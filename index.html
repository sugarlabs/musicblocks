<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Music Blocks</title>
    <meta name="description"
        content="Learn to code through music with Music Blocks. Arrange colorful blocks to create everything from simple melodies to interactive games.">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196F3">

    <!-- Icons & PWA -->
    <link rel="icon" sizes="192x192" href="favicon.ico">
    <link rel="apple-touch-icon" href="/activity/activity-icon-color-512.png">
    <link rel="manifest" href="android_chrome_manifest.json">

    <!-- Stylesheets -->
    <link rel="preload" href="https://fonts.googleapis.com/icon?family=Material+Icons" as="style"
        onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="fonts/material-icons.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="css/activities.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="dist/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="dist/css/keyboard.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="dist/css/windows.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="lib/materialize-iso.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="css/darkmode.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" as="video" href="loading-animation.webm" type="video/webm">
    <link rel="preload" as="video" href="loading-animation.mp4" type="video/mp4">
    <link rel="preload" as="image" href="loading-animation-ja.svg">
    <link rel="prefetch" type="application/l10n" href="./localization.ini" />

    <link rel="stylesheet" href="fonts/material-icons.css" />
    <link rel="stylesheet" href="lib/materialize-iso.css" />
    <link rel="stylesheet" href="css/themes.css" />

    <noscript>
        JavaScript is required to view this page.
    </noscript>

    <!-- Scripts -->
    <script src="lib/reqwest.js" defer></script>
    <script src="lib/jquery-2.1.4.min.js"></script>
    <script src="lib/jquery-ui.js" defer></script>
    <script src="lib/materialize.min.js" defer></script>
    <script src="lib/webL10n.js" defer></script>
    <script src="lib/Tone.js" defer></script>
    <script src="lib/midi.js" defer></script>
    <script src="lib/jquery.ruler.js" defer></script>
    <script src="lib/modernizr-2.6.2.min.js" defer></script>
    <script src="lib/raphael.min.js" defer></script>
    <script src="lib/wheelnav.js" defer></script>
    <script src="lib/abc.min.js" defer></script>
    <script src="lib/codejar/codejar.min.js" defer></script>
    <script src="lib/codejar/highlight.pack.js" defer></script>
    <script src="lib/astring.min.js" defer></script>
    <script data-main="js/loader" src="lib/require.js" defer></script>
    <script src="lib/easeljs.min.js" defer></script>
    <script src="lib/tweenjs.min.js" defer></script>
    <script>
        let canvas, stage, lang;
        function init() {
            canvas = document.getElementById("canvas");
            stage = new createjs.Stage(canvas);
            stage.update();
        }
    </script>
    <script>
        if ("serviceWorker" in navigator) {
            if (navigator.serviceWorker.controller) {
                console.debug(
                    "[PWA Builder] active service worker found, no need to register"
                );
            } else {
                // Register the service worker
                navigator.serviceWorker
                    .register("/sw.js")
                    .then(function (reg) {
                        console.debug(
                            "[PWA Builder] Service worker has been registered for scope: " +
                            reg.scope
                        );
                    });
            }
        }
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            doSearch();
        });
    </script>
</head>

<body id="body" onload="init();" data-title="index" style="background: #f9f9f9;">
    <!-- Moved here from outside <body> -->
    <div style="display: none;" id="chooseKeyDiv" tabindex="-1"></div>
    <div id="movable" tabindex="-1">
        <p>Solfege Pitch Preview</p>
        <input class="radioBtn" type="radio" name="movable" value="true" id="movabledo">
        <label for="movabledo">Movable Do</label>
        <input class="radioBtn" type="radio" name="movable" id="fixed" checked="checked" value="false">
        <label for="fixed">Fixed</label>
    </div>

    <div id="loading-image-container"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: #FFFFFF; z-index: 9999; contain: paint;">
        <div id="loading-media" style="width: 100%; padding: 0 20px; box-sizing: border-box;"></div>
        <div class="loading-text" id="loadingText" style="margin-top: 2rem; min-height: 1.5em; font-size: 1.2rem;"></div>
        <a href="https://www.sugarlabs.org/" target="_blank" id="link-to-sugarLabs"
            style="position: fixed; bottom: 20px; right: 20px;">
            <div class="logo-container" id="bottom-right-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 501 167" height="50" width="150">
                    <!-- Logo paths -->
                    <path d="m63.05 117.52c-11.05 0-21.12-5.5-21.12-11.539 0-3.157 2.303-5.63 5.244-5.63 2.02 0 3.719 1.183 5.515 2.435 2.592 1.809 5.529 3.855 10.651 3.855 5.139 0 8.21-2.647 8.21-5.209 0-3.416-5.271-5.607-10.852-7.927-7.799-3.243-16.639-6.918-16.639-15.886 0-10.573 9.933-16.279 19.28-16.279 7.89 0 18.895 4.132 18.895 10.86 0 2.526-1.763 5.244-5.632 5.244-2.068 0-3.558-1.125-4.997-2.212-1.872-1.414-3.994-3.02-8.266-3.02-1.209 0-7.242.227-7.242 4.726 0 2.729 4.879 4.613 10.04 6.608 7.772 3 17.446 6.739 17.446 16.333.002 12.12-10.646 17.636-20.538 17.636" class="color-change" />
                    <!-- (snip: paste your whole SVG code here) -->
                </svg>
            </div>
        </a>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                let loadL10nSplashScreen = function () {
                    console.debug("The browser is set to " + navigator.language);
                    let lang = navigator.language;
                    if (localStorage.languagePreference) {
                        console.debug(
                            "Music Blocks is set to " + localStorage.languagePreference
                        );
                        lang = localStorage.languagePreference;
                    }
                    console.debug("Using " + lang);
                    if (lang === undefined) {
                        lang = "enUS";
                        console.debug("Reverting to " + lang);
                    }
                    const container = document.getElementById("loading-media");
                    const content = lang === "ja"
                        ? `<img src="loading-animation-ja.svg" loading="eager" fetchpriority="high" style="width: 70%; height: 90%; object-fit: contain;" alt="Loading animation">`
                        : `<video loop autoplay muted playsinline fetchpriority="high" style="width: 90%; height: 100%; object-fit: contain;">
                            <source src="loading-animation.webm" type="video/webm">
                            <source src="loading-animation.mp4" type="video/mp4">
                           </video>`;
                    container.innerHTML = `<div class="media-wrapper" style="width: 100%; aspect-ratio: 16/9; max-height: 500px; display: flex; justify-content: center; align-items: center;">${content}</div>`;
                };

                loadL10nSplashScreen();

                setTimeout(function () {
                    const loadingText = document.getElementById("loadingText");
                    const texts = [_("Do, Re, Mi, Fa, Sol, La, Ti, Do"), _("Loading Music Blocks..."), _("Reading Music...")];
                    let index = 0;

                    const intervalId = setInterval(function () {
                        loadingText.textContent = texts[index];
                        index = (index + 1) % texts.length;
                    }, 1500);

                    // Stop changing text and finalize loading after 6 seconds
                    setTimeout(function () {
                        clearInterval(intervalId);
                        loadingText.textContent = _("Loading Complete!");
                        loadingText.style.opacity = 1;
                    }, 6000);
                }, 3000);
            });
        </script>
    </div>

    <script>
        (function ($) {
            $.fn.fixMe = function () {
                return this.each(function () {
                    let $this = $(this),
                        $t_fixed;

                    function init() {
                        $this.wrap('<div class="container" />');
                        $t_fixed = $this.clone();
                        $t_fixed
                            .find("tbody")
                            .remove()
                            .end()
                            .addClass("fixed")
                            .insertBefore($this);
                        resizeFixed();
                    }
                    function resizeFixed() {
                        setTimeout(function () {
                            $t_fixed.find("th").each(function (index) {
                                $(this).css(
                                    "width",
                                    $this
                                        .find("th")
                                        .eq(index)
                                        .outerWidth() + "px"
                                );
                            });
                        }, 100);
                    }
                    function scrollFixed() {
                        let offset = $(this).scrollTop(),
                            tableOffsetTop = $this.offset().top,
                            tableOffsetBottom =
                                tableOffsetTop +
                                $this.height() -
                                $this.find("thead").height();

                        if (
                            offset < tableOffsetTop ||
                            offset > tableOffsetBottom
                        ) {
                            $t_fixed.hide();
                        } else if (
                            offset >= tableOffsetTop &&
                            offset <= tableOffsetBottom &&
                            $t_fixed.is(":hidden")
                        ) {
                            $t_fixed.show();
                        }
                    }
                    $(window).resize(resizeFixed);
                    $(window).scroll(scrollFixed);
                    init();
                });
            };
            jQuery;
            $(document).ready(function () {
                $("solfa").fixMe();
                $(".up").click(function () {
                    $("html, body").animate(
                        {
                            scrollTop: 0
                        },
                        2000
                    );
                });
            });
        });
        let isDragging = false;
    </script>

    <canvas id="canvas" width="100%" height="100%" style="background-color:#FFFFFF; width:100%"></canvas>
    <div id="hideContents" style="display: none;" tabindex="-1">
        <!-- All of your code for canvasHolder, popups, modals, toolbars, etc. goes here, line for line. 
             (Copy from your actual file or paste the entire content) -->
             (snip)
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let persistentNotification = null;
            function showPersistentNotification() {
                if (!persistentNotification) {
                    persistentNotification = document.createElement("div");
                    persistentNotification.id = "persistentNotification";
                    persistentNotification.innerHTML = "Play only mode enabled. For full Music Blocks experience, use a larger display.";
                    document.body.appendChild(persistentNotification);
                }
            }
            function removePersistentNotification() {
                if (persistentNotification) {
                    persistentNotification.remove();
                    persistentNotification = null;
                }
            }
            function hideElementById(elementId) {
                const elem = document.getElementById(elementId);
                if (elem) {
                  elem.style.display = "none";
                }
            }
            function showElementById(elementId) {
                const elem = document.getElementById(elementId);
                if (elem) {
                  elem.style.display = "";
                }
            }
            function togglePlayOnlyMode() {
                const isSmallScreen = (window.innerWidth < 768) || (window.innerHeight < 600);
                const body = document.body;
                const homeButton = document.getElementById("Home [HOME]");
                const buttonContainer = document.getElementById("buttoncontainerBOTTOM");
                if (isSmallScreen) {
                    body.classList.add("play-only");
                    showPersistentNotification();
                    if (buttonContainer) {
                        buttonContainer.style.display = "flex";
                        buttonContainer.style.justifyContent = "flex-end";
                        buttonContainer.style.alignItems = "center";
                    }
                    if (homeButton) {
                        homeButton.style.display = "flex";
                        homeButton.style.position = "fixed";
                        homeButton.style.right = "15px";
                        homeButton.style.bottom = "15px";
                        homeButton.style.zIndex = "10000";
                    }
                    hideElementById("Show/hide blocks");
                    hideElementById("Expand/collapse blocks");
                    hideElementById("Decrease block size");
                    hideElementById("Increase block size");
                    hideElementById("grid");
                    hideElementById("palette");
                } else {
                    body.classList.remove("play-only");
                    removePersistentNotification();
                    if (homeButton) homeButton.style = "";
                    if (buttonContainer) buttonContainer.style = "";
                    showElementById("Show/hide blocks");
                    showElementById("Expand/collapse blocks");
                    showElementById("Decrease block size");
                    showElementById("Increase block size");
                    showElementById("grid");
                    showElementById("palette");
                }
            }
            togglePlayOnlyMode();
            window.addEventListener("resize", togglePlayOnlyMode);
        });
    </script>
    <div id="searchBar" tabindex="-1">
        <input type="text" name="search" id="search" class="ui-autocomplete" placeholder="Search for Blocks" tabindex="-1" />
        <ul class="matches" id="searchResults"></ul>
    </div>
</body>
</html>