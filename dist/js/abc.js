"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _slicedToArray(t,o){return _arrayWithHoles(t)||_iterableToArrayLimit(t,o)||_unsupportedIterableToArray(t,o)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,o){if(t){if("string"==typeof t)return _arrayLikeToArray(t,o);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,o):void 0}}function _arrayLikeToArray(t,o){(null==o||o>t.length)&&(o=t.length);for(var n=0,e=Array(o);n<o;n++)e[n]=t[n];return e}function _iterableToArrayLimit(t,o){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var e,a,i,r,N=[],s=!0,T=!1;try{if(i=(n=n.call(t)).next,0===o){if(Object(n)!==n)return;s=!1}else for(;!(s=(e=i.call(n)).done)&&(N.push(e.value),N.length!==o);s=!0);}catch(t){T=!0,a=t}finally{try{if(!s&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(T)throw a}}return N}}function _arrayWithHoles(t){if(Array.isArray(t))return t}var ABCHEADER="X:1\nT:Music Blocks composition\nC:Mr. Mouse\nL:1/16\nM:C\n",OCTAVE_NOTATION_MAP={10:"'''''",9:"''''",8:"'''",7:"''",6:"'",5:"",4:"",3:",",2:",,",1:",,,"},ACCIDENTAL_MAP={"♯":"^","♭":"_"},getABCHeader=function(){return ABCHEADER},processABCNotes=function(l,u){l.notationNotes[u]="";for(var g,f,I=function(t){return{64:"1/4",32:"1/2",16:"1",8:"2",4:"4",2:"8",1:"16"}[t]||t.toString()},b=function(t){var o;"number"==typeof t&&(t=(o=frequencyToPitch(t))[0]+o[1]);for(var n=0,e=Object.entries(ACCIDENTAL_MAP);n<e.length;n++){var a=_slicedToArray(e[n],2),i=a[0],r=a[1];t=t.replace(new RegExp(i,"g"),r)}for(var N=0,s=Object.entries(OCTAVE_NOTATION_MAP);N<s.length;N++){var T=_slicedToArray(s[N],2),O=T[0],A=T[1];if(t.includes(O)){t=t.replace(new RegExp(O,"g"),A);break}}return t.includes("'")||""===t?t.toLowerCase():t.toUpperCase()},p=0,y=!1,C=!1,S=0,E=0,d=0;d<l.notation.notationStaging[u].length;d++)!function(s){var T=l.notation.notationStaging[u][s];if("string"==typeof T)switch(T){case"break":0<s&&(l.notationNotes[u]+="\n"),p=0;break;case"begin articulation":C=!0;break;case"end articulation":C=!1;break;case"begin crescendo":l.notationNotes[u]+="!<(!";break;case"end crescendo":l.notationNotes[u]+="!<)!";break;case"begin decrescendo":l.notationNotes[u]+="!>(!";break;case"end decrescendo":l.notationNotes[u]+="!<(!";break;case"begin slur":y=!0;break;case"end slur":case"tie":l.notationNotes[u]+="";break;case"meter":l.notationNotes[u]+="M:"+l.notation.notationStaging[u][s+1]+"/"+l.notation.notationStaging[u][s+2]+"\n",s+=2;break;case"pickup":var t=l.notation.notationStaging[u][s+1];l.notationNotes[u]+="K: pickup=".concat(t,"\n"),s+=1;break;case"voice one":l.notationNotes[u]+="V:1\n";break;case"voice two":l.notationNotes[u]+="V:2\n";break;case"voice three":l.notationNotes[u]+="V:3\n";break;case"voice four":l.notationNotes[u]+="V:4\n";break;case"one voice":l.notationNotes[u]+="V:1\n";break;default:l.notationNotes[u]+=T}else{p%8==0&&0<p&&(l.notationNotes[u]+="\n"),p+=1,f="string"==typeof T[NOTATIONNOTE]?b(T[NOTATIONNOTE]):(g=T[NOTATIONNOTE],b(g[0]));var o=0;if(null!=T[NOTATIONTUPLETVALUE]){S=1/l.notation.notationStaging[u][s][NOTATIONDURATION],E=1/l.notation.notationStaging[u][s][NOTATIONROUNDDOWN];for(var n=1,e=1;e<T[NOTATIONTUPLETVALUE];){if(s+n>=l.notation.notationStaging[u].length){o=n;break}if(0<l.notation.notationStaging[u][s+n][NOTATIONINSIDECHORD]&&l.notation.notationStaging[u][s+n][NOTATIONINSIDECHORD]===l.notation.notationStaging[u][s+n-1][NOTATIONINSIDECHORD])n++;else{if(l.notation.notationStaging[u][s+n][NOTATIONTUPLETVALUE]!==T[NOTATIONTUPLETVALUE]){o=n;break}S+=1/l.notation.notationStaging[u][s+n][NOTATIONDURATION],E+=1/l.notation.notationStaging[u][s+n][NOTATIONROUNDDOWN],n++,e++}}}var a,i,r=function(t,o,n,e){for(var a,i=0,r=0;r<e;)if("object"===_typeof(g)){1<g.length&&(t.notationNotes[o]+="[");for(var N=0;N<g.length;N++)t.notationNotes[o]+=b(g[N]),t.notationNotes[o]+=" ";T[NOTATIONSTACCATO]&&(t.notationNotes[o]+="."),1<g.length&&(t.notationNotes[o]+="]"),t.notationNotes[o]+=t.notation.notationStaging[o][n+i][NOTATIONROUNDDOWN],i++,r++}else console.debug("ignoring "+g),i++,r++;return n+i-1<t.notation.notationStaging[o].length-1&&"string"==typeof(a=t.notation.notationStaging[o][n+i])&&")"===a?n+=1:t.notationNotes[o]+=" ",n=s,i};if(0<T[NOTATIONTUPLETVALUE]){0===o?(a=toFraction(E/S),l.notationNotes[u]+="("+a[0]+":"+a[1],s+=r(l,u,s,T[NOTATIONTUPLETVALUE])-1):(i=toFraction(T[NOTATIONTUPLETVALUE]/o),l.notationNotes[u]+="("+i[0]+":"+i[1],s+=r(l,u,s,o)-1),E=S=0}else{if("object"===_typeof(g)){1<g.length&&(l.notationNotes[u]+="[");for(var N=0;N<g.length;N++)l.notationNotes[u]+=b(g[N]);1<g.length&&(l.notationNotes[u]+="]"),l.notationNotes[u]+=T[NOTATIONDURATION];for(var O=0;O<T[NOTATIONDOTCOUNT];O++)l.notationNotes[u]+=".";l.notationNotes[u]+=" "}if(T[NOTATIONSTACCATO]&&(l.notationNotes[u]+="."),0<T[NOTATIONINSIDECHORD]){if(0!==s&&l.notation.notationStaging[u][s-1][NOTATIONINSIDECHORD]===T[NOTATIONINSIDECHORD]||(l.notationNotes[u]+="["),l.notationNotes[u]+=f,s===l.notation.notationStaging[u].length-1||l.notation.notationStaging[u][s+1][NOTATIONINSIDECHORD]!==T[NOTATIONINSIDECHORD]){l.notationNotes[u]+="]",l.notationNotes[u]+=I(T[NOTATIONDURATION]);for(var A=0;A<T[NOTATIONDOTCOUNT];A++)l.notationNotes[u]+=" ";C&&(l.notationNotes[u]+=" "),l.notationNotes[u]+=" "}}else{l.notationNotes[u]+=f,l.notationNotes[u]+=I(T[NOTATIONDURATION]);for(var c=0;c<T[NOTATIONDOTCOUNT];c++)l.notationNotes[u]+=".";C&&(l.notationNotes[u]+="")}T[NOTATIONSTACCATO]&&(l.notationNotes[u]+="."),E=S=0}l.notationNotes[u]+=" ",y&&(y=!1,l.notationNotes[u]+="")}d=s}(d)},saveAbcOutput=function(t){for(var o in t.logo.notationOutput=getABCHeader(),t.logo.notation.notationStaging)t.logo.notationOutput+="K:"+t.turtles.ithTurtle(o).singer.keySignature.toUpperCase().replace(" ","").replace("♭","b").replace("♯","#")+"\n",processABCNotes(t.logo,o),t.logo.notationOutput+=t.logo.notationNotes[o];return t.logo.notationOutput+="\n",t.logo.notationOutput};"undefined"!=typeof module&&module.exports&&(module.exports={getABCHeader:getABCHeader,processABCNotes:processABCNotes,saveAbcOutput:saveAbcOutput,ACCIDENTAL_MAP:ACCIDENTAL_MAP,OCTAVE_NOTATION_MAP:OCTAVE_NOTATION_MAP});