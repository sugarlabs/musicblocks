"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);var r=n.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(n){var r=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(n);return _possibleConstructorReturn(this,r?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function setupActionBlocks(g){var t=function(){_inherits(n,FlowBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"return")).setPalette("action",g),t.setHelpString([_("The Return block will return a value from an action."),"documentation",""]),t.formBlock({name:_("return"),args:1,defaults:[100],argTypes:["anyin"]}),t}return _createClass(n,[{key:"flow",value:function(t,e,n){1===t.length&&e.returns[n].push(t[0])}}]),n}(),e=function(){_inherits(n,FlowBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"returnToUrl")).setPalette("action",g),t.setHelpString([_("The Return to URL block will return a value to a webpage."),"documentation",""]),t.formBlock({name:_("return to URL"),args:1,defaults:[100],argTypes:["anyin"]}),t}return _createClass(n,[{key:"flow",value:function(t){var e,n,r,a,o,l=window.location.href;if(0<l.indexOf("?")&&0<(e=l.split("?"))[1].indexOf("&"))for(var i=e[1].split("&"),s=0;s<i.length;s++)if(0<i[s].indexOf("=")){var c=i[s].split("=");switch(c[0].toLowerCase()){case"outurl":n=c[1]}}1===t.length&&((r={}).result=t[0],a=JSON.stringify(r),(o=new XMLHttpRequest).open("POST",n,!0),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&alert(o.responseText)},o.send(a))}}]),n}(),n=function(){_inherits(n,LeftBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"calc")).setPalette("action",g),t.setHelpString([_("The Calculate block returns a value calculated by an action."),"documentation",""]),t.formBlock({name:_("calculate"),outType:"anyout",args:1,defaults:[_("action")],argTypes:["anyin"]}),t}return n}(),r=function(){_inherits(n,ValueBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"namedcalc")).setPalette("action",g),t.setHelpString([_("The Calculate block returns a value calculated by an action."),"documentation",""]),t.extraWidth=20,t.formBlock({name:_("action")}),t}return _createClass(n,[{key:"arg",value:function(t,e,n,r){var a=g.blocks.blockList[n].privateData,o=r;return a in t.actions?(g.turtles.getTurtle(e).running=!0,t.runFromBlockNow(t,e,t.actions[a],!0,o,g.turtles.getTurtle(e).queue.length),t.returns[e].shift()):(g.errorMsg(NOACTIONERRORMSG,n,a),0)}}]),n}(),a=function(){_inherits(n,FlowClampBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"nameddoArg")).setPalette("action",g),t.setHelpString([_("The Do block is used to initiate an action."),"documentation",""]),t.formBlock({name:"ja"===t.lang?_("do1"):_("do"),flows:{type:"arg",types:["anyin"]}}),t}return _createClass(n,[{key:"flow",value:function(t,e,n,r,a,o){for(var l=g.blocks.blockList[r].privateData;0<o.length;)o.pop();if(0<g.blocks.blockList[r].argClampSlots.length)for(var i,s=0;s<g.blocks.blockList[r].argClampSlots.length;s++){null!=g.blocks.blockList[r].connections[s+1]?(i=e.parseArg(e,n,g.blocks.blockList[r].connections[s+1],r,a),o.push(i)):o.push(null)}var c,u,f,p,h=g.turtles.ithTurtle(n);if(l in e.actions)return 0===h.singer.justCounting.length&&e.notation.notationLineBreak(n),0<h.singer.backward.length?(c=g.blocks.findBottomBlock(e.actions[l]),u=g.blocks.findTopBlock(e.actions[l]),h.singer.backward.push(u),f="_backward_action_"+n+"_"+r,e.setDispatchBlock(r,n,f),null===(p=g.blocks.blockList[u].connections[2])?h.singer.backward.pop():p in h.endOfClampSignals?h.endOfClampSignals[p].push(f):h.endOfClampSignals[p]=[f],e.setTurtleListener(n,f,function(){return h.singer.backward.pop()})):c=e.actions[l],[c,1];g.errorMsg(NOACTIONERRORMSG,r,l)}}]),n}(),o=function(){_inherits(n,LeftBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"namedcalcArg")).setPalette("action",g),t.setHelpString([_("The Calculate block returns a value calculated by an action."),"documentation",""]),t.formBlock({name:_("calculate"),flows:{type:"arg",types:["anyin"],labels:[""]},outType:"anyout"}),t}return _createClass(n,[{key:"arg",value:function(t,e,n,r){var a=g.blocks.blockList[n].privateData,o=[];if(0<g.blocks.blockList[n].argClampSlots.length)for(var l=0;l<g.blocks.blockList[n].argClampSlots.length;l++){var i=t.parseArg(t,e,g.blocks.blockList[n].connections[l+1],n,r);o.push(i)}return a in t.actions?(g.turtles.getTurtle(e).running=!0,t.runFromBlockNow(t,e,t.actions[a],!0,o,g.turtles.getTurtle(e).queue.length),t.returns[e].pop()):(g.errorMsg(NOACTIONERRORMSG,n,a),0)}}]),n}(),l=function(){_inherits(n,FlowClampBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"doArg")).setPalette("action",g),t.setHelpString([_("The Do block is used to initiate an action."),"documentation",""]),t.formBlock({name:"ja"===t.lang?_("do1"):_("do"),flows:{type:"arg",types:["anyin"]},args:1,argTypes:["anyin"],defaults:[_("action")]}),t}return _createClass(n,[{key:"flow",value:function(t,e,n,r,a,o){for(;0<o.length;)o.pop();if(0<g.blocks.blockList[r].argClampSlots.length)for(var l,i=0;i<g.blocks.blockList[r].argClampSlots.length;i++){null!=g.blocks.blockList[r].connections[i+2]?(l=e.parseArg(e,n,g.blocks.blockList[r].connections[i+2],r,a),o.push(l)):o.push(null)}if(1<=t.length){if(t[0]in e.actions)return 0===g.turtles.ithTurtle(n).singer.justCounting.length&&e.notation.notationLineBreak(n),[e.actions[t[0]],1];g.errorMsg(NOACTIONERRORMSG,r,t[0])}}}]),n}(),i=function(){_inherits(n,LeftBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"calcArg")).setPalette("action",g),t.setHelpString([_("The Calculate block returns a value calculated by an action."),"documentation",""]),t.formBlock({name:_("calculate"),outType:"anyout",flows:{type:"arg",types:["anyin"],labels:[""]},args:1,argTypes:["anyin"],defaults:[_("action")]}),t}return _createClass(n,[{key:"arg",value:function(t,e,n,r){var a=[];if(0<g.blocks.blockList[n].argClampSlots.length)for(var o=0;o<g.blocks.blockList[n].argClampSlots.length;o++){var l=t.parseArg(t,e,g.blocks.blockList[n].connections[o+2],n,r);a.push(l)}var i=g.blocks.blockList[n].connections[1];if(null===i)return g.errorMsg(NOINPUTERRORMSG,n),0;var s=t.parseArg(t,e,i,n,r);return s in t.actions?(g.turtles.getTurtle(e).running=!0,t.runFromBlockNow(t,e,t.actions[s],!0,a,g.turtles.getTurtle(e).queue.length),t.returns[e].pop()):(g.errorMsg(NOACTIONERRORMSG,n,s),0)}}]),n}(),s=function(){_inherits(n,LeftBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"arg")).setPalette("action",g),t.setHelpString([_("The Arg block contains the value of an argument passed to an action."),"documentation",""]),t.formBlock({name:_("arg"),outType:"anyout",args:1,defaults:[1],argTypes:["numberin"]}),t}return _createClass(n,[{key:"arg",value:function(t,e,n,r){var a=g.blocks.blockList[n].connections[1];if(null===a)return g.errorMsg(NOINPUTERRORMSG,n),0;var o=t.parseArg(t,e,a,n,r),l=r;return l&&l.length>=Number(o)?l[Number(o)-1]:(g.errorMsg(_("Invalid argument"),n),0)}}]),n}(),c=function(){_inherits(n,LeftBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"namedarg")).setPalette("action",g),t.setHelpString([_("The Arg block contains the value of an argument passed to an action."),"documentation",""]),t.formBlock({name:_("arg")+1,flows:{type:"value"}}),t}return _createClass(n,[{key:"arg",value:function(t,e,n,r){var a=g.blocks.blockList[n].privateData,o=r;return null!==o&&o.length>=Number(a)?o[Number(a)-1]:(g.errorMsg(_("Invalid argument"),n),0)}}]),n}(),u=function(){_inherits(n,FlowBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"do")).setPalette("action",g),t.beginnerBlock(!0),t.setHelpString([_("The Do block is used to initiate an action.")+" "+_("In the example, it is used with the One of block to choose a random phase."),"documentation",null,"dohelp"]),t.formBlock({name:"ja"===t.lang?_("do1"):_("do"),args:1,defaults:[_("action")],argTypes:["anyin"]}),t}return _createClass(n,[{key:"flow",value:function(t,e,n,r){if(0!==t.length){if(t[0]in e.actions)return 0===g.turtles.ithTurtle(n).singer.justCounting.length&&e.notation.notationLineBreak(n),[e.actions[t[0]],1];console.debug("action "+t[0]+" not found"),g.errorMsg(NOACTIONERRORMSG,r,t[0])}}}]),n}(),f=function(){_inherits(n,FlowBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"listen")).setPalette("action",g),t.beginnerBlock(!0),"ja"===t.lang?(t.extraWidth=15,t.setHelpString([_("The Listen block is used to listen for an event such as a mouse click."),"documentation",null,"broadcasthelp"])):t.setHelpString([_("The Listen block is used to listen for an event such as a mouse click.")+" "+_("When the event happens, an action is taken."),"documentation",null,"broadcasthelp"]),t.formBlock({name:_("on"),args:2,argTypes:["anyin","anyin"],argLabels:[_("event"),"ja"===t.lang?_("do1"):_("do")],defaults:[_("event"),_("action")]}),t}return _createClass(n,[{key:"flow",value:function(n,r,a,o,l){var i;2===n.length&&(n[1]in r.actions?(i=g.turtles.ithTurtle(a),r.setTurtleListener(a,n[0],function(){var t,e;i.running?(t=new Queue(r.actions[n[1]],1,o),i.parentFlowQueue.push(o),i.queue.push(t)):(i.singer.runningFromEvent=!0,e=((new Date).getTime()-g.logo.firstNoteTime)/1e3,i.singer.turtleTime=e,r.runFromBlockNow(r,a,r.actions[n[1]],!1,l))})):g.errorMsg(NOACTIONERRORMSG,o,n[1]))}}]),n}(),p=function(){_inherits(n,FlowBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"dispatch")).setPalette("action",g),t.beginnerBlock(!0),t.setHelpString([_("The Broadcast block is used to trigger an event."),"documentation",null,"broadcasthelp"]),t.formBlock({name:_("broadcast"),args:1,defaults:[_("event")],argTypes:["anyin"]}),t}return _createClass(n,[{key:"flow",value:function(t,e){var n;1===t.length&&(t[0]in e.eventList||(n=new Event(t[0]),e.eventList[t[0]]=n),g.stage.dispatchEvent(t[0]))}}]),n}(),h=function(){_inherits(n,StackClampBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"start")).setPalette("action",g),t.beginnerBlock(!0),t.setHelpString([_("Each Start block is a separate voice.")+" "+_("All of the Start blocks run at the same time when the Play button is pressed."),"documentation",""]),t.formBlock({name:_("start"),canCollapse:!0}),t}return _createClass(n,[{key:"flow",value:function(t){if(1===t.length)return[t[0],1]}}]),n}(),k=function(){_inherits(n,h);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this)).changeName("startdrum"),t.formBlock({name:_("start drum")}),t.makeMacro(function(t,e){return[[0,"start",t,e,[null,1,null]],[1,"setdrum",0,0,[0,2,null,3]],[2,["drumname",{value:"kick drum"}],0,0,[1]],[3,"hidden",0,0,[1,null]]]}),t}return n}(),b=function(){_inherits(n,StackClampBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"action")).setPalette("action",g),t.beginnerBlock(!0),t.setHelpString([_("The Action block is used to group together blocks so that they can be used more than once.")+" "+_("It is often used for storing a phrase of music that is repeated."),"documentation",null,"actionhelp"]),t.formBlock({canCollapse:!0,name:_("action"),args:1,argLabels:[""],defaults:[_("action")],argTypes:["anyin"]}),t.makeMacro(function(t,e){return[[0,"action",t,e,[null,1,2,null]],[1,["text",{value:_("action")}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),t}return _createClass(n,[{key:"flow",value:function(t,e,n,r){if(0!==t.length){if(t[0]in e.actions)return 0===g.turtles.ithTurtle(n).singer.justCounting.length&&e.notation.notationLineBreak(n),[e.actions[t[0]],1];console.debug("action "+t[0]+" not found"),g.errorMsg(NOACTIONERRORMSG,r,t[0])}}}]),n}(),d=function(){_inherits(n,FlowBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"nameddo")).setPalette("action",g),t.setHelpString([_("The Do block is used to initiate an action."),"documentation",""]),t.extraWidth=30,t.formBlock({name:_("action")}),t.hidden=!0,t}return _createClass(n,[{key:"flow",value:function(t,e,n,r){var a=g.blocks.blockList[r].privateData;a in e.actions||g.errorMsg(NOACTIONERRORMSG,r,a);var o,l,i,s,c=g.turtles.ithTurtle(n);return 0===c.singer.justCounting.length&&e.notation.notationLineBreak(n),0<c.singer.backward.length?(o=g.blocks.findBottomBlock(e.actions[a]),l=g.blocks.findTopBlock(e.actions[a]),c.singer.backward.push(l),i="_backward_action_"+n+"_"+r,e.setDispatchBlock(r,n,i),null===(s=g.blocks.blockList[l].connections[2])?c.singer.backward.pop():s in c.endOfClampSignals?c.endOfClampSignals[s].push(i):c.endOfClampSignals[s]=[i],e.setTurtleListener(n,i,function(){return c.singer.backward.pop()})):o=e.actions[a],[o,1]}}]),n}(),m=function(){_inherits(n,StackClampBlock);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this,"temperament1")).setPalette("action",g),t.formBlock({name:_("define temperament"),args:1,canCollapse:!0,argLabels:[""],defaults:["custom"],argTypes:["text"]}),t.makeMacro(function(t,e){return[[0,"temperament1",t,e,[null,1,2,null]],[1,["text",{value:"custom"}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),t.hidden=!0,t}return _createClass(n,[{key:"flow",value:function(){}}]),n}();(new t).setup(g),(new e).setup(g),(new n).setup(g),(new r).setup(g),(new a).setup(g),(new o).setup(g),(new l).setup(g),(new i).setup(g),(new s).setup(g),(new c).setup(g),(new u).setup(g),(new f).setup(g),(new p).setup(g),(new k).setup(g),(new h).setup(g),(new b).setup(g),(new d).setup(g),(new m).setup(g)}