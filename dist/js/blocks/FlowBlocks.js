"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var o=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,o?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function setupFlowBlocks(v){var e=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"backward")).setPalette("flow",v),e.beginnerBlock(!0),e.setHelpString([_("The Backward block runs code in reverse order (Musical retrograde)."),"documentation",""]),e.formBlock({name:_("backward")}),e.makeMacro(function(e,t){return[[0,"backward",e,t,[null,1,null]],[1,"hidden",0,0,[0,null]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,o){var l=v.turtles.ithTurtle(n);l.singer.backward.push(o);var r=v.blocks.findBottomBlock(e[0]),i="_backward_"+n+"_"+o;t.setDispatchBlock(o,n,i);var s=v.blocks.blockList[o].connections[2];null===s?l.singer.backward.pop():s in l.endOfClampSignals?l.endOfClampSignals[s].push(i):l.endOfClampSignals[s]=[i];return t.setTurtleListener(n,i,function(){return l.singer.backward.pop()}),[r,1]}}]),n}(),t=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"duplicatenotes")).setPalette("flow",v),e.piemenuValuesC1=[2,3,4,5,6,7,8],e.setHelpString([_("The Duplicate block will run each block multiple times.")+" "+_("The output of the example is: Sol, Sol, Sol, Sol, Re, Re, Re, Re, Sol, Sol, Sol, Sol."),"documentation",null,"duphelp"]),e.formBlock({name:_("Duplicate").toLowerCase(),args:1,defaults:[2]}),e.makeMacro(function(e,t){return[[0,"duplicatenotes",e,t,[null,1,null,2]],[1,["number",{value:2}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _createClass(n,[{key:"flow",value:function(e,l,o,r,t){if(void 0!==e[1]){var n=null===e[0]||"number"!=typeof e[0]||e[0]<1?(v.errorMsg(NOINPUTERRORMSG,r),2):e[0],i=Math.floor(n);if(i<1)v.errorMsg(ZERODIVIDEERRORMSG,r),l.stopTurtle=!0;else{var s=v.turtles.ithTurtle(o);s.singer.duplicateFactor*=i;var a="_duplicate_"+o;l.setDispatchBlock(r,o,a);var c=function(e,t){for(var n in l.connectionStore)if(n!==t.toString())for(var o in l.connectionStore[n])if(o===e.toString())return n;return null};s.singer.inDuplicate=!0;l.setTurtleListener(o,a,function(){if(s.singer.inDuplicate=!1,s.singer.duplicateFactor/=i,l.connectionStoreLock&&console.debug("LOCKED"),l.connectionStoreLock=!0,null===c(r,o))for(var e=l.connectionStore[o][r].length,t=0;t<e;t++){var n=l.connectionStore[o][r].pop();v.blocks.blockList[n[0]].connections[n[1]]=n[2],null!=n[2]&&(v.blocks.blockList[n[2]].connections[0]=n[0])}else delete l.connectionStore[o][r];l.connectionStoreLock=!1}),l.connectionStoreLock&&console.debug("LOCKED"),l.connectionStoreLock=!0;var u=c(r,o);if(null!=u){l.connectionStore[o][r]=[];for(var p=l.connectionStore[u][r].length;0<p;p--){var f=[l.connectionStore[u][r][p-1][0],l.connectionStore[u][r][p-1][1],l.connectionStore[u][r][p-1][2]];l.connectionStore[o][r].push(f);var h=f[0];"hidden"===v.blocks.blockList[h].name&&(h=v.blocks.blockList[h].connections[0]);var k=new Queue(h,i,r,t);s.parentFlowQueue.push(r),s.queue.push(k)}}else{for(var _,w=v.blocks.findBottomBlock(e[1]);w!=r;){"hidden"!==v.blocks.blockList[w].name&&(_=new Queue(w,i,r,t),s.parentFlowQueue.push(r),s.queue.push(_)),w=v.blocks.blockList[w].connections[0]}for(l.connectionStore[o][r]=[],w=e[1];null!=w;){var d=v.blocks.blockList[w].connections.length-1,b=v.blocks.blockList[w].connections[d];null!=b&&"hidden"===v.blocks.blockList[b].name?(l.connectionStore[o][r].push([b,1,v.blocks.blockList[b].connections[1]]),w=v.blocks.blockList[b].connections[1],v.blocks.blockList[b].connections[1]=null):(l.connectionStore[o][r].push([w,d,b]),v.blocks.blockList[w].connections[d]=null,w=b),null!=w&&(v.blocks.blockList[w].connections[0]=null)}}l.connectionStoreLock=!1}}}}]),n}(),n=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"defaultcase")).setPalette("flow",v),e.setHelpString([_("The Default block is used inside of a Switch to define the default action."),"documentation",null,"switchhelp"]),e.formBlock({name:_("default")}),e.updateDockValue(0,"caseout"),e.updateDockValue(2,"casein"),e}return _createClass(n,[{key:"flow",value:function(e,t,n,o){var l=last(t.switchBlocks[n]);if(null===l)return v.errorMsg(_("The Case Block must be used inside of a Switch Block."),o),void(t.stopTurtle=!0);var r=t.switchCases[n][l].length;t.switchCases[n][l][r-1].push(["__default__",e[0]])}}]),n}(),o=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"case")).setPalette("flow",v),e.setHelpString([_("The Case block is used inside of a Switch to define matches."),"documentation",null,"switchhelp"]),e.formBlock({name:_("case"),args:1,argTypes:["anyin"]}),e.updateDockValue(0,"caseout"),e.updateDockValue(3,"casein"),e}return _createClass(n,[{key:"flow",value:function(e,t,n,o){var l=last(t.switchBlocks[n]);if(null===l)return v.errorMsg(_("The Case Block must be used inside of a Switch Block."),o),void(t.stopTurtle=!0);var r=t.switchCases[n][l].length;t.switchCases[n][l][r-1].push([e[0],e[1]])}}]),n}(),l=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"switch")).setPalette("flow",v),e.setHelpString([_("The Switch block will run the code in the matching Case."),"documentation",null,"switchhelp"]),e.formBlock({name:_("switch"),args:1,argTypes:["anyin"]}),e.makeMacro(function(e,t){return[[0,"switch",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"case",0,0,[0,3,null,4]],[3,["number",{value:1}],0,0,[2]],[4,"defaultcase",0,0,[2,null,null]],[5,"hidden",0,0,[0,null]]]}),e.updateDockValue(2,"casein"),e}return _createClass(n,[{key:"flow",value:function(e,i,s,t){var a=v.turtles.ithTurtle(s);i.switchBlocks[s].push(t),t in i.switchCases[s]?i.switchCases[s][t].push([]):i.switchCases[s][t]=[[]];var n="_switch_"+t+"_"+s;i.setDispatchBlock(t,s,n);return i.setTurtleListener(s,n,function(){for(var e,t=last(i.switchBlocks[s]),n=v.blocks.blockList[t].connections[1],o=null==n?"__default__":i.parseArg(i,s,n,i.receivedArg),l=null,r=0;r<last(i.switchCases[s][t]).length;r++){if(last(i.switchCases[s][t])[r][0]===o){l=last(i.switchCases[s][t])[r][1];break}"__default__"===last(i.switchCases[s][t])[r][0]&&(l=last(i.switchCases[s][t])[r][1])}null!=l&&(e=new Queue(l,1,t,null),a.parentFlowQueue.push(t),a.queue.push(e)),i.switchCases[s][t].pop(),i.switchBlocks[s].pop()}),[e[1],1]}}]),n}(),r=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"clamp")).setPalette("flow",v),e.setHelpString(),e.hidden=!0,e.formBlock({name:""},!1),e}return _createClass(n,[{key:"flow",value:function(e){if(1===e.length)return[e[0],1]}}]),n}(),i=function(){_inherits(n,BaseBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"break")).setPalette("flow",v),e.setHelpString([_("The Stop block will stop a loop")+": "+_("Forever, Repeat, While, or Until."),"documentation",""]),e.formBlock({name:_("Stop").toLowerCase(),flows:{top:!0,bottom:"tail",type:""}}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,o){var l=v.turtles.ithTurtle(n);t.doBreak(l);var r=v.blocks.blockList[o].connections[0];null!=r&&(l.singer.suppressOutput||0!==l.singer.justCounting.length||l.unhighlightQueue.push(r))}}]),n}(),s=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"waitFor")).setPalette("flow",v),e.setHelpString([_("The Waitfor block will wait until the condition is true."),"documentation",null,"waitforhelp"]),e.formBlock({name:_("wait for"),args:1,argTypes:["booleanin"]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,o){if(1===e.length){var l=v.turtles.ithTurtle(n);if(e[0]){for(var r=!1,i=l.queue.length-1;0<i;i--)l.queue[i].parentBlk===o&&(r?l.queue.pop():r=!0);null===t.firstNoteTime&&(t.firstNoteTime=(new Date).getTime());var s=((new Date).getTime()-this.firstNoteTime)/1e3;l.singer.turtleTime=s,l.singer.previousTurtleTime=s}else{var a=v.blocks.blockList[o].connections[0],c=new Queue(o,1,a);l.parentFlowQueue.push(a),l.queue.push(c),l.doWait(.05)}}}}]),n}(),a=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"until")).setPalette("flow",v),e.setHelpString([_("The Until block will repeat until the condition is true."),"documentation",null,"untilhelp"]),e.formBlock({name:_("until"),flows:{labels:["ja"===e.lang?_("do2"):_("do")]},args:1,argTypes:["booleanin"]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,o){if(2===e.length){var l=v.turtles.ithTurtle(n);if(e[0])for(var r=l.queue.length-1;0<r;r--)l.queue[r].parentBlk===o&&l.queue.pop();else{var i=l.queue.length;0<i&&l.queue[i-1].parentBlk===o&&l.queue.pop();var s=v.blocks.blockList[o].connections[0],a=new Queue(o,1,s);l.parentFlowQueue.push(s),l.queue.push(a)}return[e[1],1]}}}]),n}(),c=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"while")).setPalette("flow",v),e.setHelpString([_("The While block will repeat while the condition is true."),"documentation",null,"whilehelp"]),e.formBlock({name:_("while"),flows:{labels:["ja"===e.lang?_("do2"):_("do")]},args:1,argTypes:["booleanin"]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,o){if(2===e.length){var l=v.turtles.ithTurtle(n);if(e[0]){var r=l.queue.length;0<r&&l.queue[r-1].parentBlk===o&&l.queue.pop();var i=v.blocks.blockList[o].connections[0],s=new Queue(o,1,i);return l.parentFlowQueue.push(i),l.queue.push(s),[e[1],1]}for(var a=l.queue.length-1;0<a;a--)l.queue[a].parentBlk===o&&l.queue.pop();return[e[1],1]}}}]),n}(),u=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"ifthenelse")).setPalette("flow",v),e.beginnerBlock(!0),v.beginnerMode&&"ja"===e.lang?e.setHelpString([_("Conditionals lets your program take different actions depending on the condition.")+" "+_("In this example if the mouse button is pressed a snare drum will play."),"documentation",null,"elifhelp"]):e.setHelpString([_("Conditionals lets your program take different actions depending on the condition.")+" "+_("In this example if the mouse button is pressed a snare drum will play, else a kick drum will play."),"documentation",null,"elifhelp"]),e.formBlock({name:_("if"),flows:{labels:[_("then"),_("else")]},args:1,argTypes:["booleanin"]}),e}return _createClass(n,[{key:"flow",value:function(e){if(3===e.length)return e[0]?[e[1],1]:[e[2],1]}}]),n}(),p=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"if")).setPalette("flow",v),e.beginnerBlock(!0),v.beginnerMode&&e.lang,e.setHelpString([_("Conditionals lets your program take different actions depending on the condition.")+" "+_("In this example if the mouse button is pressed a snare drum will play."),"documentation",null,"ifhelp"]),e.formBlock({name:_("if"),flows:{labels:[_("then")]},args:1,argTypes:["booleanin"]}),e}return _createClass(n,[{key:"flow",value:function(e){if(2===e.length&&e[0])return[e[1],1]}}]),n}(),f=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"forever")).setPalette("flow",v),e.beginnerBlock(!0),e.setHelpString([_("The Forever block will repeat the contained blocks forever.")+" "+_("In this example of a simple drum machine a kick drum will play 1/4 notes forever."),"documentation",null,"foreverhelp"]),e.formBlock({name:_("forever")}),e}return _createClass(n,[{key:"flow",value:function(e,t,n){if(1===e.length)return[e[0],v.turtles.ithTurtle(n).singer.suppressOutput?20:-1]}}]),n}(),h=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"repeat")).setPalette("flow",v),e.beginnerBlock(!0),e.setHelpString([_("The Repeat block will repeat the contained blocks.")+" "+_("In this example the note will be played 4 times."),"documentation",null,"repeathelp"]),e.formBlock({name:_("repeat"),args:1,argLabels:[""],defaults:[4]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,o){var l;if(void 0!==e[1])return null===e[0]||"number"!=typeof e[0]||e[0]<1?(e[0]<0&&v.errorMsg(POSNUMBER,o),[null,0]):(l=e[0],[e[1],Math.floor(l)])}}]),n}(),k=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"duplicatefactor",_("duplicate factor"))).setPalette("flow",v),e.setHelpString(),e.hidden=!0,e}return _createClass(n,[{key:"arg",value:function(e,t,n){e.inStatusMatrix&&"print"===v.blocks.blockList[v.blocks.blockList[n].connections[0]].name?e.statusFields.push([n,"duplicate"]):v.blocks.blockList[n].value=v.turtles.ithTurtle(t).singer.duplicateFactor}}]),n}(),w=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"hiddennoflow")).setPalette("flow",v),e.setHelpString(),e.dockTypes[e.dockTypes.length-1]="unavailable",e.size=0,e.hidden=!0,e}return _createClass(n,[{key:"flow",value:function(){}}]),n}(),d=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"hidden")).setPalette("flow",v),e.setHelpString(),e.size=0,e.hidden=!0,e}return _createClass(n,[{key:"flow",value:function(){}}]),n}();(new e).setup(v),(new t).setup(v),(new n).setup(v),(new o).setup(v),(new l).setup(v),(new r).setup(v),(new i).setup(v),(new s).setup(v),(new a).setup(v),(new c).setup(v),(new u).setup(v),(new p).setup(v),(new f).setup(v),(new h).setup(v),(new k).setup(v),(new w).setup(v),(new d).setup(v)}