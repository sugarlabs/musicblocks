"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,l,u,a=[],s=!0,i=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=l.call(r)).done)&&(a.push(n.value),a.length!==t);s=!0);}catch(e){i=!0,o=e}finally{try{if(!s&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(i)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var n=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,n?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function setupSensorsBlocks(i){var e=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"input")).setPalette("sensors",i),e.parameter=!0,e.setHelpString([_("The Input block prompts for keyboard input."),"documentation",""]),e.formBlock({name:_("input"),args:1,argTypes:["anyin"],defaults:[_("Input a value")]}),e}return _createClass(r,[{key:"flow",value:function(e,n,o,t){i.turtles.ithTurtle(o).doWait(120),docById("labelDiv").innerHTML='<input id="textLabel" style="position: absolute; -webkit-user-select: text;-moz-user-select: text;-ms-user-select: text;" class="input" type="text" value="" />';var r=docById("textLabel"),l=i.blocks.blockList[t].connections[1];null!==l&&(r.placeholder=i.blocks.blockList[l].value),r.style.left=i.turtles.getTurtle(o).container.x+"px",r.style.top=i.turtles.getTurtle(o).container.y+"px",r.focus(),docById("labelDiv").classList.add("hasKeyboard"),docById("textLabel").addEventListener("keypress",function(e){var t,r;13===e.keyCode&&(r=(t=docById("textLabel")).value,isNaN(r)?n.inputValues[o]=r:n.inputValues[o]=Number(r),t.blur(),t.style.display="none",n.clearTurtleRun(o),docById("labelDiv").classList.remove("hasKeyboard"))})}}]),r}(),t=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"inputvalue",_("input value"))).setPalette("sensors",i),e.parameter=!0,e.setHelpString([_("The Input-value block stores the input."),"documentation",null,"input"]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t){return t in e.inputValues?e.inputValues[t]:0}},{key:"arg",value:function(e,t,r){return t in e.inputValues?e.inputValues[t]:(i.errorMsg(NOINPUTERRORMSG,r),0)}}]),r}(),r=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"pitchness",_("pitch"))).setPalette("sensors",i),e.parameter=!0,e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return toFixed2(i.blocks.blockList[r].value)}},{key:"arg",value:function(e){if(null===e.mic)return 440;null===e.pitchAnalyser&&(e.pitchAnalyser=new Tone.Analyser({type:"fft",size:e.limit,smoothing:0}),e.mic.connect(e.pitchAnalyser));for(var t=e.pitchAnalyser.getValue(),r=1/0,n=0,o=0;o<e.limit;o++){var l=-t[o];l<r&&(r=l,n=o)}return n/(e.pitchAnalyser.sampleTime*e.limit*2)}}]),r}(),n=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"loudness",_("loudness"))).setPalette("sensors",i),e.parameter=!0,e.beginnerBlock(!("ja"===e.lang)),e.setHelpString([_("The Loudness block returns the volume detected by the microphone."),"documentation",""]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return toFixed2(i.blocks.blockList[r].value)}},{key:"arg",value:function(e){if(null===e.mic)return 0;null===e.volumeAnalyser&&(e.volumeAnalyser=new Tone.Analyser({type:"waveform",size:e.limit}),e.mic.connect(e.volumeAnalyser));for(var t=e.volumeAnalyser.getValue(),r=0,n=0;n<e.limit;n++)r+=t[n]*t[n];var o=Math.sqrt(r/e.limit);return Math.round(100*o)}}]),r}(),o=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"myclick",_("click"))).setPalette("sensors",i),e.beginnerBlock(!0),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Click block triggers an event if a mouse has been clicked."),"documentation",null,"clickhelp"]):e.setHelpString([_("The Click block triggers an event if a turtle has been clicked."),"documentation",null,"clickhelp"]),e}return _createClass(r,[{key:"arg",value:function(e,t){return"click"+i.turtles.getTurtle(t).id}}]),r}(),l=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"mycursorover",_("cursor over"))).setPalette("sensors",i),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Cursor over block triggers an event when the cursor is moved over a mouse."),"documentation",null,"cursoroverhelp"]):e.setHelpString([_("The Cursor over block triggers an event when the cursor is moved over a turtle."),"documentation",null,"cursoroverhelp"]),e}return _createClass(r,[{key:"arg",value:function(e,t){return"CursorOver"+i.turtles.getTurtle(t).id}}]),r}(),u=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"mycursorout",_("cursor out"))).setPalette("sensors",i),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Cursor out block triggers an event when the cursor is moved off of a mouse."),"documentation",null,"cursorouthelp"]):e.setHelpString([_("The Cursor out block triggers an event when the cursor is moved off of a turtle."),"documentation",null,"cursorouthelp"]),e}return _createClass(r,[{key:"arg",value:function(e,t){return"CursorOut"+i.turtles.getTurtle(t).id}}]),r}(),a=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"mycursordown",_("cursor button down"))).setPalette("sensors",i),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Cursor button down block triggers an event when the cursor button is pressed on a mouse."),"documentation",null,"cursordownhelp"]):e.setHelpString([_("The Cursor button down block triggers an event when the cursor button is pressed on a turtle."),"documentation",null,"cursordownhelp"]),e}return _createClass(r,[{key:"arg",value:function(e,t){return"CursorDown"+i.turtles.getTurtle(t).id}}]),r}(),s=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"mycursorup",_("cursor button up"))).setPalette("sensors",i),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Cursor button up block triggers an event when the cursor button is released while over a mouse."),"documentation",null,"cursoruphelp"]):e.setHelpString([_("The Cursor button up block triggers an event when the cursor button is released while over a turtle."),"documentation",null,"cursoruphelp"]),e}return _createClass(r,[{key:"arg",value:function(e,t){return"CursorUp"+i.turtles.getTurtle(t).id}}]),r}(),c=function(){_inherits(a,ValueBlock);var u=_createSuper(a);function a(e,t,r,n,o){var l;return _classCallCheck(this,a),(l=u.call(this,e,t)).colorIndex=r,l.setPalette("sensors",i),l.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?l.setHelpString([n,"documentation",""]):l.setHelpString([o,"documentation",""]),l}return _createClass(a,[{key:"updateParameter",value:function(e,t,r){return toFixed2(i.blocks.blockList[r].value)}},{key:"arg",value:function(e,t){var r=i.turtles.getTurtle(t).painter.canvasColor;r.includes("#")&&(r=hex2rgb(r.split("#")[1]));var n=r.split("(")[1].split(","),o=Number(n[this.colorIndex]);return parseInt(o/2.55)}}]),a}(),p=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"getcolorpixel",_("pixel color"))).setPalette("sensors",i),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Get pixel block returns the color of the pixel under the mouse."),"documentation",""]):e.setHelpString([_("The Get pixel block returns the color of the pixel under the turtle."),"documentation",""]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return toFixed2(i.blocks.blockList[r].value)}},{key:"arg",value:function(e,t){var r;try{r=i.turtles.getTurtle(t)}catch(e){return this.getFallbackColor()}if(!r.container)return this.getFallbackColor();var n=r.container,o=n.x,l=n.y,u=r.container.visible;try{r.container.visible=!1,i.refreshCanvas();var a=this.getPixelData(o,l),s=this.detectColor(a);return r.container.visible=u,s}catch(e){return r.container.visible=u,this.getFallbackColor()}}},{key:"getPixelData",value:function(e,t){var r=docById("overlayCanvas"),n=null==r?void 0:r.getContext("2d");if(!n)throw new Error("Canvas context unavailable");return n.getImageData(Math.floor(e),Math.floor(t),1,1).data}},{key:"detectColor",value:function(e){if(4!==e.length)throw new Error("Invalid pixel data");var t=_slicedToArray(e,4),r=t[0],n=t[1],o=t[2];return 0===t[3]?this.getBackgroundColor():searchColors(r,n,o)}},{key:"getBackgroundColor",value:function(){var e=_slicedToArray(platformColor.background.match(/\(([^)]+)\)/)[1].split(/,\s*/).map(Number),3),t=e[0],r=e[1],n=e[2];return searchColors(t,r,n)}},{key:"getFallbackColor",value:function(){return searchColors(128,128,128)}}]),r}(),h=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"time",_("time"))).setPalette("sensors",i),e.parameter=!0,e.beginnerBlock(!("ja"===e.lang)),e.setHelpString([_("The Time block returns the number of seconds that the program has been running."),"documentation",""]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return i.blocks.blockList[r].value}},{key:"arg",value:function(e){return((new Date).getTime()-e.time)/1e3}}]),r}(),f=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"mousey",_("cursor y"))).setPalette("sensors",i),e.beginnerBlock(!0),e.parameter=!0,e.setHelpString([_("The Cursor Y block returns the vertical position of the mouse."),"documentation",null,"mousebuttonhelp"]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return i.blocks.blockList[r].value}},{key:"arg",value:function(){return i.getStageY()}}]),r}(),b=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"mousex",_("cursor x"))).setPalette("sensors",i),e.beginnerBlock(!0),e.parameter=!0,e.setHelpString([_("The Cursor X block returns the horizontal position of the mouse."),"documentation",null,"mousebuttonhelp"]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return i.blocks.blockList[r].value}},{key:"arg",value:function(){return i.getStageX()}}]),r}(),v=function(){_inherits(r,BooleanSensorBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"mousebutton",_("mouse button"))).setHelpString([_("The Mouse-button block returns True if the mouse button is pressed."),"documentation",null,"mousebuttonhelp"]),e.setPalette("sensors",i),e.beginnerBlock(!0),e.parameter=!0,e.extraWidth=20,e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return i.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(){return i.getStageMouseDown()}}]),r}(),y=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"toascii",_("to ASCII"))).setPalette("sensors",i),e.parameter=!0,e.setHelpString([_("The To ASCII block converts numbers to letters."),"documentation",""]),e.formBlock({args:1,defaults:[65]}),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return i.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r,n){if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[r].connections[0]].name){var o=i.blocks.blockList[r].connections[1];if(null===o)return i.errorMsg(NOINPUTERRORMSG,r),"A";var l=e.parseArg(e,t,o,r,n);return"number"==typeof l?l<1?0:String.fromCharCode(l):(i.errorMsg(NANERRORMSG,r),0)}e.statusFields.push([r,"toascii"])}}]),r}(),d=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"keyboard",_("keyboard"))).setPalette("sensors",i),e.parameter=!0,e.setHelpString([_("The Keyboard block returns computer keyboard input."),"documentation",""]),e.makeMacro(function(e,t){return[[0,"toascii",e,t,[null,1]],[1,"keyboard",0,0,[0,null]]]}),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return i.blocks.blockList[r].value}},{key:"arg",value:function(e){e.lastKeyCode=i.getCurrentKeyCode();var t=e.lastKeyCode;return i.clearCurrentKeyCode(),t}}]),r}();[{name:"getred",label:_("red"),index:0,helpMouse:_("The Get red block returns the red component of the pixel under the mouse."),helpTurtle:_("The Get red block returns the red component of the pixel under the turtle.")},{name:"getgreen",label:_("green"),index:1,helpMouse:_("The Get green block returns the green component of the pixel under the mouse."),helpTurtle:_("The Get green block returns the green component of the pixel under the turtle.")},{name:"getblue",label:_("blue"),index:2,helpMouse:_("The Get blue block returns the blue component of the pixel under the mouse."),helpTurtle:_("The Get blue block returns the blue component of the pixel under the turtle.")}].forEach(function(e){new c(e.name,e.label,e.index,e.helpMouse,e.helpTurtle).setup(i)}),(new p).setup(i),(new y).setup(i),(new d).setup(i),(new t).setup(i),(new e).setup(i),(new h).setup(i),(new r).setup(i),(new n).setup(i),(new u).setup(i),(new l).setup(i),(new s).setup(i),(new a).setup(i),(new o).setup(i),(new v).setup(i),(new f).setup(i),(new b).setup(i)}"undefined"!=typeof module&&module.exports&&(module.exports={setupSensorsBlocks:setupSensorsBlocks});