"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var n=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,n?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function setupMeterBlocks(l){var e=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"currentmeter",_("current meter"))).setPalette("meter",l),e.parameter=!0,e.setHelpString(),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return l.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==l.blocks.blockList[l.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getCurrentMeter(t);e.statusFields.push([r,"currentmeter"])}}]),r}(),t=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"beatfactor",_("beat factor"))).setPalette("meter",l),e.parameter=!0,e.setHelpString([_("The Beat factor block returns the ratio of the note value to the meter note value."),"documentation",""]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return l.blocks.blockList[r].value}},{key:"setter",value:function(e,t,r){l.turtles.ithTurtle(r).singer.beatFactor=t}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==l.blocks.blockList[l.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getBeatFactor(t);e.statusFields.push([r,"beatfactor"])}}]),r}(),r=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"bpmfactor")).setPalette("meter",l),e.parameter=!0,e.setHelpString([_("The Beats per minute block returns the current beats per minute."),"documentation",""]),e.formBlock({name:"ja"===e.lang?_("beats per minute2"):_("beats per minute")}),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return l.blocks.blockList[r].value}},{key:"setter",value:function(e,t,r){var n=l.turtles.ithTurtle(r),o=n.singer.bpm.length;0<o?n.singer.bpm[o-1]=t:n.singer.bpm.push(t)}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==l.blocks.blockList[l.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getBPM(t);e.statusFields.push([r,"bpm"])}}]),r}(),n=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"measurevalue",_("measure count"))).setPalette("meter",l),e.parameter=!0,e.setHelpString([_("The Measure count block returns the current measure."),"documentation",""]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return l.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==l.blocks.blockList[l.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getMeasureCount(t);e.statusFields.push([r,"measurevalue"])}}]),r}(),o=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"beatvalue",_("beat count"))).setPalette("meter",l),e.beginnerBlock(!0),e.parameter=!0,l.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Beat count block is the number of the current beat,")+" "+_("In the figure, it is used to take an action on the first beat of each measure."),"documentation",null,"everybeathelp"]):e.setHelpString([_("The Beat count block is the number of the current beat,")+" "+_("eg 1, 2, 3, or 4.")+" "+_("In the figure, it is used to take an action on the first beat of each measure."),"documentation",null,"beatvaluehelp"]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return l.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==l.blocks.blockList[l.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getBeatCount(t);e.statusFields.push([r,"beatvalue"])}}]),r}(),a=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"notecounter",_("sum note values"))).setPalette("meter",l),e.parameter=!0,e.setHelpString([_("The Note counter block can be used to count the number of contained notes."),"documentation",null,"notecounterhelp"]),e.formBlock({flows:{labels:[""],type:"flow"}}),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return l.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){var n=l.blocks.blockList[r].connections[1];return null===n?(l.errorMsg(NOINPUTERRORMSG,r),0):Singer.noteCounter(e,t,n)}}]),r}(),s=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"notecounter2",_("note counter"))).setPalette("meter",l),e.parameter=!0,e.setHelpString([_("The Note counter block can be used to count the number of contained notes."),"documentation",null,"notecounterhelp"]),e.formBlock({flows:{labels:[""],type:"flow"}}),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return l.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){var n=l.blocks.blockList[r].connections[1];return null===n?(l.errorMsg(NOINPUTERRORMSG,r),0):Singer.numberOfNotes(e,t,n)}}]),r}(),u=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"elapsednotes",_("whole notes played"))).setPalette("meter",l),e.parameter=!0,e.beginnerBlock(!0),e.setHelpString([_("The Whole notes played block returns the total number of whole notes played."),"documentation",null,"elapsedhelp"]),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return l.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==l.blocks.blockList[l.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getWholeNotesPlayed(t);e.statusFields.push([r,"elapsednotes"])}}]),r}(),i=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"elapsednotes2",_("notes played"))).setPalette("meter",l),e.beginnerBlock(!0),e.parameter=!0,l.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Beat count block is the number of the current beat,")+" "+_("In the figure, it is used to take an action on the first beat of each measure."),"documentation",null,"everybeathelp"]):e.setHelpString([_("The Beat count block is the number of the current beat,")+" "+_("eg 1, 2, 3, or 4.")+" "+_("In the figure, it is used to take an action on the first beat of each measure."),"documentation",null,"beatvaluehelp"]),e.formBlock({args:1}),e.makeMacro(function(e,t){return[[0,"elapsednotes2",e,t,[null,1]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]]]}),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return l.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r,n){if(!e.inStatusMatrix||"print"!==l.blocks.blockList[l.blocks.blockList[r].connections[0]].name){var o=l.blocks.blockList[r].connections[1],a=e.parseArg(e,t,o,r,n);return Singer.MeterActions.getNotesPlayed(a,t)}e.statusFields.push([r,"elapsednotes2"])}}]),r}(),c=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"drift")).setPalette("meter",l),e.setHelpString([_("The No clock block decouples the notes from the master clock."),"documentation",""]),e.formBlock({name:_("no clock")}),e.makeMacro(function(e,t){return[[0,"drift",e,t,[null,null,1]],[1,"hidden",0,0,[0,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){if(void 0!==e[0])return Singer.MeterActions.setNoClock(r,n),[e[0],1]}}]),r}(),p=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"offbeatdo",_("on weak beat do"))).setPalette("meter",l),e.setHelpString([_("The On-weak-beat block lets you specify actions to take on weak (off) beats."),"documentation",null,"everybeathelp"]),e.formBlock({args:1,argTypes:["textin"],defaults:[_("action")]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n,o,a,s){e[0]in t.actions?Singer.MeterActions.onWeakBeatDo(e[0],s,o,r,n):l.errorMsg(NOACTIONERRORMSG,n,e[1])}}]),r}(),f=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"onbeatdo",_("on strong beat"))).setPalette("meter",l),e.piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],e.setHelpString([_("The On-strong-beat block lets you specify actions to take on specified beats."),"documentation",null,"everybeathelp"]),e.formBlock({args:2,argTypes:["numberin","textin"],defaults:[1,_("action")],argLabels:[_("beat"),"ja"===e.lang?_("do1"):_("do")]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n,o,a,s){2===e.length&&(e[1]in t.actions?Singer.MeterActions.onStrongBeatDo(e[0],e[1],s,o,r,n):l.errorMsg(NOACTIONERRORMSG,n,e[1]))}}]),r}(),b=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"everybeatdonew",_("on every beat do"))).setPalette("meter",l),e.beginnerBlock(!0),e.setHelpString([_("The On-every-beat block lets you specify actions to take on every beat."),"documentation",null,"everybeathelp"]),e.formBlock({args:1,argTypes:["textin"],defaults:[_("action")]}),e.makeMacro(function(e,t){return[[0,["everybeatdonew",{}],e,t,[null,1,null]],[1,["text",{value:"action"}],0,0,[0]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n,o,a,s){e[0]in t.actions?Singer.MeterActions.onEveryBeatDo(e[0],s,o,r,n):l.errorMsg(NOACTIONERRORMSG,n,e[1])}}]),r}(),m=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"everybeatdo",_("on every note do"))).setPalette("meter",l),e.beginnerBlock(!0),e.setHelpString([_("The On-every-note block lets you specify actions to take on every note."),"documentation",null,"everybeathelp"]),e.formBlock({args:1,argTypes:["textin"],defaults:[_("action")]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n,o,a,s){e[0]in t.actions?Singer.MeterActions.onEveryNoteDo(e[0],s,o,r,n):l.errorMsg(NOACTIONERRORMSG,n,e[1])}}]),r}(),k=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"setmasterbpm2",_("master beats per minute"))).setPalette("meter",l),e.piemenuValuesC1=[42,46,50,54,58,63,69,76,84,90,96,104,112,120,132,144,160,176,192,208],e.beginnerBlock(!0),e.setHelpString([_("The Master beats per minute block sets the number of 1/4 notes per minute for every voice."),"documentation",null,"setmasterbpm2"]),e.formBlock({args:2,defaults:[90,.25],argLabels:[_("bpm"),_("beat value")]}),e.makeMacro(function(e,t){return[[0,"setmasterbpm2",e,t,[null,1,2,5]],[1,["number",{value:90}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var o;2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&(Singer.MeterActions.setMasterBPM(e[0],e[1],n),t.notation.notationTempo(r,e[0],e[1])),t.inTempo&&(t.tempo.BPMBlocks.push(n),o=l.blocks.blockList[n].connections[1],t.tempo.BPMs.push(l.blocks.blockList[o].text.text))}}]),r}(),h=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"setmasterbpm",_("master beats per minute"))).setPalette("meter",l),e.formBlock({args:1,defaults:[90]}),e.hidden=!0,e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var o;1===e.length&&"number"==typeof e[0]&&(e[0]<30?(l.errorMsg(_("Beats per minute must be > 30."),n),Singer.masterBPM=30):1e3<e[0]?(l.errorMsg(_("Maximum beats per minute is 1000."),n),Singer.masterBPM=1e3):Singer.masterBPM=e[0],Singer.defaultBPMFactor=TONEBPM/Singer.masterBPM),t.inTempo&&(t.tempo.BPMBlocks.push(n),o=l.blocks.blockList[n].connections[1],t.tempo.BPMs.push(l.blocks.blockList[o].text.text))}}]),r}(),v=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"setbpm3",_("beats per minute"))).setPalette("meter",l),e.piemenuValuesC1=[42,46,50,54,58,63,69,76,84,90,96,104,112,120,132,144,160,176,192,208],e.beginnerBlock(!0),e.setHelpString([_("The Beats per minute block sets the number of 1/4 notes per minute."),"documentation",null,"bpmhelp"]),e.formBlock({args:2,defaults:[90,.25],argLabels:[_("bpm"),_("beat value")]}),e.makeMacro(function(e,t){return[[0,"setbpm3",e,t,[null,1,2,5]],[1,["number",{value:90}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var o;2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&(Singer.MeterActions.setBPM(e[0],e[1],r,n),t.notation.notationTempo(r,e[0],e[1])),t.inTempo&&(t.tempo.BPMBlocks.push(n),o=l.blocks.blockList[n].connections[1],t.tempo.BPMs.push(l.blocks.blockList[o].text.text))}}]),r}(),g=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"setbpm2")).setPalette("meter",l),e.formBlock({name:_("beats per minute"),args:2,argLabels:[_("bpm"),_("beat value")],defaults:[90,.25]}),e.makeMacro(function(e,t){return[[0,"setbpm2",e,t,[null,1,3,2,6]],[1,["number",{value:90}],0,0,[0]],[2,"vspace",0,0,[0,null]],[3,"divide",0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"hidden",0,0,[0,null]]]}),e.hidden=!0,e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var o=l.turtles.ithTurtle(r);if(3===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]){var a=e[0]*e[1]/.25;e[0]<30?(l.errorMsg(_("Beats per minute must be > 30.")),a=30):1e3<e[0]&&(l.errorMsg(_("Maximum beats per minute is 1000.")),a=1e3),t.notation.notationTempo(r,e[0],e[1]),o.singer.bpm.push(a);var s="_bpm_"+r;t.setDispatchBlock(n,r,s);return t.setTurtleListener(r,s,function(){o.singer.bpm.pop()}),[e[2],1]}}}]),r}(),y=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"setbpm")).setPalette("meter",l),e.formBlock({name:_("beats per minute"),args:1,defaults:[90]}),e.makeMacro(function(e,t){return[[0,"setbpm",e,t,[null,1,null,2]],[1,["number",{value:90}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e.hidden=!0,e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var o=l.turtles.ithTurtle(r);if(2===e.length&&"number"==typeof e[0]){var a=e[0]<30?(l.errorMsg(_("Beats per minute must be > 30."),n),30):1e3<e[0]?(l.errorMsg(_("Maximum beats per minute is 1000."),n),1e3):e[0];o.singer.bpm.push(a);var s="_bpm_"+r;t.setDispatchBlock(n,r,s);return t.setTurtleListener(r,s,function(){o.singer.bpm.pop()}),[e[1],1]}}}]),r}(),d=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"pickup",_("pickup"))).setPalette("meter",l),e.setHelpString([_("The Pickup block is used to accommodate any notes that come in before the beat."),"documentation",null,"pickup"]),e.extraWidth=15,e.formBlock({args:1,defaults:[0]}),e.makeMacro(function(e,t){return[[0,"pickup",e,t,[null,1,4]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:0}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var o=e[0];1!==e.length||"number"!=typeof e[0]||o<0?l.errorMsg(NOINPUTERRORMSG,n):Singer.MeterActions.setPickup(o,r,l)}}]),r}(),S=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"meter",_("meter"))).setPalette("meter",l),e.piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],e.beginnerBlock(!0),e.setHelpString([_("The beat of the music is determined by the Meter block (by default, 4 1/4 notes per measure)."),"documentation",null,"meter"]),e.extraWidth=15,e.formBlock({args:2,defaults:[4,.25],argLabels:[_("number of beats"),_("note value")]}),e.makeMacro(function(e,t){return[[0,"meter",e,t,[null,1,2,5]],[1,["number",{value:4}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var o=null===e[0]||"number"!=typeof e[0]?4:e[0],a=null===e[1]||"number"!=typeof e[1]?.25:e[1];null!==e[0]&&"number"==typeof e[0]&&null!==e[1]&&"number"==typeof e[1]||l.errorMsg(NOINPUTERRORMSG,n),t.insideMeterWidget&&(t._meterBlock=n),t.inMusicKeyboard&&(t.musicKeyboard.meterArgs=e),Singer.MeterActions.setMeter(o,a,r)}}]),r}();(new e).setup(l),(new t).setup(l),(new r).setup(l),(new n).setup(l),(new o).setup(l),(new a).setup(l),(new s).setup(l),(new u).setup(l),(new i).setup(l),(new c).setup(l),(new p).setup(l),(new f).setup(l),(new b).setup(l),(new m).setup(l),(new k).setup(l),(new h).setup(l),(new v).setup(l),(new g).setup(l),(new y).setup(l),(new d).setup(l),(new S).setup(l)}