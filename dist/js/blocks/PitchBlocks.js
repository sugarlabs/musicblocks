"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,a,i,s=[],o=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);o=!0);}catch(e){c=!0,l=e}finally{try{if(!o&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw l}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var r=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,r?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function setupPitchBlocks(S){var e=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"rest")).setPalette("pitch",S),e.hidden=e.deprecated=!0,e}return n}(),t=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"square",_("square"))).setPalette("pitch",S),e.formBlock({args:1,defaults:[440]}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"square",0,0,[4,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){Singer.playSynthBlock(e,S,t,n,r)}}]),n}(),n=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"triangle",_("triangle"))).setPalette("pitch",S),e.formBlock({args:1,defaults:[440]}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"triangle",0,0,[4,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){Singer.playSynthBlock(e,S,t,n,r)}}]),n}(),r=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"sine",_("sine"))).setPalette("pitch",S),e.formBlock({args:1,defaults:[440]}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"sine",0,0,[4,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){Singer.playSynthBlock(e,S,t,n,r)}}]),n}(),l=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"sawtooth",_("sawtooth"))).setPalette("pitch",S),e.formBlock({args:1,defaults:[440]}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"sawtooth",0,0,[4,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){Singer.playSynthBlock(e,t,n,r)}}]),n}(),a=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"invertmode")).setPalette("pitch",S),e.formBlock({outType:"textout"}),e.hidden=!0,e}return n}(),i=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"transpositionfactor",_("transposition"))).setPalette("pitch",S),e.hidden=!0,e.parameter=!0,e}return _createClass(n,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==S.blocks.blockList[S.blocks.blockList[n].connections[0]].name)return S.turtles.ithTurtle(S.turtles.companionTurtle(t)).singer.transposition;e.statusFields.push([n,"transposition"])}}]),n}(),s=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"consonantstepsizedown",_("scalar step down"))).setPalette("pitch",S),e.parameter=!0,e.setHelpString([_("The Scalar step down block returns the number of semi-tones down to the previous note in the current key and mode."),"documentation",""]),e}return _createClass(n,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t){return Singer.PitchActions.consonantStepSize("down",t)}}]),n}(),o=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"consonantstepsizeup",_("scalar step up"))).setPalette("pitch",S),e.parameter=!0,e.setHelpString([_("The Scalar step up block returns the number of semi-tones up to the next note in the current key and mode."),"documentation",""]),e}return _createClass(n,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t){return Singer.PitchActions.consonantStepSize("up",t)}}]),n}(),c=function(){_inherits(l,ValueBlock);var r=_createSuper(l);function l(e,t){var n;return _classCallCheck(this,l),(n=r.call(this,e||"deltapitch",t||_("change in pitch"))).setPalette("pitch",S),n.parameter=!0,n.setHelpString([_("The Change in pitch block is the difference (in half steps) between the current pitch being played and the previous pitch played."),"documentation",null,"deltapitchhelp"]),n}return _createClass(l,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){return e.inStatusMatrix&&"print"===S.blocks.blockList[S.blocks.blockList[n].connections[0]].name&&e.statusFields.push([n,"mypitch"]),Singer.PitchActions.deltaPitch(S.blocks.blockList[n].name,t)}}]),l}(),u=function(){_inherits(t,c);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"deltapitch2",_("scalar change in pitch"))}return t}(),h=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"mypitch",_("pitch number"))).setPalette("pitch",S),e.beginnerBlock(!0),e.parameter=!0,e.hidden=!0,e.setHelpString([_("The Pitch number block is the value of the pitch of the note currently being played."),"documentation",null,"everybeathelp"]),e}return _createClass(n,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"setter",value:function(e,t,n){var r=S.turtles.ithTurtle(S.turtles.companionTurtle(n));r.singer.previousNotePlayed=r.singer.lastNotePlayed;var l=numberToPitch(Math.floor(t)+r.singer.pitchNumberOffset);r.singer.lastNotePlayed=[l[0]+l[1],r.singer.lastNotePlayed[1]]}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==S.blocks.blockList[S.blocks.blockList[n].connections[0]].name){var r,l,a=S.turtles.ithTurtle(S.turtles.companionTurtle(t));return l=null!==a.singer.lastNotePlayed?"string"==typeof a.singer.lastNotePlayed[0]?(r=a.singer.lastNotePlayed[0].length,[a.singer.lastNotePlayed[0].slice(0,r-1),parseInt(a.singer.lastNotePlayed[0].slice(r-1))]):frequencyToPitch(a.singer.lastNotePlayed[0]):a.singer.inNoteBlock in a.singer.notePitches&&0<a.singer.notePitches[last(a.singer.inNoteBlock)].length?getNote(a.singer.notePitches[last(a.singer.inNoteBlock)][0],a.singer.noteOctaves[last(a.singer.inNoteBlock)][0],0,a.singer.keySignature,a.singer.movable,null,S.errorMsg):(null!==a.singer.lastNotePlayed&&S.errorMsg(INVALIDPITCH,n),["G",4]),pitchToNumber(l[0],l[1],a.singer.keySignature)-a.singer.pitchNumberOffset}e.statusFields.push([n,"mypitch"])}}]),n}(),p=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"pitchinhertz",_("pitch in hertz"))).setPalette("pitch",S),e.parameter=!0,e.hidden=!0,e.setHelpString([_("The Pitch in Hertz block is the value in Hertz of the pitch of the note currently being played."),"documentation",""]),e.beginnerBlock(!0),e}return _createClass(n,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(e.inStatusMatrix&&"print"===S.blocks.blockList[S.blocks.blockList[n].connections[0]].name)e.statusFields.push([n,"pitchinhertz"]);else{var r=S.turtles.ithTurtle(S.turtles.companionTurtle(t));if(null!==r.singer.lastNotePlayed)return e.synth._getFrequency(r.singer.lastNotePlayed[0],e.synth.changeInTemperament)}}}]),n}(),f=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"currentpitch",_("current pitch"))).setPalette("pitch",S),e.beginnerBlock(!0),e.parameter=!0,e.formBlock({outType:"pitchout"}),e.setHelpString([_("The Current Pitch block is used with the Pitch Converter block. In the example above, current pitch, sol 4, is displayed as 392 hertz."),"documentation",null,"currentpitchhelp"]),e}return _createClass(n,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){var r=S.turtles.ithTurtle(S.turtles.companionTurtle(t));return(e.inStatusMatrix&&"outputtools"===S.blocks.blockList[S.blocks.blockList[n].connections[0]].name||null===r.singer.lastNotePlayed)&&null===r.singer.lastNotePlayed?"G4":r.singer.lastNotePlayed[0]}}]),n}(),v=function(){_inherits(n,LeftBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"outputtools",_("pitch converter"))).setPalette("pitch",S),e.beginnerBlock(!0),e.extraWidth=50,e.setHelpString([_("This block converts the pitch value of the last note played into different formats such as hertz, letter name, pitch number, et al."),"documentation",null,"outputtoolshelp"]),e.extraSearchTerms=["pitch number","pitch in hertz","alphabet","letter class","solfege class","staff y","solfege syllable","pitch class","scalar class","scale degree","nth degree","pitch to shade","pitch to color"],e.piemenuLabels=[_("pitch number"),_("pitch in hertz"),_("alphabet"),_("letter class"),_("solfege class"),_("staff y"),_("solfege syllable"),_("pitch class"),_("scalar class"),_("scale degree"),_("nth degree"),_("pitch to shade"),_("pitch to color")],e.formBlock({args:1,argTypes:["anyin"]}),e.parameter=!1,e.makeMacro(function(e,t){return[[0,["outputtools",{value:"letter class"}],e,t,[null,1,null]],[1,["currentpitch"],0,0,[0]]]}),e}return _createClass(n,[{key:"arg",value:function(e,t,n,r){if(!e.inStatusMatrix||"print"!==S.blocks.blockList[S.blocks.blockList[n].connections[0]].name){var l,a,i,s,o,c,u,h,p,f,v,d,m=S.blocks.blockList[n].connections[1],k=S.turtles.ithTurtle(S.turtles.companionTurtle(t));return null!=m&&(l=e.parseArg(e,t,m,n,r)),"notename"===S.blocks.blockList[m].name?o=l+(k.singer.currentOctave?k.singer.currentOctave:4):"solfege"===S.blocks.blockList[m].name||"eastindiansolfege"===S.blocks.blockList[m].name?((i=-1!=(a=l).indexOf(SHARP)?SHARP:-1!=a.indexOf(FLAT)?FLAT:-1!=a.indexOf(DOUBLEFLAT)?DOUBLEFLAT:-1!=a.indexOf(DOUBLESHARP)?DOUBLESHARP:NATURAL)!=NATURAL&&(a=a.replace(i,"")),o=FIXEDSOLFEGE[a],i!=NATURAL&&(o+=i),o+=k.singer.currentOctave?k.singer.currentOctave:4):"number"===S.blocks.blockList[m].name?o=S.blocks.blockList[m].value<55?(s=numberToPitch(S.blocks.blockList[m].value+k.singer.pitchNumberOffset))[0]+s[1]:l:"scaledegree2"===S.blocks.blockList[m].name?(o=scaleDegreeToPitchMapping(k.singer.keySignature,S.blocks.blockList[m].value,k.singer.movable,null),o+=k.singer.currentOctave?k.singer.currentOctave:4):"string"==typeof l?(c=Number(l),isNaN(c)?(u=l.charAt(l.length-1),h="","12345678".includes(u)&&(h=u,l=l.slice(0,l.length-1)),SOLFEGENAMES1.includes(l)?((f=(p=l).includes(SHARP)?SHARP:p.includes(FLAT)?FLAT:p.includes(DOUBLEFLAT)?DOUBLEFLAT:p.includes(DOUBLESHARP)?DOUBLESHARP:NATURAL)!=NATURAL&&(p=p.replace(f,"")),o=FIXEDSOLFEGE[p],f!=NATURAL&&(o+=f),0===h.length?o+=k.singer.currentOctave?k.singer.currentOctave:4:o+=h):o=NOTENAMES1.includes(l)||ALLNOTENAMES.includes(l)?0===h.length?l+(k.singer.currentOctave?k.singer.currentOctave:4):l+h:l):o=c<55?(v=numberToPitch(c+k.singer.pitchNumberOffset))[0]+v[1]:c):o="number"==typeof l&&S.blocks.blockList[m].value<55?(d=numberToPitch(S.blocks.blockList[m].value+k.singer.pitchNumberOffset))[0]+d[1]:l,getPitchInfo(S,S.blocks.blockList[n].privateData,o,k)}e.statusFields.push([n,"outputtools"])}}]),n}(),d=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"oneOfPitchBlock",_("one of"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"oneOf",e,t,[null,1,2,null]],[1,["solfege",{value:"do"}],0,0,[0]],[2,["solfege",{value:"sol"}],0,0,[0]]]}),e}return n}(),m=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"midi",_("MIDI"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"setpitchnumberoffset",e,t,[null,1,2,null]],[1,["notename",{value:"C"}],0,0,[0]],[2,["number",{value:-1}],0,0,[0]]]}),e}return n}(),k=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"setpitchnumberoffset",_("set pitch number offset"))).setPalette("pitch",S),e.setHelpString([_("The Set pitch number offset block is used to set the offset for mapping pitch numbers to pitch and octave."),"documentation",null,"pitchnumberhelp"]),e.formBlock({args:2,defaults:["C",4],argTypes:["anyin","anyin"],argLabels:["ja"===e.lang?_("name2"):_("name"),_("octave")]}),e.makeMacro(function(e,t){return[[0,"setpitchnumberoffset",e,t,[null,1,2,null]],[1,["notename",{value:"C"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){null!==e[0]&&null!==e[1]||S.errorMsg(NOINPUTERRORMSG,r);var l=null===e[0]?"C":e[0],a=null===e[1]?4:e[1];Singer.PitchActions.setPitchNumberOffset(l,a,n,S)}}]),n}(),b=function(){_inherits(l,LeftBlock);var r=_createSuper(l);function l(e,t){var n;return _classCallCheck(this,l),(n=r.call(this,e||"number2pitch",t||_("number to pitch"))).setPalette("pitch",S),n.setHelpString([_("The Number to pitch block will convert a pitch number to a pich name."),"documentation",""]),n.formBlock({args:1,defaults:[55]}),n}return _createClass(l,[{key:"arg",value:function(t,e,n,r){var l=S.blocks.blockList[n].connections[1],a=t.parseArg(t,e,l,n,r);try{var i="number2pitch"===S.blocks.blockList[n].name?"pitch":"octave";return Singer.PitchActions.numToPitch(a,i,e)}catch(e){"NoArgError"===e?(S.errorMsg(NOINPUTERRORMSG,n),t.stopTurtle=!0):console.error(e)}}}]),l}(),g=function(){_inherits(n,b);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"number2octave",_("number to octave"))).setHelpString([_("The Number to octave block will convert a pitch number to an octave."),"documentation",""]),e}return n}(),y=function(){_inherits(n,LeftBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"ytopitch",_("y to pitch"))).setPalette("pitch",S),e.setHelpString([_("Y to pitch block will convert a staff y position to corresponding pitch notation."),"documentation",""]),e.formBlock({args:1,defaults:[50]}),e}return _createClass(n,[{key:"arg",value:function(e,t,n,r){var l=S.blocks.blockList[n].connections[0],a=S.blocks.blockList[n].connections[1],i=S.turtles.ithTurtle(S.turtles.companionTurtle(t)),s=keySignatureToMode(i.singer.keySignature),o=MUSICALMODES[s[1]].length,c=buildScale(i.singer.keySignature)[0],u=0;null!==a&&(u=e.parseArg(e,t,a,n,r));var h=u+YSTAFFNOTEHEIGHT/2,p=Math.floor(h/YSTAFFOCTAVEHEIGHT);h%=YSTAFFOCTAVEHEIGHT;var f=p+4,v=Math.floor(h/YSTAFFNOTEHEIGHT);if(null===l){if(null===a)return"G4";for(;v<0;)v+=NOTENAMES.length;return NOTENAMES[v]+f}if("pitchnumber"==S.blocks.blockList[l].name){if(null===a)return 7;var d=v;(d-=NOTENAMES.indexOf(s[0][0]))<0&&(d+=o);var m=c[d];return-1===(d=NOTESSHARP.indexOf(m))&&(d=NOTESFLAT.indexOf(m)),d+12*p}if("nthmodalpitch"==S.blocks.blockList[l].name){if(null===a)return 5;var k=v-NOTENAMES.indexOf(s[0][0]);return k<0&&(k+=o),k+p*o}if("print"==S.blocks.blockList[l].name){if(e.inStatusMatrix&&e.statusFields.push([n,"ytopitch"]),null===a)return"G4";for(;v<0;)v+=NOTENAMES.length;return NOTENAMES[v]+f}if("pitch"==S.blocks.blockList[l].name){if(null===a)return["sol",4];var _=v-NOTENAMES.indexOf(s[0][0]);return _<0&&(_+=o),[c[_],f]}if(null===a)return"G4";for(;v<0;)v+=NOTENAMES.length;return NOTENAMES[v]+f}}]),n}(),P=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"accidentalname",_("accidental selector"))).setPalette("pitch",S),e.setHelpString([_("The Accidental selector block is used to choose between double-sharp, sharp, natural, flat, and double-flat."),"documentation",""]),e.formBlock({outType:"textout"}),e.extraWidth=50,e}return n}(),C=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"eastindiansolfege",_("east indian solfege"))).setPalette("pitch",S),e.setHelpString([_("Pitch can be specified in terms of ni dha pa ma ga re sa."),"documentation",null,"eihelp"]),e.formBlock({outType:"solfegeout"}),e}return n}(),T=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"notename",_("note name"))).setPalette("pitch",S),e.setHelpString([_("Pitch can be specified in terms of C D E F G A B."),"documentation",null,"note2"]),e.formBlock({outType:"noteout"}),e.beginnerBlock(!0),e}return n}(),w=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"solfege",_("solfege"))).setPalette("pitch",S),e.setHelpString([_("Pitch can be specified in terms of do re mi fa sol la ti."),"documentation",null,"note1"]),e.formBlock({outType:"solfegeout"}),e.beginnerBlock(!0),e}return n}(),N=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"customNote")).setPalette("pitch",S),e.hidden=!0,e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(null===e[0]||null===e[1])return S.errorMsg(NOINPUTERRORMSG,r),void(t.stopTurtle=!0);var l=e[0],a=e[1];return Singer.processPitch(S,l,a,0)}}]),n}(),L=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"invert1")).setPalette("pitch",S),e.setHelpString([_("The Invert block rotates any contained notes around a target note."),"documentation",null,"inverthelp"]),e.formBlock({name:_("Invert").toLowerCase(),args:3,defaults:["sol",4,_("even")],argTypes:["solfegein","anyin","anyin"],argLabels:["ja"===e.lang?_("name2"):_("name"),_("octave"),_("even")+"/"+_("odd")+"/"+_("scalar")]}),e.makeMacro(function(e,t){return[[0,"invert1",e,t,[null,1,2,3,null,4]],[1,["solfege",{value:"sol"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]],[3,["invertmode",{value:"even"}],0,0,[0]],[4,"hidden",0,0,[0,null]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[3]){null!==e[0]&&null!==e[1]&&null!==e[2]||S.errorMsg(NOINPUTERRORMSG,r);var l=null===e[0]?"sol":e[0],a=null===e[1]?4:e[1],i=null===e[2]?"even":e[2];return Singer.PitchActions.invert(l,a,i,n,r),[e[3],1]}}}]),n}(),A=function(){_inherits(l,FlowClampBlock);var r=_createSuper(l);function l(e,t){var n;return _classCallCheck(this,l),(n=r.call(this,e||"invert2",t||_("invert (odd)"))).setPalette("pitch",S),n.formBlock({args:2,defaults:["sol",4],argTypes:["solfegein","anyin"],argLabels:[_("note"),_("octave")]}),n.hidden=n.deprecated=!0,n}return _createClass(l,[{key:"flow",value:function(e,t,n,r){var l=S.turtles.ithTurtle(S.turtles.companionTurtle(n));"invert"===S.blocks.blockList[r].name?l.singer.invertList.push([e[0],e[1],"even"]):l.singer.invertList.push([e[0],e[1],"odd"]);var a="_invert_"+n;t.setDispatchBlock(r,n,a);return t.setTurtleListener(n,a,function(){return l.singer.invertList.pop()}),[e[2],1]}}]),l}(),B=function(){_inherits(n,A);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"invert",_("invert (even)"))).setPalette("pitch",S),e.formBlock({args:2,defaults:["sol",4],argTypes:["solfegein","anyin"],argLabels:[_("note"),_("octave")]}),e.makeMacro(function(e,t){return[[0,"invert",e,t,[null,1,2,null,3]],[1,["solfege",{value:"sol"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e.hidden=!0,e}return n}(),O=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"register",_("register"))).setPalette("pitch",S),e.piemenuValuesC1=[-3,-2,-1,0,1,2,3],e.setHelpString([_("The Register block provides an easy way to modify the register (octave) of the notes that follow it."),"documentation",null,"registerhelp"]),e.formBlock({args:1,defaults:[0]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n){null!==e[0]&&"number"==typeof e[0]&&Singer.PitchActions.setRegister(e[0],n)}}]),n}(),M=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"50cents",_("50 cents"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"settransposition",e,t,[null,12,1,2]],[1,"vspace",0,0,[0,3]],[2,"hidden",0,0,[0,null]],[3,["newnote",{collapsed:!1}],0,0,[1,4,7,11]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"pitch",0,0,[7,9,10,null]],[9,["solfege",{value:"sol"}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"hidden",0,0,[3,null]],[12,"divide",0,0,[0,13,14]],[13,["number",{value:50}],0,0,[12]],[14,["number",{value:100}],9,0,[12]]]}),e}return n}(),E=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"settransposition")).setPalette("pitch",S),e.piemenuValuesC1=[-12,-11,-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12],e.setHelpString([_("The Semi-tone transposition block will shift the pitches contained inside Note blocks up (or down) by half steps.")+" "+_("In the example shown above, sol is shifted up to sol#."),"documentation",""]),e.formBlock({name:_("semi-tone transpose"),args:1,defaults:["1"]}),e.makeMacro(function(e,t){return[[0,"settransposition",e,t,[null,1,6,7]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,["number",{value:12}],0,0,[3]],[6,"vspace",0,0,[0,null]],[7,"hidden",0,0,[0,null]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1])return null!==e[0]&&"number"==typeof e[0]?(Singer.PitchActions.setSemitoneTranspose(e[0],n,r),[e[1],1]):void 0}}]),n}(),R=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"setratio")).setPalette("pitch",S),e.setHelpString([_("The Transpose by Ratio block will shift the pitches contained inside Note blocks up (or down) by a ratio"),"documentation",""]),e.formBlock({name:_("transpose by ratio"),args:1,defaults:[1.5]}),e.makeMacro(function(e,t){return[[0,"setratio",e,t,[null,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:3}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1]){var l,a=S.blocks.blockList[r].connections[1],i=e[0];return null===a?(S.errorMsg(NOINPUTERRORMSG,r),i=1):"intervalname"===S.blocks.blockList[a].name&&(i=(l=S.blocks.blockList[a].value)in INTERVALVALUES?INTERVALVALUES[l][2]:(console.log("could not find "+l+" in INTERVALVALUES"),1)),(isNaN(i)||i<0)&&(i=1,console.debug("ratio "+i+" must be a number > 0")),Singer.PitchActions.setRatioTranspose(i,n,r),[e[1],1]}}}]),n}(),F=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"octave",_("octave"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"settransposition",e,t,[null,1,4,5]],[1,"multiply",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:12}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e}return n}(),H=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"custompitch",_("custom pitch"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"pitch",e,t,[null,1,2,null]],[1,["customNote",{value:"C(+0¢)"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]]]}),e.hidden=!0,e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(null!==e[0]&&null!==e[1])return Singer.PitchActions.playPitch(e[0],e[1],0,n,r);S.errorMsg(NOINPUTERRORMSG,r),t.stopTurtle=!0}}]),n}(),I=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"downsixth",_("down sixth"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"minus",0,0,[0,2,3]],[2,["number",{value:-5}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return n}(),U=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"downthird",_("down third"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"minus",0,0,[0,2,3]],[2,["number",{value:-2}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return n}(),x=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"seventh",_("seventh"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:6}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return n}(),D=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"sixth",_("sixth"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:5}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return n}(),V=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"fifth",_("fifth"))).setPalette("pitch",S),e.beginnerBlock(!0),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:4}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return n}(),G=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"fourth",_("fourth"))).setPalette("pitch",S),e.beginnerBlock(!0),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,7]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:3}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,null]],[7,"hidden",0,0,[0,null]]]}),e}return n}(),j=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"third",_("third"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:2}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return n}(),z=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"second",_("second"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return n}(),q=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"unison",_("unison"))).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:0}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return n}(),W=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"setscalartransposition")).setPalette("pitch",S),e.piemenuValuesC1=[-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7],e.setHelpString([_("The Scalar transposition block will shift the pitches contained inside Note blocks up (or down) the scale.")+" "+_("In the example shown above, sol is shifted up to la."),"documentation",null,"scalartranshelp"]),e.formBlock({name:_("scalar transpose")+" (+/–)",args:1,defaults:["1"]}),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,null,2]],[1,["number",{value:1}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),S.beginnerMode&&e.beginnerModeBlock||(e.hidden=!0),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1]){var l=e[0];return null!==l&&"number"==typeof l||(S.errorMsg(NOINPUTERRORMSG,r),l=0),Singer.PitchActions.setScalarTranspose(l,n,r),[e[1],1]}}}]),n}(),K=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"accidental")).setPalette("pitch",S),e.setHelpString([_("The Accidental block is used to create sharps and flats"),"documentation",null,"accidental"]),e.formBlock({name:_("accidental override"),args:1,argTypes:["anyin"]}),e.makeMacro(function(e,t){return[[0,"accidental",e,t,[null,11,1,10]],[1,"newnote",e,t,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"hidden",0,0,[1,null]],[10,"hidden",0,0,[0,null]],[11,["accidentalname",{value:"natural ♮"}],0,0,[0]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1]){var l=e[0];return null!==l&&"string"==typeof l||(S.errorMsg(NOINPUTERRORMSG,r),l="sharp"),Singer.PitchActions.setAccidental(l,n,r),[e[1],1]}}}]),n}(),Y=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"flat")).setPalette("pitch",S),e.formBlock({name:_("flat")+" ♭"}),e.makeMacro(function(e,t){return[[0,"accidental",e,t,[null,11,1,10]],[1,"newnote",e,t,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"hidden",0,0,[1,null]],[10,"hidden",0,0,[0,null]],[11,["accidentalname",{value:"flat ♭"}],0,0,[0]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[0]){var l=S.turtles.ithTurtle(S.turtles.companionTurtle(n));l.singer.transposition+=0<l.singer.invertList.length?1:-1;var a="_flat_"+n;t.setDispatchBlock(r,n,a);return t.setTurtleListener(n,a,function(){return l.singer.transposition+=0<l.singer.invertList.length?-1:1}),[e[0],1]}}}]),n}(),X=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"sharp")).setPalette("pitch",S),e.formBlock({name:_("sharp")+" ♯"}),e.makeMacro(function(e,t){return[[0,"accidental",e,t,[null,11,1,10]],[1,"newnote",e,t,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"hidden",0,0,[1,null]],[10,"hidden",0,0,[0,null]],[11,["accidentalname",{value:"sharp ♯"}],0,0,[0]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[0]){var l=S.turtles.ithTurtle(S.turtles.companionTurtle(n));l.singer.transposition+=0<l.singer.invertList.length?-1:1;var a="_sharp_"+n;t.setDispatchBlock(r,n,a);return t.setTurtleListener(n,a,function(){return l.singer.transposition+=0<l.singer.invertList.length?1:-1}),[e[0],1]}}}]),n}(),$=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"hertz",_("hertz"))).setPalette("pitch",S),e.beginnerBlock(!0),e.setHelpString([_("The Hertz block (in combination with a Number block) will play a sound at the specified frequency."),"documentation",null,"note3"]),e.formBlock({args:1,defaults:["ja"===e.lang?440:392]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){var l=e[0];(null===l||"number"!=typeof l||l<=0)&&(S.errorMsg(NOINPUTERRORMSG,r),l=392);var a=frequencyToPitch(l),i=S.turtles.ithTurtle(S.turtles.companionTurtle(n));if("?"===a[0])S.errorMsg(INVALIDPITCH,r),t.stopTurtle=!0;else if(t.inMatrix){t.phraseMaker.addRowBlock(r),t.pitchBlocks.includes(r)||t.pitchBlocks.push(r),t.phraseMaker.rowLabels.push(S.blocks.blockList[r].name),t.phraseMaker.rowArgs.push(l.toFixed(0)),i.singer.lastNotePlayed=[a[0]+a[1],4]}else if(t.inLegoWidget){t.legoWidget.addRowBlock(r),t.pitchBlocks.includes(r)||t.pitchBlocks.push(r),t.legoWidget.rowLabels.push(S.blocks.blockList[r].name),t.legoWidget.rowArgs.push(l.toFixed(0)),i.singer.lastNotePlayed=[a[0]+a[1],4]}else if(t.inMusicKeyboard){t.musicKeyboard.instruments.push(last(i.singer.instrumentNames)),t.musicKeyboard.noteNames.push("hertz"),t.musicKeyboard.octaves.push(l),t.musicKeyboard.addRowBlock(r),i.singer.lastNotePlayed=[a[0]+a[1],4]}else if(t.inPitchStaircase){for(var s=l,o=a,c=0,u=0;u<t.pitchStaircase.Stairs.length;u++){if(t.pitchStaircase.Stairs[u][2]<parseFloat(s))return t.pitchStaircase.Stairs.splice(u,0,[o[0],o[1],parseFloat(s)]),void(c=1);if(t.pitchStaircase.Stairs[u][2]===parseFloat(s))return t.pitchStaircase.Stairs.splice(u,1,[o[0],o[1],parseFloat(s)]),void(c=1)}0===c&&t.pitchStaircase.Stairs.push([o[0],o[1],parseFloat(s)]),t.pitchStaircase.stairPitchBlocks.push(r)}else{if(!t.inPitchSlider)return Singer.PitchActions.playHertz(l,n,r);t.pitchSlider.frequencies.push(e[0])}}}]),n}(),J=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"pitchnumber",_("pitch number"))).setPalette("pitch",S),e.beginnerBlock(!0),e.setHelpString([_("The Pitch Number block will play a pitch associated by its number, e.g. 0 for C and 7 for G."),"documentation",null,"note5"]),e.formBlock({args:1,defaults:[7]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){var l=null===e[0]?(S.errorMsg(NOINPUTERRORMSG,r),7):"number"!=typeof e[0]?(S.errorMsg(NANERRORMSG,r),7):Math.round(e[0]);return Singer.PitchActions.playPitchNumber(l,n,r)}}]),n}(),Q=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"scaledegree",_("nth modal pitch"))).setPalette("pitch",S),e.setHelpString([_("nth Modal Pitch takes the pattern of pitches in semitones for a mode and makes each point a degree of the mode,")+" "+_("starting from 1 and regardless of tonal framework (i.e. not always 8 notes in the octave)"),"documentation",""]),e.hidden=!0,e.formBlock({args:2,defaults:[4,4],argLabels:[_("number"),_("octave")],argTypes:["numberin","anyin"]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){var l=null!==e[0]?e[0]:"sol",a=null!==e[1]?e[1]:4;return null!==e[0]&&null!==e[1]||S.errorMsg(NOINPUTERRORMSG,r),"number"==typeof l?Singer.PitchActions.playNthModalPitch(l,a,n,r):(S.errorMsg(INVALIDPITCH,r),void(t.stopTurtle=!0))}}]),n}(),Z=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"nthmodalpitch",_("nth modal pitch"))).setPalette("pitch",S),e.piemenuValuesC1=[7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7],e.setHelpString([_("Nth Modal Pitch takes a number as an input as the nth degree for the given mode. 0 is the first position, 1 is the second, -1 is the note before the first etc.")+" "+_("The pitches change according to the mode specified without any need for respellings."),"documentation",""]),e.formBlock({args:2,defaults:[4,4],argLabels:[_("number"),_("octave")],argTypes:["numberin","anyin"]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){var l=null!==e[0]?e[0]:"sol",a=null!==e[1]?e[1]:4;return null!==e[0]&&null!==e[1]||S.errorMsg(NOINPUTERRORMSG,r),"number"==typeof l?Singer.PitchActions.playNthModalPitch(l,a,n,r):(S.errorMsg(INVALIDPITCH,r),void(t.stopTurtle=!0))}}]),n}(),ee=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"scaledegree2",_("scale degree"))).setPalette("pitch",S),e.extraWidth=10,e.setHelpString([_("Scale Degree is a common convention in music. Scale Degree offers seven possible positions in the scale (1-7) and can be modified via accidentals.")+" "+_("Scale Degree 1 is always the first pitch in a given scale, regardless of octave."),"documentation",""]),e.formBlock({outType:"scaledegreeout"}),e.makeMacro(function(e,t){return[[0,"pitch",e,t,[null,1,2,null]],[1,["scaledegree2",{value:"5"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]]]}),e}return _createClass(n,[{key:"arg",value:function(e,t,n){return S.blocks.blockList[n].value}}]),n}(),te=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"steppitch",_("scalar step")+" (+/–)")).setPalette("pitch",S),e.piemenuValuesC1=[-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7],e.beginnerBlock(!0),e.setHelpString([_("The Scalar Step block (in combination with a Number block) will play the next pitch in a scale,")+" "+_("eg if the last note played was sol, Scalar Step 1 will play la."),"documentation",""]),e.formBlock({args:1,defaults:[1],argTypes:["anyin"]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){return Singer.PitchActions.stepPitch(e[0],n,r)}}]),n}(),ne=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"pitch2",_("pitch")+" G4")).setPalette("pitch",S),e.makeMacro(function(e,t){return[[0,"pitch",e,t,[null,1,2,null]],[1,["notename",{value:"G"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]]]}),e.beginnerBlock(!0),e}return n}(),re=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"pitch",_("pitch"))).setPalette("pitch",S),e.beginnerBlock(!0),e.setHelpString([_("The Pitch block specifies the pitch name and octave of a note that together determine the frequency of the note."),"documentation",null,"note1"]),e.formBlock({args:2,defaults:["sol",4],argTypes:["solfegein","anyin"],argLabels:["ja"===e.lang?_("name2"):_("name"),_("octave")]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){var l=null!==e[0]?e[0]:"sol",a=null!==e[1]?e[1]:4;"object"===_typeof(l)&&(a=l[1],l=l[0]),null!==l&&null!==a||S.errorMsg(NOINPUTERRORMSG,r);var i,s,o,c,u,h,p,f,v,d,m,k,_,b=S.turtles.ithTurtle(S.turtles.companionTurtle(n)),g=S.blocks.blockList[r].connections[1],y=null;return null!==g&&(y=S.blocks.blockList[g].name),u=isNaN(Number(l[0]))&&isNaN(Number(l[1]))?"number"!=typeof l&&isNaN(Number(l))?("object"===_typeof(l)&&(a=l[1],l=l[0]),SOLFEGENAMES1.includes(l.toLowerCase())||NOTENAMES1.includes(l.toUpperCase())?(i=l.charAt(l.length-1),[SHARP,FLAT,DOUBLESHARP,DOUBLEFLAT].includes(i)?l=l.substr(0,l.length-1):i=NATURAL,c=NOTENAMES.includes(l.toUpperCase())?SOLFEGECONVERSIONTABLE[l.toUpperCase()]:l,c=i!==NATURAL?c+i:c,_=Math.floor(calcOctave(b.singer.currentOctave,a,b.singer.lastNotePlayed,c)),0):(_=calcOctave(b.singer.currentOctave,a,b.singer.lastNotePlayed,l),c=(s=[l,Math.floor(Math.min(9,Math.max(0,_))),0])[0],_=s[1],s[2])):(l=Number(l))<=12?(l<1&&(S.errorMsg(INVALIDPITCH,r),l=7),c=nthDegreeToPitch(b.singer.keySignature,Math.round(l)),_=Math.floor(calcOctave(b.singer.currentOctave,a,b.singer.lastNotePlayed,c)),0):((l<A0||l>C8)&&(S.errorMsg(INVALIDPITCH,r),l=392),c=(o=_slicedToArray(frequencyToPitch(l),3))[0],_=o[1],o[2]):(_="scaledegree2"===y?(h=(p=S.blocks.blockList[g].value).includes(SHARP)?SHARP:p.includes(FLAT)?FLAT:p.includes(DOUBLESHARP)?DOUBLESHARP:p.includes(DOUBLEFLAT)?DOUBLEFLAT:NATURAL,p=Number(p.replace(h,"")),h!=NATURAL&&(c+=h),f=keySignatureToMode(b.singer.keySignature),(v=p<=0)?d=p+7*(Math.floor(Math.abs(p)/7)+1):0==(d=Math.floor(p)%7)&&(d=7),p=Math.abs(p),m=NOTESTEP[f[0].substr(0,1)]-1,f[0].substr(1)===FLAT?m--:f[0].substr(1)===SHARP&&m++,c=scaleDegreeToPitchMapping(b.singer.keySignature,d,b.singer.movable,null),k=m,k+=NOTESFLAT.includes(c)?NOTESFLAT.indexOf(c)-m:NOTESSHARP.indexOf(c)-m,(v?-1:1)*((v?Math.floor((p+1)/7):Math.floor((p-1)/7))+(v?m<k?1:0:k<m?1:0))+Math.floor(calcOctave(b.singer.currentOctave,a,b.singer.lastNotePlayed,c))):(c=l,a),0),Singer.PitchActions.playPitch(c,_,u,n,r)}}]),n}();(new s).setup(S),(new o).setup(S),(new e).setup(S),(new t).setup(S),(new n).setup(S),(new r).setup(S),(new l).setup(S),(new a).setup(S),(new i).setup(S),(new c).setup(S),(new u).setup(S),(new h).setup(S),(new p).setup(S),(new b).setup(S),(new g).setup(S),(new y).setup(S),(new v).setup(S),(new f).setup(S),(new N).setup(S),(new m).setup(S),(new k).setup(S),(new L).setup(S),(new A).setup(S),(new B).setup(S),(new O).setup(S),(new R).setup(S),(new M).setup(S),(new E).setup(S),(new F).setup(S),(new I).setup(S),(new U).setup(S),(new x).setup(S),(new D).setup(S),(new V).setup(S),(new G).setup(S),(new j).setup(S),(new z).setup(S),(new q).setup(S),(new W).setup(S),(new P).setup(S),(new K).setup(S),(new Y).setup(S),(new X).setup(S),(new d).setup(S),(new ee).setup(S),(new C).setup(S),(new T).setup(S),(new w).setup(S),(new $).setup(S),(new J).setup(S),(new Q).setup(S),(new Z).setup(S),(new te).setup(S),(new H).setup(S),(new ne).setup(S),(new re).setup(S)}