"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var n=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,n?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var language=localStorage.languagePreference||navigator.language,rhythmBlockPalette="ja"===language?"rhythm":"widgets";function setupRhythmBlockPaletteBlocks(d){var e=function(){_inherits(n,FlowBlock);var r=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=r.call(this,e||"rhythm")).setPalette(rhythmBlockPalette,d),t.setHelpString(),t.formBlock({name:"ja"===t.lang?_("rhythm1"):_("rhythm"),args:2,defaults:[3,4],argLabels:[_("number of notes"),_("note value")],argTypes:["anyin","anyin"]}),t.hidden=t.deprecated=!0,t}return _createClass(n,[{key:"flow",value:function(e,l,u,o){var a=null===e[0]||"number"!=typeof e[0]||e[0]<1?(d.errorMsg(NOINPUTERRORMSG,o),3):e[0],t=null===e[1]||"number"!=typeof e[1]||e[1]<=0?(d.errorMsg(NOINPUTERRORMSG,o),.25):e[1],s="rhythm2"===d.blocks.blockList[o].name?1/t:t;if(l.inMatrix||l.tuplet){if(l.inMatrix){l.phraseMaker.addColBlock(o,a);for(var r=0;r<a;r++)l.tupletRhythms.push(["individual",1,s])}for(var n=0;n<e[0];n++)Singer.processNote(d,s,!1,o,u)}else if(l.inRhythmRuler){null===l.rhythmRulerMeasure?l.rhythmRulerMeasure=a*t:l.rhythmRulerMeasure!=a*t&&d.textMsg(_("polyphonic rhythm"));for(var i=-1,c=0;c<l.rhythmRuler.Drums.length;c++){var h=l.rhythmRuler.Drums.length-c-1;if(l.rhythmRuler.Drums[h]===l._currentDrumBlock){i=h;break}}if(-1!==i)for(var p=0;p<a;p++)l.rhythmRuler.Rulers[i][0].push(s)}else!function(){var e=d.turtles.ithTurtle(u);0<e.singer.drumStyle.length?(l.clearNoteParams(e,o,e.singer.drumStyle),e.singer.inNoteBlock.push(o)):(l.clearNoteParams(e,o,[]),e.singer.inNoteBlock.push(o),e.singer.notePitches[last(e.singer.inNoteBlock)]=["G"],e.singer.noteOctaves[last(e.singer.inNoteBlock)]=[4],e.singer.noteCents[last(e.singer.inNoteBlock)]=[0]);for(var t=0<TONEBPM/e.singer.bpm.length?last(e.singer.bpm):Singer.masterBPM,r=null==t?1:t/s,n=0;n<a;n++)!function(e,t,r,n,l){setTimeout(function(){return Singer.processNote(d,e,!1,t,r,n)},l)}(s,o,u,n===a-1?function(){delete e.singer.noteDrums[o],e.singer.inNoteBlock.splice(e.singer.inNoteBlock.indexOf(o),1)}:null,n*r*1e3);e.doWait((a-1)*r)}()}}]),n}(),t=function(){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"rhythm2")).setPalette(rhythmBlockPalette,d),e.beginnerBlock(!0),e.piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],e.setHelpString([_("The Rhythm block is used to generate rhythm patterns."),"documentation",null,"rhythm2"]),e.extraWidth=10,e.formBlock({name:"ja"===e.lang?_("rhythm1"):_("rhythm"),args:2,defaults:[3,4],argLabels:[_("number of notes"),_("note value")],argTypes:["anyin","anyin"]}),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:3}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return r}(),r=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),isAppleBrowser()?(e=t.call(this,"sixtyfourthNote",_("1/64 note"))).appleNoteBlock():e=t.call(this,"sixtyfourthNote",_("1/64 note")+" ð…£"),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:64}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_possibleConstructorReturn(e)}return r}(),n=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),isAppleBrowser()?(e=t.call(this,"thirtysecondNote",_("1/32 note"))).appleNoteBlock():e=t.call(this,"thirtysecondNote",_("1/32 note")+" ð…¢"),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:32}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_possibleConstructorReturn(e)}return r}(),l=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),isAppleBrowser()?(e=t.call(this,"sixteenthNote",_("1/16 note"))).appleNoteBlock():e=t.call(this,"sixteenthNote",_("1/16 note")+" ð…¡"),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:16}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_possibleConstructorReturn(e)}return r}(),u=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"eighthNote",_("eighth note")+" â™ª")).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:8}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return r}(),o=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"quarterNote",_("quarter note")+" â™©")).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return r}(),a=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),isAppleBrowser()?(e=t.call(this,"halfNote",_("half note"))).appleNoteBlock():e=t.call(this,"halfNote",_("half note")+" ð…ž"),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_possibleConstructorReturn(e)}return r}(),s=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),isAppleBrowser()?(e=t.call(this,"wholeNote",_("whole note"))).appleNoteBlock():e=t.call(this,"wholeNote",_("whole note")+" ð…"),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:1}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_possibleConstructorReturn(e)}return r}(),i=function(){_inherits(n,FlowClampBlock);var r=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=r.call(this,e||"tuplet2")).setPalette(rhythmBlockPalette,d),t.setHelpString(),t.formBlock({name:_("tuplet"),args:2,defaults:[1,4],argLabels:[_("number of notes"),_("note value")]}),t.hidden=!0,t}return _createClass(n,[{key:"flow",value:function(e,t,r,n){t.inMatrix&&("tuplet3"===d.blocks.blockList[n].name?t.tupletParams.push([e[0],1/e[1]*d.turtles.ithTurtle(r).singer.beatFactor]):t.tupletParams.push([e[0],e[1]*d.turtles.ithTurtle(r).singer.beatFactor]),t.tuplet=!0,t.addingNotesToTuplet=!1);var l="_tuplet_"+r;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(){t.inMatrix&&(t.tuplet=!1,t.addingNotesToTuplet=!1)}),[e[2],1]}}]),n}(),c=function(){_inherits(r,i);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"tuplet3")).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.formBlock({name:_("tuplet"),args:2,defaults:[1,4],argLabels:[_("number of notes"),_("note value")]}),e.makeMacro(function(e,t){return[[0,"tuplet3",e,t,[null,1,10,9,7]],[1,["number",{value:1}],0,0,[0]],[2,"rhythm2",0,0,[9,3,4,8]],[3,["number",{value:3}],0,0,[2]],[4,"divide",0,0,[2,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"hidden",0,0,[0,null]],[8,"vspace",0,0,[2,null]],[9,"vspace",0,0,[0,2]],[10,"divide",0,0,[0,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]]]}),e.hidden=!0,e}return r}(),h=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"tuplet4")).setPalette(rhythmBlockPalette,d),e.setHelpString([_("The Tuplet block is used to generate a group of notes played in a condensed amount of time."),"documentation",null,"tuplet4"]),e.extraWidth=30,e.formBlock({name:_("tuplet"),args:1,defaults:[.25],argLabels:[_("note value")]}),e.makeMacro(function(e,t){return[[0,"tuplet4",e,t,[null,1,4,17]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"rhythm2",0,0,[4,6,7,10]],[6,["number",{value:6}],0,0,[5]],[7,"divide",0,0,[5,8,9]],[8,["number",{value:1}],0,0,[7]],[9,["number",{value:16}],0,0,[7]],[10,"vspace",0,0,[5,11]],[11,"rhythm2",0,0,[10,12,13,16]],[12,["number",{value:1}],0,0,[11]],[13,"divide",0,0,[11,14,15]],[14,["number",{value:1}],0,0,[13]],[15,["number",{value:4}],0,0,[13]],[16,"vspace",0,0,[11,null]],[17,"hidden",0,0,[0,18]],[18,"hidden",0,0,[17,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,v,y,_){if(void 0!==e[1]){var t=null===e[0]||"number"!=typeof e[0]||e[0]<=0?(d.errorMsg(NOINPUTERRORMSG,_),.5):e[0];v.inMatrix||(v.tupletRhythms=[],v.tupletParams=[]),v.tuplet=!0,v.addingNotesToTuplet=!1,v.tupletParams.push([1,1/t*d.turtles.ithTurtle(y).singer.beatFactor]);var r="_tuplet_"+y;v.setDispatchBlock(_,y,r);return v.setTurtleListener(y,r,function(){var e=d.turtles.ithTurtle(y);if(v.tuplet=!1,v.addingNotesToTuplet=!1,!v.inMatrix){for(var t=[],r=0;r<v.tupletRhythms.length;r++){var n=[v.tupletParams[v.tupletRhythms[r][1]]];n.push([]);for(var l=0,u=2;u<v.tupletRhythms[r].length;u++)l+=1/v.tupletRhythms[r][u],n[1].push(v.tupletRhythms[r][u]);for(var o=n[0][0]/(n[0][1]*l),a=2;a<v.tupletRhythms[r].length;a++)t.push(v.tupletRhythms[r][a]/o)}0<e.singer.drumStyle.length?v.clearNoteParams(e,_,e.singer.drumStyle):v.clearNoteParams(e,_,[DEFAULTDRUM]),e.singer.inNoteBlock.push(_);for(var s=0<TONEBPM/e.singer.bpm.length?last(e.singer.bpm):Singer.masterBPM,i=0,c=0,h=null,p=0;p<t.length;p++){var m=t[p],f=s/m,h=p===t.length-1?function(){delete e.singer.noteDrums[_],e.singer.inNoteBlock.splice(e.singer.inNoteBlock.indexOf(_),1)}:null;(function(e,t,r,n,l){setTimeout(function(){return Singer.processNote(d,e,!1,t,r,n)},l)})(m,_,y,h,c),c+=1e3*f,i+=f}e.doWait(i-f)}}),[e[1],1]}}}]),r}(),p=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"stuplet7",_("septuplet"))).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"stuplet",e,t,[null,1,2,5]],[1,["number",{value:7}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return r}(),m=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"stuplet5",_("quintuplet"))).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"stuplet",e,t,[null,1,2,5]],[1,["number",{value:5}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return r}(),f=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"stuplet3",_("triplet"))).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"stuplet",e,t,[null,1,2,5]],[1,["number",{value:3}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return r}(),v=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"stuplet",_("simple tuplet"))).setPalette(rhythmBlockPalette,d),e.piemenuValuesC1=[3,5,7,11],e.beginnerBlock(_THIS_IS_MUSIC_BLOCKS_),e.setHelpString([_("Tuplets are a collection of notes that get scaled to a specific duration.")+" "+_("Using tuplets makes it easy to create groups of notes that are not based on a power of 2."),"documentation",null,"matrix"]),e.formBlock({args:2,defaults:[3,.5],argLabels:[_("number of notes"),_("note value")]}),e.makeMacro(function(e,t){return[[0,"stuplet",e,t,[null,1,2,5]],[1,["number",{value:3}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,n,l,u){var o=null===e[0]||"number"!=typeof e[0]||e[0]<=0?(d.errorMsg(NOINPUTERRORMSG,u),3):e[0],t=null===e[1]||"number"!=typeof e[1]||e[1]<=0?(d.errorMsg(NOINPUTERRORMSG,u),.5):e[1],a=1/t*d.turtles.ithTurtle(l).singer.beatFactor;if(n.inMatrix||n.tuplet)if(n.phraseMaker.addColBlock(u,o),n.tuplet)for(var r=0;r<o;r++)n.addingNotesToTuplet||(n.tupletRhythms.push(["notes",0]),n.addingNotesToTuplet=!0),Singer.processNote(d,a,!1,u,l);else{n.tupletParams.push([1,a]);for(var s=["simple",0],i=0;i<o;i++)s.push(1/t*d.turtles.ithTurtle(l).singer.beatFactor);n.tupletRhythms.push(s)}else!function(){var e=d.turtles.ithTurtle(l);0<e.singer.drumStyle.length?n.clearNoteParams(e,u,e.singer.drumStyle):n.clearNoteParams(e,u,[DEFAULTDRUM]),e.singer.inNoteBlock.push(u);for(var t=(0<TONEBPM/e.singer.bpm.length?last(e.singer.bpm):Singer.masterBPM)/a/o,r=0;r<o;r++)!function(e,t,r,n,l){setTimeout(function(){return Singer.processNote(d,e,!1,t,r,n)},l)}(a*o,u,l,r===o-1?function(){delete e.singer.noteDrums[u],e.singer.inNoteBlock.splice(e.singer.inNoteBlock.indexOf(u),1)}:null,r*t*1e3);e.doWait((o-1)*t)}()}}]),r}();(new e).setup(d),(new t).setup(d),(new r).setup(d),(new n).setup(d),(new l).setup(d),(new u).setup(d),(new o).setup(d),(new a).setup(d),(new s).setup(d),(new i).setup(d),(new c).setup(d),(new h).setup(d),(new p).setup(d),(new m).setup(d),(new f).setup(d),(new v).setup(d)}function isAppleBrowser(){var e=navigator.userAgent,t=e.includes("Macintosh"),r=e.includes("iPad")||e.includes("Macintosh")&&"ontouchend"in document,n=e.includes("Safari")&&!e.includes("Chrome"),l=e.includes("Chrome");return(t||r)&&(n||l)}_THIS_IS_TURTLE_BLOCKS_&&(rhythmBlockPalette="rhythm"),"undefined"!=typeof module&&module.exports&&(module.exports={setupRhythmBlockPaletteBlocks:setupRhythmBlockPaletteBlocks});