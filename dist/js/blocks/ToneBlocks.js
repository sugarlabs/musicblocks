"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var n=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,n?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function setupToneBlocks(c){var e=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"oscillator",_("Oscillator").toLowerCase())).setPalette("tone",c),e.setHelpString(),e.formBlock({args:2,defaults:[_("triangle"),6],argLabels:[_("type"),_("partials")],argTypes:["anyin","numberin"]}),e.hidden=!0,e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var s=DEFAULTOSCILLATORTYPE,l=0;if(2===e.length&&"number"==typeof e[1]){for(var o in OSCTYPES)OSCTYPES[o][0]===e[0]?s=OSCTYPES[o][1]:OSCTYPES[o][1]===e[0]&&(s=e[0]);l=e[1]}t.inTimbre&&(0!=t.timbre.osc.length?c.errorMsg(_("You are adding multiple oscillator blocks.")):(t.timbre.oscParams=[],t.synth.createSynth(r,t.timbre.instrumentName,s,t.timbre.synthVals)),t.timbre.osc.push(n),t.timbre.oscParams.push(s),t.timbre.oscParams.push(l))}}]),r}(),t=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"filtertype")).setPalette("tone",c),e.setHelpString(),e.formBlock({outType:"textout"}),e.hidden=!0,e}return r}(),r=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"oscillatortype")).setPalette("tone",c),e.setHelpString(),e.formBlock({outType:"textout"}),e.hidden=!0,e}return r}(),n=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"duosynth",_("duo synth"))).setPalette("tone",c),e.piemenuValuesC1=[10,20,30,40,50,60,70,80,90,100],e.piemenuValuesC2=[10,20,30,40,50,60,70,80,90,100],e.setHelpString([_("The Duo synth block is a duo-frequency modulator used to define a timbre."),"documentation",null,"duosynthhelp"]),e.formBlock({args:2,defaults:[10,5],argLabels:[_("vibrato rate"),_("vibrato intensity")]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){Singer.ToneActions.defDuoSynth(e[0],e[1],r,n)}}]),r}(),s=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"amsynth",_("AM synth"))).setPalette("tone",c),e.piemenuValuesC1=[1,2],e.setHelpString([_("The AM synth block is an amplitude modulator used to define a timbre."),"documentation",null,"amsynthhelp"]),e.formBlock({args:1,defaults:[1]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){Singer.ToneActions.defAMSynth(e[0],r,n)}}]),r}(),l=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"fmsynth",_("FM synth"))).setPalette("tone",c),e.piemenuValuesC1=[1,5,10,15,20,25],e.setHelpString([_("The FM synth block is a frequency modulator used to define a timbre."),"documentation",null,"fmsynthhelp"]),e.formBlock({args:1,defaults:[10]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){Singer.ToneActions.defFMSynth(e[0],r,n)}}]),r}(),o=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"partial",_("partial"))).setPalette("tone",c),e.setHelpString([_("The Partial block is used to specify a weight for a specific partial harmonic."),"documentation",""]),e.formBlock({args:1,defaults:[10]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r){if("number"!=typeof e[0]||1<e[0]||e[0]<0)return c.errorMsg(_("Partial weight must be between 0 and 1.")),void(t.stopTurtle=!0);var n,s=c.turtles.ithTurtle(r);0<s.singer.inHarmonic.length?(n=s.singer.inHarmonic.length-1,s.singer.partials[n].push(e[0])):c.errorMsg(_("Partial block should be used inside of a Weighted-partials block."))}}]),r}(),a=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"harmonic")).setPalette("tone",c),e.setHelpString([_("The Weighted partials block is used to specify the partials associated with a timbre."),"documentation",""]),e.formBlock({name:_("weighted partials")}),e.makeMacro(function(e,t){return[[0,"harmonic",e,t,[null,2,1]],[1,"hidden",0,0,[0,null]],[2,"partial",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,"partial",0,0,[2,5,6]],[5,["number",{value:.2}],0,0,[4]],[6,"partial",0,0,[4,7,null]],[7,["number",{value:.01}],0,0,[6]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var s=c.turtles.ithTurtle(r);s.singer.inHarmonic.push(n),s.singer.partials.push([]);var l="_harmonic_"+r+"_"+n;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(){s.singer.inHarmonic.pop(),s.singer.partials.pop()}),[e[0],1]}}]),r}(),i=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"harmonic2")).piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10,11],e.setPalette("tone",c),e.setHelpString([_("The Harmonic block will add harmonics to the contained notes."),"documentation",null,"harmonichelp"]),e.formBlock({name:_("harmonic"),args:1,defaults:[1]}),e.makeMacro(function(e,t){return[[0,"harmonic2",e,t,[null,2,null,1]],[1,"hidden",0,0,[0,null]],[2,["number",{value:1}],0,0,[0]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){return Singer.ToneActions.doHarmonic(e[0],r,n),[e[1],1]}}]),r}(),u=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"dis")).setPalette("tone",c),e.piemenuValuesC1=[10,20,30,40,50,60,70,80,90,100],e.setHelpString([_("The Distortion block adds distortion to the pitch."),"documentation",null,"dishelp"]),e.formBlock({name:_("distortion"),args:1,defaults:[40]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){Singer.ToneActions.doDistortion(e[0],r,n);var s=c.turtles.ithTurtle(r);return t.inTimbre&&(instrumentsEffects[r][t.timbre.instrumentName].distortionActive=!0,t.timbre.distortionEffect.push(n),t.timbre.distortionParams.push(100*last(s.singer.distortionAmount)),instrumentsEffects[r][t.timbre.instrumentName].distortionAmount=e[0]),[e[1],1]}}]),r}(),m=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"tremolo")).setPalette("tone",c),e.piemenuValuesC1=[.5,1,1.5,2,2.5,3,3.5,4,4.5,5,10,20],e.piemenuValuesC2=[0,10,20,30,40,50,60,70,80,90,100],e.beginnerBlock(!0),e.setHelpString([_("The Tremolo block adds a wavering effect."),"documentation",null,"tremolohelp"]),e.formBlock({name:_("tremolo"),args:2,defaults:[10,50],argLabels:[_("rate"),_("depth")]}),e.makeMacro(function(e,t){return[[0,"tremolo",e,t,[null,1,2,null,3]],[1,["number",{value:10}],0,0,[0]],[2,["number",{value:50}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){Singer.ToneActions.doTremolo(e[0],e[1],r,n);var s=c.turtles.ithTurtle(r);return t.inTimbre&&(instrumentsEffects[r][t.timbre.instrumentName].tremoloActive=!0,t.timbre.tremoloEffect.push(n),t.timbre.tremoloParams.push(last(s.singer.tremoloFrequency)),instrumentsEffects[r][t.timbre.instrumentName].tremoloFrequency=e[0],t.timbre.tremoloParams.push(100*last(s.singer.tremoloDepth)),instrumentsEffects[r][t.timbre.instrumentName].tremoloDepth=e[1]),[e[2],1]}}]),r}(),p=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"phaser")).setPalette("tone",c),e.piemenuValuesC1=[.5,1,1.5,2,2.5,3,3.5,4,4.5,5,10,20],e.piemenuValuesC2=[1,2,3],e.piemenuValuesC3=[220,247,262,294,330,349,392,440,494,523,587,659,698,783,880],e.setHelpString([_("The Phaser block adds a sweeping sound."),"documentation",null,"phaserhelp"]),e.formBlock({name:_("phaser"),args:3,defaults:[.5,3,392],argLabels:[_("rate"),_("octaves"),_("base frequency")]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){Singer.ToneActions.doPhaser(e[0],e[1],e[2],r,n);var s=c.turtles.ithTurtle(r);return t.inTimbre&&(instrumentsEffects[r][t.timbre.instrumentName].phaserActive=!0,t.timbre.phaserEffect.push(n),t.timbre.phaserParams.push(last(s.singer.rate)),instrumentsEffects[r][t.timbre.instrumentName].rate=e[0],t.timbre.phaserParams.push(last(s.singer.octaves)),instrumentsEffects[r][t.timbre.instrumentName].octaves=e[1],t.timbre.phaserParams.push(last(s.singer.baseFrequency)),instrumentsEffects[r][t.timbre.instrumentName].baseFrequency=e[2]),[e[3],1]}}]),r}(),f=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"chorus")).setPalette("tone",c),e.piemenuValuesC1=[.5,1,1.5,2,2.5,3,3.5,4,4.5,5],e.piemenuValuesC2=[2,2.5,3,3.5,4,4.5,5,6,7,8,9,10],e.piemenuValuesC3=[0,10,20,30,40,50,60,70,80,90,100],e.beginnerBlock(!0),e.setHelpString([_("The Chorus block adds a chorus effect."),"documentation",null,"chorushelp"]),e.formBlock({name:_("chorus"),args:3,defaults:[1.5,3.5,70],argLabels:[_("rate"),_("delay (MS)"),_("depth")]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){Singer.ToneActions.doChorus(e[0],e[1],e[2],r,n);var s=c.turtles.ithTurtle(r);return t.inTimbre&&(instrumentsEffects[r][t.timbre.instrumentName].chorusActive=!0,t.timbre.chorusEffect.push(n),t.timbre.chorusParams.push(last(s.singer.chorusRate)),instrumentsEffects[r][t.timbre.instrumentName].chorusRate=e[0],t.timbre.chorusParams.push(last(s.singer.delayTime)),instrumentsEffects[r][t.timbre.instrumentName].delayTime=e[1],t.timbre.chorusParams.push(100*last(s.singer.chorusDepth)),instrumentsEffects[r][t.timbre.instrumentName].chorusDepth=e[2]),[e[3],1]}}]),r}(),h=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"vibrato")).setPalette("tone",c),e.piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10],e.beginnerBlock(!0),e.setHelpString([_("The Vibrato block adds a rapid, slight variation in pitch."),"documentation",null,"vibratohelp"]),e.formBlock({name:_("vibrato"),args:2,defaults:[5,1/16],argLabels:[_("intensity"),_("rate")]}),e.makeMacro(function(e,t){return[[0,"vibrato",e,t,[null,1,3,2,6]],[1,["number",{value:5}],0,0,[0]],[2,"vspace",0,0,[0,null]],[3,"divide",0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:16}],0,0,[3]],[6,"hidden",0,0,[0,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){return Singer.ToneActions.doVibrato(e[0],e[1],r,n),[e[2],1]}}]),r}(),b=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"setvoice")).setPalette("tone",c),e.setHelpString(),e.formBlock({name:_("set synth"),args:1,argTypes:["textin"],defaults:["violin"]}),e.makeMacro(function(e,t){return[[0,"setvoice",e,t,[null,1,null,2]],[1,["voicename",{value:"violin"}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var s=null;for(var l in VOICENAMES)VOICENAMES[l][0]===e[0]?s=VOICENAMES[l][1]:VOICENAMES[l][1]===e[0]&&(s=e[0]);if(null===s)for(var o in DRUMNAMES)DRUMNAMES[o][0]===e[0]?s=DRUMNAMES[o][1]:DRUMNAMES[o][1]===e[0]&&(s=e[0]);var a,i=c.turtles.ithTurtle(r);return null===s?c.errorMsg(NOINPUTERRORMSG,n):(i.singer.voices.push(s),a="_setvoice_"+r,t.setDispatchBlock(n,r,a),t.setTurtleListener(r,a,function(){return i.singer.voices.pop()})),[e[1],1]}}]),r}(),d=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"synthname",_("synth name"))).setPalette("tone",c),e.setHelpString(),e.formBlock({outType:"textout"}),e.hidden=e.deprecated=!0,e}return _createClass(r,[{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==c.blocks.blockList[c.blocks.blockList[r].connections[0]].name)return last(c.turtles.ithTurtle(t).singer.instrumentNames);e.statusFields.push([r,"synthname"])}}]),r}(),v=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"setdefaultinstrument",_("set default instrument"))).setPalette("tone",c),e.setHelpString([_("The set default instrument block changes the default instrument from electronic synth to the instrument of your choice."),"documentation",""]),e.makeMacro(function(e,t){return[[0,"setdefaultinstrument",e,t,[null,1,null]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]]]}),e.formBlock({args:1,argTypes:["anyin"],defaults:[DEFAULTVOICE]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var s=c.turtles.ithTurtle(r);null===e[0]?c.errorMsg(NOINPUTERRORMSG,n):0===s.singer.instrumentNames.length?s.singer.instrumentNames=[e[0]]:s.singer.instrumentNames[0]=e[0]}}]),r}(),k=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"voicename",_("set instrument"))).setPalette("tone",c),e.setHelpString([_("The Set instrument block selects a voice for the synthesizer,")+" "+_("eg guitar piano violin or cello."),"documentation",""]),e.formBlock({outType:"textout"}),e.extraWidth=50,e}return r}(),y=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"settimbre")).setPalette("tone",c),e.beginnerBlock(!0),c.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Set instrument block selects a voice for the synthesizer,"),"documentation",""]):e.setHelpString([_("The Set instrument block selects a voice for the synthesizer,")+" "+_("eg guitar piano violin or cello."),"documentation",null,"settimbrehelp"]),e.formBlock({name:_("set instrument"),args:1,argTypes:["anyin"],defaults:[_("custom")]}),e.makeMacro(function(e,t){return[[0,"settimbre",e,t,[null,1,null,2]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){return null===e[0]?c.errorMsg(NOINPUTERRORMSG,n):(t.inRhythmRuler?(t._currentDrumBlock=n,t.rhythmRuler.Drums.push(n),t.rhythmRuler.Rulers.push([[],[]])):t.inSample&&(t.sample.timbreBlock=n,"object"===_typeof(e[0])?(t.sample.timbreBlock=n,t.sample.sampleName=e[0][0],t.sample.sampleData=e[0][1],2<e[0].length?(t.sample.samplePitch=e[0][2],t.sample.sampleOctave=e[0][3]):(t.sample.samplePitch="la",t.sample.sampleOctave=4)):(t.sample.sampleName="",t.sample.sampleData="",t.sample.samplePitch="la",t.sample.sampleOctave=4)),Singer.ToneActions.setTimbre(e[0],r,n)),[e[1],1]}}]),r}(),g=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"customsample",_("sample"))).setPalette("tone",c),e.beginnerBlock(!1),e.setHelpString([_("Import a sound file to use as an instrument and set its pitch center."),"documentation",null,"turtleshell"]),e.formBlock({outType:"textout",args:3,argTypes:["anyin","anyin","anyin"],argLabels:[_("file"),_("name"),_("octave")]}),e.parameter=!0,e.makeMacro(function(e,t){return[[0,["customsample",{value:["","","do",4]}],e,t,[null,1,2,3]],[1,["audiofile",{value:null}],0,0,[0]],[2,["solfege",{value:"do"}],0,0,[0]],[3,["number",{value:4}],0,0,[0]]]}),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return c.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==c.blocks.blockList[c.blocks.blockList[r].connections[0]].name){null===c.blocks.blockList[r].value&&(c.blocks.blockList[r].value=["","","do",4]);var n,s,l=c.blocks.blockList[r].connections[1];null!=l&&null!==c.blocks.blockList[l].value&&(n=c.blocks.blockList[l].value[0],s=c.blocks.blockList[l].value[1],c.blocks.blockList[r].value[0]=n,c.blocks.blockList[r].value[1]=s);var o,a=c.blocks.blockList[r].connections[2];null!=a&&(o=c.blocks.blockList[a].value,c.blocks.blockList[r].value[2]=o);var i,u=c.blocks.blockList[r].connections[3];return null!=u&&(i=c.blocks.blockList[u].value,c.blocks.blockList[r].value[3]=i),c.blocks.blockList[r].value}e.statusFields.push([r,"customsample"])}}]),r}(),C=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"audiofile","")).parameter=!0,e.extraWidth=20,e.setPalette("tone",c),e.hidden=!0,e.beginnerBlock(!1),e.setHelpString([_("Upload a sound file to connect with the sample block."),"documentation",""]),e.formBlock({outType:"textout"}),e}return _createClass(r,[{key:"updateParameter",value:function(e,t,r){return c.blocks.updateBlockText(r),c.blocks.blockList[r].value}}]),r}();(new e).setup(c),(new t).setup(c),(new r).setup(c),(new n).setup(c),(new s).setup(c),(new l).setup(c),(new o).setup(c),(new a).setup(c),(new i).setup(c),(new u).setup(c),(new m).setup(c),(new p).setup(c),(new f).setup(c),(new h).setup(c),(new C).setup(c),(new g).setup(c),(new v).setup(c),(new b).setup(c),(new d).setup(c),(new k).setup(c),(new y).setup(c)}"undefined"!=typeof module&&module.exports&&(module.exports={setupToneBlocks:setupToneBlocks});