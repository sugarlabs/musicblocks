"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var r=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,r?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function setupVolumeBlocks(m){var e=function(){_inherits(n,LeftBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"synthvolumefactor",_("synth volume"))).setPalette("volume",m),e.parameter=!0,e.setHelpString([_("The Synth volume block returns the current volume of the current synthesizer."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("piano")]}),e.makeMacro(function(e,t){return[[0,"synthvolumefactor",e,t,[null,1]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]]]}),e}return _createClass(n,[{key:"updateParameter",value:function(e,t,n){return m.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n,r){if(!e.inStatusMatrix||"print"!==m.blocks.blockList[m.blocks.blockList[n].connections[0]].name){var l=m.blocks.blockList[n].connections[1];if(null===l)return 0;var o=e.parseArg(e,t,l,n,r);return Singer.VolumeActions.getSynthVolume(o,t)}e.statusFields.push([n,"synth volume"])}}]),n}(),t=function(){_inherits(n,ValueBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"notevolumefactor",_("master volume"))).setPalette("volume",m),e.parameter=!0,e.setHelpString([_("The Master volume block returns the master volume."),"documentation",""]),e}return _createClass(n,[{key:"setter",value:function(e,t,n){var r=Singer.masterVolume.length;Singer.masterVolume[r-1]=t,m.turtles.ithTurtle(n).singer.suppressOutput||Singer.VolumeActions.setMasterVolume(e,t)}},{key:"updateParameter",value:function(e,t,n){return m.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==m.blocks.blockList[m.blocks.blockList[n].connections[0]].name)return Singer.VolumeActions.masterVolume;e.statusFields.push([n,"volume"])}}]),n}(),n=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"ppp","ppp")).setPalette("volume",m),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:10}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return n}(),r=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"pp","pp")).setPalette("volume",m),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:20}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return n}(),l=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"p","p")).setPalette("volume",m),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:30}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return n}(),o=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"mp","mp")).setPalette("volume",m),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:40}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return n}(),u=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"mf","mf")).setPalette("volume",m),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:50}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return n}(),s=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"f","f")).setPalette("volume",m),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:60}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return n}(),i=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"ff","ff")).setPalette("volume",m),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:80}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return n}(),a=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"fff","fff")).setPalette("volume",m),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:100}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return n}(),c=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"setsynthvolume2",_("set synth volume"))).setPalette("volume",m),e.setHelpString(),e.formBlock({args:2,defaults:[DEFAULTVOICE,50],argTypes:["textin","numberin"],argLabels:[_("synth"),_("volume")]}),e.hidden=!0,e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[2]){var l,o=null===e[0]||"string"!=typeof e[0]?(m.errorMsg(NOINPUTERRORMSG,r),DEFAULTVOICE):e[0];null===e[1]||"number"!=typeof e[1]?(m.errorMsg(NOINPUTERRORMSG,r),l=50):0===(l=e[1]<0?0:100<e[1]?100:e[1])&&m.errorMsg(_("Setting volume to 0."),r);var u=null;if(o===DEFAULTVOICE||o===_(DEFAULTVOICE)?u=DEFAULTVOICE:"custom"!==o&&e[0]!==_("custom")||(u="custom"),null===u)for(var s in VOICENAMES){if(VOICENAMES[s][0]===o){u=VOICENAMES[s][1];break}if(VOICENAMES[s][1]===o){u=o;break}}if(null===u)for(var i in DRUMNAMES){if(DRUMNAMES[i][0].replace("-"," ")===o){u=DRUMNAMES[i][1];break}if(DRUMNAMES[i][1].replace("-"," ")===o){u=o;break}}null===u&&(m.errorMsg(_("Synth not found"),r),u=DEFAULTVOICE);var a=m.turtles.ithTurtle(n);a.singer.instrumentNames.includes(u)||(a.singer.instrumentNames.push(u),t.synth.loadSynth(n,u),void 0===a.singer.synthVolume[u]&&(a.singer.synthVolume[u]=[DEFAULTVOLUME],a.singer.crescendoInitialVolume[u]=[DEFAULTVOLUME])),a.singer.synthVolume[u].push(l),a.singer.suppressOutput||Singer.setSynthVolume(t,n,u,l);var c="_synthvolume_"+n;t.setDispatchBlock(r,n,c);return t.setTurtleListener(n,c,function(){a.singer.synthVolume[u].pop(),0===a.singer.justCounting.length&&0<a.singer.synthVolume[u].length&&Singer.setSynthVolume(t,n,u,last(a.singer.synthVolume[u]))}),[e[2],1]}}}]),n}(),f=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"setdrumvolume",_("set drum volume"))).setPalette("volume",m),e.beginnerBlock(!0),e.formBlock({args:2,defaults:[DEFAULTDRUM,50],argTypes:["textin","numberin"],argLabels:[_("drum"),_("volume")]}),e.makeMacro(function(e,t){return[[0,"setsynthvolume",e,t,[null,1,2,null]],[1,["drumname",{value:DEFAULTDRUM}],0,0,[0]],[2,["number",{value:50}],0,0,[0,null]]]}),e}return n}(),v=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"setsynthvolume",_("set synth volume"))).setPalette("volume",m),e.piemenuValuesC2=[0,10,20,30,40,50,60,70,80,90,100],e.beginnerBlock(!0),e.setHelpString([_("The Set synth volume block will change the volume of a particular synth,")+" "+_("eg guitar violin snare drum etc.")+" "+_("The default volume is 50.")+" "+_("The range is 0 for silence to 100 for full volume."),"documentation",""]),e.formBlock({args:2,defaults:[DEFAULTVOICE,50],argTypes:["textin","numberin"],argLabels:[_("synth"),_("volume")]}),e.makeMacro(function(e,t){return[[0,"setsynthvolume",e,t,[null,1,2,null]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:50}],0,0,[0,null]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){var l,o=e[0];null!==o&&"string"==typeof o||(m.errorMsg(NOINPUTERRORMSG,r),o=DEFAULTVOICE),null===e[1]||"number"!=typeof e[1]?(m.errorMsg(NOINPUTERRORMSG,r),l=50):0===(l=Math.max(Math.min(e[1],100),0))&&m.errorMsg(_("Setting volume to 0."),r),Singer.VolumeActions.setSynthVolume(o,l,n,r)}}]),n}(),h=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"setpanning",_("set panning"))).setPalette("volume",m),e.piemenuValuesC1=[100,80,60,40,20,0,-20,-40,-60,-80,-100],e.beginnerBlock(!0),e.setHelpString([_("The Set Panning block sets the panning for all synthesizers."),"documentation",""]),e.formBlock({args:1,defaults:[0]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){1===e.length&&("number"!=typeof e[0]?m.errorMsg(NANERRORMSG,r):(100!==e[0]&&-100!==e[0]||m.errorMsg(_("Warning: Sound is coming out from only the left or right side."),r),Singer.VolumeActions.setPanning(e[0],n)))}}]),n}(),p=function(){_inherits(n,FlowBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"setnotevolume",_("set master volume"))).setPalette("volume",m),e.piemenuValuesC1=[0,10,20,30,40,50,60,70,80,90,100],e.beginnerBlock(!0),e.setHelpString([_("The Set master volume block sets the volume for all synthesizers."),"documentation",""]),e.formBlock({args:1,defaults:[50]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){1===e.length&&("number"!=typeof e[0]?m.errorMsg(NANERRORMSG,r):Singer.VolumeActions.setMasterVolume(e[0],n,r))}}]),n}(),y=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"setnotevolume2")).setPalette("volume",m),e.setHelpString(),e.formBlock({name:_("set master volume"),args:1,defaults:[50]}),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:50}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e.hidden=!0,e.deprecated=!0,e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1]){var l;null===e[0]||"number"!=typeof e[0]?(m.errorMsg(NOINPUTERRORMSG,r),l=50):0===(l=e[0]<0?0:100<e[0]?100:e[0])&&m.errorMsg(_("Setting volume to 0."),r);var o=m.turtles.ithTurtle(n);Singer.masterVolume.push(l),o.singer.suppressOutput||Singer.setMasterVolume(t,l);var u="_volume_"+n;t.setDispatchBlock(r,n,u);return t.setTurtleListener(n,u,function(){Singer.masterVolume.pop(),0===o.singer.justCounting.length&&0<Singer.masterVolume.length&&Singer.setMasterVolume(t,last(Singer.masterVolume))}),[e[1],1]}}}]),n}(),g=function(){_inherits(n,FlowClampBlock);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"articulation")).setPalette("volume",m),e.piemenuValuesC1=[-25,-20,-15,-10,-5,0,5,10,15,20,25],e.setHelpString([_("The Set relative volume block changes the volume of the contained notes."),"documentation",null,"articulationhelp"]),e.formBlock({name:_("set relative volume"),args:1,defaults:[50]}),e.makeMacro(function(e,t){return[[0,"articulation",e,t,[null,1,null,2]],[1,["number",{value:25}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _createClass(n,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1]){var l=e[0];return null!==l&&"number"==typeof l||(m.errorMsg(NOINPUTERRORMSG,r),l=0),Singer.VolumeActions.setRelativeVolume(l,n,r),[e[1],1]}}}]),n}(),d=function(){_inherits(r,FlowClampBlock);var n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this,e||"decrescendo")).setPalette("volume",m),t.piemenuValuesC1=[1,2,3,4,5,10,15,20],t.beginnerBlock(!0),t.setHelpString([_("The Decrescendo block will decrease the volume of the contained notes by a specified amount for every note played.")+" "+_("For example if you have 7 notes in sequence contained in a Decrescendo block with a value of 5 the final note will be at 35% less than the starting volume."),"documentation",null,"crescendohelp"]),t.formBlock({name:_("decrescendo"),args:1,defaults:[5]}),t.makeMacro(function(e,t){return[[0,"decrescendo",e,t,[null,1,null,2]],[1,["number",{value:5}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),t}return _createClass(r,[{key:"flow",value:function(e,t,n,r){if(1<e.length&&0!==e[0])return Singer.VolumeActions.doCrescendo(m.blocks.blockList[r].name,e[0],n,r),[e[1],1]}}]),r}(),k=function(){_inherits(n,d);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"crescendo")).setPalette("volume",m),e.piemenuValuesC1=[1,2,3,4,5,10,15,20],e.beginnerBlock(!0),e.setHelpString([_("The Crescendo block will increase the volume of the contained notes by a specified amount for every note played.")+" "+_("For example if you have 7 notes in sequence contained in a Crescendo block with a value of 5 the final note will be at 35% more than the starting volume."),"documentation",null,"crescendohelp"]),e.formBlock({name:_("crescendo"),args:1,defaults:[5]}),e.makeMacro(function(e,t){return[[0,"crescendo",e,t,[null,1,null,2]],[1,["number",{value:5}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return n}();(new t).setup(m),(new e).setup(m),(new n).setup(m),(new r).setup(m),(new l).setup(m),(new o).setup(m),(new u).setup(m),(new s).setup(m),(new i).setup(m),(new a).setup(m),(new c).setup(m),(new f).setup(m),(new v).setup(m),(new h).setup(m),(new p).setup(m),(new y).setup(m),(new g).setup(m),(new d).setup(m),(new k).setup(m)}"undefined"!=typeof module&&module.exports&&(module.exports={setupVolumeBlocks:setupVolumeBlocks});