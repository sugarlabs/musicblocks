"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var n=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,n?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function getTargetTurtle(e,t){for(var r in t=t.toString(),e.turtleList){var n=e.ithTurtle(r);if(!n.inTrash)if(n.name.toString()===t)return r}return console.debug('turtle "'.concat(t,'" not found')),null}function _blockFindTurtle(e,t,r,n){var l=e.blocks.blockList[r].connections[1];if(null===l)return console.debug("Could not find connecting block"),null;var o=e.logo.parseArg(e.logo,t,l,r,n);return null===o?(console.debug("Could not find target turtle name from arg"),null):e.turtles.getTurtle(getTargetTurtle(e.turtles,o))}function setupEnsembleBlocks(h){var e=function(){_inherits(i,LeftBlock);var a=_createSuper(i);function i(){var e,t,r,n,l;_classCallCheck(this,i),e=a.call(this,"turtleheap",_THIS_IS_MUSIC_BLOCKS_?_("mouse index heap"):_("turtle index heap")),t=_assertThisInitialized(e),r="ensemble",n=_THIS_IS_MUSIC_BLOCKS_?[_("The Mouse index heap block returns a value in the heap at a specified location for a specified mouse."),"documentation",""]:[_("The Turtle index heap block returns a value in the heap at a specified location for a specified turtle."),"documentation",""],t.setPalette(r,h),l=n,t.setHelpString(l);var o,s,u={args:2,defaults:[_THIS_IS_MUSIC_BLOCKS_?_("Mr. Mouse"):_("Yertle"),1],argTypes:["anyin","numberin"],argLabels:[_THIS_IS_MUSIC_BLOCKS_?_("mouse name"):_("turtle name"),_("index")]};return o=_assertThisInitialized(e),s=u,o.formBlock(s),e}return _createClass(i,[{key:"arg",value:function(e,t,r,n){var l=h.blocks.blockList[r].connections[1];if(null===l)return h.errorMsg(NOINPUTERRORMSG,r),-1;var o=e.parseArg(e,t,l,r,n),s=getTargetTurtle(h.turtles,o);if(s<0)return-1;var u=h.blocks.blockList[r].connections[2];if(null===u)h.errorMsg(NANERRORMSG,r);else{var a=e.parseArg(e,t,u,r,n);if("number"==typeof a){s in e.turtleHeaps||(e.turtleHeaps[s]=[]),a<1&&(a=1,h.errorMsg(_("Index must be > 0."))),1e3<a&&(a=1e3,h.errorMsg(_("Maximum heap size is 1000.")));for(;e.turtleHeaps[s].length<a;)e.turtleHeaps[s].push(0);return e.turtleHeaps[s][a-1]}h.errorMsg(NANERRORMSG,r)}}}]),i}(),t=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"stopTurtle",_("stop mouse"))).setHelpString([_("The Stop mouse block stops the specified mouse."),"documentation",""]),e.formBlock({args:1,defaults:[_("Mr. Mouse")],argTypes:["anyin"]})):((e=t.call(this,"stopTurtle",_("stop turtle"))).setHelpString([_("The Stop turtle block stops the specified turtle."),"documentation",""]),e.formBlock({args:1,defaults:[_("Yertle")],argTypes:["anyin"]})),e.setPalette("ensemble",h),_possibleConstructorReturn(e)}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var l,o;null!==e[0]?null===(l=getTargetTurtle(h.turtles,e[0]))?_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Cannot find mouse")+" "+e[0],n):h.errorMsg(_("Cannot find turtle")+" "+e[0],n):((o=h.turtles.ithTurtle(l)).queue=[],o.parentFlowQueue=[],o.unhighlightQueue=[],o.parameterQueue=[],console.debug("stopping "+l),h.turtles.ithTurtle(r).running=!1,t.doBreak(o)):h.errorMsg(NOINPUTERRORMSG,n)}}]),r}(),r=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"startTurtle",_("start mouse"))).setPalette("ensemble",h),e.setHelpString([_("The Start mouse block starts the specified mouse."),"documentation",""]),e.formBlock({args:1,defaults:[_("Mr. Mouse")],argTypes:["anyin"]})):((e=t.call(this,"startTurtle",_("start turtle"))).setPalette("ensemble",h),e.setHelpString([_("The Start turtle block starts the specified turtle."),"documentation",""]),e.formBlock({args:1,defaults:[_("Yertle")],argTypes:["anyin"]})),_possibleConstructorReturn(e)}return _createClass(r,[{key:"flow",value:function(e,t,r,n,l,o,s){if(console.debug("start mouse from mouse "+r),null!==e[0]){var u=getTargetTurtle(h.turtles,e[0]);if(null===u)_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Cannot find mouse")+" "+e[0],n):h.errorMsg(_("Cannot find turtle")+" "+e[0],n);else{var a=h.turtles.ithTurtle(u);if(a.running)return void(_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Mouse is already running."),n):h.errorMsg(_("Turtle is already running."),n));a.queue=[],a.running=!0,a.parentFlowQueue=[],a.unhighlightQueue=[];for(var i=!(a.parameterQueue=[]),c=null,f=0;f<h.blocks.blockList.length;f++)if(h.blocks.blockList[f]===a.startBlock){i=!0,c=f;break}i?(console.debug("STARTING "+u+" "+c),t.runFromBlock(t,u,c,s,l)):h.errorMsg(_("Cannot find start block")+" "+e[0],n)}}else h.errorMsg(NOINPUTERRORMSG,n)}}]),r}(),n=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"turtlecolor",_("mouse color"))).setHelpString([_("The Mouse color block returns the pen color of the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=t.call(this,"turtlecolor",_("turtle color"))).setHelpString([_("The Turtle color block returns the pen color of the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",h),e.hidden=e.deprecated=!0,_possibleConstructorReturn(e)}return _createClass(r,[{key:"arg",value:function(e,t,r,n){var l=_blockFindTurtle(h,t,r,n);return l?l.painter.color:h.turtles.getTurtle(t).painter.color}}]),r}(),l=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"turtleheading",_("mouse heading"))).setHelpString([_("The Mouse heading block returns the heading of the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=t.call(this,"turtleheading",_("turtle heading"))).setHelpString([_("The Turtle heading block returns the heading of the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",h),e.hidden=e.deprecated=!0,_possibleConstructorReturn(e)}return _createClass(r,[{key:"arg",value:function(e,t,r,n){var l=_blockFindTurtle(h,t,r,n);return l?l.orientation:h.turtles.getTurtle(t).orientation}}]),r}(),o=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"setxyturtle",_("set mouse"))).setHelpString(),e.formBlock({args:3,defaults:[_("Mr. Mouse"),0,0],argTypes:["anyin","numberin","numberin"],argLabels:["ja"===e.lang?_("name1"):_("name"),_("x"),_("y")]})):((e=t.call(this,"setxyturtle",_("set turtle"))).setHelpString(),e.formBlock({args:3,defaults:[_("Yertle"),0,0],argTypes:["anyin","numberin","numberin"],argLabels:["ja"===e.lang?_("name1"):_("name"),_("x"),_("y")]})),e.setPalette("ensemble",h),_possibleConstructorReturn(e)}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var l=getTargetTurtle(h.turtles,e[0]);null===l?_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Cannot find mouse")+" "+e[0],n):h.errorMsg(_("Cannot find turtle")+" "+e[0],n):3===e.length&&("string"==typeof e[1]||"string"==typeof e[2]?(h.errorMsg(NANERRORMSG,n),t.stopTurtle=!0):h.turtles.getTurtle(l).painter.doSetXY(e[1],e[2]))}}]),r}(),s=function(){_inherits(r,FlowClampBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.call(this,"setturtle"),_THIS_IS_MUSIC_BLOCKS_?(e.setHelpString([_("The Set mouse block sends a stack of blocks to be run by the specified mouse."),"documentation",""]),e.formBlock({name:_("set mouse"),args:1,defaults:[_("Mr. Mouse")],argTypes:["anyin"]})):(e.setHelpString([_("The Set turtle block sends a stack of blocks to be run by the specified turtle."),"documentation",""]),e.formBlock({name:_("set turtle"),args:1,defaults:[_("Yertle")],argTypes:["anyin"]})),e.setPalette("ensemble",h),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n,l,o,s){var u=getTargetTurtle(h.turtles,e[0]);null!==u?t.runFromBlock(t,u,e[1],s,l):_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Cannot find mouse")+" "+e[0],n):h.errorMsg(_("Cannot find turtle")+" "+e[0],n)}}]),r}(),u=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"yturtle",_("mouse y"))).setHelpString([_("The Y mouse block returns the Y position of the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=t.call(this,"yturtle",_("turtle y"))).setHelpString([_("The Y turtle block returns the Y position of the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",h),_possibleConstructorReturn(e)}return _createClass(r,[{key:"arg",value:function(e,t,r,n){var l=_blockFindTurtle(h,t,r,n);return l||(l=h.turtles.getTurtle(t),console.debug("Mouse not found. Using current mouse value instead.")),h.turtles.screenY2turtleY(l.container.y)}}]),r}(),a=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"xturtle",_("mouse x"))).setHelpString([_("The X mouse block returns the X position of the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=t.call(this,"xturtle",_("turtle x"))).setHelpString([_("The X turtle block returns the X position of the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",h),_possibleConstructorReturn(e)}return _createClass(r,[{key:"arg",value:function(e,t,r,n){var l=_blockFindTurtle(h,t,r,n);return l||(l=h.turtles.getTurtle(t),console.debug("Mouse not found. Using current mouse value instead.")),h.turtles.screenX2turtleX(l.container.x)}}]),r}(),i=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"turtleelapsednotes",_("mouse notes played"))).setHelpString([_("The Mouse elapse notes block returns the number of notes played by the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=t.call(this,"turtlelapsednotes",_("turtle notes played"))).setHelpString([_("The Turtle elapse notes block returns the number of notes played by the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",h),e.hidden=e.deprecated=!0,_possibleConstructorReturn(e)}return _createClass(r,[{key:"arg",value:function(e,t,r,n){var l=_blockFindTurtle(h,t,r,n);if(l){var o=h.turtles.ithTurtle(l);return o.singer.notesPlayed[0]/o.singer.notesPlayed[1]}var s=h.turtles.ithTurtle(t);return s.singer.notesPlayed[0]/s.singer.notesPlayed[1]}}]),r}(),c=function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"turtlepitch",_("mouse pitch number"))).setHelpString([_("The Mouse pitch block returns the current pitch number being played by the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=t.call(this,"turtlepitch",_("turtle pitch number"))).setHelpString([_("The Turtle pitch block returns the current pitch number being played by the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",h),e.hidden=e.deprecated=!0,_possibleConstructorReturn(e)}return _createClass(r,[{key:"arg",value:function(e,t,r,n){for(var l,o,s=null,u=h.blocks.blockList[r].connections[1],a=e.parseArg(e,t,u,r,n),i=h.turtles.ithTurtle(t),c=0;c<h.turtles.getTurtleCount();c++){var f=h.turtles.getTurtle(c);if(a===f.name){var g,p=void 0;p=null!==f.singer.lastNotePlayed?(g=f.singer.lastNotePlayed[0].length,[f.singer.lastNotePlayed[0].slice(0,g-1),parseInt(f.singer.lastNotePlayed[0].slice(g-1))]):0<f.singer.notePitches.length?getNote(f.singer.notePitches[0],f.singer.noteOctaves[0],0,f.singer.keySignature,i.singer.movable,null,h.errorMsg,e.synth.inTemperament):(console.debug("Cannot find a note for mouse "+t),h.errorMsg(INVALIDPITCH,r),["G",4]),s=pitchToNumber(p[0],p[1],f.singer.keySignature)-i.singer.pitchNumberOffset,h.blocks.blockList[r].value=s;break}}null===s&&(_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Cannot find mouse")+" "+a,r):h.errorMsg(_("Cannot find turtle")+" "+a,r),o=null!==i.singer.lastNotePlayed?(l=i.singer.lastNotePlayed[0].length,[i.singer.lastNotePlayed[0].slice(0,l-1),parseInt(i.singer.lastNotePlayed[0].slice(l-1))]):0<i.singer.notePitches.length?getNote(i.singer.notePitches[last(i.singer.inNoteBlock)][0],i.singer.noteOctaves[last(i.singer.inNoteBlock)][0],0,i.singer.keySignature,i.singer.movable,null,h.errorMsg,e.synth.inTemperament):(console.debug("Cannot find a note for mouse "+t),h.errorMsg(INVALIDPITCH,r),["G",4]),s=pitchToNumber(o[0],o[1],i.singer.keySignature)-i.singer.pitchNumberOffset,h.blocks.blockList[r].value=s)}}]),r}(),f=function(){_inherits(l,LeftBlock);var n=_createSuper(l);function l(e,t){var r;return _classCallCheck(this,l),_THIS_IS_MUSIC_BLOCKS_?((r=n.call(this,e||"turtlenote",t||_("mouse note value"))).setHelpString(),r.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((r=n.call(this,e||"turtlenote",t||_("turtle note value"))).setHelpString(),r.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),r.setPalette("ensemble",h),r.hidden=r.deprecated=!0,_possibleConstructorReturn(r)}return _createClass(l,[{key:"arg",value:function(e,t,r,n){for(var l=null,o=h.blocks.blockList[r].connections[1],s=e.parseArg(e,t,o,r,n),u=0;u<h.turtles.getTurtleCount();u++){var a=h.turtles.ithTurtle(u);if(s===a.name){l=0<a.singer.inNoteBlock.length&&last(a.singer.inNoteBlock)in a.singer.noteValue?1/a.singer.noteValue[last(a.singer.inNoteBlock)]:null!==a.singer.lastNotePlayed?a.singer.lastNotePlayed[1]:0<a.singer.notePitches.length?a.singer.noteBeat[last(a.singer.inNoteBlock)]:-1,"turtlenote"===h.blocks.blockList[r].name?h.blocks.blockList[r].value=l:h.blocks.blockList[r].value=0!==l?1/l:0;break}}null===l&&(_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Cannot find mouse")+" "+s,r):h.errorMsg(_("Cannot find turtle")+" "+s,r),h.blocks.blockList[r].value=-1)}}]),l}(),g=function(){_inherits(r,f);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"turtlenote2",_("mouse note value"))).setHelpString(),e.hidden=e.deprecated=!0,e}return r}(),p=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"turtlesync",_("mouse sync"))).setHelpString([_("The Mouse sync block aligns the beat count between mice."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=t.call(this,"turtlesync",_("turtle sync"))).setHelpString([_("The Turtle sync block aligns the beat count between turtles."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",h),_possibleConstructorReturn(e)}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var l;null!==e[0]?null===(l=getTargetTurtle(h.turtles,e[0]))?_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Cannot find mouse")+" "+e[0],n):h.errorMsg(_("Cannot find turtle")+" "+e[0],n):h.turtles.ithTurtle(r).singer.turtleTime=h.turtles.ithTurtle(l).singer.turtleTime:h.errorMsg(NOINPUTERRORMSG,n)}}]),r}(),m=function(){_inherits(r,BooleanBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.call(this,"foundturtle"),_THIS_IS_MUSIC_BLOCKS_?(e.setHelpString([_("The Found mouse block will return true if the specified mouse can be found."),"documentation",""]),e.formBlock({name:_("found mouse"),flows:{left:"bool"},args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):(e.setHelpString([_("The Found turtle block will return true if the specified turtle can be found."),"documentation",""]),e.formBlock({name:_("found turtle"),flows:{left:"bool"},args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",h),e}return _createClass(r,[{key:"arg",value:function(e,t,r,n){var l=h.blocks.blockList[r].connections[1],o=e.parseArg(e,t,l,r,n);return null!==getTargetTurtle(h.turtles,o)}}]),r}(),d=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?((e=t.call(this,"newturtle",_("new mouse"))).setHelpString([_("The New mouse block will create a new mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=t.call(this,"newturtle",_("new turtle"))).setHelpString([_("The New turtle block will create a new turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",h),_possibleConstructorReturn(e)}return _createClass(r,[{key:"flow",value:function(e,n,t,r,l){var o,s,u,a=h.blocks.blockList[r].connections[1],i=n.parseArg(n,t,a,r,l);null===getTargetTurtle(h.turtles,i)?(o=h.blocks.blockList.length,s=[[0,"start",h.turtles.turtleX2screenX(h.turtles.getTurtle(t).x),h.turtles.turtleY2screenY(h.turtles.getTurtle(t).y),[null,1,null]],[1,"setturtlename2",0,0,[0,2,null]],[2,["text",{value:i}],0,0,[1]]],u=function e(){var t=h.blocks.blockList[o].value,r=h.turtles.ithTurtle(t);n.initTurtle(t),r.queue=[],r.parentFlowQueue=[],r.unhighlightQueue=[],r.parameterQueue=[],r.running=!0,n.runFromBlock(n,t,o,0,l),h.stage.dispatchEvent(i),document.removeEventListener("finishedLoading",e)},document.addEventListener?document.addEventListener("finishedLoading",u):document.attachEvent("finishedLoading",u),h.blocks.loadNewBlocks(s)):(console.debug("Turtle "+i+" already exists."),h.stage.dispatchEvent(i))}}]),r}(),S=function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?(e=t.call(this,"setturtlecolor",_("set mouse color"))).setHelpString([_("The Set-mouse-color block is used to set the color of a mouse."),"documentation",null,"clickhelp"]):(e=t.call(this,"setturtlecolor",_("set turtle color"))).setHelpString([_("The Set-turtle-color block is used to set the color of a turtle."),"documentation",null,"clickhelp"]),e.setPalette("ensemble",h),e.beginnerBlock(!0),e.piemenuValuesC1=[0,10,20,30,40,50,60,70,80,90],e.formBlock({args:1,argTypes:["anyin"],defaults:[0]}),_possibleConstructorReturn(e)}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var l,o,s,u,a;null!==e[0]?(0!=(o=(l=h.turtles.ithTurtle(h.turtles.companionTurtle(r))).orientation)&&l.painter.doSetHeading(0),u="number"==typeof e[0]?(s=getMunsellColor(e[0],50,100),getMunsellColor(e[0],70,80)):(s=getMunsellColor(0,50,100),getMunsellColor(0,70,80)),a=TURTLESVG.replace(/fill_color/g,s).replace(/stroke_color/g,u),l.doTurtleShell(55,"data:image/svg+xml;base64,"+window.btoa(base64Encode(a))),0!=o&&l.painter.doSetHeading(o)):h.errorMsg(NOINPUTERRORMSG,n)}}]),r}(),b=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?(e=t.call(this,"turtlename",_("mouse name"))).setHelpString([_("The Mouse-name block returns the name of a mouse."),"documentation",null,"clickhelp"]):(e=t.call(this,"turtlename",_("turtle name"))).setHelpString([_("The Turtle-name block returns the name of a turtle."),"documentation",null,"clickhelp"]),e.setPalette("ensemble",h),e.beginnerBlock(!0),e.formBlock({outType:"textout"}),_possibleConstructorReturn(e)}return _createClass(r,[{key:"arg",value:function(e,t){return h.turtles.getTurtle(t).name}}]),r}(),k=function(){_inherits(r,ValueBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?(e=t.call(this,"turtlecount",_("mouse count"))).setHelpString([_("The Mouse-count block returns the number of mice."),"documentation",null,"clickhelp"]):(e=t.call(this,"turtlecount",_("turtle count"))).setHelpString([_("The Turtle-count block returns the number of turtles."),"documentation",null,"clickhelp"]),e.setPalette("ensemble",h),e.formBlock({outType:"numberout"}),_possibleConstructorReturn(e)}return _createClass(r,[{key:"arg",value:function(){return h.turtles.turtleCount()}}]),r}();[e,t,r,n,l,o,s,u,a,i,c,f,g,p,function(){_inherits(r,LeftBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),_THIS_IS_MUSIC_BLOCKS_?(e=t.call(this,"nthturtle",_("nth mouse name"))).setHelpString([_("The Nth-Mouse name block returns the name of the nth mouse."),"documentation",null,"clickhelp"]):(e=t.call(this,"nthturtle",_("nth turtle name"))).setHelpString([_("The Nth-Turtle name block returns the name of the nth turtle."),"documentation",null,"clickhelp"]),e.setPalette("ensemble",h),e.formBlock({outType:"textout",args:1,defaults:[1]}),_possibleConstructorReturn(e)}return _createClass(r,[{key:"arg",value:function(e,t,r,n){var l=h.blocks.blockList[r].connections[1];if(null===l)return h.errorMsg(NOINPUTERRORMSG,r),0;var o=e.parseArg(e,t,l,r,n);return"number"==typeof o?0<=--o&&o<h.turtles.getTurtleCount()?h.turtles.getTurtle(o).name:(_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Cannot find mouse")):h.errorMsg(_("Cannot find turtle")),""):(h.errorMsg(_("Index must be > 0.")),"")}}]),r}(),k,m,d,b,S,function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"setturtlename",_("set name"))).setPalette("ensemble",h),e.setHelpString(),_THIS_IS_MUSIC_BLOCKS_?e.formBlock({args:2,defaults:[-1,_("Mr. Mouse")],argTypes:["anyin","anyin"],argLabels:[_("source"),_("target")]}):e.formBlock({args:2,defaults:[-1,_("Yertle")],argTypes:["anyin","anyin"],argLabels:[_("source"),_("target")]}),e.hidden=e.deprecated=!0,e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){var l=!1;if(null!==e[0]&&null!==e[1]){if(-1===e[0])h.turtles.getTurtle(r).rename(e[1]),l=!0;else if("number"==typeof e[0]){var o=Math.floor(e[0]);0<=o&&o<h.turtles.getTurtleCount()&&(h.turtles.getTurtle(o).rename(e[1]),l=!0)}else for(var s=0;s<h.turtles.getTurtleCount();s++)if(h.turtles.getTurtle(s).name===e[0]){h.turtles.getTurtle(s).rename(e[1]),l=!0;break}l?h.turtles.getTurtle(r).rename(e[1]):_THIS_IS_MUSIC_BLOCKS_?h.errorMsg(_("Cannot find mouse")+" "+e[0],n):h.errorMsg(_("Cannot find turtle")+" "+e[0],n)}else h.errorMsg(NOINPUTERRORMSG,n)}}]),r}(),function(){_inherits(r,FlowBlock);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this,"setturtlename2",_("set name"))).setPalette("ensemble",h),e.beginnerBlock(!0),_THIS_IS_MUSIC_BLOCKS_?(e.setHelpString([_("The Set-name block is used to name a mouse."),"documentation",null,"clickhelp"]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):(e.setHelpString([_("The Set-name block is used to name a turtle."),"documentation",null,"clickhelp"]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e}return _createClass(r,[{key:"flow",value:function(e,t,r,n){null!==e[0]?h.turtles.getTurtle(r).rename(e[0]):h.errorMsg(NOINPUTERRORMSG,n)}}]),r}()].forEach(function(e){(new e).setup(h)})}