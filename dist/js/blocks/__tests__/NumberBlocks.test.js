"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../NumberBlocks"),setupNumberBlocks=_require.setupNumberBlocks,createdBlocks={},DummyFlowBlock=function(){function n(e,t){_classCallCheck(this,n),this.name=e,this.displayName=t||e,createdBlocks[e]=this}return _createClass(n,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}},{key:"flow",value:function(){}}]),n}(),DummyValueBlock=function(){function n(e,t){_classCallCheck(this,n),this.name=e,this.displayName=t||e,(createdBlocks[e]=this).extraWidth=0}return _createClass(n,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}},{key:"arg",value:function(e,t,n){return global.activity.blocks.blockList[n].value}}]),n}(),DummyLeftBlock=function(){function n(e,t){_classCallCheck(this,n),this.name=e,this.displayName=t||e,createdBlocks[e]=this}return _createClass(n,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}},{key:"arg",value:function(e,t,n){return global.activity.blocks.blockList[n].value}}]),n}();global.FlowBlock=DummyFlowBlock,global.ValueBlock=DummyValueBlock,global.LeftBlock=DummyLeftBlock,global._=jest.fn(function(e){return e}),global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.NOSQRTERRORMSG="No square root",global.ZERODIVIDEERRORMSG="Division by zero",global.MathUtility={doInt:function(e){return Math.floor(Number(e))},doMod:function(e,t){return Number(e)%Number(t)},doPower:function(e,t){return Math.pow(Number(e),Number(t))},doSqrt:function(e){if(Number(e)<0)throw"NoSqrtError";return Math.sqrt(Number(e))},doAbs:function(e){return Math.abs(Number(e))},doCalculateDistance:function(e,t,n,o){return Math.hypot(n-e,o-t)},doDivide:function(e,t){if(0===Number(t))throw"DivByZeroError";return Number(e)/Number(t)},doMultiply:function(e,t){return Number(e)*Number(t)},doNegate:function(e){return-Number(e)},doPlus:function(e,t){return isNaN(e)||isNaN(t)?""+e+t:Number(e)+Number(t)},doOneOf:function(e){return e},doRandom:function(e){return e},doMinus:function(e,t){return Number(e)-Number(t)}},global.calcOctave=function(e,t,n,o){return e+parseInt(t)},global.toFixed2=function(e){return Number(e).toFixed(2)};var createDummyTurtle=function(){return{id:"T1",container:{x:50,y:100,visible:!0},singer:{currentOctave:4,lastNotePlayed:"C",drumStyle:[],inNoteBlock:[],notePitches:{},noteOctaves:{},noteCents:{}},doWait:jest.fn()}},dummyActivity={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}}},dummyLogo={inStatusMatrix:!(dummyActivity.turtles={turtleObjs:{},getTurtle:function(e){return this.turtleObjs[e]||(this.turtleObjs[e]=createDummyTurtle()),this.turtleObjs[e]},ithTurtle:function(e){return this.getTurtle(e)}}),stopTurtle:!1,parseArg:jest.fn(function(e,t,n,o,r){return r}),statusFields:[]};describe("setupNumberBlocks",function(){var t,n,o;beforeEach(function(){createdBlocks={},DummyFlowBlock.createdBlocks={},DummyValueBlock.createdBlocks={},DummyLeftBlock.createdBlocks={},dummyActivity.errorMsg.mockClear(),dummyActivity.blocks.blockList={},dummyActivity.turtles.turtleObjs={},t=dummyActivity,global.activity=t,n=_objectSpread({},dummyLogo),o=0,setupNumberBlocks(t)}),describe("IntBlock",function(){it("should return integer using MathUtility.doInt",function(){t.blocks.blockList[100]={connections:[null,200],value:100},n.parseArg=jest.fn(function(){return 123.45});var e=createdBlocks.int.arg(n,o,100,123.45);expect(e).toEqual(Math.floor(123.45))}),it("should call errorMsg and return 0 if connection is null",function(){t.blocks.blockList[100]={connections:[null,null]};var e=createdBlocks.int.arg(n,o,100,0);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",100),expect(e).toEqual(0)})}),describe("ModBlock",function(){it("updateParameter should return value using toFixed2",function(){t.blocks.blockList[110]={value:123.456};var e=createdBlocks.mod.updateParameter(n,o,110);expect(e).toEqual(toFixed2(123.456))}),it("should return mod value when valid",function(){t.blocks.blockList[110]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?100:"c2"===n?12:void 0});var e=createdBlocks.mod.arg(n,o,110,null);expect(e).toEqual(4)})}),describe("PowerBlock",function(){it("should return power using MathUtility.doPower",function(){t.blocks.blockList[120]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?2:"c2"===n?3:void 0});var e=createdBlocks.power.arg(n,o,120,null);expect(e).toEqual(Math.pow(2,3))}),it("should call errorMsg if a connection is missing",function(){t.blocks.blockList[120]={connections:[null,"c1",null]};createdBlocks.power.arg(n,o,120,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",120)})}),describe("SqrtBlock",function(){it("should return square root for valid input",function(){t.blocks.blockList[130]={connections:[null,"c1"],value:64},n.parseArg=jest.fn(function(){return 64});var e=createdBlocks.sqrt.arg(n,o,130,null);expect(e).toEqual(Math.sqrt(64))}),it("should call errorMsg if input is missing",function(){t.blocks.blockList[130]={connections:[null,null]};var e=createdBlocks.sqrt.arg(n,o,130,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",130),expect(e).toEqual(0)})}),describe("AbsBlock",function(){it("should return absolute value",function(){t.blocks.blockList[140]={connections:[null,"c1"]},n.parseArg=jest.fn(function(){return-123});var e=createdBlocks.abs.arg(n,o,140,null);expect(e).toEqual(Math.abs(-123))})}),describe("DistanceBlock",function(){it("should calculate distance between two points",function(){t.blocks.blockList[150]={connections:[null,"c1","c2","c3","c4"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n||"c2"===n?0:"c3"===n?3:"c4"===n?4:void 0});var e=createdBlocks.distance.arg(n,o,150,null);expect(e).toEqual(5)}),it("should call errorMsg if any connection is missing",function(){t.blocks.blockList[150]={connections:[null,"c1",null,"c3","c4"]};var e=createdBlocks.distance.arg(n,o,150,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",150),expect(e).toEqual(0)})}),describe("DivideBlock",function(){it("should perform division",function(){t.blocks.blockList[160]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?100:"c2"===n?4:void 0});var e=createdBlocks.divide.arg(n,o,160,null);expect(e).toEqual(25)}),it("should call errorMsg on division by zero",function(){t.blocks.blockList[160]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?100:"c2"===n?0:void 0});var e=createdBlocks.divide.arg(n,o,160,null);expect(t.errorMsg).toHaveBeenCalledWith("Division by zero",160),expect(e).toEqual(0)})}),describe("MultiplyBlock",function(){it("should perform multiplication",function(){t.blocks.blockList[170]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?5:"c2"===n?6:void 0});var e=createdBlocks.multiply.arg(n,o,170,null);expect(e).toEqual(30)})}),describe("NegBlock",function(){it("should return the negated value",function(){t.blocks.blockList[180]={connections:[null,"c1"]},n.parseArg=jest.fn(function(){return 7});var e=createdBlocks.neg.arg(n,o,180,null);expect(e).toEqual(-7)}),it("should call errorMsg if connection is missing",function(){t.blocks.blockList[180]={connections:[null,null]};var e=createdBlocks.neg.arg(n,o,180,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",180),expect(e).toEqual(0)})}),describe("MinusBlock",function(){it("should subtract second value from first",function(){t.blocks.blockList[190]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?10:"c2"===n?4:void 0});var e=createdBlocks.minus.arg(n,o,190,null);expect(e).toEqual(6)})}),describe("PlusBlock",function(){it("should add two numbers",function(){t.blocks.blockList[200]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?3:"c2"===n?7:void 0});var e=createdBlocks.plus.arg(n,o,200,null);expect(e).toEqual(10)}),it("should handle numeric strings by converting them",function(){t.blocks.blockList[200]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(){return"5"});var e=createdBlocks.plus.arg(n,o,200,null);expect(e).toEqual(10)}),it("should concatenate two strings",function(){t.blocks.blockList[200]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?"Hello ":"c2"===n?"world":void 0}),global.MathUtility.doPlus=function(e,t){return isNaN(e)||isNaN(t)?""+e+t:Number(e)+Number(t)};var e=createdBlocks.plus.arg(n,o,200,null);expect(e).toEqual("Hello world")}),it("should handle mixed string and number concatenation",function(){t.blocks.blockList[200]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?"Count: ":"c2"===n?5:void 0}),global.MathUtility.doPlus=function(e,t){return isNaN(e)||isNaN(t)?""+e+t:Number(e)+Number(t)};var e=createdBlocks.plus.arg(n,o,200,null);expect(e).toEqual("Count: 5")})}),describe("OneOfBlock",function(){it("should return one of the two values",function(){t.blocks.blockList[210]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?100:"c2"===n?200:void 0});var e=createdBlocks.oneOf.arg(n,o,210,null);expect([100,200]).toContain(e)})}),describe("RandomBlock",function(){it("should return a random number (deterministic stub)",function(){t.blocks.blockList[220]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?0:"c2"===n?10:void 0});var e=createdBlocks.random.arg(n,o,220,null);expect(e).toEqual(0)})}),describe("NumberBlock",function(){it("should return the block's numeric value",function(){t.blocks.blockList[230]={value:"123.45"};var e=createdBlocks.number.arg(n,o,230,null);expect(Number(e)).toEqual(123.45)})})});