"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var o,n=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);var n=o.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../MediaBlocks"),setupMediaBlocks=_require.setupMediaBlocks,createdBlocks={},DummyFlowBlock=function(){function o(e,t){_classCallCheck(this,o),this.name=e,this.displayName=t||e,createdBlocks[e]=this}return _createClass(o,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}},{key:"flow",value:function(){}}]),o}(),DummyValueBlock=function(){function o(e,t){_classCallCheck(this,o),this.name=e,this.displayName=t||e,(createdBlocks[e]=this).extraWidth=0}return _createClass(o,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}},{key:"arg",value:function(e,t,o){return global.activity.blocks.blockList[o].value}}]),o}(),DummyLeftBlock=function(){function o(e,t){_classCallCheck(this,o),this.name=e,this.displayName=t||e,createdBlocks[e]=this}return _createClass(o,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}},{key:"arg",value:function(e,t,o){return global.activity.blocks.blockList[o].value}}]),o}();global.FlowBlock=DummyFlowBlock,global.ValueBlock=DummyValueBlock,global.LeftBlock=DummyLeftBlock,global._=jest.fn(function(e){return e}),global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.toFixed2=function(e){return Number(e).toFixed(2)},global.calcOctave=function(e,t,o,n){return e+parseInt(t)},global.pitchToFrequency=function(e,t,o,n){return 440},global.doStopVideoCam=jest.fn(),global.Howl=function(e){this.urls=e.urls,this.play=jest.fn(),this.stop=jest.fn()},global.last=function(e){return e[e.length-1]},global._THIS_IS_MUSIC_BLOCKS_=!0;var createDummyTurtle=function(){return{id:"T1",container:{x:50,y:100,visible:!0},painter:{doClearMedia:jest.fn()},singer:{inNoteBlock:[],embeddedGraphics:{}},doWait:jest.fn(),doTurtleShell:jest.fn()}},dummyActivity={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}}};dummyActivity.turtles={turtleObjs:{},getTurtle:function(e){return this.turtleObjs[e]||(this.turtleObjs[e]=createDummyTurtle()),this.turtleObjs[e]},ithTurtle:function(e){return this.getTurtle(e)},_canvas:{width:800,height:600},scale:1};var dummyLogo={sounds:[],boxes:{},statusFields:[],parseArg:jest.fn(function(e,t,o,n,l){return l}),processShow:jest.fn(),processSpeak:jest.fn(),meSpeak:{},setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),cameraID:null};describe("setupMediaBlocks",function(){var t,o,n;beforeEach(function(){createdBlocks={},DummyFlowBlock.createdBlocks={},DummyValueBlock.createdBlocks={},DummyLeftBlock.createdBlocks={},dummyActivity.errorMsg.mockClear(),dummyActivity.blocks.blockList={},dummyActivity.turtles.turtleObjs={},t=dummyActivity,global.activity=t,o=_objectSpread({},dummyLogo),n=0,setupMediaBlocks(t)}),describe("RightPosBlock",function(){it("should return right position based on canvas width",function(){var e=createdBlocks.rightpos;expect(e.updateParameter()).toEqual(toFixed2(400)),expect(e.arg()).toEqual(400)})}),describe("LeftPosBlock",function(){it("should return left position (negative)",function(){var e=createdBlocks.leftpos;expect(e.updateParameter()).toEqual(toFixed2(-400)),expect(e.arg()).toEqual(-400)})}),describe("TopPosBlock",function(){it("should return top position based on canvas height",function(){var e=createdBlocks.toppos;expect(e.updateParameter()).toEqual(toFixed2(300)),expect(e.arg()).toEqual(300)})}),describe("BottomPosBlock",function(){it("should return bottom position (negative)",function(){var e=createdBlocks.bottompos;expect(e.updateParameter()).toEqual(toFixed2(-300)),expect(e.arg()).toEqual(-300)})}),describe("WidthBlock",function(){it("should return canvas width",function(){var e=createdBlocks.width;expect(e.updateParameter()).toEqual(toFixed2(800)),expect(e.arg()).toEqual(800)})}),describe("HeightBlock",function(){it("should return canvas height",function(){var e=createdBlocks.height;expect(e.updateParameter()).toEqual(toFixed2(600)),expect(e.arg()).toEqual(600)})}),describe("StopPlaybackBlock",function(){it("should stop all sounds and clear logo.sounds",function(){var e={stop:jest.fn()},t={stop:jest.fn()};o.sounds=[e,t],createdBlocks.stopplayback.flow([],o),expect(e.stop).toHaveBeenCalled(),expect(t.stop).toHaveBeenCalled(),expect(o.sounds.length).toEqual(0)})}),describe("ClearMediaBlock",function(){it("should clear media by calling doClearMedia on turtle's painter",function(){var e=t.turtles.ithTurtle(n);e.painter.doClearMedia=jest.fn(),createdBlocks.erasemedia.flow([],o,n),expect(e.painter.doClearMedia).toHaveBeenCalled()})}),describe("PlaybackBlock",function(){it("should call errorMsg if input is null",function(){t.blocks.blockList[300]={connections:[null,null]},createdBlocks.playback.flow([null],o,n,300),expect(t.errorMsg).toHaveBeenCalledWith("No input provided",300)}),it("should create a Howl, push it to logo.sounds and play it",function(){t.blocks.blockList[300]={connections:[null,null],value:"audio.mp3"};var e=createdBlocks.playback;o.sounds=[],e.flow(["audio.mp3"],o,n,300),expect(o.sounds.length).toBeGreaterThan(0),expect(o.sounds[0].play).toHaveBeenCalled()})}),describe("SpeakBlock",function(){it("should call processSpeak if meSpeak is not null and no note block is active",function(){t.turtles.ithTurtle(n).singer.inNoteBlock=[],o.meSpeak={},o.processSpeak=jest.fn(),createdBlocks.speak.flow(["Hello world"],o,n,400),expect(o.processSpeak).toHaveBeenCalledWith("Hello world")})}),describe("CameraBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[410]={value:"cameraInput"};var e=createdBlocks.camera.arg(o,n,410);expect(e).toEqual("cameraInput")})}),describe("VideoBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[420]={value:"videoInput"};var e=createdBlocks.video.arg(o,n,420);expect(e).toEqual("videoInput")})}),describe("LoadFileBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[430]={value:"fileInput"};var e=createdBlocks.loadFile.arg(o,n,430);expect(e).toEqual("fileInput")})}),describe("StopVideoCamBlock",function(){it("should call doStopVideoCam if logo.cameraID is not null",function(){o.cameraID="cam1",o.setCameraID=jest.fn(),createdBlocks.stopvideocam.flow([],o),expect(doStopVideoCam).toHaveBeenCalledWith("cam1",o.setCameraID)})}),describe("ToneBlock",function(){it("should return undefined on flow",function(){var e=createdBlocks.tone.flow();expect(e).toBeUndefined()})}),describe("ToFrequencyBlock",function(){it("should return frequency given valid connections",function(){t.blocks.blockList[440]={connections:[null,"c1","c2"]},o.parseArg=jest.fn(function(e,t,o,n,l){return"c1"===o?"G":"c2"===o?4:void 0});var e=createdBlocks.tofrequency.arg(o,n,440,null);expect(e).toEqual(440)}),it("should call errorMsg if a connection is missing",function(){t.blocks.blockList[440]={connections:[null,null,"c2"]};createdBlocks.tofrequency.arg(o,n,440,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",440)})}),describe("TurtleShellBlock",function(){it("should call doTurtleShell on the turtle if args are valid",function(){var e=t.turtles.getTurtle(n);e.doTurtleShell=jest.fn(),t.blocks.blockList[500]={connections:[null,"c1","c2"]},createdBlocks.turtleshell.flow([30,"avatar.png"],o,n,500),expect(e.doTurtleShell).toHaveBeenCalledWith(30,"avatar.png")}),it("should call errorMsg if first argument is a string",function(){t.blocks.blockList[500]={connections:[null,"c1","c2"]},createdBlocks.turtleshell.flow(["bad","avatar.png"],o,n,500),expect(t.errorMsg).toHaveBeenCalledWith("Not a number",500)})}),describe("ShowBlock",function(){it("should push block id to embeddedGraphics if in note block",function(){var e=t.turtles.getTurtle(n);e.singer.inNoteBlock=[600],e.singer.embeddedGraphics[600]=[],t.blocks.blockList[600]={value:"dummy"},createdBlocks.show.flow([20,"text"],o,n,600),expect(e.singer.embeddedGraphics[600]).toContain(600)}),it("should call processShow if not in note block",function(){t.turtles.getTurtle(n).singer.inNoteBlock=[],o.processShow=jest.fn(),createdBlocks.show.flow([20,"text"],o,n,600),expect(o.processShow).toHaveBeenCalledWith(n,600,20,"text")})}),describe("MediaBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[610]={value:"mediaInput"};var e=createdBlocks.media.arg(o,n,610);expect(e).toEqual("mediaInput")})}),describe("TextBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[620]={value:"hello world"};var e=createdBlocks.text.arg(o,n,620);expect(e).toEqual("hello world")})})});