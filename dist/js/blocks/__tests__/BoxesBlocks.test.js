"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);var r=o.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../BoxesBlocks"),setupBoxesBlocks=_require.setupBoxesBlocks,createdBlocks={},DummyFlowBlock=function(){function o(e,t){_classCallCheck(this,o),this.name=e,this.displayName=t||e,createdBlocks[e]=this}return _createClass(o,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}},{key:"flow",value:function(){}}]),o}(),DummyValueBlock=function(){function o(e,t){_classCallCheck(this,o),this.name=e,this.displayName=t||e,(createdBlocks[e]=this).extraWidth=0}return _createClass(o,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}}]),o}(),DummyLeftBlock=function(){function o(e,t){_classCallCheck(this,o),this.name=e,this.displayName=t||e,createdBlocks[e]=this}return _createClass(o,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}}]),o}();global.FlowBlock=DummyFlowBlock,global.ValueBlock=DummyValueBlock,global.LeftBlock=DummyLeftBlock,global._=jest.fn(function(e){return e}),global.NOINPUTERRORMSG="No input provided",global.NOBOXERRORMSG="No box error",global.SOLFEGENAMES=["do","re","mi","fa","so","la","ti","do"],describe("setupBoxesBlocks",function(){var c,r;beforeEach(function(){createdBlocks={},c={errorMsg:jest.fn(),blocks:{blockList:{}},blockSetter:jest.fn(function(e,t,o,r){var n=c.blocks.blockList[t].privateData||c.blocks.blockList[t].value;e.boxes[n]=o}),beginnerMode:!1},r={boxes:{},statusFields:[],updatingStatusMatrix:!1,inStatusMatrix:!1,parseArg:jest.fn(function(e,t,o,r,n){return n}),receivedArg:void 0},setupBoxesBlocks(c)}),describe("IncrementBlock",function(){var e;beforeEach(function(){e=createdBlocks.increment,c.blocks.blockList[100]={connections:[null,200]}}),test('should update box value when connection is "text"',function(){c.blocks.blockList[200]={name:"text",value:"myBox"},r.boxes.myBox=5,e.flow([10,2],r,"turtle0",100),expect(r.boxes.myBox).toBe(7)}),test('should use SOLFEGENAMES branch when connection is "namedbox"',function(){c.blocks.blockList[200]={name:"namedbox",value:"do"},c.blocks.blockSetter=jest.fn(),e.flow([10,2],r,"turtle0",100),expect(c.blocks.blockSetter).toHaveBeenCalledWith(r,200,"mi","turtle0")}),test("should call blockSetter with default increment if no special case applies",function(){c.blocks.blockList[200]={name:"other",value:"unused"},c.blocks.blockSetter=jest.fn(),e.flow([10,3],r,"turtle0",100),expect(c.blocks.blockSetter).toHaveBeenCalledWith(r,200,13,"turtle0")}),test("should catch error and call errorMsg when blockSetter throws",function(){c.blocks.blockList[200]={name:"other",value:"unused"},c.blocks.blockSetter=jest.fn(function(){throw new Error("fail")}),e.flow([10,2],r,"turtle0",100),expect(c.errorMsg).toHaveBeenCalledWith("Block does not support incrementing.",200)})}),describe("IncrementOneBlock",function(){var e;beforeEach(function(){e=createdBlocks.incrementOne,c.blocks.blockList[110]={connections:[null,210]},c.blocks.blockList[210]={name:"other",value:"unused"},c.blocks.blockSetter=jest.fn()}),test("should set second argument to 1 and call parent flow",function(){e.flow([10],r,"turtle0",110),expect(c.blocks.blockSetter).toHaveBeenCalledWith(r,210,11,"turtle0")})}),describe("DecrementOneBlock",function(){var e;beforeEach(function(){e=createdBlocks.decrementOne,c.blocks.blockList[120]={connections:[null,220]},c.blocks.blockList[220]={name:"other",value:"unused"},c.blocks.blockSetter=jest.fn()}),test("should set second argument to -1 and call parent flow",function(){e.flow([10],r,"turtle0",120),expect(c.blocks.blockSetter).toHaveBeenCalledWith(r,220,9,"turtle0")})}),describe("BoxBlock",function(){var t,o=130;beforeEach(function(){t=createdBlocks.box,c.blocks.blockList[o]={connections:[null,300]},c.blocks.blockList[300]={value:"boxKey"},r.receivedArg="boxKey",r.boxes.boxKey=99}),test("updateParameter should return the box value if exists",function(){var e=t.updateParameter(r,"turtle0",o);expect(e).toBe(99)}),test("updateParameter should call errorMsg and return 0 if box missing",function(){delete r.boxes.boxKey;var e=t.updateParameter(r,"turtle0",o);expect(c.errorMsg).toHaveBeenCalledWith("No box error",o,"boxKey"),expect(e).toBe(0)}),test("setter should update box value if box exists",function(){t.setter(r,123,"turtle0",o),expect(r.boxes.boxKey).toBe(123)}),test("setter should call errorMsg if box missing",function(){delete r.boxes.boxKey,t.setter(r,456,"turtle0",o),expect(c.errorMsg).toHaveBeenCalledWith("No box error",o,"boxKey")}),test("arg should call errorMsg and return 0 if connection is null",function(){c.blocks.blockList[o]={connections:[null,null]};var e=t.arg(r,"turtle0",o,"boxKey");expect(c.errorMsg).toHaveBeenCalledWith("No input provided",o),expect(e).toBe(0)}),test("arg should return box value if exists",function(){c.blocks.blockList[o]={connections:[null,300]};var e=t.arg(r,"turtle0",o,"boxKey");expect(e).toBe(99)}),test("arg should call errorMsg and return 0 if box missing",function(){delete r.boxes.boxKey;var e=t.arg(r,"turtle0",o,"boxKey");expect(c.errorMsg).toHaveBeenCalledWith("No box error",o,"boxKey"),expect(e).toBe(0)})}),describe("NamedBoxBlock",function(){var t,o=140;beforeEach(function(){t=createdBlocks.namedbox,c.blocks.blockList[o]={privateData:"namedBoxKey",connections:[]},r.boxes.namedBoxKey=77}),test("updateParameter should return the named box value if exists",function(){var e=t.updateParameter(r,"turtle0",o);expect(e).toBe(77)}),test("updateParameter should call errorMsg and return 0 if missing",function(){delete r.boxes.namedBoxKey;var e=t.updateParameter(r,"turtle0",o);expect(c.errorMsg).toHaveBeenCalledWith("No box error",o,"namedBoxKey"),expect(e).toBe(0)}),test("setter should update the named box value if exists",function(){t.setter(r,88,"turtle0",o),expect(r.boxes.namedBoxKey).toBe(88)}),test("arg should return the named box value when not in status matrix",function(){var e=t.arg(r,"turtle0",o);expect(e).toBe(77)}),test("arg should call errorMsg and return 0 if box missing",function(){delete r.boxes.namedBoxKey;var e=t.arg(r,"turtle0",o);expect(c.errorMsg).toHaveBeenCalledWith("No box error",o,"namedBoxKey"),expect(e).toBe(0)})}),describe("StoreIn2Block",function(){var e;beforeEach(function(){e=createdBlocks.storein2,c.blocks.blockList[150]={privateData:"storeKey"}}),test("flow should store the given value in logo.boxes using privateData",function(){e.flow([999],r,"turtle0",150),expect(r.boxes.storeKey).toBe(999)})}),describe("StoreInBlock",function(){var e;beforeEach(function(){e=createdBlocks.storein}),test("flow should store the value in logo.boxes using the first argument as key",function(){e.flow(["myBox",555],r),expect(r.boxes.myBox).toBe(555)}),test("flow should do nothing if args length is not 2",function(){e.flow([1],r),expect(Object.keys(r.boxes).length).toBe(0)})}),describe("Box2Block",function(){var t;beforeEach(function(){(t=createdBlocks.box2).macro=jest.fn(function(e,t){return[[0,["namedbox",{value:"box2"}],e,t,[null]]]})}),test("should create a macro returning expected configuration",function(){var e=t.macro(10,20);expect(e[0][1][0]).toBe("namedbox"),expect(e[0][1][1].value).toBe("box2")})}),describe("StoreBox2Block",function(){var e;beforeEach(function(){e=createdBlocks.storebox2,c.blocks.blockList[170]={privateData:"box2Key"},e.flow=function(e,t,o,r){var n,l;1===e.length&&(n=c.blocks.blockList[r].privateData,l=e[0],t.boxes[n]=l)}}),test("flow should store the value in logo.boxes for Box2",function(){e.flow([888],r,"turtle0",170),expect(r.boxes.box2Key).toBe(888)})}),describe("Box1Block",function(){var t;beforeEach(function(){(t=createdBlocks.box1).macro=jest.fn(function(e,t){return[[0,["namedbox",{value:"box1"}],e,t,[null]]]})}),test("should create a macro returning expected configuration",function(){var e=t.macro(5,15);expect(e[0][1][0]).toBe("namedbox"),expect(e[0][1][1].value).toBe("box1")})}),describe("StoreBox1Block",function(){var e;beforeEach(function(){e=createdBlocks.storebox1,c.blocks.blockList[190]={privateData:"box1Key"},e.flow=function(e,t,o,r){var n,l;1===e.length&&(n=c.blocks.blockList[r].privateData,l=e[0],t.boxes[n]=l)}}),test("flow should store the value in logo.boxes for Box1",function(){e.flow([777],r,"turtle0",190),expect(r.boxes.box1Key).toBe(777)})})});