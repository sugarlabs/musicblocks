"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../HeapBlocks"),setupHeapBlocks=_require.setupHeapBlocks;describe("setupHeapBlocks",function(){var n,r,o,e=function(){function n(e,t){_classCallCheck(this,n),this.name=e,this.displayName=t,o[e]=this}return _createClass(n,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}}]),n}(),t=function(){function n(e,t){_classCallCheck(this,n),this.name=e,this.displayName=t,o[e]=this}return _createClass(n,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"makeMacro",value:function(){return this}},{key:"setup",value:function(){return this}}]),n}(),a=function(){function n(e,t){_classCallCheck(this,n),this.name=e,this.displayName=t,o[e]=this}return _createClass(n,[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}}]),n}();function i(e,t){r.turtleHeaps[e]=t}beforeEach(function(){o={},global._=jest.fn(function(e){return e}),global.ValueBlock=e,global.FlowBlock=t,global.LeftBlock=a,global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",n={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}}},r={inStatusMatrix:!1,turtleHeaps:{},statusFields:[],parseArg:jest.fn(function(e,t,n,r,o){return o})},n.blocks.blockList={10:{connections:[20]},20:{name:"print"}},setupHeapBlocks(n)}),describe("HeapBlock",function(){it("should return JSON string of the turtle heap when not in status matrix",function(){i(0,[1,2,3]);var e=o.heap;r.inStatusMatrix=!1;var t=e.arg(r,0,99);expect(t).toEqual(JSON.stringify([1,2,3]))}),it("should push to statusFields when in status matrix and connected to print",function(){i(0,[4,5]);var e=o.heap;r.inStatusMatrix=!0;var t=e.arg(r,0,10);expect(t).toBeUndefined(),expect(r.statusFields).toContainEqual([10,"heap"])})}),describe("ShowHeapBlock",function(){it("should display the turtle heap as JSON string via activity.textMsg",function(){i(0,[7,8,9]),o.showHeap.flow([],r,0),expect(n.textMsg).toHaveBeenCalledWith(JSON.stringify([7,8,9]))}),it("should create an empty heap if turtle heap is undefined",function(){delete r.turtleHeaps[1],o.showHeap.flow([],r,1),expect(r.turtleHeaps[1]).toEqual([]),expect(n.textMsg).toHaveBeenCalledWith("[]")})}),describe("HeapLengthBlock",function(){it("should return the length of the turtle heap when not in status matrix",function(){i(0,[10,20,30,40]);var e=o.heapLength;r.inStatusMatrix=!1;var t=e.arg(r,0,99);expect(t).toEqual(4)}),it("should push to statusFields when in status matrix and connected to print",function(){i(0,[1]);var e=o.heapLength;r.inStatusMatrix=!0;var t=e.arg(r,0,10);expect(t).toBeUndefined(),expect(r.statusFields).toContainEqual([10,"heapLength"])})}),describe("HeapEmptyBlock",function(){it("should return true if the heap is empty",function(){i(0,[]);var e=o.heapEmpty.arg(r,0);expect(e).toBe(!0)}),it("should return false if the heap is not empty",function(){i(0,[5]);var e=o.heapEmpty.arg(r,0);expect(e).toBe(!1)}),it("should return true if turtle heap is undefined",function(){delete r.turtleHeaps[2];var e=o.heapEmpty.arg(r,2);expect(e).toBe(!0)})}),describe("EmptyHeapBlock",function(){it("should empty the turtle heap",function(){i(0,[1,2,3]),o.emptyHeap.flow([],r,0),expect(r.turtleHeaps[0]).toEqual([])})}),describe("ReverseHeapBlock",function(){it("should reverse the turtle heap",function(){i(0,[1,2,3,4]),o.reverseHeap.flow([],r,0),expect(r.turtleHeaps[0]).toEqual([4,3,2,1])})}),describe("IndexHeapBlock",function(){var t;beforeEach(function(){n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"dummy"},t=o.indexHeap,i(0,[10,20,30])}),it("should call errorMsg if connections[1] is null",function(){n.blocks.blockList[50]={connections:[null,null]},t.arg(r,0,50,2),expect(n.errorMsg).toHaveBeenCalledWith("No input provided",50)}),it("should return the value at the given index when valid",function(){r.parseArg.mockReturnValue(2);var e=t.arg(r,0,50,2);expect(e).toEqual(20)}),it("should treat -1 as the top of the heap",function(){r.parseArg.mockReturnValue(-1);var e=t.arg(r,0,50,-1);expect(e).toEqual(30)}),it("should adjust index < 1 and call errorMsg",function(){r.parseArg.mockReturnValue(0);var e=t.arg(r,0,50,0);expect(n.errorMsg).toHaveBeenCalledWith("Index must be > 0."),expect(e).toEqual(10)}),it("should adjust index > 1000 and call errorMsg",function(){r.parseArg.mockReturnValue(1500),i(0,[]);var e=t.arg(r,0,50,1500);expect(n.errorMsg).toHaveBeenCalledWith("Maximum heap size is 1000."),expect(e).toEqual(0),expect(r.turtleHeaps[0].length).toEqual(1e3)}),it("should call errorMsg and return 0 if parseArg is not a number",function(){r.parseArg.mockReturnValue("not a number");var e=t.arg(r,0,50,"not a number");expect(n.errorMsg).toHaveBeenCalledWith("Not a number",50),expect(e).toEqual(0)})}),describe("SetHeapEntryBlock",function(){var e;beforeEach(function(){e=o.setHeapEntry,i(0,[1,2,3])}),it("should call errorMsg if any argument is null",function(){e.flow([null,99],r,0,60),expect(n.errorMsg).toHaveBeenCalledWith("No input provided",60)}),it("should call errorMsg if arguments are not numbers",function(){e.flow(["a",99],r,0,60),expect(n.errorMsg).toHaveBeenCalledWith("Not a number",60)}),it("should adjust index < 1 and set the value at index 1",function(){e.flow([0,55],r,0,60),expect(n.errorMsg).toHaveBeenCalledWith("Index must be > 0."),expect(r.turtleHeaps[0][0]).toEqual(55)}),it("should adjust index > 1000 and set the value at index 1000",function(){e.flow([1500,77],r,0,60),expect(n.errorMsg).toHaveBeenCalledWith("Maximum heap size is 1000."),expect(r.turtleHeaps[0].length).toEqual(1e3),expect(r.turtleHeaps[0][999]).toEqual(77)}),it("should set the heap entry for valid input",function(){e.flow([2,88],r,0,60),expect(r.turtleHeaps[0][1]).toEqual(88)})}),describe("PopBlock",function(){it("should pop and return the top value from the heap if nonempty",function(){i(0,[100,200,300]);var e=o.pop.arg(r,0);expect(e).toEqual(300),expect(r.turtleHeaps[0]).toEqual([100,200])}),it("should call errorMsg and return 0 if the heap is empty",function(){i(0,[]);var e=o.pop.arg(r,0);expect(n.errorMsg).toHaveBeenCalledWith("empty heap"),expect(e).toEqual(0)})}),describe("PushBlock",function(){it("should push a value onto the heap",function(){i(0,[5]),o.push.flow([42],r,0,70),expect(r.turtleHeaps[0]).toEqual([5,42])}),it("should call errorMsg if the value to push is null",function(){i(0,[5]),o.push.flow([null],r,0,70),expect(n.errorMsg).toHaveBeenCalledWith("No input provided",70)})})});