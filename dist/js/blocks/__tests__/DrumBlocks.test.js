"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(o){var r=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(o);return _possibleConstructorReturn(this,r?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ownKeys(t,e){var o,r=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);var r=o.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../DrumBlocks"),setupDrumBlocks=_require.setupDrumBlocks;global._=jest.fn(function(e){return e}),global.last=jest.fn(function(e){return e[e.length-1]}),global.Singer={DrumActions:{playNoise:jest.fn(),mapPitchToDrum:jest.fn(),setDrum:jest.fn(),GetDrumname:jest.fn(function(e){return e}),playDrum:jest.fn()}},global.FlowBlock=jest.fn().mockImplementation(function(e,t){return{name:e,displayName:t,setPalette:jest.fn().mockReturnThis(),setHelpString:jest.fn().mockReturnThis(),formBlock:jest.fn().mockReturnThis(),makeMacro:jest.fn().mockReturnThis(),setup:jest.fn().mockReturnThis(),beginnerBlock:jest.fn().mockReturnThis(),flow:jest.fn()}}),global.ValueBlock=jest.fn().mockImplementation(function(e,t){return _objectSpread({},new global.FlowBlock(e,t))}),global.FlowClampBlock=jest.fn().mockImplementation(function(e){return _objectSpread({},new global.FlowBlock(e))}),global.DEFAULTDRUM="defaultDrum",global.DEFAULTEFFECT="defaultEffect",global.NOINPUTERRORMSG="No input error message",global.DEFAULTNOISE="defaultNoise",global.mock=jest.fn(function(){return{setupDrumBlocks:jest.fn(function(e){var t=new global.FlowBlock("playnoise","noise");t.setPalette("drum",e),t.setHelpString(),t.formBlock({args:1,defaults:["white noise"],argTypes:["anyin"]}),t.makeMacro();var o=new MapDrumBlock;o.setPalette("drum",e),o.setHelpString(),o.formBlock({name:"map pitch to drum",args:1,argTypes:["anyin"]}),o.makeMacro();var r=new SetDrumBlock;r.setPalette("drum",e),r.beginnerBlock(!0),r.setHelpString(),r.formBlock({name:"set drum",args:1,argTypes:["anyin"]}),r.makeMacro();var n=new PlayEffectBlock;n.setPalette("drum",e),n.beginnerBlock(!0),n.formBlock({args:1,argTypes:["anyin"]}),n.makeMacro();var l=new PlayDrumBlock;l.setPalette("drum",e),l.beginnerBlock(!0),l.setHelpString(),l.formBlock({args:1,argTypes:["anyin"]}),l.makeMacro()})}});var activity={errorMsg:jest.fn(),turtles:{ithTurtle:jest.fn(function(){return{singer:{drumStyle:[],inNoteBlock:[1],noteBeatValues:{1:[]},beatFactor:1,pushedNote:!1}}})},blocks:{blockList:{}},beginnerMode:!1},MapDrumBlock=function e(){_classCallCheck(this,e),this.setPalette=jest.fn().mockReturnThis(),this.setHelpString=jest.fn().mockReturnThis(),this.formBlock=jest.fn().mockReturnThis(),this.makeMacro=jest.fn().mockReturnThis(),this.flow=jest.fn().mockImplementation(function(e,t,o,r){return Singer.DrumActions.mapPitchToDrum(e[0],o,r),[e[1],1]})},SetDrumBlock=function e(){_classCallCheck(this,e),this.setPalette=jest.fn().mockReturnThis(),this.beginnerBlock=jest.fn().mockReturnThis(),this.setHelpString=jest.fn().mockReturnThis(),this.formBlock=jest.fn().mockReturnThis(),this.makeMacro=jest.fn().mockReturnThis(),this.flow=jest.fn().mockImplementation(function(e,t,o,r){return Singer.DrumActions.setDrum(e[0],o,r),[e[1],1]})},PlayEffectBlock=function e(){_classCallCheck(this,e),this.setPalette=jest.fn().mockReturnThis(),this.beginnerBlock=jest.fn().mockReturnThis(),this.formBlock=jest.fn().mockReturnThis(),this.makeMacro=jest.fn().mockReturnThis()},PlayDrumBlock=function e(){_classCallCheck(this,e),this.setPalette=jest.fn().mockReturnThis(),this.beginnerBlock=jest.fn().mockReturnThis(),this.setHelpString=jest.fn().mockReturnThis(),this.formBlock=jest.fn().mockReturnThis(),this.makeMacro=jest.fn().mockReturnThis(),this.flow=jest.fn().mockImplementation(function(e,t,o,r){var n;Singer.DrumActions.GetDrumname(e[0]),t.inPitchDrumMatrix?(t.pitchDrumMatrix.drums.push(e[0]),t.pitchDrumMatrix.addColBlock(r),t.drumBlocks.push(r)):t.inMatrix?(t.phraseMaker.rowLabels.push(e[0]),t.phraseMaker.rowArgs.push(-1),t.phraseMaker.addRowBlock(r),t.drumBlocks.push(r)):t.inMusicKeyboard?(t.musicKeyboard.instruments.push(e[0]),t.musicKeyboard.noteNames.push("drum"),t.musicKeyboard.octaves.push(null),t.musicKeyboard.addRowBlock(r)):(n=activity.turtles.ithTurtle(),Singer.DrumActions.playDrum(e[0],o,r),n.singer.noteBeatValues[1].push(1),n.singer.pushedNote=!0)})};global.MapDrumBlock=MapDrumBlock,global.SetDrumBlock=SetDrumBlock,global.PlayEffectBlock=PlayEffectBlock,global.PlayDrumBlock=PlayDrumBlock,describe("setupDrumBlocks",function(){var a;beforeEach(function(){a={errorMsg:jest.fn(),turtles:{ithTurtle:jest.fn(function(){return{singer:{drumStyle:[],inNoteBlock:[],noteBeatValues:[],beatFactor:1,pushedNote:!1}}})},beginnerMode:!1,blocks:{blockList:{0:{connections:[null]}}}},global.Singer={DrumActions:{playNoise:jest.fn(),mapPitchToDrum:jest.fn(),setDrum:jest.fn(),playDrum:jest.fn(),GetDrumname:jest.fn(function(e){return e})}},global._=jest.fn(function(e){return e}),global.last=jest.fn(function(e){return e[e.length-1]}),global.DEFAULTDRUM="kick",global.DEFAULTEFFECT="clap",global.NOINPUTERRORMSG="No input provided",global.DEFAULTNOISE="white noise",global.logo={inPitchDrumMatrix:!1,inMatrix:!1,inMusicKeyboard:!1,pitchDrumMatrix:{drums:[],addColBlock:jest.fn()},phraseMaker:{rowLabels:[],rowArgs:[],addRowBlock:jest.fn()},musicKeyboard:{instruments:[],noteNames:[],octaves:[],addRowBlock:jest.fn()},drumBlocks:[]}}),it("should setup drum blocks without errors",function(){expect(function(){return setupDrumBlocks(a)}).not.toThrow()}),it("should call errorMsg when flow args are invalid in PlayNoiseBlock",function(){setupDrumBlocks(a),(new(function(){_inherits(l,global.FlowBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){var t=e[0];1===e.length&&null!=t&&"string"==typeof t||a.errorMsg(global.NOINPUTERRORMSG,0)}),e}return l}())).flow([],global.logo,0,0),expect(a.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,0)}),it("should call playNoise when flow args are valid in PlayNoiseBlock",function(){setupDrumBlocks(a),(new(function(){_inherits(l,global.FlowBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){global.Singer.DrumActions.playNoise(e[0],0,0)}),e}return l}())).flow(["white noise"],global.logo,0,0),expect(global.Singer.DrumActions.playNoise).toHaveBeenCalledWith("white noise",0,0)}),it("should map pitch to drum in MapDrumBlock",function(){setupDrumBlocks(a);var e=(new(function(){_inherits(l,global.FlowClampBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){return global.Singer.DrumActions.mapPitchToDrum(e[0],0,0),[void 0,1]}),e}return l}())).flow(["C4"],global.logo,0,0);expect(global.Singer.DrumActions.mapPitchToDrum).toHaveBeenCalledWith("C4",0,0),expect(e).toEqual([void 0,1])}),it("should set drum in SetDrumBlock",function(){setupDrumBlocks(a);var e=(new(function(){_inherits(l,global.FlowClampBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){return global.Singer.DrumActions.setDrum(e[0],0,0),[void 0,1]}),e}return l}())).flow(["kick"],global.logo,0,0);expect(global.Singer.DrumActions.setDrum).toHaveBeenCalledWith("kick",0,0),expect(e).toEqual([void 0,1])}),it("should play drum in PlayDrumBlock",function(){setupDrumBlocks(a),(new(function(){_inherits(l,global.FlowBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){global.Singer.DrumActions.playDrum(e[0],0,0)}),e}return l}())).flow(["snare"],global.logo,0,0),expect(global.Singer.DrumActions.playDrum).toHaveBeenCalledWith("snare",0,0)}),it("should handle context errors in PlayDrumBlock",function(){setupDrumBlocks(a);var e=new(function(){_inherits(l,global.FlowBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){1===e.length&&null!=e[0]||console.debug("PLAY DRUM ERROR: missing context")}),e}return l}());console.debug=jest.fn(),e.flow([null],global.logo,0,0),expect(console.debug).toHaveBeenCalledWith("PLAY DRUM ERROR: missing context")}),it("should push drum to pitchDrumMatrix in PlayDrumBlock",function(){global.logo.inPitchDrumMatrix=!0,setupDrumBlocks(a),(new(function(){_inherits(l,global.FlowBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){var t=e[0];1===e.length&&null!=t&&"string"==typeof t||(a.errorMsg(global.NOINPUTERRORMSG,0),t=global.DEFAULTDRUM);var o=global.Singer.DrumActions.GetDrumname(t),r=a.turtles.ithTurtle(0);0<r.singer.drumStyle.length&&(o=global.last(r.singer.drumStyle)),global.logo.pitchDrumMatrix.drums.push(o),global.logo.pitchDrumMatrix.addColBlock(0)}),e}return l}())).flow(["snare"],global.logo,0,0),expect(global.logo.pitchDrumMatrix.drums).toContain("snare"),expect(global.logo.pitchDrumMatrix.addColBlock).toHaveBeenCalledWith(0)}),it("should push drum to phraseMaker in PlayDrumBlock",function(){global.logo.inMatrix=!0,setupDrumBlocks(a),(new(function(){_inherits(l,global.FlowBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){var t=e[0];1===e.length&&null!=t&&"string"==typeof t||(a.errorMsg(global.NOINPUTERRORMSG,0),t=global.DEFAULTDRUM);var o=global.Singer.DrumActions.GetDrumname(t),r=a.turtles.ithTurtle(0);0<r.singer.drumStyle.length&&(o=global.last(r.singer.drumStyle)),global.logo.phraseMaker.rowLabels.push(o),global.logo.phraseMaker.rowArgs.push(-1),global.logo.phraseMaker.addRowBlock(0)}),e}return l}())).flow(["snare"],global.logo,0,0),expect(global.logo.phraseMaker.rowLabels).toContain("snare"),expect(global.logo.phraseMaker.rowArgs).toContain(-1),expect(global.logo.phraseMaker.addRowBlock).toHaveBeenCalledWith(0)}),it("should push drum to musicKeyboard in PlayDrumBlock",function(){global.logo.inMusicKeyboard=!0,setupDrumBlocks(a),(new(function(){_inherits(l,global.FlowBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){var t=e[0];1===e.length&&null!=t&&"string"==typeof t||(a.errorMsg(global.NOINPUTERRORMSG,0),t=global.DEFAULTDRUM);var o=global.Singer.DrumActions.GetDrumname(t),r=a.turtles.ithTurtle(0);0<r.singer.drumStyle.length&&(o=global.last(r.singer.drumStyle)),global.logo.musicKeyboard.instruments.push(o),global.logo.musicKeyboard.noteNames.push("drum"),global.logo.musicKeyboard.octaves.push(null),global.logo.musicKeyboard.addRowBlock(0)}),e}return l}())).flow(["snare"],global.logo,0,0),expect(global.logo.musicKeyboard.instruments).toContain("snare"),expect(global.logo.musicKeyboard.noteNames).toContain("drum"),expect(global.logo.musicKeyboard.octaves).toContain(null),expect(global.logo.musicKeyboard.addRowBlock).toHaveBeenCalledWith(0)}),it("should play drum in setdrum clamp in PlayDrumBlock",function(){a.turtles.ithTurtle=jest.fn(function(){return{singer:{drumStyle:["snare"],inNoteBlock:[],noteBeatValues:[],beatFactor:1,pushedNote:!1}}}),setupDrumBlocks(a),(new(function(){_inherits(l,global.FlowBlock);var n=_createSuper(l);function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=n.call.apply(n,[this].concat(o))),"flow",function(e){var t=e[0];1===e.length&&null!=t&&"string"==typeof t||(a.errorMsg(global.NOINPUTERRORMSG,0),t=global.DEFAULTDRUM);var o=global.Singer.DrumActions.GetDrumname(t),r=a.turtles.ithTurtle(0);0<r.singer.drumStyle.length&&(o=global.last(r.singer.drumStyle)),global.Singer.DrumActions.playDrum(o,0,0)}),e}return l}())).flow(["snare"],global.logo,0,0),expect(global.Singer.DrumActions.playDrum).toHaveBeenCalledWith("snare",0,0)})});