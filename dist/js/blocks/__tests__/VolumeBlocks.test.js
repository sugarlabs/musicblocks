"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var o=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,o?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../VolumeBlocks"),setupVolumeBlocks=_require.setupVolumeBlocks;describe("setupVolumeBlocks",function(){var r,l,i,s,n=function(){function n(e,t){_classCallCheck(this,n),this.name=e,this.displayName=t,i[e]=this}return _createClass(n,[{key:"setPalette",value:function(e){return this.palette=e,this}},{key:"beginnerBlock",value:function(e){return this.isBeginner=e,this}},{key:"setHelpString",value:function(e){return this.help=e,this}},{key:"formBlock",value:function(e){return this.blockParams=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(){return this}}]),n}(),e=function(){_inherits(t,n);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return t}(),t=function(){_inherits(t,n);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return t}(),o=function(){_inherits(t,n);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return t}();beforeEach(function(){i={},global._=jest.fn(function(e){return e}),global.ValueBlock=n,global.FlowBlock=e,global.FlowClampBlock=t,global.LeftBlock=o,global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.last=function(e){return e[e.length-1]},global.DEFAULTVOLUME=70,global.DEFAULTVOICE="piano",global.DEFAULTDRUM="drum",global.VOICENAMES={piano:["piano","piano"],guitar:["guitar","guitar"]},global.DRUMNAMES={drum:["drum","drum"]},global.Singer={VolumeActions:{getSynthVolume:jest.fn(function(e,t){return 80}),setSynthVolume:jest.fn(function(e,t,n,o){}),setMasterVolume:jest.fn(function(e,t,n){}),setPanning:jest.fn(),doCrescendo:jest.fn(),setRelativeVolume:jest.fn()},masterVolume:[],setSynthVolume:jest.fn(function(e,t,n,o){}),setMasterVolume:jest.fn(function(e,t){})},r={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}},turtles:{turtleObjs:{},ithTurtle:function(e){return this.turtleObjs[e]||(this.turtleObjs[e]={singer:{staccato:[],synthVolume:{},instrumentNames:[],suppressOutput:!1,justCounting:[],crescendoInitialVolume:{}}}),this.turtleObjs[e]}}},l={inStatusMatrix:!1,statusFields:[],stopTurtle:!1,synth:{loadSynth:jest.fn()},setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),notation:{notationBeginSlur:jest.fn(),notationEndSlur:jest.fn()},parseArg:jest.fn(function(e,t,n,o,r){return r})},s=0,setupVolumeBlocks(r)}),describe("SynthVolumeBlock",function(){it("should push status when in status matrix",function(){var e="blkSynthVol1";r.blocks.blockList[e]={connections:[10,20]},r.blocks.blockList[10]={name:"print"},l.inStatusMatrix=!0,i.synthvolumefactor.arg(l,s,e,"piano"),expect(l.statusFields).toContainEqual([e,"synth volume"])}),it("should call getSynthVolume when connection is valid",function(){var e="blkSynthVol2";r.blocks.blockList[e]={connections:[null,30]},r.blocks.blockList[30]={name:"dummy"},l.inStatusMatrix=!1,l.parseArg.mockReturnValue("piano");var t=i.synthvolumefactor.arg(l,s,e,"piano");expect(Singer.VolumeActions.getSynthVolume).toHaveBeenCalledWith("piano",s),expect(t).toEqual(80)}),it("should return 0 when second connection is null",function(){var e="blkSynthVol3";r.blocks.blockList[e]={connections:[null,null]},l.inStatusMatrix=!1;var t=i.synthvolumefactor.arg(l,s,e,"piano");expect(t).toEqual(0)}),it("updateParameter should return block value",function(){var e="blkSynthVol4";r.blocks.blockList[e]={value:"testValue"};var t=i.synthvolumefactor.updateParameter(l,s,e);expect(t).toEqual("testValue")})}),describe("MasterVolumeBlock",function(){it("should push status when in status matrix",function(){var e="blkMasterVol1";r.blocks.blockList[e]={connections:[15]},r.blocks.blockList[15]={name:"print"},l.inStatusMatrix=!0,i.notevolumefactor.arg(l,s,e),expect(l.statusFields).toContainEqual([e,"volume"])}),it("should return master volume when not in status matrix",function(){l.inStatusMatrix=!1,Singer.VolumeActions.masterVolume=85;var e=i.notevolumefactor.arg(l,s,"blkMasterVol2");expect(e).toEqual(85)}),it("updateParameter should return block value",function(){var e="blkMasterVol3";r.blocks.blockList[e]={value:95};var t=i.notevolumefactor.updateParameter(l,s,e);expect(t).toEqual(95)})}),describe("SetSynthVolume2Block",function(){it("should return undefined if third argument is undefined",function(){var e=i.setsynthvolume2.flow(["piano",80],l,s,"blkSSV2");expect(e).toBeUndefined()}),it("should process valid synth volume and register a listener",function(){var e="blkSSV2",t=i.setsynthvolume2,n=r.turtles.ithTurtle(s);n.singer.instrumentNames=[],n.singer.synthVolume={},n.singer.crescendoInitialVolume={},l.synth.loadSynth=jest.fn();var o=t.flow(["piano",90,100],l,s,e);expect(l.synth.loadSynth).toHaveBeenCalledWith(s,"piano"),expect(n.singer.instrumentNames).toContain("piano"),expect(l.setDispatchBlock).toHaveBeenCalledWith(e,s,expect.stringMatching(/^_synthvolume_/)),expect(l.setTurtleListener).toHaveBeenCalled(),expect(o).toEqual([100,1])})}),describe("SetSynthVolumeBlock",function(){it("should call setSynthVolume after validating arguments",function(){i.setsynthvolume.flow(["piano",95],l,s,"blkSSV"),expect(Singer.VolumeActions.setSynthVolume).toHaveBeenCalledWith("piano",95,s,"blkSSV")})}),describe("SetPanBlock",function(){it("should call errorMsg if argument is not a number",function(){i.setpanning.flow(["not a number"],l,s,"blkPan"),expect(r.errorMsg).toHaveBeenCalledWith(NANERRORMSG,"blkPan")}),it("should warn when panning is extreme and call setPanning",function(){i.setpanning.flow([100],l,s,"blkPan2"),expect(r.errorMsg).toHaveBeenCalledWith("Warning: Sound is coming out from only the left or right side.","blkPan2"),expect(Singer.VolumeActions.setPanning).toHaveBeenCalledWith(100,s)})}),describe("SetNoteVolumeBlock",function(){it("should call errorMsg if argument is not a number",function(){i.setnotevolume.flow(["NaN"],l,s,"blkNoteVol"),expect(r.errorMsg).toHaveBeenCalledWith(NANERRORMSG,"blkNoteVol")}),it("should call setMasterVolume with a valid number",function(){i.setnotevolume.flow([75],l,s,"blkNoteVol2"),expect(Singer.VolumeActions.setMasterVolume).toHaveBeenCalledWith(75,s,"blkNoteVol2")})}),describe("SetNoteVolume2Block",function(){it("should return undefined if second argument is undefined",function(){var e=i.setnotevolume2.flow([50],l,s,"blkNoteVol2");expect(e).toBeUndefined()}),it("should process master volume change and register a listener",function(){var e="blkNoteVol22",t=i.setnotevolume2;Singer.masterVolume=[],r.turtles.ithTurtle(s).singer.suppressOutput=!1;var n=t.flow([60,100],l,s,e);expect(Singer.masterVolume).toContain(60),expect(l.setDispatchBlock).toHaveBeenCalledWith(e,s,expect.stringMatching(/^_volume_/)),expect(l.setTurtleListener).toHaveBeenCalled(),expect(n).toEqual([100,1])})}),describe("ArticulationBlock",function(){it("should return undefined if second argument is undefined",function(){var e=i.articulation.flow([30],l,s,"blkArt");expect(e).toBeUndefined()}),it("should call setRelativeVolume and return an array",function(){var e=i.articulation.flow([25,50],l,s,"blkArt2");expect(Singer.VolumeActions.setRelativeVolume).toHaveBeenCalledWith(25,s,"blkArt2"),expect(e).toEqual([50,1])})}),describe("DecrescendoBlock",function(){it("should call doCrescendo and return expected array when value is nonzero",function(){var e=i.decrescendo;r.blocks.blockList.blkDec={name:"decrescendo"};var t=e.flow([5,99],l,s,"blkDec");expect(Singer.VolumeActions.doCrescendo).toHaveBeenCalledWith("decrescendo",5,s,"blkDec"),expect(t).toEqual([99,1])})}),describe("CrescendoBlock",function(){it("should behave like decrescendo with block name 'crescendo'",function(){var e=i.crescendo;r.blocks.blockList.blkCres={name:"crescendo"};var t=e.flow([5,88],l,s,"blkCres");expect(Singer.VolumeActions.doCrescendo).toHaveBeenCalledWith("crescendo",5,s,"blkCres"),expect(t).toEqual([88,1])})})});