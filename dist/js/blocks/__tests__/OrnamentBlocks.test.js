"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(r){var o=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(r);return _possibleConstructorReturn(this,o?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);var o=r.call(t,e||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../OrnamentBlocks"),setupOrnamentBlocks=_require.setupOrnamentBlocks;describe("setupOrnamentBlocks",function(){var o,n,i,r=function(){function r(t,e){_classCallCheck(this,r),this.name=t,this.displayName=e,i[t]=this}return _createClass(r,[{key:"setPalette",value:function(t){return this.palette=t,this}},{key:"beginnerBlock",value:function(t){return this.isBeginner=t,this}},{key:"setHelpString",value:function(t){return this.help=t,this}},{key:"formBlock",value:function(t){return this.blockParams=t,this}},{key:"makeMacro",value:function(t){return this.macro=t,this}},{key:"setup",value:function(){return this}}]),r}(),t=function(){_inherits(e,r);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return e}();beforeEach(function(){i={},global._=jest.fn(function(t){return t}),global.ValueBlock=r,global.FlowClampBlock=t,global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.last=function(t){return t[t.length-1]},global.Singer={OrnamentActions:{doNeighbor:jest.fn(),setSlur:jest.fn(),setStaccato:jest.fn()},noteCounter:jest.fn(function(t,e,r){return r})},o={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}},turtles:{turtleObjs:{},ithTurtle:function(t){return this.turtleObjs[t]||(this.turtleObjs[t]={singer:{staccato:[],glide:[],justCounting:[]}}),this.turtleObjs[t]}}},n={inStatusMatrix:!1,statusFields:[],stopTurtle:!1,setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),notation:{notationBeginSlur:jest.fn(),notationEndSlur:jest.fn()}},setupOrnamentBlocks(o)}),describe("StaccatoFactorBlock",function(){it('should push "staccato" status when in status matrix',function(){var t="blkSF1";o.blocks.blockList[t]={connections:[10]},o.blocks.blockList[10]={name:"print"},n.inStatusMatrix=!0,i.staccatofactor.arg(n,0,t),expect(n.statusFields).toContainEqual([t,"staccato"])}),it("should return the last staccato factor if available",function(){n.inStatusMatrix=!1,o.turtles.ithTurtle(0).singer.staccato=[5,10,15];var t=i.staccatofactor.arg(n,0,"blkSF2");expect(t).toEqual(15)}),it("should return 0 if no staccato factors exist",function(){n.inStatusMatrix=!1,o.turtles.ithTurtle(0).singer.staccato=[];var t=i.staccatofactor.arg(n,0,"blkSF3");expect(t).toEqual(0)}),it("updateParameter should return the block value from activity",function(){o.blocks.blockList.blkSF4={value:42};var t=i.staccatofactor.updateParameter(n,0,"blkSF4");expect(t).toEqual(42)})}),describe("SlurFactorBlock",function(){it('should push "slur" status when in status matrix',function(){var t="blkSLF1";o.blocks.blockList[t]={connections:[20]},o.blocks.blockList[20]={name:"print"},n.inStatusMatrix=!0,i.slurfactor.arg(n,0,t),expect(n.statusFields).toContainEqual([t,"slur"])}),it("should return negative of the last staccato factor if available",function(){n.inStatusMatrix=!1,o.turtles.ithTurtle(0).singer.staccato=[3,6,9];var t=i.slurfactor.arg(n,0,"blkSLF2");expect(t).toEqual(-9)}),it("should return 0 if no staccato factors exist",function(){n.inStatusMatrix=!1,o.turtles.ithTurtle(0).singer.staccato=[];var t=i.slurfactor.arg(n,0,"blkSLF3");expect(t).toEqual(0)}),it("updateParameter should return the block value from activity",function(){var t="blkSLF4";o.blocks.blockList[t]={value:55};var e=i.slurfactor.updateParameter(n,0,t);expect(e).toEqual(55)})}),describe("NeighborBlock",function(){it("should call doNeighbor and return expected array",function(){var t=i.neighbor.flow([2,.5,99],n,0,"blkNeighbor");expect(Singer.OrnamentActions.doNeighbor).toHaveBeenCalledWith(2,.5,0,"blkNeighbor"),expect(t).toEqual([99,1])}),it("should call errorMsg if arguments are not numbers",function(){i.neighbor.flow(["a",.5,99],n,0,"blkNeighbor"),expect(o.errorMsg).toHaveBeenCalledWith(NANERRORMSG,"blkNeighbor"),expect(n.stopTurtle).toBe(!0)})}),describe("Neighbor2Block",function(){it("should inherit flow behavior from NeighborBlock",function(){var t=i.neighbor2.flow([3,.25,88],n,0,"blkNeighbor2");expect(Singer.OrnamentActions.doNeighbor).toHaveBeenCalledWith(3,.25,0,"blkNeighbor2"),expect(t).toEqual([88,1])})}),describe("GlideBlock",function(){it("should return undefined if second argument is undefined",function(){var t=i.glide.flow([1/16],n,0,"blkGlide");expect(t).toBeUndefined()}),it("should process glide correctly with valid arguments",function(){var t=i.glide,e=o.turtles.ithTurtle(0);e.singer.glide=[];var r=t.flow([.1,8],n,0,"blkGlide");expect(e.singer.glide).toContain(.1),expect(Singer.noteCounter).toHaveBeenCalledWith(n,0,8),expect(n.notation.notationBeginSlur).toHaveBeenCalledWith(0),expect(n.setDispatchBlock).toHaveBeenCalledWith("blkGlide",0,expect.stringMatching(/^_glide_/)),expect(n.setTurtleListener).toHaveBeenCalled(),expect(r).toEqual([8,1])}),it("should default glide argument and call errorMsg if first argument is invalid",function(){var t=i.glide.flow([null,8],n,0,"blkGlide");expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,"blkGlide"),expect(t).toEqual([8,1])})}),describe("SlurBlock",function(){it("should return undefined if second argument is undefined",function(){var t=i.slur.flow([1/16],n,0,"blkSlur");expect(t).toBeUndefined()}),it("should call setSlur with correct arguments",function(){i.slur.flow([.2,7],n,0,"blkSlur"),expect(Singer.OrnamentActions.setSlur).toHaveBeenCalledWith(.2,0,"blkSlur")}),it("should default slur argument and call errorMsg if first argument is invalid",function(){i.slur.flow([null,7],n,0,"blkSlur"),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,"blkSlur")})}),describe("StaccatoBlock",function(){it("should return undefined if second argument is undefined",function(){var t=i.staccato.flow([1/32],n,0,"blkStaccato");expect(t).toBeUndefined()}),it("should call setStaccato with correct arguments",function(){i.staccato.flow([.05,5],n,0,"blkStaccato"),expect(Singer.OrnamentActions.setStaccato).toHaveBeenCalledWith(.05,0,"blkStaccato")}),it("should default staccato argument and call errorMsg if first argument is invalid",function(){i.staccato.flow([null,5],n,0,"blkStaccato"),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,"blkStaccato")})}),describe("NewSlurBlock",function(){it("should not be hidden and behave like SlurBlock",function(){var t=i.newslur;expect(t.hidden).toBe(!1),t.flow([.15,10],n,0,"blkNewSlur"),expect(Singer.OrnamentActions.setSlur).toHaveBeenCalledWith(.15,0,"blkNewSlur")})}),describe("NewStaccatoBlock",function(){it("should not be hidden and behave like StaccatoBlock",function(){var t=i.newstaccato;expect(t.hidden).toBe(!1),t.flow([.08,12],n,0,"blkNewStaccato"),expect(Singer.OrnamentActions.setStaccato).toHaveBeenCalledWith(.08,0,"blkNewStaccato")})})});