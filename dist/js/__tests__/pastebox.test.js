"use strict";var PasteBox=require("../pastebox");describe("PasteBox",function(){var e=global.Image,t=global.window,n=global.createjs,a=global.docById,o=global.base64Encode;afterAll(function(){global.Image=e,global.window=t,global.createjs=n,global.docById=a,global.base64Encode=o}),describe("constructor / hide / show / getPos",function(){var e,t,n;beforeEach(function(){t={stage:{addChild:jest.fn()},refreshCanvas:jest.fn(),pasted:jest.fn()},n=jest.fn(),global.docById=n,global.base64Encode=jest.fn(function(e){return e}),global.window={btoa:jest.fn(function(e){return e})},e=new PasteBox(t)}),it("should initialize with the correct default values",function(){expect(e.activity).toBe(t),expect(e._container).toBeNull(),expect(e.save).toBeNull(),expect(e.close).toBeNull(),expect(e._scale).toBe(1)}),it("should hide the container and clear the paste element",function(){e._container={visible:!0},n.mockReturnValue({value:"foo",style:{visibility:"visible"}}),e.hide(),expect(e._container.visible).toBe(!1),expect(t.refreshCanvas).toHaveBeenCalled(),expect(n).toHaveBeenCalledWith("paste"),expect(n("paste").value).toBe(""),expect(n("paste").style.visibility).toBe("hidden")}),it("should make the container visible and show the paste element",function(){e._container={visible:!1},n.mockReturnValue({style:{visibility:"hidden"}}),e.show(),expect(e._container.visible).toBe(!0),expect(t.refreshCanvas).toHaveBeenCalled(),expect(n).toHaveBeenCalledWith("paste"),expect(n("paste").style.visibility).toBe("visible")}),it("should return the position of the container",function(){e._container={x:12,y:34},expect(e.getPos()).toEqual([12,34])})}),describe("createBox()",function(){var a,o;beforeEach(function(){o={stage:{addChild:jest.fn()},refreshCanvas:jest.fn(),pasted:jest.fn()},global.base64Encode=jest.fn(function(e){return e}),global.window={btoa:jest.fn(function(e){return e})},a=new PasteBox(o)}),it("should create a container and add it to the stage",function(){var e={addChild:jest.fn(),x:0,y:0,visible:!1};global.createjs={Container:jest.fn(function(){return e}),Bitmap:jest.fn(),Shape:jest.fn()},jest.spyOn(a,"_makeBoxBitmap"),a.createBox(2,10,20),expect(a._scale).toBe(2),expect(global.createjs.Container).toHaveBeenCalled(),expect(o.stage.addChild).toHaveBeenCalledWith(e),expect(e.x).toBe(10),expect(e.y).toBe(20),expect(a._makeBoxBitmap).toHaveBeenCalledWith(expect.any(String),"box",expect.any(Function),null)}),it("should create a bitmap from SVG data and call the callback",function(){var e={addChild:jest.fn(),x:0,y:0,visible:!1,getBounds:jest.fn(function(){return{x:0,y:0,width:300,height:55}}),on:jest.fn(),hitArea:null},t={type:"BITMAP"};global.createjs={Container:jest.fn(function(){return e}),Bitmap:jest.fn(function(){return t}),Shape:jest.fn(function(){return{graphics:{beginFill:jest.fn().mockReturnThis(),drawRect:jest.fn().mockReturnThis()}}})};var n={onload:null,src:""};global.Image=jest.fn(function(){return n}),(a=new PasteBox(o)).createBox(1,0,0),expect(n.onload).toBeInstanceOf(Function),n.onload(),expect(e.addChild).toHaveBeenCalledWith(t),expect(e.visible).toBe(!0),expect(o.refreshCanvas).toHaveBeenCalled()})}),describe("_loadClearContainerHandler click‚Äêhandler",function(){var e,t,n;beforeEach(function(){t={pasted:jest.fn(),refreshCanvas:jest.fn()},global.docById=jest.fn().mockReturnValue({value:"",style:{visibility:"visible"}}),global.createjs={Shape:jest.fn(function(){return{graphics:{beginFill:jest.fn().mockReturnThis(),drawRect:jest.fn().mockReturnThis()}}})},(e=new PasteBox(t))._scale=1,e._container={getBounds:jest.fn(function(){return{x:0,y:0,width:300,height:55}}),on:jest.fn(function(e,t){n=t}),hitArea:null,x:200,y:0,visible:!0},e._loadClearContainerHandler()}),it("should set up the click handler for the container",function(){expect(e._container.on).toHaveBeenCalledWith("click",expect.any(Function))}),it("calls pasted() + hide() when clicking in paste area",function(){n({stageX:410,stageY:25}),expect(t.pasted).toHaveBeenCalled(),expect(e._container.visible).toBe(!1),expect(t.refreshCanvas).toHaveBeenCalled(),expect(global.docById).toHaveBeenCalledWith("paste")}),it("only calls hide() when clicking in close area",function(){n({stageX:460,stageY:10}),expect(t.pasted).not.toHaveBeenCalled(),expect(e._container.visible).toBe(!1),expect(t.refreshCanvas).toHaveBeenCalled(),expect(global.docById).toHaveBeenCalledWith("paste")}),it("does nothing when clicking outside both areas",function(){n({stageX:300,stageY:60}),expect(t.pasted).not.toHaveBeenCalled(),expect(t.refreshCanvas).not.toHaveBeenCalled(),expect(e._container.visible).toBe(!0)}),it("debounces rapid clicks in paste area",function(){jest.useFakeTimers(),n({stageX:410,stageY:25}),n({stageX:410,stageY:25}),jest.advanceTimersByTime(500),n({stageX:410,stageY:25}),expect(t.pasted).toHaveBeenCalledTimes(2),jest.useRealTimers()})})});