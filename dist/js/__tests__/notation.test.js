"use strict";var Notation=require("../notation"),_require=require("../utils/musicutils"),durationToNoteValue=_require.durationToNoteValue,convertFactor=_require.convertFactor,getDrumSymbol=_require.getDrumSymbol;global.convertFactor=convertFactor,global.durationToNoteValue=durationToNoteValue,global.getDrumSymbol=getDrumSymbol,global._=require("lodash"),global.last=function(t){return t[t.length-1]},global.toFixed2=function(t){return parseFloat(t.toFixed(2))},global.rationalToFraction=jest.fn().mockReturnValue([1,2]),jest.mock("../utils/musicutils.js",function(){return{durationToNoteValue:jest.fn().mockReturnValue([1,1,1,1]),convertFactor:jest.fn().mockReturnValue(4),getDrumSymbol:jest.fn().mockReturnValue("drums")}}),describe("Notation Class",function(){var o;beforeEach(function(){var t={turtles:{ithTurtle:jest.fn().mockReturnValue({singer:{staccato:[]}})},logo:{updateNotation:jest.fn()}};(o=new Notation(t))._notationStaging=[[]],o._notationStaging.turtle1=[],o._notationDrumStaging={},o._notationDrumStaging.turtle1=[],o._markup={},o._markup.turtle1=[],o._pickupPOW2={},o._pickupPOW2.turtle1=!1,o._pickupPoint={},o._pickupPoint.turtle1=null}),describe("Setters and Getters",function(){it("should correctly set and get notationStaging",function(){var t={turtle1:["note1","note2"]};o.notationStaging=t,expect(o.notationStaging).toEqual(t)}),it("should correctly set and get notationDrumStaging",function(){var t={turtle1:["drum1","drum2"]};o.notationDrumStaging=t,expect(o.notationDrumStaging).toEqual(t)}),it("should correctly set and get notationMarkup",function(){var t={turtle1:["markup1","markup2"]};o.notationMarkup=t,expect(o.notationMarkup).toEqual(t)}),it("should correctly return pickupPOW2 and pickupPoint",function(){expect(o.pickupPOW2).toEqual({turtle1:!1}),expect(o.pickupPoint).toEqual({turtle1:null})})}),describe("Notation Utility Methods",function(){it("should update notation correctly with doUpdateNotation",function(){var t="turtle1";o.doUpdateNotation("C4",4,t,!1,[]),expect(o._notationStaging[t]).toContainEqual(expect.arrayContaining(["C4",expect.any(Number),expect.any(Number)]))}),it("should update notation with drum correctly",function(){var t="turtle1";o.doUpdateNotation("C4",4,t,!1,["kick"]),expect(o._notationDrumStaging[t]).toContainEqual(expect.arrayContaining([["drums"],expect.any(Number),expect.any(Number)]))}),it("should update notation with noise correctly",function(){var t="turtle1";o.doUpdateNotation("C4",4,t,!1,["noise1"]),expect(o._notationDrumStaging[t].length).toBe(0)}),it("should handle object notes with markup",function(){var t={0:"C4",1:"D4"},n="turtle1";o._markup={turtle1:["articulation","staccato"]},o.doUpdateNotation(t,4,n,!1,[]),expect(o._notationStaging[n]).toContainEqual(expect.arrayContaining([t,expect.any(Number),expect.any(Number)]))}),it("should add notation markup using _notationMarkup",function(){var t="turtle1";o._notationMarkup(t,"staccato",!0),expect(o._notationStaging[t]).toEqual(["markdown","staccato"])}),it("should add notation markup above using _notationMarkup",function(){var t="turtle1";o._notationMarkup(t,"staccato",!1),expect(o._notationStaging[t]).toEqual(["markup","staccato"])}),it("should add a pickup using notationPickup",function(){var t="turtle1";o.notationPickup(t,2),expect(convertFactor).toHaveBeenCalledWith(2),expect(o._notationStaging[t]).toEqual(["pickup",4])}),it("should add a voice using notationVoices",function(){var t="turtle1";o.notationVoices(t,2),expect(o._notationStaging[t]).toContain("voice two")}),it("should handle different voice numbers correctly",function(){var t="turtle1";o.notationVoices(t,1),expect(o._notationStaging[t]).toContain("voice one"),o._notationStaging[t]=[],o.notationVoices(t,3),expect(o._notationStaging[t]).toContain("voice three"),o._notationStaging[t]=[],o.notationVoices(t,4),expect(o._notationStaging[t]).toContain("voice four"),o._notationStaging[t]=[],o.notationVoices(t,5),expect(o._notationStaging[t]).toContain("one voice"),o._notationStaging[t]=[],o.notationVoices(t,6),expect(o._notationStaging[t]).toContain("one voice")}),it("should set key using notationKey",function(){var t="turtle1",n="major";o.notationKey(t,"C",n),expect(o._notationStaging[t]).toEqual(["key","C",n])}),it("should set meter using notationMeter",function(){var t="turtle1";o.notationMeter(t,4,4),expect(o._notationStaging[t]).toEqual(["meter",4,4])}),it("should handle notationSwing",function(){var t="turtle1";o.notationSwing(t),expect(o._notationStaging[t]).toContain("swing")}),it("should handle notationTempo",function(){var t="turtle1";o.notationTempo(t,120,4),expect(o._notationStaging[t]).toEqual(["tempo",120,4])})}),describe("Line Breaks and Harmonics",function(){it("should add line break notation",function(){var t="turtle1";o.notationLineBreak(t),expect(o._pickupPoint[t]).toBeNull()}),it("should add harmonics notation",function(){var t="turtle1";o.__notationHarmonic(t),expect(o._pickupPoint[t]).toBeNull()}),it("should begin harmonics",function(){var t="turtle1";o.notationBeginHarmonics(t),expect(o._notationStaging[t]).toEqual(["begin harmonics"])}),it("should end harmonics",function(){var t="turtle1";o.notationEndHarmonics(t),expect(o._notationStaging[t]).toEqual(["end harmonics"])})}),describe("Articulation Controls",function(){it("should begin articulation",function(){var t="turtle1";o.notationBeginArticulation(t),expect(o._notationStaging[t]).toEqual(["begin articulation"])}),it("should end articulation",function(){var t="turtle1";o.notationEndArticulation(t),expect(o._notationStaging[t]).toEqual(["end articulation"])}),it("should begin crescendo",function(){var t="turtle1";o.notationBeginCrescendo(t,2),expect(o._notationStaging[t]).toEqual(["begin crescendo"])}),it("should begin decrescendo",function(){var t="turtle1";o.notationBeginCrescendo(t,-2),expect(o._notationStaging[t]).toEqual(["begin decrescendo"])}),it("should end crescendo",function(){var t="turtle1";o.notationEndCrescendo(t,2),expect(o._notationStaging[t]).toEqual(["end crescendo"])}),it("should end decrescendo",function(){var t="turtle1";o.notationEndCrescendo(t,-2),expect(o._notationStaging[t]).toEqual(["end decrescendo"])})}),describe("Slur and Tie Controls",function(){it("should begin slur",function(){var t="turtle1";o.notationBeginSlur(t),expect(o._notationStaging[t]).toEqual(["begin slur"])}),it("should end slur",function(){var t="turtle1";o.notationEndSlur(t),expect(o._notationStaging[t]).toEqual(["end slur"])}),it("should insert tie",function(){var t="turtle1";o.notationInsertTie(t),expect(o._notationStaging[t]).toEqual(["tie"])}),it("should remove tie",function(){var t="turtle1";o._notationStaging[t].push("some element");var n=o._notationStaging[t].length;o.notationRemoveTie(t),expect(o._notationStaging[t].length).toBe(n-1),expect(o._pickupPoint[t]).toBeNull()})}),describe("Static Methods",function(){it("should handle notation markup via static method",function(){var t=Notation._markup;Notation._markup={turtle1:[]},Notation.notationMarkup("turtle1","staccato"),expect(Notation._markup.turtle1).toContain("staccato"),Notation._markup=t})}),describe("Edge Cases",function(){it("should handle empty or invalid input for notationPickup",function(){var t="turtle1";o.notationPickup(t,0),expect(o._notationStaging[t].length).toBe(0)})})});