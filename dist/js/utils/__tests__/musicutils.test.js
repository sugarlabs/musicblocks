"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var o,n=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);var n=o.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("util"),TextEncoder=_require.TextEncoder;global.TextEncoder=TextEncoder,global._=jest.fn(function(e){return e}),global.window={btoa:jest.fn(function(e){return Buffer.from(e,"utf8").toString("base64")})};var _require2=require("../musicutils"),scaleDegreeToPitchMapping=_require2.scaleDegreeToPitchMapping,buildScale=_require2.buildScale,getNote=_require2.getNote,getModeLength=_require2.getModeLength,nthDegreeToPitch=_require2.nthDegreeToPitch,getInterval=_require2.getInterval,_calculate_pitch_number=_require2._calculate_pitch_number,_getStepSize=_require2._getStepSize,reducedFraction=_require2.reducedFraction,toFraction=_require2.toFraction,durationToNoteValue=_require2.durationToNoteValue,calcNoteValueToDisplay=_require2.calcNoteValueToDisplay,noteToPitchOctave=_require2.noteToPitchOctave,pitchToFrequency=_require2.pitchToFrequency,noteIsSolfege=_require2.noteIsSolfege,getSolfege=_require2.getSolfege,splitSolfege=_require2.splitSolfege,i18nSolfege=_require2.i18nSolfege,splitScaleDegree=_require2.splitScaleDegree,getNumNote=_require2.getNumNote,calcOctave=_require2.calcOctave,calcOctaveInterval=_require2.calcOctaveInterval,isInt=_require2.isInt,convertFromSolfege=_require2.convertFromSolfege,convertFactor=_require2.convertFactor,getPitchInfo=_require2.getPitchInfo,noteToFrequency=_require2.noteToFrequency,setOctaveRatio=_require2.setOctaveRatio,getOctaveRatio=_require2.getOctaveRatio,TEMPERAMENT=_require2.TEMPERAMENT,getTemperamentsList=_require2.getTemperamentsList,getTemperament=_require2.getTemperament,getTemperamentKeys=_require2.getTemperamentKeys,addTemperamentToList=_require2.addTemperamentToList,addTemperamentToDictionary=_require2.addTemperamentToDictionary,updateTemperaments=_require2.updateTemperaments,deleteTemperamentFromList=_require2.deleteTemperamentFromList,DEFAULTINVERT=_require2.DEFAULTINVERT,DEFAULTMODE=_require2.DEFAULTMODE,customMode=_require2.customMode,getInvertMode=_require2.getInvertMode,getIntervalNumber=_require2.getIntervalNumber,getIntervalDirection=_require2.getIntervalDirection,getIntervalRatio=_require2.getIntervalRatio,getModeNumbers=_require2.getModeNumbers,getDrumIndex=_require2.getDrumIndex,getDrumName=_require2.getDrumName,getDrumSymbol=_require2.getDrumSymbol,getFilterTypes=_require2.getFilterTypes,getOscillatorTypes=_require2.getOscillatorTypes,getDrumIcon=_require2.getDrumIcon,getDrumSynthName=_require2.getDrumSynthName,getNoiseName=_require2.getNoiseName,getNoiseIcon=_require2.getNoiseIcon,getNoiseSynthName=_require2.getNoiseSynthName,getVoiceName=_require2.getVoiceName,getVoiceIcon=_require2.getVoiceIcon,getVoiceSynthName=_require2.getVoiceSynthName,isCustomTemperament=_require2.isCustomTemperament,getTemperamentName=_require2.getTemperamentName,noteToObj=_require2.noteToObj,frequencyToPitch=_require2.frequencyToPitch,getArticulation=_require2.getArticulation,keySignatureToMode=_require2.keySignatureToMode,getScaleAndHalfSteps=_require2.getScaleAndHalfSteps,modeMapper=_require2.modeMapper,getSharpFlatPreference=_require2.getSharpFlatPreference,getCustomNote=_require2.getCustomNote,pitchToNumber=_require2.pitchToNumber,numberToPitchSharp=_require2.numberToPitchSharp,getNumber=_require2.getNumber,getNoteFromInterval=_require2.getNoteFromInterval,numberToPitch=_require2.numberToPitch,GetNotesForInterval=_require2.GetNotesForInterval,base64Encode=_require2.base64Encode;describe("musicutils",function(){it("should set and get Octave Ratio",function(){setOctaveRatio(4);var e=getOctaveRatio();expect(e).toBe(4)})}),describe("Temperament Functions",function(){global.TEMPERAMENTS=[[_("Equal (12EDO)"),"equal","equal"],[_("Equal (5EDO)"),"equal5","equal5"],[_("Equal (7EDO)"),"equal7","equal7"],[_("Equal (19EDO)"),"equal19","equal19"],[_("Equal (31EDO)"),"equal31","equal31"],[_("5-limit Just Intonation"),"just intonation","just intonation"],[_("Pythagorean (3-limit JI)"),"Pythagorean","Pythagorean"],[_("Meantone")+" (1/3)","1/3 comma meantone","meantone (1/3)"],[_("Meantone")+" (1/4)","1/4 comma meantone","meantone (1/4)"],[_("custom"),"custom","custom"]],global.INITIALTEMPERAMENTS=[[_("Equal (12EDO)"),"equal","equal"],[_("Equal (5EDO)"),"equal5","equal5"],[_("Equal (7EDO)"),"equal7","equal7"],[_("Equal (19EDO)"),"equal19","equal19"],[_("Equal (31EDO)"),"equal31","equal31"],[_("5-limit Just Intonation"),"just intonation","just intonation"],[_("Pythagorean (3-limit JI)"),"Pythagorean","Pythagorean"],[_("Meantone")+" (1/3)","1/3 comma meantone","meantone (1/3)"],[_("Meantone")+" (1/4)","1/4 comma meantone","meantone (1/4)"]],global.PreDefinedTemperaments={equal:!0,equal5:!0,equal7:!0,equal19:!0,equal31:!0,"just intonation":!0,Pythagorean:!0,"1/3 comma meantone":!0,"1/4 comma meantone":!0},it("getTemperamentsList should return the list of temperaments",function(){expect(getTemperamentsList()).toEqual([[_("Equal (12EDO)"),"equal","equal"],[_("Equal (5EDO)"),"equal5","equal5"],[_("Equal (7EDO)"),"equal7","equal7"],[_("Equal (19EDO)"),"equal19","equal19"],[_("Equal (31EDO)"),"equal31","equal31"],[_("5-limit Just Intonation"),"just intonation","just intonation"],[_("Pythagorean (3-limit JI)"),"Pythagorean","Pythagorean"],[_("Meantone")+" (1/3)","1/3 comma meantone","meantone (1/3)"],[_("Meantone")+" (1/4)","1/4 comma meantone","meantone (1/4)"],[_("custom"),"custom","custom"]])}),describe("getTemperament",function(){it("should return the correct temperament for a valid key",function(){var e=getTemperament("equal");expect(e).toHaveProperty("perfect 1"),expect(e).toHaveProperty("minor 2"),expect(e).toHaveProperty("pitchNumber",12)}),it("should return the correct temperament for equal5 key",function(){var e=getTemperament("equal5");expect(e).toHaveProperty("perfect 1"),expect(e).toHaveProperty("minor 2"),expect(e).toHaveProperty("pitchNumber",5)}),it("should return undefined for an invalid key",function(){var e=getTemperament("invalid");expect(e).toBeUndefined()})}),describe("getTemperamentKeys",function(){it("should return an array with the correct length",function(){var e=getTemperamentKeys();expect(e.length).toBe(10)}),it("should return an array containing all keys",function(){var e=getTemperamentKeys();expect(e).toEqual(expect.arrayContaining(["equal","equal5","equal7","equal19","equal31","just intonation","Pythagorean","1/3 comma meantone","1/4 comma meantone","custom"]))})}),describe("addTemperamentToList",function(){it("adds a new entry to TEMPERAMENTS if not predefined",function(){var e=["custom","custom","custom"];addTemperamentToList(e),expect(TEMPERAMENTS).toContainEqual(e)}),it("does not add a duplicate entry if already present",function(){addTemperamentToList(["Equal (12EDO)","equal","equal"]),expect(TEMPERAMENTS.filter(function(e){return"equal"===e[1]}).length).toBe(1)})}),describe("addTemperamentToDictionary",function(){it("add the new entry to temparment",function(){addTemperamentToDictionary("music","blocks"),expect(TEMPERAMENT.music).toBe("blocks")})}),describe("deleteTemperamentFromList",function(){it("removes an entry from TEMPERAMENT by key",function(){TEMPERAMENT.custom=!0,deleteTemperamentFromList("custom"),expect(TEMPERAMENT.custom).toBeUndefined()}),it("does nothing if the key does not exist",function(){deleteTemperamentFromList("doesn't exist"),expect(TEMPERAMENT["doesn't exist"]).toBeUndefined()})}),describe("updateTemperaments",function(){it("should reset TEMPERAMENTS to INITIALTEMPERAMENTS",function(){updateTemperaments(),INITIALTEMPERAMENTS.forEach(function(e){expect(TEMPERAMENTS).toContainEqual(e)})})})}),describe("Constants",function(){it("should have correct default values",function(){expect(DEFAULTINVERT).toBe("even"),expect(DEFAULTMODE).toBe("major")})}),describe("customMode",function(){it("should return custom mode from MUSICALMODES",function(){expect(customMode).toEqual([1,1,1,1,1,1,1,1,1,1,1,1])})}),describe("getInvertMode",function(){it("should return the correct invert mode name",function(){expect(getInvertMode("even")).toBe("even"),expect(getInvertMode("scalar")).toBe("scalar"),expect(getInvertMode("nonexistent")).toBe("nonexistent")})}),describe("getIntervalNumber",function(){it("should return the number of semi-tones for a given interval",function(){expect(getIntervalNumber("perfect 5")).toBe(7),expect(getIntervalNumber("major 3")).toBe(4)})}),describe("getIntervalDirection",function(){it("should return the direction of the interval",function(){expect(getIntervalDirection("diminished 6")).toBe(-1),expect(getIntervalDirection("minor 3")).toBe(-1)})}),describe("getIntervalRatio",function(){it("should return the ratio for a given interval",function(){expect(getIntervalRatio("perfect 5")).toBe(1.5),expect(getIntervalRatio("major 3")).toBe(1.25)})}),describe("getModeNumbers",function(){it("should return the correct mode numbers for a valid mode",function(){expect(getModeNumbers("chromatic")).toBe("0 1 2 3 4 5 6 7 8 9 10 11"),expect(getModeNumbers("major")).toBe("0 2 4 5 7 9 11"),expect(getModeNumbers("minor")).toBe("0 2 3 5 7 8 10")}),it("should return an empty string for an invalid mode",function(){expect(getModeNumbers("invalidMode")).toBe("")}),it("should handle custom mode correctly",function(){expect(getModeNumbers("custom")).toBe("0 1 2 3 4 5 6 7 8 9 10 11")})}),jest.mock("../musicutils",function(){return _objectSpread(_objectSpread({},jest.requireActual("../musicutils")),{},{getDrumIndex:jest.fn(),getDrumName:jest.fn(),getDrumSymbol:jest.fn()})}),describe("getDrum",function(){var o,n;beforeEach(function(){o=[["snare drum","snare drum","images/snaredrum.svg","sn","drum"],["kick drum","kick drum","images/kick.svg","hh","drum"],["tom tom","tom tom","images/tom.svg","tomml","drum"],["floor tom","floor tom","images/floortom.svg","tomfl","drum"],["bass drum","bass drum","images/kick.svg","tomfl","drum"],["hi hat","hi hat","images/hihat.svg","hh","bell"]],n="kick drum",require("../musicutils").getDrumIndex.mockImplementation(function(t){if("http"===t.slice(0,4))return null;if(""===t)return o.findIndex(function(e){return e[0]===n});var e=o.findIndex(function(e){return e[0].toLowerCase()===t.toLowerCase()});return 0<=e?e:-1}),require("../musicutils").getDrumName.mockImplementation(function(e){if(""===e&&(e=n),"http"===e.slice(0,4))return null;for(var t=0;t<o.length;t++){if(o[t][0].toLowerCase()===e.toLowerCase())return o[t][0];if(o[t][1].toLowerCase()===e.toLowerCase())return o[t][1]}return null}),require("../musicutils").getDrumSymbol.mockImplementation(function(e){if(""===e)return"hh";for(var t=0;t<o.length;t++){if(o[t][0].toLowerCase()===e.toLowerCase())return o[t][3];if(o[t][1].toLowerCase()===e.toLowerCase())return"hh"}return"hh"})}),describe("getDrumIndex",function(){it("should return the index of a valid drum name",function(){expect(getDrumIndex("snare drum")).toBe(0),expect(getDrumIndex("kick drum")).toBe(1),expect(getDrumIndex("floor tom")).toBe(3)}),it("should return -1 for an invalid drum name",function(){expect(getDrumIndex("invalid drum")).toBe(-1)}),it("should return the index of the DEFAULTDRUM for empty input",function(){expect(getDrumIndex("")).toBe(1)}),it("should ignore case sensitivity when matching drum names",function(){expect(getDrumIndex("SNARE DRUM")).toBe(0)}),it('should return null for names starting with "http"',function(){expect(getDrumIndex("http")).toBe(null)})}),describe("getDrumName",function(){it("should return the name of a valid drum",function(){expect(getDrumName("snare drum")).toBe("snare drum"),expect(getDrumName("kick drum")).toBe("kick drum")}),it("should return the DEFAULTDRUM name for empty input",function(){expect(getDrumName("")).toBe("kick drum")}),it('should return null for names starting with "http"',function(){expect(getDrumName("http")).toBe(null)}),it("should ignore case sensitivity when matching drum names",function(){expect(getDrumName("SNARE DRUM")).toBe("snare drum"),expect(getDrumName("KICK DRUM")).toBe("kick drum")}),it("should return null for an invalid drum name",function(){expect(getDrumName("invalid drum")).toBe(null)}),it("should match the second element of DRUMNAMES if provided",function(){expect(getDrumName("kick drum")).toBe("kick drum")})}),describe("getDrumSymbol",function(){it("should return the correct symbol for a valid drum name",function(){expect(getDrumSymbol("snare drum")).toBe("sn"),expect(getDrumSymbol("kick drum")).toBe("hh"),expect(getDrumSymbol("floor tom")).toBe("tomfl")}),it('should return "hh" for an empty name',function(){expect(getDrumSymbol("")).toBe("hh")}),it('should return "hh" for an invalid drum name',function(){expect(getDrumSymbol("invalid drum")).toBe("hh")}),it('should return "hh" for a name matching the second element of DRUMNAMES',function(){expect(getDrumSymbol("snare drum")).toBe("sn"),expect(getDrumSymbol("kick drum")).toBe("hh")}),it("should ignore case sensitivity when matching drum names",function(){expect(getDrumSymbol("SNARE DRUM")).toBe("sn"),expect(getDrumSymbol("KICK DRUM")).toBe("hh")})})}),describe("getFilterTypes",function(){it("should return default filter type",function(){expect(getFilterTypes("")).toBe("highpass")}),it("should return correct filter types",function(){expect(getFilterTypes("highpass")).toBe("highpass"),expect(getFilterTypes("notch")).toBe("notch")})}),describe("getOscillatorTypes",function(){beforeEach(function(){global.OSCTYPES=[["sine","sine"],["square","square"],["triangle","triangle"],["sawtooth","sawtooth"]]}),it("should return correct oscillator type for valid display names",function(){expect(getOscillatorTypes("sine")).toBe("sine"),expect(getOscillatorTypes("square")).toBe("square")}),it("should handle case insensitive matching",function(){expect(getOscillatorTypes("SINE")).toBe("sine"),expect(getOscillatorTypes("SawTooth")).toBe("sawtooth")}),it("should return null for invalid oscillator types",function(){expect(getOscillatorTypes("invalid")).toBe(null),expect(getOscillatorTypes("random")).toBe(null)})}),describe("getDrumIcon",function(){beforeEach(function(){global.DRUMNAMES=[["snare drum","snare drum","images/snaredrum.svg"],["kick drum","kick drum","images/kick.svg"],["tom tom","tom tom","images/tom.svg"],["floor tom","floor tom","images/floortom.svg"],["bass drum","bass drum","images/kick.svg"],["hi hat","hi hat","images/hihat.svg"]],global.DEFAULTDRUM="kick drum"}),it("should return correct icon path for exact drum names",function(){expect(getDrumIcon("snare drum")).toBe("images/snaredrum.svg"),expect(getDrumIcon("hi hat")).toBe("images/hihat.svg")}),it("should handle case insensitive matching",function(){expect(getDrumIcon("SNARE DRUM")).toBe("images/snaredrum.svg"),expect(getDrumIcon("HI HAT")).toBe("images/hihat.svg")}),it("should return default drum icon for invalid drum names",function(){expect(getDrumIcon("invalid drum")).toBe("images/drum.svg"),expect(getDrumIcon("123")).toBe("images/drum.svg")})}),describe("getDrumSynthName",function(){beforeEach(function(){global.DRUMNAMES=[["snare drum","snare drum","images/snaredrum.svg"],["kick drum","kick drum","images/kick.svg"],["tom tom","tom tom","images/tom.svg"],["floor tom","floor tom","images/floortom.svg"],["bass drum","bass drum","images/kick.svg"],["hi hat","hi hat","images/hihat.svg"]],global.DEFAULTDRUM="kick drum"}),it("should return correct synth name for exact matches",function(){expect(getDrumSynthName("snare drum")).toBe("snare drum"),expect(getDrumSynthName("tom tom")).toBe("tom tom")}),it("should return null for null",function(){expect(getDrumSynthName(null)).toBeNull()})}),describe("getNoiseName",function(){beforeEach(function(){global.NOISENAMES=[["white noise","noise1","images/noise1.svg"],["brown noise","noise2","images/noise2.svg"],["pink noise","noise3","images/noise3.svg"],["","custom noise","images/custom.svg"]],global.DEFAULTNOISE="noise1"}),it("should return display name of default noise for empty string",function(){expect(getNoiseName("")).toBe("white noise")}),it("should return corresponding display name for valid identifiers",function(){expect(getNoiseName("noise1")).toBe("white noise"),expect(getNoiseName("noise3")).toBe("pink noise")})}),describe("getNoiseIcon",function(){beforeEach(function(){global.NOISENAMES=[["white noise","noise1","images/noise1.svg"],["brown noise","noise2","images/noise2.svg"],["pink noise","noise3","images/noise3.svg"],["","custom noise","images/custom.svg"]],global.DEFAULTNOISE="noise1"}),it("should return icon path for default noise when input is empty",function(){expect(getNoiseIcon("")).toBe("images/noise1.svg")}),it("should return correct icon path when searching by display name",function(){expect(getNoiseIcon("white noise")).toBe("images/noise1.svg"),expect(getNoiseIcon("pink noise")).toBe("images/noise3.svg")}),it("should return correct icon path when searching by identifier",function(){expect(getNoiseIcon("noise1")).toBe("images/noise1.svg")}),it("should handle custom noise with empty display name",function(){expect(getNoiseIcon("custom noise")).toBe("images/custom.svg")}),it("should return default synth.svg for non-existent noise names",function(){expect(getNoiseIcon("nonexistent")).toBe("images/synth.svg")}),it("should be case sensitive for noise names",function(){expect(getNoiseIcon("WHITE NOISE")).toBe("images/synth.svg")})}),describe("getNoiseSynthName",function(){beforeEach(function(){global.NOISENAMES=[["white noise","noise1","images/noise1.svg"],["brown noise","noise2","images/noise2.svg"],["pink noise","noise3","images/noise3.svg"],["","custom noise","images/custom.svg"]],global.DEFAULTNOISE="noise1"}),it("should return null for null input",function(){expect(getNoiseSynthName(null)).toBeNull()}),it("should return null for undefined input",function(){expect(getNoiseSynthName(void 0)).toBeNull()}),it("should return default noise for empty string",function(){expect(getNoiseSynthName("")).toEqual("noise1")}),it("should handle undefined NOISENAMES",function(){global.NOISENAMES=void 0,expect(function(){return getNoiseSynthName("any")}).toThrow()})}),describe("getVoiceName",function(){beforeEach(function(){global.VOICENAMES=[["piano","piano","images/piano.svg"],["violin","violin","images/violin.svg"],["guitar","guitar","images/guitar.svg"],["","custom voice","images/custom.svg"],["electronic synth","synth","images/synth.svg"]],global.DEFAULTVOICE="electronic synth"}),it("should return default voice for empty string",function(){expect(getVoiceName("")).toBe("electronic synth")}),it("should return null for http links",function(){expect(getVoiceName("http://example.com")).toBeNull(),expect(getVoiceName("https://example.com")).toBeNull()}),it("should return voice name for exact matches",function(){expect(getVoiceName("piano")).toBe("piano"),expect(getVoiceName("guitar")).toBe("guitar")}),it("should be case sensitive",function(){expect(getVoiceName("PIANO")).toBe("electronic synth")})}),describe("Voice and Temperament Functions",function(){beforeEach(function(){global.VOICENAMES=[["piano","piano_synth","images/piano.svg"],["violin","violin_synth","images/violin.svg"],["electronic synth","synth","images/synth.svg"],["","custom voice","images/custom.svg"]],global.CUSTOMSAMPLES=[["custom_sample1","sample1","images/sample1.svg"],["custom_sample2","sample2","images/sample2.svg"]],global.DEFAULTVOICE="electronic synth",global.PreDefinedTemperaments={equal:!0,"just intonation":!0}}),describe("getVoiceIcon",function(){it("should return icon path for default voice when input is empty",function(){expect(getVoiceIcon("")).toBe("images/synth.svg")}),it("should return correct icon path when searching by synth name",function(){expect(getVoiceIcon("piano_synth")).toBe("images/piano.svg")}),it("should handle custom samples",function(){expect(getVoiceIcon("custom_sample1")).toBe("custom_sample1")})}),describe("getVoiceSynthName",function(){it("should return null for null/undefined input",function(){expect(getVoiceSynthName(null)).toBeNull(),expect(getVoiceSynthName(void 0)).toBeNull()}),it("should return default voice synth name for empty string",function(){expect(getVoiceSynthName("")).toBe("synth")}),it("should return the same http link",function(){var e="http://example.com/sound.mp3";expect(getVoiceSynthName(e)).toBe(e)}),it("should return correct synth name for display names",function(){expect(getVoiceSynthName("piano")).toBe("piano_synth"),expect(getVoiceSynthName("violin")).toBe("violin_synth")})}),describe("isCustomTemperament",function(){it("should return false for predefined temperaments",function(){expect(isCustomTemperament("equal")).toBeFalsy(),expect(isCustomTemperament("just intonation")).toBeFalsy()}),it("should return true for custom temperaments",function(){expect(isCustomTemperament("custom_temp")).toBeTruthy()})})}),describe("getTemperamentName",function(){beforeEach(function(){global.TEMPERAMENTS=[["equal","equal"],["just","just"],["pythagorean","pythagorean"]],global.DEFAULTTEMPERAMENT="equal"}),it("should return default temperament when input is empty string",function(){expect(getTemperamentName("")).toBe("equal")}),it("should be case insensitive when matching names",function(){expect(getTemperamentName("EQUAL")).toBe("equal"),expect(getTemperamentName("Equal")).toBe("equal")})}),describe("noteToObj",function(){it("should correctly parse note with octave",function(){expect(noteToObj("C4")).toEqual(["C",4]),expect(noteToObj("G3")).toEqual(["G",3])}),it("should handle notes with accidentals and octave",function(){expect(noteToObj("C#4")).toEqual(["C#",4]),expect(noteToObj("F#5")).toEqual(["F#",5])}),it("should default to octave 4 when no octave is specified",function(){expect(noteToObj("C")).toEqual(["C",4]),expect(noteToObj("Bb")).toEqual(["Bb",4])})}),describe("frequencyToPitch",function(){beforeEach(function(){global.A0=27.5,global.C8=4186.01,global.TWELVEHUNDRETHROOT2=Math.pow(2,1/1200),global.PITCHES=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}),it("should handle frequencies below A0",function(){expect(frequencyToPitch(20)).toEqual(["A",0,0]),expect(frequencyToPitch(27.4)).toEqual(["A",0,0])}),it("should handle frequencies above C8",function(){expect(frequencyToPitch(4200)).toEqual(["C",8,0]),expect(frequencyToPitch(5e3)).toEqual(["C",8,0])}),it("should handle frequencies with cents deviation",function(){var e=frequencyToPitch(442);expect(e[0]).toBe("A"),expect(e[1]).toBe(4);var t=frequencyToPitch(438);expect(t[0]).toBe("A"),expect(t[2]).toBeLessThan(0)}),it("should map intermediate frequencies to nearest note",function(){var e=A0*Math.pow(2,1/3),t=frequencyToPitch(e);expect(t[0]).toBe("Dâ™­"),expect(t[1]).toBe(1)})}),describe("getArticulation",function(){it("should remove solfege syllables",function(){expect(getArticulation("do")).toBe(""),expect(getArticulation("re")).toBe("")}),it("should handle combinations of articulations",function(){expect(getArticulation("do^")).toBe(""),expect(getArticulation("C^^")).toBe("")}),it("should preserve non-articulation characters",function(){expect(getArticulation("X")).toBe("X"),expect(getArticulation("123")).toBe("123")}),it("should handle empty and special cases",function(){expect(getArticulation("")).toBe(""),expect(getArticulation("doremifa")).toBe("")})}),describe("keySignatureToMode",function(){beforeEach(function(){global.MAQAMTABLE={},global.BTOFLAT={},global.STOSHARP={},global.FLAT="b",global.SHARP="#",global.SOLFEGENAMES1=[],global.NOTESSHARP=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],global.NOTESFLAT=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],global.MUSICALMODES={major:[2,2,1,2,2,2,1],minor:[2,1,2,2,1,2,2]}}),it("should handle empty and null inputs",function(){expect(keySignatureToMode("")).toEqual(["C","major"]),expect(keySignatureToMode(null)).toEqual(["C","major"])}),it("should handle basic major keys",function(){expect(keySignatureToMode("C major")).toEqual(["C","major"]),expect(keySignatureToMode("D major")).toEqual(["D","major"])}),it("should handle full minor key names",function(){expect(keySignatureToMode("A minor")).toEqual(["A","minor"]),expect(keySignatureToMode("E minor")).toEqual(["E","minor"])})}),describe("getScaleAndHalfSteps",function(){beforeEach(function(){global.SOLFMAPPER=["do","do","re","re","mi","fa","fa","sol","sol","la","la","ti"],global.SOLFEGENAMES=["do","re","mi","fa","sol","la","ti"],global.NOTESSHARP=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],global.NOTESFLAT=["C","Dâ™­","D","Eâ™­","E","F","Gâ™­","G","Aâ™­","A","Bâ™­","B"],global.MUSICALMODES={major:[2,2,1,2,2,2,1],minor:[2,1,2,2,1,2,2]},global.EXTRATRANSPOSITIONS={},global.MAQAMTABLE={},global.BTOFLAT={},global.STOSHARP={},global.FLAT="â™­",global.SHARP="#",global.SOLFEGENAMES1=[]}),it(" should handle major scale correctly",function(){var e=getScaleAndHalfSteps("C major");expect(e).toEqual([["C","Dâ™­","D","Eâ™­","E","F","Gâ™­","G","Aâ™­","A","Bâ™­","B"],["do","","re","","mi","fa","","sol","","la","","ti"],"C","major"])}),it("should handle minor scale correctly",function(){var e=getScaleAndHalfSteps("A minor");expect(e).toEqual([["C","Dâ™­","D","Eâ™­","E","F","Gâ™­","G","Aâ™­","A","Bâ™­","B"],["do","","re","mi","","fa","","sol","la","","ti",""],"A","minor"])})}),describe("modeMapper",function(){beforeEach(function(){global.SHARP="â™¯",global.FLAT="â™­"}),it("should map Ionian to major",function(){expect(modeMapper("C","ionian")).toEqual(["c","major"]),expect(modeMapper("D","ionian")).toEqual(["d","major"])}),it("should handle flats in Dorian mode",function(){expect(modeMapper("Eâ™­","dorian")).toEqual(["eâ™­","minor"]),expect(modeMapper("Bâ™­","dorian")).toEqual(["f","minor"])}),it("should handle flats in Locrian mode",function(){expect(modeMapper("Eâ™­","locrian")).toEqual(["dâ™­","minor"]),expect(modeMapper("Bâ™­","locrian")).toEqual(["dâ™­","minor"])})}),describe("getSharpFlatPreference",function(){beforeEach(function(){global.SHARPPREFERENCE=["g major","d major","a major","e major","b major"],global.FLATPREFERENCE=["f major","bb major","eb major","ab major","db major"]}),it('should return "sharp" for keys that traditionally use sharps',function(){expect(getSharpFlatPreference("G")).toBe("sharp"),expect(getSharpFlatPreference("D")).toBe("sharp")}),it('should return "natural" for C major and keys not in sharp/flat preferences',function(){expect(getSharpFlatPreference("C")).toBe("natural"),expect(getSharpFlatPreference("Am")).toBe("natural")})}),describe("getCustomNote",function(){beforeEach(function(){global.DOUBLEFLAT="ğ„«",global.FLAT="â™­",global.DOUBLESHARP="ğ„ª",global.SHARP="â™¯"}),it("should handle array input by taking first element",function(){expect(getCustomNote(["C","other"])).toBe("C"),expect(getCustomNote(["D#","other"])).toBe("Dâ™¯")}),it("should convert double flat notation",function(){expect(getCustomNote("Cbb")).toBe("Cğ„«"),expect(getCustomNote("Dbb")).toBe("Dğ„«")})}),describe("pitchToNumber",function(){beforeEach(function(){global.DOUBLEFLAT="ğ„«",global.FLAT="â™­",global.DOUBLESHARP="ğ„ª",global.SHARP="â™¯",global.PITCHES=["C","D","E","F","G","A","B"],global.FIXEDSOLFEGE1={do:"C",re:"D",mi:"E",fa:"F",sol:"G",la:"A",ti:"B"},global.getScaleAndHalfSteps=jest.fn().mockImplementation(function(e){return[["C","D","E","F","G","A","B"],["do","re","mi","fa","sol","la","ti"]]}),global.console.debug=jest.fn()}),it("should handle rest notes",function(){expect(pitchToNumber("R",4,"C major")).toBe(0),expect(pitchToNumber("r",4,"C major")).toBe(0)}),it("should handle basic notes",function(){expect(pitchToNumber("C",4,"C major")).toBe(39),expect(pitchToNumber("A",4,"C major")).toBe(48)})}),describe("numberToPitchSharp",function(){beforeEach(function(){global.SHARP="â™¯",global.PITCHES2=["A","Aâ™¯","B","C","Câ™¯","D","Dâ™¯","E","F","Fâ™¯","G","Gâ™¯"]}),it("should convert 0 to A0",function(){expect(numberToPitchSharp(0)).toEqual(["A",0])}),it("should convert positive numbers within first octave",function(){expect(numberToPitchSharp(1)).toEqual(["Aâ™¯",0]),expect(numberToPitchSharp(2)).toEqual(["B",0])})}),describe("getNumber",function(){beforeEach(function(){global.DOUBLEFLAT="ğ„«",global.FLAT="â™­",global.DOUBLESHARP="ğ„ª",global.SHARP="â™¯",global.NOTESTEP={C:0,D:2,E:4,F:5,G:7,A:9,B:11}}),it("should handle natural notes in octave 4",function(){expect(getNumber("C",4)).toBe(37),expect(getNumber("D",4)).toBe(39)}),it("should handle negative octaves",function(){expect(getNumber("C",-1)).toBe(1)}),it("should handle flat notes",function(){expect(getNumber("Bb",4)).toBe(47),expect(getNumber("Eb",4)).toBe(40)})}),describe("getNoteFromInterval",function(){beforeEach(function(){global.DOUBLEFLAT="ğ„«",global.FLAT="â™­",global.DOUBLESHARP="ğ„ª",global.SHARP="â™¯",global.INTERVALVALUES={"major 2":[2,1],"major 3":[4,1],"major 6":[9,1],"major 7":[11,1],"perfect 1":[0,1],"perfect 4":[5,1],"perfect 5":[7,1],"perfect 8":[12,1],"minor 2":[1,1],"minor 3":[3,1],"minor 6":[8,1],"minor 7":[10,1],"diminished 4":[4,1],"diminished 5":[6,1],"diminished 8":[11,1],"augmented 1":[1,1],"augmented 2":[3,1],"augmented 3":[5,1],"augmented 4":[6,1],"augmented 5":[8,1],"augmented 6":[10,1],"augmented 7":[12,1],"augmented 8":[13,1]},global.pitchToNumber=jest.fn(function(e,t){return 12*t+["C","D","E","F","G","A","B"].indexOf(e)}),global.numberToPitch=jest.fn(function(e){var t=Math.floor(e/12);return[["C","D","E","F","G","A","B"][e%12],t]}),global.numberToPitchSharp=jest.fn(function(e){var t=Math.floor(e/12);return[["C","Câ™¯","D","Dâ™¯","E","F","Fâ™¯","G","Gâ™¯","A","Aâ™¯","B"][e%12],t]}),global.getNumber=jest.fn(function(e,t){return 12*t+["C","D","E","F","G","A","B"].indexOf(e)})}),it("should calculate major 2nd correctly",function(){expect(getNoteFromInterval("C4","major 2")).toEqual(["D",4]),expect(getNoteFromInterval("F4","major 2")).toEqual(["G",4])}),it("should calculate augmented intervals correctly",function(){expect(getNoteFromInterval("C4","augmented 4")).toEqual(["Fâ™¯",4]),expect(getNoteFromInterval("F4","augmented 5")).toEqual(["Câ™¯",5])})}),describe("numberToPitch",function(){beforeEach(function(){global.PITCHES=["C","Dâ™­","D","Eâ™­","E","F","Gâ™­","G","Aâ™­","A","Bâ™­","B"],global.TEMPERAMENT={equal:{pitchNumber:12,interval:["perfect 1","minor 2","major 2","minor 3","major 3","perfect 4","diminished 5","perfect 5","minor 6","major 6","minor 7","major 7"]},"just intonation":{pitchNumber:12,0:[1,"C",4],1:[16/15,"Dâ™­",4],2:[9/8,"D",4],3:[1.2,"Eâ™­",4],4:[5/4,"E",4],5:[4/3,"F",4],6:[45/32,"Gâ™­",4],7:[1.5,"G",4],8:[1.6,"Aâ™­",4],9:[5/3,"A",4],10:[1.8,"Bâ™­",4],11:[15/8,"B",4]}},global.isCustomTemperament=jest.fn(function(e){return"equal"!==e&&e in global.TEMPERAMENT}),global.getNoteFromInterval=jest.fn(function(e,t){return["C",4]}),global.console.debug=jest.fn()}),it("should convert single-digit positive numbers",function(){expect(numberToPitch(0,"equal")).toEqual(["A",0]),expect(numberToPitch(1,"equal")).toEqual(["Bâ™­",0])}),it("should handle octave transitions",function(){expect(numberToPitch(11,"equal")).toEqual(["Aâ™­",1]),expect(numberToPitch(13,"equal")).toEqual(["Bâ™­",1])}),it("should maintain correct ratios",function(){var e=numberToPitch(4,"just intonation","C4",0),t=numberToPitch(7,"just intonation","C4",0);expect(Array.isArray(e)).toBe(!0),expect(Array.isArray(t)).toBe(!0)})}),describe("GetNotesForInterval",function(){global.last=jest.fn(function(e){return e[e.length-1]}),it("should handle basic note status with two notes",function(){expect(GetNotesForInterval({singer:{noteStatus:[["C4","E4"]]}})).toEqual({firstNote:"C",secondNote:"E",octave:0})}),it("should handle note pitches with accidentals",function(){expect(GetNotesForInterval({singer:{noteStatus:null,notePitches:{1:["Câ™¯","Eâ™­"]},inNoteBlock:[1]}})).toEqual({firstNote:"C#",secondNote:"Eb",octave:0})}),it("should handle empty tur object",function(){expect(GetNotesForInterval({singer:{}})).toEqual({firstNote:"C",secondNote:"C",octave:0})})}),describe("base64Encode",function(){it("should handle empty string",function(){var e=base64Encode("");expect(e.length).toBe(0)}),it("should handle special characters and Unicode",function(){var e="Â¡Hola! ä½ å¥½",t=base64Encode(e),o=(new TextEncoder).encode(e);expect(t.length).toBe(o.length);for(var n=0;n<o.length;n++)expect(t.charCodeAt(n)).toBe(o[n])})}),describe("getNote",function(){it("should return rest note",function(){expect(getNote("rest")).toEqual(["R","",0]),expect(getNote("r")).toEqual(["R","",0])}),it("should return the correct note for C4 in C major",function(){var e=getNote("C",4,0,"C major");expect(e).toEqual(["C",4,0])}),it("should return the correct note for C4 with transposition in C major",function(){var e=getNote("C",4,2,"C major");expect(e).toEqual(["D",4,0])}),it("should return the correct note for F4 in F major",function(){var e=getNote("F",4,0,"F major");expect(e).toEqual(["F",4,0])}),it("should return the correct note for Fâ™¯4 in F major",function(){var e=getNote("Fâ™¯",4,0,"F major");expect(e).toEqual(["Fâ™¯",4,0])}),it("should return the correct note for Gâ™¯4 in G major",function(){var e=getNote("Gâ™¯",4,0,"G major");expect(e).toEqual(["Gâ™¯",4,0])})}),describe("buildScale",function(){[{keySignature:"Câ™­ major",expected:[["Câ™­","Dâ™­","Eâ™­","Fâ™­","Gâ™­","Aâ™­","Bâ™­","Câ™­"],[2,2,1,2,2,2,1]]},{keySignature:"Fâ™­ major",expected:[["Fâ™­","Gâ™­","Aâ™­","Bğ„«","Câ™­","Dâ™­","Eâ™­","Fâ™­"],[2,2,1,2,2,2,1]]},{keySignature:"D major",expected:[["D","E","Fâ™¯","G","A","B","Câ™¯","D"],[2,2,1,2,2,2,1]]},{keySignature:"C major",expected:[["C","D","E","F","G","A","B","C"],[2,2,1,2,2,2,1]]},{keySignature:"G major",expected:[["G","A","B","C","D","E","Fâ™¯","G"],[2,2,1,2,2,2,1]]},{keySignature:"A minor",expected:[["A","B","C","D","E","F","G","A"],[2,1,2,2,1,2,2]]},{keySignature:"Fâ™¯ major",expected:[["Fâ™¯","Gâ™¯","Aâ™¯","B","Câ™¯","Dâ™¯","Eâ™¯","Fâ™¯"],[2,2,1,2,2,2,1]]},{keySignature:"Bb major",expected:[["Bâ™­","C","D","Eâ™­","F","G","A","Bâ™­"],[2,2,1,2,2,2,1]]},{keySignature:"E major",expected:[["E","Fâ™¯","Gâ™¯","A","B","Câ™¯","Dâ™¯","E"],[2,2,1,2,2,2,1]]}].forEach(function(e){var t=e.keySignature,o=e.expected;it("should return the correct scale and intervals for ".concat(t),function(){var e=buildScale(t);expect(e).toEqual(o)})}),it("should handle invalid key signatures gracefully",function(){var e=buildScale("");expect(e).toEqual([["C","D","E","F","G","A","B","C"],[2,2,1,2,2,2,1]])})}),describe("getStepSize",function(){it('should return the correct step size for "C" in "C major" going up',function(){var e=_getStepSize("C major","C","up",0,"equal");expect(e).toBe(2)}),it('should return the correct step size for "C" in "C major" going down',function(){var e=_getStepSize("C major","C","down",0,"equal");expect(e).toBe(-1)}),it('should return the correct step size for "F" in "F major" going up',function(){var e=_getStepSize("F major","F","up",0,"equal");expect(e).toBe(2)}),it('should return the correct step size for "F" in "F major" going down',function(){var e=_getStepSize("F major","F","down",0,"equal");expect(e).toBe(-1)}),it('should return the correct step size for "G" in "G major" going up',function(){var e=_getStepSize("G major","G","up",0,"equal");expect(e).toBe(2)}),it('should return the correct step size for "G" in "G major" going down',function(){var e=_getStepSize("G major","G","down",0,"equal");expect(e).toBe(-1)}),it('should return the correct step size for "F#" in "F# major" going up',function(){var e=_getStepSize("F# major","F#","up",0,"equal");expect(e).toBe(0)}),it('should return the correct step size for "G#" in "G# major" going down',function(){var e=_getStepSize("G# major","G#","down",0,"equal");expect(e).toBe(0)}),it('should return 0 for "C" going down in a key without a lower note',function(){var e=_getStepSize("C major","C","down",0,"equal");expect(e).toBe(-1)}),it("should return an error or appropriate value for invalid key signature",function(){var e=_getStepSize("Invalid key","C","up",0,"equal");expect(e).toBe(2)}),it('should return the correct step size for "C" in "C major" with a non-standard temperament',function(){var e=_getStepSize("C major","C","up",0,"just");expect(e).toBe(0)})}),describe("getModeLength",function(){it("should return length",function(){var e=getModeLength("");expect(e).toBe(7)}),it("should return length",function(){var e=getModeLength("E major");expect(e).toBe(7)})}),describe("nthDegreeToPitch",function(){it("should return the correct note for the 2nd scale degree in C major",function(){var e=nthDegreeToPitch("C major",2);expect(e).toBe("E")}),it("should handle a scale degree larger than the scale length (wrapping case)",function(){var e=nthDegreeToPitch("C major",8);expect(e).toBe("D")}),it("should return the root note for scale degree 0 in C major",function(){var e=nthDegreeToPitch("C major",0);expect(e).toBe("C")}),it("should return the correct note for the 5th scale degree in A minor",function(){var e=nthDegreeToPitch("A minor",5);expect(e).toBe("F")}),it("should handle negative scale degrees (reverse wrapping)",function(){var e=nthDegreeToPitch("C major",-1);expect(e).toBeUndefined()}),it("should return undefined for a scale degree when the scale is empty",function(){var e=nthDegreeToPitch("Unknown",2);expect(e).toBe("E")})}),describe("getInterval",function(){it("should return the correct interval for a pitch in the scale",function(){var e=getInterval(2,"C major","E");expect(e).toBe(3)}),it("should wrap around when pitch is not in the current scale",function(){var e=getInterval(5,"C major","B");expect(e).toBe(8)}),it("should return 0 for a pitch not found in equivalent mappings",function(){var e=getInterval(2,"C major","Z");expect(e).toBe(0)}),it("should correctly shift pitches up or down if they are not in the consonant scale",function(){var e=getInterval(1,"C major","B");expect(e).toBe(1);var t=getInterval(-1,"C major","Cb");expect(t).toBe(-2)})}),describe("reducedFraction",function(){global.NSYMBOLS={1:"ğ…",2:"ğ…",4:"â™©",8:"â™ª",16:"ğ…¡"},it("should return reduced fraction with a common numerator and denominator",function(){expect(reducedFraction(4,8)).toBe("1<br>&mdash;<br>2<br>ğ…"),expect(reducedFraction(8,16)).toBe("1<br>&mdash;<br>2<br>ğ…")}),it("should return a fraction without symbols for non-standard denominators",function(){expect(reducedFraction(10,15)).toBe("2<br>&mdash;<br>3<br><br>"),expect(reducedFraction(25,50)).toBe("1<br>&mdash;<br>2<br>ğ…")}),it("should handle edge case where denominator is 0",function(){expect(reducedFraction(5,0)).toBe("1<br>&mdash;<br>0<br><br>")}),it("should handle positive and negative fractions correctly",function(){expect(reducedFraction(-4,8)).toBe("1<br>&mdash;<br>-2<br><br>"),expect(reducedFraction(5,-15)).toBe("1<br>&mdash;<br>-3<br><br>")})}),describe("toFraction",function(){it("should return array with numerator and denomrator from floating point number",function(){expect(toFraction(2.2)).toEqual([11,5]),expect(toFraction(.1)).toEqual([1,10])}),it("should return array with numerator and denomrator from floating point number",function(){expect(toFraction(0)).toEqual([0,2])})}),describe("calcNoteValueToDisplay",function(){global.NSYMBOLS={1:"ğ…",2:"ğ…",4:"â™©",8:"â™ª",16:"ğ…¡"},it("should return a note value with a symbol when the note value is in NSYMBOLS",function(){var e=calcNoteValueToDisplay(1,2);expect(e).toBe("2<br>&mdash;<br>1<br>ğ…")}),it("should return a reduced fraction when note value is not in NSYMBOLS",function(){var e=calcNoteValueToDisplay(3,4);expect(e).toBe("4<br>&mdash;<br>3<br>ğ….")}),it("should handle note values with fractional components and display them correctly",function(){var e=calcNoteValueToDisplay(1,3);expect(e).toBe("3<br>&mdash;<br>1<br>ğ…")}),it("should handle cases where note value cannot be found in NSYMBOLS and returns a reduced fraction",function(){var e=calcNoteValueToDisplay(5,6);expect(e).toBe("6<br>&mdash;<br>5<br>ğ….")}),it("should return a note value with a symbol for valid inputs that map to an NSYMBOL",function(){var e=calcNoteValueToDisplay(8,8);expect(e).toBe("1<br>&mdash;<br>1<br>ğ…")}),it("should handle larger numerators and denominators properly",function(){var e=calcNoteValueToDisplay(100,200);expect(e).toBe("2<br>&mdash;<br>1<br>ğ…")}),it("should handle when enter 0 as a parameter",function(){expect(calcNoteValueToDisplay(1,0)).toBe("0<br>&mdash;<br>1<br>ğ…")})}),describe("durationToNoteValue",function(){global.POWER2=[1,2,4,8,16,32,64,128],it("should correctly convert a duration to a note value with no dots",function(){var e=durationToNoteValue(1);expect(e).toEqual([1,0,null])}),it("should correctly convert a duration to a note value with one dot",function(){var e=durationToNoteValue(1.5);expect(e).toEqual([1,0,[3,.5],1])}),it("should correctly convert a duration to a note value with two dots",function(){var e=durationToNoteValue(1.75);expect(e).toEqual([1,0,[3.5,.5],1])}),it("should round down durations that do not match exact note values in POWER2",function(){var e=durationToNoteValue(.3);expect(e).toEqual([1,0,[.6,.5],1])}),it("should correctly return the note value for durations in POWER2",function(){var e=durationToNoteValue(2);expect(e).toEqual([2,0,null])}),it("should return the default rounded value for durations without an exact tuplet factor",function(){var e=durationToNoteValue(.5);expect(e).toEqual([1,0,[1,.5],1])})}),describe("noteToPitchOctave",function(){it("should correctly extract pitch and octave from a note string with a single character",function(){var e=noteToPitchOctave("C4");expect(e).toEqual(["C",4])}),it("should correctly extract pitch and octave from a note string with a sharp note",function(){var e=noteToPitchOctave("C#5");expect(e).toEqual(["C#",5])}),it("should correctly extract pitch and octave from a note string with a flat note",function(){var e=noteToPitchOctave("Db6");expect(e).toEqual(["Db",6])}),it("should correctly handle a note string with a lowercase pitch",function(){var e=noteToPitchOctave("g3");expect(e).toEqual(["g",3])}),it("should handle multi-character note names with no octave",function(){var e=noteToPitchOctave("B#");expect(e).toEqual(["B",NaN])})}),describe("pitchToFrequency",function(){global.TWELTHROOT2=1.0594630943592953,global.TWELVEHUNDRETHROOT2=1.0005777895065548,global.A0=27.5,it("calculates frequency with 0 cents",function(){var e=pitchToFrequency("A",4,0,"C");expect(e).toBe(A0*Math.pow(TWELTHROOT2,48))}),it("calculates frequency with non-zero cents",function(){var e=pitchToFrequency("A",4,50,"C");expect(e).toBe(A0*Math.pow(TWELVEHUNDRETHROOT2,4850))}),it("handles edge case with extreme pitch number",function(){var e=pitchToFrequency("C",8,0,"C");expect(e).toBe(A0*Math.pow(TWELTHROOT2,87))}),it("throws error if pitchToNumber fails",function(){expect(pitchToFrequency("Z",4,0,"C")).toBe(A0*Math.pow(TWELTHROOT2,39))})}),describe("noteToFrequency",function(){global.TWELTHROOT2=1.0594630943592953,global.TWELVEHUNDRETHROOT2=1.0005777895065548,global.A0=27.5,it("converts note to frequency correctly",function(){var e=noteToFrequency("A4","C");expect(e).toBe(A0*Math.pow(TWELTHROOT2,48))}),it("handles invalid note input gracefully",function(){expect(noteToFrequency("X9","C")).toBe(A0*Math.pow(TWELTHROOT2,99))})}),describe("noteIsSolfege",function(){global.SOLFEGECONVERSIONTABLE={"Câ™­":"doâ™­",C:"do","Câ™¯":"doâ™¯","Dâ™­":"reâ™­",D:"re","Dâ™¯":"reâ™¯","Eâ™­":"miâ™­",E:"mi",F:"fa","Fâ™¯":"faâ™¯","Gâ™­":"solâ™­",G:"sol","Gâ™¯":"solâ™¯","Aâ™­":"laâ™­",A:"la","Aâ™¯":"laâ™¯","Bâ™­":"tiâ™­",B:"ti","Bâ™¯":"tiâ™¯",R:_("rest")},it("should return false for standard note without solfege conversion",function(){expect(noteIsSolfege("C")).toBe(!1)}),it("should return false for a rest note",function(){expect(noteIsSolfege("R")).toBe(!1)}),it("should return true for a note with an unrecognized sharp (e.g., Eâ™¯)",function(){expect(noteIsSolfege("Eâ™¯")).toBe(!0)})}),describe("getSolfege",function(){}),describe("getSolfege",function(){global.SOLFEGECONVERSIONTABLE={"Câ™­":"doâ™­",C:"do","Câ™¯":"doâ™¯","Dâ™­":"reâ™­",D:"re","Dâ™¯":"reâ™¯","Eâ™­":"miâ™­",E:"mi",F:"fa","Fâ™¯":"faâ™¯","Gâ™­":"solâ™­",G:"sol","Gâ™¯":"solâ™¯","Aâ™­":"laâ™­",A:"la","Aâ™¯":"laâ™¯","Bâ™­":"tiâ™­",B:"ti","Bâ™¯":"tiâ™¯",R:_("rest")},it("should return the note itself if it is already a solfege note",function(){expect(getSolfege("C")).toBe("do"),expect(getSolfege("R")).toBe("rest")}),it("should return the correct solfege for standard notes",function(){expect(getSolfege("Câ™­")).toBe("doâ™­"),expect(getSolfege("D")).toBe("re")}),it("should return the correct solfege for sharp and flat notes",function(){expect(getSolfege("Gâ™¯")).toBe("solâ™¯"),expect(getSolfege("Aâ™¯")).toBe("laâ™¯")}),it("should return undefined for invalid notes not present in the conversion table",function(){expect(getSolfege("X")).toBe("X")})}),describe("splitSolfege",function(){global.SOLFNOTES=["ti","la","sol","fa","mi","re","do"],it("should correctly split solfege notes without attributes",function(){expect(splitSolfege("do")).toEqual(["do",""]),expect(splitSolfege("la")).toEqual(["la",""]),expect(splitSolfege("ti")).toEqual(["ti",""])}),it("should correctly split solfege notes with sharp (â™¯) or flat (â™­) attributes",function(){expect(splitSolfege("doâ™¯")).toEqual(["do","â™¯"]),expect(splitSolfege("tiâ™¯")).toEqual(["ti","â™¯"]),expect(splitSolfege("doâ™­")).toEqual(["do","â™­"])}),it("should correctly handle solfege with compound attributes (e.g., 'solâ™¯â™¯')",function(){expect(splitSolfege("solâ™¯â™¯")).toEqual(["sol","â™¯â™¯"]),expect(splitSolfege("doâ™¯â™¯")).toEqual(["do","â™¯â™¯"])}),it("should return ['sol', ''] if input is null or not a valid string",function(){expect(splitSolfege(null)).toEqual(["sol",""]),expect(splitSolfege(void 0)).toEqual(["sol",""]),expect(splitSolfege(123)).toEqual(["sol",""]),expect(splitSolfege({})).toEqual(["sol",""])})}),describe("i18nSolfege",function(){global.SOLFNOTES=["ti","la","sol","fa","mi","re","do"],it("should return the internationalized version of a solfege note",function(){expect(i18nSolfege("do")).toEqual("do"),expect(i18nSolfege("ti")).toEqual("ti")}),it("should return internationalized solfege notes with attributes",function(){expect(i18nSolfege("doâ™¯")).toEqual("doâ™¯"),expect(i18nSolfege("tiâ™­")).toEqual("tiâ™­")}),it("should return the same note if it's not a valid solfege note",function(){expect(i18nSolfege("Câ™¯")).toEqual("Câ™¯"),expect(i18nSolfege("G")).toEqual("G"),expect(i18nSolfege("Bâ™­")).toEqual("Bâ™­"),expect(i18nSolfege("R")).toEqual("R")}),it("should handle null or undefined values gracefully",function(){expect(i18nSolfege(null)).toEqual("sol")})}),describe("splitScaleDegree",function(){global.NATURAL="â™®",it("should split a scale degree into note and attributes",function(){expect(splitScaleDegree("C")).toEqual(["C",""]),expect(splitScaleDegree("Câ™¯")).toEqual(["C","â™¯"]),expect(splitScaleDegree("Bâ™­")).toEqual(["B","â™­"])}),it("should return default natural attribute when no attributes are provided",function(){expect(splitScaleDegree("")).toEqual([5,NATURAL]),expect(splitScaleDegree(null)).toEqual([5,NATURAL])}),it("should handle invalid or undefined inputs gracefully",function(){expect(splitScaleDegree(void 0)).toEqual([5,NATURAL]),expect(splitScaleDegree("")).toEqual([5,NATURAL])})}),describe("getNumNote",function(){global.NOTESTABLE={1:"do",2:"doâ™¯",3:"re",4:"reâ™¯",5:"mi",6:"fa",7:"faâ™¯",8:"sol",9:"solâ™¯",10:"la",11:"laâ™¯",0:"ti"},it("should correctly convert a value to a note and octave",function(){expect(getNumNote(7,0)).toEqual(["faâ™¯",1]),expect(getNumNote(9,0)).toEqual(["solâ™¯",1]),expect(getNumNote(8,1)).toEqual(["solâ™¯",1]),expect(getNumNote(13,1)).toEqual(["doâ™¯",2])})}),describe("calcOctave",function(){global.SOLFEGENAMES1=["do","doâ™¯","doğ„ª","reğ„«","reâ™­","re","reâ™¯","reğ„ª","miğ„«","miâ™­","mi","fa","faâ™¯","fağ„ª","solğ„«","solâ™­","sol","solâ™¯","solğ„ª","la","lağ„«","laâ™­","laâ™¯","lağ„ª","tiğ„«","tiâ™­","ti"],global.FIXEDSOLFEGE1={"doğ„«":"B","doâ™­":"Câ™­",do:"C","doâ™¯":"Câ™¯","doğ„ª":"D","reğ„«":"C","reâ™­":"Dâ™­",re:"D","reâ™¯":"Dâ™¯","reğ„ª":"E","miğ„«":"D","miâ™­":"Eâ™­",mi:"E","miâ™¯":"Eâ™¯","miğ„ª":"G","fağ„«":"Eâ™­","faâ™­":"Fâ™­",fa:"F","faâ™¯":"Fâ™¯","fağ„ª":"Gâ™¯","solğ„«":"E","solâ™­":"Gâ™­",sol:"G","solâ™¯":"Gâ™¯","solğ„ª":"A","lağ„«":"G","laâ™­":"Aâ™­",la:"A","laâ™¯":"Aâ™¯","lağ„ª":"B","tiğ„«":"A","tiâ™­":"Bâ™­",ti:"B","tiâ™¯":"Bâ™¯","tiğ„ª":"C",R:_("rest")},it("should return correct octave for a numeric argument",function(){expect(calcOctave(4,5,null,"C")).toBe(5)}),it("should return correct octave based on currentNote and lastNotePlayed",function(){expect(calcOctave(4,"next",["C"],"C")).toBe(5),expect(calcOctave(4,"next",["C"],"D")).toBe(5),expect(calcOctave(4,"previous",["C"],"D")).toBe(3)}),it("should correctly calculate octave based on half-steps between notes",function(){expect(calcOctave(4,"current",["C"],"G")).toBe(3),expect(calcOctave(4,"next",["C"],"B")).toBe(4),expect(calcOctave(4,"previous",["C"],"A")).toBe(2)}),it("should be able to handle default case",function(){expect(calcOctave(4,"default",["do"],"do")).toBe(4)})}),describe("calcOctaveInterval",function(){it("should return correct octave value for argument 'next'",function(){expect(calcOctaveInterval("next")).toBe(1),expect(calcOctaveInterval(_("next"))).toBe(1)}),it("should return correct octave value for argument 'previous'",function(){expect(calcOctaveInterval("previous")).toBe(-1),expect(calcOctaveInterval(_("previous"))).toBe(-1)}),it("should return correct octave value for argument 'current'",function(){expect(calcOctaveInterval("current")).toBe(0),expect(calcOctaveInterval(_("current"))).toBe(0)}),it("should return correct octave value for numeric arguments",function(){expect(calcOctaveInterval(1)).toBe(1),expect(calcOctaveInterval(0)).toBe(0),expect(calcOctaveInterval(-1)).toBe(-1),expect(calcOctaveInterval(2)).toBe(2),expect(calcOctaveInterval(-2)).toBe(-2)}),it("should return default value of 0 for invalid or undefined arguments",function(){expect(calcOctaveInterval(void 0)).toBe(0),expect(calcOctaveInterval(null)).toBe(0),expect(calcOctaveInterval("invalid")).toBe(0)})}),describe("isInt",function(){it("should return true for integer values",function(){expect(isInt(1)).toBe(!0),expect(isInt(-10)).toBe(!0),expect(isInt(123456)).toBe(!0)}),it("should return false for non-integer values",function(){expect(isInt(1.23)).toBe(!1),expect(isInt(-.56)).toBe(!1),expect(isInt("abc")).toBe(!1)}),it("should return false for NaN",function(){expect(isInt(NaN)).toBe(!1)}),it("should return false for numeric strings",function(){expect(isInt("1")).toBe(!1),expect(isInt("-10")).toBe(!1)})}),describe("convertFromSolfege",function(){global.FIXEDSOLFEGE1={"doğ„«":"B","doâ™­":"Câ™­",do:"C","doâ™¯":"Câ™¯","doğ„ª":"D","reğ„«":"C","reâ™­":"Dâ™­",re:"D","reâ™¯":"Dâ™¯","reğ„ª":"E","miğ„«":"D","miâ™­":"Eâ™­",mi:"E","miâ™¯":"Eâ™¯","miğ„ª":"G","fağ„«":"Eâ™­","faâ™­":"Fâ™­",fa:"F","faâ™¯":"Fâ™¯","fağ„ª":"Gâ™¯","solğ„«":"E","solâ™­":"Gâ™­",sol:"G","solâ™¯":"Gâ™¯","solğ„ª":"A","lağ„«":"G","laâ™­":"Aâ™­",la:"A","laâ™¯":"Aâ™¯","lağ„ª":"B","tiğ„«":"A","tiâ™­":"Bâ™­",ti:"B","tiâ™¯":"Bâ™¯","tiğ„ª":"C",R:_("rest")},global.EQUIVALENTNATURALS={"Eâ™¯":"F","Bâ™¯":"C","Câ™­":"B","Fâ™­":"E"},[{input:"doğ„«",expected:"B"},{input:"doâ™­",expected:"B"},{input:"doâ™¯",expected:"Câ™¯"},{input:"reâ™¯",expected:"Dâ™¯"},{input:"Eâ™¯",expected:"F"},{input:"R",expected:_("rest")}].forEach(function(e){var t=e.input,o=e.expected;it("should convert ".concat(t," to ").concat(o),function(){expect(convertFromSolfege(t)).toBe(o)})}),it("should return the input if no conversion is available",function(){expect(convertFromSolfege("X")).toBe("X")})}),describe("convertFactor",function(){[{input:.0625,expected:"16"},{input:.125,expected:"8"},{input:.09375,expected:"16."},{input:.1875,expected:"8."},{input:.21875,expected:"8.."},{input:.25,expected:"4"},{input:.3125,expected:"4 16"},{input:.375,expected:"4."},{input:.4375,expected:"4.."},{input:.5,expected:"2"},{input:.5625,expected:"2 16"},{input:.675,expected:"2 8"},{input:.6875,expected:"2 8 16"},{input:.75,expected:"2."},{input:.8125,expected:"2 4 16"},{input:.875,expected:"2.."},{input:.9375,expected:"2 4 8 16"},{input:1,expected:"1"}].forEach(function(e){var t=e.input,o=e.expected;it('should return "'.concat(o,'" for ').concat(t),function(){expect(convertFactor(t)).toBe(o)})}),it("should return null for unknown factors",function(){expect(convertFactor(0)).toBeNull(),expect(convertFactor("string")).toBeNull()})}),describe("scaleDegreeToPitchMapping",function(){it("maps scale degree to pitch with movable do",function(){var e=scaleDegreeToPitchMapping("C major",1,!0,null);expect(e).toBe("C")}),it("maps pitch to scale degree with movable do",function(){var e=scaleDegreeToPitchMapping("C major",null,!0,"C");expect(e).toEqual(["1","â™®","8","â™®"])}),it("maps scale degree to pitch in a chosen mode",function(){var e=scaleDegreeToPitchMapping("D minior",2,!1,null);expect(e).toBe("E")}),it("maps pitch to scale degree in a chosen mode",function(){var e=scaleDegreeToPitchMapping("D",null,!1,"E");expect(e).toEqual(["2","â™®"])}),it("handles invalid pitch input gracefully",function(){var e=scaleDegreeToPitchMapping("C major",null,!0,"Z");expect(e).toEqual([])}),it("handles undefined scale degree gracefully",function(){var e=scaleDegreeToPitchMapping("C major",10,!1,null);expect(e).toBeUndefined()}),it("handles fallback to major scale for incomplete modes",function(){var e=scaleDegreeToPitchMapping("A minor",5,!1,null);expect(e).toBe("E")}),it("handles edge cases for pitch alterations",function(){var e=scaleDegreeToPitchMapping("C major",null,!1,"C#");expect(e).toEqual(["1","8"])})});