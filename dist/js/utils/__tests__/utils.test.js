"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var fs=require("fs"),path=require("path");describe("Utility Functions (logic-only)",function(){var n,o,i,r,f,u,a,c,s,l,d,p,x;beforeAll(function(){global.window={btoa:function(e){return Buffer.from(e,"utf8").toString("base64")},outerHeight:600,outerWidth:800,innerHeight:400,innerWidth:600,devicePixelRatio:2,widgetWindows:{hideAllWindows:jest.fn(),hideWindow:jest.fn()},server:"http://localhost/",onload:null,setInterval:jest.fn(),clearInterval:jest.fn()},global.navigator={userAgent:"NodeTest"},global.document={getElementById:jest.fn(function(){return null}),getElementsByClassName:jest.fn(function(){return[]}),getElementsByName:jest.fn(function(){return[]}),getElementsByTagName:jest.fn(function(){return[]}),querySelector:jest.fn(function(){return{getContext:jest.fn(function(){return{measureText:function(){return{width:42}}}})}}),webL10n:{get:jest.fn(function(e){return e}),getLanguage:jest.fn(function(){return"en"})},body:{innerHTML:""},createElement:jest.fn(function(){return{getContext:jest.fn(function(){return{measureText:function(){return{width:42}}}})}})},global.localStorage={getItem:jest.fn(),setItem:jest.fn(),removeItem:jest.fn(),clear:jest.fn(),kanaPreference:""},global.XMLHttpRequest=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"open",value:function(){}},{key:"setRequestHeader",value:function(){}},{key:"send",value:function(){this.status=200,this.responseText="Mock response"}}]),e}(),global.self={location:{href:"file:///"},console:console};var e=fs.readFileSync(path.join(__dirname,"../utils.js"),"utf8"),t=new Function("\n            ".concat(e,'\n            return {\n                toTitleCase: typeof toTitleCase !== "undefined" ? toTitleCase : undefined,\n                fileExt: typeof fileExt !== "undefined" ? fileExt : undefined,\n                fileBasename: typeof fileBasename !== "undefined" ? fileBasename : undefined,\n                last: typeof last !== "undefined" ? last : undefined,\n                safeSVG: typeof safeSVG !== "undefined" ? safeSVG : undefined,\n                toFixed2: typeof toFixed2 !== "undefined" ? toFixed2 : undefined,\n                mixedNumber: typeof mixedNumber !== "undefined" ? mixedNumber : undefined,\n                nearestBeat: typeof nearestBeat !== "undefined" ? nearestBeat : undefined,\n                oneHundredToFraction: typeof oneHundredToFraction !== "undefined" ? oneHundredToFraction : undefined,\n                rationalToFraction: typeof rationalToFraction !== "undefined" ? rationalToFraction : undefined,\n                rgbToHex: typeof rgbToHex !== "undefined" ? rgbToHex : undefined,\n                hexToRGB: typeof hexToRGB !== "undefined" ? hexToRGB : undefined,\n                hex2rgb: typeof hex2rgb !== "undefined" ? hex2rgb : undefined\n            };\n        '))();n=t.toTitleCase,o=t.fileExt,i=t.fileBasename,r=t.last,f=t.safeSVG,u=t.toFixed2,a=t.mixedNumber,c=t.nearestBeat,s=t.oneHundredToFraction,l=t.rationalToFraction,d=t.rgbToHex,p=t.hexToRGB,x=t.hex2rgb}),describe("toTitleCase()",function(){it("converts first character to uppercase",function(){expect(n("hello")).toBe("Hello")}),it("returns undefined if not a string",function(){expect(n(123)).toBeUndefined()})}),describe("fileExt()",function(){it("returns file extension",function(){expect(o("image.png")).toBe("png"),expect(o("archive.tar.gz")).toBe("gz")}),it("returns empty string if no extension",function(){expect(o("filename")).toBe(""),expect(o(null)).toBe("")})}),describe("fileBasename()",function(){it("returns basename without extension",function(){expect(i("image.png")).toBe("image"),expect(i("archive.tar.gz")).toBe("archive.tar")}),it("handles files without extension",function(){expect(i("filename")).toBe("filename")})}),describe("last()",function(){it("returns last element of array",function(){expect(r([1,2,3])).toBe(3),expect(r(["a","b","c"])).toBe("c")}),it("returns null if empty array",function(){expect(r([])).toBeNull()})}),describe("safeSVG()",function(){it("escapes HTML entities",function(){expect(f("<svg>")).toBe("&lt;svg&gt;"),expect(f("Hello & goodbye")).toBe("Hello &amp; goodbye")}),it("returns non-string as is",function(){expect(f(123)).toBe(123)})}),describe("toFixed2()",function(){it("formats number to two decimals if needed",function(){expect(u(3.14159)).toBe("3.14"),expect(u(3)).toBe("3")}),it("returns input as is if not a number",function(){expect(u("abc")).toBe("abc")})}),describe("mixedNumber()",function(){it("returns mixed fraction for fractional numbers",function(){expect(a(2.25)).toBe("2 1/4"),expect(a(1)).toBe("1/1")}),it("returns number/1 for integer",function(){expect(a(2)).toBe("2/1")})}),describe("nearestBeat()",function(){it("finds nearest beat",function(){expect(c(50,8)).toEqual([4,8])})}),describe("oneHundredToFraction()",function(){it("returns fraction for given number",function(){expect(s(50)).toEqual([1,2]),expect(s(1)).toEqual([1,64]),expect(s(100)).toEqual([1,1])})}),describe("rationalToFraction()",function(){it("converts float to fraction",function(){expect(l(.5)).toEqual([1,2])}),it("handles 0, NaN, Infinity",function(){expect(l(0)).toEqual([0,1]),expect(l(NaN)).toEqual([0,1]),expect(l(1/0)).toEqual([0,1])})}),describe("rgbToHex()",function(){it("converts rgb to hex",function(){expect(d(255,0,0)).toBe("#ff0000"),expect(d(0,255,0)).toBe("#00ff00"),expect(d(0,0,255)).toBe("#0000ff")})}),describe("hexToRGB()",function(){it("converts hex to rgb object",function(){expect(p("#ff0000")).toEqual({r:255,g:0,b:0}),expect(p("#00ff00")).toEqual({r:0,g:255,b:0})}),it("returns null for invalid hex",function(){expect(p("#zzz")).toBeNull()})}),describe("hex2rgb()",function(){it("converts hex to rgba string",function(){expect(x("ff0000")).toBe("rgba(255,0,0,1)")})})});