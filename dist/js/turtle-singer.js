"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s,i,n,o,g=[],a=!0,l=!1;try{if(n=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;a=!1}else for(;!(a=(s=n.call(r)).done)&&(g.push(s.value),g.length!==t);a=!0);}catch(e){l=!0,i=e}finally{try{if(!a&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw i}}return g}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,g=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){g=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(g)throw n}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,_toPropertyKey(s.key),s)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var s=r.call(e,t||"default");if("object"!=_typeof(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}var Singer=function(){function Te(e){_classCallCheck(this,Te),this.turtle=e,this.turtles=e.turtles,this.attack=[],this.decay=[],this.sustain=[],this.release=[],this.scalarTransposition=0,this.scalarTranspositionValues=[],this.transposition=0,this.transpositionValues=[],this.transpositionRatios=[],this.defaultNoteValue=4,this.register=0,this.beatFactor=1,this.dotCount=0,this.oscList={},this.noteBeat={},this.noteValue={},this.noteDrums={},this.notePitches={},this.noteOctaves={},this.noteCents={},this.noteHertz={},this.noteBeatValues={},this.embeddedGraphics={},this.delayedNotes=[],this.lastNotePlayed=null,this.lastPitchPlayed={},this.previousNotePlayed=null,this.noteStatus=null,this.noteDirection=0,this.pitchNumberOffset=39,this.currentOctave=4,this.currentCalculatedOctave={},this.inHarmonic=[],this.partials=[],this.inNeighbor=[],this.neighborStepPitch=[],this.neighborNoteValue=[],this.inDefineMode=!1,this.defineMode=[],this.notesPlayed=[0,1],this.whichNoteToCount=1,this.tallyNotes=0,this.movable=!1,this.bpm=[],this.previousTurtleTime=0,this.turtleTime=0,this.pushedNote=!1,this.duplicateFactor=1,this.arpeggio=[],this.arpeggioIndex=0,this.inDuplicate=!1,this.skipFactor=1,this.skipIndex=0,this.instrumentNames=[],this.inCrescendo=[],this.crescendoDelta=[],this.crescendoInitialVolume={DEFAULTVOICE:[DEFAULTVOLUME]},this.intervals=[],this.semitoneIntervals=[],this.chordIntervals=[],this.ratioIntervals=[],this.staccato=[],this.glide=[],this.glideOverride=0,this.swing=[],this.swingTarget=[],this.swingCarryOver=0,this.tie=!1,this.tieNotePitches=[],this.tieNoteExtras=[],this.tieCarryOver=0,this.tieFirstDrums=[],this.synthVolume={},this.drift=0,this.drumStyle=[],this.voices=[],this.backward=[],this.vibratoIntensity=[],this.vibratoRate=[],this.distortionAmount=[],this.tremoloFrequency=[],this.tremoloDepth=[],this.rate=[],this.octaves=[],this.baseFrequency=[],this.chorusRate=[],this.delayTime=[],this.chorusDepth=[],this.neighborArgNote1=[],this.neighborArgNote2=[],this.neighborArgBeat=[],this.neighborArgCurrentBeat=[],this.panner=null,this.inNoteBlock=[],this.multipleVoices=!1,this.invertList=[],this.beatList=[],this.factorList=[],this.keySignature="C major",this.pitchDrumTable={},this.defaultStrongBeats=!1,this.pickup=0,this.beatsPerMeasure=4,this.noteValuePerBeat=4,this.currentBeat=0,this.currentMeasure=0,this.justCounting=[],this.justMeasuring=[],this.firstPitch=[],this.lastPitch=[],this.suppressOutput=!1,this.dispatchFactor=1,this.inverted=!1}return _createClass(Te,null,[{key:"playSynthBlock",value:function(e,t,r,s,i){var n,o;1===e.length&&(n=frequencyToPitch(e[0]),r.inMatrix?(r.phraseMaker.addRowBlock(i),r.pitchBlocks.includes(i)||r.pitchBlocks.push(i),r.phraseMaker.rowLabels.push(t.logo.blocks.blockList[i].name),r.phraseMaker.rowArgs.push(e[0])):r.inLegoWidget&&!r.inMatrix?(r.legoWidget.addRowBlock(i),r.pitchBlocks.includes(i)||r.pitchBlocks.push(i),r.legoWidget.rowLabels.push(t.logo.blocks.blockList[i].name),r.legoWidget.rowArgs.push(e[0])):r.inPitchSlider?r.pitchSlider.frequency=e[0]:((o=t.turtles.ithTurtle(s)).singer.oscList[last(o.singer.inNoteBlock)].push(t.blocks.blockList[i].name),o.singer.notePitches[last(o.singer.inNoteBlock)].push(n[0]),o.singer.noteOctaves[last(o.singer.inNoteBlock)].push(n[1]),o.singer.noteCents[last(o.singer.inNoteBlock)].push(n[2]),0!==n[2]?o.singer.noteHertz[last(o.singer.inNoteBlock)].push(pitchToFrequency(n[0],n[1],n[2],o.singer.keySignature)):o.singer.noteHertz[last(o.singer.inNoteBlock)].push(0),o.singer.noteBeatValues[last(o.singer.inNoteBlock)].push(o.singer.beatFactor),o.singer.pushedNote=!0))}},{key:"addScalarTransposition",value:function(e,t,r,s,i){if(0===i)return[r,s];var n=e.activity,o=n.turtles.ithTurtle(t),g=getNote(r,s,0,o.singer.keySignature,o.singer.movable,null,n.errorMsg,e.synth.inTemperament);if(isCustomTemperament(e.synth.inTemperament))g=getNote(g[0],g[1],(0<i?getStepSizeUp:getStepSizeDown)(o.singer.keySignature,g[0],i,e.synth.inTemperament),o.singer.keySignature,o.singer.movable,null,n.errorMsg,e.synth.inTemperament);else for(var a=0;a<Math.abs(i);a++)g=getNote(g[0],g[1],(0<i?getStepSizeUp:getStepSizeDown)(o.singer.keySignature,g[0]),o.singer.keySignature,o.singer.movable,null,n.logo.errorMsg,e.synth.inTemperament);return g}},{key:"scalarDistance",value:function(e,t,r,s){if(s===r)return 0;var i,n=e.activity,o=!1;r<s&&(r=(i=[s,r])[0],s=i[1],o=!0);for(var g=n.turtles.ithTurtle(t),a=r+g.singer.pitchNumberOffset,l=s+g.singer.pitchNumberOffset,u=0,h=numberToPitch(l);u++<100&&!(a<=(l+=getStepSizeUp(g.singer.keySignature,h[0],1)));)h=numberToPitch(l);return o?u:-u}},{key:"calculateInvert",value:function(e,t,r,s,i){for(var n=4<arguments.length&&void 0!==i?i:0,o=e.activity,g=o.turtles.ithTurtle(t),a=0,l=getNote(r,s,n,g.singer.keySignature,g.singer.movable,null,o.errorMsg),u=pitchToNumber(l[0],l[1],g.singer.keySignature)-g.singer.pitchNumberOffset,h=g.singer.invertList.length-1;0<=h;h--){var c,p,m,y=getNote(g.singer.invertList[h][0],g.singer.invertList[h][1],-n,g.singer.keySignature,g.singer.movable,null,o.errorMsg),v=pitchToNumber(y[0],y[1],g.singer.keySignature)-g.singer.pitchNumberOffset;"even"===g.singer.invertList[h][2]?u+=2*(a+=v-u):"odd"===g.singer.invertList[h][2]?u+=2*(a+=v-u+.5):(c=Te.scalarDistance(e,t,v,u),p=Te.addScalarTransposition(e,t,y[0],y[1],-c),a+=((m=pitchToNumber(p[0],p[1],g.singer.keySignature)-g.singer.pitchNumberOffset)-u)/2,u=m)}return a}},{key:"noteCounter",value:function(e,t,r){if(null===r)return 0;var s=e.activity,i=s.turtles.ithTurtle(t),n=i.singer.suppressOutput,o=JSON.stringify(e.boxes),g=JSON.stringify(e.turtleHeaps[t]),a=JSON.stringify(e.turtleDicts[t]),l=i.x,u=i.y,h=i.painter.color,c=i.painter.value,p=i.painter.chroma,m=i.painter.stroke,y=i.painter.canvasAlpha,v=i.orientation,d=i.painter.penState,f=i.singer.whichNoteToCount,b=i.singer.previousTurtleTime,N=i.singer.turtleTime;for(var k in i.singer.suppressOutput=!0,i.singer.justCounting.push(!0),i.endOfClampSignals)for(var T in i.butNotThese[k]=[],i.endOfClampSignals[k])i.butNotThese[k].push(T);var S=i.singer.notesPlayed,P=i.singer.tallyNotes;i.running=!0,i.singer.whichNoteToCount+=i.singer.inNoteBlock.length,s.logo.runFromBlockNow(e,t,r,!0,[],s.turtles.getTurtle(t).queue.length);var O=rationalSum(i.singer.notesPlayed,[-S[0],S[1]]);return i.singer.notesPlayed=S,i.singer.tallyNotes=P,e.boxes=null==o?{}:JSON.parse(o),null==g?e.turtleHeaps={}:e.turtleHeaps[t]=JSON.parse(g),null==a?e.turtleDicts={}:e.turtleDicts[t]=JSON.parse(a),i.painter.doPenUp(),i.painter.doSetXY(l,u),i.painter.color=h,i.painter.value=c,i.painter.chroma=p,i.painter.stroke=m,i.painter.canvasAlpha=y,i.painter.doSetHeading(v),i.painter.penState=d,i.singer.previousTurtleTime=b,i.singer.turtleTime=N,i.singer.whichNoteToCount=f,i.singer.justCounting.pop(),i.singer.suppressOutput=n,i.butNotThese={},O[0]/O[1]}},{key:"numberOfNotes",value:function(e,t,r){if(null===r)return 0;var s=e.activity,i=s.turtles.ithTurtle(t),n=(i.singer.notesPlayed,i.singer.tallyNotes,{suppressOutput:i.singer.suppressOutput,boxes:JSON.stringify(e.boxes),turtleHeaps:JSON.stringify(e.turtleHeaps[t]),turtleDicts:JSON.stringify(e.turtleDicts[t]),x:i.x,y:i.y,color:i.painter.color,value:i.painter.value,chroma:i.painter.chroma,stroke:i.painter.stroke,canvasAlpha:i.painter.canvasAlpha,orientation:i.orientation,penState:i.painter.penState,whichNoteToCount:i.singer.whichNoteToCount,prevTurtleTime:i.singer.previousTurtleTime,turtleTime:i.singer.turtleTime,noteCount:i.singer.notesPlayed,tallyNotes:i.singer.tallyNotes});i.singer.suppressOutput=!0,i.singer.justCounting.push(!0),Object.keys(i.endOfClampSignals).forEach(function(e){i.butNotThese[e]=Object.keys(i.endOfClampSignals[e])}),i.running=!0,i.singer.whichNoteToCount+=i.singer.inNoteBlock.length,s.logo.runFromBlockNow(e,t,r,!0,[],[],s.turtles.getTurtle(t).queue.length);var o=i.singer.tallyNotes-n.tallyNotes;return Object.assign(i.singer,{notesPlayed:n.noteCount,tallyNotes:n.tallyNotes,previousTurtleTime:n.prevTurtleTime,turtleTime:n.turtleTime,whichNoteToCount:n.whichNoteToCount,suppressOutput:n.suppressOutput}),Object.assign(i.painter,{color:n.color,value:n.value,chroma:n.chroma,stroke:n.stroke,canvasAlpha:n.canvasAlpha,penState:n.penState}),s.logo.boxes=JSON.parse(n.boxes),s.logo.turtleHeaps[t]=JSON.parse(n.turtleHeaps),s.logo.turtleDicts[t]=JSON.parse(n.turtleDicts),i.painter.doPenUp(),i.painter.doSetXY(n.x,n.y),i.painter.doSetHeading(n.orientation),i.painter.doSetXY(saveX,saveY),i.painter.color=saveColor,i.painter.value=saveValue,i.painter.chroma=saveChroma,i.painter.stroke=saveStroke,i.painter.canvasAlpha=saveCanvasAlpha,i.painter.doSetHeading(saveOrientation),i.painter.penState=savePenState,i.singer.suppressOutput=saveSuppressStatus,i.singer.previousTurtleTime=savePrevTurtleTime,i.singer.turtleTime=saveTurtleTime,i.singer.whichNoteToCount=saveWhichNoteToCount,i.singer.justCounting.pop(),i.butNotThese={},o}},{key:"setMasterVolume",value:function(e,t,r){var s,i,n=e.activity;t=Math.min(Math.max(t,0),100),r?(s=n.logo.blockList[r].connections[0],i=last(n.logo.blockList[r].connections),e.synth.setMasterVolume(t,s,i)):e.synth.setMasterVolume(t);var o,g=_createForOfIteratorHelper(n.turtles.turtleList);try{for(g.s();!(o=g.n()).done;){var a=o.value;for(var l in a.singer.synthVolume)a.singer.synthVolume[l].push(t)}}catch(e){g.e(e)}finally{g.f()}}},{key:"setSynthVolume",value:function(e,t,r,s,i){switch(s=Math.min(Math.max(s,0),100),r){case"noise1":case"noise2":case"noise3":e.synth.setVolume(t,r,s/25,i);break;default:e.synth.setVolume(t,r,s,i)}}},{key:"processPitch",value:function(p,e,t,r,s,i){var n,m=p.turtles.ithTurtle(s),o=Te.addScalarTransposition(p.logo,s,e,t,m.singer.scalarTransposition),g=_slicedToArray(o,2);e=g[0],t=g[1],0<m.singer.inNeighbor.length&&(o=getNote(e,t,m.singer.transposition,m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament),m.singer.neighborArgNote1.push(o[0]+o[1]),"neighbor2"===p.blocks.blockList[last(m.singer.inNeighbor)].name?(n=Te.addScalarTransposition(p.logo,s,e,t,parseInt(m.singer.neighborStepPitch)),0!==m.singer.transposition&&(n=getNote(n[0],n[1],m.singer.transposition,m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament))):n=getNote(e,t,m.singer.transposition+parseInt(m.singer.neighborStepPitch),m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament),m.singer.neighborArgNote2.push(n[0]+n[1]));var y=0<m.singer.invertList.length?Te.calculateInvert(p.logo,s,e,t):0;if(0<m.singer.justMeasuring.length){var a=m.singer.transposition;o=getNote(e,t,a,m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament);var l=m.singer.justMeasuring.length,u=pitchToNumber(o[0],o[1],m.singer.keySignature)-m.singer.pitchNumberOffset;m.singer.firstPitch.length<l?m.singer.firstPitch.push(u):m.singer.lastPitch.length<l&&m.singer.lastPitch.push(u)}else if(p.logo.inPitchDrumMatrix){"rest"!==e.toLowerCase()&&(p.logo.pitchDrumMatrix.addRowBlock(i),p.logo.pitchBlocks.includes(i)||p.logo.pitchBlocks.push(i));for(var h=0<m.singer.duplicateFactor.length?m.singer.duplicateFactor:1,c=0;c<h;c++){var v=2*y+m.singer.transposition,d=m.singer.arpeggio.length,f=v+r;0<d&&c<d&&(f+=m.singer.arpeggio[c]);var b=getNote(e,t,f,m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament);b[0]=noteIsSolfege(e)?getSolfege(b[0]):b[0],0<m.singer.drumStyle.length?p.logo.pitchDrumMatrix.drums.push(last(m.singer.drumStyle)):(p.logo.pitchDrumMatrix.rowLabels.push(b[0]),p.logo.pitchDrumMatrix.rowArgs.push(b[1]))}}else if(p.logo.inMatrix){"rest"!==e.toLowerCase()&&(p.logo.phraseMaker.addRowBlock(i),p.logo.pitchBlocks.includes(i)||p.logo.pitchBlocks.push(i));for(var N=0<m.singer.duplicateFactor.length?m.singer.duplicateFactor:1,k=0;k<N;k++){var T=2*y+m.singer.transposition,S=m.singer.arpeggio.length,P=T+r;0<S&&k<S&&(P+=m.singer.arpeggio[k]);var O=getNote(e,t,P,m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament);m.singer.previousNotePlayed=m.singer.lastNotePlayed,m.singer.lastNotePlayed=[O[0]+O[1],4],"C"===m.singer.keySignature[0]&&"major"===m.singer.keySignature[1].toLowerCase()&&noteIsSolfege(e)&&(O[0]=getSolfege(O[0])),0<m.singer.drumStyle.length?(p.logo.phraseMaker.rowLabels.push(last(m.singer.drumStyle)),p.logo.phraseMaker.rowArgs.push(-1)):(p.logo.phraseMaker.rowLabels.push(O[0]),p.logo.phraseMaker.rowArgs.push(O[1]))}}else if(p.logo.inLegoWidget&&!p.logo.inMatrix){"rest"!==e.toLowerCase()&&(p.logo.legoWidget.addRowBlock(i),p.logo.pitchBlocks.includes(i)||p.logo.pitchBlocks.push(i));for(var C=0<m.singer.duplicateFactor.length?m.singer.duplicateFactor:1,B=0;B<C;B++){var M=2*y+m.singer.transposition,w=m.singer.arpeggio.length,A=M+r;0<w&&B<w&&(A+=m.singer.arpeggio[B]);var D=getNote(e,t,A,m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament);m.singer.previousNotePlayed=m.singer.lastNotePlayed,m.singer.lastNotePlayed=[D[0]+D[1],4],"C"===m.singer.keySignature[0]&&"major"===m.singer.keySignature[1].toLowerCase()&&noteIsSolfege(e)&&(D[0]=getSolfege(D[0])),0<m.singer.drumStyle.length?(p.logo.legoWidget.rowLabels.push(last(m.singer.drumStyle)),p.logo.legoWidget.rowArgs.push(-1)):(p.logo.legoWidget.rowLabels.push(D[0]),p.logo.legoWidget.rowArgs.push(D[1]))}}else if(0<m.singer.inNoteBlock.length){m.singer.inverted=0<m.singer.invertList.length;for(var L=function(e,t,r,s){var i,n=2*y+m.singer.transposition,o=m.singer.arpeggio.length,g=n,a=e;0<o&&(i=getNote(e,t,0,m.singer.keySignature,m.singer.movable,s,p.errorMsg,p.logo.synth.inTemperament),isNaN(m.singer.arpeggio[m.singer.arpeggioIndex][0])?a="rest":g+=getInterval(m.singer.arpeggio[m.singer.arpeggioIndex][0],m.singer.keySignature,i[0])+m.singer.arpeggio[m.singer.arpeggioIndex][1],m.singer.arpeggioIndex+=1,m.singer.arpeggioIndex===o&&(m.singer.arpeggioIndex=0)),i=getNote(a,t,g+12*m.singer.register,m.singer.keySignature,m.singer.movable,s,p.errorMsg,p.logo.synth.inTemperament);for(var l,u,h=1,c=0;c<m.singer.transpositionRatios.length;c++)h*=m.singer.transpositionRatios[c];return 1!=h&&(l=pitchToFrequency(i[0],i[1],i[2],m.singer.keySignature),i=frequencyToPitch(l*h)),0!==i[2]&&0===r&&(r=i[2]),0<m.singer.drumStyle.length&&(u=last(m.singer.drumStyle),m.singer.pitchDrumTable[i[0]+i[1]]=u),m.singer.notePitches[last(m.singer.inNoteBlock)].push(i[0]),m.singer.noteOctaves[last(m.singer.inNoteBlock)].push(i[1]),m.singer.noteCents[last(m.singer.inNoteBlock)].push(r),m.singer.noteHertz[last(m.singer.inNoteBlock)].push(0===r?0:pitchToFrequency(i[0],i[1],r,m.singer.keySignature)),i},I=L(e,t,r),F=0;F<m.singer.intervals.length;F++){var x=getNote(I[0],I[1],getInterval(m.singer.intervals[F],m.singer.keySignature,I[0]),m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament);L(x[0],x[1],r)}for(var V=0;V<m.singer.semitoneIntervals.length;V++){var _=getNote(I[0],I[1],m.singer.semitoneIntervals[V][0],m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament);L(_[0],_[1],r,m.singer.semitoneIntervals[V][1])}for(var E=0;E<m.singer.chordIntervals.length;E++){var j=getNote(I[0],I[1],getInterval(m.singer.chordIntervals[E][0],m.singer.keySignature,I[0])+m.singer.chordIntervals[E][1],m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament);L(j[0],j[1],r)}for(var R=0;R<m.singer.ratioIntervals.length;R++){var H=pitchToFrequency(I[0],I[1],0,m.singer.keySignature)*m.singer.ratioIntervals[R],q=frequencyToPitch(H);L(q[0],q[1],q[2])}0<m.singer.inNoteBlock.length&&m.singer.noteBeatValues[last(m.singer.inNoteBlock)].push(m.singer.beatFactor),m.singer.pushedNote=!0}else if(0<m.singer.drumStyle.length){var z=last(m.singer.drumStyle),W=m.singer.transposition,U=getNote(e,t,W,m.singer.keySignature,m.singer.movable,null,p.errorMsg);m.singer.pitchDrumTable[U[0]+U[1]]=z}else if(p.logo.inPitchStaircase){for(var J=pitchToFrequency(e,t,0,m.singer.keySignature),K=getNote(e,t,0,m.singer.keySignature,m.singer.movable,null,p.errorMsg),G=0;G<p.logo.pitchStaircase.Stairs.length;G++){if(p.logo.pitchStaircase.Stairs[G][2]<parseFloat(J))return void p.logo.pitchStaircase.Stairs.splice(G,0,[K[0],K[1],parseFloat(J),1,1]);if(p.logo.pitchStaircase.Stairs[G][2]===parseFloat(J))return void p.logo.pitchStaircase.Stairs.splice(G,1,[K[0],K[1],parseFloat(J),1,1])}p.logo.pitchStaircase.Stairs.push([K[0],K[1],parseFloat(J),1,1]),p.logo.pitchStaircase.stairPitchBlocks.push(i)}else if(p.logo.inMusicKeyboard){var Y=2*y+m.singer.transposition,X=getNote(e,t,Y,m.singer.keySignature,m.singer.movable,null,p.errorMsg);X[0]=noteIsSolfege(e)?getSolfege(X[0]):X[0],0===m.singer.drumStyle.length&&(p.logo.musicKeyboard.instruments.push(last(m.singer.instrumentNames)),p.logo.musicKeyboard.noteNames.push(X[0]),p.logo.musicKeyboard.octaves.push(X[1]),p.logo.musicKeyboard.addRowBlock(i),m.singer.lastNotePlayed=[o[0]+o[1],4])}else{p.logo.clearNoteParams(m,i,[]),void 0===m.singer.currentCalculatedOctave&&(m.singer.currentCalculatedOctave=4),m.singer.inNoteBlock.push(i),m.singer.inverted=0<m.singer.invertList.length;for(var $=function(e,t,r,s){var i,n=2*y+m.singer.transposition,o=getNote(e,t,n+12*m.singer.register,m.singer.keySignature,m.singer.movable,s,p.errorMsg,p.logo.synth.inTemperament);return 0<m.singer.drumStyle.length&&(i=last(m.singer.drumStyle),m.singer.pitchDrumTable[o[0]+o[1]]=i),m.singer.notePitches[last(m.singer.inNoteBlock)].push(o[0]),m.singer.noteOctaves[last(m.singer.inNoteBlock)].push(o[1]),m.singer.noteCents[last(m.singer.inNoteBlock)].push(r),m.singer.noteHertz[last(m.singer.inNoteBlock)].push(0===r?0:pitchToFrequency(o[0],o[1],r,m.singer.keySignature)),o},Q=$(e,t,r),Z=0;Z<m.singer.intervals.length;Z++){var ee=getNote(Q[0],Q[1],getInterval(m.singer.intervals[Z],m.singer.keySignature,Q[0]),m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament);$(ee[0],ee[1],r)}for(var te=0;te<m.singer.semitoneIntervals.length;te++){var re=getNote(Q[0],Q[1],m.singer.semitoneIntervals[te][0],m.singer.keySignature,m.singer.movable,null,p.errorMsg,p.logo.synth.inTemperament);$(re[0],re[1],r,m.singer.semitoneIntervals[te][1])}0<m.singer.inNoteBlock.length&&m.singer.noteBeatValues[last(m.singer.inNoteBlock)].push(m.singer.beatFactor),m.singer.pushedNote=!0,Te.processNote(p,m.singer.defaultNoteValue,!1,i,s,function(){m.singer.inNoteBlock.splice(m.singer.inNoteBlock.indexOf(i),1)})}}},{key:"processNote",value:function(V,E,e,j,R,t){var r,s,H=V.turtles.ithTurtle(R),q=TONEBPM/(0<H.singer.bpm.length?last(H.singer.bpm):Te.masterBPM),z=Number(last(H.singer.bpm)),W=e?0===E?0:1e3*q/E:E,U=0,J=0,K=0,G=0,Y=0,X=0,$=0,Q=0,Z=0,ee=0,te=0,re=0,se=[],ie=[],ne=[],oe=0,ge=0,ae=!1,le=!1,ue=!1,he=!1,ce=!1,pe=!1,me=null,i=!1,ye=0;if(H.inSetTimbre&&last(H.singer.instrumentNames)&&((r=last(H.singer.instrumentNames))in instrumentsEffects[R]&&((s=instrumentsEffects[R][r]).vibratoActive&&(U=s.vibratoRate,K=s.vibratoIntensity,ae=!0),s.distortionActive&&(G=s.distortionAmount,le=!0),s.tremoloActive&&(Y=s.tremoloFrequency,X=s.tremoloDepth,ue=!0),s.phaserActive&&($=s.rate,Q=s.octaves,Z=s.baseFrequency,he=!0),s.chorusActive&&(ee=s.chorusRate,te=s.delayTime,re=s.chorusDepth,ce=!0)),r in instrumentsFilters[R]&&(me=instrumentsFilters[R][r])),0<H.singer.vibratoRate.length&&(U=last(H.singer.vibratoRate),K=last(H.singer.vibratoIntensity),ae=!0),0<H.singer.distortionAmount.length&&(G=last(H.singer.distortionAmount),le=!0),0<H.singer.tremoloDepth.length&&(Y=last(H.singer.tremoloFrequency),X=last(H.singer.tremoloDepth),ue=!0),0<H.singer.rate.length&&($=last(H.singer.rate),Q=last(H.singer.octaves),Z=last(H.singer.baseFrequency),he=!0),0<H.singer.chorusRate.length&&(ee=last(H.singer.chorusRate),te=last(H.singer.delayTime),re=last(H.singer.chorusDepth),ce=!0),se=[1],0<H.singer.inHarmonic.length&&(0===se.length?V.errorMsg(_("You must have at least one Partial block inside of a Weighted-partial block")):se=last(H.singer.partials)),0<H.singer.inNeighbor.length){for(var n=H.singer.neighborArgNote1.length,o=0;o<n;o++)ie.push(H.singer.neighborArgNote1.pop()),ne.push(H.singer.neighborArgNote2.pop());oe=q/last(H.singer.neighborArgBeat),ge=q/last(H.singer.neighborArgCurrentBeat),pe=!0}var g,ve=0;if(0<H.singer.inCrescendo.length&&0===H.singer.crescendoDelta.length)for(var a in H.singer.inCrescendo.pop(),H.singer.synthVolume)Te.setSynthVolume(V.logo,R,DEFAULTVOICE,last(H.singer.synthVolume[a]));else if(0<H.singer.crescendoDelta.length)for(var l in last(H.singer.synthVolume[DEFAULTVOICE])===last(H.singer.crescendoInitialVolume[DEFAULTVOICE])&&0===H.singer.justCounting.length&&V.logo.notation.notationBeginCrescendo(R,last(H.singer.crescendoDelta)),H.singer.synthVolume){var u=last(H.singer.synthVolume[l]),h=H.singer.synthVolume[l].length;H.singer.synthVolume[l][h-1]+=last(H.singer.crescendoDelta),H.singer.suppressOutput||(Te.setSynthVolume(V.logo,R,l,u),V.logo.synth.rampTo(R,l,u,last(H.singer.synthVolume[l]),q/W))}if(V.logo.inTimbre){var c=getNote(H.singer.notePitches[last(H.singer.inNoteBlock)][0],H.singer.noteOctaves[last(H.singer.inNoteBlock)][0],0,H.singer.keySignature,H.singer.movable,null,V.errorMsg);V.logo.timbre.notesToPlay.push([c[0]+c[1],1/W]),H.singer.previousNotePlayed=H.singer.lastNotePlayed,H.singer.lastNotePlayed=[c[0]+c[1],W]}else if(V.logo.inArpeggio){var p=getNote(H.singer.notePitches[last(H.singer.inNoteBlock)][0],H.singer.noteOctaves[last(H.singer.inNoteBlock)][0],0,H.singer.keySignature,H.singer.movable,null,V.errorMsg);V.logo.arpeggio.notesToPlay.push([p[0]+p[1],1/W]),H.singer.previousNotePlayed=H.singer.lastNotePlayed,H.singer.lastNotePlayed=[p[0]+p[1],W]}else if(V.logo.inMatrix||V.logo.tuplet){if(0<H.singer.inNoteBlock.length){V.logo.phraseMaker.addColBlock(j,1);for(var m=V.logo.phraseMaker.blockNo||-1,y=0;y<V.logo.pitchBlocks.length;y++)V.logo.phraseMaker.addNode(V.logo.pitchBlocks[y],j,0,m);for(var v=0;v<V.logo.drumBlocks.length;v++)V.logo.phraseMaker.addNode(V.logo.drumBlocks[v],j,0,m)}}else if(V.logo.inLegoWidget&&!V.logo.inMatrix){H.singer.inNoteBlock.length,W*=H.singer.beatFactor,V.logo.tuplet?V.logo.addingNotesToTuplet?(g=V.logo.tupletRhythms.length-1,V.logo.tupletRhythms[g].push(W)):(V.logo.tupletRhythms.push(["notes",V.logo.tupletParams.length-1,W]),V.logo.addingNotesToTuplet=!0):V.logo.tupletRhythms.push(["",1,W])}else{null===V.logo.firstNoteTime&&(V.logo.firstNoteTime=(new Date).getTime());var d,f=((new Date).getTime()-V.logo.firstNoteTime)/1e3,b=0===H.singer.drift?Math.max(f-H.singer.turtleTime,0):0,de=H.singer.tie?H.singer.tieCarryOver:0;if(H.singer.tie){var N=last(H.singer.inNoteBlock);if(0<H.singer.tieCarryOver){var k=!0;if(H.singer.tieNotePitches.length!==H.singer.notePitches[last(H.singer.inNoteBlock)].length)k=!1;else for(var T=0;T<H.singer.tieNotePitches.length;T++)if(H.singer.tieNotePitches[T][0]!=H.singer.notePitches[last(H.singer.inNoteBlock)][T]||H.singer.tieNotePitches[T][1]!=H.singer.noteOctaves[last(H.singer.inNoteBlock)][T]){k=!1;break}if(!k){V.errorMsg(_("You can only tie notes of the same pitch. Did you mean to use slur?"),N);for(var S=[],P=0;P<H.singer.notePitches[last(H.singer.inNoteBlock)].length;P++)S.push([H.singer.notePitches[N][P],H.singer.noteOctaves[N][P],H.singer.noteCents[N][P],H.singer.noteHertz[N][P],N]);var O=[N,H.singer.oscList[N],H.singer.noteBeat[N],H.singer.noteBeatValues[N],H.singer.noteDrums[N],H.singer.embeddedGraphics[N]],N=H.singer.tieNoteExtras[0];H.singer.inNoteBlock.push(N),H.singer.notePitches[N]=[],H.singer.noteOctaves[N]=[],H.singer.noteCents[N]=[],H.singer.noteHertz[N]=[];for(var C=0;C<H.singer.tieNotePitches.length;C++)H.singer.notePitches[N].push(H.singer.tieNotePitches[C][0]),H.singer.noteOctaves[N].push(H.singer.tieNotePitches[C][1]),H.singer.noteCents[N].push(H.singer.tieNotePitches[C][2]),H.singer.noteHertz[N].push(H.singer.tieNotePitches[C][3]);if(H.singer.oscList[N]=H.singer.tieNoteExtras[1],H.singer.noteBeat[N]=H.singer.tieNoteExtras[2],H.singer.noteBeatValues[N]=H.singer.tieNoteExtras[3],H.singer.noteDrums[N]=H.singer.tieNoteExtras[4],H.singer.embeddedGraphics[N]=H.singer.tieNoteExtras[5],0===H.singer.justCounting.length)for(var B=0;B<H.singer.notePitches[N].length;B++)V.logo.notation.notationRemoveTie(R);H.singer.tie=!1,de=0,Te.processNote(V,H.singer.tieCarryOver,!1,N,R),H.singer.inNoteBlock.pop(),H.singer.suppressOutput||H.doWait(Math.max(q/H.singer.tieCarryOver-b,0)),de=H.singer.tieCarryOver,H.singer.tieCarryOver=0,H.singer.tie=!0,N=O[0],H.singer.notePitches[N]=[],H.singer.noteOctaves[N]=[],H.singer.noteCents[N]=[],H.singer.noteHertz[N]=[];for(var M=0;M<S.length;M++)H.singer.notePitches[N].push(S[M][0]),H.singer.noteOctaves[N].push(S[M][1]),H.singer.noteCents[N].push(S[M][2]),H.singer.noteHertz[N].push(S[M][3]);H.singer.oscList[N]=O[1],H.singer.noteBeat[N]=O[2],H.singer.noteBeatValues[N]=O[3],H.singer.noteDrums[N]=O[4],H.singer.embeddedGraphics[N]=O[5]}}if(0===H.singer.tieCarryOver){H.singer.tieNotePitches=[],H.singer.tieCarryOver=W;for(var w=0;w<H.singer.notePitches[N].length;w++)H.singer.tieNotePitches.push([H.singer.notePitches[N][w],H.singer.noteOctaves[N][w],H.singer.noteCents[N][w],H.singer.noteHertz[N][w]]);H.singer.tieNoteExtras=[N,H.singer.oscList[N],H.singer.noteBeat[N],H.singer.noteBeatValues[N],H.singer.noteDrums[N],[]],H.singer.tieFirstDrums=H.singer.noteDrums[N],W=0}else ve=H.singer.tieCarryOver,W=1/(1/W+1/H.singer.tieCarryOver),H.singer.tieCarryOver=0}0<H.singer.swing.length&&(null==last(H.singer.swingTarget)&&(H.singer.swingTarget[H.singer.swingTarget.length-1]=W),d=last(H.singer.swing),W===last(H.singer.swingTarget)&&(0===H.singer.swingCarryOver?(W=1/(1/W+1/d),H.singer.swingCarryOver=d):(W=W===d?0:1/(1/W-1/d),H.singer.swingCarryOver=0),W<0&&(W=0)));var fe=W;if(0<fe)if(H.singer.previousTurtleTime=H.singer.turtleTime,1===H.singer.inNoteBlock.length)H.singer.turtleTime+=q/fe,H.singer.suppressOutput||H.doWait(Math.max(q/fe-b,0)),H.singer.delayedNotes=[];else{i=!0;for(var A=ye=0;A<H.singer.delayedNotes.length&&(0<A&&(ye+=q*H.singer.delayedNotes[A-1][1]),H.singer.delayedNotes[A][0]!==j);A++);console.log("Note in note "+j+" delay "+ye)}var be=!1;1<H.singer.skipFactor&&(0<H.singer.skipIndex%H.singer.skipFactor&&(be=!0),H.singer.skipIndex+=1);var Ne=[],ke=[];if((null!==last(H.singer.inNoteBlock)||i)&&(function(){var e=last(H.singer.inNoteBlock);if(void 0!==H.singer.notePitches[e]){if(1<H.singer.notePitches[e].length)for(;H.singer.notePitches[e].includes("rest");)H.singer.notePitches[e].splice(H.singer.notePitches[e].indexOf("rest"),1);if(0===H.singer.notePitches[e].length&&H.singer.notePitches[last(H.singer.inNoteBlock)].push("rest"),!V.logo.stopTurtle){H.singer.inNoteBlock.length===H.singer.whichNoteToCount&&(H.singer.notesPlayed=rationalSum(H.singer.notesPlayed,[1,E]),H.singer.tallyNotes++);var t=[],r=[];if(H.singer.noteBeat[j]=W,isFinite(fe)){var s,i=0<H.singer.glide.length?last(H.singer.glide):0,n=q/W;0<H.singer.staccato.length&&(n=(s=last(H.singer.staccato))<0?q*(1/W-1/s):W<s?q/s:q/W),ae&&(J=n*(fe/U));for(var o,g,a=[],l=0;l<H.singer.notePitches[e].length;l++){var u=H.singer.notePitches[e][l],h=!1;if(1===u.length)for(var c=0;c<H.singer.notePitches[e].length;c++)l!==c&&H.singer.noteOctaves[e][l]===H.singer.noteOctaves[e][c]&&(u+"♯"!==H.singer.notePitches[e][c]&&u+"♭"!==H.singer.notePitches[e][c]||(h=!0));a.push(h)}if(0<H.singer.notePitches[e].length){for(var p,m,y=0;y<H.singer.notePitches[e].length;y++){"rest"===H.singer.notePitches[e][y]||be?(g="R",H.singer.previousNotePlayed=H.singer.lastNotePlayed):(o=getNote(H.singer.notePitches[e][y],H.singer.noteOctaves[e][y],0,H.singer.keySignature,H.singer.movable,null,V.errorMsg,V.logo.synth.inTemperament),g=0!==H.singer.noteCents[e][y]?0!==H.singer.noteHertz[e][y]?H.singer.noteHertz[e][y]:Math.floor(pitchToFrequency(o[0],o[1],H.singer.noteCents[e][y],H.singer.keySignature)):o[0]+o[1]),"R"!==g&&(0<(p=se.indexOf(1))&&(g=noteToFrequency(g,H.singer.keySignature)*(p+1)),t.push(g)),0<fe?(0<ve&&0===y&&0===H.singer.justCounting.length&&V.logo.notation.notationInsertTie(R),0===H.singer.justCounting.length&&(0<H.singer.noteDrums[e].length?(Ne.includes(g)||Ne.push(g),ke.includes(H.singer.noteDrums[e][0])||ke.push(H.singer.noteDrums[e][0])):a[y]?Ne.includes(g+"♮")||Ne.push(g+"♮"):Ne.includes(g)||Ne.push(g))):0<H.singer.tieCarryOver&&0===H.singer.justCounting.length&&(a[y],Ne.includes(g)||Ne.push(g)),y===H.singer.notePitches[e].length-1&&(m=void 0,0<fe?m=0<ve?1/(1/fe-1/ve):fe:0<H.singer.tieCarryOver&&(m=H.singer.tieCarryOver),(V.logo.runningLilypond||V.logo.runningMxml||V.logo.runningAbc||V.logo.runningMIDI)&&(V.logo.notationMIDI(Ne,ke,m,R,z||90,last(H.singer.instrumentNames)),V.logo.updateNotation(Ne,m,R,-1,ke)))}for(var v=isCustomTemperament(V.logo.synth.inTemperament)?V.logo.synth.getCustomFrequency(t):V.logo.synth.getFrequency(t,V.logo.synth.changeInTemperament),d=V.logo.synth.startingPitch,f=pitchToFrequency(d.substring(0,d.length-1),Number(d.slice(-1)),0,null),b=getTemperament(V.logo.synth.inTemperament).pitchNumber,N=[],k=[],T=[],S=[],P=0;P<v.length;P++)void 0!==v[P]&&(N[P]=v[P]/f,k[P]=(b*(Math.log10(N[P])/Math.log10(getOctaveRatio()))).toFixed(0),T[P]=rationalToFraction(N[P])[0],S[P]=rationalToFraction(N[P])[1]);if(H.singer.suppressOutput||H.blink(fe,last(Te.masterVolume)),0<t.length){var O=t[0].length;"number"==typeof t[0]?H.singer.currentOctave=frequencyToPitch(t[0])[1]:H.singer.currentOctave=parseInt(t[0].slice(O-1)),H.singer.currentCalculatedOctave=H.singer.currentOctave;for(var C=0;C<t.length;C++)"string"==typeof t[C]&&(t[C]=t[C].replace(/♭/g,"b").replace(/♯/g,"#"));if(0<fe&&!be){var B={doVibrato:ae,doDistortion:le,doTremolo:ue,doPhaser:he,doChorus:ce,doPartials:!0,doPortamento:!0,doNeighbor:pe,vibratoIntensity:K,vibratoFrequency:J,distortionAmount:G,tremoloFrequency:Y,tremoloDepth:X,rate:$,octaves:Q,baseFrequency:Z,chorusRate:ee,delayTime:te,chorusDepth:re,partials:se,portamento:i,neighborArgNote1:ie,neighborArgNote2:ne,neighborArgBeat:oe,neighborArgCurrentBeat:ge},M=!1;if(0<H.singer.drumStyle.length&&j in V.blocks.blockList)for(var w=V.blocks.blockList[j].connections[0],w=V.blocks.blockList[w];"setdrum"!==w.name;){if("settimbre"===w.name){M=!0;break}if(null===(w=w.connections[0]))break;w=V.blocks.blockList[w]}if(0<H.singer.oscList[e].length)1<t.length&&V.errorMsg(last(H.singer.oscList[e])+": "+_("synth cannot play chords."),j),H.singer.suppressOutput||V.logo.synth.trigger(R,t,n,last(H.singer.oscList[e]),B,null,!1,ye);else if(0<H.singer.drumStyle.length&&!M)H.singer.suppressOutput||V.logo.synth.trigger(R,t,n,last(H.singer.drumStyle),null,null,!1,ye);else for(var A,D=0;D<t.length;D++){t[D]in H.singer.pitchDrumTable&&!M?H.singer.suppressOutput||V.logo.synth.trigger(R,t[D],n,H.singer.pitchDrumTable[t[D]],null,null,!1,ye):last(H.singer.instrumentNames)?H.singer.suppressOutput||(0<H.singer.glide.length?0===H.singer.glideOverride?V.logo.synth.trigger(R,t[D],n,last(H.singer.instrumentNames),B,me,!0,ye):(A=q/H.singer.glideOverride,V.logo.synth.trigger(R,t[D],A,last(H.singer.instrumentNames),B,me,!1,ye),H.singer.glideOverride=0):V.logo.synth.trigger(R,t[D],n,last(H.singer.instrumentNames),B,me,!1,ye)):0<H.singer.voices.length&&last(H.singer.voices)?H.singer.suppressOutput||V.logo.synth.trigger(R,t[D],n,last(H.singer.voices),B,null,!1,ye):H.singer.suppressOutput||V.logo.synth.trigger(R,t[D],n,DEFAULTVOICE,B,null,!1,ye)}}H.singer.previousNotePlayed=H.singer.lastNotePlayed,H.singer.lastNotePlayed=[t[0],W],H.singer.noteStatus=[t,W],H.singer.lastPitchPlayed=H.singer.lastNotePlayed}}if(0<H.singer.noteDrums[e].length){for(var L=0;L<H.singer.noteDrums[e].length;L++)r.push(H.singer.noteDrums[e][L]);for(var I,F=0;F<H.singer.tieFirstDrums.length;F++)r.includes(H.singer.tieFirstDrums[F])||r.push(H.singer.tieFirstDrums[F]);if(0===H.singer.notePitches[e].length&&(H.singer.suppressOutput||H.blink(fe,last(Te.masterVolume))),H.singer.tie&&0<H.singer.tieCarryOver||0<fe){if(H.singer.tie&&0===W?I=0:(I=n,0<de&&(H.singer.tieFirstDrums=[])),0<I&&!be)for(var x=0;x<r.length;x++)0<H.singer.drumStyle.length?H.singer.suppressOutput||V.logo.synth.trigger(R,["C2"],I,last(H.singer.drumStyle),null,null,!1,ye):H.singer.suppressOutput||V.logo.synth.trigger(R,["C2"],I,r[x],null,null,!1,ye);0===t.length&&(H.singer.previousNotePlayed=H.singer.lastNotePlayed,H.singer.lastNotePlayed=["C2",W],H.singer.noteStatus=[["C2"],W],H.singer.lastPitchPlayed=H.singer.lastNotePlayed)}}H.singer.suppressOutput||be||V.logo.synth.start(),H.singer.tie&&0===W?0<de?V.logo.dispatchTurtleSignals(R,q/H.singer.tieCarryOver,j,q/de):V.logo.dispatchTurtleSignals(R,q/H.singer.tieCarryOver,j,0):0<de?V.logo.dispatchTurtleSignals(R,n-q/de,j,q/de):V.logo.dispatchTurtleSignals(R,n,j,0),H.singer.embeddedGraphics[j]=[],setTimeout(function(){V.blocks.visible&&j in V.blocks.blockList&&V.blocks.unhighlight(j)},1e3*n)}}}}(),0<V.logo.specialArgs.length)){for(var D=V.logo.specialArgs.pop(),L=D[3],I=[],F=1;F<=V.blocks.blockList[L].protoblock.args;F++)"in"===V.blocks.blockList[L].protoblock.dockTypes[F]?null!==V.blocks.blockList[L].connections[F]&&I.push(V.blocks.blockList[L].connections[F]):I.push(V.logo.parseArg(V.logo,D[2],V.blocks.blockList[L].connections[F],L,D[4]));"function"==typeof V.blocks.blockList[L].protoblock.flow&&V.blocks.blockList[L].protoblock.flow(I,D[1],D[2],D[3],D[4],D[5],D[6])}}H.singer.pushedNote=!1,null!=t&&t(),V.stage.update()}}]),Te}();_defineProperty(Singer,"masterBPM",TARGETBPM),_defineProperty(Singer,"defaultBPMFactor",TONEBPM/TARGETBPM),_defineProperty(Singer,"masterVolume",[DEFAULTVOLUME]),"undefined"!=typeof module&&module.exports&&(module.exports=Singer);