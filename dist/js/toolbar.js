"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var WRAP=!0,$j=jQuery.noConflict(),play_button_debounce_timeout=null,Toolbar=function(){function e(){var o=this;_classCallCheck(this,e),_defineProperty(this,"disableTooltips",function(e){e(".tooltipped").tooltip("remove"),o.tooltipsDisabled=!0}),_defineProperty(this,"closeAuxToolbar",function(e){var t,n=docById("aux-toolbar");"block"===n.style.display&&(e(o.activity,!1),t=docById("menu"),n.style.display="none",t.innerHTML="menu",docById("toggleAuxBtn").className-="blue darken-1")}),this.stopIconColorWhenPlaying=window.platformColor.stopIconcolor,this.language=localStorage.languagePreference,void 0===this.language&&(this.language=navigator.language),this.tooltipsDisabled=!1}return _createClass(e,[{key:"init",value:function(e){var t,n;this.activity=e,n=_THIS_IS_MUSIC_BLOCKS_?(t=[["mb-logo",_("About Music Blocks")],["play",_("Play")],["stop",_("Stop")],["record",_("Record")],["Full screen",_("Full screen")],["FullScreen",_("Full screen")],["Toggle Fullscreen",_("Toggle Fullscreen")],["newFile",_("New project")],["load",_("Load project from file")],["saveButton",_("Save project")],["saveButtonAdvanced",_("Save project as HTML")],["planetIcon",_("Find and share projects")],["planetIconDisabled",_("Offline. Sharing is unavailable")],["toggleAuxBtn",_("Auxiliary menu")],["helpIcon",_("Help")],["runSlowlyIcon",_("Run slowly")],["runStepByStepIcon",_("Run step by step")],["displayStatsIcon",_("Display statistics")],["loadPluginIcon",_("Load plugin")],["delPluginIcon",_("Delete plugin")],["enableHorizScrollIcon",_("Enable horizontal scrolling")],["disableHorizScrollIcon",_("Disable horizontal scrolling")],["themeSelectIcon",_("Change theme")],["light",_("Light Mode")],["dark",_("Dark Mode")],["mergeWithCurrentIcon",_("Merge with current project")],["chooseKeyIcon",_("Set Pitch Preview")],["toggleJavaScriptIcon",_("JavaScript Editor")],["restoreIcon",_("Restore")],["beginnerMode",_("Switch to beginner mode")],["advancedMode",_("Switch to advanced mode")],["languageSelectIcon",_("Select language")],["save-html-beg",_("Save project as HTML"),"innerHTML"],["save-png-beg",_("Save mouse artwork as PNG"),"innerHTML"],["save-html",_("Save project as HTML"),"innerHTML"],["save-midi",_("Save project as MIDI"),"innerHTML"],["save-svg",_("Save mouse artwork as SVG"),"innerHTML"],["save-png",_("Save mouse artwork as PNG"),"innerHTML"],["save-wav",_("Save music as WAV"),"innerHTML"],["save-abc",_("Save sheet music as ABC"),"innerHTML"],["save-ly",_("Save sheet music as Lilypond"),"innerHTML"],["save-mxml",_("Save sheet music as MusicXML"),"innerHTML"],["save-blockartwork-svg",_("Save block artwork as SVG"),"innerHTML"],["save-blockartwork-png",_("Save block artwork as PNG"),"innerHTML"],["new-project",_("Confirm"),"innerHTML"],["enUS",_("English (United States)"),"innerHTML"],["enUK",_("English (United Kingdom)"),"innerHTML"],["ja",_("日本語"),"innerHTML"],["ko",_("한국어"),"innerHTML"],["es",_("español"),"innerHTML"],["pt",_("português"),"innerHTML"],["kana",_("にほんご"),"innerHTML"],["zhCN",_("中文"),"innerHTML"],["th",_("ภาษาไทย"),"innerHTML"],["tr",_("Turkish"),"innerHTML"],["ayc",_("aymara"),"innerHTML"],["quz",_("quechua"),"innerHTML"],["gug",_("guarani"),"innerHTML"],["hi",_("हिंदी"),"innerHTML"],["ibo",_("igbo"),"innerHTML"],["ar",_("عربى"),"innerHTML"],["te",_("తెలుగు"),"innerHTML"],["he",_("עִברִית"),"innerHTML"],["ur",_("اردو"),"innerHTML"]],[_("About Music Blocks"),_("Play"),_("Stop"),_("Record"),_("Full screen"),_("Full screen"),_("Toggle Fullscreen"),_("New project"),_("Load project from file"),_("Save project"),_("Save project"),_("Find and share projects"),_("Offline. Sharing is unavailable"),_("Auxiliary menu"),_("Help"),_("Run slowly"),_("Run step by step"),_("Display statistics"),_("Load plugin"),_("Delete plugin"),_("Enable horizontal scrolling"),_("Disable horizontal scrolling"),_("Change theme"),_("Light Mode"),_("Dark Mode"),_("Merge with current project"),_("Set Pitch Preview"),_("JavaScript Editor"),_("Restore"),_("Switch to beginner mode"),_("Switch to advanced mode"),_("Select language"),_("Save project as HTML"),_("Save project as MIDI"),_("Save mouse artwork as SVG"),_("Save mouse artwork as PNG"),_("Save music as WAV"),_("Save sheet music as ABC"),_("Save sheet music as Lilypond"),_("Save block artwork as SVG"),_("Save block artwork as PNG"),_("Confirm"),_("Select language"),_("Save project as HTML"),_("Save turtle artwork as PNG"),_("Save project as HTML"),_("Save turtle artwork as SVG"),_("Save turtle artwork as PNG"),_("Save block artwork as SVG"),_("Save block artwork as PNG"),_("Confirm"),_("English (United States)"),_("English (United Kingdom)"),_("日本語"),_("한국인"),_("español"),_("português"),_("にほんご"),_("中文"),_("ภาษาไทย"),_("Turkish"),_("aymara"),_("quechua"),_("guarani"),_("हिंदी"),_("తెలుగు"),_("igbo"),_("عربى"),_("עִברִית"),_("اردو")]):(t=[["mb-logo",_("About Turtle Blocks")],["play",_("Play")],["stop",_("Stop")],["record",_("Record")],["Full screen",_("Full screen")],["FullScreen",_("Full screen")],["Toggle Fullscreen",_("Toggle Fullscreen")],["newFile",_("New project")],["load",_("Load project from file")],["saveButton",_("Save project")],["saveButtonAdvanced",_("Save project as HTML")],["planetIcon",_("Find and share projects")],["planetIconDisabled",_("Offline. Sharing is unavailable")],["toggleAuxBtn",_("Auxiliary menu")],["helpIcon",_("Help")],["runSlowlyIcon",_("Run slowly")],["runStepByStepIcon",_("Run step by step")],["displayStatsIcon",_("Display statistics")],["loadPluginIcon",_("Load plugin")],["delPluginIcon",_("Delete plugin")],["enableHorizScrollIcon",_("Enable horizontal scrolling")],["disableHorizScrollIcon",_("Disable horizontal scrolling")],["themeSelectIcon",_("Change theme")],["light",_("Light Mode")],["dark",_("Dark Mode")],["mergeWithCurrentIcon",_("Merge with current project")],["toggleJavaScriptIcon",_("JavaScript Editor")],["restoreIcon",_("Restore")],["beginnerMode",_("Switch to beginner mode")],["advancedMode",_("Switch to advanced mode")],["languageSelectIcon",_("Select language")],["save-html-beg",_("Save project as HTML"),"innerHTML"],["save-png-beg",_("Save turtle artwork as PNG"),"innerHTML"],["save-html",_("Save project as HTML"),"innerHTML"],["save-svg",_("Save turtle artwork as SVG"),"innerHTML"],["save-png",_("Save turtle artwork as PNG"),"innerHTML"],["save-blockartwork-svg",_("Save block artwork as SVG"),"innerHTML"],["save-blockartwork-png",_("Save block artwork as PNG"),"innerHTML"],["new-project",_("Confirm"),"innerHTML"],["enUS",_("English (United States)"),"innerHTML"],["enUK",_("English (United Kingdom)"),"innerHTML"],["ja",_("日本語"),"innerHTML"],["ko",_("한국인"),"innerHTML"],["es",_("español"),"innerHTML"],["pt",_("português"),"innerHTML"],["kana",_("にほんご"),"innerHTML"],["zhCN",_("中文"),"innerHTML"],["th",_("ภาษาไทย"),"innerHTML"],["tr",_("Turkish"),"innerHTML"],["ayc",_("aymara"),"innerHTML"],["quz",_("quechua"),"innerHTML"],["gug",_("guarani"),"innerHTML"],["hi",_("हिंदी"),"innerHTML"],["ibo",_("igbo"),"innerHTML"],["ar",_("عربى"),"innerHTML"],["te",_("తెలుగు"),"innerHTML"],["he",_("עִברִית"),"innerHTML"],["ur",_("اردو"),"innerHTML"]],[_("About Turtle Blocks"),_("Play"),_("Stop"),_("Record"),_("Full screen"),_("Full screen"),_("Toggle Fullscreen"),_("New project"),_("Load project from file"),_("Save project"),_("Save project as HTML"),_("Find and share projects"),_("Offline. Sharing is unavailable"),_("Auxiliary menu"),_("Help"),_("Run slowly"),_("Run step by step"),_("Display statistics"),_("Load plugin"),_("Delete plugin"),_("Enable horizontal scrolling"),_("Disable horizontal scrolling"),_("Change theme"),_("Light Mode"),_("Dark Mode"),_("Merge with current project"),_("JavaScript Editor"),_("Restore"),_("Switch to beginner mode"),_("Switch to advanced mode"),_("Select language"),_("Save project as HTML"),_("Save turtle artwork as PNG"),_("Save project as HTML"),_("Save turtle artwork as SVG"),_("Save turtle artwork as PNG"),_("Save block artwork as SVG"),_("Save block artwork as PNG"),_("Confirm"),_("English (United States)"),_("English (United Kingdom)"),_("日本語"),_("한국인"),_("español"),_("português"),_("にほんご"),_("中文"),_("ภาษาไทย"),_("Turkish"),_("aymara"),_("quechua"),_("guarani"),_("हिंदी"),_("తెలుగు"),_("igbo"),_("عربى"),_("עִברִית"),_("اردو")]);var o=docById("beginnerMode"),i=docById("advancedMode");this.activity.beginnerMode?(i.style.display="block",o.style.display="none"):(i.style.display="none",o.style.display="display");for(var a=0;a<t.length;a++){var c=t[a],l=n[a],r=docById(c[0]);3===t[a].length?null!=r&&(r.innerHTML=c[1]):null!=r&&r.setAttribute("data-tooltip",l)}this.tooltipsDisabled||$j(".tooltipped").tooltip({html:!0,delay:100}),$j(".materialize-iso, .dropdown-trigger").dropdown({constrainWidth:!1,hover:!1,belowOrigin:!0})}},{key:"renderLogoIcon",value:function(e){var t=this,n=docById("mb-logo");"ja"===this.language&&(n.innerHTML='<img style="width: 100%; transform: scale(0.85);" src="images/logo-ja.svg">'),n.onmouseenter=function(){document.body.style.cursor="pointer"},n.onmouseleave=function(){document.body.style.cursor="default"},n.onclick=function(){e(t.activity)}}},{key:"renderPlayIcon",value:function(e){var t=this,n=docById("play"),o=docById("stop"),i=docById("record"),a=!1;function c(){a?(n.onclick=l,a=!1):(n.onclick=null,console.log("Wait for next 2 seconds to play the music"))}var l=n.onclick=function(){a=!1,e(t.activity),c(),o.style.color=t.stopIconColorWhenPlaying,saveButton.disabled=!0,saveButtonAdvanced.disabled=!0,saveButton.className="grey-text inactiveLink",saveButtonAdvanced.className="grey-text inactiveLink",i.className="grey-text inactiveLink",a=!0,play_button_debounce_timeout=setTimeout(function(){c()},2e3),o.addEventListener("click",function(){clearTimeout(play_button_debounce_timeout),a=!0,t.activity.hideMsgs(),c()})}}},{key:"renderStopIcon",value:function(e){var t=this,n=docById("stop"),o=docById("record");n.onclick=function(){e(t.activity),n.style.color="white",saveButton.disabled=!1,saveButtonAdvanced.disabled=!1,saveButton.className="",saveButtonAdvanced.className="",o.className=""}}},{key:"renderNewProjectIcon",value:function(e){var t=this,n=docById("modal-container"),o=docById("newdropdown");o.innerHTML="";var i=document.createElement("div");i.classList.add("new-project-title"),i.textContent=_("New project"),o.appendChild(i);var a=document.createElement("div");a.id="confirmation-message",a.textContent=_("Are you sure you want to create a new project?"),o.appendChild(a);var c=document.createElement("li"),l=document.createElement("div");l.classList.add("confirm-button"),l.id="new-project",l.textContent=_("Confirm"),c.appendChild(l),o.appendChild(c),n.style.display="flex",l.onclick=function(){n.style.display="none",e(t.activity)}}},{key:"renderLoadIcon",value:function(e){var t=this;docById("load").onclick=function(){e(t.activity)}}},{key:"renderThemeSelectIcon",value:function(t,e){var n=this,o=document.getElementById("themeSelectIcon");e.forEach(function(e){localStorage.themePreference===e&&(o.innerHTML=document.getElementById(e).innerHTML)});var i=docById("themeSelectIcon"),a=e;i.onclick=function(){a.forEach(function(e){docById(e).onclick=function(){return t["".concat(e,"_onclick")](n.activity)}})}}},{key:"renderWrapIcon",value:function(){var e=this,t=docById("wrapTurtle"),n=_("Turtle Wrap Off");t.setAttribute("data-tooltip",n),$j(".tooltipped").tooltip({html:!0,delay:100}),t.onclick=function(){(WRAP=!WRAP)?(n=_("Turtle Wrap Off"),e.activity.helpfulWheelItems.forEach(function(e){"Turtle Wrap Off"===e.label?e.display=!0:"Turtle Wrap On"===e.label&&(e.display=!1)})):(n=_("Turtle Wrap On"),e.activity.helpfulWheelItems.forEach(function(e){"Turtle Wrap Off"===e.label?e.display=!1:"Turtle Wrap On"===e.label&&(e.display=!0)})),t.setAttribute("data-tooltip",n),$j(".tooltipped").tooltip({html:!0,delay:100})}}},{key:"changeWrap",value:function(e){var t=docById("wrapTurtle"),n="";(WRAP=!WRAP)?(n=_("Turtle Wrap Off"),e.helpfulWheelItems.forEach(function(e){"Turtle Wrap Off"===e.label?e.display=!0:"Turtle Wrap On"===e.label&&(e.display=!1)})):(n=_("Turtle Wrap On"),e.helpfulWheelItems.forEach(function(e){"Turtle Wrap Off"===e.label?e.display=!1:"Turtle Wrap On"===e.label&&(e.display=!0)})),t.setAttribute("data-tooltip",n),$j(".tooltipped").tooltip({html:!0,delay:100}),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none")}},{key:"renderSaveIcons",value:function(n,o,i,a,c,l,r,s,d,u,y){var v=this,e=docById("saveButton"),t=docById("saveButtonAdvanced");this.activity.beginnerMode?"ja"===this.language?e.onclick=function(){n(v.activity)}:(e.style.display="block",t.style.display="none",e.onclick=function(){var e=docById("save-html-beg");console.debug(e),e.onclick=function(){n(v.activity)};var t=docById("save-png-beg");console.debug(t),""==o(v.activity.canvas,v.activity.logo,v.activity.turtles,v.activity.canvas.width,v.activity.canvas.height,1)?(t.disabled=!0,t.className="grey-text inactiveLink"):(t.disabled=!1,t.className="",t.onclick=function(){c(v.activity)})}):(console.debug("ADVANCED MODE BUTTONS"),e.style.display="none",t.style.display="block",t.onclick=function(){docById("save-html").onclick=function(){n(v.activity)};var e=docById("save-svg"),t=docById("save-png");console.debug(t),""==o(v.activity.canvas,v.activity.logo,v.activity.turtles,v.activity.canvas.width,v.activity.canvas.height,1)?(e.disabled=!0,t.disabled=!0,e.className="grey-text inactiveLink",t.className="grey-text inactiveLink"):(e.disabled=!1,t.disabled=!1,e.className="",t.className="",e.onclick=function(){i(v.activity)},t.onclick=function(){c(v.activity)}),_THIS_IS_MUSIC_BLOCKS_&&(docById("save-midi").onclick=function(){a(v.activity)},docById("save-wav").onclick=function(){l(v.activity)},docById("save-ly").onclick=function(){r(v.activity)},docById("save-abc").onclick=function(){s(v.activity)},docById("save-mxml").onclick=function(){d(v.activity)}),docById("save-blockartwork-svg").onclick=function(){u(v.activity)},docById("save-blockartwork-png").onclick=function(){y(v.activity)}})}},{key:"updateRecordButton",value:function(e){var t=this,n=docById("record"),o=fnBrowserDetect();["firefox","safari"].includes(o)?n.classList.add("hide"):(n.style.display="block",n.innerHTML='<i class="material-icons main">'.concat(RECORDBUTTON,"</i>"),n.onclick=function(){return e(t.activity)})}},{key:"renderPlanetIcon",value:function(e,t){var n=this,o=docById("planetIcon"),i=docById("planetIconDisabled");e?o.onclick=function(){docById("toolbars").style.display="none",docById("wheelDiv").style.display="none",docById("contextWheelDiv").style.display="none",t(n.activity)}:(o.style.display="none",i.style.display="block")}},{key:"renderMenuIcon",value:function(e){var t=this,n=docById("menu"),o=docById("aux-toolbar");n.onclick=function(){docById("search").classList.toggle("open"),""==o.style.display||"none"==o.style.display?(e(t.activity,!1),o.style.display="block",n.innerHTML="more_vert",docById("toggleAuxBtn").className="blue darken-1"):(e(t.activity,!0),o.style.display="none",n.innerHTML="menu",docById("toggleAuxBtn").className-="blue darken-1",docById("chooseKeyDiv").style.display="none",docById("movable").style.display="none")}}},{key:"renderRunSlowlyIcon",value:function(e){var t=this,n=docById("runSlowlyIcon");this.activity.beginnerMode&&"ja"===this.language&&(n.style.display="none"),n.onclick=function(){e(t.activity),docById("stop").style.color=t.stopIconColorWhenPlaying}}},{key:"renderHelpIcon",value:function(e){var t=this;docById("helpIcon").onclick=function(){e(t.activity)}}},{key:"renderModeSelectIcon",value:function(t,s,d,u,y,v){function n(){p.style.display=_.activity.beginnerMode?"none":"block",g.style.display=_.activity.beginnerMode?"block":"none";var e,t,n,o,i,a,c=docById("record");c&&(_.activity.beginnerMode?c.style.display="none":(c.style.display="block",_.updateRecordButton(),c.onclick=function(){return s(_.activity)})),_.activity.beginnerMode?(["displayStatsIcon","loadPluginIcon","delPluginIcon","enableHorizScrollIcon","disableHorizScrollIcon","toggleJavaScriptIcon"].forEach(function(e){var t=docById(e);t&&(t.style.display="none")}),_.activity.helpfulWheelItems&&_.activity.helpfulWheelItems.forEach(function(e){"Enable horizontal scrolling"===e.label&&(e.display=!1)})):((e=docById("displayStatsIcon"))&&(e.style.display="block",e.onclick=function(){return d(_.activity)}),(t=docById("loadPluginIcon"))&&(t.style.display="block",t.onclick=function(){return u(_.activity)}),(n=docById("delPluginIcon"))&&(n.style.display="block",n.onclick=function(){return y(_.activity)}),o=docById("enableHorizScrollIcon"),i=docById("disableHorizScrollIcon"),o&&(o.style.display="block",o.onclick=function(){v(_.activity)}),i&&(i.onclick=function(){v(_.activity)}),(a=docById("toggleJavaScriptIcon"))&&(a.style.display="block"),_.activity.helpfulWheelItems&&_.activity.helpfulWheelItems.forEach(function(e){"Enable horizontal scrolling"===e.label&&(e.display=!0)}));var l=docById("saveButton"),r=docById("saveButtonAdvanced");l&&(l.style.display=_.activity.beginnerMode?"block":"none"),r&&(r.style.display=_.activity.beginnerMode?"none":"block"),_.activity.toolbar.renderSaveIcons(_.activity.save.saveHTML.bind(_.activity.save),doSVG,_.activity.save.saveSVG.bind(_.activity.save),_.activity.save.saveMIDI.bind(_.activity.save),_.activity.save.savePNG.bind(_.activity.save),_.activity.save.saveWAV.bind(_.activity.save),_.activity.save.saveLilypond.bind(_.activity.save),_.activity.save.saveAbc.bind(_.activity.save),_.activity.save.saveMxml.bind(_.activity.save),_.activity.save.saveBlockArtwork.bind(_.activity.save),_.activity.save.saveBlockArtworkPNG.bind(_.activity.save))}function e(){var e;_.activity.beginnerMode=!_.activity.beginnerMode;try{localStorage.setItem("beginnerMode",_.activity.beginnerMode.toString())}catch(e){console.error(e)}n(),_.tooltipsDisabled||$j(".tooltipped").tooltip({html:!0,delay:100}),$j(".materialize-iso, .dropdown-trigger").dropdown({constrainWidth:!1,hover:!1,belowOrigin:!0}),t&&t(_.activity),null!==(e=_.activity.palettes)&&void 0!==e&&e.updatePalettes&&_.activity.palettes.updatePalettes(),_.activity.refreshCanvas&&_.activity.refreshCanvas()}var _=this,p=docById("beginnerMode"),g=docById("advancedMode");p.onclick=null,g.onclick=null,p.onclick=e,g.onclick=e,n()}},{key:"renderRunStepIcon",value:function(e){var t=this,n=docById("runStepByStepIcon");this.activity.beginnerMode&&"ja"===this.language&&(n.style.display="none"),n.onclick=function(){e(t.activity)}}},{key:"renderMergeIcon",value:function(e){var t=this;docById("mergeWithCurrentIcon").onclick=function(){e(t.activity)}}},{key:"renderRestoreIcon",value:function(e){var t=this;docById("restoreIcon").onclick=function(){e(t.activity)}}},{key:"renderChooseKeyIcon",value:function(e){var t,n=this;_THIS_IS_MUSIC_BLOCKS_&&(t=docById("chooseKeyIcon"),docById("chooseKeyDiv").style.display="none",t.onclick=function(){e(n.activity)})}},{key:"renderJavaScriptIcon",value:function(e){var t=this;docById("toggleJavaScriptIcon").onclick=function(){return e(t.activity)}}},{key:"renderLanguageSelectIcon",value:function(t){var n=this,e=docById("languageSelectIcon"),o=["enUS","enUK","es","pt","ko","ja","kana","zhCN","th","tr","ayc","quz","gug","hi","ibo","ar","te","he","ur"];e.onclick=function(){o.forEach(function(e){docById(e).onclick=function(){return t["".concat(e,"_onclick")](n.activity)}})}}}]),e}();"undefined"!=typeof module&&module.exports&&(module.exports=Toolbar);