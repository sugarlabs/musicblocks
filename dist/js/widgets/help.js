"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=Array(e);i<e;i++)o[i]=t[i];return o}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);var o=i.call(t,e||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var HelpWidget=function(){function a(t,e){var i=this;_classCallCheck(this,a),this.activity=t,this.beginnerBlocks=[],this.advancedBlocks=[],this.appendedBlockList=[],this.index=0,this.isOpen=!0;var o=window.widgetWindows.windowFor(this,"help","help",!1);o.getWidgetBody().style.maxHeight="70vh",(this.widgetWindow=o).clear(),o.show(),o.onclose=function(){i.isOpen=!1,document.onkeydown=t.__keyPressed,o.destroy()},this._helpDiv=document.createElement("div"),setTimeout(function(){return i._setup(e,0)},0),setTimeout(this.widgetWindow.sendToCenter,50)}return _createClass(a,[{key:"_setup",value:function(t,e){var n=this;this._helpDiv.style.width="100%",this._helpDiv.style.backgroundColor="#e8e8e8";var i,o,a;if(this._helpDiv.insertAdjacentHTML("afterbegin",'\n                    <div id="right-arrow" class="hover" tabindex="-1"></div>\n                    <div id="left-arrow" class="hover" tabindex="-1"></div>\n                    <div id="helpButtonsDiv" tabindex="-1"></div>\n                    <div id="helpBodyDiv" tabindex="-1"></div>\n                         '),this.widgetWindow.getWidgetBody().append(this._helpDiv),t?(null!==this.activity.blocks.activeBlock.name&&(this.activity.blocks.blockList[this.activity.blocks.activeBlock].protoblock.staticLabels[0],0==e?this.widgetWindow.updateTitle(_("Take a tour")):this.widgetWindow.updateTitle(HELPCONTENT[e][0])),(o=document.getElementById("right-arrow")).style.display="none",o.classList.remove("hover"),(i=document.getElementById("left-arrow")).style.display="none",i.classList.remove("hover")):(0==e?this.widgetWindow.updateTitle(_("Take a tour")):this.widgetWindow.updateTitle(HELPCONTENT[e][0]),(o=document.getElementById("right-arrow")).style.display="block",o.classList.add("hover"),(i=document.getElementById("left-arrow")).style.display="block",i.classList.add("hover"),document.onkeydown=function(t){"ArrowLeft"===t.key?i.click():"ArrowRight"===t.key&&o.click()},a=docById("left-arrow"),0===e&&i.classList.add("disabled"),a.onclick=function(){0<e&&(--e,i.classList.remove("disabled"),0==e?n.widgetWindow.updateTitle(_("Take a tour")):n.widgetWindow.updateTitle(HELPCONTENT[e][0]),n._showPage(e)),0===e&&i.classList.add("disabled")},(a=docById("right-arrow")).onclick=function(){e+=1,i.classList.remove("disabled"),e===HELPCONTENT.length&&(e=0),0==e?n.widgetWindow.updateTitle(_("Take a tour")):n.widgetWindow.updateTitle(HELPCONTENT[e][0]),n._showPage(e)}),t){if(null!==this.activity.blocks.activeBlock.name){var c=this.activity.blocks.blockList[this.activity.blocks.activeBlock].name,l=document.createElement("div");l.classList.add("icon-container"),l.insertAdjacentHTML("afterbegin",'<a class="tooltipped"\n                        data-toggle="tooltip"\n                        title="Show Palette containing the block"\n                        data-position="bottom">\n                      <i style="margin-right: 10px" id="findIcon" class="material-icons md-48">search</i>\n                    </a>\n                    ');var r=this.activity.blocks.blockList[this.activity.blocks.activeBlock].protoblock.helpString;if(r){var s=docById("helpBodyDiv");s.style.height="70vh";var d="";if(1<r.length){var p=r[1],h=localStorage.languagePreference;switch(void 0===h&&(h=navigator.language),h){case"ja":"kana"==localStorage.kanaPreference?p+="-kana":p+="-ja";break;case"es":p+="-es";break;case"pt":p+="-pt"}var y="Docs/".concat(p,"/").concat(c,"_block.svg");d+='<figure style="width:100%;"><img style="max-width:100%;" src='.concat(y,"></figure>")}d+="<p>".concat(r[0],"</p>");l.insertAdjacentHTML("afterbegin",'<i style="margin-right: 10px" id="loadButton" data-toggle="tooltip" title="Load this block" class="material-icons md-48">get_app</i>'),s.insertAdjacentHTML("afterbegin",d),this.activity.blocks.blockList[this.activity.blocks.activeBlock].protoblock.beginnerModeBlock||l.insertAdjacentHTML("beforeend",'<a class="tooltipped"\n                        data-toggle="tooltip"\n                        title="This block is only available in advance mode"\n                        data-position="bottom">\n                      <i id="advIconText" class="material-icons md-48">star</i>\n                     </a>\n                    '),s.append(l);var g=this.activity.blocks.palettes.getProtoNameAndPalette(c),u=docById("loadButton");null!==u&&(u.onclick=function(){var t,e,i,o,a;r.length<4?(t=g[0],e=g[1],i=g[2],Object.prototype.hasOwnProperty.call(n.activity.blocks.protoBlockDict,i)&&n.activity.blocks.palettes.dict[e].makeBlockFromSearch(t,i,function(t){n.activity.blocks.moveBlock(t,100,100)})):"string"==typeof r[3]?(o=getMacroExpansion(n.activity,r[3],100,100),n.activity.blocks.loadNewBlocks(o)):(a=r[3],n.activity.blocks.loadNewBlocks(a))}),docById("findIcon").onclick=function(){n.activity.blocks.palettes.showPalette(g[1])}}}}else docById("helpBodyDiv").style.height="325px",docById("helpBodyDiv").style.width="345px",this._showPage(e);this.widgetWindow.takeFocus()}},{key:"_showPage",value:function(t){var e=this,i=docById("helpBodyDiv");i.innerHTML="";var o,a,n,c=HELPCONTENT.length,l="".concat(t+1,"/").concat(c),r="",r=[_("Welcome to Music Blocks"),_("Meet Mr. Mouse!"),_("Guide"),_("About"),_("Congratulations.")].includes(HELPCONTENT[t][0])?'<figure>&nbsp;<img src=" '.concat(HELPCONTENT[t][2],'"></figure>'):'<figure>&nbsp;<img src=" '.concat(HELPCONTENT[t][2],'" width="64px" height="64px"></figure>');r+='<h1 class="heading">'.concat(HELPCONTENT[t][0],'</h1> \n         <p class="description">').concat(HELPCONTENT[t][1],"</p>\n         <p>").concat(l,"</p>"),3<HELPCONTENT[t].length&&(o=HELPCONTENT[t][3],r+='<p><a href="'.concat(o,'" target="_blank">').concat(HELPCONTENT[t][4],"</a></p>")),[_("Congratulations.")].includes(HELPCONTENT[t][0])?docById("right-arrow").onclick=function(){e._prepareBlockList()}:(a=docById("right-arrow"),n=docById("left-arrow"),a.onclick=function(){t+=1,n.classList.remove("disabled"),t===HELPCONTENT.length&&(t=0),0==t?e.widgetWindow.updateTitle(_("Take a tour")):e.widgetWindow.updateTitle(HELPCONTENT[t][0]),e._showPage(t)},0===t&&n.classList.add("disabled"),n.onclick=function(){0<t&&(--t,n.classList.remove("disabled"),0==t?e.widgetWindow.updateTitle(_("Take a tour")):e.widgetWindow.updateTitle(HELPCONTENT[t][0]),e._showPage(t)),0===t&&n.classList.add("disabled")}),i.style.color="#505050",i.insertAdjacentHTML("afterbegin",r),this.widgetWindow.takeFocus()}},{key:"_prepareBlockList",value:function(){var t,e;for(var i in this.activity.blocks.protoBlockDict)!0===this.activity.blocks.protoBlockDict[i].beginnerModeBlock&&void 0!==this.activity.blocks.protoBlockDict[i].helpString&&0!==this.activity.blocks.protoBlockDict[i].helpString.length&&this.beginnerBlocks.push(i);for(var o in this.activity.blocks.protoBlockDict)!1===this.activity.blocks.protoBlockDict[o].beginnerModeBlock&&void 0!==this.activity.blocks.protoBlockDict[o].helpString&&0!==this.activity.blocks.protoBlockDict[o].helpString.length&&this.advancedBlocks.push(o);(t=this.appendedBlockList).push.apply(t,_toConsumableArray(this.beginnerBlocks)),(e=this.appendedBlockList).push.apply(e,_toConsumableArray(this.advancedBlocks)),this._blockHelp(this.activity.blocks.protoBlockDict[this.appendedBlockList[0]])}},{key:"_blockHelp",value:function(t){var c=this,e=window.widgetWindows.windowFor(this,"help","help");(this.widgetWindow=e).clear(),this._helpDiv=document.createElement("div"),this._helpDiv.style.height="70vh",this._helpDiv.style.backgroundColor="#e8e8e8";this._helpDiv.insertAdjacentHTML("afterbegin",'<div id="right-arrow" class="hover" tabindex="-1"></div><div id="left-arrow" class="hover" tabindex="-1"></div><div id="helpButtonsDiv" tabindex="-1"></div><div id="helpBodyDiv" tabindex="-1"></div>'),this.widgetWindow.getWidgetBody().append(this._helpDiv);var i,o=docById("right-arrow"),a=docById("right-arrow"),n=docById("left-arrow");if(document.onkeydown=function(t){"ArrowLeft"===t.key?n.click():"ArrowRight"===t.key&&a.click()},this.index==this.appendedBlockList.length-1&&a.classList.add("disabled"),o.onclick=function(){c.index!==c.appendedBlockList.length-1&&(c.index+=1),c._blockHelp(c.activity.blocks.protoBlockDict[c.appendedBlockList[c.index]])},(o=docById("left-arrow")).onclick=function(){var t;0==c.index?(t=window.widgetWindows.windowFor(c,"help","help"),(c.widgetWindow=t).clear(),c._helpDiv=document.createElement("div"),c._setup(!1,HELPCONTENT.length-1)):(--c.index,c._blockHelp(c.activity.blocks.protoBlockDict[c.appendedBlockList[c.index]]))},null!==t.name&&(i=t.staticLabels[0],this.widgetWindow.updateTitle(_(i))),null!==t.name){var l=t.name,r=document.createElement("div");r.classList.add("icon-container");var s=t.helpString,d=docById("helpBodyDiv");if(d.style.height="70vh",d.style.backgroundColor="#e8e8e8",s){var p="";if(1<s.length){s[1];var h=localStorage.languagePreference;switch(void 0===h&&(h=navigator.language),h){case"ja":"kana"==localStorage.kanaPreference?0:0;break;case"es":0;break;case"pt":0}var y="Docs/documentation/".concat(l,"_block.svg");p+='<figure class="blockImage-wrapper"><img class="blockImage" src="'.concat(y,'"></figure>')}p+='<p class="message">'.concat(s[0],"</p>"),d.insertAdjacentHTML("afterbegin",p);r.insertAdjacentHTML("afterbegin",'<i style="margin-right: 10px" id="loadButton" data-toggle="tooltip" title="Load this block" class="material-icons md-48">get_app</i>'),r.insertAdjacentHTML("beforeend",'<a class="tooltipped"\n                    data-toggle="tooltip"\n                    title="Show Palette containing the block"\n                    data-position="bottom">\n                    <i style="margin-right: 10px"\n                        id="findIcon"\n                        class="material-icons md-48">search\n                    </i>\n                 </a>\n                '),t.beginnerModeBlock||r.insertAdjacentHTML("beforeend",'<a class="tooltipped"\n                    data-toggle="tooltip"\n                    title="This block is only available in advance mode"\n                    data-position="bottom">\n                     <i id="advIconText"\n                        class="material-icons md-48">star\n                     </i>\n                 </a>\n                '),d.append(r),docById("findIcon").onclick=function(){t.palette.palettes.showPalette(t.palette.name)};var g=docById("loadButton");null!==g&&(g.onclick=function(){var t,e,i,o,a,n;s.length<4?(e=(t=c.activity.blocks.palettes.getProtoNameAndPalette(l))[0],i=t[1],o=t[2],Object.prototype.hasOwnProperty.call(c.activity.blocks.protoBlockDict,o)&&c.activity.blocks.palettes.dict[i].makeBlockFromSearch(e,o,function(t){c.activity.blocks.moveBlock(t,100,100)})):"string"==typeof s[3]?(a=getMacroExpansion(c.activity,s[3],100,100),c.activity.blocks.loadNewBlocks(a)):(n=s[3],c.activity.blocks.loadNewBlocks(n))})}}this.widgetWindow.takeFocus()}},{key:"showPageByName",value:function(t){for(var e=0;e<HELPCONTENT.length;e++)HELPCONTENT[e].includes(t)&&this._showPage(e)}}]),a}();_defineProperty(HelpWidget,"ICONSIZE",32);