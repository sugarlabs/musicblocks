"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var n=i.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var PitchSlider=function(){function c(){_classCallCheck(this,c),this._delta=0,this.sliders={},this._cellScale=0,this.isActive=!1,this.activeSlider=null}return _createClass(c,[{key:"init",value:function(i){var l=this;if(this.activity=i,!window.widgetWindows.openWindows.slider){this.frequencies&&this.frequencies.length||(this.frequencies=[392]);for(var s=[],e=0;e<this.frequencies.length;e++){var t=(new Tone.AMSynth).toDestination();s.push(t)}this._cellScale=1,this.widgetWindow=window.widgetWindows.windowFor(this,"pitch slider","slider",!0),this.isActive=!0,(i.logo.pitchSlider=this).widgetWindow.onclose=function(){for(var e=0,t=s;e<t.length;e++){t[e].triggerRelease()}l.isActive=!1,i.logo.pitchSlider=null,l.widgetWindow.destroy()};document.addEventListener("keydown",function(e){if(l.isActive&&("ArrowUp"===e.key||"ArrowDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key)){e.preventDefault(),e.stopPropagation();var t,i,n,r,o,a=null!==l.activeSlider?l.activeSlider:0;return l.sliders[a]&&(t=l.sliders[a],i=parseFloat(t.min),n=parseFloat(t.max),r=parseFloat(t.value),"ArrowUp"===e.key||"ArrowRight"===e.key?t.value=Math.min(r*c.SEMITONE,n):"ArrowDown"!==e.key&&"ArrowLeft"!==e.key||(t.value=Math.max(r/c.SEMITONE,i)),o=new Event("input",{bubbles:!0}),t.dispatchEvent(o)),!1}},!0);for(var n in this.frequencies)!function(e){var t=document.createElement("div");l.widgetWindow._toolbar.appendChild(t),t.style.float="left";var i=l.frequencies[e]/2,n=2*l.frequencies[e],r=l.widgetWindow.addRangeSlider(l.frequencies[e],t,i,n,"pitchSlider");0==e&&(l.activeSlider=e),r.addEventListener("mousedown",function(){l.activeSlider=e});var o=document.createElement("div");o.className="wfbtItem",t.appendChild(o),o.innerHTML="<label>".concat(l.frequencies[e],"</label>"),l.sliders[e]=r;function a(){l.frequencies[e]=parseFloat(l.sliders[e].value),s[e].frequency.linearRampToValueAtTime(l.frequencies[e],Tone.now()+.05),o.innerHTML="<label>".concat(l.frequencies[e],"</label>")}r.oninput=function(){s[e].triggerAttack(l.frequencies[e]),a()},r.onchange=function(){s[e].triggerRelease()},l.widgetWindow.addButton("up.svg",c.ICONSIZE,_("Move up"),t).onclick=function(){r.value=Math.min(parseFloat(r.value)*c.SEMITONE,n),a(),s[e].triggerAttackRelease(l.frequencies[e],"4n")},l.widgetWindow.addButton("down.svg",c.ICONSIZE,_("Move down"),t).onclick=function(){r.value=Math.max(parseFloat(r.value)/c.SEMITONE,i),a(),s[e].triggerAttackRelease(l.frequencies[e],"4n")},l.widgetWindow.addButton("export-chunk.svg",c.ICONSIZE,_("Save"),t).onclick=function(){l._save(l.frequencies[e])}}(n);i.textMsg(_("Use the up/down buttons or arrow keys to change pitch."),3e3),i.textMsg(_("Click on the slider to create a note block."),3e3),setTimeout(this.widgetWindow.sendToCenter,0)}}},{key:"_save",value:function(e){for(var t in this.activity.blocks.palettes.dict)this.activity.blocks.palettes.dict[t].hideMenu(!0);this.activity.refreshCanvas();var i=[[0,"note",100+this._delta,100+this._delta,[null,1,2,null]],[1,["number",{value:8}],0,0,[0]]];this._delta+=21;var n=i.length,r=n+1,o=n+2;i.push([n,"hertz",0,0,[0,r,o]]),i.push([r,["number",{value:e}],0,0,[n]]),i.push([o,"hidden",0,0,[n,null]]),this.activity.blocks.loadNewBlocks(i)}}]),c}();_defineProperty(PitchSlider,"ICONSIZE",32),_defineProperty(PitchSlider,"SEMITONE",Math.pow(2,1/12));