"use strict";function TemperamentWidget(){var u=430,p=32,y=document.createElement("div"),m=null;this.inTemperament=null,this.lastTriggered=null,this.notes=[],this.frequencies=[],this.intervals=[],this.ratios=[],this.scale=[],this.cents=[],this.scaleNotes=[],this.pitchNumber=0,this.circleIsVisible=!0,this.playbackForward=!0,this._addButton=function(e,t,i,n){var s=e.insertCell(-1);return s.innerHTML='&nbsp;&nbsp;<img \n                src="header-icons/'.concat(t,'" \n                title="').concat(n,'" \n                alt="').concat(n,'" \n                height="').concat(i,'" \n                width="').concat(i,'" \n                vertical-align="middle" \n                align-content="center"\n            >&nbsp;&nbsp;'),s.style.width="53px",s.style.minWidth=s.style.width,s.style.maxWidth=s.style.width,s.style.height=s.style.width,s.style.minHeight=s.style.height,s.style.maxHeight=s.style.height,s.style.backgroundColor=platformColor.selectorBackground,s.onmouseover=function(){this.style.backgroundColor=platformColor.selectorBackgroundHOVER},s.onmouseout=function(){this.style.backgroundColor=platformColor.selectorBackground},s},this._circleOfNotes=function(){this.circleIsVisible=!1,this.toggleNotesButton(),y.style.display="inline",y.style.visibility="visible",y.style.border="0px",y.style.overflow="auto",y.style.backgroundColor="white",y.style.height="300px",y.innerHTML='<div id="temperamentTable"></div>';var e=docById("temperamentTable");e.style.position="relative";var h=150;e.innerHTML='<canvas id="circ" width = 430px height = 360px></canvas><div id="wheelDiv2" class="wheelNav"></div><div id ="information"></div>',e.style.width="300px";var t=docById("circ");t.style.position="absolute",t.style.zIndex=1,t.style.background="rgba(255, 255, 255, 0.85)";var i=t.getContext("2d"),n=t.width/2,s=t.height/2;i.beginPath(),i.arc(n,s,h,0,2*Math.PI,!1),i.fillStyle="rgba(204, 0, 102, 0)",i.fill(),i.lineWidth=1,i.strokeStyle="#003300",i.stroke();var d=[];docById("wheelDiv2").style.display="",docById("wheelDiv2").style.background="none",this.createMainWheel=function(e,t){void 0===e&&(e=this.ratios),void 0===t&&(t=this.pitchNumber);for(var i=[],n=0;n<t;n++)i.push(n.toString());this.notesCircle=new wheelnav("wheelDiv2",null,350,350),this.notesCircle.wheelRadius=230,this.notesCircle.navItemsEnabled=!1,this.notesCircle.navAngle=270,this.notesCircle.navItemsContinuous=!0,this.notesCircle.navItemsCentered=!1,this.notesCircle.slicePathFunction=slicePath().MenuSliceWithoutLine,this.notesCircle.slicePathCustom=slicePath().MenuSliceCustomization(),this.notesCircle.sliceSelectedPathCustom=this.notesCircle.slicePathCustom,this.notesCircle.sliceInitPathCustom=this.notesCircle.slicePathCustom,this.notesCircle.initWheel(i),d=[];for(var s=[],o=[],l=[],r=0;r<this.notesCircle.navItemCount;r++)this.notesCircle.navItems[r].fillAttr="#c8C8C8",this.notesCircle.navItems[r].titleAttr.font="20 20px Impact, Charcoal, sans-serif",this.notesCircle.navItems[r].titleSelectedAttr.font="20 20px Impact, Charcoal, sans-serif",d[r]=270+Math.log10(e[r])/Math.log10(this.powerBase)*360,0!==r&&(l[r-1]=r==t-1?d[0]+360-d[r]:d[r]-d[r-1]),0===r?(o[r]=360/t,s[r]=this.notesCircle.navAngle-o[0]/2):(s[r]=s[r-1]+o[r-1],o[r]=2*(d[r]-s[r])),this.notesCircle.navItems[r].sliceAngle=o[r];for(var a=2*Math.PI*h/t/3,c=0;c<l.length;c++)l[c]<11&&(a=2*Math.PI*h/t/6);29<a&&(a=2*Math.PI*h/33),this.notesCircle.slicePathCustom.menuRadius=a,this.notesCircle.createWheel(),docById("wheelDiv2").style.position="absolute",docById("wheelDiv2").style.height="360px",docById("wheelDiv2").style.width=u+"px",docById("wheelDiv2").style.zIndex=5},this.createMainWheel();var o,l,r,a=this;this.octaveChanged?((r=document.createElement("div")).id="divAppend",r.innerHTML='<div id="clearNotes" style="float:left;">'+_("Clear")+'</div><div id="standardOctave" style="float:right;">'+_("back to 2:1 octave space")+"</div>",r.style.textAlign="center",r.style.position="absolute",r.style.zIndex=2,r.style.height="33px",r.style.width=docById("wheelDiv2").style.width,r.style.marginTop="360px",r.style.background="rgba(255, 255, 255, 0.85)",r.style.overflow="auto",docById("temperamentTable").append(r),(o=docById("clearNotes")).style.height="30px",o.style.marginLeft="3px",o.style.backgroundColor=platformColor.selectorBackground,o.style.width="212px",(l=docById("standardOctave")).style.height="30px",l.style.marginRight="3px",l.style.backgroundColor=platformColor.selectorBackground,l.style.width="207px"):((o=document.createElement("div")).id="divAppend",o.innerHTML=_("Clear"),o.style.textAlign="center",o.style.position="absolute",o.style.zIndex=2,o.style.paddingTop="5px",o.style.backgroundColor=platformColor.selectorBackground,o.style.height="25px",o.style.width=docById("wheelDiv2").style.width,o.style.marginTop=docById("wheelDiv2").style.height,o.style.overflow="auto",docById("temperamentTable").append(o)),void 0!==o&&(o.onclick=function(){var e=a.ratios[0];a.ratios=[],a.ratios[0]=e,a.ratios[1]=a.powerBase;var t=a.frequencies[0];a.frequencies=[],a.frequencies[0]=t,a.frequencies[1]=t*a.powerBase,a.pitchNumber=1,a.checkTemperament(a.ratios),a._circleOfNotes()}),void 0!==l&&(l.onclick=function(){var e=[],t=[],i=a.frequencies[0];a.frequencies=[],isCustomTemperament(a.inTemperament)||(a.powerBase=2);for(var n=0;n<a.ratios.length;n++)e[n]=Math.log10(a.ratios[n])/Math.log10(a.powerBase)*12,a.ratios[n]=Math.pow(a.powerBase,e[n]/12),t[n]=a.ratios[n].toFixed(2),a.frequencies[n]=a.ratios[n]*i,a.frequencies[n]=a.frequencies[n].toFixed(2);a.powerBase=2,a.checkTemperament(t),a.octaveChanged=!1,a._circleOfNotes()}),docById("temperamentTable").addEventListener("click",function(e){a.showNoteInfo(e)})},this.showNoteInfo=function(u){for(var p=this,m=0;m<this.notesCircle.navItemCount;m++)(u.target.id=="wheelnav-wheelDiv2-slice-"+m||u.target.innerHTML==m&&""!==u.target.innerHTML)&&function(){var e=u.clientX-docById("wheelDiv2").getBoundingClientRect().left,t=u.clientY-docById("wheelDiv2").getBoundingClientRect().top,i=p.frequencies[m],n=p;null!==docById("noteInfo")&&docById("noteInfo").remove(),docById("information").innerHTML+='<div class="popup" id="noteInfo" style="left: '.concat(e,"px; top: ").concat(t,'px;">\n                        <span class="popuptext" id="myPopup"></span>\n                    </div>'),0!==m&&(docById("noteInfo").innerHTML+='<img \n                            src="header-icons/edit.svg" \n                            id="edit" \n                            title="'.concat(_("edit"),'" \n                            alt="edit" \n                            height="20px" \n                            width="20px" \n                            data-message="').concat(m,'"\n                        >')),docById("noteInfo").innerHTML+='<img src="header-icons/close-button.svg" id="close" title="'+_("Close")+'" alt="'+_("Close")+'" height=20px width=20px align="right"><br>';for(var s=!1,o=0;o<p.ratiosNotesPair.length;o++)if(p.ratios[m]==p.ratiosNotesPair[o][0]){s=!0,docById("noteInfo").innerHTML+='<div id="note">&nbsp;'.concat(_("note"),"&nbsp;").concat(p.ratiosNotesPair[o][1],"</div>");break}if(0==s){for(var l=Math.log10(p.ratios[m])/Math.log10(p.powerBase)*1200,r=[],a=[],c=0;c<p.cents.length;c++)r[c]=l-p.cents[c],a[c]=Math.abs(l-p.cents[c]);var h=a.reduce(function(e,t){return Math.min(e,t)}),d=a.indexOf(h);r[d]<0?docById("noteInfo").innerHTML+='<div id="note">&nbsp;'.concat(_("note"),"&nbsp;").concat(p.ratiosNotesPair[d][1],"(-").concat(a[d].toFixed(2),"¢)</div>"):docById("noteInfo").innerHTML+='<div id="note">&nbsp;'.concat(_("note"),"&nbsp;").concat(p.ratiosNotesPair[d][1],"(").concat(a[d].toFixed(2),"¢)</div>")}docById("noteInfo").innerHTML+='<div id="frequency">&nbsp;'.concat(_("frequency"),"&nbsp;").concat(i,"</div>"),docById("noteInfo").style.top="130px",docById("noteInfo").style.left="132px",docById("noteInfo").style.position="absolute",docById("noteInfo").style.zIndex=10,docById("close").onclick=function(){docById("noteInfo").remove()},null!==docById("edit")&&docById("edit").addEventListener("click",function(e){n.editFrequency(e)})}()},this.editFrequency=function(e){var i=Number(e.target.dataset.message),n=this;docById("noteInfo").style.width="180px",docById("noteInfo").style.height="130px",docById("note").innerHTML="",docById("frequency").innerHTML="",docById("noteInfo").innerHTML+='<center><input type="range" class="sliders" id="frequencySlider1" style="width:170px; background:white; border:0;" min="'.concat(this.frequencies[i-1],'" max="').concat(this.frequencies[i+1],'"></center>'),docById("noteInfo").innerHTML+="<br>&nbsp;&nbsp;".concat(_("frequency"),'<span class="rangeslidervalue" id="frequencydiv1">').concat(this.frequencies[i],"</span>"),docById("noteInfo").innerHTML+='<br><br><div id="done" style="background:rgb(196, 196, 196);"><center>'.concat(_("done"),"</center><div>"),docById("frequencySlider1").oninput=function(){docById("frequencydiv1").innerHTML=docById("frequencySlider1").value;var e=docById("frequencySlider1").value,t=e/n.frequencies[0];n.temporaryRatios=n.ratios.slice(),n.temporaryRatios[i]=t,n._logo.resetSynth(0),n._logo.synth.trigger(0,e,.01*Singer.defaultBPMFactor,"electronic synth",null,null),n.createMainWheel(n.temporaryRatios)},docById("done").onclick=function(){n.ratios=n.temporaryRatios.slice(),n.typeOfEdit="nonequal",n.createMainWheel();var e=n.frequencies[0];n.frequencies=[];for(var t=0;t<n.ratios.length;t++)n.frequencies[t]=n.ratios[t]*e,n.frequencies[t]=n.frequencies[t].toFixed(2);n.checkTemperament(n.ratios),docById("noteInfo").remove()},docById("close").onclick=function(){n.temporaryRatios=n.ratios.slice(),n.createMainWheel(),docById("noteInfo").remove()}},this._graphOfNotes=function(){this.circleIsVisible=!0,this.toggleNotesButton(),y.innerHTML="",null!=docById("wheelDiv2")&&(docById("wheelDiv2").style.display="none",this.notesCircle.removeWheel()),y.innerHTML='<table id="notesGraph"></table>';var e=docById("notesGraph"),t=[];isCustomTemperament(this.inTemperament)?t=[_("Play"),_("pitch number"),_("ratio"),_("frequency")]:(t=[_("Play"),_("pitch number"),_("ratio"),_("interval"),_("note"),_("frequency")]).splice(5,0,this.scale),e.innerHTML='<thead id="tablehead"><tr id="menu"></tr></thead><tbody id="tablebody"></tbody>';for(var i="",n=0;n<t.length;n++)i+='<th id="menuLabels">'+t[n]+"</th>";docById("menu").innerHTML=i;for(var s=document.querySelectorAll("#menuLabels"),o=0;o<t.length;o++)s[o].style.background=platformColor.labelColor,s[o].style.height="30px",s[o].style.textAlign="center",s[o].style.fontWeight="bold",isCustomTemperament(this.inTemperament)?(s[0].style.width="40px",s[1].style.width="120px",s[2].style.width="120px",s[3].style.width="140px"):(s[0].style.width="40px",s[1].style.width="40px",s[2].style.width="60px",s[3].style.width="120px",s[4].style.width="50px",s[5].style.width="100px",s[6].style.width="95px");for(var l="",r=0;r<=this.pitchNumber;r++)l+='<tr id="notes_'+r+'"></tr>';docById("tablebody").innerHTML+='<tr><td colspan="7"><div id="graph"><table id="tableOfNotes"></table></div></td></tr>',docById("tableOfNotes").innerHTML=l;for(var a=this,c=[],h=[],d=[],u=0;u<=this.pitchNumber;u++){c[u]=docById("notes_"+u),h[0]=c[u].insertCell(-1),h[0].innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="20px" \n                    width="20px" \n                    id="play_').concat(u,'" \n                    data-id="').concat(u,'"\n                >&nbsp;&nbsp;'),h[0].style.width="40px",h[0].style.backgroundColor=platformColor.selectorBackground,h[0].style.textAlign="center",h[0].onmouseover=function(){this.style.backgroundColor=platformColor.selectorBackgroundHOVER},h[0].onmouseout=function(){this.style.backgroundColor=platformColor.selectorBackground};var p=docById("play_"+u);if(p.onmouseover=function(e){this.style.cursor="pointer"},p.onclick=function(e){a.playNote(e.target.dataset.id)},h[1]=c[u].insertCell(-1),h[1].id="pitchNumber_"+u,h[1].innerHTML=u,h[1].style.backgroundColor=platformColor.selectorBackground,h[1].style.textAlign="center",d[u]=this.ratios[u],d[u]=d[u].toFixed(2),h[2]=c[u].insertCell(-1),h[2].innerHTML=d[u],h[2].style.backgroundColor=platformColor.selectorBackground,h[2].style.textAlign="center",!isCustomTemperament(this.inTemperament)){h[3]=c[u].insertCell(-1),h[3].innerHTML=this.intervals[u],h[3].style.width="120px",h[3].style.backgroundColor=platformColor.selectorBackground,h[3].style.textAlign="center",h[4]=c[u].insertCell(-1),h[4].innerHTML=this.notes[u],h[4].style.width="50px",h[4].style.backgroundColor=platformColor.selectorBackground,h[4].style.textAlign="center",h[5]=c[u].insertCell(-1);for(var m=0;m<this.scaleNotes.length;m++)if(this.notes[u][0]==this.scaleNotes[m]){h[5].innerHTML=m;break}""===h[5].innerHTML&&(h[5].innerHTML=_("non scalar")),h[5].style.width="100px",h[5].style.backgroundColor=platformColor.selectorBackground,h[5].style.textAlign="center"}h[6]=c[u].insertCell(-1),h[6].innerHTML=this.frequencies[u],h[6].style.backgroundColor=platformColor.selectorBackground,h[6].style.textAlign="center",isCustomTemperament(this.inTemperament)?(h[1].style.width="130px",h[6].style.width="130px",h[2].style.width="130px"):(h[1].style.width="60px",h[6].style.width="80px",h[2].style.width="60px")}},this.edit=function(){this.editMode=null,this._logo.synth.setMasterVolume(0),this._logo.synth.stop();var t=this;null!=docById("wheelDiv2")&&(docById("wheelDiv2").style.display="none",this.notesCircle.removeWheel()),y.innerHTML="",y.innerHTML='<table id="editOctave" width="'.concat(u,'"><tbody><tr id="menu"></tr></tbody></table>');for(var e=[_("equal"),_("ratios"),_("arbitrary"),_("octave space")],i="",n=0;n<e.length;n++)i+='<td id="editMenus">'+e[n]+"</td>";docById("menu").innerHTML=i,docById("editOctave").innerHTML+='<tr><td colspan="4" id="userEdit"></td></tr>';for(var s=document.querySelectorAll("#editMenus"),o=0;o<e.length;o++)s[o].style.background=platformColor.selectorBackground,s[o].style.height="30px",s[o].style.textAlign="center",s[o].style.fontWeight="bold";s[0].style.background="#c8C8C8",t.equalEdit(),s[0].onclick=function(e){s[1].style.background=platformColor.selectorBackground,s[2].style.background=platformColor.selectorBackground,s[3].style.background=platformColor.selectorBackground,s[0].style.background="#c8C8C8",t.equalEdit()},s[1].onclick=function(e){s[0].style.background=platformColor.selectorBackground,s[2].style.background=platformColor.selectorBackground,s[3].style.background=platformColor.selectorBackground,s[1].style.background="#c8C8C8",t.ratioEdit()},s[2].onclick=function(e){s[0].style.background=platformColor.selectorBackground,s[1].style.background=platformColor.selectorBackground,s[3].style.background=platformColor.selectorBackground,s[2].style.background="#c8C8C8",t.arbitraryEdit()},s[3].onclick=function(e){s[0].style.background=platformColor.selectorBackground,s[1].style.background=platformColor.selectorBackground,s[2].style.background=platformColor.selectorBackground,s[3].style.background="#c8C8C8",t.octaveSpaceEdit()}},this.equalEdit=function(){this.editMode="equal",docById("userEdit").innerHTML="";var n=docById("userEdit");n.style.backgroundColor="#c8C8C8",n.innerHTML="<br>".concat(_("pitch number"),'&nbsp;&nbsp;&nbsp;&nbsp; <input type="text" id="octaveIn" value="0"></input>\n            &nbsp;&nbsp; ').concat(_("to"),'&nbsp;&nbsp;\n            <input type="text" id="octaveOut" value="0"></input><br><br>'),n.innerHTML+="".concat(_("number of divisions"),' &nbsp;&nbsp;&nbsp;&nbsp; <input type="text" id="divisions" value="').concat(this.pitchNumber,'"></input>'),n.style.paddingLeft="80px";var v=this,f=document.createElement("div");function g(e){f.id="divAppend",f.innerHTML=e?'<div id="preview" style="float:left;">'.concat(_("back"),'</div>\n                    <div id="done_" style="float:right;">').concat(_("done"),"</div>"):'<div id="preview" style="float:left;">'.concat(_("preview"),'</div>\n                    <div id="done_" style="float:right;">').concat(_("done"),"</div>"),f.style.textAlign="center",f.style.marginLeft="-80px",f.style.height="32px",f.style.marginTop="40px",f.style.overflow="auto",n.append(f);var t=docById("preview");t.style.height="30px",t.style.marginLeft="3px",t.style.backgroundColor=platformColor.selectorBackground,t.style.width="215px";var i=docById("done_");i.style.height="30px",i.style.marginRight="3px",i.style.backgroundColor=platformColor.selectorBackground,i.style.width="205px"}g(!1),f.onmouseover=function(){this.style.cursor="pointer"};var b=this.pitchNumber,I=Number(docById("octaveIn").value),w=Number(docById("octaveOut").value),C=Number(docById("divisions").value),B=[],T=[],x=[],k=[],M=[],q=[];this.tempRatios=[],f.addEventListener("click",function(e){try{v.performEqualEdit(e)}catch(e){activity.errorMsg(_("The Number of divisions is too large."),3e3)}}),this.performEqualEdit=function(e){if(I=Number(docById("octaveIn").value),w=Number(docById("octaveOut").value),C=Number(docById("divisions").value),this.tempRatios=this.ratios.slice(),I===w){for(var t=0;t<C;t++)B[t]=Math.pow(this.powerBase,t/C),x[t]=B[t].toFixed(2);for(var i=0;i<this.tempRatios.length;i++)k[i]=this.tempRatios[i],k[i]=k[i].toFixed(2);for(var n=x.filter(function(e){return-1==k.indexOf(e)}),s=0;s<n.length;s++)q[s]=x.indexOf(n[s]),M[s]=B[q[s]];this.tempRatios=this.tempRatios.concat(M),this.tempRatios.sort(function(e,t){return e-t}),b=this.tempRatios.length-1,this.typeOfEdit="equal",this.divisions=C}else{b=C+Number(b)-Math.abs(I-w);var o=270+Math.log10(this.tempRatios[I])/Math.log10(this.powerBase)*360,l=270+Math.log10(this.tempRatios[w])/Math.log10(this.powerBase)*360,r=Math.abs(l-o)/C;this.tempRatios.splice(I+1,Math.abs(I-w)-1);for(var a=0;a<C-1;a++){var c=(Math.min(o,l)+r*(a+1)-270)/360;B[a]=Math.pow(this.powerBase,c),this.tempRatios.splice(I+1+a,0,B[a]),T[a]=this.tempRatios[a],T[a]=T[a].toFixed(2)}this.typeOfEdit="nonequal"}if(e.target.innerHTML===_("done")){this.ratios=this.tempRatios.slice();var h=this.frequencies[0];this.frequencies=[];for(var d=0;d<=b;d++)this.frequencies[d]=this.ratios[d]*h,this.frequencies[d]=this.frequencies[d].toFixed(2);this.pitchNumber=b,this.checkTemperament(T),this._circleOfNotes()}else if(e.target.innerHTML===_("preview")){docById("userEdit").innerHTML='<div id="wheelDiv2" class="wheelNav"></div>',this.createMainWheel(this.tempRatios,b);for(var u=0;u<b;u++)this.notesCircle.navItems[u].fillAttr="#e0e0e0",this.notesCircle.navItems[u].sliceHoverAttr.fill="#e0e0e0",this.notesCircle.navItems[u].slicePathAttr.fill="#e0e0e0",this.notesCircle.navItems[u].sliceSelectedAttr.fill="#e0e0e0";this.notesCircle.refreshWheel(),docById("userEdit").style.paddingLeft="0px",g(!0),f.style.marginTop=docById("wheelDiv2").style.height,docById("preview").style.marginLeft="80px";var p=this.tempRatios.slice(),m=this.frequencies[0];this.eqTempHzs=[];for(var y=0;y<=b;y++)this.eqTempHzs[y]=p[y]*m,this.eqTempHzs[y]=this.eqTempHzs[y].toFixed(2);this.eqTempPitchNumber=b,this.checkTemperament(T),docById("done_").onclick=function(){v.ratios=v.tempRatios.slice();var e=v.frequencies[0];v.frequencies=[];for(var t=0;t<=b;t++)v.frequencies[t]=v.ratios[t]*e,v.frequencies[t]=v.frequencies[t].toFixed(2);v.pitchNumber=b,v.eqTempPitchNumber=null,v.eqTempHzs=[],v.checkTemperament(T),v._circleOfNotes()},docById("preview").onclick=function(){v.equalEdit(),v.eqTempPitchNumber=null,v.eqTempHzs=[]}}}},this.ratioEdit=function(){this.editMode="ratio",docById("userEdit").innerHTML="";var n=docById("userEdit");n.style.backgroundColor="#c8C8C8",n.innerHTML="<br>".concat(_("ratio"),' &nbsp;&nbsp;&nbsp;&nbsp; <input type="text" id="ratioIn" value="1"></input> &nbsp;&nbsp; : &nbsp;&nbsp; <input type="text" id="ratioOut" value="1"></input><br><br>'),n.innerHTML+="".concat(_("recursion"),' &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="text" id="recursion" value="1"></input>'),n.style.paddingLeft="100px";var w=this,C=document.createElement("div");function B(e){C.id="divAppend",C.innerHTML=e?'<div id="preview" style="float:left;">'.concat(_("back"),'</div>\n                    <div id="done_" style="float:right;">').concat(_("done"),"</div>"):'<div id="preview" style="float:left;">'.concat(_("preview"),'</div>\n                    <div id="done_" style="float:right;">').concat(_("done"),"</div>"),C.style.textAlign="center",C.style.marginLeft="-100px",C.style.height="32px",C.style.marginTop="40px",C.style.overflow="auto",n.append(C);var t=docById("preview");t.style.height="30px",t.style.marginLeft="3px",t.style.backgroundColor=platformColor.selectorBackground,t.style.width="215px";var i=docById("done_");i.style.height="30px",i.style.marginRight="3px",i.style.backgroundColor=platformColor.selectorBackground,i.style.width="205px"}B(!1),C.onmouseover=function(){this.style.cursor="pointer"},C.onclick=function(e){var t=docById("ratioIn").value,i=docById("ratioOut").value,n=docById("recursion").value,s=w.frequencies.length,o=t/i,l=[],r=[],a=[],c=[],h=[];w.tempRatios=w.ratios.slice();for(var d=0;d<n;d++)l[d]=Math.pow(o,d+1),r[d]=w.frequencies[0]*l[d],function e(t){if(r[t]<w.frequencies[s-1])for(var i=0;i<w.tempRatios.length;i++){if(a[i]=l[t]-w.tempRatios[i],a[i]<0){c.push(i),w.tempRatios.splice(c[t],0,l[t]);break}if(0==a[i]){c.push(i),w.tempRatios.splice(c[t],1,l[t]);break}}else l[t]=l[t]/2,r[t]=w.frequencies[0]*l[t],e(t)}(d);w.tempRatios.sort(function(e,t){return e-t});var u=w.tempRatios.length-1;if(e.target.innerHTML===_("done")){w.ratios=w.tempRatios.slice(),w.typeOfEdit="nonequal",w.pitchNumber=w.ratios.length-1;var p=w.frequencies[0];w.frequencies=[];for(var m=0;m<=w.pitchNumber;m++)w.frequencies[m]=w.ratios[m]*p,w.frequencies[m]=w.frequencies[m].toFixed(2);for(var y=0;y<w.ratios.length;y++)h[y]=w.ratios[y],h[y]=h[y].toFixed(2);w.checkTemperament(h),w._circleOfNotes()}else if(e.target.innerHTML===_("preview")){docById("userEdit").innerHTML='<div id="wheelDiv2" class="wheelNav"></div>',w.createMainWheel(w.tempRatios,u);for(var v=0;v<u;v++)w.notesCircle.navItems[v].fillAttr="#e0e0e0",w.notesCircle.navItems[v].sliceHoverAttr.fill="#e0e0e0",w.notesCircle.navItems[v].slicePathAttr.fill="#e0e0e0",w.notesCircle.navItems[v].sliceSelectedAttr.fill="#e0e0e0";w.notesCircle.refreshWheel(),docById("userEdit").style.paddingLeft="0px",B(!0),C.style.marginTop=docById("wheelDiv2").style.height,docById("preview").style.marginLeft="100px";var f=w.tempRatios.slice();w.typeOfEdit="nonequal",w.NEqTempPitchNumber=f.length-1;var g=w.frequencies[0];w.NEqTempHzs=[];for(var b=0;b<=w.NEqTempPitchNumber;b++)w.NEqTempHzs[b]=f[b]*g,w.NEqTempHzs[b]=w.NEqTempHzs[b].toFixed(2);for(var I=0;I<f.length;I++)h[I]=f[I],h[I]=h[I].toFixed(2);w.checkTemperament(h),docById("done_").onclick=function(){w.ratios=w.tempRatios.slice(),w.pitchNumber=w.ratios.length-1;var e=w.frequencies[0];w.frequencies=[];for(var t=0;t<=w.pitchNumber;t++)w.frequencies[t]=w.ratios[t]*e,w.frequencies[t]=w.frequencies[t].toFixed(2);for(var i=0;i<w.ratios.length;i++)h[i]=w.ratios[i],h[i]=h[i].toFixed(2);w.checkTemperament(h),w._circleOfNotes(),w.NEqTempPitchNumber=null,w.NEqTempHzs=[]},docById("preview").onclick=function(){w.ratioEdit(),w.NEqTempPitchNumber=null,w.NEqTempHzs=[]}}}},this.arbitraryEdit=function(){this.editMode="arbitrary",docById("userEdit").innerHTML="";var e=docById("userEdit");e.innerHTML='<br><div id="wheelDiv3" class="wheelNav"></div>',e.style.paddingLeft="0px";var d=this,c=[];this.tempRatios1=this.ratios.slice(),this._createInnerWheel=function(e,t){void 0!==this.wheel1&&(docById("wheelDiv4").display="none",this.wheel1.removeWheel()),null==e&&(e=this.ratios),null==t&&(t=this.pitchNumber);for(var i=[],n=0;n<t;n++)i.push(n.toString());docById("wheelDiv4").style.display="",docById("wheelDiv4").style.background="none",docById("wheelDiv4").style.position="relative",docById("wheelDiv4").style.zIndex=5,this.wheel1=new wheelnav("wheelDiv4"),this.wheel1.wheelRadius=200,this.wheel1.navItemsEnabled=!1,this.wheel1.navAngle=270,this.wheel1.navItemsContinuous=!0,this.wheel1.navItemsCentered=!1,this.wheel1.slicePathFunction=slicePath().MenuSliceWithoutLine,this.wheel1.slicePathCustom=slicePath().MenuSliceCustomization(),this.wheel1.sliceSelectedPathCustom=this.wheel1.slicePathCustom,this.wheel1.sliceInitPathCustom=this.wheel1.slicePathCustom,this.wheel1.initWheel(i);for(var s=[],o=[],l=[],r=[],a=0;a<this.wheel1.navItemCount;a++)this.wheel1.navItems[a].fillAttr="#e0e0e0",this.wheel1.navItems[a].titleAttr.font="20 20px Impact, Charcoal, sans-serif",this.wheel1.navItems[a].titleSelectedAttr.font="20 20px Impact, Charcoal, sans-serif",l[a]=270+Math.log10(e[a])/Math.log10(this.powerBase)*360,0!==a&&(a==this.pitchNumber-1?r[a-1]=l[0]+360-l[a]:r[a-1]=l[a]-l[a-1]),0===a?(o[a]=360/t,s[a]=this.wheel1.navAngle-o[0]/2):(s[a]=s[a-1]+o[a-1],o[a]=2*(l[a]-s[a])),this.wheel1.navItems[a].sliceAngle=o[a];for(var c=2*Math.PI*128/t/3,h=0;h<r.length;h++)r[h]<11&&(c=2*Math.PI*128/this.pitchNumber/6);29<c&&(c=2*Math.PI*128/33),this.wheel1.slicePathCustom.menuRadius=c,null!==docById("frequencySlider")&&(docById("frequencySlider").oninput=function(){d._refreshInnerWheel()}),this.wheel1.createWheel()},e.innerHTML+='<div id="wheelDiv4" class="wheelNav"></div>',this._createInnerWheel(),e.innerHTML+='<canvas id="circ1" width = "'.concat(u,'" height = "').concat(256,'"></canvas>');var t=docById("circ1");t.style.position="absolute",t.style.zIndex=1,t.style.marginTop="-305px";var i=t.getContext("2d"),n=t.width/2,s=t.height/2;i.beginPath(),i.arc(n,s,128,0,2*Math.PI,!1),i.fillStyle="rgba(204, 0, 102, 0)",i.fill(),i.lineWidth=1,i.strokeStyle="#003300",i.stroke(),this._createOuterWheel=function(t,i){void 0!==this.wheel&&(docById("wheelDiv3").display="none",this.wheel.removeWheel()),null==i&&(i=this.pitchNumber),null==t&&(t=this.ratios),docById("wheelDiv3").style.display="",docById("wheelDiv3").style.background="none",this.wheel=new wheelnav("wheelDiv3",null,600,600),this.wheel.wheelRadius=300,this.wheel.slicePathFunction=slicePath().DonutSlice,this.wheel.slicePathCustom=slicePath().DonutSliceCustomization(),this.wheel.slicePathCustom.minRadiusPercent=.9,this.wheel.slicePathCustom.maxRadiusPercent=1,this.wheel.sliceSelectedPathCustom=this.wheel.slicePathCustom,this.wheel.sliceInitPathCustom=this.wheel.slicePathCustom,this.wheel.colors=["#c0c0c0","#e0e0e0"],this.wheel.titleRotateAngle=90,this.wheel.navItemsEnabled=!1;var e=[],n=[],s=[],o=[],l=[];c=[];for(var r=0;r<=i;r++)r!==i&&e.push("|"),n[r]=270+Math.log10(t[r])/Math.log10(this.powerBase)*360,0!==r&&(s[r-1]=r==i-1?n[0]+360-n[r]:n[r]-n[r-1],c[r-1]=n[r-1]+s[r-1]/2);this.wheel.navAngle=270+s[0]/2,this.wheel.initWheel(e);for(var a=0;a<i;a++)0===a?(l[a]=360/i,o[a]=this.wheel.navAngle-l[0]/2):(o[a]=o[a-1]+l[a-1],l[a]=2*(c[a]-o[a])),this.wheel.navItems[a].sliceAngle=l[a];this.wheel.createWheel(),docById("wheelDiv3").style.position="absolute",docById("wheelDiv3").style.zIndex=10,docById("wheelDiv3").style.marginTop="15px",docById("wheelDiv3").style.marginLeft="37px",docById("wheelDiv3").addEventListener("mouseover",function(e){d.arbitraryEditSlider(e,c,t,i)})},this._createOuterWheel();var o=document.createElement("div");o.id="divAppend",o.innerHTML=_("done"),o.style.textAlign="center",o.style.paddingTop="5px",o.style.backgroundColor=platformColor.selectorBackground,o.style.height="25px",o.style.marginTop="40px",o.style.overflow="auto",e.append(o),o.onmouseover=function(){this.style.cursor="pointer"},o.onclick=function(){d.ratios=d.tempRatios1.slice(),d.typeOfEdit="nonequal",d.pitchNumber=d.ratios.length-1;var e=[],t=d.frequencies[0];d.frequencies=[];for(var i=0;i<d.ratios.length;i++)d.frequencies[i]=d.ratios[i]*t,d.frequencies[i]=d.frequencies[i].toFixed(2);for(var n=0;n<d.ratios.length;n++)e[n]=d.ratios[n],e[n]=e[n].toFixed(2);d.checkTemperament(e),d._circleOfNotes()}},this.arbitraryEditSlider=function(e,t,i,n){for(var s=this,o=this.frequencies[0],l=[],r=0;r<=n;r++)l[r]=i[r]*o,l[r]=l[r].toFixed(2);for(var a=0;a<n;a++)e.target.parentNode.id=="wheelnav-wheelDiv3-title-"+a&&function(){var t=s;null!==docById("noteInfo1")&&docById("noteInfo1").remove(),docById("wheelDiv3").innerHTML+='<div class="popup" id="noteInfo1" style="width:180px; height:135px;"><span class="popuptext" id="myPopup"></span></div>',docById("noteInfo1").innerHTML+='<img src="header-icons/close-button.svg" id="close" title="'+_("Close")+'" alt="'+_("Close")+'" height=20px width=20px align="right">',docById("noteInfo1").innerHTML+='<br><center><input type="range" class="sliders" id = "frequencySlider" style="width:170px; background:white; border:0;" min="'.concat(l[a],'" max="').concat(l[a+1],'" value="30"></center>'),docById("noteInfo1").innerHTML+="&nbsp;&nbsp;".concat(_("frequency"),' : <span class="rangeslidervalue" id="frequencydiv">').concat(l[a],"</span>"),docById("noteInfo1").innerHTML+='<br><br><div id="done" style="background:rgb(196, 196, 196);"><center>'.concat(_("done"),"</center><div>"),docById("noteInfo1").style.top="100px",docById("noteInfo1").style.left="90px",docById("frequencySlider").oninput=function(){t._refreshInnerWheel()},docById("done").onclick=function(){t.tempRatios1=t.tempRatios.slice();var e=t.tempRatios1.length-1;t._createOuterWheel(t.tempRatios1,e)},docById("close").onclick=function(){t.tempRatios=t.tempRatios1.slice();var e=t.tempRatios.length-1;t._createInnerWheel(t.tempRatios,e),docById("noteInfo1").remove()}}()},this._refreshInnerWheel=function(){docById("frequencydiv").innerHTML=docById("frequencySlider").value;var e=docById("frequencySlider").value,t=e/this.frequencies[0],i=[];this.tempRatios=this.tempRatios1.slice();for(var n=0;n<this.tempRatios.length;n++){i[n]=t-this.tempRatios[n],i[n]=i[n].toFixed(2);var s=void 0;if(i[n]<0){s=n,this.tempRatios.splice(s,0,t);break}if(0===i[n]){s=n,this.tempRatios.splice(s,1,t);break}}var o=this.tempRatios.length-1;this._logo.resetSynth(0),this._logo.synth.trigger(0,e,.01*Singer.defaultBPMFactor,"electronic synth",null,null),this._createInnerWheel(this.tempRatios,o)},this.octaveSpaceEdit=function(){this.editMode="octave",docById("userEdit").innerHTML="";var o=this.ratios.length,e=this.ratios[o-1],t=docById("userEdit");t.style.backgroundColor="#c8C8C8",t.innerHTML="<br><br>".concat(_("octave space"),' &nbsp;&nbsp;&nbsp;&nbsp; \n            <input type="text" id="startNote" value="').concat(e,'" style="width:50px;"></input> &nbsp;&nbsp; : &nbsp;&nbsp; <input type="text" id="endNote" value="1" style="width:50px;"></input><br><br>'),t.style.paddingLeft="70px";var l=this,i=document.createElement("div");i.id="divAppend",i.innerHTML=_("done"),i.style.textAlign="center",i.style.paddingTop="5px",i.style.marginLeft="-70px",i.style.backgroundColor=platformColor.selectorBackground,i.style.height="25px",i.style.marginTop="40px",i.style.overflow="auto",t.append(i),i.onmouseover=function(){this.style.cursor="pointer"},i.onclick=function(){var e=docById("startNote").value/docById("endNote").value;2!=e&&l.activity.textMsg(_("The octave ratio has changed. This changes temperament significantly."),3e3);var t=[],i=[],n=l.frequencies[0];l.frequencies=[];for(var s=0;s<o;s++)t[s]=Math.log10(l.ratios[s])/Math.log10(l.powerBase)*12,l.ratios[s]=Math.pow(e,t[s]/12),i[s]=l.ratios[s].toFixed(2),l.frequencies[s]=l.ratios[s]*n,l.frequencies[s]=l.frequencies[s].toFixed(2);l.powerBase=e,l.typeOfEdit="nonequal",l.checkTemperament(i),2!=e&&(l.octaveChanged=!0),l._circleOfNotes()}},this.checkTemperament=function(n){for(var s,o=this,l=[],e=getTemperamentKeys(),t=0;t<e.length;t++){var r=e[t];if(!isCustomTemperament(r))if("break"===function(){for(var e=getTemperament(r),i=[],t=0;t<e.interval.length;t++)l[t]=e.interval[t],i[t]=e[l[t]],i[t]=i[t].toFixed(2);if(n.length==i.length&&n.every(function(e,t){return e===i[t]}))return s=r,o.inTemperament=r,m.innerHTML=o.inTemperament,"break"}())break}void 0===s&&(this.inTemperament="custom",m.innerHTML=this.inTemperament)},this._save=function(){if(this.notes=[],isCustomTemperament(this.inTemperament))for(var e=this._logo.synth.startingPitch,t=Number(e.slice(-1)),i=pitchToFrequency(e.substring(0,e.length-1),t,0,"C Major"),n="",s=0;s<this.ratios.length;s++){var o=frequencyToPitch(this.ratios[s]*i),l=o[0],r=o[1],a=o[2];2!==this.powerBase&&(n=r);var c="";a<0?(a<-30?c="vv":a<-15&&(c="v"),this.notes[s]=c+l+n+"("+a.toFixed(0)+"¢)"+r):(30<a?c="^^":15<a&&(c="^"),this.notes[s]=c+l+n+"(+"+a.toFixed(0)+"¢)"+r)}setOctaveRatio(this.powerBase);var h=this._logo.synth.startingPitch.length,d=this._logo.synth.startingPitch.substring(0,h-1),u=this._logo.synth.startingPitch.slice(-1),p=[[0,"settemperament",150,150,[null,1,2,3,null]],[1,["temperamentname",{value:this.inTemperament}],0,0,[0]],[2,["notename",{value:d}],0,0,[0]],[3,["number",{value:u}],0,0,[0]]];this.activity.blocks.loadNewBlocks(p);for(var m=this.activity.blocks.findUniqueTemperamentName(this.inTemperament),y=[[0,["temperament1",{collapsed:!0}],150,100,[null,1,2,null]],[1,["text",{value:this.inTemperament=m}],0,0,[0]],[2,["storein"],0,0,[0,3,4,5]],[3,["text",{value:this._logo.synth.startingPitch}],0,0,[2]],[4,["number",{value:this.frequencies[0]}],0,0,[2]],[5,["octavespace"],0,0,[2,6,9]],[6,["divide"],0,0,[5,7,8]],[7,["number",{value:rationalToFraction(getOctaveRatio())[0]}],0,0,[6]],[8,["number",{value:rationalToFraction(getOctaveRatio())[1]}],0,0,[6]],[9,"vspace",0,0,[5,10]]],v=9,f=0;f<this.pitchNumber;f++)var g=y.length,v=this.inTemperament.startsWith("equal")||"1/3 comma meantone"===this.inTemperament||"equal"===this.typeOfEdit&&this.divisions===this.pitchNumber?(y.push([g,"definefrequency",0,0,[v,g+1,g+8,g+12]]),y.push([g+1,"multiply",0,0,[g,g+2,g+3]]),y.push([g+2,["namedbox",{value:this._logo.synth.startingPitch}],0,0,[g+1]]),y.push([g+3,["power"],0,0,[g+1,g+4,g+5]]),y.push([g+4,["number",{value:this.powerBase}],0,0,[g+3]]),y.push([g+5,["divide"],0,0,[g+3,g+6,g+7]]),y.push([g+6,["number",{value:f}],0,0,[g+5]]),y.push([g+7,["number",{value:this.pitchNumber}],0,0,[g+5]]),y.push([g+8,"vspace",0,0,[g,g+9]]),y.push([g+9,["pitch"],0,0,[g+8,g+10,g+11,null]]),isCustomTemperament(this.inTemperament)?(y.push([g+10,["text",{value:this.notes[f].substring(0,this.notes[f].length-1)}],0,0,[g+9]]),y.push([g+11,["number",{value:this.notes[f].slice(-1)}],0,0,[g+9]])):(y.push([g+10,["notename",{value:this.ratiosNotesPair[f][1][0]}],0,0,[g+9]]),y.push([g+11,["number",{value:this.ratiosNotesPair[f][1][1]}],0,0,[g+9]])),f==this.pitchNumber-1?y.push([g+12,"hidden",0,0,[g,null]]):y.push([g+12,"hidden",0,0,[g,g+13]]),g+12):(y.push([g,"definefrequency",0,0,[v,g+1,g+6,g+10]]),y.push([g+1,"multiply",0,0,[g,g+2,g+3]]),y.push([g+2,["namedbox",{value:this._logo.synth.startingPitch}],0,0,[g+1]]),y.push([g+3,["divide"],0,0,[g+1,g+4,g+5]]),y.push([g+4,["number",{value:rationalToFraction(this.ratios[f])[0]}],0,0,[g+3]]),y.push([g+5,["number",{value:rationalToFraction(this.ratios[f])[1]}],0,0,[g+3]]),y.push([g+6,"vspace",0,0,[g,g+7]]),y.push([g+7,["pitch"],0,0,[g+6,g+8,g+9,null]]),isCustomTemperament(this.inTemperament)?(y.push([g+8,["text",{value:this.notes[f].substring(0,this.notes[f].length-1)}],0,0,[g+7]]),y.push([g+9,["number",{value:this.notes[f].slice(-1)}],0,0,[g+7]])):(y.push([g+8,["notename",{value:this.ratiosNotesPair[f][1][0]}],0,0,[g+7]]),y.push([g+9,["number",{value:this.ratiosNotesPair[f][1][1]}],0,0,[g+7]])),f==this.pitchNumber-1?y.push([g+10,"hidden",0,0,[g,null]]):y.push([g+10,"hidden",0,0,[g,g+11]]),g+10);var b=this;if(setTimeout(function(){b.activity.blocks.loadNewBlocks(y),activity.textMsg(_("New action block generated."),3e3)},500),isCustomTemperament(this.inTemperament)){deleteTemperamentFromList(this.inTemperament);for(var I={pitchNumber:this.pitchNumber},w=0;w<this.pitchNumber;w++){I[""+w]=[this.ratios[w],this.notes[w].substring(0,this.notes[w].length-1),this.notes[w].slice(-1)]}console.log(I),addTemperamentToDictionary(this.inTemperament,I),updateTemperaments()}isCustomTemperament(this.inTemperament)&&(this._logo.customTemperamentDefined=!0,this.activity.blocks.protoBlockDict.custompitch.hidden=!1,this.activity.blocks.palettes.updatePalettes("pitch"))},this.playNote=function(e){this._logo.resetSynth(0);var t;null===docById("wheelDiv4")?(t=this.frequencies[e],"equal"==this.editMode&&this.eqTempHzs&&this.eqTempHzs.length?t=this.eqTempHzs[e]:"ratio"==this.editMode&&this.NEqTempHzs&&this.NEqTempHzs.length&&(t=this.NEqTempHzs[e])):t=this.tempRatios1[e]*this.frequencies[0],this._logo.synth.trigger(0,t,.5*Singer.defaultBPMFactor,"electronic synth",null,null)},this.playAll=function(){var i=0;this._playing=!this._playing,this._logo.resetSynth(0);var n=this.playButton;this._playing?n.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/stop-button.svg" \n                    title="'.concat(_("Stop"),'" \n                    alt="').concat(_("Stop"),'" \n                    height="').concat(p,'" \n                    width="').concat(p,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;'):(this._logo.synth.setMasterVolume(0),this._logo.synth.stop(),n.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="').concat(p,'" \n                    width="').concat(p,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;'));var e=this._logo.synth.startingPitch,t=Number(e.slice(-1))-1,s=pitchToFrequency(e.substring(0,e.length-1),t,0,"C Major"),o=this,l=this.pitchNumber;"equal"==this.editMode&&this.eqTempPitchNumber?l=this.eqTempPitchNumber:"ratio"==this.editMode&&this.NEqTempPitchNumber&&(l=this.NEqTempPitchNumber),null!==docById("wheelDiv4")&&(l=this.tempRatios1.length-1);var r=(new Date).getTime();if(this._playing&&r-this.lastClickTime>1e3*Singer.defaultBPMFactor*.5||this.inbetween){if(o.playbackForward=!0,this.inbetween=!1,this.circleIsVisible)for(var a=0;a<=this.pitchNumber;a++){docById("pitchNumber_"+a).style.background=platformColor.selectorBackground}!function e(t){t===l&&(o.playbackForward=!1),0===t&&i++,o._playing&&(o._logo.synth.trigger(0,s,.5*Singer.defaultBPMFactor,"electronic synth",null,null),o.playNote(t)),0==o.circleIsVisible&&null==docById("wheelDiv4")?(t===l&&o._playing?(o.notesCircle.navItems[0].fillAttr="#808080",o.notesCircle.navItems[0].sliceHoverAttr.fill="#808080",o.notesCircle.navItems[0].slicePathAttr.fill="#808080",o.notesCircle.navItems[0].sliceSelectedAttr.fill="#808080"):o._playing&&(o.notesCircle.navItems[t].fillAttr="#808080",o.notesCircle.navItems[t].sliceHoverAttr.fill="#808080",o.notesCircle.navItems[t].slicePathAttr.fill="#808080",o.notesCircle.navItems[t].sliceSelectedAttr.fill="#808080"),0==o.playbackForward&&t<l?t===l-1?(o.notesCircle.navItems[0].fillAttr="#c8C8C8",o.notesCircle.navItems[0].sliceHoverAttr.fill="#c8C8C8",o.notesCircle.navItems[0].slicePathAttr.fill="#c8C8C8",o.notesCircle.navItems[0].sliceSelectedAttr.fill="#c8C8C8"):(o.notesCircle.navItems[t+1].fillAttr="#c8C8C8",o.notesCircle.navItems[t+1].sliceHoverAttr.fill="#c8C8C8",o.notesCircle.navItems[t+1].slicePathAttr.fill="#c8C8C8",o.notesCircle.navItems[t+1].sliceSelectedAttr.fill="#c8C8C8"):0!==t&&(o.notesCircle.navItems[t-1].fillAttr="#c8C8C8",o.notesCircle.navItems[t-1].sliceHoverAttr.fill="#c8C8C8",o.notesCircle.navItems[t-1].slicePathAttr.fill="#c8C8C8",o.notesCircle.navItems[t-1].sliceSelectedAttr.fill="#c8C8C8"),o.notesCircle.refreshWheel()):1==o.circleIsVisible&&null==docById("wheelDiv4")?(docById("pitchNumber_"+t).style.background=platformColor.labelColor,0==o.playbackForward&&t<l?docById("pitchNumber_"+(t+1)).style.background=platformColor.selectorBackground:0!==t&&(docById("pitchNumber_"+(t-1)).style.background=platformColor.selectorBackground)):null!==docById("wheelDiv4")&&(t===l?(o.wheel1.navItems[0].fillAttr="#808080",o.wheel1.navItems[0].sliceHoverAttr.fill="#808080",o.wheel1.navItems[0].slicePathAttr.fill="#808080",o.wheel1.navItems[0].sliceSelectedAttr.fill="#808080"):(o.wheel1.navItems[t].fillAttr="#808080",o.wheel1.navItems[t].sliceHoverAttr.fill="#808080",o.wheel1.navItems[t].slicePathAttr.fill="#808080",o.wheel1.navItems[t].sliceSelectedAttr.fill="#808080"),0==o.playbackForward&&t<l?t===l-1?(o.wheel1.navItems[0].fillAttr="#e0e0e0",o.wheel1.navItems[0].sliceHoverAttr.fill="#e0e0e0",o.wheel1.navItems[0].slicePathAttr.fill="#e0e0e0",o.wheel1.navItems[0].sliceSelectedAttr.fill="#e0e0e0"):(o.wheel1.navItems[t+1].fillAttr="#e0e0e0",o.wheel1.navItems[t+1].sliceHoverAttr.fill="#e0e0e0",o.wheel1.navItems[t+1].slicePathAttr.fill="#e0e0e0",o.wheel1.navItems[t+1].sliceSelectedAttr.fill="#e0e0e0"):0!==t&&(o.wheel1.navItems[t-1].fillAttr="#e0e0e0",o.wheel1.navItems[t-1].sliceHoverAttr.fill="#e0e0e0",o.wheel1.navItems[t-1].slicePathAttr.fill="#e0e0e0",o.wheel1.navItems[t-1].sliceSelectedAttr.fill="#e0e0e0"),o.wheel1.refreshWheel()),o.playbackForward?t+=1:--t,t<=l&&0<=t&&o._playing&&i<2?setTimeout(function(){e(t)},1e3*Singer.defaultBPMFactor*.5):o.inbetween=!0,o.playbackForward||-1!=t||(n.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(p,'" \n                        width="').concat(p,'" \n                        vertical-align="middle" \n                        align-content="center"\n                    >&nbsp;&nbsp;'),o._playing=!1,o.playbackForward=!0,this.inbetween=!1,setTimeout(function(){o.notesCircle.navItems[0].fillAttr="#c8C8C8",o.notesCircle.navItems[0].sliceHoverAttr.fill="#c8C8C8",o.notesCircle.navItems[0].slicePathAttr.fill="#c8C8C8",o.notesCircle.navItems[0].sliceSelectedAttr.fill="#c8C8C8",o.notesCircle.refreshWheel()},1e3*Singer.defaultBPMFactor*.5))}(0)}this.lastClickTime=r},this.init=function(e){this.activity=e,this._logo=this.activity.logo;var t=window.innerWidth;this._cellScale=t/1200;var i=window.widgetWindows.windowFor(this,"temperament");(this.widgetWindow=i).clear(),i.show(),i.getWidgetBody().append(y),i.getWidgetBody().style.height="500px",i.getWidgetBody().style.width="500px";var n=this;i.onclose=function(){n._logo.synth.setMasterVolume(0),n._logo.synth.stop(),null!=docById("wheelDiv2")&&(docById("wheelDiv2").style.display="none",n.notesCircle.removeWheel()),null!=docById("wheelDiv3")&&(docById("wheelDiv3").style.display="none",n.wheel.removeWheel()),null!=docById("wheelDiv4")&&(docById("wheelDiv4").style.display="none",n.wheel1.removeWheel()),this.destroy()},this._playing=!1;var s=document.createElement("table").createTHead().insertRow(0);s.id="buttonsRow",(m=s.insertCell()).innerHTML=this.inTemperament,m.style.width="106px",m.style.minWidth=m.style.width,m.style.maxWidth=m.style.width,m.style.height="53px",m.style.minHeight=m.style.height,m.style.maxHeight=m.style.height,m.style.textAlign="center",m.style.backgroundColor=platformColor.selectorBackground,this.playButton=i.addButton("play-button.svg",p,_("Play all")),this.lastClickTime=0,this.playbackForward=!0,this.inbetween=!1,this.playButton.onclick=function(){n.playAll()},i.addButton("export-chunk.svg",p,_("Save")).onclick=function(){n._save()};var o=i.addButton("play-button.svg",p,_("Table")),l=getTemperament(this.inTemperament);this.pitchNumber=l.pitchNumber,this.octaveChanged=!1,this.scale=this.scale[0]+" "+this.scale[1],this.scaleNotes=buildScale(this.scale),this.scaleNotes=this.scaleNotes[0],this.powerBase=2;var r=this._logo.synth.startingPitch,a=[],c=[];this.notes=[],this.frequencies=[],this.cents=[],this.intervals=[],this.ratios=[],this.ratiosNotesPair=[];for(var h,d,u=0;u<=this.pitchNumber;u++){isCustomTemperament(this.inTemperament)&&void 0!==l[0]&&void 0!==l[0][1]?(h=u+"",u===this.pitchNumber?(this.notes[u]=[l[0][1],Number(l[0][2])+1],this.ratios[u]=this.powerBase):(this.notes[u]=[l[h][1],l[h][2]],this.ratios[u]=l[h][0]),this.frequencies[u]=this._logo.synth.getCustomFrequency(this.notes[u][0]+this.notes[u][1]+"",this.inTemperament).toFixed(2),this.cents[u]=Math.log10(this.ratios[u])/Math.log10(this.powerBase)*1200):(isCustomTemperament(this.inTemperament)&&(l=getTemperament("equal")),a[u]=getNoteFromInterval(r,l.interval[u]),this.notes[u]=a[u],c[u]=a[u][0],a[u][0].substring(1,a[u][0].length)===FLAT||"b"===a[u][0].substring(1,a[u][0].length)?c[u]=a[u][0].replace(FLAT,"b"):a[u][0].substring(1,a[u][0].length)!==SHARP&&"#"!==a[u][0].substring(1,a[u][0].length)||(c[u]=a[u][0].replace(SHARP,"#")),a[u]=c[u]+a[u][1],this.intervals[u]=l.interval[u],this.ratios[u]=l[this.intervals[u]],this.cents[u]=Math.log10(this.ratios[u])/Math.log10(this.powerBase)*1200,0==u?this.frequencies[u]=this._logo.synth._getFrequency(a[u],!0,this.inTemperament).toFixed(2):(d=this.frequencies[0]*this.ratios[u],this.frequencies[u]=d.toFixed(2))),this.ratiosNotesPair[u]=[this.ratios[u],this.notes[u]]}this.toggleNotesButton=function(){this.circleIsVisible?(o.getElementsByTagName("img")[0].src="header-icons/circle.svg",o.getElementsByTagName("img")[0].title="circle",o.getElementsByTagName("img")[0].alt="circle"):(o.getElementsByTagName("img")[0].src="header-icons/table.svg",o.getElementsByTagName("img")[0].title="table",o.getElementsByTagName("img")[0].alt="table")},this._circleOfNotes(),o.onclick=function(e){n.editMode=null,n.circleIsVisible?n._circleOfNotes():n._graphOfNotes()},i.addButton("add2.svg",p,_("Add pitches")).onclick=function(e){n.edit()},i.sendToCenter()}}