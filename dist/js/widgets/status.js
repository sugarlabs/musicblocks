"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,n=!0,l=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return n=t.done,t},e:function(t){l=!0,o=t},f:function(){try{n||null==i.return||i.return()}finally{if(l)throw o}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);var r=i.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var StatusMatrix=function(){function p(){_classCallCheck(this,p)}return _createClass(p,[{key:"init",value:function(t){var r=this;this.activity=t,this.isOpen=!0,this.isMaximized=!1,this._cellScale=window.innerWidth/1200;var e=this._cellScale;this.widgetWindow=window.widgetWindows.windowFor(this,"status","status"),this.widgetWindow.clear(),this.widgetWindow.show(),this._statusTable=document.createElement("table"),this.widgetWindow.getWidgetBody().append(this._statusTable),this.widgetWindow.onclose=function(){r.isOpen=!1,r.widgetWindow.destroy()};var a=this._statusTable.createTHead(),i=a.insertRow(),e=Math.floor(24*this._cellScale);(y=i.insertCell()).style.backgroundColor="#FFFFFF",y.className="headcol",y.style.height=Math.floor(MATRIXBUTTONHEIGHT*this._cellScale)+"px",y.style.width="212.5px",y.innerHTML="&nbsp;";var o,n,l=_createForOfIteratorHelper(this.activity.turtles.turtleList);try{for(l.s();!(o=l.n()).done;){var s=o.value;s.inTrash||((y=i.insertCell()).style.backgroundColor="#FFFFFF",_THIS_IS_MUSIC_BLOCKS_?y.innerHTML='&nbsp;&nbsp;<img \n                        src="images/mouse.svg" \n                        title="'.concat(s.name,'" \n                        alt="').concat(s.name,'" \n                        height="').concat(e,'" \n                        width="').concat(e,'"\n                    >&nbsp;&nbsp;'):y.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/turtle-button.svg" \n                        title="'.concat(s.name,'" \n                        alt="').concat(s.name,'" \n                        height="').concat(e,'"\n                        width="').concat(e,'"\n                    >&nbsp;&nbsp;'),y.style.width="212.5px",this.widgetWindow.onmaximize=function(){r.isMaximized=!r.isMaximized,y.style.width="100vw",y.style.paddingLeft="30px",y.style.fontSize=.9*Math.floor(r._cellScale*p.FONTSCALEFACTOR)+"%",r.isMaximized||(y.style.width="212.5px")},y.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+"px",y.className="headcol")}}catch(t){l.e(t)}finally{l.f()}var c,u,y,f,h,b=_createForOfIteratorHelper(this.activity.logo.statusFields);try{for(b.s();!(c=b.n()).done;)!function(){var t=c.value,e=a.insertRow();switch((y=e.insertCell()).style.fontSize=.9*Math.floor(r._cellScale*p.FONTSCALEFACTOR)+"%",t[1]){case"plus":case"minus":case"neg":case"divide":case"power":case"multiply":case"sqrt":case"int":case"mod":n="";break;case"namedbox":n=r.activity.blocks.blockList[t[0]].privateData;break;case"heap":n=_("heap");break;case"bpm":case"bpmfactor":n="ja"===localStorage.languagePreference?_("beats per minute2"):r.activity.blocks.blockList[t[0]].protoblock.staticLabels[0];break;case"outputtools":n=r.activity.blocks.blockList[t[0]].privateData;break;default:n=r.activity.blocks.blockList[t[0]].protoblock.staticLabels[0]}var i=n.charAt(0).toUpperCase()+n.slice(1);y.innerHTML="&nbsp;<b>".concat(i,"</b>"),y.style.height=Math.floor(MATRIXBUTTONHEIGHT*r._cellScale)+"px",y.style.backgroundColor=platformColor.selectorBackground,y.style.paddingLeft="10px",r.activity.turtles.turtleList.forEach(function(){(y=e.insertCell()).style.backgroundColor=platformColor.selectorBackground,y.style.fontSize=.9*Math.floor(r._cellScale*p.FONTSCALEFACTOR)+"%",y.innerHTML="",y.style.height=Math.floor(MATRIXSOLFEHEIGHT*r._cellScale)+"px",y.style.textAlign="center"})}()}catch(t){b.e(t)}finally{b.f()}_THIS_IS_MUSIC_BLOCKS_&&(u=a.insertRow(),(y=u.insertCell()).style.fontSize=.9*Math.floor(this._cellScale*p.FONTSCALEFACTOR)+"%",h=(f=_("note")).charAt(0).toUpperCase()+f.slice(1),y.innerHTML="&nbsp;<b>".concat(h,"</b>"),y.style.height=Math.floor(MATRIXBUTTONHEIGHT*this._cellScale)+"px",y.style.backgroundColor=platformColor.selectorBackground,y.style.paddingLeft="10px",this.activity.turtles.turtleList.forEach(function(){(y=u.insertCell()).style.backgroundColor=platformColor.selectorBackground,y.style.fontSize=.9*Math.floor(r._cellScale*p.FONTSCALEFACTOR)+"%",y.innerHTML="",y.style.height=Math.floor(MATRIXSOLFEHEIGHT*r._cellScale)+"px",y.style.textAlign="center"})),this.widgetWindow.sendToCenter()}},{key:"updateAll",value:function(){this.activity.logo.updatingStatusMatrix=!0;var t,e,i=0,r=0,a=_createForOfIteratorHelper(this.activity.turtles.turtleList);try{for(a.s();!(e=a.n()).done;){var o=e.value,n=this.activity.turtles.ithTurtle(r);if(!o.inTrash){var l,s,c,u,y,f=void 0,h=void 0,b=void 0,p=0,d=_createForOfIteratorHelper(this.activity.logo.statusFields);try{for(d.s();!(y=d.n()).done;){var v=y.value,g=this.activity.logo.inStatusMatrix;switch(this.activity.logo.inStatusMatrix=!1,this.activity.logo.parseArg(this.activity.logo,r,v[0]),this.activity.blocks.blockList[v[0]].name){case"x":case"y":case"heading":f=this.activity.blocks.blockList[v[0]].value.toFixed(0);break;case"mynotevalue":f=mixedNumber(this.activity.blocks.blockList[v[0]].value);break;case"elapsednotes2":l=v[0],s=this.activity.blocks.blockList[l].connections[1],u=this.activity.logo.parseArg(this.activity.logo,r,s,l,null),f=mixedNumber(this.activity.blocks.blockList[v[0]].value)+" × "+mixedNumber(u);break;case"elapsednotes":f=mixedNumber(this.activity.blocks.blockList[v[0]].value);break;case"namedbox":f=(c=this.activity.blocks.blockList[v[0]].privateData)in this.activity.logo.boxes?this.activity.logo.boxes[c]:"";break;case"beatvalue":f=mixedNumber(n.singer.currentBeat);break;case"measurevalue":f=n.singer.currentMeasure;break;case"pitchinhertz":if(f="",null!=n.singer.noteStatus){h=n.singer.noteStatus[0];for(var m=0;m<h.length;m++)0<m&&(f+=" "),"number"==typeof(b=this.activity.logo.synth.getFrequency(h[m],this.activity.logo.synth.changeInTemperament))&&(f+=b.toFixed(2))}else f="";break;case"heap":default:f=this.activity.blocks.blockList[v[0]].value}this.activity.logo.inStatusMatrix=g,null!=(t=this._statusTable.rows[p+1].cells[i+1])&&(t.innerHTML=f),p++}}catch(t){d.e(t)}finally{d.f()}var S,T=void 0;if(_THIS_IS_MUSIC_BLOCKS_){if(f=T="",null!=n.singer.noteStatus){h=n.singer.noteStatus[0];for(var _=0;_<h.length;_++)"number"==typeof h[_]?(T+=toFixed2(h[_]),T+="Hz "):(T+=h[_],T+=" ");f=n.singer.noteStatus[1],T+=(S=rationalToFraction(f))[1]+"/"+S[0]}null!=(t=this._statusTable.rows[p+1].cells[i+1])&&(t.innerHTML=T.replace(/#/g,"♯").replace(/b/g,"♭"))}i+=1,r++}}}catch(t){a.e(t)}finally{a.f()}this.activity.logo.updatingStatusMatrix=!1}}]),p}();_defineProperty(StatusMatrix,"BUTTONDIVWIDTH",128),_defineProperty(StatusMatrix,"BUTTONSIZE",53),_defineProperty(StatusMatrix,"ICONSIZE",32),_defineProperty(StatusMatrix,"OUTERWINDOWWIDTH",620),_defineProperty(StatusMatrix,"INNERWINDOWWIDTH",StatusMatrix.OUTERWINDOWWIDTH-1.5*StatusMatrix.BUTTONSIZE),_defineProperty(StatusMatrix,"FONTSCALEFACTOR",75);