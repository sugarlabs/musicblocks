"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var i=n.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}function asyncGeneratorStep(e,t,n,i,a,s,l){try{var r=e[s](l),o=r.value}catch(e){return void n(e)}r.done?t(o):Promise.resolve(o).then(i,a)}function _asyncToGenerator(r){return function(){var e=this,l=arguments;return new Promise(function(t,n){var i=r.apply(e,l);function a(e){asyncGeneratorStep(i,t,n,a,s,"next",e)}function s(e){asyncGeneratorStep(i,t,n,a,s,"throw",e)}a(void 0)})}}function SampleWidget(){var c=this,t=32,i=[DOUBLEFLAT,FLAT,"",SHARP,DOUBLESHARP],n=[DOUBLEFLAT,FLAT,NATURAL,SHARP,DOUBLESHARP],a=["do","re","mi","fa","sol","la","ti","do"],s=["C","D","E","F","G","A","B"],l=[0,2,4,5,7,9,11],r="electronic synth",w=["#3030FF","#FF3050"];this.timbreBlock,this.sampleArray,this.sampleData="",this.sampleName="electronic synth",this.samplePitch="sol",this.sampleOctave="4",this.pitchCenter=9,this.accidentalCenter=2,this.octaveCenter=4,this.sampleLength=1e3,this.pitchAnalysers={},this.tunerEnabled=!1,this.tunerAnalyser=null,this.tunerMic=null,this.tunerCanvas=null,this.tunerContext=null,this.tunerAnimationFrame=null,this.centsValue=0,this.sliderVisible=!1,this.sliderDiv=null,this.centAdjustmentWindow=null,this.centAdjustmentVisible=!1,this.centAdjustmentSlider=null,this.centAdjustmentValue=0,this.centAdjustmentOn=!1,this.currentNoteObj=null,this.player=null,this._updateBlocks=function(){var e,t,n,i,a;this.sampleArray=[this.sampleName,this.sampleData,this.samplePitch,this.sampleOctave,this.centAdjustmentValue||0],null!=this.timbreBlock&&null!=(a=this.activity.blocks.blockList[this.timbreBlock].connections[1])&&(this.activity.blocks.blockList[a].value=this.sampleArray,this.activity.blocks.blockList[a].updateCache(),e=this.activity.blocks.blockList[a].connections[1],t=this.activity.blocks.blockList[a].connections[2],n=this.activity.blocks.blockList[a].connections[3],null!=e&&(this.activity.blocks.blockList[e].value=[this.sampleName,this.sampleData],this.activity.blocks.blockList[e].text.text=this.sampleName,this.activity.blocks.blockList[e].updateCache()),null!=t&&(this.activity.blocks.blockList[t].value=this.samplePitch,this.activity.blocks.blockList[t].text.text=this.samplePitch,this.activity.blocks.blockList[t].updateCache()),null!=n&&(this.activity.blocks.blockList[n].value=this.sampleOctave,this.activity.blocks.blockList[n].text.text=this.sampleOctave,this.activity.blocks.blockList[n].updateCache()),this.centAdjustmentValue&&0!==this.centAdjustmentValue&&(i=(0<this.centAdjustmentValue?"+":"")+this.centAdjustmentValue+"Â¢",this.activity.blocks.blockList[a].text&&this.activity.blocks.blockList[a].text.text&&(this.activity.blocks.blockList[a].text.text.includes("Â¢")||(this.activity.blocks.blockList[a].text.text+=" "+i))),this.activity.refreshCanvas(),this.activity.saveLocally())},this.pause=function(){this.playBtn.innerHTML='<img \n                src="header-icons/play-button.svg" \n                title="'.concat(_("Play"),'" \n                alt="').concat(_("Play"),'" \n                height="').concat(t,'" \n                width="').concat(t,'" \n                vertical-align="middle"\n            >'),this.isMoving=!1},this.resume=function(){this.playBtn.innerHTML='<img \n                src="header-icons/pause-button.svg" \n                title="'.concat(_("Pause"),'" \n                alt="').concat(_("Pause"),'" \n                height="').concat(t,'" \n                width="').concat(t,'" \n                vertical-align="middle"\n            >'),this.isMoving=!0},this._usePitch=function(e){var t=a.indexOf(e);this.pitchCenter=-1==t?0:t},this._useAccidental=function(e){var t=n.indexOf(e);this.accidentalCenter=-1===t?2:t},this._useOctave=function(e){this.octaveCenter=parseInt(e)},this.getSampleLength=function(){1333333<this.sampleData.length&&this.activity.errorMsg(_("Warning: Sample is bigger than 1MB."),this.timbreBlock)},this.displayRecordingStartMessage=function(){activity.textMsg(_("Recording started"),3e3)},this.displayRecordingStopMessage=function(){activity.textMsg(_("Recording complete"),3e3)},this.showSampleTypeError=function(){this.activity.errorMsg(_("Upload failed: Sample is not a .wav file."),this.timbreBlock)},this.__save=function(){var n=this;setTimeout(function(){n._addSample();var e=n.centAdjustmentValue||0,t=[[0,"settimbre",100,100,[null,1,null,5]],[1,["customsample",{value:[n.sampleName,n.sampleData,n.samplePitch,n.sampleOctave,e]}],100,100,[0,2,3,4]],[2,["audiofile",{value:[n.sampleName,n.sampleData]}],0,0,[1]],[3,["solfege",{value:n.samplePitch}],0,0,[1]],[4,["number",{value:n.sampleOctave}],0,0,[1]],[5,"hidden",0,0,[0,null]]];n.activity.blocks.loadNewBlocks(t),activity.textMsg(_("A new sample block was generated."),3e3)},1e3)},this._saveSample=function(){this.__save()},this._get_save_lock=function(){return this._save_lock},this.handleFiles=function(e){var t=new FileReader;t.readAsDataURL(e),t.onload=function(){"audio/wav"===t.result.substring(t.result.indexOf(":")+1,t.result.indexOf(";"))?t.result.length<=1333333?(c.sampleData=t.result,c.sampleName=e.name,c._addSample()):c.activity.errorMsg(_("Warning: Your sample cannot be loaded because it is >1MB."),c.timbreBlock):c.showSampleTypeError()},t.onloadend=function(){t.result&&(e.name,t.result)}},this.drag_and_drop=function(){var e=document.getElementsByClassName("samplerCanvas")[0];e.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("drop",function(e){e.preventDefault();var t=e.dataTransfer.files[0];c.handleFiles(t)})},this.init=function(y,e){var g=this;this.activity=y,this.timbreBlock=e,this.running=!0,this.originalSampleName="",this.isMoving=!1,this.drawVisualIDs={};var a=window.widgetWindows.windowFor(this,"sampler","Sampler"),s=this;a.onmaximize=function(){s._scale(),s._updateContainerPositions()},a.onrestore=function(){s._scale(),s._updateContainerPositions()},this._updateContainerPositions=function(){var e=docById("tunerContainer"),t=(docById("centAdjustmentContainer"),docById("centValueDisplay"));e&&(this.widgetWindow.isMaximized()?(e.style.marginTop="150px",e.style.marginLeft="auto",e.style.marginRight="auto",e.style.justifyContent="center"):(e.style.marginTop="100px",e.style.marginLeft="",e.style.marginRight="",e.style.justifyContent="")),t&&(this.widgetWindow.isMaximized()?(t.style.marginTop="50px",t.style.marginBottom="50px"):(t.style.marginTop="30px",t.style.marginBottom="30px"))},a.onclose=function(){if(g.drawVisualIDs)for(var e=0,t=Object.keys(g.drawVisualIDs);e<t.length;e++){var n=t[e];cancelAnimationFrame(g.drawVisualIDs[n])}g.running=!1;var i=docById("wheelDiv");i&&"none"!==i.style.display&&(i.style.display="none",g._pitchWheel&&g._pitchWheel.removeWheel(),g._exitWheel&&g._exitWheel.removeWheel(),g._accidentalsWheel&&g._accidentalsWheel.removeWheel(),g._octavesWheel&&g._octavesWheel.removeWheel()),docById("wheelDivptm").style.display="none",g.pitchWheel,g.pitchAnalysers={},a.destroy()},this.playBtn=a.addButton("play-button.svg",t,_("Play")),this.playBtn.onclick=function(){f(),g.isMoving?g.pause():(""!=g.sampleName&&g.resume(),g._playReferencePitch())},a.addButton("load-media.svg",t,_("Upload sample"),"").onclick=function(){f();var i=docById("myOpenAll");i.addEventListener("change",function e(t){window.scroll(0,0);var n=i.files[0];s.handleFiles(n),i.removeEventListener("change",e)},!1),i.focus(),i.click(),window.scroll(0,0)},this.pitchBtnContainer=document.createElement("div"),this.pitchBtnContainer.className="wfbtItem",this.pitchBtnContainer.style.display="flex",this.pitchBtnContainer.style.flexDirection="column",this.pitchBtnContainer.style.alignItems="center",this.pitchBtnContainer.style.cursor="pointer",a._toolbar.appendChild(this.pitchBtnContainer),this.pitchBtn=document.createElement("input"),this.pitchBtn.value="C4",this.pitchBtnContainer.appendChild(this.pitchBtn),this.frequencyDisplay=document.createElement("div"),this.frequencyDisplay.style.fontSize="smaller",this.frequencyDisplay.style.textAlign="center",this.frequencyDisplay.style.color=platformColor.textColor,this.frequencyDisplay.textContent="261 Hz",this.pitchBtnContainer.appendChild(this.frequencyDisplay),this.pitchBtnContainer.onclick=function(){f(),g._createPieMenu()},this._save_lock=!1,a.addButton("export-chunk.svg",t,_("Save sample"),"").onclick=function(){f(),s._get_save_lock()||(s._save_lock=!0,s._saveSample(),setTimeout(function(){s._save_lock=!1},1e3))},this._recordBtn=a.addButton("mic.svg",t,_("Toggle Mic"),""),this._playbackBtn=a.addButton("playback.svg",t,_("Playback"),""),this._promptBtn=a.addButton("prompt.svg",t,_("Prompt"),"");var d=!1;this._promptBtn.onclick=function(){var e,t;g.widgetWindow.clearScreen(),t=g.widgetWindow.isMaximized()?(e=g.widgetWindow.getWidgetBody().getBoundingClientRect().width,g.widgetWindow.getWidgetFrame().getBoundingClientRect().height-70):(e=800,400);var n=["Birds chirping in the morning","Rain falling on a window","Waves crashing on some rocks","Cat meowing near a door","Dog barking in a park","Horse galloping in a field","Children laughing at a playground","Footsteps walking on wooden floor","Car honking on the street","Clock ticking in a quiet room"][Math.floor(10*Math.random())],i=document.createElement("div");i.id="samplerPrompt",g.widgetWindow.getWidgetBody().appendChild(i),i.style.height=t+"px",i.style.width=e+"px",i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.justifyContent="center",i.style.gap="20px";var a=document.createElement("h1");a.innerHTML="AI Sample Generation",a.style.fontSize="40px",a.style.marginTop="0",a.style.marginBottom="0px",a.style.fontWeight="200";var r=document.createElement("textarea");r.style.height="200px",r.style.width="650px",r.style.fontSize="30px",r.style.resize="none",r.style.borderRadius="10px",r.style.border="none",r.style.padding="15px",r.placeholder=n,r.addEventListener("input",function(){o.disabled=!!d,c.disabled=!0,h.disabled=!0});var s=document.createElement("div");s.style.display="flex",s.style.justifyContent="space-between",s.style.width="650px";var o=document.createElement("button");o.style.width="152px",o.style.height="61px",o.style.fontSize="32px",o.style.borderRadius="10px",o.style.border="none",o.style.cursor="pointer",o.innerHTML="Submit",o.onclick=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,i,a,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.disabled=!0,t=r.value,n=encodeURIComponent(t),i="http://13.61.94.100:8000/generate?prompt=".concat(n),e.prev=4,d=!0,y.textMsg(_("Generating Audio... (It may take up to 1 minute)"),2500),a=setInterval(function(){y.textMsg(_("Generating Audio..."),1e3)},5e3),e.next=10,fetch(i);case 10:return s=e.sent,e.next=13,s.json();case 13:l=e.sent,clearInterval(a),"success"===l.status?(d=!1,y.textMsg(_("Audio ready!"),3e3),c.disabled=!1,h.disabled=!1):(d=!1,y.textMsg(_("Failed to generate audio"),3e3)),e.next=24;break;case 18:e.prev=18,e.t0=e.catch(4),d=!1,clearInterval(a),y.textMsg(_("Error occurred"),3e3),o.disabled=!1;case 24:case"end":return e.stop()}},e,null,[[4,18]])}));var c=document.createElement("button");c.style.width="152px",c.style.height="61px",c.style.fontSize="32px",c.style.borderRadius="10px",c.style.border="none",c.style.cursor="pointer",c.innerHTML="Preview",c.disabled=!0,c.onclick=function(){new Audio("http://13.61.94.100:8000/preview").play()};var h=document.createElement("button");h.style.width="152px",h.style.height="61px",h.style.fontSize="32px",h.style.borderRadius="10px",h.style.border="none",h.style.cursor="pointer",h.innerHTML="Save",h.disabled=!0,h.onclick=function(){var e=document.createElement("a");e.href="http://13.61.94.100:8000/save",e.download="output.wav",document.body.appendChild(e),e.click(),document.body.removeChild(e)},s.appendChild(o),s.appendChild(c),s.appendChild(h),i.appendChild(a),i.appendChild(r),i.appendChild(s)},this._playbackBtn.id="playbackBtn",this._playbackBtn.classList.add("disabled"),this.is_recording=!1,this.playback=!1,this._recordBtn.onclick=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f(),g.is_recording){e.next=10;break}return e.next=4,g.activity.logo.synth.startRecording();case 4:g.is_recording=!0,g._recordBtn.getElementsByTagName("img")[0].src="header-icons/record.svg",g.displayRecordingStartMessage(),g.activity.logo.synth.LiveWaveForm(),e.next=17;break;case 10:return e.next=12,g.activity.logo.synth.stopRecording();case 12:g.recordingURL=e.sent,g.is_recording=!1,g._recordBtn.getElementsByTagName("img")[0].src="header-icons/mic.svg",g.displayRecordingStopMessage(),g._playbackBtn.classList.remove("disabled");case 17:case"end":return e.stop()}},e)})),this._playbackBtn.onclick=function(){f(),g.playback?(g.activity.logo.synth.stopPlayBackRecording(),g.playback=!1):(g.sampleData=g.recordingURL,g.sampleName="Recorded Audio ".concat(g.recordingURL),g._addSample(),g.activity.logo.synth.playRecording(),g.playback=!0)},this._tunerBtn=a.addButton("tuner.svg",t,_("Tuner"),"");var v=!1,f=function(){var e;v&&(y.textMsg(_("Tuner stopped"),3e3),g.activity.logo.synth.stopTuner(),v=!1,(e=docById("tunerContainer"))&&e.remove())};this._tunerBtn.onclick=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,i,a,s,l,r,o,c,h,d,u,p,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(docById("tunerContainer")&&!v&&docById("tunerContainer").remove(),(t=docById("centAdjustmentContainer"))&&(t.remove(),g.centAdjustmentOn=!1),v){e.next=94;break}return v=!0,docByClass("samplerCanvas")[0].style.display="none",(n=document.createElement("div")).style.display="flex",n.id="tunerContainer",n.style.gap="10px",g.widgetWindow.isMaximized()?(n.style.marginTop="150px",n.style.marginLeft="auto",n.style.marginRight="auto",n.style.justifyContent="center"):n.style.marginTop="100px",(i=document.createElement("img")).setAttribute("src","header-icons/accidental-flat.svg"),i.style.height="40px",i.style.width="40px",i.style.marginTop="auto",n.appendChild(i),(a=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.width="350px",a.style.height="170px",n.appendChild(a),(s=document.createElement("img")).setAttribute("src","header-icons/accidental-sharp.svg"),s.style.height="40px",s.style.width="40px",s.style.marginTop="auto",n.appendChild(s),["M5.0064 173.531C2.24508 173.507 0.0184649 171.249 0.121197 168.49C0.579513 156.179 2.33654 143.951 5.36299 132.009C6.04138 129.332 8.81378 127.792 11.4701 128.546L57.9638 141.754C60.6202 142.508 62.1508 145.271 61.5107 147.958C59.8652 154.863 58.8534 161.905 58.488 168.995C58.3459 171.752 56.0992 173.973 53.3379 173.949L5.0064 173.531Z","M12.3057 125.699C9.66293 124.899 8.16276 122.104 9.03876 119.486C12.9468 107.802 18.0776 96.5645 24.3458 85.959C25.7508 83.5817 28.8448 82.885 31.181 84.3574L72.0707 110.128C74.4068 111.601 75.0971 114.683 73.7261 117.08C70.2017 123.243 67.2471 129.714 64.8991 136.414C63.9858 139.02 61.2047 140.517 58.5619 139.716L12.3057 125.699Z","M32.7848 81.8612C30.4747 80.3483 29.8225 77.2446 31.4008 74.9787C38.442 64.8698 46.5309 55.5326 55.5331 47.1225C57.551 45.2374 60.7159 45.4406 62.5426 47.5115L94.5158 83.7582C96.3425 85.8291 96.1364 88.981 94.1457 90.8948C89.0279 95.8148 84.3698 101.192 80.2295 106.958C78.619 109.202 75.5286 109.855 73.2186 108.342L32.7848 81.8612Z","M64.7847 45.5682C62.9944 43.4658 63.243 40.3041 65.3958 38.5746C74.9997 30.8588 85.3915 24.1786 96.3984 18.6454C98.8656 17.4051 101.845 18.4917 103.014 20.9933L123.481 64.7795C124.65 67.2812 123.564 70.2473 121.115 71.5228C114.819 74.8016 108.834 78.6484 103.237 83.0152C101.06 84.7138 97.9107 84.4699 96.1204 82.3675L64.7847 45.5682Z","M105.713 19.7604C104.588 17.2388 105.717 14.2752 108.27 13.2222C119.658 8.52459 131.511 5.04268 143.631 2.83441C146.348 2.33942 148.9 4.22142 149.318 6.95115L156.62 54.7298C157.037 57.4595 155.159 59.9997 152.45 60.5334C145.485 61.9056 138.659 63.9106 132.058 66.5236C129.491 67.54 126.538 66.4188 125.412 63.8972L105.713 19.7604Z","M152.254 6.52852C151.885 3.79193 153.803 1.26651 156.549 0.975363C168.8 -0.323498 181.154 -0.325115 193.405 0.97054C196.151 1.26096 198.07 3.78589 197.701 6.52258L191.247 54.423C190.878 57.1597 188.361 59.0681 185.611 58.8169C178.542 58.1712 171.428 58.1722 164.358 58.8197C161.608 59.0716 159.091 57.1639 158.721 54.4273L152.254 6.52852Z","M200.638 6.94443C201.055 4.21459 203.607 2.33193 206.324 2.82621C218.444 5.0313 230.298 8.51011 241.688 13.2047C244.241 14.257 245.371 17.2203 244.246 19.7423L224.559 63.8842C223.434 66.4062 220.481 67.5281 217.913 66.5124C211.312 63.9011 204.486 61.8978 197.52 60.5275C194.811 59.9945 192.933 57.4548 193.349 54.7249L200.638 6.94443Z","M246.945 20.9745C248.114 18.4725 251.093 17.3851 253.561 18.6248C264.569 24.1552 274.963 30.8326 284.569 38.5459C286.722 40.2748 286.971 43.4365 285.181 45.5394L253.855 82.3468C252.066 84.4497 248.916 84.6944 246.739 82.9964C241.14 78.6311 235.155 74.7859 228.858 71.5087C226.408 70.2339 225.322 67.268 226.49 64.766L246.945 20.9745Z","M287.424 47.482C289.25 45.4107 292.415 45.2066 294.433 47.0913C303.438 55.499 311.529 64.8341 318.573 74.9411C320.152 77.2066 319.501 80.3105 317.191 81.824L276.764 108.315C274.454 109.829 271.364 109.176 269.753 106.934C265.611 101.168 260.951 95.7923 255.832 90.8736C253.841 88.9604 253.634 85.8085 255.46 83.7371L287.424 47.482Z","M318.795 84.3198C321.131 82.8468 324.225 83.5427 325.631 85.9196C331.902 96.5235 337.036 107.76 340.947 119.442C341.823 122.061 340.324 124.855 337.681 125.657L291.429 139.686C288.786 140.487 286.005 138.991 285.091 136.385C282.741 129.686 279.785 123.215 276.259 117.054C274.887 114.657 275.577 111.574 277.912 110.101L318.795 84.3198Z","M338.518 128.503C341.174 127.748 343.947 129.288 344.626 131.964C347.655 143.905 349.416 156.133 349.877 168.444C349.981 171.203 347.755 173.462 344.993 173.487L296.662 173.917C293.901 173.942 291.653 171.722 291.51 168.964C291.143 161.875 290.13 154.833 288.482 147.928C287.841 145.242 289.371 142.478 292.027 141.723L338.518 128.503Z"].forEach(function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",e),n.setAttribute("fill","#808080"),a.appendChild(n)}),(l=document.createElement("div")).id="modeToggle",l.style.position="absolute",l.style.top="30px",l.style.left="50%",l.style.transform="translateX(-50%)",l.style.display="flex",l.style.backgroundColor="#FFFFFF",l.style.borderRadius="25px",l.style.padding="3px",l.style.boxShadow="0 2px 8px rgba(0,0,0,0.1)",l.style.width="120px",l.style.height="44px",l.style.cursor="pointer",(r=document.createElement("div")).style.flex="1",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.borderRadius="22px",r.style.cursor="pointer",r.style.transition="all 0.2s ease",r.style.userSelect="none",r.title=_("Chromatic"),(o=document.createElement("div")).style.flex="1",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.borderRadius="22px",o.style.cursor="pointer",o.style.transition="all 0.2s ease",o.style.userSelect="none",o.title=_("Target pitch"),(c=document.createElement("img")).src="header-icons/chromatic-mode.svg",c.style.width="32px",c.style.height="32px",c.style.filter="brightness(0)",c.style.pointerEvents="none",(h=document.createElement("img")).src="header-icons/target-pitch-mode.svg",h.style.width="32px",h.style.height="32px",h.style.filter="brightness(0)",h.style.pointerEvents="none",d="chromatic",u=function(){"chromatic"===d?(r.style.backgroundColor="#A6CEFF",o.style.backgroundColor="#FFFFFF"):(r.style.backgroundColor="#FFFFFF",o.style.backgroundColor="#A6CEFF")},p=!0,m=function(e){p&&(p=!1,d=e,u(),setTimeout(function(){p=!0},200))},r.onclick=function(){return m("chromatic")},o.onclick=function(){return m("target")},r.appendChild(c),o.appendChild(h),l.appendChild(r),l.appendChild(o),u(),n.appendChild(l),g.widgetWindow.getWidgetBody().appendChild(n),e.next=91,g.activity.logo.synth.startTuner();case 91:y.textMsg(_("Tuner started"),3e3),e.next=97;break;case 94:y.textMsg(_("Tuner stopped"),3e3),g.activity.logo.synth.stopTuner(),v=!1;case 97:case"end":return e.stop()}},e)})),this.centsSliderBtn=a.addButton("slider.svg",t,_("Cents Adjustment"),""),this.centsSliderBtn.onclick=function(){f();var e,t,n,i,a,s,l,r,o,c,h,d,u,p,m,y=docById("centAdjustmentContainer");y?(y.remove(),g.centAdjustmentOn=!1,(e=docByClass("samplerCanvas")[0])&&(e.style.display="block")):((t=docById("tunerContainer"))&&(t.remove(),g.activity.logo.synth.stopTuner(),v=!1),g.centAdjustmentOn?(g.centAdjustmentOn=!1,(n=docById("centAdjustmentContainer"))&&n.remove(),(i=docByClass("samplerCanvas")[0])&&(i.style.display="block")):(g.centAdjustmentOn=!0,(a=docByClass("samplerCanvas")[0])&&(a.style.display="none"),(s=document.createElement("div")).id="centAdjustmentContainer",s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.backgroundColor="#d8d8d8",s.style.zIndex="1000",(l=document.createElement("div")).id="centValueDisplay",l.textContent=(0<=g.centAdjustmentValue?"+":"")+(g.centAdjustmentValue||0)+"Â¢",l.style.fontSize="24px",l.style.fontWeight="bold",l.style.textAlign="center",g.widgetWindow.isMaximized()?(l.style.marginTop="50px",l.style.marginBottom="50px"):(l.style.marginTop="30px",l.style.marginBottom="30px"),s.appendChild(l),r=document.createElement("div"),g.widgetWindow.isMaximized()?(r.style.width="60%",r.style.margin="0 auto 30px auto"):(r.style.width="80%",r.style.margin="0 auto"),o=document.createElement("input"),Object.assign(o,{type:"range",min:-50,max:50,value:g.centAdjustmentValue||0,step:1}),Object.assign(o.style,{width:"100%",height:"20px",WebkitAppearance:"none",background:"#4CAF50",outline:"none",borderRadius:"10px",cursor:"pointer",opacity:"0.8"}),(c=document.createElement("style")).textContent="\n                    input[type=range]::-webkit-slider-thumb {\n                        -webkit-appearance: none;\n                        width: 25px;\n                        height: 25px;\n                        background: #2196F3;\n                        border-radius: 50%;\n                        cursor: pointer;\n                        transition: all .2s ease-in-out;\n                    }\n                    input[type=range]::-webkit-slider-thumb:hover {\n                        transform: scale(1.1);\n                    }\n                    input[type=range]::-moz-range-thumb {\n                        width: 25px;\n                        height: 25px;\n                        background: #2196F3;\n                        border-radius: 50%;\n                        cursor: pointer;\n                        border: none;\n                        transition: all .2s ease-in-out;\n                    }\n                    input[type=range]::-moz-range-thumb:hover {\n                        transform: scale(1.1);\n                    }\n                ",document.head.appendChild(c),r.appendChild(o),s.appendChild(r),h=document.createElement("div"),g.widgetWindow.isMaximized()?h.style.width="60%":h.style.width="80%",h.style.display="flex",h.style.justifyContent="space-between",h.style.margin="10px auto",(d=document.createElement("span")).textContent="-50Â¢",d.style.fontWeight="bold",(u=document.createElement("span")).textContent="+50Â¢",u.style.fontWeight="bold",h.appendChild(d),h.appendChild(u),s.appendChild(h),(p=document.createElement("div")).style.textAlign="center",p.style.marginTop="30px",(m=document.createElement("button")).textContent=_("Reset"),m.style.padding="10px 20px",m.style.backgroundColor="#808080",m.style.color="white",m.style.border="none",m.style.borderRadius="5px",m.style.cursor="pointer",m.style.fontSize="16px",m.onclick=function(){g.centAdjustmentValue=0,l.textContent="0Â¢",o.value=0,g.applyCentAdjustment(0)},p.appendChild(m),s.appendChild(p),g.widgetWindow.getWidgetBody().appendChild(s),o.oninput=function(){var e=parseInt(o.value);g.centAdjustmentValue=e,l.textContent=(0<=e?"+":"")+e+"Â¢",g.applyCentAdjustment(e)}))},a.sendToCenter(),this.widgetWindow=a,this._scale(),this._parseSamplePitch(),this.getPitchName(),this.setTimbre(),y.textMsg(_("Upload a sample and adjust its pitch center."),3e3),this.pause(),a.sendToCenter(),this.drag_and_drop()},this._addSample=function(){for(var e=0;e<CUSTOMSAMPLES.length;e++)if(CUSTOMSAMPLES[e][0]==this.sampleName)return void(CUSTOMSAMPLES[e]=[this.sampleName,this.sampleData,this.samplePitch,this.sampleOctave,this.centAdjustmentValue||0]);CUSTOMSAMPLES.push([this.sampleName,this.sampleData,this.samplePitch,this.sampleOctave,this.centAdjustmentValue||0])},this._parseSamplePitch=function(){var e=this.samplePitch.substring(0,2);this.pitchCenter="so"===e?4:a.indexOf(e);var t=this.samplePitch,n=-1!=t.indexOf(SHARP)?1:-1!=t.indexOf(FLAT)?-1:-1!=t.indexOf(DOUBLEFLAT)?-2:-1!=t.indexOf(DOUBLESHARP)?2:0;this.accidentalCenter=n+2,this.octaveCenter=this.sampleOctave},this._calculateFrequency=function(){var e=0;e+=isNaN(this.octaveCenter)?0:12*this.octaveCenter,e+=isNaN(this.pitchCenter)?0:l[this.pitchCenter];var t=(e+=isNaN(this.accidentalCenter)?0:this.accidentalCenter-2)-57;return Math.floor(440*Math.pow(2,t/12))},this._updateSamplePitchValues=function(){this.samplePitch=a[this.pitchCenter]+i[this.accidentalCenter],this.sampleOctave=this.octaveCenter.toString()},this.setTimbre=function(){var e;null!=this.sampleName&&""!=this.sampleName&&(this.originalSampleName=this.sampleName+"_original",e=[this.originalSampleName,this.sampleData,"la",4],Singer.ToneActions.setTimbre(e,0,this.timbreBlock))},this._playReferencePitch=function(){this._updateSamplePitchValues(),this._updateBlocks();var e=0;e+=isNaN(this.octaveCenter)?0:12*this.octaveCenter,e+=isNaN(this.pitchCenter)?0:l[this.pitchCenter];var t=(e+=isNaN(this.accidentalCenter)?0:this.accidentalCenter-2)-57,n=Math.floor(440*Math.pow(2,t/12));this.activity.logo.synth.trigger(0,[n],.5,r,null,null,!1),this.setTimbre(),this._playDelayedSample()},this._playSample=function(){var e,t,n;null!=this.sampleName&&""!=this.sampleName&&(this.reconnectSynthsToAnalyser(),e=this._calculateFrequency(),this.currentNoteObj=TunerUtils.frequencyToPitch(e),t="customsample_"+this.originalSampleName,instruments[0][t]||this.activity.logo.synth.loadSynth(0,t),instruments[0][t]&&(this.player=instruments[0][t]),n=220,0!==this.centAdjustmentValue&&(n=220*Math.pow(2,this.centAdjustmentValue/1200)),this.activity.logo.synth.trigger(0,[n],this.sampleLength/1e3,t,null,null,!1))},this._waitAndPlaySample=function(){var t=this;return new Promise(function(e){setTimeout(function(){t._playSample(),e("played"),t._endPlaying()},500)})},this._playDelayedSample=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._waitAndPlaySample();case 2:case"end":return e.stop()}},e,this)})),this._waitAndEndPlaying=function(){var t=this;return new Promise(function(e){setTimeout(function(){t.pause(),e("ended")},t.sampleLength)})},this._endPlaying=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._waitAndEndPlaying();case 2:case"end":return e.stop()}},e,this)})),this.reconnectSynthsToAnalyser=function(){for(var e in[0,1])void 0===this.pitchAnalysers[e]&&(this.pitchAnalysers[e]=new Tone.Analyser({type:"waveform",size:8192}));for(var t in instruments[0]){var n=1;t===r&&(n=0,instruments[0][t].connect(this.pitchAnalysers[n])),t==="customsample_"+this.originalSampleName&&(n=1,instruments[0][t].connect(this.pitchAnalysers[n]))}},this._createPieMenu=function(){var i=this;docById("wheelDivptm").style.display="";for(var e,t=["ð„ª","â™¯","â™®","â™­","ð„«"],n=["ti","la","sol","fa","mi","re","do"],a=[],s=0;s<DRUMS.length;s++)e=_(DRUMS[s]),a.push(e);this._pitchWheel=new wheelnav("wheelDivptm",null,600,600),this._exitWheel=new wheelnav("_exitWheel",this._pitchWheel.raphael),this._accidentalsWheel=new wheelnav("_accidentalsWheel",this._pitchWheel.raphael),this._octavesWheel=new wheelnav("_octavesWheel",this._pitchWheel.raphael),wheelnav.cssMode=!0,this._pitchWheel.keynavigateEnabled=!1,this._pitchWheel.slicePathFunction=slicePath().DonutSlice,this._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._pitchWheel.colors=platformColor.pitchWheelcolors,this._pitchWheel.slicePathCustom.minRadiusPercent=.2,this._pitchWheel.slicePathCustom.maxRadiusPercent=.5,this._pitchWheel.sliceSelectedPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.sliceInitPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.animatetime=0,this._pitchWheel.createWheel(n),this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.2,this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.clickModeRotate=!1,this._exitWheel.createWheel(["Ã—"," "]),this._accidentalsWheel.colors=platformColor.accidentalsWheelcolors,this._accidentalsWheel.slicePathFunction=slicePath().DonutSlice,this._accidentalsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._accidentalsWheel.slicePathCustom.minRadiusPercent=.5,this._accidentalsWheel.slicePathCustom.maxRadiusPercent=.75,this._accidentalsWheel.sliceSelectedPathCustom=this._accidentalsWheel.slicePathCustom,this._accidentalsWheel.sliceInitPathCustom=this._accidentalsWheel.slicePathCustom;for(var l=[],r=0;r<t.length;r++)l.push(t[r]);for(var o=0;o<9;o++)l.push(null),this._accidentalsWheel.colors.push(platformColor.accidentalsWheelcolorspush);this._accidentalsWheel.animatetime=0,this._accidentalsWheel.createWheel(l),this._accidentalsWheel.setTooltips([_("double sharp"),_("sharp"),_("natural"),_("flat"),_("double flat")]),this._octavesWheel.colors=platformColor.octavesWheelcolors,this._octavesWheel.slicePathFunction=slicePath().DonutSlice,this._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._octavesWheel.slicePathCustom.minRadiusPercent=.75,this._octavesWheel.slicePathCustom.maxRadiusPercent=.95,this._octavesWheel.sliceSelectedPathCustom=this._octavesWheel.slicePathCustom,this._octavesWheel.sliceInitPathCustom=this._octavesWheel.slicePathCustom;var c=["8","7","6","5","4","3","2","1",null,null,null,null,null,null];this._octavesWheel.animatetime=0,this._octavesWheel.createWheel(c);var h=this.pitchBtn.getBoundingClientRect().x,d=this.pitchBtn.getBoundingClientRect().y;docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="300px",docById("wheelDivptm").style.width="300px",docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,h*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,d*this.activity.getStageScale()))+"px";var u=this.octaveCenter,p=4-this.accidentalCenter,m=6-this.pitchCenter;this._accidentalsWheel.navigateWheel(p),this._octavesWheel.navigateWheel(c.indexOf(u.toString())),this._pitchWheel.navigateWheel(m),this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",i._pitchWheel.removeWheel(),i._exitWheel.removeWheel(),i._accidentalsWheel.removeWheel(),i._octavesWheel.removeWheel()};for(var y=function(){var e,t,n;e=i._pitchWheel.navItems[i._pitchWheel.selectedNavItemIndex].title,t=i._accidentalsWheel.navItems[i._accidentalsWheel.selectedNavItemIndex].title,n=Number(i._octavesWheel.navItems[i._octavesWheel.selectedNavItemIndex].title),i._usePitch(e),i._useAccidental(t),i._useOctave(n),i.getPitchName(),i._playReferencePitch()},g=0;g<n.length;g++)this._pitchWheel.navItems[g].navigateFunction=y;for(var v=0;v<t.length;v++)this._accidentalsWheel.navItems[v].navigateFunction=y;for(var f=0;f<8;f++)this._octavesWheel.navItems[f].navigateFunction=y},this.getPitchName=function(){var e=s[this.pitchCenter];e+=i[this.accidentalCenter],e+=this.octaveCenter.toString(),this.pitchName=e;var t=this._calculateFrequency();return this.pitchBtn.value=this.pitchName,this.frequencyDisplay.textContent=t+" Hz",this.pitchName},this._scale=function(){var e,t,n=this,i=document.getElementsByClassName("samplerCanvas");Array.prototype.forEach.call(i,function(e){n.widgetWindow.getWidgetBody().removeChild(e)}),t=this.widgetWindow.isMaximized()?(e=this.widgetWindow.getWidgetBody().getBoundingClientRect().width,this.widgetWindow.getWidgetFrame().getBoundingClientRect().height-70):(e=800,400),document.getElementsByTagName("canvas")[0].innerHTML="",this.makeCanvas(e,t,0,!0),this.reconnectSynthsToAnalyser()},this.makeCanvas=function(y,g,v,f){var C=this,x=document.createElement("canvas");x.height=g,x.width=y,x.className="samplerCanvas",this.widgetWindow.getWidgetBody().appendChild(x);var e,t,n,b=x.getContext("2d");b.clearRect(0,0,y,g),this.tunerEnabled?((e=document.createElement("canvas")).height=Math.min(200,.4*g),e.width=Math.min(200,.8*y),e.className="tunerCanvas",e.style.position="absolute",e.style.top="10px",e.style.left=(y-e.width)/2+"px",this.widgetWindow.getWidgetBody().appendChild(e),this.tunerDisplay?(this.tunerDisplay.canvas=e,this.tunerDisplay.width=e.width,this.tunerDisplay.height=e.height):this.tunerDisplay=new TunerDisplay(e,e.width,e.height),t=TunerUtils.frequencyToPitch(A0*Math.pow(2,(pitchToNumber(a[this.pitchCenter]+i[this.accidentalCenter],this.octaveCenter)-57)/12)),this.tunerDisplay.update(t[0],t[1],this.centsValue),x.height=g-e.height-20,x.style.marginTop=e.height+20+"px"):this.tunerDisplay&&((n=document.getElementsByClassName("tunerCanvas")[0])&&n.parentNode.removeChild(n),this.tunerDisplay=null);!function e(){if(C.drawVisualIDs[v]=requestAnimationFrame(e),C.is_recording||C.pitchAnalysers[v]&&(C.running||f)){var t;b.fillStyle="#FFFFFF",b.font="10px Verdana",C.verticalOffset=-x.height/4,C.zoomFactor=40,b.fillRect(0,0,y,g),0<=v&&(t=""!=C.sampleName?C.sampleName:_("sample")),b.fillStyle="#000000",b.fillText(_("reference tone"),10,10),b.fillText(t,10,x.height/2+10);for(var n,i,a,s,l,r=0;r<2;r+=1){var o=void 0,c=(o=C.is_recording?0===r?C.pitchAnalysers[0].getValue():C.activity.logo.synth.getWaveFormValues():C.pitchAnalysers[r].getValue()).length,h=w[r],d=y*C.zoomFactor/c;b.lineWidth=2,b.strokeStyle=h,b.beginPath();for(var u=0,p=0;p<c;p++){var m=g/2*(1-o[p])+C.verticalOffset;0===p?b.moveTo(u,m):b.lineTo(u,m),u+=d}b.lineTo(x.width,x.height/2),b.stroke(),C.verticalOffset=x.height/4}C.tunerEnabled&&C.tunerDisplay&&C.pitchAnalysers[1]&&C.sampleName&&((n=C.pitchAnalysers[1].getValue())&&0<n.length&&(0<(i=detectPitch(n))&&(s=(a=W(i)).note,l=a.cents,C.tunerDisplay.update(s,l,C.centsValue),document.querySelectorAll("#tunerContainer svg path").forEach(function(e,t){var n=10*(t-5);Math.abs(l-n)<=5?e.setAttribute("fill","#00ff00"):l<n?e.setAttribute("fill","#ff0000"):e.setAttribute("fill","#0000ff")}))))}}()},this.toggleTuner=function(){this.tunerEnabled=!this.tunerEnabled,this.tunerEnabled?this._tunerBtn.getElementsByTagName("img")[0].src="header-icons/tuner-active.svg":this._tunerBtn.getElementsByTagName("img")[0].src="header-icons/tuner.svg",this._scale()},this.applyCentsAdjustment=function(){var e;this.sampleName&&""!==this.sampleName&&(e=TunerUtils.calculatePlaybackRate(0,this.centsValue),instruments[0]["customsample_"+this.originalSampleName]&&(instruments[0]["customsample_"+this.originalSampleName].playbackRate.value=e))};function o(l,e,t){function r(e){var a,n=(a=e).map(function(e,i){return a.slice(0,a.length-i).reduce(function(e,t,n){return e+t*a[n+i]},0)});return n.map(function(e,t){return n[0]+n[t]-2*n[t]})}var o=2<arguments.length&&void 0!==t?t:.1;return function(e){e=function(e,t){var n=1<arguments.length&&void 0!==t?t:500,i=2*Math.PI*n/l;return e.map(function(e,t,n){return 0<t?i*e+(1-i)*n[t-1]:e})}(e,300);var n,t=r(e),i=(n=0,t.map(function(e,t){return n+=e,0===t?1:e/(n/t)})),a=function(e){for(var t=2;t<e.length;t++)if(e[t]<o){for(;t+1<e.length&&e[t+1]<e[t];)t++;return t}return-1}(i);if(-1===a)return-1;var s=function(e,t){var n=t<1?t:t-1,i=t+1<e.length?t+1:t;if(n===t)return e[t]<=e[i]?t:i;if(i===t)return e[t]<=e[n]?t:n;var a=e[n],s=e[t],l=e[i];return t+(i-n)*(a-l)/(2*(a-2*s+l))}(i,a);return l/s}}var W=function(e){if(e<=0)return{note:"---",cents:0};var t=69+12*Math.log2(e/440),n=Math.round(t),i=n%12,a=Math.floor(n/12)-1,s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][i]+a,l=440*Math.pow(2,(n-69)/12);return{note:s,cents:Math.round(1200*Math.log2(e/l))}},h=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,i,s,a,l,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new AudioContext,e.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:n=e.sent,i=t.createMediaStreamSource(n),(s=t.createAnalyser()).fftSize=4096,i.connect(s),a=t.sampleRate,l=new Float32Array(2048),r=o(a,2048),function e(){s.getFloatTimeDomainData(l);var t,n,i,a=r(l);0<a?(n=(t=W(a)).note,i=t.cents,document.getElementById("pitch").textContent=a.toFixed(2),document.getElementById("note").textContent=0===i?" ".concat(n," (Perfect)"):" ".concat(n,", off by ").concat(i," cents")):(document.getElementById("pitch").textContent="---",document.getElementById("note").textContent="---"),requestAnimationFrame(e)}(),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("".concat(e.t0.name,": ").concat(e.t0.message)),alert("Microphone access failed: "+e.t0.message);case 21:case"end":return e.stop()}},e,null,[[0,17]])}));return function(){return e.apply(this,arguments)}}();this.makeTuner=function(e,t){var n=document.createElement("div");n.className="tuner-container",n.style.height=t+"px",n.style.width=e+"px",n.style.position="relative",n.style.backgroundColor="#f5f5f5",n.style.borderRadius="8px",n.style.padding="20px",n.style.boxSizing="border-box";var i=document.createElement("h1");i.textContent="Tuner",i.style.textAlign="center",i.style.marginBottom="20px";var a=document.createElement("button");a.id="start",a.textContent="Start",a.style.display="block",a.style.margin="0 auto 20px",a.style.padding="10px 20px",a.style.fontSize="16px",a.style.cursor="pointer";var s=document.createElement("p");s.textContent="Detected Pitch: ",s.style.textAlign="center",s.style.fontSize="18px";var l=document.createElement("span");l.id="pitch",l.textContent="---";var r=document.createElement("p");r.textContent="Note: ",r.style.textAlign="center",r.style.fontSize="18px";var o=document.createElement("span");o.id="note",o.textContent="---",s.appendChild(l),r.appendChild(o),n.appendChild(i),n.appendChild(a),n.appendChild(s),n.appendChild(r),c.widgetWindow.getWidgetBody().appendChild(n),document.getElementById("start").addEventListener("click",h)},this.applyCentAdjustment=function(e){var t=this;this.centAdjustmentValue=e;var n,i=Math.pow(2,e/1200);this.sampleName&&""!==this.sampleName&&this.originalSampleName&&(n="customsample_"+this.originalSampleName,"undefined"!=typeof instruments&&instruments[0]&&instruments[0][n]&&instruments[0][n].playbackRate?instruments[0][n].playbackRate.value=i:console.log("Instrument not found, will apply cent adjustment during playback")),this.isMoving&&(this.pause(),setTimeout(function(){t._playReferencePitch()},100))}}var PitchSmoother=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:5;_classCallCheck(this,t),this.pitchHistory=[],this.smoothingSize=e}return _createClass(t,[{key:"addPitch",value:function(e){0<e&&(this.pitchHistory.push(e),this.pitchHistory.length>this.smoothingSize&&this.pitchHistory.shift())}},{key:"getSmoothedPitch",value:function(){if(0===this.pitchHistory.length)return-1;var e=_toConsumableArray(this.pitchHistory).sort(function(e,t){return e-t}),t=e[Math.floor(e.length/4)],n=e[Math.floor(3*e.length/4)],i=n-t,a=this.pitchHistory.filter(function(e){return t-1.5*i<=e&&e<=n+1.5*i});return 0===a.length?-1:a.reduce(function(e,t){return e+t})/a.length}},{key:"reset",value:function(){this.pitchHistory=[]}}]),t}();