"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var LILYPONDHEADER='\\version "2.18.2"\n\n% ****************************************************************\n% \n% WHAT IS THIS? -- This is a LilyPond file generated from Music\n% Blocks software (Read about it at www.musicblocks.net).\n% \n% DOWNLOAD LILYPOND -- In order to create notation with this file,\n% you will need to download and install LilyPond software onto your\n% computer (http://lilypond.org/download.html). Frescobaldi\n% software is also handy for editing LilyPond files\n% (http://frescobaldi.org/download).\n% \n% LILYPOND INSTRUCTIONS -- For instructions on how to further\n% manipulate musical notation using LilyPond software, please\n% read the Introduction (http://lilypond.org/text-input.html) and\n% the Manual\n% (http://lilypond.org/doc/v2.18/Documentation/learning/index.html).\n% \n% GLOSSARY -- A glossary with helpful examples may be found here\n% (http://www.lilypond.org/doc/v2.19/Documentation/music-glossary/).\n% \n% MUTOPIA -- You may also benefit from studying scores from the\n% Mutopia Project website, which has freely sharable music notation\n% generated with LilyPond (http://www.mutopiaproject.org/).\n% \n% HACKLILY -- You can explore your Lilypond output in a web browser\n% at (http://hacklily.org/).\n% \n% COMMENTS -- Some of the code below is commented out. You can\n% enable it by deleting the % that precedes the text or, in the\n% case of a commented section, deleting the %{ and %} that surrounds\n% the section.\n% \n% ****************************************************************\n\n% Please add your own name, the title of your musical creation,\n% and the intended copyright below.\n% The copyright is great for sharing (and re-sharing)!\n% Read more about it here (http://creativecommons.org/licenses/by-sa/4.0/).\n% Of course, you can use any copyright you like -- you made it!\n\\header {\n   dedication = \\markup {\n      \\abs-fontsize #8 \\sans "Made with LilyPond and Music Blocks" \\with-url #"http://musicblocks.sugarlabs.org/" {\n         \\abs-fontsize #8 \\sans "(http://musicblocks.sugarlabs.org/)"\n      }\n   }\n   title = "My Music Blocks Creation"\n%   subtitle = "Subtitle"\n%   instrument = "Instrument"\n   composer = "Mr. Mouse"\n%   arranger = "Arranger"\n   copyright = "Mr. Mouse (c) 2020 -- CC-BY-SA"\n   tagline = "Made from Music Blocks v.2.2"\n   footer = \\markup {\n      \\with-url #"http://musicblocks.sugarlabs.org/" "Made with Music Blocks Software v.2.2" Engraved on \\simple #(strftime "%Y-%m-%d" (localtime (current-time)))\n   }\n   currentYear = \\markup {\n      \\simple #(strftime "%Y" (localtime (current-time)))\n   }\n   copyTag =  " free to distribute, modify, and perform"\n   copyType = \\markup {\n      \\with-url #"http://creativecommons.org/licenses/by-sa/3.0/" "Creative Commons Attribution ShareAlike 3.0 (Unported) License "\n   }\n   copyright = \\markup {\n      \\override #\'(baseline-skip . 0 ) \\right-column {\n         \\sans \\bold \\with-url #"http://musicblocks.net" {\n            \\abs-fontsize #9  "Music " \\concat {\n               \\abs-fontsize #12 \\with-color #white \\char ##x01C0 \\abs-fontsize #9 "Blocks "\n            }\n         }\n      }\n      \\override #\'(baseline-skip . 0 ) \\center-column {\n         \\abs-fontsize #11.9 \\with-color #grey \\bold {\n            \\char ##x01C0 \\char ##x01C0\n         }\n      }\n      \\override #\'(baseline-skip . 0 ) \\column {\n         \\abs-fontsize #8 \\sans \\concat {\n            " Typeset using " \\with-url #"http://www.lilypond.org" "LilyPond software " \\char ##x00A9 " " \\currentYear " by " \\composer " " \\char ##x2014 " " \\footer\n         }\n         \\concat {\n            \\concat {\n               \\abs-fontsize #8 \\sans {\n                  " " \\copyType \\char ##x2014 \\copyTag\n               }\n            }\n            \\abs-fontsize #13 \\with-color #white \\char ##x01C0\n         }\n      }\n   }\n   tagline = ##f\n}\n\n% To change the meter make adjustments in the following section.\n% You must also delete the % before \\meter everywhere it appears below.\nmeter = {\n%   \\time 3/4\n%   \\key c \\minor\n   \\numericTimeSignature\n%   \\partial 4 \n%   \\tempo "Andante" 4=90\n}\n\n',getLilypondHeader=function(){return LILYPONDHEADER},processLilypondNotes=function(t,o,n){o.notationNotes[n]="\\meter\n";for(var e,a,i,l,u=function(t){var o;"number"==typeof t&&(t=(o=frequencyToPitch(t))[0]+o[1]);var n={"♮":"!","♯":"is","♭":"es",10:"''''''''",1:",, ",2:", ",3:"",4:"'",5:"''",6:"'''",7:"''''",8:"''''''",9:"'''''''"};return t.replace(/[♮♯♭]|10|[1-9]/g,function(t){return n[t]}).toLowerCase()},r=0,s=!1,g=!1,c=!1,p=!1,N=0,O=0,T=!1,f=function(t,o,n,e){for(var a,i,r=0,s=0;s<e;)if(O=2*t.notation.notationStaging[o][n+r][NOTATIONDURATION],"object"===_typeof(l=t.notation.notationStaging[o][n+r][NOTATIONNOTE])){for(1<l.length&&(t.notationNotes[o]+="<"),a=0;a<l.length;a++)t.notationNotes[o]+=u(l[a]),(1===l.length||a<l.length-1)&&(t.notationNotes[o]+=" ");l[NOTATIONSTACCATO]&&(t.notationNotes[o]+=" \\staccato "),1<l.length&&(t.notationNotes[o]+=">"),t.notationNotes[o]+=t.notation.notationStaging[o][n+r][NOTATIONROUNDDOWN],r++,s++}else"tie"===t.notation.notationStaging[o][n+r]&&(t.notationNotes[o]+="~"),r++,s++;return n+r-1<t.notation.notationStaging[o].length-1?"string"==typeof(i=t.notation.notationStaging[o][n+r])&&")"===i?(t.notationNotes[o]+=")} ",n+=1):"string"==typeof i&&"markup"===i?(t.notationNotes[o]+="^\\markup { \\abs-fontsize #6 { "+t.notation.notationStaging[o][n+r+1]+" } } } ",r+=2):"string"==typeof i&&"markdown"===i?(t.notationNotes[o]+="_\\markup {"+t.notation.notationStaging[o][n+r+1]+"} } ",r+=2):t.notationNotes[o]+="} ":t.notationNotes[o]+="} ",r},h=0;h<o.notation.notationStaging[n].length;h++){var d=o.notation.notationStaging[n][h];if("string"==typeof d)switch(d){case"swing":o.notationNotes[n]+="\\tempo swing\n";break;case"tempo":o.notationNotes[n]+="\\tempo "+o.notation.notationStaging[n][h+2]+" = "+o.notation.notationStaging[n][h+1]+"\n",h+=2;break;case"markup":o.notationNotes[n]+="^\\markup { \\abs-fontsize #6 { "+o.notation.notationStaging[n][h+1]+" } } ",h+=1;break;case"markdown":o.notationNotes[n]+="_\\markup { "+o.notation.notationStaging[n][h+1]+" } ",h+=1;break;case"break":0<h&&(o.notationNotes[n]+="\n"),r=0;break;case"begin articulation":p=!0;break;case"end articulation":p=!1;break;case"begin crescendo":o.notationNotes[n]+="  ",g=!0;break;case"begin decrescendo":o.notationNotes[n]+="  ",c=!0;break;case"end crescendo":case"end decrescendo":o.notationNotes[n]+="\\! ";break;case"begin slur":s=!0;break;case"end slur":o.notationNotes[n]+=")  ";break;case"begin harmonics":o.notationNotes[n]+="\\harmonicsOn ";break;case"end harmonics":o.notationNotes[n]+="\\harmonicsOff ";break;case"tie":o.notationNotes[n]+="~";break;case"key":if(e=o.notation.notationStaging[n][h+1]+" "+o.notation.notationStaging[n][h+2],a=o.notation.notationStaging[n][h+1].toLowerCase().replace(FLAT,"es").replace(SHARP,"is").replace(NATURAL,"").replace(DOUBLESHARP,"isis").replace(DOUBLEFLAT,"eses"),i=o.notation.notationStaging[n][h+2],["major","minor","ionian","dorian","phrygian","lydian","mixolydian","aeolian","locrian"].includes(i))o.notationNotes[n]+=" \\key "+a+" \\"+i+"\n";else{d=getScaleAndHalfSteps(e);for(var m="\n"+i.replace(/ /g,"_")+" = #`(",b="",y=void 0,A=-1,L=0;L<d[1].length;L++)if(""!==d[1][L]){if(d[0][L].substr(0,1)===b){m="";break}if(b=d[0][L].substr(0,1),A<(y=["C","D","E","F","G","A","B"].indexOf(d[0][L].substr(0,1)))){if(1<y-A)for(var S=A+1;S<y;S++)m+="("+S+" . ,NATURAL) ";A=y,1===d[0][L].length?m+="("+y+" . ,NATURAL) ":d[0][L].substr(1,1)===FLAT?m+="("+y+" . ,FLAT) ":m+="("+y+" . ,SHARP) "}}if(""!==m){if(y<6)for(var v=y+1;v<7;v++)m+="("+v+" . ,NATURAL) ";m+=")\n",t.freygish+=m,o.notationNotes[n]+=" \\key "+a+" \\"+i.replace(/ /g,"_")+"\n"}}h+=2;break;case"meter":o.notationNotes[n]+=" \\time "+o.notation.notationStaging[n][h+1]+"/"+o.notation.notationStaging[n][h+2]+"\n",h+=2;break;case"pickup":o.notationNotes[n]+=" \\partial "+o.notation.notationStaging[n][h+1]+"\n",h+=1;break;case"voice one":T?o.notationNotes[n]+="}\n\\new Voice { \\voiceOne ":(o.notationNotes[n]+="<< { \\voiceOne ",T=!0);break;case"voice two":T?o.notationNotes[n]+="}\n\\new Voice { \\voiceTwo ":(o.notationNotes[n]+="<< { \\voiceTwo ",T=!0);break;case"voice three":T?o.notationNotes[n]+="}\n\\new Voice { \\voiceThree ":(o.notationNotes[n]+="<< { \\voiceThree ",T=!0);break;case"voice four":T?o.notationNotes[n]+="}\n\\new Voice { \\voiceFour ":(o.notationNotes[n]+="<< { \\voiceFour ",T=!0);break;case"one voice":o.notationNotes[n]+="}\n>> \\oneVoice\n",T=!1;break;default:o.notationNotes[n]+=d}else{r%8==0&&0<r&&(o.notationNotes[n]+="\n"),r+=1,"string"==typeof d[NOTATIONNOTE]?u(d[NOTATIONNOTE]):(l=d[NOTATIONNOTE],u(l[0]));var k,w,I,U,D,E,P,_,R=0,M=null,V=0,C=null,x=0;if(null!=d[NOTATIONTUPLETVALUE]){var Y=void 0,N=1/o.notation.notationStaging[n][h][NOTATIONDURATION],O=1/o.notation.notationStaging[n][h][NOTATIONROUNDDOWN],V=1/(d[NOTATIONTUPLETVALUE][0]*d[NOTATIONTUPLETVALUE][1]);null===C?(C=d[NOTATIONROUNDDOWN],x=1):d[NOTATIONROUNDDOWN]>C&&(Y=d[NOTATIONROUNDDOWN]/C,C=d[NOTATIONROUNDDOWN],x*=Y,x+=1),(null===M||d[NOTATIONTUPLETVALUE][1]<M)&&(M=d[NOTATIONTUPLETVALUE][1]);for(var H=1,W=1;W<d[NOTATIONTUPLETVALUE][0]*d[NOTATIONTUPLETVALUE][1];){if(h+H>=o.notation.notationStaging[n].length){R=H;break}if("tie"===o.notation.notationStaging[n][h+H])W++,H++;else{if([1,.5,.25,.125,.0625].includes(V)){R=H;break}if(null===o.notation.notationStaging[n][h+H][NOTATIONTUPLETVALUE]){R=H;break}if(o.notation.notationStaging[n][h+H][NOTATIONTUPLETVALUE][0]!==d[NOTATIONTUPLETVALUE][0]){R=H;break}o.notation.notationStaging[n][h+H][NOTATIONROUNDDOWN]>C?(Y=o.notation.notationStaging[n][h+H][NOTATIONROUNDDOWN]/C,C=o.notation.notationStaging[n][h+H][NOTATIONROUNDDOWN],x*=Y,x+=1):o.notation.notationStaging[n][h+H][NOTATIONROUNDDOWN]<C?x+=Y=C/o.notation.notationStaging[n][h+H][NOTATIONROUNDDOWN]:x+=1,N+=1/o.notation.notationStaging[n][h+H][NOTATIONDURATION],O+=1/o.notation.notationStaging[n][h+H][NOTATIONROUNDDOWN],V+=1/(o.notation.notationStaging[n][h+H][NOTATIONTUPLETVALUE][0]*o.notation.notationStaging[n][h+H][NOTATIONTUPLETVALUE][1]),H++,W++}}}if(null!=d[NOTATIONTUPLETVALUE]&&0<d[NOTATIONTUPLETVALUE][0]*d[NOTATIONTUPLETVALUE][1]){0===R?(w=(k=toFraction(O/N))[0]*N,I=k[0]*k[1],U=void 0,Math.floor(w)!==w&&(w=(U=toFraction(+w))[0],I=U[1]),o.notationNotes[n]+="\\tuplet "+w+"/"+I+" { ",h+=f(o,n,h,d[NOTATIONTUPLETVALUE][0]*d[NOTATIONTUPLETVALUE][1])-1):(E=(D=toFraction(x/C/V))[0],P=D[1],_=void 0,Math.floor(E)!==E&&(E=(_=toFraction(+E))[0],P=_[1]),o.notationNotes[n]+="\\tuplet "+E+"/"+P+" { ",h+=f(o,n,h,R)-1),O=N=0}else{if("object"===_typeof(l)){1<l.length&&(o.notationNotes[n]+="<");for(var B=0;B<l.length;B++)o.notationNotes[n]+=u(l[B]),B<l.length-1&&(o.notationNotes[n]+=" ");1<l.length&&(o.notationNotes[n]+=">"),o.notationNotes[n]+=d[NOTATIONDURATION];for(var F=0;F<d[NOTATIONDOTCOUNT];F++)o.notationNotes[n]+=".";p&&(o.notationNotes[n]+="->")}o.notationNotes[n]+=" ",d[NOTATIONSTACCATO]&&(o.notationNotes[n]+="\\staccato "),O=N=0}s&&(s=!1,o.notationNotes[n]+="(  "),g&&(g=!1,o.notationNotes[n]+="\\< "),c&&(c=!1,o.notationNotes[n]+="\\> ")}}},saveLilypondOutput=function(t){var o=[_("mouse"),_("brown rat"),_("mole"),_("chipmunk"),_("red squirrel"),_("guinea pig"),_("capybara"),_("coypu"),_("black rat"),_("grey squirrel"),_("flying squirrel"),_("bat")],n=["treble","bass","bass_8","percussion"],e=["zero","one","two","three","four","five","six","seven","eight","nine"],a=0,i=[],r=a+=Object.keys(t.logo.notation.notationStaging).length;for(var s in t.logo.notation.notationDrumStaging){for(var l=!1,u=0;u<t.logo.notation.notationDrumStaging[s].length;u++){var g=t.logo.notation.notationDrumStaging[s][u];"object"===_typeof(g)&&"object"===_typeof(g[0])&&"R"!==g[0][0]&&(l=!0)}t.logo.notation.notationStaging[a.toString()]=l?t.logo.notation.notationDrumStaging[s]:[],a+=1}console.debug("saving as lilypond: "+a),t.logo.notationOutput+="% You can change the MIDI instruments below to anything on this list:\n% (http://lilypond.org/doc/v2.18/documentation/notation/midi-instruments)\n\n";var c=0,p=[];for(var N in t.logo.notation.notationStaging){var O=N;if("string"==typeof N&&(O=Number(N)),0<t.logo.notation.notationStaging[N].length){for(var T=0,f=0,h=0;h<t.logo.notation.notationStaging[N].length;h++){var d=t.logo.notation.notationStaging[N][h];if("object"===_typeof(d))for(var m=0;m<d[0].length;m++){"R"!==d[0][m]&&("string"==typeof d[0][m]?T+=Number(d[0][m].substr(-1)):T+=frequencyToPitch(d[0][m])[1],f+=1)}}if(r-1<O)i.push("percussion");else if(0<f)switch(console.debug(T+" "+f+" "+Math.floor(.5+T/f)),Math.floor(.5+T/f)){case 0:case 1:case 2:i.push("bass_8");break;case 3:i.push("bass");break;default:i.push("treble")}else i.push("treble");this.freygish="",processLilypondNotes(this,t.logo,N),""!==this.freygish&&(t.logo.notationOutput+=this.freygish);var b,y="",A="";if(r-1<O)y=(y=_("drum")+e[O-r]).replace(/ /g,"").replace(".",""),t.logo.notationOutput+=y+" = {\n",t.logo.notationOutput+="\\drummode {\n",t.logo.notationOutput+=t.logo.notationNotes[N],c===a-1&&(t.logo.notationOutput+=' \\bar "|."'),t.logo.notationOutput+="\n}\n",t.logo.notationOutput+="\n}\n\n";else{N in t.turtles.turtleList&&((y=t.turtles.getTurtle(N).name)!==_("start")&&y!==_("start drum")&&y!==O.toString()||(y=o[O%12])),""===y&&(y=o[O%12]),y=y.replace(/ /g,"").replace(".",""),t.logo.notationOutput+=y+" = {\n",t.logo.notationOutput+=t.logo.notationNotes[N],c===a-1&&(t.logo.notationOutput+=' \\bar "|."'),t.logo.notationOutput+="\n}\n\n";var L="",S="",v="",k="",w="",I=0,U=y.indexOf("_");if(1===y.length)A=y,p[N]=A;else if(-1===U){for(var D=2;D<y.length;D++)if(2===D?L=y.slice(0,2):L+=y.charAt(D-1),!p.includes(L)){A=L,p[N]=A;break}}else if(S=y.slice(0,U),v=y.slice(U+1,y.length),L=(k=S.charAt(0))+(w=v.charAt(0)),p.includes(L)){if(1!==I){L="";for(var E=1;E<y.length;E++){if(L=k+(w+=v.charAt(E)),!p.includes(L)){A=L,p[N]=A;break}if(L=(k+=S.charAt(E))+w,!p.includes(L)){A=L,p[N]=A;break}}}}else A=L,p[N]=A,I=1}t.logo.notationOutput+=y.replace(/ /g,"").replace(".","")+"Voice = ",t.logo.notationOutput+=r-1<O?"\\new DrumStaff \\with {\n":"\\new Staff \\with {\n",t.logo.notationOutput+='   \\clef "'+last(i)+'"\n',t.logo.notationOutput+='   instrumentName = "'+y+'"\n',r-1<O?(b=O-r,t.logo.notationOutput+='   shortInstrumentName = "d'+b+'"\n',t.logo.notationOutput+='   midiInstrument = "snare drum"\n'):(t.logo.notationOutput+='   shortInstrumentName = "'+A+'"\n',t.logo.notationOutput+='   midiInstrument = "acoustic grand"\n'),t.logo.notationOutput+='\n} { \\clef "'+last(i)+'" \\'+y.replace(/ /g,"").replace(".","")+" }\n\n"}else i.push("");c+=1}t.logo.notationOutput+="\n\\score {\n",t.logo.notationOutput+="   <<\n";for(var P=0;P<n.length;P++){var R=void 0;for(var M in t.logo.notationNotes){var V=M;"string"==typeof M&&(V=Number(M)),i[V]===n[P]&&0<t.logo.notation.notationStaging[M].length&&(r-1<V?R=_("drum")+e[V-r]:(""===(R=M in t.turtles.turtleList?t.turtles.getTurtle(M).name:V in t.turtles.turtleList?t.turtles.getTurtle(V).name:_("mouse"))&&(R=_("mouse")),R!==_("start")&&R!==_("start drum")&&R!==V.toString()||(R=o[V%12])),R=R.replace(/ /g,"").replace(".",""),t.logo.notationOutput+="      \\"+R+"Voice\n")}}t.logo.notationOutput+=t.logo.guitarOutputHead;for(var C=0;C<n.length;C++){var x=void 0;for(var Y in t.logo.notationNotes){var H=Y;"string"==typeof Y&&(H=Number(Y)),i[0]===n[C]&&0<t.logo.notation.notationStaging[Y].length&&(r-1<H?x=_("drum")+e[H-r]:(x=Y in t.turtles.turtleList?t.turtles.getTurtle(Y).name:H in t.turtles.turtleList?t.turtles.getTurtle(H).name:_("mouse"))!==_("start")&&x!==_("start drum")&&x!==H.toString()||(x=o[H%12]),x=x.replace(/ /g,"").replace(".",""),t.logo.notationOutput+='         \\context TabVoice = "'+x+'" \\'+x.replace(/ /g,"").replace(".","")+"\n")}}t.logo.notationOutput+=t.logo.guitarOutputEnd,t.logo.notationOutput+="\n   >>\n   \\layout {}\n\n",t.logo.notationOutput+=t.logo.MIDIOutput,t.logo.notationOutput+="% MUSIC BLOCKS CODE\n",t.logo.notationOutput+="% Below is the code for the Music Blocks project that generated this Lilypond file.\n%{\n\n";var W=t.prepareExport();return t.logo.notationOutput+=W.replace(/]],/g,"]],\n"),t.logo.notationOutput+="\n%}\n\n",t.logo.notationOutput};"undefined"!=typeof module&&module.exports&&(module.exports={LILYPONDHEADER:LILYPONDHEADER,getLilypondHeader:getLilypondHeader,processLilypondNotes:processLilypondNotes,saveLilypondOutput:saveLilypondOutput});