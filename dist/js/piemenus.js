"use strict";function _createForOfIteratorHelper(e,t){var l="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!l){if(Array.isArray(e)||(l=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){l&&(e=l);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){l=l.call(e)},n:function(){var e=l.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==l.return||l.return()}finally{if(s)throw n}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var l={}.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,i=Array(t);l<t;l++)i[l]=e[l];return i}function asyncGeneratorStep(e,t,l,i,a,n,o){try{var s=e[n](o),c=s.value}catch(e){return void l(e)}s.done?t(c):Promise.resolve(c).then(i,a)}function _asyncToGenerator(s){return function(){var e=this,o=arguments;return new Promise(function(t,l){var i=s.apply(e,o);function a(e){asyncGeneratorStep(i,t,l,a,n,"next",e)}function n(e){asyncGeneratorStep(i,t,l,a,n,"throw",e)}a(void 0)})}}var setWheelSize=function(e){var t=document.getElementById("wheelDiv"),l=window.innerWidth;t.style.position="absolute",t.style.zIndex="20000",1200<=l?(t.style.width=e+"px",t.style.height=e+"px"):768<=l?(t.style.width=e-50+"px",t.style.height=e-50+"px"):(t.style.width=e-100+"px",t.style.height=e-100+"px"),t.style.height=t.style.width};setWheelSize(),window.addEventListener("resize",setWheelSize);var piemenuPitches=function(u,m,v,e,t,l,d){var W=null,i=u.prevAccidental||null;if(!u.blocks.stageClick){void 0===d&&(d=!1);var g=null!==u.connections[0]&&["pitch","setpitchnumberoffset","invert1","tofrequency"].includes(u.blocks.blockList[u.connections[0]].name);null!==u.connections[0]&&["setkey","setkey2"].includes(u.blocks.blockList[u.connections[0]].name)&&(m=["C","G","D","A","E","B","F"],v=["C","G","D","A","E","B","F"]);var a=docById("wheelDiv");if(a.style.display="",a.style.opacity="0",u._pitchWheel=new wheelnav("wheelDiv",null,600,600),d||(u._accidentalsWheel=new wheelnav("_accidentalsWheel",u._pitchWheel.raphael)),g&&(u._octavesWheel=new wheelnav("_octavesWheel",u._pitchWheel.raphael)),u._exitWheel=new wheelnav("_exitWheel",u._pitchWheel.raphael),wheelnav.cssMode=!0,u._pitchWheel.keynavigateEnabled=!1,u._pitchWheel.colors=platformColor.pitchWheelcolors,u._pitchWheel.slicePathFunction=slicePath().DonutSlice,u._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),u._pitchWheel.slicePathCustom.minRadiusPercent=.2,u._pitchWheel.slicePathCustom.maxRadiusPercent=d?.75:.5,u._pitchWheel.sliceSelectedPathCustom=u._pitchWheel.slicePathCustom,u._pitchWheel.sliceInitPathCustom=u._pitchWheel.slicePathCustom,u._pitchWheel.animatetime=0,u._pitchWheel.createWheel(m),u._exitWheel.colors=platformColor.exitWheelcolors,u._exitWheel.slicePathFunction=slicePath().DonutSlice,u._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),u._exitWheel.slicePathCustom.minRadiusPercent=0,u._exitWheel.slicePathCustom.maxRadiusPercent=.2,u._exitWheel.sliceSelectedPathCustom=u._exitWheel.slicePathCustom,u._exitWheel.sliceInitPathCustom=u._exitWheel.slicePathCustom,u._exitWheel.clickModeRotate=!1,u._exitWheel.initWheel(["×"," "]),u._exitWheel.navItems[1].enabled=!1,u._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",u._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",u._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",u._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",u._exitWheel.createWheel(),!d){u._accidentalsWheel.colors=platformColor.accidentalsWheelcolors,u._accidentalsWheel.slicePathFunction=slicePath().DonutSlice,u._accidentalsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),u._accidentalsWheel.slicePathCustom.minRadiusPercent=.5,u._accidentalsWheel.slicePathCustom.maxRadiusPercent=.75,u._accidentalsWheel.sliceSelectedPathCustom=u._accidentalsWheel.slicePathCustom,u._accidentalsWheel.sliceInitPathCustom=u._accidentalsWheel.slicePathCustom;for(var n=[],o=0;o<e.length;o++)n.push(e[o]);for(var s=0;s<9;s++)n.push(null),u._accidentalsWheel.colors.push(platformColor.accidentalsWheelcolorspush);u._accidentalsWheel.animatetime=0,u._accidentalsWheel.createWheel(n),u._accidentalsWheel.setTooltips([_("double sharp"),_("sharp"),_("natural"),_("flat"),_("double flat")])}g&&(u._octavesWheel.colors=platformColor.octavesWheelcolors,u._octavesWheel.slicePathFunction=slicePath().DonutSlice,u._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),u._octavesWheel.slicePathCustom.minRadiusPercent=.75,u._octavesWheel.slicePathCustom.maxRadiusPercent=.95,u._octavesWheel.sliceSelectedPathCustom=u._octavesWheel.slicePathCustom,u._octavesWheel.sliceInitPathCustom=u._octavesWheel.slicePathCustom,u._octavesWheel.animatetime=0,u._octavesWheel.createWheel(["8","7","6","5","4","3","2","1",null,null,null,null,null,null]));var c=u.container.x,h=u.container.y,r=u.activity.canvas.offsetLeft+28*u.blocks.blockScale,y=u.activity.canvas.offsetTop+6*u.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(300),docById("wheelDiv").style.left=Math.min(u.blocks.turtles._canvas.width-300,Math.max(0,Math.round((c+u.activity.blocksContainer.x)*u.activity.getStageScale()+r)-200))+"px",docById("wheelDiv").style.top=Math.min(u.blocks.turtles._canvas.height-350,Math.max(0,Math.round((h+u.activity.blocksContainer.y)*u.activity.getStageScale()+y)-200))+"px";var x=v.indexOf(t);-1===x&&(x=d?0:4),W=x,u._pitchWheel.navigateWheel(x);var p,b={A:2,B:1,C:0,D:6,E:5,F:4,G:3},I={major:1,dorian:2,phrygian:3,lydian:4,mixolydian:5,minor:6,locrian:7}[u.activity.KeySignatureEnv[1]],P=["",SHARP,FLAT];for(var f in P){for(var C in NOTENAMES){if(buildScale(NOTENAMES[C]+P[f]+" major")[0][I-1]===u.activity.KeySignatureEnv[0]){p=NOTENAMES[C]+P[f];break}}if(void 0!==p)break}for(var k,S,D=(D=buildScale(p+" major")[0]).splice(0,D.length-1),E=0;E<b[p[0]];E++)D.push(D.shift());(u.activity.KeySignatureEnv[2]||"solfege"!==u.name)&&("notename"!==u.name||null!=u.connections[0]&&["setkey","setkey2"].includes(u.blocks.blockList[u.connections[0]].name))||(l=D[6-x][0]===FIXEDSOLFEGE[t]||D[6-x][0]===t?D[6-x].substr(1):EQUIVALENTACCIDENTALS[D[6-x]].substr(1),u.value=u.value.replace(SHARP,"").replace(FLAT,"").replace(DOUBLESHARP,"").replace(DOUBLEFLAT,""),u.value+=l,u.text.text=u.value),d||(k=2,null!==i?k=e.indexOf(i):l===DOUBLEFLAT?k=4:l===FLAT?k=3:l===NATURAL?k=2:l===SHARP?k=1:l===DOUBLESHARP&&(k=0),u._accidentalsWheel.navigateWheel(k)),g&&(S=u.blocks.findPitchOctave(u.connections[0]),u._octavesWheel.navigateWheel(8-S)),a.style.transition="opacity 0.15s ease-in",setTimeout(function(){a.style.opacity="1"},50);for(var w=u,N={note:t,attr:l},M=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,l,i,a,n,o,s,c,h,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A();case 3:if(w.activity.logo.synth||(console.debug("Creating synth in logo"),w.activity.logo.synth=new Synth),w.activity.logo.synth.tone||w.activity.logo.synth.newTone(),t=w._pitchWheel.navItems[w._pitchWheel.selectedNavItemIndex].title,l=m.indexOf(t),null===W&&(W=l),n=0,6<W+(a=3<(i=l-W)?i-7:i<-3?7+i:i)?n=-1:W+a<0&&(n=1),s=v[W=l],d){e.next=21;break}if(o=w._accidentalsWheel.navItems[w._accidentalsWheel.selectedNavItemIndex].title," "===t)return e.abrupt("return");e.next=20;break;case 20:"♮"!==o&&(s+=o);case 21:if(c=g?Number(w._octavesWheel.navItems[w._octavesWheel.selectedNavItemIndex].title):4,(c+=n)<1?c=1:8<c&&(c=8),N.octave=c,g&&0!==n&&(w._octavesWheel.navigateWheel(8-c),w.blocks.setPitchOctave(w.connections[0],c)),h=u.activity.KeySignatureEnv[0]+" "+u.activity.KeySignatureEnv[1],r="scaledegree2"==w.name?(s=s.replace(o,""),s=SOLFEGENAMES[s-1],s+=o,getNote(s,c,0,h,!0,null,w.activity.errorMsg,w.activity.logo.synth.inTemperament)):getNote(s,c,0,h,u.activity.KeySignatureEnv[2],null,w.activity.errorMsg,w.activity.logo.synth.inTemperament),d||(r[0]=r[0].replace(SHARP,"#").replace(FLAT,"b")),instruments[0]&&instruments[0][DEFAULTVOICE]){e.next=40;break}return e.prev=30,w.activity.logo.synth.createDefaultSynth(0),e.next=34,w.activity.logo.synth.loadSynth(0,DEFAULTVOICE);case 34:e.next=40;break;case 36:return e.prev=36,e.t0=e.catch(30),console.debug("Error initializing synth:",e.t0),e.abrupt("return");case 40:w.activity.logo.synth.tone||w.activity.logo.synth.newTone(),e.prev=41,w.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),w.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),e.next=50;break;case 46:return e.prev=46,e.t1=e.catch(41),console.debug("Error setting volume:",e.t1),e.abrupt("return");case 50:if(w._triggerLock){e.next=63;break}return w._triggerLock=!0,e.prev=52,e.next=55,w.activity.logo.synth.trigger(0,[r[0]+r[1]],1/8,DEFAULTVOICE,null,null,!1);case 55:e.next=60;break;case 57:e.prev=57,e.t2=e.catch(52),console.debug("Error triggering note:",e.t2);case 60:return e.prev=60,setTimeout(function(){w._triggerLock=!1},125),e.finish(60);case 63:e.next=68;break;case 65:e.prev=65,e.t3=e.catch(0),console.error("Error in pitch preview:",e.t3);case 68:case"end":return e.stop()}},e,null,[[0,65],[30,36],[41,46],[52,57,60,63]])}));return function(){return e.apply(this,arguments)}}(),A=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Tone.start();case 3:console.debug("Audio context started"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.debug("Error starting audio context:",e.t0);case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(){return e.apply(this,arguments)}}(),L=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:return w.activity.logo.synth.tone||w.activity.logo.synth.newTone(),e.next=5,M();case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),T=0;T<v.length;T++)u._pitchWheel.navItems[T].navigateFunction=L;if(!d)for(var R=0;R<e.length;R++)u._accidentalsWheel.navItems[R].navigateFunction=L;if(g)for(var F=0;F<8;F++)u._octavesWheel.navItems[F].navigateFunction=L;u._exitWheel.navItems[0].navigateFunction=function(){w._piemenuExitTime=(new Date).getTime();var e=w._pitchWheel.navItems[w._pitchWheel.selectedNavItemIndex].title,t=!d&&w._accidentalsWheel?w._accidentalsWheel.navItems[w._accidentalsWheel.selectedNavItemIndex].title:"";w.text.text="♮"===t||""===t?e:e+t,w.value=e+("♮"===t?"":t),w.container.setChildIndex(w.text,w.container.children.length-1),w.updateCache(),docById("wheelDiv").style.display="none",w._pitchWheel.removeWheel(),d||w._accidentalsWheel.removeWheel(),w._exitWheel.removeWheel(),g&&w._octavesWheel.removeWheel()}}},piemenuCustomNotes=function(e,t,l,i,a){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";var n=null!==e.connections[0]&&["pitch","setpitchnumberoffset","invert1","tofrequency"].includes(e.blocks.blockList[e.connections[0]].name);e._customWheel=new wheelnav("wheelDiv",null,800,800),e._cusNoteWheel=new wheelnav("_cusNoteWheel",e._customWheel.raphael),e._exitWheel=new wheelnav("_exitWheel",e._customWheel.raphael),n&&(e._octavesWheel=new wheelnav("_octavesWheel",e._customWheel.raphael)),wheelnav.cssMode=!0,e._customWheel.keynavigateEnabled=!1,e._customWheel.colors=platformColor.intervalNameWheelcolors,e._customWheel.slicePathFunction=slicePath().DonutSlice,e._customWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._customWheel.slicePathCustom.minRadiusPercent=.1,e._customWheel.slicePathCustom.maxRadiusPercent=.5,e._customWheel.sliceSelectedPathCustom=e._customWheel.slicePathCustom,e._customWheel.sliceInitPathCustom=e._customWheel.slicePathCustom,e._customWheel.titleRotateAngle=0,e._customWheel.animatetime=0,e._customWheel.clickModeRotate=!1,e._customWheel.createWheel(l),e._cusNoteWheel.colors=platformColor.intervalWheelcolors,e._cusNoteWheel.slicePathFunction=slicePath().DonutSlice,e._cusNoteWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._cusNoteWheel.slicePathCustom.minRadiusPercent=.5,e._cusNoteWheel.slicePathCustom.maxRadiusPercent=.85,e._cusNoteWheel.titleFont="100 24px Impact, sans-serif",e._cusNoteWheel.sliceSelectedPathCustom=e._cusNoteWheel.slicePathCustom,e._cusNoteWheel.sliceInitPathCustom=e._cusNoteWheel.slicePathCustom,n&&(e._octavesWheel.colors=platformColor.octavesWheelcolors,e._octavesWheel.slicePathFunction=slicePath().DonutSlice,e._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._octavesWheel.slicePathCustom.minRadiusPercent=.85,e._octavesWheel.slicePathCustom.maxRadiusPercent=1,e._octavesWheel.sliceSelectedPathCustom=e._octavesWheel.slicePathCustom,e._octavesWheel.sliceInitPathCustom=e._octavesWheel.slicePathCustom,e._octavesWheel.animatetime=0,e._octavesWheel.createWheel(["8","7","6","5","4","3","2","1",null,null,null,null,null,null])),e._cusNoteWheel.clickModeRotate=!1,e._cusNoteWheel.titleRotateAngle=180,e._cusNoteWheel.animatetime=0;var o,s={},c=[],h=0,r=0,u=_createForOfIteratorHelper(l);try{for(u.s();!(o=u.n()).done;)var m=o.value,r=r>t[m].pitchNumber?r:t[m].pitchNumber}catch(e){u.e(e)}finally{u.f()}var v,d=_createForOfIteratorHelper(l);try{for(d.s();!(v=d.n()).done;){var W=v.value;for(var _ in s[W]=[],t[W])if("pitchNumber"!==_&&"interval"!==_)if("number"==typeof t[W][_])s[W].push(_),h++;else if(3===t[W][_].length)s[W].push(t[W][_][1]),h++;else for(var g=0;g<t[W][_].length;g++)s[W].push(t[W][_][1]),h++;for(var y=r-h;0<y;y--);h=0}}catch(e){d.e(e)}finally{d.f()}i in s||(i=s[0]);for(var x=0;x<r;x++)x<s[i].length?c.push(s[i][x]):c.push("");e._cusNoteWheel.navAngle=-180/l.length+180/c.length,e._cusNoteWheel.createWheel(c),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.1,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var p,b=e,I=e.container.x,P=e.container.y,f=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,C=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(400),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-400,Math.max(0,Math.round((I+e.activity.blocksContainer.x)*e.activity.getStageScale()+f)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-450,Math.max(0,Math.round((P+e.activity.blocksContainer.y)*e.activity.getStageScale()+C)-200))+"px",n&&(p=e.blocks.findPitchOctave(e.connections[0]),e._octavesWheel.navigateWheel(8-p));for(var k,S=0;S<l.length;S++)!function(l){b._customWheel.navItems[l].navigateFunction=function(){b.customID=b._customWheel.navItems[b._customWheel.selectedNavItemIndex].title,c=[];for(var e=0;e<r;e++)e<s[b._customWheel.navItems[l].title].length?c.push(s[b._customWheel.navItems[l].title][e]):c.push("");for(var t=0;t<c.length;t++)0===c[t].length?b._cusNoteWheel.navItems[t].navItem.hide():(b._cusNoteWheel.navItems[t].title=c[t],b._cusNoteWheel.navItems[t].navItem.title=c[t],b._cusNoteWheel.navItems[t].basicNavTitleMax.title=c[t],b._cusNoteWheel.navItems[t].basicNavTitleMin.title=c[t],b._cusNoteWheel.navItems[t].hoverNavTitleMax.title=c[t],b._cusNoteWheel.navItems[t].hoverNavTitleMin.title=c[t],b._cusNoteWheel.navItems[t].selectedNavTitleMax.title=c[t],b._cusNoteWheel.navItems[t].selectedNavTitleMin.title=c[t],b._cusNoteWheel.navItems[t].initNavTitle.title=c[t],b._cusNoteWheel.navItems[t].navItem.show());b._customWheel.refreshWheel(),b._cusNoteWheel.navigateWheel(0)}}(S);for(k=0;k<l.length&&i!==l[k];k++);k===l.length&&(k=0),e._customWheel.navigateWheel(k);var D=a;for(var E in t[i])if("pitchNumber"!=E&&t[i][E][1]==D){D=+E;break}"number"!=typeof D||isNaN(D)||e._cusNoteWheel.navigateWheel(r*l.indexOf(i)+D);var w=function(){var e=b._customWheel.navItems[b._customWheel.selectedNavItemIndex].title,t=b._cusNoteWheel.navItems[b._cusNoteWheel.selectedNavItemIndex].title;b.value=t,b.text.text=t;var l=4;n&&(l=Number(b._octavesWheel.navItems[b._octavesWheel.selectedNavItemIndex].title),b.blocks.setPitchOctave(b.connections[0],l)),b.container.setChildIndex(b.text,b.container.children.length-1),b.updateCache();var i,a=getNote(t,l,0,"C major",!1,null,b.activity.errorMsg,e);b.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(b.activity.logo.synth.createDefaultSynth(0),b.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),b.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),b.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),b._triggerLock||(b._triggerLock=!0,void 0!==(i=b.activity.logo.synth.getCustomFrequency([t+a[1]],b.customID))&&"undefined"!==i&&instruments[0][DEFAULTVOICE].triggerAttackRelease(i,1/8)),setTimeout(function(){b._triggerLock=!1},125)};if(n)for(var N=0;N<8;N++)e._octavesWheel.navItems[N].navigateFunction=w;for(var M=0;M<c.length;M++)e._cusNoteWheel.navItems[M].navigateFunction=w;e._exitWheel.navItems[0].navigateFunction=function(){b._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none"}}},piemenuNthModalPitch=function(o,s,e){if(e%1!=0&&(e=Math.floor(e+.5)),!o.blocks.stageClick){for(var c=[],t=0;t<s.length;t++)c.push(s[t].toString());c.push(null),docById("wheelDiv").style.display="",o._pitchWheel=new wheelnav("wheelDiv",null,600,600),o._octavesWheel=new wheelnav("_octavesWheel",o._pitchWheel.raphael),o._exitWheel=new wheelnav("_exitWheel",o._pitchWheel.raphael),wheelnav.cssMode=!0,o._pitchWheel.keynavigateEnabled=!1,o._pitchWheel.colors=platformColor.pitchWheelcolors,o._pitchWheel.slicePathFunction=slicePath().DonutSlice,o._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),o._pitchWheel.slicePathCustom.minRadiusPercent=.35,o._pitchWheel.slicePathCustom.maxRadiusPercent=.72,o._pitchWheel.sliceSelectedPathCustom=o._pitchWheel.slicePathCustom,o._pitchWheel.sliceInitPathCustom=o._pitchWheel.slicePathCustom,o._pitchWheel.animatetime=0,o._pitchWheel.createWheel(c),o._exitWheel.colors=platformColor.exitWheelcolors,o._exitWheel.slicePathFunction=slicePath().DonutSlice,o._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),o._exitWheel.slicePathCustom.minRadiusPercent=0,o._exitWheel.slicePathCustom.maxRadiusPercent=.2,o._exitWheel.sliceSelectedPathCustom=o._exitWheel.slicePathCustom,o._exitWheel.sliceInitPathCustom=o._exitWheel.slicePathCustom,o._exitWheel.clickModeRotate=!1,o._exitWheel.initWheel(["×"," "]),o._exitWheel.navItems[1].enabled=!1,o._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",o._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",o._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",o._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",o._exitWheel.createWheel(),o._octavesWheel.colors=platformColor.octavesWheelcolors,o._octavesWheel.slicePathFunction=slicePath().DonutSlice,o._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),o._octavesWheel.slicePathCustom.minRadiusPercent=.8,o._octavesWheel.slicePathCustom.maxRadiusPercent=1,o._octavesWheel.sliceSelectedPathCustom=o._octavesWheel.slicePathCustom,o._octavesWheel.sliceInitPathCustom=o._octavesWheel.slicePathCustom;o._octavesWheel.animatetime=0,o._octavesWheel.createWheel(["8","7","6","5","4","3","2","1",null,null,null,null,null,null]);var l=docById("labelDiv");l.innerHTML='<input id="numberLabel" style="position: absolute; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text;" class="number" type="number" value="'.concat(e,'" />'),l.classList.add("hasKeyboard"),o.label=docById("numberLabel"),o.label.addEventListener("keypress",o._exitKeyPressed.bind(o));var i=o.container.x,a=o.container.y,n=o.activity.canvas.offsetLeft+28*o.blocks.blockScale,h=o.activity.canvas.offsetTop+6*o.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(300);var r=Math.round((i+o.activity.blocksContainer.x)*o.activity.getStageScale()+n),u=Math.round((a+o.activity.blocksContainer.y)*o.activity.getStageScale()+h);o.label.style.left=r+"px",o.label.style.top=u+"px",docById("wheelDiv").style.left=Math.min(Math.max(r-75,0),o.blocks.turtles._canvas.width-300)+"px",docById("wheelDiv").style.top=u-300<0?u+40+"px":u-300+"px",o.label.style.width=Math.round(150*o.blocks.blockScale)*o.protoblock.scale/2+"px",o.label.style.fontSize=Math.round(20*o.blocks.blockScale*o.protoblock.scale/2)+"px";var m=s.indexOf(e);o._pitchWheel.navigateWheel(m);var v=o.blocks.findPitchOctave(o.connections[0]);o._octavesWheel.navigateWheel(8-v);var d=o;o.label.addEventListener("change",function(){d._labelChanged(!1,!1)});for(var W=function(){var e=d._pitchWheel.navItems[d._pitchWheel.selectedNavItemIndex].title,t=c.indexOf(e),l=0;7==c[t]?l=1:c[t]<0&&(l=-1);var i=Number(d._octavesWheel.navItems[d._octavesWheel.selectedNavItemIndex].title);(i+=l)<1?i=1:8<i&&(i=8);var a=o.activity.KeySignatureEnv[0]+" "+o.activity.KeySignatureEnv[1],n=0<=s[t]?nthDegreeToPitch(a,s[t]):nthDegreeToPitch(a,7+s[t]);d.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(d.activity.logo.synth.createDefaultSynth(0),d.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),d.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),d.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),d._triggerLock||(d._triggerLock=!0,d.activity.logo.synth.trigger(0,[n.replace(SHARP,"#").replace(FLAT,"b")+i],1/8,DEFAULTVOICE,null,null)),setTimeout(function(){d._triggerLock=!1},125),function(){var e=d._pitchWheel.navItems[d._pitchWheel.selectedNavItemIndex].title,t=c.indexOf(e);d.value=s[t],d.text.text=e,d.container.setChildIndex(d.text,d.container.children.length-1),d.updateCache();var l=Number(d._octavesWheel.navItems[d._octavesWheel.selectedNavItemIndex].title);d.blocks.setPitchOctave(d.connections[0],l)}()},_=0;_<s.length;_++)o._pitchWheel.navItems[_].navigateFunction=W;for(var g=0;g<8;g++)o._octavesWheel.navItems[g].navigateFunction=W;o._exitWheel.navItems[0].navigateFunction=function(){d._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",d._pitchWheel.removeWheel(),d._exitWheel.removeWheel(),d._octavesWheel.removeWheel()}}},piemenuAccidentals=function(e,l,i,t){if(!e.blocks.stageClick){docById("wheelDiv").style.display="",e._accidentalWheel=new wheelnav("wheelDiv",null,600,600),e._exitWheel=new wheelnav("_exitWheel",e._accidentalWheel.raphael);for(var a=[],n=0;n<l.length;n++)a.push(last(l[n].split(" ")));a.push(null),wheelnav.cssMode=!0,e._accidentalWheel.keynavigateEnabled=!1,e._accidentalWheel.colors=platformColor.accidentalsWheelcolors,e._accidentalWheel.slicePathFunction=slicePath().DonutSlice,e._accidentalWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._accidentalWheel.slicePathCustom.minRadiusPercent=.2,e._accidentalWheel.slicePathCustom.maxRadiusPercent=.6,e._accidentalWheel.sliceSelectedPathCustom=e._accidentalWheel.slicePathCustom,e._accidentalWheel.sliceInitPathCustom=e._accidentalWheel.slicePathCustom,e._accidentalWheel.titleRotateAngle=0,e._accidentalWheel.animatetime=0,e._accidentalWheel.createWheel(a),e._accidentalWheel.setTooltips(l),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var o=e,s=function(){o._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",o._accidentalWheel.removeWheel(),o._exitWheel.removeWheel()},c=e.container.x,h=e.container.y,r=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,u=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(300),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-300,Math.max(0,Math.round((c+e.activity.blocksContainer.x)*e.activity.getStageScale()+r)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-350,Math.max(0,Math.round((h+e.activity.blocksContainer.y)*e.activity.getStageScale()+u)-200))+"px";var m=i.indexOf(t);-1===m&&(m=2),e._accidentalWheel.navigateWheel(m);for(var v=0;v<l.length;v++)e._accidentalWheel.navItems[v].navigateFunction=function(){var e,t;e=o._accidentalWheel.navItems[o._accidentalWheel.selectedNavItemIndex].title,t=a.indexOf(e),o.value=i[t],o.text.text=l[t],o.container.setChildIndex(o.text,o.container.children.length-1),o.updateCache(),s()};e._exitWheel.navItems[0].navigateFunction=function(){s()}}},piemenuNoteValue=function(e,t){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";var i=[3,2,7,5],a={2:[1,2,4,8,16,32],3:[1,3,6,9,12,27],5:[1,5,10,15,20,25],7:[1,7,14,21,28,35]},l=e.connections[0];null!==l&&null!==(l=e.blocks.blockList[l].connections[0])&&["neighbor","neighbor2"].includes(e.blocks.blockList[l].name)&&(a={2:[8,16,32,64],3:[9,12,27,54],5:[10,15,20,25],7:[14,21,28,35]}),e._noteValueWheel=new wheelnav("wheelDiv",null,600,600),e._exitWheel=new wheelnav("_exitWheel",e._noteValueWheel.raphael),e._tabsWheel=new wheelnav("_tabsWheel",e._noteValueWheel.raphael);for(var n=[],o=0;o<i.length;o++)n.push(i[o].toString());wheelnav.cssMode=!0,e._noteValueWheel.keynavigateEnabled=!1,e._noteValueWheel.colors=platformColor.noteValueWheelcolors,e._noteValueWheel.slicePathFunction=slicePath().DonutSlice,e._noteValueWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._noteValueWheel.slicePathCustom.minRadiusPercent=.2,e._noteValueWheel.slicePathCustom.maxRadiusPercent=.6,e._noteValueWheel.sliceSelectedPathCustom=e._noteValueWheel.slicePathCustom,e._noteValueWheel.sliceInitPathCustom=e._noteValueWheel.slicePathCustom,e._noteValueWheel.animatetime=0,e._noteValueWheel.clickModeRotate=!1,e._noteValueWheel.createWheel(n),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();for(var s=[],c=0;c<i.length;c++)for(var h=0;h<a[i[c]].length;h++)s.push(a[i[c]][h].toString());e._tabsWheel.colors=platformColor.tabsWheelcolors,e._tabsWheel.slicePathFunction=slicePath().DonutSlice,e._tabsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._tabsWheel.slicePathCustom.minRadiusPercent=.6,e._tabsWheel.slicePathCustom.maxRadiusPercent=.8,e._tabsWheel.sliceSelectedPathCustom=e._tabsWheel.slicePathCustom,e._tabsWheel.sliceInitPathCustom=e._tabsWheel.slicePathCustom,e._tabsWheel.clickModeRotate=!1,e._tabsWheel.navAngle=-180/i.length+180/(i.length*a[i[0]].length),e._tabsWheel.createWheel(s);var r=e,u=function(){r._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",r._noteValueWheel.removeWheel(),r._exitWheel.removeWheel(),r.label.style.display="none",null!==r._check_meter_block&&r.blocks.meter_block_changed(r._check_meter_block)},m=docById("labelDiv");m.innerHTML='<input id="numberLabel" style="position: absolute; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text;" class="number" type="number" value="'.concat(t,'" />'),m.classList.add("hasKeyboard"),e.label=docById("numberLabel"),e.label.addEventListener("keypress",e._exitKeyPressed.bind(e)),e.label.addEventListener("change",function(){r._labelChanged(!1,!1)});var v=e.container.x,d=e.container.y,W=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,_=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(300);var g=Math.round((v+e.activity.blocksContainer.x)*e.activity.getStageScale()+W),y=Math.round((d+e.activity.blocksContainer.y)*e.activity.getStageScale()+_);e.label.style.left=g+"px",e.label.style.top=y+"px",docById("wheelDiv").style.left=Math.min(Math.max(g-75,0),e.blocks.turtles._canvas.width-300)+"px",docById("wheelDiv").style.top=y-300<0?y+40+"px":y-300+"px",e.label.style.width=Math.round(150*e.blocks.blockScale)*e.protoblock.scale/2+"px";for(var x=function(){for(var e=0;e<i.length;e++)for(var t=0;t<a[i[0]].length;t++){var l=e*a[i[0]].length;r._noteValueWheel.selectedNavItemIndex===e?r._tabsWheel.navItems[l+t].navItem.show():r._tabsWheel.navItems[l+t].navItem.hide()}},p=0;p<n.length;p++)e._noteValueWheel.navItems[p].navigateFunction=x;if(1===t)e._noteValueWheel.navigateWheel(1),e._tabsWheel.navigateWheel(0);else{for(var b=0;b<i.length;b++){for(var I=void 0,I=0;I<a[i[b]].length;I++)if(a[i[b]][I]===t){e._noteValueWheel.navigateWheel(b),e._tabsWheel.navigateWheel(b*a[i[b]].length+I);break}if(I<a[i[b]].length)break}b===i.length&&(e._noteValueWheel.navigateWheel(1),e._tabsWheel.navigateWheel(2))}e.label.style.fontSize=Math.round(20*e.blocks.blockScale*e.protoblock.scale/2)+"px",e.label.style.display="",e.label.focus();for(var P=0;P<s.length;P++)e._tabsWheel.navItems[P].navigateFunction=function(){r.text.text=r._tabsWheel.navItems[r._tabsWheel.selectedNavItemIndex].title,r.value=Number(r.text.text),r.container.setChildIndex(r.text,r.container.children.length-1),r.updateCache(),u()};e._exitWheel.navItems[0].navigateFunction=function(){u()}}},piemenuNumber=function(e,i,t){if(!e.blocks.stageClick){docById("wheelDiv").style.display="",e._numberWheel=new wheelnav("wheelDiv",null,600,600),e._exitWheel=new wheelnav("_exitWheel",e._numberWheel.raphael);for(var a=[],l=0;l<i.length;l++)a.push(i[l].toString());if(a.push(null),wheelnav.cssMode=!0,e._numberWheel.keynavigateEnabled=!1,e._numberWheel.colors=platformColor.numberWheelcolors,e._numberWheel.slicePathFunction=slicePath().DonutSlice,e._numberWheel.slicePathCustom=slicePath().DonutSliceCustomization(),16<i.length?(e._numberWheel.slicePathCustom.minRadiusPercent=.6,e._numberWheel.slicePathCustom.maxRadiusPercent=1):10<i.length?(e._numberWheel.slicePathCustom.minRadiusPercent=.5,e._numberWheel.slicePathCustom.maxRadiusPercent=.9):(e._numberWheel.slicePathCustom.minRadiusPercent=.2,e._numberWheel.slicePathCustom.maxRadiusPercent=.6),e._numberWheel.sliceSelectedPathCustom=e._numberWheel.slicePathCustom,e._numberWheel.sliceInitPathCustom=e._numberWheel.slicePathCustom,"setbpm3"===e.blocks.blockList[e.connections[0]].name||"setmasterbpm2"===e.blocks.blockList[e.connections[0]].name?(e._numberWheel.titleRotateAngle=0,t=90===t?90:t<40?40:t<60?2*Math.floor(e.value/2):t<72?3*Math.floor(e.value/3):t<120?4*Math.floor(e.value/4):t<144?6*Math.floor(e.value/6):t<208?8*Math.floor(e.value/8):208):"setheading"===e.blocks.blockList[e.connections[0]].name&&(e._numberWheel.navAngle=-90),e._numberWheel.animatetime=0,e._numberWheel.createWheel(a),20<e._numberWheel.navItems.length)for(var n=0;n<e._numberWheel.navItems.length;n++)e._numberWheel.navItems[n].titleAttr.font="30 30px sans-serif",e._numberWheel.navItems[n].titleSelectedAttr.font="30 30px sans-serif";e._exitWheel.colors=platformColor.exitWheelcolors2,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×","-","+"]),e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.navItems[1].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[1].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[1].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[1].titleHoverAttr.cursor="pointer",e._exitWheel.navItems[2].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[2].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[2].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[2].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var o=e,s=function(){o.value=i[o._numberWheel.selectedNavItemIndex],o.text.text=a[o._numberWheel.selectedNavItemIndex],o.container.setChildIndex(o.text,o.container.children.length-1),o.updateCache()},c=function(){o._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",o._numberWheel.removeWheel(),o._exitWheel.removeWheel(),o.label.style.display="none",null!==o._check_meter_block&&o.blocks.meter_block_changed(o._check_meter_block)},h=docById("labelDiv");h.innerHTML='<input id="numberLabel" style="position: absolute; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text;" class="number" type="number" value="'.concat(t,'" />'),h.classList.add("hasKeyboard"),e.label=docById("numberLabel"),e.label.addEventListener("keypress",e._exitKeyPressed.bind(e)),e.label.addEventListener("change",function(){o._labelChanged(!1,!1)});var r=e.container.x,u=e.container.y,m=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,v=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(300);var d=Math.round((r+e.activity.blocksContainer.x)*e.activity.getStageScale()+m),W=Math.round((u+e.activity.blocksContainer.y)*e.activity.getStageScale()+v);e.label.style.left=d+"px",e.label.style.top=W+"px",docById("wheelDiv").style.left=Math.min(Math.max(d-75,0),e.blocks.turtles._canvas.width-300)+"px",docById("wheelDiv").style.top=W-300<0?W+40+"px":W-300+"px",e.label.style.width=Math.round(150*e.blocks.blockScale)*e.protoblock.scale/2+"px";var _=i.indexOf(t);(-1===_||t<1||8<t)&&(t=Math.min(Math.max(t,1),8),_=i.indexOf(t)),t%1!=0&&(t=Math.min(Math.max(Math.floor(t+.5),1),8),_=i.indexOf(t)),-1!==_&&e._numberWheel.navigateWheel(_),e.label.style.fontSize=Math.round(20*e.blocks.blockScale*e.protoblock.scale/2)+"px",e.label.style.display="",e.label.focus();for(var g=0;g<a.length;g++)e._numberWheel.navItems[g].navigateFunction=function(){s(),c()};e._exitWheel.navItems[0].navigateFunction=function(){c()},e._exitWheel.navItems[1].navigateFunction=function(){var e,t=o.connections[0];null===(e=o.blocks.blockList[t])||void 0===e||e.connections[0];1<o.value&&--o.value,o.text.text=o.value.toString(),o.container.setChildIndex(o.text,o.container.children.length-1),o.updateCache(),o.label.value=o.value},e._exitWheel.navItems[2].navigateFunction=function(){o.connections[0];o.value<8&&(o.value+=1),o.text.text=o.value.toString(),o.container.setChildIndex(o.text,o.container.children.length-1),o.updateCache(),o.label.value=o.value};var y=function(){var e=o._numberWheel.navItems[o._numberWheel.selectedNavItemIndex].title,t=a.indexOf(e),l=numberToPitch(i[t]+3);o.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(o.activity.logo.synth.createDefaultSynth(0),o.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),o.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),o.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),l[0]=l[0].replace(SHARP,"#").replace(FLAT,"b"),o._triggerLock||(o._triggerLock=!0,o.activity.logo.synth.trigger(0,l[0]+(l[1]+3),1/8,DEFAULTVOICE,null,null)),setTimeout(function(){o._triggerLock=!1},125),s()},x=function(){var e=o._numberWheel.navItems[o._numberWheel.selectedNavItemIndex].title,t=a.indexOf(e),l=frequencyToPitch(i[t]);o.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(o.activity.logo.synth.createDefaultSynth(0),o.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),o.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),o.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),l[0]=l[0].replace(SHARP,"#").replace(FLAT,"b"),o._triggerLock||(o._triggerLock=!0,o.activity.logo.synth.trigger(0,l[0]+l[1],1/8,DEFAULTVOICE,null,null)),setTimeout(function(){o._triggerLock=!1},125),s()};if(e._usePieNumberC1()&&"pitchnumber"===e.blocks.blockList[e.connections[0]].name)for(var p=0;p<i.length;p++)e._numberWheel.navItems[p].navigateFunction=y;if(e._usePieNumberC1()&&"hertz"===e.blocks.blockList[e.connections[0]].name)for(var b=0;b<i.length;b++)e._numberWheel.navItems[b].navigateFunction=x}},piemenuColor=function(e,t,l,i){if(!e.blocks.stageClick){docById("wheelDiv").style.display="",e._numberWheel=new wheelnav("wheelDiv",null,600,600),e._exitWheel=new wheelnav("_exitWheel",e._numberWheel.raphael);for(var a=[],n=0;n<t.length;n++)a.push(t[n].toString());if(wheelnav.cssMode=!0,e._numberWheel.keynavigateEnabled=!1,e._numberWheel.colors=[],"setcolor"===i||"setturtlecolor"===i)for(var o=0;o<t.length;o++)e._numberWheel.colors.push(COLORS40[Math.floor(t[o]/2.5)][2]);else if("sethue"===i)for(var s=0;s<t.length;s++)e._numberWheel.colors.push(getMunsellColor(t[s],50,50));else{if("setshade"===i)for(var c=0;c<t.length;c++)e._numberWheel.colors.push(getMunsellColor(0,t[c],0));else if("settranslucency"===i)for(var h=0;h<t.length;h++)e._numberWheel.colors.push(getMunsellColor(35,70,100-t[h]));else for(var r=0;r<t.length;r++)e._numberWheel.colors.push(getMunsellColor(60,60,t[r]));for(var u=0;u<t.length;u++)a.push(null)}e._numberWheel.slicePathFunction=slicePath().DonutSlice,e._numberWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._numberWheel.slicePathCustom.minRadiusPercent=.6,e._numberWheel.slicePathCustom.maxRadiusPercent=1,e._numberWheel.sliceSelectedPathCustom=e._numberWheel.slicePathCustom,e._numberWheel.sliceInitPathCustom=e._numberWheel.slicePathCustom,e._numberWheel.animatetime=0,e._numberWheel.createWheel(a),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var m=e,v=function(){m._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",m._numberWheel.removeWheel(),m._exitWheel.removeWheel(),m.label.style.display="none"},d=docById("labelDiv");d.innerHTML='<input id="numberLabel" style="position: absolute; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text;" class="number" type="number" value="'.concat(l,'" />'),d.classList.add("hasKeyboard"),e.label=docById("numberLabel"),e.label.addEventListener("keypress",e._exitKeyPressed.bind(e)),e.label.addEventListener("change",function(){m._labelChanged(!1,!1)});var W=e.container.x,_=e.container.y,g=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,y=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(300);var x=Math.round((W+e.activity.blocksContainer.x)*e.activity.getStageScale()+g),p=Math.round((_+e.activity.blocksContainer.y)*e.activity.getStageScale()+y);e.label.style.left=x+"px",e.label.style.top=p+"px",docById("wheelDiv").style.left=Math.min(Math.max(x-75,0),e.blocks.turtles._canvas.width-300)+"px",docById("wheelDiv").style.top=p-300<0?p+40+"px":p-300+"px",e.label.style.width=Math.round(150*e.blocks.blockScale)*e.protoblock.scale/2+"px";var b=t.indexOf(l);-1===b&&(b=0),e._numberWheel.navigateWheel(b),e.label.style.fontSize=Math.round(20*e.blocks.blockScale*e.protoblock.scale/2)+"px",e.label.style.display="",e.label.focus();for(var I=0;I<a.length;I++)e._numberWheel.navItems[I].navigateFunction=function(){m.value=t[m._numberWheel.selectedNavItemIndex],m.text.text=a[m._numberWheel.selectedNavItemIndex],m.container.setChildIndex(m.text,m.container.children.length-1),m.updateCache(),v()};e._exitWheel.navItems[0].navigateFunction=function(){v()}}},piemenuBasic=function(e,l,i,t,a){if(!e.blocks.stageClick){void 0===a&&(a=platformColor.piemenuBasicundefined),docById("wheelDiv").style.display="";var n=800;"outputtools"===e.name||"grid"===e.name?n=1e3:"temperamentname"===e.name&&(n=1200),e._basicWheel=new wheelnav("wheelDiv",null,n,n),e._exitWheel=new wheelnav("_exitWheel",e._basicWheel.raphael);for(var o=[],s=0;s<l.length;s++)o.push(l[s]);wheelnav.cssMode=!0,e._basicWheel.keynavigateEnabled=!1,e._basicWheel.colors=a,e._basicWheel.slicePathFunction=slicePath().DonutSlice,e._basicWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._basicWheel.slicePathCustom.minRadiusPercent=.2,e._basicWheel.slicePathCustom.maxRadiusPercent=1,e._basicWheel.sliceSelectedPathCustom=e._basicWheel.slicePathCustom,e._basicWheel.sliceInitPathCustom=e._basicWheel.slicePathCustom,e._basicWheel.animatetime=0,"wrapmode"!==e.name&&(e._basicWheel.titleRotateAngle=0),e._basicWheel.createWheel(o),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var c=e,h=function(){c._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",c._basicWheel.removeWheel()},r=e.container.x,u=e.container.y,m=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,v=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(300),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-300,Math.max(0,Math.round((r+e.activity.blocksContainer.x)*e.activity.getStageScale()+m)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-350,Math.max(0,Math.round((u+e.activity.blocksContainer.y)*e.activity.getStageScale()+v)-200))+"px";var d=i.indexOf(t);-1===d&&(d=1),e._basicWheel.navigateWheel(d);for(var W=0;W<l.length;W++)e._basicWheel.navItems[W].navigateFunction=function(){var e,t;e=c._basicWheel.navItems[c._basicWheel.selectedNavItemIndex].title,t=o.indexOf(e),"outputtools"===c.name?(c.overrideName=i[t],c.privateData=i[t]):c.value=i[t],c.text.text=l[t],c.container.setChildIndex(c.text,c.container.children.length-1),c.updateCache(),h()};e._exitWheel.navItems[0].navigateFunction=function(){h()}}},piemenuBoolean=function(e,l,i,t){if(!e.blocks.stageClick){docById("wheelDiv").style.display="",e._booleanWheel=new wheelnav("wheelDiv",null,600,600);for(var a=[],n=0;n<l.length;n++)a.push(l[n]);wheelnav.cssMode=!0,e._booleanWheel.keynavigateEnabled=!1,e._booleanWheel.colors=platformColor.booleanWheelcolors,e._booleanWheel.slicePathFunction=slicePath().DonutSlice,e._booleanWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._booleanWheel.slicePathCustom.minRadiusPercent=0,e._booleanWheel.slicePathCustom.maxRadiusPercent=.6,e._booleanWheel.sliceSelectedPathCustom=e._booleanWheel.slicePathCustom,e._booleanWheel.sliceInitPathCustom=e._booleanWheel.slicePathCustom,e._booleanWheel.animatetime=0,e._booleanWheel.createWheel(a);var o=e,s=function(){var e=o._booleanWheel.navItems[o._booleanWheel.selectedNavItemIndex].title,t=a.indexOf(e);o.value=i[t],o.text.text=l[t],o.container.setChildIndex(o.text,o.container.children.length-1),o.updateCache()},c=function(){o._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",o._booleanWheel.removeWheel()},h=e.container.x,r=e.container.y,u=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,m=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(300),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-300,Math.max(0,Math.round((h+e.activity.blocksContainer.x)*e.activity.getStageScale()+u)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-350,Math.max(0,Math.round((r+e.activity.blocksContainer.y)*e.activity.getStageScale()+m)-200))+"px";var v=i.indexOf(t);-1===v&&(v=0),e._booleanWheel.navigateWheel(v),e._booleanWheel.navItems[0].navigateFunction=function(){s(),c()},e._booleanWheel.navItems[1].navigateFunction=function(){s(),c()}}},piemenuChords=function(e,t){if(!e.blocks.stageClick){docById("wheelDiv").style.display="",e._chordWheel=new wheelnav("wheelDiv",null,1e3,1e3),e._exitWheel=new wheelnav("_exitWheel",e._chordWheel.raphael);for(var l=[],i=0;i<CHORDNAMES.length;i++){var a=_(CHORDNAMES[i]);0===a.length?l.push(CHORDNAMES[i]):l.push(a)}wheelnav.cssMode=!0,e._chordWheel.keynavigateEnabled=!1,e._chordWheel.colors=platformColor.modeWheelcolors,e._chordWheel.slicePathFunction=slicePath().DonutSlice,e._chordWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._chordWheel.slicePathCustom.minRadiusPercent=.2,e._chordWheel.slicePathCustom.maxRadiusPercent=1,e._chordWheel.sliceSelectedPathCustom=e._chordWheel.slicePathCustom,e._chordWheel.sliceInitPathCustom=e._chordWheel.slicePathCustom,e._chordWheel.titleRotateAngle=0,e._chordWheel.animatetime=0,e._chordWheel.createWheel(l);for(var n=0;n<e._chordWheel.navItems.length;n++)e._chordWheel.navItems[n].titleAttr.font="32 32px sans-serif",e._chordWheel.navItems[n].titleSelectedAttr.font="32 32px sans-serif";e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var o=e,s=function(){o._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",o._chordWheel.removeWheel()},c=e.container.x,h=e.container.y,r=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,u=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(400),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-300,Math.max(0,Math.round((c+e.activity.blocksContainer.x)*e.activity.getStageScale()+r)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-350,Math.max(0,Math.round((h+e.activity.blocksContainer.y)*e.activity.getStageScale()+u)-200))+"px";var m=l.indexOf(t);-1===m&&(m=0),e._chordWheel.navigateWheel(m);for(var v=0;v<l.length;v++)e._chordWheel.navItems[v].navigateFunction=function(){o.text.text=o._chordWheel.navItems[o._chordWheel.selectedNavItemIndex].title,o.value=CHORDNAMES[o._chordWheel.selectedNavItemIndex],o.container.setChildIndex(o.text,o.container.children.length-1),o.updateCache(),s()};e._exitWheel.navItems[0].navigateFunction=function(){s()}}},piemenuVoices=function(e,s,c,t,l,i){if(!e.blocks.stageClick){for(var a=platformColor.piemenuVoicesColors,n=[],o=0;o<s.length;o++)n.push(a[t[o]%a.length]);docById("wheelDiv").style.display="","kana"===localStorage.kanaPreference?e._voiceWheel=new wheelnav("wheelDiv",null,1200,1200):e._voiceWheel=new wheelnav("wheelDiv",null,800,800),e._exitWheel=new wheelnav("_exitWheel",e._voiceWheel.raphael),wheelnav.cssMode=!0,e._voiceWheel.keynavigateEnabled=!1,e._voiceWheel.colors=n,e._voiceWheel.slicePathFunction=slicePath().DonutSlice,e._voiceWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._voiceWheel.slicePathCustom.minRadiusPercent=.2,e._voiceWheel.slicePathCustom.maxRadiusPercent=1,e._voiceWheel.sliceSelectedPathCustom=e._voiceWheel.slicePathCustom,e._voiceWheel.sliceInitPathCustom=e._voiceWheel.slicePathCustom,e._voiceWheel.titleRotateAngle=void 0===i?0:i,e._voiceWheel.animatetime=0,e._voiceWheel.createWheel(s);for(var h=0;h<e._voiceWheel.navItems.length;h++)e._voiceWheel.navItems[h].titleAttr.font="30 30px sans-serif",e._voiceWheel.navItems[h].titleSelectedAttr.font="30 30px sans-serif";e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var r=e,u=function(){var e,t,l=r._voiceWheel.navItems[r._voiceWheel.selectedNavItemIndex].title,i=s.indexOf(l),a=c[i],n=0,o=r.activity.turtles.ithTurtle(0);o.singer.instrumentNames.includes(a)||(o.singer.instrumentNames.push(a),a===DEFAULTVOICE&&r.activity.logo.synth.createDefaultSynth(0),r.activity.logo.synth.loadSynth(0,a),n=500),setTimeout(function(){Singer.setSynthVolume(r.activity.logo,0,a,DEFAULTVOLUME),r.activity.logo.synth.trigger(0,"G4",.25,a,null,null,!1),r.activity.logo.synth.start()},n),e=r._voiceWheel.navItems[r._voiceWheel.selectedNavItemIndex].title,t=s.indexOf(e),r.value=c[t],r.text.text=e,null===getDrumName(r.value)?r.activity.logo.synth.loadSynth(0,getVoiceSynthName(r.value)):r.activity.logo.synth.loadSynth(0,getDrumSynthName(r.value)),r.container.setChildIndex(r.text,r.container.children.length-1),r.updateCache()},m=e.container.x,v=e.container.y,d=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,W=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(400),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-400,Math.max(0,Math.round((m+e.activity.blocksContainer.x)*e.activity.getStageScale()+d)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-450,Math.max(0,Math.round((v+e.activity.blocksContainer.y)*e.activity.getStageScale()+W)-200))+"px";var _=c.indexOf(l);-1===_&&(_=0),e._voiceWheel.navigateWheel(_);for(var g=0;g<c.length;g++)e._voiceWheel.navItems[g].navigateFunction=u;e._exitWheel.navItems[0].navigateFunction=function(){r._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none"}}},piemenuIntervals=function(e,t){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";var l=localStorage.languagePreference;e._intervalNameWheel="ja"===l?new wheelnav("wheelDiv",null,1500,1500):new wheelnav("wheelDiv",null,800,800),e._intervalWheel=new wheelnav("block._intervalWheel",e._intervalNameWheel.raphael),e._exitWheel=new wheelnav("_exitWheel",e._intervalNameWheel.raphael),wheelnav.cssMode=!0,e._intervalNameWheel.keynavigateEnabled=!1,e._intervalNameWheel.colors=platformColor.intervalNameWheelcolors,e._intervalNameWheel.slicePathFunction=slicePath().DonutSlice,e._intervalNameWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._intervalNameWheel.slicePathCustom.minRadiusPercent=.2,e._intervalNameWheel.slicePathCustom.maxRadiusPercent=.8,e._intervalNameWheel.sliceSelectedPathCustom=e._intervalNameWheel.slicePathCustom,e._intervalNameWheel.sliceInitPathCustom=e._intervalNameWheel.slicePathCustom,e._intervalNameWheel.titleRotateAngle=0,e._intervalNameWheel.clickModeRotate=!1;for(var a=[],i=0;i<INTERVALS.length;i++)a.push(_(INTERVALS[i][1]));e._intervalNameWheel.animatetime=0,e._intervalNameWheel.createWheel(a),e._intervalWheel.colors=platformColor.intervalWheelcolors,e._intervalWheel.slicePathFunction=slicePath().DonutSlice,e._intervalWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._intervalWheel.slicePathCustom.minRadiusPercent=.8,e._intervalWheel.slicePathCustom.maxRadiusPercent=1,e._intervalWheel.sliceSelectedPathCustom=e._intervalWheel.slicePathCustom,e._intervalWheel.sliceInitPathCustom=e._intervalWheel.slicePathCustom,e._intervalWheel.clickModeRotate=!1,e._intervalWheel.navAngle=-180/a.length+180/(8*a.length);for(var n=[],o=e._intervalWheel.animatetime=0;o<INTERVALS.length;o++)for(var s=1;s<9;s++)n.push(s.toString());e._intervalWheel.createWheel(n),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var c=e,h=e.container.x,r=e.container.y,u=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,m=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(400),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-400,Math.max(0,Math.round((h+e.activity.blocksContainer.x)*e.activity.getStageScale()+u)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-450,Math.max(0,Math.round((r+e.activity.blocksContainer.y)*e.activity.getStageScale()+m)-200))+"px";for(var v=0;v<INTERVALS.length;v++)!function(l,i){c._intervalNameWheel.navItems[l].navigateFunction=function(){for(var e=0;e<a.length;e++)for(var t=0;t<8;t++)e===l&&i.includes(t+1)?c._intervalWheel.navItems[8*e+t].navItem.show():c._intervalWheel.navItems[8*e+t].navItem.hide()}}(v,INTERVALS[v][2]);for(var d=t.split(" "),W=0;W<INTERVALS.length&&d[0]!==INTERVALS[W][1];W++);W===INTERVALS.length&&(W=0),e._intervalNameWheel.navigateWheel(W);var g=Number(d[1]);INTERVALS[W][2].includes(g)?e._intervalWheel.navigateWheel(g-1):e._intervalWheel.navigateWheel(INTERVALS[W][2][0]-1);for(var y=function(){var e=c._intervalNameWheel.navItems[c._intervalNameWheel.selectedNavItemIndex].title,t=c._intervalWheel.navItems[c._intervalWheel.selectedNavItemIndex].title;c.value=INTERVALS[c._intervalNameWheel.selectedNavItemIndex][1]+" "+t,c.text.text="perfect 1"===e?_("unison"):e+" "+t,c.container.setChildIndex(c.text,c.container.children.length-1),c.updateCache();var l=getNote("C",4,INTERVALVALUES[c.value][0],"C major",!1,null,null);l[0]=l[0].replace(SHARP,"#").replace(FLAT,"b"),c.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(c.activity.logo.synth.createDefaultSynth(0),c.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),c.activity.logo.synth.setMasterVolume(DEFAULTVOLUME),Singer.setSynthVolume(c.activity.logo,0,DEFAULTVOICE,DEFAULTVOLUME),c._triggerLock||(c._triggerLock=!0,c.activity.logo.synth.trigger(0,["C4",l[0]+l[1]],1/8,DEFAULTVOICE,null,null)),setTimeout(function(){c._triggerLock=!1},125)},x=0;x<8*a.length;x++)e._intervalWheel.navItems[x].navigateFunction=y;e._exitWheel.navItems[0].navigateFunction=function(){c._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none"}}},piemenuModes=function(e,W){if(!e.blocks.stageClick){var t,i="C",l="7",a=!1,n=e.connections[0];null!==n&&("setkey2"!==e.blocks.blockList[n].name||null!==(t=e.blocks.blockList[n].connections[1])&&"notename"===e.blocks.blockList[t].name&&(i=e.blocks.blockList[t].value)),docById("wheelDiv").style.display="",e._modeWheel=new wheelnav("wheelDiv",null,1200,1200),e._modeGroupWheel=new wheelnav("_modeGroupWheel",e._modeWheel.raphael),e._modeNameWheel=null,e._exitWheel=new wheelnav("_exitWheel",e._modeWheel.raphael),wheelnav.cssMode=!0,e._modeWheel.colors=platformColor.modeWheelcolors,e._modeWheel.slicePathFunction=slicePath().DonutSlice,e._modeWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._modeWheel.slicePathCustom.minRadiusPercent=.85,e._modeWheel.slicePathCustom.maxRadiusPercent=1,e._modeWheel.sliceSelectedPathCustom=e._modeWheel.slicePathCustom,e._modeWheel.sliceInitPathCustom=e._modeWheel.slicePathCustom,e._modeWheel.clickModeRotate=!1,e._modeWheel.navAngle=-90,e._modeWheel.animatetime=0,e._modeWheel.createWheel(["0","1","2","3","4","5","6","7","8","9","10","11"]),e._modeGroupWheel.colors=platformColor.modeGroupWheelcolors,e._modeGroupWheel.slicePathFunction=slicePath().DonutSlice,e._modeGroupWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._modeGroupWheel.slicePathCustom.minRadiusPercent=.15,e._modeGroupWheel.slicePathCustom.maxRadiusPercent=.3,e._modeGroupWheel.sliceSelectedPathCustom=e._modeGroupWheel.slicePathCustom,e._modeGroupWheel.sliceInitPathCustom=e._modeGroupWheel.slicePathCustom,e._modeGroupWheel.navAngle=-90,e._modeGroupWheel.animatetime=0;var o=[];for(var s in MODE_PIE_MENUS)o.push(s);e._modeGroupWheel.createWheel(o),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.15,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×","▶"]),e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.navItems[1].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[1].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[1].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[1].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var c,g=e,y=function(e,t){g._modeNameWheel.navItems[e].navigateFunction=function(){for(var e=0;e<12;e++)t.includes(e)?g._modeWheel.navItems[e].navItem.show():g._modeWheel.navItems[e].navItem.hide();!function(){if(" "===g._modeNameWheel.navItems[g._modeNameWheel.selectedNavItemIndex].title)g._modeNameWheel.navigateWheel((g._modeNameWheel.selectedNavItemIndex+1)%g._modeNameWheel.navItems.length);else{if(g.text.text=g._modeNameWheel.navItems[g._modeNameWheel.selectedNavItemIndex].title,g.text.text===_("major")+" / "+_("ionian"))g.value="major";else if(g.text.text===_("minor")+" / "+_("aeolian"))g.value="aeolian";else for(var e=0;e<MODE_PIE_MENUS[l].length;e++){var t=MODE_PIE_MENUS[l][e];if(_(t)===g.text.text){g.value=t;break}}g.container.setChildIndex(g.text,g.container.children.length-1),g.updateCache()}}()}},h=function(){var e=0;a&&(e=12);var t=g._modeWheel.selectedNavItemIndex,l=getNote(i,4,t+e,i+" chromatic",!1,null,null);l[0]=l[0].replace(SHARP,"#").replace(FLAT,"b"),g.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(g.activity.logo.synth.createDefaultSynth(0),g.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),g.activity.logo.synth.setMasterVolume(DEFAULTVOLUME),g.activity.logo.synth.setVolume(0,DEFAULTVOICE,DEFAULTVOLUME),g.activity.logo.synth.trigger(0,[l[0]+l[1]],1/12,DEFAULTVOICE,null,null)},r=e.container.x,u=e.container.y,m=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,v=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(600),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-600,Math.max(0,Math.round((r+e.activity.blocksContainer.x)*e.activity.getStageScale()+m)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-650,Math.max(0,Math.round((u+e.activity.blocksContainer.y)*e.activity.getStageScale()+v)-200))+"px";for(var d=0;d<12;d++)g._modeWheel.navItems[d].navigateFunction=h;for(l in MODE_PIE_MENUS){for(var x=void 0,x=0;x<MODE_PIE_MENUS[l].length;x++){if(MODE_PIE_MENUS[l][x]===W)break}if(x<MODE_PIE_MENUS[l].length)break}"major"===W&&(l="7");for(var p=function(){var e=g._modeGroupWheel.selectedNavItemIndex;!function(e){var t=!1;null===g._modeNameWheel&&(g._modeNameWheel=new wheelnav("_modeNameWheel",g._modeWheel.raphael),t=!0),g._modeNameWheel.keynavigateEnabled=!1;for(var l=[],i=0;i<MODE_PIE_MENUS[e].length;i++){" "===MODE_PIE_MENUS[e][i]?l.push(platformColor.modePieMenusIfColorPush):l.push(platformColor.modePieMenusElseColorPush)}g._modeNameWheel.colors=l,g._modeNameWheel.slicePathFunction=slicePath().DonutSlice,g._modeNameWheel.slicePathCustom=slicePath().DonutSliceCustomization(),g._modeNameWheel.slicePathCustom.minRadiusPercent=.3,g._modeNameWheel.slicePathCustom.maxRadiusPercent=.85,g._modeNameWheel.sliceSelectedPathCustom=g._modeNameWheel.slicePathCustom,g._modeNameWheel.sliceInitPathCustom=g._modeNameWheel.slicePathCustom,g._modeNameWheel.titleRotateAngle=0,g._modeNameWheel.navAngle=-90;for(var a=new Array,n=0;n<MODE_PIE_MENUS[e].length;n++){var o=MODE_PIE_MENUS[e][n];switch(o){case"ionian":case"major":a.push(_("major")+" / "+_("ionian"));break;case"aeolian":case"minor":a.push(_("minor")+" / "+_("aeolian"));break;default:" "===o?a.push(" "):a.push(_(o))}}if(g._modeNameWheel.animatetime=0,t)g._modeNameWheel.createWheel(a);else{for(var s=0;s<g._modeNameWheel.navItems.length;s++)g._modeNameWheel.navItems[s].title=a[s],g._modeNameWheel.navItems[s].basicNavTitleMax.title=a[s],g._modeNameWheel.navItems[s].basicNavTitleMin.title=a[s],g._modeNameWheel.navItems[s].hoverNavTitleMax.title=a[s],g._modeNameWheel.navItems[s].hoverNavTitleMin.title=a[s],g._modeNameWheel.navItems[s].selectedNavTitleMax.title=a[s],g._modeNameWheel.navItems[s].selectedNavTitleMin.title=a[s],g._modeNameWheel.navItems[s].initNavTitle.title=a[s],g._modeNameWheel.navItems[s].fillAttr=l[s],g._modeNameWheel.navItems[s].sliceHoverAttr.fill=l[s],g._modeNameWheel.navItems[s].slicePathAttr.fill=l[s],g._modeNameWheel.navItems[s].sliceSelectedAttr.fill=l[s];g._modeNameWheel.refreshWheel()}if("ja"===localStorage.languagePreference)for(var c=0;c<g._modeNameWheel.navItems.length;c++)g._modeNameWheel.navItems[c].titleAttr.font="30 30px sans-serif",g._modeNameWheel.navItems[c].titleSelectedAttr.font="30 30px sans-serif";for(var h=0,r=0;r<MODE_PIE_MENUS[e].length;r++){var u=MODE_PIE_MENUS[e][r],m=[0];if(" "!==u)for(var v=MUSICALMODES[u],d=0;d<v.length;d++)m.push(last(m)+v[d]);y(h,m),h+=1}for(h=0;h<MODE_PIE_MENUS[e].length&&MODE_PIE_MENUS[e][h]!==W;h++);h===a.length&&(h=0),g._modeNameWheel.navigateWheel(h)}(l=g._modeGroupWheel.navItems[e].title)},b=0;b<e._modeGroupWheel.navItems.length;b++)e._modeGroupWheel.navItems[b].navigateFunction=p;for(var I=0;I<e._modeGroupWheel.navItems.length;I++)if(e._modeGroupWheel.navItems[I].title===l){e._modeGroupWheel.navigateWheel(I);break}e._exitWheel.navItems[0].navigateFunction=function(){c&&clearTimeout(c),g._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",null!==g._modeNameWheel&&g._modeNameWheel.removeWheel()},e._exitWheel.navItems[1].navigateFunction=function(){for(var e=[0],t=MUSICALMODES[g.value],l=0;l<t.length-1;l++)e.push(last(e)+t[l]);e.push(12),e.push(12);for(var i=t.length-1;0<=i;i--)e.push(last(e)-t[i]);docById("wheelnav-_exitWheel-title-1").style.fill="#ffffff",docById("wheelnav-_exitWheel-title-1").style.pointerEvents="none",docById("wheelnav-_exitWheel-slice-1").style.pointerEvents="none",setTimeout(function(){var e=docById("wheelnav-_exitWheel-title-1"),t=docById("wheelnav-_exitWheel-slice-1");e&&t&&(e.style.fill="#000000",e.style.pointerEvents="auto",t.style.pointerEvents="auto")},2e3),function e(t,l){l<t.length&&(t[l]<12?(a=!1,g._modeWheel.navigateWheel(t[l])):(a=!0,g._modeWheel.navigateWheel(0)),c=setTimeout(function(){e(t,l+1)},100))}(e,0)}}},piemenuBlockContext=function(e){var l,i,a,n,t,o,s,c,h,r,u,m;null!==e.blocks.activeBlock&&(i=l=0,n=(a=e).blocks.blockList.indexOf(e),docById("contextWheelDiv").style.position="absolute",t=e.blocks.blockList[n].container.x,o=e.blocks.blockList[n].container.y,s=e.activity.canvas.offsetLeft+28*e.activity.getStageScale(),c=e.activity.canvas.offsetTop+6*e.activity.getStageScale(),docById("contextWheelDiv").style.left=Math.round((t+e.activity.blocksContainer.x)*e.activity.getStageScale()+s)-150+"px",docById("contextWheelDiv").style.top=Math.round((o+e.activity.blocksContainer.y)*e.activity.getStageScale()+c)-150+"px",docById("contextWheelDiv").style.display="",h=["imgsrc:header-icons/copy-button.svg","imgsrc:header-icons/extract-button.svg","imgsrc:header-icons/empty-trash-button.svg","imgsrc:header-icons/cancel-button.svg"],r=e.blocks.findTopBlock(n),["customsample","temperament1","definemode","show","turtleshell","action"].includes(e.name)&&h.push("imgsrc:header-icons/save-blocks-button.svg"),u=e.blocks.blockList[e.blocks.activeBlock].protoblock.helpString?(h.push("imgsrc:header-icons/help-button.svg"),h.length-1):null,(m=new wheelnav("contextWheelDiv",null,250,250)).colors=platformColor.wheelcolors,m.slicePathFunction=slicePath().DonutSlice,m.slicePathCustom=slicePath().DonutSliceCustomization(),m.slicePathCustom.minRadiusPercent=.2,m.slicePathCustom.maxRadiusPercent=.6,m.sliceSelectedPathCustom=m.slicePathCustom,m.sliceInitPathCustom=m.slicePathCustom,m.clickModeRotate=!1,m.initWheel(h),m.createWheel(),m.navItems[0].setTooltip(_("Duplicate")),m.navItems[1].setTooltip(_("Extract")),m.navItems[2].setTooltip(_("Move to trash")),m.navItems[3].setTooltip(_("Close")),["customsample","temperament1","definemode","show","turtleshell","action"].includes(e.blocks.blockList[r].name)&&m.navItems[4].setTooltip(_("Save stack")),null!==u&&m.navItems[u].setTooltip(_("Help")),m.navItems[0].selected=!1,m.navItems[0].navigateFunction=function(){"customsample"===e.blocks.blockList[r].name?a.activity.errorMsg(_("In order to copy a sample, you must reload the widget, import the sample again, and export it.")):function t(){a.blocks.activeBlock=n,a.blocks.prepareStackForCopy(),a.blocks.pasteDx=l,a.blocks.pasteDy=i,a.blocks.pasteStack(),l+=21,i+=21,a.activity.helpfulWheelItems.forEach(function(e){"Paste previous stack"===e.label&&(e.display=!0,e.fn=t.bind(a))})}()},m.navItems[1].navigateFunction=function(){a.blocks.activeBlock=n,a.blocks.extract(),docById("contextWheelDiv").style.display="none"},m.navItems[2].navigateFunction=function(){a.blocks.activeBlock=n,a.blocks.extract(),a.blocks.sendStackToTrash(a.blocks.blockList[n]),docById("contextWheelDiv").style.display="none",activity.textMsg(_("You can restore deleted blocks from the trash with the Restore From Trash button."),3e3)},m.navItems[3].navigateFunction=function(){docById("contextWheelDiv").style.display="none"},document.body.addEventListener("click",function(e){var t=document.getElementById("contextWheelDiv");"block"===window.getComputedStyle(t).display&&(t.style.display="none")}),["customsample","temperament1","definemode","show","turtleshell","action"].includes(e.name)&&(m.navItems[4].navigateFunction=function(){a.blocks.activeBlock=n,a.blocks.prepareStackForCopy(),a.blocks.saveStack()}),null!==u&&(m.navItems[u].navigateFunction=function(){a.blocks.activeBlock=n,new HelpWidget(a,!0),docById("contextWheelDiv").style.display="none"}),setTimeout(function(){a.blocks.stageClick=!1},500))},piemenuGrid=function(l){var e;docById("wheelDivptm").style.display="none";var t,i,a=l.turtles.gridButton.getBoundingClientRect().x,n=l.turtles.gridButton.getBoundingClientRect().y;docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="400px",docById("wheelDivptm").style.width="400px",docById("wheelDivptm").style.left=Math.min(l.turtles._canvas.width-200,Math.max(0,a*l.getStageScale()))-350+"px",docById("wheelDivptm").style.top=Math.min(l.turtles._canvas.height-250,Math.max(0,n*l.getStageScale()))+"px",docById("wheelDivptm").style.display="",i=_THIS_IS_TURTLE_BLOCKS_?(t=["imgsrc: images/grid/blank.svg","imgsrc: images/grid/Cartesian.svg","imgsrc: images/grid/Cartesian polar.svg","imgsrc: images/grid/Polar.svg",""],["Blank","Cartesian","Cartesian/Polar","Polar","Blank"]):(t=["imgsrc: images/grid/blank.svg","imgsrc: images/grid/Cartesian.svg","imgsrc: images/grid/Cartesian polar.svg","imgsrc: images/grid/Polar.svg","imgsrc: images/grid/Treble.svg","imgsrc: images/grid/Grand.svg","imgsrc: images/grid/Mezzo-soprano.svg","imgsrc: images/grid/Alto.svg","imgsrc: images/grid/Tenor.svg","imgsrc: images/grid/Bass.svg"],["Blank","Cartesian","Cartesian/Polar","Polar","Treble","Grand","Mezzo Soprano","Alto","Tenor","Bass"]),l.turtles.gridWheel=new wheelnav("wheelDivptm",null,300,300),l.turtles._exitWheel=new wheelnav("_exitWheel",l.turtles.gridWheel.raphael),l.turtles.gridWheel.keynavigateEnabled=!1,l.turtles.gridWheel.slicePathFunction=slicePath().DonutSlice,l.turtles.gridWheel.slicePathCustom=slicePath().DonutSliceCustomization(),l.turtles.gridWheel.colors=platformColor.gridWheelcolors.wheel,l.turtles.gridWheel.slicePathCustom.minRadiusPercent=.3,l.turtles.gridWheel.slicePathCustom.maxRadiusPercent=1,l.turtles.gridWheel.sliceSelectedPathCustom=l.turtles.gridWheel.slicePathCustom,l.turtles.gridWheel.sliceInitPathCustom=l.turtles.gridWheel.slicePathCustom,l.turtles.gridWheel.animatetime=0,l.turtles.gridWheel.clickModeRotate=!0;var o=platformColor.gridWheelcolors.selected,s=o.fill,c=o.stroke;l.turtles.gridWheel.sliceHoverAttr={fill:s,stroke:c,"stroke-width":2},l.turtles.gridWheel.sliceSelectedAttr={fill:s,stroke:c,"stroke-width":2},l.turtles.gridWheel.clockwise=!1,l.turtles.gridWheel.initWheel(t),l.turtles.gridWheel.createWheel();var h=null!==(e=l.turtles.currentGrid)&&void 0!==e?e:0;l.turtles.gridWheel.navigateWheel(h);for(var r=0;r<i.length;r++)!function(e){l.turtles.gridWheel.navItems[e].navigateFunction=function(){l.hideGrids(),l.turtles.currentGrid=e,l.turtles.doGrid(e)},l.turtles.gridWheel.navItems[e].setTooltip(i[e])}(r);l.turtles._exitWheel.colors=platformColor.exitWheelcolors,l.turtles._exitWheel.slicePathFunction=slicePath().DonutSlice,l.turtles._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),l.turtles._exitWheel.slicePathCustom.minRadiusPercent=0,l.turtles._exitWheel.slicePathCustom.maxRadiusPercent=.3,l.turtles._exitWheel.sliceSelectedPathCustom=l.turtles._exitWheel.slicePathCustom,l.turtles._exitWheel.sliceInitPathCustom=l.turtles._exitWheel.slicePathCustom,l.turtles._exitWheel.clickModeRotate=!1,l.turtles._exitWheel.createWheel(["×"," "]),l.turtles._exitWheel.navItems[0].navigateFunction=function(){u(l)},"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none");var u=function(e){docById("wheelDivptm").style.display="none",e.turtles.gridWheel.removeWheel(),e.turtles._exitWheel.removeWheel()};document.addEventListener("mousedown",function e(t){docById("wheelDivptm").contains(t.target)||(u(l),document.removeEventListener("mousedown",e))})},piemenuKey=function(h){docById("chooseKeyDiv").style.display="block",docById("movable").style.display="block";var a=new wheelnav("chooseKeyDiv",null,1300,1300),n=new wheelnav("keyNameWheel2",a.raphael),o=["C","G","D","A","E","B/C♭","F♯/G♭","C♯/D♭","G♯/A♭","D♯/E♭","A♯/B♭","F"];wheelnav.cssMode=!0,a.slicePathFunction=slicePath().DonutSlice,a.slicePathCustom=slicePath().DonutSliceCustomization(),a.slicePathCustom.minRadiusPercent=.6,a.slicePathCustom.maxRadiusPercent=.9,a.sliceSelectedPathCustom=a.slicePathCustom,a.sliceInitPathCustom=a.slicePathCustom,a.titleRotateAngle=0,a.colors=platformColor.pitchWheelcolors,a.animatetime=0,a.createWheel(o),n.colors=platformColor.pitchWheelcolors,n.slicePathFunction=slicePath().DonutSlice,n.slicePathCustom=slicePath().DonutSliceCustomization(),n.slicePathCustom.minRadiusPercent=.9,n.slicePathCustom.maxRadiusPercent=1,n.sliceSelectedPathCustom=n.slicePathCustom,n.sliceInitPathCustom=n.slicePathCustom;for(var e,s=[],t=0;t<o.length;t++){2<o[t].length?(e=o[t].split("/"),s.push(e[0]),s.push(e[1])):(s.push(""),s.push(""))}n.navAngle=-7.45,n.animatetime=0,n.createWheel(s);var l=new wheelnav("modenameWheel",a.raphael),i=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"];l.slicePathFunction=slicePath().DonutSlice,l.slicePathCustom=slicePath().DonutSliceCustomization(),l.slicePathCustom.minRadiusPercent=.2,l.slicePathCustom.maxRadiusPercent=.6,l.sliceSelectedPathCustom=l.slicePathCustom,l.sliceInitPathCustom=l.slicePathCustom,l.titleRotateAngle=0,l.colors=platformColor.modeGroupWheelcolors,l.animatetime=0,l.createWheel(i);var c=new wheelnav("exitWheel",a.raphael);c.slicePathFunction=slicePath().DonutSlice,c.slicePathCustom=slicePath().DonutSliceCustomization(),c.slicePathCustom.minRadiusPercent=0,c.slicePathCustom.maxRadiusPercent=.2,c.sliceSelectedPathCustom=c.slicePathCustom,c.sliceInitPathCustom=c.slicePathCustom,c.titleRotateAngle=0,c.clickModeRotate=!1,c.colors=platformColor.exitWheelcolors,c.animatetime=0,c.createWheel(["×"," "]);var r=event.clientX,u=event.clientY;docById("chooseKeyDiv").style.left=r-175+"px",docById("chooseKeyDiv").style.top=u+50+"px",docById("movable").style.left=r-110+"px",docById("movable").style.top=u+400+"px";c.navItems[0].navigateFunction=function(){docById("chooseKeyDiv").style.display="none",docById("movable").style.display="none";for(var e=document.getElementsByName("movable"),t=0;t<e.length;t++)e[t].checked&&(h.KeySignatureEnv[2]="true"==e[t].value);a.removeWheel(),n.removeWheel(),l.removeWheel(),h.storage.KeySignatureEnv=h.KeySignatureEnv,function(){var e=!1,t=[];for(var l in h.blocks.blockList)"setkey2"!==h.blocks.blockList[l].name||h.blocks.blockList[l].trash||(e=!0,t.push(l));if(!e){h.blocks.findStacks();var i,a,n,o,s=h.blocks.stackList;for(var c in s.sort(),s){"start"===h.blocks.blockList[s[c]].name&&(a=h.blocks.blockList[s[c]].connections[1],n=h.KeySignatureEnv[2]?(h.blocks._makeNewBlockWithConnections("movable",0,[s[c],null,null],null,null),i=h.logo.blocks.blockList.length-1,h.blocks._makeNewBlockWithConnections("boolean",0,[i],null,null),h.blocks.blockList[i].connections[1]=h.blocks.blockList.length-1,[i,null,null,a]):[s[c],null,null,a],h.blocks._makeNewBlockWithConnections("setkey2",0,n,null,null),o=h.blocks.blockList.length-1,h.blocks.blockList[a].connections[0]=o,h.KeySignatureEnv[2]?(h.blocks.blockList[s[c]].connections[1]=i,h.blocks.blockList[i].connections[2]=o):h.blocks.blockList[s[c]].connections[1]=o,h.blocks.adjustExpandableClampBlock(),h.blocks._makeNewBlockWithConnections("notename",0,[o],null,null),h.blocks.blockList[o].connections[1]=h.blocks.blockList.length-1,h.blocks.blockList[h.blocks.blockList.length-1].value=h.KeySignatureEnv[0],h.blocks._makeNewBlockWithConnections("modename",0,[o],null,null),h.blocks.blockList[o].connections[2]=h.blocks.blockList.length-1,h.blocks.blockList[h.blocks.blockList.length-1].value=h.KeySignatureEnv[1],h.textMsg(_("You have chosen key for your pitch preview.")+h.KeySignatureEnv[0]+" "+h.KeySignatureEnv[1]))}}}()};for(var m=function(e){var t=getNote(e,4,null,e+" "+h.KeySignatureEnv[1],!1,null,null);t[0]=t[0].replace(SHARP,"#").replace(FLAT,"b");var l=h.turtles.ithTurtle(0);l.singer.instrumentNames.includes(DEFAULTVOICE)||(l.singer.instrumentNames.push(DEFAULTVOICE),h.logo.synth.createDefaultSynth(0),h.logo.synth.loadSynth(0,DEFAULTVOICE)),h.logo.synth.setMasterVolume(DEFAULTVOLUME),Singer.setSynthVolume(h.logo,0,DEFAULTVOICE,DEFAULTVOLUME),h.logo.synth.trigger(0,[t[0]+t[1]],1/12,DEFAULTVOICE,null,null)},v=function(i){a.navItems[i].navigateFunction=function(){for(var e,t,l=0;l<s.length;l++)Math.floor(l/2)!=i?n.navItems[l].navItem.hide():2<o[i].length&&n.navItems[l].navItem.show();e=a.navItems[a.selectedNavItemIndex].title,n.navigateWheel(2*a.selectedNavItemIndex),""===e?a.navigateWheel((a.selectedNavItemIndex+1)%a.navItems.length):e.length<=2&&(h.KeySignatureEnv[0]=e),h.storage.KeySignatureEnv=h.KeySignatureEnv,0<=i&&i<5||9<i&&i<12?m(h.KeySignatureEnv[0]):(t=(t=a.navItems[a.selectedNavItemIndex].title).split("/"),m(t[0]))}},d=0;d<o.length;d++)v(d);for(var W=0;W<i.length;W++)l.navItems[W].navigateFunction=function(){var e;""===(e=l.navItems[l.selectedNavItemIndex].title)?l.navigateWheel((l.selectedNavItemIndex+1)%l.navItems.length):h.KeySignatureEnv[1]=e,h.storage.KeySignatureEnv=h.KeySignatureEnv};for(var g,y=0;y<s.length;y++)n.navItems[y].navigateFunction=function(){var e;e=n.navItems[n.selectedNavItemIndex].title,h.KeySignatureEnv[0]=e,h.storage.KeySignatureEnv=h.KeySignatureEnv};void 0!==h.storage.KeySignatureEnv?(g=h.storage.KeySignatureEnv.split(","),h.KeySignatureEnv[0]=g[0],h.KeySignatureEnv[1]=g[1],h.KeySignatureEnv[2]="true"==g[2]):h.KeySignatureEnv=["C","major",!1],h.storage.KeySignatureEnv=h.KeySignatureEnv;var x=o.indexOf(h.KeySignatureEnv[0]);if(-1===x){if(-1!==(x=s.indexOf(h.KeySignatureEnv[0]))){a.navigateWheel(Math.floor(x/2)),n.navigateWheel(x);for(var p=0;p<s.length;p++)n.navItems[p].navItem.hide(),x%2==0?(n.navItems[x].navItem.show(),n.navItems[x+1].navItem.show()):(n.navItems[x].navItem.show(),n.navItems[x-1].navItem.show())}}else a.navigateWheel(x),n.navItems[2*x].navItem.hide(),n.navItems[2*x+1].navItem.hide();var b=i.indexOf(h.KeySignatureEnv[1]);-1!==b&&l.navigateWheel(b)};