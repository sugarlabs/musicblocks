"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var n=_toPrimitive(e,"string");return"symbol"==_typeof(n)?n:n+""}function _toPrimitive(e,n){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===n?String:Number)(e);var o=t.call(e,n||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupVolumeActions(c){Singer.VolumeActions=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"doCrescendo",value:function(e,n,t,o){var r=c.turtles.ithTurtle(t);for(var i in r.singer.crescendoDelta.push("crescendo"===e?n:-n),r.singer.synthVolume){var s=last(r.singer.synthVolume[i]);r.singer.synthVolume[i].push(s),void 0===r.singer.crescendoInitialVolume[i]?r.singer.crescendoInitialVolume[i]=[s]:r.singer.crescendoInitialVolume[i].push(s)}r.singer.inCrescendo.push(!0);var l,u="_crescendo_"+t;void 0!==o&&o in c.blocks.blockList?c.logo.setDispatchBlock(o,t,u):!MusicBlocks.isRun||null!==(l=Mouse.getMouseFromTurtle(r))&&l.MB.listeners.push(u);c.logo.setTurtleListener(t,u,function(){for(var e in 0===r.singer.justCounting.length&&c.logo.notation.notationEndCrescendo(t,last(r.singer.crescendoDelta)),r.singer.crescendoDelta.pop(),r.singer.synthVolume){var n=r.singer.synthVolume[e].length;r.singer.synthVolume[e][n-1]=last(r.singer.crescendoInitialVolume[e]),r.singer.crescendoInitialVolume[e].pop()}})}},{key:"setRelativeVolume",value:function(e,n,t){var o=c.turtles.ithTurtle(n);for(var r in o.singer.synthVolume){var i=last(o.singer.synthVolume[r])*(100+e)/100,i=Math.max(Math.min(i,100),-100);void 0===o.singer.synthVolume[r]?o.singer.synthVolume[r]=[i]:o.singer.synthVolume[r].push(i),o.singer.suppressOutput||Singer.setSynthVolume(c.logo,n,r,i)}0===o.singer.justCounting.length&&c.logo.notation.notationBeginArticulation(n);var s,l="_articulation_"+n;void 0!==t&&t in c.blocks.blockList?c.logo.setDispatchBlock(t,n,l):!MusicBlocks.isRun||null!==(s=Mouse.getMouseFromTurtle(o))&&s.MB.listeners.push(l);c.logo.setTurtleListener(n,l,function(){for(var e in o.singer.synthVolume)o.singer.synthVolume[e].pop(),Singer.setSynthVolume(c.logo,n,e,last(o.singer.synthVolume[e]));0===o.singer.justCounting.length&&c.logo.notation.notationEndArticulation(n)})}},{key:"setMasterVolume",value:function(e,n,t){0===(e=Math.max(Math.min(e,100),0))&&c.errorMsg(_("Setting volume to 0."),t),2===Singer.masterVolume.length&&Singer.masterVolume.pop(),Singer.masterVolume.push(e),c.turtles.ithTurtle(n).singer.suppressOutput||Singer.setMasterVolume(c.logo,e,t)}},{key:"setPanning",value:function(e,n){e=Math.max(Math.min(e,100),-100)/100;var t=c.turtles.ithTurtle(n);for(var o in t.singer.panner?t.singer.panner.pan.value=e:t.singer.panner=new Tone.Panner(e).toDestination(),instruments[n])instruments[n][o].connect(t.singer.panner)}},{key:"setSynthVolume",value:function(e,n,t,o){var r=null,i=null,s=null;if(c.logo.blockList&&c.logo.blockList[o]&&(i=c.logo.blockList[o].connections[0],s=last(c.logo.blockList[o].connections)),e===DEFAULTVOICE||e===_(DEFAULTVOICE)?r=DEFAULTVOICE:"custom"!==e&&e!==_("custom")||(r="custom"),null===r)for(var l in VOICENAMES){if(VOICENAMES[l][0]===e){r=VOICENAMES[l][1];break}if(VOICENAMES[l][1]===e){r=e;break}}if(null===r)for(var u in DRUMNAMES){if(DRUMNAMES[u][0].replace("-"," ")===e){r=DRUMNAMES[u][1];break}if(DRUMNAMES[u][1].replace("-"," ")===e){r=e;break}}null===r&&(c.errorMsg(r+"not found"),r=DEFAULTVOICE);var a=c.turtles.ithTurtle(t);a.singer.instrumentNames.includes(r)||(a.singer.instrumentNames.push(r),c.logo.synth.loadSynth(t,r),void 0===a.singer.synthVolume[r]&&(a.singer.synthVolume[r]=[DEFAULTVOLUME],a.singer.crescendoInitialVolume[r]=[DEFAULTVOLUME])),a.singer.synthVolume[r].push(n),a.singer.suppressOutput||(Singer.setSynthVolume(c.logo,t,r,n),null===i&&null===s&&setTimeout(function(){c.logo.synth.trigger(0,"G4",.25,e,null,null,!1)},250))}},{key:"getSynthVolume",value:function(e,n){var t=c.turtles.ithTurtle(n);for(var o in t.singer.synthVolume)if(o===e)return last(t.singer.synthVolume[o])}},{key:"masterVolume",get:function(){return last(Singer.masterVolume)}}]),e}()}"undefined"!=typeof module&&module.exports&&(module.exports=setupVolumeActions);