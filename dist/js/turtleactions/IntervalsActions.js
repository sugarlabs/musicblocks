"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupIntervalsActions(M){Singer.IntervalsActions=function(){function e(){_classCallCheck(this,e)}function t(e){return r.apply(this,arguments)}var r;return _createClass(e,null,[{key:"GetModename",value:function(e){var t="major";for(var r in MUSICALMODES)if(r===e||_(r)===e){t=r;break}return t}},{key:"GetIntervalNumber",value:function(e){var t=M.turtles.ithTurtle(e),r=GetNotesForInterval(t),n=r.firstNote,o=r.secondNote,i=r.octave,s=Math.abs(ALLNOTESTEP[n]-ALLNOTESTEP[o]);for(ALLNOTESTEP[o]<ALLNOTESTEP[n]&&0!==i&&(s=12-s),i<0&&0!==s&&12!==s&&(s=12-s),(i<-1||0===s)&&(i=Math.abs(i));0<i;)s+=12,i--;return s}},{key:"GetCurrentInterval",value:function(e){var t=M.turtles.ithTurtle(e),r=GetNotesForInterval(t),n=r.firstNote,o=r.secondNote,i=r.octave,s=NOTENAMES.indexOf(n.substring(0,1)),l=NOTENAMES.indexOf(o.substring(0,1)),u="",a=Math.abs(l-s);l<s&&0!==i&&(a=NOTENAMES.length-a);var c=this.GetIntervalNumber(e),g=[_("one"),_("two"),_("three"),_("four"),_("five"),_("six"),_("seven"),_("eight"),_("nine")],v=1<Math.abs(i)?_("octaves"):_("octave"),f=g[Math.abs(i)-1]||Math.abs(i);if(c%12==0&&0===a){if(i<0){-1===i&&(f="");var p=f+" "+_("perfect")+" "+v+" "+_("below");return p.charAt(0).toUpperCase()+p.slice(1)}if(1<i){var h=f+" "+_("perfect")+" "+v+" "+_("above");return h.charAt(0).toUpperCase()+h.slice(1)}}if(21<c)for(1<=i&&(u=", "+_("plus")+" "+f+" "+v);12<c;)c-=12;return i<0&&(a=0!==a?NOTENAMES.length-a:a,i<-1&&(u=",  ".concat(f," ").concat(v)),u+=" ",u+=_("below")),c%12==0&&0===a?SEMITONETOINTERVALMAP[c][a]:SEMITONETOINTERVALMAP[c][a]+u}},{key:"setKey",value:function(e,t,r){var n=Singer.IntervalsActions.GetModename(t),o=M.turtles.ithTurtle(r),i=getNote(e,4,o.singer.transposition,o.singer.keySignature,!1,null,M.errorMsg,M.logo.synth.inTemperament);o.singer.keySignature=i[0]+" "+n,M.logo.notation.notationKey(r,i[0],n)}},{key:"getCurrentKey",value:function(e){return M.turtles.ithTurtle(e).singer.keySignature.split(" ")[0]}},{key:"getCurrentMode",value:function(e){return M.turtles.ithTurtle(e).singer.keySignature.split(" ")[1]}},{key:"getModeLength",value:(r=function(e){return getModeLength(M.turtles.ithTurtle(e).singer.keySignature)},t.toString=function(){return r.toString()},t)},{key:"setMovableDo",value:function(e,t){M.turtles.ithTurtle(t).singer.movable=e}},{key:"defineMode",value:function(e,t,n){var o,i=M.turtles.ithTurtle(t);i.singer.inDefineMode=!0,i.singer.defineMode=[],o=null===e?(M.errorMsg(NOINPUTERRORMSG,n),"custom"):e.toLowerCase();var r,s="_definemode_"+t;void 0!==n&&n in M.blocks.blockList?M.logo.setDispatchBlock(n,t,s):!MusicBlocks.isRun||null!==(r=Mouse.getMouseFromTurtle(i))&&r.MB.listeners.push(s);M.logo.setTurtleListener(t,s,function(){MUSICALMODES[o]=[],i.singer.defineMode.includes(0)||(i.singer.defineMode.push(0),M.errorMsg(_("Adding missing pitch number 0.")));for(var e=i.singer.defineMode.sort(function(e,t){return e[0]-t[0]}),t=0;t<e.length;t++)e[t]<0||11<e[t]?M.errorMsg(_("Ignoring pitch numbers less than zero or greater than eleven.")):0<t&&e[t]===e[t-1]?M.errorMsg(_("Ignoring duplicate pitch numbers.")):t<e.length-1?MUSICALMODES[o].push(e[t+1]-e[t]):MUSICALMODES[o].push(12-e[t]);var r=M.blocks.blockList[n].connections[1];"text"===M.blocks.blockList[r].name&&M.blocks.updateBlockText(r),i.singer.inDefineMode=!1})}},{key:"setScalarInterval",value:function(e,t,r){var n=e;null!==n&&"number"==typeof n||(M.errorMsg(NOINPUTERRORMSG,r),n=1);var o=M.turtles.ithTurtle(t),i=0<n?Math.floor(n):Math.ceil(n);o.singer.intervals.push(i);var s,l="_interval_"+t;void 0!==r&&r in M.blocks.blockList?M.logo.setDispatchBlock(r,t,l):!MusicBlocks.isRun||null!==(s=Mouse.getMouseFromTurtle(o))&&s.MB.listeners.push(l);M.logo.setTurtleListener(t,l,function(){return o.singer.intervals.pop()})}},{key:"setChordInterval",value:function(e,t,r){var n=e;null===n&&(M.errorMsg(NOINPUTERRORMSG,r),n=[1,0]);var o=M.turtles.ithTurtle(t);o.singer.chordIntervals.push(n);var i,s="_chord_interval_"+t;void 0!==r&&r in M.blocks.blockList?M.logo.setDispatchBlock(r,t,s):!MusicBlocks.isRun||null!==(i=Mouse.getMouseFromTurtle(o))&&i.MB.listeners.push(s);M.logo.setTurtleListener(t,s,function(){return o.singer.chordIntervals.pop()})}},{key:"setSemitoneInterval",value:function(e,t,r){var n=e;null!==n&&"number"==typeof n||(M.errorMsg(NOINPUTERRORMSG,r),n=1);var o,i,s=M.turtles.ithTurtle(t),l=0<n?Math.floor(n):Math.ceil(n);0!==l&&(s.singer.semitoneIntervals.push([l,s.singer.noteDirection]),o="_semitone_interval_"+t,void(s.singer.noteDirection=0)!==r&&r in M.blocks.blockList?M.logo.setDispatchBlock(r,t,o):!MusicBlocks.isRun||null!==(i=Mouse.getMouseFromTurtle(s))&&i.MB.listeners.push(o),M.logo.setTurtleListener(t,o,function(){return s.singer.semitoneIntervals.pop()}))}},{key:"setRatioInterval",value:function(e,t,r){var n=e;null!==n&&"number"==typeof n||(M.errorMsg(NOINPUTERRORMSG,r),n=1);var o=M.turtles.ithTurtle(t);o.singer.ratioIntervals.push(e);var i,s="_ratio_interval_"+t;void 0!==r&&r in M.blocks.blockList?M.logo.setDispatchBlock(r,t,s):!MusicBlocks.isRun||null!==(i=Mouse.getMouseFromTurtle(o))&&i.MB.listeners.push(s);M.logo.setTurtleListener(t,s,function(){return o.singer.ratioIntervals.pop()})}},{key:"setTemperament",value:function(e,t,r){M.logo.synth.inTemperament=e,M.logo.synth.startingPitch=t+""+r,M.logo.temperamentSelected.push(e);var n=M.logo.temperamentSelected.length;M.logo.temperamentSelected[n-1]!==M.logo.temperamentSelected[n-2]&&(M.logo.synth.changeInTemperament=!0)}}]),e}()}