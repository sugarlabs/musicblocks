"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var i=n.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupRhythmActions(v){Singer.RhythmActions=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"playNote",value:function(e,t,n,i,s){var r,o,l,g=v.turtles.ithTurtle(n);if(0===g.singer.inNoteBlock.length){g.singer.notesPlayed[0]/g.singer.notesPlayed[1]<g.singer.pickup?o=l=0:(o=1+(r=g.singer.noteValuePerBeat*(g.singer.notesPlayed[0]/g.singer.notesPlayed[1]-g.singer.pickup))%g.singer.beatsPerMeasure,l=1+Math.floor(r/g.singer.beatsPerMeasure)),g.singer.currentBeat=o,g.singer.currentMeasure=l;var a=g.id;g.singer.beatList.includes("everybeat")&&(s(),v.stage.dispatchEvent("__everybeat_"+a+"__")),g.singer.beatList.includes(o)?(s(),v.stage.dispatchEvent("__beat_"+o+"_"+a+"__")):1<o&&g.singer.beatList.includes("offbeat")&&(s(),v.stage.dispatchEvent("__offbeat_"+a+"__"));for(var u,c=o+g.singer.beatsPerMeasure*(g.singer.currentMeasure-1),p=0;p<g.singer.factorList.length;p++){c%g.singer.factorList[p]==0&&(s(),u="__beat_"+g.singer.factorList[p]+"_"+a+"__",v.stage.dispatchEvent(u))}}v.logo.clearNoteParams(g,i,[]);var h="newnote"===t?1/e:e;g.singer.inNoteBlock.push(i),g.singer.multipleVoices=1<g.singer.inNoteBlock.length,g.singer.noteValue[last(g.singer.inNoteBlock)]=1/(h*g.singer.beatFactor);var k,d="_playnote_"+n;void 0!==i&&i in v.blocks.blockList?v.logo.setDispatchBlock(i,n,d):!MusicBlocks.isRun||null!==(k=Mouse.getMouseFromTurtle(g))&&k.MB.listeners.push(d);v.logo.setTurtleListener(n,d,function(){var e;g.singer.multipleVoices&&v.logo.notation.notationVoices(n,g.singer.inNoteBlock.length),0<g.singer.inNoteBlock.length&&(0<g.singer.inNeighbor.length&&(g.singer.neighborArgBeat.push(g.singer.beatFactor*(1/g.singer.neighborNoteValue)),e=1/h-2*g.singer.neighborNoteValue,g.singer.neighborArgCurrentBeat.push(g.singer.beatFactor*(1/e))),Singer.processNote(v,1/g.singer.noteValue[last(g.singer.inNoteBlock)],"osctime"===t,last(g.singer.inNoteBlock),n)),delete g.singer.oscList[last(g.singer.inNoteBlock)],delete g.singer.noteBeat[last(g.singer.inNoteBlock)],delete g.singer.noteBeatValues[last(g.singer.inNoteBlock)],delete g.singer.noteValue[last(g.singer.inNoteBlock)],delete g.singer.notePitches[last(g.singer.inNoteBlock)],delete g.singer.noteOctaves[last(g.singer.inNoteBlock)],delete g.singer.noteCents[last(g.singer.inNoteBlock)],delete g.singer.noteHertz[last(g.singer.inNoteBlock)],delete g.singer.noteDrums[last(g.singer.inNoteBlock)],delete g.singer.embeddedGraphics[last(g.singer.inNoteBlock)],g.singer.inNoteBlock.splice(-1,1),g.singer.multipleVoices&&0===g.singer.inNoteBlock.length&&(v.logo.notation.notationVoices(n,0),g.singer.multipleVoices=!1),v.logo.pitchBlocks=[],v.logo.drumBlocks=[]})}},{key:"playRest",value:function(e){var t=v.turtles.ithTurtle(e);0<t.singer.inNoteBlock.length&&(t.singer.notePitches[last(t.singer.inNoteBlock)].push("rest"),t.singer.noteOctaves[last(t.singer.inNoteBlock)].push(4),t.singer.noteCents[last(t.singer.inNoteBlock)].push(0),t.singer.noteHertz[last(t.singer.inNoteBlock)].push(0),t.singer.noteBeatValues[last(t.singer.inNoteBlock)].push(t.singer.beatFactor),t.singer.pushedNote=!0)}},{key:"doRhythmicDot",value:function(n,e,t){var i=v.turtles.ithTurtle(e),s=2-1/Math.pow(2,i.singer.dotCount);i.singer.beatFactor*=s,0<=n?i.singer.dotCount+=n:-1===n?(v.errorMsg(_("An argument of -1 results in a note value of 0."),t),n=0):i.singer.dotCount+=1/n;var r=2-1/Math.pow(2,i.singer.dotCount);i.singer.beatFactor/=r;var o,l="_dot_"+e;void 0!==t&&t in v.blocks.blockList?v.logo.setDispatchBlock(t,e,l):!MusicBlocks.isRun||null!==(o=Mouse.getMouseFromTurtle(i))&&o.MB.listeners.push(l);v.logo.setTurtleListener(e,l,function(){var e=2-1/Math.pow(2,i.singer.dotCount);i.singer.beatFactor*=e,i.singer.dotCount-=0<=n?n:1/n;var t=2-1/Math.pow(2,i.singer.dotCount);i.singer.beatFactor/=t})}},{key:"doTie",value:function(o,e){var l=v.turtles.ithTurtle(o);l.singer.tie=!0,l.singer.tieNotePitches=[],l.singer.tieNoteExtras=[],l.singer.tieCarryOver=0,l.singer.tieFirstDrums=[];var t,n="_tie_"+o;void 0!==e&&e in v.blocks.blockList?v.logo.setDispatchBlock(e,o,n):!MusicBlocks.isRun||null!==(t=Mouse.getMouseFromTurtle(l))&&t.MB.listeners.push(n);v.logo.setTurtleListener(o,n,function(){if(l.singer.tie=!1,0<l.singer.tieCarryOver){if(0===l.singer.justCounting.length){var e=last(l.singer.inNoteBlock);if(null!=e&&e in l.singer.notePitches)for(var t=0;t<l.singer.notePitches[last(l.singer.inNoteBlock)].length;t++)v.logo.notation.notationRemoveTie(o)}var n=l.singer.tieNoteExtras[0],i=l.singer.tieCarryOver;l.singer.tieCarryOver=0,l.singer.inNoteBlock.push(n),l.singer.notePitches[n]=[],l.singer.noteOctaves[n]=[],l.singer.noteCents[n]=[],l.singer.noteHertz[n]=[];for(var s=0;s<l.singer.tieNotePitches.length;s++)l.singer.notePitches[n].push(l.singer.tieNotePitches[s][0]),l.singer.noteOctaves[n].push(l.singer.tieNotePitches[s][1]),l.singer.noteCents[n].push(l.singer.tieNotePitches[s][2]),l.singer.noteHertz[n].push(l.singer.tieNotePitches[s][3]);l.singer.oscList[n]=l.singer.tieNoteExtras[1],l.singer.noteBeat[n]=l.singer.tieNoteExtras[2],l.singer.noteBeatValues[n]=l.singer.tieNoteExtras[3],l.singer.noteDrums[n]=l.singer.tieNoteExtras[4],l.singer.embeddedGraphics[n]=[],Singer.processNote(v,i,"osctime"===v.blocks.blockList[n].name,n,o);var r=0<TONEBPM/l.singer.bpm.length?last(l.singer.bpm):Singer.masterBPM;l.doWait(r/i),l.singer.inNoteBlock.pop(),delete l.singer.notePitches[n],delete l.singer.noteOctaves[n],delete l.singer.noteCents[n],delete l.singer.noteHertz[n],delete l.singer.oscList[n],delete l.singer.noteBeat[n],delete l.singer.noteBeatValues[n],delete l.singer.noteDrums[n],delete l.singer.embeddedGraphics[n],v.logo.notation.notationStaging[o].pop()}l.singer.tieNotePitches=[],l.singer.tieNoteExtras=[]})}},{key:"multiplyNoteValue",value:function(e,t,n){var i=v.turtles.ithTurtle(t);i.singer.beatFactor/=e;var s,r="_multiplybeat_"+t;void 0!==n&&n in v.blocks.blockList?v.logo.setDispatchBlock(n,t,r):!MusicBlocks.isRun||null!==(s=Mouse.getMouseFromTurtle(i))&&s.MB.listeners.push(r);v.logo.setTurtleListener(t,r,function(){return i.singer.beatFactor*=e})}},{key:"addSwing",value:function(e,t,n,i){var s=v.turtles.ithTurtle(n);s.singer.suppressOutput?v.logo.notation.notationSwing(n):(s.singer.swing.push(1/e),s.singer.swingTarget.push(1/t));var r,o="_swing_"+n;void(s.singer.swingCarryOver=0)!==i&&i in v.blocks.blockList?v.logo.setDispatchBlock(i,n,o):!MusicBlocks.isRun||null!==(r=Mouse.getMouseFromTurtle(s))&&r.MB.listeners.push(o);v.logo.setTurtleListener(n,o,function(){s.singer.suppressOutput||(s.singer.swingTarget.pop(),s.singer.swing.pop()),s.singer.swingCarryOver=0})}},{key:"getNoteValue",value:function(e){var t=v.turtles.ithTurtle(e),n=0;return 0!==(n=null!==t.singer.noteValue[last(t.singer.inNoteBlock)]&&void 0!==t.singer.noteValue[last(t.singer.inNoteBlock)]?0!==t.singer.noteValue[last(t.singer.inNoteBlock)]?1/t.singer.noteValue[last(t.singer.inNoteBlock)]:0:null!==t.singer.lastNotePlayed?t.singer.lastNotePlayed[1]:void 0!==t.singer.notePitches[last(t.singer.inNoteBlock)]&&0<t.singer.notePitches[last(t.singer.inNoteBlock)].length?t.singer.noteBeat[last(t.singer.inNoteBlock)]:0)?1/n:0}}]),e}()}