"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=Array(e);i<e;i++)o[i]=t[i];return o}var setupDictActions=require("../DictActions");describe("setupDictActions",function(){var i,r,c;beforeAll(function(){global.Turtle={DictActions:{}},global._=jest.fn(function(t){return t}),global.Singer={RhythmActions:{getNoteValue:jest.fn().mockReturnValue(4)}},global.getNote=jest.fn().mockReturnValue(["G",4]),global.pitchToNumber=jest.fn().mockReturnValue(60),global.INVALIDPITCH="Invalid pitch",global.getTargetTurtle=jest.fn()}),beforeEach(function(){i={turtles:{ithTurtle:jest.fn(),screenX2turtleX:jest.fn(),screenY2turtleY:jest.fn()},logo:{turtleDicts:{},synth:{inTemperament:"equal"}},textMsg:jest.fn(),errorMsg:jest.fn()},r=0,c={painter:{color:"red",value:10,chroma:.5,pensize:2,stroke:2,font:"Arial",orientation:90,turtle:{orientation:90},doSetColor:jest.fn(),doSetValue:jest.fn(),doSetChroma:jest.fn(),doSetPensize:jest.fn(),doSetFont:jest.fn(),doSetHeading:jest.fn(),doSetXY:jest.fn()},container:{x:100,y:200},singer:{notesPlayed:[1,2],lastNotePlayed:["C4"],notePitches:["C"],noteOctaves:[4],keySignature:"C",movable:!0,pitchNumberOffset:0}},i.turtles.ithTurtle.mockReturnValue(c),i.turtles.screenX2turtleX.mockReturnValue(100),i.turtles.screenY2turtleY.mockReturnValue(200),global.getTargetTurtle.mockImplementation(function(t,e){return"target"===e?0:null}),setupDictActions(i),i.logo.turtleDicts[r]={}}),describe("_GetDict",function(){test.each([["color","red"],["shade",10],["grey",.5],["pen size",2],["font","Arial"],["heading",90],["x",100],["y",200],["notes played",.5]])("should get %s correctly",function(t,e){expect(Turtle.DictActions._GetDict(0,r,t)).toBe(e)}),it("should get the note value correctly",function(){var t=Turtle.DictActions._GetDict(0,r,"note value");expect(t).toBe(4),expect(Singer.RhythmActions.getNoteValue).toHaveBeenCalledWith(0)}),it("should get the current pitch correctly",function(){var t=Turtle.DictActions._GetDict(0,r,"current pitch");expect(t).toBe("C4")}),it("should get the pitch number correctly with lastNotePlayed",function(){var t=Turtle.DictActions._GetDict(0,r,"pitch number");expect(t).toBe(60),expect(pitchToNumber).toHaveBeenCalledWith("C",4,"C")}),it("should get the pitch number correctly using notePitches when lastNotePlayed is null",function(){c.singer.lastNotePlayed=null;var t=Turtle.DictActions._GetDict(0,r,"pitch number",1);expect(t).toBe(60),expect(getNote).toHaveBeenCalled()}),it("should handle error when getting pitch number with no notes",function(){c.singer.lastNotePlayed=null,c.singer.notePitches=[];var t=Turtle.DictActions._GetDict(0,r,"pitch number",1);expect(t).toBe(60),expect(i.errorMsg).toHaveBeenCalledWith(INVALIDPITCH,1)}),it("should return undefined for an unsupported key",function(){var t=Turtle.DictActions._GetDict(0,r,"unsupportedKey");expect(t).toBeUndefined()})}),describe("SetDictValue",function(){test.each([["color","blue","doSetColor",["blue"]],["shade",20,"doSetValue",[20]],["grey",.7,"doSetChroma",[.7]],["pen size",5,"doSetPensize",[5]],["font","Times New Roman","doSetFont",["Times New Roman"]],["heading",180,"doSetHeading",[180]],["x",150,"doSetXY",[150,200]],["y",250,"doSetXY",[100,250]]])("should set %s correctly",function(t,e,i,o){var n;Turtle.DictActions.SetDictValue(0,r,t,e),(n=expect(c.painter[i])).toHaveBeenCalledWith.apply(n,_toConsumableArray(o))})}),describe("SerializeDict",function(){it("should serialize the turtle dictionary correctly",function(){var t=Turtle.DictActions.SerializeDict(0,r),e=JSON.stringify({color:"red",shade:10,grey:.5,"pen size":2,font:"Arial",heading:90,y:200,x:100});expect(t).toBe(e)}),it("should include additional properties from turtleDicts",function(){i.logo.turtleDicts[r]={0:{custom:"value"}};var t=Turtle.DictActions.SerializeDict(0,r),e=JSON.stringify({color:"red",shade:10,grey:.5,"pen size":2,font:"Arial",heading:90,y:200,x:100,custom:"value"});expect(t).toBe(e)})}),describe("getDict",function(){it("should return serialized turtle dictionary when dict is a turtle name",function(){var t=Turtle.DictActions.getDict("target",r),e=Turtle.DictActions.SerializeDict(0,r);expect(t).toBe(e)}),it("should return empty object JSON when dict does not exist",function(){i.logo.turtleDicts[r]={};var t=Turtle.DictActions.getDict("nonexistent",r);expect(t).toBe("{}")}),it("should return dictionary JSON when dict exists",function(){i.logo.turtleDicts[r]={testDict:{key:"value"}};var t=Turtle.DictActions.getDict("testDict",r);expect(t).toBe(JSON.stringify({key:"value"}))}),it("should initialize turtleDicts when it doesn't exist for the turtle",function(){delete i.logo.turtleDicts[r];var t=Turtle.DictActions.getDict("nonexistent",r);expect(t).toBe("{}"),expect(i.logo.turtleDicts[r]).toEqual({})})}),describe("showDict",function(){it("should display the dictionary contents",function(){i.logo.turtleDicts[r]={testDict:{key:"value"}},Turtle.DictActions.showDict("testDict",r),expect(i.textMsg).toHaveBeenCalledWith(JSON.stringify({key:"value"}))}),it("should display turtle information when dict is a turtle name",function(){var t=Turtle.DictActions.SerializeDict(0,r);Turtle.DictActions.showDict("target",r),expect(i.textMsg).toHaveBeenCalledWith(t)}),it("should display empty JSON when dict name does not exist",function(){i.logo.turtleDicts[r]={},Turtle.DictActions.showDict("nonexistentDict",r),expect(i.textMsg).toHaveBeenCalledWith("{}")})}),describe("setValue",function(){it("should set value in the dictionary",function(){i.logo.turtleDicts[r]={},Turtle.DictActions.setValue("customDict","color","green",r),expect(i.logo.turtleDicts[r].customDict.color).toBe("green")}),it("should create a new dictionary if it doesn't exist",function(){i.logo.turtleDicts[r]={},Turtle.DictActions.setValue("newDict","key","value",r),expect(i.logo.turtleDicts[r].newDict.key).toBe("value")}),it("should create a new turtleDicts entry if it doesn't exist",function(){delete i.logo.turtleDicts[r],Turtle.DictActions.setValue("newDict","key","value",r),expect(i.logo.turtleDicts[r].newDict.key).toBe("value")}),it("should log to console when setting a value",function(){console.log=jest.fn(),i.logo.turtleDicts[r]={},Turtle.DictActions.setValue("testDict","key","value",r),expect(console.log).toHaveBeenCalled()})}),describe("getValue",function(){it("should return value from the dictionary",function(){i.logo.turtleDicts[r]={testDict:{key:"value"}};var t=Turtle.DictActions.getValue("testDict","key",r);expect(t).toBe("value")}),it("should return error message if dictionary does not exist",function(){i.logo.turtleDicts[r]={};var t=Turtle.DictActions.getValue("nonexistentDict","key",r);expect(t).toBe("Dictionary with this name does not exist")}),it("should return error message if key does not exist in dictionary",function(){i.logo.turtleDicts[r]={testDict:{existingKey:"value"}};var t=Turtle.DictActions.getValue("testDict","nonexistentKey",r);expect(t).toBe("Key with this name does not exist in testDict")})})});