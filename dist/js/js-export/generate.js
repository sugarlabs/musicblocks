"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,c=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){c=!0,l=e},f:function(){try{a||null==o.return||o.return()}finally{if(c)throw l}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);var r=o.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var JSGenerate=function(){function b(){_classCallCheck(this,b)}return _createClass(b,null,[{key:"generateStacksTree",value:function(){b.startBlocks=[],b.actionBlocks=[],b.startTrees=[],b.actionTrees=[],b.actionNames=[],globalActivity.blocks.findStacks();var e,t=_createForOfIteratorHelper(globalActivity.blocks.stackList);try{for(t.s();!(e=t.n()).done;){var o,r,n=e.value;"start"!==globalActivity.blocks.blockList[n].name||globalActivity.blocks.blockList[n].trash?"action"!==globalActivity.blocks.blockList[n].name||globalActivity.blocks.blockList[n].trash||(o=globalActivity.blocks.blockList[n].connections[1],r=globalActivity.blocks.blockList[n].connections[2],null!==o&&null!==r&&b.actionBlocks.push(n)):b.startBlocks.push(n)}}catch(e){t.e(e)}finally{t.f()}function l(e,t,o){void 0===o&&(o=0);for(var r,n=e.connections[e.connections.length-2-o],n=globalActivity.blocks.blockList[n];void 0!==n;){if("hidden"!==n.name&&"vspace"!==n.name&&(["storein2","nameddo"].includes(n.name)?t.push([n.name+"_"+n.privateData]):t.push([n.name]),r=function e(t){var o=t.protoblock.args;"clamp"===t.protoblock.style?--o:"doubleclamp"===t.protoblock.style&&(o-=2);for(var r=[],n=1;n<=o;n++){var l=globalActivity.blocks.blockList[t.connections[n]];if(void 0!==l)if("clamp"!==l.protoblock.style||!0!==l.protoblock._style.flows.left){for(;"hspace"===l.name;)l=globalActivity.blocks.blockList[l.connections[1]];"value"===l.protoblock.style?JSInterface.isGetter(l.name)?r.push([l.name,null]):"BooleanBlock"===l.protoblock.__proto__.__proto__.constructor.name?"boolean"===l.name?r.push("bool_"+l.value):r.push([l.name,e(l)]):"namedbox"===l.name?r.push("box_"+l.privateData):r.push(l.value):"arg"===l.protoblock.style&&r.push([l.name,e(l)])}else console.warn('CANNOT PROCESS "'.concat(l.name,'" BLOCK')),r.push(null);else r.push(null)}return r}(n),last(t).push(0===r.length?null:r),"clamp"===n.protoblock.style?last(t).push(l(n,[])):"doubleclamp"===n.protoblock.style?(last(t).push(l(n,[],1)),last(t).push(l(n,[],0))):last(t).push(null)),!(0<n.connections.length))break;if(void 0===(n=globalActivity.blocks.blockList[last(n.connections)]))break}return t}var a,c=_createForOfIteratorHelper(b.startBlocks);try{for(c.s();!(a=c.n()).done;){var i=a.value;b.startTrees.push(l(globalActivity.blocks.blockList[i],[]))}}catch(e){c.e(e)}finally{c.f()}var s,u=_createForOfIteratorHelper(b.actionBlocks);try{for(u.s();!(s=u.n()).done;){var f=s.value,y=globalActivity.blocks.blockList[globalActivity.blocks.blockList[f].connections[1]].value;null!=y&&(b.actionNames.push(y),b.actionTrees.push(l(globalActivity.blocks.blockList[f],[])))}}catch(e){u.e(e)}finally{u.f()}}},{key:"printStacksTree",value:function(){function c(e,t){void 0===t&&(t=0);var o,r=_createForOfIteratorHelper(e);try{for(r.s();!(o=r.n()).done;){for(var n=o.value,l="",a=0;a<4*t;a++)l+=" ";console.log("%c"+l+"%c"+n[0]+" : %c"+function e(t){if(null===t||0===t.length)return"none";var o,r="(",n=_createForOfIteratorHelper(t);try{for(n.s();!(o=n.n()).done;){var l=o.value;null===l?r+="null":"object"===_typeof(l)?r+=l[0]+e(l[1]):r+=l,r+=", "}}catch(e){n.e(e)}finally{n.f()}return r=r.substring(0,r.length-2)+")"}(n[1]),"background: mediumslateblue","background; none","color: dodgerblue"),null!==n[2]&&(c(n[2],t+1),4===n.length&&null!==n[3]&&(console.log("%c"+l+"** NEXTFLOW **","color: green"),c(n[3],t+1)))}}catch(e){r.e(e)}finally{r.f()}}if(0===b.startTrees.length)console.log("%cno start trees generated","color: tomato");else{var e,t=_createForOfIteratorHelper(b.startTrees);try{for(t.s();!(e=t.n()).done;){var o=e.value;console.log("\n   %c START ","background: navy; color: white; font-weight: bold"),c(o),console.log("\n")}}catch(e){t.e(e)}finally{t.f()}}if(0===b.startTrees.length)console.log("%cno action trees generated","color: tomato");else{var r,n=_createForOfIteratorHelper(b.actionTrees);try{for(n.s();!(r=n.n()).done;){var l=r.value;console.log("\n   %c ACTION ","background: green; color: white; font-weight: bold"),c(l),console.log("\n")}}catch(e){n.e(e)}finally{n.f()}}}},{key:"generateCode",value:function(){b.generateFailed=!1,b.AST=JSON.parse(JSON.stringify(ASTUtils.BAREBONE_AST));try{for(var e=0;e<b.actionTrees.length;e++)b.AST.body.splice(e,0,ASTUtils.getMethodAST(b.actionNames[e],b.actionTrees[e]));for(var t=b.actionTrees.length,o=0;o<b.startTrees.length;o++)b.AST.body.splice(o+t,0,ASTUtils.getMouseAST(b.startTrees[o]))}catch(e){b.generateFailed=!0,console.error("CANNOT GENERATE ABSTRACT SYNTAX TREE\nError:",e)}if(!b.generateFailed)try{b.code=astring.generate(b.AST,{indent:"    "})}catch(e){b.generateFailed=!0,console.error("CANNOT GENERATE CODE\nError: INVALID ABSTRACT SYNTAX TREE")}var r;b.generateFailed&&((r=JSON.parse(JSON.stringify(ASTUtils.BAREBONE_AST))).body.splice(0,0,ASTUtils.getMouseAST([])),b.code=astring.generate(r))}},{key:"run",value:function(e,t){b.generateStacksTree(),e&&(console.log("\n   %c STACK TREES ","background: greenyellow; color: midnightblue; font-weight: bold"),b.printStacksTree()),b.generateCode(),e&t&&console.log("%c _______________________________________","color: darkorange"),t&&(console.log("\n   %c CODE ","background: greenyellow; color: midnightblue; font-weight: bold"),console.log(b.code))}}]),b}();_defineProperty(JSGenerate,"startBlocks",[]),_defineProperty(JSGenerate,"actionBlocks",[]),_defineProperty(JSGenerate,"startTrees",[]),_defineProperty(JSGenerate,"actionTrees",[]),_defineProperty(JSGenerate,"actionNames",[]),_defineProperty(JSGenerate,"AST",{}),_defineProperty(JSGenerate,"code",""),_defineProperty(JSGenerate,"generateFailed",!1),"undefined"!=typeof module&&module.exports&&(module.exports={JSGenerate:JSGenerate});