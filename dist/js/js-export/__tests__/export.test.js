"use strict";function asyncGeneratorStep(e,t,n,o,s,u,r){try{var l=e[u](r),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(o,s)}function _asyncToGenerator(l){return function(){var e=this,r=arguments;return new Promise(function(t,n){var o=l.apply(e,r);function s(e){asyncGeneratorStep(o,t,n,s,u,"next",e)}function u(e){asyncGeneratorStep(o,t,n,s,u,"throw",e)}s(void 0)})}}var _require=require("../export.js"),Mouse=_require.Mouse,MusicBlocks=_require.MusicBlocks;global.importMembers=jest.fn(),global.JSInterface={validateArgs:jest.fn(function(e,t){return t})},global.Painter={prototype:{method1:jest.fn(),method2:jest.fn()}};var JSEditor={logConsole:jest.fn()};global.JSEditor=JSEditor;var globalActivity={turtles:{getTurtleCount:jest.fn(),getTurtle:jest.fn(),addTurtle:jest.fn(),getIndexOfTurtle:jest.fn(),removeTurtle:jest.fn(),screenX2turtleX:jest.fn(),screenY2turtleY:jest.fn()},logo:{prepSynths:jest.fn(),firstNoteTime:null,stage:{removeEventListener:jest.fn()}},textMsg:jest.fn(),stage:{dispatchEvent:jest.fn()}};global.globalActivity=globalActivity,global.Singer={RhythmActions:{getNoteValue:jest.fn()},MeterActions:{setPickup:jest.fn(),getWholeNotesPlayed:jest.fn(),getBeatCount:jest.fn(),getMeasureCount:jest.fn(),getBPM:jest.fn(),getBeatFactor:jest.fn(),getCurrentMeter:jest.fn()},PitchActions:{deltaPitch:jest.fn(),consonantStepSize:jest.fn()},IntervalsActions:{setMovableDo:jest.fn(),getCurrentKey:jest.fn(),getCurrentMode:jest.fn(),getModeLength:jest.fn()},VolumeActions:{setPanning:jest.fn(),setMasterVolume:jest.fn(),masterVolume:1}},describe("Mouse Class",function(){var t,e=jest.fn();beforeEach(function(){globalActivity.turtles.getTurtleCount.mockReturnValue(1),globalActivity.turtles.getTurtle.mockReturnValue({id:1,initTurtle:jest.fn(),doWait:jest.fn()}),t=new Mouse(e)}),test("should create a new Mouse instance",function(){expect(t).toBeInstanceOf(Mouse),expect(Mouse.MouseList).toContain(t),expect(Mouse.TurtleMouseMap[1]).toBe(t)}),test("should get Mouse from Turtle",function(){var e=Mouse.getMouseFromTurtle({id:1});expect(e).toBe(t)}),test("should return null if Turtle is not in map",function(){var e=Mouse.getMouseFromTurtle({id:2});expect(e).toBeNull()}),test("should run the flow",function(){t.run(),expect(t.turtle.doWait).toHaveBeenCalledWith(0),expect(e).toHaveBeenCalledWith(t.MB)})}),describe("MusicBlocks Class",function(){var n,e;beforeEach(function(){globalActivity.turtles.getTurtleCount.mockReturnValue(1),globalActivity.turtles.getTurtle.mockReturnValue({id:1,initTurtle:jest.fn(),doWait:jest.fn(),container:{x:10,y:20}}),(e=new Mouse(jest.fn())).run=jest.fn(),n=new MusicBlocks(e)}),test("should create a new MusicBlocks instance",function(){expect(n).toBeInstanceOf(MusicBlocks),expect(n.mouse).toBe(e),expect(n.turtle).toBe(e.turtle)}),test("should run all mice",function(){Mouse.MouseList.push(e),MusicBlocks.run(),expect(globalActivity.logo.prepSynths).toHaveBeenCalled(),expect(e.run).toHaveBeenCalled()}),test("should handle ENDFLOW",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.ENDFLOW;case 2:t=e.sent,expect(t).toBeUndefined();case 4:case"end":return e.stop()}},e)}))),test("should handle ENDFLOWCOMMAND",_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.turtle.waitTime=100,n.turtle.doWait=jest.fn(),n.listeners.push("testSignal"),e.next=5,n.ENDFLOWCOMMAND;case 5:expect(globalActivity.stage.dispatchEvent).toHaveBeenCalledWith("testSignal"),expect(n.turtle.doWait).toHaveBeenCalledWith(0);case 7:case"end":return e.stop()}},e)}))),test("should print a message",function(){n.print("test message"),expect(JSEditor.logConsole).toHaveBeenCalled(),expect(globalActivity.textMsg).toHaveBeenCalledWith("test message")}),test("should handle undefined message",function(){n.print(void 0),expect(globalActivity.textMsg).toHaveBeenCalledWith("undefined")}),test("should handle null message",function(){n.print(null),expect(globalActivity.textMsg).toHaveBeenCalledWith("null")}),test("should get X coordinate",function(){globalActivity.turtles.screenX2turtleX.mockReturnValue(10),expect(n.X).toBe(10)}),test("should get Y coordinate",function(){globalActivity.turtles.screenY2turtleY.mockReturnValue(20),expect(n.Y).toBe(20)}),test("should get HEADING",function(){n.turtle.orientation=90,expect(n.HEADING).toBe(90)}),test("should get PENSIZE",function(){n.turtle.painter={stroke:5},expect(n.PENSIZE).toBe(5)}),test("should get COLOR",function(){n.turtle.painter={color:"red"},expect(n.COLOR).toBe("red")}),test("should get SHADE",function(){n.turtle.painter={value:50},expect(n.SHADE).toBe(50)}),test("should get GREY",function(){n.turtle.painter={chroma:75},expect(n.GREY).toBe(75)}),test("should get NOTEVALUE",function(){Singer.RhythmActions.getNoteValue.mockReturnValue(1),expect(n.NOTEVALUE).toBe(1)}),test("should set PICKUP",function(){n.PICKUP=2,expect(Singer.MeterActions.setPickup).toHaveBeenCalledWith(2,n.turIndex)}),test("should get WHOLENOTESPLAYED",function(){Singer.MeterActions.getWholeNotesPlayed.mockReturnValue(4),expect(n.WHOLENOTESPLAYED).toBe(4)}),test("should get BEATCOUNT",function(){Singer.MeterActions.getBeatCount.mockReturnValue(16),expect(n.BEATCOUNT).toBe(16)}),test("should get MEASURECOUNT",function(){Singer.MeterActions.getMeasureCount.mockReturnValue(4),expect(n.MEASURECOUNT).toBe(4)}),test("should get BPM",function(){Singer.MeterActions.getBPM.mockReturnValue(120),expect(n.BPM).toBe(120)}),test("should get BEATFACTOR",function(){Singer.MeterActions.getBeatFactor.mockReturnValue(1.5),expect(n.BEATFACTOR).toBe(1.5)}),test("should get CURRENTMETER",function(){Singer.MeterActions.getCurrentMeter.mockReturnValue("4/4"),expect(n.CURRENTMETER).toBe("4/4")}),test("should get SCALARCHANGEINPITCH",function(){Singer.PitchActions.deltaPitch.mockReturnValue(2),expect(n.SCALARCHANGEINPITCH).toBe(2)}),test("should get CHANGEINPITCH",function(){Singer.PitchActions.deltaPitch.mockReturnValue(1),expect(n.CHANGEINPITCH).toBe(1)}),test("should get SCALARSTEPUP",function(){Singer.PitchActions.consonantStepSize.mockReturnValue(1),expect(n.SCALARSTEPUP).toBe(1)}),test("should get SCALARSTEPDOWN",function(){Singer.PitchActions.consonantStepSize.mockReturnValue(-1),expect(n.SCALARSTEPDOWN).toBe(-1)}),test("should set MOVABLEDO",function(){n.MOVABLEDO=!0,expect(Singer.IntervalsActions.setMovableDo).toHaveBeenCalledWith(!0,n.turIndex)}),test("should get CURRENTKEY",function(){Singer.IntervalsActions.getCurrentKey.mockReturnValue("C"),expect(n.CURRENTKEY).toBe("C")}),test("should get CURRENTMODE",function(){Singer.IntervalsActions.getCurrentMode.mockReturnValue("major"),expect(n.CURRENTMODE).toBe("major")}),test("should get MODELENGTH",function(){Singer.IntervalsActions.getModeLength.mockReturnValue(7),expect(n.MODELENGTH).toBe(7)}),test("should set PANNING",function(){n.PANNING=.5,expect(Singer.VolumeActions.setPanning).toHaveBeenCalledWith(.5,n.turIndex)}),test("should set MASTERVOLUME",function(){n.MASTERVOLUME=.8,expect(Singer.VolumeActions.setMasterVolume).toHaveBeenCalledWith(.8,n.turIndex)}),test("should get MASTERVOLUME",function(){expect(n.MASTERVOLUME).toBe(1)})});