"use strict";var _require=require("../generate"),JSGenerate=_require.JSGenerate;global.last=jest.fn(function(e){return e[e.length-1]});var globalActivity={blocks:{stackList:[],blockList:{},findStacks:jest.fn()}};global.globalActivity=globalActivity,global.console={log:jest.fn(),error:jest.fn(),warn:jest.fn()};var ASTUtils={BAREBONE_AST:{type:"Program",body:[]},getMethodAST:jest.fn(),getMouseAST:jest.fn()},astring={generate:jest.fn()};global.ASTUtils=ASTUtils,global.astring=astring,describe("JSGenerate Class",function(){beforeEach(function(){jest.clearAllMocks(),JSGenerate.startBlocks=[],JSGenerate.actionBlocks=[],JSGenerate.startTrees=[],JSGenerate.actionTrees=[],JSGenerate.actionNames=[],JSGenerate.AST={type:"Program",body:[]},JSGenerate.code="",JSGenerate.generateFailed=!1}),test("should generate correct AST structure",function(){JSGenerate.actionTrees=[[["action",null,null]]],JSGenerate.actionNames=["action1"],JSGenerate.startTrees=[[["start",null,null]]];ASTUtils.getMethodAST.mockReturnValue({type:"Method"}),ASTUtils.getMouseAST.mockReturnValue({type:"Mouse"}),astring.generate.mockReturnValue("generated code"),JSGenerate.generateCode(),expect(JSGenerate.AST).toEqual({type:"Program",body:[{type:"Method"},{type:"Mouse"}]}),expect(JSGenerate.code).toBe("generated code"),expect(JSGenerate.generateFailed).toBe(!1)}),test("should handle code generation failure",function(){JSGenerate.actionTrees=[[["action",null,null]]],JSGenerate.actionNames=["action1"],JSGenerate.startTrees=[[["start",null,null]]],ASTUtils.getMethodAST.mockImplementation(function(){throw new Error("Failed to generate AST")}),JSGenerate.generateCode(),expect(JSGenerate.generateFailed).toBe(!0),expect(console.error).toHaveBeenCalledWith("CANNOT GENERATE ABSTRACT SYNTAX TREE\nError:",expect.any(Error)),expect(JSGenerate.code).toBe(astring.generate(ASTUtils.BAREBONE_AST))}),test("should print stacks tree",function(){JSGenerate.startTrees=[[["start",null,null]]],JSGenerate.actionTrees=[[["action",null,null]]],JSGenerate.actionNames=["action1"],JSGenerate.printStacksTree(),expect(console.log).toHaveBeenCalledWith("\n   %c START ","background: navy; color: white; font-weight: bold"),expect(console.log).toHaveBeenCalledWith("\n   %c ACTION ","background: green; color: white; font-weight: bold")}),test("should handle empty start and action trees",function(){JSGenerate.startTrees=[],JSGenerate.actionTrees=[],JSGenerate.printStacksTree(),expect(console.log).toHaveBeenCalledWith("%cno start trees generated","color: tomato"),expect(console.log).toHaveBeenCalledWith("%cno action trees generated","color: tomato")}),test("should handle invalid action name",function(){globalActivity.blocks.stackList=[1],globalActivity.blocks.blockList={1:{name:"action",trash:!1,connections:[null,2,3]},2:{name:"namedbox",value:null,connections:[null]},3:{name:"value",value:"arg1",connections:[null]}},JSGenerate.generateStacksTree(),expect(JSGenerate.actionNames).toEqual([])}),test("should handle invalid block connections",function(){globalActivity.blocks.stackList=[1],globalActivity.blocks.blockList={1:{name:"start",trash:!1,connections:[]}},JSGenerate.generateStacksTree(),expect(JSGenerate.startTrees).toEqual([[]])}),test("should run code generator with print options",function(){JSGenerate.actionTrees=[[["action",null,null]]],JSGenerate.actionNames=["action1"],JSGenerate.startTrees=[[["start",null,null]]],ASTUtils.getMethodAST.mockReturnValue({type:"Method"}),ASTUtils.getMouseAST.mockReturnValue({type:"Mouse"}),astring.generate.mockReturnValue("generated code"),JSGenerate.run(!0,!0),expect(console.log).toHaveBeenCalledWith("\n   %c STACK TREES ","background: greenyellow; color: midnightblue; font-weight: bold"),expect(console.log).toHaveBeenCalledWith("\n   %c CODE ","background: greenyellow; color: midnightblue; font-weight: bold"),expect(console.log).toHaveBeenCalledWith("generated code")})});