"use strict";function _typeof(i){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(i)}function _classCallCheck(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,_toPropertyKey(n.key),n)}}function _createClass(i,e,t){return e&&_defineProperties(i.prototype,e),t&&_defineProperties(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function _defineProperty(i,e,t){return(e=_toPropertyKey(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _toPropertyKey(i){var e=_toPrimitive(i,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(i,e){if("object"!=_typeof(i)||!i)return i;var t=i[Symbol.toPrimitive];if(void 0===t)return("string"===e?String:Number)(i);var n=t.call(i,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var Trashcan=function(){function a(i){_classCallCheck(this,a),this.activity=i,this.isVisible=!1,this._scale=1,this._iconsize=55,this._container=new createjs.Container,this._borderHighlightBitmap=null,this._isHighlightInitialized=!1,this._inAnimation=!1,this._animationInterval=null,this._highlightPower=255,this._animationLevel=0,this.animationTime=500,this.activity.trashContainer.addChild(this._container),this.activity.trashContainer.setChildIndex(this._container,0),this.resizeEvent(1),this._makeTrash()}return _createClass(a,[{key:"_makeBorderHighlight",value:function(i){var e=this,t=new Image;t.onload=function(){e._borderHighlightBitmap=new createjs.Bitmap(t),e._borderHighlightBitmap.scaleX=e.activity.cellSize/e._iconsize,e._borderHighlightBitmap.scaleY=e.activity.cellSize/e._iconsize,e._isHighlightInitialized?e._container.removeChildAt(e._container.children.length-1):(e._container.visible=!1,e._isHighlightInitialized=!0),e._container.addChild(e._borderHighlightBitmap),e._borderHighlightBitmap.visible=!0};var n="rgb("+this._highlightPower+","+this._highlightPower+","+this._highlightPower+")";i&&(n=platformColor.trashActive),t.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(BORDER.replace("stroke_color",n)))}},{key:"_makeBorder",value:function(){var e=this,t=new Image;t.onload=function(){var i=new createjs.Bitmap(t);i.scaleX=e.activity.cellSize/e._iconsize,i.scaleY=e.activity.cellSize/e._iconsize,e._container.addChild(i),e._makeBorderHighlight(!1)},t.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(BORDER.replace("stroke_color",platformColor.trashBorder)))}},{key:"_makeTrash",value:function(){var e=this,t=new Image;t.onload=function(){var i=new createjs.Bitmap(t);e._container.addChild(i),e._iconsize=i.getBounds().width,i.scaleX=e.activity.cellSize/e._iconsize,i.scaleY=e.activity.cellSize/e._iconsize,i.x=(a.TRASHWIDTH-e.activity.cellSize)/2*i.scaleX,i.y=(a.TRASHHEIGHT-e.activity.cellSize)/2*i.scaleY,e._makeBorder()},t.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(TRASHICON.replace(/fill_color/g,platformColor.trashBorder)))}},{key:"updateContainerPosition",value:function(){this._container.x=window.innerWidth/this._scale-a.TRASHWIDTH-2*this._iconsize,this._container.y=window.innerHeight/this._scale-a.TRASHHEIGHT-5/4*this._iconsize}},{key:"shouldResize",value:function(i,e){return this._container.x!==i||this._container.y!==e}},{key:"resizeEvent",value:function(i){this._scale=i,this.updateContainerPosition();var e,t=this;function n(){var i=(window.innerWidth/t._scale-a.TRASHWIDTH)/2,e=window.innerHeight/t._scale-a.TRASHHEIGHT;t.shouldResize(i,e)&&t.updateContainerPosition()}window.addEventListener("resize",function(){clearTimeout(e),e=setTimeout(n,300)})}},{key:"hide",value:function(){createjs.Tween.get(this._container).to({alpha:0},200).set({visible:!1})}},{key:"show",value:function(){this.stopHighlightAnimation(),createjs.Tween.get(this._container).to({alpha:0,visible:!0}).to({alpha:1},200)}},{key:"startHighlightAnimation",value:function(){var i=this;this._inAnimation||(this._inAnimation=!0,this._animationInterval=setInterval(function(){return i._animationLevel+=20,i._animationLevel>=i.animationTime?(i.isVisible=!0,i._makeBorderHighlight(!0),i.activity.refreshCanvas(),void clearInterval(i._animationInterval)):(i._highlightPower=parseInt(255-i._animationLevel/i.animationTime*255,10),i._makeBorderHighlight(!1),void i.activity.refreshCanvas())},20),this._switchHighlightVisibility(!0))}},{key:"stopHighlightAnimation",value:function(){this._inAnimation&&(clearInterval(this._animationInterval),this._inAnimation=!1,this.isVisible=!1,this._animationLevel=0,this._highlightPower=255,this._makeBorderHighlight(!1),this._switchHighlightVisibility(!1))}},{key:"_switchHighlightVisibility",value:function(i){last(this._container.children).visible=i,this._container.children[1].visible=!i,this._container.visible=!0,this.activity.refreshCanvas()}},{key:"overTrashcan",value:function(i,e){var t=this._container.x,n=this._container.y;return!(i<t)&&(!(t+a.TRASHWIDTH<i)&&!(e<n))}}]),a}();_defineProperty(Trashcan,"TRASHWIDTH",120),_defineProperty(Trashcan,"TRASHHEIGHT",120),"undefined"!=typeof module&&module.exports&&(module.exports=Trashcan);