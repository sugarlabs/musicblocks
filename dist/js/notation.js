"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,n,i){return n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var n=_toPrimitive(t,"string");return"symbol"==_typeof(n)?n:n+""}function _toPrimitive(t,n){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===n?String:Number)(t);var o=i.call(t,n||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var Notation=function(){function n(t){_classCallCheck(this,n),this.activity=t,this._notationStaging={},this._notationDrumStaging={},this._markup={},this._pickupPOW2={},this._pickupPoint={}}return _createClass(n,[{key:"_notationMarkup",value:function(t,n,i){i?this._notationStaging[t].push("markdown",n):this._notationStaging[t].push("markup",n),this._pickupPoint[t]=null}},{key:"doUpdateNotation",value:function(t,n,i,o,e){var a,u=durationToNoteValue(n),s=this.activity.turtles.ithTurtle(i);if(this._notationStaging[i].push([t,u[0],u[1],u[2],u[3],o,0<s.singer.staccato.length&&0<last(s.singer.staccato)]),0===e.length?this._notationDrumStaging[i].push([["R"],u[0],u[1],u[2],u[3],o,!1]):["noise1","noise2","noise3"].includes(e[0])||(a=getDrumSymbol(e[0]),this._notationDrumStaging[i].push([[a],u[0],u[1],u[2],u[3],o,!1])),this._pickupPoint[i]=null,"object"===_typeof(t)&&i in this._markup){for(var r=0;r<this._markup[i].length;r++){var p=this._markup[i][r];"number"==typeof p?this._notationMarkup(i,toFixed2(p),!1):0<p.length&&this._notationMarkup(i,p,!0)}this._markup[i]=[]}}},{key:"notationVoices",value:function(t,n){switch(n){case 1:this._notationStaging[t].push("voice one");break;case 2:this._notationStaging[t].push("voice two");break;case 3:this._notationStaging[t].push("voice three");break;case 4:this._notationStaging[t].push("voice four");break;default:this._notationStaging[t].push("one voice")}this._pickupPoint[t]=null}},{key:"notationKey",value:function(t,n,i){this._notationStaging[t].push("key",n,i),this._pickupPoint[t]=null}},{key:"notationMeter",value:function(t,n,i){if(null!=this._pickupPoint[t]){var o=this._notationStaging[t].length-this._pickupPoint[t],e=[];for(var a in o)e.push(this._notationStaging[t].pop());for(var u in this._notationStaging[t].push("meter",n,i),o)this._notationStaging[t].push(e.pop())}else this._notationStaging[t].push("meter",n,i);this._pickupPoint[t]=null}},{key:"notationSwing",value:function(t){this._notationStaging[t].push("swing")}},{key:"notationTempo",value:function(t,n,i){var o=convertFactor(i);null!==o&&this._notationStaging[t].push("tempo",n,o)}},{key:"notationPickup",value:function(t,n){if(0!==n){var i,o=this._notationStaging[t].length,e=convertFactor(n);if(null!==e)this._notationStaging[t].push("pickup",e),this._pickupPOW2[t]=!0;else{i=rationalToFraction(1-n);for(var a=0;a<i[0];a++)this.activity.logo.updateNotation(["R"],i[1],t,!1,"")}this._pickupPoint[t]=o}}},{key:"__notationHarmonic",value:function(t){this._notationStaging.push("harmonic"),this._pickupPoint[t]=null}},{key:"notationLineBreak",value:function(t){this._pickupPoint[t]=null}},{key:"notationBeginArticulation",value:function(t){this._notationStaging[t].push("begin articulation"),this._pickupPoint[t]=null}},{key:"notationEndArticulation",value:function(t){this._notationStaging[t].push("end articulation"),this._pickupPoint[t]=null}},{key:"notationBeginCrescendo",value:function(t,n){0<n?this._notationStaging[t].push("begin crescendo"):this._notationStaging[t].push("begin decrescendo"),this._pickupPoint[t]=null}},{key:"notationEndCrescendo",value:function(t,n){0<n?this._notationStaging[t].push("end crescendo"):this._notationStaging[t].push("end decrescendo"),this._pickupPoint[t]=null}},{key:"notationBeginSlur",value:function(t){this._notationStaging[t].push("begin slur"),this._pickupPoint[t]=null}},{key:"notationEndSlur",value:function(t){this._notationStaging[t].push("end slur"),this._pickupPoint[t]=null}},{key:"notationInsertTie",value:function(t){this._notationStaging[t].push("tie"),this._pickupPoint[t]=null}},{key:"notationRemoveTie",value:function(t){this._notationStaging[t].pop(),this._pickupPoint[t]=null}},{key:"notationBeginHarmonics",value:function(t){this._notationStaging[t].push("begin harmonics"),this._pickupPoint[t]=null}},{key:"notationEndHarmonics",value:function(t){this._notationStaging[t].push("end harmonics"),this._pickupPoint[t]=null}},{key:"notationStaging",set:function(t){this._notationStaging=t},get:function(){return this._notationStaging}},{key:"notationDrumStaging",set:function(t){this._notationDrumStaging=t},get:function(){return this._notationDrumStaging}},{key:"notationMarkup",set:function(t){this._notationMarkup=t},get:function(){return this._notationMarkup}},{key:"pickupPOW2",get:function(){return this._pickupPOW2}},{key:"pickupPoint",get:function(){return this._pickupPoint}}],[{key:"notationMarkup",value:function(t,n){t in this._markup?this._markup[t].push(n):this._markup[t]=[n]}}]),n}();"undefined"!=typeof module&&module.exports&&(module.exports=Notation);