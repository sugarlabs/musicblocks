"use strict";function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}saveMxmlOutput=function(O){function x(e){t+="    ".repeat(N)+e+"\n"}function M(e){x('<direction placement="above">'),N++,x("<direction-type>"),N++,x('<wedge type="'.concat(e,'"/>')),N--,x("</direction-type>"),N--,x("</direction>")}function P(e,t,n,r){x('<measure number="'.concat(e,'"> <attributes> <divisions>').concat(t,"</divisions> <key> <fifths>0</fifths> </key> <time> <beats>").concat(n,"</beats> <beat-type>").concat(r,"</beat-type> </time> <clef>  <sign>G</sign> <line>2</line> </clef> </attributes>"))}var _=["voice two","voice one","one voice"],t="",N=0;x("<?xml version='1.0' encoding='UTF-8'?>"),x('<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">'),x('<score-partwise version="3.1">'),N++,x("<part-list>"),N++,Object.keys(O.notation.notationStaging).forEach(function(e){0!==O.notation.notationStaging[e].length&&(voiceNum=parseInt(e)+1,x('<score-part id="P'.concat(voiceNum,'">')),N++,x("<part-name> Voice #".concat(voiceNum," </part-name>")),N--,x("</score-part>"))}),N--,x("</part-list>"),N--,Object.keys(O.notation.notationStaging).forEach(function(e){if(0!==O.notation.notationStaging[e].length){voiceNum=parseInt(e)+1,N++,x('<part id="P'.concat(voiceNum,'">')),N++;var t=1,n=32,r=4,o=4,a=!1,i=-1,c=-1,s=-1,l=!1,u=null,p=!0;N++;for(var d=n,f=O.notation.notationStaging[e],y=0;y<f.length;y++){var m=f[y];if(!["tie","begin slur","end slur"].includes(m)&&!_.includes(m))if("key"!==m)if("begin crescendo"!==m)if("begin decrescendo"!==m)if("end crescendo"!==m&&"end decrescendo"!==m)if("tempo"!==m)if("meter"!==m){var v,g=!1,b=_createForOfIteratorHelper(m[0]);try{for(b.s();!(v=b.n()).done;){for(var h=v.value,w=32/m[1],I=0;I<m[2];I++)w+=w/2;d<w&&!g&&l&&(x("</measure>"),t++,d=n,l=!1),g||(d===n&&(p?(P(t,n,r,o),p=!1):a?(d=n=i,P(t,i,r=c,o=s),a=!1):x('<measure number="'.concat(t,'">')),l=!0,null!==u&&(x(u),u=null)),d-=w);var A="♭"===h[1]?-1:"♯"===h[1]?1:0;x("<note>"),N++,g&&x("<chord/>"),"R"===h[0]?x("<rest/>"):(x("<pitch>"),N++,x("<step>".concat(h[0],"</step>")),0!=A&&x("<alter>".concat(A,"</alter>")),x("<octave>".concat(h[h.length-1],"</octave>")),N--,x("</pitch>")),x("<duration>".concat(w,"</duration>")),"tie"===f[y+1]?x('<tie type="start"/>'):"tie"===f[y-1]&&x('<tie type="stop"/>'),N--,x("<notations>"),N++,x("<articulations>"),N++,m[6]&&x('<staccato placement="below"/>'),N--,x("</articulations>"),N--,"begin slur"===f[y-1]&&(N++,x('<slur type="start"/>'),N--),"end slur"===f[y+1]&&(N++,x('<slur type="stop"/>'),N--),x("</notations>"),x("</note>"),g=!0}}catch(e){b.e(e)}finally{b.f()}}else i=(c=f[y+1])*(1/(s=f[y+2])/(1/32)),y+=2,a=!0;else{var S=f[y+1],T=f[y+2],k=Math.floor(S*(4/T));l?x('<sound tempo="'.concat(k,'"/>')):u='<sound tempo="'.concat(k,'"/>'),y+=2}else x("<direction>"),N++,x("<direction-type>"),N++,x('<wedge type="stop"/>'),N--,x("</direction-type>"),N--,x("</direction>");else M("diminuendo");else M("crescendo");else y+=2}N--,l&&(N++,x("<barline>"),N++,x("<bar-style>light-heavy</bar-style>"),N--,x("</barline>"),N--,x("</measure>")),N--,x("</part>"),N--}}),x("</score-partwise>");for(var e=1e5,n=0;n<t.length-1;n++)"P"!==t[n]&&"#"!==t[n]||!"123456789".includes(t[n+1])||(e=Math.min(e,parseInt(t[n+1])));t=t.split("");for(var r=0;r<t.length-1;r++)"P"!==t[r]&&"#"!==t[r]||!"123456789".includes(t[r+1])||(t[r+1]=parseInt(t[r+1])-e+1);return t=t.join("")},"undefined"!=typeof module&&module.exports&&(module.exports=saveMxmlOutput);