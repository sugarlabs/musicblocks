function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var o;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(o="Object"===(o={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:o)||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=Array(e);o<e;o++)n[o]=t[o];return n}function _iterableToArrayLimit(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,a,i,r,l=[],c=!0,u=!1;try{if(i=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;c=!1}else for(;!(c=(n=i.call(o)).done)&&(l.push(n.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=o.return&&(r=o.return(),Object(r)!==r))return}finally{if(u)throw a}}return l}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0===o)return("string"===e?String:Number)(t);o=o.call(t,e||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var SaveInterface=(()=>_createClass(function t(e){var o=this,n=(_classCallCheck(this,t),this.activity=e,this.filename=null,this.notationConvert="",this.timeLastSaved=-100,this.htmlSaveTemplate='<!DOCTYPE html><html lang="en"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="description" content="{{ project_description }}"> <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"> <title>{{ project_name }}</title> <meta property="og:site_name" content="Music Blocks"/> <meta property="og:type" content="website"/> <meta property="og:title" content="'+_("Music Blocks Project")+' - {{ project_name }}"/> <meta property="og:description" content="{{ project_description }}"/> <style>body{background-color: #dbf0fb;}#main{background-color: white; padding: 5%; position: fixed; width: 80vw; height: max-content; margin: auto; top: 0; left: 0; bottom: 0; right: 0; display: flex; flex-direction: column; justify-content: center; text-align: center; color: #424242; box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23); font-family: "Roboto", "Helvetica","Arial",sans-serif;}h3{font-weight: 400; font-size: 36px; margin-top: 10px;}hr{border-top: 0px solid #ccc; margin: 1em;}.btn {display: inline-block; margin-left: 10px; cursor: pointer; font-size: 14px; border-radius: 12px; border: 1px solid #1678ad; padding: 3px 5px; line-height: 20px; color: #181818;}.btn:hover {transition: 0.4s; -webkit-transition: 0.3s; -moz-transition: 0.3s; background-color: #3eb7e7;}.code{word-break: break-all; height: 15vh; background: #f6f8fa; color: #494949; text-align: justify; margin-right: 10vw; margin-left: 10vw; padding: 16px; overflow: auto; line-height: 1.45; background-color: #f6f8fa; border-radius: 3px; font-family: "SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;}.image{border-radius: 2px 2px 0 0; position: relative; background-color: #96D3F3;}.image-div{margin-bottom: 10px;}.moreinfo-div{margin-top: 20px;}h4{font-weight: 500; font-size: 1.4em; margin-top: 10px; margin-bottom: 10px;}.tbcode{margin-bottom: 10px;}</style></head><body> <div id="main"> <div class="image-div"><img class="image" id="project-image" src="{{ project_image }}"></div><h3 id="title">'+_("Music Blocks Project")+' - {{ project_name }}</h3> <p>{{ project_description }}</p><hr> <div> <div style="color: #9E9E9E"><p>'+_("This project was created in Music Blocks")+' (<a href="https://musicblocks.sugarlabs.org" target="_blank">https://musicblocks.sugarlabs.org</a>). '+TITLESTRING+" "+_("Music Blocks is a Free/Libre Software application.")+" "+_("The source code can be accessed at")+' <a href="https://github.com/sugarlabs/musicblocks" target="_blank">https://github.com/sugarlabs/musicblocks</a>. '+_("For more information, please consult the")+' <a href="'+GUIDEURL+'" target="_blank">'+_("Music Blocks Guide")+"</a>.</p><p>"+_("To run this project, open Music Blocks in a web browser and drag and drop this file into the browser window.")+" "+_("Alternatively, open the file in Music Blocks using the Load project button.")+'</p></div><div class="moreinfo-div"> <div class="tbcode"><h4>'+_("Project Code")+"</h4>"+_("This code stores data about the blocks in a project.")+'<a href="javascript:toggle();" id="showhide">'+_("Show")+'</a><button class="btn" onclick="copyCode()" style="margin-left: 10px;">'+_("Copy to Clipboard")+'</button></div> <div class="code" id="codeBlock">{{ data }}</div></div></div></div><script type="text/javascript">function toggle() {  var codeBlock = document.getElementsByClassName("code")[0];  var showHideButton = document.getElementById("showhide");  if (codeBlock.style.display === "none") {    codeBlock.style.display = "flex";    showHideButton.textContent = "'+_("Hide")+'";  } else {    codeBlock.style.display = "none";    showHideButton.textContent = "'+_("Show")+'";  }}window.onload = function() {  var codeBlock = document.getElementById("codeBlock");  var showHideButton = document.getElementById("showhide");  codeBlock.style.display = "none";  showHideButton.textContent = "'+_("Show")+'";};function copyCode() {  var text = document.getElementById("codeBlock").innerText;  navigator.clipboard.writeText(text).then(function() {    alert("'+_("Project code copied to clipboard!")+'");  }).catch(function() {    alert("'+_("Failed to copy.")+'");  });}<\/script>',this.timeLastSaved=-100,jQuery.noConflict());n(window).on("beforeunload",function(t){var e="#saveButtonAdvanced";if(o.activity.beginnerMode&&(e="#saveButton"),void 0!==o.PlanetInterface&&o.PlanetInterface.getTimeLastSaved()!==o.timeLastSaved)return t.preventDefault(),n(e).trigger("mouseenter"),""})},[{key:"download",value:function(t,e,o){var n=null,n=null==o?(o=void 0===this.activity.PlanetInterface?_("My Project"):this.activity.PlanetInterface.getCurrentProjectName(),fileExt(o)!=t&&(o+="."+t),1==window.isElectron?o:prompt("Filename:",o)):(fileExt(o)!=t&&(o+="."+t),o);console.debug("saving to "+n),null===n?console.debug("save cancelled"):(fileExt(n)!=t&&(n+="."+t),this.downloadURL(n,e))}},{key:"downloadURL",value:function(t,e){var o=document.createElement("a");o.setAttribute("href",e),o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o)}},{key:"prepareHTML",value:function(){var t=this.htmlSaveTemplate,e=_("No description provided"),o=(void 0!==this.activity.PlanetInterface&&(e=this.activity.PlanetInterface.getCurrentProjectDescription()),_("My Project")),n=(void 0!==this.activity.PlanetInterface&&(o=this.activity.PlanetInterface.getCurrentProjectName()),this.activity.prepareExport()),a="";return void 0!==this.activity.PlanetInterface&&(a=this.activity.PlanetInterface.getCurrentProjectImage()),t=t.replace(new RegExp("{{ project_description }}","g"),e).replace(new RegExp("{{ project_name }}","g"),o).replace(new RegExp("{{ data }}","g"),n).replace(new RegExp("{{ project_image }}","g"),a)}},{key:"saveHTML",value:function(t){var e="data:text/plain;charset=utf-8,"+encodeURIComponent(t.save.prepareHTML());t.save.download("html",e,null)}},{key:"saveHTMLNoPrompt",value:function(e){setTimeout(function(){var t="data:text/plain;charset=utf-8,"+encodeURIComponent(e.save.prepareHTML());void 0!==e.PlanetInterface?e.save.downloadURL(e.PlanetInterface.getCurrentProjectName()+".html",t):e.save.downloadURL(_("My Project").replace(" ","_")+".html",t)},500)}},{key:"saveMIDI",value:function(t){t.logo.runningMIDI=!0,t.logo.runLogoCommands(),document.body.style.cursor="wait"}},{key:"afterSaveMIDI",value:function(){var d=getMidiInstrument(),s=getMidiDrum(),e=activity.logo._midiData;setTimeout(function(){var t,u;t=e,(u=new Midi).header.ticksPerBeat=480,Object.entries(t).forEach(function(t){var t=_slicedToArray(t,2),r=t[0],t=t[1],l=(u.addTrack().name="Track ".concat(parseInt(r)+1),new Map),c=0;t.forEach(function(t){var e,o,n,a,i;t.note&&0!==t.note.length&&(e=1/t.duration*60*4/t.bpm,o=t.instrument||"default",t.drum?(n=t.drum||!1,l.has(n)||((a=u.addTrack()).name="Track ".concat(parseInt(r)+1," - ").concat(n),a.channel=9,l.set(n,a)),a=l.get(n),n=s[n]||36,a.addNote({midi:n,time:c,duration:e,velocity:.9})):(l.has(o)||((a=u.addTrack()).name="Track ".concat(parseInt(r)+1," - ").concat(o),a.instrument.number=null!=(n=d[o])?n:d.default,l.set(o,a)),i=l.get(o),t.note.forEach(function(t){t.includes("R")||i.addNote({name:t.replace("♯","#").replace("♭","b"),time:c,duration:e,velocity:.8})})),c+=e)}),c=0}),t=u.toArray(),t=new Blob([t],{type:"audio/midi"}),t=URL.createObjectURL(t),activity.save.download("midi",t,null),activity.logo._midiData={},document.body.style.cursor="default"},500)}},{key:"saveSVG",value:function(t){var e="data:image/svg+xml;utf8,"+doSVG(t.canvas,t.logo,t.turtles,t.canvas.width,t.canvas.height,1);t.save.download("svg",e,null)}},{key:"savePNG",value:function(t){var e=docById("overlayCanvas").toDataURL("image/png");t.save.download("png",e,null)}},{key:"saveBlockArtwork",value:function(t){var e="data:image/svg+xml;utf8,"+t.printBlockSVG();t.save.download("svg",e,null)}},{key:"saveBlockArtworkPNG",value:function(e){e.printBlockPNG().then(function(t){e.save.download("png",t,null)})}},{key:"saveWAV",value:function(t){document.body.style.cursor="wait",t.logo.recording=!0,t.logo.synth.setupRecorder(),t.logo.synth.recorder.start(),t.logo.runLogoCommands(),t.textMsg(_("Your recording is in progress."))}},{key:"saveAbc",value:function(t){if(document.body.style.cursor="wait",t.logo.recordingBuffer.hasData){t.logo.notationOutput=t.logo.recordingBuffer.notationOutput,t.logo.notationNotes=t.logo.recordingBuffer.notationNotes;for(var e=0;e<t.turtles.getTurtleCount();e++)t.logo.recordingBuffer.notationStaging[e]&&(t.logo.notation.notationStaging[e]=t.logo.recordingBuffer.notationStaging[e]),t.logo.recordingBuffer.notationDrumStaging[e]&&(t.logo.notation.notationDrumStaging[e]=t.logo.recordingBuffer.notationDrumStaging[e]);setTimeout(function(){t.save.afterSaveAbc()},100)}else{t.logo.runningAbc=!0,t.logo.notationOutput=ABCHEADER,t.logo.notationNotes={};for(var o=0;o<t.turtles.getTurtleCount();o++)t.logo.notation.notationStaging[o]=[],t.logo.notation.notationDrumStaging[o]=[],t.turtles.getTurtle(o).painter.doClear(!0,!0,!0);t.logo.runLogoCommands()}}},{key:"afterSaveAbc",value:function(){var t=encodeURIComponent(saveAbcOutput(this.activity));this.activity.save.download("abc","data:text;utf8,"+t,null)}},{key:"saveLilypond",value:function(t){if(t.logo.recordingBuffer.hasData){t.logo.notationOutput=t.logo.recordingBuffer.notationOutput,t.logo.notationNotes=t.logo.recordingBuffer.notationNotes;for(var e=0;e<t.turtles.getTurtleCount();e++)t.logo.recordingBuffer.notationStaging[e]&&(t.logo.notation.notationStaging[e]=t.logo.recordingBuffer.notationStaging[e]),t.logo.recordingBuffer.notationDrumStaging[e]&&(t.logo.notation.notationDrumStaging[e]=t.logo.recordingBuffer.notationDrumStaging[e])}var o=_("My Project"),o=(void 0!==t.PlanetInterface&&(o=t.PlanetInterface.getCurrentProjectName()),"ly"!=fileExt(o)&&(o+=".ly"),docById("lilypondModal").style.display="block",docById("fileNameText").textContent=_("File name"),docById("titleText").textContent=_("Project title"),docById("authorText").textContent=_("Project author"),docById("MIDIText").textContent=_("Include MIDI output?"),docById("guitarText").textContent=_("Include guitar tablature output?"),docById("submitLilypond").textContent=_("Save as Lilypond"),docById("fileName").value=o,void 0!==t.PlanetInterface?docById("title").value=t.PlanetInterface.getCurrentProjectName():docById("title").value=_("My Project"),t.storage.getItem("customAuthor"));docById("author").value=null!=o?JSON.parse(o):_("Mr. Mouse"),docById("submitLilypond").onclick=function(){t.save.saveLYFile(!1)},docByClass("close")[0].onclick=function(){t.logo.runningLilypond=!1,docById("lilypondModal").style.display="none"}}},{key:"saveLYFile",value:function(t){var e=this,o=(void 0===t&&(t=!1),docById("fileName").value),n=docById("title").value,a=docById("author").value,i=(this.activity.storage.setItem("customAuthor",JSON.stringify(a)),docById("MIDICheck").checked),r=docById("guitarCheck").checked,l=(null!=o&&"ly"!==fileExt(o)&&0,{"My Music Blocks Creation":n,"Mr. Mouse":a}),o=LILYPONDHEADER.replace(/My Music Blocks Creation|Mr. Mouse/gi,function(t){return l[t]});if(this.activity.logo.MIDIOutput=i?"% MIDI SECTION\n% MIDI Output included! \n\n\\midi {\n   \\tempo 4=90\n}\n\n\n}\n\n":"% MIDI SECTION\n% Delete the %{ and %} below to include MIDI output.\n%{\n\\midi {\n   \\tempo 4=90\n}\n%}\n\n}\n\n",r?(this.activity.logo.guitarOutputHead='\n\n% GUITAR TAB SECTION\n% Guitar tablature output included!\n\n      \\new TabStaff = "guitar tab" \n      <<\n         \\clef moderntab\n',this.activity.logo.guitarOutputEnd="      >>\n\n"):(this.activity.logo.guitarOutputHead='\n\n% GUITAR TAB SECTION\n% Delete the %{ and %} below to include guitar tablature output.\n%{\n      \\new TabStaff = "guitar tab" \n      <<\n         \\clef moderntab\n',this.activity.logo.guitarOutputEnd="      >>\n%}\n"),this.activity.logo.recordingBuffer.hasData)this.notationConvert=t?"pdf":"",this.activity.logo.notationOutput=this.activity.logo.notationOutput.replace(/My Music Blocks Creation|Mr. Mouse/gi,function(t){return l[t]}),docById("lilypondModal").style.display="none",document.body.style.cursor="wait",setTimeout(function(){e.afterSaveLilypond()},100);else{this.activity.logo.runningLilypond=!0,this.notationConvert=t?"pdf":"",this.activity.logo.notationOutput=o,this.activity.logo.notationNotes={};for(var c=0;c<this.activity.turtles.getTurtleCount();c++)this.activity.logo.notation.notationStaging[c]=[],this.activity.logo.notation.notationDrumStaging[c]=[],this.activity.turtles.getTurtle(c).painter.doClear(!0,!0,!0);document.body.style.cursor="wait",this.activity.logo.runLogoCommands(),docById("lilypondModal").style.display="none"}}},{key:"afterSaveLilypond",value:function(t){t=docById("fileName").value;var e=saveLilypondOutput(this.activity);"pdf"===this.notationConvert?this.afterSaveLilypondPDF(e,t):this.afterSaveLilypondLY(e,t),this.notationConvert=""}},{key:"afterSaveLilypondLY",value:function(t,e){var o;e=docById("fileName").value,platform.FF?console.debug('execCommand("copy") does not work on FireFox'):((o=jQuery("<textarea />").appendTo(document.body)).val(t),o.select(),o[0].setSelectionRange(0,t.length),document.execCommand("copy"),o.remove(),this.activity.textMsg(_("The Lilypond code is copied to clipboard. You can paste it here: ")+"<a href='http://hacklily.org' target='_blank'>http://hacklily.org</a> ")),this.download("ly","data:text;utf8,"+encodeURIComponent(t),e)}},{key:"afterSaveLilypondPDF",value:function(t,o){var n=this;document.body.style.cursor="wait",window.Converter.ly2pdf(t,function(t,e){document.body.style.cursor="default",t?n.activity.save.download("pdf",e,o):(console.debug("Error: "+e),n.activity.errorMsg(_("Failed to convert Lilypond to PDF. Please try saving as .ly file instead."),5e3))})}},{key:"saveMxml",value:function(t){this.activity.logo.runningMxml=!0;for(var e=0;e<this.activity.turtles.getTurtleCount();e++)this.activity.logo.notation.notationStaging[e]=[],this.activity.logo.notation.notationDrumStaging[e]=[],this.activity.turtles.getTurtle(e).painter.doClear(!0,!0,!0);this.activity.logo.runLogoCommands()}},{key:"afterSaveMxml",value:function(t){var e=saveMxmlOutput(this.activity.logo);this.download("xml","data:text;utf8,"+encodeURIComponent(e),t),this.activity.logo.runningMxml=!1}}]))();"undefined"!=typeof module&&module.exports&&(module.exports={SaveInterface:SaveInterface});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _slicedToArray(t,o){return _arrayWithHoles(t)||_iterableToArrayLimit(t,o)||_unsupportedIterableToArray(t,o)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,o){var n;if(t)return"string"==typeof t?_arrayLikeToArray(t,o):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,o):void 0}function _arrayLikeToArray(t,o){(null==o||o>t.length)&&(o=t.length);for(var n=0,e=Array(o);n<o;n++)e[n]=t[n];return e}function _iterableToArrayLimit(t,o){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var e,a,r,i,N=[],s=!0,T=!1;try{if(r=(n=n.call(t)).next,0===o){if(Object(n)!==n)return;s=!1}else for(;!(s=(e=r.call(n)).done)&&(N.push(e.value),N.length!==o);s=!0);}catch(t){T=!0,a=t}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(T)throw a}}return N}}function _arrayWithHoles(t){if(Array.isArray(t))return t}var ABCHEADER="X:1\nT:Music Blocks composition\nC:Mr. Mouse\nL:1/16\nM:C\n",OCTAVE_NOTATION_MAP={10:"'''''",9:"''''",8:"'''",7:"''",6:"'",5:"",4:"",3:",",2:",,",1:",,,"},ACCIDENTAL_MAP={"♯":"^","♭":"_"},getABCHeader=function(){return ABCHEADER},processABCNotes=function(c,l){c.notationNotes[l]="";for(var u,g,f=function(t){return{64:"1/4",32:"1/2",16:"1",8:"2",4:"4",2:"8",1:"16"}[t]||t.toString()},I=function(t){var o;"number"==typeof t&&(t=(o=frequencyToPitch(t))[0]+o[1]);for(var n=0,e=Object.entries(ACCIDENTAL_MAP);n<e.length;n++){var a=_slicedToArray(e[n],2),r=a[0],a=a[1];t=t.replace(new RegExp(r,"g"),a)}for(var i=0,N=Object.entries(OCTAVE_NOTATION_MAP);i<N.length;i++){var s=_slicedToArray(N[i],2),T=s[0],s=s[1];if(t.includes(T)){t=t.replace(new RegExp(T,"g"),s);break}}return t.includes("'")||""===t?t.toLowerCase():t.toUpperCase()},b=0,p=!1,y=!1,C=0,S=0,E=0;E<c.notation.notationStaging[l].length;E++)(t=>{var N=c.notation.notationStaging[l][t];if("string"==typeof N)switch(N){case"break":0<t&&(c.notationNotes[l]+="\n"),b=0;break;case"begin articulation":y=!0;break;case"end articulation":y=!1;break;case"begin crescendo":c.notationNotes[l]+="!<(!";break;case"end crescendo":c.notationNotes[l]+="!<)!";break;case"begin decrescendo":c.notationNotes[l]+="!>(!";break;case"end decrescendo":c.notationNotes[l]+="!<(!";break;case"begin slur":p=!0;break;case"end slur":case"tie":c.notationNotes[l]+="";break;case"meter":c.notationNotes[l]+="M:"+c.notation.notationStaging[l][t+1]+"/"+c.notation.notationStaging[l][t+2]+"\n",t+=2;break;case"pickup":var o=c.notation.notationStaging[l][t+1];c.notationNotes[l]+="K: pickup=".concat(o,"\n"),t+=1;break;case"voice one":c.notationNotes[l]+="V:1\n";break;case"voice two":c.notationNotes[l]+="V:2\n";break;case"voice three":c.notationNotes[l]+="V:3\n";break;case"voice four":c.notationNotes[l]+="V:4\n";break;case"one voice":c.notationNotes[l]+="V:1\n";break;default:c.notationNotes[l]+=N}else{b%8==0&&0<b&&(c.notationNotes[l]+="\n"),b+=1,g="string"==typeof N[NOTATIONNOTE]?I(N[NOTATIONNOTE]):(u=N[NOTATIONNOTE],I(u[0]));var n=0;if(null!=N[NOTATIONTUPLETVALUE]){C=1/c.notation.notationStaging[l][t][NOTATIONDURATION],S=1/c.notation.notationStaging[l][t][NOTATIONROUNDDOWN];for(var e=1,a=1;a<N[NOTATIONTUPLETVALUE];){if(t+e>=c.notation.notationStaging[l].length){n=e;break}if(0<c.notation.notationStaging[l][t+e][NOTATIONINSIDECHORD]&&c.notation.notationStaging[l][t+e][NOTATIONINSIDECHORD]===c.notation.notationStaging[l][t+e-1][NOTATIONINSIDECHORD])e++;else{if(c.notation.notationStaging[l][t+e][NOTATIONTUPLETVALUE]!==N[NOTATIONTUPLETVALUE]){n=e;break}C+=1/c.notation.notationStaging[l][t+e][NOTATIONDURATION],S+=1/c.notation.notationStaging[l][t+e][NOTATIONROUNDDOWN],e++,a++}}}var r,i=function(t,o,n,e){for(var a=0,r=0;r<e;){if("object"===_typeof(u)){1<u.length&&(t.notationNotes[o]+="[");for(var i=0;i<u.length;i++)t.notationNotes[o]+=I(u[i]),t.notationNotes[o]+=" ";N[NOTATIONSTACCATO]&&(t.notationNotes[o]+="."),1<u.length&&(t.notationNotes[o]+="]"),t.notationNotes[o]+=t.notation.notationStaging[o][n+a][NOTATIONROUNDDOWN]}a++,r++}return a};if(0<N[NOTATIONTUPLETVALUE])0===n?(r=toFraction(S/C),c.notationNotes[l]+="("+r[0]+":"+r[1],t+=i(c,l,t,N[NOTATIONTUPLETVALUE])-1):(r=toFraction(N[NOTATIONTUPLETVALUE]/n),c.notationNotes[l]+="("+r[0]+":"+r[1],t+=i(c,l,t,n)-1);else{if("object"===_typeof(u)){1<u.length&&(c.notationNotes[l]+="[");for(var s=0;s<u.length;s++)c.notationNotes[l]+=I(u[s]);1<u.length&&(c.notationNotes[l]+="]"),c.notationNotes[l]+=N[NOTATIONDURATION];for(var T=0;T<N[NOTATIONDOTCOUNT];T++)c.notationNotes[l]+=".";c.notationNotes[l]+=" "}if(N[NOTATIONSTACCATO]&&(c.notationNotes[l]+="."),0<N[NOTATIONINSIDECHORD]){if(0!==t&&c.notation.notationStaging[l][t-1][NOTATIONINSIDECHORD]===N[NOTATIONINSIDECHORD]||(c.notationNotes[l]+="["),c.notationNotes[l]+=g,t===c.notation.notationStaging[l].length-1||c.notation.notationStaging[l][t+1][NOTATIONINSIDECHORD]!==N[NOTATIONINSIDECHORD]){c.notationNotes[l]+="]",c.notationNotes[l]+=f(N[NOTATIONDURATION]);for(var O=0;O<N[NOTATIONDOTCOUNT];O++)c.notationNotes[l]+=" ";y&&(c.notationNotes[l]+=" "),c.notationNotes[l]+=" "}}else{c.notationNotes[l]+=g,c.notationNotes[l]+=f(N[NOTATIONDURATION]);for(var A=0;A<N[NOTATIONDOTCOUNT];A++)c.notationNotes[l]+=".";y&&(c.notationNotes[l]+="")}N[NOTATIONSTACCATO]&&(c.notationNotes[l]+=".")}S=C=0,c.notationNotes[l]+=" ",p&&(p=!1,c.notationNotes[l]+="")}E=t})(E)},saveAbcOutput=function(t){for(var o in t.logo.notationOutput=getABCHeader(),t.logo.notation.notationStaging)t.logo.notationOutput+="K:"+t.turtles.ithTurtle(o).singer.keySignature.toUpperCase().replace(" ","").replace("♭","b").replace("♯","#")+"\n",processABCNotes(t.logo,o),t.logo.notationOutput+=t.logo.notationNotes[o];return t.logo.notationOutput+="\n",t.logo.notationOutput};"undefined"!=typeof module&&module.exports&&(module.exports={getABCHeader:getABCHeader,processABCNotes:processABCNotes,saveAbcOutput:saveAbcOutput,ACCIDENTAL_MAP:ACCIDENTAL_MAP,OCTAVE_NOTATION_MAP:OCTAVE_NOTATION_MAP});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regeneratorValues(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return{value:(e=e&&a>=e.length?void 0:e)&&e[a++],done:!e}}}}throw new TypeError(_typeof(e)+" is not iterable")}function _regeneratorKeys(e){var t,a=Object(e),o=[];for(t in a)o.unshift(t);return function e(){for(;o.length;)if((t=o.pop())in a)return e.value=t,e.done=!1,e;return e.done=!0,e}}function _createForOfIteratorHelper(e,t){var a,o,n,l,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return n=!(o=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){n=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(n)throw a}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),l=0,{s:t=function(){},n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _regenerator(){var h,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",a=e.toStringTag||"@@toStringTag";function o(e,t,a,o){var n,l,i,s,r,c,u,d,g,t=t&&t.prototype instanceof m?t:m,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(n=e,l=a,u=o||[],d=!1,g={p:c=0,n:0,v:h,a:p,f:p.bind(h,4),d:function(e,t){return i=e,s=0,r=h,g.n=t,M}},function(e,t,a){if(1<c)throw TypeError("Generator is already running");for(d&&1===t&&p(t,a),s=t,r=a;(b=s<2?h:r)||!d;){i||(s?s<3?(1<s&&(g.n=-1),p(s,r)):g.n=r:g.v=r);try{if(c=2,i){if(b=i[e=s?e:"next"]){if(!(b=b.call(i,r)))throw TypeError("iterator result is not an object");if(!b.done)return b;r=b.value,s<2&&(s=0)}else 1===s&&(b=i.return)&&b.call(i),s<2&&(r=TypeError("The iterator does not provide a '"+e+"' method"),s=1);i=h}else if((b=(d=g.n<0)?r:n.call(l,g))!==M)break}catch(e){i=h,s=1,r=e}finally{c=1}}return{value:b,done:d}}),!0),t;function p(e,t){for(s=e,r=t,b=0;!d&&c&&!a&&b<u.length;b++){var a,o=u[b],n=g.p,l=o[2];3<e?(a=l===t)&&(r=o[(s=o[4])?5:s=3],o[4]=o[5]=h):o[0]<=n&&((a=e<2&&n<o[1])?(s=0,g.v=t,g.n=o[1]):n<l&&(a=e<3||o[0]>t||l<t)&&(o[4]=e,o[5]=t,g.n=l,s=0))}if(a||1<e)return M;throw d=!0,t}}var M={};function m(){}function n(){}function l(){}var b=Object.getPrototypeOf,e=[][t]?b(b([][t]())):(_regeneratorDefine2(b={},t,function(){return this}),b),i=l.prototype=m.prototype=Object.create(e);function s(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",n.prototype=l),_regeneratorDefine2(l,"constructor",n),_regeneratorDefine2(l,a,n.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,a,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:s}})()}function _regeneratorDefine2(e,t,a,o){var l=Object.defineProperty;try{l({},"",{})}catch(e){l=0}(_regeneratorDefine2=function(e,t,a,o){function n(t,a){_regeneratorDefine2(e,t,function(e){return this._invoke(t,a,e)})}t?l?l(e,t,{value:a,enumerable:!o,configurable:!o,writable:!o}):e[t]=a:(n("next",0),n("throw",1),n("return",2))})(e,t,a,o)}function asyncGeneratorStep(e,t,a,o,n,l,i){try{var s=e[l](i),r=s.value}catch(e){return void a(e)}s.done?t(r):Promise.resolve(r).then(o,n)}function _asyncToGenerator(s){return function(){var e=this,i=arguments;return new Promise(function(t,a){var o=s.apply(e,i);function n(e){asyncGeneratorStep(o,t,a,n,l,"next",e)}function l(e){asyncGeneratorStep(o,t,a,n,l,"throw",e)}n(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var a;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(a="Object"===(a={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,o=Array(t);a<t;a++)o[a]=e[a];return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0===a)return("string"===t?String:Number)(e);a=a.call(e,t||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}var MUSICBLOCKS_EXTRAS,globalActivity,LEADING=0,BLOCKSCALES=[1,1.5,2,3,4],_THIS_IS_MUSIC_BLOCKS_=!0,_THIS_IS_TURTLE_BLOCKS_=!_THIS_IS_MUSIC_BLOCKS_,_ERRORMSGTIMEOUT_=15e3,_MSGTIMEOUT_=6e4,RESPONSIVE_BREAKPOINT_TABLET=768,RESPONSIVE_BREAKPOINT_MOBILE=600,MYDEFINES=["utils/platformstyle","easeljs.min","tweenjs.min","preloadjs.min","howler","p5.min","p5-sound-adapter","p5.dom.min","Chart","utils/utils","activity/artwork","widgets/status","widgets/help","utils/munsell","activity/toolbar","activity/trash","activity/boundary","activity/palette","activity/protoblocks","activity/blocks","activity/block","activity/turtledefs","activity/notation","activity/logo","activity/turtle","activity/turtles","activity/turtle-singer","activity/turtle-painter","activity/languagebox","activity/themebox","activity/basicblocks","activity/blockfactory","activity/piemenus","activity/planetInterface","activity/rubrics","activity/macros","activity/SaveInterface","utils/musicutils","utils/synthutils","utils/mathutils","activity/pastebox","prefixfree.min","Tone","activity/js-export/samples/sample","activity/js-export/export","activity/js-export/interface","activity/js-export/constraints","activity/js-export/ASTutils","activity/js-export/generate","activity/js-export/ast2blocklist","activity/js-export/API/GraphicsBlocksAPI","activity/js-export/API/PenBlocksAPI","activity/js-export/API/RhythmBlocksAPI","activity/js-export/API/MeterBlocksAPI","activity/js-export/API/PitchBlocksAPI","activity/js-export/API/IntervalsBlocksAPI","activity/js-export/API/ToneBlocksAPI","activity/js-export/API/OrnamentBlocksAPI","activity/js-export/API/VolumeBlocksAPI","activity/js-export/API/DrumBlocksAPI","activity/js-export/API/DictBlocksAPI","activity/turtleactions/RhythmActions","activity/turtleactions/MeterActions","activity/turtleactions/PitchActions","activity/turtleactions/IntervalsActions","activity/turtleactions/ToneActions","activity/turtleactions/OrnamentActions","activity/turtleactions/VolumeActions","activity/turtleactions/DrumActions","activity/turtleactions/DictActions","activity/blocks/RhythmBlocks","activity/blocks/MeterBlocks","activity/blocks/PitchBlocks","activity/blocks/IntervalsBlocks","activity/blocks/ToneBlocks","activity/blocks/OrnamentBlocks","activity/blocks/VolumeBlocks","activity/blocks/DrumBlocks","activity/blocks/WidgetBlocks","activity/blocks/RhythmBlockPaletteBlocks","activity/blocks/ActionBlocks","activity/blocks/FlowBlocks","activity/blocks/NumberBlocks","activity/blocks/BoxesBlocks","activity/blocks/BooleanBlocks","activity/blocks/HeapBlocks","activity/blocks/DictBlocks","activity/blocks/ExtrasBlocks","activity/blocks/ProgramBlocks","activity/blocks/GraphicsBlocks","activity/blocks/PenBlocks","activity/blocks/MediaBlocks","activity/blocks/SensorsBlocks","activity/blocks/EnsembleBlocks","widgets/widgetWindows","widgets/statistics","widgets/jseditor"],doAnalyzeProject=(_THIS_IS_MUSIC_BLOCKS_&&(MYDEFINES=MYDEFINES.concat(MUSICBLOCKS_EXTRAS=["widgets/modewidget","widgets/meterwidget","widgets/phrasemaker","widgets/arpeggio","widgets/aiwidget","widgets/aidebugger","widgets/pitchdrummatrix","widgets/rhythmruler","widgets/pitchstaircase","widgets/temperament","widgets/tempo","widgets/pitchslider","widgets/musickeyboard","widgets/timbre","widgets/oscilloscope","widgets/sampler","widgets/reflection","widgets/legobricks","activity/lilypond","activity/abc","activity/midi","activity/mxml"])),function(){return analyzeProject(globalActivity)}),Activity=(()=>_createClass(function e(){var E=this,t=(_classCallCheck(this,e),(globalActivity=this)._listeners=[],this.cellSize=55,this.searchSuggestions=[],this.homeButtonContainer,this.msgTimeoutID=null,this.msgText=null,this.errorMsgTimeoutID=null,this.errorMsgText=null,this.errorMsgArrow=null,this.errorArtwork={},this.cartesianBitmap=null,this.polarBitmap=null,this.trebleBitmap=null,this.trebleSharpBitmap=[null,null,null,null,null,null,null],this.trebleFlatBitmap=[null,null,null,null,null,null,null],this.grandBitmap=null,this.grandSharpBitmap=[null,null,null,null,null,null,null],this.grandFlatBitmap=[null,null,null,null,null,null,null],this.sopranoBitmap=null,this.sopranoSharpBitmap=[null,null,null,null,null,null,null],this.sopranoFlatBitmap=[null,null,null,null,null,null,null],this.altoBitmap=null,this.altoSharpBitmap=[null,null,null,null,null,null,null],this.altoFlatBitmap=[null,null,null,null,null,null,null],this.tenorBitmap=null,this.tenorSharpBitmap=[null,null,null,null,null,null,null],this.tenorFlatBitmap=[null,null,null,null,null,null,null],this.bassBitmap=null,this.bassSharpBitmap=[null,null,null,null,null,null,null],this.bassFlatBitmap=[null,null,null,null,null,null,null],["emptybox","emptyheap","negroot","noinput","zerodivide","notanumber","nostack","notastring","nomicrophone"]);window.hidePrintText=function(){globalActivity&&globalActivity.hidePrintText()},window.hideErrorText=function(){globalActivity&&globalActivity.hideErrorText()},this.saveLocally=null,this.scrollBlockContainer=!1,this.blockRefreshCanvas=!1,this.statsWindow=null,this.firstTimeUser=!1,this.beginnerMode=!1,this.runMode="normal",this.keyboardEnableFlag,this.inTempoWidget=!1,this.projectID=null,this.storage=localStorage,this.isDragging=!1,this.isSelecting=!1,this.selectionModeOn=!1,this.isHelpfulSearchWidgetOn=!1,this.isInputON=!1,this.loadAnimationIntervalId=null,this.gifAnimator=new GIFAnimator,this.stageDirty=!1,this.themes=["light","dark"];try{for(var a=0;a<this.themes.length;a++)this.themes[a]===this.storage.themePreference?body.classList.add(this.themes[a]):body.classList.remove(this.themes[a])}catch(e){console.error("Error accessing themePreference storage:",e)}this.beginnerMode=!0;try{void 0===this.storage.beginnerMode?this.firstTimeUser=!0:null!==this.storage.beginnerMode&&(this.beginnerMode=this.storage.beginnerMode,"string"==typeof this.beginnerMode)&&"false"===this.beginnerMode&&(this.beginnerMode=!1)}catch(e){console.error(e)}try{var o="en";void 0!==this.storage.languagePreference?(o=this.storage.languagePreference).startsWith("ja")&&(o="ja"):(o=navigator.language).includes("-")&&(o=o.slice(0,o.indexOf("-"))),i18next.changeLanguage(o)}catch(e){console.error(e)}this.KeySignatureEnv=["C","major",!1];try{void 0!==this.storage.KeySignatureEnv&&(console.log(this.storage.KeySignatureEnv),this.KeySignatureEnv=this.storage.KeySignatureEnv.split(","),this.KeySignatureEnv[2]="true"===this.KeySignatureEnv[2])}catch(e){console.error(e)}this.setupDependencies=function(){E.cleanupEventListeners(),createDefaultStack(),createHelpContent(E),window.scroll(0,0),document.title=TITLESTRING,E.canvas=document.getElementById("myCanvas"),E.fileChooser=document.getElementById("myOpenFile"),E.pluginChooser=document.getElementById("myOpenPlugin"),E.allFilesChooser=document.getElementById("myOpenAll"),E.auxToolbar=document.getElementById("aux-toolbar"),E.errorText=document.getElementById("errorText"),E.errorTextContent=document.getElementById("errorTextContent"),E.addEventListener(E.errorText,"click",E._hideArrows),E.printText=document.getElementById("printText"),E.printTextContent=document.getElementById("printTextContent"),E.server=!0,E.turtleBlocksScale=1,E.mousestage=null,E.stage=null,E.turtles=null,E.palettes=null,E.blocks=null,E.logo=null,E.gif=null,E.pasteBox=null,E.languageBox=null,E.themeBox=null,E.planet=null,window.converter=null,E.buttonsVisible=!0,E.headerContainer=null,E.swiping=!1,E.menuButtonsVisible=!1,E.scrollBlockContainer=!1,E.currentKeyCode=0,E.merging=!1,E.loading=!1,E.smallerContainer=null,E.largerContainer=null,E.resizeDebounce=!1,E.hideBlocksContainer=null,E.collapseBlocksContainer=null,E.searchWidget=document.getElementById("search"),E.searchWidget.style.visibility="hidden",E.searchWidget.placeholder=_("Search for blocks"),E.helpfulSearchWidget=document.createElement("input"),E.helpfulSearchWidget.setAttribute("id","helpfulSearch"),E.helpfulSearchWidget.style.visibility="hidden",E.helpfulSearchWidget.placeholder=_("Search for blocks"),E.helpfulSearchWidget.classList.add("ui-autocomplete"),E.progressBar=document.getElementById("myProgress"),E.progressBar.style.visibility="hidden",new createjs.DOMElement(document.getElementById("paste")),E.paste=document.getElementById("paste"),E.paste.style.visibility="hidden",E.toolbarHeight=document.getElementById("toolbars").offsetHeight,E.helpfulWheelItems=[],E.setHelpfulSearchDiv()};function i(e){e._findBlocks(),"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none",e.__tick())}var n=function(){var e,t;E.stage&&(e=createjs.Tween.hasActiveTweens(),t=E.gifAnimator&&0<E.gifAnimator.getActiveCount(),E.stageDirty||e||t)&&(E.stage.update(),E.stageDirty=!1),requestAnimationFrame(n)};requestAnimationFrame(n),this.setHelpfulSearchDiv=function(){document.getElementById("helpfulSearchDiv")&&document.getElementById("helpfulSearchDiv").parentNode.removeChild(document.getElementById("helpfulSearchDiv")),E.helpfulSearchDiv=document.createElement("div"),E.helpfulSearchDiv.setAttribute("id","helpfulSearchDiv"),document.body.appendChild(E.helpfulSearchDiv);(t=document.createElement("div")).style.cssText="position: absolute;top: 10px;right: 10px;cursor: pointer;";var e=document.createElement("button"),t=(e.textContent="×",e.id="crossButton",document.body.appendChild(e),t.appendChild(e),E.helpfulSearchDiv.appendChild(t),document.getElementById("begIconText"));E.addEventListener(e,"click",E._hideHelpfulSearchWidget),E.addEventListener(t,"click",E._hideHelpfulSearchWidget),E.helpfulSearchDiv.appendChild(E.helpfulSearchWidget)},this._displayHelpfulSearchDiv=function(){document.getElementById("helpfulSearchDiv")||E.setHelpfulSearchDiv(),E.helpfulSearchDiv.style.left=document.getElementById("helpfulWheelDiv").offsetLeft+80*E.getStageScale()+"px",E.helpfulSearchDiv.style.top=document.getElementById("helpfulWheelDiv").offsetTop+110*E.getStageScale()+"px";var e=window.innerWidth,t=window.innerHeight,a=(E.helpfulSearchDiv.style.display="block",E.helpfulSearchDiv.offsetWidth),o=E.helpfulSearchDiv.offsetHeight;E.helpfulSearchDiv.offsetLeft+a>e&&(E.helpfulSearchDiv.style.left=e-a+"px"),E.helpfulSearchDiv.offsetTop+o>t&&(E.helpfulSearchDiv.style.top=t-o+"px"),E.showHelpfulSearchWidget(),E.isHelpfulSearchWidgetOn=!0},this._hideHelpfulSearchWidget=function(e){"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none"),E.helpfulSearchDiv&&E.helpfulSearchDiv.parentNode&&E.helpfulSearchDiv.parentNode.removeChild(E.helpfulSearchDiv),f.__tick()},this.doContextMenus=function(){E.addEventListener(document,"contextmenu",function(e){e.preventDefault(),e.stopPropagation(),E.beginnerMode||(E.isHelpfulSearchWidgetOn&&E._hideHelpfulSearchWidget(),E.blocks.isCoordinateOnBlock(e.clientX,e.clientY))||"myCanvas"!==e.target.id||E._displayHelpfulWheel(e)},!1)},this._displayHelpfulWheel=function(e){document.getElementById("helpfulWheelDiv").style.position="absolute";var t=e.clientX,e=e.clientY,a=E.canvas.offsetLeft+28*E.getStageScale(),o=E.canvas.offsetTop+6*E.getStageScale(),t=Math.max(Math.round(t*E.getStageScale()+a)-150,a),a=Math.max(Math.round(e*E.getStageScale()+o)-150,o),e=(document.getElementById("helpfulWheelDiv").style.left=t+"px",document.getElementById("helpfulWheelDiv").style.top=a+"px",window.innerWidth-20),o=window.innerHeight-20,n=(e<t+350&&(document.getElementById("helpfulWheelDiv").style.left=e-350+"px"),o<a+350&&(document.getElementById("helpfulWheelDiv").style.top=o-350+"px"),document.getElementById("helpfulWheelDiv").style.display="",new wheelnav("helpfulWheelDiv",null,300,300)),t=(n.colors=platformColor.wheelcolors,n.slicePathFunction=slicePath().DonutSlice,n.slicePathCustom=slicePath().DonutSliceCustomization(),n.slicePathCustom.minRadiusPercent=.45,n.slicePathCustom.maxRadiusPercent=1,n.sliceSelectedPathCustom=n.slicePathCustom,n.sliceInitPathCustom=n.slicePathCustom,n.clickModeRotate=!1,E.helpfulWheelItems.filter(function(e){return e.display})),l=(n.initWheel(t.map(function(e){return e.icon})),n.createWheel(),n.navItems[0].selected=!1,t.forEach(function(e,t){n.navItems[t].setTooltip(_(e.label)),n.navItems[t].navigateFunction=function(){return e.fn(E)}}),function(e){helpfulWheelDiv.contains(e.target)||(helpfulWheelDiv.style.display="none",E.removeEventListener(document,"click",l))});E.addEventListener(document,"click",l)},this.doPluginsAndPaletteCols=function(){for(var e in platformColor.paletteColors)PALETTEFILLCOLORS[e]=platformColor.paletteColors[e][0],PALETTESTROKECOLORS[e]=platformColor.paletteColors[e][1],PALETTEHIGHLIGHTCOLORS[e]=platformColor.paletteColors[e][2],HIGHLIGHTSTROKECOLORS[e]=platformColor.paletteColors[e][1];E.pluginObjs={PALETTEPLUGINS:{},PALETTEFILLCOLORS:{},PALETTESTROKECOLORS:{},PALETTEHIGHLIGHTCOLORS:{},FLOWPLUGINS:{},ARGPLUGINS:{},BLOCKPLUGINS:{},MACROPLUGINS:{},ONLOAD:{},ONSTART:{},ONSTOP:{}},E.macroDict={},E.DEFAULTDELAY=500,E.TURTLESTEP=-1,E.blockscale=BLOCKSCALES.indexOf(DEFAULTBLOCKSCALE),-1===E.blockscale&&(E.blockscale=1),E.stageMouseDown=!1,E.stageX=0,E.stageY=0;var t=1200===screen.width&&900===screen.height||900===screen.width&&1200===screen.height;E.cellSize=55,t&&(E.cellSize=75),E.onscreenButtons=[],E.onscreenMenu=[],E.firstRun=!0,E.pluginsImages={}};function p(r){var c=window.innerWidth,t=new Set,a=[];Object.values(r.blocks.blockList).forEach(function(e){t.has(e.id)||(r.blocks.findDragGroup(e.id),0<r.blocks.dragGroup.length&&(a.push(_toConsumableArray(r.blocks.dragGroup)),r.blocks.dragGroup.forEach(function(e){return t.add(e)})))}),a.forEach(function(e){(s=r.blocks.blockList[e[0]]).initialPosition||(s.initialPosition={x:s.container.x,y:s.container.y}),c<RESPONSIVE_BREAKPOINT_TABLET&&!s.beforeMobilePosition&&(s.beforeMobilePosition={x:s.container.x,y:s.container.y}),RESPONSIVE_BREAKPOINT_TABLET<=c&&s.beforeMobilePosition&&(t=s.beforeMobilePosition.x-s.container.x,a=s.beforeMobilePosition.y-s.container.y,e.forEach(function(e){(e=r.blocks.blockList[e]).container.x+=t,e.container.y+=a}),s.beforeMobilePosition=null),c<RESPONSIVE_BREAKPOINT_MOBILE&&!s.before600pxPosition&&(s.before600pxPosition={x:s.container.x,y:s.container.y}),RESPONSIVE_BREAKPOINT_MOBILE<=c&&s.before600pxPosition&&(o=s.before600pxPosition.x-s.container.x,n=s.before600pxPosition.y-s.container.y,e.forEach(function(e){(e=r.blocks.blockList[e]).container.x+=o,e.container.y+=n}),s.before600pxPosition=null);var t,a,o,n,l,i,s=Math.max.apply(Math,_toConsumableArray(e.map(function(e){return r.blocks.blockList[e].container.x+r.blocks.blockList[e].width})));c<s&&(l=Math.max(10,c-s-10),e.forEach(function(e){r.blocks.blockList[e].container.x+=l})),(s=Math.min.apply(Math,_toConsumableArray(e.map(function(e){return r.blocks.blockList[e].container.x}))))<0&&(i=100-s,e.forEach(function(e){r.blocks.blockList[e].container.x+=i}))}),r._findBlocks()}this._handleRepositionBlocksOnResize=function(){return p(E)},this.addEventListener(window,"resize",this._handleRepositionBlocksOnResize),this._findBlocks=function(){E.blocks.visible||E._changeBlockVisibility(),E.blocks.activeBlock=null,hideDOMLabel(),E.blocks.showBlocks(),E.blocksContainer.x=0,E.blocksContainer.y=0;var n,e=window.innerWidth,l=e<RESPONSIVE_BREAKPOINT_MOBILE,t=l?1:Math.floor(e/400),a="block"===E.auxToolbar.style.display?90+E.toolbarHeight:90,i=l?Math.floor(e/2):Math.floor(E.canvas.width/4),s=Math.floor(a*E.turtleBlocksScale),r=Math.floor(40*E.turtleBlocksScale),o=e/t*1.2,c=Array.from({length:t},function(e,t){return Math.floor(t*o+o/2)}),u=Array(t).fill(s);for(n in E.blocks.blockList)(()=>{var t,e,a,o;E.blocks.blockList[n].trash||((t=E.blocks.blockList[n]).originalPosition||(t.originalPosition={x:t.container.x,y:t.container.y}),null===t.connections[0]&&(l?(e=i-t.container.x,a=s-t.container.y,E.blocks.moveBlockRelative(n,e,a),s+=t.height+r):(e=u.indexOf(Math.min.apply(Math,_toConsumableArray(u))),a=c[e]-t.container.x,o=u[e]-t.container.y,E.blocks.moveBlockRelative(n,a,o),u[e]+=t.height+r)),0<t.connections.length&&t.connections.forEach(function(e){null!==e&&(e=E.blocks.blockList[e])&&(e.container.x=t.container.x+e.relativeX,e.container.y=t.container.y+e.relativeY)}))})();p(E),E.setHomeContainers(!1),E.boundary.hide();for(var d=0;d<E.turtles.turtleList.length;d++){var g=E.turtles.turtleList[d].painter.penState;E.turtles.turtleList[d].painter.penState=!1,E.turtles.turtleList[d].painter.doSetXY(0,0),E.turtles.turtleList[d].painter.doSetHeading(0),E.turtles.turtleList[d].painter.penState=g}},this._isFirstHomeClick=!0,this._findBlocks=function(){if(E.blocks.visible||E._changeBlockVisibility(),E.blocks.activeBlock=null,hideDOMLabel(),E.blocks.showBlocks(),E.blocksContainer.x=0,E.blocksContainer.y=0,E._isFirstHomeClick){var e,t,a="block"===E.auxToolbar.style.display?90+E.toolbarHeight:90,o=Math.floor(E.canvas.width/4),n=(E.palettes.updatePalettes(),Math.floor(o*E.turtleBlocksScale)),l=Math.floor(a*E.turtleBlocksScale),i=!0;for(e in E.blocks.blockList)if(!E.blocks.blockList[e].trash){var s=E.blocks.blockList[e];if("start"===s.name&&null===s.connections[0]){var r=n-s.container.x,c=l-s.container.y;if(E.blocks.moveBlockRelative(e,r,c),E.blocks.findDragGroup(e),0<E.blocks.dragGroup.length)for(var u=0;u<E.blocks.dragGroup.length;u++){var d=E.blocks.dragGroup[u];0!==u&&E.blocks.moveBlockRelative(d,r,c)}(n+=Math.floor(150*E.turtleBlocksScale))>7*E.canvas.width/8/E.turtleBlocksScale&&(n=(i=!i)?Math.floor(o):Math.floor(o+STANDARDBLOCKHEIGHT),l+=STANDARDBLOCKHEIGHT)}}for(t in E.blocks.blockList)if(!E.blocks.blockList[t].trash){var g=E.blocks.blockList[t];if("start"!==g.name&&null===g.connections[0]){var p=n-g.container.x,h=l-g.container.y;if(E.blocks.moveBlockRelative(t,p,h),E.blocks.findDragGroup(t),0<E.blocks.dragGroup.length)for(var M=0;M<E.blocks.dragGroup.length;M++){var m=E.blocks.dragGroup[M];0!==M&&E.blocks.moveBlockRelative(m,p,h)}(n+=Math.floor(150*E.turtleBlocksScale))>7*E.canvas.width/8/E.turtleBlocksScale&&(n=(i=!i)?Math.floor(o):Math.floor(o+STANDARDBLOCKHEIGHT),l+=STANDARDBLOCKHEIGHT)}}}else{var b,a="block"===E.auxToolbar.style.display?90+E.toolbarHeight:90,y=(w=window.innerWidth)<=320?1:Math.floor(w/320),k=w/y*1.2,w=Math.floor(a*E.turtleBlocksScale),v=1.2*Math.floor(20*E.turtleBlocksScale),T=Array.from({length:y},function(e,t){return Math.floor(t*k+k/2)}),D=Array(y).fill(w);for(b in E.blocks.blockList)if(!E.blocks.blockList[b].trash){var A=E.blocks.blockList[b];if(null===A.connections[0]){for(var L=0,f=1;f<y;f++)D[f]<D[L]&&(L=f);var N=T[L]-A.container.x,I=D[L]-A.container.y;if(E.blocks.moveBlockRelative(b,N,I),E.blocks.findDragGroup(b),0<E.blocks.dragGroup.length)for(var C=0;C<E.blocks.dragGroup.length;C++){var S=E.blocks.dragGroup[C];0!==C&&E.blocks.moveBlockRelative(S,N,I)}D[L]+=A.height+v}}}E.setHomeContainers(!1),E.boundary.hide();for(var B=0;B<E.turtles.getTurtleCount();B++){var O=E.turtles.getTurtle(B),j=O.painter.penState;O.painter.penState=!1,O.painter.doSetXY(0,0),O.painter.doSetHeading(0),O.painter.penState=j}E._isFirstHomeClick=!E._isFirstHomeClick},this.setHomeContainers=function(e){null!==E.homeButtonContainer&&(e?changeImage(E.homeButtonContainer.children[0],GOHOMEFADEDBUTTON,GOHOMEBUTTON):changeImage(E.homeButtonContainer.children[0],GOHOMEBUTTON,GOHOMEFADEDBUTTON))},this.__saveHelpBlock=function(n,e){var l=E;setTimeout(function(){l.sendAllToTrash(!1,!0),setTimeout(function(){var e,t,a,o=l.blocks.protoBlockDict[n].helpString;o.length<4?(a=(e=l.palettes.getProtoNameAndPalette(n))[0],t=e[1],l.blocks.protoBlockDict.hasOwnProperty(e=e[2])&&l.palettes.dict[t].makeBlockFromSearch(a,e,function(e){l.blocks.moveBlock(e,0,0)})):"string"==typeof o[3]?(t=getMacroExpansion(l,o[3],0,0),l.blocks.loadNewBlocks(t)):(a=o[3],l.blocks.loadNewBlocks(a)),setTimeout(function(){console.log("Saving help artwork: "+n+"_block.svg");var e="data:image/svg+xml;utf8,"+l.printBlockSVG();l.save.download("svg",e,n+"_block.svg")},500)},500)},e+1e3)},this._saveHelpBlocks=function(){var e,t=[];for(e in E.blocks.protoBlockDict)void 0!==E.blocks.protoBlockDict[e].helpString&&0!==E.blocks.protoBlockDict[e].helpString.length&&t.push(e);var a,o=0;for(a in t)E.__saveHelpBlock(t[a],2e3*o),o+=1;E.sendAllToTrash(!0,!0)},this.printBlockSVG=function(){E.blocks.activeBlock=null;for(var e=0,t="",a=0,o=0,n=0;n<E.blocks.blockList.length;n++)if(!E.blocks.blockList[n].ignore()){if(E.blocks.blockList[n].container.x+E.blocks.blockList[n].width>a&&(a=E.blocks.blockList[n].container.x+E.blocks.blockList[n].width),E.blocks.blockList[n].container.y+E.blocks.blockList[n].height>o&&(o=E.blocks.blockList[n].container.y+E.blocks.blockList[n].height),r=(E.blocks.blockList[n].collapsed?E.blocks.blockCollapseArt:E.blocks.blockArt)[n].split("><"),E.blocks.blockList[n].isCollapsible()&&(t+="<g>"),t+='<g transform="translate('+E.blocks.blockList[n].container.x+", "+E.blocks.blockList[n].container.y+')">',SPECIALINPUTS.includes(E.blocks.blockList[n].name))for(var l=1;l<r.length;l++)1===l?t+="<"+r[l]+"><":2!==l&&(3===l?t+=r[l].replace("filter:url(#dropshadow);","")+"><":5===l?"string"==typeof E.blocks.blockList[n].value?t+=r[l]+">"+_(E.blocks.blockList[n].value)+"<":t+=r[l]+">"+E.blocks.blockList[n].value+"<":l===r.length-2?t+=r[l]+">":l!==r.length-1&&(t+=r[l]+"><"));else for(var i=1;i<r.length;i++)1===i?t+="<"+r[i]+"><":2!==i&&(3===i?t+=r[i].replace("filter:url(#dropshadow);","")+"><":i===r.length-2?t+=r[i]+">":i!==r.length-1&&(t+=r[i]+"><"));if(t+="</g>",E.blocks.blockList[n].isCollapsible()){var s=void 0,s=INLINECOLLAPSIBLES.includes(E.blocks.blockList[n].name)?E.blocks.blockList[n].container.y+4:E.blocks.blockList[n].container.y+12;t+='<g transform="translate('+E.blocks.blockList[n].container.x+", "+s+') scale(0.5 0.5)">';for(var r=(E.blocks.blockList[n].collapsed?EXPANDBUTTON:COLLAPSEBUTTON).split("><"),c=2;c<r.length-1;c++)t+="<"+r[c]+">";t+="</g>"}if("start"===E.blocks.blockList[n].name){t+='<g transform="translate('+(E.blocks.blockList[n].container.x+110)+", "+(E.blocks.blockList[n].container.y+12)+') scale(0.4 0.4)">',r=TURTLESVG.replace(/fill_color/g,FILLCOLORS[e]).replace(/stroke_color/g,STROKECOLORS[e]).split("><"),9<(e+=1)&&(e=0);for(var u=2;u<r.length-1;u++)t+="<"+r[u]+">";t+="</g>"}E.blocks.blockList[n].isCollapsible()&&(t+="</g>")}return t+="</svg>",'<svg xmlns="http://www.w3.org/2000/svg" width="'+a+'" height="'+o+'">'+encodeURIComponent(t)},this.printBlockPNG=_asyncToGenerator(_regenerator().m(function e(){var t,o,n,a,l,i,s;return _regenerator().w(function(e){for(;;)if(0===e.n)return t=E.printBlockSVG(),o=document.createElement("canvas"),n=o.getContext("2d"),a=(a=(a=new DOMParser).parseFromString(decodeURIComponent(t),"image/svg+xml")).documentElement,i=parseInt(a.getAttribute("width"),10),a=parseInt(a.getAttribute("height"),10),o.width=i,o.height=a,l=new Image,i=new Blob([decodeURIComponent(t)],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(i),e.a(2,new Promise(function(t,a){l.onload=function(){n.drawImage(l,0,0),URL.revokeObjectURL(s);var e=o.toDataURL("image/png");t(e)},l.onerror=function(e){URL.revokeObjectURL(s),a(e)},l.src=s}))},e)}));function h(t){if(!document.getElementById("import-midi")){var a=document.createElement("div"),e=(a.classList.add("modalBox"),a.id="import-midi",document.createElement("h2"));e.textContent=_("Import MIDI"),e.classList.add("modal-title"),a.appendChild(e);(e=document.createElement("div")).classList.add("message-container");var o=document.createElement("p"),n=(o.textContent=_("Set the max blocks to generate :"),o.classList.add("modal-message"),e.appendChild(o),document.createElement("select"));n.classList.add("block-count-dropdown");for(var l=1;l<=12;l++){var i=document.createElement("option");i.value=100*l,i.textContent=100*l,n.appendChild(i)}e.appendChild(n),a.appendChild(e),(o=document.createElement("button")).classList.add("confirm-button"),o.textContent=_("Confirm"),o.addEventListener("click",function(){var e=n.value;transcribeMidi(t,e),document.body.removeChild(a)}),a.appendChild(o),(e=document.createElement("button")).classList.add("cancel-button"),e.textContent=_("Cancel"),e.addEventListener("click",function(){document.body.removeChild(a)}),a.appendChild(e),document.body.appendChild(a)}}function M(e,t){e.runMode="normal",e._doFastButton(t)}this._allClear=function(a){function e(){E.blocks.activeBlock=null,hideDOMLabel(),E.gifAnimator&&(E.gifAnimator.stopAll(),t=document.getElementById("overlayCanvas"))&&t.getContext("2d").clearRect(0,0,t.width,t.height),E.logo.boxes={},E.logo.time=0,E.hideMsgs(),E.hideGrids(),E.turtles.setBackgroundColor(-1),E.logo.svgOutput="",E.logo.notationOutput="",E.logo.recordingBuffer.hasData=!1,E.logo.recordingBuffer.notationOutput="",E.logo.recordingBuffer.notationNotes={},E.logo.recordingBuffer.notationStaging={},E.logo.recordingBuffer.notationDrumStaging={};for(var e=0;e<E.turtles.getTurtleCount();e++)E.logo.turtleHeaps[e]=[],E.logo.turtleDicts[e]={},E.logo.notation.notationStaging[e]=[],E.logo.notation.notationDrumStaging[e]=[],void 0!==a&&a||E.turtles.getTurtle(e).painter.doClear(!0,!0,!0);E.blocksContainer.x=0,E.blocksContainer.y=0,Element.prototype.remove=function(){E.parentElement.removeChild(E)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var e=0,t=E.length;e<t;e++)E[e]&&E[e].parentElement&&E[e].parentElement.removeChild(E[e])};var t=document.getElementById("myTable");null!==t&&t.remove(),"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none",E.__tick())}var t,o,n,l,i;1<arguments.length&&void 0!==arguments[1]&&arguments[1]?e():(t=e,document.getElementById("clear-confirm")||((o=document.createElement("div")).classList.add("modalBox"),o.id="clear-confirm",(n=document.createElement("h2")).textContent=_("Clear Workspace"),n.classList.add("modal-title"),o.appendChild(n),(n=document.createElement("p")).textContent=_("Are you sure you want to clear the workspace?"),n.classList.add("modal-message"),o.appendChild(n),(n=document.createElement("div")).classList.add("clear-button-container"),(l=document.createElement("button")).classList.add("confirm-button"),l.textContent=_("Confirm"),l.style.backgroundColor=platformColor.blueButton,l.style.color="white",l.style.border="none",l.style.borderRadius="4px",l.style.padding="8px 16px",l.style.fontWeight="bold",l.style.cursor="pointer",l.style.marginRight="16px",E.addEventListener(l,"click",function(){document.body.removeChild(o),t()}),(i=document.createElement("button")).classList.add("cancel-button"),i.textContent=_("Cancel"),i.style.backgroundColor="#f1f1f1",i.style.color="black",i.style.border="none",i.style.borderRadius="4px",i.style.padding="8px 16px",i.style.fontWeight="bold",i.style.cursor="pointer",E.addEventListener(i,"click",function(){document.body.removeChild(o)}),n.appendChild(l),n.appendChild(i),o.appendChild(n),document.body.appendChild(o)))};function m(e){g||(g=!0,e._doRecordButton())}function b(e){e.runMode="slow",e._doSlowButton()}function y(e){e.runMode="step",e._doStepButton()}function z(e){e.toolbar.renderSaveIcons(e.save.saveHTML.bind(e.save),doSVG,e.save.saveSVG.bind(e.save),e.save.saveMIDI.bind(e.save),e.save.savePNG.bind(e.save),e.save.saveWAV.bind(e.save),e.save.saveLilypond.bind(e.save),e.save.afterSaveLilypondLY.bind(e.save),e.save.saveAbc.bind(e.save),e.save.saveMxml.bind(e.save),e.save.saveBlockArtwork.bind(e.save),e.save.saveBlockArtworkPNG.bind(e.save)),e.regeneratePalettes&&e.regeneratePalettes(),e.refreshCanvas()}function k(e){e._setScroller(),e._setupBlocksContainerEvents(),"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none")}function W(e){e._deletePlugin()}this._doFastButton=function(e){E._onResize(),E.blocks.activeBlock=null,hideDOMLabel();for(var t,a=E.logo.turtleDelay,o=(E.logo.turtleDelay=0,E.logo.synth.resume(),document.getElementsByClassName("wftTitle")),n=0;n<o.length;n++)if("tempo"===o[n].innerHTML){E.logo.tempo.isMoving&&E.logo.tempo.pause(),E.logo.tempo.resume();break}E.turtles.running()?0!==a?E.logo.step():(document.getElementById("stop").style.color="white",E.logo.doStopTurtles(),t=E,setTimeout(function(){document.getElementById("stop").style.color="#ea174c",t.logo.runLogoCommands(null,e)},500)):(E.turtles.isShrunk()||(E.blocks.hideBlocks(),E.showBlocksAfterRun=!0),E.logo.runLogoCommands(null,e))};var l,g=!1,w=(this._doRecordButton=function(){var o,n=document.getElementById("record"),l=document.getElementById("rec_inside"),e=new Event("click"),i=0;function s(){return(s=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return i=1,e.n=1,navigator.mediaDevices.getDisplayMedia({preferCurrentTab:"True",systemAudio:"include",audio:"True",video:{mediaSource:"tab"},bandwidthProfile:{video:{clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto"}},preferredVideoCodecs:"auto"});case 1:return e.a(2,e.v)}},e)}))).apply(this,arguments)}var r=E;function c(){i=0,o.stop();var e=document.createElement("p");e.textContent="Stopped recording",document.body.appendChild(e)}function u(e,t){i=1,l.classList.add("blink"),n.removeEventListener("click",u,!0);var o=[],a=new MediaRecorder(e);return e.oninactive=function(){console.log("Recording is ready to save"),c(),i=0},a.onstop=function(){var e,t,a;e=o,i=1,l.classList.remove("blink"),e=new Blob(e,{type:"video/webm"}),null===(a=window.prompt(_("Enter file name")))||""===a.trim()?(alert(_("File save canceled")),i=0,d(),m()):((t=document.createElement("a")).href=URL.createObjectURL(e),t.download="".concat(a,".webm"),document.body.appendChild(t),t.click(),URL.revokeObjectURL(e),document.body.removeChild(t),i=0,d(),m(),r.textMsg(_("Click on stop saving"))),o=[],i=0,l.setAttribute("fill","#ffffff")},a.ondataavailable=function(e){0<e.data.size&&o.push(e.data)},a.start(200),setTimeout(function(){console.log("Resizing for Record",r.canvas.height),r._onResize()},500),a}function d(){n.addEventListener("click",(()=>{var e=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,function(){return s.apply(this,arguments)}();case 1:t=e.v,o=u(t),1==i&&this.removeEventListener("click",a),(t=document.createElement("p")).textContent="Started recording",document.body.appendChild(t),l.setAttribute("fill","red");case 2:return e.a(2)}},e,this)}));function a(){return e.apply(this,arguments)}return a})())}0==i&&g&&(d(),n.dispatchEvent(e),i=1),1==i&&g&&(n.addEventListener("click",c),i=0)},this._doSlowButton=function(){E.blocks.activeBlock=null,hideDOMLabel(),E.logo.turtleDelay=DEFAULTDELAY,E.logo.synth.resume(),E.turtles.running()?E.logo.step():E.logo.runLogoCommands()},this._doStepButton=function(){E.blocks.activeBlock=null,hideDOMLabel();var e=Object.keys(E.logo.stepQueue).length;E.logo.synth.resume(),0===e||E.logo.turtleDelay!==E.TURTLESTEP?(E.logo.turtleDelay=E.TURTLESTEP,E.turtles.running()||(E.logo.runLogoCommands(),document.getElementById("stop").style.color=E.toolbar.stopIconColorWhenPlaying),E.logo.step()):Object.keys(E.logo.stepQueue).every(function(e){return 0===E.logo.stepQueue[e].length})?(E.logo.doStopTurtles(),document.getElementById("stop").style.color="white"):(E.logo.turtleDelay=E.TURTLESTEP,E.logo.step())},function(e,t){e._doHardStopButton(t)}),c=(this._doHardStopButton=function(e){if(E.blocks.activeBlock=null,hideDOMLabel(),!(e=void 0!==e&&e)||!_THIS_IS_MUSIC_BLOCKS_){E.logo.doStopTurtles();for(var t=document.getElementsByClassName("wftTitle"),a=0;a<t.length;a++)if("tempo"===t[a].innerHTML){E.logo.tempo.isMoving&&E.logo.tempo.pause();break}}},this._setScroller=function(){E.blocks.activeBlock=null,E.scrollBlockContainer=!E.scrollBlockContainer;var e=document.getElementById("enableHorizScrollIcon"),t=document.getElementById("disableHorizScrollIcon");E.scrollBlockContainer&&!E.beginnerMode?(e.style.display="none",t.style.display="block",E.helpfulWheelItems.forEach(function(e){"Enable horizontal scrolling"===e.label?e.display=!1:"Disable horizontal scrolling"===e.label&&(e.display=!0)}),activity.textMsg("Horizontal scrolling enabled.",3e3)):(e.style.display="block",t.style.display="none",E.helpfulWheelItems.forEach(function(e){"Enable horizontal scrolling"===e.label?e.display=!0:"Disable horizontal scrolling"===e.label&&(e.display=!1)}),activity.textMsg("Horizontal scrolling disabled.",3e3))},this.doLoadAnimation=function(){var t={load_messages:[_("Catching mice"),_("Cleaning the instruments"),_("Testing key pieces"),_("Sight-reading"),_("Combining math and music"),_("Generating more blocks"),_("Do Re Mi Fa Sol La Ti Do"),_("Tuning string instruments"),_("Pressing random keys")]},a=(document.getElementById("load-container").style.display="block",0);E.loadAnimationIntervalId=setInterval(function(){var e=t.load_messages[Math.floor(Math.random()*t.load_messages.length)];document.getElementById("messageText").innerHTML=e+"...",++a>=t.load_messages.length&&(a=0)},2e3)},this.stopLoadAnimation=function(){null!==E.loadAnimationIntervalId&&(clearInterval(E.loadAnimationIntervalId),E.loadAnimationIntervalId=null);var e=document.getElementById("load-container");e&&(e.style.display="none")},(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t._doLargerBlocks();case 1:"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none",t.__tick());case 2:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})()),u=(this._doLargerBlocks=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(E.blocks.activeBlock=null,E.resizeDebounce)e.n=3;else{if(E.blockscale<BLOCKSCALES.length-1)return E.resizeDebounce=!0,E.blockscale+=1,E.clearCache(),e.n=1,E.blocks.setBlockScale(BLOCKSCALES[E.blockscale]);e.n=2}break;case 1:E.blocks.checkBounds(),E.refreshCanvas();case 2:t=E,setTimeout(function(){t.resizeDebounce=!1},200);case 3:return e.n=4,E.setSmallerLargerStatus();case 4:return e.n=5,E.stage.update();case 5:return e.a(2)}},e)})),(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t._doSmallerBlocks();case 1:"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none",t.__tick());case 2:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})()),s=(this._doSmallerBlocks=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(E.blocks.activeBlock=null,E.resizeDebounce)e.n=3;else{if(0<E.blockscale)return E.resizeDebounce=!0,--E.blockscale,E.clearCache(),e.n=1,E.blocks.setBlockScale(BLOCKSCALES[E.blockscale]);e.n=2}break;case 1:E.blocks.checkBounds(),E.refreshCanvas();case 2:t=E,setTimeout(function(){t.resizeDebounce=!1},200);case 3:return e.n=4,E.setSmallerLargerStatus();case 4:return e.n=5,E.stage.update();case 5:return e.a(2)}},e)})),this.setSmallerLargerStatus=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(BLOCKSCALES[E.blockscale]<DEFAULTBLOCKSCALE)return e.n=1,changeImage(E.smallerContainer.children[0],SMALLERBUTTON,SMALLERDISABLEBUTTON);e.n=2;break;case 1:e.n=3;break;case 2:return e.n=3,changeImage(E.smallerContainer.children[0],SMALLERDISABLEBUTTON,SMALLERBUTTON);case 3:if(4===BLOCKSCALES[E.blockscale])return e.n=4,changeImage(E.largerContainer.children[0],BIGGERBUTTON,BIGGERDISABLEBUTTON);e.n=5;break;case 4:e.n=6;break;case 5:return e.n=6,changeImage(E.largerContainer.children[0],BIGGERDISABLEBUTTON,BIGGERBUTTON);case 6:return e.a(2)}},e)})),this._deletePlugin=function(){if(null!==E.palettes.activePalette){var e=JSON.parse(E.storage.plugins);E.palettes.activePalette in e.PALETTEPLUGINS&&delete e.PALETTEPLUGINS[E.palettes.activePalette],E.palettes.activePalette in e.PALETTEFILLCOLORS&&delete e.PALETTEFILLCOLORS[E.palettes.activePalette],E.palettes.activePalette in e.PALETTESTROKECOLORS&&delete e.PALETTESTROKECOLORS[E.palettes.activePalette],E.palettes.activePalette in e.PALETTEHIGHLIGHTCOLORS&&delete e.PALETTEHIGHLIGHTCOLORS[E.palettes.activePalette];for(var t=0;t<E.palettes.dict[E.palettes.activePalette].protoList.length;t++){var a=E.palettes.dict[E.palettes.activePalette].protoList[t].name;a in e.FLOWPLUGINS&&(console.log("deleting "+a),delete e.FLOWPLUGINS[a]),a in e.BLOCKPLUGINS&&(console.log("deleting "+a),delete e.BLOCKPLUGINS[a]),a in e.ARGPLUGINS&&(console.log("deleting "+a),delete e.ARGPLUGINS[a])}E.palettes.activePalette in e.MACROPLUGINS&&delete e.MACROPLUGINS[E.palettes.activePalette],E.palettes.activePalette in e.ONLOAD&&delete e.ONLOAD[E.palettes.activePalette],E.palettes.activePalette in e.ONSTART&&delete e.ONSTART[E.palettes.activePalette],E.palettes.activePalette in e.ONSTOP&&delete e.ONSTOP[E.palettes.activePalette],E.storage.plugins=JSON.stringify(e),E.textMsg(E.palettes.activePalette+" "+_("plugins will be removed upon restart."))}},this.hideGrids=function(){E.turtles.setGridLabel(_("show Cartesian")),E._hideCartesian(),E._hidePolar(),_THIS_IS_MUSIC_BLOCKS_&&(E._hideTreble(),E._hideGrand(),E._hideSoprano(),E._hideAlto(),E._hideTenor(),E._hideBass())},this._doCartesianPolar=function(){switch(E.turtles.currentGrid){case 1:E._hideCartesian();break;case 2:E._hideCartesian(),E._hidePolar();break;case 3:E._hidePolar();break;case 4:E._hideTreble();break;case 5:E._hideGrand();break;case 6:E._hideSoprano();break;case 7:E._hideAlto();break;case 8:E._hideTenor();break;case 9:E._hideBass()}switch(E.turtles.gridWheel.selectedNavItemIndex){case 1:E._showCartesian();break;case 2:E._showCartesian(),E._showPolar();break;case 3:E._showPolar();break;case 4:E._showTreble();break;case 5:E._showGrand();break;case 6:E._showSoprano();break;case 7:E._showAlto();break;case 8:E._showTenor();break;case 9:E._showBass()}E.turtles.currentGrid=E.turtles.gridWheel.selectedNavItemIndex,E.update=!0},this._setupBlocksContainerEvents=function(){function t(e){i.stageMouseDown=!1,i.moving=!1,null===i.stage.getObjectUnderPoint()&&a.delta<4&&(i.stageX=e.stageX,i.stageY=e.stageY)}var i=E,a={x:0,y:0,delta:0},s=function(){["wheelDiv","contextWheelDiv","helpfulWheelDiv","textLabel","numberLabel"].forEach(function(e){(e=document.getElementById(e))&&(e.style.display="none")})},o=function(e){var t=0,a=0,o=0,n=0;return"detail"in e&&(a=e.detail),"wheelDelta"in e&&(a=-e.wheelDelta/120),"wheelDeltaY"in e&&(a=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=a,a=0),o=10*t,n=10*a,"deltaY"in e&&(n=e.deltaY),((o="deltaX"in e?e.deltaX:o)||n)&&e.deltaMode&&(1===e.deltaMode?(o*=40,n*=40):(o*=800,n*=800)),o&&!t&&(t=o<1?-1:1),n&&!a&&(a=n<1?-1:1),{pixelX:o,pixelY:n}},e=document.getElementById("myCanvas"),r=[[null,null],[null,null]];e.addEventListener("touchstart",function(e){if(2===e.touches.length)for(var t=0;t<2;t++)r[t][0]=e.touches[t].clientY,r[t][1]=e.touches[t].clientX}),e.addEventListener("touchmove",function(e){if(2===e.touches.length){for(var t=0;t<2;t++){var a,o,n=e.touches[t].clientY,l=e.touches[t].clientX;null!==r[t][0]&&null!==r[t][1]&&(a=n-r[t][0],o=l-r[t][1],0!=a&&(s(),i.blocksContainer.y-=a),i.scrollBlockContainer&&0!=o&&(s(),i.blocksContainer.x-=o),r[t][0]=n,r[t][1]=l)}i.refreshCanvas()}}),e.addEventListener("touchend",function(){for(var e=0;e<2;e++)r[e][0]=null,r[e][1]=null}),E.addEventListener(document.getElementById("myCanvas"),"wheel",function(e){var t=(a=o(e)).pixelY,a=a.pixelX;e.ctrlKey?(e.preventDefault(),(t<0?c:u)(i)):(s(),i.scrollBlockContainer?(0!==t&&(i.blocksContainer.y-=t),0!==a&&(i.blocksContainer.x-=a)):e.axis===e.VERTICAL_AXIS&&0!==t&&(i.blocksContainer.y-=t)),i.refreshCanvas()},!1),E.stage.on("stagemousemove",function(e){i.stageX=e.stageX,i.stageY=e.stageY}),E.stage.on("stagemousedown",function(e){i.stageMouseDown=!0,null!==i.stage.getObjectUnderPoint()|i.turtles.running()||(i.moving=!0,a={x:e.stageX,y:e.stageY,delta:0},hideDOMLabel(),i.stage.removeAllEventListeners("stagemousemove"),i.stage.on("stagemousemove",function(e){var t;i.stageX=e.stageX,i.stageY=e.stageY,i.moving&&(i.blocks.activeBlock=null,t=Math.abs(e.stageX-a.x)+Math.abs(e.stageY-a.y),i.scrollBlockContainer&&(i.blocksContainer.x+=e.stageX-a.x),i.blocksContainer.y+=e.stageY-a.y,a={x:e.stageX,y:e.stageY,delta:a.delta+t},i.refreshCanvas())})),i.stage.removeAllEventListeners("stagemouseup"),i.stage.on("stagemouseup",t)})},this.getStageScale=function(){return E.turtleBlocksScale},this.getStageX=function(){return E.turtles.screenX2turtleX(E.stageX/E.turtleBlocksScale)},this.getStageY=function(){return E.turtles.screenY2turtleY((E.stageY-E.toolbarHeight)/E.turtleBlocksScale)},this.getStageMouseDown=function(){return E.stageMouseDown},this._createGrid=function(e){(t=new Image).src=e;var e=new createjs.Container,t=(E.stage.addChild(e),new createjs.Bitmap(t));return e.addChild(t),t.cache(0,0,1200,900),t.x=(E.canvas.width-1200)/2,t.y=(E.canvas.height-900)/2,t.scaleX=t.scaleY=t.scale=1,t.visible=!1,t.updateCache(),t},this._createMsgContainer=function(e,t,a,o){var n=new createjs.Container,l=(E.stage.addChild(n),n.x=E.canvas.width/2,n.y=o,n.visible=!1,new Image),o=MSGBLOCK.replace("fill_color",e).replace("stroke_color",t),i=E;l.onload=function(){var e=new createjs.Bitmap(l),e=(n.addChild(e),new createjs.Text("your message here","20px Arial","#000000")),t=(n.addChild(e),e.textAlign="center",e.textBaseline="alphabetic",e.x=500,e.y=30,n.getBounds());n.cache(t.x,t.y,t.width,t.height),(t=new createjs.Shape).graphics.beginFill("#FFF").drawRect(0,0,1e3,42),t.x=0,t.y=0,n.hitArea=t,n.on("click",function(){n.visible=!1,null!==i.errorMsgArrow&&i.errorMsgArrow.removeAllChildren(),i.update=!0}),a(e),i.msgText=e},l.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(o))},this._createErrorContainers=function(){for(var e=0;e<t.length;e++)E._makeErrorArtwork(t[e])},this._makeErrorArtwork=function(e){var o=new createjs.Container,n=(E.stage.addChild(o),o.x=E.canvas.width/2,o.y=80,E.errorArtwork[e]=o,E.errorArtwork[e].name=e,E.errorArtwork[e].visible=!1,new Image);n.onload=function(){var e=new createjs.Bitmap(n),e=(o.addChild(e),new createjs.Text("","20px Sans","#000000")),e=(o.addChild(e),e.x=70,e.y=10,o.getBounds()),t=(o.cache(e.x,e.y,e.width,e.height),new createjs.Shape),a=(t.graphics.beginFill("#FFF").drawRect(0,0,e.width,e.height),t.x=0,t.y=0,o.hitArea=t,E);o.on("click",function(){o.visible=!1,null!=a.errorMsgArrow&&a.errorMsgArrow.removeAllChildren(),a.update=!0})},n.src="images/"+e+".svg"},this.prepSearchWidget=function(){for(var e in E.searchBlockPosition=[100,100],E.searchSuggestions=[],E.deprecatedBlockNames=[],E.blocks.protoBlockDict){var t=E.blocks.protoBlockDict[e],e=t.staticLabels.join(" "),a=t.palette.model.makeBlockInfo(0,t,t.name,t.name).artwork64;if(e||void 0!==t.extraSearchTerms)if(t.deprecated)E.deprecatedBlockNames.push(e);else{if(0===e.length){var o=_(t.name);switch(t.name){case"scaledegree2":o=_("scale degree");break;case"voicename":o=_("voice name");break;case"invertmode":o=_("invert mode");break;case"outputtools":o=_("output tools");break;case"customNote":o=_("custom note");break;case"accidentalname":o=_("accidental name");break;case"eastindiansolfege":o=_("east indian solfege");break;case"notename":o=_("note name");break;case"temperamentname":o=_("temperament name");break;case"modename":o=_("mode name");break;case"chordname":o=_("chord name");break;case"intervalname":o=_("interval name");break;case"filtertype":o=_("filter type");break;case"oscillatortype":o=_("oscillator type");break;case"audiofile":o=_("audio file");break;case"noisename":o=_("noise name");break;case"drumname":o=_("drum name");break;case"effectsname":o=_("effects name");break;case"wrapmode":o=_("wrap mode");break;case"loadFile":o=_("load file")}E.searchSuggestions.push({label:o,value:t.name,specialDict:t,artwork:a})}else E.searchSuggestions.push({label:e,value:t.name,specialDict:t,artwork:a});if(void 0!==t.extraSearchTerms)for(var n=0;n<t.extraSearchTerms.length;n++)E.searchSuggestions.push({label:t.extraSearchTerms[n],value:t.name,specialDict:t,artwork:a})}}E.searchSuggestions=E.searchSuggestions.reverse()},this.hideSearchWidget=function(){var e=docByClass("ui-menu");0<e.length&&(e[0].style.visibility="hidden"),E.searchWidget.style.visibility="hidden",E.searchWidget.idInput_custom=""},this.showSearchWidget=function(){var e,t,a;E.searchWidget.style.zIndex=1001,E.searchWidget.style.border="2px solid lightblue",E.helpfulSearchDiv&&E._hideHelpfulSearchWidget(),"visible"===E.searchWidget.style.visibility?E.hideSearchWidget():(0<(e=docByClass("ui-menu")).length&&(e[0].style.visibility="visible"),E.searchWidget.value=null,E.searchWidget.style.visibility="visible",E.searchWidget.style.left=E.palettes.getSearchPos()[0]*E.turtleBlocksScale*1.5+"px",E.searchWidget.style.top=E.palettes.getSearchPos()[1]*E.turtleBlocksScale*.95+"px",E.searchBlockPosition=[100,100],E.prepSearchWidget(),t=E,a=function(e){"visible"===document.getElementById("search").style.visibility&&(e.target===document.getElementById("search")||document.getElementById("search").contains(e.target))||document.getElementById("ui-id-1")&&"block"===document.getElementById("ui-id-1").style.display&&(e.target===document.getElementById("ui-id-1")||document.getElementById("ui-id-1").contains(e.target))||document.getElementsByTagName("tr")[2].contains(e.target)||(t.hideSearchWidget(),document.removeEventListener("mousedown",a))},document.addEventListener("mousedown",a),setTimeout(function(){t.searchWidget.focus(),t.doSearch()},500))},this.doSearch=function(){var e,t,a,o=jQuery.noConflict(),n=E,l=(o("#search").autocomplete({source:n.searchSuggestions,select:function(e,t){e.preventDefault(),n.searchWidget.value=t.item.label,n.searchWidget.idInput_custom=t.item.value,n.searchWidget.protoblk=t.item.specialDict,n.doSearch(),13===e.keyCode&&(E.searchWidget.style.visibility="visible")},focus:function(e){e.preventDefault()}}),o("#search").autocomplete("instance")._renderItem=function(e,t){return o("<li></li>").data("item.autocomplete",t).append('<img src="'+t.artwork+'" height="20px"><a> '+t.label+"</a>").appendTo(e.css({"z-index":9999,"max-height":"200px","overflow-y":"auto"}))},E.searchWidget.idInput_custom);!l||l.length<=0||(t=(e=E.searchWidget.protoblk).palette.name,E.blocks.protoBlockDict.hasOwnProperty(a=e.name)?(E.palettes.dict[t].makeBlockFromSearch(e,a,function(e){n.blocks.moveBlock(e,100+n.searchBlockPosition[0]-n.blocksContainer.x,n.searchBlockPosition[1]-n.blocksContainer.y)}),E.searchBlockPosition[0]+=STANDARDBLOCKHEIGHT,E.searchBlockPosition[1]+=STANDARDBLOCKHEIGHT):-1<E.deprecatedBlockNames.indexOf(l)?E.errorMsg(_("This block is deprecated.")):E.errorMsg(_("Block cannot be found.")),E.searchWidget.value="",E.update=!0)},this.makeSamplerWidget=function(e,t){e=[[0,"sampler",300-E.blocksContainer.x,300-E.blocksContainer.y,[null,1,8]],[1,"settimbre",0,0,[0,2,6,7]],[2,["customsample",{value:["","","do",4]}],0,0,[1,3,4,5]],[3,["audiofile",{value:[e,t]}],0,0,[2]],[4,["solfege",{value:"do"}],0,0,[2]],[5,["number",{value:4}],0,0,[2]],[6,"vspace",0,0,[1,null]],[7,"hidden",0,0,[1,null]],[8,"hiddennoflow",0,0,[0,null]]],E.blocks.loadNewBlocks(e)},this.__keyPressed=function(e){if(!0===window.widgetWindows.isOpen("slider")&&(37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode))return e.preventDefault(),e.stopPropagation(),!1;if(!0!==window.widgetWindows.isOpen("JavaScript Editor")&&E.keyboardEnableFlag&&!(document.getElementById("labelDiv").classList.contains("hasKeyboard")||E.printText&&E.printText.classList.contains("show"))){if(E.keyboardEnableFlag){if(null!==document.getElementById("BPMInput")&&document.getElementById("BPMInput").classList.contains("hasKeyboard"))return;if(null!==document.getElementById("musicratio1")&&document.getElementById("musicratio1").classList.contains("hasKeyboard"))return;if(null!==document.getElementById("musicratio2")&&document.getElementById("musicratio2").classList.contains("hasKeyboard"))return;if(null!==document.getElementById("dissectNumber")&&document.getElementById("dissectNumber").classList.contains("hasKeyboard"))return;if(null!==document.getElementById("timbreName")&&document.getElementById("timbreName").classList.contains("hasKeyboard"))return}if(9===e.keyCode)return e.preventDefault(),!1;for(var t,a="block"===document.getElementById("lilypondModal").style.display||"visible"===E.searchWidget.style.visibility||"visible"===E.helpfulSearchWidget.style.visibility||E.isInputON||document.getElementById("samplerPrompt")||""===document.getElementById("planet-iframe").style.display||"visible"===document.getElementById("paste").style.visibility||""===document.getElementById("wheelDiv").style.display||E.turtles.running(),o=document.getElementsByClassName("wftTitle"),n=0;n<o.length;n++)if("tempo"===o[n].innerHTML){E.inTempoWidget=!0;break}if(e.altKey&&!a||13==e.keyCode||"/"==e.key||"\\"==e.key)switch(e.keyCode){case 66:E.textMsg("Alt-B "+_("Saving block artwork")),E.save.saveBlockArtwork();break;case 67:E.textMsg("Alt-C "+_("Copy")),E.blocks.prepareStackForCopy();break;case 69:E.textMsg("Alt-E "+_("Erase")),E._allClear(!1);break;case 82:E.textMsg("Alt-R "+_("Play"));var l=document.getElementById("stop");l&&(l.style.color=platformColor.stopIconcolor),E._doFastButton();break;case 13:E.isInputON||"visible"!==E.searchWidget.style.visibility&&("visible"===document.getElementById("paste").style.visibility?(E.pasted(),document.getElementById("paste").style.visibility="hidden"):(E.textMsg("Enter "+_("Play")),(l=document.getElementById("stop"))&&(l.style.color=platformColor.stopIconcolor),E._doFastButton()));break;case 83:E.textMsg("Alt-S "+_("Stop")),E.logo.doStopTurtles();break;case 86:E.blocks.pasteStack();break;case 72:E.textMsg("Alt-H "+_("Save block help")),E._saveHelpBlocks();break;case 191:"/"!=e.key||E.beginnerMode||"block"!=disableHorizScrollIcon.style.display||(E.blocksContainer.x+=E.canvas.width/10,E.stage.update());case 220:"\\"!=e.key||E.beginnerMode||"block"!=disableHorizScrollIcon.style.display||(E.blocksContainer.x-=E.canvas.width/10,E.stage.update())}else if(e.ctrlKey)86===e.keyCode&&(E.pasteBox.createBox(E.turtleBlocksScale,200,200),E.pasteBox.show(),document.getElementById("paste").style.left=(E.pasteBox.getPos()[0]+10)*E.turtleBlocksScale+"px",document.getElementById("paste").style.top=(E.pasteBox.getPos()[1]+10)*E.turtleBlocksScale+"px",document.getElementById("paste").focus(),document.getElementById("paste").style.visibility="visible",E.update=!0);else if(e.shiftKey&&!a)32===e.keyCode&&(e.preventDefault(),1===E.turtleContainer.scaleX?E.turtles.setStageScale(.5):E.turtles.setStageScale(1));else{if("visible"===document.getElementById("paste").style.visibility&&13===e.keyCode)0<document.getElementById("paste").value.length&&E.pasted();else if(32===e.keyCode){var i=Object.values(window.widgetWindows.openWindows).some(function(e){return e});E.turtles.running()?(e.preventDefault(),E._doHardStopButton()):a||i||(e.preventDefault(),E._doFastButton())}else if(!a)switch(e.keyCode){case 35:E.textMsg("END "+_("Jumping to the bottom of the page.")),E.blocksContainer.y=-E.blocks.bottomMostBlock()+E.canvas.height/2,E.stage.update();break;case 33:E.textMsg("PAGE_UP "+_("Scrolling up.")),E.blocksContainer.y+=E.canvas.height/2,E.stage.update();break;case 34:E.textMsg("PAGE_DOWN "+_("Scrolling down.")),E.blocksContainer.y-=E.canvas.height/2,E.stage.update();break;case 46:E.textMsg("DEL "+_("Extracting block")),E.blocks.extract();break;case 38:E.inTempoWidget?E.logo.tempo.speedUp(0):(null!==E.blocks.activeBlock?(E.textMsg("UP ARROW "+_("Moving block up.")),E.blocks.moveStackRelative(E.blocks.activeBlock,0,-STANDARDBLOCKHEIGHT/2),E.blocks.blockMoved(E.blocks.activeBlock),E.blocks.adjustDocks(E.blocks.activeBlock,!0)):null!==E.palettes.activePalette?E.palettes.activePalette.scrollEvent(STANDARDBLOCKHEIGHT,1):E.blocksContainer.y+=20,E.stage.update());break;case 40:E.inTempoWidget?E.logo.tempo.slowDown(0):(null!==E.blocks.activeBlock?(E.textMsg("DOWN ARROW "+_("Moving block down.")),E.blocks.moveStackRelative(E.blocks.activeBlock,0,STANDARDBLOCKHEIGHT/2),E.blocks.blockMoved(E.blocks.activeBlock),E.blocks.adjustDocks(E.blocks.activeBlock,!0)):null!==E.palettes.activePalette?E.palettes.activePalette.scrollEvent(-STANDARDBLOCKHEIGHT,1):E.blocksContainer.y-=20,E.stage.update());break;case 37:E.inTempoWidget||(null!==E.blocks.activeBlock?(E.textMsg("LEFT ARROW "+_("Moving block left.")),E.blocks.moveStackRelative(E.blocks.activeBlock,-STANDARDBLOCKHEIGHT/2,0),E.blocks.blockMoved(E.blocks.activeBlock),E.blocks.adjustDocks(E.blocks.activeBlock,!0)):E.scrollBlockContainer&&(E.blocksContainer.x+=20),E.stage.update());break;case 39:E.inTempoWidget||(null!==E.blocks.activeBlock?(E.textMsg("RIGHT ARROW "+_("Moving block right.")),E.blocks.moveStackRelative(E.blocks.activeBlock,STANDARDBLOCKHEIGHT/2,0),E.blocks.blockMoved(E.blocks.activeBlock),E.blocks.adjustDocks(E.blocks.activeBlock,!0)):E.scrollBlockContainer&&(E.blocksContainer.x-=20),E.stage.update());break;case 36:E.textMsg("HOME "+_("Jump to home position.")),E.palettes.mouseOver?(t=Math.max(55-E.palettes.buttons.rhythm.y,0),E.palettes.menuScrollEvent(1,t),E.palettes.hidePaletteIconCircles()):null!==E.palettes.activePalette?E.palettes.activePalette.scrollEvent(-E.palettes.activePalette.scrollDiff,1):E._findBlocks(),E.stage.update();break;case 9:break;case 27:"visible"===E.searchWidget.style.visibility&&(E.textMsg("ESC "+_("Hide blocks")),E.searchWidget.style.visibility="hidden");break;case 13:E.textMsg("Return "+_("Play")),E.inTempoWidget&&(E.logo.tempo.isMoving&&E.logo.tempo.pause(),E.logo.tempo.resume()),null!==E.blocks.activeBlock&&SPECIALINPUTS.includes(E.blocks.blockList[E.blocks.activeBlock].name)||E.logo.runLogoCommands()}E.currentKeyCode=e.keyCode}}},this.getCurrentKeyCode=function(){return E.currentKeyCode},this.clearCurrentKeyCode=function(){E.currentKey="",E.currentKeyCode=0},this._onResize=function(e){if(e||null!==E.saveLocally&&E.saveLocally(),E.stage){var e=jQuery.noConflict(),t=0,a=0,a="undefined"==typeof platform||platform.androidWebkit?(t=window.outerWidth,window.outerHeight):(t=window.innerWidth,window.innerHeight);if(E._clientWidth=document.body.clientWidth,E._clientHeight=document.body.clientHeight,E._innerWidth=window.innerWidth,E._innerHeight=window.innerHeight,E._outerWidth=window.outerWidth,E._outerHeight=window.outerHeight,!document.getElementById("labelDiv").classList.contains("hasKeyboard")){Math.min(t,a),E.cellSize;var o=!1,n=(E.turtleBlocksScale=1,E.stage.scaleX=E.turtleBlocksScale,E.stage.scaleY=E.turtleBlocksScale,E.stage.canvas.width=t,E.stage.canvas.height=a,E.turtles.doScale(t,a,E.turtleBlocksScale),E.boundary.setScale(t,a,E.turtleBlocksScale),E.trashcan.resizeEvent(E.turtleBlocksScale),E._setupPaletteMenu(),E.canvas.width/(2*E.turtleBlocksScale)-600),l=E.canvas.height/(2*E.turtleBlocksScale)-450;E.cartesianBitmap.x=n,E.cartesianBitmap.y=l,E.polarBitmap.x=n,E.polarBitmap.y=l,E.trebleBitmap.x=n,E.trebleBitmap.y=l,E.grandBitmap.x=n,E.grandBitmap.y=l,E.sopranoBitmap.x=n,E.sopranoBitmap.y=l,E.altoBitmap.x=n,E.altoBitmap.y=l,E.tenorBitmap.x=n,E.tenorBitmap.y=l,E.bassBitmap.x=n,E.bassBitmap.y=l;for(var i=0;i<7;i++)E.grandSharpBitmap[i].x=n,E.grandFlatBitmap[i].x=n,E.trebleSharpBitmap[i].x=n,E.trebleFlatBitmap[i].x=n,E.sopranoSharpBitmap[i].x=n,E.sopranoFlatBitmap[i].x=n,E.altoSharpBitmap[i].x=n,E.altoFlatBitmap[i].x=n,E.tenorSharpBitmap[i].x=n,E.tenorFlatBitmap[i].x=n,E.bassSharpBitmap[i].x=n,E.bassFlatBitmap[i].x=n;E.grandSharpBitmap[0].y=l,E.grandSharpBitmap[1].y=E.canvas.height/(2*E.turtleBlocksScale)-412.5,E.grandSharpBitmap[2].y=E.canvas.height/(2*E.turtleBlocksScale)-462.5,E.grandSharpBitmap[3].y=E.canvas.height/(2*E.turtleBlocksScale)-425,E.grandSharpBitmap[4].y=E.canvas.height/(2*E.turtleBlocksScale)-387.5,E.grandSharpBitmap[5].y=E.canvas.height/(2*E.turtleBlocksScale)-437.5,E.grandSharpBitmap[6].y=E.canvas.height/(2*E.turtleBlocksScale)-400,E.grandFlatBitmap[0].y=l,E.grandFlatBitmap[1].y=E.canvas.height/(2*E.turtleBlocksScale)-487.5,E.grandFlatBitmap[2].y=E.canvas.height/(2*E.turtleBlocksScale)-437.5,E.grandFlatBitmap[3].y=E.canvas.height/(2*E.turtleBlocksScale)-475,E.grandFlatBitmap[4].y=E.canvas.height/(2*E.turtleBlocksScale)-425,E.grandFlatBitmap[5].y=E.canvas.height/(2*E.turtleBlocksScale)-462.5,E.grandFlatBitmap[6].y=E.canvas.height/(2*E.turtleBlocksScale)-412.5;for(var s=0;s<7;s++)E.trebleSharpBitmap[s].y=E.grandSharpBitmap[s].y,E.trebleFlatBitmap[s].y=E.grandFlatBitmap[s].y,E.sopranoSharpBitmap[s].y=E.grandSharpBitmap[s].y,E.sopranoFlatBitmap[s].y=E.grandFlatBitmap[s].y,E.altoSharpBitmap[s].y=E.grandSharpBitmap[s].y,E.altoFlatBitmap[s].y=E.grandFlatBitmap[s].y,E.tenorSharpBitmap[s].y=E.grandSharpBitmap[s].y,E.tenorFlatBitmap[s].y=E.grandFlatBitmap[s].y,E.bassSharpBitmap[s].y=E.grandSharpBitmap[s].y,E.bassFlatBitmap[s].y=E.grandFlatBitmap[s].y;E.sopranoSharpBitmap[4].y-=87.5,E.sopranoSharpBitmap[6].y-=87.5,E.sopranoFlatBitmap[0].y-=87.5,E.sopranoFlatBitmap[2].y-=87.5,E.sopranoFlatBitmap[4].y-=87.5,E.sopranoFlatBitmap[6].y-=87.5;for(var r=0;r<7;r++)E.sopranoSharpBitmap[r].y+=87.5,E.sopranoFlatBitmap[r].y+=87.5;for(var c=0;c<7;c++)E.altoSharpBitmap[c].y+=87.5,E.altoFlatBitmap[c].y+=87.5;E.tenorSharpBitmap[0].y+=87.5,E.tenorSharpBitmap[2].y+=87.5;for(var u=0;u<7;u++)E.tenorSharpBitmap[u].y+=87.5,E.tenorFlatBitmap[u].y+=87.5;for(var d=0;d<7;d++)E.bassSharpBitmap[d].y+=175,E.bassFlatBitmap[d].y+=175;E.update=!0,"undefined"!=typeof platform&&platform.mobile?E.toolbar.disableTooltips(e):E.palettes.setMobile(!1);for(var g=0;g<E.turtles.getTurtleCount();g++)E.turtles.getTurtle(g).painter.doClear(!1,!1,!0);l=document.getElementById("overlayCanvas"),o?(l.width=2*t,l.height=2*a):(l.width=t,l.height=a),E.blocks.checkBounds()}}},document.getElementById("canvasContainer")),r=document.getElementById("myCanvas"),d=document.getElementById("canvas"),v=document.getElementById("canvasHolder"),T=1600,D=900;function A(){var e,t;window.innerWidth===window.screen.width&&window.innerHeight===window.screen.height?(s.style.width=T+"px",s.style.height=D+"px",r.width=T,r.height=D,d.width=r.width,d.height=r.width,v.width=T,v.height=D):(e=window.innerWidth,t=window.innerHeight,s.style.width=e+"px",s.style.height=t+"px",r.width=e,r.height=t,d.width=r.width,d.height=r.width,v.width=r.width,v.height=r.height),document.getElementById("hideContents").click(),f.refreshCanvas()}this._handleWindowResize=function(){clearTimeout(l),l=setTimeout(function(){A(),E._setupPaletteMenu()},100)},this.addEventListener(window,"resize",this._handleWindowResize),this._handleOrientationChangeResize=A,this.addEventListener(window,"orientationchange",this._handleOrientationChangeResize);function L(){try{f._onResize(!1),document.getElementById("hideContents").click()}catch(e){console.error("An error occurred in resizeCanvas_:",e)}}function U(e){e.blocks&&e.blocks.trashStacks&&0!==e.blocks.trashStacks.length?"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none",e.__tick()):e.textMsg(_("Trash can is empty."),3e3)}function G(e){e.blocks&&e.blocks.trashStacks&&0!==e.blocks.trashStacks.length?(E._restoreTrashById(E.blocks.trashStacks[E.blocks.trashStacks.length-1]),e.textMsg(_("Item restored from the trash."),3e3),"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none",e.__tick())):e.textMsg(_("Trash can is empty."),3e3)}var f=this;L(),this._handleOrientationChangeResizeCanvas=L,this.addEventListener(window,"orientationchange",this._handleOrientationChangeResizeCanvas);this._restoreTrashById=function(e){var t=E.blocks.trashStacks.indexOf(e);if(-1!==t){for(var a in E.blocks.trashStacks.splice(t,1),E.palettes.dict)E.palettes.dict[a].hideMenu(!0);E.blocks.activeBlock=null,E.refreshCanvas();var o=3*-E.cellSize;E.blocks.findDragGroup(e);for(var n=0;n<E.blocks.dragGroup.length;n++){var l=E.blocks.dragGroup[n];E.blocks.blockList[l].trash=!1,E.blocks.moveBlockRelative(l,0,o),E.blocks.blockList[l].show()}if(E.blocks.raiseStackToTop(e),"start"===(t=E.blocks.blockList[e]).name||"drum"===t.name)e=t.value,E.turtles.getTurtle(e).inTrash=!1,E.turtles.getTurtle(e).container.visible=!0;else if("action"===t.name&&null!==(e=E.blocks.blockList[t.connections[1]])){var i,s=e.value,r=(t.trash=!0,E.blocks.findUniqueActionName(s));if(t.trash=!1,r!==e){i=8<(e.value=r).length?r.substr(0,7)+"...":r,e.text.text=i,null!==e.label&&(e.label.value=r),e.container.updateCache();for(var c=0;c<E.blocks.dragGroup.length;c++){var u=E.blocks.blockList[E.blocks.dragGroup[c]];["nameddo","nameddoArg","namedcalc","namedcalcArg"].includes(u.name)&&u.privateData===s&&(u.privateData=r,i=8<(u.value=r).length?r.substr(0,7)+"...":r,u.text.text=i,u.overrideName=i,u.regenerateArtwork(),u.container.updateCache())}}}activity.textMsg(_("Item restored from the trash."),3e3),E.refreshCanvas()}},document.getElementById("restoreIcon").addEventListener("click",function(){E._renderTrashView()}),this._renderTrashView=function(){var e,s,t,a,o;activity.blocks&&activity.blocks.trashStacks&&0!==activity.blocks.trashStacks.length&&(e=document.getElementById("trashList"),(s=document.createElement("div")).id="trashView",s.classList.add("trash-view"),(t=document.createElement("div")).classList.add("button-container"),(o=document.createElement("a")).id="restoreLastIcon",o.classList.add("restore-last-icon"),o.innerHTML='<i class="material-icons md-48">restore_from_trash</i>',o.addEventListener("click",function(){E._restoreTrashById(E.blocks.trashStacks[E.blocks.trashStacks.length-1]),s.classList.add("hidden")}),(a=document.createElement("a")).id="restoreAllIcon",a.classList.add("restore-all-icon"),a.innerHTML='<i class="material-icons md-48">delete_sweep</i>',a.addEventListener("click",function(){for(;0<E.blocks.trashStacks.length;)E._restoreTrashById(E.blocks.trashStacks[0]);s.classList.add("hidden")}),o.setAttribute("title",_("Restore last item")),a.setAttribute("title",_("Restore all items")),t.appendChild(o),t.appendChild(a),s.appendChild(t),E.blocks.trashStacks.forEach(function(e){var t,a,o=E.blocks.blockList[e],n=document.createElement("div"),l=(n.classList.add("trash-item"),o.artwork),l="data:image/svg+xml;utf8,"+encodeURIComponent(l),i=document.createElement("img"),l=(i.src=l,i.alt="Block Icon",i.classList.add("trash-item-icon"),document.createTextNode(o.name));n.appendChild(i),n.appendChild(l),n.dataset.blockId=e,n.addEventListener("mouseover",function(){return n.classList.add("hover")}),n.addEventListener("mouseout",function(){return n.classList.remove("hover")}),n.addEventListener("click",function(){E._restoreTrashById(e),s.classList.add("hidden")}),t=s,a=!0,document.addEventListener("click",function(e){a?a=!1:t.contains(e.target)||e.target===t||(t.style.display="none")}),s.appendChild(n)}),(o=document.getElementById("trashView"))?e.replaceChild(s,o):e.appendChild(s))},this._openAuxMenu=function(){E.turtles.running()||0!==E.toolbarHeight||E._showHideAuxMenu(!1)};function N(e){e._changeBlockVisibility(),"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none",e.__tick())}function I(e){e._toggleCollapsibleStacks(),"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none",e.__tick())}function R(e){e._doOpenSamples()}function C(e){piemenuKey(e),"none"!==document.getElementById("helpfulWheelDiv").style.display&&(document.getElementById("helpfulWheelDiv").style.display="none")}function P(e,t,a,o){e._loadProject(t,a,o)}var S=function(e,t){e._showHideAuxMenu(t)},B=(this._showHideAuxMenu=function(e){var t,a=document.querySelectorAll("#buttoncontainerTOP .tooltipped"),o=document.getElementById("Grid"),n=o?o.getBoundingClientRect().top:70+LEADING+6;E.changeTopButtonsPosition=function(t){a.forEach(function(e){e.style.top="".concat(n+t,"px")})},e||0!==E.toolbarHeight?(t=E.toolbarHeight,E.toolbarHeight=0,E.turtles.deltaY(-t),E.palettes.deltaY(-t),E.blocksContainer.y-=t,E.changeTopButtonsPosition(-t),E.cartesianBitmap.y-=t,E.polarBitmap.y-=t,E.trebleBitmap.y-=t,E.grandBitmap.y-=t,E.sopranoBitmap.y-=t,E.altoBitmap.y-=t,E.tenorBitmap.y-=t,E.bassBitmap.y-=t):(E.toolbarHeight=t=55+LEADING+5,E.palettes.deltaY(t),E.turtles.deltaY(t),E.blocksContainer.y+=t,E.changeTopButtonsPosition(t),E.cartesianBitmap.y+=t,E.polarBitmap.y+=t,E.trebleBitmap.y+=t,E.grandBitmap.y+=t,E.sopranoBitmap.y+=t,E.altoBitmap.y+=t,E.tenorBitmap.y+=t,E.bassBitmap.y+=t,E.blocks.checkBounds()),E.refreshCanvas()},this.hideAuxMenu=function(){0<E.toolbarHeight&&(E._showHideAuxMenu(!1),E.menuButtonsVisible=!1)},this.sendAllToTrash=function(e,t){var a,o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];for(a in E.blocksContainer.x=0,E.blocksContainer.y=0,E.blocks.palettes.dict)E.palettes.dict[a].hideMenu(!0);hideDOMLabel(),E.refreshCanvas();var n,l,i=0,s=3*E.cellSize;for(n in E.blocks.blockList)null===E.blocks.blockList[n].connections[0]&&E.blocks.trashStacks.push(n),"start"===E.blocks.blockList[n].name||"drum"===E.blocks.blockList[n].name?(l=E.blocks.blockList[n].value,E.blocks.blockList[n].trash||null===l||(E.turtles.getTurtle(l).inTrash=!0,E.turtles.getTurtle(l).container.visible=!1)):"action"!==E.blocks.blockList[n].name||E.blocks.blockList[n].trash||(E.blocks.deleteActionBlock(E.blocks.blockList[n]),i+=1),E.blocks.blockList[n].trash=!0,E.blocks.moveBlockRelative(n,0,s),E.blocks.blockList[n].hide();e?(E.blocks.loadNewBlocks(DATAOBJS),E._allClear(!1)):t||E.saveLocally();var r=E;setTimeout(function(){r.stage.dispatchEvent("trashsignal")},100*i),E.update=!0,o&&closeWidgets()},this._changeBlockVisibility=function(){hideDOMLabel(),E.blocks.visible?(E.blocks.hideBlocks(),E.showBlocksAfterRun=!1,E.palettes.hide(),changeImage(E.hideBlocksContainer.children[0],SHOWBLOCKSBUTTON,HIDEBLOCKSFADEDBUTTON)):(changeImage(E.hideBlocksContainer.children[0],HIDEBLOCKSFADEDBUTTON,SHOWBLOCKSBUTTON),E.blocks.showBlocks(),E.palettes.show())},this._toggleCollapsibleStacks=function(){hideDOMLabel(),E.blocks.visible&&E.blocks.toggleCollapsibles()},this.onStopTurtle=function(){},this.onRunTurtle=function(){},this.clearCache=function(){E.blocks.blockList.forEach(function(e){e.container&&(e.container.uncache(),e.container.cache()),e.bitmap&&(e.bitmap.uncache(),e.bitmap.cache())})},this.refreshCanvas=function(){var e;E.blockRefreshCanvas||(E.blockRefreshCanvas=!0,E.stageDirty=!0,E.update=!0,e=E,setTimeout(function(){e.blockRefreshCanvas=!1,e.stageDirty=!0},5))},this.__tick=function(e){(E.update||createjs.Tween.hasActiveTweens())&&(E.update=!1,E.stageDirty=!0)},this.markStageDirty=function(){E.stageDirty=!0},this._doOpenSamples=function(){"none"!==document.getElementById("palette").style.display&&(document.getElementById("palette").style.display="none"),E.toolbar.closeAuxToolbar(S),E.planet.openPlanet(),"none"!==document.getElementById("buttoncontainerBOTTOM").style.display&&(document.getElementById("buttoncontainerBOTTOM").style.display="none"),"none"!==document.getElementById("buttoncontainerTOP").style.display&&(document.getElementById("buttoncontainerTOP").style.display="none")},this.doUploadToPlanet=function(){E.planet.openPlanet()},function(e,t){e.toolbar.closeAuxToolbar(S),e.merging=!!(t=void 0!==t&&t),document.querySelector("#myOpenFile").focus(),document.querySelector("#myOpenFile").click(),window.scroll(0,0),w(e),e._allClear(!0,!0)}),O=(window.prepareExport=this.prepareExport,this.runProject=function(e){document.removeEventListener("finishedLoading",E.runProject);var t=E;setTimeout(function(){t._changeBlockVisibility(),t._doFastButton(e)},5e3)},[{value:"1/1",duration:1},{value:"1/2",duration:.5},{value:"1/4",duration:.25},{value:"1/8",duration:.125},{value:"1/16",duration:.0625},{value:"1/32",duration:.03125},{value:"1/64",duration:.015625},{value:"1/128",duration:.0078125}]),j=(this.getClosestStandardNoteValue=function(e){for(var t=O[0],a=Math.abs(e-t.duration),o=1;o<O.length;o++){var n=Math.abs(e-O[o].duration);n<a&&(t=O[o],a=n)}return t.value.split("/").map(Number)},(()=>{var t=_asyncToGenerator(_regenerator().m(function e(a){var o,t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(o=(()=>{var e=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(!a.turtles.running()){for(a.stage.update(event),t=0;t<a.turtles.getTurtleCount();t++)a.logo.turtleHeaps[t]=[],a.logo.turtleDicts[t]={},a.logo.notation.notationStaging[t]=[],a.logo.notation.notationDrumStaging[t]=[],a.turtles.getTurtle(t).painter.doClear(!0,!0,!1);_THIS_IS_MUSIC_BLOCKS_?(console.log("%cMusic Blocks","font-size: 24px; font-weight: bold; font-family: sans-serif; padding:20px 0 0 110px; background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+IDxzdmcgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgaWQ9InN2ZzExMjEiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM0LjEzMTI0OSAxNC41NTIwODkiIGhlaWdodD0iNTUuMDAwMDE5IiB3aWR0aD0iMTI5Ij4gPGRlZnMgaWQ9ImRlZnMxMTE1Ij4gPGNsaXBQYXRoIGlkPSJjbGlwUGF0aDQzMzciIGNsaXBQYXRoVW5pdHM9InVzZXJTcGFjZU9uVXNlIj4gPHJlY3QgeT0iNTUyIiB4PSI1ODgiIGhlaWdodD0iMTQzNiIgd2lkdGg9IjE5MDAiIGlkPSJyZWN0NDMzOSIgc3R5bGU9ImZpbGw6I2EzYjVjNDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDwvY2xpcFBhdGg+IDwvZGVmcz4gPG1ldGFkYXRhIGlkPSJtZXRhZGF0YTExMTgiPiA8cmRmOlJERj4gPGNjOldvcmsgcmRmOmFib3V0PSIiPiA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4gPGRjOnR5cGUgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4gPGRjOnRpdGxlPjwvZGM6dGl0bGU+IDwvY2M6V29yaz4gPC9yZGY6UkRGPiA8L21ldGFkYXRhPiA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLjA4Njc4MiwwLDAsMS4wODY3ODIsLTEuNTQ3MzI0NSwtMS4zMDU3OTkpIiBpZD0iZzE4MTIiPiA8ZWxsaXBzZSB0cmFuc2Zvcm09Im1hdHJpeCgwLjAxMDQ2MDk5LDAsMCwwLjAxMDQ2MDk5LDEuMDE2NzM4OSwtNi4yMDQ4NTI5KSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoNDMzNykiIHJ5PSI3NjgiIHJ4PSI3NDgiIGN5PSIxNDc2IiBjeD0iMTU0MCIgaWQ9InBhdGg0MzMzIiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDojYTNiNWM0O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxNTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPGVsbGlwc2Ugcnk9IjEuNzgyNjg1OSIgcng9IjEuNjkzOTIxNiIgY3k9IjguODM0MzUzNCIgY3g9IjE2LjQ0NjczOSIgaWQ9InBhdGg0MjU2IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDojYzlkYWQ4O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojYzlkYWQ4O3N0cm9rZS13aWR0aDowLjEwNDYwOTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDMyOCIgZD0ibSAxNy42MzAyNjYsMTMuNDg3MDkgMC4zMjU0NywwLjM5MjA0NCAwLjM0NzY2LDAuMjczNjkgMC4zMTA2NzYsMC4xMTA5NTUgMC4yMzY3MDUsLTAuMDUxNzggMC4xNDA1NDQsLTAuMTg0OTI2IDAuMTk5NzIsMC4wODEzNyAwLjE1NTMzOCwwLjA0NDM4IDAuNjEzOTU0LC0wLjQyMTYzMiAwLjQyMTYzMSwtMC4yNTE0OTkgYyAwLDAgMC44ODc2NDUsLTAuMDA3NCAxLjYwNTE1NywtMC41NTQ3NzcgMC43MTc1MTMsLTAuNTQ3MzgxIDAuNDk1NjAyLC0wLjY1MDkzOSAwLjQ5NTYwMiwtMC42NTA5MzkgbCAtMC4wMzY5OSwtMC40MjkwMjkgLTAuNTM5OTg0LC0wLjcxNzUxMyAtMC41NTQ3NzcsLTAuNTY5NTcxIC0wLjIyOTMwOSwtMC4xNDc5NDEgYyAwLDAgLTAuMDIyMTksLTAuMDQ0MzggLTAuMDczOTcsLTAuMDQ0MzggLTAuMDUxNzgsMCAtMC4yNDQxMDMsLTAuMDczOTcgLTAuNTE3NzkzLDAuMDQ0MzggLTAuMjczNjkxLDAuMTE4MzUzIC0wLjQ2NjAxNCwwLjE3MDEzMiAtMC44NDMyNjMsMC4zODQ2NDYgLTAuMzc3MjQ4LDAuMjE0NTE0IC0wLjcxMDExNSwwLjQyMTYzMSAtMC44MzU4NjUsMC40OTU2MDIgLTAuMTI1NzUsMC4wNzM5NyAtMC43NDcxLDAuNDI5MDI4IC0wLjc0NzEsMC40MjkwMjggbCAtMC4wOTYxNiwwLjY1ODMzNiB6IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDojZjhmOGY4O2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjAxMDQ2MDk5cHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggaWQ9InBhdGg0MzMwIiBkPSJtIDE4LjA4MTQ4NSwxMy4xMTcyMzkgYyAwLDAgMS4wMTcyMDIsMC4yMTk4MDggMS40OTA2MTMsLTAuMTM1MjUgMC42ODI1NSwtMC42NzQwOTcgMS42NTU4OTMsLTEuMTU0NzMxIDEuODcwMzU1LC0xLjc0NTMwOCAwLjEwODI1NywtMC4yOTgxMTYgMC4wOTI2NSwtMC4zNzIzNzcgLTAuMDgwMTgsLTAuNjM3MTkxIC0wLjc4NDA4NSwtMS4xMTY5NTIzIC0yLjE4NjAyMywwLjQ4MzU2MyAtMi4xODYwMjMsMC40ODM1NjMgbCAtMS4yMjA1MTEsMS4wNDI5ODMgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2M5ZGFkODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI4MSIgZD0ibSAxOC45MjM2MzgsMTEuOTExMTY2IGMgMCwwIC0yLjI2MjA3MywwLjM2MDA3MyAtMS4yNDU4MDcsMS42MzE0MjYgMS4wMTYyNjgsMS4yNzEzNTQgMS4zMzE1OSwwLjQ2ODQxNSAxLjMzMTU5LDAuNDY4NDE1IDAsMCAwLjIzNzM2NCwwLjI4NDAyMSAwLjU1MDIyMSwtMC4wMTI4OSAwLjMxMjg1NywtMC4yOTY5MSAwLjgwMTY1NywtMC40ODY1NjMgMC44MDE2NTcsLTAuNDg2NTYzIDAsMCAwLjgzMzQxOSwtMC4wODE1OCAxLjcyODg1MSwtMC42NDAzNDUgMC44OTU0MzIsLTAuNTU4NzY5IDAuMDI1NDUsLTEuNDk0NjQ0IDAuMDI1NDUsLTEuNDk0NjQ0IDAsMCAtMC43MDQwMDIsLTAuOTE0MzA1IC0xLjE5MTE1OCwtMS4wNjIwMDQgLTAuNDg3MTU1LC0wLjE0NzY5OSAtMS4yNjAyMDYsLTAuMjA1OTYzIC0xLjI2MDIwNiwtMC4yMDU5NjMgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNTkyNiIgZD0ibSAxNi44ODkxNjUsMy45OTA3MDY3IGMgLTAuMjA1OTI1LDAuMDA5MDIgLTAuNDkwNTg0LDAuMDE2NDUyIC0wLjY4MjQzNCwwLjA5NDMwNiAtMC4zNjM1MSwwLjExMzE2MjUgLTAuNzg0MDE5LDAuMzA2NTkxNiAtMS4xMDIwMzksMC40MTQ1MTk3IEMgMTQuODA1NzA3LDQuNjAwOTk5MyAxNC41MjgzODMsNC44Njc1ODQxIDE0LjQ0MjUxNSw0Ljc3MDc2NzYgMTQuMzE0ODUsNC42MjY4MjQ0IDE0LjIyNDM1Myw0LjU5NTM2MyAxNC4wNDU2ODksNC40OTc1NTkgMTMuODAxNzgxLDQuMzk5NTA1IDEzLjg3Mzc3Myw0LjQ0NDgyNzIgMTMuNjYwODY2LDQuMzg2MzI4MyAxMy41MTM2ODEsNC4zNDU4ODcxIDEzLjQ0ODI5LDQuMjg4Mjk1OCAxMy4wNDc5NTQsNC4zMDIzNTY3IGMgLTAuMjE2MDg3LDAuMDA3NTkgLTAuNDczNTEsMC4wMDgwNCAtMC42NjAwODEsMC4wODk3MjUgLTAuMzc0NjE1LDAuMTY0MDE3OCAtMC4yOTksMC4yNDg0NzU3IC0wLjUzODU3MiwwLjQ5MDAyNTIgLTAuMTY1MTA4LDAuMTY2NDcwOSAtMC4yMjMwMjksMC41NzQ5ODMxIC0wLjI4MjA0MSwwLjgxODg1OCAtMC4wNjkzOSwwLjI4Njc3NzYgLTAuMDU0NywwLjYwMTAzOTMgLTAuMDIwMzEsMC45Njc0MDMxIDAuMDI3NjEsMC4yOTQxOTY1IDAuMDkxNzMsMC40OTczOTM5IDAuMjQ5Mzg4LDAuNzU5MDYzIDAuMTM1MDg0LDAuMjI0MTk4OSAwLjMyNDU2MSwwLjI4MzU4MjggMC41NDY1OSwwLjQ5NzI4OTMgMC4wNzc3NCwwLjA3NDgzIDAuMzY4Mzk4LC0wLjAzODk2NSAwLjQ4NDg4LC0wLjAxNTEwNCAwLjEwODcwOSwwLjAyMjI3IC0wLjA0ODE3LDAuMjE2NzA4OCAtMC4wNTMyLDAuMjQ1MzgzNCAtMC4wNTM4LDAuMjM5NTE2OSAtMC4xMTA1MDMsMC4wODc3NzEgLTAuMDgwNiwwLjYyNzQyNjEgMC4zNDgxMjMsMi4wMjY2ODkyIDEuMDA1MDg5LC0xLjA2NzI2NDcgMC4zMjY2NDksMC42Njg2MTk0IC0wLjA1Mjk4LDAuMTM1NTY0IC0wLjQzNzU5NCwwLjM4ODgwNjggLTAuNTAzMzY4LDAuNTg2ODUzOCAtMC4wMTI2NywwLjE2NTEwOSAwLjE5NzgzNSwwLjE5NDA4IDAuMzE4OTk3LDAuMTc4MDQ5IDAuMDYyNjYsMC40ODAzOTUgMC4xMjQ5ODIsMS4wNDIwNDggMC41MjIyNDIsMS4zNzI0MzkgMC4xMjAxNzcsMC4xMDY0MDIgMC4yODY2NTIsMC4wOTQ0NyAwLjQyOTMxNywwLjEyNjQ0MyAwLjIyMTY0MSwwLjI2ODEyOCAwLjQ0ODY2OCwwLjU1NzA2NiAwLjc4NDA4NywwLjY4OTc3NCAwLjI4Mzg0NSwwLjE0ODQzNSAwLjYyNDkxMywwLjA1MSAwLjg5NjEzOCwwLjIzMzA2NSAwLjcxMjkyNSwwLjM2MDkwMSAxLjU5NDM3LDAuMjI3NDI0IDIuMjQwMzA3LC0wLjIxNDM2NyAwLjIzOTczNiwtMC4wMjU4NCAwLjUwMTI0MywwLjA1MTE5IDAuNzUxMzkxLDAuMDIyMjIgMC41NzU4OTgsLTAuMDIwMDYgMS4xNjcyMDcsLTAuMjQwMDA1IDEuNTIzOTYyLC0wLjcxMTUwMiAwLjA3MjksLTAuMDY2IDAuMTAyMDgxLC0wLjE3ODE0IDAuMTY4ODAzLC0wLjI0MDYzNSAwLjA2NjE2LDAuMDgzMyAwLjIwMTA3OSwwLjE2NTI4OSAwLjI4NTY1MywwLjA1NTAyIDAuMTkzMDcyLC0wLjI1MzQzNiAwLjIyMzQxMywtMC41OTUxMDQgMC4zMjcxNDUsLTAuODgyNTU5IDAuMDg2NTgsMC4wMzY0MSAwLjA4NDIsMC4yNjU3MzQgMC4xOTA4MiwwLjE3NTk2OCAwLjA4ODU4LC0wLjI3NzUxIDAuMjMxMDU1LC0wLjU4OTU1NCAwLjE1NzQ4NywtMC44NzUxMDMgQyAyMS4wOTQ5NjgsOS44NjQxNTE0IDIwLjk5NDc5OSw5LjcxMDk4NzkgMjAuOTU5NzUxLDkuNjcwOTkxNCAyMS4wNjk3Myw5LjY2NDkyMTQgMjEuMzkyMTQ2LDkuNjA3NDEyNCAyMS4zNjQyMjYsOS40MzQyNzkgMjEuMjg0OTAyLDkuMjY0MDY1MSAyMC45MzAzMjQsOS4wNTgwODkzIDIwLjc4MTQ3LDguOTYzNjg5MyAyMC42Mjc0ODksNy4wODIzNjI5IDIwLjgzMTk0MSw3Ljk3MzAwNDMgMjAuMzc0NDc1LDYuNTcyMTY2OCAyMC4yODY2OTMsNi4yOTYzNjYgMjAuMTc5NTgyLDYuMDI1MzkwOCAyMC4wMzkxNDksNS43NjczNzc4IDE5LjgxNDE1NSw1LjM1NDAwNzYgMTkuNTAzNjMsNC45NzM5MDc1IDE5LjA1MDAzMSw0LjY2MDUzMjggMTguNjk0MTU3LDQuNDg2NjE1NyAxOC43NzkxNjcsNC40MTI0NTc4IDE4LjQxNjMxOSw0LjI4NDIxMTggMTguMDQwOTE2LDQuMTE0ODkzIDE3LjkyMzEyNiw0LjExNDQyOTQgMTcuNzA2MjE3LDQuMDQ5NTUxNCAxNy40MjE5OTMsNC4wMDQyMzgyIDE3LjE3NjIyNiwzLjk5MzQ2MTEgMTYuODg5MTY1LDMuOTkwNzA2NyBaIG0gLTAuNDE2Nzc3LDMuNzcwMjM0NSBjIDAuMjU4MDA1LDAuMDA5NzYgMC40MjkyNTksMC4yNTQ4MTQgMC41Mjc1MDEsMC40Njg0NDEgLTAuMDQ2NTEsMC4xMjA5MTIzIC0wLjIxNzYxMywwLjE4MDMzMTggLTAuMzE0MzE2LDAuMjcwODAwNSAtMC4wNTIyNywwLjAzMDg5OCAtMC4xOTUwNTcsMC4xNDE5ODI5IC0wLjA3Mzk3LDAuMTc2MjU4MyAwLjE2NzU3NCwtMC4wMDgwMSAwLjM0MTEyNSwtMC4xMDE3NzYgMC41MDIzNjMsLTAuMDgxMjUzIDAuMDM4OCwwLjMxMzY5MjcgMC4wMTAzOCwwLjcyNTUwMzEgLTAuMjk1OTM5LDAuOTAyMTQ5NSAtMC4zMTY4ODQsMC4wODI4MjcgLTAuNTYyMDUzLC0wLjIxMjE0MTYgLTAuNjc2ODI5LC0wLjQ3MTYxOCAtMC4xNDcwOTYsLTAuMzY2NjkwMiAtMC4xODU5MzQsLTAuODQyODQzMSAwLjA3NjUxLC0xLjE2Njk5ODggMC4wNjUzMSwtMC4wNjgyNjggMC4xNjAwMTEsLTAuMTA2MzQ3NSAwLjI1NDY3OCwtMC4wOTc3OCB6IG0gMi44NTkyNDQsMi41NzU3ODc4IGMgLTAuMDc2NzMsMC4xODQ3NTggLTAuMjMwNjU5LDAuMzMwMTU2IC0wLjQwNzAxMSwwLjQxMzI1MiAtMC4wNTUzOSwwLjE1MDcwNSAwLjA0MDA0LDAuMzU0MzggMC4wMjk3LDAuNDgzMjM0IC0wLjA0OTA3LC0wLjE2MDM1NyAtMC4wMDE2LC0wLjM2MTQyNiAtMC4xMDg4NzUsLTAuNDk2NzU3IC0wLjA3MDE4LC0wLjAyMjcxIC0wLjE0Nzc0NywtMC4wMjgxIC0wLjIxMTc0MSwtMC4wNzIwNiAwLjIxMjc5NCwwLjExNzcxNyAwLjQ5NTYxLDAuMDM5MjQgMC42MDQ3NjYsLTAuMTgyMDk0IDAuMDI5MzQsLTAuMDM3NjIgMC4wODE1OSwtMC4xNDU1NzUgMC4wOTMxNiwtMC4xNDU1NzEgeiBtIC0wLjk2NTM3MiwwLjE0MTk4OCBjIDAuMDQ1NjYsMC4wMzQwOSAwLjIwNDg5NywwLjE2Mjg1NyAwLjA3NzQ0LDAuMDY3ODUgLTAuMDE2NDEsLTAuMDExMzggLTAuMDkwMTksLTAuMDcwODYgLTAuMDc3NDQsLTAuMDY3ODUgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2M5ZGFkODtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wNTIzMDQ5NTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggaWQ9InBhdGg0MjU3IiBkPSJtIDE4LjU2MjI5Miw0LjM0MDY1NDMgYyAwLDAgLTAuMDE4MjMsLTAuMTI2MDkyNSAwLjA1NTAzLC0wLjI2MzA5MTEgMC4xMDcwNjUsLTAuMjAwMjExOCAwLjM2NDA0MywtMC40MDk5NDg1IDAuNjYxOTUxLC0wLjU5NjUyOTEgMC4zOTA1NzksLTAuMjQ0NjIwMiAwLjg3ODEwNSwtMC40MDE1NzcyIDEuNDU3NjUzLDAuMDM1OTg1IDAuMTUwMzMxLDAuMTEzNTAwOCAwLjI3NTEyLDAuMzU2MTg0OSAwLjQzNjUyLDAuNTQ2MjQ1OCAwLDAgMC40NDM4MjIsMC41MzI1ODcxIDAuMDU5MTgsMS43OTAwODI5IEMgMjAuODQ3OTc4LDcuMTEwODQ1IDIwLjI0MTQyLDYuNTMzODc1NCAyMC4yNDE0Miw2LjUzMzg3NTQgWiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2M5ZGFkODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI1OSIgZD0ibSAxNS41NDQ5NjIsNC4zMTU2Mjk4IGMgMC42NzQwMTYsMC44NjIwMTcgMi4yMjQ5NDUsMy4zNjQ2NDY3IDIuNTUyNDgxLDIuMTM1NzQ3MSAwLjIwOTIyLC0wLjkxMDEwNjEgMC4wMTUzMiwtMi4zMDI1OTczIDAuMDE1MzIsLTIuMzAyNTk3MyAwLDAgLTEuMjUyMDM4LC0wLjQ2NTg4NTcgLTIuNTY3ODAyLDAuMTY2ODUwMiB6IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDojODk5YmIwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojODk5YmIwO3N0cm9rZS13aWR0aDowLjEwNDYwOTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI3NiIgZD0ibSAxNC41NTMyNiw5LjMxOTI1NjMgYyAwLDAgLTAuMTY3Mzc2LDAuMDUyMzA1IDEuMDk4NDA0LDAuMzM0NzUxNyAxLjI2NTc4LDAuMjgyNDQ2NyAxLjYyMTQ1MywtMC42Njk1MDM0IDEuNjIxNDUzLC0wLjY2OTUwMzQgMCwwIDEuMDM1NjM4LC0xLjUxNjg0MzYgMi4xNDQ1MDMsLTAuMzAzMzY4NyAwLDAgMC4yODI0NDcsMC4zMDMzNjg3IDAuNzg0NTc1LDAuMjkyOTA3NyAwLDAgMC4zMTM4MjksLTAuMTc3ODM2OCAwLjU3NTM1NCwtMC4wMTA0NjEgMC4yNjE1MjUsMC4xNjczNzU5IDAuNDkxNjY3LDAuMzI0MjkwNyAwLjQ5MTY2NywwLjMyNDI5MDcgMCwwIDAuMzg3MDU2LDAuMzY2MTM0NyAtMC4yOTI5MDgsMC4zNTU2NzM3IDAsMCAwLjQyODksMC4xMDQ2MDk5IC0wLjA4MzY5LDEuMzM5MDA3IGwgLTAuMTQ2NDU0LC0wLjMzNDc1MiBjIDAsMCAtMC4yMDkyMiwxLjQwMTc3MyAtMC41NzUzNTQsMC44NjgyNjIgMCwwIC0wLjE2ODU2NywwLjI4NDA0MiAtMC41NDkzMzUsMC41MzgxMTEgLTAuNDYxNzA0LDAuMzA4MDczIC0xLjIwMDYyLDAuNTc5MDM0IC0xLjg4Mjg0NiwwLjMzNTM4MiAwLDAgLTAuOTI5NDM2LDEuMDIzNTYzIC0yLjUxMjQwMiwwLjEyMTEyNSAwLDAgLTAuODcxNzI4LDAuMTY2NTUyIC0xLjQ1NzU0MywtMC44MTY3ODEgMCwwIC0wLjgwNTQ5NiwwLjE5ODc1OSAtMC45NTE5NSwtMS40OTU5MjIgMCwwIC0wLjY3OTk2NSwwLjA0MTg0IC0wLjA0MTg0LC0wLjU0Mzk3MSAwLjYzODEyLC0wLjU4NTgxNTUgMS4yMDMwMTQsLTAuNDYwMjgzNiAxLjIwMzAxNCwtMC40NjAyODM2IHoiIHN0eWxlPSJkaXNwbGF5OmlubGluZTtmaWxsOiNmOGY4Zjg7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuMDEwNDYwOTlweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQzNjUiIGQ9Im0gMTMuNTM4NTQ0LDUuMzE3OTI3NiBjIC0wLjAxNjk4LDAuMDAzMzMgLTAuMjk1NDI5LDAuMDA0MTEgLTAuNTQyNjE0LC0wLjEyODc4OTQgLTAuMTI2Mjk4LC0wLjA2NzkwNiAtMC4yNDcwMjYsLTAuMTI3MDA2OSAtMC4yOTEyNywtMC4xODU5ODA3IC0wLjAzNTY0LC0wLjA0NzUwOCAwLjAwNDEsLTAuMTExNDU4NyAtMC4wNjY4NSwtMC4wNTMwMjIgLTAuOTQ5ODUyLDAuNzgyODExNiAtMC40ODU4NjcsMi4wNDg5MTU3IDAuMzkxNTE4LDIuMzgxNzQ5OSAwLDAgMC4xNjgwMywtMC45MzA1MDIgMS4wODQ1NzEsLTEuOTg3ODA1NyIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2Y4ZjhmODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggaWQ9InBhdGg0MzY3IiBkPSJtIDE4Ljk2OTEyOSw0LjU1MTQ2OTcgYyAwLDAgMC45NjE2MTUsMC42ODA1MjcxIDEuMTk4MzIsMS42MTI1NTQzIDAsMCAxLjE1MzkzOSwtMS43MzA5MDY4IC0wLjA3Mzk3LC0yLjQyNjIyODIgMCwwIC0wLjIwNzExOCwwLjc5ODg4IC0xLjEyNDM1MSwwLjgxMzY3MzkgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2Y4ZjhmODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDIxNSIgZD0ibSAxMi44Mzg2ODUsMTAuMjA5MDE4IGMgMC4xNDQzOTksMS43NjE2ODIgMC45Mzg2MDEsMS40NzI4ODIgMC45Mzg2MDEsMS40NzI4ODIgMC42MzUzNiwxLjAxMDggMS40Mjk1NjEsMC44MjMwOCAxLjQyOTU2MSwwLjgyMzA4IDEuMzcxODAyLDAuODM3NTIyIDIuNTI3MDAzLC0wLjEwMTA3OSAyLjUyNzAwMywtMC4xMDEwNzkgMS45MzQ5NjMsMC4zMTc2OCAyLjQxMTQ4MywtMC45MjQxNjIgMi40MTE0ODMsLTAuOTI0MTYyIDAuMzc1NDQxLDAuNTc3NjAxIDAuNjA2NDgxLC0wLjgwODY0MSAwLjYwNjQ4MSwtMC44MDg2NDEgMC4wNTc3NiwtMC4xMTU1MiAwLjE0NDQwMSwwLjM0NjU2IDAuMTQ0NDAxLDAuMzQ2NTYgMC40NjIwNzksLTEuMjEyOTYwNSAwLjA4MzI0LC0xLjM3NzgzMyAwLjA4MzI0LC0xLjM3NzgzMyAxLjAxMDgwMSwwLjAyODg4IC0wLjIwMzYyNiwtMC43MDI4NzQgLTAuMjAzNjI2LC0wLjcwMjg3NCAtMC4wMjU1MywtMS4wNTkwNjU0IC0wLjAyNTA4LC0xLjMyOTIxMzEgLTAuMzkwMDU0LC0yLjMzMzQzNzggMC44MDk3OTcsMC4yMTYzODc3IDAuODExMDU3LC0wLjk2MDY1ODkgMC45NDkxNywtMS4yMjk3ODc3IDAuMTk5OTE5LC0wLjUzOTAyNDUgLTAuMDM1NiwtMS41MDQ0OTA0IC0wLjY3OTY0MSwtMS45MTk1MzIzIC0wLjI2NTQxMSwtMC4xNzEwMzg3IC0wLjYwMDIsLTAuMjQ4NjAwOSAtMS4wMDI0ODYsLTAuMTY0MzE5OCAtMC4zMDI3NTUsMC4xMzkwMTI4IC0wLjY5MjU0LDAuMzk0OTg5NSAtMC45MDc2MjgsMC42MDg2NjE5IC0wLjE5MzYxMywwLjE5MjMzOTUgLTAuMjE5NjQ5LDAuMzAzMjExNCAtMC4xOTU0NDIsMC40MTU1NTciIHN0eWxlPSJmaWxsOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiM1MDUwNTA7c3Ryb2tlLXdpZHRoOjAuMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggaWQ9InBhdGg0MjI3IiBkPSJtIDEyLjgzODY4NSwxMC4yMTE0OTUgYyAwLDAgLTAuOTA5NzIxLDAuMDk4NiAwLjI1OTkyLC0wLjgxMTExNzkgMCwwIDAuNDkwOTYsLTAuNDE4NzYwOCAxLjQ3Mjg4MSwtMC4wNTc3NiIgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQyMjkiIGQ9Ik0gMTIuOTA0OTA0LDkuNTY1NTUzIEMgMTIuNTA1NjUzLDguNzczODU0OCAxMi42NzA3OTcsOC4xNjU2MDM3IDEyLjg1MDI0NCw3Ljk1ODI5NCIgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQyMDEiIGQ9Im0gMTQuNTgxMzAzLDQuODIyNzY5MiBjIDAsMCAxLjc5NTc0OSwtMS40NTE3MDY2IDMuOTY3MjA3LC0wLjUxNTAzMDkiIHN0eWxlPSJkaXNwbGF5OmlubGluZTtmaWxsOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiM1MDUwNTA7c3Ryb2tlLXdpZHRoOjAuMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiBkPSJNIDEyLjkxMzUyNyw3Ljg5OTY1ODEgQyAxMC44OTQzNTYsOC4zNTIwMTQzIDExLjE2ODQwMiw0LjI1NDUyNDcgMTIuNzY0OTUyLDQuMzAyNTA3MyAxMy4zODM1NjksNC4yODU3MzczIDE0LjA5NzQyNCw0LjI2Nzg1NSAxNC42NTY4MSw1LjAwMTUxMyIgaWQ9InBhdGg0MjA3IiAvPiA8cGF0aCBpZD0icGF0aDQyMzMiIGQ9Im0gMTguMzQwMzMxLDEwLjQ1NDQ5OSBjIDAsMCAwLjY2NDI0LDAuNzIyIDEuMDEwODAxLC0wLjE3MzI4IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojNTA1MDUwO3N0cm9rZS13aWR0aDowLjEwNDYwOTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDIzNSIgZD0ibSAxOC44ODkwNTIsMTAuNzI4ODU5IDAuMDcyMiwwLjU2MzE2IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojNTA1MDUwO3N0cm9rZS13aWR0aDowLjEwNDYwOTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI1MSIgZD0ibSAxNC4xMzQ4Miw1LjM0NDA4MDEgYyAtMC4xNzgzOTEsMCAtMC42MzI5NDYsMC4wMDY5OCAtMC45OTQxOTIsLTAuMDg2ODE2IEMgMTIuOTA4NzMsNS4xOTcwNTE5IDEyLjcxNTI4NCw1LjA5NTMxMjUgMTIuNjU4MDI2LDQuOTIzNTM3OCIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQzMDEiIGQ9Im0gMTIuNjcyOTA2LDExLjI0OTk1OSBjIDAsMCAtMS4yMTMxMTMsMC44ODAyNDcgLTAuNzI0OTA5LDEuNTQ1OTgxIGwgMC41OTkxNiwwLjUzMjU4NiAwLjgyMTA3MiwwLjQ0MzgyMyAxLjIyNzkwNywwLjA2NjU3IDAuODA2Mjc3LC0wLjE0Nzk0MSAwLjQxNDIzNCwtMC4xODQ5MjYgMC40NDM4MjIsMC4zNzcyNSAwLjM5OTQ0MSwwLjAxNDc5IDAuMjI5MzA4LC0wLjExMDk1NiAwLjY4NzkyNCwtMC4yNzM2OTEgMC4zNjI0NTYsLTAuMjg0Nzg2IDAuMjA3MTE3LC0wLjMxNDM3MyAtMC4wMjk1OSwtMC4zNDAyNjQgYyAwLDAgLTAuMzg0NjQ2LC0xLjE2MTMzNSAtMC43OTg4OCwtMS4zNDYyNjEgMCwwIC0wLjUzMjU4NywtMC41NzY5NjkgLTEuMjcyMjkxLC0wLjA4MTM3IDAsMCAtMS4xMTY5NTIsMC4zNjk4NTIgLTIuMDg1OTY0LDAuMDQ0MzggLTAuOTY5MDEyLC0wLjMyNTQ3IC0xLjI4NzA4NSwwLjA1OTE4IC0xLjI4NzA4NSwwLjA1OTE4IHoiIHN0eWxlPSJkaXNwbGF5OmlubGluZTtmaWxsOiNmOGY4Zjg7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuMDEwNDYwOTlweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQzMjUiIGQ9Im0gMTEuODUzMTgsMTIuNDgxMDk0IGMgMCwwIDEuMjIwNTExLC0wLjcwMjcxOSAzLjA2OTc3LC0wLjE4NDkyNyAwLDAgMC45MTcyMzQsMC4xNjI3MzYgMS41MDg5OTYsLTAuMDY2NTcgMC41OTE3NjQsLTAuMjI5MzA5IDAuNzkxNDgzLDAuMjczNjkgMC43OTE0ODMsMC4yNzM2OSAwLDAgMC40NjYwMTQsMC44NDMyNjIgMC4zOTk0NCwwLjkwMjQzOCBsIDAuMTc3NTI5LC0wLjA1MTc4IDAuMjY2MjkzLC0wLjM0MDI2NCAwLjA3Mzk3LC0wLjI1ODg5NyAtMC4xNDA1NDMsLTAuNDI5MDI4IC0wLjI3MzY5MSwtMC41NzY5NjggLTAuMzEwNjc2LC0wLjQ0MzgyMiAtMC4yNTE0OTksLTAuMTg0OTI3IC0wLjQyMTYzMSwtMC4xODQ5MjUgLTAuNDA2ODM4LDAuMDI5NTkgLTAuNjA2NTU2LDAuMjUxNDk5IGMgMCwwIC0xLjAyODE4OSwwLjI4ODQ4NSAtMi4yNDg3LC0wLjE4NDkyNSAwLDAgLTAuOTAyNDM4LC0wLjE2MjczNiAtMS41MTYzOTIsMC45ODM4MDYgbCAtMC4xMTgzNTMsMC4zOTk0MzkgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2M5ZGFkODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI3OSIgZD0ibSAxNi44MzM2NzIsMTMuNzg1MjE3IGMgMC4xNTM0MjMsLTAuMTAyOTY3IDEuNDU0MTIyLC0wLjQwNTE0NCAxLjI3MTUzLC0xLjEwNzA1MiAtMC4xODI1OSwtMC43MDE5MDYgLTAuODEwNDg4LC0yLjE4MzA4IC0xLjk2Mjc0OSwtMS42MjExNTEgLTEuMTUyMjY0LDAuNTYxOTMyIC0yLjQyODI3MSwwLjA0NDIyIC0yLjQyODI3MSwwLjA0NDIyIDAsMCAtMC41MDI1NzUsLTAuMTkxMTk4IC0wLjkxNzEzNywwLjA0NDc1IC0wLjQxNDU2MiwwLjIzNTk1MSAtMC44MzU2OTEsMC42MjQyODUgLTAuOTY5NjcsMS4yNjM4MzYgLTAuMTMzOTgyLDAuNjM5NTU3IDEuNTU5NzQ1LDEuMzQxOTkxIDEuNTU5NzQ1LDEuMzQxOTkxIDAsMCAxLjYyODU2NywwLjIzODgxMyAyLjM5NTY5MywtMC4yNzYwMzUgMCwwIDAuNjI5NzI5LDAuNjk3NzcxIDEuMDUwODU5LDAuMzA5NDM3IHoiIHN0eWxlPSJkaXNwbGF5OmlubGluZTtmaWxsOm5vbmU7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiM1MDUwNTA7c3Ryb2tlLXdpZHRoOjAuMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggZD0ibSAxNy4xMTQwMTYsOC41MDk4MjQxIGEgMC45NDk4OTcwOCwwLjU4NjQwNTg3IDc4LjA3ODA2MiAwIDEgLTAuMzQwNjEzLDEuMDQwNjk1NSAwLjk0OTg5NzA4LDAuNTg2NDA1ODcgNzguMDc4MDYyIDAgMSAtMC43NzY1NjIsLTAuNjc4NzU2IDAuOTQ5ODk3MDgsMC41ODY0MDU4NyA3OC4wNzgwNjIgMCAxIDAuMjM5NTYsLTEuMTI5MDIxNiAwLjk0OTg5NzA4LDAuNTg2NDA1ODcgNzguMDc4MDYyIDAgMSAwLjgwNzczNiwwLjUzMTgzNzIgbCAtMC41MDM4NzgsMC4zNTYzODM5IHoiIGlkPSJwYXRoNDI2NSIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6IzUwNTA1MDtmaWxsLW9wYWNpdHk6MTtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5NDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIgLz4gPHBhdGggZD0iTSAyMC40MTM5NzcsOC4wMzE1OTA2IEEgMC44NTY3NjMyNSwwLjUyODkxMDk1IDc4LjA3ODA2MiAwIDEgMjAuMTA2NzYsOC45NzAyNDk4IDAuODU2NzYzMjUsMC41Mjg5MTA5NSA3OC4wNzgwNjIgMCAxIDE5LjQwNjMzNiw4LjM1ODA0MzEgMC44NTY3NjMyNSwwLjUyODkxMDk1IDc4LjA3ODA2MiAwIDEgMTkuNjIyNDA3LDcuMzM5NzE3NiAwLjg1Njc2MzI1LDAuNTI4OTEwOTUgNzguMDc4MDYyIDAgMSAyMC4zNTA5NDgsNy44MTk0MTA4IGwgLTAuNDU0NDc0LDAuMzIxNDQxNiB6IiBpZD0icGF0aDQyNjUtMiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6IzUwNTA1MDtmaWxsLW9wYWNpdHk6MTtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5NDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIgLz4gPHBhdGggaWQ9InBhdGg1NzIwIiBkPSJtIDIxLjEzNDgzMiw3LjY5NjM2MzQgYyAtMC4xMTIzMTgsLTAuMDI3NzU3IC0wLjI2MjQ5NywtMC4wODEwNTQgLTAuMzMzNzMxLC0wLjExODQzODMgLTAuMTQ0MDA1LC0wLjA3NTU3MyAtMC4yOTkzMjksLTAuMjY5ODY1MyAtMC4yOTkzMjksLTAuMzc0NDI2IDAsLTAuMDk2NjA3IC0wLjE5MzI5OCwtMC44NDY4MTQgLTAuMjk0MTMzLC0xLjE0MTU1OTcgQyAxOS45MTc4NSw1LjIxNDg4MjcgMTkuNDI2NzM2LDQuNjc1ODIwNSAxOC44MDY4MDgsNC41MjQzNDIzIDE4LjU3NDU0Myw0LjQ2NzU4OTMgMTguMzc3OTYsNC4zNzc3MTcyIDE4LjM3Nzk2LDQuMzI4Mjg1MSBjIDAsLTAuMTE2NTg3NCAwLjUxODc4NywtMC4zNzIwNTkgMC43NTU1ODcsLTAuMzcyMDgxOCAwLjIyNTEyOSwtMi4wOWUtNSAwLjU1MTc3MywwLjE5NTUxMDUgMC43NTQwMDcsMC40NTEzNTU2IDAuMDg5NTgsMC4xMTMzMjYgMC4zMzY4NDMsMC41NTg3ODc0IDAuNTQ5NDc2LDAuOTg5OTE0MSAwLjYzMDg5MSwxLjI3OTE3MTkgMS4xMjc0NjQsMS45Njg0NzM4IDEuNTY3NTYzLDIuMTc1OTYzMyAwLjIxNzMwOCwwLjEwMjQ1MTggMC4yMjYxMTYsMC4xMTE5NDIgMC4xMzA4ODEsMC4xNDEwMjE1IC0wLjE1OTgzNSwwLjA0ODgwNCAtMC43NzQ5NSwwLjAzNzY4MSAtMS4wMDA2NDIsLTAuMDE4MDk0IHoiIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjA7c3Ryb2tlLXdpZHRoOjAuMDUyMzA0OTU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lIiAvPiA8cGF0aCBpZD0icGF0aDQyNDUiIGQ9Im0gMTUuNTQ0Mzg3LDQuMzE0MzcwOSBjIDAsMCAxLjU1NTIyNiwyLjEwODgwNTMgMi4wNzgyNzYsMi4yNzYxODExIDAuNTIzMDQ5LDAuMTY3Mzc1OSAwLjU1MDA5OSwtMS4yNjczOTM5IDAuNTUwMDk5LC0xLjI2NzM5MzkgMCwwIDAuMDEwNDYsLTAuODA1NDk2MiAtMC4wMzEzOCwtMS4xNjExNyIgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQyNDkiIGQ9Im0gMTguOTQ0Mzc3LDQuNTQ1NjI2MiBjIDAuMjUwMTgyLDAuMDI5NjUgMC44NTMyMzUsLTAuMDU1OTAzIDEuMTM0NjY1LC0wLjc3MjM2OTQiIHN0eWxlPSJmaWxsOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiM1MDUwNTA7c3Ryb2tlLXdpZHRoOjAuMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHRleHQgaWQ9InRleHQ0MjQ1IiB5PSIyLjA1MTI3MTQiIHg9IjExLjU1NzI5OSIgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXNpemU6MC4xMjU1MzE4OHB4O2xpbmUtaGVpZ2h0OjAlO2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7bGV0dGVyLXNwYWNpbmc6MHB4O3dvcmQtc3BhY2luZzowcHg7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjAxMDQ2MDk5cHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHRzcGFuIHN0eWxlPSJmb250LXNpemU6MC40MTg0Mzk2cHg7bGluZS1oZWlnaHQ6MS4yNTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4IiB5PSIyLjA1MTI3MTQiIHg9IjExLjU1NzI5OSIgaWQ9InRzcGFuNDI0NyI+wqA8L3RzcGFuPjwvdGV4dD4gPC9nPiA8L3N2Zz4=) no-repeat;"),console.log("%cMusic Blocks is a collection of tools for exploring fundamental musical concepts in a fun way.","font-size: 16px; font-family: sans-serif; font-weight: bold;")):console.log("%cTurtle Blocks is a collection of tools for exploring  concepts from Logo in a fun way.","font-size: 16px; font-family: sans-serif; font-weight: bold;"),a.keyboardEnableFlag=1}document.removeEventListener("finishedLoading",o);case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}})(),a.keyboardEnableFlag=0,a.sessionData=null,a.planet)return e.n=1,a.planet.openCurrentProject();e.n=2;break;case 1:a.sessionData=e.v,e.n=3;break;case 2:t=a.storage.currentProject,a.sessionData=a.storage["SESSION"+t];case 3:if(document.addEventListener?document.addEventListener("finishedLoading",o):document.attachEvent("finishedLoading",o),a.sessionData){a.doLoadAnimation();try{"undefined"===a.sessionData||"[]"===a.sessionData?a.justLoadStart():(window.loadedSession=a.sessionData,a.blocks.loadNewBlocks(JSON.parse(a.sessionData)))}catch(e){console.error(e)}}else a.justLoadStart();a.update=!0;case 4:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})());function Y(e,t,a,o,n,l,i){a=toFraction(a),s=e.name;var s,o=((o=o.accidentals.find(function(e){return e=e.note.toUpperCase().replace(",",""),s=s.replace(",",""),e.toLowerCase()===s.toLowerCase()}))?s+("sharp"===o.acc?"♯":"flat"===o.acc?"♭":""):s).toUpperCase();null!=l&&(a[1]=i*l),n.push([t,["newnote",{collapsed:!0}],0,0,[t-1,t+1,t+4,t+8]],[t+1,"divide",0,0,[t,t+2,t+3]],[t+2,["number",{value:a[0]}],0,0,[t+1]],[t+3,["number",{value:a[1]}],0,0,[t+1]],[t+4,"vspace",0,0,[t,t+5]],[t+5,"pitch",0,0,[t+4,t+6,t+7,null]],[t+6,["notename",{value:o}],0,0,[t+5]],[t+7,["number",{value:(i=e.pitch,Math.floor(i/7)+4)}],0,0,[t+5]],[t+8,"hidden",0,0,[t,t+9]])}function x(e,t){for(var a=0;a<e.length;a++)if(e[a][0]===t)return a;return-1}this._loadProject=function(e,t){var a,o,n,l,i;void 0!==E.planet&&(t=void 0!==t?t:{run:!1,show:!1,collapse:!1},E.loading=!0,document.body.style.cursor="wait",E.doLoadAnimation(),E.textMsg(E.planet.getCurrentProjectName()),a=E,setTimeout(function(){try{a.planet.openProjectFromPlanet(e,function(){a.loadStartWrapper(j)})}catch(e){console.error(e),a.loadStartWrapper(j)}a.planet.initialiseNewProject(),a.loading=!1,document.body.style.cursor="default",a.update=!0},2500),o=t.run,n=t.show,l=t.collapse,i=function(){setTimeout(function(){if(!l&&a.firstRun&&a._toggleCollapsibleStacks(),o&&a.firstRun){for(var e=0;e<a.turtles.getTurtleCount();e++)a.turtles.getTurtle(e).painter.doClear(!0,!0,!1);a.textMsg(_("Click the run button to run the project.")),n&&a._changeBlockVisibility(),l||a._toggleCollapsibleStacks()}else n||a._changeBlockVisibility();document.removeEventListener("finishedLoading",i),a.firstRun=!1},1e3)},document.addEventListener?document.addEventListener("finishedLoading",i,!1):document.attachEvent("finishedLoading",i))},this.parseABC=(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var a,i,o,s,r,c,u,n,l,d,g,p,h,M,m,b,y,k,w,v,T,D,A,L,f,N;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:a=[],i={},o={},s=0,c=((r=null)!=(n=null==(n=t.metaText)?void 0:n.title)?n:"title").toString().toLowerCase(),u=(null!=(n=null==(n=t.metaText)?void 0:n.instruction)?n:"guitar").toString().toLowerCase(),null!=(n=t.lines)&&n.forEach(function(e){null!=(e=e.staff)&&e.forEach(function(e,t){o.hasOwnProperty(t)||(o[t]={arrangedBlocks:[]}),o[t].arrangedBlocks.push(e)})}),n=_regenerator().m(function e(l){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:null!=(t=o[l].arrangedBlocks)&&t.forEach(function(o){i.hasOwnProperty(l)||(i[l]={meterNum:(null==o||null==(e=o.meter)||null==(e=e.value[0])?void 0:e.num)||4,meterDen:(null==o||null==(e=o.meter)||null==(e=e.value[0])?void 0:e.den)||4,keySignature:o.key,baseBlocks:[],startBlock:[[s,["start",{collapsed:!1}],100,100,[null,s+1,null]],[s+1,"print",0,0,[s,s+2,s+3]],[s+2,["text",{value:c}],0,0,[s+1]],[s+3,"setturtlename2",0,0,[s+1,s+4,s+5]],[s+4,["text",{value:"Voice ".concat(parseInt(l)+1," ")}],0,0,[s+3]],[s+5,"meter",0,0,[s+3,s+6,s+7,s+10]],[s+6,["number",{value:(null==o||null==(e=o.meter)||null==(e=e.value[0])?void 0:e.num)||4}],0,0,[s+5]],[s+7,"divide",0,0,[s+5,s+8,s+9]],[s+8,["number",{value:1}],0,0,[s+7]],[s+9,["number",{value:(null==o||null==(e=o.meter)||null==(e=e.value[0])?void 0:e.den)||4}],0,0,[s+7]],[s+10,"vspace",0,0,[s+5,s+11]],[s+11,"setkey2",0,0,[s+10,s+12,s+13,s+14]],[s+12,["notename",{value:o.key.root}],0,0,[s+11]],[s+13,["modename",{value:"m"==o.key.mode?"minor":"major"}],0,0,[s+11]],[s+14,"settimbre",0,0,[s+11,s+15,null,s+16]],[s+15,["voicename",{value:u}],0,0,[s+14]],[s+16,"hidden",0,0,[s+14,null]]],repeatBlock:[],repeatArray:[],nameddoArray:{}},s+=17);var e,n=[];o.voices.forEach(function(e){e.forEach(function(e){if("note"===e.el_type)null!==(null==e?void 0:e.startTriplet)&&void 0!==(null==e?void 0:e.startTriplet)&&(r=e.startTriplet),Y(e.pitches[0],s,e.duration,o.key,n,r,i[l].meterDen),null!==(null==e?void 0:e.endTriplet)&&void 0!==(null==e?void 0:e.endTriplet)&&(r=null),s+=9;else if("bar"===e.el_type)if("bar_left_repeat"===e.type)i[l].repeatArray.push({start:i[l].baseBlocks.length,end:-1});else if("bar_right_repeat"===e.type){var t,a=i[l].repeatArray;for(t in a)-1===a[t].end&&(i[l].repeatArray[t].end=i[l].baseBlocks.length)}}),n[0][4][0]=s+3,n[n.length-1][4][1]=null,0!=i[l].baseBlocks.length&&(i[l].baseBlocks[i[l].baseBlocks.length-1][0][i[l].baseBlocks[i[l].baseBlocks.length-1][0].length-4][4][1]=s),n.push([s,["nameddo",{value:"V: ".concat(parseInt(l)+1," Line ").concat((null==(e=i[l])||null==(e=e.baseBlocks)?void 0:e.length)+1)}],0,0,[0===i[l].baseBlocks.length?null:i[l].baseBlocks[i[l].baseBlocks.length-1][0][i[l].baseBlocks[i[l].baseBlocks.length-1][0].length-4][0],null]],[s+1,["action",{collapsed:!1}],100,100,[null,s+2,s+3,null]],[s+2,["text",{value:"V: ".concat(parseInt(l)+1," Line ").concat((null==(e=i[l])||null==(e=e.baseBlocks)?void 0:e.length)+1)}],0,0,[s+1]],[s+3,"hidden",0,0,[s+1,n[0][0]]]),i[l].nameddoArray||(i[l].nameddoArray={}),i[l].nameddoArray[l]||(i[l].nameddoArray[l]=[]),i[l].nameddoArray[l].push(s),s+=4,a.push(n),i[l].baseBlocks.push([n])})});case 1:return e.a(2)}},e)}),f=_regeneratorKeys(o);case 1:if((N=f()).done){e.n=3;break}return N=N.value,e.d(_regeneratorValues(n(N)),2);case 2:e.n=1;break;case 3:for(d in l=[],i){i[d].startBlock[i[d].startBlock.length-3][4][2]=i[d].baseBlocks[0][0][i[d].baseBlocks[0][0].length-4][0],i[d].baseBlocks[0][0][i[d].baseBlocks[0][0].length-4][4][0]=i[d].startBlock[i[d].startBlock.length-3][0],L=i[d].repeatArray,g=_createForOfIteratorHelper(L);try{for(g.s();!(p=g.n()).done;)0==(h=p.value).start?(i[d].repeatBlock.push([s,"repeat",0,0,[i[d].startBlock[i[d].startBlock.length-3][0],s+1,i[d].nameddoArray[d][0],null===i[d].nameddoArray[d][h.end+1]?null:i[d].nameddoArray[d][h.end+1]]]),i[d].repeatBlock.push([s+1,["number",{value:2}],100,100,[s]]),i[d].startBlock[i[d].startBlock.length-3][4][2]=s,M=x(i[d].baseBlocks[0][0],i[d].nameddoArray[d][0]),m=x(i[d].baseBlocks[h.end][0],i[d].nameddoArray[d][h.end]),i[d].baseBlocks[h.end+1]&&i[d].baseBlocks[h.end+1][0]&&-1!=(b=x(i[d].baseBlocks[h.end+1][0],i[d].nameddoArray[d][h.end+1]))&&(i[d].baseBlocks[h.end+1][0][b][4][0]=s),i[d].baseBlocks[0][0][M][4][0]=s,i[d].baseBlocks[h.end][0][m][4][1]=null):(y=x(i[d].baseBlocks[h.start][0],i[d].nameddoArray[d][h.start]),k=x(i[d].baseBlocks[h.start-1][0],i[d].baseBlocks[h.start][0][y][4][0]),w=x(i[d].baseBlocks[h.end][0],i[d].baseBlocks[h.start][0][y][4][1]),(v=-1)===k&&(v=x(i[d].repeatBlock,i[d].baseBlocks[h.start][0][y][4][0])),i[d].baseBlocks[h.start][0][y][4][0],T=i[d].baseBlocks[h.start][0][y][0],D=i[d].nameddoArray[d][h.end+1],i[d].repeatBlock.push([s,"repeat",0,0,[i[d].baseBlocks[h.start][0][y][4][0],s+1,T,null===D?null:D]]),i[d].repeatBlock.push([s+1,["number",{value:2}],100,100,[s]]),-1!=k?i[d].baseBlocks[h.start-1][0][k][4][1]=s:i[d].repeatBlock[v][4][3]=s,-1!==w&&(i[d].baseBlocks[h.end][0][w][4][1]=null),i[d].baseBlocks[h.start][0][y][4][0]=s,null!==D&&(A=x(i[d].baseBlocks[h.end+1][0],D),i[d].baseBlocks[h.end+1][0][A][4][0]=s)),s+=2}catch(e){g.e(e)}finally{g.f()}L=(L=i[d].baseBlocks.reduce(function(e,t){return e.concat(t)},[])).flat(),[].concat(_toConsumableArray(i[d].startBlock),_toConsumableArray(L)),l.push.apply(l,_toConsumableArray(i[d].startBlock)),l.push.apply(l,_toConsumableArray(L)),l.push.apply(l,_toConsumableArray(i[d].repeatBlock))}return this.blocks.loadNewBlocks(l),e.a(2,null)}},e,this)}));return function(e){return t.apply(this,arguments)}})(),this.loadStartWrapper=(()=>{var n=_asyncToGenerator(_regenerator().m(function e(t,a,o,n){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t(E,a,o,n);case 1:E.showContents();case 2:return e.a(2)}},e)}));return function(e,t,a,o){return n.apply(this,arguments)}})(),this.showContents=function(){clearInterval(window.intervalId),document.getElementById("loadingText").textContent=_("Loading Complete!"),setTimeout(function(){document.getElementById("loadingText").textContent=null,document.getElementById("loading-image-container").style.display="none",document.getElementById("bottom-right-logo").style.display="none",document.getElementById("palette").style.display="block",document.getElementById("hideContents").style.display="block",document.getElementById("buttoncontainerBOTTOM").style.display="block",document.getElementById("buttoncontainerTOP").style.display="block"},500)},this.justLoadStart=function(){E.blocks.loadNewBlocks(DATAOBJS)};function H(e){e.turtles.running()&&e._doHardStopButton(),void 0!==e.planet&&e.planet.getCurrentProjectName()!==_("My Project")?(e.planet.saveLocally(),e.planet.initialiseNewProject(),j(e),e.planet.saveLocally()):(e.toolbar.closeAuxToolbar(S),setTimeout(function(){e.sendAllToTrash(!1,!1),e.blocks.loadNewBlocks(DATAOBJS)},1e3))}function Q(e){e._doOpenPlugin()}function Z(e){B(e,!0)}function F(e){new JSEditor(e)}function X(e){e.statsWindow&&e.statsWindow.isOpen||(e.statsWindow=new StatsWindow(e))}function J(e){e._showHelp()}function V(e){e._showAboutPage()}this.hideMsgs=function(){if(null!==E.errorMsgText){for(var e in E.errorMsgText.parent.visible=!1,E.errorText.classList.remove("show"),E._hideArrows(),E.msgText.parent.visible=!1,E.printText.classList.remove("show"),E.errorArtwork)E.errorArtwork[e].visible=!1;E.refreshCanvas()}},this._hideArrows=function(){null!==E.errorMsgArrow&&(E.errorMsgArrow.removeAllChildren(),E.refreshCanvas())},this.textMsg=function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_MSGTIMEOUT_;null!==E.msgTimeoutID&&(clearTimeout(E.msgTimeoutID),E.msgTimeoutID=null),null!==E.msgText&&(E.printText.classList.add("show"),E.printTextContent.innerHTML=e,(t=E).msgTimeoutID=setTimeout(function(){t.printText.classList.remove("show"),t.msgTimeoutID=null},a))},this.errorMsg=function(e,t,a,o){if(null!==E.errorMsgTimeoutID&&clearTimeout(E.errorMsgTimeoutID),null!==E.errorMsgText){var n,l;switch(null!=t&&t in E.blocks.blockList&&!E.blocks.blockList[t].collapsed&&(l=E.canvas.width/2,s=E.blocks.blockList[t].container.x+E.blocksContainer.x,t=E.blocks.blockList[t].container.y+E.blocksContainer.y,null===E.errorMsgArrow&&(E.errorMsgArrow=new createjs.Container,E.stage.addChild(E.errorMsgArrow)),n=new createjs.Shape,E.errorMsgArrow.addChild(n),n.graphics.setStrokeStyle(4).beginStroke("#ff0031").moveTo(l,128).lineTo(s,t),E.stage.setChildIndex(E.errorMsgArrow,E.stage.children.length-1),n=Math.atan2(s-l,128-t)/Math.PI*180,l=new createjs.Shape,E.errorMsgArrow.addChild(l),l.graphics.setStrokeStyle(4).beginStroke("#ff0031").moveTo(-10,18).lineTo(0,0).lineTo(10,18),l.x=s,l.y=t,l.rotation=n),e){case NOMICERRORMSG:E.errorArtwork.nomicrophone.visible=!0,E.stage.setChildIndex(E.errorArtwork.nomicrophone,E.stage.children.length-1);break;case NOSTRINGERRORMSG:E.errorArtwork.notastring.visible=!0,E.stage.setChildIndex(E.errorArtwork.notastring,E.stage.children.length-1);break;case EMPTYHEAPERRORMSG:E.errorArtwork.emptyheap.visible=!0,E.stage.setChildIndex(E.errorArtwork.emptyheap,E.stage.children.length-1);break;case NOSQRTERRORMSG:E.errorArtwork.negroot.visible=!0,E.stage.setChildIndex(E.errorArtwork.negroot,E.stage.children.length-1);break;case NOACTIONERRORMSG:E.errorArtwork.nostack.children[1].text=a=null===a?"foo":a,E.errorArtwork.nostack.visible=!0,E.errorArtwork.nostack.updateCache(),E.stage.setChildIndex(E.errorArtwork.nostack,E.stage.children.length-1);break;case NOBOXERRORMSG:E.errorArtwork.emptybox.children[1].text=a=null===a?"foo":a,E.errorArtwork.emptybox.visible=!0,E.errorArtwork.emptybox.updateCache(),E.stage.setChildIndex(E.errorArtwork.emptybox,E.stage.children.length-1);break;case ZERODIVIDEERRORMSG:E.errorArtwork.zerodivide.visible=!0,E.stage.setChildIndex(E.errorArtwork.zerodivide,E.stage.children.length-1);break;case NANERRORMSG:E.errorArtwork.notanumber.visible=!0,E.stage.setChildIndex(E.errorArtwork.notanumber,E.stage.children.length-1);break;case NOINPUTERRORMSG:E.errorArtwork.noinput.visible=!0,E.stage.setChildIndex(E.errorArtwork.noinput,E.stage.children.length-1);break;default:E.errorText.classList.add("show"),E.errorTextContent.innerHTML=e}var i,s=void 0!==o?o:_ERRORMSGTIMEOUT_;0<s&&((i=E).errorMsgTimeoutID=setTimeout(function(){i.hideMsgs()},s)),E.refreshCanvas()}},this.hideErrorText=function(){E.errorText&&(E.errorText.style.display="none")},this.hidePrintText=function(){E.printText&&E.printText.classList.remove("show")},this._hideCartesian=function(){E.cartesianBitmap.visible=!1,E.cartesianBitmap.updateCache(),E.update=!0},this._showCartesian=function(){E.cartesianBitmap.visible=!0,E.cartesianBitmap.updateCache(),E.update=!0},this._hidePolar=function(){E.polarBitmap.visible=!1,E.polarBitmap.updateCache(),E.update=!0},this._showPolar=function(){E.polarBitmap.visible=!0,E.polarBitmap.updateCache(),E.update=!0},this._hideAccidentals=function(){for(var e=E.canvas.width/(2*E.turtleBlocksScale)-600,t=0;t<7;t++)E.grandSharpBitmap[t].visible=!1,E.grandSharpBitmap[t].x=e,E.grandSharpBitmap[t].updateCache(),E.grandFlatBitmap[t].visible=!1,E.grandFlatBitmap[t].x=e,E.grandFlatBitmap[t].updateCache(),E.trebleSharpBitmap[t].visible=!1,E.trebleSharpBitmap[t].x=e,E.trebleSharpBitmap[t].updateCache(),E.trebleFlatBitmap[t].visible=!1,E.trebleFlatBitmap[t].x=e,E.trebleFlatBitmap[t].updateCache(),E.sopranoSharpBitmap[t].visible=!1,E.sopranoSharpBitmap[t].x=e,E.sopranoSharpBitmap[t].updateCache(),E.sopranoFlatBitmap[t].visible=!1,E.sopranoFlatBitmap[t].x=e,E.sopranoFlatBitmap[t].updateCache(),E.altoSharpBitmap[t].visible=!1,E.altoSharpBitmap[t].x=e,E.altoSharpBitmap[t].updateCache(),E.altoFlatBitmap[t].visible=!1,E.altoFlatBitmap[t].x=e,E.altoFlatBitmap[t].updateCache(),E.tenorSharpBitmap[t].visible=!1,E.tenorSharpBitmap[t].x=e,E.tenorSharpBitmap[t].updateCache(),E.tenorFlatBitmap[t].visible=!1,E.tenorFlatBitmap[t].x=e,E.tenorFlatBitmap[t].updateCache(),E.bassSharpBitmap[t].visible=!1,E.bassSharpBitmap[t].x=e,E.bassSharpBitmap[t].updateCache(),E.bassFlatBitmap[t].visible=!1,E.bassFlatBitmap[t].x=e,E.bassFlatBitmap[t].updateCache();E.update=!0},this._hideTreble=function(){E.trebleBitmap.visible=!1,E.trebleBitmap.updateCache(),E._hideAccidentals(),E.update=!0},this._showTreble=function(){E.trebleBitmap.visible=!0,E.trebleBitmap.updateCache(),E._hideAccidentals(),console.log(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1]);for(var e=buildScale(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1])[0],t=(console.log(e),["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP]),a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,n=0;n<7;n++)e.includes(t[n])&&(E.trebleSharpBitmap[n].x+=o,E.trebleSharpBitmap[n].visible=!0,E.trebleSharpBitmap[n].updateCache(),o+=15),e.includes(a[n])&&(E.trebleFlatBitmap[n].x+=o,E.trebleFlatBitmap[n].visible=!0,E.trebleFlatBitmap[n].updateCache(),o+=15);E.update=!0},this._hideGrand=function(){E.grandBitmap.visible=!1,E.grandBitmap.updateCache(),E._hideAccidentals(),E.update=!0},this._showGrand=function(){E.grandBitmap.visible=!0,E.grandBitmap.updateCache(),E._hideAccidentals(),console.log(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1]);for(var e=buildScale(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1])[0],t=(console.log(e),["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP]),a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,n=0;n<7;n++)e.includes(t[n])&&(E.grandSharpBitmap[n].x+=o,E.grandSharpBitmap[n].visible=!0,E.grandSharpBitmap[n].updateCache(),o+=15),e.includes(a[n])&&(E.grandFlatBitmap[n].x+=o,E.grandFlatBitmap[n].visible=!0,E.grandFlatBitmap[n].updateCache(),o+=15);E.update=!0},this._hideSoprano=function(){E.sopranoBitmap.visible=!1,E.sopranoBitmap.updateCache(),E.update=!0},this._showSoprano=function(){E.sopranoBitmap.visible=!0,E.sopranoBitmap.updateCache(),E._hideAccidentals(),console.log(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1]);for(var e=buildScale(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1])[0],t=(console.log(e),["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP]),a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,n=0;n<7;n++)e.includes(t[n])&&(E.sopranoSharpBitmap[n].x+=o,E.sopranoSharpBitmap[n].visible=!0,E.sopranoSharpBitmap[n].updateCache(),o+=15),e.includes(a[n])&&(E.sopranoFlatBitmap[n].x+=o,E.sopranoFlatBitmap[n].visible=!0,E.sopranoFlatBitmap[n].updateCache(),o+=15);E.update=!0},this._hideAlto=function(){E.altoBitmap.visible=!1,E.altoBitmap.updateCache(),E._hideAccidentals(),E.update=!0},this.__showAltoAccidentals=function(){},this._showAlto=function(){E.altoBitmap.visible=!0,E.altoBitmap.updateCache(),E._hideAccidentals(),console.log(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1]);for(var e=buildScale(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1])[0],t=(console.log(e),["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP]),a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,n=0;n<7;n++)e.includes(t[n])&&(E.altoSharpBitmap[n].x+=o,E.altoSharpBitmap[n].visible=!0,E.altoSharpBitmap[n].updateCache(),o+=15),e.includes(a[n])&&(E.altoFlatBitmap[n].x+=o,E.altoFlatBitmap[n].visible=!0,E.altoFlatBitmap[n].updateCache(),o+=15);E.update=!0},this._hideTenor=function(){E.tenorBitmap.visible=!1,E.tenorBitmap.updateCache(),E.update=!0},this._showTenor=function(){E.tenorBitmap.visible=!0,E.tenorBitmap.updateCache(),E._hideAccidentals(),console.log(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1]);for(var e=buildScale(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1])[0],t=(console.log(e),["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP]),a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,n=0;n<7;n++)e.includes(t[n])&&(E.tenorSharpBitmap[n].x+=o,E.tenorSharpBitmap[n].visible=!0,E.tenorSharpBitmap[n].updateCache(),o+=15),e.includes(a[n])&&(E.tenorFlatBitmap[n].x+=o,E.tenorFlatBitmap[n].visible=!0,E.tenorFlatBitmap[n].updateCache(),o+=15);E.update=!0},this._hideBass=function(){E.bassBitmap.visible=!1,E.bassBitmap.updateCache(),E._hideAccidentals(),E.update=!0},this._showBass=function(){E.bassBitmap.visible=!0,E.bassBitmap.updateCache(),E._hideAccidentals(),console.log(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1]);for(var e=buildScale(E.KeySignatureEnv[0]+" "+E.KeySignatureEnv[1])[0],t=(console.log(e),["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP]),a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,n=0;n<7;n++)e.includes(t[n])&&(E.bassSharpBitmap[n].x+=o,E.bassSharpBitmap[n].visible=!0,E.bassSharpBitmap[n].updateCache(),o+=15),e.includes(a[n])&&(E.bassFlatBitmap[n].x+=o,E.bassFlatBitmap[n].visible=!0,E.bassFlatBitmap[n].updateCache(),o+=15);E.update=!0},this.prepareExport=function(){var e=[];E.hasMatrixDataBlock=!1;for(var t=0;t<E.blocks.blockList.length;t++)E.blocks.blockList[t].trash||e.push(t);for(var a=[],o=0;o<E.blocks.blockList.length;o++){var n=E.blocks.blockList[o],l=null;if(!n.trash){if(n.isValueBlock()||"loadFile"===n.name||"boolean"===n.name)switch(n.name){case"namedbox":case"namedarg":l={value:n.privateData};break;default:l={value:n.value}}else switch(n.name){case"start":case"drum":var i=E.turtles.getTurtle(n.value),l=null==i?{id:E.turtles.getTurtleCount(),collapsed:!1,xcor:0,ycor:0,heading:0,color:0,shade:50,pensize:5,grey:100}:{id:i.id,collapsed:n.collapsed,xcor:i.x,ycor:i.y,heading:i.orientation,color:i.painter.color,shade:i.painter.value,pensize:i.painter.stroke,grey:i.painter.chroma};break;case"temperament1":E.blocks.customTemperamentDefined&&(i="custom",null!==n.connections[1]&&(i=E.blocks.blockList[n.connections[1]].value),console.log(i),l={customName:i,customTemperamentNotes:getTemperament(i),startingPitch:E.logo.synth.startingPitch,octaveSpace:getOctaveRatio()});break;case"interval":case"newnote":case"action":case"matrix":case"pitchdrummatrix":case"rhythmruler":case"timbre":case"pitchstaircase":case"tempo":case"pitchslider":case"musickeyboard":case"modewidget":case"meterwidget":case"status":l={collapsed:n.collapsed};break;case"storein2":case"nameddo":case"nameddoArg":case"namedcalc":case"namedcalcArg":case"outputtools":l={value:n.privateData};break;case"nopValueBlock":case"nopZeroArgBlock":case"nopOneArgBlock":case"nopTwoArgBlock":case"nopThreeArgBlock":n.name=n.privateData;break;case"matrixData":l={notes:window.savedMatricesNotes,count:window.savedMatricesCount},E.hasMatrixDataBlock=!0;break;case"wrapmode":l={value:n.value}}for(var s=[],r=0;r<n.connections.length;r++){var c=e.indexOf(n.connections[r]);null===n.connections[r]||-1===c?s.push(null):s.push(c)}a.push(null===l?[e.indexOf(o),n.name,n.container.x,n.container.y,s]:[e.indexOf(o),[n.name,l],n.container.x,n.container.y,s])}}return JSON.stringify(a)},this._doOpenPlugin=function(){E.toolbar.closeAuxToolbar(S),E.pluginChooser.focus(),E.pluginChooser.click()},this._setupPaletteMenu=function(){function e(e,t,a){return e=E._makeButton(e,t,n,l,o,0),E._loadButtonDragHandler(e,a,E),n+=o,e}var o=E.cellSize,n=window.innerWidth-4*o-27.5,l=window.innerHeight-57.5,t=document.getElementById("buttoncontainerBOTTOM");t&&t.parentNode.removeChild(t),(t=document.createElement("div")).setAttribute("id","buttoncontainerBOTTOM"),t.style.display="block",document.body.appendChild(t),E.homeButtonContainer=e(GOHOMEFADEDBUTTON,_("Home")+" ["+_("Home").toUpperCase()+"]",i),E.boundary.hide(),E.helpfulWheelItems.find(function(e){return"Home [HOME]"===e.label})||E.helpfulWheelItems.push({label:"Home [HOME]",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(GOHOMEFADEDBUTTON)),display:!0,fn:i}),E.hideBlocksContainer=e(SHOWBLOCKSBUTTON,_("Show/hide blocks"),N),E.helpfulWheelItems.find(function(e){return"Show/hide blocks"===e.label})||E.helpfulWheelItems.push({label:"Show/hide blocks",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(SHOWBLOCKSBUTTON)),display:!0,fn:N}),E.collapseBlocksContainer=e(COLLAPSEBLOCKSBUTTON,_("Expand/collapse blocks"),I),E.helpfulWheelItems.find(function(e){return"Expand/collapse blocks"===e.label})||E.helpfulWheelItems.push({label:"Expand/collapse blocks",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(COLLAPSEBLOCKSBUTTON)),display:!0,fn:I}),E.smallerContainer=e(SMALLERBUTTON,_("Decrease block size"),u),E.helpfulWheelItems.find(function(e){return"Decrease block size"===e.label})||E.helpfulWheelItems.push({label:"Decrease block size",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(SMALLERBUTTON)),display:!0,fn:u}),E.largerContainer=e(BIGGERBUTTON,_("Increase block size"),c),E.helpfulWheelItems.find(function(e){return"Increase block size"===e.label})||E.helpfulWheelItems.push({label:"Increase block size",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(BIGGERBUTTON)),display:!0,fn:c}),E.helpfulWheelItems.find(function(e){return"Restore"===e.label})||E.helpfulWheelItems.push({label:"Restore",icon:"imgsrc:header-icons/restore-from-trash.svg",display:!0,fn:G}),E.helpfulWheelItems.find(function(e){return"Turtle Wrap Off"===e.label})||E.helpfulWheelItems.push({label:"Turtle Wrap Off",icon:"imgsrc:header-icons/wrap-text.svg",display:!0,fn:E.toolbar.changeWrap}),E.helpfulWheelItems.find(function(e){return"Turtle Wrap On"===e.label})||E.helpfulWheelItems.push({label:"Turtle Wrap On",icon:"imgsrc:header-icons/wrap-text.svg",display:!1,fn:E.toolbar.changeWrap}),E.helpfulWheelItems.find(function(e){return"Enable horizontal scrolling"===e.label})||E.helpfulWheelItems.push({label:"Enable horizontal scrolling",icon:"imgsrc:header-icons/compare-arrows.svg",display:!E.beginnerMode,fn:k}),E.helpfulWheelItems.find(function(e){return"Disable horizontal scrolling"===e.label})||E.helpfulWheelItems.push({label:"Disable horizontal scrolling",icon:"imgsrc:header-icons/lock.svg",display:!1,fn:k}),_THIS_IS_MUSIC_BLOCKS_&&!E.helpfulWheelItems.find(function(e){return"Set Pitch Preview"===e.label})&&E.helpfulWheelItems.push({label:"Set Pitch Preview",icon:"imgsrc:header-icons/music-note.svg",display:!0,fn:C}),E.helpfulWheelItems.find(function(e){return"Grid"===e.label})||E.helpfulWheelItems.push({label:"Grid",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(CARTESIANBUTTON)),display:!0,fn:piemenuGrid}),E.helpfulWheelItems.find(function(e){return"Select"===e.label})||E.helpfulWheelItems.push({label:"Select",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(SELECTBUTTON)),display:!0,fn:E.selectMode}),E.helpfulWheelItems.find(function(e){return"Clear"===e.label})||E.helpfulWheelItems.push({label:"Clear",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(CLEARBUTTON)),display:!0,fn:function(){return E._allClear(!1)}}),E.helpfulWheelItems.find(function(e){return"Collapse"===e.label})||E.helpfulWheelItems.push({label:"Collapse",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(COLLAPSEBUTTON)),display:!0,fn:E.turtles.collapse}),E.helpfulWheelItems.find(function(e){return"Expand"===e.label})||E.helpfulWheelItems.push({label:"Expand",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(EXPANDBUTTON)),display:!1,fn:E.turtles.expand}),E.helpfulWheelItems.find(function(e){return"Search for Blocks"===e.label})||E.helpfulWheelItems.push({label:"Search for Blocks",icon:"imgsrc:header-icons/search-button.svg",display:!0,fn:E._displayHelpfulSearchDiv}),E.helpfulWheelItems.find(function(e){return"Paste previous stack"===e.label})||E.helpfulWheelItems.push({label:"Paste previous stack",icon:"imgsrc:header-icons/copy-button.svg",display:!1,fn:E.turtles.expand}),E.helpfulWheelItems.find(function(e){return"Close"===e.label})||E.helpfulWheelItems.push({label:"Close",icon:"imgsrc:header-icons/cancel-button.svg",display:!0,fn:E._hideHelpfulSearchWidget})},this.showHelpfulSearchWidget=function(){var e,t=jQuery.noConflict();if(t("#helpfulSearch"))try{t("#helpfulSearch").autocomplete("destroy")}catch(e){}E.helpfulSearchWidget.style.zIndex=1001,E.helpfulSearchWidget.idInput_custom="","block"===E.helpfulSearchDiv.style.display&&(E.helpfulSearchWidget.value=null,E.helpfulSearchWidget.style.visibility="visible",E.searchBlockPosition=[100,100],E.prepSearchWidget(),e=E,setTimeout(function(){e.helpfulSearchWidget.focus(),e.doHelpfulSearch()},500),document.getElementById("helpfulWheelDiv").style.display="none")},this.doHelpfulSearch=function(){var e,t,a,o=jQuery.noConflict(),n=E,l=(o("#helpfulSearch").autocomplete({source:n.searchSuggestions,select:function(e,t){e.preventDefault(),n.helpfulSearchWidget.value=t.item.label,n.helpfulSearchWidget.idInput_custom=t.item.value,n.helpfulSearchWidget.protoblk=t.item.specialDict,n.doHelpfulSearch()},focus:function(e){e.preventDefault()}}),o("#helpfulSearch").autocomplete("instance")._renderItem=function(e,t){return o("<li></li>").data("item.autocomplete",t).append('<img src="'+t.artwork+'" height = "20px"><a> '+t.label+"</a>").appendTo(e.css("z-index",9999))},E.helpfulSearchWidget.idInput_custom);!l||l.length<=0||(t=(e=E.helpfulSearchWidget.protoblk).palette.name,E.blocks.protoBlockDict.hasOwnProperty(a=e.name)?(E.palettes.dict[t].makeBlockFromSearch(e,a,function(e){n.blocks.moveBlock(e,100+n.searchBlockPosition[0]-n.blocksContainer.x,n.searchBlockPosition[1]-n.blocksContainer.y)}),E.searchBlockPosition[0]+=STANDARDBLOCKHEIGHT,E.searchBlockPosition[1]+=STANDARDBLOCKHEIGHT):-1<E.deprecatedBlockNames.indexOf(l)?E.errorMsg(_("This block is deprecated.")):E.errorMsg(_("Block cannot be found.")),E.helpfulSearchWidget.value="",document.getElementById("helpfulSearchDiv").style.display="none",E.update=!0)},this._showHelp=function(){new HelpWidget(E,!1)};this._showAboutPage=function(){new HelpWidget(E,!1)},this._makeButton=function(e,t,a,o){var n=document.createElement("div"),l=(n.setAttribute("id",""+t),n.setAttribute("class","tooltipped"),n.setAttribute("data-tooltip",t),n.setAttribute("data-position","top"),jQuery.noConflict()(".tooltipped").tooltip({html:!0,delay:100}),E);return n.onmouseover=function(){l.loading||(document.body.style.cursor="pointer",n.style.transition="0.12s ease-out",n.style.transform="scale(1.15)")},n.onmouseout=function(){l.loading||(document.body.style.cursor="default",n.style.transition="0.15s ease-out",n.style.transform="scale(1)")},(t=new Image).src="data:image/svg+xml;base64,"+window.btoa(base64Encode(e)),n.appendChild(t),n.setAttribute("style","position: absolute; right:"+(document.body.clientWidth-a)+"px;  top: "+o+"px;"),document.getElementById("buttoncontainerBOTTOM").appendChild(n),n},this._loadButtonDragHandler=function(e,t,a){var o=E;e.onmousedown=function(){o.loading||(document.body.style.cursor="default"),t(a)}},this.pasted=function(){var e=document.getElementById("paste").value,t="";if(null!==e&&""!==e){var a,e=e.replace("\n"," ");try{t=JSON.parse(e)}catch(e){return void E.errorMsg(_("Could not parse JSON input."))}for(a in E.palettes.dict)E.palettes.dict[a].hideMenu(!0);E.refreshCanvas(),E.blocks.loadNewBlocks(t),E.pasteBox.hide()}},this.deltaY=function(e){E.toolbarHeight+=e;for(var t=0;t<E.onscreenButtons.length;t++)E.onscreenButtons[t].y+=e;for(var a=0;a<E.onscreenMenu.length;a++)E.onscreenMenu[a].y+=e;E.palettes.deltaY(e),E.turtles.deltaY(e),E.blocksContainer.y+=e,E.refreshCanvas()},this.domReady=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return E.saveLocally=void 0,E.update=!0,e.n=1,E.init();case 1:return e.a(2)}},e)})),this.__saveLocally=function(){var e=E.prepareExport();if(void 0===E.storage.currentProject)try{E.storage.currentProject="My Project",E.storage.allProjects=JSON.stringify(["My Project"])}catch(e){console.error(e)}var a="";try{a=E.storage.currentProject,E.storage["SESSION"+a]=e}catch(e){console.error(e)}var o=new Image,e=doSVG(E.canvas,E.logo,E.turtles,320,240,320/E.canvas.width);o.onload=function(){var e=new createjs.Bitmap(o),t=e.getBounds();e.cache(t.x,t.y,t.width,t.height);try{f.storage["SESSIONIMAGE"+a]=e.bitmapCache.getCacheDataURL()}catch(e){console.error(e)}},o.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(e))},this.setupMouseEvents=function(){E.addEventListener(document,"mousedown",function(e){E.isSelecting&&(E.moving=!1,"myCanvas"===e.target.id)&&E._createDrag(e)},!1)},this.deselectSelectedBlocks=function(){E.unhighlightSelectedBlocks(!1),E.setSelectionMode(!1)},this.addEventListener(document.getElementById("toolbars"),"mouseover",function(){E.isDragging=!1}),this.deleteMultipleBlocks=function(){if(E.blocks.selectionModeOn){for(var e=E.blocks.selectedBlocks,t=[],a=[],o=0;o<e.length;o++)E.blocks.selectedBlocks[o].isClampBlock()?t.push(E.blocks.selectedBlocks[o]):E.blocks.selectedBlocks[o].isDisconnected()&&a.push(E.blocks.selectedBlocks[o]);for(var n=0;n<t.length;n++)E.blocks.sendStackToTrash(t[n]);for(var l=0;l<a.length;l++)E.blocks.sendStackToTrash(a[l]);E.blocks.setSelectionToActivity(!1),E.refreshCanvas(),document.getElementById("helpfulWheelDiv").style.display="none"}},this.copyMultipleBlocks=function(){if(E.blocks.selectionModeOn&&E.blocks.selectedBlocks.length){for(var e=E.blocks.selectedBlocks,a=0,o=0,n=new Map,l=0;l<e.length;l++)(()=>{var t=E.blocks.blockList.indexOf(e[l]);n.set(t,e[l].connections.filter(function(e){return null!==e})),e[l].connections.some(function(e){return(e=n.get(e))&&e.some(function(e){return e===t})})||e[l].trash||(E.blocks.activeBlock=t,E.blocks.pasteDx=a,E.blocks.pasteDy=o,E.blocks.prepareStackForCopy(),E.blocks.pasteStack(),a+=21,o+=21)})();E.setSelectionMode(!1),E.selectedBlocks=[],E.unhighlightSelectedBlocks(!1,!1),E.blocks.setSelectedBlocks(E.selectedBlocks),E.refreshCanvas(),document.getElementById("helpfulWheelDiv").style.display="none"}},this.selectMode=function(){E.moving=!1,E.isSelecting=!E.isSelecting,E.isSelecting?E.textMsg(_("Select is enabled.")):E.textMsg(_("Select is disabled.")),document.getElementById("helpfulWheelDiv").style.display="none"},this._create2Ddrag=function(){E.dragArea={},E.selectedBlocks=[],E.startX=0,E.startY=0,E.currentX=0,E.currentY=0,E.hasMouseMoved=!1,E.selectionArea&&E.selectionArea.parentNode&&E.selectionArea.parentNode.removeChild(E.selectionArea),E.selectionArea=document.createElement("div"),document.body.appendChild(E.selectionArea),E.setupMouseEvents(),E.addEventListener(document,"mousemove",function(e){E.hasMouseMoved=!0,E.isDragging&&E.isSelecting&&(E.currentX=e.clientX,E.currentY=e.clientY,E.blocks.isBlockMoving||E.turtles.running()||(E.setSelectionMode(!0),E.drawSelectionArea(),E.selectedBlocks=E.selectBlocksInDragArea(),E.unhighlightSelectedBlocks(!0,!0),E.blocks.setSelectedBlocks(E.selectedBlocks)))}),E.addEventListener(document,"mouseup",function(e){E.isSelecting&&(E.isDragging=!1,E.selectionArea.style.display="none",E.startX=0,E.startY=0,E.currentX=0,E.currentY=0,setTimeout(function(){E.hasMouseMoved=!1},100))})},this._createDrag=function(e){E.isDragging=!0,E.startX=e.clientX,E.startY=e.clientY},this.drawSelectionArea=function(){var e=Math.min(E.startX,E.currentX),t=Math.min(E.startY,E.currentY),a=Math.abs(E.currentX-E.startX),o=Math.abs(E.currentY-E.startY);E.selectionArea.style.display="flex",E.selectionArea.style.position="absolute",E.selectionArea.style.left=e+"px",E.selectionArea.style.top=t+"px",E.selectionArea.style.height=o+"px",E.selectionArea.style.width=a+"px",E.selectionArea.style.zIndex="9989",E.selectionArea.style.backgroundColor="rgba(137, 207, 240, 0.5)",E.selectionArea.style.pointerEvents="none",E.dragArea={x:e,y:t,width:a,height:o}},this.rectanglesOverlap=function(e,t){return e.x+e.width>t.x&&e.x<t.x+t.width&&e.y+e.height>t.y&&e.y<t.y+t.height},this.selectBlocksInDragArea=function(e,t){var a=[];return E.dragRect=E.dragArea,E.blocks.blockList.forEach(function(e){E.blockRect={x:E.scrollBlockContainer?e.container.x+E.blocksContainer.x:e.container.x,y:e.container.y+E.blocksContainer.y,height:e.height,width:e.width},E.rectanglesOverlap(E.blockRect,E.dragRect)&&a.push(e)}),a},this.unhighlightSelectedBlocks=function(e,t){for(var a=0;a<E.selectedBlocks.length;a++)for(var o in E.blocks.blockList)E.isEqual(E.blocks.blockList[o],E.selectedBlocks[a])&&(e?E.blocks.unhighlightSelectedBlocks(o,!0):(E.blocks.highlight(o,!0),E.refreshCanvas()))},this.isEqual=function(e,t){var a=Object.keys(e),o=Object.keys(t);if(a.length!==o.length)return!1;for(var n=0,l=a;n<l.length;n++){var i=l[n];if(!t.hasOwnProperty(i))return!1}for(var s=0,r=a;s<r.length;s++){var c=r[s];if(e[c]!==t[c])return!1}return!0},this.setSelectionMode=function(e){e?E.selectionModeOn||0!==E.selectedBlocks.length&&(E.selectedBlocks=[],E.selectionModeOn=e,E.blocks.setSelection(E.selectionModeOn)):(E.selectedBlocks=[],E.selectionModeOn=e,E.blocks.setSelection(E.selectionModeOn))},this.init=_asyncToGenerator(_regenerator().m(function e(){var i,t,a,o,n,l,s,r,c,u,d,g,p;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return E._clientWidth=document.body.clientWidth,E._clientHeight=document.body.clientHeight,E._innerWidth=window.innerWidth,E._innerHeight=window.innerHeight,E._outerWidth=window.outerWidth,E._outerHeight=window.outerHeight,document.getElementById("loader").className="loader",doBrowserCheck(),i=E,jQuery.browser.mozilla||(window.onblur=function(){w(i,!0)}),E.stage=new createjs.Stage(E.canvas),createjs.Touch.enable(E.stage),t=0,document.addEventListener("mousemove",function(){++t%4==0&&i.__tick()}),document.addEventListener("click",function(e){E.hasMouseMoved||(E.selectionModeOn?E.deselectSelectedBlocks():E._hideHelpfulSearchWidget(e))}),E._createMsgContainer("#ffffff","#7a7a7a",function(e){i.msgText=e},130),E._createMsgContainer("#ffcbc4","#ff0031",function(e){i.errorMsgText=e},130),E._createErrorContainers(),E.blocksContainer=new createjs.Container,E.trashContainer=new createjs.Container,E.turtleContainer=new createjs.Container,E.stage.addChild(E.turtleContainer),E.stage.addChild(E.trashContainer),E.stage.addChild(E.blocksContainer),E._setupBlocksContainerEvents(),E.trashcan=new Trashcan(E),E.turtles=new Turtles(E),E.boundary=new Boundary(E.blocksContainer),E.blocks=new Blocks(E),E.palettes=new Palettes(E),E.palettes.init(),E.logo=new Logo(E),E.pasteBox=new PasteBox(E),E.languageBox=new LanguageBox(E),E.themeBox=new ThemeBox(E),E.firstTimeUser&&E._showHelp(),e.p=1,E.planet=new PlanetInterface(E),e.n=2,E.planet.init();case 2:e.n=4;break;case 3:e.p=3,E.planet=void 0;case 4:for(E.save=new SaveInterface(E),E.toolbar=new Toolbar,E.toolbar.init(E),E.toolbar.renderLogoIcon(V),E.toolbar.renderPlayIcon(M),E.toolbar.renderStopIcon(w),E.toolbar.renderNewProjectIcon(H),E.toolbar.renderLoadIcon(B),E.toolbar.renderSaveIcons(E.save.saveHTML.bind(E.save),doSVG,E.save.saveSVG.bind(E.save),E.save.saveMIDI.bind(E.save),E.save.savePNG.bind(E.save),E.save.saveWAV.bind(E.save),E.save.saveLilypond.bind(E.save),E.save.saveAbc.bind(E.save),E.save.saveMxml.bind(E.save),E.save.saveBlockArtwork.bind(E.save),E.save.saveBlockArtworkPNG.bind(E.save)),E.toolbar.renderPlanetIcon(E.planet,R),E.toolbar.renderMenuIcon(S),E.toolbar.renderHelpIcon(J),E.toolbar.renderModeSelectIcon(z,m,X,Q,W,k),E.toolbar.renderRunSlowlyIcon(b),E.toolbar.renderRunStepIcon(y),E.toolbar.renderThemeSelectIcon(E.themeBox,E.themes),E.toolbar.renderMergeIcon(Z),E.toolbar.renderRestoreIcon(U),_THIS_IS_MUSIC_BLOCKS_&&E.toolbar.renderChooseKeyIcon(C),E.toolbar.renderJavaScriptIcon(F),E.toolbar.renderLanguageSelectIcon(E.languageBox),E.toolbar.renderWrapIcon(),initPalettes(E.palettes),void 0!==E.planet?E.saveLocally=E.planet.saveLocally.bind(E.planet):E.saveLocally=E.__saveLocally,window.saveLocally=E.saveLocally,initBasicProtoBlocks(E),E.macroData=E.storage.macros,null!==E.macroData&&processMacroData(E.macroData,E.palettes,E.blocks,E.macroDict),E.pluginData=E.storage.plugins,null!==E.pluginData&&"null"!==E.pluginData&&updatePluginObj(E,processPluginData(E,E.pluginData,"localStorage:plugins")),void 0!==(a=E.storage.custommode)&&JSON.parse(a),E.fileChooser.addEventListener("click",function(){i.value=null}),E.fileChooser.addEventListener("change",function(){var e,o=new FileReader,t=new FileReader,a=(o.onload=function(){i.loading=!0,document.body.style.cursor="wait",i.doLoadAnimation(),setTimeout(function(){if(null===(t=o.result)||""===t)i.errorMsg(_("Cannot load project from the file. Please check the file type."));else{var e,t=t.replace("\n"," ");try{for(var a in e=t.includes("html")?t.includes('id="codeBlock"')?JSON.parse(t.match('<div class="code" id="codeBlock">(.+?)</div>')[1]):JSON.parse(t.match('<div class="code">(.+?)</div>')[1]):JSON.parse(t),i.palettes.dict)i.palettes.dict[a].hideMenu(!0);i.stage.removeAllEventListeners("trashsignal"),i.merging?(i.merging=!1,i.blocks.loadNewBlocks(e)):(i.stage.addEventListener("trashsignal",function(){i.blocks.loadNewBlocks(e),i.stage.removeAllEventListeners("trashsignal"),i.planet&&i.planet.saveLocally()},!1),i.sendAllToTrash(!1,!1),i._allClear(!1,!0),i.planet&&(i.planet.closePlanet(),i.planet.initialiseNewProject(i.fileChooser.files[0].name.substr(0,i.fileChooser.files[0].name.lastIndexOf("."))))),i.loading=!1,i.refreshCanvas()}catch(e){i.errorMsg(_("Cannot load project from the file. Please check the file type.")),console.error(e),document.body.style.cursor="default",i.loading=!1}}},200)},t.onload=function(e){e=new Midi(e.target.result),console.debug(e),h(e)},i.fileChooser.files[0]);a&&("mid"===(e=a.name.split(".").pop().toLowerCase())||"midi"===e?t.readAsArrayBuffer(a):o.readAsText(a))},!1),a=function(e){e.stopPropagation(),e.preventDefault();var t,n=e.dataTransfer.files,l=new FileReader,e=new FileReader,a=new FileReader;l.onload=function(){i.loading=!0,document.body.style.cursor="wait",setTimeout(function(){if(null===(t=l.result)||""===t)i.errorMsg(_("Cannot load project from the file. Please check the file type."));else{var e,t=t.replace("\n"," ");try{for(var a in e=t.includes("html")?JSON.parse(t.match('<div class="code">(.+?)</div>')[1]):JSON.parse(t),i.blocks.palettes.dict)i.palettes.dict[a].hideMenu(!0);i.stage.removeAllEventListeners("trashsignal");var o=function(){document.removeEventListener("finishedLoading",o)};i.stage.addEventListener("trashsignal",function(){i.blocks.loadNewBlocks(e),i.stage.removeAllEventListeners("trashsignal"),document.addEventListener?document.addEventListener("finishedLoading",o):document.attachEvent("finishedLoading",o)},!1),i.sendAllToTrash(!1,!1),void 0!==i.planet&&i.planet.initialiseNewProject(n[0].name.substr(0,n[0].name.lastIndexOf("."))),i.loading=!1,i.refreshCanvas()}catch(e){console.error(e),i.errorMsg(_("Cannot load project from the file. Please check the file type.")),document.body.style.cursor="default",i.loading=!1}}},200)},e.onload=function(e){e=new Midi(e.target.result),console.debug(e),h(e)},a.onload=function(e){e=(e=e.target.result).replace(/\\/g,""),e=new ABCJS.parseOnly(e),console.log(e),e.forEach(function(e){E.parseABC(e)})},a.onload=function(e){e=(e=e.target.result).replace(/\\/g,""),e=new ABCJS.parseOnly(e),console.log(e),e.forEach(function(e){E.parseABC(e)})},void 0!==n[0]&&("mid"==(t=n[0].name.split(".").pop().toLowerCase())||"midi"==t?e.readAsArrayBuffer(n[0]):"abc"==t?a.readAsText(n[0]):(l.readAsText(n[0]),l.readAsText(n[0]),window.scroll(0,0)))},n=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},(p=document.getElementById("canvasHolder")).addEventListener("dragover",n,!1),p.addEventListener("drop",a,!1),E.allFilesChooser.addEventListener("click",function(){E.value=null}),E.pluginChooser.addEventListener("click",function(){window.scroll(0,0),E.value=null}),E.pluginChooser.addEventListener("change",function(){window.scroll(0,0);var t=new FileReader,a=i.pluginChooser.files[0];t.onload=function(){i.loading=!0,document.body.style.cursor="wait",setTimeout(function(){var e=processRawPluginData(i,t.result,a&&a.name?a.name:"local-file");null!==e&&(i.storage.plugins=preparePluginExports(i,e)),setTimeout(function(){i.palettes.visible&&i.palettes.hide()},1e3),document.body.style.cursor="default",i.loading=!1},200)},t.readAsText(a)},!1),createjs.Touch.enable(E.stage,!1,!0),E.stage.mouseMoveOutside=!0,E.stage.enableMouseOver(10),E.cartesianBitmap=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(CARTESIAN))),E.polarBitmap=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(POLAR))),E.trebleBitmap=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE))),E.grandBitmap=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(GRAND))),E.sopranoBitmap=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(SOPRANO))),E.altoBitmap=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(ALTO))),E.tenorBitmap=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TENOR))),E.bassBitmap=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(BASS))),o=0;o<7;o++)E.grandSharpBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(GRAND_G))),E.grandFlatBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(GRAND_F))),E.trebleSharpBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),E.trebleFlatBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F))),E.sopranoSharpBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),E.sopranoFlatBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F))),E.altoSharpBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),E.altoFlatBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F))),E.tenorSharpBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),E.tenorFlatBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F))),E.bassSharpBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),E.bassFlatBitmap[o]=E._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F)));if(n=window.location.href,l={run:!1,show:!1,collapse:!1},E._onResize(!0),r=[],!(0<n.indexOf("?"))){e.n=17;break}if(!(0<(s=n.split("?"))[1].indexOf("&"))){e.n=16;break}u=s[1].split("&"),d=0;case 5:d<u.length?0<u[d].indexOf("=")?(c=u[d].split("="),p=c[0].toLowerCase(),e.n="file"===p?6:"id"===p?7:"run"===p?8:"show"===p?9:"collapse"===p?10:"inurl"===p?11:"outurl"===p?12:13):e.n=14:e.n=15;break;case 6:return e.a(3,14);case 7:return E.projectID=c[1],e.a(3,14);case 8:return"true"===c[1].toLowerCase()&&(l.run=!0),e.a(3,14);case 9:return"true"===c[1].toLowerCase()&&(l.show=!0),e.a(3,14);case 10:return"true"===c[1].toLowerCase()&&(l.collapse=!0),e.a(3,14);case 11:return(e=>new Promise(function(t,a){var o=new XMLHttpRequest;o.open("get",e,!0),o.responseType="json",o.onload=function(){var e=o.status;200===e?t(o.response):a(e)},o.send()}))(c[1]).then(function(e){e=e.arg,r.push(parseInt(e))},function(){alert("Something went wrong reading JSON-encoded project data.")}),e.a(3,14);case 12:return c[1],e.a(3,14);case 13:return E.errorMsg(_("Invalid parameters")),e.a(3,14);case 14:d++,e.n=5;break;case 15:e.n=17;break;case 16:"id"===(c=0<s[1].indexOf("=")?s[1].split("="):c)[0].toLowerCase()&&(E.projectID=c[1]);case 17:null!==E.projectID?setTimeout(function(){i.loadStartWrapper(P,i.projectID,l,r)},200):setTimeout(function(){i.loadStartWrapper(j)},200),E.prepSearchWidget(),E._create2Ddrag(),g=E,document.onkeydown=function(){g.__keyPressed(event)},void 0!==E.planet&&E.planet.planet.setAnalyzeProject(doAnalyzeProject);case 18:return e.a(2)}},e,null,[[1,3]])}))},[{key:"addEventListener",value:function(e,t,a,o){e&&"function"==typeof e.addEventListener&&(e.addEventListener(t,a,o),this._listeners.push({target:e,type:t,listener:a,options:o}))}},{key:"removeEventListener",value:function(t,a,o,n){var l=this;t&&"function"==typeof t.removeEventListener&&(t.removeEventListener(a,o,n),this._listeners=this._listeners.filter(function(e){return e.target!==t||e.type!==a||e.listener!==o||!l._areOptionsEqual(e.options,n)}))}},{key:"_areOptionsEqual",value:function(e,t){function a(e){return"boolean"==typeof e?e:"object"===_typeof(e)&&null!==e&&!!e.capture}return a(e)===a(t)}},{key:"cleanupEventListeners",value:function(){for(;0<this._listeners.length;){var e=this._listeners.pop(),t=e.target;t&&"function"==typeof t.removeEventListener&&t.removeEventListener(e.type,e.listener,e.options)}}},{key:"saveLocally",value:function(){try{localStorage.setItem("beginnerMode",this.beginnerMode.toString()),localStorage.setItem("themePreference",this.themePreference.toString())}catch(e){console.error("Error saving to localStorage:",e)}}},{key:"regeneratePalettes",value:function(){try{var e={};if(this.palettes&&this.palettes.dict)for(var t in this.palettes.dict){var a=this.palettes.dict[t];a&&a.container&&void 0!==a.container.x&&(e[t]={x:a.container.x,y:a.container.y,visible:!!a.visible})}if(this.palettes){if("function"!=typeof this.palettes.hide?console.warn("Palettes hide method not available"):this.palettes.hide(),"function"!=typeof this.palettes.clear?(console.warn("Palettes clear method not available"),this.palettes.dict={},this.palettes.visible=!1,this.palettes.activePalette=null,this.palettes.paletteObject=null):this.palettes.clear(),initPalettes(this.palettes),this.blocks&&initBasicProtoBlocks(this),this.palettes&&this.palettes.dict)for(var o in e){var n=this.palettes.dict[o],l=e[o];n&&n.container&&l&&(n.container.x=l.x,n.container.y=l.y,l.visible)&&n.showMenu(!0)}this.palettes&&"function"==typeof this.palettes.updatePalettes&&this.palettes.updatePalettes(),this.blocks&&"function"==typeof this.blocks.updateBlockPositions&&this.blocks.updateBlockPositions(),this.refreshCanvas()}else console.warn("Palettes object not initialized")}catch(e){console.error("Error regenerating palettes:",e),this.errorMsg(_("Error regenerating palettes. Please refresh the page."))}}}]))(),activity=new Activity;require(["domReady!"],function(e){doBrowserCheck(),jQuery.browser.mozilla?setTimeout(function(){activity.setupDependencies(),activity.domReady(e)},5e3):(activity.setupDependencies(),activity.domReady(e))}),define(MYDEFINES,function(){activity.setupDependencies(),activity.doContextMenus(),activity.doPluginsAndPaletteCols()});
var COLLAPSEBUTTONXOFF=-48,COLLAPSEBUTTONYOFF=9,STANDARDBLOCKHEIGHT=42,DEFAULTBLOCKSCALE=1.5,FILLCOLORS=["#ed001d","#a34600","#fb5f00","#6cc600","#00843c","#008283","#007ac9","#005dff","#b500e3","#ec008a"],STROKECOLORS=["#ffada6","#ffa300","#ffc000","#037700","#00fa8c","#00f3db","#00e3ff","#8dceff","#f3aeff","#ff97d5"],TURTLESVG=_THIS_IS_TURTLE_BLOCKS_?'<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" enable-background="new" width="55" height="55" viewBox="0 0 55.000001 55.000001" id="svg2" version="1.1"><g><path d="M 27.497 48.279 C 26.944 48.279 26.398 48.244 25.86 48.179 L 27.248 50.528 L 28.616 48.215 C 28.245 48.245 27.875 48.279 27.497 48.279 Z " fill="fill_color" stroke="stroke_color" stroke-width="3.5"/><g><path d="M 40.16 11.726 C 37.996 11.726 36.202 13.281 35.817 15.333 C 37.676 16.678 39.274 18.448 40.492 20.541 C 42.777 20.369 44.586 18.48 44.586 16.151 C 44.586 13.707 42.604 11.726 40.16 11.726 Z " fill="fill_color" stroke="stroke_color" stroke-width="3.5"/><path d="M 40.713 39.887 C 39.489 42.119 37.853 44.018 35.916 45.443 C 36.437 47.307 38.129 48.682 40.16 48.682 C 42.603 48.682 44.586 46.702 44.586 44.258 C 44.586 42.003 42.893 40.162 40.713 39.887 Z " fill="fill_color" stroke="stroke_color" stroke-width="3.5"/><path d="M 14.273 39.871 C 12.02 40.077 10.249 41.95 10.249 44.258 C 10.249 46.701 12.229 48.682 14.673 48.682 C 16.737 48.682 18.457 47.262 18.945 45.35 C 17.062 43.934 15.47 42.061 14.273 39.871 Z " fill="fill_color" stroke="stroke_color" stroke-width="3.5"/><path d="M 19.026 15.437 C 18.683 13.334 16.872 11.726 14.673 11.726 C 12.229 11.726 10.249 13.707 10.249 16.15 C 10.249 18.532 12.135 20.46 14.494 20.556 C 15.68 18.513 17.226 16.772 19.026 15.437 Z " fill="fill_color" stroke="stroke_color" stroke-width="3.5"/></g><path d="M 27.497 12.563 C 29.405 12.563 31.225 12.974 32.915 13.691 C 33.656 12.615 34.093 11.314 34.093 9.908 C 34.093 6.221 31.104 3.231 27.416 3.231 C 23.729 3.231 20.74 6.221 20.74 9.908 C 20.74 11.336 21.192 12.657 21.956 13.742 C 23.68 12.993 25.543 12.563 27.497 12.563 Z " fill="fill_color" stroke="stroke_color" stroke-width="3.5"/><g><path d="M 43.102 30.421 C 43.102 35.1554 41.4568 39.7008 38.5314 43.0485 C 35.606 46.3963 31.6341 48.279 27.497 48.279 C 23.3599 48.279 19.388 46.3963 16.4626 43.0485 C 13.5372 39.7008 11.892 35.1554 11.892 30.421 C 11.892 20.6244 18.9364 12.563 27.497 12.563 C 36.0576 12.563 43.102 20.6244 43.102 30.421 Z " fill="fill_color" stroke="stroke_color" stroke-width="3.5"/></g><g><path d="M 27.501 41.551 C 23.533 41.391 21.958 39.542 21.958 39.542 L 25.528 35.379 L 29.993 35.547 L 33.125 39.667 C 33.125 39.667 30.235 41.661 27.501 41.551 Z " fill="stroke_color" stroke="none" /><path d="M 18.453 33.843 C 17.604 30.875 18.625 26.959 18.625 26.959 L 22.625 29.126 L 24.118 33.755 L 20.536 37.988 C 20.536 37.987 19.071 35.998 18.453 33.843 Z " fill="stroke_color" stroke="none" /><path d="M 19.458 25.125 C 19.458 25.125 19.958 23.167 22.497 21.303 C 24.734 19.66 26.962 19.583 26.962 19.583 L 26.925 24.564 L 23.404 27.314 L 19.458 25.125 Z " fill="stroke_color" stroke="none" /><path d="M 32.084 27.834 L 28.625 24.959 L 29 19.75 C 29 19.75 30.834 19.708 32.959 21.417 C 35.187 23.208 36.321 26.4 36.321 26.4 L 32.084 27.834 Z " fill="stroke_color" stroke="none" /><path d="M 31.292 34.042 L 32.605 29.578 L 36.792 28.042 C 36.792 28.042 37.469 30.705 36.75 33.709 C 36.21 35.965 34.666 38.07 34.666 38.07 L 31.292 34.042 Z " fill="stroke_color" stroke="none" /></g></g></svg>':'<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="55" viewBox="0 0 54.999998 54.999998" version="1.1" id="svg40" height="55"><g transform="translate(-3.1884835,0.12548216)" style="fill:stroke_color;stroke:fill_color;stroke-width:1.99999976;stroke-miterlimit:4;stroke-dasharray:none" id="g3586"><path style="fill:stroke_color;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" id="path4725" d="m 31.188483,5.8745178 c 0,0 -1.254644,-1 -2,-1 -1.490712,0 -2.945907,0.9459074 -4,2 -1.581139,1.5811389 -1.692548,4.1860072 -3,6.0000002 -0.826905,1.14727 -1.85273,2.173095 -3,3 -1.813992,1.307452 -4.41886,1.418861 -5.999999,3 -1.054093,1.054093 -2,2.509288 -2,4 0,1.490712 1.176934,3.540162 2,4 2.595129,1.449868 0.836609,0.648512 2,2 0,0 -1.040434,3.300808 -1,5 0.06539,2.747959 1.999999,7 1.999999,8 0,1 3.621931,4.46873 6,6 2.394526,1.541867 5.323775,2.059095 8.164792,2.258437 3.065644,0.215103 5.976447,-0.356365 8.670416,-1.835208 1.652944,-0.907377 3.020234,-1.924716 4.164792,-3.423229 1.631246,-2.13571 3.310226,-4.40261 4,-7 0.42778,-1.610833 0.203639,-3.345821 0,-5 -0.167925,-1.364071 -1.27205,-2.652826 -1,-4 0.329909,-1.633688 2.319717,-2.47849 3,-4 0.693755,-1.551642 1.687609,-3.445625 1,-5 -0.786311,-1.777496 -3.357594,-1.960634 -5,-3 -1.015577,-0.642689 -2.106041,-1.196706 -3,-2 -1.93647,-1.740075 -3.442391,-3.913943 -5,-6.0000002 -0.71906,-0.9630146 -1.044881,-2.2704844 -2,-3 -0.837694,-0.6398275 -1.974105,-1.2421808 -3,-1 -0.458794,0.1083066 -1,1 -1,1" /><path d="m 46.209786,28.156906 c 0,0 1.463947,5.738921 1.001084,8.583832 -0.503422,3.094194 -1.733796,6.320068 -4.004337,8.583833 -2.061998,2.055845 -3.20724,2.828474 -6.006505,3.815036 -1.290398,0.454783 -4.973515,0.953759 -6.514048,0.953759 -1.540535,0 -5.223651,-0.498977 -6.514049,-0.95376 -2.799265,-0.986562 -3.944507,-1.759191 -6.006506,-3.815036 -2.270541,-2.263765 -3.500915,-5.489639 -4.004337,-8.583833 -0.462863,-2.844911 1.001084,-8.583832 1.001084,-8.583832 M 28.176267,22.43435 c 0,0 -4.122174,4.705629 -7.007589,5.722555 -1.877805,0.661806 -4.201946,0.826315 -6.006506,0 -1.925806,-0.881834 -3.58357,-2.772978 -4.004337,-4.768796 -0.478397,-2.26917 0.558956,-4.123549 2.470477,-5.529022 2.067374,-1.520067 4.598363,-1.662883 6.539282,-3.054811 2.515152,-1.803739 2.912345,-5.389772 5.005421,-7.6300732 1.420632,-1.520559 5.512965,-3.8150366 5.512965,-3.8150366 0,0 4.092331,2.2944775 5.512964,3.8150365 2.093073,2.2403013 2.490269,5.8263353 5.005421,7.6300743 1.940919,1.391928 4.538808,1.465531 6.606183,2.927334 1.937249,1.369793 2.881973,3.387329 2.403575,5.656499 -0.420767,1.995818 -2.078532,3.886962 -4.004337,4.768796 -1.80456,0.826315 -4.1287,0.661806 -6.006505,0 -2.885416,-1.016926 -7.00759,-5.722555 -7.00759,-5.722555" id="path4505-6" style="fill:none;stroke:fill_color;stroke-width:1.95427048;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /><g id="g4565" transform="matrix(1.0010843,0,0,0.95375917,57.401951,5.3863652)" style="fill:none;stroke:fill_color;stroke-opacity:1"><g id="g4553" transform="translate(0,-1)" style="fill:none;stroke:fill_color;stroke-opacity:1"><path d="M -30.228157,8.514322 C -33.422908,9.40349 -38.624018,5.874516 -40.102591,4.585664" id="path3411-7" style="fill:none;fill-rule:evenodd;stroke:fill_color;stroke-width:1.93205309;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /><path d="M -29.760199,5.904536 C -33.101366,5.473905 -35.931474,3.7361852 -37.633646,2.3416285" id="path3413-5" style="fill:none;fill-rule:evenodd;stroke:fill_color;stroke-width:1.93205309;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /></g><g id="g4557" style="fill:none;stroke:fill_color;stroke-opacity:1"><path d="m -23.145912,7.514322 c 3.194751,0.889168 8.395861,-2.639806 9.874434,-3.928658" id="path3411-3" style="fill:none;fill-rule:evenodd;stroke:fill_color;stroke-width:1.93205309;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /><path d="m -23.61387,4.904536 c 3.341167,-0.430631 6.171275,-2.168351 7.873447,-3.5629075" id="path3413-56" style="fill:none;fill-rule:evenodd;stroke:fill_color;stroke-width:1.93205309;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /></g></g><g id="g4636" transform="matrix(1.0010843,0,0,0.95375917,57.930597,3.4788469)" style="fill:#ffffff;stroke:fill_color;stroke-opacity:1;fill-opacity:0.94117647"><ellipse cx="-30.836912" cy="14.612609" id="circle3409-2" rx="1.8846371" ry="2.0666313" style="fill:#ffffff;fill-rule:evenodd;stroke:fill_color;stroke-width:1.99999976;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;fill-opacity:0.94117647" /><ellipse cx="-23.593306" cy="14.699166" id="ellipse4229-9" rx="1.8846371" ry="2.0666313" style="fill:#ffffff;fill-rule:evenodd;stroke:fill_color;stroke-width:1.99999976;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;fill-opacity:0.94117647" /></g><g id="g4632" transform="matrix(1.0010843,0,0,0.95375917,58.02711,3.4788469)" style="fill:none;stroke:fill_color;stroke-opacity:1"><path d="m -37.186516,14.624518 c -14.340024,2.75008 -4.810404,15.671871 4.375,5.25" id="path4303-1" style="fill:none;fill-rule:evenodd;stroke:fill_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /><path d="m -17.436517,14.624518 c 14.3400245,2.75008 4.810404,15.671872 -4.375,5.25" id="path4303-1-2" style="fill:none;fill-rule:evenodd;stroke:fill_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /></g><path d="m 33.12784,3.3591671 c -1.384692,1.3140551 -1.985761,2.3793068 -2.459835,2.3793068 -0.662709,0 -1.27278,-1.0652517 -2.459836,-2.3793068 -0.97292,-1.0770097 1.101306,-2.37930771 2.459836,-2.37930771 1.358531,0 3.532987,1.36090081 2.459835,2.37930771 z" id="path4227-7" style="fill:fill_color;fill-rule:evenodd;stroke:fill_color;stroke-width:2.16383076;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;fill-opacity:1" /><path style="fill:none;stroke:fill_color;stroke-width:1.95427048;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" id="path4653" d="m 31.302308,50.085622 c 0,0 0.723125,3.123831 5.500191,3.669996 4.777067,0.546166 11.784656,-3.778776 14.78791,-9.501331 3.003254,-5.722555 2.402683,-11.490783 3.003253,-18.121425" /></g></svg>',DRUMSVG='<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.1" width="55" height="55" viewBox="0 0 55 55" id="svg2" xml:space="preserve"><path d="m 9.653,18.199 h 35.54 c 0.772,0 1.4,0.628 1.4,1.403 v 2.362 c 0,0.771 -0.628,1.401 -1.4,1.401 H 9.653 c -0.775,0 -1.403,-0.628 -1.403,-1.401 v -2.361 c 0,-0.777 0.627,-1.404 1.403,-1.404 z" id="path8" style="fill:stroke_color;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><rect width="33.139" height="22.128" x="10.852" y="23.365" id="rect10" style="fill:stroke_color;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><path d="m 9.653,45.493 h 35.54 c 0.772,0 1.4,0.627 1.4,1.401 v 2.362 c 0,0.775 -0.628,1.405 -1.4,1.405 H 9.653 c -0.775,0 -1.403,-0.629 -1.403,-1.405 v -2.362 c 0,-0.77 0.627,-1.401 1.403,-1.401 z" id="path17" style="fill:stroke_color;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><path d="M 10.851,45.491 19.395,23.365 27.291,45.49 35.217,23.364" id="path19" style="fill:none;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><path d="M 43.987,45.491 35.217,23.365" id="path21" style="fill:none;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><line style="fill:none;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" y2="5.948" y1="13.149" x2="48.335999" x1="33.689999" id="line27" display="inline" /><line style="fill:none;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" y2="9.4799995" y1="2.2130001" x2="20.658001" x1="6.0419998" id="line29" display="inline" /><path d="m 25.721,9.802 c 0.55,1.451 -0.171,3.066 -1.608,3.612 -1.437,0.545 -3.049,-0.188 -3.599,-1.639 -0.547,-1.45 0.174,-3.067 1.609,-3.613 1.438,-0.542 3.049,0.19 3.598,1.64 z" id="path23" style="fill:stroke_color;stroke:stroke_color;stroke-width:2.25;stroke-linecap:round;stroke-linejoin:round;display:inline" /><path d="m 33.338,16.442 c -1.04,1.125 -2.798,1.189 -3.928,0.144 -1.128,-1.044 -1.197,-2.801 -0.155,-3.927 1.041,-1.125 2.8,-1.19 3.926,-0.146 1.129,1.045 1.2,2.803 0.157,3.929 z" id="path25" style="fill:stroke_color;stroke:stroke_color;stroke-width:2.25;stroke-linecap:round;stroke-linejoin:round;display:inline" /></svg>',EFFECTSVG='<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.1" width="55" height="55" viewBox="0 0 55 55" id="svg2" xml:space="preserve"><path d="m 9.653,18.199 h 35.54 c 0.772,0 1.4,0.628 1.4,1.403 v 2.362 c 0,0.771 -0.628,1.401 -1.4,1.401 H 9.653 c -0.775,0 -1.403,-0.628 -1.403,-1.401 v -2.361 c 0,-0.777 0.627,-1.404 1.403,-1.404 z" id="path8" style="fill:stroke_color;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><rect width="33.139" height="22.128" x="10.852" y="23.365" id="rect10" style="fill:stroke_color;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><path d="m 9.653,45.493 h 35.54 c 0.772,0 1.4,0.627 1.4,1.401 v 2.362 c 0,0.775 -0.628,1.405 -1.4,1.405 H 9.653 c -0.775,0 -1.403,-0.629 -1.403,-1.405 v -2.362 c 0,-0.77 0.627,-1.401 1.403,-1.401 z" id="path17" style="fill:stroke_color;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><path d="M 10.851,45.491 19.395,23.365 27.291,45.49 35.217,23.364" id="path19" style="fill:none;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><path d="M 43.987,45.491 35.217,23.365" id="path21" style="fill:none;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" /><line style="fill:none;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" y2="5.948" y1="13.149" x2="48.335999" x1="33.689999" id="line27" display="inline" /><line style="fill:none;stroke:stroke_color;stroke-width:3.5;stroke-linecap:round;stroke-linejoin:round;display:inline" y2="9.4799995" y1="2.2130001" x2="20.658001" x1="6.0419998" id="line29" display="inline" /><path d="m 25.721,9.802 c 0.55,1.451 -0.171,3.066 -1.608,3.612 -1.437,0.545 -3.049,-0.188 -3.599,-1.639 -0.547,-1.45 0.174,-3.067 1.609,-3.613 1.438,-0.542 3.049,0.19 3.598,1.64 z" id="path23" style="fill:stroke_color;stroke:stroke_color;stroke-width:2.25;stroke-linecap:round;stroke-linejoin:round;display:inline" /><path d="m 33.338,16.442 c -1.04,1.125 -2.798,1.189 -3.928,0.144 -1.128,-1.044 -1.197,-2.801 -0.155,-3.927 1.041,-1.125 2.8,-1.19 3.926,-0.146 1.129,1.045 1.2,2.803 0.157,3.929 z" id="path25" style="fill:stroke_color;stroke:stroke_color;stroke-width:2.25;stroke-linecap:round;stroke-linejoin:round;display:inline" /></svg>',TEXTX=26,TEXTY=26,VALUETEXTX=70,COLLAPSETEXTX=10,COLLAPSETEXTY=40,MEDIASAFEAREA=[40,4,108,80],HIGHLIGHTCOLOR="#FFFFFF",ACTIVECOLOR="#212121",showMaterialHighlight=function(t,e,i,o,n,s){var a={highlight:new createjs.Shape,active:new createjs.Shape};return a.highlight.graphics.f(HIGHLIGHTCOLOR).drawCircle(-6,-6,i),a.highlight.alpha=.3,a.highlight.x=t,a.highlight.y=e,a.active.graphics.f(ACTIVECOLOR).drawCircle(-6,-6,i),a.active.alpha=0,s.addChild(a.highlight,a.active),createjs.Tween.get(a.active).to({scaleX:.3,scaleY:.3,x:o.rawX/n,y:o.rawY/n}).to({scaleX:1,scaleY:1,x:t,y:e},200,createjs.Ease.circInOut),createjs.Tween.get(a.active).to({alpha:.05}).to({alpha:.3},150),a},hideButtonHighlight=function(t,e){void 0!==t.active&&(createjs.Tween.get(t.active).to({alpha:0},200),createjs.Tween.get(t.highlight).to({alpha:0},400),setTimeout(function(){e.removeChild(t.active,t.highlight)},410))},hidePaletteNameDisplay=function(t,e){setTimeout(function(){e.removeChild(t)},150)},MENUWIDTH=200,PALETTEFILLER='<svg xmlns="http://www.w3.org/2000/svg" width="200" height="filler_height"><rect width="200" height="filler_height" x="0" y="0" style="fill:#b3b3b3;fill-opacity:1;stroke:none" /></svg>',PALETTEHEADER='<svg xmlns="http://www.w3.org/2000/svg" width="header_width" height="42"><rect width="header_width" height="42" x="0" y="0" style="fill:fill_color;fill-opacity:1;stroke:none" /><text style="font-size:16px;font-style:normal;font-weight:normal;text-align:end;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:end;fill-opacity:1;stroke:none;font-family:Sans"><tspan  x="40" y="28" style="font-size:16px;text-align:start;text-anchor:start;fill:#ffffff">palette_label</tspan></text></svg>',PALETTEBUTTON='<svg xmlns="http://www.w3.org/2000/svg" width="55" height="55"><circle cx="27.5" cy="27.5" r="27.5" x="0" y="0" style="fill:fill_color;fill-opacity:1;stroke:none" /></svg>',BACKGROUND='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="650" height="590"><rect width="650" height="590" x="0" y="0" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" /><g transform="translate(595,0)" style="fill:#000000;display:block"><path d="m 27.557,5.053 c -12.43,0 -22.5,10.076 -22.5,22.497 0,12.432 10.07,22.503 22.5,22.503 12.431,0 22.5,-10.071 22.5,-22.503 0,-12.421 -10.07,-22.497 -22.5,-22.497 z m 10.199,28.159 c 1.254,1.256 1.257,3.291 0,4.545 -0.628,0.629 -1.451,0.943 -2.274,0.943 -0.822,0 -1.644,-0.314 -2.27,-0.94 l -5.76,-5.761 -5.76,5.761 c -0.627,0.626 -1.449,0.94 -2.271,0.94 -0.823,0 -1.647,-0.314 -2.275,-0.943 -1.254,-1.254 -1.254,-3.289 0.004,-4.545 l 5.758,-5.758 -5.758,-5.758 c -1.258,-1.254 -1.258,-3.292 -0.004,-4.546 1.255,-1.254 3.292,-1.259 4.546,0 l 5.76,5.759 5.76,-5.759 c 1.252,-1.259 3.288,-1.254 4.544,0 1.257,1.254 1.254,3.292 0,4.546 l -5.758,5.758 5.758,5.758 z" style="fill:#000000;display:inline" /></g></svg>',cameraPALETTE='<svg width="106" height="66" version="1.1" xmlns="http://www.w3.org/2000/svg"> <g transform="scale(1.5)"> <path d="m8.5 0.5h60v43h-60v-31-1h-6v3h-2v-8h2v3h6v-1z" fill="#FF664B" stroke="#EA4326" stroke-linecap="round"/> <text fill="#282828" font-family="sans-serif" font-size="10px"><tspan x="13" y="25"/></text> </g> <g transform="matrix(.99738 0 0 1.0122 24.08 8.5328)" display="block"> <g display="inline"> <polygon points="6.29 14.52 6.29 38.973 48.209 38.973 48.209 14.52 38.532 14.52 34.904 9.862 18.783 9.862 15.155 14.52" fill="#fff"/><polygon points="6.29 14.52 6.29 38.973 48.209 38.973 48.209 14.52 38.532 14.52 34.904 9.862 18.783 9.862 15.155 14.52" fill="none" stroke="#010101" stroke-width="3.5"/> </g> <path d="m20.601 26.441c0 3.67 2.979 6.648 6.65 6.648 3.667 0 6.646-2.979 6.646-6.648 0-3.668-2.979-6.652-6.646-6.652-3.67 0-6.65 2.986-6.65 6.652z" display="inline" fill="#fff" stroke="#010101" stroke-width="3.5"/> <rect x="38.099" y="18.418" width="6.287" height="4.193" fill="#010101"/> </g> </svg>',mediaPALETTE='<svg width="106" height="66" version="1.1" xmlns="http://www.w3.org/2000/svg"> <g transform="scale(1.5)"> <path d="m8.5 0.5h60v43h-60v-31-1h-6v3h-2v-8h2v3h6v-1z" fill="#FF664B" stroke="#EA4326" stroke-linecap="round"/> <text fill="#282828" font-family="sans-serif" font-size="10px"><tspan x="13" y="25"/></text> </g> <g transform="matrix(1.2126 0 0 1.1428 -162.31 -786.51)"> <g transform="matrix(.55206 0 0 .55206 204.78 703.45)" fill="none" stroke="#fff"> <g transform="translate(-80.094 12.22)"> <g fill="none" stroke="#fff"> <path d="m6.736 49.002h24.52c2.225 0 3.439-1.447 3.439-3.441v-27.28c0-1.73-1.732-3.441-3.439-3.441h-4.389" fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="3.5"/> </g> </g> <g transform="translate(-80.094 12.22)"> <g fill="none" stroke="#fff"> <path d="m26.867 38.592c0 1.836-1.345 3.201-3.441 4.047l-16.69 6.363v-34.162l16.69-8.599c2.228-0.394 3.441 0.84 3.441 2.834z" fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="3.5"/> </g> </g> <g stroke-linecap="round" stroke-linejoin="round" stroke-width="2.25"> <path d="m-70.67 54.827s-1.351-0.543-2.702-0.543-2.703 0.543-2.703 0.543"/> <path d="m-70.67 44.226s-1.239-0.543-2.815-0.543c-1.577 0-2.59 0.543-2.59 0.543"/> <path d="m-70.67 33.898s-1.125-0.544-2.927-0.544-2.478 0.544-2.478 0.544"/> <line x1="-66.885" x2="-66.885" y1="58.753" y2="23.725"/> </g> </g> <g transform="translate(.12541)"> <g transform="matrix(1 0 0 -1 90.782 733.43)"></g> <g transform="matrix(0 -1 -1 0 211.61 774.1)"> <g transform="translate(34.08 -1006.4)" fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round"> <polyline transform="matrix(-.46924 .46924 -.46924 -.46924 66.291 1019)" points="51.562 15.306 41.17 16.188 42.053 5.794" stroke-width="3.5"/> <path d="m39.363 1033.1-0.05636 9.9115-8.7506 0.067" stroke-width="2.5"/> </g> </g> </g> </g> </svg>',videoPALETTE='<svg width="106" height="66" version="1.1" xmlns="http://www.w3.org/2000/svg"> <g transform="scale(1.5)"> <path d="m8.5 0.5h60v43h-60v-31-1h-6v3h-2v-8h2v3h6v-1z" fill="#FF664B" stroke="#EA4326" stroke-linecap="round"/> <text fill="#282828" font-family="sans-serif" font-size="10px"><tspan x="13" y="25"/></text> </g> <g transform="matrix(1.9081 0 0 1.7957 -5.3053 -15.788)"> <g transform="matrix(.5 0 0 .5 13.688 13.75)" stroke-width="3.5"> <g stroke="#010101" stroke-width="3.5"> <polygon points="48.788 23.002 36.849 11.058 5.962 11.058 5.962 43.944 48.788 43.944" fill="#fff"/> <polyline points="36.849 11.058 36.849 23.002 48.788 23.002" fill="none"/> </g> </g> <g fill="#010101"> <path d="m27.44 26.172c-2.3785 0-4.36 2.372-4.36 2.372s1.9815 2.3835 4.36 2.382c2.3785-2e-3 4.361-2.385 4.361-2.385s-1.982-2.3705-4.361-2.369zm0 4.045c-0.921 0-1.6675-0.747-1.6675-1.668 0-0.9195 0.7465-1.668 1.6675-1.668 0.9195 0 1.6665 0.7485 1.6665 1.668 5e-4 0.921-0.7465 1.668-1.6665 1.668z"/> <circle transform="matrix(.5 0 0 .5 13.688 13.75)" cx="27.505" cy="29.597" r="1.514"/> <circle transform="matrix(.5 0 0 .5 13.688 13.75)" cx="14.875" cy="29.597" r="1.514"/> <circle transform="matrix(.5 0 0 .5 13.688 13.75)" cx="10.375" cy="29.597" r="1.514"/> <circle transform="matrix(.5 0 0 .5 13.688 13.75)" cx="43.875" cy="29.597" r="1.514"/> <circle transform="matrix(.5 0 0 .5 13.688 13.75)" cx="39.375" cy="29.597" r="1.514"/> </g> </g> </svg>',NEXTBUTTON='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="55" height="55"><path d="M27.5,50C39.927,50,50,39.927,50,27.5C50,15.072,39.927,5,27.5,5S5,15.072,5,27.5 C5,39.927,15.073,50,27.5,50z M17.093,22.725c0.626-0.624,1.447-0.939,2.271-0.939c0.822,0,1.645,0.315,2.271,0.939l5.84,5.833 l5.657-5.802c0.63-0.645,1.464-0.967,2.3-0.967c0.808,0,1.62,0.305,2.246,0.914c1.266,1.238,1.295,3.271,0.056,4.546l-7.929,8.126 c-0.002,0-0.002,0-0.003,0c-0.01,0.011-0.015,0.021-0.022,0.028c-0.116,0.115-0.245,0.208-0.371,0.302 c-0.039,0.028-0.071,0.064-0.111,0.093c-0.114,0.075-0.24,0.133-0.36,0.194c-0.068,0.035-0.131,0.078-0.2,0.107 c-0.1,0.039-0.203,0.064-0.306,0.093c-0.099,0.032-0.191,0.068-0.292,0.09c-0.083,0.018-0.169,0.018-0.251,0.028 c-0.122,0.015-0.244,0.033-0.366,0.036c-0.071,0-0.147-0.014-0.219-0.021c-0.133-0.007-0.266-0.011-0.395-0.036 c-0.075-0.014-0.147-0.043-0.223-0.064c-0.124-0.035-0.251-0.061-0.373-0.111c-0.083-0.032-0.161-0.082-0.244-0.121 c-0.106-0.055-0.215-0.104-0.316-0.165c-0.084-0.058-0.16-0.13-0.239-0.194c-0.086-0.064-0.176-0.122-0.254-0.201 c-0.005-0.003-0.009-0.011-0.013-0.014c-0.007-0.004-0.011-0.008-0.014-0.011l-8.142-8.13 C15.837,26.019,15.834,23.986,17.093,22.725z" fill="#000000"/></svg>',PREVBUTTON='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="55" height="55"><path d="M27.5,5C15.073,5,5,15.073,5,27.5C5,39.928,15.073,50,27.5,50S50,39.928,50,27.5 C50,15.073,39.927,5,27.5,5z M37.906,32.275c-0.626,0.624-1.447,0.939-2.271,0.939c-0.821,0-1.645-0.315-2.271-0.939l-5.84-5.833 l-5.657,5.802c-0.63,0.645-1.464,0.967-2.3,0.967c-0.808,0-1.62-0.305-2.246-0.914c-1.266-1.238-1.295-3.271-0.056-4.546 l7.929-8.126c0.002,0,0.002,0,0.003,0c0.01-0.011,0.015-0.021,0.022-0.028c0.116-0.115,0.245-0.208,0.371-0.302 c0.039-0.028,0.071-0.064,0.111-0.093c0.114-0.075,0.24-0.133,0.36-0.194c0.068-0.035,0.131-0.078,0.2-0.107 c0.1-0.039,0.203-0.064,0.306-0.093c0.099-0.032,0.191-0.068,0.292-0.09c0.083-0.018,0.169-0.018,0.251-0.028 c0.122-0.015,0.244-0.033,0.366-0.036c0.071,0,0.147,0.014,0.219,0.021c0.133,0.007,0.266,0.011,0.395,0.036 c0.075,0.014,0.146,0.043,0.223,0.064c0.123,0.035,0.251,0.061,0.373,0.111c0.082,0.032,0.161,0.082,0.243,0.121 c0.106,0.055,0.216,0.104,0.316,0.165c0.084,0.058,0.159,0.13,0.238,0.194c0.086,0.064,0.176,0.122,0.255,0.201 c0.005,0.003,0.009,0.011,0.013,0.014c0.007,0.004,0.011,0.008,0.014,0.011l8.142,8.13C39.162,28.981,39.166,31.014,37.906,32.275 z" fill="#000000"/></svg>',MSGBLOCK='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1000" height="42"><g transform="matrix(2,0,0,2,0,8)"><path d="m 0.5,8.5 0,-8 c 0,-2.09 1.91,-4 4,-4 l 4,0 10,0 473,0 4,0 c 2.09,0 4.26,1.92 4,4 l 0,8 0,4 c 0,2.09 -1.91,4 -4,4 l -4,0 -473,0 -10,0 -4,0 c -2.09,0 -4,-1.91 -4,-4 z" style="fill:fill_color;fill-opacity:1;stroke:stroke_color;stroke-width:1;stroke-linecap:round;stroke-opacity:1" /></g></svg>',BOUNDARY='<svg xmlns="http://www.w3.org/2000/svg" height="HEIGHT" width="WIDTH"> <rect style="fill:none;stroke:stroke_color;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:9, 9;stroke-dashoffset:0;stroke-opacity:1" y="Y" x="X" height="DY" width="DX" /></svg>',MBOUNDARY='<svg xmlns="http://www.w3.org/2000/svg" height="HEIGHT" width="WIDTH"> <rect style="fill:fill_color;stroke:stroke_color;stroke-width:STROKE;stroke-linecap:round;stroke-linejoin:round;stroke-opacity:1" y="Y" x="X" height="DY" width="DX" /></svg>',BORDER='<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><rect width="115" height="115" x="2.5" y="2.5" style="fill:none;stroke:stroke_color;stroke-width:5.0;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:15, 15;stroke-dashoffset:0" /></svg>',PALETTECOLORS0={widgets:[37.5,70,50],pitch:[37.5,70,50],rhythm:[12.5,60,80],meter:[12.5,60,80],tone:[57.5,50,28],ornament:[57.5,50,28],intervals:[37.5,70,50],volume:[57.5,50,28],drum:[57.5,50,28],mouse:[37.5,70,50],pen:[57.5,50,28],boxes:[12.5,60,80],action:[22.5,80,57],media:[57.5,70,28],number:[0,70,42],boolean:[30,80,57],flow:[15,60,50],sensors:[7.5,60,80],extras:[12.5,60,80],program:[12.5,60,80],myblocks:[57.5,70,14],heap:[17.5,60,70],dictionary:[17.5,60,70],mice:[7.5,50,0]},PALETTECOLORS={widgets:[37.5,70,35],pitch:[37.5,70,42],rhythm:[12.5,60,49],meter:[12.5,60,49],tone:[57.5,50,21],ornament:[57.5,50,21],intervals:[37.5,70,42],volume:[57.5,50,21],drum:[57.5,50,21],mouse:[37.5,70,35],pen:[57.5,50,21],boxes:[12.5,60,49],action:[22.5,80,35],media:[57.5,70,21],number:[0,70,28],boolean:[30,80,35],flow:[15,60,28],sensors:[7.5,60,35],extras:[12.5,60,49],program:[12.5,60,49],myblocks:[57.5,70,14],heap:[17.5,60,28],dictionary:[17.5,60,28],mice:[7.5,50,0]},PALETTEFILLCOLORS={},PALETTESTROKECOLORS={},PALETTEHIGHLIGHTCOLORS={},HIGHLIGHTSTROKECOLORS={},UPICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 55 55"><path d="M27.5,5C15.073,5,5,15.073,5,27.5C5,39.928,15.073,50,27.5,50S50,39.928,50,27.5 C50,15.073,39.927,5,27.5,5z M37.906,32.275c-0.626,0.624-1.447,0.939-2.271,0.939c-0.821,0-1.645-0.315-2.271-0.939l-5.84-5.833 l-5.657,5.802c-0.63,0.645-1.464,0.967-2.3,0.967c-0.808,0-1.62-0.305-2.246-0.914c-1.266-1.238-1.295-3.271-0.056-4.546 l7.929-8.126c0.002,0,0.002,0,0.003,0c0.01-0.011,0.015-0.021,0.022-0.028c0.116-0.115,0.245-0.208,0.371-0.302 c0.039-0.028,0.071-0.064,0.111-0.093c0.114-0.075,0.24-0.133,0.36-0.194c0.068-0.035,0.131-0.078,0.2-0.107 c0.1-0.039,0.203-0.064,0.306-0.093c0.099-0.032,0.191-0.068,0.292-0.09c0.083-0.018,0.169-0.018,0.251-0.028 c0.122-0.015,0.244-0.033,0.366-0.036c0.071,0,0.147,0.014,0.219,0.021c0.133,0.007,0.266,0.011,0.395,0.036 c0.075,0.014,0.146,0.043,0.223,0.064c0.123,0.035,0.251,0.061,0.373,0.111c0.082,0.032,0.161,0.082,0.243,0.121 c0.106,0.055,0.216,0.104,0.316,0.165c0.084,0.058,0.159,0.13,0.238,0.194c0.086,0.064,0.176,0.122,0.255,0.201 c0.005,0.003,0.009,0.011,0.013,0.014c0.007,0.004,0.011,0.008,0.014,0.011l8.142,8.13C39.162,28.981,39.166,31.014,37.906,32.275 z" fill="#000000"/></svg>',DOWNICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 55 55"><path d="M27.5,50C39.927,50,50,39.927,50,27.5C50,15.072,39.927,5,27.5,5S5,15.072,5,27.5 C5,39.927,15.073,50,27.5,50z M17.093,22.725c0.626-0.624,1.447-0.939,2.271-0.939c0.822,0,1.645,0.315,2.271,0.939l5.84,5.833 l5.657-5.802c0.63-0.645,1.464-0.967,2.3-0.967c0.808,0,1.62,0.305,2.246,0.914c1.266,1.238,1.295,3.271,0.056,4.546l-7.929,8.126 c-0.002,0-0.002,0-0.003,0c-0.01,0.011-0.015,0.021-0.022,0.028c-0.116,0.115-0.245,0.208-0.371,0.302 c-0.039,0.028-0.071,0.064-0.111,0.093c-0.114,0.075-0.24,0.133-0.36,0.194c-0.068,0.035-0.131,0.078-0.2,0.107 c-0.1,0.039-0.203,0.064-0.306,0.093c-0.099,0.032-0.191,0.068-0.292,0.09c-0.083,0.018-0.169,0.018-0.251,0.028 c-0.122,0.015-0.244,0.033-0.366,0.036c-0.071,0-0.147-0.014-0.219-0.021c-0.133-0.007-0.266-0.011-0.395-0.036 c-0.075-0.014-0.147-0.043-0.223-0.064c-0.124-0.035-0.251-0.061-0.373-0.111c-0.083-0.032-0.161-0.082-0.244-0.121 c-0.106-0.055-0.215-0.104-0.316-0.165c-0.084-0.058-0.16-0.13-0.239-0.194c-0.086-0.064-0.176-0.122-0.254-0.201 c-0.005-0.003-0.009-0.011-0.013-0.014c-0.007-0.004-0.011-0.008-0.014-0.011l-8.142-8.13 C15.837,26.019,15.834,23.986,17.093,22.725z" fill="#000000"/></svg>',FADEDUPICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 55 55"><path d="M27.5,5C15.073,5,5,15.073,5,27.5C5,39.928,15.073,50,27.5,50S50,39.928,50,27.5 C50,15.073,39.927,5,27.5,5z M37.906,32.275c-0.626,0.624-1.447,0.939-2.271,0.939c-0.821,0-1.645-0.315-2.271-0.939l-5.84-5.833 l-5.657,5.802c-0.63,0.645-1.464,0.967-2.3,0.967c-0.808,0-1.62-0.305-2.246-0.914c-1.266-1.238-1.295-3.271-0.056-4.546 l7.929-8.126c0.002,0,0.002,0,0.003,0c0.01-0.011,0.015-0.021,0.022-0.028c0.116-0.115,0.245-0.208,0.371-0.302 c0.039-0.028,0.071-0.064,0.111-0.093c0.114-0.075,0.24-0.133,0.36-0.194c0.068-0.035,0.131-0.078,0.2-0.107 c0.1-0.039,0.203-0.064,0.306-0.093c0.099-0.032,0.191-0.068,0.292-0.09c0.083-0.018,0.169-0.018,0.251-0.028 c0.122-0.015,0.244-0.033,0.366-0.036c0.071,0,0.147,0.014,0.219,0.021c0.133,0.007,0.266,0.011,0.395,0.036 c0.075,0.014,0.146,0.043,0.223,0.064c0.123,0.035,0.251,0.061,0.373,0.111c0.082,0.032,0.161,0.082,0.243,0.121 c0.106,0.055,0.216,0.104,0.316,0.165c0.084,0.058,0.159,0.13,0.238,0.194c0.086,0.064,0.176,0.122,0.255,0.201 c0.005,0.003,0.009,0.011,0.013,0.014c0.007,0.004,0.011,0.008,0.014,0.011l8.142,8.13C39.162,28.981,39.166,31.014,37.906,32.275 z" fill="#b8b8b8"/></svg>',FADEDDOWNICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 55 55"><path d="M27.5,50C39.927,50,50,39.927,50,27.5C50,15.072,39.927,5,27.5,5S5,15.072,5,27.5 C5,39.927,15.073,50,27.5,50z M17.093,22.725c0.626-0.624,1.447-0.939,2.271-0.939c0.822,0,1.645,0.315,2.271,0.939l5.84,5.833 l5.657-5.802c0.63-0.645,1.464-0.967,2.3-0.967c0.808,0,1.62,0.305,2.246,0.914c1.266,1.238,1.295,3.271,0.056,4.546l-7.929,8.126 c-0.002,0-0.002,0-0.003,0c-0.01,0.011-0.015,0.021-0.022,0.028c-0.116,0.115-0.245,0.208-0.371,0.302 c-0.039,0.028-0.071,0.064-0.111,0.093c-0.114,0.075-0.24,0.133-0.36,0.194c-0.068,0.035-0.131,0.078-0.2,0.107 c-0.1,0.039-0.203,0.064-0.306,0.093c-0.099,0.032-0.191,0.068-0.292,0.09c-0.083,0.018-0.169,0.018-0.251,0.028 c-0.122,0.015-0.244,0.033-0.366,0.036c-0.071,0-0.147-0.014-0.219-0.021c-0.133-0.007-0.266-0.011-0.395-0.036 c-0.075-0.014-0.147-0.043-0.223-0.064c-0.124-0.035-0.251-0.061-0.373-0.111c-0.083-0.032-0.161-0.082-0.244-0.121 c-0.106-0.055-0.215-0.104-0.316-0.165c-0.084-0.058-0.16-0.13-0.239-0.194c-0.086-0.064-0.176-0.122-0.254-0.201 c-0.005-0.003-0.009-0.011-0.013-0.014c-0.007-0.004-0.011-0.008-0.014-0.011l-8.142-8.13 C15.837,26.019,15.834,23.986,17.093,22.725z" fill="#b8b8b8"/></svg>',CLOSEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 55 55"><g transform="translate(0-997.36)"><path fill="fill_color" d="m0 997.36h55v54.998h-55z"/><g fill="#fff"><path d="m44.971 1036.26c1.675 1.674 1.675 4.39 0 6.06-1.675 1.674-4.391 1.674-6.07 0l-28.875-28.872c-1.675-1.674-1.675-4.39 0-6.06 1.675-1.674 4.391-1.674 6.07 0l28.875 28.872"/><path d="m16.09 1042.33c-1.675 1.674-4.391 1.674-6.07 0-1.675-1.674-1.675-4.39 0-6.06l28.875-28.871c1.675-1.674 4.391-1.674 6.07 0 1.675 1.674 1.675 4.39 0 6.06l-28.875 28.871"/></g></g></svg>',ACTIONSPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 11</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M15.67,43.73V39.11H14.05A5.35,5.35,0,0,1,8.7,33.78V17.59a5.34,5.34,0,0,1,5.35-5.32h3v4.62H29.62V12.27H42a5.34,5.34,0,0,1,5.35,5.32V33.78A5.35,5.35,0,0,1,42,39.11H31v4.62Z" style="fill:#ffbf00"/><path d="M42,13a4.63,4.63,0,0,1,4.65,4.62V33.78A4.64,4.64,0,0,1,42,38.41H30.32V43H16.38V38.41H14.05A4.64,4.64,0,0,1,9.4,33.78V17.59A4.63,4.63,0,0,1,14.05,13h2.33v4.62H30.32V13H42m0-1.4h-13v4.62H17.78V11.57H14.05a6,6,0,0,0-6.05,6V33.78a6,6,0,0,0,6.05,6H15v4.62H31.72V39.81H42a6,6,0,0,0,6-6V17.59a6,6,0,0,0-6-6Z" style="fill:#daaf30"/></g></g></svg>',BOOLEANPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 15</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M23.46,28A11.69,11.69,0,0,1,28,18.78a12,12,0,0,0-7.38-2.53,11.75,11.75,0,1,0,0,23.5A12,12,0,0,0,28,37.22,11.69,11.69,0,0,1,23.46,28Z" style="fill:#d97df5;stroke:#b653d3;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><path d="M35.38,16.25A12,12,0,0,0,28,18.78a11.63,11.63,0,0,1,0,18.44,12,12,0,0,0,7.38,2.53,11.75,11.75,0,1,0,0-23.5Z" style="fill:#d97df5;stroke:#b653d3;stroke-miterlimit:10;stroke-width:1.399999976158142px"/></g></g></svg>',BOXESPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 16</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M28.29,44.21a1,1,0,0,1-.53-.16,1,1,0,0,1-.46-.83V26.13a1,1,0,0,1,.59-.9l14.93-6.69a1.11,1.11,0,0,1,.41-.08,1,1,0,0,1,.53.15,1,1,0,0,1,.46.83V36.53a1,1,0,0,1-.59.9L28.7,44.12A1,1,0,0,1,28.29,44.21Z" style="fill:#fe994f"/><path d="M43.23,19.16a.26.26,0,0,1,.15,0,.29.29,0,0,1,.14.24V36.53a.3.3,0,0,1-.17.26L28.41,43.48a.25.25,0,0,1-.12,0,.32.32,0,0,1-.16,0,.28.28,0,0,1-.13-.24V26.14a.3.3,0,0,1,.17-.27L43.1,19.18l.13,0m0-1.4a1.86,1.86,0,0,0-.7.14L27.6,24.6a1.68,1.68,0,0,0-1,1.54V43.22a1.66,1.66,0,0,0,.79,1.42,1.68,1.68,0,0,0,.9.26,1.86,1.86,0,0,0,.7-.14l14.93-6.69a1.7,1.7,0,0,0,1-1.54V19.44a1.69,1.69,0,0,0-1.69-1.68Z" style="fill:#e86b0e"/><path d="M27.71,44.21a.93.93,0,0,1-.4-.09L12.37,37.43a1,1,0,0,1-.59-.9V19.44a1,1,0,0,1,.46-.83,1,1,0,0,1,.53-.15,1.15,1.15,0,0,1,.41.08l14.94,6.7a1,1,0,0,1,.58.89V43.22a1,1,0,0,1-.47.83A.94.94,0,0,1,27.71,44.21Z" style="fill:#fe994f"/><path d="M12.77,19.16l.13,0,14.93,6.69a.3.3,0,0,1,.17.27V43.22a.28.28,0,0,1-.13.24.32.32,0,0,1-.16,0,.25.25,0,0,1-.12,0L12.65,36.79a.3.3,0,0,1-.17-.26V19.44a.29.29,0,0,1,.14-.24.26.26,0,0,1,.15,0m0-1.4a1.69,1.69,0,0,0-1.69,1.69V36.53a1.7,1.7,0,0,0,1,1.54L27,44.76a1.74,1.74,0,0,0,1.6-.12,1.66,1.66,0,0,0,.79-1.42V26.14a1.68,1.68,0,0,0-1-1.54L13.47,17.91a1.69,1.69,0,0,0-.7-.15Z" style="fill:#e86b0e"/><path d="M28,26.52a1,1,0,0,1-.41-.09l-3.36-1.57-7.76-3.42-.28-.11L13.14,20a1,1,0,0,1-.58-.91,1,1,0,0,1,.59-.89L27.6,11.88a.93.93,0,0,1,.4-.09.86.86,0,0,1,.39.09l14.46,6.28a1,1,0,0,1,0,1.8L28.41,26.43A1,1,0,0,1,28,26.52Z" style="fill:#fe994f"/><path d="M28,12.5a.25.25,0,0,1,.12,0l2.49,1.08h0l8.57,3.73,3.39,1.47a.3.3,0,0,1,.17.26.29.29,0,0,1-.17.26L28.12,25.79a.26.26,0,0,1-.24,0l-3.35-1.56-8-3.55h0l-.9-.4h0l-2.15-1a.29.29,0,0,1-.17-.26.3.3,0,0,1,.17-.26l14.45-6.28a.25.25,0,0,1,.12,0m0-1.4a1.63,1.63,0,0,0-.68.14L12.88,17.52a1.67,1.67,0,0,0-1,1.53,1.69,1.69,0,0,0,1,1.55l2.15,1,.9.4.57.26h0L24,25.51l3.31,1.55a1.74,1.74,0,0,0,.72.16,1.65,1.65,0,0,0,.69-.15L43.14,20.6a1.69,1.69,0,0,0,1-1.55,1.67,1.67,0,0,0-1-1.53L39.74,16l-8.57-3.72-2.49-1.08A1.63,1.63,0,0,0,28,11.1Z" style="fill:#e86b0e"/></g></g></svg>',BLOCKSPALETTEICON=BOXESPALETTEICON,CARTESIANBUTTON='<svg width="42" height="42" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 42"><title>アセット 33</title><g style="isolation:isolate"><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="42" height="42" rx="5" ry="5" style="fill:#292929;opacity:0.4;mix-blend-mode:multiply"/><path d="M31.73,21a10.36,10.36,0,0,1-5.36,9,11,11,0,0,1-10.74,0,10.27,10.27,0,0,1,0-18,11,11,0,0,1,10.74,0A10.36,10.36,0,0,1,31.73,21Z" style="fill:none;stroke:#d8d8d8;stroke-linecap:square;stroke-miterlimit:10;stroke-width:1.36741304397583px"/><line x1="21" y1="8.37" x2="21" y2="33.63" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:1.6257020235061646px"/><line x1="33.63" y1="21" x2="8.37" y2="21" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:1.6257020235061646px"/><rect x="10.98" y="10.98" width="20.04" height="20.04" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:1.6257020235061646px"/></g></g></g></svg>',SELECTBUTTON='<svg width="42" height="42" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--gis" preserveAspectRatio="xMidYMid meet"><path d="M2.1 0v1.914H0v6h3V3h5.1V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h1.8v1.2h3V0h-4.8zm1.8 7.2v6h3v-6h-3zM0 10.913v6h3v-6H0zM66.9 16.2v6h3v-6h-3zM0 19.914v6h3v-6H0zM66.9 25.2v6h3v-6h-3zM0 28.914v6h3v-6H0zM66.9 34.2v6h3v-6h-3zM0 37.914v6h3v-6H0zM66.9 43.2v6h3v-6h-3zM0 46.914v6h3v-6H0zM66.9 52.2v6h3v-6h-3zM0 55.914v5.191h3.809v-3H3v-2.19H0zm6.809 2.191v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9.648 1.899a2.076 2.076 0 0 0-2.19 2.324l3.137 33.676c.2 1.635 2.135 2.399 3.397 1.34l6.623-5.371l2.969 5.142c1.707 2.958 4.417 3.684 7.375 1.977c2.957-1.708 3.684-4.417 1.976-7.375l-2.959-5.125l7.848-3.008c1.548-.564 1.855-2.62.539-3.611L71.576 60.416a2.073 2.073 0 0 0-1.119-.412z" fill="#fff"></path></svg>',CARTESIANPOLARBUTTON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 42"><title>アセット 30</title><g style="isolation:isolate"><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="42" height="42" rx="5" ry="5" style="fill:#292929;opacity:0.4;mix-blend-mode:multiply"/><path d="M31.73,21a10.36,10.36,0,0,1-5.36,9,11,11,0,0,1-10.74,0,10.27,10.27,0,0,1,0-18,11,11,0,0,1,10.74,0A10.36,10.36,0,0,1,31.73,21Z" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:1.6257020235061646px"/><line x1="21" y1="8.37" x2="21" y2="33.63" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:1.6257020235061646px"/><line x1="33.63" y1="21" x2="8.37" y2="21" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:1.6257020235061646px"/><rect x="10.98" y="10.98" width="20.04" height="20.04" style="fill:none;stroke:#fff;stroke-linecap:square;stroke-miterlimit:10;stroke-width:1.36741304397583px"/></g></g></g></svg>',DRUMPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 8</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#dfdfdf;opacity:0"/><path d="M31.05,23a2.76,2.76,0,0,1,0-5.51,3.38,3.38,0,0,1,.63.07l4.23-4.22a1.46,1.46,0,0,1,2.48,1,1.44,1.44,0,0,1-.43,1l-4.22,4.22A2.76,2.76,0,0,1,31.05,23Z" style="fill:#3edcdd"/><path d="M36.92,13.62a.79.79,0,0,1,.54.22.77.77,0,0,1,0,1.07l-4.53,4.53a2.05,2.05,0,0,1-1.88,2.87,2.06,2.06,0,0,1,0-4.11,2.11,2.11,0,0,1,.82.17l4.53-4.53a.79.79,0,0,1,.53-.22m0-1.4v0a2.18,2.18,0,0,0-1.52.63l-4,4-.39,0a3.46,3.46,0,1,0,3.44,3.07l4-4a2.16,2.16,0,0,0-1.53-3.68Z" style="fill:#1dbcbd"/><path d="M26,20.36A2.75,2.75,0,0,1,23.27,17L19,12.75a1.46,1.46,0,0,1,1-2.48,1.44,1.44,0,0,1,1,.43l4.22,4.22a2.78,2.78,0,0,1,2.57.73A2.76,2.76,0,0,1,26,20.36Z" style="fill:#3edcdd"/><path d="M20.07,11a.73.73,0,0,1,.53.22l4.53,4.53a2.11,2.11,0,0,1,.82-.17,2.05,2.05,0,0,1,1.45,3.5,2.05,2.05,0,0,1-3.34-2.26l-4.53-4.53A.76.76,0,0,1,20.07,11m0-1.4a2.14,2.14,0,0,0-1.53.63,2.16,2.16,0,0,0,0,3.05l4,4A3.47,3.47,0,0,0,26,21.06a3.46,3.46,0,0,0,0-6.91l-.39,0-4-4a2.12,2.12,0,0,0-1.52-.63Z" style="fill:#1dbcbd"/><path d="M15.91,45.73a2.21,2.21,0,0,1-2.21-2.21V42a2.21,2.21,0,0,1,2.21-2.21h.81V26.6h-.81a2.21,2.21,0,0,1-2.21-2.21V22.88a2.22,2.22,0,0,1,2.21-2.22H40.09a2.22,2.22,0,0,1,2.21,2.22v1.51a2.21,2.21,0,0,1-2.21,2.21h-.81V39.8h.81A2.21,2.21,0,0,1,42.3,42v1.51a2.21,2.21,0,0,1-2.21,2.21Z" style="fill:#3edcdd"/><path d="M40.09,21.36a1.52,1.52,0,0,1,1.51,1.52v1.51a1.52,1.52,0,0,1-1.51,1.51H38.58V40.5h1.51A1.51,1.51,0,0,1,41.6,42v1.51A1.52,1.52,0,0,1,40.09,45H15.91a1.52,1.52,0,0,1-1.51-1.51V42a1.51,1.51,0,0,1,1.51-1.51h1.51V25.9H15.91a1.52,1.52,0,0,1-1.51-1.51V22.88a1.52,1.52,0,0,1,1.51-1.52H40.09m0-1.4H15.91A2.92,2.92,0,0,0,13,22.88v1.51a2.92,2.92,0,0,0,2.91,2.91H16V39.1h-.11A2.91,2.91,0,0,0,13,42v1.51a2.92,2.92,0,0,0,2.91,2.91H40.09A2.92,2.92,0,0,0,43,43.52V42a2.91,2.91,0,0,0-2.91-2.91H40V27.3h.11A2.92,2.92,0,0,0,43,24.39V22.88A2.92,2.92,0,0,0,40.09,20Z" style="fill:#1dbcbd"/></g></g></svg>',EFFECTPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 8</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#dfdfdf;opacity:0"/><path d="M31.05,23a2.76,2.76,0,0,1,0-5.51,3.38,3.38,0,0,1,.63.07l4.23-4.22a1.46,1.46,0,0,1,2.48,1,1.44,1.44,0,0,1-.43,1l-4.22,4.22A2.76,2.76,0,0,1,31.05,23Z" style="fill:#3edcdd"/><path d="M36.92,13.62a.79.79,0,0,1,.54.22.77.77,0,0,1,0,1.07l-4.53,4.53a2.05,2.05,0,0,1-1.88,2.87,2.06,2.06,0,0,1,0-4.11,2.11,2.11,0,0,1,.82.17l4.53-4.53a.79.79,0,0,1,.53-.22m0-1.4v0a2.18,2.18,0,0,0-1.52.63l-4,4-.39,0a3.46,3.46,0,1,0,3.44,3.07l4-4a2.16,2.16,0,0,0-1.53-3.68Z" style="fill:#1dbcbd"/><path d="M26,20.36A2.75,2.75,0,0,1,23.27,17L19,12.75a1.46,1.46,0,0,1,1-2.48,1.44,1.44,0,0,1,1,.43l4.22,4.22a2.78,2.78,0,0,1,2.57.73A2.76,2.76,0,0,1,26,20.36Z" style="fill:#3edcdd"/><path d="M20.07,11a.73.73,0,0,1,.53.22l4.53,4.53a2.11,2.11,0,0,1,.82-.17,2.05,2.05,0,0,1,1.45,3.5,2.05,2.05,0,0,1-3.34-2.26l-4.53-4.53A.76.76,0,0,1,20.07,11m0-1.4a2.14,2.14,0,0,0-1.53.63,2.16,2.16,0,0,0,0,3.05l4,4A3.47,3.47,0,0,0,26,21.06a3.46,3.46,0,0,0,0-6.91l-.39,0-4-4a2.12,2.12,0,0,0-1.52-.63Z" style="fill:#1dbcbd"/><path d="M15.91,45.73a2.21,2.21,0,0,1-2.21-2.21V42a2.21,2.21,0,0,1,2.21-2.21h.81V26.6h-.81a2.21,2.21,0,0,1-2.21-2.21V22.88a2.22,2.22,0,0,1,2.21-2.22H40.09a2.22,2.22,0,0,1,2.21,2.22v1.51a2.21,2.21,0,0,1-2.21,2.21h-.81V39.8h.81A2.21,2.21,0,0,1,42.3,42v1.51a2.21,2.21,0,0,1-2.21,2.21Z" style="fill:#3edcdd"/><path d="M40.09,21.36a1.52,1.52,0,0,1,1.51,1.52v1.51a1.52,1.52,0,0,1-1.51,1.51H38.58V40.5h1.51A1.51,1.51,0,0,1,41.6,42v1.51A1.52,1.52,0,0,1,40.09,45H15.91a1.52,1.52,0,0,1-1.51-1.51V42a1.51,1.51,0,0,1,1.51-1.51h1.51V25.9H15.91a1.52,1.52,0,0,1-1.51-1.51V22.88a1.52,1.52,0,0,1,1.51-1.52H40.09m0-1.4H15.91A2.92,2.92,0,0,0,13,22.88v1.51a2.92,2.92,0,0,0,2.91,2.91H16V39.1h-.11A2.91,2.91,0,0,0,13,42v1.51a2.92,2.92,0,0,0,2.91,2.91H40.09A2.92,2.92,0,0,0,43,43.52V42a2.91,2.91,0,0,0-2.91-2.91H40V27.3h.11A2.92,2.92,0,0,0,43,24.39V22.88A2.92,2.92,0,0,0,40.09,20Z" style="fill:#1dbcbd"/></g></g></svg>',ERASEBUTTON='<svg width="42" height="42" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 42"><title>アセット 27</title><g style="isolation:isolate"><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="42" height="42" rx="5" ry="5" style="fill:#292929;opacity:0.4;mix-blend-mode:multiply"/><path d="M32.54,31.33H19.16l2-2-8-8.09-2.92,2.88a1.14,1.14,0,0,0,0,1.61l5.51,5.58H7.4a.62.62,0,1,0,0,1.24H32.54a.62.62,0,1,0,0-1.24Z" style="fill:#fff"/><path d="M32.82,17.86a1.15,1.15,0,0,0,0-1.61L26.44,9.77a1.15,1.15,0,0,0-1.61,0L14.06,20.39l8,8.1Z" style="fill:#fff"/></g></g></g></svg>',CLEARBUTTON=ERASEBUTTON,EXTRASPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 19</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M41.13,44.77a4.27,4.27,0,0,1-3-1.21l-16-15.63a8.87,8.87,0,0,1-2.61.39,8.76,8.76,0,0,1-6.16-2.5A8.37,8.37,0,0,1,11,18.57a1.4,1.4,0,0,1,1.4-1.2,1.39,1.39,0,0,1,1,.41l2.9,2.83a3,3,0,0,0,4.26,0,2.79,2.79,0,0,0,.8-2,3.08,3.08,0,0,0-.92-2.15l-2.81-2.75a1.37,1.37,0,0,1-.35-1.41,1.4,1.4,0,0,1,1.15-.95,8.24,8.24,0,0,1,1.22-.08,8.71,8.71,0,0,1,6.16,2.5,8.5,8.5,0,0,1,2.16,8.59L43.94,38a3.92,3.92,0,0,1,0,5.67A4,4,0,0,1,41.13,44.77Z" style="fill:#c4c4c4"/><path d="M19.59,11.75a8.25,8.25,0,0,1,5.79,2.35,7.9,7.9,0,0,1,1.92,8.37L43.57,38.41a3.38,3.38,0,0,1,0,4.9,3.48,3.48,0,0,1-2.4.94,3.71,3.71,0,0,1-2.6-1.06L22.34,27.33a8.35,8.35,0,0,1-2.75.46,8.23,8.23,0,0,1-5.79-2.35,7.92,7.92,0,0,1-2.32-6.79.89.89,0,0,1,.88-.75.85.85,0,0,1,.61.25L15.87,21a3.52,3.52,0,0,0,2.48,1,3.56,3.56,0,0,0,2.53-1,3.46,3.46,0,0,0-.13-4.89l-2.81-2.76a.85.85,0,0,1,.5-1.46,8.89,8.89,0,0,1,1.15-.08m0-1.05a9.22,9.22,0,0,0-1.29.09,1.92,1.92,0,0,0-1.58,1.3A1.89,1.89,0,0,0,17.2,14L20,16.8a2.57,2.57,0,0,1,.77,1.78,2.28,2.28,0,0,1-.66,1.62,2.42,2.42,0,0,1-1.77.74,2.52,2.52,0,0,1-1.75-.7L13.71,17.4a1.94,1.94,0,0,0-3.27,1.1,8.93,8.93,0,0,0,2.62,7.7,9.36,9.36,0,0,0,9,2.32L37.79,43.94a4.82,4.82,0,0,0,3.34,1.36,4.51,4.51,0,0,0,3.12-1.22,4.45,4.45,0,0,0,.06-6.42L28.5,22.17a9,9,0,0,0-2.39-8.82,9.25,9.25,0,0,0-6.52-2.65Z" style="fill:#a0a0a0"/></g></g></svg>',FLOWPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 12</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M32.37,24.34a1.24,1.24,0,0,1-1-.61,1.21,1.21,0,0,1,0-1.22l1.53-2.64a13.79,13.79,0,0,0-6.48-1.61,13.49,13.49,0,0,0-7.48,2.25,4.92,4.92,0,0,1-2.65.81A3.3,3.3,0,0,1,14,20.48a2.53,2.53,0,0,1-.76-2.13,4.56,4.56,0,0,1,2.11-3.3A20,20,0,0,1,26.4,11.72a20.27,20.27,0,0,1,9.75,2.5L38,11.1a1.21,1.21,0,0,1,2.18.2L43.69,21a1.22,1.22,0,0,1-.94,1.62L32.51,24.33Z" style="fill:#d98a43"/><path d="M39,11.2a.51.51,0,0,1,.48.34L43,21.26a.52.52,0,0,1-.4.69L32.46,23.63h-.09a.52.52,0,0,1-.44-.78l1.89-3.25a14.56,14.56,0,0,0-7.44-2.05,14.22,14.22,0,0,0-7.87,2.36,4.17,4.17,0,0,1-2.26.7A2.62,2.62,0,0,1,14.44,20c-1-1-.59-3.11,1.26-4.33a19.33,19.33,0,0,1,10.7-3.22,19.57,19.57,0,0,1,10,2.75l2.16-3.72A.5.5,0,0,1,39,11.2m0-1.4a1.91,1.91,0,0,0-1.65.95l-1.47,2.54A20.92,20.92,0,0,0,26.4,11a20.63,20.63,0,0,0-11.47,3.45,5.2,5.2,0,0,0-2.42,3.82,3.28,3.28,0,0,0,1,2.71,4,4,0,0,0,2.76,1,5.68,5.68,0,0,0,3-.92A12.85,12.85,0,0,1,26.38,19a13,13,0,0,1,5.5,1.21l-1.16,2a1.93,1.93,0,0,0,0,1.92,1.91,1.91,0,0,0,1.65,1,1.63,1.63,0,0,0,.31,0l10.18-1.68a1.9,1.9,0,0,0,1.34-.92,1.93,1.93,0,0,0,.15-1.62L40.8,11.06A1.93,1.93,0,0,0,39,9.8Z" style="fill:#b7651a"/><path d="M17,45.5a1.2,1.2,0,0,1-1.14-.8L12.31,35a1.22,1.22,0,0,1,.94-1.62l10.24-1.69h.14a1.24,1.24,0,0,1,1.05.61,1.21,1.21,0,0,1,0,1.22l-1.53,2.64a13.79,13.79,0,0,0,6.48,1.61,13.41,13.41,0,0,0,7.48-2.25,5,5,0,0,1,2.65-.81,3.3,3.3,0,0,1,2.29.84,2.53,2.53,0,0,1,.76,2.13A4.56,4.56,0,0,1,40.69,41,20,20,0,0,1,29.6,44.28a20.27,20.27,0,0,1-9.75-2.5L18,44.9A1.19,1.19,0,0,1,17,45.5Z" style="fill:#d98a43"/><path d="M23.63,32.36a.52.52,0,0,1,.44.78l-1.89,3.25a14.56,14.56,0,0,0,7.44,2,14.22,14.22,0,0,0,7.87-2.36,4.17,4.17,0,0,1,2.26-.7,2.62,2.62,0,0,1,1.81.65c1,1,.59,3.11-1.26,4.33a19.33,19.33,0,0,1-10.7,3.22,19.57,19.57,0,0,1-10-2.75l-2.16,3.72a.5.5,0,0,1-.44.25.51.51,0,0,1-.48-.34L13,34.74a.52.52,0,0,1,.4-.69l10.17-1.68h.09m0-1.4a1.63,1.63,0,0,0-.31,0L13.14,32.67a1.9,1.9,0,0,0-1.34.92,1.93,1.93,0,0,0-.15,1.62l3.55,9.73a1.91,1.91,0,0,0,3.45.31l1.47-2.54A20.92,20.92,0,0,0,29.6,45a20.63,20.63,0,0,0,11.47-3.45,5.18,5.18,0,0,0,2.42-3.82,3.28,3.28,0,0,0-1-2.71,4,4,0,0,0-2.76-1,5.68,5.68,0,0,0-3,.92A12.77,12.77,0,0,1,29.62,37a13,13,0,0,1-5.5-1.21l1.16-2a1.93,1.93,0,0,0,0-1.92,1.91,1.91,0,0,0-1.65-1Z" style="fill:#b7651a"/></g></g></svg>',HEAPPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 13</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><rect x="16.4" y="40.07" width="23.16" height="5.48" rx="0.77" ry="0.77" style="fill:#d98a43"/><path d="M38.79,40.57a.27.27,0,0,1,.27.27v3.93a.27.27,0,0,1-.27.28H17.18a.27.27,0,0,1-.28-.28V40.84a.27.27,0,0,1,.28-.27H38.79m0-1H17.18a1.27,1.27,0,0,0-1.28,1.27v3.93a1.28,1.28,0,0,0,1.28,1.28H38.79a1.27,1.27,0,0,0,1.27-1.28V40.84a1.27,1.27,0,0,0-1.27-1.27Z" style="fill:#b7651a"/><rect x="16.4" y="31.98" width="23.16" height="5.48" rx="0.77" ry="0.77" style="fill:#d98a43"/><path d="M38.79,32.48a.27.27,0,0,1,.27.27v3.94a.27.27,0,0,1-.27.27H17.18a.27.27,0,0,1-.28-.27V32.75a.27.27,0,0,1,.28-.27H38.79m0-1H17.18a1.27,1.27,0,0,0-1.28,1.27v3.94A1.27,1.27,0,0,0,17.18,38H38.79a1.27,1.27,0,0,0,1.27-1.27V32.75a1.27,1.27,0,0,0-1.27-1.27Z" style="fill:#b7651a"/><rect x="16.4" y="23.9" width="23.16" height="5.48" rx="0.77" ry="0.77" style="fill:#d98a43"/><path d="M38.79,24.39a.28.28,0,0,1,.27.28V28.6a.27.27,0,0,1-.27.27H17.18a.27.27,0,0,1-.28-.27V24.67a.28.28,0,0,1,.28-.28H38.79m0-1H17.18a1.28,1.28,0,0,0-1.28,1.28V28.6a1.27,1.27,0,0,0,1.28,1.27H38.79a1.27,1.27,0,0,0,1.27-1.27V24.67a1.28,1.28,0,0,0-1.27-1.28Z" style="fill:#b7651a"/><path d="M33.4,21.58a2,2,0,0,1-2-2V14.29a2,2,0,0,1,2-2h7.41v-1.2a.66.66,0,0,1,.42-.61l.09,0h.16a.68.68,0,0,1,.46.19l3.25,3.1a.67.67,0,0,1,.2.47.63.63,0,0,1-.2.47l-3.25,3.1a.68.68,0,0,1-.46.19h-.1l-.15,0a.66.66,0,0,1-.42-.61V16.1l-5.45,0V19.6A2,2,0,0,1,33.4,21.58Z" style="fill:#d98a43"/><path d="M41.48,11a.16.16,0,0,1,.11.05l3.25,3.1a.15.15,0,0,1,0,.22l-3.25,3.1a.16.16,0,0,1-.11,0l-.07,0a.15.15,0,0,1-.1-.14V15.6H40.19l-5.33,0v4a1.47,1.47,0,0,1-1.46,1.48h0a1.47,1.47,0,0,1-1.47-1.48V14.29a1.47,1.47,0,0,1,1.47-1.48h7.91v-1.7a.18.18,0,0,1,.1-.15h.07m0-1a1.22,1.22,0,0,0-.43.08,1.16,1.16,0,0,0-.74,1.08v.7H33.4a2.48,2.48,0,0,0-2.47,2.48V19.6a2.47,2.47,0,1,0,4.93,0v-3l4.33,0h.12v.71a1.16,1.16,0,0,0,2,.83l3.25-3.09a1.16,1.16,0,0,0,.36-.84,1.14,1.14,0,0,0-.35-.82l-3.26-3.12a1.17,1.17,0,0,0-.8-.32Z" style="fill:#b7651a"/><path d="M22.34,21.58a.65.65,0,0,1-.47-.2L18.8,18.09a.69.69,0,0,1-.13-.7.65.65,0,0,1,.61-.42h1.19V16.1h-8a1.9,1.9,0,0,1,0-3.8h9.85a1.89,1.89,0,0,1,1.88,1.9V17h1.18a.65.65,0,0,1,.61.42.69.69,0,0,1-.13.7l-3.07,3.29A.67.67,0,0,1,22.34,21.58Z" style="fill:#d98a43"/><path d="M22.35,12.81a1.39,1.39,0,0,1,1.38,1.4v3.26h1.68a.16.16,0,0,1,.15.1.17.17,0,0,1,0,.18L22.45,21a.15.15,0,0,1-.22,0l-3.06-3.28a.17.17,0,0,1,0-.18.15.15,0,0,1,.14-.1H21V16.33l0-.73H12.5a1.4,1.4,0,0,1,0-2.8h9.85m0-1H12.5a2.4,2.4,0,0,0,0,4.8h6.23a1.18,1.18,0,0,0-.52.6,1.15,1.15,0,0,0,.23,1.23l3.06,3.29a1.17,1.17,0,0,0,.84.36,1.16,1.16,0,0,0,.84-.36l3.07-3.29a1.17,1.17,0,0,0,.24-1.22,1.16,1.16,0,0,0-1.08-.74h-.68V14.21a2.4,2.4,0,0,0-2.38-2.4Z" style="fill:#b7651a"/></g></g></svg>',DICTPALETTEICON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 55 55.000002" id="svg4792" version="1.1"> <g id="layer1" transform="translate(-207.04724,-371.1811)"> <g id="g5947"> <rect y="382.42371" x="219.79819" height="30.542082" width="29.256098" id="rect5945" style="opacity:1;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.0301905;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" /> <path d="m 250.69748,384.68111 v -2.62501 c 0,-0.48358 -0.30153,-0.875 -0.67307,-0.875 h -12.78845 c -1.09847,0 -2.07623,0.68833 -2.69052,1.75 0,0 0,0 0,0 0,0 0,0 0,0 -0.61429,-1.06167 -1.59205,-1.75 -2.69051,-1.75 h -12.78845 c -0.37155,0 -0.67309,0.39142 -0.67309,0.875 v 2.62501 h -1.34615 v 29.75 h 14.49314 c 0.73635,1.07332 1.81327,1.74999 3.00686,1.74999 1.19359,0 2.27007,-0.67667 3.00596,-1.74999 h 14.49404 v -29.75 h -1.34616 z m -30.96152,-1.75001 h 12.11538 c 1.11327,0 2.01923,1.17775 2.01923,2.62499 v 16.72184 c 0,0.48359 0.30153,0.875 0.67308,0.875 0.37153,0 0.67308,-0.39141 0.67308,-0.875 v -16.72184 c 0,-1.44724 0.90595,-2.62499 2.01923,-2.62499 h 12.11538 v 28 h -12.11538 c -1.09802,0 -2.07623,0.68833 -2.69052,1.75 0,0 0,0 0,0 0,0 0,0 0,0 -0.61429,-1.06167 -1.5925,-1.75 -2.69051,-1.75 h -12.11538 v -28 z" style="fill:#d98a43;fill-opacity:1;stroke-width:0.120762" id="path4311" /> </g> </g> </svg>',PROGRAMPALETTEICON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 14.552084 14.552084" version="1.1"> <g transform="matrix(1.8297871,0,0,1.8297871,-6.037566,-6.0375658)"> <path d="M 6.7527306,6.3934064 4.263988,7.2784534 6.7527306,8.1586773 V 8.5975834 L 3.6610949,7.4762023 V 7.0758813 L 6.7527306,5.9545002 Z" style="stroke-width:0.264583px;stroke:#a0a0a0;stroke-opacity:1" /> <path d="M 7.7993529,6.3934064 V 5.9545002 l 3.0916361,1.1213811 v 0.400321 L 7.7993529,8.5975834 V 8.1586773 L 10.283272,7.2784534 Z" style="stroke-width:0.264583px;stroke:#a0a0a0;stroke-opacity:1" /> </g> </svg>',INTERVALSPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 4</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#dfdfdf;opacity:0"/><path d="M28,48.8c-2.92,0-5.3-2.1-5.3-4.67s2.38-4.67,5.3-4.67a5.87,5.87,0,0,1,2.25.45V38.84a5.69,5.69,0,0,1-2.25.45c-2.92,0-5.3-2.09-5.3-4.67S25.08,30,28,30a5.69,5.69,0,0,1,2.25.46V29.33a5.69,5.69,0,0,1-2.25.45c-2.92,0-5.3-2.09-5.3-4.67s2.38-4.66,5.3-4.66a5.69,5.69,0,0,1,2.25.45V8.75a1.52,1.52,0,1,1,3,0V24.9a1.36,1.36,0,0,1,0,.21,1.94,1.94,0,0,1,0,.24v9.06a1.25,1.25,0,0,1,0,.21,1.64,1.64,0,0,1,0,.23v9a2.23,2.23,0,0,1,0,.32C33.3,46.7,30.92,48.8,28,48.8Z" style="fill:#7cd622"/><path d="M31.76,7.9a.84.84,0,0,1,.82.85V24.9c0,.07,0,.14,0,.21s0,.14,0,.21v9.09c0,.07,0,.14,0,.21s0,.14,0,.21v8.86s0,.06,0,.09,0,.23,0,.35c0,2.19-2.06,4-4.6,4s-4.6-1.78-4.6-4,2.06-4,4.6-4a5,5,0,0,1,2.95,1V37.64a5,5,0,0,1-2.95,1c-2.54,0-4.6-1.78-4.6-4s2.06-4,4.6-4a5,5,0,0,1,2.95,1V28.13a5,5,0,0,1-2.95.95c-2.54,0-4.6-1.77-4.6-4s2.06-4,4.6-4a5,5,0,0,1,2.95.94V8.75a.84.84,0,0,1,.81-.85m0-1.4a2.23,2.23,0,0,0-2.21,2.25V19.93A6.64,6.64,0,0,0,28,19.75c-3.31,0-6,2.4-6,5.36a5.34,5.34,0,0,0,3.22,4.76,5.12,5.12,0,0,0,0,9.51A5.34,5.34,0,0,0,22,44.13c0,3,2.69,5.37,6,5.37s6-2.41,6-5.37a1.69,1.69,0,0,0,0-.35s0-.06,0-.09V34.92c0-.1,0-.2,0-.3s0-.2,0-.3v-8.9c0-.11,0-.21,0-.31s0-.2,0-.3V8.75A2.24,2.24,0,0,0,31.76,6.5Z" style="fill:#57ad02"/></g></g></svg>',MEDIAPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 18</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M17.74,12.69H37a5,5,0,0,1,5,5V43a4.37,4.37,0,0,1-4.37,4.37H17.74a1.67,1.67,0,0,1-1.67-1.67V14.35A1.67,1.67,0,0,1,17.74,12.69Z" style="fill:#ff664b;stroke:#fc2905;stroke-miterlimit:10;stroke-width:1.1655624461467282px"/><rect x="13.38" y="20.83" width="5.4" height="1.67" rx="0.83" ry="0.83" style="fill:#fc2905"/><rect x="13.38" y="29.17" width="5.4" height="1.67" rx="0.83" ry="0.83" style="fill:#fc2905"/><rect x="13.38" y="37.51" width="5.4" height="1.67" rx="0.83" ry="0.83" style="fill:#fc2905"/><rect x="21.68" y="12.55" width="1.45" height="34.83" style="fill:#fc2905"/></g></g></svg>',METERPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 2</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#dfdfdf;opacity:0"/><path d="M24.17,48.94H15.66a.82.82,0,0,1-.63-.2.83.83,0,0,1-.18-.6c0-.25,0-.82.75-.82l.35,0h.47a3.07,3.07,0,0,0,.73-.08.82.82,0,0,0,.71-.92v-.54a10.61,10.61,0,0,1,0-1.13.38.38,0,0,0,0-.14h-2.7l-2.6,0h0l-.24,0-.33,0a.57.57,0,0,1-.61-.39,1.84,1.84,0,0,1,.17-1.61C12.3,41.45,13,40.25,13.65,39A17.71,17.71,0,0,0,16,31.32c0-.4,0-.81,0-1.2v-1l.41.15a6.58,6.58,0,0,0,2.28.39,12,12,0,0,0,3.24-.53l.65-.18-.29.61a53.29,53.29,0,0,1-8.73,13.18h4.31V38.91a.87.87,0,0,1,.22-.7,27.16,27.16,0,0,0,3.65-4.64l.26-.41.26.41a1.18,1.18,0,0,1,.15.75v.28q0,3.93,0,7.86a.73.73,0,0,0,0,.33h.21a5.06,5.06,0,0,1,.55,0h1a.67.67,0,0,1,.54.18.7.7,0,0,1,.12.59s0,.09,0,.13a.83.83,0,0,1-.12.69.63.63,0,0,1-.49.18H22.38v.12c0,.37,0,.75,0,1.12,0,.22,0,.45,0,.67,0,.54.21.78.72.85a4.44,4.44,0,0,0,.63,0h.54a.71.71,0,0,1,.53.18.79.79,0,0,1,.19.59c0,.59-.25.84-.82.84Z" style="fill:#f5a623"/><path d="M22,29.47a53.22,53.22,0,0,1-9.16,13.62h5.05c.35,0,.26-.25.26-.45,0-1.2,0-2.41,0-3.62,0-.2-.06-.42.12-.6A27,27,0,0,0,22,33.73a1.17,1.17,0,0,1,.09.72q0,4,0,8c0,.42.06.65.45.65h.14a4.43,4.43,0,0,1,.52,0h1.06c.48,0,.29.38.3.62s.11.54-.29.54H22.46c-.29,0-.4.1-.38.45,0,.59,0,1.18,0,1.77a1,1,0,0,0,1,1.16,5.27,5.27,0,0,0,.68,0h.54c.27,0,.42.07.41.46s-.11.53-.51.53H15.65c-.36,0-.5-.08-.49-.49s.07-.51.44-.51h0l.79,0a3.2,3.2,0,0,0,.81-.09,1.13,1.13,0,0,0,.94-1.22c0-.55,0-1.1,0-1.65s-.13-.47-.46-.47H12.56c-.17,0-.38.05-.56.05s-.28,0-.32-.18a1.54,1.54,0,0,1,.14-1.34c.75-1.16,1.45-2.35,2.1-3.58a18,18,0,0,0,2.38-7.85c0-.59,0-1.18,0-1.73a6.83,6.83,0,0,0,2.39.41A12.63,12.63,0,0,0,22,29.47m1.13-1-1.3.37a11.74,11.74,0,0,1-3.16.51A6.18,6.18,0,0,1,16.52,29l-.83-.31v1.42c0,.39,0,.78,0,1.18a17.37,17.37,0,0,1-2.31,7.58c-.65,1.21-1.35,2.4-2.08,3.54a2.15,2.15,0,0,0-.21,1.86.89.89,0,0,0,.91.61,2.33,2.33,0,0,0,.37,0l.19,0,2.61,0,2.39,0c0,.34,0,.66,0,1s0,.35,0,.53c0,.38-.12.53-.48.62a2.52,2.52,0,0,1-.66.07h-.78a1,1,0,0,0-1.1,1.11,1,1,0,0,0,1.11,1.12h8.51a1,1,0,0,0,1.15-1.14,1.12,1.12,0,0,0-.28-.82,1,1,0,0,0-.75-.27h-.54a5.28,5.28,0,0,1-.59,0c-.33,0-.44-.13-.45-.55v-.67q0-.45,0-.93h1.55a.93.93,0,0,0,.71-.29,1.05,1.05,0,0,0,.21-.85v-.07a.23.23,0,0,1,0-.07,1,1,0,0,0-.2-.82.91.91,0,0,0-.73-.29H23.18a3.93,3.93,0,0,0-.49,0h0c0-2.58,0-5.19,0-7.72v-.4a1.43,1.43,0,0,0-.19-.94L22,32.58l-.52.82A27,27,0,0,1,17.86,38a1.15,1.15,0,0,0-.3.94v3.54H14.25a53.72,53.72,0,0,0,8.32-12.73l.58-1.23Z" style="fill:#f09000"/><path d="M15.5,27a.61.61,0,0,1-.5-.19.67.67,0,0,1-.14-.56.48.48,0,0,0,0-.18.7.7,0,0,1,.13-.55.62.62,0,0,1,.46-.17l.74,0,.71,0c.66,0,1-.32,1-1,0-.21,0-.41,0-.62s0-.65,0-1a.47.47,0,0,0,0-.19h0a.72.72,0,0,0-.18,0l-2.54,0H12.47l-.21,0-.3,0a.53.53,0,0,1-.57-.36,1.89,1.89,0,0,1,.13-1.54l.37-.61c.57-.94,1.16-1.92,1.7-2.9A17.73,17.73,0,0,0,16,9.42a7.38,7.38,0,0,0,0-.94c0-.28,0-.56,0-.85V7.19l.41.15a6.59,6.59,0,0,0,2.33.4,14.55,14.55,0,0,0,3.24-.47l.62-.15-.27.58a53.14,53.14,0,0,1-8.72,13.13h2.16l2,0h0a.67.67,0,0,0,.19,0,.53.53,0,0,0,0-.2c0-.8,0-1.59,0-2.39V17.06a1.14,1.14,0,0,1,.31-.9,25.22,25.22,0,0,0,3.42-4.33.56.56,0,0,1,.14-.16l.28-.29.27.29a1.21,1.21,0,0,1,.12.71.76.76,0,0,0,0,.15v1c0,2.33,0,4.65,0,7,0,.25,0,.29,0,.29h0a.29.29,0,0,0,.14,0h.11l.47,0h1a.67.67,0,0,1,.54.18.71.71,0,0,1,.15.57v.14a.78.78,0,0,1-.15.66.61.61,0,0,1-.49.19H23l-.47,0h-.15a1.41,1.41,0,0,0,0,.18c0,.36,0,.72,0,1.08s0,.47,0,.71a.72.72,0,0,0,.76.82h.53a1.88,1.88,0,0,0,.34,0l.23,0a.7.7,0,0,1,.54.21,1,1,0,0,1,.19.82.6.6,0,0,1-.67.64H15.5Z" style="fill:#f5a623"/><path d="M22,7.57A53,53,0,0,1,13,21a.31.31,0,0,0,.28.13l.29,0h2.22c.64,0,1.28,0,1.91,0h0c.38,0,.49-.13.48-.54,0-1.18,0-2.37,0-3.56a.86.86,0,0,1,.22-.69A26.19,26.19,0,0,0,21.85,12a1.22,1.22,0,0,1,.16-.18,1.26,1.26,0,0,1,.07.71c0,2.67,0,5.34,0,8,0,.46.13.62.49.62h.14a3.24,3.24,0,0,1,.44,0h1.09c.44,0,.3.35.32.6s0,.52-.33.52H22.48c-.33,0-.42.16-.4.51,0,.6,0,1.19,0,1.78a1,1,0,0,0,1.06,1.13l.54,0,.38,0,.19,0c.39,0,.45.27.43.7s-.11.35-.37.35H15.5c-.42,0-.33-.27-.32-.51s-.12-.52.27-.52h1.46a1.16,1.16,0,0,0,1.26-1.3c0-.53,0-1.06,0-1.59s-.12-.52-.5-.52H12.47c-.15,0-.35.05-.51.05s-.24,0-.27-.15a1.59,1.59,0,0,1,.1-1.29c.7-1.17,1.42-2.33,2.07-3.53a18.19,18.19,0,0,0,2.45-7.9c0-.59-.06-1.18-.06-1.8A7,7,0,0,0,18.69,8,14.43,14.43,0,0,0,22,7.57m1.11-.9L21.85,7a13.84,13.84,0,0,1-3.16.46,6.3,6.3,0,0,1-2.23-.38l-.82-.29v.87a8.43,8.43,0,0,0,0,.87,7,7,0,0,1,0,.91A17.4,17.4,0,0,1,13.32,17c-.53,1-1.12,1.94-1.68,2.88l-.38.62a2.14,2.14,0,0,0-.16,1.78.83.83,0,0,0,.86.59l.35,0,.16,0,2.72,0,2.37,0c0,.3,0,.59,0,.88v.61c0,.52-.17.68-.67.7h-.71l-.67,0h-.06a.88.88,0,0,0-.68.27,1,1,0,0,0-.21.78v.14a.93.93,0,0,0,.21.79.94.94,0,0,0,.73.29h8.82a.9.9,0,0,0,1-.92A1.37,1.37,0,0,0,25,25.33a1,1,0,0,0-.77-.31l-.28,0-.29,0-.35,0h-.16c-.29,0-.47-.11-.48-.53v-.7c0-.31,0-.63,0-.95h1.52a.93.93,0,0,0,.72-.29,1.14,1.14,0,0,0,.23-.9.27.27,0,0,1,0-.09,1,1,0,0,0-.24-.8.9.9,0,0,0-.7-.28H23.14l-.45,0c0-2.34,0-4.72,0-7V12.4a1.45,1.45,0,0,0-.15-.88l-.42-.75-.58.63,0,0a.85.85,0,0,0-.18.22A24.94,24.94,0,0,1,18,15.94a1.43,1.43,0,0,0-.39,1.12c0,.39,0,.78,0,1.17,0,.77,0,1.54,0,2.31H14.25a53.81,53.81,0,0,0,8.3-12.7l.56-1.16Z" style="fill:#f09000"/><path d="M35.22,50.18l-.61,0a5.15,5.15,0,0,1-3.9-2A5.56,5.56,0,0,1,30,43.51a9,9,0,0,1,8.49-6.46,6.71,6.71,0,0,1,2.39.42l0-29.24A4.33,4.33,0,0,1,41,7.17a1.61,1.61,0,0,1,1.62-1.35,1.65,1.65,0,0,1,1.64,1.35,6,6,0,0,1,.07,1.1q0,16.85,0,33.64a2.32,2.32,0,0,0,0,.24,1.8,1.8,0,0,1-.38,1.47,9.92,9.92,0,0,1-3.14,4.57,9.17,9.17,0,0,1-5.54,2Z" style="fill:#f5a623"/><path d="M42.57,6.54h.06a.89.89,0,0,1,.87.77,4.67,4.67,0,0,1,.06,1q0,16.8,0,33.61c0,.43.17.94-.26,1.3a9.38,9.38,0,0,1-3,4.4,8.52,8.52,0,0,1-5.12,1.85l-.55,0c-3.1-.22-4.75-2.62-4-5.76a8.32,8.32,0,0,1,7.79-5.91,5.91,5.91,0,0,1,3.11.84l0-30.21a5.65,5.65,0,0,1,0-1.09.89.89,0,0,1,.92-.77m0-1.44A2.34,2.34,0,0,0,40.24,7a5.8,5.8,0,0,0-.08,1.21V8.4q0,12.94,0,25.9v2.21a7.72,7.72,0,0,0-1.68-.18,9.79,9.79,0,0,0-9.19,7,6.25,6.25,0,0,0,.86,5.24,5.83,5.83,0,0,0,4.43,2.28c.22,0,.45,0,.66,0a9.83,9.83,0,0,0,6-2.14A10.57,10.57,0,0,0,44.54,44,2.57,2.57,0,0,0,45,42.08a1,1,0,0,1,0-.17q0-16.8,0-33.61A6.88,6.88,0,0,0,44.92,7,2.33,2.33,0,0,0,42.69,5.1Z" style="fill:#f09000"/></g></g></svg>',MICEPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 22</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><g id="g4536"><path id="path4725" d="M24.85,31a2.42,2.42,0,0,0-.35-1.06,3,3,0,0,0-2.11-.71c-1.11,0-2.07.88-3.17,1.06a6.23,6.23,0,0,1-2.11,0c-1.09-.18-2-1.06-3.16-1.06a3,3,0,0,0-2.11.71,2.9,2.9,0,0,0-.7,2.13c.4,1.43.07.52,0,1.42A10.68,10.68,0,0,0,9,34.91c-.94,1-1.76,3.19-2.11,3.54s-.3,2.87,0,4.26A8.64,8.64,0,0,0,9,46.41a7.73,7.73,0,0,0,3.69,2.43,6.37,6.37,0,0,0,2.67.26A10.24,10.24,0,0,0,19.22,48,6.59,6.59,0,0,0,21,46.26c.42-.54.49-1.39,1.06-1.77s1.68-.06,2.46-.36,1.8-.62,2.11-1.42-.5-1.88-.71-2.84a10.66,10.66,0,0,1-.35-1.77,20.5,20.5,0,0,1,.35-3.9,6.61,6.61,0,0,0,.35-1.78,2,2,0,0,0-.7-1.42c-.2-.12-.7,0-.7,0" style="fill:#92a9ff;stroke:#5370dc;stroke-width:0.4994235330523765px"/><path id="path4505-6" d="M22.3,44.24a15.24,15.24,0,0,1-2.67,3.4,7.67,7.67,0,0,1-4.42,1.62,6.56,6.56,0,0,1-3.46-.77,14.91,14.91,0,0,1-2.62-2,15.1,15.1,0,0,1-2-2.65,6.83,6.83,0,0,1-.77-3.48A8,8,0,0,1,8,35.91a15,15,0,0,1,3.37-2.69M18,35.81s-3.1.21-4.48-.46a4.17,4.17,0,0,1-2.11-2.13,3.71,3.71,0,0,1,.27-3.11A2.63,2.63,0,0,1,14.46,29c1.26.19,2.2,1,3.38,1.23,1.51.25,2.91-.88,4.44-.93a15.7,15.7,0,0,1,3.28.6,16.15,16.15,0,0,1,.59,3.31c0,1.54-1.17,2.95-.92,4.49.19,1.18,1.08,2.13,1.29,3.38A2.7,2.7,0,0,1,25.38,44a3.57,3.57,0,0,1-3.08.27,4.19,4.19,0,0,1-2.12-2.13c-.65-1.39-.45-4.52-.45-4.52" style="fill:none;stroke:#5370dc;stroke-linecap:round;stroke-width:0.9760086686920225px"/><g id="g4565"><g id="g4553"><path id="path3411-7" d="M21.08,31.94c-1.42-.84-2.07-3.88-2.16-4.84" style="fill:none;stroke:#5370dc;stroke-width:0.9649127798239797px"/><path id="path3413-5" d="M22.12,31.22a8.37,8.37,0,0,1-1.58-4" style="fill:none;stroke:#5370dc;stroke-width:0.9649127798239797px"/></g><g id="g4557"><path id="path3411-3" d="M23.57,34.45c.83,1.44,3.84,2.09,4.79,2.18" style="fill:none;stroke:#5370dc;stroke-width:0.9649127798239797px"/><path id="path3413-56" d="M24.28,33.4a8.17,8.17,0,0,0,4,1.59" style="fill:none;stroke:#5370dc;stroke-width:0.9649127798239797px"/></g></g><g id="g4636"><ellipse id="circle3409-2" cx="19.34" cy="33.63" rx="0.98" ry="0.94" transform="matrix(0.63, -0.78, 0.78, 0.63, -18.97, 27.52)" style="fill:none;stroke:#5370dc;stroke-width:0.9988469470329054px"/><ellipse id="ellipse4229-9" cx="21.86" cy="36.24" rx="0.98" ry="0.94" transform="translate(-20.06 30.44) rotate(-51.03)" style="fill:none;stroke:#5370dc;stroke-width:0.9988469470329054px"/></g><g id="g4632"><path id="path4303-1" d="M17.14,31.42c-6-4.17-7,3.59-.22,3.33" style="fill:none;stroke:#5370dc;stroke-width:0.4994235330523765px"/><path id="path4303-1-2" d="M24.09,38.43c4.12,6-3.57,7-3.3.22" style="fill:none;stroke:#5370dc;stroke-width:0.4994235330523765px"/></g><path id="path4227-7" d="M26.41,30.8c-.94,0-1.53.14-1.7,0s-.07-.83,0-1.72c0-.72,1.23-.45,1.71,0S27.15,30.82,26.41,30.8Z" style="fill:#92a9ff;stroke:#5370dc;stroke-width:1.080668001658815px"/><path id="path4653" d="M9.35,46.73S8.5,48.09,10,50s5.47,2.84,8.54,1.88S23.41,48.63,26,46.5" style="fill:none;stroke:#5370dc;stroke-linecap:round;stroke-width:0.9760086686920225px"/></g><g id="g4536-2" data-name="g4536"><path id="path4725-2" data-name="path4725" d="M31.15,25a2.42,2.42,0,0,0,.35,1.06,3,3,0,0,0,2.11.71c1.11,0,2.07-.88,3.17-1.06a6.23,6.23,0,0,1,2.11,0c1.09.18,2,1.06,3.16,1.06a3,3,0,0,0,2.11-.71,2.9,2.9,0,0,0,.7-2.13c-.4-1.43-.07-.52,0-1.42A10.68,10.68,0,0,0,47,21.09c.94-1,1.76-3.19,2.11-3.54s.3-2.87,0-4.26A8.64,8.64,0,0,0,47,9.59a7.73,7.73,0,0,0-3.69-2.43,6.37,6.37,0,0,0-2.67-.26A10.24,10.24,0,0,0,36.78,8,6.59,6.59,0,0,0,35,9.74c-.42.54-.49,1.39-1.06,1.77s-1.68.06-2.46.36-1.8.62-2.11,1.42.5,1.88.71,2.84a10.66,10.66,0,0,1,.35,1.77,20.5,20.5,0,0,1-.35,3.9,6.61,6.61,0,0,0-.35,1.78,2,2,0,0,0,.7,1.42c.2.12.7,0,.7,0" style="fill:#92a9ff;stroke:#5370dc;stroke-width:0.4994235330523765px"/><path id="path4505-6-2" data-name="path4505-6" d="M33.7,11.76a15.24,15.24,0,0,1,2.67-3.4,7.67,7.67,0,0,1,4.42-1.62,6.56,6.56,0,0,1,3.46.77,14.91,14.91,0,0,1,2.62,2,15.1,15.1,0,0,1,2,2.65,6.83,6.83,0,0,1,.77,3.48A8,8,0,0,1,48,20.09a15,15,0,0,1-3.37,2.69M38,20.19s3.1-.21,4.48.46a4.17,4.17,0,0,1,2.11,2.13,3.71,3.71,0,0,1-.27,3.11A2.63,2.63,0,0,1,41.54,27c-1.26-.19-2.2-1-3.38-1.23-1.51-.25-2.91.88-4.44.93a15.7,15.7,0,0,1-3.28-.6,16.15,16.15,0,0,1-.59-3.31c0-1.54,1.17-3,.92-4.49-.19-1.18-1.08-2.13-1.29-3.38A2.7,2.7,0,0,1,30.62,12a3.57,3.57,0,0,1,3.08-.27,4.19,4.19,0,0,1,2.12,2.13c.65,1.39.45,4.52.45,4.52" style="fill:none;stroke:#5370dc;stroke-linecap:round;stroke-width:0.9760086686920225px"/><g id="g4565-2" data-name="g4565"><g id="g4553-2" data-name="g4553"><path id="path3411-7-2" data-name="path3411-7" d="M34.92,24.06c1.42.84,2.07,3.88,2.16,4.84" style="fill:none;stroke:#5370dc;stroke-width:0.9649127798239797px"/><path id="path3413-5-2" data-name="path3413-5" d="M33.88,24.78a8.37,8.37,0,0,1,1.58,4" style="fill:none;stroke:#5370dc;stroke-width:0.9649127798239797px"/></g><g id="g4557-2" data-name="g4557"><path id="path3411-3-2" data-name="path3411-3" d="M32.43,21.55c-.83-1.44-3.84-2.09-4.79-2.18" style="fill:none;stroke:#5370dc;stroke-width:0.9649127798239797px"/><path id="path3413-56-2" data-name="path3413-56" d="M31.72,22.6a8.17,8.17,0,0,0-4-1.59" style="fill:none;stroke:#5370dc;stroke-width:0.9649127798239797px"/></g></g><g id="g4636-2" data-name="g4636"><ellipse id="circle3409-2-2" data-name="circle3409-2" cx="36.66" cy="22.37" rx="0.98" ry="0.94" transform="translate(-3.79 36.8) rotate(-51.03)" style="fill:none;stroke:#5370dc;stroke-width:0.9988469470329054px"/><ellipse id="ellipse4229-9-2" data-name="ellipse4229-9" cx="34.14" cy="19.76" rx="0.98" ry="0.94" transform="translate(-2.7 33.88) rotate(-51.03)" style="fill:none;stroke:#5370dc;stroke-width:0.9988469470329054px"/></g><g id="g4632-2" data-name="g4632"><path id="path4303-1-2-2" data-name="path4303-1" d="M38.86,24.58c6,4.17,7-3.59.22-3.33" style="fill:none;stroke:#5370dc;stroke-width:0.4994235330523765px"/><path id="path4303-1-2-3" data-name="path4303-1-2" d="M31.91,17.57c-4.12-6,3.57-7,3.3-.22" style="fill:none;stroke:#5370dc;stroke-width:0.4994235330523765px"/></g><path id="path4227-7-2" data-name="path4227-7" d="M29.59,25.2c.94,0,1.53-.14,1.7,0s.07.83,0,1.72c0,.72-1.23.45-1.71,0S28.85,25.18,29.59,25.2Z" style="fill:#92a9ff;stroke:#5370dc;stroke-width:1.080668001658815px"/><path id="path4653-2" data-name="path4653" d="M46.65,9.27S47.5,7.91,46,6s-5.47-2.84-8.54-1.88S32.59,7.37,30.05,9.5" style="fill:none;stroke:#5370dc;stroke-linecap:round;stroke-width:0.9760086686920225px"/></g></g></g></svg>',TURTLESPALETTEICON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg enable-background="new" width="50" height="50" viewBox="0 0 55.000001 55.000001" id="svg2" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><g transform="matrix(1.5,0,0,1.5,-28.371155,-2.5826034)"><g transform="matrix(0.23334524,0.23334524,-0.23334524,0.23334524,29.689002,14.856933)"> <path d="m 27.497,48.279 c -0.553,0 -1.099,-0.035 -1.637,-0.1 l 1.388,2.349 1.368,-2.313 c -0.371,0.03 -0.741,0.064 -1.119,0.064 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /><g> <path d="m 40.16,11.726 c -2.164,0 -3.958,1.555 -4.343,3.607 1.859,1.345 3.457,3.115 4.675,5.208 2.285,-0.172 4.094,-2.061 4.094,-4.39 0,-2.444 -1.982,-4.425 -4.426,-4.425 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /><path d="m 40.713,39.887 c -1.224,2.232 -2.86,4.131 -4.797,5.556 0.521,1.864 2.213,3.239 4.244,3.239 2.443,0 4.426,-1.98 4.426,-4.424 0,-2.255 -1.693,-4.096 -3.873,-4.371 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /><path d="m 14.273,39.871 c -2.253,0.206 -4.024,2.079 -4.024,4.387 0,2.443 1.98,4.424 4.424,4.424 2.064,0 3.784,-1.42 4.272,-3.332 -1.883,-1.416 -3.475,-3.289 -4.672,-5.479 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /><path d="m 19.026,15.437 c -0.343,-2.103 -2.154,-3.711 -4.353,-3.711 -2.444,0 -4.424,1.981 -4.424,4.424 0,2.382 1.886,4.31 4.245,4.406 1.186,-2.043 2.732,-3.784 4.532,-5.119 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /></g><path d="m 27.497,12.563 c 1.908,0 3.728,0.411 5.418,1.128 0.741,-1.076 1.178,-2.377 1.178,-3.783 0,-3.687 -2.989,-6.677 -6.677,-6.677 -3.687,0 -6.676,2.99 -6.676,6.677 0,1.428 0.452,2.749 1.216,3.834 1.724,-0.749 3.587,-1.179 5.541,-1.179 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /><g> <path d="m 43.102,30.421 c 0,4.7344 -1.6452,9.2798 -4.5706,12.6275 -2.9254,3.3478 -6.8973,5.2305 -11.0344,5.2305 -4.1371,0 -8.109,-1.8827 -11.0344,-5.2305 -2.9254,-3.3477 -4.5706,-7.8931 -4.5706,-12.6275 0,-9.7966 7.0444,-17.858 15.605,-17.858 8.5606,0 15.605,8.0614 15.605,17.858 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" id="path16" /></g><g> <path d="m 25.875,33.75 -1.542,-4.625 3.164,-2.587 3.615,2.626 -1.487,4.669 z" fill="#969cf2" stroke="none" stroke-width="3.5" /><path d="m 27.501,41.551 c -3.968,-0.16 -5.543,-2.009 -5.543,-2.009 l 3.57,-4.163 4.465,0.168 3.132,4.12 c 0,0 -2.89,1.994 -5.624,1.884 z" fill="#969cf2" stroke="none" /><path d="m 18.453,33.843 c -0.849,-2.968 0.172,-6.884 0.172,-6.884 l 4,2.167 1.493,4.629 -3.582,4.233 c 0,-10e-4 -1.465,-1.99 -2.083,-4.145 z" fill="#969cf2" stroke="none" /><path d="m 19.458,25.125 c 0,0 0.5,-1.958 3.039,-3.822 2.237,-1.643 4.465,-1.72 4.465,-1.72 l -0.037,4.981 -3.521,2.75 z" fill="#969cf2" stroke="none" /><path d="M 32.084,27.834 28.625,24.959 29,19.75 c 0,0 1.834,-0.042 3.959,1.667 2.228,1.791 3.362,4.983 3.362,4.983 z" fill="#969cf2" stroke="none" /><path d="m 31.292,34.042 1.313,-4.464 4.187,-1.536 c 0,0 0.677,2.663 -0.042,5.667 -0.54,2.256 -2.084,4.361 -2.084,4.361 z" fill="#969cf2" stroke="none" /></g></g><g transform="matrix(0.23334524,0.23334524,0.23334524,-0.23334524,32.010536,12.457869)"><path  d="m 27.497,48.279 c -0.553,0 -1.099,-0.035 -1.637,-0.1 l 1.388,2.349 1.368,-2.313 c -0.371,0.03 -0.741,0.064 -1.119,0.064 z"  fill="#726ee5"  stroke="#969cf2"  stroke-width="3.5"/><g> <path d="m 40.16,11.726 c -2.164,0 -3.958,1.555 -4.343,3.607 1.859,1.345 3.457,3.115 4.675,5.208 2.285,-0.172 4.094,-2.061 4.094,-4.39 0,-2.444 -1.982,-4.425 -4.426,-4.425 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /><path d="m 40.713,39.887 c -1.224,2.232 -2.86,4.131 -4.797,5.556 0.521,1.864 2.213,3.239 4.244,3.239 2.443,0 4.426,-1.98 4.426,-4.424 0,-2.255 -1.693,-4.096 -3.873,-4.371 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /><path d="m 14.273,39.871 c -2.253,0.206 -4.024,2.079 -4.024,4.387 0,2.443 1.98,4.424 4.424,4.424 2.064,0 3.784,-1.42 4.272,-3.332 -1.883,-1.416 -3.475,-3.289 -4.672,-5.479 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /><path d="m 19.026,15.437 c -0.343,-2.103 -2.154,-3.711 -4.353,-3.711 -2.444,0 -4.424,1.981 -4.424,4.424 0,2.382 1.886,4.31 4.245,4.406 1.186,-2.043 2.732,-3.784 4.532,-5.119 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /></g> <path d="m 27.497,12.563 c 1.908,0 3.728,0.411 5.418,1.128 0.741,-1.076 1.178,-2.377 1.178,-3.783 0,-3.687 -2.989,-6.677 -6.677,-6.677 -3.687,0 -6.676,2.99 -6.676,6.677 0,1.428 0.452,2.749 1.216,3.834 1.724,-0.749 3.587,-1.179 5.541,-1.179 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /><g> <path d="m 43.102,30.421 c 0,4.7344 -1.6452,9.2798 -4.5706,12.6275 -2.9254,3.3478 -6.8973,5.2305 -11.0344,5.2305 -4.1371,0 -8.109,-1.8827 -11.0344,-5.2305 -2.9254,-3.3477 -4.5706,-7.8931 -4.5706,-12.6275 0,-9.7966 7.0444,-17.858 15.605,-17.858 8.5606,0 15.605,8.0614 15.605,17.858 z" fill="#726ee5" stroke="#969cf2" stroke-width="3.5" /></g><g><path d="m 25.875,33.75 -1.542,-4.625 3.164,-2.587 3.615,2.626 -1.487,4.669 z" fill="#969cf2" stroke="none" stroke-width="3.5" /><path d="m 27.501,41.551 c -3.968,-0.16 -5.543,-2.009 -5.543,-2.009 l 3.57,-4.163 4.465,0.168 3.132,4.12 c 0,0 -2.89,1.994 -5.624,1.884 z" fill="#969cf2" stroke="none" /><path d="m 18.453,33.843 c -0.849,-2.968 0.172,-6.884 0.172,-6.884 l 4,2.167 1.493,4.629 -3.582,4.233 c 0,-10e-4 -1.465,-1.99 -2.083,-4.145 z" fill="#969cf2" stroke="none" /><path d="m 19.458,25.125 c 0,0 0.5,-1.958 3.039,-3.822 2.237,-1.643 4.465,-1.72 4.465,-1.72 l -0.037,4.981 -3.521,2.75 z" fill="#969cf2" stroke="none" /><path d="M 32.084,27.834 28.625,24.959 29,19.75 c 0,0 1.834,-0.042 3.959,1.667 2.228,1.791 3.362,4.983 3.362,4.983 z" fill="#969cf2" stroke="none" /><path d="m 31.292,34.042 1.313,-4.464 4.187,-1.536 c 0,0 0.677,2.663 -0.042,5.667 -0.54,2.256 -2.084,4.361 -2.084,4.361 z" fill="#969cf2" stroke="none" /></g></g></g></svg>',COLLAPSEBUTTON='<svg width="42" height="42" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 42"><title>アセット 29</title><g style="isolation:isolate"><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="42" height="42" rx="5" ry="5" style="fill:#292929;opacity:0.4;mix-blend-mode:multiply"/><path d="M30.56,29.8l-4.17-4.16h2.26a1,1,0,1,0,0-2.07H23.94a1.08,1.08,0,0,0-1.11,1v0s0,0,0,.06v4.64h0a1,1,0,1,0,2.08,0V27.08l4.19,4.19a1,1,0,0,0,1.46,0A1,1,0,0,0,30.56,29.8Z" style="fill:#fff"/><path d="M19.17,24.6a1.08,1.08,0,0,0-1.11-1H13.35a1,1,0,1,0,0,2.07H15.6L11.44,29.8a1,1,0,0,0,1.47,1.47l4.18-4.19v2.26a1,1,0,1,0,2.08,0V24.7s0,0,0-.06A.08.08,0,0,1,19.17,24.6Z" style="fill:#fff"/><path d="M23.94,20.5h4.7a1,1,0,1,0,0-2.08H26.39l4.17-4.16a1,1,0,0,0,0-1.47,1,1,0,0,0-1.46,0L24.91,17V14.72a1,1,0,1,0-2.08,0v4.64a.43.43,0,0,0,0,.05v.05A1.09,1.09,0,0,0,23.94,20.5Z" style="fill:#fff"/><path d="M18.13,13.62a1.08,1.08,0,0,0-1,1.09V17l-4.18-4.19a1,1,0,0,0-1.47,0,1,1,0,0,0,0,1.46l4.16,4.17H13.35a1,1,0,1,0,0,2.08h4.71a1.09,1.09,0,0,0,1.11-1,.08.08,0,0,1,0,0s0,0,0-.06V14.71A1.07,1.07,0,0,0,18.13,13.62Z" style="fill:#fff"/></g></g></g></svg>',EXPANDBUTTON='<svg width="42" height="42" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 42"><title>アセット 28</title><g style="isolation:isolate"><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="42" height="42" rx="5" ry="5" style="fill:#292929;opacity:0.4;mix-blend-mode:multiply"/><path d="M30.86,25.8h0a1.06,1.06,0,0,0-1-1.1,1.08,1.08,0,0,0-1,1.1v2.26L24.6,23.87a1,1,0,0,0-1.46,0,1,1,0,0,0,0,1.47L27.3,29.5H25.05a1,1,0,1,0,0,2.08h4.71a1.07,1.07,0,0,0,1.1-1V25.8Z" style="fill:#fff"/><path d="M17.4,23.87l-4.19,4.19V25.8a1.08,1.08,0,0,0-1-1.1,1.06,1.06,0,0,0-1,1.1v4.74a1.07,1.07,0,0,0,1.1,1H17a1,1,0,1,0,0-2.08H14.7l4.16-4.16a1,1,0,0,0,0-1.47A1,1,0,0,0,17.4,23.87Z" style="fill:#fff"/><path d="M24.6,20.19,28.79,16v2.27a1.08,1.08,0,0,0,1,1.09,1.06,1.06,0,0,0,1-1.09V13.52a1.06,1.06,0,0,0-1.1-1H25.05a1,1,0,1,0,0,2.07H27.3l-4.16,4.17a1,1,0,0,0,1.46,1.46Z" style="fill:#fff"/><path d="M14.7,14.56H17a1,1,0,1,0,0-2.07H12.24a1.06,1.06,0,0,0-1.1,1v4.75a1.06,1.06,0,0,0,1,1.09,1.08,1.08,0,0,0,1-1.09V16l4.19,4.18a1,1,0,0,0,1.46-1.46Z" style="fill:#fff"/></g></g></g></svg>',MOUSEPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 20</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><g id="g4536"><path id="path4725" d="M26.85,12.59a3.36,3.36,0,0,0-1.41-.71,4.25,4.25,0,0,0-2.81,1.43c-1.12,1.14-1.2,3-2.12,4.31a9.36,9.36,0,0,1-2.11,2.15c-1.28.94-3.11,1-4.23,2.15a4.43,4.43,0,0,0-1.41,2.88,4.15,4.15,0,0,0,1.41,2.87c1.83,1,.59.46,1.41,1.43a16,16,0,0,0-.7,3.59c0,2,1.41,5,1.41,5.74s2.55,3.21,4.22,4.31a11.88,11.88,0,0,0,5.75,1.62A10.76,10.76,0,0,0,32.37,43a8.93,8.93,0,0,0,2.94-2.45,15.15,15.15,0,0,0,2.81-5,9.42,9.42,0,0,0,0-3.59c-.11-1-.89-1.9-.7-2.87.23-1.17,1.63-1.78,2.11-2.87s1.19-2.47.71-3.59-2.37-1.4-3.53-2.15a15.11,15.11,0,0,1-2.11-1.44,29.21,29.21,0,0,1-3.52-4.3c-.51-.69-.74-1.63-1.41-2.16a2.67,2.67,0,0,0-2.11-.71c-.33.07-.71.71-.71.71" style="fill:#92a9ff;stroke:#5370dc;stroke-width:0.7110743593067895px"/><path id="path4505-6" d="M37.43,28.59s1,4.12.71,6.16a11.4,11.4,0,0,1-2.82,6.16,9.37,9.37,0,0,1-4.23,2.74,21.07,21.07,0,0,1-4.59.68,21,21,0,0,1-4.59-.68,9.37,9.37,0,0,1-4.23-2.74,11.33,11.33,0,0,1-2.82-6.16c-.33-2,.7-6.16.7-6.16m9.17-4.11s-2.9,3.38-4.94,4.11a5.83,5.83,0,0,1-4.23,0,5.23,5.23,0,0,1-2.82-3.43,3.82,3.82,0,0,1,1.74-4c1.46-1.1,3.24-1.2,4.61-2.2,1.77-1.29,2.05-3.87,3.52-5.47a23.17,23.17,0,0,1,3.89-2.74,22.8,22.8,0,0,1,3.88,2.74c1.48,1.6,1.76,4.18,3.53,5.47,1.37,1,3.2,1.06,4.65,2.1a3.9,3.9,0,0,1,1.7,4.06,5.22,5.22,0,0,1-2.83,3.43,5.82,5.82,0,0,1-4.23,0c-2-.73-4.93-4.11-4.93-4.11" style="fill:none;stroke:#5370dc;stroke-linecap:round;stroke-width:1.389631630945327px"/><g id="g4565"><g id="g4553"><path id="path3411-7" d="M24,17.39c-2.25.61-5.92-1.81-7-2.69" style="fill:none;stroke:#5370dc;stroke-width:1.37383341250824px"/><path id="path3413-5" d="M24.33,15.6a11.44,11.44,0,0,1-5.55-2.44" style="fill:none;stroke:#5370dc;stroke-width:1.37383341250824px"/></g><g id="g4557"><path id="path3411-3" d="M29,17.39c2.25.61,5.92-1.81,7-2.69" style="fill:none;stroke:#5370dc;stroke-width:1.37383341250824px"/><path id="path3413-56" d="M28.67,15.6a11.48,11.48,0,0,0,5.55-2.44" style="fill:none;stroke:#5370dc;stroke-width:1.37383341250824px"/></g></g><g id="g4636"><ellipse id="circle3409-2" cx="23.94" cy="20.88" rx="1.33" ry="1.41" style="fill:none;stroke:#5370dc;stroke-width:1.4221485490802457px"/><ellipse id="ellipse4229-9" cx="29.05" cy="20.94" rx="1.33" ry="1.41" style="fill:none;stroke:#5370dc;stroke-width:1.4221485490802457px"/></g><g id="g4632"><path id="path4303-1" d="M19.53,20.89c-10.11,1.88-3.39,10.72,3.09,3.59" style="fill:none;stroke:#5370dc;stroke-width:0.7110743593067895px"/><path id="path4303-1-2" d="M33.46,20.89c10.12,1.88,3.39,10.72-3.08,3.59" style="fill:none;stroke:#5370dc;stroke-width:0.7110743593067895px"/></g><path id="path4227-7" d="M28.22,10.79c-1,.94-1.4,1.71-1.73,1.71s-.9-.77-1.74-1.71c-.68-.77.78-1.71,1.74-1.71S29,10.06,28.22,10.79Z" style="fill:#92a9ff;stroke:#5370dc;stroke-width:1.5386445692824375px"/><path id="path4653" d="M26.93,44.33s.51,2.24,3.88,2.63,8.3-2.71,10.41-6.82,1.7-8.25,2.12-13" style="fill:none;stroke:#5370dc;stroke-linecap:round;stroke-width:1.389631630945327px"/></g></g></g></svg>',TURTLEPALETTEICON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" enable-background="new" width="50" height="50" viewBox="0 0 55.000001 55.000001" id="svg2" version="1.1"> <g> <path d="M 27.497 48.279 C 26.944 48.279 26.398 48.244 25.86 48.179 L 27.248 50.528 L 28.616 48.215 C 28.245 48.245 27.875 48.279 27.497 48.279 Z " fill="#726ee5" stroke="#969cf2" stroke-width="3.5"/> <g> <path d="M 40.16 11.726 C 37.996 11.726 36.202 13.281 35.817 15.333 C 37.676 16.678 39.274 18.448 40.492 20.541 C 42.777 20.369 44.586 18.48 44.586 16.151 C 44.586 13.707 42.604 11.726 40.16 11.726 Z " fill="#726ee5" stroke="#969cf2" stroke-width="3.5"/> <path d="M 40.713 39.887 C 39.489 42.119 37.853 44.018 35.916 45.443 C 36.437 47.307 38.129 48.682 40.16 48.682 C 42.603 48.682 44.586 46.702 44.586 44.258 C 44.586 42.003 42.893 40.162 40.713 39.887 Z " fill="#726ee5" stroke="#969cf2" stroke-width="3.5"/> <path d="M 14.273 39.871 C 12.02 40.077 10.249 41.95 10.249 44.258 C 10.249 46.701 12.229 48.682 14.673 48.682 C 16.737 48.682 18.457 47.262 18.945 45.35 C 17.062 43.934 15.47 42.061 14.273 39.871 Z " fill="#726ee5" stroke="#969cf2" stroke-width="3.5"/> <path d="M 19.026 15.437 C 18.683 13.334 16.872 11.726 14.673 11.726 C 12.229 11.726 10.249 13.707 10.249 16.15 C 10.249 18.532 12.135 20.46 14.494 20.556 C 15.68 18.513 17.226 16.772 19.026 15.437 Z " fill="#726ee5" stroke="#969cf2" stroke-width="3.5"/> </g> <path d="M 27.497 12.563 C 29.405 12.563 31.225 12.974 32.915 13.691 C 33.656 12.615 34.093 11.314 34.093 9.908 C 34.093 6.221 31.104 3.231 27.416 3.231 C 23.729 3.231 20.74 6.221 20.74 9.908 C 20.74 11.336 21.192 12.657 21.956 13.742 C 23.68 12.993 25.543 12.563 27.497 12.563 Z " fill="#726ee5" stroke="#969cf2" stroke-width="3.5"/> <g> <path d="M 43.102 30.421 C 43.102 35.1554 41.4568 39.7008 38.5314 43.0485 C 35.606 46.3963 31.6341 48.279 27.497 48.279 C 23.3599 48.279 19.388 46.3963 16.4626 43.0485 C 13.5372 39.7008 11.892 35.1554 11.892 30.421 C 11.892 20.6244 18.9364 12.563 27.497 12.563 C 36.0576 12.563 43.102 20.6244 43.102 30.421 Z " fill="#726ee5" stroke="#969cf2" stroke-width="3.5"/> </g> <g> <path d="M 25.875 33.75 L 24.333 29.125 L 27.497 26.538 L 31.112 29.164 L 29.625 33.833 Z " fill="#969cf2" stroke="none" stroke-width="3.5"/> <path d="M 27.501 41.551 C 23.533 41.391 21.958 39.542 21.958 39.542 L 25.528 35.379 L 29.993 35.547 L 33.125 39.667 C 33.125 39.667 30.235 41.661 27.501 41.551 Z " fill="#969cf2" stroke="none" /> <path d="M 18.453 33.843 C 17.604 30.875 18.625 26.959 18.625 26.959 L 22.625 29.126 L 24.118 33.755 L 20.536 37.988 C 20.536 37.987 19.071 35.998 18.453 33.843 Z " fill="#969cf2" stroke="none" /> <path d="M 19.458 25.125 C 19.458 25.125 19.958 23.167 22.497 21.303 C 24.734 19.66 26.962 19.583 26.962 19.583 L 26.925 24.564 L 23.404 27.314 L 19.458 25.125 Z " fill="#969cf2" stroke="none" /> <path d="M 32.084 27.834 L 28.625 24.959 L 29 19.75 C 29 19.75 30.834 19.708 32.959 21.417 C 35.187 23.208 36.321 26.4 36.321 26.4 L 32.084 27.834 Z " fill="#969cf2" stroke="none" /> <path d="M 31.292 34.042 L 32.605 29.578 L 36.792 28.042 C 36.792 28.042 37.469 30.705 36.75 33.709 C 36.21 35.965 34.666 38.07 34.666 38.07 L 31.292 34.042 Z " fill="#969cf2" stroke="none" /> </g> </g> </svg>',NOGRIDBUTTON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 42"><title>アセット 32</title><g style="isolation:isolate"><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="42" height="42" rx="5" ry="5" style="fill:#292929;opacity:0.4;mix-blend-mode:multiply"/><path d="M31.73,21a10.36,10.36,0,0,1-5.36,9,11,11,0,0,1-10.74,0,10.27,10.27,0,0,1,0-18,11,11,0,0,1,10.74,0A10.36,10.36,0,0,1,31.73,21Z" style="fill:none;stroke:#d8d8d8;stroke-linecap:square;stroke-miterlimit:10;stroke-width:1.36741304397583px"/><line x1="21" y1="8.37" x2="21" y2="33.63" style="fill:none;stroke:#d8d8d8;stroke-linecap:square;stroke-miterlimit:10;stroke-width:1.36741304397583px"/><line x1="33.63" y1="21" x2="8.37" y2="21" style="fill:none;stroke:#d8d8d8;stroke-linecap:square;stroke-miterlimit:10;stroke-width:1.36741304397583px"/><rect x="10.98" y="10.98" width="20.04" height="20.04" style="fill:none;stroke:#d8d8d8;stroke-linecap:square;stroke-miterlimit:10;stroke-width:1.36741304397583px"/></g></g></g></svg>',NUMBERPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 14</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M13.19,37.65a1,1,0,0,1-1-1V24.36l-1.87.39-.2,0a1,1,0,0,1-1-.8L9,22.65a1,1,0,0,1,.29-.9l4.21-3.4H15.6a1,1,0,0,1,1,1V36.64a1,1,0,0,1-1,1Z" style="fill:#ff6ea1"/><path d="M15.6,18.85a.52.52,0,0,1,.51.51V36.64a.52.52,0,0,1-.51.51H13.19a.52.52,0,0,1-.53-.51V23.75l-2.47.51h-.1a.45.45,0,0,1-.46-.36l-.17-1.32a.53.53,0,0,1,.14-.48l4-3.26h2m0-1H13.29l-.28.22L9,21.33l0,0,0,0a1.54,1.54,0,0,0-.44,1.34L8.64,24a1.44,1.44,0,0,0,1.45,1.23,1.63,1.63,0,0,0,.31,0L11.66,25V36.64a1.53,1.53,0,0,0,1.53,1.51H15.6a1.52,1.52,0,0,0,1.51-1.51V19.36a1.52,1.52,0,0,0-1.51-1.51Z" style="fill:#ff2c76"/><path d="M20.12,37.65a1,1,0,0,1-1-1v-.81l.12-.14c1.82-2.11,5.33-6.5,7.25-8.94a4.6,4.6,0,0,0,1.32-2.68c0-1-.76-1.95-2.47-1.95a4.17,4.17,0,0,0-2.78,1.44,1,1,0,0,1-1.47,0l-1.34-1.29a1,1,0,0,1,0-1.4,8.27,8.27,0,0,1,5.89-2.8c4,0,6.76,2.41,6.76,5.86,0,1.93-.87,3.13-2,4.65-1,1.36-2.57,3.26-4,4.95l-.19.23h5a1,1,0,0,1,1,1v1.86a1,1,0,0,1-1,1Z" style="fill:#ff6ea1"/><path d="M25.56,18.58c4,0,6.26,2.45,6.26,5.36,0,1.75-.79,2.85-1.88,4.36s-3.34,4.17-4.83,6h6.06a.55.55,0,0,1,.54.51v1.86a.55.55,0,0,1-.54.51h-11a.52.52,0,0,1-.53-.51V36c1.85-2.15,5.38-6.57,7.26-9a5,5,0,0,0,1.43-3c0-1.21-1-2.45-3-2.45a4.65,4.65,0,0,0-3.14,1.59.53.53,0,0,1-.76,0l-1.35-1.29a.52.52,0,0,1,0-.7,7.83,7.83,0,0,1,5.52-2.64m0-1a8.84,8.84,0,0,0-6.29,3,1.51,1.51,0,0,0,.1,2.06l1.35,1.29a1.5,1.5,0,0,0,1.07.44,1.51,1.51,0,0,0,1.07-.44,3.86,3.86,0,0,1,2.45-1.31c1.46,0,2,.78,2,1.45a4.13,4.13,0,0,1-1.19,2.34c-1.93,2.46-5.44,6.84-7.26,9l-.24.28v1a1.53,1.53,0,0,0,1.53,1.51H31.17a1.55,1.55,0,0,0,1.54-1.51V34.78a1.55,1.55,0,0,0-1.54-1.51H27.24c1.27-1.53,2.62-3.17,3.5-4.38,1.12-1.54,2.08-2.86,2.08-4.95,0-3.74-3-6.36-7.26-6.36Z" style="fill:#ff2c76"/><path d="M40.1,37.92a8,8,0,0,1-6.21-2.57,1,1,0,0,1,0-1.33l1.46-1.36a1.07,1.07,0,0,1,.71-.29,1,1,0,0,1,.7.3A5.59,5.59,0,0,0,39.9,34a2.32,2.32,0,0,0,2.47-2c0-1.05-1-2.17-3.37-2.17H37.43a1,1,0,0,1-1-1V27.06a1,1,0,0,1,1-1H39c1.84,0,3-.76,3-2a2.1,2.1,0,0,0-2.22-2,3.19,3.19,0,0,0-2.46,1.12,1,1,0,0,1-.76.35,1.12,1.12,0,0,1-.7-.27L34.46,22a.87.87,0,0,1-.32-.68,1,1,0,0,1,.31-.75,8.18,8.18,0,0,1,5.62-2.51c3.75,0,6.47,2.28,6.47,5.43a5.25,5.25,0,0,1-2.39,4.21,5.28,5.28,0,0,1,2.9,4.45C47.05,35.55,44.19,37.92,40.1,37.92Z" style="fill:#ff6ea1"/><path d="M40.07,18.58c3.25,0,6,1.91,6,4.93a4.87,4.87,0,0,1-2.89,4.19v.08c1.32.54,3.4,2,3.4,4.39,0,3-2.58,5.25-6.45,5.25A7.37,7.37,0,0,1,34.26,35a.51.51,0,0,1,0-.67L35.72,33a.57.57,0,0,1,.37-.16.5.5,0,0,1,.36.16,6,6,0,0,0,3.45,1.45,2.79,2.79,0,0,0,3-2.52c0-1.4-1.34-2.67-3.87-2.67H37.43a.51.51,0,0,1-.53-.54V27.06a.48.48,0,0,1,.53-.54H39c2.3,0,3.48-1.1,3.48-2.48a2.57,2.57,0,0,0-2.72-2.47,3.66,3.66,0,0,0-2.83,1.29.55.55,0,0,1-.39.18.59.59,0,0,1-.37-.15l-1.38-1.24a.48.48,0,0,1,0-.7,7.8,7.8,0,0,1,5.28-2.37m0-1a8.8,8.8,0,0,0-6,2.67,1.5,1.5,0,0,0-.43,1.11,1.42,1.42,0,0,0,.51,1.05l1.35,1.22a1.59,1.59,0,0,0,1,.41,1.53,1.53,0,0,0,1.12-.51,2.73,2.73,0,0,1,2.1-1A1.59,1.59,0,0,1,41.48,24c0,1.09-1.28,1.48-2.48,1.48H37.43a1.48,1.48,0,0,0-1.53,1.54v1.69a1.51,1.51,0,0,0,1.53,1.54H39c1.69,0,2.87.69,2.87,1.67s-1,1.52-2,1.52a5.08,5.08,0,0,1-2.71-1.12l0,0a1.51,1.51,0,0,0-1-.44,1.57,1.57,0,0,0-1,.4l-1.46,1.35,0,0,0,0a1.5,1.5,0,0,0,0,2,8.48,8.48,0,0,0,6.58,2.73c4.38,0,7.45-2.57,7.45-6.25A5.56,5.56,0,0,0,45,27.68a5.58,5.58,0,0,0,2-4.17c0-3.44-2.93-5.93-7-5.93Z" style="fill:#ff2c76"/></g></g></svg>',PENPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 21</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M39.58,9.75,11.52,37.53a1.94,1.94,0,0,0-.5.85L9,45.6a1,1,0,0,0,1.18,1.17l7.29-2a1.81,1.81,0,0,0,.86-.49L46.43,16.53a1.9,1.9,0,0,0,0-2.71L42.32,9.75A2,2,0,0,0,39.58,9.75Z" style="fill:#92a9ff;stroke:#5370dc;stroke-width:1.399999976158142px"/><line x1="36.16" y1="12.81" x2="43.35" y2="19.92" style="fill:#92a9ff;stroke:#5370dc;stroke-width:1.399999976158142px"/></g></g></svg>',PITCHPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 3</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#dfdfdf;opacity:0"/><rect x="8" y="43.16" width="40" height="1.17" style="fill:#57ad02"/><rect x="8" y="36.28" width="40" height="1.17" style="fill:#57ad02"/><rect x="8" y="29.41" width="40" height="1.17" style="fill:#57ad02"/><rect x="8" y="22.54" width="40" height="1.17" style="fill:#57ad02"/><rect x="8" y="15.66" width="40" height="1.17" style="fill:#57ad02"/><path d="M12.77,44h-.36a3.16,3.16,0,0,1-2.36-1.22,3.45,3.45,0,0,1-.48-2.88,5.31,5.31,0,0,1,5-3.87,4.17,4.17,0,0,1,1,.12l0-16a3.58,3.58,0,0,1,0-.75,1.19,1.19,0,0,1,1.2-1,1.21,1.21,0,0,1,1.2,1,3.6,3.6,0,0,1,0,.66V39.2a1.3,1.3,0,0,1-.24,1A5.9,5.9,0,0,1,16,42.86,5.33,5.33,0,0,1,12.77,44Z" style="fill:#7cd622"/><path d="M16.82,19.17h0a.49.49,0,0,1,.48.44,3.44,3.44,0,0,1,0,.56V39.09c0,.24.09.53-.14.73a5.35,5.35,0,0,1-1.63,2.48,4.67,4.67,0,0,1-2.82,1h-.31a2.43,2.43,0,0,1-2.21-3.25,4.6,4.6,0,0,1,4.3-3.32,3.24,3.24,0,0,1,1.71.47q0-8.5,0-17a3.12,3.12,0,0,1,0-.61.49.49,0,0,1,.51-.44m0-1.4a1.9,1.9,0,0,0-1.89,1.56,3.93,3.93,0,0,0,0,.8V35.37h-.31a6,6,0,0,0-5.66,4.41,4.16,4.16,0,0,0,.59,3.45,3.85,3.85,0,0,0,2.87,1.51h.42a6,6,0,0,0,3.66-1.32,6.5,6.5,0,0,0,2-2.87,2.1,2.1,0,0,0,.32-1.41v-19a4,4,0,0,0-.06-.82,1.91,1.91,0,0,0-1.79-1.58h-.09Z" style="fill:#57ad02"/><path d="M26.1,40.78h-.36a3.13,3.13,0,0,1-2.36-1.22,3.48,3.48,0,0,1-.48-2.88,5.33,5.33,0,0,1,5-3.87,3.8,3.8,0,0,1,1,.13V17a4.41,4.41,0,0,1,0-.75,1.19,1.19,0,0,1,1.2-1,1.2,1.2,0,0,1,1.2,1,3.71,3.71,0,0,1,0,.67c0,6.33,0,12.63,0,18.94v.11a1.3,1.3,0,0,1-.25,1,5.75,5.75,0,0,1-1.81,2.66,5.27,5.27,0,0,1-3.24,1.18Z" style="fill:#7cd622"/><path d="M30.15,15.92h0a.48.48,0,0,1,.48.43,2.59,2.59,0,0,1,0,.56q0,9.47,0,18.92c0,.25.1.53-.14.73A5.3,5.3,0,0,1,28.92,39a4.61,4.61,0,0,1-2.82,1h-.31a2.41,2.41,0,0,1-2.2-3.24,4.61,4.61,0,0,1,4.29-3.33A3.22,3.22,0,0,1,29.6,34q0-8.5,0-17a3.12,3.12,0,0,1,0-.61.5.5,0,0,1,.51-.43m0-1.4a1.87,1.87,0,0,0-1.88,1.56,3.88,3.88,0,0,0-.06.79V32.11h-.32a6,6,0,0,0-5.66,4.41A4.15,4.15,0,0,0,22.81,40a3.82,3.82,0,0,0,2.88,1.51h.41a6,6,0,0,0,3.66-1.32,6.35,6.35,0,0,0,2-2.87,2.12,2.12,0,0,0,.33-1.41v-.06q0-9.45,0-18.91a4.06,4.06,0,0,0-.06-.82,1.89,1.89,0,0,0-1.8-1.57h-.09Z" style="fill:#57ad02"/><path d="M39.43,37.53l-.36,0a3.13,3.13,0,0,1-2.36-1.22,3.44,3.44,0,0,1-.47-2.88,5.32,5.32,0,0,1,5-3.87,4.17,4.17,0,0,1,1,.13V13.61a3,3,0,0,1,0-.65,1.18,1.18,0,0,1,1.19-1,1.2,1.2,0,0,1,1.2,1,3.78,3.78,0,0,1,0,.67q0,9.49,0,18.94v.11a1.37,1.37,0,0,1-.24,1,5.88,5.88,0,0,1-1.82,2.65,5.26,5.26,0,0,1-3.24,1.19Z" style="fill:#7cd622"/><path d="M43.48,12.66h0a.5.5,0,0,1,.49.43,3.44,3.44,0,0,1,0,.56q0,9.47,0,18.92c0,.25.1.53-.13.74a5.36,5.36,0,0,1-1.64,2.47,4.59,4.59,0,0,1-2.82,1h-.31a2.42,2.42,0,0,1-2.2-3.25,4.61,4.61,0,0,1,4.3-3.33,3.21,3.21,0,0,1,1.71.48q0-8.5,0-17a3.18,3.18,0,0,1,0-.62.5.5,0,0,1,.51-.43m0-1.4a1.89,1.89,0,0,0-1.88,1.56,4,4,0,0,0-.06.79V28.85h-.31a6,6,0,0,0-5.66,4.41,4.11,4.11,0,0,0,.59,3.46A3.84,3.84,0,0,0,39,38.21l.41,0a6,6,0,0,0,3.66-1.33,6.35,6.35,0,0,0,2-2.87,2,2,0,0,0,.33-1.4v-.07q0-9.44,0-18.91a4.11,4.11,0,0,0-.06-.82,1.89,1.89,0,0,0-1.8-1.57h-.09Z" style="fill:#57ad02"/></g></g></svg>',PLAYBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="55" height="55" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg10" version="1.1" viewBox="0 0 28 28"> <title id="title2">アセット 23</title> <circle id="circle4" style="fill:#ffffff;stroke-width:0.9285714" r="13" cy="14" cx="14" /> <path id="path6" style="fill:#0050a0" d="M 18.9,13.56 11.65,9 A 1,1 0 0 0 10.09,9.86 V 19 a 1,1 0 0 0 1.56,0.86 l 7.25,-4.54 a 1,1 0 0 0 0,-1.76 z" /> </svg>',POLARBUTTON='<svg width="42" height="42" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 42"><title>アセット 31</title><g style="isolation:isolate"><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="42" height="42" rx="5" ry="5" style="fill:#292929;opacity:0.4;mix-blend-mode:multiply"/><path d="M31.73,21a10.36,10.36,0,0,1-5.36,9,11,11,0,0,1-10.74,0,10.27,10.27,0,0,1,0-18,11,11,0,0,1,10.74,0A10.36,10.36,0,0,1,31.73,21Z" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:1.6257020235061646px"/><line x1="21" y1="8.37" x2="21" y2="33.63" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:1.6257020235061646px"/><line x1="33.63" y1="21" x2="8.37" y2="21" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:1.6257020235061646px"/><rect x="10.98" y="10.98" width="20.04" height="20.04" style="fill:none;stroke:#d8d8d8;stroke-linecap:square;stroke-miterlimit:10;stroke-width:1.36741304397583px"/></g></g></g></svg>',RHYTHMPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 1</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M7.24,42.72a4.17,4.17,0,0,1-.61,0A3.47,3.47,0,0,1,4,41a3.77,3.77,0,0,1-.14-3.37A6.37,6.37,0,0,1,9.49,34,4.6,4.6,0,0,1,11,34.2V14.88a2.68,2.68,0,0,1,.1-.78,1.07,1.07,0,0,1,1.05-.82h0a1.16,1.16,0,0,1,1.14.75,2.1,2.1,0,0,1,.13.85V37.16A1.82,1.82,0,0,1,13,38.58a6.21,6.21,0,0,1-5.75,4.14ZM10,35.66A6.48,6.48,0,0,0,5.67,39.9a.67.67,0,0,0,.12.56.8.8,0,0,0,.61.35l.12,0a6.18,6.18,0,0,0,4.13-3.59,5.85,5.85,0,0,0,.22-.56l0-.13A1,1,0,0,0,10.6,36a1,1,0,0,0-.58-.33Z" style="fill:#f5a623"/><path d="M12.18,13.78a.67.67,0,0,1,.65.44,2,2,0,0,1,.08.72V37.16c0,.42,0,.85-.37,1.14a5.65,5.65,0,0,1-5.3,3.92,5.09,5.09,0,0,1-.55,0,3,3,0,0,1-2.4-4.33,5.82,5.82,0,0,1,5.2-3.39,3.75,3.75,0,0,1,1.83.44.54.54,0,0,0,.19,0v-20a2.73,2.73,0,0,1,.07-.64.6.6,0,0,1,.58-.46h0M6.4,41.31a1.07,1.07,0,0,0,.25,0,6.75,6.75,0,0,0,4.46-3.86,7.5,7.5,0,0,0,.31-.84A1.67,1.67,0,0,0,10,35.15a.45.45,0,0,0-.2,0,7,7,0,0,0-4.63,4.56A1.29,1.29,0,0,0,6.4,41.31m5.78-28.54h0A1.58,1.58,0,0,0,10.61,14a3.2,3.2,0,0,0-.11.91V33.54a5.5,5.5,0,0,0-1-.09,6.8,6.8,0,0,0-6.14,4,4.31,4.31,0,0,0,.18,3.82,3.94,3.94,0,0,0,3,1.89,5,5,0,0,0,.67,0,6.66,6.66,0,0,0,6.19-4.39,2.33,2.33,0,0,0,.49-1.63V14.88a2.66,2.66,0,0,0-.16-1,1.66,1.66,0,0,0-1.58-1.07ZM6.39,40.3a.24.24,0,0,1-.15-.09.32.32,0,0,1-.09-.16,6,6,0,0,1,3.9-3.87,1.29,1.29,0,0,1,.33.33c-.06.17-.12.33-.19.48a5.7,5.7,0,0,1-3.8,3.31Z" style="fill:#f09000"/><path d="M33.56,42.54h-.4a3.33,3.33,0,0,1-2.52-1.3,3.67,3.67,0,0,1-.5-3.07,5.86,5.86,0,0,1,5.49-4.23,4.57,4.57,0,0,1,1.49.25v-19a3.35,3.35,0,0,1,0-.69,1.11,1.11,0,0,1,2.18,0,3.54,3.54,0,0,1,0,.71c0,7.32,0,14.6,0,21.89,0,0,0,.1,0,.15a1.2,1.2,0,0,1-.25,1,6.44,6.44,0,0,1-2,3,5.87,5.87,0,0,1-3.58,1.3Z" style="fill:#f5a623"/><path d="M38.27,14.12h0a.57.57,0,0,1,.56.5,3.44,3.44,0,0,1,0,.64V37.13c0,.28.11.61-.17.84a6.13,6.13,0,0,1-1.89,2.86A5.4,5.4,0,0,1,33.55,42H33.2c-2-.15-3-1.71-2.57-3.75a5.36,5.36,0,0,1,5-3.84,3.71,3.71,0,0,1,2,.55q0-9.83,0-19.65a4.18,4.18,0,0,1,0-.71.58.58,0,0,1,.6-.51m0-1a1.59,1.59,0,0,0-1.59,1.31,4.58,4.58,0,0,0,0,.79v18.3a5.18,5.18,0,0,0-1-.09,6.37,6.37,0,0,0-6,4.62,4.17,4.17,0,0,0,.58,3.48A3.83,3.83,0,0,0,33.12,43l.43,0a6.36,6.36,0,0,0,3.89-1.41,6.88,6.88,0,0,0,2.16-3.12,1.74,1.74,0,0,0,.31-1.28v-22a4,4,0,0,0-.06-.83,1.55,1.55,0,0,0-1.51-1.32h-.07Z" style="fill:#f09000"/><path d="M46.64,42.54h-.4a3.33,3.33,0,0,1-2.52-1.3,3.7,3.7,0,0,1-.5-3.07,5.86,5.86,0,0,1,5.49-4.23,4.52,4.52,0,0,1,1.49.25l0-19a3.31,3.31,0,0,1,0-.69,1.11,1.11,0,0,1,2.18,0,3.54,3.54,0,0,1,.05.71c0,7.32,0,14.6,0,21.89,0,0,0,.1,0,.15a1.19,1.19,0,0,1-.24,1,6.54,6.54,0,0,1-2,3,5.85,5.85,0,0,1-3.58,1.3Z" style="fill:#f5a623"/><path d="M51.35,14.12h0a.57.57,0,0,1,.57.5,3.43,3.43,0,0,1,0,.64q0,10.93,0,21.86c0,.28.11.61-.16.84a6.23,6.23,0,0,1-1.9,2.86A5.39,5.39,0,0,1,46.64,42h-.36c-2-.15-3-1.71-2.56-3.75a5.35,5.35,0,0,1,5-3.84,3.77,3.77,0,0,1,2,.55q0-9.83,0-19.65a3.35,3.35,0,0,1,0-.71.57.57,0,0,1,.59-.51m0-1a1.57,1.57,0,0,0-1.58,1.31,3.83,3.83,0,0,0-.06.79v18.3a5.36,5.36,0,0,0-1-.09,6.38,6.38,0,0,0-6,4.62,4.17,4.17,0,0,0,.58,3.48,3.85,3.85,0,0,0,2.9,1.5l.43,0a6.31,6.31,0,0,0,3.88-1.41,6.9,6.9,0,0,0,2.17-3.12A1.79,1.79,0,0,0,53,37.24a.45.45,0,0,1,0-.11q0-10.94,0-21.86a4.74,4.74,0,0,0-.05-.83,1.57,1.57,0,0,0-1.51-1.32h-.08Z" style="fill:#f09000"/></g></g></svg>',NOTESPALETTEICON=RHYTHMPALETTEICON,RHYTHMPALETTEHELPICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><g fill="#292929" fill-opacity="0.4"><rect width="56" height="56" fill="none"/><path d="M7.24,42.72a4.17,4.17,0,0,1-.61,0A3.47,3.47,0,0,1,4,41a3.77,3.77,0,0,1-.14-3.37A6.37,6.37,0,0,1,9.49,34a4.6,4.6,0,0,1,1.49.2V14.88a2.68,2.68,0,0,1,.1-.78,1.07,1.07,0,0,1,1.05-.82,1.16,1.16,0,0,1,1.14.75,2.1,2.1,0,0,1,.13.85V37.16A1.82,1.82,0,0,1,13,38.58a6.21,6.21,0,0,1-5.75,4.14ZM10,35.66A6.48,6.48,0,0,0,5.67,39.9a.67.67,0,0,0,.12.56.8.8,0,0,0,.61.35l.12,0a6.18,6.18,0,0,0,4.13-3.59,5.85,5.85,0,0,0,.22-.56l0-.13A1,1,0,0,0,10.6,36,1,1,0,0,0,10,35.66Z"/><path d="M33.56,42.54h-.4a3.33,3.33,0,0,1-2.52-1.3,3.67,3.67,0,0,1-.5-3.07,5.86,5.86,0,0,1,5.49-4.23,4.57,4.57,0,0,1,1.49.25v-19a3.35,3.35,0,0,1,0-.69,1.11,1.11,0,0,1,2.18,0,3.54,3.54,0,0,1,0,.71c0,7.32,0,14.6,0,21.89,0,0,0,.1,0,.15a1.2,1.2,0,0,1-.25,1,6.44,6.44,0,0,1-2,3,5.87,5.87,0,0,1-3.58,1.3Z"/><path d="M46.64,42.54h-.4a3.33,3.33,0,0,1-2.52-1.3,3.7,3.7,0,0,1-.5-3.07,5.86,5.86,0,0,1,5.49-4.23,4.52,4.52,0,0,1,1.49.25v-19a3.31,3.31,0,0,1,0-.69,1.11,1.11,0,0,1,2.18,0,3.54,3.54,0,0,1,.05.71c0,7.32,0,14.6,0,21.89,0,0,0,.1,0,.15a1.19,1.19,0,0,1-.24,1,6.54,6.54,0,0,1-2,3,5.87,5.87,0,0,1-3.58,1.3Z"/></g></svg>',SENSORSPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 17</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#fff;opacity:0"/><path d="M44,14H12a1.56,1.56,0,0,0-1.56,1.56V34.61A1.56,1.56,0,0,0,12,36.17H44a1.56,1.56,0,0,0,1.56-1.56V15.55A1.56,1.56,0,0,0,44,14Zm-.56,18.93a1.32,1.32,0,0,1-1.33,1.32H13.85a1.32,1.32,0,0,1-1.33-1.32V17.24a1.33,1.33,0,0,1,1.33-1.33h28.3a1.33,1.33,0,0,1,1.33,1.33Z" style="fill:#aabb00;stroke:#748400;stroke-miterlimit:10;stroke-width:0.64px"/><path d="M35.35,46.31H12.47a1.59,1.59,0,0,1-1.53-1.94L12,39.61a1.57,1.57,0,0,1,1.53-1.24H34.29a1.57,1.57,0,0,1,1.53,1.24l1.06,4.76A1.59,1.59,0,0,1,35.35,46.31Z" style="fill:#aabb00;stroke:#748400;stroke-miterlimit:10;stroke-width:0.64px"/><rect x="40.24" y="38.37" width="4.85" height="7.94" rx="2.42" ry="2.42" style="fill:#aabb00;stroke:#748400;stroke-miterlimit:10;stroke-width:0.64px"/><rect x="42.27" y="39.59" width="0.78" height="1.63" rx="0.39" ry="0.39" style="fill:#fc2905"/></g></g></svg>',TONEPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 6</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#dfdfdf;opacity:0"/><path d="M36.08,45.48a7.08,7.08,0,1,1,0-14.15,6.91,6.91,0,0,1,3.13.75V26.36H22.74v12a7.09,7.09,0,1,1-7.09-7.08,6.91,6.91,0,0,1,3.13.75V14.76H43.17V38.41A7.09,7.09,0,0,1,36.08,45.48Z" style="fill:#3edcdd"/><path d="M42.47,15.46V38.41A6.39,6.39,0,1,1,36.08,32a6.31,6.31,0,0,1,3.83,1.31V25.66H22V38.41A6.39,6.39,0,1,1,15.65,32a6.31,6.31,0,0,1,3.83,1.31V15.46h23m1.4-1.4H18.08V31a7.64,7.64,0,0,0-2.43-.4,7.78,7.78,0,1,0,7.79,7.78V27.06H38.51v4a7.64,7.64,0,0,0-2.43-.4,7.78,7.78,0,1,0,7.79,7.78V14.06Z" style="fill:#1dbcbd"/></g></g></svg>',ORNAMENTPALETTEICON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg11" version="1.1" viewBox="0 0 55 55" height="55" width="55"> <metadata id="metadata17"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type  rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title>iconBackNew</dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs15" /> \x3c!-- Generator: Sketch 57.1 (83088) - https://sketch.com --\x3e <title id="title2">iconBackNew</title> <desc id="desc4">Created with Sketch.</desc> <g transform="translate(8,5)" style="fill:none;fill-rule:evenodd;stroke:none;stroke-width:1" id="Page-1"> <g style="fill:#3ddcdd;fill-rule:nonzero" id="iconBackNew"> <path id="path19" d="M 3.333225,31.193897 C 2.7571945,31.14974 2.2903846,31.005233 1.9101528,30.753366 0.55384938,29.854949 0.96605153,27.894236 2.9250307,25.92592 c 1.2667721,-1.272811 2.8118788,-2.17941 4.4457492,-2.608566 0.6630746,-0.174165 1.380315,-0.25063 1.8948623,-0.202012 0.4242027,0.04008 1.0459598,0.05722 1.1440678,0.03153 0.05502,-0.01441 0.09424,-0.04418 0.115212,-0.08747 0.180685,-0.372983 -0.181426,-3.09886 -0.7017431,-5.282527 -0.2103316,-0.88272 -0.4281626,-1.48768 -0.5533444,-1.536748 -0.04717,-0.01849 -0.1905471,0.08919 -0.6247573,0.469215 -0.882127,0.772041 -1.6475317,1.494471 -4.30131,4.059803 -1.1142743,1.077138 -2.0357479,1.961569 -2.0477189,1.965402 -0.011971,0.0038 -0.4373922,-0.453129 -0.9453803,-1.015473 L 0.42705317,20.696638 0.72889536,20.39093 C 1.4079828,19.703144 5.5864634,15.597649 6.7616883,14.463512 7.1214706,14.116307 7.5213893,13.720515 7.6503965,13.583973 8.058874,13.151637 8.2874948,12.806848 8.2881157,12.622214 8.2887926,12.42066 8.0897384,11.641318 7.7875026,10.66221 6.8808007,7.7249041 6.1706976,4.4408513 5.9991573,2.3915537 5.9616724,1.9437419 5.980339,1.1525517 6.0328975,0.96146892 6.085773,0.76923273 6.141987,0.64530015 6.1835393,0.62935506 c 0.046512,-0.0178483 0.1448383,0.0357148 0.4126114,0.22476998 0.3318369,0.23428576 1.167065,0.80654326 2.9912606,2.04946536 2.5421407,1.7320968 3.8648257,2.6470925 4.3701777,3.0231659 0.499055,0.3713868 0.671738,0.4435093 0.925776,0.3866582 0.196509,-0.043977 0.361462,-0.1737469 0.912689,-0.7180236 0.621399,-0.6135624 1.305914,-1.2610602 2.550626,-2.4126917 l 0.941473,-0.8710684 0.982362,0.9805056 0.982363,0.9805057 -2.124371,2.1116629 -2.124371,2.1116631 0.01512,0.082062 c 0.02675,0.1451746 0.340248,0.7354999 0.663797,1.2499644 0.438239,0.6968295 0.588464,0.9600635 0.829739,1.4539195 0.249201,0.51008 0.34377,0.731176 0.530132,1.239407 0.39326,1.072464 0.818486,2.800582 0.68912,2.800582 -0.03661,0 -0.187742,-0.314369 -0.346387,-0.720502 -0.263772,-0.675265 -0.563886,-1.279703 -0.972463,-1.958569 -0.881624,-1.464851 -1.913138,-2.6652206 -2.421876,-2.8183284 -0.09102,-0.027394 -0.116116,-0.02667 -0.183473,0.00529 -0.207704,0.098562 -1.303772,1.0524374 -2.311463,2.0115974 -0.834696,0.794496 -3.420362,3.321791 -3.420362,3.343147 0,0.01395 0.160453,0.616346 0.356564,1.338649 0.412428,1.519037 0.577847,2.169647 0.726648,2.857982 0.759759,3.514564 0.670089,5.940744 -0.287785,7.7866 -0.414793,0.79932 -0.988036,1.481334 -1.7011478,2.023935 -1.3287641,1.011048 -2.949944,1.71102 -4.5031426,1.944307 -0.2179251,0.03273 -0.9299679,0.08771 -1.0384358,0.08019 -0.026218,-0.0018 -0.1591932,-0.01186 -0.2954998,-0.0223 z m 6.0655157,-19.49791 c 0.4227004,-0.294911 1.2743373,-1.069342 2.2760913,-2.0697504 0.94039,-0.9391274 1.285196,-1.3307559 1.285196,-1.4597195 0,-0.2163346 -1.220521,-0.9322937 -3.6432049,-2.1371084 C 8.2377035,5.4927563 7.7449921,5.2636405 7.6700452,5.2636405 c -0.067854,0 -0.085311,0.084101 -0.081636,0.3932733 0.010128,0.8519168 0.458581,3.1545725 0.9260652,4.7550322 0.2375121,0.813136 0.3654556,1.131742 0.5204879,1.296125 0.1096787,0.116293 0.1832776,0.113848 0.3637781,-0.01208 z" /> <path id="path21" d="M 3.1162778,31.56314 C 2.4156607,31.480088 2.0901407,31.376967 1.7174191,31.120007 1.2443149,30.79384 0.94598299,30.36558 0.81190472,29.820126 0.7517003,29.575203 0.75843266,29.039198 0.82575984,28.71703 0.94581738,28.142542 1.2705083,27.388019 1.6309109,26.846003 c 0.936462,-1.40836 2.5444836,-2.67719 4.3972035,-3.469666 0.8658476,-0.370354 1.7174374,-0.585362 2.5553536,-0.645169 0.3492021,-0.02492 0.4433432,-0.02241 0.9722285,0.02597 0.3220735,0.02946 0.6005295,0.04983 0.6187915,0.04526 0.02825,-0.0071 0.02719,-0.09919 -0.007,-0.617 -0.02213,-0.334781 -0.06289,-0.779894 -0.09057,-0.989142 C 9.9388248,20.152639 9.5795666,18.231781 9.3729246,17.432379 9.2703045,17.03539 9.233385,16.932366 9.1907382,16.923992 9.0417336,16.894732 7.9663819,17.831261 6.239003,19.494671 c -1.1292199,1.087402 -1.393349,1.339293 -1.8475663,1.76196 -1.2842554,1.195049 -1.9580484,1.763895 -2.0893186,1.763895 -0.1346205,0 -0.6616115,-0.449298 -1.33096741,-1.134746 -0.56429373,-0.57786 -0.95338983,-1.058316 -0.95338983,-1.177246 0,-0.0599 0.37614759,-0.467354 1.39282384,-1.508745 C 3.2568899,17.3086 5.5600626,15.052383 7.7930403,12.947455 L 8.000788,12.751621 7.642435,11.528155 C 6.5710544,7.8703156 6.2169945,6.4917094 5.9539769,4.9537888 5.7563737,3.7983619 5.6694973,2.9665681 5.6502683,2.0459499 5.6297299,1.0626457 5.6954755,0.39215609 5.837803,0.13342603 5.9047343,0.01175461 5.9755127,-0.00576827 6.1142169,0.06499328 6.2808068,0.14998106 6.9277497,0.59557125 7.4899537,1.0125495 8.1886385,1.5307535 8.9337992,2.0520568 9.6591155,2.5300624 12.292252,4.2653801 12.583721,4.462974 14.053465,5.5090922 l 0.723998,0.5153198 0.706086,-0.674278 c 1.759821,-1.680542 2.514244,-2.3861567 3.113396,-2.911971 0.395804,-0.3473562 0.73312,-0.6067259 0.789059,-0.6067259 0.0926,0 0.343468,0.2119759 0.844509,0.7135923 0.661849,0.6626098 1.176012,1.2694152 1.321606,1.559735 0.06678,0.1331664 0.06522,0.1388567 -0.09566,0.3484948 -0.360194,0.4693733 -1.219091,1.3678806 -2.78808,2.9166566 -0.714411,0.7052068 -1.298928,1.2921517 -1.298928,1.3043219 0,0.01217 0.09985,0.1480369 0.221882,0.3019255 0.411968,0.5195009 0.615187,0.8461463 0.978901,1.5734438 0.715537,1.430818 1.199604,2.838539 1.503464,4.372244 0.210309,1.061515 0.342615,1.982458 0.363936,2.533262 0.01612,0.416425 -0.0016,0.430563 -0.134821,0.1078 -0.04365,-0.105722 -0.0887,-0.197992 -0.100112,-0.205046 -0.01141,-0.0071 -0.02182,0.04412 -0.02313,0.113715 -0.0013,0.0696 -0.01014,0.153354 -0.01962,0.186126 -0.01629,0.05631 -0.0207,0.05284 -0.08029,-0.06327 -0.108755,-0.21191 -0.288493,-0.685827 -0.540981,-1.426406 -0.406272,-1.191647 -0.646772,-1.79948 -1.004366,-2.538401 C 18.119456,12.772382 17.659723,12.05263 17.118468,11.413 16.977449,11.246349 16.14905,10.335201 15.95148,10.12944 l -0.05384,-0.05607 -2.595002,2.50805 c -1.427252,1.379428 -2.647355,2.559197 -2.71134,2.621711 l -0.116337,0.113661 0.192857,0.628216 c 0.534386,1.740722 0.828503,2.949726 1.074761,4.41794 0.297539,1.773956 0.371474,3.480366 0.20241,4.67161 -0.176294,1.242196 -0.714018,2.493794 -1.479554,3.44379 -1.2769971,1.584698 -3.4914471,2.717015 -5.9429172,3.038801 -0.2810226,0.03689 -1.2231195,0.0677 -1.40625,0.04599 z M 9.9728873,10.751592 C 10.835544,9.9219509 12.113993,8.7012773 12.288512,8.5406118 12.358334,8.4763328 12.425695,8.4046189 12.438203,8.3812472 12.496894,8.2715816 12.310975,8.0989752 11.817912,7.8053702 10.941399,7.2834324 8.2884439,5.9441278 8.0278329,5.8920055 7.9301764,5.8724743 7.921445,5.9246324 7.9655794,6.2638759 c 0.09057,0.6961726 0.4350773,2.1695625 0.9197428,3.9335571 0.1602796,0.583355 0.3019995,1.100867 0.3149332,1.150026 0.012934,0.04916 0.03175,0.08938 0.041814,0.08938 0.010064,0 0.338932,-0.308362 0.7308181,-0.685249 z" /> <path style="stroke:#00e0df" id="path29" d="m 14.302782,44.558662 c -0.05156,-0.0125 -0.304687,-0.05675 -0.5625,-0.09833 -0.913513,-0.147322 -1.889633,-0.606656 -2.283236,-1.074427 -0.363979,-0.432565 -0.435514,-0.656153 -0.435514,-1.361241 0,-0.775437 0.103294,-1.136594 0.502926,-1.758436 1.305707,-2.031726 4.537722,-3.912502 7.403324,-4.308144 0.684904,-0.09456 2.169287,-0.09474 2.674912,-3.13e-4 0.216514,0.04043 0.662941,0.156399 0.992062,0.257708 0.32912,0.10131 0.694813,0.1842 0.812652,0.1842 0.186786,0 0.226265,-0.02875 0.307953,-0.224259 0.488,-1.167948 0.593648,-7.513429 0.143248,-8.603866 -0.03905,-0.09453 -0.107089,-0.171875 -0.151208,-0.171875 -0.15662,0 -1.838502,1.560957 -5.215419,4.840437 l -1.77955,1.728188 -1.094938,-1.099945 -1.094937,-1.099945 1.936988,-1.881717 c 2.694026,-2.617152 6.319285,-6.252117 6.710411,-6.728376 l 0.326522,-0.397592 -0.03545,-0.414908 c -0.07187,-0.841101 -0.345964,-4.320539 -0.41672,-5.289907 -0.04014,-0.55 -0.07481,-1.885938 -0.07704,-2.96875 -0.005,-2.41152 0.08444,-3.329013 0.498324,-5.1141358 l 0.164122,-0.7078853 2.09823,2.1453851 c 1.154027,1.179962 2.803123,2.853808 3.664659,3.719657 l 1.566427,1.574272 2.25,-2.151723 c 1.2375,-1.183448 2.264373,-2.152027 2.281939,-2.152397 0.01757,-3.69e-4 0.502305,0.47042 1.077197,1.046202 l 1.045257,1.046875 -2.276447,2.318843 -2.276447,2.318843 0.329819,0.493657 c 2.180873,3.26423 3.006831,5.833075 3.2233,10.024907 0.102657,1.987913 0.08647,2.07223 -0.15597,0.8125 -0.507117,-2.634989 -0.82749,-3.71707 -1.526617,-5.15625 -0.615921,-1.267897 -1.718617,-2.765275 -2.759499,-3.74719 -0.242196,-0.228475 -0.535242,-0.460658 -0.651214,-0.515961 -0.204069,-0.09731 -0.217509,-0.09545 -0.417339,0.05788 -0.534635,0.41023 -2.007553,1.796345 -4.866248,4.579466 l -1.284768,1.250804 0.149595,2.09375 c 0.179576,2.513367 0.225643,6.458481 0.08831,7.5625 -0.272919,2.193942 -0.929154,4.094532 -1.841806,5.33425 -1.655173,2.248333 -4.503809,3.561403 -7.889059,3.636436 -0.584375,0.01295 -1.104687,0.01332 -1.15625,8.12e-4 z M 25.18506,21.263627 c 1.07077,-0.891105 3.245104,-3.03964 3.384048,-3.343897 0.08694,-0.190389 -0.07475,-0.375601 -0.985076,-1.128317 -0.4125,-0.341083 -1.101562,-0.923971 -1.53125,-1.295307 -1.267431,-1.095312 -1.592257,-1.244608 -1.705649,-0.783944 -0.07084,0.287805 -0.134561,5.203673 -0.07734,5.966871 0.04743,0.632599 0.171606,0.908129 0.409282,0.908129 0.06447,0 0.292165,-0.145591 0.505987,-0.323535 z" /> </g> </g></svg>',VOLUMEPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 7</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#dfdfdf;opacity:0"/><path d="M27,40.15a2.15,2.15,0,0,1-1.13-.32l-9.3-5.54H10.86a2.13,2.13,0,0,1-2.16-2.1V23.81a2.13,2.13,0,0,1,2.16-2.09h5.66l9.3-5.55A2.17,2.17,0,0,1,29.11,18v20.1a2.06,2.06,0,0,1-.67,1.52,2.23,2.23,0,0,1-1.49.58Z" style="fill:#3edcdd"/><path d="M27,16.55A1.43,1.43,0,0,1,28.41,18v20.1A1.43,1.43,0,0,1,27,39.45a1.51,1.51,0,0,1-.78-.22l-9.46-5.65H10.86A1.42,1.42,0,0,1,9.4,32.19V23.81a1.42,1.42,0,0,1,1.46-1.39h5.85l9.46-5.65a1.51,1.51,0,0,1,.78-.22m0-1.4a2.89,2.89,0,0,0-1.49.42L16.33,21H10.86A2.83,2.83,0,0,0,8,23.81v8.38A2.83,2.83,0,0,0,10.86,35h5.47l9.13,5.45a2.89,2.89,0,0,0,1.49.42,2.83,2.83,0,0,0,2.86-2.8V18A2.83,2.83,0,0,0,27,15.15Z" style="fill:#1dbcbd"/><path d="M34.79,35.29a1.67,1.67,0,0,1-1.26-.52,2.47,2.47,0,0,1-.05-3.08,7.06,7.06,0,0,0,0-7.92,2.5,2.5,0,0,1,.05-3.1,1.71,1.71,0,0,1,1.26-.52A2.79,2.79,0,0,1,37,21.45,11.21,11.21,0,0,1,37,34a2.78,2.78,0,0,1-2.23,1.29Z" style="fill:#3edcdd"/><path d="M34.79,20.86a2.1,2.1,0,0,1,1.65,1,10.56,10.56,0,0,1,0,11.77,2.1,2.1,0,0,1-1.65,1A1,1,0,0,1,34,34.3a1.84,1.84,0,0,1,0-2.23,7.77,7.77,0,0,0,0-8.69,1.84,1.84,0,0,1,0-2.23,1,1,0,0,1,.75-.29m-.75.29h0m.75-1.7A2.41,2.41,0,0,0,33,20.2a3.2,3.2,0,0,0-.12,3.95,6.35,6.35,0,0,1,0,7.14,3.2,3.2,0,0,0,.12,4,2.39,2.39,0,0,0,1.77.73,3.49,3.49,0,0,0,2.81-1.6,11.91,11.91,0,0,0,0-13.33,3.5,3.5,0,0,0-2.81-1.61Z" style="fill:#1dbcbd"/><path d="M41.43,39.51A1.79,1.79,0,0,1,40.11,39a2.36,2.36,0,0,1,0-3.11,12.86,12.86,0,0,0,0-16.26,2.37,2.37,0,0,1,0-3.12,1.79,1.79,0,0,1,1.32-.54,2.68,2.68,0,0,1,2,1,17,17,0,0,1,0,21.47,2.68,2.68,0,0,1-2,1Z" style="fill:#3edcdd"/><path d="M41.43,16.64a2,2,0,0,1,1.5.79,16.39,16.39,0,0,1,0,20.59,2,2,0,0,1-1.5.79,1.14,1.14,0,0,1-.82-.32h0a1.69,1.69,0,0,1,.09-2.2,13.62,13.62,0,0,0,0-17.13,1.69,1.69,0,0,1-.09-2.2,1.14,1.14,0,0,1,.82-.32m-.82.32h0m.82-1.72a2.5,2.5,0,0,0-1.82.75,3,3,0,0,0,0,4,12.17,12.17,0,0,1,0,15.38,3.07,3.07,0,0,0,0,4.05,2.5,2.5,0,0,0,1.82.75A3.38,3.38,0,0,0,44,38.9a17.67,17.67,0,0,0,0-22.35,3.38,3.38,0,0,0-2.59-1.31Z" style="fill:#1dbcbd"/></g></g></svg>',WIDGETSPALETTEICON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56"><title>アセット 5</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><rect width="56" height="56" style="fill:#dfdfdf;opacity:0"/><rect x="9.4" y="9.45" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="18.7" y="9.45" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="28" y="9.45" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="37.3" y="9.45" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="9.4" y="18.72" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="18.7" y="18.72" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="28" y="18.72" width="9.3" height="9.28" style="fill:#57ad02;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="37.3" y="18.72" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="9.4" y="28" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="18.7" y="28" width="9.3" height="9.28" style="fill:#57ad02;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="28" y="28" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="37.3" y="28" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="9.4" y="37.28" width="9.3" height="9.28" style="fill:#57ad02;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="18.7" y="37.28" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="28" y="37.28" width="9.3" height="9.28" style="fill:#7cd622;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/><rect x="37.3" y="37.28" width="9.3" height="9.28" style="fill:#57ad02;stroke:#57ad02;stroke-miterlimit:10;stroke-width:1.399999976158142px"/></g></g></svg>',MATRIXPALETTEICON=WIDGETSPALETTEICON,MYBLOCKSPALETTEICON='<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="55" height="55"> <path d="m 15.719636,31.331478 0.114372,5.261133 11.437247,6.290486 L 27.5,29.387146" style="fill:none;stroke:#282828;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 27.728744,29.501519 0.05719,13.381578 11.723178,-7.548583 0,-4.689272 -5.947368,3.545548" style="fill:none;stroke:#282828;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 10.001012,27.328441 5.604251,-5.146761 -5.832996,-2.973684 12.123482,-7.091093 5.718623,3.316801 5.489879,-3.088056 12.123482,7.319838 -5.832996,2.401822 5.489878,5.032388 -11.322874,7.205466 -5.947369,-5.261134 -6.290485,5.261134 -11.322875,-6.976721 z" style="fill:none;stroke:#282828;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="M 16.40587,21.952935 27.156883,15.204959 38.937247,22.067308 27.614372,28.815283 16.40587,21.952935 z" style="fill:none;stroke:#282828;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <g transform="matrix(0.39620698,0,0,0.39620698,28.654032,26.094918)" style="display:block"> <path d="m 33.233,35.1 10.102,10.1 c 0.752,0.75 1.217,1.783 1.217,2.932 0,2.287 -1.855,4.143 -4.146,4.143 -1.145,0 -2.178,-0.463 -2.932,-1.211 l -10.102,-10.103 -10.1,10.1 c -0.75,0.75 -1.787,1.211 -2.934,1.211 -2.284,0 -4.143,-1.854 -4.143,-4.141 0,-1.146 0.465,-2.184 1.212,-2.934 L 21.511,35.095 11.409,24.995 c -0.747,-0.748 -1.212,-1.785 -1.212,-2.93 0,-2.289 1.854,-4.146 4.146,-4.146 1.143,0 2.18,0.465 2.93,1.214 L 27.372,29.235 37.474,19.132 c 0.754,-0.749 1.787,-1.214 2.934,-1.214 2.289,0 4.146,1.856 4.146,4.145 0,1.146 -0.467,2.18 -1.217,2.932 L 33.233,35.1 z" style="fill:#282828;stroke:#00abff;stroke-width:3.5" /> <circle cx="27.371" cy="10.849" r="8.1219997" style="fill:#282828;stroke:#00abff;stroke-width:3.5" /> </g></svg>',SEARCHPALETTEICON='<svg version="1.1" viewBox="0 0 55 55" height="55" width="55" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><path d="m24.041 6.6112c-9.5473 0-17.367 7.825-17.367 17.367 0 9.5454 7.819 17.367 17.367 17.367 3.5927 0 6.9465-1.1133 9.7246-3.0036l9.9922 9.9922 4.6392-4.6392-9.9625-10.022c1.8768-2.7711 2.9739-6.1147 2.9739-9.6948 0-9.5441-7.8273-17.367-17.367-17.367zm0 6.602c5.9766 0 10.765 4.7852 10.765 10.765 0 5.9848-4.7899 10.765-10.765 10.765-5.9871 0-10.765-4.779-10.765-10.765 0-5.9818 4.7772-10.765 10.765-10.765z" fill="#c0c0c0" stroke="#606060" stroke-linejoin="round" stroke-width="2.5"/></svg>',MUSICICON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg28" height="55" width="55" version="1.0"> <rect ry="0" rx="0" y="0" x="0" height="55" width="55" id="rect841" style="fill:background_fill_color;fill-opacity:1;stroke:none;stroke-width:14.53336239;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <g id="g26" transform="matrix(0.87134744,0,0,0.87134744,3.2573019,3.5379454)"> <g style="fill:fill_color;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" transform="matrix(2.8153153,0,0,2.8153153,175.99125,78.011244)"> <path d="m -61.801691,-12.829594 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-9.472 0.352,0 0,10.352 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 0.736,0.48 q 0.848,0 1.712,-0.72 0.88,-0.72 0.88,-1.072 0,-0.224 -0.192,-0.224 -0.592,0 -1.632,0.688 -1.024,0.672 -1.024,1.12 0,0.208 0.256,0.208 z" style="fill:fill_color;fill-opacity:1" /> </g> <g style="fill:fill_color;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 28.250009,41.891892 q 0,-2.342343 2.297297,-4.144145 2.297298,-1.846846 4.864865,-1.846846 1.486487,0 2.657658,0.765765 l 0,-26.666666 0.990991,0 0,29.144144 q 0,2.522522 -2.207207,4.189189 Q 34.646405,45 31.988748,45 30.502261,45 29.376135,44.144144 28.250009,43.243243 28.250009,41.891892 Z" /> </g> <g style="fill:fill_color;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 42.833345,41.891892 q 0,-2.342343 2.297297,-4.144145 2.297298,-1.846846 4.864865,-1.846846 1.486487,0 2.657658,0.765765 l 0,-26.666666 0.990991,0 0,29.144144 q 0,2.522522 -2.207208,4.189189 Q 49.229741,45 46.572084,45 45.085597,45 43.959471,44.144144 42.833345,43.243243 42.833345,41.891892 Z" /> </g> </g> <path id="path843" d="M 0,0.5 H 55" style="fill:none;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path843-3" d="M 0,54.5 H 55" style="fill:none;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> </svg>',GRAPHICSICON='<svg xmlns="http://www.w3.org/2000/svg" width="55" height="55"> <rect ry="0" rx="0" y="0" x="0" height="55" width="55" id="rect841" style="fill:background_fill_color;fill-opacity:1;stroke:none;stroke-width:14.53336239;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="m 11.152285,41.709935 c 1.43401,0.788706 5.23977,1.402428 7.528553,1.290609 1.626167,-0.07945 3.914929,-0.479849 5.234137,-1.43401 2.238123,-1.618798 3.032695,-5.829627 5.090736,-7.671954 1.225701,-1.097229 3.231844,-2.444635 4.875634,-2.509518 2.003851,-0.07909 4.468168,1.514349 6.166244,2.581219 1.290216,0.810619 3.800127,3.369923 3.800127,3.369923" style="fill:none;stroke:stroke_color;stroke-width:1.5;stroke-linecap:round;stroke-miterlimit:4;stroke-opacity:1" /> <path d="m 35.566307,13.352385 2.437818,-2.366117 1.200984,0.84248 1.416085,1.200984 0.985882,1.272684 0.914181,1.487786 -2.366117,2.509519 -0.896257,-1.505711 -2.186866,-2.366117 -1.50571,-1.075508 z" style="fill:stroke_color;stroke:fill_color;stroke-width:1px;stroke-opacity:1" /> <path d="m 32.877538,16.112854 2.294417,-2.079315 1.200984,0.84248 1.416085,1.200984 0.985882,1.272684 0.914181,1.487786 -2.079315,1.864214 -0.967957,-1.147208 -2.330267,-2.222716 -1.43401,-1.218909 z" style="fill:stroke_color;stroke:fill_color;stroke-width:1px;stroke-opacity:1" /> <path d="m 13.423248,38.807621 0.891754,-3.80169 18.820708,-18.21056 -0.469344,-0.680549 2.252852,-2.135517 5.115854,5.115853 -2.229385,2.135517 -0.774419,-0.539747 -19.05538,18.022823 -3.70782,0.657082 -0.84482,-0.563212 z" style="fill:stroke_color;stroke:fill_color;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1" /> <path d="m 33.482432,17.358584 3.660886,3.473148" style="fill:stroke_color;stroke:fill_color;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1" /> <path d="m 10.935723,41.905293 2.769132,-2.816066" style="fill:stroke_color;stroke:fill_color;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1" /> <path d="m 14.690478,35.287537 c 0,0 1.594197,0.393866 2.158983,0.93869 0.574138,0.553844 1.032558,2.158984 1.032558,2.158984" style="fill:stroke_color;stroke:fill_color;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1" />  <path id="path843" d="M 0,0.5 H 55" style="fill:none;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path843-3" d="M 0,54.5 H 55" style="fill:none;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> </svg>',GRAPHICSICONX='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg28" height="55" width="55" version="1.0"> <rect ry="0" rx="0" y="0" x="0" height="55" width="55" id="rect841" style="fill:background_fill_color;fill-opacity:1;stroke:none;stroke-width:14.53336239;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <g id="g26" transform="matrix(0.87134744,0,0,0.87134744,3.2573019,3.5379454)"> <g transform="translate(-3.1884835,0.12548216)" style="fill:fill_color;stroke:stroke_color;stroke-width:1.99999976;stroke-miterlimit:4;stroke-dasharray:none" id="g3586"> <path style="fill:fill_color;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" id="path4725" d="m 31.188483,5.8745178 c 0,0 -1.254644,-1 -2,-1 -1.490712,0 -2.945907,0.9459074 -4,2 -1.581139,1.5811389 -1.692548,4.1860072 -3,6.0000002 -0.826905,1.14727 -1.85273,2.173095 -3,3 -1.813992,1.307452 -4.41886,1.418861 -5.999999,3 -1.054093,1.054093 -2,2.509288 -2,4 0,1.490712 1.176934,3.540162 2,4 2.595129,1.449868 0.836609,0.648512 2,2 0,0 -1.040434,3.300808 -1,5 0.06539,2.747959 1.999999,7 1.999999,8 0,1 3.621931,4.46873 6,6 2.394526,1.541867 5.323775,2.059095 8.164792,2.258437 3.065644,0.215103 5.976447,-0.356365 8.670416,-1.835208 1.652944,-0.907377 3.020234,-1.924716 4.164792,-3.423229 1.631246,-2.13571 3.310226,-4.40261 4,-7 0.42778,-1.610833 0.203639,-3.345821 0,-5 -0.167925,-1.364071 -1.27205,-2.652826 -1,-4 0.329909,-1.633688 2.319717,-2.47849 3,-4 0.693755,-1.551642 1.687609,-3.445625 1,-5 -0.786311,-1.777496 -3.357594,-1.960634 -5,-3 -1.015577,-0.642689 -2.106041,-1.196706 -3,-2 -1.93647,-1.740075 -3.442391,-3.913943 -5,-6.0000002 -0.71906,-0.9630146 -1.044881,-2.2704844 -2,-3 -0.837694,-0.6398275 -1.974105,-1.2421808 -3,-1 -0.458794,0.1083066 -1,1 -1,1" /> <path d="m 46.209786,28.156906 c 0,0 1.463947,5.738921 1.001084,8.583832 -0.503422,3.094194 -1.733796,6.320068 -4.004337,8.583833 -2.061998,2.055845 -3.20724,2.828474 -6.006505,3.815036 -1.290398,0.454783 -4.973515,0.953759 -6.514048,0.953759 -1.540535,0 -5.223651,-0.498977 -6.514049,-0.95376 -2.799265,-0.986562 -3.944507,-1.759191 -6.006506,-3.815036 -2.270541,-2.263765 -3.500915,-5.489639 -4.004337,-8.583833 -0.462863,-2.844911 1.001084,-8.583832 1.001084,-8.583832 M 28.176267,22.43435 c 0,0 -4.122174,4.705629 -7.007589,5.722555 -1.877805,0.661806 -4.201946,0.826315 -6.006506,0 -1.925806,-0.881834 -3.58357,-2.772978 -4.004337,-4.768796 -0.478397,-2.26917 0.558956,-4.123549 2.470477,-5.529022 2.067374,-1.520067 4.598363,-1.662883 6.539282,-3.054811 2.515152,-1.803739 2.912345,-5.389772 5.005421,-7.6300732 1.420632,-1.520559 5.512965,-3.8150366 5.512965,-3.8150366 0,0 4.092331,2.2944775 5.512964,3.8150365 2.093073,2.2403013 2.490269,5.8263353 5.005421,7.6300743 1.940919,1.391928 4.538808,1.465531 6.606183,2.927334 1.937249,1.369793 2.881973,3.387329 2.403575,5.656499 -0.420767,1.995818 -2.078532,3.886962 -4.004337,4.768796 -1.80456,0.826315 -4.1287,0.661806 -6.006505,0 -2.885416,-1.016926 -7.00759,-5.722555 -7.00759,-5.722555" id="path4505-6" style="fill:none;stroke:stroke_color;stroke-width:1.95427048;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <g id="g4565" transform="matrix(1.0010843,0,0,0.95375917,57.401951,5.3863652)" style="fill:none;stroke:stroke_color;stroke-opacity:1"> <g id="g4553" transform="translate(0,-1)" style="fill:none;stroke:stroke_color;stroke-opacity:1"> <path d="M -30.228157,8.514322 C -33.422908,9.40349 -38.624018,5.874516 -40.102591,4.585664" id="path3411-7" style="fill:none;fill-rule:evenodd;stroke:stroke_color;stroke-width:1.93205309;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M -29.760199,5.904536 C -33.101366,5.473905 -35.931474,3.7361852 -37.633646,2.3416285" id="path3413-5" style="fill:none;fill-rule:evenodd;stroke:stroke_color;stroke-width:1.93205309;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> </g> <g id="g4557" style="fill:none;stroke:stroke_color;stroke-opacity:1"> <path d="m -23.145912,7.514322 c 3.194751,0.889168 8.395861,-2.639806 9.874434,-3.928658" id="path3411-3" style="fill:none;fill-rule:evenodd;stroke:stroke_color;stroke-width:1.93205309;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="m -23.61387,4.904536 c 3.341167,-0.430631 6.171275,-2.168351 7.873447,-3.5629075" id="path3413-56" style="fill:none;fill-rule:evenodd;stroke:stroke_color;stroke-width:1.93205309;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> </g> </g> <g id="g4636" transform="matrix(1.0010843,0,0,0.95375917,57.930597,3.4788469)" style="fill:#ffffff;stroke:stroke_color;stroke-opacity:1;fill-opacity:0.94117647"> <ellipse cx="-30.836912" cy="14.612609" id="circle3409-2" rx="1.8846371" ry="2.0666313" style="fill:#ffffff;fill-rule:evenodd;stroke:stroke_color;stroke-width:1.99999976;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;fill-opacity:0.94117647" /> <ellipse cx="-23.593306" cy="14.699166" id="ellipse4229-9" rx="1.8846371" ry="2.0666313" style="fill:#ffffff;fill-rule:evenodd;stroke:stroke_color;stroke-width:1.99999976;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;fill-opacity:0.94117647" /> </g> <g id="g4632" transform="matrix(1.0010843,0,0,0.95375917,58.02711,3.4788469)" style="fill:none;stroke:stroke_color;stroke-opacity:1"> <path d="m -37.186516,14.624518 c -14.340024,2.75008 -4.810404,15.671871 4.375,5.25" id="path4303-1" style="fill:none;fill-rule:evenodd;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="m -17.436517,14.624518 c 14.3400245,2.75008 4.810404,15.671872 -4.375,5.25" id="path4303-1-2" style="fill:none;fill-rule:evenodd;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> </g> <path d="m 33.12784,3.3591671 c -1.384692,1.3140551 -1.985761,2.3793068 -2.459835,2.3793068 -0.662709,0 -1.27278,-1.0652517 -2.459836,-2.3793068 -0.97292,-1.0770097 1.101306,-2.37930771 2.459836,-2.37930771 1.358531,0 3.532987,1.36090081 2.459835,2.37930771 z" id="path4227-7" style="fill:stroke_color;fill-rule:evenodd;stroke:stroke_color;stroke-width:2.16383076;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;fill-opacity:1" /> <path style="fill:none;stroke:stroke_color;stroke-width:1.95427048;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" id="path4653" d="m 31.302308,50.085622 c 0,0 0.723125,3.123831 5.500191,3.669996 4.777067,0.546166 11.784656,-3.778776 14.78791,-9.501331 3.003254,-5.722555 2.402683,-11.490783 3.003253,-18.121425" /> </g> </g> <path id="path843" d="M 0,0.5 H 55" style="fill:none;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path843-3" d="M 0,54.5 H 55" style="fill:none;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> </svg>',LOGICICON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg28" height="55" width="55" version="1.0"> <rect ry="0" rx="0" y="0" x="0" height="55" width="55" id="rect841" style="fill:background_fill_color;fill-opacity:1;stroke:none;stroke-width:14.53336239;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <g id="g26" transform="matrix(0.87134744,0,0,0.87134744,3.2573019,3.5379454)"> <path d="m 14.85,27.1 -0.45,13.15 4.35,-2.4 c 0,0 6.349418,4.294879 10.2,4.05 4.946317,-0.314563 11.65,-7.5 11.65,-7.5 l -2.25,-2.3 c 0,0 -5.615371,6.15399 -9.4,6.65 -2.286298,0.29964 -7.05,-2.5 -7.05,-2.5 L 26,34.1 14.85,27.1 z" style="fill:fill_color;stroke:stroke_color;stroke-width:1.29999995;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 40.15,28.955044 0.45,-13.150001 -4.35,2.4 c 0,0 -6.349418,-4.294879 -10.2,-4.05 -4.946317,0.314563 -11.65,7.5 -11.65,7.5 l 2.25,2.3 c 0,0 5.615371,-6.15399 9.4,-6.65 2.286298,-0.29964 7.05,2.5 7.05,2.5 l -4.1,2.15 11.15,7.000001 z" style="fill:fill_color;stroke:stroke_color;stroke-width:1.29999995;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> </g> <path id="path843" d="M 0,0.5 H 55" style="fill:none;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path843-3" d="M 0,54.5 H 55" style="fill:none;stroke:stroke_color;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> </svg>',TRASHICON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg12" version="1.1" viewBox="0 0 55.000003 55"> <g transform="translate(3.2399972,2.2500001)" id="g825"> <path d="M 37.422492,7.0250365 H 33.372495 L 31.932496,5.5850377 A 1.9799983,1.9799983 0 0 0 30.514997,5.0000382 H 18.072508 A 1.9799983,1.9799983 0 0 0 16.655009,5.5850377 L 15.14751,7.0250365 H 11.097514 A 2.0249983,2.0249983 0 0 0 9.0725156,9.0500348 V 11.075033 H 39.44749 V 9.0500348 A 2.0249983,2.0249983 0 0 0 37.422492,7.0250365 Z" style="fill:#808080;stroke-width:2.24999809" id="path4" /> <path id="path6" d="m 11.097656,13.099609 v 10.439453 19.935547 c -2.17e-4,1.118682 0.906709,2.025608 2.025391,2.025391 h 8.121094 6.03125 8.123047 c 1.117919,-8.62e-4 2.023654,-0.907471 2.023437,-2.025391 V 23.539062 13.099609 Z" style="fill:#808080;stroke-width:2.24999809" /> </g> </svg>',PALETTEICONS=_THIS_IS_TURTLE_BLOCKS_?{search:SEARCHPALETTEICON,widgets:WIDGETSPALETTEICON,rhythm:RHYTHMPALETTEICON,meter:METERPALETTEICON,pitch:PITCHPALETTEICON,tone:TONEPALETTEICON,ornament:ORNAMENTPALETTEICON,intervals:INTERVALSPALETTEICON,volume:VOLUMEPALETTEICON,drum:DRUMPALETTEICON,graphics:TURTLEPALETTEICON,turtle:TURTLEPALETTEICON,pen:PENPALETTEICON,number:NUMBERPALETTEICON,boolean:BOOLEANPALETTEICON,flow:FLOWPALETTEICON,boxes:BOXESPALETTEICON,action:ACTIONSPALETTEICON,media:MEDIAPALETTEICON,sensors:SENSORSPALETTEICON,extras:EXTRASPALETTEICON,myblocks:MYBLOCKSPALETTEICON,program:PROGRAMPALETTEICON,heap:HEAPPALETTEICON,dictionary:DICTPALETTEICON,ensemble:TURTLESPALETTEICON,music:MUSICICON,artwork:GRAPHICSICON,logic:LOGICICON}:{search:SEARCHPALETTEICON,widgets:WIDGETSPALETTEICON,rhythm:RHYTHMPALETTEICON,meter:METERPALETTEICON,pitch:PITCHPALETTEICON,tone:TONEPALETTEICON,ornament:ORNAMENTPALETTEICON,intervals:INTERVALSPALETTEICON,volume:VOLUMEPALETTEICON,drum:DRUMPALETTEICON,graphics:MOUSEPALETTEICON,turtle:MOUSEPALETTEICON,pen:PENPALETTEICON,number:NUMBERPALETTEICON,boolean:BOOLEANPALETTEICON,flow:FLOWPALETTEICON,boxes:BOXESPALETTEICON,action:ACTIONSPALETTEICON,media:MEDIAPALETTEICON,sensors:SENSORSPALETTEICON,extras:EXTRASPALETTEICON,myblocks:MYBLOCKSPALETTEICON,program:PROGRAMPALETTEICON,heap:HEAPPALETTEICON,dictionary:DICTPALETTEICON,ensemble:MICEPALETTEICON,music:MUSICICON,artwork:GRAPHICSICON,logic:LOGICICON},STEPBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24">  <metadata   id="metadata12">  <rdf:RDF>  <cc:Work   rdf:about="">    <dc:format>image/svg+xml</dc:format>    <dc:type     rdf:resource="http://purl.org/dc/dcmitype/StillImage" />    <dc:title></dc:title>  </cc:Work>  </rdf:RDF>  </metadata>  <defs   id="defs10" />  <path   id="path2"   fill="none"   d="M0 0h24v24H0z" />  <path   style="fill:#292929;fill-opacity:0.4;"   id="path4"   d="M 4,6 H 2 v 14 c 0,1.1 0.9,2 2,2 H 18 V 20 H 4 Z M 20,2 H 8 C 6.9,2 6,2.9 6,4 v 12 c 0,1.1 0.9,2 2,2 h 12 c 1.1,0 2,-0.9 2,-2 V 4 C 22,2.9 21.1,2 20,2 Z m -8,12.5 v -9 l 6,4.5 z" /></svg>',RUNBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24">  <metadata   id="metadata12">  <rdf:RDF>  <cc:Work   rdf:about="">    <dc:format>image/svg+xml</dc:format>    <dc:type     rdf:resource="http://purl.org/dc/dcmitype/StillImage" />    <dc:title></dc:title>  </cc:Work>  </rdf:RDF>  </metadata>  <defs   id="defs10" />  <path   id="path2"   fill="none"   d="M0 0h24v24H0z" />  <path   style="fill:#292929;fill-opacity:0.4;"   id="path4"   d="M 12,2 C 6.48,2 2,6.48 2,12 2,17.52 6.48,22 12,22 17.52,22 22,17.52 22,12 22,6.48 17.52,2 12,2 Z m -2,14.5 v -9 l 6,4.5 z" />  <path   id="path844"   d="M 11.128592,21.951552 C 9.7325044,21.795415 8.67695,21.494778 7.5567354,20.934238 6.5159935,20.413465 5.6559169,19.783883 4.8473419,18.950942 3.286112,17.342664 2.354414,15.382869 2.0779232,13.125562 2.007709,12.552323 2.008562,11.445715 2.0796683,10.861591 2.3093043,8.9751759 3.0249886,7.25277 4.1899285,5.7829203 4.5219368,5.3640128 5.3632597,4.5219266 5.774496,4.1969153 7.2687047,3.0160014 8.9774616,2.3063638 10.879701,2.0767506 c 0.565813,-0.068297 1.651271,-0.067788 2.233266,0.00105 0.829757,0.098142 1.630901,0.2890482 2.390625,0.5696686 0.660403,0.2439341 1.667014,0.777132 2.239038,1.1860099 2.078338,1.4855775 3.5084,3.6519503 4.022599,6.0937578 0.16604,0.7884841 0.190548,1.0552941 0.190548,2.0744341 0,1.019141 -0.02451,1.28595 -0.190548,2.074434 -0.314543,1.49369 -1.012847,2.960973 -1.994922,4.191748 -0.326132,0.408722 -1.103537,1.184581 -1.516715,1.513698 -1.167165,0.929708 -2.525854,1.592128 -3.973518,1.937264 -0.761495,0.181547 -1.17509,0.22699 -2.151482,0.236393 -0.489844,0.0047 -0.939844,0.0031 -1,-0.0037 z m 1.877589,-7.685936 c 1.639982,-1.229829 2.985722,-2.247108 2.990533,-2.260618 0.0097,-0.02711 -5.915179,-4.4815993 -5.98244,-4.4978065 -0.034929,-0.00842 -0.041932,0.7418569 -0.041932,4.4921875 0,2.47626 0.011712,4.502291 0.026026,4.502291 0.014315,0 1.36783,-1.006224 3.007813,-2.236054 z"   style="fill:none;fill-opacity:1;stroke:none;stroke-width:0.13553125;stroke-linecap:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />  <path   id="path846"   d="M 11.128592,21.951552 C 9.7325044,21.795415 8.67695,21.494778 7.5567354,20.934238 6.5159935,20.413465 5.6559169,19.783883 4.8473419,18.950942 3.286112,17.342664 2.354414,15.382869 2.0779232,13.125562 2.007709,12.552323 2.008562,11.445715 2.0796683,10.861591 2.3093043,8.9751759 3.0249886,7.25277 4.1899285,5.7829203 4.5219368,5.3640128 5.3632597,4.5219266 5.774496,4.1969153 7.2687047,3.0160014 8.9774616,2.3063638 10.879701,2.0767506 c 0.565813,-0.068297 1.651271,-0.067788 2.233266,0.00105 0.829757,0.098142 1.630901,0.2890482 2.390625,0.5696686 0.660403,0.2439341 1.667014,0.777132 2.239038,1.1860099 2.078338,1.4855775 3.5084,3.6519503 4.022599,6.0937578 0.16604,0.7884841 0.190548,1.0552941 0.190548,2.0744341 0,1.019141 -0.02451,1.28595 -0.190548,2.074434 -0.314543,1.49369 -1.012847,2.960973 -1.994922,4.191748 -0.326132,0.408722 -1.103537,1.184581 -1.516715,1.513698 -1.167165,0.929708 -2.525854,1.592128 -3.973518,1.937264 -0.761495,0.181547 -1.17509,0.22699 -2.151482,0.236393 -0.489844,0.0047 -0.939844,0.0031 -1,-0.0037 z m 1.877589,-7.685936 c 1.639982,-1.229829 2.985722,-2.247108 2.990533,-2.260618 0.0097,-0.02711 -5.915179,-4.4815993 -5.98244,-4.4978065 -0.034929,-0.00842 -0.041932,0.7418569 -0.041932,4.4921875 0,2.47626 0.011712,4.502291 0.026026,4.502291 0.014315,0 1.36783,-1.006224 3.007813,-2.236054 z"   style="fill:none;fill-opacity:1;stroke:none;stroke-width:0.13553125;stroke-linecap:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /></svg>',STEPMUSICBUTTON='<svg width="55" height="55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28"><title>アセット 26</title><g id="レイヤー_2" data-name="レイヤー 2"><g id="Icon"><circle cx="14" cy="14" r="14" style="fill:#fff"/><path d="M22.66,8.12s0-.51.4-.6.62-1.13-.16-1.08-1,1.09-.88,1.67c0,0,.29,1-.24,1.22s-.62-1.18-.62-1.18,0-.19.29-.48S22,6.44,21,6.61a1.4,1.4,0,0,0-.61,2s.54,2.25.6,3a10.09,10.09,0,0,1-.11,2.34A7,7,0,1,0,9.55,20.55c-1.55.21-2.83.82-3,2.2H18.83a4.94,4.94,0,0,0,4.44-3.56,15,15,0,0,0,.15-6.08,2.52,2.52,0,0,1,1-2c1.07-1-.53-1.53-.53-1.53A1.67,1.67,0,0,1,22.66,8.12ZM14,20.34a5.18,5.18,0,1,1,5.17-5.18A5.18,5.18,0,0,1,14,20.34Z" style="fill:#0050a0"/><path d="M7.1,11.07a1.93,1.93,0,0,0,0-.48s0-.05,0-.07v-4c2.4,1.22,1,1.86,1,1.86h0a.53.53,0,0,0,.18,1,.51.51,0,0,0,.36-.14h0c2.4-1.63.39-3.67-.38-4.16a9.41,9.41,0,0,1-1.21-.92V4a.38.38,0,0,0-.75,0V9.22a1.94,1.94,0,0,0-3.13,1.21,2,2,0,0,0,3.85.64Z" style="fill:#0050a0"/><path d="M13.17,13.29a.37.37,0,0,0-.57.31V17a.37.37,0,0,0,.57.31l2.68-1.67a.37.37,0,0,0,0-.64Z" style="fill:#0050a0"/></g></g></svg>',STOPBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="55" height="55" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg975" version="1.1" viewBox="0 0 28 28"> <title id="title967">アセット 24</title> <circle id="circle969" style="fill:#ffffff;stroke-width:0.9285714" r="13" cy="14" cx="14" /> <rect id="rect971" style="fill:#0050a0" ry="1" rx="1" height="9" width="9" y="9.5" x="9.5" /> </svg>',RECORDBUTTON='<svg xmlns="http://www.w3.org/2000/svg" width="55" height="55"><circle cx="30" cy="30" r="20" stroke="currentColor" fill="none" stroke-width="6" /><circle id="rec_inside" cx="30" cy="30" r="8" fill="currentColor" /></svg>',RECORDHELPBUTTON='<svg xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 55 55"><circle cx="30" cy="30" r="20" stroke="#292929" stroke-opacity="0.4" fill="none" stroke-width="6"/><circle id="rec_inside" cx="30" cy="30" r="8" fill="#292929" fill-opacity="0.4"/></svg>',CARTESIAN='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.0" width="1200" height="900" id="svg2"> <defs id="defs4" /> <g id="layer1"> <path d="m 0,850 1200,0" id="path5" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 0,750 1200,0" id="path7" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 0,650 1200,0" id="path9" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 0,550 1200,0" id="path11" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 0,350 1200,0" id="path13" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 0,250 1200,0" id="path15" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 0,150 1200,0" id="path17" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 0,50 1200,0" id="path19" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 1100,0 0,900" id="path21" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 1000,0 0,900" id="path23" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 900,0 0,900" id="path25" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 800,0 0,900" id="path27" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 700,0 0,900" id="path29" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 500,0 0,900" id="path31" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 400,0 0,900" id="path33" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 300,0 0,900" id="path35" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 200,0 0,900" id="path37" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 100,0 0,900" id="path39" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="m 590,850 20,0" id="path41" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 590,750 20,0" id="path43" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 590,650 20,0" id="path45" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 590,550 20,0" id="path47" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 0,450 1200,0" id="path49" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 590,350 20,0" id="path51" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 590,250 20,0" id="path53" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 590,150 20,0" id="path55" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 590,50 20,0" id="path57" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 1100,440 0,20" id="path59" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 1000,440 0,20" id="path61" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 900,440 0,20" id="path63" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 800,440 0,20" id="path65" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 700,440 0,20" id="path67" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 600,0 0,900" id="path69" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 500,440 0,20" id="path71" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 400,440 0,20" id="path73" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 300,440 0,20" id="path75" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 200,440 0,20" id="path77" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> <path d="m 100,440 0,20" id="path79" style="fill:none;stroke:#000000;stroke-width:1px;stroke-opacity:1" /> </g> <text x="603.90137" y="344.8584" id="text3218" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="603.90137" y="344.8584" id="tspan3220">100</tspan></text> <text x="604.26758" y="244.8584" id="text3218-8" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="604.26758" y="244.8584" id="tspan3220-7">200</tspan></text> <text x="604.23828" y="144.8584" id="text3218-7" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="604.23828" y="144.8584" id="tspan3220-2">300</tspan></text> <text x="604.51172" y="44.858398" id="text3218-2" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="604.51172" y="44.858398" id="tspan3220-26">400</tspan></text> <text x="1104.2285" y="444.8584" id="text3218-6" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="1104.2285" y="444.8584" id="tspan3220-1">500</tspan></text> <text x="1004.5117" y="444.8584" id="text3218-9" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="1004.5117" y="444.8584" id="tspan3220-4">400</tspan></text> <text x="904.23828" y="444.8584" id="text3218-0" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="904.23828" y="444.8584" id="tspan3220-9">300</tspan></text> <text x="804.26758" y="444.8584" id="text3218-71" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="804.26758" y="444.8584" id="tspan3220-15">200</tspan></text> <text x="703.90137" y="444.8584" id="text3218-76" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="703.90137" y="444.8584" id="tspan3220-73">100</tspan></text> <text x="469.51172" y="444.8584" id="text3218-5" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="469.51172" y="444.8584" id="tspan3220-6">–100</tspan></text> <text x="369.51172" y="444.8584" id="text3218-94" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="369.51172" y="444.8584" id="tspan3220-8">–200</tspan></text> <text x="269.51172" y="444.8584" id="text3218-93" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="269.51172" y="444.8584" id="tspan3220-90">–300</tspan></text> <text x="169.51172" y="444.8584" id="text3218-85" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="169.51172" y="444.8584" id="tspan3220-0">–400</tspan></text> <text x="69.511719" y="444.8584" id="text3218-3" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="69.511719" y="444.8584" id="tspan3220-85">–500</tspan></text> <text x="571.51172" y="544.8584" id="text3218-1" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="571.51172" y="544.8584" id="tspan3220-5">–100</tspan></text> <text x="571.51172" y="644.8584" id="text3218-4" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="571.51172" y="644.8584" id="tspan3220-81">–200</tspan></text> <text x="571.51172" y="744.8584" id="text3218-30" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="571.51172" y="744.8584" id="tspan3220-44">–300</tspan></text> <text x="571.51172" y="844.8584" id="text3218-47" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="571.51172" y="844.8584" id="tspan3220-63">–400</tspan></text> <text x="604.34082" y="444.8584" id="text3218-96" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="604.34082" y="444.8584" id="tspan3220-21">0</tspan></text> <text x="69.140625" y="43.681641" id="text3218-2-7" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="69.140625" y="43.681641" id="tspan3220-26-8">(–500, 400)</tspan></text> <text x="1074.1406" y="43.681641" id="text3218-2-7-5" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="1074.1406" y="43.681641" id="tspan3220-26-8-7">(500, 400)</tspan></text> <text x="1074.1406" y="843.68164" id="text3218-2-7-1" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="1074.1406" y="843.68164" id="tspan3220-26-8-8">(500, –400)</tspan></text> <text x="69.140625" y="843.68164" id="text3218-2-7-1-5" xml:space="preserve" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"><tspan x="69.140625" y="843.68164" id="tspan3220-26-8-8-9">(–500, –400)</tspan></text> </svg>',POLAR='<?xml version="1.0" encoding="UTF-8" standalone="no"?> \x3c!-- Created with Inkscape (http://www.inkscape.org/) --\x3e <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.0" width="1200" height="900" id="svg2"> <path d="M 899.66703,-69.03853 300.33297,969.03853" id="path3403" style="fill:none;stroke:#aaaaaa;stroke-width:1;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 600,-149.33408 0,1198.66818" id="path69" style="fill:none;stroke:#aaaaaa;stroke-width:1;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="M 300.33297,-69.03853 899.66703,969.03853" id="path3397" style="fill:none;stroke:#aaaaaa;stroke-width:1;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 176.2068,26.20681 847.5864,847.58638" id="path3405" style="fill:none;stroke:#aaaaaa;stroke-width:1;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="M 80.961482,150.33296 1119.0385,749.66704" id="path3399" style="fill:none;stroke:#aaaaaa;stroke-width:1;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 881.14902,435.72711 c 0,194.53909 -157.2228,352.24418 -351.16696,352.24418 -193.94417,0 -351.16697,-157.70509 -351.16697,-352.24418 0,-194.53909 157.2228,-352.244179 351.16696,-352.244179 193.94417,0 351.16697,157.705089 351.16697,352.244179 l 0,0 z" transform="matrix(1.1334197,0,0,1.1299535,-0.6921025,-42.351375)" id="path2537" style="fill:none;stroke:#000000;stroke-width:0.88363791;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 881.14902,435.72711 c 0,194.53909 -157.2228,352.24418 -351.16696,352.24418 -193.94417,0 -351.16697,-157.70509 -351.16697,-352.24418 0,-194.53909 157.2228,-352.244179 351.16696,-352.244179 193.94417,0 351.16697,157.705089 351.16697,352.244179 l 0,0 z" transform="matrix(0.8500647,0,0,0.8474652,149.48096,80.736436)" id="path3311" style="fill:none;stroke:#000000;stroke-width:1.17818391;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 881.14902,435.72711 c 0,194.53909 -157.2228,352.24418 -351.16696,352.24418 -193.94417,0 -351.16697,-157.70509 -351.16697,-352.24418 0,-194.53909 157.2228,-352.244179 351.16696,-352.244179 193.94417,0 351.16697,157.705089 351.16697,352.244179 l 0,0 z" transform="matrix(0.5667098,0,0,0.5649768,299.65398,203.82429)" id="path3313" style="fill:none;stroke:#000000;stroke-width:1.76727581;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 881.14902,435.72711 c 0,194.53909 -157.2228,352.24418 -351.16696,352.24418 -193.94417,0 -351.16697,-157.70509 -351.16697,-352.24418 0,-194.53909 157.2228,-352.244179 351.16696,-352.244179 193.94417,0 351.16697,157.705089 351.16697,352.244179 l 0,0 z" transform="matrix(0.2833549,0,0,0.2824884,449.82699,326.91215)" id="path3315" style="fill:none;stroke:#000000;stroke-width:3.53455162;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 881.14902,435.72711 c 0,194.53909 -157.2228,352.24418 -351.16696,352.24418 -193.94417,0 -351.16697,-157.70509 -351.16697,-352.24418 0,-194.53909 157.2228,-352.244179 351.16696,-352.244179 193.94417,0 351.16697,157.705089 351.16697,352.244179 l 0,0 z" transform="matrix(1.4220377,0,0,1.417689,-153.65446,-167.72553)" id="path3395" style="fill:none;stroke:#000000;stroke-width:0.70429397;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="m 0,450 1200,0" id="path49" style="fill:none;stroke:#aaaaaa;stroke-width:1px;stroke-opacity:1" /> <path d="M 80.96149,749.66704 1119.0385,150.33296" id="path3401" style="fill:none;stroke:#aaaaaa;stroke-width:1;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <path d="M 1023.7932,26.20681 176.2068,873.79319" id="path3407" style="fill:none;stroke:#aaaaaa;stroke-width:1;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /> <text x="602.82129" y="175.8584" id="text3003" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="602.82129" y="175.8584" id="tspan3005" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">0</tspan></text> <text x="869.37012" y="459.64014" id="text3003-4" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="869.37012" y="459.64014" id="tspan3005-7" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">90</tspan></text> <text x="602.23438" y="733.8584" id="text3003-5" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="602.23438" y="733.8584" id="tspan3005-6" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">180</tspan></text> <text x="319.26758" y="459.64014" id="text3003-3" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="319.26758" y="459.64014" id="tspan3005-74" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">270</tspan></text> <text x="725.93848" y="209.30679" id="text3003-52" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="725.93848" y="209.30679" id="tspan3005-5" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">30</tspan></text> <text x="836.63684" y="321.30682" id="text3003-7" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="836.63684" y="321.30682" id="tspan3005-4" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">60</tspan></text> <text x="796.0752" y="262.57425" id="text3003-0" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="796.0752" y="262.57425" id="tspan3005-78" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">45</tspan></text> <text x="349.23846" y="323.30682" id="text3003-52-6" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="349.23846" y="323.30682" id="tspan3005-5-8" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">300</tspan></text> <text x="461.2384" y="209.30679" id="text3003-7-8" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="461.2384" y="209.30679" id="tspan3005-4-4" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">330</tspan></text> <text x="387.23846" y="262.64017" id="text3003-0-3" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="387.23846" y="262.64017" id="tspan3005-78-1" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">315</tspan></text> <text x="359.25311" y="595.97345" id="text3003-52-9" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="359.25311" y="595.97345" id="tspan3005-5-2" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">240</tspan></text> <text x="461.25305" y="697.30682" id="text3003-7-0" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="461.25305" y="697.30682" id="tspan3005-4-6" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">210</tspan></text> <text x="407.25311" y="650.6402" id="text3003-0-8" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="407.25311" y="650.6402" id="tspan3005-78-9" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">225</tspan></text> <text x="722.58643" y="699.30682" id="text3003-52-66" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="722.58643" y="699.30682" id="tspan3005-5-4" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">150</tspan></text> <text x="823.25305" y="595.97345" id="text3003-7-9" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="823.25305" y="595.97345" id="tspan3005-4-5" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">120</tspan></text> <text x="780.58643" y="654.6402" id="text3003-0-0" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="780.58643" y="654.6402" id="tspan3005-78-4" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">135</tspan></text> <text x="572.36084" y="733.8584" id="text3003-5-0" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="572.36084" y="733.8584" id="tspan3005-6-9" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#ff0000;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">–180</tspan></text> <text x="435.53955" y="691.30682" id="text3003-5-0-4" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="435.53955" y="691.30682" id="tspan3005-6-9-8" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#ff0000;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">–150</tspan></text> <text x="381.53955" y="644.6402" id="text3003-5-0-8" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="381.53955" y="644.6402" id="tspan3005-6-9-6" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#ff0000;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">–135</tspan></text> <text x="338.53955" y="585.97345" id="text3003-5-0-5" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="338.53955" y="585.97345" id="tspan3005-6-9-9" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#ff0000;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">–120</tspan></text> <text x="320.63477" y="447.14014" id="text3003-5-0-89" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="320.63477" y="447.14014" id="tspan3005-6-9-2" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#ff0000;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">–90</tspan></text> <text x="354.41336" y="308.54013" id="text3003-5-0-0" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="354.41336" y="308.54013" id="tspan3005-6-9-1" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#ff0000;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">–60</tspan></text> <text x="399.03955" y="247.14014" id="text3003-5-0-9" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="399.03955" y="247.14014" id="tspan3005-6-9-62" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#ff0000;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">–45</tspan></text> <text x="443.03955" y="215.14014" id="text3003-5-0-6" xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;fill:#0000c0;fill-opacity:1;stroke:none;font-family:DejaVu Sans"><tspan x="443.03955" y="215.14014" id="tspan3005-6-9-64" style="font-size:10px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:125%;writing-mode:lr-tb;text-anchor:start;fill:#ff0000;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans">–30</tspan></text> </svg>',TREBLE='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.0" width="1200" height="900">  <g> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,350 H 1200" /> <path d="M 0,325 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,425 H 1200" /> <path d="M 0,400 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,375 H 1200" /> <path d="M 0,500 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,475 H 1200" /> <path d="M 0,450 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,300 H 1200" /> <path d="M 0,275 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,250 H 1200" />  </g>  <g> <path d="M 0,324.99995 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,424.99995 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,374.99994 H 1200" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,349.99995 H 1200" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,399.99995 H 1200" />  </g>  <g  style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:186.667px;line-height:270px;font-family:sans-serif;-inkscape-font-specification:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 70.20588,422.67402 q 4.479989,15.67997 4.479989,25.68528 0,7.91464 -5.52532,12.99197 -5.525321,5.07732 -13.43997,5.07732 -7.466649,0 -12.99197,-4.47999 -5.525321,-4.33066 -5.525321,-10.60264 0,-2.09067 0.746665,-4.33066 0.895998,-2.09066 2.090662,-4.03199 1.343997,-1.792 3.285326,-2.98666 2.090662,-1.04533 4.330657,-1.04533 2.98666,0 5.226655,1.49333 2.389327,1.64266 3.583991,4.03199 1.194664,2.38933 1.194664,5.07732 0,9.25864 -10.453309,9.25864 1.343997,1.94133 3.434659,2.98666 2.239995,1.19467 5.226654,1.19467 1.791996,0 3.583992,-0.448 1.791996,-0.29867 3.882658,-1.49333 2.239995,-1.04533 3.882658,-2.83733 1.642663,-1.64266 2.687994,-4.77865 1.045331,-2.98666 1.045331,-7.01865 0,-3.136 -4.181324,-22.54929 -3.285326,0.896 -8.213315,0.896 -14.4853,0 -24.938609,-10.75197 -10.303977,-10.75198 -10.303977,-25.68528 0,-5.22665 1.642663,-10.60264 1.791996,-5.37599 3.882658,-9.40798 2.239995,-4.18132 6.421318,-9.25864 4.330657,-5.22666 7.167984,-8.21332 2.98666,-3.13599 8.213315,-8.36265 -0.895998,-3.13599 -1.49333,-5.82398 -0.597332,-2.83733 -1.045331,-5.67466 -0.447999,-2.83732 -0.746665,-5.52532 -0.149333,-2.68799 -0.149333,-5.37599 0,-13.43996 4.927989,-22.39994 4.927988,-9.10932 9.855977,-9.10932 1.49333,0 3.285326,1.94133 1.941329,1.94133 3.733325,5.37599 1.791996,3.43466 2.98666,9.10931 1.343997,5.52532 1.343997,11.94664 0,23.74395 -16.874629,39.27458 l 3.882658,17.62129 q 1.045331,-0.14933 2.239995,-0.29866 1.194664,-0.14934 2.090662,-0.14934 9.109313,0 15.381298,7.46665 6.271986,7.31732 6.271986,17.91996 -0.149333,17.6213 -16.127963,23.89328 z M 69.011216,311.57027 q 0,-8.21331 -4.778656,-8.21331 -2.687994,0 -5.226655,2.23999 -2.389328,2.24 -4.031991,5.97332 -1.642662,3.584 -2.687993,8.21332 -0.895998,4.47999 -0.895998,9.10931 0,6.27199 1.941329,10.90131 1.343996,-0.74667 2.687993,-1.94133 1.49333,-1.344 2.837327,-2.83733 1.343997,-1.64266 2.687994,-3.43465 1.343997,-1.94133 2.389328,-3.88266 1.045331,-2.09066 1.941329,-4.18133 1.045331,-2.09066 1.642663,-4.03199 0.746665,-2.09066 1.045331,-4.03199 0.447999,-2.09066 0.447999,-3.88266 z m 10.751975,92.28779 q 0,-5.52532 -2.239995,-9.55731 -2.239995,-4.18132 -6.122652,-6.27198 -3.733325,-2.24 -8.810647,-2.24 l 6.719985,33.74926 q 10.453309,-4.33066 10.453309,-15.67997 z m -13.589302,16.57597 -6.869318,-34.34659 q -2.687994,0.59733 -5.226654,2.68799 -2.389328,1.94133 -4.031991,4.92799 -1.49333,2.83733 -1.49333,5.67465 0,1.64267 0.447999,3.28533 0.597332,1.64266 1.343997,2.83733 0.746665,1.19466 1.642663,2.38932 0.895998,1.19467 1.791996,1.94133 1.04533,0.74667 1.791995,1.344 0.746665,0.59733 1.194664,0.896 0.597332,0.29866 0.597332,0.29866 l -1.194664,0.74667 q -2.837326,-0.896 -5.823986,-2.83733 -2.837327,-1.94133 -5.375988,-5.97332 -2.538661,-4.03199 -2.538661,-8.81064 0,-4.77866 2.239995,-9.25865 2.239995,-4.47999 5.375988,-7.31732 3.135993,-2.98666 6.570651,-4.18132 L 53.928584,358.7595 q -23.44528,19.56262 -23.44528,37.78125 0,10.90131 8.213314,18.21862 8.213315,7.31732 18.666624,7.31732 2.538661,0 8.810647,-1.64266 z" style="font-size:149.333px" />  </g>  <g> <g transform="translate(9.7078857,-24.097161)"> <rect ry="1.5" y="344.09711" x="1165.3268" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1165.566" y="352.73724" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan  x="1165.566"  y="352.73724">125</tspan></text> </g> <rect ry="1.5" y="345.14465" x="1175.0347" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1175.2739" y="353.78479" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1175.2739" y="353.78479">100</tspan></text> <g transform="translate(15.408936,-0.2922865)"> <rect ry="1.5" y="370.58167" x="1159.6257" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1163.2903" y="379.2218" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan  x="1163.2903"  y="379.2218">75</tspan></text> </g> <g transform="translate(15.408936,24.852417)"> <rect ry="1.5" y="370.58167" x="1159.6257" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1163.2903" y="379.2218" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan  x="1163.2903"  y="379.2218">50</tspan></text> </g> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="1175.0347" y="420.5788" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="429.21893" x="1178.7432"><tspan y="429.21893" x="1178.7432">25</tspan></text> <text x="1173.958" y="416.64658" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1173.958" y="416.64658">37.5</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="391.50186" x="1173.9897"><tspan y="391.50186" x="1173.9897">62.5</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="366.35715" x="1173.9995"><tspan y="366.35715" x="1173.9995">87.5</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="341.21243" x="1170.6084"><tspan y="341.21243" x="1170.6084">112.5</tspan></text>  </g>  <g  transform="translate(-1115.8589,-25.000055)"> <rect ry="0" y="345" x="1115.8589" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1122.7827" y="353.64014" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1122.7827" y="353.64014">F</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="1115.8589" y="370.14471" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="378.78485" x="1121.8135"><tspan y="378.78485" x="1121.8135">D</tspan></text> <rect ry="0" y="395.28943" x="1115.8589" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1122.292" y="403.92957" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1122.292" y="403.92957">B</tspan></text> <rect ry="0" y="420.43414" x="1115.8589" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1122.1138" y="429.07428" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1122.1138" y="429.07428">G</tspan></text> <rect ry="0" y="445.57886" x="1115.8589" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1122.5288" y="454.21899" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1122.5288" y="454.21899">E</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="441.64661" x="1122.7827"><tspan>F</tspan></text> <text x="1122.4409" y="416.50189" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1122.4409" y="416.50189">A</tspan></text> <text x="1122.3579" y="391.35721" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1122.3579" y="391.35721">C</tspan></text> <text x="1122.5288" y="366.21249" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1122.5288" y="366.21249">E</tspan></text> </g> </svg>',SOPRANO='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.0" width="1200" height="900"> <g transform="translate(0,50)"> <path d="M 0,350 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,325 H 1200" /> <path d="M 0,425 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,400 H 1200" /> <path d="M 0,375 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,500 H 1200" /> <path d="M 0,475 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,450 H 1200" /> <path d="M 0,300 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,275 H 1200" /> <path d="M 0,250 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> </g> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,424.99957 H 1200" /> <path d="M 0,399.99958 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,474.99957 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,449.99957 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,374.99957 H 1200" /> <rect ry="0" y="469.99957" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.7529163" y="478.63971" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.7529163" y="478.63971">A</tspan></text> <rect ry="0" y="445.43372" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <g transform="scale(1.0149201,0.98529926)" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:131.373px;line-height:190.022px;font-family:sans-serif;-inkscape-font-specification:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.985299px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 75.362294,464.15635 q 8.933364,0 14.319657,5.51767 5.386293,5.51767 5.386293,14.5824 0,9.85298 -6.437277,16.68437 -6.437277,6.70003 -15.764761,6.70003 -8.013753,0 -13.400046,-3.54707 -5.386293,-3.67845 -5.386293,-10.11573 0,-2.62746 2.233341,-4.8608 2.233341,-2.36471 5.123547,-2.36471 3.152952,0 5.25492,2.23334 2.233341,2.10197 2.233341,4.99217 0,1.9706 -2.101968,4.59806 -1.970595,2.49609 -1.970595,2.89021 0,1.18235 1.182357,1.83922 1.182357,0.52549 3.415698,0.52549 11.429452,0 11.429452,-19.57458 0,-5.25492 -0.525492,-8.40787 -0.525492,-3.28432 -1.839222,-4.59805 -1.31373,-1.31373 -2.496087,-1.57648 -1.182358,-0.39412 -3.547072,-0.39412 -3.809817,0 -6.437277,3.02158 -2.496087,3.02158 -4.992174,10.50984 -3.152952,-17.60398 -11.692197,-24.96087 v 50.05311 H 44.358265 V 404.38164 h 4.992174 v 50.18448 q 8.539245,-7.35688 11.692197,-24.82949 3.284325,13.40004 11.429451,13.40004 2.364714,0 3.547072,-0.26274 1.182357,-0.26275 2.496087,-1.57648 1.31373,-1.31373 1.839222,-4.46668 0.525492,-3.15295 0.525492,-8.53925 0,-19.70595 -11.429452,-19.70595 -4.598055,0 -4.598055,2.23334 0,0.5255 1.970595,3.15296 2.101968,2.49608 2.101968,4.46668 0,2.8902 -2.233341,5.12355 -2.101968,2.10196 -5.25492,2.10196 -2.890206,0 -5.123547,-2.23334 -2.233341,-2.36471 -2.233341,-4.99217 0,-6.43728 5.386293,-9.98435 5.386293,-3.67844 13.400046,-3.67844 9.327484,0 15.764761,6.83139 6.437277,6.70003 6.437277,16.68437 0,8.67062 -5.386293,14.31966 -5.25492,5.51767 -14.319657,5.51767 -4.598056,0 -9.196111,-1.70785 l -4.335309,9.7216 4.335309,9.85298 q 4.860801,-1.83923 9.196111,-1.83923 z m -35.86483,43.74721 H 26.491537 V 404.38164 h 13.005927 z" style="font-size:131.373px;stroke-width:0.985299px" /> </g> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088673" y="370.289" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="378.92914" x="6.603992"><tspan y="378.92914" x="6.603992">B</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088673" y="395.43372" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="404.07385" x="6.4257693"><tspan y="404.07385" x="6.4257693">G</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088673" y="420.57843" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="429.21857" x="6.8408084"><tspan y="429.21857" x="6.8408084">E</tspan></text> <text x="7.0947146" y="416.64618" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="7.0947146" y="416.64618">F</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="391.50146" x="6.7529178"><tspan y="391.50146" x="6.7529178">A</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="1171.3524" y="445.14429" ry="1.5" /> <rect ry="1.5" y="370.289" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1175.017" y="378.92914" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1175.017" y="378.92914">75</tspan></text> <rect ry="1.5" y="395.43372" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1174.9364" y="404.07385" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1174.9364" y="404.07385">50</tspan></text> <rect ry="1.5" y="420.57843" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1175.0609" y="429.21857" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1175.0609" y="429.21857">25</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="416.64621" x="1170.2758"><tspan y="416.64621" x="1170.2758">37.5</tspan></text> <text x="1170.3075" y="391.5015" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1170.3075" y="391.5015">62.5</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" width="25" height="10" x="1168.8524" y="468.34171" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="476.98184" x="1173.3788"><tspan y="476.98184" x="1173.3788">-25</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="432.99957" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="441.63971" x="6.1254749"><tspan y="441.63971" x="6.1254749">D</tspan></text> <rect ry="0" y="458.14429" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.6039906" y="466.78442" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.6039906" y="466.78442">B</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="454.21207" x="6.6699085"><tspan y="454.21207" x="6.6699085">C</tspan></text> <text x="1170.1073" y="441.15939" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1170.1073" y="441.15939">12.5</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="453.10022" x="1178.1737"><tspan y="453.10022" x="1178.1737">0</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="465.04102" x="1168.6083"><tspan y="465.04102" x="1168.6083">-12.5</tspan></text> </svg>',ALTO='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.0" width="1200" height="900"> <g transform="translate(0,75)"> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,350 H 1200" /> <path d="M 0,325 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,425 H 1200" /> <path d="M 0,400 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,375 H 1200" /> <path d="M 0,500 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,475 H 1200" /> <path d="M 0,450 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,300 H 1200" /> <path d="M 0,275 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,250 H 1200" /> </g> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,424.99986 H 1200" /> <path d="M 0,399.99987 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,474.99986 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,449.99986 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,499.99986 H 1200" /> <rect ry="0" y="469.99985" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.7529163" y="478.63998" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.7529163" y="478.63998" id="tspan3220-9-3">A</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="495.14456" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="503.7847" x="7.0947132"><tspan id="tspan3220-2-2-2" y="503.7847" x="7.0947132">F</tspan></text> <rect ry="0" y="445.43399" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.4257679" y="491.21237" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.4257679" y="491.21237" id="tspan3220-2-1-2-9-1-2">G</tspan></text> <g transform="scale(1.0149218,0.9852976)" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:131.373px;line-height:190.022px;font-family:sans-serif;-inkscape-font-specification:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.985298px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 75.36225,464.15715 q 8.933364,0 14.319657,5.51766 5.386293,5.51767 5.386293,14.58241 0,9.85297 -6.437277,16.68437 -6.437277,6.70002 -15.76476,6.70002 -8.013753,0 -13.400046,-3.54707 -5.386294,-3.67845 -5.386294,-10.11572 0,-2.62746 2.233341,-4.8608 2.233341,-2.36472 5.123548,-2.36472 3.152952,0 5.25492,2.23334 2.233341,2.10197 2.233341,4.99218 0,1.97059 -2.101968,4.59805 -1.970595,2.49609 -1.970595,2.89021 0,1.18236 1.182357,1.83922 1.182357,0.52549 3.415698,0.52549 11.429451,0 11.429451,-19.57457 0,-5.25492 -0.525492,-8.40788 -0.525492,-3.28432 -1.839222,-4.59805 -1.31373,-1.31373 -2.496087,-1.57648 -1.182357,-0.39412 -3.547071,-0.39412 -3.809817,0 -6.437277,3.02158 -2.496087,3.02158 -4.992174,10.50984 -3.152953,-17.60398 -11.692198,-24.96087 v 50.05312 H 44.358221 V 404.38243 h 4.992174 v 50.18449 q 8.539245,-7.35689 11.692198,-24.8295 3.284325,13.40005 11.429451,13.40005 2.364714,0 3.547071,-0.26275 1.182357,-0.26275 2.496087,-1.57648 1.31373,-1.31373 1.839222,-4.46668 0.525492,-3.15295 0.525492,-8.53924 0,-19.70595 -11.429451,-19.70595 -4.598055,0 -4.598055,2.23334 0,0.52549 1.970595,3.15295 2.101968,2.49609 2.101968,4.46668 0,2.89021 -2.233341,5.12355 -2.101968,2.10197 -5.25492,2.10197 -2.890207,0 -5.123548,-2.23334 -2.233341,-2.36472 -2.233341,-4.99218 0,-6.43727 5.386294,-9.98435 5.386293,-3.67844 13.400046,-3.67844 9.327483,0 15.76476,6.8314 6.437277,6.70002 6.437277,16.68437 0,8.67062 -5.386293,14.31965 -5.25492,5.51767 -14.319657,5.51767 -4.598055,0 -9.19611,-1.70785 l -4.335309,9.7216 4.335309,9.85298 q 4.860801,-1.83922 9.19611,-1.83922 z M 39.49742,507.90436 H 26.491493 V 404.38243 H 39.49742 Z" style="font-size:131.373px;stroke-width:0.985298px" id="path897" /> </g> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088673" y="395.43399" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="404.07413" x="6.4257693"><tspan id="tspan3220-2-6-4" y="404.07413" x="6.4257693">G</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088673" y="420.5787" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="429.21884" x="6.8408084"><tspan id="tspan3220-2-1-6" y="429.21884" x="6.8408084">E</tspan></text> <text x="7.0947146" y="416.64645" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="7.0947146" y="416.64645" id="tspan3220-2-1-2-0">F</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="1171.3524" y="445.14456" ry="1.5" /> <rect ry="1.5" y="395.43399" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1174.9364" y="404.07413" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1174.9364" y="404.07413" id="tspan3220-2-6">50</tspan></text> <rect ry="1.5" y="420.5787" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1175.0609" y="429.21884" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1175.0609" y="429.21884" id="tspan3220-2-1">25</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="416.64648" x="1170.2758"><tspan id="tspan3220-2-1-2" y="416.64648" x="1170.2758">37.5</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" width="25" height="10" x="1168.8524" y="468.34198" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="476.98212" x="1173.3788"><tspan id="tspan3220-3" y="476.98212" x="1173.3788">-25</tspan></text> <rect ry="1.5" y="493.48672" x="1168.8524" height="10" width="25" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" /> <text x="1173.2738" y="502.12686" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1173.2738" y="502.12686" id="tspan3220-2-12">-50</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="489.55447" x="1168.6083"><tspan id="tspan3220-2-1-2-9-2" y="489.55447" x="1168.6083">-37.5</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="432.99985" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="441.63998" x="6.1254749"><tspan id="tspan3220-9-3-5" y="441.63998" x="6.1254749">D</tspan></text> <rect ry="0" y="458.14456" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.6039906" y="466.7847" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.6039906" y="466.7847" id="tspan3220-2-2-2-7">B</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="454.21234" x="6.6699085"><tspan id="tspan3220-2-1-2-9-1-2-7" y="454.21234" x="6.6699085">C</tspan></text> <text x="1170.1073" y="441.15967" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1170.1073" y="441.15967" id="tspan3220-2-1-2-6">12.5</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="453.10049" x="1178.1737"><tspan id="tspan3220-2-6-43" y="453.10049" x="1178.1737">0</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="465.04129" x="1168.6083"><tspan id="tspan3220-2-1-2-2-4" y="465.04129" x="1168.6083">-12.5</tspan></text> </svg>',TENOR='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="900" width="1200" version="1.0"> <g transform="translate(0,100)"> <path d="M 0,350 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,325 H 1200" /> <path d="M 0,425 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,400 H 1200" /> <path d="M 0,375 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,500 H 1200" /> <path d="M 0,475 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,450 H 1200" /> <path d="M 0,300 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,275 H 1200" /> <path d="M 0,250 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> </g> <path d="M 0,424.99966 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,524.99966 H 1200" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,474.99966 H 1200" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,449.99966 H 1200" /> <path d="M 0,499.99966 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="469.99966" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="478.6398" x="6.7529163"><tspan y="478.6398" x="6.7529163">A</tspan></text> <rect ry="0" y="495.14438" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="7.0947132" y="503.78452" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="7.0947132" y="503.78452">F</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.61884367" y="520.28906" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="528.9292" x="6.1254749"><tspan y="528.9292" x="6.1254749">D</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="445.43381" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="516.35681" x="6.840807"><tspan y="516.35681" x="6.840807">E</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="491.21219" x="6.4257679"><tspan y="491.21219" x="6.4257679">G</tspan></text> <g transform="scale(1.0149201,0.98529926)" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:131.373px;line-height:190.022px;font-family:sans-serif;-inkscape-font-specification:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.985299px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 75.676935,464.15641 q 8.933365,0 14.319658,5.51767 5.386293,5.51767 5.386293,14.5824 0,9.85298 -6.437277,16.68437 -6.437277,6.70003 -15.764761,6.70003 -8.013753,0 -13.400046,-3.54707 -5.386293,-3.67845 -5.386293,-10.11572 0,-2.62746 2.233341,-4.86081 2.233341,-2.36471 5.123547,-2.36471 3.152952,0 5.25492,2.23334 2.233341,2.10197 2.233341,4.99218 0,1.97059 -2.101968,4.59805 -1.970595,2.49609 -1.970595,2.89021 0,1.18235 1.182357,1.83922 1.182357,0.52549 3.415698,0.52549 11.429452,0 11.429452,-19.57458 0,-5.25492 -0.525493,-8.40787 -0.525492,-3.28432 -1.839222,-4.59805 -1.31373,-1.31373 -2.496087,-1.57648 -1.182357,-0.39412 -3.547071,-0.39412 -3.809817,0 -6.437277,3.02158 -2.496087,3.02158 -4.992174,10.50984 -3.152952,-17.60398 -11.692197,-24.96087 v 50.05311 H 44.672907 V 404.3817 h 4.992174 v 50.18448 q 8.539245,-7.35688 11.692197,-24.82949 3.284325,13.40004 11.429451,13.40004 2.364714,0 3.547071,-0.26274 1.182357,-0.26275 2.496087,-1.57648 1.31373,-1.31373 1.839222,-4.46668 0.525493,-3.15295 0.525493,-8.53925 0,-19.70595 -11.429452,-19.70595 -4.598055,0 -4.598055,2.23335 0,0.52549 1.970595,3.15295 2.101968,2.49608 2.101968,4.46668 0,2.89021 -2.233341,5.12355 -2.101968,2.10196 -5.25492,2.10196 -2.890206,0 -5.123547,-2.23334 -2.233341,-2.36471 -2.233341,-4.99217 0,-6.43728 5.386293,-9.98435 5.386293,-3.67844 13.400046,-3.67844 9.327484,0 15.764761,6.83139 6.437277,6.70003 6.437277,16.68437 0,8.67062 -5.386293,14.31966 -5.25492,5.51767 -14.319658,5.51767 -4.598055,0 -9.19611,-1.70785 l -4.335309,9.7216 4.335309,9.85298 q 4.860801,-1.83923 9.19611,-1.83923 z M 39.812106,507.90362 H 26.806179 V 404.3817 h 13.005927 z" style="font-size:131.373px;stroke-width:0.985299px" /> </g> <rect ry="0" y="420.57852" x="0.17088673" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.8408084" y="429.21866" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.8408084" y="429.21866">E</tspan></text> <rect ry="1.5" y="445.14438" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="1171.3524" y="420.57852" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="429.21866" x="1175.0609"><tspan y="429.21866" x="1175.0609">25</tspan></text> <rect ry="1.5" y="468.3418" x="1168.8524" height="10" width="25" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" /> <text x="1173.3788" y="476.98193" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1173.3788" y="476.98193">-25</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" width="25" height="10" x="1168.8524" y="493.48654" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="502.12668" x="1173.2738"><tspan y="502.12668" x="1173.2738">-50</tspan></text> <rect ry="1.5" y="518.63123" x="1168.8524" height="10" width="25" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" /> <text x="1173.3788" y="527.27136" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1173.3788" y="527.27136">-75</tspan></text> <text x="1168.6083" y="514.69897" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1168.6083" y="514.69897">-62.5</tspan></text> <text x="1168.6083" y="489.55429" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1168.6083" y="489.55429">-37.5</tspan></text> <rect ry="0" y="432.99966" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.1254749" y="441.6398" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.1254749" y="441.6398">D</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="458.14438" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="466.78452" x="6.6039906"><tspan y="466.78452" x="6.6039906">B</tspan></text> <text x="6.6699085" y="454.21216" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.6699085" y="454.21216">C</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="441.15948" x="1170.1073"><tspan y="441.15948" x="1170.1073">12.5</tspan></text> <text x="1178.1737" y="453.10031" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1178.1737" y="453.10031">0</tspan></text> <text x="1168.6083" y="465.04111" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1168.6083" y="465.04111">-12.5</tspan></text> </svg>',BASS='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="900" width="1200" version="1.0"> <g transform="translate(0,150)"> <path d="M 0,350 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,325 H 1200" /> <path d="M 0,425 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,400 H 1200" /> <path d="M 0,375 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,500 H 1200" /> <path d="M 0,475 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,450 H 1200" /> <path d="M 0,300 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,275 H 1200" /> <path d="M 0,250 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> </g> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,474.99987 H 1200" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,574.99987 H 1200" /> <path d="M 0,524.99986 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,499.99987 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,549.99988 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="469.99988" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="478.64001" x="6.7529163"><tspan y="478.64001" x="6.7529163">A</tspan></text> <rect ry="0" y="495.14459" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="7.0947132" y="503.78473" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="7.0947132" y="503.78473">F</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="520.28931" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="528.92944" x="6.1254749"><tspan y="528.92944" x="6.1254749">D</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="545.43402" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="554.07416" x="6.6039906"><tspan y="554.07416" x="6.6039906">B</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="570.57874" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="579.21887" x="6.4257679"><tspan y="579.21887" x="6.4257679">G</tspan></text> <text x="6.7529163" y="566.64648" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.7529163" y="566.64648">A</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="541.50177" x="6.6699085"><tspan y="541.50177" x="6.6699085">C</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="516.35706" x="6.840807"><tspan y="516.35706" x="6.840807">E</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="491.2124" x="6.4257679"><tspan y="491.2124" x="6.4257679">G</tspan></text> <g style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:149.333px;line-height:216px;font-family:sans-serif;-inkscape-font-specification:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 96.338834,481.17328 q 2.687994,0 4.479986,1.94133 1.94133,1.94133 1.94133,4.47999 0,2.53866 -2.09066,4.47999 -2.090661,1.94133 -4.479989,1.94133 -6.271985,0 -6.271985,-6.71998 0,-2.688 1.941328,-4.33066 1.941329,-1.792 4.47999,-1.792 z m -4.629322,30.7626 q 1.941328,-1.94133 4.629322,-1.94133 2.687994,0 4.479986,2.09066 1.94133,2.09067 1.94133,4.18133 0,2.83732 -1.94133,4.77865 -1.941325,1.94133 -4.479986,1.94133 -6.421318,0 -6.421318,-6.71998 0,-2.38933 1.791996,-4.33066 z M 54.674929,473.25864 q 12.095973,0 20.309287,8.36264 8.213315,8.21332 8.213315,19.71196 0,5.67465 -1.642663,11.05064 -1.49333,5.37599 -4.927989,10.30398 -3.434659,4.77865 -6.869317,8.81064 -3.434659,4.03199 -8.95998,8.06398 -5.525321,4.032 -9.258645,6.86932 -3.733325,2.688 -10.154644,6.12265 -6.271986,3.43466 -9.109313,4.92799 -2.687993,1.344 -8.213314,4.03199 l -0.746665,-2.38932 q 0.149333,-0.14934 4.031991,-2.688 3.882658,-2.53866 6.271985,-4.03199 2.389328,-1.64266 7.018651,-5.37599 4.778656,-3.73332 7.914649,-6.86931 3.135993,-3.28533 7.01865,-8.06399 4.031991,-4.92798 6.421319,-9.55731 2.389328,-4.62932 4.031991,-10.60264 1.791996,-5.97332 1.791996,-11.94664 0,-23.44528 -16.575962,-23.44528 -5.525321,0 -9.407979,1.49333 -3.882658,1.344 -5.674654,3.43466 -1.642663,2.09066 -2.389328,3.73332 -0.746665,1.49333 -0.746665,2.688 0,2.23999 2.98666,2.23999 1.194664,0 2.837327,-0.448 1.642663,-0.59733 2.239995,-0.59733 4.031991,0 6.719985,2.53866 2.687994,2.53866 2.687994,6.27199 0,4.33066 -3.285326,7.16798 -3.285326,2.83733 -7.765316,2.83733 -5.823987,0 -9.557311,-3.43466 -3.733325,-3.43466 -3.733325,-8.81065 0,-9.85597 8.362647,-16.12796 8.511981,-6.27198 20.159954,-6.27198 z" style="font-size:149.333px" /> </g> <rect ry="1.5" y="468.34201" x="1168.8524" height="10" width="25" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" /> <text x="1173.3788" y="476.98215" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1173.3788" y="476.98215">-25</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" width="25" height="10" x="1168.8524" y="493.48676" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="502.12689" x="1173.2738"><tspan y="502.12689" x="1173.2738">-50</tspan></text> <rect ry="1.5" y="518.63147" x="1168.8524" height="10" width="25" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" /> <text x="1173.3788" y="527.27161" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1173.3788" y="527.27161">-75</tspan></text> <rect ry="1.5" y="543.77618" x="1168.8524" height="10" width="25" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" /> <text x="1170.0927" y="552.41632" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1170.0927" y="552.41632">-100</tspan></text> <rect ry="1.5" y="568.9209" x="1168.8524" height="10" width="25" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" /> <text x="1170.1976" y="577.56104" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1170.1976" y="577.56104">-125</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="564.98865" x="1165.4271"><tspan y="564.98865" x="1165.4271">-112.5</tspan></text> <text x="1168.6083" y="539.84393" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1168.6083" y="539.84393">-87.5</tspan></text> <text x="1168.6083" y="514.69922" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1168.6083" y="514.69922">-62.5</tspan></text> <text x="1168.6083" y="489.5545" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1168.6083" y="489.5545">-37.5</tspan></text> </svg>',GRAND='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.0" width="1200" height="900"> <g> <g> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,350 H 1200" /> <path d="M 0,325 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,425 H 1200" /> <path d="M 0,400 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,375 H 1200" /> <path d="M 0,500 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,475 H 1200" /> <path d="M 0,450 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,300 H 1200" /> <path d="M 0,275 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,250 H 1200" /> </g> <g transform="translate(0,150)"> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,350 H 1200" /> <path d="M 0,325 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,425 H 1200" /> <path d="M 0,400 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,375 H 1200" /> <path d="M 0,500 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,475 H 1200" /> <path d="M 0,450 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,300 H 1200" /> <path d="M 0,275 H 1200" style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#e4e4e4;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,250 H 1200" /> </g> </g> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,325.00035 H 1200" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,425.00035 H 1200" /> <path d="M 0,375.00034 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,350.00035 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,400.00036 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,475.00035 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="M 0,575.00035 H 1200" style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,525.00034 H 1200" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,500.00035 H 1200" /> <path style="fill:none;stroke:#282828;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 0,550.00036 H 1200" /> <rect ry="0" y="470.00034" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.7529163" y="478.64047" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.7529163" y="478.64047">A</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="495.14505" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="503.78519" x="7.0947132"><tspan y="503.78519" x="7.0947132">F</tspan></text> <rect ry="0" y="520.28979" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.1254749" y="528.92993" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.1254749" y="528.92993">D</tspan></text> <rect ry="0" y="545.43451" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.6039906" y="554.07465" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.6039906" y="554.07465">B</tspan></text> <rect ry="0" y="570.57922" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.4257679" y="579.21936" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.4257679" y="579.21936">G</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="566.64697" x="6.7529163"><tspan y="566.64697" x="6.7529163">A</tspan></text> <text x="6.6699085" y="541.50226" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.6699085" y="541.50226">C</tspan></text> <text x="6.840807" y="516.35754" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.840807" y="516.35754">E</tspan></text> <text x="6.4257679" y="491.21286" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.4257679" y="491.21286">G</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088673" y="320.00034" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="328.64047" x="7.0947146"><tspan y="328.64047" x="7.0947146">F</tspan></text> <rect ry="0" y="345.14505" x="0.17088673" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.1254764" y="353.78519" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.1254764" y="353.78519">D</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088673" y="370.28976" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="378.9299" x="6.603992"><tspan y="378.9299" x="6.603992">B</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088673" y="395.43448" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="404.07462" x="6.4257693"><tspan y="404.07462" x="6.4257693">G</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088673" y="420.57919" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="429.21933" x="6.8408084"><tspan y="429.21933" x="6.8408084">E</tspan></text> <text x="7.0947146" y="416.64694" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="7.0947146" y="416.64694">F</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="391.50223" x="6.7529178"><tspan y="391.50223" x="6.7529178">A</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="366.35754" x="6.66991"><tspan y="366.35754" x="6.66991">C</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="341.21283" x="6.8408084"><tspan y="341.21283" x="6.8408084">E</tspan></text> <rect ry="1.5" y="320.00034" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1171.6967" y="328.64047" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1171.6967" y="328.64047">125</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="1171.3524" y="345.14505" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="353.78519" x="1171.5917"><tspan y="353.78519" x="1171.5917">100</tspan></text> <rect ry="1.5" y="370.28976" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1175.017" y="378.9299" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1175.017" y="378.9299">75</tspan></text> <rect ry="1.5" y="395.43448" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1174.9364" y="404.07462" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1174.9364" y="404.07462">50</tspan></text> <rect ry="1.5" y="420.57919" x="1171.3524" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="1175.0609" y="429.21933" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1175.0609" y="429.21933">25</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="416.64697" x="1170.2758"><tspan y="416.64697" x="1170.2758">37.5</tspan></text> <text x="1170.3075" y="391.50226" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1170.3075" y="391.50226">62.5</tspan></text> <text x="1170.3173" y="366.35754" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1170.3173" y="366.35754">87.5</tspan></text> <text x="1166.9261" y="341.21283" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1166.9261" y="341.21283">112.5</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" width="25" height="10" x="1168.8524" y="468.34247" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="476.9826" x="1173.3788"><tspan y="476.9826" x="1173.3788">-25</tspan></text> <rect ry="1.5" y="493.48721" x="1168.8524" height="10" width="25" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" /> <text x="1173.2738" y="502.12735" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1173.2738" y="502.12735">-50</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" width="25" height="10" x="1168.8524" y="518.63196" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="527.27209" x="1173.3788"><tspan y="527.27209" x="1173.3788">-75</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" width="25" height="10" x="1168.8524" y="543.77667" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="552.41681" x="1170.0927"><tspan y="552.41681" x="1170.0927">-100</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.95534;stroke-linecap:round;stroke-linejoin:round" width="25" height="10" x="1168.8524" y="568.92139" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="577.56152" x="1170.1976"><tspan y="577.56152" x="1170.1976">-125</tspan></text> <text x="1165.4271" y="564.98914" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1165.4271" y="564.98914">-112.5</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="539.84442" x="1168.6083"><tspan y="539.84442" x="1168.6083">-87.5</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="514.69971" x="1168.6083"><tspan y="514.69971" x="1168.6083">-62.5</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="489.55496" x="1168.6083"><tspan y="489.55496" x="1168.6083">-37.5</tspan></text> <rect ry="0" y="445.00034" x="0.17088604" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="0.17088509" y="433.00034" ry="0" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="441.64047" x="6.1254749"><tspan y="441.64047" x="6.1254749">D</tspan></text> <rect ry="0" y="458.14505" x="0.17088509" height="10" width="20" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" /> <text x="6.6039906" y="466.78519" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="6.6039906" y="466.78519">B</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="454.21283" x="6.6699085"><tspan y="454.21283" x="6.6699085">C</tspan></text> <text x="1170.1073" y="441.16016" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none"><tspan x="1170.1073" y="441.16016">12.5</tspan></text> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.74891;stroke-linecap:round;stroke-linejoin:round" width="20" height="10" x="1170.9183" y="444.31479" ry="1.5" /> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="453.10098" x="1178.1737"><tspan y="453.10098" x="1178.1737">0</tspan></text> <text style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:10px;line-height:125%;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;stroke:none" y="465.04178" x="1168.6083"><tspan y="465.04178" x="1168.6083">-12.5</tspan></text> <g style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:186.667px;line-height:270px;font-family:sans-serif;-inkscape-font-specification:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 70.20556,424.33302 q 4.47999,15.67996 4.47999,25.68527 0,7.91465 -5.525321,12.99197 -5.525321,5.07732 -13.43997,5.07732 -7.466649,0 -12.99197,-4.47999 -5.525321,-4.33065 -5.525321,-10.60264 0,-2.09066 0.746665,-4.33065 0.895998,-2.09067 2.090662,-4.032 1.343997,-1.79199 3.285326,-2.98666 2.090662,-1.04533 4.330657,-1.04533 2.98666,0 5.226655,1.49333 2.389328,1.64267 3.583991,4.03199 1.194664,2.38933 1.194664,5.07733 0,9.25864 -10.453309,9.25864 1.343997,1.94133 3.434659,2.98666 2.239995,1.19467 5.226654,1.19467 1.791996,0 3.583992,-0.448 1.791996,-0.29867 3.882658,-1.49333 2.239995,-1.04533 3.882658,-2.83733 1.642663,-1.64266 2.687994,-4.77866 1.045331,-2.98666 1.045331,-7.01865 0,-3.13599 -4.181324,-22.54928 -3.285326,0.896 -8.213315,0.896 -14.4853,0 -24.938609,-10.75198 Q 23.315,404.91973 23.315,389.98643 q 0,-5.22666 1.642663,-10.60264 1.791996,-5.37599 3.882658,-9.40798 2.239995,-4.18133 6.421318,-9.25865 4.330657,-5.22665 7.167984,-8.21331 2.98666,-3.13599 8.213315,-8.36265 -0.895998,-3.13599 -1.49333,-5.82399 -0.597332,-2.83732 -1.045331,-5.67465 -0.447999,-2.83733 -0.746665,-5.52532 -0.149333,-2.68799 -0.149333,-5.37599 0,-13.43997 4.927989,-22.39995 4.927988,-9.10931 9.855977,-9.10931 1.49333,0 3.285326,1.94133 1.941329,1.94133 3.733325,5.37599 1.791996,3.43466 2.98666,9.10931 1.343997,5.52532 1.343997,11.94664 0,23.74394 -16.874629,39.27458 l 3.882658,17.62129 q 1.045331,-0.14933 2.239995,-0.29867 1.194664,-0.14933 2.090662,-0.14933 9.109313,0 15.381298,7.46665 6.271986,7.31732 6.271986,17.91996 -0.149333,17.62129 -16.127963,23.89328 z M 69.010896,313.22927 q 0,-8.21331 -4.778656,-8.21331 -2.687994,0 -5.226655,2.23999 -2.389328,2.24 -4.03199,5.97332 -1.642663,3.58399 -2.687994,8.21332 -0.895998,4.47999 -0.895998,9.10931 0,6.27198 1.941329,10.90131 1.343997,-0.74667 2.687993,-1.94133 1.49333,-1.344 2.837327,-2.83733 1.343997,-1.64266 2.687994,-3.43466 1.343997,-1.94133 2.389328,-3.88266 1.045331,-2.09066 1.941329,-4.18132 1.045331,-2.09066 1.642663,-4.03199 0.746665,-2.09066 1.045331,-4.03199 0.447999,-2.09066 0.447999,-3.88266 z m 10.751975,92.28779 q 0,-5.52532 -2.239995,-9.55731 -2.239994,-4.18133 -6.122652,-6.27199 -3.733325,-2.23999 -8.810647,-2.23999 l 6.719985,33.74925 q 10.453309,-4.33065 10.453309,-15.67996 z m -13.589302,16.57596 -6.869318,-34.34659 q -2.687994,0.59734 -5.226654,2.688 -2.389328,1.94133 -4.031991,4.92799 -1.49333,2.83732 -1.49333,5.67465 0,1.64266 0.447999,3.28533 0.597332,1.64266 1.343997,2.83732 0.746665,1.19467 1.642663,2.38933 0.895998,1.19467 1.791996,1.94133 1.045331,0.74666 1.791995,1.344 0.746665,0.59733 1.194664,0.89599 0.597332,0.29867 0.597332,0.29867 l -1.194664,0.74667 q -2.837326,-0.896 -5.823986,-2.83733 -2.837327,-1.94133 -5.375988,-5.97332 -2.538661,-4.03199 -2.538661,-8.81065 0,-4.77865 2.239995,-9.25864 2.239995,-4.47999 5.375988,-7.31732 3.135993,-2.98666 6.570651,-4.18132 L 53.928264,360.4185 q -23.44528,19.56262 -23.44528,37.78124 0,10.90131 8.213314,18.21863 8.213315,7.31732 18.666624,7.31732 2.538661,0 8.810647,-1.64267 z" style="font-size:149.333px" /> </g> <g style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:149.333px;line-height:216px;font-family:sans-serif;-inkscape-font-specification:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 96.338834,481.17377 q 2.687994,0 4.479986,1.94133 1.94133,1.94133 1.94133,4.47999 0,2.53866 -2.09066,4.47999 -2.090661,1.94133 -4.479989,1.94133 -6.271985,0 -6.271985,-6.71998 0,-2.688 1.941328,-4.33066 1.941329,-1.792 4.47999,-1.792 z m -4.629322,30.7626 q 1.941328,-1.94133 4.629322,-1.94133 2.687994,0 4.479986,2.09066 1.94133,2.09066 1.94133,4.18133 0,2.83732 -1.94133,4.77865 -1.941325,1.94133 -4.479986,1.94133 -6.421318,0 -6.421318,-6.71998 0,-2.38933 1.791996,-4.33066 z M 54.674929,473.25912 q 12.095973,0 20.309287,8.36265 8.213315,8.21332 8.213315,19.71196 0,5.67465 -1.642663,11.05064 -1.49333,5.37599 -4.927989,10.30397 -3.434659,4.77866 -6.869317,8.81065 -3.434659,4.03199 -8.95998,8.06398 -5.525321,4.03199 -9.258645,6.86932 -3.733325,2.68799 -10.154644,6.12265 -6.271986,3.43466 -9.109313,4.92799 -2.687993,1.344 -8.213314,4.03199 l -0.746665,-2.38933 q 0.149333,-0.14933 4.031991,-2.68799 3.882658,-2.53866 6.271985,-4.03199 2.389328,-1.64266 7.018651,-5.37599 4.778656,-3.73332 7.914649,-6.86932 3.135993,-3.28532 7.01865,-8.06398 4.031991,-4.92799 6.421319,-9.55731 2.389328,-4.62932 4.031991,-10.60264 1.791996,-5.97332 1.791996,-11.94664 0,-23.44528 -16.575962,-23.44528 -5.525321,0 -9.407979,1.49333 -3.882658,1.344 -5.674654,3.43466 -1.642663,2.09066 -2.389328,3.73332 -0.746665,1.49333 -0.746665,2.688 0,2.23999 2.98666,2.23999 1.194664,0 2.837327,-0.448 1.642663,-0.59733 2.239995,-0.59733 4.031991,0 6.719985,2.53866 2.687994,2.53866 2.687994,6.27199 0,4.33065 -3.285326,7.16798 -3.285326,2.83733 -7.765316,2.83733 -5.823987,0 -9.557311,-3.43466 -3.733325,-3.43466 -3.733325,-8.81065 0,-9.85597 8.362647,-16.12796 8.511981,-6.27199 20.159954,-6.27199 z" style="font-size:149.333px" /> </g> </svg>',CANCELBUTTON='<?xml version="1.0" ?><svg enable-background="new 0 0 55.125 55" height="55px" version="1.1" viewBox="0 0 55.125 55" width="55.125px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><g display="block" id="dialog-cancel"> <path d="M27.557,5.053c-12.43,0-22.5,10.076-22.5,22.497c0,12.432,10.07,22.503,22.5,22.503 c12.431,0,22.5-10.071,22.5-22.503C50.057,15.129,39.987,5.053,27.557,5.053z M37.756,33.212c1.254,1.256,1.257,3.291,0,4.545 c-0.628,0.629-1.451,0.943-2.274,0.943c-0.822,0-1.644-0.314-2.27-0.94l-5.76-5.761l-5.76,5.761 c-0.627,0.626-1.449,0.94-2.271,0.94c-0.823,0-1.647-0.314-2.275-0.943c-1.254-1.254-1.254-3.289,0.004-4.545l5.758-5.758 l-5.758-5.758c-1.258-1.254-1.258-3.292-0.004-4.546c1.255-1.254,3.292-1.259,4.546,0l5.76,5.759l5.76-5.759 c1.252-1.259,3.288-1.254,4.544,0c1.257,1.254,1.254,3.292,0,4.546l-5.758,5.758L37.756,33.212z" display="inline" fill="#c0c0c0"/> </g></svg>',STOPTURTLEBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path id="path2" fill="none" d="M0 0h24v24H0z" /> <path style="fill:#292929;fill-opacity:0.4;" id="path4" d="M 6,6 H 18 V 18 H 6 Z" /></svg>',NEWBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path id="path2" fill="none" d="M0 0h24v24H0z" /> <path style="fill:#292929;fill-opacity:0.4;" id="path4" d="M 14,2 H 6 C 4.9,2 4.01,2.9 4.01,4 L 4,20 c 0,1.1 0.89,2 1.99,2 H 18 c 1.1,0 2,-0.9 2,-2 V 8 Z m 2,14 h -3 v 3 H 11 V 16 H 8 v -2 h 3 v -3 h 2 v 3 h 3 z M 13,9 V 3.5 L 18.5,9 Z" /></svg>',LOADBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path style="fill:#292929;fill-opacity:0.4;" id="path2" d="M 10,4 H 4 C 2.9,4 2.01,4.9 2.01,6 L 2,18 c 0,1.1 0.9,2 2,2 h 16 c 1.1,0 2,-0.9 2,-2 V 8 C 22,6.9 21.1,6 20,6 h -8 z" /> <path id="path4" fill="none" d="M0 0h24v24H0z" /></svg>',OPENMERGEBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg viewBox="0 0 54.999998 55" version="1.1" id="svg8" width="55" height="55" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs23" /> <g id="g4402" transform="translate(-0.00690978,3.2337309)"> <path style="fill:#292929;fill-opacity:0.4;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="M 20.199791,15.5 H 25.5 V 22 L 14.794251,39.025767 17.205149,40.573764 28.5,22 V 15.5 H 34 L 27.5,8 Z" id="path977" /> <path style="fill:#292929;fill-opacity:0.4;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="M 30.504985,24.660265 40.205749,39.025767 37.794851,40.573764 28.853414,27.51107 Z" id="path977-3" /> </g> </svg>',OPENBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg8" version="1.1" viewBox="0 0 54.999998 55"> <g transform="matrix(2.4725237,0,0,2.4725237,5.0000683,9.3764013)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="M 16.38,12.79 H 1.82 V 3.65 h 14.56 z m 0,-11 H 9.1 L 7.28,0 H 1.82 A 1.82,1.82 0 0 0 0,1.83 v 11 a 1.84,1.84 0 0 0 1.82,1.83 H 16.38 A 1.84,1.84 0 0 0 18.2,12.83 V 3.65 A 1.83,1.83 0 0 0 16.38,1.83 Z" /> </g> </g> </svg>',SAVEBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path style="fill:#292929;fill-opacity:0.4;" id="path2" d="m 19,12 v 7 H 5 V 12 H 3 v 7 c 0,1.1 0.9,2 2,2 h 14 c 1.1,0 2,-0.9 2,-2 v -7 z m -6,0.67 2.59,-2.58 1.41,1.41 -5,5 -5,-5 1.41,-1.41 2.59,2.58 V 3 h 2 z" /> <path id="path4" d="M0 0h24v24H0z" fill="none" /></svg>',PLANETBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path id="path2" fill="none" d="M0 0h24v24H0z" /> <path style="fill:#292929;fill-opacity:0.4;" id="path4" d="M 12,2 C 6.48,2 2,6.48 2,12 2,17.52 6.48,22 12,22 17.52,22 22,17.52 22,12 22,6.48 17.52,2 12,2 Z M 11,19.93 C 7.05,19.44 4,16.08 4,12 4,11.38 4.08,10.79 4.21,10.21 L 9,15 v 1 c 0,1.1 0.9,2 2,2 z m 6.9,-2.54 C 17.64,16.58 16.9,16 16,16 h -1 v -3 c 0,-0.55 -0.45,-1 -1,-1 H 8 v -2 h 2 c 0.55,0 1,-0.45 1,-1 V 7 h 2 c 1.1,0 2,-0.9 2,-2 V 4.59 c 2.93,1.19 5,4.06 5,7.41 0,2.08 -0.8,3.97 -2.1,5.39 z" /></svg>',HELPBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path id="path2" fill="none" d="M0 0h24v24H0z" /> <path style="fill:#292929;fill-opacity:0.4;" id="path4" d="M 12,2 C 6.48,2 2,6.48 2,12 2,17.52 6.48,22 12,22 17.52,22 22,17.52 22,12 22,6.48 17.52,2 12,2 Z m 1,17 h -2 v -2 h 2 z m 2.07,-7.75 -0.9,0.92 C 13.45,12.9 13,13.5 13,15 h -2 v -0.5 c 0,-1.1 0.45,-2.1 1.17,-2.83 l 1.24,-1.26 C 13.78,10.05 14,9.55 14,9 14,7.9 13.1,7 12,7 10.9,7 10,7.9 10,9 H 8 c 0,-2.21 1.79,-4 4,-4 2.21,0 4,1.79 4,4 0,0.88 -0.36,1.68 -0.93,2.25 z" /></svg>',SLOWBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path id="path2" fill="none" d="M0 0h24v24H0z" /> <path style="fill:#292929;fill-opacity:0.4;" id="path4" d="M 10,16.5 16,12 10,7.5 Z M 12,2 C 6.48,2 2,6.48 2,12 2,17.52 6.48,22 12,22 17.52,22 22,17.52 22,12 22,6.48 17.52,2 12,2 Z m 0,18 C 7.59,20 4,16.41 4,12 4,7.59 7.59,4 12,4 c 4.41,0 8,3.59 8,8 0,4.41 -3.59,8 -8,8 z" /></svg>',SHOWBLOCKSBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 42" version="1.1" id="svg10" width="42" height="42"> <rect width="42" height="42" rx="5" ry="5" style="opacity:0.4;isolation:isolate;mix-blend-mode:multiply;fill:#292929" id="rect4" x="0" y="0" /> <g style="fill:#ffffff" id="レイヤー_2" data-name="レイヤー 2" transform="matrix(1.8,0,0,1.8,3,6.375)"> <g style="fill:#ffffff" id="Icon"> <path d="M 10,5.54 A 2.59,2.59 0 1 0 12.58,8.12 2.58,2.58 0 0 0 10,5.54 Z m 0,3.84 A 1.26,1.26 0 1 1 11.25,8.12 1.25,1.25 0 0 1 10,9.38 Z" style="fill:#ffffff" id="path4" /> <path d="M 17.5,0 H 11.25 V 2.5 H 3.75 V 0 H 2.5 A 2.5,2.5 0 0 0 0,2.5 v 8.75 a 2.5,2.5 0 0 0 2.5,2.5 h 1.25 v 2.5 h 7.5 v -2.5 H 17.5 A 2.5,2.5 0 0 0 20,11.25 V 2.5 A 2.5,2.5 0 0 0 17.5,0 Z m -1.77,8.9 a 7.28,7.28 0 0 1 -5.73,3 7.28,7.28 0 0 1 -5.73,-3 1.25,1.25 0 0 1 0,-1.55 7.28,7.28 0 0 1 5.73,-3 7.28,7.28 0 0 1 5.73,3 1.25,1.25 0 0 1 0,1.55 z" style="fill:#ffffff" id="path6" /> </g> </g> </svg>',HIDEBLOCKSBUTTON=SHOWBLOCKSBUTTON,HIDEBLOCKSFADEDBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42 42" version="1.1" id="svg10" width="42" height="42"> <rect width="42" height="42" rx="5" ry="5" style="opacity:0.4;isolation:isolate;mix-blend-mode:multiply;fill:#ff2929" id="rect4" x="0" y="0" /> <g style="fill:#ffffff" id="レイヤー_2" data-name="レイヤー 2" transform="matrix(1.8,0,0,1.8,3,6.375)"> <g style="fill:#ffffff" id="Icon"> <path d="M 10,5.54 A 2.59,2.59 0 1 0 12.58,8.12 2.58,2.58 0 0 0 10,5.54 Z m 0,3.84 A 1.26,1.26 0 1 1 11.25,8.12 1.25,1.25 0 0 1 10,9.38 Z" style="fill:#ffffff" id="path4" /> <path d="M 17.5,0 H 11.25 V 2.5 H 3.75 V 0 H 2.5 A 2.5,2.5 0 0 0 0,2.5 v 8.75 a 2.5,2.5 0 0 0 2.5,2.5 h 1.25 v 2.5 h 7.5 v -2.5 H 17.5 A 2.5,2.5 0 0 0 20,11.25 V 2.5 A 2.5,2.5 0 0 0 17.5,0 Z m -1.77,8.9 a 7.28,7.28 0 0 1 -5.73,3 7.28,7.28 0 0 1 -5.73,-3 1.25,1.25 0 0 1 0,-1.55 7.28,7.28 0 0 1 5.73,-3 7.28,7.28 0 0 1 5.73,3 1.25,1.25 0 0 1 0,1.55 z" style="fill:#ffffff" id="path6" /> </g> </g> </svg>',ENLARGEBLOCKSBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="42" width="42" id="svg8" version="1.1" viewBox="0 0 42 42"> <rect width="42" height="42" rx="5" ry="5" style="opacity:0.4;isolation:isolate;mix-blend-mode:multiply;fill:#292929" id="rect4" x="0" y="0" /> <g style="fill:#ffffff" id="レイヤー_2" data-name="レイヤー 2" transform="matrix(1.8,0,0,1.8,3,6.375)"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="M 17.5,0 H 11.25 V 2.5 H 3.75 V 0 H 2.5 A 2.5,2.5 0 0 0 0,2.5 v 8.75 a 2.5,2.5 0 0 0 2.5,2.5 h 1.25 v 2.5 h 7.5 v -2.5 H 17.5 A 2.5,2.5 0 0 0 20,11.25 V 2.5 A 2.5,2.5 0 0 0 17.5,0 Z M 11,6.66 12.68,5 h -0.91 a 0.43,0.43 0 1 1 0,-0.85 h 1.91 a 0.44,0.44 0 0 1 0.44,0.43 v 0 1.89 A 0.43,0.43 0 0 1 13.7,6.91 0.43,0.43 0 0 1 13.28,6.47 V 5.55 l -1.69,1.7 a 0.43,0.43 0 0 1 -0.6,0 A 0.42,0.42 0 0 1 11,6.66 Z M 9.26,9.34 7.57,11 h 0.91 a 0.44,0.44 0 0 1 0.45,0.43 0.44,0.44 0 0 1 -0.45,0.42 H 6.57 A 0.43,0.43 0 0 1 6.13,11.43 V 9.52 A 0.43,0.43 0 0 1 6.55,9.08 0.43,0.43 0 0 1 7,9.52 v 0.92 l 1.69,-1.7 a 0.42426407,0.42426407 0 1 1 0.6,0.6 z m 0,-2.09 a 0.43,0.43 0 0 1 -0.6,0 L 7,5.55 V 6.47 A 0.43,0.43 0 0 1 6.58,6.91 0.43,0.43 0 0 1 6.16,6.47 V 4.59 c 0,0 0,0 0,0 v 0 A 0.44,0.44 0 0 1 6.6,4.16 h 1.88 a 0.43,0.43 0 1 1 0,0.85 H 7.57 l 1.69,1.65 a 0.42,0.42 0 0 1 0,0.59 z m 4.87,4.15 v 0 a 0.45,0.45 0 0 1 -0.45,0.42 h -1.91 a 0.44,0.44 0 0 1 -0.45,-0.42 0.44,0.44 0 0 1 0.45,-0.43 h 0.91 L 11,9.34 a 0.42426407,0.42426407 0 1 1 0.6,-0.6 l 1.69,1.7 V 9.52 a 0.43,0.43 0 0 1 0.42,-0.44 0.43,0.43 0 0 1 0.42,0.44 v 0 z" /> </g> </g> </svg>',COLLAPSEBLOCKSBUTTON=ENLARGEBLOCKSBUTTON,UTILITYBUTTONGEAR='<svg xmlns="http://www.w3.org/2000/svg" width="55" height="55"> <g transform="matrix(0.64,0,0,0.63959066,9.90448,9.9400384)" > <polygon points="26.891,12.363 17.238,16.369 14.659,4.975 20.555,2.531 " style="fill:#ffffff" /> <polygon points="42.646,26.88 38.649,17.228 50.04,14.654 52.477,20.55 " style="fill:#ffffff" /> <polygon points="28.117,42.645 37.775,38.645 40.349,50.029 34.453,52.471 " style="fill:#ffffff" /> <polygon points="37.824,16.315 28.171,12.309 34.394,2.439 40.295,4.882 " style="fill:#ffffff" /> <polygon points="38.628,37.791 42.623,28.139 52.493,34.365 50.055,40.258 " style="fill:#ffffff" /> <polygon points="16.385,37.76 12.391,28.105 2.515,34.34 4.953,40.234 " style="fill:#ffffff" /> <polygon points="12.319,26.875 16.32,17.216 4.936,14.643 2.493,20.539 " style="fill:#ffffff" /> <polygon points="26.939,42.623 17.287,38.629 14.719,50.018 20.609,52.461 " style="fill:#ffffff" /> <path d="m 39.925,22.352 c 2.845,6.863 -0.412,14.728 -7.274,17.574 -6.867,2.85 -14.734,-0.418 -17.578,-7.281 -2.84,-6.862 0.418,-14.733 7.279,-17.572 6.862,-2.845 14.734,0.417 17.573,7.279 z" style="fill:none;stroke:#ffffff;stroke-width:11.69439983" /> </g> </svg> ',UTILITYBUTTONSPANNER='<?xml version="1.0" ?><svg enable-background="new 0 0 55 55" height="55px" id="Layer_1" style="" version="1.1" viewBox="0 0 55 55" width="55px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><g display="block" id="preferences-system" style=""> <path d="M51.103,50.895c-2.343,2.343-6.143,2.343-8.485,0L19.813,28.091c-2.343-2.343-2.343-6.143,0-8.485l0,0 c2.343-2.343,6.143-2.343,8.485,0l22.804,22.804C53.445,44.752,53.445,48.552,51.103,50.895L51.103,50.895z" fill="#ffffff" style=""/> <g style=""> <g style=""> <path d="M17.813,2.254c-0.804,0-1.587,0.081-2.358,0.2l10.557,10.558L13.22,25.804L2.662,15.246 c-0.119,0.771-0.2,1.555-0.2,2.36c0,8.479,6.873,15.352,15.351,15.352s15.351-6.873,15.351-15.352 C33.164,9.127,26.291,2.254,17.813,2.254z" fill="#ffffff" style=""/> </g> </g> </g></svg>',UTILITYBUTTON=UTILITYBUTTONGEAR,WRAPTURTLEBUTTON='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#292929" fill-opacity="0.4" width="18px" height="18px"><path d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3 3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',RESTORETRASHBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path style="fill:#292929;fill-opacity:0.4" id="path2" d="m 19,4 h -3.5 l -1,-1 h -5 l -1,1 H 5 V 6 H 19 Z M 6,7 v 12 c 0,1.1 0.9,2 2,2 h 8 c 1.1,0 2,-0.9 2,-2 V 7 Z m 8,7 v 4 H 10 V 14 H 8 l 4,-4 4,4 z" /> <path id="path4" d="M0 0h24v24H0z" fill="none" /></svg>',MENUBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path style="fill:#292929;fill-opacity:0.4;" id="path2" d="m 2,15.5 v 2 h 20 v -2 z m 0,-5 v 2 h 20 v -2 z m 0,-5 v 2 h 20 v -2 z" /> <path id="path4" fill="none" d="M0 0h24v24H0z" /></svg>',GOHOMEFADEDBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="42" height="42" id="svg2" version="1.1"> <rect width="42" height="42" rx="5" ry="5" style="opacity:0.4;isolation:isolate;mix-blend-mode:multiply;fill:#292929" id="rect834" x="0" y="0" /> <g transform="matrix(0.82936636,0,0,0.82936636,-1.8075749,-1.8075749)" id="g830"> <rect style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:none;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:4.5, 4.5;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="rect4167" width="43.406631" height="43.406631" x="5.7966843" y="5.7966843" /> <g id="go-home" transform="matrix(0.75032224,0,0,0.75032224,6.5269987,7.2064703)"> <path id="path874" d="M 27.5,15.96256 8.48131,32.4005 8.55256,48.0374 17,48.0052 V 30.9243 h 9 v 17.0809 h 21.59 l -0.1679,-15.726 z m 4,14.96174 h 8 v 8 h -8 z" style="fill:#ffffff;stroke:none;stroke-width:3.5;stroke-linecap:round" /> <path id="path876" d="M 5.48131,27.4005 27.5,8.96256 l 11.3997,9.11494 -0.036,-8.81628 4.0299,0.01041 -0.0104,12.05297 7.5389,5.9546" style="fill:none;stroke:#ffffff;stroke-width:4.5;stroke-linecap:round" /> </g> </g> </svg>',GOHOMEBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="42" height="42" id="svg2" version="1.1"> <rect width="42" height="42" rx="5" ry="5" style="opacity:0.4;isolation:isolate;mix-blend-mode:multiply;fill:#292929;" id="rect834" x="0" y="0" /> <g transform="matrix(0.82936636,0,0,0.82936636,-1.8075749,-1.8075749)" id="g830"> <rect style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:none;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:4.5, 4.5;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="rect4167" width="43.406631" height="43.406631" x="5.7966843" y="5.7966843" /> <g id="go-home" transform="matrix(0.75032224,0,0,0.75032224,6.5269987,7.2064703)"> <path id="path874" d="M 27.5,15.96256 8.48131,32.4005 8.55256,48.0374 17,48.0052 V 30.9243 h 9 v 17.0809 h 21.59 l -0.1679,-15.726 z m 4,14.96174 h 8 v 8 h -8 z" style="fill:#ffffff;stroke:none;stroke-width:3.5;stroke-linecap:round" /> <path id="path876" d="M 5.48131,27.4005 27.5,8.96256 l 11.3997,9.11494 -0.036,-8.81628 4.0299,0.01041 -0.0104,12.05297 7.5389,5.9546" style="fill:none;stroke:#ffffff;stroke-width:4.5;stroke-linecap:round" /> </g> </g> </svg>',SAVEDARKBUTTON=SAVEBUTTON,UPLOADPLANETBUTTON='<svg width="55.000001" height="55.000001" xmlns="http://www.w3.org/2000/svg"> <g> <title>background</title> <rect fill="none" id="canvas_background" height="402" width="582" y="-1" x="-1"/> </g> <g> <title>Layer 1</title> <g id="layer1"> <path fill="#ffffff" id="path4214" d="m23.766615,3.567021c-11.002951,0 -19.93288,8.930108 -19.93288,19.932983c0,11.002991 8.92993,19.932861 19.93288,19.932861c11.002951,0 19.932882,-8.929871 19.932882,-19.932861c0,-11.002875 -8.929932,-19.932983 -19.932882,-19.932983zm-1.99329,35.739723c-7.873482,-0.976681 -13.953011,-7.674141 -13.953011,-15.80674c0,-1.23579 0.15946,-2.411934 0.418591,-3.567963l9.54785,9.547913l0,1.99324c0,2.192646 1.793961,3.986477 3.98657,3.986477l0,3.847073zm13.753691,-5.06292c-0.51825,-1.614544 -1.99329,-2.77063 -3.787251,-2.77063l-1.993279,0l0,-5.979836c0,-1.096439 -0.896982,-1.993355 -1.99329,-1.993355l-11.959732,0l0,-3.986599l3.98658,0c1.09631,0 1.99328,-0.896915 1.99328,-1.993298l0,-3.986478l3.98658,0c2.192621,0 3.986582,-1.794008 3.986582,-3.986714l0,-0.817154c5.840328,2.372054 9.966438,8.092779 9.966438,14.770243c0,4.146004 -1.594627,7.913311 -4.185909,10.74382z"/> </g> <polyline fill="none" points="11.386,18.559 20.773,18.559 20.773,9.173 " id="polyline3009"/> <line fill="none" stroke="#ffffff" stroke-width="2.9867" stroke-linecap="round" stroke-linejoin="round" x1="44.994993" x2="44.994993" y1="50.749995" y2="38.833995" id="line3011"/> <polyline transform="rotate(180, 44.995, 39.2853)" fill="none" stroke="#ffffff" stroke-width="2.9867" stroke-linecap="round" stroke-linejoin="round" points="50.1249942779541,36.243345975875854 44.99499320983887,42.32734560966492 39.8649959564209,36.243345975875854 " id="polyline3013"/> </g> </svg>',PLANETDISABLEDBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 55 55" height="55" width="55"> <path id="path2" fill="none" d="M0 0h24v24h-24z" /> <path style="fill:#e3e3e3" id="path4" transform="scale(2.29)" d="M12 2c-5.52 0-10 4.48-10 10s4.48 10 10 10 10-4.48 10-10-4.48-10-10-10zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79l4.79 4.79v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1h-6v-2h2c.55 0 1-.45 1-1v-2h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" /> </svg> ',SAVESVGBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg18" version="1.1" viewBox="0 0 54.999998 54.999999"> <g transform="matrix(2.0347429,0,0,2.0347429,6.5319066,5.0321823)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="M 0.82,5.55 A 0.84,0.84 0 0 1 1.65,6.38 0.83,0.83 0 0 1 0.82,7.2 0.82,0.82 0 0 1 0,6.38 0.83,0.83 0 0 1 0.82,5.55 Z" /> <path id="path6" style="fill:#ffffff" d="M 2.5,6.12 2.86,5.5 A 0.23,0.23 0 0 1 3.2,5.43 3.31,3.31 0 0 0 4.71,6.05 0.83,0.83 0 0 0 5.62,5.28 C 5.62,4.77 5.19,4.42 4.35,4.08 3.51,3.74 2.47,3.08 2.47,1.92 A 2,2 0 0 1 4.72,0 3.52,3.52 0 0 1 6.72,0.67 0.25,0.25 0 0 1 6.78,1 L 6.4,1.57 A 0.26,0.26 0 0 1 6.05,1.69 3.29,3.29 0 0 0 4.66,1.14 0.8,0.8 0 0 0 3.78,1.84 c 0,0.47 0.37,0.79 1.18,1.12 1,0.39 2.09,1 2.09,2.26 a 2.11,2.11 0 0 1 -2.3,2 3.22,3.22 0 0 1 -2.2,-0.78 C 2.46,6.33 2.41,6.28 2.5,6.12 Z" /> <path id="path8" style="fill:#ffffff" d="M 7.42,0.36 A 0.18,0.18 0 0 1 7.59,0.1 h 1 a 0.18,0.18 0 0 1 0.17,0.11 l 1.92,4.3 h 0.07 l 1.94,-4.3 A 0.18,0.18 0 0 1 12.86,0.1 h 1 a 0.18,0.18 0 0 1 0.17,0.26 L 11,7.09 A 0.18,0.18 0 0 1 10.83,7.2 h -0.1 A 0.18,0.18 0 0 1 10.56,7.09 Z" /> <path id="path10" style="fill:#ffffff" d="m 18.05,0 a 3.78,3.78 0 0 1 2.44,0.93 0.19,0.19 0 0 1 0,0.28 l -0.62,0.65 a 0.17,0.17 0 0 1 -0.26,0 A 2.27,2.27 0 0 0 18.1,1.28 2.29,2.29 0 0 0 15.87,3.6 2.27,2.27 0 0 0 18.12,5.89 3.13,3.13 0 0 0 19.31,5.64 V 4.79 h -0.8 A 0.18,0.18 0 0 1 18.32,4.61 V 3.82 a 0.18,0.18 0 0 1 0.19,-0.19 h 1.92 a 0.19,0.19 0 0 1 0.18,0.19 v 2.56 a 0.19,0.19 0 0 1 -0.08,0.16 5.05,5.05 0 0 1 -2.48,0.65 3.6,3.6 0 0 1 0,-7.19 z" /> <path id="path12" style="fill:#ffffff" d="m 18.41,10.1 h -16 a 1,1 0 0 0 -1,1 v 10 a 1,1 0 0 0 1,1 h 16 a 1,1 0 0 0 1,-1 v -10 a 1,1 0 0 0 -1,-1 z m -4,4 -4.5,4.5 -0.5,-0.5 -2,-2 -4.71,4.7 A 1,1 0 0 1 2.41,20.1 v -8 a 1,1 0 0 1 1,-1 h 14 a 1,1 0 0 1 1,1 v 6 z" /> <circle id="circle14" style="fill:#ffffff" r="1" cy="13.6" cx="5.9099998" /> </g> </g> </svg>',SAVEPNGBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg18" version="1.1" viewBox="0 0 55.000002 54.999999"> <g transform="matrix(2.0361991,0,0,2.0361991,4.9184841,4.9999999)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="M 0.82,5.55 A 0.84,0.84 0 0 1 1.65,6.38 0.83,0.83 0 0 1 0.82,7.2 0.82,0.82 0 0 1 0,6.38 0.83,0.83 0 0 1 0.82,5.55 Z" /> <path id="path6" style="fill:#ffffff" d="M 2.91,0.29 A 0.19,0.19 0 0 1 3.1,0.1 H 5.45 A 2.24,2.24 0 0 1 7.69,2.31 2.25,2.25 0 0 1 5.46,4.56 H 4.21 V 6.91 A 0.2,0.2 0 0 1 4,7.1 H 3.1 A 0.19,0.19 0 0 1 2.91,6.91 Z m 2.46,3.05 a 1,1 0 0 0 1,-1 1,1 0 0 0 -1,-1 H 4.21 v 2 z" /> <path id="path8" style="fill:#ffffff" d="M 8.83,0.18 A 0.19,0.19 0 0 1 9,0 h 0.25 l 4.16,4.42 v 0 -4.13 A 0.19,0.19 0 0 1 13.63,0.1 h 0.92 a 0.2,0.2 0 0 1 0.19,0.19 V 7 A 0.19,0.19 0 0 1 14.55,7.18 H 14.31 L 10.13,2.61 v 0 4.3 A 0.19,0.19 0 0 1 9.94,7.1 H 9 A 0.2,0.2 0 0 1 8.81,6.91 Z" /> <path id="path10" style="fill:#ffffff" d="m 19.65,0 a 3.78,3.78 0 0 1 2.44,0.93 0.19,0.19 0 0 1 0,0.28 l -0.62,0.65 a 0.17,0.17 0 0 1 -0.26,0 A 2.27,2.27 0 0 0 19.7,1.28 2.29,2.29 0 0 0 17.47,3.6 2.27,2.27 0 0 0 19.72,5.89 3.13,3.13 0 0 0 20.91,5.64 V 4.79 h -0.8 A 0.18,0.18 0 0 1 19.92,4.61 V 3.82 A 0.18,0.18 0 0 1 20.11,3.63 H 22 a 0.19,0.19 0 0 1 0.18,0.19 V 6.38 A 0.19,0.19 0 0 1 22.1,6.54 5.05,5.05 0 0 1 19.62,7.19 3.6,3.6 0 0 1 19.62,0 Z" /> <path id="path12" style="fill:#ffffff" d="m 19.21,10.1 h -16 a 1,1 0 0 0 -1,1 v 10 a 1,1 0 0 0 1,1 h 16 a 1,1 0 0 0 1,-1 v -10 a 1,1 0 0 0 -1,-1 z m -4,4 -4.5,4.5 -0.5,-0.5 -2,-2 -4.71,4.7 A 1,1 0 0 1 3.21,20.1 v -8 a 1,1 0 0 1 1,-1 h 14 a 1,1 0 0 1 1,1 v 6 z" /> <circle id="circle14" style="fill:#ffffff" r="1" cy="13.6" cx="6.71" /> </g> </g> </svg>',SAVEWAVBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg16" version="1.1" viewBox="0 0 54.999999 54.999999"> <g transform="matrix(2.0472243,0,0,2.0472243,2.6785688,5.0020095)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="M 0.82,5.55 A 0.84,0.84 0 0 1 1.65,6.38 0.83,0.83 0 0 1 0.82,7.2 0.82,0.82 0 0 1 0,6.38 0.83,0.83 0 0 1 0.82,5.55 Z" /> <path id="path6" style="fill:#ffffff" d="M 2.29,0.34 A 0.17,0.17 0 0 1 2.47,0.1 h 0.92 a 0.21,0.21 0 0 1 0.18,0.14 l 1,4 v 0 L 6.24,0.11 A 0.16,0.16 0 0 1 6.41,0 h 0.18 a 0.16,0.16 0 0 1 0.17,0.11 l 1.6,4.12 v 0 l 1,-4 A 0.21,0.21 0 0 1 9.6,0.1 h 0.92 A 0.17,0.17 0 0 1 10.7,0.34 L 8.81,7.06 A 0.19,0.19 0 0 1 8.63,7.2 H 8.47 A 0.17,0.17 0 0 1 8.3,7.09 L 6.51,2.56 v 0 L 4.69,7.09 A 0.17,0.17 0 0 1 4.52,7.2 H 4.36 A 0.19,0.19 0 0 1 4.18,7.06 Z" /> <path id="path8" style="fill:#ffffff" d="M 11,6.84 14.1,0.11 A 0.18,0.18 0 0 1 14.27,0 h 0.1 a 0.17,0.17 0 0 1 0.17,0.11 l 3.08,6.73 A 0.18,0.18 0 0 1 17.45,7.1 H 16.58 A 0.29,0.29 0 0 1 16.29,6.9 L 15.8,5.82 h -3 L 12.32,6.9 A 0.3,0.3 0 0 1 12.03,7.1 H 11.16 A 0.18,0.18 0 0 1 11,6.84 Z m 4.32,-2.13 -1,-2.2 v 0 l -1,2.2 z" /> <path id="path10" style="fill:#ffffff" d="M 17.62,0.36 A 0.18,0.18 0 0 1 17.79,0.1 h 1 A 0.18,0.18 0 0 1 19,0.21 l 1.92,4.3 H 21 l 1.89,-4.3 A 0.18,0.18 0 0 1 23.06,0.1 h 1 a 0.18,0.18 0 0 1 0.17,0.26 l -3.1,6.73 A 0.18,0.18 0 0 1 21,7.2 H 20.9 A 0.18,0.18 0 0 1 20.73,7.09 Z" /> <path id="path12" style="fill:#ffffff" d="M 17,9.22 H 8.17 V 17 A 2.72,2.72 0 0 0 6.51,16.44 2.77,2.77 0 1 0 9.28,19.2 V 13.64 H 17 V 17 a 2.76,2.76 0 1 0 1.1,2.2 v -10 z" /> </g> </g> </svg>',SAVELILYPONDBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg34" version="1.1" viewBox="0 0 55.000001 55"> <g transform="matrix(1.914129,0,0,1.914129,5.0281255,4.9999999)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="M 18.2,10 H 8.8 v 8.23 a 2.9,2.9 0 0 0 -1.8,-0.6 2.94,2.94 0 1 0 3,2.93 v -5.87 h 8.2 v 3.54 a 2.93,2.93 0 1 0 1.17,2.33 V 10 Z" /> <path id="path6" style="fill:#ffffff" d="m 23.48,11.76 a 0.58,0.58 0 0 0 -0.59,-0.59 h -2.35 v 1.17 h 2.35 a 0.58,0.58 0 0 0 0.59,-0.58 z" /> <path id="path8" style="fill:#ffffff" d="m 22.89,13.52 h -2.35 v 1.17 h 2.35 a 0.59,0.59 0 1 0 0,-1.17 z" /> <path id="path10" style="fill:#ffffff" d="M 22.89,15.87 H 20.54 V 17 h 2.35 a 0.59,0.59 0 1 0 0,-1.17 z" /> <path id="path12" style="fill:#ffffff" d="m 22.89,18.21 h -2.35 v 1.18 h 2.35 a 0.59,0.59 0 1 0 0,-1.18 z" /> <path id="path14" style="fill:#ffffff" d="m 22.89,20.56 h -2.35 v 1.18 h 2.35 a 0.59,0.59 0 0 0 0.59,-0.59 0.58,0.58 0 0 0 -0.59,-0.59 z" /> <path id="path16" style="fill:#ffffff" d="m 0.59,11.17 a 0.59,0.59 0 1 0 0,1.17 h 7 v -1.17 z" /> <path id="path18" style="fill:#ffffff" d="m 0,14.1 a 0.58,0.58 0 0 0 0.59,0.59 h 7 v -1.17 h -7 A 0.58,0.58 0 0 0 0,14.1 Z" /> <path id="path20" style="fill:#ffffff" d="M 0,16.45 A 0.58,0.58 0 0 0 0.59,17 h 7 v -1.13 h -7 A 0.58,0.58 0 0 0 0,16.45 Z" /> <path id="path22" style="fill:#ffffff" d="m 0,18.8 a 0.59,0.59 0 0 0 0.59,0.59 H 2.93 V 18.21 H 0.59 A 0.59,0.59 0 0 0 0,18.8 Z" /> <path id="path24" style="fill:#ffffff" d="m 0,21.15 a 0.59,0.59 0 0 0 0.59,0.59 H 2.93 V 20.56 H 0.59 A 0.58,0.58 0 0 0 0,21.15 Z" /> <path id="path26" style="fill:#ffffff" d="M 8.53,5.45 A 0.84,0.84 0 0 1 9.36,6.28 0.83,0.83 0 0 1 8.53,7.1 0.82,0.82 0 0 1 7.71,6.28 0.83,0.83 0 0 1 8.53,5.45 Z" /> <path id="path28" style="fill:#ffffff" d="M 10.31,0.19 A 0.2,0.2 0 0 1 10.5,0 h 0.84 a 0.2,0.2 0 0 1 0.19,0.19 V 6.81 A 0.2,0.2 0 0 1 11.34,7 H 10.5 A 0.2,0.2 0 0 1 10.31,6.81 Z" /> <path id="path30" style="fill:#ffffff" d="M 12.21,3.26 A 0.18,0.18 0 0 1 12.38,3 h 0.9 a 0.18,0.18 0 0 1 0.17,0.11 l 1,2.26 v 0 l 1,-2.26 C 15.45,3.01 15.57,3 15.69,3 h 0.8 a 0.17,0.17 0 0 1 0.17,0.26 L 13.62,9.87 A 0.2,0.2 0 0 1 13.45,9.99 H 12.59 A 0.18,0.18 0 0 1 12.42,9.72 l 1.42,-3 z" /> </g> </g> </svg>',SAVEABCBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg16" version="1.1" viewBox="0 0 55.000002 54.999999"> <g transform="matrix(2.0457978,0,0,2.0457978,5.7160355,5.0024652)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="M 0.82,5.55 A 0.84,0.84 0 0 1 1.65,6.38 0.83,0.83 0 0 1 0.82,7.2 0.82,0.82 0 0 1 0,6.38 0.83,0.83 0 0 1 0.82,5.55 Z" /> <path id="path6" style="fill:#ffffff" d="M 2,6.84 5.11,0.11 A 0.18,0.18 0 0 1 5.28,0 h 0.1 A 0.17,0.17 0 0 1 5.55,0.11 L 8.63,6.84 A 0.18,0.18 0 0 1 8.46,7.1 H 7.59 A 0.29,0.29 0 0 1 7.3,6.9 L 6.81,5.82 h -3 L 3.33,6.9 A 0.3,0.3 0 0 1 3,7.1 H 2.17 A 0.18,0.18 0 0 1 2,6.84 Z m 4.32,-2.13 -1,-2.2 v 0 l -1,2.2 z" /> <path id="path8" style="fill:#ffffff" d="M 9.54,0.29 A 0.19,0.19 0 0 1 9.73,0.1 H 12 A 2,2 0 0 1 14.13,2 1.9,1.9 0 0 1 13,3.54 1.8,1.8 0 0 1 14.3,5.17 2,2 0 0 1 12.15,7.1 H 9.73 A 0.19,0.19 0 0 1 9.54,6.91 Z M 11.9,3 A 0.86,0.86 0 0 0 12.76,2.1 0.82,0.82 0 0 0 11.9,1.25 H 10.83 V 3 Z M 12,5.92 a 0.89,0.89 0 0 0 0.9,-0.91 1,1 0 0 0 -1,-0.87 h -1.07 v 1.78 z" /> <path id="path10" style="fill:#ffffff" d="m 18.81,0 a 3.38,3.38 0 0 1 2.42,0.93 0.19,0.19 0 0 1 0,0.28 l -0.61,0.63 a 0.16,0.16 0 0 1 -0.25,0 2.37,2.37 0 0 0 -1.54,-0.59 2.27,2.27 0 0 0 -2.23,2.33 2.26,2.26 0 0 0 2.24,2.31 2.4,2.4 0 0 0 1.53,-0.57 0.18,0.18 0 0 1 0.25,0 l 0.62,0.64 a 0.19,0.19 0 0 1 0,0.27 3.43,3.43 0 0 1 -2.43,1 3.6,3.6 0 1 1 0,-7.2 z" /> <path id="path12" style="fill:#ffffff" d="M 15.7,9.22 H 6.86 V 17 A 2.76,2.76 0 1 0 8,19.17 v -5.53 h 7.7 V 17 a 2.72,2.72 0 0 0 -1.7,-0.59 2.77,2.77 0 1 0 2.77,2.76 v -10 z" /> </g> </g> </svg>',SAVEBLOCKARTWORKBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg16" version="1.1" viewBox="0 0 54.999998 55.000002"> <g transform="matrix(1.9551772,0,0,1.9551772,7.3518338,5.0309243)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="M 0.82,5.55 A 0.84,0.84 0 0 1 1.65,6.38 0.83,0.83 0 0 1 0.82,7.2 0.82,0.82 0 0 1 0,6.38 0.83,0.83 0 0 1 0.82,5.55 Z" /> <path id="path6" style="fill:#ffffff" d="M 2.5,6.12 2.86,5.5 A 0.23,0.23 0 0 1 3.2,5.43 3.31,3.31 0 0 0 4.71,6.05 0.83,0.83 0 0 0 5.62,5.28 C 5.62,4.77 5.19,4.42 4.35,4.08 3.51,3.74 2.47,3.08 2.47,1.92 A 2,2 0 0 1 4.72,0 3.52,3.52 0 0 1 6.72,0.67 0.25,0.25 0 0 1 6.78,1 L 6.4,1.57 A 0.26,0.26 0 0 1 6.05,1.69 3.29,3.29 0 0 0 4.66,1.14 0.8,0.8 0 0 0 3.78,1.84 c 0,0.47 0.37,0.79 1.18,1.12 1,0.39 2.09,1 2.09,2.26 a 2.11,2.11 0 0 1 -2.3,2 3.22,3.22 0 0 1 -2.2,-0.78 C 2.46,6.33 2.41,6.28 2.5,6.12 Z" /> <path id="path8" style="fill:#ffffff" d="M 7.42,0.36 A 0.18,0.18 0 0 1 7.59,0.1 h 1 a 0.18,0.18 0 0 1 0.17,0.11 l 1.92,4.3 h 0.07 l 1.94,-4.3 A 0.18,0.18 0 0 1 12.86,0.1 h 1 a 0.18,0.18 0 0 1 0.17,0.26 L 11,7.09 A 0.18,0.18 0 0 1 10.83,7.2 h -0.1 A 0.18,0.18 0 0 1 10.56,7.09 Z" /> <path id="path10" style="fill:#ffffff" d="m 18.05,0 a 3.78,3.78 0 0 1 2.44,0.93 0.19,0.19 0 0 1 0,0.28 l -0.62,0.65 a 0.17,0.17 0 0 1 -0.26,0 A 2.27,2.27 0 0 0 18.1,1.28 2.29,2.29 0 0 0 15.87,3.6 2.27,2.27 0 0 0 18.12,5.89 3.13,3.13 0 0 0 19.31,5.64 V 4.79 h -0.8 A 0.18,0.18 0 0 1 18.32,4.61 V 3.82 a 0.18,0.18 0 0 1 0.19,-0.19 h 1.92 a 0.19,0.19 0 0 1 0.18,0.19 v 2.56 a 0.19,0.19 0 0 1 -0.08,0.16 5.05,5.05 0 0 1 -2.48,0.65 3.6,3.6 0 0 1 0,-7.19 z" /> <path id="path12" style="fill:#ffffff" d="m 16.41,10 h -5 v 2 h -6 v -2 h -1 a 2,2 0 0 0 -2,2 v 7 a 2,2 0 0 0 2,2 h 1 v 2 h 6 v -2 h 5 a 2,2 0 0 0 2,-2 v -7 a 2,2 0 0 0 -2,-2 z" /> </g> </g> </svg>',BEGINNERBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg10" version="1.1" viewBox="0 0 54.999998 55.000001"> <g transform="translate(6.2944389,7.2345833)" id="レイヤー_2" data-name="レイヤー 2"> <g id="Icon"> <path d="M 41.82,17.39 A 2,2 0 0 0 40.71,14 L 29.52,12.35 A 2,2 0 0 1 28,11.26 L 23,1.11 a 2,2 0 0 0 -3.59,0 l -5,10.15 a 2,2 0 0 1 -1.5,1.09 L 1.71,14 a 2,2 0 0 0 -1.1,3.41 l 8.1,7.9 a 2,2 0 0 1 0.57,1.77 L 7.37,38.2 a 2,2 0 0 0 2.9,2.11 l 10,-5.26 a 2,2 0 0 1 1.86,0 l 10,5.26 a 2,2 0 0 0 2.9,-2.11 L 33.15,27.06 a 2,2 0 0 1 0.57,-1.77 z m -10.19,5.75 a 5,5 0 0 0 -1.44,4.42 l 1.57,9.15 -8.22,-4.32 a 5,5 0 0 0 -4.65,0 l -8.22,4.32 1.57,-9.15 A 5,5 0 0 0 10.8,23.14 l -6.65,-6.48 9.19,-1.34 a 5,5 0 0 0 3.76,-2.73 l 4.11,-8.33 4.11,8.33 a 5,5 0 0 0 3.77,2.73 l 9.19,1.34 z" style="fill:#ffffff" id="path1015" /> </g> </g> </svg> ',ADVANCEDBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="24" height="24" viewBox="0 0 24 24" version="1.1" id="svg6" sodipodi:docname="mode_change.svg" inkscape:version="0.92.3 (2405546, 2018-03-11)"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="785" inkscape:window-height="480" id="namedview8" showgrid="false" inkscape:zoom="9.8333333" inkscape:cx="12" inkscape:cy="12" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="svg6" /> <path d="M 22,9.24 14.81,8.62 12,2 9.19,8.63 2,9.24 7.46,13.97 5.82,21 12,17.27 18.18,21 16.55,13.97 Z m -10,6.16 -3.76,2.27 1,-4.28 -3.32,-2.88 4.38,-0.38 1.7,-4.03 1.71,4.04 4.38,0.38 -3.32,2.88 1,4.28 z" id="path2" style="fill:#292929;fill-opacity:0.4" inkscape:connector-curvature="0" /> <path d="M0 0h24v24H0z" fill="none" id="path4" /></svg>',LANGUAGEBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path id="path2" fill="none" d="M0 0h24v24H0z" /> <path style="fill:#292929;fill-opacity:0.4" id="path4" d="m 12.87,15.07 -2.54,-2.51 0.03,-0.03 C 12.1,10.59 13.34,8.36 14.07,6 H 17 V 4 H 10 V 2 H 8 V 4 H 1 V 5.99 H 12.17 C 11.5,7.92 10.44,9.75 9,11.35 8.07,10.32 7.3,9.19 6.69,8 h -2 c 0.73,1.63 1.73,3.17 2.98,4.56 L 2.58,17.58 4,19 9,14 12.11,17.11 Z M 18.5,10 h -2 L 12,22 h 2 l 1.12,-3 h 4.75 L 21,22 h 2 z m -2.62,7 1.62,-4.33 1.62,4.33 z" /></svg>',SHORTCUTSBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg8" version="1.1" viewBox="0 0 14.552084 14.552085" height="14.552085mm" width="14.552084mm"> <defs id="defs2" /> <metadata id="metadata5"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <g transform="translate(-34.509229,-116.40298)" id="layer1"> <rect ry="2.2811759" y="117.47707" x="35.583324" height="12.403892" width="12.403891" id="rect815" style="fill:none;stroke:#292929;stroke-opacity:0.4;stroke-width:2.148;stroke-linecap:round;stroke-miterlimit:4;stroke-dasharray:none" /> <text id="text819" y="124.30835" x="36.994572" style="font-style:normal;font-weight:normal;font-size:7.16668034px;line-height:4.47917509px;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#292929;fill-opacity:0.4;stroke:none;stroke-width:0.179167px;stroke-linecap:butt;stroke-linejoin:miter;" xml:space="preserve"><tspan style="stroke-width:0.179167px;fill:#292929;fill-opacity:0.4;" y="124.30835" x="36.994572" id="tspan817">D</tspan></text> </g> </svg>',SMALLERBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="42" height="42" id="svg2" version="1.1"> <metadata id="metadata824"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs822" /> <rect width="42" height="42" rx="5" ry="5" style="opacity:0.4;isolation:isolate;mix-blend-mode:multiply;fill:#292929" id="rect834" x="0" y="0" /> <g transform="matrix(0.78209352,0,0,0.78209352,-1.6688631,0.65371947)" id="g1554"> <g id="g1539"> <circle style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:4.5;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" cx="34.75" cy="20.25" r="15" id="circle1535" /> <path style="fill:none;stroke:#ffffff;stroke-width:6;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 23.870372,31.129628 9,46" id="path1537" /> </g> <path d="m 26.25,20.25 h 17" style="fill:none;stroke:#ffffff;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" id="path1541" /> </g> </svg>',SMALLERDISABLEBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="42" height="42" id="svg2" version="1.1"> <metadata id="metadata824"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs822" /> <rect width="42" height="42" rx="5" ry="5" style="opacity:0.4;isolation:isolate;mix-blend-mode:multiply;fill:#FFB700" id="rect834" x="0" y="0" /> <g transform="matrix(0.78209352,0,0,0.78209352,-1.6688631,0.65371947)" id="g1554"> <g id="g1539"> <circle style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:4.5;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" cx="34.75" cy="20.25" r="15" id="circle1535" /> <path style="fill:none;stroke:#ffffff;stroke-width:6;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 23.870372,31.129628 9,46" id="path1537" /> </g> <path d="m 26.25,20.25 h 17" style="fill:none;stroke:#ffffff;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" id="path1541" /> </g> </svg>',BIGGERBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="42" height="42" id="svg2" version="1.1"> <metadata id="metadata824"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs822" /> <rect width="42" height="42" rx="5" ry="5" style="opacity:0.4;isolation:isolate;mix-blend-mode:multiply;fill:#292929" id="rect834" x="0" y="0" /> <circle style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:3.51942086;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" cx="25.508886" cy="16.491114" r="11.731402" id="circle1535" /> <path style="fill:none;stroke:#ffffff;stroke-width:4.69256115;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 17,25 5.3699786,36.630021" id="path1537" /> <path id="path1541" style="fill:none;stroke:#ffffff;stroke-width:3.51942086;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 18.861092,16.491113 h 13.29559" /> <path id="path1541-3" style="fill:none;stroke:#ffffff;stroke-width:3.51942086;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 25.508887,9.843318 v 13.29559" /> </svg>',BIGGERDISABLEBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="42" height="42" id="svg2" version="1.1"> <metadata id="metadata824"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs822" /> <rect width="42" height="42" rx="5" ry="5" style="opacity:0.4;isolation:isolate;mix-blend-mode:multiply;fill:#FFB700" id="rect834" x="0" y="0" /> <circle style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:3.51942086;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" cx="25.508886" cy="16.491114" r="11.731402" id="circle1535" /> <path style="fill:none;stroke:#ffffff;stroke-width:4.69256115;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 17,25 5.3699786,36.630021" id="path1537" /> <path id="path1541" style="fill:none;stroke:#ffffff;stroke-width:3.51942086;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 18.861092,16.491113 h 13.29559" /> <path id="path1541-3" style="fill:none;stroke:#ffffff;stroke-width:3.51942086;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 25.508887,9.843318 v 13.29559" /> </svg>',STATSBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path style="fill:#292929;fill-opacity:0.4;" id="path2" d="M 19,3 H 5 C 3.9,3 3,3.9 3,5 v 14 c 0,1.1 0.9,2 2,2 h 14 c 1.1,0 2,-0.9 2,-2 V 5 C 21,3.9 20.1,3 19,3 Z M 9,17 H 7 v -7 h 2 z m 4,0 H 11 V 7 h 2 z m 4,0 h -2 v -4 h 2 z" /> <path id="path4" fill="none" d="M0 0h24v24H0z" /></svg>',PLUGINSBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"> <metadata  id="metadata12"> <rdf:RDF>  <cc:Work  rdf:about="">  <dc:format>image/svg+xml</dc:format>  <dc:type  rdf:resource="http://purl.org/dc/dcmitype/StillImage" />  </cc:Work> </rdf:RDF>  </metadata>  <defs  id="defs10" />  <path  id="path2"  fill="none"  d="M0 0h24v24H0z" />  <path  style="fill:#292929;fill-opacity:0.4;"  id="path4"  d="M 12,2 C 6.48,2 2,6.48 2,12 2,17.52 6.48,22 12,22 17.52,22 22,17.52 22,12 22,6.48 17.52,2 12,2 Z m 5,11 h -4 v 4 H 10.75 V 13 H 7 v -2 h 3.75 V 7 H 13 v 4 h 4 z" /> </svg>',PLUGINSDELETEBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg6" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata12"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs10" /> <path id="path2" fill="none" d="M0 0h24v24H0z" /> <path style="fill:#292929;fill-opacity:0.4;" id="path4" d="M 12,2 C 6.48,2 2,6.48 2,12 2,17.52 6.48,22 12,22 17.52,22 22,17.52 22,12 22,6.48 17.52,2 12,2 Z m 5,11 H 7 v -2 h 10 z" /></svg>',SCROLLLOCKBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg8" version="1.1" viewBox="0 0 55 55"> <g transform="matrix(1.5221942,0,0,1.5221942,17.255633,15.120844)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="m 11.78,6.16 h -0.42 v -1.74 0 a 4.62,4.62 0 0 0 -9.23,0 v 0 1.74 H 1.68 A 1.68,1.68 0 0 0 0,7.84 v 5.05 a 3.37,3.37 0 0 0 3.36,3.36 h 6.73 a 3.37,3.37 0 0 0 3.37,-3.36 V 7.84 A 1.68,1.68 0 0 0 11.78,6.16 Z M 6.69,12.75 C 6,12.75 5.48,11.32 5.48,10.62 a 1.25,1.25 0 0 1 2.5,0 C 8,11.32 7.38,12.75 6.69,12.75 Z M 9.25,6.16 h -5 V 4.63 a 2.52,2.52 0 1 1 5,0 z" /> </g> </g> </svg>',SCROLLUNLOCKBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="svg10" version="1.1" viewBox="0 0 24 24" height="24" width="24"> <metadata id="metadata14"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs3"> <path d="M0 0h24v24H0V0z" id="a" /> </defs> <clipPath id="b"> <use id="use5" overflow="visible" xlink:href="#a" /> </clipPath> <path style="fill:#292929;fill-opacity:0.4;" id="path8" d="M 9.01,14 H 2 v 2 h 7.01 v 3 L 13,15 9.01,11 Z m 5.98,-1 V 10 H 22 V 8 H 14.99 V 5 L 11,9 Z" clip-path="url(#b)" /></svg>',EMPTYTRASHCONFIRMBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg12" version="1.1" viewBox="0 0 55.000003 55"> <g transform="matrix(2.2499981,0,0,2.2499981,9.0725156,5.0000382)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#292929;fill-opacity:0.4;" d="M 12.6,0.9 H 10.8 L 10.16,0.26 A 0.88,0.88 0 0 0 9.53,0 H 4 A 0.88,0.88 0 0 0 3.37,0.26 L 2.7,0.9 H 0.9 A 0.9,0.9 0 0 0 0,1.8 V 2.7 H 13.5 V 1.8 A 0.9,0.9 0 0 0 12.6,0.9 Z" /> <path id="path6" style="fill:#292929;fill-opacity:0.4;" d="M 4.38,14.5 A 6.47,6.47 0 0 1 12.6,8.24 V 3.6 H 0.9 V 17.1 A 0.9,0.9 0 0 0 1.8,18 H 5.41 A 6.44,6.44 0 0 1 4.38,14.5 Z" /> <path id="path8" style="fill:#292929;fill-opacity:0.4;" d="m 10.88,9 a 5.5,5.5 0 1 0 5.5,5.5 5.5,5.5 0 0 0 -5.5,-5.5 z m 2.43,7 a 0.70710678,0.70710678 0 0 1 -1,1 l -1.45,-1.46 -1.44,1.39 a 0.70710678,0.70710678 0 0 1 -1,-1 L 9.9,14.5 8.44,13 a 0.70710678,0.70710678 0 0 1 1,-1 L 10.9,13.46 12.35,12 a 0.70710678,0.70710678 0 0 1 1,1 l -1.5,1.5 z" /> </g> </g> </svg>',COPYBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg10" version="1.1" viewBox="0 0 55 55"> <title id="title2">アセット 52</title> <g transform="matrix(2.119632,0,0,2.119632,5.0000003,9.2711648)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#292929;fill-opacity:0.4;" d="m 3,13.15 h 1 v -7 a 3,3 0 0 1 3,-3 h 2 v 2 h 4.07 v -2 h 3 V 2 a 2,2 0 0 0 -2,-2 H 9.11 V 2 H 3 V 0 H 2 A 2,2 0 0 0 0,2 v 7.11 a 2,2 0 0 0 2,2 h 1 v 2 z" /> <path id="path6" style="fill:#292929;fill-opacity:0.4;" d="m 19.23,4.1 h -5.06 v 2 H 8.1 v -2 h -1 a 2,2 0 0 0 -2,2 v 7.1 a 2,2 0 0 0 2,2 h 1 v 2 h 6.07 v -2 h 5.06 a 2,2 0 0 0 2,-2 V 6.12 a 2,2 0 0 0 -2,-2.02 z" /> </g> </g> </svg>',FULLSCREENBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg height="55" width="55" id="svg10" version="1.1" viewBox="0 0 55 55" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"> <g transform="translate(-0.7500335,-0.75)" style="stroke:#292929;stroke-opacity:0.4"> <path style="fill:none;stroke:#292929;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:0.4" d="m 40.000067,6.5 10,4.465e-4 V 16.5" /> <path style="fill:none;stroke:#292929;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:0.4" d="m 40.000067,49.999999 10,-4.46e-4 V 40" /> <path style="fill:none;stroke:#292929;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:0.4" d="m 16.5,50 -10,-4.47e-4 V 40" /> <path style="fill:none;stroke:#292929;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:0.4" d="m 6.5,16.5 4.465e-4,-10 H 16.5" /> </g> </svg>',PASTEBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg10" version="1.1" viewBox="0 0 54.999998 55.000001"> <g transform="translate(2.2289291,14.370309)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#ffffff" d="M 28.33,0 H 18.21 V 4.05 H 6.07 V 0 h -2 A 4,4 0 0 0 0,4.05 v 14.16 a 4,4 0 0 0 4.05,4.05 h 2 v 4 h 12.16 v -4 h 10.12 a 4,4 0 0 0 4.05,-4.05 V 4.05 A 4,4 0 0 0 28.33,0 Z" /> <path id="path6" style="fill:#ffffff" d="m 37,18.65 5.43,5.42 a 1.56,1.56 0 0 0 1.11,0.46 v 0 a 1.56,1.56 0 0 0 1.13,-0.5 L 50,18.64 a 1.56,1.56 0 1 0 -2.2,-2.2 L 45.08,19.2 V 9.74 a 1.56,1.56 0 1 0 -3.12,0 v 9.5 l -2.8,-2.79 a 1.56,1.56 0 0 0 -2.2,2.2 z" /> </g> </g> </svg>',EXTRACTBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="55" width="55" id="svg12" version="1.1" viewBox="0 0 55 54.999999"> <g transform="matrix(0.69498069,0,0,0.69498069,5.0000002,11.397297)" data-name="レイヤー 2" id="レイヤー_2"> <g id="Icon"> <path id="path4" style="fill:#292929;fill-opacity:0.4;" d="m 61.63,14.12 h -7.82 v 3.13 h -9.37 v -3.13 h -1.56 a 3.13,3.13 0 0 0 -3.13,3.13 v 10.94 a 3.13,3.13 0 0 0 3.13,3.12 h 1.56 v 3.13 h 9.37 v -3.13 h 7.82 a 3.12,3.12 0 0 0 3.12,-3.12 V 17.25 a 3.13,3.13 0 0 0 -3.12,-3.13 z" /> <path id="path6" style="fill:#292929;fill-opacity:0.4;" d="m 29.71,28 4.76,-4.76 a 1.29,1.29 0 0 0 0.4,-1 v 0 a 1.42,1.42 0 0 0 -0.44,-1 L 29.71,16.5 a 1.3647161,1.3647161 0 0 0 -1.93,1.93 l 2.42,2.42 h -8.3 a 1.37,1.37 0 1 0 0,2.74 h 8.34 L 27.78,26 a 1.37,1.37 0 0 0 0,1.93 1.35,1.35 0 0 0 1.93,0.07 z" /> <path id="path8" style="fill:#292929;fill-opacity:0.4;" d="M 31.38,11.6 V 2.05 a 2.05,2.05 0 0 0 -2.05,-2 H 10.74 V 2.73 H 3.92 V 0 H 2.05 A 2.05,2.05 0 0 0 0,2.05 v 39.56 a 2,2 0 0 0 2.05,2 h 1.87 v 2.73 h 6.82 v -2.69 h 11.77 a 2,2 0 0 0 2,-2 v -9.59 a 2,2 0 0 0 -2,-2.05 H 6.82 V 13.64 h 22.51 a 2,2 0 0 0 2.05,-2.04 z" /> </g> </g> </svg>',METRONOMESVG='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg8" version="1.1" viewBox="0 0 14.552083 14.552083" height="55" width="55"> <defs id="defs2" /> <metadata id="metadata5"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <g transform="translate(-224.05668,-92.55687)" id="layer1"> <path id="path881" d="m 226.24175,106.79388 c -0.20228,-0.0699 -0.32246,-0.17272 -0.40927,-0.35015 -0.0585,-0.11961 -0.0754,-0.19281 -0.0742,-0.32205 9.5e-4,-0.10185 0.25429,-1.44731 0.64781,-3.44031 0.35545,-1.80017 0.90544,-4.591848 1.22219,-6.20372 0.31675,-1.611873 0.5947,-2.980893 0.61767,-3.042266 0.0624,-0.166725 0.18743,-0.32141 0.35082,-0.433942 0.25607,-0.176361 0.28837,-0.179604 1.79164,-0.179967 1.31374,-3.17e-4 1.35305,0.0013 1.531,0.05963 0.24,0.07879 0.46514,0.281181 0.56453,0.507501 0.05,0.113775 0.1955,0.800409 0.51683,2.438543 0.246,1.254098 0.45382,2.279698 0.46183,2.279113 0.0132,-9.51e-4 0.98975,-1.747064 1.00861,-1.803438 0.004,-0.0132 -0.0471,-0.05629 -0.11441,-0.09575 -0.15576,-0.09129 -0.23599,-0.193387 -0.23599,-0.300335 0,-0.1096 0.62382,-1.920034 0.69102,-2.005468 0.0283,-0.03596 0.0982,-0.0794 0.15541,-0.09654 0.11719,-0.03511 0.18095,-0.01239 0.53875,0.191917 l 0.19373,0.110629 0.12829,-0.230387 c 0.0706,-0.126713 0.16067,-0.255862 0.20026,-0.286999 0.13123,-0.103226 0.36806,-0.0554 0.4459,0.09005 0.0579,0.108206 0.0218,0.28281 -0.104,0.503002 -0.0621,0.108754 -0.11267,0.207356 -0.11228,0.219116 3.1e-4,0.01176 0.12671,0.08978 0.28074,0.17337 0.23243,0.126148 0.28879,0.169675 0.33151,0.256029 0.0434,0.08774 0.0466,0.119709 0.0205,0.204075 -0.0359,0.115971 -1.21996,1.579517 -1.33835,1.654245 -0.10509,0.06633 -0.2046,0.06002 -0.36923,-0.0234 -0.12766,-0.06469 -0.14413,-0.06728 -0.17341,-0.02723 -0.0923,0.126164 -1.35447,2.424914 -1.35447,2.46676 0,0.027 0.30197,1.583382 0.67104,3.458632 0.36907,1.87524 0.67104,3.47147 0.67104,3.54717 0,0.22165 -0.0521,0.34853 -0.20729,0.50465 -0.24535,0.24685 0.11425,0.22835 -4.41966,0.22733 -3.75517,-7.9e-4 -3.99528,-0.004 -4.12858,-0.0498 z m 8.12294,-0.61717 c 0.0242,-0.0292 -0.0348,-0.37362 -0.25649,-1.49694 -0.15838,-0.80247 -0.2912,-1.46168 -0.29516,-1.46492 -0.004,-0.003 -0.10416,-0.0272 -0.22266,-0.0532 -0.40092,-0.0879 -0.65638,-0.21945 -1.38937,-0.71536 -0.47791,-0.32333 -0.642,-0.41641 -0.91574,-0.51945 -0.50845,-0.19138 -1.18217,-0.20503 -1.71111,-0.0347 -0.28339,0.0913 -0.52496,0.22458 -1.09054,0.60182 -0.70801,0.47224 -1.02666,0.62618 -1.4346,0.69305 -0.0618,0.0101 -0.10661,0.0348 -0.11518,0.0636 -0.008,0.0258 -0.13933,0.6848 -0.2925,1.46437 -0.22648,1.15274 -0.27211,1.42507 -0.24437,1.45849 0.03,0.0362 0.50595,0.0411 3.98518,0.0411 3.33179,0 3.95601,-0.006 3.98254,-0.0379 z m -6.93198,-3.77088 c 0.12526,-0.0589 0.35944,-0.19596 0.5204,-0.30458 0.16096,-0.10862 0.38744,-0.26111 0.50328,-0.33887 0.42538,-0.28554 0.89744,-0.48736 1.3095,-0.55984 0.0979,-0.0172 0.20576,-0.0369 0.23966,-0.0437 0.0598,-0.012 0.0616,-0.0221 0.0616,-0.34051 v -0.32815 h -0.26108 c -0.30479,0 -0.42806,-0.0404 -0.49031,-0.16082 -0.0545,-0.10529 -0.0545,-0.20302 0,-0.30832 0.0623,-0.120387 0.18552,-0.160818 0.49031,-0.160818 h 0.26108 v -0.917547 -0.917549 h -0.26291 c -0.30009,0 -0.42769,-0.04327 -0.49151,-0.16667 -0.0515,-0.09967 -0.0505,-0.198868 0.003,-0.30247 0.0623,-0.120388 0.18552,-0.160819 0.49031,-0.160819 h 0.26108 V 96.480679 95.56616 l -0.29443,-0.0107 c -0.22027,-0.008 -0.31235,-0.02267 -0.36554,-0.05819 -0.19408,-0.12962 -0.1679,-0.439383 0.0447,-0.528191 0.0584,-0.0244 0.19056,-0.03893 0.35424,-0.03893 h 0.26108 v -0.302645 c 0,-0.419515 0.0741,-0.546429 0.31897,-0.546429 0.0908,0 0.13203,0.01698 0.19557,0.08052 0.0973,0.0973 0.11542,0.177633 0.11542,0.511776 v 0.256777 h 0.26291 c 0.31358,0 0.4234,0.04091 0.49074,0.182811 0.0575,0.12125 0.0361,0.252476 -0.0563,0.344869 -0.0831,0.08314 -0.1707,0.102278 -0.46799,0.102278 h -0.22939 v 0.91755 0.917547 h 0.26291 c 0.31358,0 0.4234,0.04091 0.49074,0.182811 0.0575,0.121251 0.0361,0.252477 -0.0563,0.34487 -0.0831,0.08314 -0.1707,0.102278 -0.46799,0.102278 h -0.22939 v 0.917549 0.917547 h 0.26291 c 0.31358,0 0.4234,0.04091 0.49074,0.182812 0.0575,0.12125 0.0361,0.25248 -0.0563,0.34487 -0.0831,0.0831 -0.1707,0.10228 -0.46799,0.10228 h -0.22939 v 0.32815 c 0,0.31857 0.002,0.3285 0.0616,0.3399 0.37574,0.0716 0.55327,0.11418 0.7034,0.16867 0.0979,0.0355 0.17991,0.0621 0.18237,0.059 0.0626,-0.0781 1.32593,-2.395742 1.32593,-2.432592 0,-0.109752 -1.01556,-5.218428 -1.05436,-5.303857 -0.0223,-0.04906 -0.0807,-0.113724 -0.12988,-0.143693 -0.086,-0.05242 -0.14004,-0.05449 -1.42366,-0.05459 l -1.33428,-1.03e-4 -0.0955,0.08386 c -0.0525,0.04612 -0.10207,0.104665 -0.11009,0.1301 -0.0209,0.06619 -1.74096,8.809925 -1.74096,8.849855 0,0.0444 0.0723,0.022 0.35099,-0.1091 z m 6.2417,0.077 c -0.008,-0.0339 -0.1231,-0.61875 -0.25629,-1.29967 -0.13319,-0.68092 -0.25071,-1.2294 -0.26116,-1.218834 -0.0205,0.0207 -0.92487,1.641934 -0.94493,1.693874 -0.0114,0.0295 0.67029,0.51291 0.96078,0.68132 0.12175,0.0706 0.4348,0.20002 0.4922,0.20351 0.0129,7.9e-4 0.0172,-0.0263 0.009,-0.0602 z m 2.087,-6.989843 c 0.19631,-0.240298 0.35428,-0.439203 0.35104,-0.442012 -0.003,-0.0028 -0.20542,-0.116135 -0.44929,-0.251834 l -0.44339,-0.246724 -0.0307,0.08617 c -0.0169,0.04739 -0.10302,0.295696 -0.19135,0.551789 -0.0883,0.256092 -0.16851,0.485853 -0.17816,0.51058 -0.0137,0.03508 0.0385,0.07544 0.23759,0.183629 0.2401,0.130493 0.25786,0.135916 0.30125,0.09199 0.0254,-0.02567 0.20673,-0.243286 0.40304,-0.483582 z" style="fill:fill_color;stroke-width:0.0273895" /> </g> </svg>',PITCHPREVIEWBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="55" height="55" viewBox="0 0 55.000001 55.000001" version="1.1" id="svg864" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <g transform="matrix(4.021879,0,0,4.021879,268.33692,99.65892)" style="fill:#292929;fill-opacity:0.4;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" > <path style="fill:#292929;fill-opacity:0.4" d="m -61.801691,-12.829594 c 0,-0.554667 0.272,-1.045333 0.816,-1.472 0.544,-0.437333 1.12,-0.656 1.728,-0.656 0.176,0 0.342667,0.02267 0.5,0.068 0.157333,0.04533 -0.138667,-0.09067 0,0 v -9.268 h 0.796 v 10.352 c 0,0.597333 -0.261333,1.093333 -0.784,1.488 -0.522667,0.394667 -1.098667,0.592 -1.728,0.592 -0.352,0 -0.661333,-0.101333 -0.928,-0.304 -0.266667,-0.213333 -0.4,-0.48 -0.4,-0.8 z" /> </g> </svg>',PITCHPREVIEWHELPBUTTON='<svg xmlns="http://www.w3.org/2000/svg" width="36px" height="36px" viewBox="0 0 24 24" fill="#292929" fill-opacity="0.4" ><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>',JAVASCRIPTBUTTON='<?xml version="1.0" encoding="UTF-8" standalone="no"?> \x3c!-- Created with Inkscape (http://www.inkscape.org/) --\x3e <svg width="55" height="55" viewBox="0 0 14.552083 14.552084" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <g> <text xml:space="preserve" style="font-size:11.8659px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;stroke-width:0.317835;fill:#292929;fill-opacity:0.4;" x="-0.38877353" y="8.8153467" transform="scale(0.7616083,1.3130109)"><tspan style="stroke-width:0.317835;fill:#292929;fill-opacity:0.4;" x="-0.38877353" y="8.8153467">&lt; &gt;</tspan></text> </g> </svg>',GRAND_F='<svg version="1.0" width="1200" height="900" id="svg296" sodipodi:docname="grand-f.svg" inkscape:version="1.2.1 (9c6d41e410, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <text xml:space="preserve" style="font-size:48px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px" x="103.94531" y="384.08594" id="text583"><tspan id="tspan581" x="103.94531" y="384.08594" style="font-size:48px">♭</tspan></text> <text xml:space="preserve" style="font-size:48px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px" x="103.94531" y="534.08594" id="text583-3"><tspan id="tspan581-6" x="103.94531" y="559.08594" style="font-size:48px">♭</tspan></text> </svg>',GRAND_G='<svg version="1.0" width="1200" height="900" id="svg296" sodipodi:docname="grand-g.svg" inkscape:version="1.2.1 (9c6d41e410, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <text xml:space="preserve" style="font-size:48px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px" x="99.945312" y="340.08594" id="text583"><tspan id="tspan581" x="99.945312" y="340.08594" style="font-size:48px">♯</tspan></text> <text xml:space="preserve" style="font-size:48px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px" x="99.945312" y="515.08594" id="text583-3"><tspan id="tspan581-6" x="99.945312" y="515.08594" style="font-size:48px">♯</tspan></text> </svg>',TREBLE_F='<svg version="1.0" width="1200" height="900" id="svg296" sodipodi:docname="grand-f.svg" inkscape:version="1.2.1 (9c6d41e410, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <text xml:space="preserve" style="font-size:48px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px" x="103.94531" y="384.08594" id="text583"><tspan id="tspan581" x="103.94531" y="384.08594" style="font-size:48px">♭</tspan></text> </svg>',TREBLE_G='<svg version="1.0" width="1200" height="900" id="svg296" sodipodi:docname="grand-g.svg" inkscape:version="1.2.1 (9c6d41e410, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <text xml:space="preserve" style="font-size:48px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px" x="99.945312" y="340.08594" id="text583"><tspan id="tspan581" x="99.945312" y="340.08594" style="font-size:48px">♯</tspan></text> </svg>',DARKMODEBUTTON=("undefined"!=typeof module&&module.exports&&(module.exports={showMaterialHighlight:showMaterialHighlight,hideButtonHighlight:hideButtonHighlight,hidePaletteNameDisplay:hidePaletteNameDisplay,COLLAPSEBUTTONXOFF:COLLAPSEBUTTONXOFF,STANDARDBLOCKHEIGHT:STANDARDBLOCKHEIGHT,FILLCOLORS:FILLCOLORS,TURTLESVG:TURTLESVG}),'<svg height="55px" width="55px" viewBox="0 -960 960 960" fill="#292929" opacity="0.4" version="1.1" id="svg1" xmlns="http://www.w3.org/2000/svg"><path id="path1" d="M 481.01562 -933.98438 L 346.01562 -800 L 160 -800 L 160 -613.98438 L 26.015625 -480 L 160 -346.01562 L 160 -160 L 346.01562 -160 L 481.01562 -28.984375 L 613.98438 -160 L 800 -160 L 800 -346.01562 L 933.98438 -480 L 800 -613.98438 L 800 -800 L 613.98438 -800 L 481.01562 -933.98438 z M 490 -676.01562 C 543.94667 -676.01562 589.94208 -656.98438 627.96875 -618.98438 C 665.99542 -580.98437 685 -535.02135 685 -481.05469 C 685 -427.09469 665.99542 -381.08686 627.96875 -343.04688 C 589.94208 -305.01353 543.94667 -286.01562 490 -286.01562 C 476.66667 -286.01563 463.33333 -287.50781 450 -290.50781 C 436.66667 -293.50781 423.6823 -297.67448 411.01562 -303.00781 C 445.6823 -319.67448 473.31771 -343.90885 493.98438 -375.74219 C 514.65103 -407.57552 525 -442.6823 525 -481.01562 C 525 -519.34897 514.65103 -554.41667 493.98438 -586.25 C 473.31771 -618.08333 445.6823 -642.00781 411.01562 -658.00781 C 423.70229 -664.00781 436.7124 -668.48438 450.03906 -671.48438 C 463.35906 -674.48438 476.66667 -676.01562 490 -676.01562 z"/></svg>'),SELECTHELPBUTTON='<svg height="55" width="55" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"><path d="M2.1 0v1.914H0v6h3V3h5.1V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h1.8v1.2h3V0h-4.8zm1.8 7.2v6h3v-6h-3zM0 10.913v6h3v-6H0zM66.9 16.2v6h3v-6h-3zM0 19.914v6h3v-6H0zM66.9 25.2v6h3v-6h-3zM0 28.914v6h3v-6H0zM66.9 34.2v6h3v-6h-3zM0 37.914v6h3v-6H0zM66.9 43.2v6h3v-6h-3zM0 46.914v6h3v-6H0zM66.9 52.2v6h3v-6h-3zM0 55.914v5.191h3.809v-3H3v-2.19H0zm6.809 2.191v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9.648 1.899a2.076 2.076 0 0 0-2.19 2.324l3.137 33.676c.2 1.635 2.135 2.399 3.397 1.34l6.623-5.371l2.969 5.142c1.707 2.958 4.417 3.684 7.375 1.977c2.957-1.708 3.684-4.417 1.976-7.375l-2.959-5.125l7.848-3.008c1.548-.564 1.855-2.62.539-3.611L71.576 60.416a2.073 2.073 0 0 0-1.119-.412z" fill="#292929" fill-opacity="0.4"/></svg>',BLOCKMENUBUTTON='<svg height="150" width="150" viewBox="0 0 150 150" version="1.1" xmlns="http://www.w3.org/2000/svg"><path fill="#707070" d="M 67.27458,51.22359 51.82373,3.670761 a 75,75 0 0 1 46.35254,0 75,75 0 0 1 37.5,27.245345 L 95.22542,60.30537 a 25,25 0 0 0 -12.5,-9.08178 25,25 0 0 0 -15.45084,0 z"/>\x3c!--Embedded Help Icon--\x3e<g transform="matrix(0.6,0,0,0.6,74,11)"><path fill="#ffffff" d="m 50,27.625 c 0,12.343 -10.157,22.5 -22.5,22.5 C 15.157,50.125 5,39.968 5,27.625 5,15.282 15.157,5.125 27.5,5.125 c 12.343,0 22.5,10.157 22.5,22.5 z"/><path fill="#282828" d="m 23.956,27.167 c 0,-1.621 1.8,-1.89 3.645,-2.386 1.8,-0.495 3.6,-1.215 3.6,-3.825 0,-1.98 -1.845,-3.42 -3.734,-3.42 -3.78,0 -4.365,4.455 -7.246,4.455 -1.62,0 -2.745,-1.26 -2.745,-3.24 0,-4.726 5.94,-7.425 9.991,-7.425 5.806,0 10.756,3.6 10.756,9.631 0,4.995 -3.15,7.921 -7.785,9.091 v 1.619 c 0,1.801 -1.351,3.105 -3.241,3.105 -2.025,0 -3.24,-1.305 -3.24,-3.105 v -4.5 z m -0.27,13.77 c 0,-1.935 1.575,-3.51 3.51,-3.51 1.936,0 3.51,1.575 3.51,3.51 0,1.936 -1.574,3.512 -3.51,3.512 -1.935,-10e-4 -3.51,-1.577 -3.51,-3.512 z"/></g><path fill="#909090" d="M 50,75 H 0 A 75,75 0 0 1 14.323725,30.916106 75,75 0 0 1 51.82373,3.670761 L 67.27458,51.22359 a 25,25 0 0 0 -12.5,9.08178 A 25,25 0 0 0 50,75 Z"/><path fill="#808080" d="M 95.22542,60.30537 135.67627,30.916106 A 75,75 0 0 1 150,75 75,75 0 0 1 135.67627,119.08389 L 95.22542,89.69463 A 25,25 0 0 0 100,75 25,25 0 0 0 95.22542,60.30537 Z"/><path fill="#808080" d="M 67.27458,98.77641 51.82373,146.32924 A 75,75 0 0 1 14.323725,119.08389 75,75 0 0 1 0,75 h 50 a 25,25 0 0 0 4.77458,14.69463 25,25 0 0 0 12.5,9.08178 z"/><path fill="#909090" d="m 95.22542,89.69463 40.45085,29.38926 a 75,75 0 0 1 -37.5,27.24535 75,75 0 0 1 -46.35254,0 L 67.27458,98.77641 a 25,25 0 0 0 15.45084,0 25,25 0 0 0 12.5,-9.08178 z"/>\x3c!--Embedded Duplicate Icon--\x3e<g transform="matrix(1.3,0,0,1.3,112,64)"><path fill="#ffffff" d="m 3,13.15 h 1 v -7 a 3,3 0 0 1 3,-3 h 2 v 2 h 4.07 v -2 h 3 V 2 a 2,2 0 0 0 -2,-2 H 9.11 V 2 H 3 V 0 H 2 A 2,2 0 0 0 0,2 v 7.11 a 2,2 0 0 0 2,2 h 1 v 2 z"/><path fill="#ffffff" d="m 19.23,4.1 h -5.06 v 2 H 8.1 v -2 h -1 a 2,2 0 0 0 -2,2 v 7.1 a 2,2 0 0 0 2,2 h 1 v 2 h 6.07 v -2 h 5.06 a 2,2 0 0 0 2,-2 V 6.12 a 2,2 0 0 0 -2,-2.02 z"/></g>\x3c!--Embedded Extract Icon--\x3e<g transform="matrix(0.5,0,0,0.5,77,110)"><path style="fill:#ffffff" d="m 61.63,14.12 h -7.82 v 3.13 h -9.37 v -3.13 h -1.56 a 3.13,3.13 0 0 0 -3.13,3.13 v 10.94 a 3.13,3.13 0 0 0 3.13,3.12 h 1.56 v 3.13 h 9.37 v -3.13 h 7.82 a 3.12,3.12 0 0 0 3.12,-3.12 V 17.25 a 3.13,3.13 0 0 0 -3.12,-3.13 z"/><path style="fill:#ffffff" d="m 29.71,28 4.76,-4.76 a 1.29,1.29 0 0 0 0.4,-1 v 0 a 1.42,1.42 0 0 0 -0.44,-1 L 29.71,16.5 a 1.3647161,1.3647161 0 0 0 -1.93,1.93 l 2.42,2.42 h -8.3 a 1.37,1.37 0 1 0 0,2.74 h 8.34 L 27.78,26 a 1.37,1.37 0 0 0 0,1.93 1.35,1.35 0 0 0 1.93,0.07 z"/><path style="fill:#ffffff" d="M 31.38,11.6 V 2.05 a 2.05,2.05 0 0 0 -2.05,-2 H 10.74 V 2.73 H 3.92 V 0 H 2.05 A 2.05,2.05 0 0 0 0,2.05 v 39.56 a 2,2 0 0 0 2.05,2 h 1.87 v 2.73 h 6.82 v -2.69 h 11.77 a 2,2 0 0 0 2,-2 v -9.59 a 2,2 0 0 0 -2,-2.05 H 6.82 V 13.64 h 22.51 a 2,2 0 0 0 2.05,-2.04 z"/></g>\x3c!--Embedded Close Icon--\x3e<g transform="matrix(0.58,0,0,0.58,20,30)"><path style="fill:#ffffff" d="m 27.557,5.053 c -12.43,0 -22.5,10.076 -22.5,22.497 0,12.432 10.07,22.503 22.5,22.503 12.431,0 22.5,-10.071 22.5,-22.503 0,-12.421 -10.07,-22.497 -22.5,-22.497 z m 10.199,28.159 c 1.254,1.256 1.257,3.291 0,4.545 -0.628,0.629 -1.451,0.943 -2.274,0.943 -0.822,0 -1.644,-0.314 -2.27,-0.94 l -5.76,-5.761 -5.76,5.761 c -0.627,0.626 -1.449,0.94 -2.271,0.94 -0.823,0 -1.647,-0.314 -2.275,-0.943 -1.254,-1.254 -1.254,-3.289 0.004,-4.545 l 5.758,-5.758 -5.758,-5.758 c -1.258,-1.254 -1.258,-3.292 -0.004,-4.546 1.255,-1.254 3.292,-1.259 4.546,0 l 5.76,5.759 5.76,-5.759 c 1.252,-1.259 3.288,-1.254 4.544,0 1.257,1.254 1.254,3.292 0,4.546 l -5.758,5.758 z"/></g>\x3c!--Embedded Move to Trash Icon--\x3e<g transform="matrix(1.38,0,0,1.38,23,90)"><path style="fill:#ffffff" d="M 12.6,0.9 H 10.8 L 10.16,0.26 A 0.88,0.88 0 0 0 9.53,0 H 4 A 0.88,0.88 0 0 0 3.37,0.26 L 2.7,0.9 H 0.9 A 0.9,0.9 0 0 0 0,1.8 V 2.7 H 13.5 V 1.8 A 0.9,0.9 0 0 0 12.6,0.9 Z"/><path style="fill:#ffffff" d="M 4.38,14.5 A 6.47,6.47 0 0 1 12.6,8.24 V 3.6 H 0.9 V 17.1 A 0.9,0.9 0 0 0 1.8,18 H 5.41 A 6.44,6.44 0 0 1 4.38,14.5 Z"/><path style="fill:#ffffff" d="m 10.88,9 a 5.5,5.5 0 1 0 5.5,5.5 5.5,5.5 0 0 0 -5.5,-5.5 z m 2.43,7 a 0.70710678,0.70710678 0 0 1 -1,1 l -1.45,-1.46 -1.44,1.39 a 0.70710678,0.70710678 0 0 1 -1,-1 L 9.9,14.5 8.44,13 a 0.70710678,0.70710678 0 0 1 1,-1 L 10.9,13.46 12.35,12 a 0.70710678,0.70710678 0 0 1 1,1 l -1.5,1.5 z"/></g></svg>',CANVASMENUBUTTON='<svg version="1.1" id="svg1" width="150" height="150" viewBox="0 0 722.01721 721.08618" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" ><clipPath clipPathUnits="userSpaceOnUse" id="clipPath4"><path d="M 354.375,3.375 320.85776,5.237069 289.20259,9.6594828 250.79741,20.599138 209.18779,36.126451 175.85929,53.737068 131.97414,84.258621 85.655173,130.57759 50.741379,178.75862 36.126451,208.11798 16.642241,256.5 l -7.0991375,31.88793 -3.9472067,22.10205 -3.6174485,35.62209 -0.2327586,25.60345 3.6077586,46.0862 5.0154197,25.26164 9.875112,33.24621 11.520963,30.77743 11.027209,23.53568 12.919938,23.78256 14.894961,21.06691 29.013639,35.86837 26.65086,25.13793 25.37069,21.18103 33.51724,21.53018 31.65518,14.78017 20.13362,8.37931 15.82758,5.58621 36.54311,9.89224 23.625,3.95689 12.3362,1.74569 32.46983,0.93104 11.40517,-0.5819 27,-0.93103 19.20259,-1.62931 24.09052,-4.5388 23.74138,-5.70258 21.41379,-6.98276 19.43534,-8.03017 30.49138,-14.0819 22.46121,-13.15086 24.55603,-16.99138 14.78018,-11.98707 11.98707,-11.52155 16.52586,-15.47845 12.10345,-14.19828 12.80172,-14.54741 12.21983,-18.15517 7.56465,-12.10345 10.7069,-17.80604 11.17241,-23.27586 7.56466,-16.06034 4.88793,-13.73276 5.93534,-20.25 5.93535,-22.57759 5.00431,-26.65086 1.74569,-19.20259 1.28017,-23.74138 -0.34914,-30.49137 -2.7931,-24.2069 -3.9569,-26.18535 -5.35344,-21.53017 -5.23707,-16.2931 -8.14655,-22.11207 -5.93535,-14.89655 -8.96121,-18.27155 -6.28448,-11.87069 -9.89224,-16.06035 -9.19397,-13.61638 -9.5431,-12.45258 -13.5,-16.17673 L 618.67241,108.5819 606.10345,97.060345 593.88362,86.237069 575.61207,72.271552 553.15086,57.258621 536.74138,46.668104 523.47414,40.150862 503.80604,32.12069 484.25431,24.090517 469.59052,18.795258 455.85775,14.896552 428.625,8.2047411 C 419.78017,7.0215513 386.3509,2.3724003 391.5,3.607758" /></clipPath><g transform="translate(-1.74569,-3.3750004)"><image width="726" height="729" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAtYAAALZCAYAAACTRmYTAAAAAXNSR0IArs4c6QAAAARnQU1BAACx&#10;jwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAN2tSURBVHhe7J0HuBTl2YY/FLFgxw6CFBURBEEE&#10;rNgLdlTsGgvWRE000Rh/TWKMphmNsffYFbGAXURBEOyoqIj0ZqdZwMLPPedbzp49W2Z2p89zX9eG&#10;+QaCh3N2Z555v+d93iZLlmKq4D+vLzZXvbbYroQQQggRBn1bL28u33kls8GqTeyZ7DJn4RLz+5e+&#10;N8On/WTPCBEty9lfXfPKjJ/MwYO+k6gWQgghIgAR+d83F5v5i6qqi6UG/v18HySqRZxwXbGeOu/n&#10;pW/gH8zDH/5gzwghhBAiKg7arKk5p2cz03p1zzWyxDNt/s/m368tNo9O+NGeESIeVBTWsxcuMbeO&#10;W2xue0eCWgghyrGSWWxWXLJo6a/fm5WW/rqi4Xixc7xsveR706xJOGKA/+L3TVY03y1pZhY1WfpV&#10;LT3+nq9i6a+LDOeWrpes4BybJrIVJBHsIKd2a2b2bd/UrLNKE5PmnyJi5Ytvl5gnP/nR3Pj2YscG&#10;IkTcKCmsP/jyZ3Pv+z+Ye5a+hBAiKyzXZEmBEEYc54TyUpFsz+UL6JWacH7x0jt/Mm/0P5nlHdHN&#10;v/C7pSK7Xnzz61IBbkX4MiHOOfv7P5im9m8RUYPI7rnB8qZpCgvYP/5szGtzfpKYFrGngbD+eenR&#10;ExN/NIM/+sG8PF2eJSFEOmm2VA6uuWSeWWPJgqWv+WYtM9+s8fPSl1lgVl3yjf1TohKfLlnLLD9/&#10;hpm7fAszt2kLM6/pOubr5dc285uubRYuv6ZTYRRCiCzR5PsflywZPvVH8/yUH83Tk34y3/ygS6EQ&#10;IvmsbBY5onmNn+eZNZcKZo7XXCqg11wqplde8p39U6IWZixZx6w6b6JdNebHJis0EN0Llort+cuv&#10;YRY2XUuVbiFEKmnS7voFFVzWQggRT5qb7+oEMwLavjhGSGPVEMEy5ed1zZrzP7Yrb+RE97ylonvB&#10;UrGN6HZeTdc03zdZ2f4pIYRIFk3aXrdAsloIEWtWX7LQbLDkM7Puki+XiWh+XcEoESBKJv2wtln7&#10;m0l25R+IbuwkC5Zbw6lwf9V0PfPFChuZhcuvbv+EEELEEwlrIUSswP+8wZLPzfo/f2Y24GW+MKvI&#10;uhFLJi1azaz93XS7Cp7vl29uPl9+ffNFs43M502XvjNW2ND80KSZ/V0hhIgeCWshRKSst+SLpSL6&#10;c0dM81p7yVz7OyLuTP1mBbPGD5/bVTTMXX5tR2DXvTYwXzZd3/6OEEKEj4S1ECI0cpaODZaKaX5F&#10;UC9nfra/K5LGrAU/mVV+WmBX8WBJk+XN50vFNdaR3K+ykAghwkLCWggRCLJ0pJ+v584zTRIQqicL&#10;iRAiLCSshRC+sI752mz40xxHTMvSkX6+ZSTO3Dl2lTzyLSSfNWtpvl5+Hfs7QghRPRLWQoiqwMLR&#10;7ufpps3S1yY/zzCrGg1WyRJfmjXM8nOn2lXy+Wa51cyMFduZmUtfs1ZobX5qopxtIYR3JKyFEK5Z&#10;e8m8pSJ6qmm7ZKZp9fMse1ZkkVlLWphV5n1iV+ljZrO2S0V226Uiu42Z13Rte1YIIcojYS2EKEtb&#10;pyI9zRHTqy2JV6OaiI6pP69r1qhyOEzSQFjPbNbOzGrW2sxZYWNVs4UQJZGwFkI0gOSO9kumLhXT&#10;003rn2fas0I0ZNKPLczaC9NbsS4Foppq9qxmbRyRrWq2ECIfCWshhNl4ySzT/uelYvqnaWYNs9Ce&#10;FaI0kxavadb+dopdZRdys2eviMhupWq2EELCWogsssqSb5cK6Wmm3ZJpTmVaCK9M/b65WeN77Wjk&#10;s2i5lZ1K9qdWZKuaLUT2kLAWIgM0XfKD2XLROLPaCj85gnrNJfPs7whRHTMWGrPqj4pULMfnK2xo&#10;Pm22sVPNxj4ihEg/EtZCpJgNf5hmNlo81Wy4aKpp2uRn06b5D/Z3hKiNz+d9a1ZYstiuRCXmNV3H&#10;TF+xnZnerIP5bKngFkKkEwlrIVLGOj/OqRPTS18bLG5o8/hprU1MCw1uETXyg2lqvpn7hV0Jr3ze&#10;rOVSgd1+6audmdu0hT0rhEgDEtZCpIDVfppnWi36xGz0A4J6mll+yY/2dxryZfN2pv0KX9mVENUx&#10;z6xqlsydYVeiFhhI44jspb9+u9yq9qwQIqlIWAuRUFZcsshsvGiiaelUp6eYFX/+zv5OaeY2W99s&#10;ssoiuxKiOj41a5sV506yK+EHPzRZwcxYaVOnis3rx6VrIUTykLAWImFsvHiSafX9RLPRD9PMqj95&#10;b0JcsmZrs5aZb1dCeGfGknXMqvMm2pXwm7rx6lSx25uZzTaxZ4UQSUDCWogEsN4PM+uq04ummLV+&#10;qs3b+lXzdqad7CCiBib/tI5Za4GEdRh8vfw6ZsZKiOwO5vOmG9izQoi4ImEtRExZ88cvHd9068Wf&#10;mHV/mGXP1s7XzTYwbVf53q6E8M6kH9Y2a38jK0jYfLpCSzNjqcCmkj1v+bXsWSFEnJCwFiJGrPzz&#10;N2bjpWK6zjs9xTQxwXw8m6zZShMWRdVMXrSaWes7DRaKEnzYM1ZaKrKbtTffLbeKPSuEiBoJayFi&#10;wAY/zDDtvx9vWn//kWkWQjbw3NU6mE2WV1yaqI5p3zYzqy/+zK5ElCxu0sxMW2lz88lKnZxBNEKI&#10;aJGwFiJCNlkqpNsvGm9aLQp3W/3rZhuatqtUThERohiz5//g7K6IeDFjxXbmkxU7mSlLhbYQIhqa&#10;3HnnnRLWQoTIzz//bBYuXGgWLFhgFi+ObnLd2muv7XwtQnhl7lwNGYozzZo1M6uttppZddVVzXLL&#10;LWfPCiHCoMmgQYMkrIUIgUWLFjmChFeUgjqHhLWoBoTaV18pVSYJILDXXHNN57Xiiivas0KIIGny&#10;4osvSlgLESDz5s0zn376qfOKk5BdY401TJMmTexKCHcg1j77TP7qJMHD0Prrr++8+NwLIYKjybhx&#10;4ySshQiAmTNnmmnTppnZs2fbM/GCm22LFi3MDz/8YM8IURnsBTNmaJx5Utlwww1N69atTcuWLe0Z&#10;IYSfNJk8ebKEtRA+gUidOHGiWfq5Mp9//rk9G1+4wc6frymMwj3YCqZMmWJXIqmsu+66pm3btqZD&#10;hw5mhRU0Pl0Iv2gya9YsCWshagRx+vHHHzuvJAlVqlfffad0EOEeCet0sfrqq5tNN93UeXEshKiN&#10;Jl988YWEtRBVgs3jww8/NB999JH58ccf7dnkQKVqrbXWikUzpUgGiC8sTiJdNG3a1Gy++eamY8eO&#10;zgO3EKI6msybN0/CWgiPYPf44IMPnF+TDtvBX3/9tV0JUZ6VVlrJzJkzx65EGsEessUWWzi/CiG8&#10;0WThwoUS1kK4ZNy4ceb99993GhPTgnzWwguK28sONDhuueWWZquttrJnhBCVaPLtt99KWAtRgfHj&#10;x5u33norVYI6B/m2DJNIopVFhM/Se4asQxkDgd29e3enii2EKE+T7777TsJaiBLQjIigJuUjzbRr&#10;105VSFERZVhnG64T3bp1cxodhRDFafL9999LWAtRwNSpU82bb77pNCVmAdlBhBvY2Zg+fbpdiaxC&#10;kyMV7DZt2tgzQogcEtZC5DFr1izzxhtvOD7qLLHyyis7L404F+VgoNAnn3xiVyLrdO7c2fTo0UMp&#10;IkLkIWEtxFIY5kKFGttHVlE6iKgEQ0WwRwmRz9Zbb+1UsHl/CJF1mixatEjCWmSWuXPnOoKaKnXW&#10;m/fY1p03b55dCdEYCWtRCjLxEde8GCIkRFaRsBaZhGQDxDSimmNhTPPmzTXaWJRlnXXWSUV2uwiO&#10;VVZZxbGHUMXmmiJE1pCwFpnihx9+WFahVnW2MbKDiHKsscYaTmOvEJWgak31GoFNmowQWUHCWmSG&#10;nKD+4osv7BlRiIS1KAc7GvQjCOEW7EM5i4gQWUDCWqSed9991xHVJH6I8qy++urOZD0hisGOzzff&#10;fGNXQriHITNUr7t06WLPCJFOJKxFaiGDmgq1tq69sckmmzhNnULk06RJE+1miJqhSZrqdceOHe0Z&#10;IdKFhLVIHVSmR40apfSCKpEdRBSDnPPZs2fblRC1wfTGXXfd1ay99tr2jBDpQMJapIaffvrJjB49&#10;2nllPTqvFhSVJYqx1lprpX60vwiHDTbYwHz//ffOca9eveS/FqlCwlqkAiLAqFLPnDnTnhG1oExr&#10;UYgyrIVftG/f3nz55Zd2Zcz6669vevfubTbaaCN7RojkImEtEs3ChQsdQY2XWviH7CCiEMQPfQtC&#10;1EK5Ho6uXbuabbfd1jRt2tSeESJ5SFiLxPLOO+84olqNdv7Dtv+SJbo0iHpUsRa1QlzjhhtuaObP&#10;n2/PNIas9D59+jgP90IkEQlrkTjmzJnj+Kg//PBDe0YEQevWrcveAEW2oMls0qRJdiWEdwotIOUg&#10;NaRnz55m1VVXtWeESAYS1iJRUKHmRZ6uCBbZQUQ+jKdWD4OoFnbBqFgvXrzYnqnMSiut5DQ3durU&#10;yZ4RIv5IWItEQKUMQT19+nR7RgRNixYtnKQVIXLIdiWqpUOHDlVPveUhv0ePHo4dSYi4I2EtYg1T&#10;3hDUr7/+uj0jwqRVq1ZOg6gQfBa1UySqgamLtU7sZEARjY2K5hNxR8JaxBZGkSOqv/rqK3tGhI3s&#10;IAJWXHFF8+mnn9qVEN7w8zpCJB/ieuONN7ZnhIgXEtYidnz++eeOoB4/frw9I6KCrVdVKcXqq69u&#10;pk2bZldCuCeoh3Oi+RDY+LCFiBMS1iJWjBkzxhHVualcInpkBxHrrLOOM4RJCC+sssoqTtNirTaQ&#10;UvB3471mPLoQcUHCWsSCKVOmmFdeeUVVsRgiO4hYb731zIQJE+xKCHd4iderhc0339wR2GRgCxE1&#10;EtYiUpa+/8zIkSPN2LFj7RkRN5i4x89JZBcNhxFeYZeDIVNhJQutvPLKjrju0qWLPSNENEhYi8ig&#10;Ov3iiy+aWbNm2TMirtAw9O2339pV9HDDxp7y3XffmR9//DFTUyJJR2DkMw2FZEuHMf5ZVhDhlVri&#10;9WqB/27v3r3NaqutZs8IES4S1iISqFAPHz5cOckJIU52EG7WbC/rvVMHExGxaiy33HL2jP+oeVF4&#10;gcSOBQsW2FX48H5FXGNFESJsJKxFqDAiG0H9/vvv2zMiCWywwQaRN5RSlZ4xY0akN+y4wjY4WcHN&#10;mjWzZ/yFv/ezzz6zKyHKs8kmm8RimFC3bt0cgc0ujxBhIWEtQoPmJ6wfyqVOJlGLayqmSicpDdYQ&#10;BM3yyy9vz/gHkYtBJTuIdNGuXbtYXeOxsSGu6RURIgyC2zsUIo+XX37ZDBo0SKI6wVAVjQqqpRLV&#10;5aHBdM6cOXblH1T7JKqFG1ZddVWn7yFO0MMzZMgQ7ZKK0JCwFoHCsJcHH3zQidITySaqajVe6iia&#10;oJLIvHnzfBfBUT5QiWTBrlbchDUsXrzYKe4MGzYsVk3YIp3ICiICY9y4cY71Qxey9ECTHDepMKFp&#10;cvbs2XYlKrHmmms6299+wRCOyZMn25UQxUlKLCfvZ6wh2KaECAJVrIXv4Md89tlnzdChQyWqUwbx&#10;bmGj95A3/K5Yr7DCCvZIiNJgA0kCPKg/9dRT5rXXXrNnhPAXCWvhK9OnTzf333+/eeONN+wZkSai&#10;qEiFXSFPOjzY+okSFUQl2rRpE8qERT95/fXXHe+1bGbCbySshW9QAUBUE4km0smnn34aSOpEObI0&#10;/CWO/Pzzz/ZIiMaEfT3wEwpBTzzxhBk/frw9I0TtSFiLmiFXmIvT888/70zBE+mFRkJNNMsW+kyL&#10;cuBVpmk2qdCU/dJLLznNjVFn9Yt0oOZFUROMOaZBUdtp2YFBJGHGr02aNEk3PI906tTJHtUOqSB+&#10;NY/yYMYra7sQTMWkshvkdMwooFGW/PQkNC26gdH9NDYyOVKIapGwFlUzYsQIM3LkSLsSWYEpfKus&#10;sopdBY+EtXf8FNZQyxQ9rCT8/5m6mvUx9CuttJJZY401EtPoV4kOHTqksqjSq1cv0717d7sSwhsS&#10;1sIzZFMzlpxqtcgmNCuFtf0rYe0dP4U1uxPVNkSS6ML1QnaShiCs11133URXsDfccMNYZlb7BRYX&#10;qtfE8wnhBXmshSeYXnXfffdJVGecrFceswLb/NWKagQ5FhKJ6sYwRZTvTZItMWkfHDRlyhTz+OOP&#10;m48//tieEcIdEtbCNaNHj3YuNGH6a0U8kac+G2BdqAbEOGPoRWnYhaGan0Tatm1rvvrqK7tKL+y4&#10;0JT/1ltv2TNCVEbCWriCgS/YP4QARAFeUZFuqh0Og+hSTF9lSFRK2gCkWnYxksqrr77qpIYI4QYJ&#10;a1EWLvoPP/ywBr6IRkg4lYahKgcccIA57LDDnOSEpFJNRjHWD6wOwh00dSaJVq1aZfLniw2SacJp&#10;9pULf5CwFiXBA/jAAw/IYyaKkrRJa2FBQ9pZZ51l+vXrZ3bffXfzy1/+MrENUNU8PKUlei0skmSt&#10;a9GiReIeBPxk2rRpjh3Sr/hJkU4krEVRPvroI/Pggw+aOXPm2DNCNITdjNVXX92uBFDhRVR37tzZ&#10;nqmr8J155pmJtM5UI6zVrOidpOz+8ICYNRtIIdicnnzySTNhwgR7RoiGSFiLRrz++uvmkUceSZz3&#10;T4SPxo3Xgx8ZUb3lllvaM/UwcILfS9qDyOLFi+2Re2QR8k4SPkc8IKppuQ4+Fy+88IIskqIoEtai&#10;AVwsnnvuObsSojxff/21Pco2DM3B8lEuP7p169ZO5TpJw0HkJxU5qm1kTTNjx45VU6NohIS1cKDK&#10;9OijjzoXCiHcQhPTaqutZlfZhJQEqtGbb765PVMahk4grps3b27PxBsJawHE6+khujg0NQ4ZMsSu&#10;hJCwFkth3PDdd99tPvjgA3tGCPeQgJFVGJJBpdqNqM7Rrl07c8YZZ8R+wAZNmMqsF6ussooaUisw&#10;ffp0c//99+tBVDhIWGecqVOnmnvuucfMnDnTnhHCG1mtZFF1RlRvuumm9ox7OnTo4Ihrqt1xJe2T&#10;9YQ7GF2ufpvKcB3kXqrEECFhnWHeffddc++992Y6PknUDkMusmYHwSeN/aN9+/b2jHc222wzR1zH&#10;1bsaZ9EvwmG99dbLxIRFvyAxBUuldn+zjYR1Rhk5cqR8YcI3smQHIdkDUY2lo1Y6duzoeK6rGcQS&#10;NE2bNrVHIqvwXlfyj3eYUsy0RpFNJKwzCBmcI0aMsCshaicrux5kUWP/oJnLL7bYYgtHXONpjhNZ&#10;9s6LuhQbxetVz1tvvWWeeuopuxJZQsI6Q3z//fdOg8U777xjzwjhDzTAJiXpoloYTU6lGsHhN2Rf&#10;YwuJE8qjzi48VOnBqnamTJli7rvvPrsSWUHCOiN89tln5s477zSTJ0+2Z4TwlzjaGfxi7bXXNr/6&#10;1a8CEdU5unTp4lSu40LWJ+xlGXZk5s2bZ1eiFig63HTTTUoMyRAS1hng2WefdUS1mlBEkKTVDrLO&#10;Ous49o+WLVvaM8Gx1VZbmRNPPNGuokURa9mERmTFLPrLTz/9ZO644w4lhmQECeuUg8+LaYprrbWW&#10;PSNEMFCZIfM2Tay77rqO/WOjjTayZ4Jnm222sUfRooi1bLL++uvroSogSAyZMWOGXYm0ImGdYt54&#10;4w3HUw3kVLOdLUSQpClJAoFBpZoc3zB55ZVX7FG0SFhnD97zalgMlieeeMKZHyHSi4R1SmE0+YMP&#10;PmhXdTdJAuyJTxLFIU+4WbNmy175+cKFv5cvIMv9Xv75Sr+X8yjTNOTl93JpEvxa7HyYpGULeYMN&#10;NnAq1QiNMBk9erQzZCJqyLCWxzp7pL0BOS6QzDVp0iS7EmmjyaJFixRSmTLIzxw8eLBdNQTBgDhT&#10;I0VjTjnllAZb/p9//rm57rrrnGMql/kV/2nTppnbb7/dOf7tb3/bYErdRx99tGyn4JJLLnF+zfH2&#10;22+bxx57zKy00krmd7/7nT1bB6IKPzy2HRrl8nnxxRfNyy+/7Hx9fJ35cJF+7bXXnGElxxxzjD1b&#10;fz5seI+RQOMX3ID8/PsqQYWaJkJsIGEyatQopxfCDzp16mSPqoMEFBINqoEHeL/7OfiZHHLIIc5Q&#10;Kz4HYcOD6mGHHeY8bDzyyCPmxx9/tL/jD5tssknkzb9t2rRRw2LI7Lbbbs6gKJEuVLFOGdycS4lq&#10;mDNnjlNhjVtmbpSQTXzCCSc4TWqlKBySUO3QBDf/P69/d+7P+/U11kqSJ/bRoMhDTdiiGvuHX6La&#10;DxCScYGv5fe//73p1auXOfnkk83RRx9tfycceD//4Q9/MHvttZfZb7/9zPHHH29/Jz2wk6Z4xfCh&#10;/0lTGtOHKtYpgqEvbqcpMjVOKSF1IKipUFIVfeCBB+xZYxYvXmxmzZrlHCO48q0h/FkeUmDjjTdu&#10;UG3CdkO8IVAFys+DZfz3l19+6RxTpcqHahHVPm5yrVq1smfr4Dy/j8gobKTj7+PvpQpOtZjKGk2E&#10;Q4cONa+//rr9U+HB99PPil5YFWt+jrwPwm705XN7991325U/1FqxxgLDzks1+F2xZiemcOeH61y+&#10;1S2fFi1amK233tq8//77FVMYsD7wmeJrLkZuZyl/dD1NuoU7SrUSdcWaf1/uuiTCZ8cddzSdO3e2&#10;K5F0JKxTwksvveRs/XuBLaicAMwyVCcZzoE/+B//+Ic9K2rBz2SBMIQ1X++f/vQnuwoPbA1BeKpr&#10;FdZ8Jj7++GO78kYQVhAqxoVb5liqBg0aZFd18FB64403LnsIPvfcc0sKxl133dUce+yxjqAlrQGL&#10;Rz7FRDXcdddd5vnnn7crf4hSWGP74eGCQoKIju23396J2xTJR36AFDBs2DDPohomTJgQenOWyAZJ&#10;s4N8+umny/z0YcHDcBwaFYsRN1vAVVdd5fQ15HPggQeagw46yK7q2HzzzRvsLHXt2tUeNaZv377L&#10;xCxe13x4/9I7USiqn3nmGd9FddSwwyRRHT3YwYjHFclHwjrhcJHnYl8tbPdiH8gyUXmRgwIrCJ5x&#10;REZUJKU5lgfLXXbZxTlm1P/111/vHAfN8OHDzb333mtX8SNuOcbsJv31r39tJK5paMT3nCNfVEO5&#10;Bzwq0jnyj6neXnDBBaZDhw72TB0UL+L6IFQt2MoUrxcfCB6Iwr4n/EXCOsFwoX/uuefsqno+/PDD&#10;TFeuubH88Y9/TI0NBK8w3u4ooxVJVCkUOXGDB8rzzjvPHHHEEWb33Xd3zpHagpUgSGhYuu++++wq&#10;noSZwuIWxPVf/vKXRuL68MMPdxoL/QBRXaxSzbU2l/STJpLcaJxWSHJCYIvkImGdUPADspXsF9hC&#10;wk5CEOkmP4IwblCpO//885c9fFDlz4nrN99809x0003Osd+ww1Sq6S5OxHU4DDshiOvCDGCSQryK&#10;68KdqpyoLvRyk7KURlGNr7tU06aIFiwhcRkUJbwjYZ1A2EIeM2aMXfkDN5msTmfMxe0NGDDAnkkH&#10;UVtc4mYnyJET1auuuqo9Uwfieuedd3aOmVp68803O8d+we7SQw89ZFfxBd9xnKcuIq6vuOIKM3Hi&#10;RHumDsR1oVfarVec+FF2LwpFNQ9B5eJLkwoPvRoAFG/GjRvnJAaJ5CFhnTBuu+02xwsaBNxMiZJa&#10;bbXV7JlsQKUK6wQWijSRH/MXBTQExi0vnZ8xopo4wmIcddRRy8Q1XsdbbrnFOa4VBv88/PDDdhVv&#10;4rzTkAOrypVXXtlIXBc2K5Z7/+V/PniY6Nixo13VQfqH2/jSpMHDZVqmpKaZ9957z+nHEMlCwjpB&#10;kFpQbbasW4jJopKRhJurKM6//vUvxzMexdTFQgqrwlGy3nrrlRXVORDXJEYA38Nbb73VOa4WmosL&#10;Y+HiTH4jX5xhR4SGxkJx7QdBROrFBVJAKKCIZMAAGfoyRHKQsE4IxE1NnTrVroJF0xmFX8TJDrL/&#10;/vu7btY68sgjl1Wux44du2x8vVeeeuqpRvnIcSeqPGU3UFUmc55JjLx4UCp3nSpnhyr1e1TDt912&#10;22X/jQsvvND0798/Vg+JtUBu9U8//WRXIgnQA1VL+pcIFymnBHD55Zcvm/IXFnTehz2BLirIcOWh&#10;Zfr06fZMsolD3F6OOA0g8pp0kW8LoUv/jjvucI7dQpIEg0eEfzAZs3fv3o7Azr2YIluKcnaoUr9H&#10;xT7/799iiy2czOzcLkaSYaKr4vWSCQ271cyrEOEjYR1zLr30UmeUdRR88sknzvZ52uH7i2jKH2ee&#10;ZOIQt5eDqmAcvg6gCY0GXS/ki+vRo0ebO++80zmuBN5cJgMmkbhWM9lt8Nr/gc+/FF4TMdJwLWQy&#10;pUguFICeeOIJuxJxRcI6xjBON+pBG5rOKGolLlPdaM795z//WVZsFQNxzbhhGDVqlPnf//7nHJeC&#10;G1+Sb35xTYvAVoQtxy00n5abZPfiiy+6fojge+J3ElPYUNmXtzr5zJgxwzz++ON2JeJIk6UXq3SN&#10;nUsJl112mVmwYIFdRQ9bomHbUcKCuL2DDz7YeYhJQ9X617/+tVPZGzp0aCymeFElq8WfyhaonwNL&#10;+N7gzfX6wEhDWy5bdqeddnLi3Qrhhsf3PWo6depkj7xDZdjrw0c+VIJpgg4KBvtUsqlx7USAVIIm&#10;bfKcy8GuC+/BIB8Q+RqC9LY3b97ced/HcfCPqA7uybmpsSJeLH/xxRdfao9FTLjmmmti54Pj68Fe&#10;kMaIJqwKe+yxh3OTpSKZdPr06eOII9ISZs2aZc9GB1nCbKNX28iIUPvxxx/tqnYQSDxwdOvWzREc&#10;biHKja8FLz5bsoi3Ll262N81jvUjLh7IWoY9UZ2tpekU8RbkTtvChQud61G51/z58+2fLg/vq2L/&#10;/8JX0PYYGgqDbBbn2u32eyKSAe9LaNmypfOriA+ygsQM0ge8+kDDQtMZk0Gc4vZyxM1egCj++9//&#10;7rm58rjjjltmC2HyaW40OU2KaWksitp+JvyFh9qcCBPpggLB+PHj7UrEBQnrGEHW7YcffmhX8YMt&#10;0axOZxS1EaQ1oFqo4CGuv/zyS3vGHYhr4tiA4Q2Ia2L10gCJGHH1WIvqSEtMoCgOD/ikeIn4IGEd&#10;E5jM5qUxJypoAGM7PE3TGRW3FzxYC+L4nqlWXJ944okNxHVa0GCodNG6detYPtQKf6GvI07RpllH&#10;zYsxgBivpOXdbrjhhk4FW80w8SPXvIg1IU52EMYo82DmFb+bF4tBM9wFF1zgeF3dkt/MGDeqbV7E&#10;NoDlqxbi0LzIwzJxoZVw27w4efLkQIcdBdG8iGeb3Gp5q7MDg628XMNEMEhYR8z777/v3KCTSK4h&#10;hhuPiA9xFdaIGLeTD/MJQ1gDo55JC3FzY4qzqIZqhTVJKR999JFdVUeQwpqpiwyIcQO+4t/+9rcl&#10;G1932GEHc9JJJ7kStNhj/v3vf5t3333XnvGXIIR1+/btPe/EiORz/PHHm1VWWcWuRBTIChIh+KKS&#10;KqoB+0QapjPSkHnJJZeY8847z54RQUBTnJcUjrBBiGELqVThu/fee2MtqmuBBJe40qxZs2X2Gzfw&#10;oNS9e3e7asyee+7pWsyusMIKplevXnYVf4gQJT1FZI+HH35YfRIRo4p1RBDUf9VVV6XCSrHZZpsl&#10;2t/FDZhRyUQJ/uMf/7BnkwseawQsFqNaq49+U40dxGvFmmoNyR004lUDVduePXvaVUPefPPNQD3V&#10;VPWp9tbajFRtxZoHZWwPtRBkxZooUi9b3eUaS//2t785thK3PPTQQ4EN/vG7Yt2hQwclgWQY3tfM&#10;ZhDRIGEdAWSiIuDS1FRCo1wtQyWihIo1W8xpEdZxBtFL5dELXoV1qeEtSYF/75VXXmlX1VGtsOaB&#10;rNa4zyCFNdeZ3XbbrYG45mEEW1ox2F14+umn7aohfI/pFSkEfzZiPL96j6XijTfeCCzH309hzb9J&#10;kYkCKxC7MiJ8JKwj4LrrrnNsFGkjqdMZJazDhYEGXgSKV2FNtaZ///5VV6yjhH4FRmfXajWpVlgj&#10;7mr15QbdvJgPovqiiy5y0i+KUW3FmoQmrtNhWWP8FNaMLk9T0UZUDwOs6CUQ4SJhHTJ33nlnqgPd&#10;k1i5TttI8zhbQSBoYS2qF9ZL7wc1VzvDEta8xy+88MKSohpqsYIgrv/73/+G0pztl7Cmcj9v3jy7&#10;EsKYHj16eOpNELWj5sUQoakg7VOSPv74YyeyK0lwI7rjjjtSIaph4403dm6wjGqPI7rxx5OmTZsm&#10;xkKAqP7973/fSFQXpnaUE8X5v4c9r3A4F2Jk4MCBpkmTJvZMvMFi5efof5EOsDC9/fbbdiXCQMI6&#10;JKiaxCn6LCjYOtV0RlEO0grYwhfxIik/E6Ik//CHPzgPkPnccsstzi5NPm5FMdctbGCFGd40wZ52&#10;2ml2FW/4fgTlARfJhs8F0b4iHCSsQ2DkyJGpms5WCS7upJ4kZZSu4vbCx88EBOEPSfCkY9tCVGMn&#10;ygdR/fLLL9tVddC0iD2kUFz36dPHnHzyyXYVTyhkaBCMKAefD3aURfBIWAcM8VxBRTTFGTyWbEsm&#10;4WadtgE3jGanOTbON9oFCxbYIxEX4v6wg6i++OKLGyV5YOOqRlQXq2bnxHXh1EaSZuIsrolJVHax&#10;qMTzzz+fyuCEuCFhHSBUPgYNGmRX2YOEEK/RalGQFA+lW8jbRWzEsXExBz7rJKZ2pJk4P2AiHEn/&#10;KOzf4H0+bNgwu2rs36eRshT5fzb/IRRxfcUVV5iJEyfaM3UgrplqFzcYW64Ji8ItL7zwgpk9e7Zd&#10;iSCQsA4IfMY0K2a9mYRBFy1atLArIeqhWU7EBxr44giV9AsuuKBRgsf//ve/BqIaPvjgg2WDURDO&#10;5Zq2iDTMxekVWvVIRylWuSZDe5999rGreKDPkfAC723EtR7GgkNxewFAZ/3tt9+uLZc84jydMW1x&#10;e7/+9a+dBq+hQ4ea119/3Z6NH24n6CluzzvVxO2RIlPrxEfwO25vq622atT/cM8995hnnnnGrhpD&#10;FZfiRqUqPOki7KqVqmyzq4KoJxs6BzYmJrX6SbVxe23bti1blReiFEyY7devn1lxxRXtGeEXqlgH&#10;AJ5qieqGYIvhgxxHqGylKW4vR9wtLjS4yg4SH6hkxREiSvPTLiqJapgxY4Yrawt/bzlhygMdExqn&#10;TJliz9QlLMQBppjG9Wcm4g/zJkaNGmVXwk+Wv/jiiy+1x8IHXnzxRTNixAi7Evmw9URlhrg1ERyk&#10;GFCFoAN81qxZ9mw8oWqNp7UcVAgr/RlRD5XPddZZx67cQ/ObH0INMepnHjZ2jffee895AH722WdD&#10;v75i58M2wr+Lr+Oxxx7zfSIjn4PllvNW5yLDW0kgohawTWElKjbaX1SPKtY+Qk7k008/bVeiGAxh&#10;KDftLAoUtxcd3377rT0qjara3qg2jzrOGcjsAA4ePNgZdhEFPNgNGTLEsVfFoW+GaxY7PkLUyquv&#10;vtpgR0bUjoS1T7Ct8vjjj9uVKAe2EG4McUFxe9GBF7dSckxS8tDjAv56r/DwEtfmRdEYfsb6eQm/&#10;YNaGvPr+IWHtAwgzfNWqILiDbVQsCnGZzqi4vWipJKzxklYjFrMI30ui6bzC91gkAyYs+tkc6hdY&#10;dfC281AvkZYssNvlp+SI2lAqiA/guVMTgHeI4eOGHvWwEKrnZ5xxhrMVzlhjES74gSttr+P9nTx5&#10;si78FUB0VfMQgj0Lm5YfIKriKPzijJdUkDZt2jTI4A4bvObvvvuuY338/PPPnZ2xUn0z2JJIm6GI&#10;ssUWW5iuXbs6axFPSOBhjL+oDQnrGqFD/NFHH7Ur4RWaJhBLUXa3I+633XZbx0eZhgekXNzek08+&#10;aV577TV7Nt7wkFVpa5sHMGwuojiI42p3gUjs8WuHQ8LaO26FdVTxeghn/O2I6VrHYvPwRxxkjx49&#10;YmUJFHUwCGnLLbe0K1ENEtY1wPCAW2+9VV63GlF3u78kUViTO+wmLYZmR/oZ/EydSDorrLCCI6pr&#10;scsw0ZDeBz+QsPaOG2HNz5fc7TAz3Sl4MISHATp+J/OQgtKzZ09n4A6zBEQ8ICVk3333NS1btrRn&#10;hFfksa4StuJoVpSorh2GUkTpt0aYcGOjkpImktSU6XbHgt0FqnbsdCAysgzb7FSa27dvX5OoBqL2&#10;RLyhuhuWqOa+9tJLL5k///nPTsRhEHGX7FSOGTPGXHbZZU6PkpuEIBE82PLYuVUsbvWoYl0ljNMl&#10;01T4R1TTGdPmsU5ixRpouqvmYYD/T9qSXcpBs63fDbc8sPiVea6KtXcqVazZkQhLVLN7eNNNNzmT&#10;K71A1ZniBO8l+iHwX3uBa9bAgQOd3SsRPZtuuqnZfffd7Up4QcK6Cpj6xfaY8J/NN9/c2eoPE5rn&#10;GFFM1e6+++5zbgo533U+WH/w+NJ80717d3u2Dhq/5syZ43iFu3TpYs/WwQMYQfxUF2ngyeftt992&#10;0mS4mXTo0MGerQNRjNjnpssrH7z9VHm5+BVu2fHfoZrJn0lKMghwU466kTWrsC3vlxiWsPZOJWHN&#10;SPUwvqeIaUR1JWseTW677bab48flusUuEtfMQvBjT5o0yUmcYHgav5aD3cOjjz7aaXIU0bPNNts4&#10;dh3hDQlrj7z55pupG30dNzp27OiI1LDIVayBPM8XXnhhmdjO57nnnnO2yBCAJ554oj1bB7agt956&#10;y6m6H3nkkfZsHQ8++KD54IMPnJvFQQcdZM/Wceeddzrh/L179zZ77bWXPVvHDTfc4Dxk7LLLLs4N&#10;LJ+rrrrKufnhhSu88F1++eWJ3NrH56sJi9HA992vrXgJa++UE9ZhpYBQAGAnttRnkKIB1hCub9V6&#10;oumNwFpywQUXlH3ox3e955572pWIEh6guK8J92ikuQeoViKS5EcMFqq73EzCmgRHlQTPLjcvRC6i&#10;Pv9c7kXlhe1NxoUjAvN/b+LEiY6YoFLMDSj/92gK41c8wYwuzv89Kt142aiCMwgl//fowGf7l/8P&#10;f2/+7xF3xfsQbzpfa/7v8fDXrVs3c9xxxznd97Nnz06EX46ft6Yshk/u/eMXfor0rIANqpi9h0Yy&#10;rgtBP3DSnMhuXameoXPPPdc88sgjThRbLZ9R3msUTs466yznGsrUv2KNyFxPv/zyS6cyLqKF4g5W&#10;JA3qco8q1i5B4Nx+++0a/RkSVG/Y/vTq0xN1nHTSSQ28is8//3zFbdg44DYdRPgH1UeGevgFD0hh&#10;7jilAa51xYQ1jakIzCDhQZxKdTGwmj388MON7G1+wfX98MMPdxoli8FO3oABA+xKRMVGG23k7CBQ&#10;4BGVUSqIS+halqgODyonVFrjMp0xaRQ289GEcsIJJ8S+6lBpUIzwn0qTL73Cjo5wD2KlmKhmpyro&#10;ngPuaaVENYKW7OpSoppK5rXXXmv2228/Z4eM2FSuL/j1EWKdO3d2rjtXXHGFGT9+vP1/NQQbHt7r&#10;P/7xj/ZMQ6hoJ6EgkHZobB47dqxdiUqoYu0CnqZJWBDhg62CG4+qmN6gClTYKAnsvAwaNMjZao0r&#10;CAoRHn5OXcxBxTosK1fSodm42ANv0NVqvPD//Oc/i/6c6O8goaMYI0aMcDzSNEd7ger373//e3P8&#10;8cfbMw1BYB911FFFm9dPP/10+XxjQJ8+fZyHKFEeVawrwJO2RHV0cGMh71TeW2+UehDh+0jXfb9+&#10;/Rz/ZhzJej512AQRVaiHI3fwXi8mqqn4Bimq8WzfeOONjUQ1lXNSr4qJaqJQjznmGLPzzjt7FtVA&#10;QsgvfvELR5zRP1IITdo0hxcbeY4NM2hLjKgMOwikZonySFiXAf8XaQ8iWtiG0vayNypVC4lRogpE&#10;+knc4EFKhEcQQ654gNO46vLQyFfqe+S3PaeQp556qmhlGNvGHnvsYVf1sGvLDti9995rz1QPQ2Go&#10;eiKWCyG2b/DgwY0SUthp8+O/LWqDh3DEtR5yyiNhXQZENdtlInporsIWItzhxjqDf/20004zvXr1&#10;smfigRrfwiWoxAkqjxLXxeHBg9ShYhF7iEuy7YOCBBjsHIVgwzj//PPtqh4EMF5pP++FPMzRYP2r&#10;X/2q0YMdleurr77aruohlalYpVuEC+9NHo5k9SqNPNYlILOYJAURL6Kazpg0GLRzxBFH2FVl2N7D&#10;ex2XiyVb4YpsCwd2g4pVL/0C4c7NWMN/6uLzSGEpZZXhZ8EuUpCfw/vvv98RRvkwZAqrRqHljkm0&#10;v/3tb+2qMdhYiMSjUZEHdR6m+Dfmoj+xUr7zzjtlK5xk+xPlVwhZ1thS8qEf4He/+51diSjg/Uvx&#10;g6bWYrsbQsK6KDR23XzzzXYl4kYU0xmTBjfKk08+2a7cQZ7sQw89FAsPHV+/KiLhgPWm0qQ9P+C/&#10;Q/Y6FcosjaAHkjIQnNg/yhF0wyL2xr/+9a+Nvv8kg9B7kc+QIUPMgQceWPRnxYMvVWwsHW7G63NP&#10;ZfBWqSbZCy+80PzlL3+xqzr4/2A/KaxoU1nXNMBoYNeYpBjgIRDPvZpKGyNhXQBxX4hqRevFm7Cn&#10;MyYNqgrnnHOOXXmDahY7NkF4b92CAFETYzhQSY7yZy3qoFKNiA3yZ0FluNAGgjgmyzofJsXSh1E4&#10;vIUHBCrJiOpq4O9l2uxS3WHP1MOAmsLM6l/+8pfmv//9r13VweTbX//613YlwgDLEtfkwgcjkl6O&#10;PfZY9UAVII91AQgKier4wwecyV2iOLVsu+O5xnsdZYY4lU0NIwieVVZZRaI6JmCjCPpnMW7cOHtU&#10;D+kghSBwi01EPPXUU6sW1UAFGh93MSsMnmum7uZz6aWXmtVWW82u6mACsp+TQkV5qFJTxCq224B9&#10;qNRwnywjYZ0HbxxGu4pkQDNLHFMt4gDb7sWqQm7h+0pqCFWrqKA6JoJFDy/xgImjX331lV0Fw7Rp&#10;0xoJUh6iC20VpG+89957dlUPFgw/tv0RaojowrhPeiouv/xyu6qDP8tgq0KKPSAI/2HUPtaPcrY8&#10;dkA++ugjuxKgO5eFOB+q1SI5YNthOiMfftGYWofqcOMj7xrvZRQ54oXVK+E/lTy/IhwKRWYQvPvu&#10;u/aonv33398e1XPxxRfbo3oYLe6nr5kHiUMOOcSu6vn3v/9tZsyYYVd1HHDAAfaoHgnrYGEnC1vS&#10;W2+9Zc+Uhubkl19+ObB0oSQiYW1BVBd+oEX84Uka20PcR3VHgV/TKjt06GDOPPNM06ZNG3smHKi4&#10;q6IaLFlrIowjQcfr5SgmRguFNQ2Lhc3LPFQXE+C1wqAYBHYht956qz2qo2/fvk7PSD7sVqq5ORjY&#10;rcQLT8StW2g0ZXKmqEPCeilse40cOdKuRNKgson1QQ0UDfFzDDwPLmzJ4q8M06JRLOdXiLRAgy67&#10;pUFDNbEwppQcbSLT8nn66aftUT185qlgBkGxqnXhpGOuATRM5sP1XoUw/8HP/vrrr1f1wC1LSD2Z&#10;F9Y89coCknyYzqjqZkP8FNY5tt9+eyfGL4ytawjad5p1sFOJ6CCXuViToN8UG+6y3Xbb2aN6Hn30&#10;UXtUD5XloKBaXzhECGFHLGA+PXr0sEf1qIHRP2gmRQsVswu5hYZzetT4NetkXlgjqhXblg5Ic9F0&#10;xnqCENZApatdu3Z2FSw0NEXh784KYVRLRXHWX3/90B4ci4lQPsf5IL4pUOTD1xhUtTrHJptsYo/q&#10;KObt5QGkkDDsM1mAe+bbb7/d6GGmGrDokFeedTItrJkINXr0aLsSaeCTTz5RDJ8lKGENYQwUyRFW&#10;dTyLhFEtFcXJNYiFQTERWihWZ86caY/qQVgHTbH/RqHALyasVbGuDRqXmzVrtmzgi19gCZkwYYJd&#10;ZZPMCmuEwbPPPmtXIk3woQ7jhhB3/BbW2AaobNBcFOYuT7FtbOEPGhsfDTQCh/m+diOsC8UshDGk&#10;qdh/o1Dkq2LtL1Sp+R4HIYC5T9DImGWbWWaFNRYQxXmlF5oosi6u/eqapzv8scceM3/729+cX8Nu&#10;GuLfITuI/1CxkhUkGmi+C5Ni14LCAVDFRqmH0bdSTFgX3puLzSsIckcuzeCnpkod5EM1lpDnn3/e&#10;rrJHJoU1b6qxY8falUgriOvCxpgsUeuNBwF91VVXmTvuuMOpVEfZlKK8Zf8J2jsrikPDXi2TUauh&#10;2M+6ULwWm7Qaxo5Gsf9GYbxese8XNgbhHpKduIZzLQ8Dsq2ZzJhFMiesaRZRCkh2IJM1qw2NtQpr&#10;mpviknOsbV//kTAJH8aWR+FrLxwLDp9++qk9qqPYDl8YDwDF/huFX0uxJs8wbCppgYo/scLFfPRB&#10;wXh+GhnD3p2JA5kT1ohqeTazAz4vbiBsf2UNRHEtFSfyY8mwjQPcfCUE/UUZ4eHDDloU9ptiwrow&#10;17qYsA5DiBWzlhV6qovZVLTj4g4eQIgwjAIKW1m0hGRKWI8ZM8a8+eabdiWyApVbXlmscNRatd5q&#10;q62KNg5FgXzW/hKX3YiswA5QMYEYBm4q1nx9hdY5dopmz55tV/5DNZMpf4X06tXLHtVRbPCIKtbl&#10;WWuttZyCxPvvv2/PRAONjExmzBKZEdY8ncsCkl1yfsKsVT0rCWs31bM999zTHkWL4rX8JYtbtFES&#10;5WTYYsL6tddes0f1FBtdHmQkLYUupkLms+WWW5qNNtrIruogwq0QJT+VBvsjWeBRPcjlw3WGqnWW&#10;HuQzI6wR1WH4xUR8YVsza9uHpZJB8L8NHjzY3HvvvfZMaWi2KtbYFDYIazUx+kehoBHBQbxelH0C&#10;fH4Ld3zYpi+sZu677772qJ5Ro0YFkluP0Co2Qr1fv372qJ6XXnrJHtWz+eab2yORg4c3LF5+Z1PX&#10;StYsIZkQ1lwYxo0bZ1fZgQsXAgqfcdZepapxTGcsFt2UVoo9TCJQb775ZuczMX36dFefjY033tge&#10;RYvG1vuHovbCgYdBrsNR0qRJE9OlSxe7qufxxx+3R3Xst99+jT7rfO1BiCJ8v4UVVUThqaeeald1&#10;UK0ubF7kQaFYFT7LUKXmes6QtDhCI2Ncvza/abJo0aJU1+cJvUdEZGkQAjdMLABZn6rGxD58eFyA&#10;ubHks+mmm/oywjXu9O7d2+y11152ZRyv26BBgxqIKqr4Z599dlmbzEMPPWTGjx9vV9HBDVUWBn9A&#10;MGkXL3jat28fiy15HqBvv/12u6oDL3Oh1eOWW24xAwcOtKs6lltuOXPKKaeYjh072jO1gTXvX//6&#10;V6N71Mknn2xuuukmu6rjuOOOM3fffbdd1bHzzjubgw46yK4E8YRMko477dq1a/TglEZSX7HmaTdL&#10;oprtRgSjRhXXJYJQnWVKYGF1jnzNLHj0EMM5O8jw4cPNPffc0+h7weejXP8B76k4iGqgcsVNXtSO&#10;XwOERGl4EAxz/H85ioliGvoLvdaI2w4dOthVHTzM3njjjb5M6uMh4/rrry96j7rkkkvsUR0keBWK&#10;aujTp489yjYUjbB0JUFUA4Njivnl00aq71CIgSylgFAFUAWqMQjsYg8bdJqvt956dpVOuKn/+9//&#10;dqpDxXyKOdiW/fDDD+2qHnZ87rzzTruKBww6ELXBTo4q/8FDzGeUg5XyYUeqU6dOdlXPueeea4/q&#10;4TPPjl8hN9xwg7OlXy0kgPz9738vmkvNdaply5Z2Vcc///lPe1QPVhU1LtZnUxcbRR9nGByT9rkE&#10;y1988cWX2uPU8cgjj2Qms5o3qipQ5Vm0aJHj0c2veFI94UKd5l0NBJSbRjUamaju817Ci44Q5yYa&#10;Ny8uAkGisDYYVKI8/2Bp1apV7JJssAwUVqjx5Xbu3LmB6OaayAPss88+a8/UQ9Wah/DWrVu79jnz&#10;gP/ggw+aIUOGFPWbH3LIIY1E9LRp08xRRx3V6M+TUsR/O8tg30tKlboQ7sOQ5ubT1HqsaVh87LHH&#10;7Crd8EYtDPsXxaFSV5hwQXMRN5JiVRQRT7I48MdPqPgVywYW/kESSBwjIvEwF2ZH4wMvNn768MMP&#10;Nw8//LBdNYac+65duzoRecXiBPnv4O0mpaJU5R5R/+qrrzZKbDryyCPNAw88YFd18GBw0UUXZTYd&#10;iHsXRY803KtOP/10s8kmm9hVukilsKZx79prr81MRYaqa5Z85LVCRmrh1DkqL3RVp32LKi1QsYqL&#10;dzWJMAyk2GAO4Q9EVMb1/sOu1JVXXmlX9ZxxxhnOfbOQYs2DxaDCzU4IFhIeKNw8VGyzzTZOMknh&#10;ECq+d1yPC6GC3bNnT7vKFojqNFlbeaA69thj7SpdpNJjjYcnS9uccduqjzvFbBF407HSaExuMsht&#10;J4rqkJUmOLCbxfn9iYgt1vx33XXXmf/85z92Vc9dd91lLrvsMrsqDQUt/L5YONyIairS3KuLTXbN&#10;DfQqhNi/WqfJJg3yx0m1Slu/GP7wt99+267SReqENX6xLHSd5qObpDdKbUnS4Ij/WkNI4k/hOGbh&#10;DRp6RTCwIxb3HUQmLBarCBO7+dRTT9lVPb///e/N2LFjza677mrPVA/eWvqfSCgqHFqTgzhUKuWF&#10;YHmkqp4VcU2DIg8qDFhJI2i1qDPegyB1wpoflISmKEe50aozZsxQ6kRCYNtZVIcq/sGw7rrrJmK3&#10;lKo6sXrFsuuZfFjobQZsG1SMmZZYTdwdYpmZEliQ3GRQk0BSTMjzUE1lPe3imusbaU1ptnlyvx05&#10;cqRdpYdUeazfffddV16wtEGVXriHCxZNMOUgx7XUdqSIB2whywZVHfQYxGFoSdpgAEaSGsvYii8V&#10;p3nxxRebP/7xj3bVGGwfBARQ4aaqyr+bF0KQzyaeYLz8iGMmOhab/FgJIlKprg8bNsyeqYcG3LPO&#10;Oit1hRDuT9x7khajVy38/M4888xGoQJJJlXCGo/Y1KlT7So7SFh7w42wBrYsZTmIN0oHqQ4eSPRQ&#10;4i8kCyVxjsATTzxRVLjCgQce6Fg2guw9wcN94YUXOnF/VMoLBRbieu+99y5q8UybuMae89Zbb2Vu&#10;150dkDRN0kyNFYTthCyKahEcxJFpEEG8cZujK+ph+19WEJGDinCpajIV6c0228zceuut9ox/fPLJ&#10;J2a33XYzJ5xwgpk9e7aTmb/jjjs6vS75YFuhKs4Y80IofFBQS7pdgh0k4gqJJcyilZWx+kxlTAup&#10;ENZ0INNdLITfSFzHG/VTeIeGsXJ9BsI7xOsleertiSeeaPr27WtXDcGScMoppzge6XKZ1m4h1/q3&#10;v/2t8/e9+OKL9mwd+K932WWXRuKaivnQoUOLimtEOQ2NSR2QRpUaX37Wc+XTpOFSYQVhKyuNBni3&#10;yAriDbdWkHzkuY4vsoN4g6SBiRMn2pWoFWwIvNJgrWEq47333mtXxaHQgGca7/Ree+1V0RvL9+WV&#10;V15xJrnef//9rt572EIQ3TSD5kNlep999ilqCyGNBa9ukiJT11prLcf6IeoYMGCA6d69u10ll8QL&#10;a6YQXX/99XaVTeImrAvj6krF20VFNcJa0xnjC6Ojs5ZtWws0ljGSWvgDUwvT1AhKtBvWD7cVYB7U&#10;aNqkUZHBTTxkEIvH94RqNzF91cA0R7zfheKar2vfffctKq5btmzpDLqJu7jm68M7ntYYvWrh4Yif&#10;X9IjbxMvrEkBIQ0ky8RNWOPXu+SSS5xjus7dDBcIk2qENeDnpToTxzHFWSapTWNRQcVR48z9gYcU&#10;BBIDPNIED6rPPvtsUfEaJuXENdXyUaNG2TP1xF1c8yCC5SWp1pWg4edaLGYxSSTaY/3OO+9kXlSL&#10;8EC8cRNN0lZjFpAVyhvypfsHjXVpE9VA1fmQQw5xIvd69OgR2L+RCuWvfvUr83//93+OLaKQ999/&#10;3/FVF+4UNm/e3MnT7tWrlz1Tz8yZMx3PdRytORRnyKaWqC4ND3OFHvukkVhhzc0h6qdp0Rgqwfkj&#10;arlAp6n5jy1OpjM2bdrUnhFxgButcEfcrFlJpU2bNokYBlML7NAdc8wxTp71oYce6kSQkmBRC1w7&#10;8dGefvrp5rzzznMaPxHVTH0sJq6xLdHQWCiuubc899xzRcU1DY3//e9/YyOu6QNZvHixCoEuwEef&#10;dG2XWCsIjRBPPvmkXWUbvyp2NH6wTeUFLrKIaaq4+KIQnbxyo2oZV5qL9mKMMsfz58+vKh7p6quv&#10;NnPnzrWr6qnWCpIPN4O031STBN5O3leiMnw258yZY1eiGrjGUW3Norefa/j48eOdHWMqi3zuyn0f&#10;uDfQB4FlixfivNQoc2x2VJuLNYpvtdVWTiRf4Sh2dhKxD7z66qv2TD08/Jxzzjl2FQ3cU998803t&#10;FHmEJBpCA5JIIoU1T648japhqQ4/hTWVgbjCCN64CGsgLirpW1ZpAaHDz1VUhoddedJrQw/WjUEU&#10;875iRwSLTO5VbGx6ORDqiOti19ZqxPWxxx4bSdJErtCkfobq4AGMGMgkkkgrCNsEEtUiaj7++ONG&#10;TTUiGqgGcRMXlZG/szbY1tf3sDEUK6hM89CBHZC1V1ENPCD/8pe/NOutt549Uw8Z2AyVKbSF4F3e&#10;euut7aohjFsPG4Q/X6NEdfXwvSP+MYkkrmLNdJ4bb7zRrgQEUbHGdpF/8eLJm7GjW2yxhT1TB1UF&#10;BCbZpHjIgOil448/3jnm/P/+9z/nmAYY/NZM8uLimx+pQ8WB3FI8zPlwgc3ZU+JWsc6h0efxYJNN&#10;NvHl/ZFm8KLT3CWqh+tbobAT/kPxjMp1sWtr165dncp1LkOb+wS72MUo1RgZFDx4kYYlage9QMJL&#10;KetQXElcxVoNi+FBRzYvbiJUCfCr4Y1GvNA0csUVV5jLL7/cPPTQQ07Ife7Pky2eg4tj7vx7773n&#10;XAzJHf/DH/7gRCUy1pa/E6/27rvv7lQ6cn+eVxLgybpYdUWEiwRjZRibLKqHrGaJ6nCgORHBnN8M&#10;nwN/d66hkYJQKVFNgScsUc3XS/FIoto/eKhKouZLlLBGwNA0IcKBi8ROO+3kdG/nLA90W//nP/9x&#10;GkdrqdJS3X7jjTfMddddZ55//vlljR3kV5522mmhVhj8YMKECbKFRAzeTgnH8ijNpjb0/goXdlgQ&#10;1zSKFkLCBruZpQbE4c/t1q2bXQULXwcFJQ188Z8xY8YkzvqbKGGdVL9NUtlzzz2dhhCqyUuWLDHD&#10;hw93hLCfFRsENRaQm266aVkzEJ3jiOuk5UVzYa003lcEizLGy4OlS1QHO3ayGoUPn2mq0sUq18Xg&#10;fjVw4EBnUFkYUKkmm1p9X8GATRRxnSQSc5XFMqAMyPDA20S1GriZ3HDDDY79I6jIIHzi11xzjRNL&#10;BFysjjrqKOc4KVAxJSZK6RTRwY6KKA0PyMI7NOERFyqiAXFN5ZqpiuWgbwdRXdgLFATsqrLzisVR&#10;BAvCOkkNw4kR1mPHjrVHIgy2224751cmDSKqZ8yY4ayDhIvUoEGDnKd/oMExaUkPREUxlEAJFdHA&#10;917b9aUhak94h100JYFES65yzc+iGHzu2emkOT5oSP3A5z1r1ix7RgQJUY5JqlonQljjW1JDQLjk&#10;EjtoTAw78/aJJ54wX375pXOcRJFEsgleVvlZo0F2kNLkhjUJ9yCiuLGL6KFgQUoEA6HyITUC0U1i&#10;S5BwP+JFf5AGvoRLkqrWiRDWuQqmCBfC9qPI4WTL9Z577kn01ivWFrJVRfgURjaKetiBEt4gPk02&#10;kPiAiEZcM6ALcukhpSrZfsEDFgUfZVNHA5bUpDgXYi+sESgS1uHDlvEzzzxjV+FD4kjSGhYKYafF&#10;64h4UTtUNZK4W0AlDJHADZxYN5rlEA+dO3d2hl/w2nLLLZ1zVOxo5qJZluSE/Ez4csjO4A08vbnd&#10;MxEf+Kwgrs8//3wnp7pYaoifMPeAKnWxUesiPNAESSgOxH5AzODBg4uOKRX1+DUg5rzzzjO9e/d2&#10;jl955RVz1VVXOcdeoRv7kksucY6x8Fx22WXOsVcQGAwIyImGuA6IqYRGn4dPHIZ4sGPB+4yKJ4KZ&#10;9zGCgEa43It17rwf0EBLrwIvbB/5v/JCGGBr4HPEiz8vSsPDjWwg2YXPMGkfitGLD/vss4/p27ev&#10;XcWTWAvrXGayGm7K45ewvvLKK0379u2d49tvv90MHTrUOfaKX8IamNqYawT81a9+5UuzSNjCGjSd&#10;MVz4GYcRLcd7E+GcE9D5vxL7FWcYzETEZe6VE9wcKzpMkzyzDruNH3zwgXZ5Yga7dGeffXaspzHG&#10;Wlg/9thjZtSoUXYlSuGHsEYEELSfy2FmpHm1E4/8FNa33HKLI1Ryx08//bRzXAtRCGuQuA4X3st+&#10;NBhRUS4mnPnVr0pz3EBMUPHnhdDO/zULfmMaYPkZy5OeTbBXJWXybxbp16/fsjjgOBJbjzUNSPJW&#10;hweezjhW2PJv4kE3pwQNTS/yXIdHLdM78Wxuu+22pn///o4F6bDDDjN77LGHc444L3Le0yqqAWHB&#10;561r167OtushhxxiTjrpJMfT+otf/MI5R0U3reBfl6jOHjyMc8+RqI43eK2xuMWV2AprpiziCRTh&#10;gAc07iTha6zE1KlTl+0KiGDx4rHGS0lj4N577+1k4R544IGmR48eZr311rN/QuRAdPbp08cceeSR&#10;Tl/GgAEDTK9evZyHjTSw7rrrOtV5kS24LpNNHcbMBlEb9IrEOSEklsKai5qq1eEiYR0Oms4YHlxH&#10;mjRpYlcNYXeGiivbiSeccII55phjnGOGEpX6/4jGYJOhUXTXXXc1J554ojn99NPNfvvtZ7baaqvE&#10;vsd5yNKEyuyAV5fdJ6b+qp8rOVC1jmvxNZYea2Lehg0bZleiErV4rHfeeWfn144dO5oddthhWaPg&#10;s88+W3VeZ6tWrczBBx/sHE+bNs3xylcL2845QY0/+cEHH3SO4aWXXrJH3ojKY50P1T2a67TdHCw0&#10;4+bi0qhEIpwR1CTOiOCZOXOmc33iOsAr7ikk2F/CHoglogNr3pQpUxSjl1D2339/R7fEjdgJay5q&#10;NM7p4uaeWoT1bbfdlsjKEo2WL7zwgl15Iw7CGriJk8ygKklw8MDYs2dP52FPRAsPkVyriC6bMGFC&#10;LJNHyAefP3++XYk0Q/OxJjonG6x6JITEbW5B7Kwg+GYkqkUWQGTIEuI/VKkPP/xwc+GFFzo7JxLV&#10;8YDdMBo/99prLzNw4ECnsz83PS8OsJshUZ1+uOayWyhRnXwIuYjjILlYVayJeCK3Wo0j3qilYn3m&#10;mWc6v2JN6NChgzO0AsaPH191NByVAKbEAQ1kNIRUy3bbbbcsfYGbHtOv4MMPP0x8xToH33dtRdYG&#10;Ng+aDbfYYotY55uKxnBzxHZGFTuqcfTYzUhCiXPSgKgdrB/cO5TTnh5opmbGRZxSzWIlrPHMPvnk&#10;k3Yl3FKLsM6BED7rrLOWCc645FjfcMMNyyLqaC65/PLLneNaiJuwBk1n9A4Cunv37o7dIy2JFFln&#10;4sSJjsjmFabIzffii/SB6GLH5L333rNnRJo46KCDnKSiuBAbKwgXUSL2RDQkYcJYmkcLf/zxxxKH&#10;LiEWj1zlc88912m+1fctPbB7g0Xk1FNPdSwjjBQPGt4/2jFKL8Toff/99xLVKQYLsR/DwPwiNsIa&#10;Ua2KXXQkQbSmWVgDVTrlJhcHn/Ruu+1mzjjjDHPAAQc4UyxFesGWwW7EUUcdZY477jgnJ7uWgT/l&#10;YMqiIhbTSS6bmnQakV5mzZoVK691LIQ1k46UWx0tca1Y5/um0i6sAZ8pfmFRR7du3RxxdeyxxzpT&#10;D+Nm4RHB07JlSycnm4ZHtnypavsFKSDq6UkfPCwpmzpbUJyNS/58LIQ135DZs2fblYgCtlHyGzpy&#10;TYxRkz82etKkSfYo3TCdMajqXFJgwAiVyn322ScUO4CIPyQ50JzKePlDDz3UGUxTCzy0axBM+iCj&#10;nt3vaucwiGTCrkRcqtaxENZ8QxjaIKIl34oTBzGDqGayW46sbOcxTYo0lSxG8XXq1MkcffTRjs+W&#10;SqUQxaDZl1HqeO2rvXdQrVa0a7ogkYrkKNlKs0lcnA+RC2umceU+BNtss43T4S+iId8OEod8WXyV&#10;WfU+Ynuh4SY3CTPtkG985JFHmgMPPNARPEK4Aa897xssIl7eNwgwRa6lByxi7EAomzrbkJBGnGLU&#10;RC6s87dr6MxGTNC0grcyK6IiLuRvi5Lr2rt3b7sKH5pOcuPWswqZvkyUilM+p98Qc8bWfv/+/bVr&#10;JaoGiwg7HW4fzLALxH28unAHP0umeX7yySf2jMgycUh/iVRYsw1HbmkhbINTPeWmy9AHJSVEw777&#10;7hvJdjz+bvy1GvRR9wS+2mqr2VV6QESzjc+ERD+b0US2yVmJ9ttvP7Pxxhvbsw3ZcMMNlVmdArAJ&#10;cm3E+qGJmSLHuHHjIg9jiFRYV2ouYKuOCyBeUxIBam1WEd6gUnrMMcc4HdZhgfWDrd1cMoY6uo2Z&#10;MmXKsiE5SQexQ1weP2NF5omgYEgV1y68+htttJE9W4ce2JMPVervvvvOvPvuu/aMEHUwEwVxHSWR&#10;CmuixdxAHB/b4iRX4MOmKiGCJbetxkMNcWd05IcBsVr4bYEHK8bci7qJdEmO4UPcIHIQOwx4ESIM&#10;SJc5/vjjnd03KtU0ZSteL9nksqlnzJhhzwjRkKgfuCIT1gi3anKJ8WF/++23zghufNgMEhD+Q/5n&#10;zqbTtm1bJ0OWC1pQsK1HJRNhDfgfb7vttlhNU4oapjMmzRZFn8Qee+zhiBtEjhBR0LVrV3PCCSc4&#10;g4boHxHJg3s9uw3cmyi2CVEKQjHcFm6DIDJhXWvGJFUHfDR4NfFha6yxv9DIeM8995g5c+Y4a7bw&#10;zz77bLPTTjv5ntSR+7tJAQHE9H333Wc+/fRTZy3q4WKRFHFNQxkVanaZhIgDXL8YlR6H1CPhHqxw&#10;7FrHIfFBJIMoq9aRCGt80wzB8AOsAvx9NDH07NnTqa4KfyBP+aabblqWDUlCBTclxkr7EYtIBYIB&#10;IKeddtqygSg8LFGpVrh/aRDXcfZcYx/i50oEWlq84SI98GC6++67mx133FGTPBMAPyPuQcqmFl7A&#10;Zx3VtOYmixYtCn301OjRowPNm8SLij/3gw8+sGfSDckRfnDmmWeaXXbZxTm++uqrzYgRI5xjIKGF&#10;FAfyX3Ngyxk1apSzNZcfXUXj0CWXXOIc83O+7LLLnOMceB25qXXu3HlZlBxVat4Xzz33XIO/64Yb&#10;blgmzk4++WRfun0Rfkm/oTI8h8QWEnTiBHaPHXbYQYJFJAJ2Pt966y09yMcQii0Io6RM3MW/z72N&#10;3XMe3rgGUjzCesQOMEVAXtzD2I3lNWvWLHnFA4R0ILRG2IQurBFQWAzCCOfPiUC8qWluggtCWJca&#10;9VvOBpL//8n/c6XO51Pqvwe5/4+EdUN4f7NTE4fpcXTpb7/99mpMFImEIgwNcWpsjAdcT+jxiari&#10;6Aauv/R60WxPYhkxsdXA7A56ztiJpEilwUX+gVX49NNPt6vwCF1Y45F68cUX7Socck0PPBmm0bcb&#10;hLCOIxLWjaE6woMHF+eoYKATVWo1EoskQ/GFTOT333/fnhFhw04cjexxGPJRij59+gRqO0Vgv/ba&#10;a7EZz5100A1h91SELqyfeOKJyLY+8AizvYSFgUlNacFPYU1zjxcQdYVV6MJ1YTU6ty5XpS7Gqaee&#10;KmFdBJIOyHQNO/N7gw02cKrUuXhEIdIA1UMqh9wnRHhQpabwFUdrBIKfScDYCsJKlWH3hCJkviVT&#10;eIdQBGysYRKqsCZhYvDgwXYVLfh2ESNpqE74JaxrgW0wfGVcHPHZMloYuEiS8EGDKTcqP4RxraRN&#10;WAPVkzC3sblYIaq54QiRNpbeF52KYdSDJrICUa58r+MYo8e1lUnA+f1FYYJuuvPOO5cldAlvMODu&#10;3HPPde77YbH8xRdffKk9DhyaRIjMiQNkYdMkx4eGhgN8TaRgJJE4jHOlWsrXQcWBSnTfvn2d8zSe&#10;IKxpsovSrpAPYjBt09d4YKFyzfs6SIhGZNgG9g92gIRII7y3W7du7ezK0MMg32sw0CPC8DGi0eI4&#10;s+Dggw82hx9+eKT3CyrkWO34/iSlkTNOoPNwKvB5DovQ4vaoAOQGjsQJqny86OglD5sLqRBJJOjp&#10;jFzcmcKpSEuRFXiQZPdNWez+w64xVdg4ZlOz+/q73/3OszUySCho/PKXvwy18poWws60Ds0KQjNC&#10;ErxCxL+xLUWFNTfWO+7EwQqSD3F7uRg9CDJasRrSaAXJZ/PNN/e1SZdqDbm//FyFyCrjx483L7/8&#10;sufeENEYbBVxuy/kYKIzk2LjCruSt9xyS6r6xMLglFNOMR06dLCrYAlNWD/22GNOZmOSwC+MD5sL&#10;apyJm7COO2kX1kBDoR+2K2xSiGpsJkJkHa61w4cPlzWkStiSxzIY16IVfSP9+/dv1IAfN/CiM0gt&#10;K7M6/KB3796OtScMQrGC0MCWNFENNNzxdMgTLHmVYXUDC1ErRDbVagthJPlhhx0mUS2EJWcN4YFT&#10;eINCFYI6rqKaAsKhhx4ae1EN9AAMHDjQ0SbCHdhBwnogDkVYJ8VSUQoaw/BhY36XD1skhWnTpjm2&#10;pmrYbrvtnJHkyqYWoiHsePHZYBqtqAxWMopSZITHodG+GFQz+/XrZ1fJ4ZhjjnGG04jKkFMfVspP&#10;4MKaf0wcmxargeo1VWzExrbbbqsLq4g1NAzzfvVie2E4wz777ONktgohSrPnnnuarl272pUoBlVq&#10;qoRxHvjSsWNHM2DAALtKFvQyUbmm2VJUJqwmxsCFNaI6qTF2pSBaDv8qv9ItrjHOIq4wEpg+gZVX&#10;XtmeKQ3WEbZCtb0ohDvY2clFi4qGsFvGmPg4DnzJQdwfGdVJhvjYE044oUFggCgOcYVhOCgCF9ZJ&#10;t4FUgqEnVOVzPmw+qELECR4CueiSF1sKmh2ZTrXJJpvYM0IIN9CLQNaxhiXVgVUG+wfTK+M48CUH&#10;XmoEqZuiQ9zB87///vvblShHGLsngQprPJ5+xn7FmZwPm+YWfNgbbbSR/R0RN5LQnOI3VI1K5Z+y&#10;64JntFo/thBZB8vDiSee6PyaZfj3z549O5bZ1IWQy58mfzL2PRVGKoPPOuhBaoEL66yR82HzxN6z&#10;Z8/QchOFe7K6ZTZlypQGN34eMOiE32OPPbSNKIQPULnedNNN7So7cP0gm5oGxc8//9yejS/sLFfb&#10;rMgONRnSfusbemLY4Z85c6Y9450jjzzSHolS4Pn/6KOP7CoYAs2xvv/++50qbtZBzDDO+/3337dn&#10;/IULWVzGhScBUl1o0ssq3PjZot1ll12cYTJCCH+hSWrkyJF2lW7ink1dDAbAeO0l4d943333NajG&#10;05dy9NFHO5Oba4HBQ0OGDHHGb+egiZwGWa888cQTZtiwYXYlioFt94gjjrAr/wmsYs1Tl0R1HVSw&#10;ecqlgzwIH7bytd2DDzLLohq4QTCqV6JaiGBgSil512mHseQI6iSJagorXtNcCCr4z3/+08jiQlHr&#10;mmuuqXqIHFM87733XjN48OAGohqeeuop8+ijj9qVe3bbbbfM3+MqQcU6SDtIYMI6izaQSpDQwMMG&#10;Azewifg1ZIDmizQ0YIRBKZ9xVuA9Rxd8p06d7BkhRBDQZxPWpLewWWWVVZwC0euvvx7bbOpSUAX2&#10;2mfzwgsvOEEFxfj555/NzTffXFVTHBXw1157za4a89JLL3meoMvPpk+fPnYlioGoDtIOEpiw1pjt&#10;0hB/xpOunz5stuOYxiRKgweQ73lWadmypTn22GOdKpMQIniojjIiO01w/UBMh5UJ7Cdk+rNr7BU3&#10;Fflbb73V0wCSe+65p6yozlHNboAiICuTOGFNVzD2B1EetoEQ2PhdSRLp3Lmz/R3v0DzCBa9Zs2b2&#10;jMgHUZ3lKESqZ1Sqs55aIETYMLyDpsY0kIRs6nJ0797dHnnD7Sjs22+/3fn+VAJRTbXfDdVYFii0&#10;tW3b1q5EMYK0gwQirFWt9g4PInx4cz7saiwL+KrWX39956m8XGZxlsAiw40ty6Kafz95rTxcCCHC&#10;hwfaIJulgoZ7Si6butALnCSIFq0GL/G5d911V8lqPsU0ft+tqAZ2Gquh2oeIrBCkHSSQVJBBgwZ5&#10;9gWJhiAIaUqkCXTWrFn2rDeYeEk1nA9zlsA/RwUfa0zWY+S4oZ9xxhlqcBUiBtBnQ7NakiD5gqjO&#10;JMTolYNr4R/+8Ae78gY9Y1dddZVduaNY8sj//vc/5+HELRRFLrzwQrvyBoW6iy++2K5EMYJKB/Fd&#10;WCOoEdbCHxCJWDwYQPPxxx/bs0JUhgr1L3/5S4lqIWLEggULzN13321X8YUd0ObNm5u3337bnkk2&#10;NPTVYskhpePZZ5+1K3ewU5hLIPEqquHcc881rVu3tivv/PWvf1WRsww0ep5//vnOr37iu19ANhB/&#10;yfmw2X5ja6cWH7bIDlhfzjnnHIlqIWIGn02qmXEGjy73nrSIathss83sUXWQK73jjjvalTuwfeC5&#10;vu222zyJanZbzzzzzJpENWRxWJEXgrKDSFgniK+++srZ3tlqq62cLQx8b0IUQpXpvPPOUwSjEDGF&#10;ChnVzDiCZYIkiokTJ9oz6cCPZr5DDjnEU+IGUXx33HGHpwQVdgoGDhzoS1qYRpxXJvbCGuFHIogI&#10;FqKOyMOmoYJmDC+NFSLd0GCEJy/LsYJCJAEefE888US7ih4eyKmmM5Y8adnUlSAty69CFIN/vFau&#10;3YKoPv30032rNBP3KMoTRDqIr8Ja1epwIQ+b0HouGghsP55wRXJh+5BmFU3dEiIZMAn25JNPtqvo&#10;oI8H73cSs6nd4NcwthxUrv0W1zlR7WdMnoR1ZYKwg/gqrDVtMToQ2H7kYYtkQrziZZddpiFBQiQM&#10;BNWpp55qV+FDNjWDTdJ8/+bf6DeI61133dWuaiP3HvA7e5r7QZajZt0SW2FNjFBSQ+PTRC4PWz7s&#10;bEH3t9cxvUKIeMCDMdXKMOHegB2FpjqiWdNMUIPT9t9/f7PLLrvYVXXkKtXt27e3Z/xF8wsq47cd&#10;xDdhLRtIvMj3YTM2vdqQeRF/wr4hCyGCgSpoGJBNPWfOHPPBBx/YM+kmSHvcAQccULW4xgrkt/2j&#10;EBXXKuO3HcQ3YS0bSDzBh01cHxcWfNiK30kX++67rzq/hUgJTM7dYYcd7Mp/EHJUMF977TXz6aef&#10;2rPpJ+hJxIjraqLxiPALevS4IlfdETthjfVAFev4gw87l4eNVUQkm06dOpmdd97ZroQQaaBLly6B&#10;FEDwGf/000+pyqZ2S9Bj2B9//PGqiotDhw41kydPtqtgoPdKVMZPO4gvwpo3FHmNIhkQi4hVRD7s&#10;5EJlK+5DJoQQ1bH77rv72nRGNjW51GnLpnbLokWL7JH/IKpffPFFu/IGgv/6668PVFx///339kiU&#10;w087iC/CWtXqZFKYhy0fdjJgO/ess86yKyFEGunfv789qh5sAGnNpvZCUOJyyJAhVYvqHIjrG264&#10;ITBxjR1UuCM2whqVL2GdbHJ52Dkfdq2jX0WwHHvssYF1uQsh4gGJHXh3q4VsatK60ppN7QUKSH5D&#10;pfqFF16wq9oglSWoyjU71MIdftlBahbWiOqg/UsiPBDYfMhzPmxFuMWLvfbaSw2oQmQEdhG32247&#10;u3IP1o933nlHRS8LDfx+8sgjj9RcqS4kCFsInvogHirSil92EF+EtUgfOR82w2bkw44H2267rW8D&#10;CYQQyaBr165m8803t6vy5LKpsX6o4FUPDXx+ievHHnvMjBgxwq4qw8/DLTlbyKRJk+yZ2pg5c6Y9&#10;Em6JXFhT2ZSwTjeMueWJl5Gw2ERatWplf0eECVVqPzyXQojkwQN1pUEfWD+I0MtKNrVXpkyZYo+q&#10;h0r18OHD7aoyzZs3N+ecc445/PDD7ZnKoKv88lz78W/OGgjrWj35NQnrzz77TB2nGYGfMzYRRqQy&#10;Nt1tBUXUDsMcjjjiCLsSQmSRvffe2x41hGbmtdZay7z++uvO0BdRnI8//tgeVcdTTz3lqVKNqP7l&#10;L39p1ltvPdOnTx8zYMAA+zuVydlCpk6das9Ux4QJE+yRcAt2kFrnstQkrLMUMC/qYWw68UVYRPBh&#10;Bx2+n2VoKD344IMV8i9ExkE877HHHnZVRy6b+q233rJnRClqEdZUfp999lm7qgzX61/96ldOLGqO&#10;3r17e6pcI67vvvvumnKosxqvWCu1PtBIWIuqwSKCD3vLLbeUDzsgDjroINO+fXu7EkJkmQ4dOjiN&#10;5YD1I8vZ1F6ZO3du1dZVL5Vq4g1zlepCqFwfddRRrkMB2CX+8MMP7cobWIKCzO9OM5EJa56SJawF&#10;yIcdDAyJ4PsphBA5evXq5Yg3rB9ZzqauBpo6q8FtEyA/FyrVxUR1jp49e3qqXM+aNcseeYP3h6iO&#10;WoceVi2sEdXyV4t88n3YCEL5sKunbdu2ZrfddrMrIYSoZ88997RHwgvVjnPHL12JnKhmJ6ES2ELc&#10;9s1UYwOkAVL55dVDpb8Wf3rVwprGRSFKgcCWD7t6ENX6ngkhikFFtF+/fnYl3MLAnDfffNOu3FNp&#10;dkDO/uFGVOdg5wFbSCWqmVswatQoxS3WSC0NjDVVrIWoRKEPu1JklDBmp5120hAYIURZuE60a9fO&#10;roRbnn/+eXvkHhJZSk0k5p5GpZr0Jq9gCyknrg899NCq/l6/h9dkkVp81stffPHFl9pjT4wcObKm&#10;blWRLdiawipCgyM2h+WXX17+wCIwaQ3/HXYaIYQoxwYbbGDGjh1rV8INCxcudPqB+N55ARHMfQvP&#10;M9XgZs2aOUO7TjzxxJoa97nmU3giKpEGS2jdurU55phjTLdu3Zy1F15++WVn6qaoDd4n1Q5ka7Jo&#10;0aIl9tg1VKsJSheiFhi7+80331Td9ZxGjjvuOOciK4QQbhg2bJh55pln7Eq4gSrzRRddVHUBA3G9&#10;0UYb2ZV/IOYoWFa7s4vV5a9//avSQHxi4MCBVaVyVWUFkb9a+AF52FSxcz5sqgFZhigmiWohhBeo&#10;qrVp08auhBuoDA8dOtSuvBOEqAYaFWuxS1LwlKj2j2qjLKsS1pruJPwk58Pu1KmTI7IZhJA1aEYi&#10;Xk8IIbxSaiqjKM1LL71Uc15xnCAFZNy4cXYl/KDa90dVwrraXEUhypHLw0ZkEteHzywrkAKi6YpC&#10;iGqgibFaP2hWWbJkibnjjjtSUeH96quvzD333GNXwi9CE9bEqDFLXYig4ELH+4y4uR49epiOHTva&#10;30knPERU06QihBA5eDgPyqKQVrCEMDY86aTlASFu4Hd3OxwoH8/CWjF7IkwKfdhpS8vAT6dBMEKI&#10;WuHaqMEx3nnvvffMoEGD7CpZMB3wxhtvrHpUu6jM+PHj7ZF7PAvr2bNn2yMhwiPnw6Z6nSYfNqJ6&#10;7bXXtishhKieLbbYwmy//fZ2JdxCfPALL7xgV8nhgQceUKpWwEyaNMkeucdz3N6dd94pK0hEtGrV&#10;yh7VDskuZEsnlRVXXNGZdvX5558ntgGla9euriZvCSGEW4hso4qp9C7vUPHfZ5997Cq+/PTTT46F&#10;pdoR7cI9pJVdfvnlduUOT8KaquH9999vVyJM+OGeddZZdlU7Dz74YGp2H5KYh73KKquY0047zay/&#10;/vr2jBBC+MNbb72le3WVMGr8iCOOsKv4gTXy1ltvrToKTnjnggsu8LRL7skKIhuIiCOFPuwVVljB&#10;/k58IVpPoloIEQRcC2mKFt4ZM2aMufbaa517Stwg/eOqq66SqA4ZfPhekLAWqSHnw958882dG0tc&#10;vcsbb7yxfJBCiEDhGkOykvDOJ598Yv75z3/GKqxhwoQJ5h//+IcsPhHgtYHR06dO+dUiCeAxRGSv&#10;s846TtUmblPJevfubY+EECIYiN7TtaZ6iHz929/+Zh577LFIq9fcy+htu/766813331nz4owmTx5&#10;sj1yh2thTSUQwSJEUqA5k4tjkyZNYpOHvckmm2iLVggRCn369DHNmjWzK+EV4uyGDx9u/vKXvzip&#10;IWFmRc+bN88MHjzYaZxTk2K0MEzIS2iHa2GtarVIMnHxYauCJIQIC6bY6ppTOxQVhwwZYi655BKn&#10;gl3N0BC3YPlgiuKll15qXn75ZWdIiYgeL3YQ16kgL774ovISI0SpIP7SvHlzp5JDVB8NIWHQvn17&#10;M3DgQLsSQojg4fr2n//8RzG5PrPuuuua7t27m0033dS5tlcL9g6yktFXVKblDIgnnTp1Mscff7xd&#10;lce1sCYzccGCBXYlwkbCOhgQ16uvvnooedjHHnus6dy5s10JIUQ4PPPMM2bYsGF2JfyGqZf08myw&#10;wQZO2hM7BdxXiFWliIOVgEhYRDNj1GlApDGSe7CmJiaHK6+80h6Vx5Ww5omKWfQiOiSsgyfIPGyS&#10;Sk488US7EkKI8MCvS9VaxTEh3EFuNQEIuQcjdPDhhx/uDKarhCuPNQ1gQqSdQh+2n00/NBEJIUQU&#10;rLHGGvJaC1ECxHO7du1Mly5dnPs/tg9SdVZaaSVnyiVNrEx7ZrfBDa6ENYJDiKyQy8PGO+dHHvaW&#10;W25ptthiC7sSQojw4eF+zTXXtCshsgnZ7syS4L7M/R0x3bp1a0dcA82iOASKZcC73fFxJazDau4S&#10;Ik5gC0FkYxGpJQ9b1WohRNQgHHQtElmDJlOidrt162a6du3qFMx4wEQ45xJX8Mi7wa2wduWxxo+r&#10;qnX0nH322faoIXQU03znBUZ0qvvYO1592HyQjzrqKLsSQojowOqG11r2TpFGsDzROLryyis7wplZ&#10;FvzKLAs/4O/ec8897ao0roQ1E39EtJRrXiS43usse1EbNDbgvUJg8+Etxamnnup4t4QQIg6MHDnS&#10;PPHEE3YlRDJhFkXLli2dZkIqzj/88IPjhUYrBQWe6/79+1cU6hWtIKpUC9EYNz5spj1KVAsh4gRN&#10;jMTCCZEkENH0KmHpwBdNdnguoQNLB2I3SFEN7PiQsFOJisJaW0ZClKacD7tXr172SAgh4gHVPXmt&#10;RZxhR3izzTZzrJQkdJHSQfGK9y47xRDV9GRfhLUaF4WoDNtQPITy1EylmqfqapsdhRAiSHjob9Wq&#10;lV0JER3E2FF9RkBz32SIGlF3nMfaQYZ00JVoL/girGUFEcIbfGZ22GEHuxJCiHhBAQAhI0TYEHWH&#10;eM5F3SGqmVCJgKYazXuzWNRdXMACWglZQYTwGZ62uXgIIURcQdy4jRkTohqwSOZH3WHpIOoO8ZyL&#10;uotTNdoNbiL3ygprRjjyEkK4h7B5IYSIM4gexLUQfkDVmWZ+BDQvqtEUmfBC56YXJk1EF4OKNf+W&#10;cpQV1qpWC+ENKkAS1kKIJID4EaIa6CHi/UM1GltR27ZtnTg6RGcl4Zlk6Keq5LMuK6zlrxbCG5ts&#10;solTCRJCiLhDxXr99de3KyGKw2AUbBw5SwfjwFdffXXn96hG44+Osy/ab+bOnWuPilP2O6FEECG8&#10;oWq1ECJJqGot8mH0/eabb+4I6Fw1mocvbBw5S0eWRHQxahLWsoII4R6e4BWxJ4RIEhLW2QWBzC4r&#10;7wFSOhDTWDqaNWvmCOhcNVo0RFYQIUKCCxQeMyGESApMYWRrX6QfKs/Yf6hEI6RJ7MifXoiYJrFD&#10;lKdS5F5JYS1RLYQ3ENZCCJE0lA6SPthBZXphTkRj6cArjXCmEo2QTkNKRxQQucf3sBQlhbVsIEK4&#10;Z8MNNzQtW7a0KyGESA6ILsZIi2RCpF27du2cn2P37t0dMY0tkemFOREtS4d/8L0sZwcpKazVuCiE&#10;e/ClCSFEEiEmFFEmkgGFHHYZevTo4VSjqUzTdIjgIw6uXDVV+EO5BkZZQYSoEbbWlAYihEgysoPE&#10;kzXWWMNJ6aASzYsGw3XWWce57yxevNipRmc9pSMKqhLWsoII4Q6q1dpGFUIkGYoDTM4T0UHzO5YO&#10;rBzbbLON8ys/F1I6qETzSvPwlSThWVhrlLkQ7pENRAiRBhS9Fy6M/GanABGNrYMHGywdWDkWLVok&#10;S0eM8eyxVrU6fHgipepJA1yrVq2crZ589AGLJ1wElQYihEgDCOtVV13VroSfrL322o6lAwGNkMbS&#10;wZReLB2IaGwdIjl88803jg2nGE2W/kAbtYq+/fbbZvTo0XYlgmLdddd1PmgdOnRwfFSFEOkyceJE&#10;M2HCBDNnzhxz9tln299pyAsvvGDee+89uxJhQrVhxx13tCshhEg2jz76qO7/NULBhXxw7utE2iHA&#10;SokwkVz23nvvRkVQKCqsR4wYIaEWIFQEEGN08rplxowZTiW7GBLW0cEHS1YQIURaGDdunLnnnnvs&#10;SriBezMVaeLt8ECr+pwNdtppp6LBBUWtIN9++609En5DY8Jxxx3nSVRDKVEtooPsUGKPhBAiLSjh&#10;qDxUKLfYYgvTs2dP54WlAxsnUXfff/+9RHWGwA5SDAnrEOFDuP/++zuCTCQfRLVGmAsh0sSaa65p&#10;Nt54Y7vKNoz7xqpJzN22227rZEZz3Sf3GxHNSykd2aWUVi4qrEupcFE9fDi32247uxJpgI5uIYRI&#10;G1msWpMFzQMFFehevXo5DYY0pq+88spOzB1JafJJi3w8VawlrP2FCsBee+1lVyItyAYihEgjWRDW&#10;6623nunUqZNTiUZI04jOvZoKNJVIkjqEKIfrirW2Nvxn1113dbaORHqgAZWubyGESBtpm8K4+uqr&#10;OxnRRN0horF2rL/++k5iB5VoBBIeaSG84FpYq1rtL23atJFfLYWomVQIkVYoBCX1GkcPE/ddLB29&#10;e/d2eptY0w9DYyFiCGuHELXiWlhr4qK/aERsOpG/WgiRZpJQEGK4CjuHVNhzlg4SO6hQs/NOoZBd&#10;eCGCopi4biSsFy5caI+EH7Rv394eiTQhf7UQIs3gP44beKAZqkZjYZ8+fZyUDgatIbBl6RBR4EpY&#10;lyptC+/gw1UcW/ogx5SKiBBCpBWvsxb8hnsnw7fwQyOisXRQRW/WrJnTWEgRUJYOETWuhLU81v6x&#10;yiqr2CORJlq2bGmPhBAivYS1M0fFGXtdly5dHDsH3mhslBSnEM+IaFk6RBwpJqwbjTR/5plnzKRJ&#10;k+xK1ALNH/3797er4HjuuefM+PHj7UoEzX777aeGVCFE6nnqqafM8OHD7co/GP+NhYMBLDQbUoFO&#10;YvUZHzfZ1llMUiP3m1fWE8/w9JM2k08jYT148GAzZ84cuxK1gGXg6KOPtqvgePTRR83UqVPtSgTN&#10;KaecovhEIUTqmT17tvn3v/9tV9XBgBUq3/ijV1xxRfPTTz8lPiSBCvpnn31m5s+fb89kF3bm0To8&#10;LGUREmd23HFHu6pDVpAACasRVD+z8MAGIlEthMgCXq0gVDDZqd1qq60cOwfeaKYON2/efJmlI+mi&#10;msLjxIkTJaotWCGmTZvmvLKIPNYhgycsaHHNNtTXX39tVyJoZAERQmSJUtc8fNFUKtkKJ+oOEU12&#10;9FprreUkc6AlwiouhQUVfO3oF+err74ykydPtqvsUFFYa+qi/wTtV58yZYqztSbCQYNhhBBZgkg7&#10;oJGQ6nMu6o6UDira7OBRhUZEU+hJK3PnzjWffvqpXYlizJs3z8yaNcuuskFFYa1qtf+wZRQkH3/8&#10;sT0SQUOTDQ03QgiRFdq1a+cIaaLv8Evnou6yNkxOlWp34D3PUoILuzOFn4UGwjprH5QwmD59emAf&#10;SCwgEtbhscYaa9gjIYTIBlSl02bp8Ar/fsX9uefLL7+0R9mgsGrdQFhn/cMTFCNHjrRH/sLfqylT&#10;4UFXuxBCZI2sN2xLG3ljwYIF9igblBXWxbwionZmzpxpRowYYVf+MHbsWOWNh4wq1kKILNKiRQt7&#10;lE004dEbWavulxXW8lgHx5tvvmneeOMNu6qNd99914wePdquRFioYi2EyCJZF9YKCBDlKNzRUMU6&#10;RLBujBo1yq6q47XXXjPDhg2zKxEmqlgLIbIIsXpCiOKUbV6UsA4ehPHjjz9uPv/8c3vGHTQDDBky&#10;pGZhLqpHFWshRBZZffXV7ZEQopBCt4esIBFAiPq9995rHnzwQfPWW2+VbIzg58HvP/zww+buu+82&#10;n3zyif0dETbETDGOVwghsoaEtRClKaxYN1m0aNGyWIkbb7xRA2IiYrXVVls2b58YPSraWeusjTNE&#10;Th100EF2JYQQ2eKBBx7IbBMfg9gYECPc061bN3uUfhjlf9RRR9lVXsUac75EdXQgoqlk0+BI2odE&#10;dbyQv1oIkWWy3sAoRCnQzvkNrsuEdZpHkQpRK/JXCyGyDLupIh40adLEHHDAAeaEE05wJgKL6MnX&#10;0MusIPh577rrLuekEKIhe+21lzPaVwghsgg9PlmNeY2TFaRZs2bmxBNPNJ06dXLWzMnAxlvu6+vX&#10;r59zD6vEVVdd5eyc+0GWrCBwyCGHmFVWWcU5VsVaCBeoYi2EyDJqYIyetdZay/zmN79ZJqqhZcuW&#10;5ne/+51p3769PdMYKtwiWGQFEcIj8lgLIbKMigvRsskmm5jzzz/faaQvpHnz5ubss882u+yyiz3T&#10;kCVLlmVUiIDI19DLhLVGdgpRHBJbll9+ebsSQojsgZdXkaPRsM022zjCedVVV7VninPwwQcX9V1L&#10;WAdPvoZukAoihGiMqtVCCKGqdRQceOCB5rjjjnNd3Onevbs555xzGvys3Ca+SYBXT1EriCrWQhRH&#10;NxMhhFCRIUxWWmklc9ppp5nddtvNnmnI4sWLzVdffWVXDdl4440d33WHDh3sGRE0Ra0g8lgLUZxK&#10;229CCJEFmEArgocmxfPOO69Bk2I+JID8/e9/N3/5y1/MO++8Y882BN/1r371K7PTTjupEh0Cal4U&#10;wgPKCRVCCF0Lw6Bt27bmt7/9rVlvvfXsmYYQ/fe3v/3NfPrpp47T4NZbbzWPP/64/d3GHHrooWbH&#10;HXe0KxEUqlgL4QFyQ4UQIuuoiTtYaFKkyky1uRhvv/22ueaaa8zChQvtmTqef/55c+2115rvvvvO&#10;nmmIohKDp6iwVvOiEMVRJ7wQQqhiHRTkTB900EElmxSxcjzxxBPmtttuK1kEnTBhgrnyyivNnDlz&#10;7BkRJmpeFMIDupkIIYQxTZs2tUfCL2hSPPXUU82uu+5qzzQEbXbLLbeY5557zp6pY7PNNnP80/nQ&#10;zPiPf/zDvPXWW/aMCIuiFWsJayGKo4q1EELICuI3lZoU58+f7wjld999156pg0i9008/3fFPH330&#10;0Q1+LqSF3H777eaxxx5zHbMnakcVayE8II+1EEJo985PKjUpTp061bF2zJ49256pY7/99nOGwOTE&#10;dK9evcxZZ53VyJf9wgsvmOuvv958++239owIEnmshfCAbiZCCKFroV+4aVK8+uqrzYIFC+yZOhvO&#10;L37xC7PnnnvaM/W0b9/eqXyvv/769kwdH330kZMg4tZ3jddbVIesIEK4ZLnlllPFWgghliIrSO1U&#10;mqT45JNPNmpSJD+cqvTWW29tzzSmRYsW5vzzz29kK8F3Tea1G9+1rCPVU1RY558UQtSBqEZcCyFE&#10;1lHzYvXQpIgvutQkRSCT+umnn7arOvBh/+Y3vzHt2rWzZ0rD/WrgwIGNqtoUTvFdl8u7hq222soe&#10;Ca9IWAvhEm19CiFEHboeVgfV5F//+tdmiy22sGcaQpMiVeXCKYqMJi/nwy4GhSB82CeeeGKjByHy&#10;rv/73/+WzLveY489zBlnnGFWWWUVe0a4RcJaCJfIBiKEEHXICuKdnP95gw02sGcaMm3aNMcHPX36&#10;dHumjs6dO5tzzjmnpA+7Et26dTNnn322WW211eyZOnK+a8aiF6Njx46OpaRVq1b2jHCDUkGEcImi&#10;9oQQoh6Ja/fQpFgssSMHMXr//ve/nYp1Prvvvrs55ZRTat4haNOmjfnd737nVL7z+fLLL81//vOf&#10;kk2NuQp7z5497RlRCQlrIVyiirUQQtQjn3VlsGMccsghZScpPvPMM+bmm29u4Bbgzx555JHmgAMO&#10;8C2hg3HmVL7Jvs7n888/d+wnb775pj3TEH7Oxx57rBkwYIB+5i6QFUQIl0hYCyFEPfJZlyfXpNi3&#10;b197piEUMWlSHDp0qD1TB/8//M19+vSxZ/yDnxnZ13iv8+FrueOOO8ygQYNKRi5vv/32jqVkjTXW&#10;sGdEMSSshXCJhLUQQtSj6mVp8DOfe+65ZvPNN7dnGrJw4ULH+jFu3Dh7po4111zTSf7YdNNN7Zlg&#10;IC0Ei0nhfe2ll14y11xzTSNLSg4sJfJdl6eosJYVRIjGqDojhBD1SFiXZt999zUbbrihXTWECYpM&#10;UixsUmzZsmXR4S5B0aVLF0fEE+OXz+TJk80VV1xhJk2aZM80BEsJthBRnPwM8CaLFi1awsFf//pX&#10;54QQoh625Upt6QkhRNYgZ/mLL76wq2wwZcqUkika+RBxRxpHIe+9955juVi8eLE9UwfxeyeddFIk&#10;O6PffPONuemmmxxBXUj//v3NzjvvbFf1fPbZZ+ayyy6zq/IU+z6kGXz1Rx11VN2x879L0Za3EI0p&#10;vBAKIUSWkW20NKNHj7ZH9Tz33HOOgC28l+BdPvXUUyPTXiSVMFa9d+/e9kw9eK4ZKFPoZODfIoqT&#10;P0hu2ZG2d4RozPfff2+PhBBCSFiX5oMPPjAPPPCA41WeMWOGI6ifeOIJ+7t1kPZx0EEHObaKqKf6&#10;kkJClZUKdeHXwgh0rCvjx483X3/9tVNxHzNmjP1dUUi+hl5mBbnuuuvMvHnznJNCiDpoJjn00EPt&#10;Sgghss1DDz1kluoGu8oGbq0glUB8nXzyyaZTp072THxgcMxtt91WciqjV7JmBVl11VWdByZYJqzJ&#10;U8yab0qISrRu3docffTRdiWEENnmvvvuKxnNllb8ENYkhgwcONBJ2CgF9gu8z5XYddddi4rziRMn&#10;Oh74cjAe/fDDD7erhnz66adOlZ2M61rJmrAm2SUXZyiPtRBlkBVECCHqyZqo9gPELMkf5UQ1TJ06&#10;1UyYMKHia8GCBfb/0RDi/Ir9+fwXFpVSkExCrF6puEBRmvxBQMuEtWLFhGiMmheFEKIOierq2GWX&#10;XRrF2xWDiYxuKPXn3Pz/K/0ZBtXI/uidosJazYtCNCZrXkIhhCiF5l0Ei9sx5qX+nJv/v1+j0kVD&#10;8jW0rCBClAFhnR/8LoQQWUWJINkg6rSSJFJUWMsKIkRjENWqWgshhKwgWUHC2jtFhbWsIEIUR8Ja&#10;CCFkBakWt97puCC7iHdkBRHCA2pgFEIICetqSZqdUBVr78gKIoQHFLknhBCygmQFCWvvKG5PCA+o&#10;Yi2EEGpeDJpa4/Y23HBD069fv7KvPn362D8t/EQVayE8II+1EELIClItbgVzrXF7DHjZa6+9yr7c&#10;CGtVrL1TtGKdf1IIUY+EtRBCyApSLUlrXpSw9o4q1kJ4QMJaCCFUsa4WpYKkH6WCCOGBBQsW2CMh&#10;hMgu3333nT0SaUYOBu+oeVEID3z11Vf2SAghssu8efPskfBC0irWwjtFK9b5J4UQ9UhYCyGEMXPn&#10;zrVHwgvyWKcfVayF8ABVGjXtCCGyDP5q9ZtUhzzW6SdfQ0tYC+ECVa2FEFlG1erqSZpQlbD2jlJB&#10;hPCIhLUQIsvMnz/fHgmvyAqSfvKtIE0WLVrk/MQZ23zVVVc5J4UQDenbt68mVgkhMsubb75pxo8f&#10;b1fZYsqUKTVV7Pfff3+zxx57OFN8sdRgLcz9yjRLXj///LO5+eabXaVQ7b777mbLLbe0q2C4+uqr&#10;7VF1dOvWzR5lg8MOO8ysuOKKzvEyYc0P+G9/+5tzUgjRkK222soZByuEEFnk+eefN3PmzLGrbFGr&#10;sM4iWRPWRx555LKq9bJ6PyfyS9lCiHpkBRFCZJkvv/zSHgkh8sE6UzQVBFZddVV7JITIR8JaCJFV&#10;sClo6qIQxVlllVXsUR0S1kK44Ntvv3X6EIQQImuocVGI0qy88sr2qA4JayFcoqq1ECKLSFgLUZrm&#10;zZvbozokrIVwiYS1ECKLfPHFF/ZICFFI2Yr1aqutZo+EEIVIWAshskjWGxcV7CDKUViUbiCsC8vZ&#10;Qoh6JKyFEFkk68I6l08s3FFYwU07ZZsXVbFONjwY9ezZ066E30hYCyGyCANMsoyKjt5YffXV7VE2&#10;KCus9eZJLvzsTjrpJNOiRQt7RviNhLUQImt89tlnmS+6cX8tFE+iNFnTIapYp5CcqF5rrbXsGREE&#10;5LhmdfKYECKbfPrpp2bWrFlO3GizZs3MGmus4byytt2/wQYb2CNRjo022sh5n2SFJk2alG9e5Ddl&#10;0k8WEtXhMnnyZHskhBDpZ8KECc6vFBbwWs+YMcN5Ibh/+uknp1rH1j+vpk2bOn82jfDva9mypV2J&#10;Yqy99tpmvfXWs6tsUGwno4GwBkXuJQeJ6vCZMmWKPRJCiPSDFaQYVOoYnIXAnjlzpvNCeFOcQ0es&#10;ueaaqdsFX3fddc3GG29sVyIfBHXr1q3tKjtIWKcIiepoQFhrtK8QIgt4TQNZbrnlzNy5c83s2bPN&#10;9OnTHQsJ4nuFFVZwKr5psJDgH95iiy3MOuus4/x7sw4/0w4dOjgWkCxSTFg3WbRo0RJ77PDII4+Y&#10;jz76yK5EHCknqseMGWOefvppuxJBMGDAANOuXTu7EkKIdPLqq6+at956y678A3FNEY8YuyVLlpjv&#10;vvtOBQuRSHjI6tGjh13VoYp1wmBrTZXqaJEdRAiRBaZNm2aP/AUh/fnnnzte7ZyFBCgaUQGVDhFJ&#10;gfdsIY2EtZJB4otEdTyQsBZCZIGwBsPg116wYIGTuoTYxkqSbyHBr73SSivZPy1EfHBlBRk3bpwZ&#10;OnSoXYm4gKj+xS9+UVFU8/Q/ceJEu/KX4cOH2yNx+umnOxd7IYRII3ikhwwZYlfxAOsIFW0EN8hC&#10;IqJm7733dvz2+TQS1sSJ3X///XYl4kCuUs0FJUquuOIKs/T9YlfZZr/99jNdunSxKyGESBcjRoww&#10;7733nl3FE/zZ3B/ZjkdsE//3zTffOOeFCINDDjmkUdW6kRWkmF9EREdcRLVoSFDeQyGEiAPE6MUd&#10;LCQLFy50vtachQRLCXna+LS5b2ZtkI0IF1dxewg5EQ94Ao+TqFYVoB75rIUQaYXKL82FSYT71Ndf&#10;f+2IbMQ2OdyLFy92bCT4tdE4OSuJELVQTFRDI2Gt6YvxAe/Y2LFj7Sp6qA6IOubPn+/42YUQIm1M&#10;mjTJHqUDLIxffPGFc80mW/urr74yP//8syOMENtUt3V/E15xLaxBUTfxYdSoUea5556zKxEnaO4R&#10;Qoi0kQQbSK3gxc5NjaS6TbGEgS/oH8S2LCSiEhLWCUbiOp7IZy2ESCNZENbFmDdvniOyEdv5FhLs&#10;I+givNtC5CjVk9goFQQ0fTGebLfddmaPPfawq+Jo8mJ44NM788wzVdkQQqQGmgH/97//2ZUoBDGV&#10;SyH58ccfzffff+/YSkT2YOIikxcLUcU6QahyHS/wwMsOIoRIEwxpEaXBQkI1m6o2lX2q3PSlIbap&#10;bGuQTXYoVbEuKqwV7RZfENdPPfWUXYmoIfddCCHSAlYI4Y25c+c6DyQ0RpKmgoWkWbNmyywkSiFJ&#10;J5481uutt549EmHQoUMHe+QOkkKeeeYZuxJRMmHCBA3NEUKkAiYZfvLJJ3YlqoV7AuPgEdo8qORS&#10;SKhmI7YRZDRKimRTavpy0Z/s+uuvb49EGGy55Zamf//+nuJ+Xn31VVWuYwB+RMS1EEIkHUQ14lr4&#10;DxYSqtmI7ZyFBHGNyEZs0yQpkgM2kFLNrEWFNT/oUiVuEQydO3d2RmN6EddUriWuo0eNvkKINJC2&#10;/Oq4g7hGZCO2ydmmETKXQlJOuInoKWeZLrkXoap1+EhcJ5OPP/44sVPKhBACEHcaehUtNMQjsPlZ&#10;4NlmgiRTMLGQ4NUmgUoWknhQygYCJX9C8llHg8R1MkFcCyFEUlG1Op58++23TuEGrzZpJLkUEoQ2&#10;L5okGeMuwkXCOmFIXCcP2UGEEEmFZjs1LSYHUkgQ2rxoksxZSLCPYOOVhSR4JKxjTrGnTcT1wQcf&#10;bFfuQFzT1CjCh2073ZiEEEmEaxeVUZFMGFSDhYT7EJ7tnIUE6whiGyuJLCT+QdGzKo+1hHV4lKpM&#10;d+nSxQwYMMBT5ZonWRENEydOtEdCCJEcVBRIHzwoYR1BbGMlyaWQYB+hqo2FRBMjq4PmUuw4pSj7&#10;CCNxHT0dO3Y0hx9+uCdxLaIBO8j8+fPtSggh4g/Ca8aMGXYl0gziGvsIVW0sJIhvLCS5xkgsJPJr&#10;V2b11Ve3R8VpsmjRopLfxSeeeMK89957diU22WQTe+Qv22+/fcUhMfwcBg0aZFciruy1116me/fu&#10;diWEEPHmlVdeMePGjbMrkXWwjWBzoLpNSgkvVbYbwuyRrbfe2q4aU1ZYjxkzxgwbNsyusg1PKOee&#10;e65dRcOHH35oHnzwQT1Rxpj27ds7OwxCCBF3GL39wAMPOIOuhCgFQhv7CNqD9wzNrln2bFMMbdu2&#10;rV01RlaQBCFbSPzBqzh9+nS7EkKI+ML1SqJaVCJnIcE2xHh2pkjmBtnkLCRZqmqXSwSBssJaQ2Li&#10;h8R1/FEjkBAiCSi7WlRLbpANDZK5FBKq2vi1Ed1prWivsMIKZRNBoOy/nG8SLyGEe0gHYatMCCHi&#10;CoJo2rRpdiVEbZClTVMklW1EN1VuCoDE/SG2EaRpqGpjC6700FDxkUJV63ghn3X8Idpo/PjxdiWE&#10;EPFDO2siaEjJwj6C2M63kCC0EdxE1lHpThLYXypRUVjLZx0fJKrjT4sWLczmm29uZs6cac8IIUS8&#10;QOBMmDDBroQID6rZOb82czdIHcEZgWDNDbKJs8apFLUHZVNBgJg3YveE4vZEaVq1auU8gXPRyD2B&#10;77333mU7h4UQIgqY0vvGG2/YlRDxApHN/RQrCbbKOKWQ7LjjjqZNmzZ2VZyKwhof1q233mpXIggO&#10;PPBA061bN7tqjCrV8QXhTEc09o9CWrdubfr162dXQggRPaSAPPzww+a7776zZ9ILgozGOv7NxMRl&#10;kZz1giQLjpPKOuus4/i00UG8d/l5cu8Nm/3226+2VBCQFSRaqFRLVMcLtqs23XRTR1Rz0S4mqoHG&#10;IHXdCyHixPvvv58JUc11GR853t6simrg4YIpi3wvKJQmlXwLCY2RWEiI+qO6jZWE6nbQzZG54TmV&#10;cFVbl7iOBkT1I488IlEdE9Zee23HP42Pmos2oroS3MSEECIOLFiwIBON1cwSKFXwyDKI07SMr//x&#10;xx+dBwUi/0gjoVESsJDk/NoIbT/1E/5qN1HHEtYxRaI6Pmy00UaOoMbjxQeYxh+3cBFT970QIg5w&#10;XyEWLc0gtHiAEMVBgFL5TSPcm6lo8x7gwYo1dhGsMIjtZs2aOZXuanFTrQYJ6xgiUR0PsHpsttlm&#10;5ttvv3UENU/I1aCqtRAiatg+/+CDD+wqnSCoSZoQ5WG3NSsPH7wfeJBAbGOJwRpDNRuhjeD2EvnH&#10;/8cNEtYxQ6I6Wgr903540oje+/jjj+1KCCHChwd8REWaQTgJd2T1e4W2opqN0EZwI7w5l4v841fW&#10;xfzavgprDYkJB4nq6Mj5p+k8duuf9oIGxgghogLxkPZrEEKI3UXhDr5X0hp10MzLrnTOr02KDNbP&#10;nF+bNBUaYCulgeRwJaxR8G69JaI63nnnHYnqCNhwww1Nx44dl/mn+UAFAR/Yjz76yK6EECI8qFbX&#10;4i1NAmkYlx02SZt6GCZYZXJ+bZo+2e3xtWINZPKKYHj33XfNo48+KlEdIgz7wT/Nkyofnmr9015I&#10;u79RCBE/iJvLQp+H7p/e0ffMPV4GBEpYxwBlHYdDzj/dvn17Z2s07ExP/FwM+xFCiLBAVKsyKURt&#10;eJmiLGEtUg82pnz/dJRNG6paCyHCgi1s9XcIUTteKtYVR5rnc+211yofUiQG/NMEurMVGid/Yd++&#10;fc0WW2xhV0IIEQwjRoxwmuKzANd4t+lL9I1xf+BFQ1r+0I+3337bGTATJLvvvrszNdAvsHTQcM+u&#10;KC+3kzXZwWVMuCgP74/TTjvNrirjSVg/8cQTmfmQiuTSpk0bp4s3ruNb1113XXPooYfalRBC+A+7&#10;c4MGDcqMj9aNsGZYyGGHHeYUN0pxxx13mNGjR9tVMFxxxRVmrbXWsiv/ee6558zgwYMrWoAkrN3B&#10;kLgDDzzQrirj2goCG2+8sT0SIl4wUalDhw6Of5pBCHEV1cANb9y4cXYlhBD+QxFMzWn1YAW88MIL&#10;y4rqtLDHHnuY888/34mRFbXjxV8NEtYi0eT802St4ydMSuj9G2+84VhUhBDCb6jcqlG6Hgovv/nN&#10;b0yrVq3smdKE8TASxn8DMXjeeec5/3ZRG4EK6xYtWjgjIIWImg022MDJn+aiQf500rz/33//vSOu&#10;hRDCT/DX6trSkCOPPNJ19Tbfbx0UYfw3AM2G9UVUDzMu3OZX5/AkrEHpICJK8E+TP40wJX86yUMP&#10;Jk6cqJQQIYSvIKr9nhybZLbcckuz3Xbb2VX22GmnnZwilKgOinhekbAWsYfmCrzTSfBPe+X1119X&#10;0o4QwhemTJniDBwT9ey66672KLvssssu9kh4hcZFr3gW1tX8R4Sohpx/midGvNNJ8U97gRHqiGsh&#10;hKgFEiBee+01uxI5aFrMOiRRierwkl+dw1PcXo5rrrnGfPPNN3YlhL8gpMkWpblv8eLF9my6IdeU&#10;6CMhhKiGsWPHZtpbXSpu78Ybb7RH7nj66acDH6pz8sknOzMWwgLr5Nlnn21X9ShurzzLL7+8GThw&#10;oF25pyph/eijj8obKnwHmxFjx9Nk9XALmabkZPo5NEAIkQ1mzZplHnvsMbvKJsWENY1n119/vV1l&#10;m1NPPdUe1SNhXZ6WLVuaAw44wK7c49kKAm4ia4RwQ75/ev78+ZkU1UCzkbZxhRDVMGbMGHskhPAL&#10;YnyroSphLZ+1qBW2wUj3SLN/2ivvv/++mTx5sl0JIURlsH+QkCSE8Jdqi8hVC2tm7QvhFZ4AaUjE&#10;8kB1WokYDeEmmRVfuRCiNpjiirdaCOEv7KZjBamGqoQ1aAqj8ALvFwT1okWLnIEu/Coaw41Swx2E&#10;EG4YNWqUPRJC+Ml6661nj7xTtbCuVsmL7NC0aVPTrl07xz9NZRpBLSrz9ttvmxkzZtiVEEI05p13&#10;3nGaFoUQ/lPNYJgcVaWCwLRp08w999xjV0LUw/jPDTfc0In4oSFReIfvH93IdLULIUQ+NDvff//9&#10;diXAr7i9Wvjoo4+cAhI9Q1988YXzYs11nCxpMrVzLyqi7OKGhVJBvNGvX7+qByJWLax//PFHc+21&#10;15rvvvvOnhFZhwsFsXFz586V1cMHttlmG9OzZ0+7EkKIOh588EE1fBcQRdzekiVLHDFNohMWPq96&#10;qHnz5qZ79+7OdZ5m/iZNmtjf8R8Ja/fwPTnppJOq/nlUXQ5jm192EAE5/zRNd/JP+wcTGYMeVCCE&#10;SBbPP/+8+eSTT5wiBrn/ojQ///yzPfIX7nUPP/yw+e1vf2uuuuoqM3LkyKqKjAzaGzFihPnXv/7l&#10;/F2PPPKI84AgooWQhVoecmraZ1bsXnbhwQrvdIcOHeSfDpCXX37ZTJ8+3a6EEFnmzTffXJZ3n4vm&#10;RGCL4gRhpZsyZYq59NJLzXPPPVfR6kjlEzsBRUjumeXg73rmmWfMn/70J8dqK6KjFn81VG0FAd5g&#10;9913n12JLCD/dPisuuqqzlTGMEfgCiHixdSpU829995rV/VQtSZvFz9vlgnaCkL1+8knnzRDhw4t&#10;Wwlv1qyZOeyww0znzp3N2muvbc/Wwc9o3LhxFSvTjNLef//9zd577+2bPURWEPfst99+NSXf1fQ4&#10;h8DSCOZsQOMFdg/yy8mflqgOj4ULF5phw4bZlRAia9DTNHjwYLtqCEWOiRMnOg/ePIQL//nqq6/M&#10;lVdeaZ544omyohox9n//939mp512aiSqgabFXXfd1Vx00UVlq6I//fSTefTRR80//vEPp1FVhAcP&#10;qtVOXMxRk7BeccUVTdu2be1KpBEuFDRV8HQt/3R0zJ492zz77LN2JYTIEiRwVfLwYh/49ttviwo6&#10;UT2I6r/85S/ODn05uE9eeOGFThGqEhQl//CHP1RMneCB6fLLL3cCAUQ48DNh16EWajYgkVMs0gXb&#10;Z/n501SoRfTQsKSBEEJkC6qkbvOqEYGTJk1yxLW2+GuHhxmaE9k1LAdC7Be/+IVj4XBLLnnCjfea&#10;r4GdCRE81Ubs5VOzsEZ81aruRTxgG5GnbqrUXKAV5xQ/GArxwQcf2JUQIs2MHj3avPfee3blHsQ1&#10;wm2NNdawZ4RX2KW9+uqrXRWWjjzyyEY7Bfz/8WNfd9115uabb3aaHYnnywc7CF7qSsyZM8f897//&#10;dSxBIjiwNsdCWOO5VdU62eSC6hHWXETmzZtnf0fEkeHDh+uhR4iUg7WDz3q1UOWmWS7L1pBa4vZu&#10;uummZckr5cASu91229lVHcToXXbZZebxxx93iiFEpxLPh2eaqL588Fy7SS+ZMGGCue222+xKBAGi&#10;mp9nrdQsrEHCOpnk/NO5/GltNSWHxx57zB4JIdIGgtCPycYIPKrXVK6zmHldbdweOwWkd7ihWHrE&#10;rbfe6lSZC8EzzXCffNjxp7jlBobQjB071q6E3/hRrQZfhDV2EPm5kkHOP53Ln5Z/OpnQRFp4gRZC&#10;pAO/x3AT1UfSxJprrmnPiHIwP8AtRB3mQ6Hq/ffft6vGjBkzxh7V40XQMVBG+I9fNhDwRVhjIVA6&#10;SLwhf5rqNBcB/NNZzzxNA9hBmMImhEgPZBwHkQLx+eefmxkzZmTKGlKtFcSLHZIIvXy4v5YD4V2Y&#10;ruVlRoGiboOhTZs2vvUL+iKsQXaQeJLLn875p/WhTBcMRHj33XftSgiRZNjm/+ijj+zKf2h+wxrC&#10;/aB58+b2rCiEXXi3FO76cs8tl/SB7aPQxztz5kx7VBkvX5twj1/VavBVWFfrZxL+U5g/XSkDVSSX&#10;kSNHuo7jEkLEE5oVX3jhBbsKFirXRMilfRx6tZpk3333dT3xkO9lPkTu7bnnnnbVGKb6FVIpIzsH&#10;/x6mMQp/IYQjlsKa5ghVraOFCwGWHPmnswfNjPp5C5FMENV+NCt6AbsDqRf4rhWZ2xAGuBx00EF2&#10;VZ5CYQ0HHnigM32xkD322MP06tXLrupgsqLbwteAAQNcNzoK92AD8bNP0NcSs4R1NLClx8x/nrj4&#10;kMo/nU0GDRqk8bdCJIwoRHU+VEuphNKHI+qhMty3b1+7Kg2e6WHDhtlVPUcffbT53e9+54jho446&#10;ypnKeOihh9rfrcftRF2q4G6+HuEdP6vVIGGdYGiawD9N4wONKcqfFvfff7/EtRAJIWpRnYNoOAoy&#10;abeGeIXBL9tss41dlYaixvTp0+2qHjQROdU777yz2WSTTezZehj2VUyUF8LX0L9/f7sSfkJhMtbC&#10;mg+l0kGCh2QP/NM0osg/LQqRuBYi/sRFVOfgPoI1hMp1FjOvS3HiiSc69spycC9moEylRJB8uHe7&#10;GfjSsWNH52sQwYANpNJYea/4KqxBHavBwdMvH3CaTuSnFeWQuBYivsRNVOdD5RV7g8ah10Ez4jnn&#10;nFPRhsE9+dJLL3WmLFaCnOw///nPFVO68GSfddZZztcggsHvajU0WbRoUcPh9TVCti5PbsIf2KbY&#10;aKONnAudrB7CK0cccYS2d4WIEXEW1fngu0Z0BJGpHQQkYBE/mg//huuvv96uaofBL3fccUdFQbzt&#10;ttuaLbfc0mk0bNmypfO1YbdBfL/11lsVpzpi7zzppJOcarVfnHrqqfaoHnqzsjzcj9hJ/O9+P7j4&#10;Lqzh3nvvdSY9ierBP92iRQtHTGvUuKgWLhiHHXaYxLUQMSApojofCjsIVHZK40wYwhr4PmDhKDdd&#10;sRa22morx/rBJEA/kbBuDA8/xdJbasV3KwjIDlI9Of8042fxYElUi1rgffToo4/KFiJExCRRVAMZ&#10;+RR4kjgOvdrJi+WgyvmrX/3KnH/++aZHjx72bO307NnTSRE588wzfRfVojhB2EAgEGGtBkbv4J/m&#10;6THnn16yxPeNBJFReDgbMmSIxLUQEZFUUZ2DuQjE8mFRKJwaGHdIzAoC+p0GDhxo/v73v5sDDjig&#10;Kk864+UPPvhg5+84+eSTA0tWw4YiGkKTblDCOhArCHAR4WIiSsOTL0H0bGElxccmkgt2kL322ku2&#10;ECFCJOmiuhBGdpMagtiOE8WsIID49bOyXI4JEyY41X082Lz4HnFvx5KC8Oaez688oLADUCltxC9e&#10;e+01c8stt9hVPVm2gnTu3NnsuOOOduUvgQnrUaNGmZdeesmuRD74p3lS5UOnqDwRJrzvGDQgcS1E&#10;8KRNVOdgUiPe6zgVhEoJ6379+jkV5SzzyCOPmGeeecau6smysGZsPVF7QRCIFQQ0LKYxdAcz0AXf&#10;K3YPiWoRNuSsMumr2A1ICOEfaRXVQEoV1hBSq+KeeT1y5Ejz7bff2lX2wF5KoVPUw45BUDYQCExY&#10;b7DBBo6QFHWec7Z8vvnmG6chUf5pESVUKJ5//nln6pcQwn/efPPN1IrqfGbOnOkUiBAqcQVrxu23&#10;325X2QMLSNxsO1GDqG7SpIld+U9gwhqyXLVeZZVVnG0WxpjSNMa4WCGihgfejz76yNnCJS1ElQwh&#10;/OWpp54quu2eVhCuVOfxDgcpVmqB3GgauLPG4MGDVUApQlAWkByBeaxh9uzZTph6lsDDSnMHjQuy&#10;eog4wbACmmsKITd1l112cR4GhRDVwVjru+++27nvZRUe3MnOZ3c2bEp5rPOh2PeLX/zCuRamGXbG&#10;b775ZmeKZjmy6LGmv4jBaUESqLCGBx980HzyySd2lV6wvdDxS7RPENmZQtQCDbNUlfBGFmPjjTd2&#10;RvaSoy6E8AZChiKSrv1104IpLoXd2OhGWANCsmvXrs68CF4kc6UBbDn8+3m5GasOWRTW22yzjZMZ&#10;HiSBC2u2YIYOHWpX6QP/NE/osnqIuEKsE02LlcbwckOkct2lSxd7RghRiQ8//NDZchcN4SGdKn5Y&#10;Q87cCutKMPWwV69edhUMF154oXNNjposCusBAwY4zoIgCdRjDYyMrCY4Pc4wFUn+aZEEEMt0xFcS&#10;1cD2LT5ExWQK4Y5XXnlForoEM2bMcMQugziEiAMUQoMW1RC4sKaau8UWW9hVsmnRooUTl4dHB8uH&#10;hrqIOEMlgmYioh29QEMjjY1R+CSFSAL0zzz++OPm5ZdftmdEMb788ktnJHraimsimYQVqBG4sIak&#10;C2uC8PFiEZOHly7LmZgiOVCtpmpUDXSS0x+BL1sIUQ9eVpoU33//fXtGlIO5DVOnTnWao9ntFSIK&#10;iIRs3769XQVLKMKaTuGwRnf6CVYPvm6ENFU/NaaIpEDzEAMcamHOnDnm4YcfNu+88449I0S2oWfo&#10;rrvukv2vCqhcM6wkzpnXIr0gqnFQhEEowhqSUrVmihRiGlGN1UMXUJE0ENV+NPHAokWLzJNPPmle&#10;fPFFe0aIbDJ8+PBUN+KHAYNK2AXDd73ccqHJDyFCnasSeCpIPjfccIPT7BdH8E2TbckHP+1WDx4c&#10;unXrZlfJBq+jbnb1rL/++s4AmCCgYXf77bdPTTyVEG5g54ax2H49rIo6KAA0a9bMt14OpYJ4Jyup&#10;IExa7Nevn10FT6jCmif+0aNH21U8wD/N03OW8qcR1TvvvLNdJRsuyoxsFXWWK6K/goQbIeK6d+/e&#10;9owQ6WXMmDGOqC6V/y5qY8UVV3SKAW5SiyohYe2drAhrYmQ7duxoV8ETqrDGVsE0oDiA1YM3FII6&#10;a0hYp48gK9XF4POzww47OINlhEgbNP0SpTdp0iR7RgQJA9bIvMZ6Vi1+CWsKFEGnmIR5rS5HFoQ1&#10;TfxMWqQoFBahCmsYNGhQ0bHKYYB/GiHABzDLUXkS1umCqYqMrq3lplQNRPlRvUZgcyxE0kHcjR07&#10;1qlSk2YhwgM7JtOLsWNWg1/COktkQVhvtdVWzn0qTELvHujUqZM9Cg8+sORPEwyu/GmRJpiqSGJN&#10;2KIaiJ9EgBA9NnnyZHtWiGTCe5iISQYkSVSHD/1XFAg0UEb4SZhNizlCF9akg4Qx+QZoskJQE7Gi&#10;/GmRNqjuuJ2qGCRsm99///1OckgUAl+IWuAzhJjmPUzesogWxDXea3KvRbCkfacRi1EUzfahW0Fg&#10;xIgRTqUrKLLsn3aDUkGSD+9vbj7VDoAJCrzeWEMYqCRE3MHr+tprrzliTsQLvLEU4dxaQ9hliIt3&#10;OSnkCo9pZaeddjJbbrmlXYVHJMKaLR+i9/wEkUGkCh65uEb6CeEX2JvibL/o0aOH42vj5ihE3Jg3&#10;b57jpX799dftGRFXWrVq5RRQKtlzsKYxMVa4BwdBWqvWTPmkaZHeurCJJKEdUeBX9EnOP00DFxVq&#10;iWqRdsh/jbun+Y033jD33HOPxj6L2PHuu+86TfQS1ckgtytX6SEdgRh0mkea4HuVZisI3uooRDVE&#10;UrEGuncZl1wt+GYYjfrll186VWohsgBDjKJK1akWurK32WYbxyYiRFQQ9/rCCy8oQi+hNG3a1Lnv&#10;l7OGUNlWI7U7ohSeYXDAAQc4HusoiExYw0033eQIYy+0adPGySOUf1pkjTAGwAQFlZHu3bs7L3aX&#10;hAgL7jHjx493dk/Y4ZSwTjaIa2wf33//vT3TEAavMC1TlIZ7SVghElHAe+Sggw6yq/CJVFiPGjXK&#10;6cauBEIa/zQeK1k9RBbhQpEG/yBNl1tvvbXjwSYqUIigQGAhphHV+VN1ed9NmTLFrkQSwcZALN/C&#10;hQvtmYawO0EMqWgMu55pL27QQN+lSxe7Cp9IhTUxYf/973/tqjFcANk+5sPDIBAhskjYUxXDgMYS&#10;BDYvLF1C+AXFF8Q0r2I2QWIqEV6lKp4iOdDYWEpcYxlhZ1s/5zq45iKo054TTpDFgAEDIm2cj1RY&#10;w+OPP96owUn+aSHqoFFx2rRpqc2H5uKXs4got1bUAoWa9957zxHUTOErR4sWLcwnn3xiVyLJcI1k&#10;J6zUnArO471evHhxg52LLLDccss5O/5cWxHWWYCkk759+9pVNEQurPG7PfDAA86x8qeFqAc/KNvZ&#10;RIOlHR6kcwKbioMQbqEymbN8uH0ApREOn67XHh8RTxCNPCyVql6L7NCvXz/HOhwlkQtreOihh5wn&#10;SUSEEKKukstuDRNDswQPE/ivsYggfoQoBSIqJ6ir2e5nW3zixIl2JdLARhtt5FSmtdOdTfCP9+/f&#10;366iIxbCmu07pjEKIeoa/IhByvI0OLZ3qV4jsNM+dld4g36bnKBmi78W8FvHbXqpqA3SLrA+qHqd&#10;PaKatFhILIQ1aR8E9mtbToj4T1UME/otGADFK83xUKIypDzgiybHvZSf1itKCEkneIupXktcZwd2&#10;oA499NBYFGJiIaxh3Lhx5pVXXrErIbKJtqeLw41ys802cwR2p06d7FmRdtjWR0zTi0MTbxDwwKZs&#10;63SSG0rl1nsvksuOO+5oOnfubFfREhthzQWUqvXcuXPtGREUhMPTKBp32MmgMkXVYfbs2c57JM0k&#10;capiFJBhi8Du2rVr6vNYswoDPnKCOuiqI7YBGoQV6ZpOsPuwM6HqdXrhPoC3mgJMHIiNsIa3337b&#10;jB492q5EUHTr1s3svPPOdpUc8Bzjq0zq9MFyJHmqYpQwiRVPHSJbJBuqiohpXmH7nrVTlH6whvhl&#10;IRLxIi7e6hyxEtY0olC1Jj5JBAciJOqcx1qgmjVs2LDUxDJKVNcOEX0dO3Y02267rarYCWPWrFlO&#10;ZRpBHZXwwZdJ07Cm9aUbrg38nGttehXxASsX3urll1/enomeWAlreOONN8zYsWPtSgRBUivW+WAT&#10;GT58uJMok2Qkqv2HmycCW1Xs+IKwyVk9Zs6cac9Gi7zW2YCHcFKHZA1JB1GPLy9G7IQ1FQtyrbVl&#10;ExxJr1jn8+qrr5oxY8bYVbLg4o69RSN3g6N9+/ZOZN+mm25qz4iowMNMLjtCGlEdx6oh456zHHOZ&#10;JUgcIu+60pROEV9I0DrssMNiVa2G2AlroGJN5VoEQxoq1vkMHjw4sMSAoMjSVMUo4eHl448/do7Z&#10;HWDcLZaRJDTvJh0809g8sG4hqPmVaYdxhsZYhHXWRl9nFX7eNDeqcTWZbL/99marrbayq/gQS2GN&#10;x/rhhx9WJS8g0lSxBtJC7rzzzsTscpBCgJUla1MVo4BrCd/rYiCuEdrt2rWLfARuGkCMUo3mlRPS&#10;SRSoabKEUJHl4Z3dAR50skizZs2cay67ERwXQ42NyYOkF7zVeObjRiyFNYwaNcq88847diWyChMI&#10;ySLlwseTKetiMInt+eeft6v4oqmK4UE1aurUqXZVGXKysYxgH2nZsqU9K8pBDCZCOleZLvUQkyRW&#10;Xnllp4I5f/58eyaZfP31186umKgHMdaiRQu7aghxp8S1qaCXDLbbbrvY9tHEVlhzUSAhRP4nkQNB&#10;ip+q1AS+2267LfaJMmqQCo98G4hXeADKiWwi/Xi4K1Xtygpci7ku54vptF6fkx6/R7qJ0rWK07x5&#10;c8cWVgx+j2u0vnfxhgckcqvjek2OrbCGESNGJD71QfgLW3qIaz5Yhbz44ovOBM+4UovQE97xe/ub&#10;9xxVLUR27ldepXZRkgrfN+wDVGypeCKmv/zyy8yJDX6uVOGTxhdffKHejQpgC+EzXAoaG+PYXCvq&#10;iHO1GmItrLmY47VWI4nIB0/s/vvvb1f1TJ482Tz++ON2FS8QYB999JFdiaAJM91h9dVXXya284U3&#10;1a84Q9wY4hkRxoupt2qorQfLAOklSQKfMDsKojJUrct9Rqlc83Al73W84HpLcS3OO4ixFtbw8ssv&#10;O/5ZIfI57bTTnDzSfKioYQeJG1Q/PvjgA7sSYRCHBxnSBnIiG783N4JyL+wnvKe9NuPQoEYDL7YM&#10;fqVKn1vnjnPniaVCUOeEtCiPV59+1CCqJQTdgWiu1EvB54XrtzKv40Pv3r2dCNU4E3thjVcMr7UQ&#10;+eyzzz5Os1khV199tT2KBxLV0YDYTOrNkCmA+UI7J7whXyTnhLMX8I2n1RcdBFTHEKtJ+J4RZaj+&#10;DW+0bdvWaVisBNVtGnP12YkWdiKpVhcW1eJG5XdUxFDtIXdWpJNqY85KiaY4feC4GEtUhw/bu0mu&#10;MCGQEMz8G7DDIeyomvLimHP8nldRDXG/IcUNrDJJiWKMe0Z4HHFrM8VrT1oIu1AiOjp16pSIa1js&#10;hTVIWKeTLbfc0uyyyy525Q2eXItRjdgIAhoVp0yZYlciTHTzK41Xm4mos5iVSiKKE+pF8o6XhxHe&#10;BzNmzIh970Ra4Z7P3IEkkAhhzXa6RhKnCz4gu+++e9VVFiLQComLZ5Spip9//rnyUCMiiUkOYeFm&#10;21s0BOtNEoQ1FiIRPERN8oCatjSguINmIGM+CSTmKpuUJxVRGXYg9txzT7vyzrbbbrvMc5oPF7yo&#10;IQ6Q5iE1hkUD33+lWpRGVc3qIMKOIVVCAIUTrvGldk6Fv7ALiQ0kKcS+eTGfZ555Rs0ZCYeGQxoP&#10;c5CRe9ddd9lVZTbeeGNzyCGH2FVDnnjiiUjfH1QxeKKeNm2aPSPCBl/7hx9+aFeiEKaXJn2iYFSw&#10;E0WkZ1yhuc6t/YzrFA8KpGIUTiJ8++23A/93slvptyjlXpIbXMTkTDfgn6/VHqXM6+ChmNajRw+7&#10;ij+JEtYIlqFDh9qVSBrYefbdd1+7qsOLsCZiZ6eddrKrhlAlJmovypHKmqoYPcRj0dwniqNUkNqI&#10;s7h2I6z5fJCqUHgdzueOO+4ww4YNs6tguPLKKx1BGhTPP/+8uffee510oHL4IayB9wUPK4o69B92&#10;IQ8//PDE2EAgUcIannrqKTWF1QjbKsUmF1YDN+lPP/3UrkrToUMH069fP7uqh4aQZ5991q4ag4+N&#10;LGAugCTElGL48OHmnXfesavwSfoI5DRAt7ib92KWoUKpBsbqoXGNYkAcBVQlYU0m929+8xuzySab&#10;2DPFSYOwBlJ0rrnmGse2UQq/hHUOPl9uq+XCHdtss43p2bOnXSWDxAlrtnkee+wxuxLV0K1bN7Pz&#10;zjvbVW3gPbznnnvsqjjt27c3++23n135DxXKu+++267CJw7DSIQyw93A9nvh1r/wRlwnMpYT1k2b&#10;NjWXX365Y5WqRBjC+oorrgjFs85D0AUXXFDSquG3sAbuB/QyaGeodtgFPvjgg4v2VMWZxLWI82Hs&#10;3LmzXYm4w/jxctuOtUJ1YPDgwXYVPog5iep4wE1UlIcdIqVH1AZNa+xQJYmjjjrKlagOi7Deg1g0&#10;TjjhBLsKB3bN2NFQ7Gft0BOSNFENicxe6tq1a6L8NnEjrEECTLXaf//9A4v44uLFVM6ott40ACY+&#10;8B5TzJ47FBNWG1SG/bLShUEu2jSr9OnTJ/TGN+5JyryuDXYTkpoGl0hhzZhZ7AyiOsKqFnADCire&#10;i6rR/fffH1mVku0+pU/EB34ewh1JrADFDSxwJBQlgd12280eZZeovgeklGDD0cOsd5Ks8RIprIEt&#10;gnLNbCJ6SHHBD4/A9gsyimlUxNfNtnYUsA2sSL14oQg593CjF7WTlO+j7pPRfg94CKMPSNYQ95BZ&#10;TSNoUklc82I+pDA899xzdiXcgpWmb9++dlUbbpoXqewccMABVd+IPvvsMzN9+nSnYWj27Nn2bDSw&#10;BUy1XANg4oV+Hu5hW1yRhP4Qp4jNUs2L119/vSdLwtNPP23eeustuwqGgQMHht5Ee9xxx9mjeoJo&#10;XiwHPTlM5A3LjplEqO7TsJgku1UhiRbWoKEx3okibq9Vq1bmoIMOcnJU81m4cKHzMyyG2787LMjT&#10;xNoiL2+8UBqIN3iw1nRKf6DXh50zrmNRU0pY33rrrYpYXMpJJ53UKKkjbGENWFm5ByvzujhJGwZT&#10;jMQLayqYjz76qF2JOIMAYmpifuWaSuOdd95pV/GFrxlhLQtI/OBGpZ+Le9hm1U3dP+KSYS9hXZ64&#10;COscFJvi8EAWJ/gsUa1Oul0tsR7rHIg1/NYi/vAQ9Mgjj1SchhVHGK4g8RZP9HPxhkS1v2CHU/Os&#10;8AqpIYh6NRPXw25a0kU1JF5YAz8Mxdokg5y4TlJ4/rrrrhvLgRCi7sFaeENVMv9RY5qoBqZC8nmU&#10;fjGmTZs2ZrPNNrOrZJMKYc1FTfF7yQFxTf50EsQ1WdUff/yxXYm4QSOQ8IYSVPyHZlCEgRBeYQeJ&#10;WL6sP5ylScMl3mOdDxP41FiWHNg+3XXXXc19991nz8QLpnyOHz/erkQcURpIdVAZWrx4sV0JP8Dr&#10;j0DyM17UC6U81rfccouvdgMsDOw6lhrMxX+LRvX27dvbM40ZN26c07ReyhZIBfewww7zdUfqxBNP&#10;bPTfi9JjXQxSZlZcccWSI9jTCtO0d9xxR7tKPqmoWOeQ1zpZkPgxdOhQu4oXVKolquNNnEY0Jw1u&#10;3sJf2AnYZJNN7Cq9vPTSS+b11193kniKvd555x0zatQo+6eLM2zYMPPuu+8W/f/z4u9/+eWX7Z/O&#10;Dl999ZVTHFxttdXsmfRDsg523jSRKmHNE3KHDh3sSiSBOG5LI9g0VTH+RFUZTANKiQgG/LI0OqcZ&#10;N4O52rZta4+K48ZLm9XdKDKumdtACtVyy6VKohUFCwi7PWkidT81nnzCGtkt0gdxP8W2U0X8kPe9&#10;erJww46CRYsWOc3OWWO//fYzd911l/O6+uqrzQ477GB/pzj77rvvsj/Pq9KfzyKzZs1y7Fppbmzk&#10;s5JGp0Hqrq6MLk3btoIIB4bm0ISkhrj4IxtIbajaHxzE78UprcbvQlOxv2/IkCHm/vvvd47XWmst&#10;51e3/Pe//zUjR460q3rC+LrjDjsg+PbTVtHNgVZL40N+KssWbC1kyaMkagefFw0jX3/9tT0j4gwT&#10;MEX1JCnuMolwPckC/fv3XyZYn3zySaf67AVE9ZgxY+zKmEMPPdQeiXzI6k9b5nW7du3Mpptualfp&#10;IpXCOo1meBEcBNJzwYrT+HRRngkTJtgjUQ1YFkRw0ISWhUbG7bbbzpx22ml2Zczzzz/vWlzni2qq&#10;lmeeeabp3bu3sxaNIfN63rx5qYnlS3PYRGqNdl26dHHi0oSoBM1GU6dOtSsRdzTlrnY0fTF4iHbL&#10;QvpKnz59zMknn2xXlcU1u02FovqXv/yl6dWrl7MWpeGBmLjDpItrRHWah3ulVliDqtaiEnjyNVVR&#10;ZA0qXyJY8Me2atXKrtJDy5YtnV9Jrcg1au60007mpJNOco4Bcf3www/bVUPuuOOOBvYPRHWPHj2c&#10;Y67HK620knOc++/4BWkbaQFxzb8niZYjmjHTrs1SLazZikvLiEzhPzTAyVKQPCZNmmSPRLUg+pLY&#10;zJU0iBNt0aKFXaUDEkAGDhxo/vSnP9kzdey8887OEJYcDIAphJSL4cOH25Ux55xzzjJRnYO/F3tJ&#10;v3797BlRDB6OmWKctMZGRHXap0ymWlgDjYy5J2AhcrANpazq5EEcohrv/EHXxeDhveo1JcNvgqjU&#10;Eo9HdbmQvn37mtNPP935nBZrRKSXBWFOUeO8884z3bt3t79TD7+Hd1u4g8ZGdg+WX355eya+sAuR&#10;BSdBqkaal+K9994zI0aMsCuRdTQAJrlozLx/UHTQSPhwoELH9n2QlBppfuutt2og0FKwqhQ+lMdt&#10;pHktYLHgIY7dqDjCDtkBBxyQid631FesgTn0aY11Ed6g8U2iOrloeI9/kIYjwkHCVgTNN9984zy8&#10;xXXy5zbbbJOZQIlMCGvo2bNn6n09ojxsT7JtJpLJ2muvrTQLH0lTM1fcIR+/0phvIfyAhCse5OKU&#10;SIMFBGGdFTIjrHmK23bbbe1KZA1+/kxVZAiMSCZZGboRFsTBifAgKg0vrBBBQ+Y197s4VK/ZGcuS&#10;qIbMCGvYfPPNzRZbbGFXIisgyLipaapispk+fbo9En5AQoMID3Zb0pzdm+Odd95xGhMHDRpkzzRk&#10;8ODB5je/+Y1566237JlwyNoODQ/OVK+jTg2hQTVrM0Uy0byYDxe3xx9/XCIrI9ApTVNHXC0gtU5n&#10;I26Jh4a0s+aaa8pf7TNZmAwYN2jgooJHRdFvSjUv3nLLLb6OwqYBcOTIkY61jkFs+bzxxhvm6quv&#10;titjbrrppgbpM1yrTjnlFLsy5owzzmg0bZEJuBMnTjTbb7+9PeMPRAEW7tKkqXmxHIhrrLBhW+nI&#10;cd9///3tKjtkTlgDA0GeffZZuxJphgzZOA6A4QZLHFWnTp3smepAWN95552pF9dcoEn3Ef7BZ2O1&#10;1VazKxEWQV2TwkoFYaoiA2B4QLjtttvsWWPGjh1rrr32WrsyZvfddzfHHXecXdVz++23mxdffNGu&#10;jDPKPH/qInF9NOL179/fHHjggfZs7WRZWOfA5x9WURGP97777uukcGWNTFlBcrRv377Rk7ZIH3Gd&#10;quiXqAa2lo8//nhfK1JxZNasWfZI+AXDS0T44H1F0CUVHuYBkZqrvFOpvu6665xjIM+6mKiGX/zi&#10;F86kxhz5480RfYhq8DueUAORjJk8eXJomddbb711JkU1ZFJYA42MxQLuRTrgAx3HqYpc3A8++GBf&#10;RHUOxDU3sbSKa6qqX331lV0Jv2BLP07JAVmC60BahB6i+D//+Y/5+eefnTWV6vwJjMU4+eSTzV57&#10;7WVXdeIae4kIHooUPLwE6b1u06aNI6yzSiatIDnw3Q4dOtSuRFpAaH7wwQd2FTxbbbWVI5aTxKuv&#10;vlp05HAcobo3btw4uxJ+wntXletoID7Sz/H8YVlBrrzySvP+++87x4cffrh58MEHnWMoZf8oBY2M&#10;vHLk/33YQ7CJ+EXaB8RUA30Wfg+JIixgn332cWZGZJXMVqyBD1WPHj3sSqQBPsxhimoRPHPmzLFH&#10;wm+yLCqiJuiqYRjki2r8tF5ENVCQOProo+2q4d8ngocHMa4Bfu5cMbI8y6IaMi2sgcExWYuCSSt8&#10;mD/66CO7EmmA6sdnn31mV0KkBxqOw7Aj+h0zl7N85LPffvuZI444wq7cQXwmU3CxDfTp08eercfv&#10;r1sDkYqDT54kFnZQaqVdu3aZtoDkyLywxueG33q55TL/rUg0RD+R2SnSxbrrrmuPRBAUE0kiPL74&#10;4otUNHgNGTLEqVbzOuuss5wmuXKQCnLRRReZyy+/3HmNHj3a/k5waCBSebAl1TJQhljbbt262VW2&#10;kZpcCp5cKtcimeSmKn7//ff2jEgLCA8RHBIb0RP0NEa/d3zIlC8Hnv1KcwPmzZtnj0pDLKFfqPnZ&#10;HRSneNgm89oriOqsW0ByZLp5sZAnn3xSVc+EkRs+EKUPV82LwYDvjy1KERybbrppo4YuET4UB2q9&#10;95RqXjz11FN9HbaCUH/ooYdKNr3SEEcGdbmUIvzlr7zyyrJovUIQdthDqhF4xWDK41VXXWVX9WS9&#10;ebEc2DrcPpB06NDB7LHHHnYlJKzzwGvEVEaN+k0GcZmqyNeQNMsCFaO4Tx/Fe8l4ZBEc7NYpci96&#10;iJQkH7qWHYRSwpqEhiOPPNKussmjjz5qHnnkEbuqR8K6PPSf8eBd7uGbBlxEteKL65GwLoDpbiNG&#10;jLArEWfiOlVR+IMfVTxRHiqC9CeI6Kn1elZKWCPar7jiisxO2cQieMEFFxStvkpYV4bvD5NvSxVi&#10;dtxxR9O5c2e7EiCPdQG8QZjMKOJNXKcqCn9gXLJEdfAsXLhQjdsxYcGCBWattdayK//g773hhhvs&#10;KnvcfPPN8ljXANVqmlGLvTc333xzieoiqGJdBLbJH3vssZL+LxEtdNET0xRHiIdjsEEcGT9+fGKi&#10;62QDCQ+mgH777bd2FRzYHLhJ82uWos9InuLhBesavuNyDzLsHkycONGuvFGqYp2jX79+ZsCAAXaV&#10;DUpZQHKoYu0NLI98v7he0MSKBUQ7Xo2RsC4BQ0aGDx9uVyIuhD1V0Sts5xI3FUcGDRrkWJ2SANWR&#10;SpFdwh/o5vd7+lo+VMVJ7VGhog6uEQiUUgKblBDGTnulkrAGGgtpZmzZsqU9k04oIFx//fUVdzUl&#10;rKuDZsUtt9zSeSgXjdEeYAm22GILbXHEDCrVmqqYfqjwSVSHB5XUoCAukeZiiep6eMggM/i7776z&#10;ZxpSLk2jVhDeF154obn22mvNc8895wxpSQs8jLzwwgvmv//9rznvvPNkFQwQ+l8kqkujinUZqAAQ&#10;fF9N9UD4C57qCRMm2FV8UcW6djbeeGPz7rvv2pUImh49ejhiz28Q1ZqaWRoeaKggF0tlYZu9UvW5&#10;EDcVazeccMIJZtddd7WrYPjd737npKBEjSrW3uE9e8ghhyhNqAyqWJeBC98OO+zg+GZFdCBW01RZ&#10;EeUpVckTwRDEkBjsHxLV5UEIlxKXeNFzGf1CxAUq1TvvvLNEdQUkrCuAqENci2ggI5OObomt7FBt&#10;85aojiBy+5M0MZPCCTti7JTwYnqcX4NJKkETWDF/O9aZtPugRfLYaaednGxrUR5ZQVwyduxY88Yb&#10;b9iVCIPcTkEctgzdIitIbZCXmpQGy7TAdrifkXtUwONq22LbH2/oZptt5iTPIBIY8FQM8o+Z6Ers&#10;48cff+yk6gThFadZke31Qtgxpd/A7UOKrCDekRXEPdttt51TrRaVUcXaJdtuu63yrUOEGz1NPEkS&#10;1aJ2NPU0fLBt+Em5KW1RQSP6SSedZK6++mpzxhlnmN13390Z515KVANWDAQvYuLkk082//rXv5z/&#10;7zbbbGP/hD9QtS4WP4hQZutdiKjp2LGjRLUHJKw9wBPb2muvbVciSIhb04CQ7JGEBtW0wQARPwnC&#10;s10tPXv2dFIwfvnLXzrFkVoTULp27WpOOeUU88c//tGZOBc0NJViTxEiKrBJ9e3b166EGySsPYDv&#10;bvvtt7crERSaqphN5N2LBr8b5eIw/IUt/rPPPtupNBezWdQK0Z/HHHOMI9qJZg0SP206QniBB1Eq&#10;1UFMBE0z+sR6BA+omhmDg8ahJFct/RQVxDxmKXYuS9P44kaQ2clhs+eee5qLLroolJxdRPs555zj&#10;xI8FBZOA27VrZ1dChAeimmEwwhtqXqySl156yWlmEf4R51HlbvGreRFRfeeddzrVRG7afgwrinvz&#10;4vz5883PP/9sV+7JqiCnsc0vunfv7qTv+AE/xxkzZthVuJx44ommV69edhUu3A9uu+22qqw1VL3L&#10;/TzZUcALX84P71fzItfhoCuU7EjGoZ9CzYulYSLrPvvsY1fCCxLWVYKPcOjQoRoe4xNUqj/66CO7&#10;Si5+COucqM7deLjh+iGu4yyssYG4fVBFfCNeaPqKk583bNimJVECi1rTpk3t2erwc0hMFMKaBKHT&#10;Tz/dbL755vZMZWiMZgIin7evv/7aifTkIQ0Ri7BEYLZt29YRX27h77rhhhvMp59+as+4o5KwBq4t&#10;5SxyfgnrLCFhXRx8/YcddpjyqqtEwroGGIDw5JNPKmO5RpIyVdENtQrrQlGdww9xHWdh7TZmj88a&#10;IggRIephUt9qq61mV97Zeuutne+rH4QtrLGx/OpXv3JSPirx+eefm1GjRpnXX3/d9QAbRDYV/T59&#10;+rhqJERUX3PNNZ6yvN0Ia0DolBLtEtbekbBuDA/rhx56qHLUa0Ae6xpAEJIUIqoHIaqpinWUEtVA&#10;Je2RRx4x77zzjj2TLsgJrgTb4IgVierGMGQEL261xDEizy2kdFQS1Xx/7rnnHvOHP/zBKYZ4mQrJ&#10;A8cLL7xgLrvsMnPzzTc7n9NysPt26qmnBuJbLxcPKIQf7LLLLhLVNSJhXSMMGqCaIbzDVMXcFmzW&#10;4eGilKjOgbh+7LHHUieuESKLFi2yq+Lw+35VVNMKleJqM6mT+hmksrbVVlvZVXFGjBhh/u///s+8&#10;/PLL9kz1UOkmau/pp5+2Z4pDJfT444+3K//AB89gm2K4qXiLhuh71hD6Eyp9nkRlJKx9gDdjEJFO&#10;aQZPJFUyvxqmkgyi+q677nLVzJNGce3Gx1dLNTZLIK6raebEr5408IXvsccedlWce++919x9990V&#10;H9y8MnjwYHPjjTeW9fgzSIZBNH5Dj0GxCD6JRO/UmmueJtj1CXriZlaQx9onaKYaMmSIs+UoysNN&#10;AT9oGgfAePVY50S11yY8bqIHHnigM7DCLXH1WPOAVW5UNKLIy9Z92PCzYDIZjW5soa6zzjrO+zvn&#10;3WQ0Ng8G/Bv4edOANm3aNOf3ggBPMA2NXuDP83X7QRgea763f/rTn8oO7LrpppvMG2+8YVfBgBg5&#10;88wznUJBMXjIueSSSyo2M7r1WOco1cjIf8fvSZppBVsNDaqi7poxYMCAwNNgsoKEtY8gFPHvifJU&#10;6m5PMl6EdbWiOodXcR1HYb3uuutW9Fcj1OJWsabSxeQ9dquIpfLaAEUCx5tvvmleffVV33cfSLXg&#10;++qV9u3b++JfD0NYH3zwwWbvvfe2q8YQezdmzBi7ChYeqs4991y7aszYsWPNrbfealfF8Sqs2eXJ&#10;PbDlw64X1xVRGZKISj0QZQ0SQJRX7R+ygvgI3jc1M5ZHUxXroHu/FlENOVsIAi2puGnGcmORCQsq&#10;pMcee6y54447nAcoRmZXkyrAAxg2hosvvtj861//MnvttZf9ndqp1vbg5/TFIOFnUE5UP/HEE6GJ&#10;aiB7H7tJKRil7rdo4WfMe6gQGiaLnRcNoTIrUV0H9g+Jan+RsPYZqodUH0Rj2HZLS6xeLSCquRH7&#10;kcGMuEZIJFVcu7EDVeMZDoIjjjjC8dWyS+DnTZlGN5It/vOf/5iddtrJnq2ear9fSZm+2LdvX3vU&#10;GLLwseSFDQ2S7D6UgqQFv6E/haprIUQvlrPIZB19f+qhUTGqgUppRsI6AMg7JelA1JOGqYp+kBPV&#10;fkfGJVFcU1lLQtIHVo9///vfTgKFl+16r2y44YZOHvN5550XyY2/WENcHNlhhx3sUWMeffRRexQ+&#10;NDSWelimkTGIn2mpxl8qstyD0jSqvlYYosSOqSr6ddAPEkRzrTBm+YsvvvhSeyx8gg8wjUBU45Kc&#10;D+sXaZmq6AbC9dn6LUZQojoHuwFEGCLQivHBBx/EqgmQr5Ppd5WIcsJi//79neY0vq9hwbAcKtcz&#10;Z8509f0pxhprrGGP3EP104/YPWwK+KyDAIHau3dvu2oI9o9hw4bZVfjgecYWVCpTm+9JKRscnvhq&#10;Htr4b/I5KtY0j6jmfYDFh6+L+xK9ARxn5cWDB425PGjwPXaTQJQFuJ7tv//+TvVe+I+aFwOEJpKn&#10;nnoq0wMt0jRV0Q1UQ7xOXqSS/8ADD9iVOxBeXreX49a8yI2PSXiV4M8gIMLmtNNO81zR4SEAQUwl&#10;nq+ZKjAPW9zUEcxexRPJFs8++6xducfNhMBCsLH50SQaZPPiL37xi5LC+sorr3RGlEcJQoWvoxgT&#10;J040f//73+2qIV6bF/OhT4HPSJx6EUR84brL7psigoNDVpAA4eZWzg+Ydtj6DHO0sUgOVJDciOqo&#10;OOecc1yL6vHjxzvNjL/+9a/NcccdZy688ELzt7/9zRlrjYXk8ssvd1Ij8GgTvYZdYc6cOfb/XZ6B&#10;Awea/fbbz66CJYqHF6+U6l9hdzBqUQ1UjktF/NEgxkOW3xBVyUObEG7o16+fRHXASFgHDJMZt99+&#10;e7vKDuT4cpNJ4uAJETxxzks9/fTTy/p4czDJ74ILLnCm+tEwVymbmp2r999/37EDsavxz3/+05VF&#10;6oQTTjC77babXQVH3Kcv0qdRyuISp4FJ7777rj1qTLt27eyRv7BLIO+wqATpQwpXCB4J6xCg83br&#10;rbe2q/RDYgIiQlMVRSmq9Q4HDXmulUQsW/qXXnqpU5HmuFpGjx5tLrroIsfuUSkiD7HfpUsXuwqG&#10;uA8WKVeVrZSFHiblHpaCqizTg1CNr15kB+yD3bt3tysRJPJYh8jw4cOdBrI0g0+QanWQk+XijDzW&#10;laFxxsv7IyyPNTed3//+93ZVHAZAMXzEb2hAQzx36tTJnmkM9pHzzz/fVWW5Go81jW3V/P8KCcpj&#10;ve+++zpRh8UgTaXw4YTPIg9KQfLiiy8WFdJYgYoJ3ZEjR5r//e9/dlVPLR7rfGjUk/1OFELevhJA&#10;wkMV6xDBb512bxO+6qyKauEOv0Zn+wmi8sQTT7Sr4tx1112BiGqggo+l5JVXXrFnGoMVAltIULDL&#10;FOehGaUqsljOSlX82SkM8lWKUv0DQVugeB8LkU/nzp0lqkNGwjpk9tlnH+cGmUZIPtBURVGJODYt&#10;HnnkkWU/l4jqxx9/3K5Kg+2r1MtNZN9VV13lWERKgU2FXO2giHPucSnRH0cLS6mvKegHF1Jd2rZt&#10;a1ci69AwS6yeCBcJ6whgOzPMXNwwIKs6Tj5HEU+IBiOGMk7w3j3ooIPsqjE0JroR1YD9gMpzsZdb&#10;ENflvNtkawcFWcdxhZiwYkSVcV6OUvMLwvj+YpsKIn1EJAsGwARthRLFkbCOALJtEddpmYqVpQEw&#10;ojbY1Ygb5eLs8L8TpRcmP//8szM6vRT4cfFMBoEfPt+gKCWg42h/KCWgw5hpgAc/rbuiwh1Yjoj+&#10;FNEgYR0RNJmElU8bJBLVwgt+DCDxEyp7e+yxh101hmi8KJg8ebK577777Kox5b7mWojzMKtSDaxc&#10;S+NGqa8prEhDPmcM5xLZA7uRRHW0SFhHCKJ07733tqvkQfUxS1MVRW1wwUcwxokdd9yxZHXxhRde&#10;cCrWUUGKS6kR9CSYcP3wm1IWhjhQbGw3UJ0rtftHz0eQr1KUatAN68GSByRsVyJ7HHvssbICRYzi&#10;9mIAEWgjRoywq2RA+gfxXxoA0xDF7ZWmTZs2VQ3yCDJuD+8zjYXFYJKi14QbfiZnnnmmXTWE1BGi&#10;6LzArlapJJA777zTPPHEE3bVkGpj89q3b19z1TqouL1tt93WnHTSSXbVEOLtygndMCG9hK+nGI89&#10;9pgT2ViIX3F7hRB9GreeBhEcxxxzjC+RmaI2VLGOAcThbLPNNnYVf7hYU3mRqG7MkiXen1OpLhDD&#10;6OW15ppr2v93cohbegMV9FKi+u23345FbCQ5yaUoF/dWLXH+TM+cOdMeNYYJt3Fh0003tUeNUca0&#10;CIpDDjlEojomSFjHBJqRyg2HiAsrrbSS00T05Zdf2jMin2qqTq1btzbHH3+8p1cQoipI2KqPS0Ux&#10;R7nRvq+++qo9ipZvvvnGjB071q4aEsT1wmtFPUwQ1qUezoKeSumFrl272qPGhG2FWrBggeL3MgCj&#10;yjfffHO7ElEjYR0jdt55Z2e7PK4gGhFIcR1HLeJLHFMK2rVrZ48aM27cOHsUPaXsM3jD/RZNCPk4&#10;R+6V8rxjYYlDtY7dp1K7j1OmTHGEbtjQMMkuo0gn2AI1qjxeSFjHDMb2xjGSDGgS0lRFUQ2lJuNF&#10;CTmvxfjiiy+KNg3i8a30Kid02WUo9v/Jf6244or2T9dTLh++1L+hFtiViivlHngoTEQNXwNxqsWI&#10;6mGN/gQlhKSTHj16mO23396uRFxQ82JMoTEpTn5HxL4GwFSGyhBNb3Hk3nvvjeRnSM5wLdahoJoX&#10;//znPxe1g1Ah5vcK2W677QL/2R599NGNHkLYJeJnV4x77rnHDB482K7qqaV6S/Xrq6++sivvBNW8&#10;CFTT//WvfxV9AAF+blH5mKlW/+UvfymZyHDxxReXTHkJqnkxHx6YaDgX6QArGPMwRPxQxTqm4KON&#10;C8R6SVS7g63eOFZnodRNPWg22mgjexQvSk0/rUVUBsHixYtLep+D2OKP+5CYV155xa4aE6XQYHpn&#10;KVHNw1pUn78cQY9TF+GBZVSiOr5IWMeY008/vWRlJiw0AMY7H3zwgT2KD1TxohrOEseR01Aq+zio&#10;aL9aKPU1lfo3pJnhw4fbo8aQ8hLF4C181eWsKOXSXcLi66+/dhKFRLLBbnbUUUfZlYgjEtYxh+zb&#10;qCaLSVRXBzfRuFWti2XnhgHVzzg+aECpaMQ4V2wLqSbesRJxHhIDn376aVmhuv/++5uLLrootIY9&#10;xGq5HUaq1XH5DPCQG8cR8MIdHTp0MEcccYRdibgiYZ0AmKTEQJYw0VTF6mHb/sEHH4xNpRYPblRJ&#10;LkE01/lFqYefUtv5UVLqawriAQ7rSdwZMmSIk2BSCiIsL7jggpKNhH7B+/vUU08tu3NQaohPFBBX&#10;qKp1MunYsaM57LDD7ErEGQnrhDBgwIDQIstI/5g1a1Yg1bCsMGnSJHPTTTc51bWowPpx6623xio6&#10;Lk6UssaUGkcdFYjqUrtWQeROlxOscQGB+Nxzz9lVcfg5BrlljtA599xzyxY9Hn/88dhNPqQPJIkD&#10;prIMQ+QOPvhguxJxR6kgCWPo0KGBRt6xfcqNNW4NXEmGqCseinhgCcNmgGCkQh11AgAPZiTb1Got&#10;CCoV5IwzzjC77rqrXdWDWMWCVYibJkwi8xgrXIwLL7ywomglPaWwCs3gB9ImivGPf/yj6DCbWlJB&#10;eJ8ylrtagkwFycFn6vzzzy/ZgJrPM888Yx555BG78oc999zT9O/f366K895775n//Oc/dlWeMFJB&#10;8uFhgId/EX8YOEQMr0gOEtYJhErNxIkT7co/iGPi4q4BMMIPEKLjx4+3q+oJSlgfcMAB5rjjjrOr&#10;hlCJrKbSuMsuu5gzzzzTrhqCWK+mwlzu6zznnHOKithahDWRdq1atbIr7wQtrOn9OO+881yJ6hxM&#10;baQo8cYbb9gz1YEA7tevX9mx5cBO1d///nfXA2HCFtbATgg7kyK+kFPNQ5xIFrKCJJA99tgjkHHG&#10;mqoo/GSFFVawR/GkXMWuW7du9ih6So3IpvodhIClNyCuQ2KoVHsV1YAXeuDAgc6uwY477miaN29u&#10;f6cyPGj06tXLeYjhVUlUI6ZvvvnmSKYseiGLiTJJomfPnhLVCUUV6wQzevRo8/bbb9tVbWhrUPgJ&#10;NhCa4BinXCtBVaxpbGPwSrER3jTu/v73v7cr9/hdsaaJ+Prrr7erhowdO9b87W9/s6uG1DremweL&#10;uXPn2pU3gqpY45n+3e9+51lUl4KfMdc8qrZE0fFe5X3LQwUe5A033NCJNsNL7TZJg7/nhhtucMaX&#10;eyGKijXw7/T6tYrg6dOnj+nbt69diaShinWC4cPHU22tcPOWqBZ+QoXQD1EdJD///LN588037aoh&#10;m222WSC7Ql7Zfffd7VFj3nrrLXvkP3HbbeAa5dZT7RZ+xnvvvbfzwPOb3/zG/OEPf3CmI/LfOeWU&#10;U5w87C233NK1qEagXnXVVYkSqvQ/RD0rQTRkhx12kKhOOBLWCYfBBGxTVgtbq5qqKPymWBU4jrDr&#10;U4ooBo3kQxIIft5SFGta9Is4JQJRqcb+4TbJIoqvfeTIkebKK6+MNAWoGrAT1eKnF/6CoMaqJJKN&#10;hHUK6N69u1O99gpNQMqqFkGQlKrdiBEjStozSPjgFRWHH354Sa/zyy+/HKiH96effrJH0YKopoLs&#10;VlRTgb3mmmvMv//970DTk3JgU7rlllvM//73P2cHJIlg+YlbxGQWYXeqmvu4iB8S1ikBT+T2229v&#10;V5XRVEURFEQLVpN+ERXEsZWCiXorr7yyXYUHD8vlIraeffZZexQMcRgSQ+yfV1FNvB1JNEw6JKLw&#10;vvvuc8Sv31DpffTRRx37yGuvvWbPJhMeomqJVxS1s9dee/li6xTxQMI6RWy11VautpGoTsj+IYIi&#10;aZ5NJuOV8oPzAHrFFVeEWtHjv8U0v1LQtPjhhx/aVTBE7Y+vVlQXFguGDx/uiN/bb7/dl7Hi9KIg&#10;1vnannrqKXs2+ZCfXmvDq6gOHqB5kBbpQakgKeT99993toqLwQ3rs88+qzioQohqIW3DzwFDQaWC&#10;5FMuKxqIoPvzn//sfLbKUW4KH39HpUo+2cIIQRrrSvHb3/62YrNxrSKJB4pqK/W1poLkRHWLFi3s&#10;mfKUEtXF4O9mih2ReYz25t9Zji+++MKxlGCZoxIelIc6qlSQfKhaT5061a5EGOy///7O+1GkCwnr&#10;lEJ1hmpNPjRDMQlPUxVFUJDe4PduSBjCGrAOMOWwFHwNJEgEZZOgUv3rX/+6rKgeNGiQUzGtRK3C&#10;mpxnfpbVUIuwDlJUF4MmW/5bTJzN5Trz86XwwHWycApmUMRBWAPf/8mTJ9uVCBJGlBPlKNKHrCAp&#10;hQt1/rhmtuepmElUiyCh4ppEEFWVLCw0El522WWO+PAbeiT4u8uJauwfbkS1HyAsw47cI0ovTFEN&#10;XBOpQjPJloo0L44ZlBWWqI4TWICS+hlOEocddphEdYqRsE4xVN9yObgIhzlz5jjHQgRF0uLGgM8G&#10;+cVYAyrRrl07869//atsvrQXEOtYULB/lPNxL1y40Bk8EiZhTl+MQlSLxrArw2AcERxHHHGE6dCh&#10;g12JNCJhnXLwEtLUqFHlImgQRUl7eENUX3LJJc4Oj1uwDZx22mnmr3/9a9WZswjJ/v37m+uuu87x&#10;d1eC+LggphmWI2eNCJqcqCZT3w0S1cFCI6Pbn4XwxrHHHutM8xTpRh7rjEDDIvFQXDSFCILWrVub&#10;cePG2ZV/BOWxpiJ70UUXeRLVxZg3b56T1MG/HX85DW/F4PvD9i+2Dy/52P/4xz88D4PxI+GB+K9q&#10;ouq8eKwlquuIi8c6B024msbrH9jMzjzzTE25zAgS1hkCcfLYY4/pgikCgebYIKqqQQhrRDX2j3LN&#10;itXC10ovA7+SkIJnFZsHx16g0ZgR2dWMLvdDWPfo0aOqB3G3wprKPwknXkQ1349PPvnEnkkPcRPW&#10;wENPGEN20g6fxWOOOcauRBaQFSRDICYGDBigzEzhOzT0hW1VqBY+B5deemkgohr4+zfaaCPHj41v&#10;G+HoVVQT70Y1vRpR7RcI2aBAVHutVKdVVMeVpE6SjBPcayWqs4eEdQZhylN+YogQtUK1OgnkRLXb&#10;5iGm0t10003mjTfesGeCh12l3//+92b69On2TDQEYb+BnKiulCGdQ6I6GmiYlR+4evbZZx/nXiuy&#10;h6wgGYb4rsGDB9uVENXDhLwpU6bYlb/4ZQXxKqqp2P39739fNrK6b9++5pBDDnGq0UHw5ptvmoce&#10;esiXHHA/rCD8Hcsvv7xduaecFUSiujhxtIIAnxki+OgjEO45+uijnZ4KkU0krDMON8DHH39cF05R&#10;NUFPbPNDWFcjqhF0o0ePtmfqIWqPl1+RWWPGjDHPPPOMr42ffghr7D38bL1STlj/3//9n2nZsqVd&#10;lQdRffXVV/s+cCiOxFVYA/0BZHuLynCdOf7448tOYBXpR8JaOKJ6yJAhalQRVYGIe/fdd+3Kf2oV&#10;1n6K6nwY5kJyxtZbb+0qAzsH9hJGo1OhJu2jVIpILfghrKlWV/P3lBLWTJrbe++97ao8WbN/xFlY&#10;A+PtFdlaHirUhx56qJI/hIS1qGPJkiXmySefDCQuTaQb8quDFEC1COugRHUhWBxoVqQamz8im88V&#10;XzsPr0ReIjip/gXdGOaHsAYEH1YAL5QS1tdee62raY5Z9FTHXVhr1Hl5ttlmG7PHHnvYlcg6Etai&#10;ASNGjDAjR460KyHKg4AMusmuWmEdlqiOI34Ja6rxX3/9tV25o5iwRphdccUVdlUaRDXDcLJmPYi7&#10;sIYg+yiSzG677eYpl16kH6WCiAYwSY5uZiHcUI0HNwzIjvYqqhk8kgZR7SdNmza1R7VBxf7HH3+0&#10;q+IsWrTIebCRnzee8PNzs+OQJQ488ECJatEICWvRCCbDHX744aZ58+b2jBDFWbx4sT2KD4jqP/3p&#10;T55FNbs1oiFYWbxSLLOb73G5yELeR1SqFakXX4jfU9JFHVxjSP7o1KmTPSNEPRLWoijt27c3Rxxx&#10;hGnVqpU9I0RDuLkwyCRO5ES122ZCiery0GjplVJV7nvvvbfo1NcFCxY4ojqrE2F5EIm7DSQHOw9Z&#10;T7xo06aNOfbYY/WQIUoij7UoC41LTz/9tJN5LUQ+PHS99957dhUcbj3WXkU11dhrrrkmlaLaL481&#10;FTlGq3uBh5Vy1wuiCvkZkTSBP//55593qqFZBe9yUNnoQRB0s3Kc4fNAso2SP0Q5JKyFK5577jnz&#10;+uuv25UQxhny8dFHH9lVcLgR1tWI6uuvv94MGzbMnkkXfglrkk4Qyl6ZM2eO+eqrr+xKlIP3LO/f&#10;JIFNcObMmXaVDfBS06goRCVkBRGuIEpIY9BFDhI3whDVbpCoDo5vvvnGHnlj3XXXVaObC6j+Jk1U&#10;Q9Z+tghqiWrhFglr4ZpevXqZAw44QE2NwhEEcUCiOljwP1cDw2XI9K5mJHpWIFHH7Wj3uDF37lzX&#10;n7kks+qqqyr5Q3hGwlp4YssttzRHHnmk68QFkU6qaWrzGzy6f/zjHz3d4G+++WaJag/gr662OslD&#10;D41eSazIBg0Ppm5Hu8cV4hHT/LPddNNNzVFHHaXkD+EZCWvhGbZ5DzvsMLPDDjvYMyJLMFEwDjYQ&#10;OvPbtm1rV5VBVD/77LN2JdzCA0y1YBniwWfDDTes6e9JA6R/UKXm+5HUSnU+NLbzc00jO++8szOe&#10;PC47cyJZqHlR1ATDHF588UXzxRdf2DMi7VBpe//99+0qeIo1LzLJD6HslltuucVJt8kKfjUvAuOa&#10;/fp8V5OLnRaSEqnnBf5N2H3Scv3ngWeXXXbx9MAuRCGqWIuawBJC3nXnzp3tGZF2qkmJ8BsvVqTb&#10;brstU6Lab4oNfKkWhFhWX2mEB6XVV1/drpIN4/uxOUpUi1qRsBY1s9pqq5n999/fyaf1awSyiCeI&#10;rDgM8nCbe0xV+8knn7QrUQ1x8NOL+EKsYpIHiWFR2meffZx86qzblYQ/SFgL3+jZs6emNaYctkpp&#10;WgqTYtW+KVOmVBynfscdd5hnnnnGrkS1xHFsvYgXfu5qhAk57VSpu3XrZs8IUTsS1sJX8HYirnv0&#10;6GHPCFEbxSLbaJxiRHYpENVDhgyxq2zh965R2A9SInnMnz8/cRaK7bff3gwYMCAVjaQiXqh5UQTG&#10;uHHjnMZGryORRXz58ccfQx8/zfvnyy+/tKuGYEE6+uijl4lJ/uwNN9xgRo0a5ayzCNYsxmT7BTtQ&#10;sniJSjDmm4FCcR9Pv84665i+ffs6cXpCBIGEtQgUEh0Q15988ok9I5IK0VoffPCBXYUHDVKzZs0q&#10;2TRJznLr1q2dyuqMGTPs2exCBY5IRL8gIo4UFiEqQTxdnK/1Xbp0cVI/NORMBImEtQiFl19+2bzy&#10;yit2JZJIVMIamADItDdRHibF+S2C8c/y4CJEJXgIJrv8008/tWfiAdV0qtTdu3e3Z4QIDnmsRSjs&#10;tNNOpn///mbttde2Z0SS4IY5Z84cuwof7A2a4FcexEMQlWV2CvS9F26g0Thu7xUeCun7kagWYaGK&#10;tQgVmlyGDx8e6oARUTvYC+IwbZFoL3ycoiHEhPHQGlQ6A6KE770QbiDbetq0aXYVHb1793Yq1WnN&#10;ERfxRBVrESpccA844ACz2267FU17EPEkLj8rxCMvfNWi7udCoyINWUFGnql5UXiBHa4oI/j4TBx0&#10;0EGOn1qiWoSNKtYiMqho0NhIY5qIL9wkaYajETVOkFDC8JI4TIIMG0QLojoswUtGfdx+/iLeYEua&#10;PHmyXYVHp06dnCo1TbdCRIGEtYgUkhxoahwzZow9I+LGeuutZyZMmGBXIovICiK8wq4Sw4XmzZtn&#10;zwQLSR9kU2uGgogaCWsRC6hekz0cRYVDlGejjTYy48ePtyuRRagCKo9eeCWs+L2uXbs6fmo1x4s4&#10;IGEtYsUbb7zhCOy4DxnICthAqATJrpNtmKrHe0EIr9BYO3v2bLvyF3bTtttuO7PFFlvYM0JEj4S1&#10;iB1ff/21efXVV83bb79tz4iooClu4sSJdiWyCgJGkXuiGmgknDJlil35R58+fcwOO+ygxloROySs&#10;RWzB1zt69GhVSyNENhABiGrEtRDVQCPh1KlT7ao22D3BS73xxhvbM0LECwlrEWtIfEBc8/rhhx/s&#10;WREWDGaZPn26XYkss9lmmznNaEJ4BTsZqTK1vH94uMP2QUKNEHFGwlokAqb+Ia4//PBDe0YEjWwg&#10;/9/enfVEtURhGC4GmQxio4CAjKJGGUSmO+ONif/A6IVX/lhvnJVJBJUpgCCiTEGR41endqeZe6T3&#10;8D7JTlPVxJgcjnwsVq1Cot7eXq6VR9oyOcjY3d1tb+/VPQiA3xGsESjv3r2zAZvRX7lXX19vRkdH&#10;3QpRNzAwYJaXl90KSI16ofUbyFT+7a6pqTH37t0zN2/edDuA/3HzIgKlp6fHPH361AwNDbkd5Arj&#10;1ZAonzfpIfh0oZMOMiZLhxOfPXtGqEbgULFGYOkwjKrXzL7OPs2DnZqacivA2Is3VlZW3ApIj/qt&#10;5+bm3Oqw1tZWc//+fXtwGggiShAIrJaWFvP48WPz4MEDRoFlWWlpqfsI+B+Hh5ENupHxKJp3/fDh&#10;Q/PkyRNCNQKNijVCQX17mn399u1bt4NM5Gr2LIKLqSDIloP/vujmRFWpVc0Ggo5gjVAZHx+3AZvZ&#10;1+nTyXtdMQ8kamxsPLbaCKRC1WlNmNE4TwXqjo4O9w4QfARrhM7u7q69Fv3Vq1ccwEsD00BwFFUZ&#10;Uzl8BhxHwVrte48ePXI7QHgQrBFaa2tr5uXLlzZg0x+avFgsxoFQHKKpIM3NzW4FpE6/8bh9+7bp&#10;6upiJjVCi2CN0NONXwrXenAyblrESTo7O83GxoZbAckpKCiwXzsK1booBggzgjUiQ33XCtfv3793&#10;OziINhCchJF7SJXmUCtQX7lyxe0A4UawRuRo/rVaRHTQEfsxvxon0cVMS0tLbgUcr7293bZ86NAr&#10;ECUEa0TWxMSEDdj0E//vtIsbgMHBQdtaBRynqanJBmpd9AJEEcEakTcyMmJbRKLeW6xf1Y6NjbkV&#10;cFhfX5+dGQ8cpDYy9VFfv37d7QDRRLAGnDdv3tiAvbi46HaiRYeKJicn3Qo4TJXI9fV1twKMuXz5&#10;cvxgIgCCNbDP379/4yP6olSZKysrs7/i1wxw4DhtbW1mb49vGTCmqqrK/qClUF1UVOR2ARCsgSNs&#10;b2/bcK2QHYUKXV1dHYc5cara2lp7sQeiS2cxFKYVqktLS90uAA/BGjjBr1+/4hXsf/+vuN3woQ0E&#10;yVCoVrhG9JSUlNhA3d3dbcM1gKMRrIEkqC3kxYsX5vXr17ZdJEz0DVM/QGxtbbkd4Hg3btwwOzs7&#10;boWw8y53UaDmSnvgdARrIAULCwv2gpkPHz7YdpEwYBoIUtHb22t+/PjhVggrtXnohyhd8FJTU+N2&#10;AZyGYA2kQRVeL2AH/SY6ner/9OmTWwEnGxgYMMvLy26FsInFYvFATcsHkDqCNZCBP3/+2HA9PDxs&#10;pqen3W5wFBcX28o7I9SQLG5fDKeGhgY7g1qBmikfQPoI1kCWqOqrKnaQ2iqYBoJUUbEOl2vXrtkw&#10;3dLS4nYAZIJgDWTZ/Px8vIrt9z5s2kCQKnqsg0/90151mikvQHYRrIEcWVtbswFbVezV1VW36x86&#10;7a8JJ/p7AslSGPv3fcOtECS61MXrn66srHS7ALKJYA3kmPqwFa5VwZ6ZmXG7+aeT/hMTE24FJOfq&#10;1au2Nx/BUV9fbwO1Hv7bAblFsAbOkIKsQrYf+poJ1kiHZhkzzzgY2tvbbXW6tbXV7QDINYI1kAez&#10;s7O2gq1WkXxctqEWEFWudPENkIrCwkLT3NzsVvCbc+fOxavTmlEP4GwRrIE80iEwrw/7LA+EcWgR&#10;mejq6mJEo89cuHDBVqcVqPUxgPwgWAM+8Pv373iLyJcvX9xu7tAGgkz09fXx2w6fUM+7Wj4UqFWt&#10;BpBfBGvAZ3RtukKvnsXFRbebPWoDKSkpYRYx0jY4OGi+ffvmVjhr1dXVNkyrd5rrxgF/IVgDPjY1&#10;NRUP2bpGPRv0TVl/LpAugvXZKy8vN21tbfahxx3wL4I1EABbW1tmcnLS9kV//PjR7O7uundSRxsI&#10;MtXf329WVlbcCrmkqrQXqHWxCwB/I1gDAaNA41Wyv3796naTs7e3Z785Ly0tuR0gdRxezC1N81Cg&#10;1hOLxdwugCAgWAMBNj09HQ/ZyfRM0waCbFB/r3r1kT2a5OFVpxsaGtwugKAhWAMhoFnYCsxeyN7c&#10;3HTv7FdbW2tbSYBM6OuooqLCrZAuTfFQkPaq00VFRe4dAEFFsAZCRvOwFbC9nmyP2kDKyspyMmkE&#10;0aKvIy4fSZ9G5Hl90+fPn3e7AMKAYA2E2NzcXLySrSr2WczIRvgVFBTYucn/vn+4HZyGEXlANBCs&#10;gQjQFJHnz5+btbU1Mzo6yqg0ZOzOnTv26wnHU8uM+qVVoW5qanK7AMKMYA1E0MbGhhkeHjYjIyM2&#10;aAOpYpb1YZq44wVpvapKDSBaCNYAbKuIQrYe5hMjGUNDQ4xt/EfhObEqXVxc7N4BEEUEawD76PDj&#10;2NiYrWTrFTjKwMBAJK/F1+SOxCB96dIl9w4AEKwBnELj+byg/f37d7eLqOvt7bU/hEWBZkw3Njba&#10;q8T1UJUGcByCNYCkqULphezEUX6Inlu3btmr9sPKC9JUpQGkgmANIC26eU8he3x83AZtJkREi0Jn&#10;YWGhWwWf5kl7FWmq0gDSRbAGkBULCwvm8+fPZnZ21l61zsG2cIvFYqaqqsqtgkd//7q6OjtTur6+&#10;nqo0gKwgWAPIie3t7XjI1jMzM2PW19fduwg6HeJTZVc3evpdeXm5nSmtIK0bIxWmS0pK3LsAkD0E&#10;awBnZnV1NR6yvUeX1yCYOjs77Ux0P1F7igK0grQXpisrK927AJBbBGsAeaVr1xW2aSEJnrt379of&#10;lvIpsaXDewWAfCFYA/AVWkiC46xvX6SlA4DfEawB+J7XQjI/P29vhtTYP73u7Oy4z0A+5Or2RU3k&#10;0MFIPZoh7VWjaekA4HcEawCBpUq2KqYK2bq8xgvc+nhzc9N9FnKlv78/7SvwD4bnixcv2o/1WlFR&#10;4T4LAIKFYA0glHSoTqHv4KPw7bcDd0HV09Njfv786VaHJYZnPeqHVnDWKy0cAMKIYA0gctTHrZCd&#10;WOX2QvdJQRH7dXR02FcvMFdXV8eDsx4AiBqCNQAk0I2SuqpbrSSqbHsf6zXx46PeC8JM56OoslxW&#10;VmYPB6oNQ6/eo/2De3q0p/dKS0vdnwIAIFgDAAAAWVDoXgEAAABkgGANAAAAZAHBGgAAAMgCgjUA&#10;AACQMWP+AzNc6P+B/hDxAAAAAElFTkSuQmCC&#10;" id="image1" style="opacity:1" clip-path="url(#clipPath4)" /></g></svg>';
-1!==navigator.userAgent.search("Firefox")?(browser.browserAction.onClicked.addListener(function(e){browser.tabs.create({url:"index.html"})}),browser.runtime.onInstalled.addListener(function(e){browser.tabs.create({url:"index.html"})})):(chrome.browserAction.onClicked.addListener(function(e){window.open(chrome.runtime.getURL("index.html"))}),chrome.runtime.onInstalled.addListener(function(e){window.open(chrome.runtime.getURL("index.html"))})),"undefined"!=typeof module&&module.exports&&(module.exports={isFirefox:-1!==navigator.userAgent.search("Firefox"),browserAction:(-1!==navigator.userAgent.search("Firefox")?browser:chrome).browserAction});
function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){var t;if(r)return"string"==typeof r?_arrayLikeToArray(r,e):"Map"===(t="Object"===(t={}.toString.call(r).slice(8,-1))&&r.constructor?r.constructor.name:t)||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,o=Array(e);t<e;t++)o[t]=r[t];return o}function base64Encode(r){r=(new TextEncoder).encode(r),r=String.fromCharCode.apply(String,_toConsumableArray(r));return btoa(r)}function base64Decode(r){r=window.atob(r),r=new Uint8Array(r.split("").map(function(r){return r.charCodeAt(0)}));return(new TextDecoder).decode(r)}"undefined"!=typeof module&&module.exports&&(module.exports={base64Encode:base64Encode,base64Decode:base64Decode});
var BACKWARDCOMPATIBILIYDICT={fullscreen:"vspace",fillscreen2:"fillscreen",sandwichclampcollapsed:"clamp",ifelse:"ifthenelse",xcor:"x",ycor:"y",seth:"setheading",remainder2:"mod",plus2:"plus",product2:"multiply",division2:"divide",minus2:"minus",stack:"do",hat:"action",stopstack:"break",clean:"clear",setxy2:"setxy",greater2:"greater",less2:"less",equal2:"equal",random2:"random",setvalue:"setshade",setchroma:"setgrey",setgray:"setgrey",gray:"grey",chroma:"grey",value:"shade",hue:"color",startfill:"beginfill",stopfill:"endfill",string:"text",shell:"turtleshell"},initBasicProtoBlocks=function(e){for(var s in e.blocks.palettes=e.palettes,setupRhythmBlockPaletteBlocks(e),setupRhythmBlocks(e),setupMeterBlocks(e),setupPitchBlocks(e),setupIntervalsBlocks(e),setupToneBlocks(e),setupOrnamentBlocks(e),setupVolumeBlocks(e),setupDrumBlocks(e),setupWidgetBlocks(e),setupFlowBlocks(e),setupNumberBlocks(e),setupActionBlocks(e),setupBoxesBlocks(e),setupBooleanBlocks(e),setupHeapBlocks(e),setupDictBlocks(e),setupExtrasBlocks(e),setupProgramBlocks(e),setupGraphicsBlocks(e),setupPenBlocks(e),setupMediaBlocks(e),setupSensorsBlocks(e),setupEnsembleBlocks(e),e.blocks.protoBlockDict)null!=e.blocks.protoBlockDict[s].palette&&e.blocks.protoBlockDict[s].palette.add(e.blocks.protoBlockDict[s])};"undefined"!=typeof module&&module.exports&&(module.exports={initBasicProtoBlocks:initBasicProtoBlocks,BACKWARDCOMPATIBILIYDICT:BACKWARDCOMPATIBILIYDICT});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",i=e.toStringTag||"@@toStringTag";function s(e,t,i,s){var l,o,a,n,c,h,r,u,p,t=t&&t.prototype instanceof d?t:d,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(l=e,o=i,r=s||[],u=!1,p={p:h=0,n:0,v:m,a:b,f:b.bind(m,4),d:function(e,t){return a=e,n=0,c=m,p.n=t,k}},function(e,t,i){if(1<h)throw TypeError("Generator is already running");for(u&&1===t&&b(t,i),n=t,c=i;(v=n<2?m:c)||!u;){a||(n?n<3?(1<n&&(p.n=-1),b(n,c)):p.n=c:p.v=c);try{if(h=2,a){if(v=a[e=n?e:"next"]){if(!(v=v.call(a,c)))throw TypeError("iterator result is not an object");if(!v.done)return v;c=v.value,n<2&&(n=0)}else 1===n&&(v=a.return)&&v.call(a),n<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),n=1);a=m}else if((v=(u=p.n<0)?c:l.call(o,p))!==k)break}catch(e){a=m,n=1,c=e}finally{h=1}}return{value:v,done:u}}),!0),t;function b(e,t){for(n=e,c=t,v=0;!u&&h&&!i&&v<r.length;v++){var i,s=r[v],l=p.p,o=s[2];3<e?(i=o===t)&&(c=s[(n=s[4])?5:n=3],s[4]=s[5]=m):s[0]<=l&&((i=e<2&&l<s[1])?(n=0,p.v=t,p.n=s[1]):l<o&&(i=e<3||s[0]>t||o<t)&&(s[4]=e,s[5]=t,p.n=o,n=0))}if(i||1<e)return k;throw u=!0,t}}var k={};function d(){}function l(){}function o(){}var v=Object.getPrototypeOf,e=[][t]?v(v([][t]())):(_regeneratorDefine2(v={},t,function(){return this}),v),a=o.prototype=d.prototype=Object.create(e);function n(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,i,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",l.prototype=o),_regeneratorDefine2(o,"constructor",l),_regeneratorDefine2(o,i,l.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,i,"Generator"),_regeneratorDefine2(a,t,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:s,m:n}})()}function _regeneratorDefine2(e,t,i,s){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(_regeneratorDefine2=function(e,t,i,s){function l(t,i){_regeneratorDefine2(e,t,function(e){return this._invoke(t,i,e)})}t?o?o(e,t,{value:i,enumerable:!s,configurable:!s,writable:!s}):e[t]=i:(l("next",0),l("throw",1),l("return",2))})(e,t,i,s)}function asyncGeneratorStep(e,t,i,s,l,o,a){try{var n=e[o](a),c=n.value}catch(e){return void i(e)}n.done?t(c):Promise.resolve(c).then(s,l)}function _asyncToGenerator(n){return function(){var e=this,a=arguments;return new Promise(function(t,i){var s=n.apply(e,a);function l(e){asyncGeneratorStep(s,t,i,l,o,"next",e)}function o(e){asyncGeneratorStep(s,t,i,l,o,"throw",e)}l(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,_toPropertyKey(s.key),s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var TEXTWIDTH=240,STRINGLEN=9,LONGPRESSTIME=1500,INLINECOLLAPSIBLES=["newnote","interval","osctime","definemode"],COLLAPSIBLES=["drum","start","action","temperament1","matrix","pitchdrummatrix","rhythmruler2","timbre","status","pitchstaircase","tempo","pitchslider","modewidget","newnote","musickeyboard","temperament","interval","osctime","definemode"],NOHIT=["hidden","hiddennoflow"],SPECIALINPUTS=["text","number","solfege","eastindiansolfege","scaledegree2","notename","voicename","modename","chordname","drumname","effectsname","filtertype","oscillatortype","boolean","intervalname","invertmode","accidentalname","temperamentname","noisename","customNote","grid","outputtools","wrapmode"],WIDENAMES=["intervalname","accidentalname","drumname","effectsname","voicename","modename","chordname","temperamentname","noisename","outputtools"],EXTRAWIDENAMES=[],PIEMENUS=["solfege","eastindiansolfege","scaledegree2","notename","voicename","drumname","effectsname","accidentalname","invertmode","boolean","filtertype","oscillatortype","intervalname","modename","chordname","temperamentname","noisename","customNote","grid","outputtools","wrapmode"],_blockMakeBitmap=function(e,t,i){var s=new Image;s.onload=function(){var e=new createjs.Bitmap(s);t(e,i)},s.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(e))},_domCache={wheelDiv:null,contextWheelDiv:null,helpfulWheelDiv:null,labelDiv:null},_getStatic=function(e){return _domCache[e]||(_domCache[e]=docById(e)),_domCache[e]},Block=(()=>_createClass(function e(t,i,s){_classCallCheck(this,e),null!==t&&(this.protoblock=t,this.blocks=i,this.overrideName=s,this.name=t.name,this.activity=this.blocks.activity,this.collapsed=!1,this.inCollapsed=!1,this.trash=!1,this.loadComplete=!1,this.label=null,this.labelattr=null,this.text=null,this.value=null,this.privateData=null,this.customID=null,this.image=t.image,this.imageBitmap=null,this.controller=null,this.container=null,this.bounds=null,this.width=0,this.height=0,this.hitHeight=0,this.bitmap=null,this.highlightBitmap=null,this.disconnectedBitmap=null,this.disconnectedHighlightBitmap=null,this.artwork=null,this.collapseArtwork=null,this.collapseButtonBitmap=null,this.expandButtonBitmap=null,this.collapseBlockBitmap=null,this.highlightCollapseBlockBitmap=null,this.collapseText=null,this.size=1,this.docks=[],this.connections=[],this.clampCount=[1,1],this.argClampSlots=[1],this.postProcess=null,(this.postProcessArg=this)._labelLock=!1,this._piemenuExitTime=null,this._triggerLongPress=!1,this._triggerLock=!1,this._check_meter_block=null,this.original={x:0,y:0},this.offset={x:0,y:0})},[{key:"_createCache",value:function(n,c){var h=this;return new Promise(function(s,l){var o=0,a=(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var i;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,20<(o=void 0!==t?t:o))throw new Error("COULD NOT CREATE CACHE");e.n=1;break;case 1:if(h.bounds=h.container.getBounds(),null===h.bounds)return i=50*Math.pow(2,o),e.n=2,delayExecution(i);e.n=3;break;case 2:h.regenerateArtwork(!0,[]),a(o+1),e.n=4;break;case 3:h.container.cache(h.bounds.x,h.bounds.y,h.bounds.width,h.bounds.height),n(h,c),s();case 4:e.n=6;break;case 5:e.p=5,l(e.v);case 6:return e.a(2)}},e,null,[[0,5]])}));return function(e){return t.apply(this,arguments)}})();a()})}},{key:"updateCache",value:function(){var n=this;return new Promise(function(s,l){var o=0,a=(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var i;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,15<(o=void 0!==t?t:o))throw new Error("COULD NOT UPDATE CACHE");e.n=1;break;case 1:if(null===n.bounds)return i=100*Math.pow(2,o),e.n=2,n.pause(i);e.n=3;break;case 2:a(o+1),e.n=4;break;case 3:n.container.updateCache(),n.activity.refreshCanvas(),s();case 4:e.n=6;break;case 5:e.p=5,l(e.v);case 6:return e.a(2)}},e,null,[[0,5]])}));return function(e){return t.apply(this,arguments)}})();a()})}},{key:"ignore",value:function(){if(null===this.bitmap)return!0;if("hidden"===this.name)return!0;if("hiddennoflow"===this.name)return!0;if(this.trash)return!0;if(this.inCollapsed)return!0;if(null!==this.disconnectedBitmap&&null!==this.disconnectedHighlightBitmap){if(!(this.bitmap.visible||this.highlightBitmap.visible||this.disconnectedBitmap.visible||this.disconnectedHighlightBitmap.visible)){if(null===this.collapseBlockBitmap)return!0;if(!this.collapseBlockBitmap.visible&&!this.highlightCollapseBlockBitmap.visible)return!0}}else if(!this.bitmap.visible&&!this.highlightBitmap.visible){if(null===this.collapseBlockBitmap)return!0;if(!this.collapseBlockBitmap.visible&&!this.highlightCollapseBlockBitmap.visible)return!0}return!1}},{key:"offScreen",value:function(e){return!this.trash&&e.offScreen(this.container.x,this.container.y)}},{key:"copySize",value:function(){this.size=this.protoblock.size}},{key:"getInfo",value:function(){return this.name+" block"}},{key:"isCollapsible",value:function(){return COLLAPSIBLES.includes(this.name)}},{key:"isInlineCollapsible",value:function(){return INLINECOLLAPSIBLES.includes(this.name)}},{key:"highlight",value:function(){if(!this.trash&&!this.inCollapsed&&this.container.visible){if(null!==this.disconnectedBitmap){if(!this.bitmap.visible&&!this.disconnectedBitmap.visible)return}else if(!this.bitmap.visible)return;this.container.visible=!0,this.bitmap.visible=!1,null!==this.disconnectedBitmap&&(this.disconnectedBitmap.visible=!1),this.collapsed?(null!==this.highlightCollapseBlockBitmap&&(this.highlightCollapseBlockBitmap.visible=!0),null!==this.collapseText&&(this.collapseText.visible=!0),null!==this.collapseBlockBitmap&&(this.collapseBlockBitmap.visible=!1),this.highlightBitmap.visible=!1,null!==this.disconnectedHighlightBitmap&&(this.disconnectedHighlightBitmap.visible=!1),this.highlightBitmap.visible=!1):(this.isDisconnected()?(this.disconnectedHighlightBitmap.visible=!0,this.highlightBitmap.visible=!1):(null!==this.disconnectedHighlightBitmap&&(this.disconnectedHighlightBitmap.visible=!1),this.highlightBitmap.visible=!0),this.isCollapsible()&&(null!==this.collapseText&&(this.collapseText.visible=!1),null!==this.collapseBlockBitmap&&(this.collapseBlockBitmap.visible=!1),null!==this.highlightCollapseBlockBitmap)&&(this.highlightCollapseBlockBitmap.visible=!1)),this.container.updateCache()}}},{key:"unhighlight",value:function(){this.trash||this.inCollapsed||null!==this.bitmap&&(this.highlightBitmap.visible=!1,null!==this.disconnectedHighlightBitmap&&(this.disconnectedHighlightBitmap.visible=!1),this.container.visible=!0,this.collapsed?(null!==this.collapseBlockBitmap&&(this.collapseBlockBitmap.visible=!0),null!==this.collapseText&&(this.collapseText.visible=!0),null!==this.highlightCollapseBlockBitmap&&(this.highlightCollapseBlockBitmap.visible=!1),this.bitmap.visible=!1):(this.isDisconnected()?(this.disconnectedBitmap.visible=!0,this.bitmap.visible=!1):(null!==this.disconnectedBitmap&&(this.disconnectedBitmap.visible=!1),this.bitmap.visible=!0),this.container.visible=!0,this.isCollapsible()&&(null!==this.collapseText&&(this.collapseText.visible=!1),null!==this.collapseBlockBitmap&&(this.collapseBlockBitmap.visible=!1),null!==this.highlightCollapseBlockBitmap)&&(this.highlightCollapseBlockBitmap.visible=!1)),this.container.updateCache())}},{key:"unhighlightSelectedBlocks",value:function(e,t){t&&(this.blocks.unhighlight(e,!0),this.collapsed||(this.disconnectedBitmap.visible=!0),this.container.updateCache())}},{key:"updateArgSlots",value:function(e){this.argClampSlots=e,this._newArtwork(0),this.regenerateArtwork(!1)}},{key:"updateSlots",value:function(e,t){this.clampCount[e]+=t,this._newArtwork(t),this.regenerateArtwork(!1)}},{key:"resize",value:function(i){var s=this;this.postProcess=function(){var e;if(null!==s.imageBitmap&&(s._positionMedia(s.imageBitmap,s.imageBitmap.image.width,s.imageBitmap.image.height,i),e=s.container.children.length-1,s.container.setChildIndex(s.imageBitmap,e)),"start"===s.name||"drum"===s.name){for(var t=0;t<s.activity.turtles.getTurtleCount();t++)if(s.activity.turtles.getTurtle(t).startBlock===s){s.activity.turtles.getTurtle(t).resizeDecoration(i,s.bitmap.image.width),s._ensureDecorationOnTop();break}}else s.isCollapsible()&&s._ensureDecorationOnTop();s.updateCache(),s._calculateBlockHitArea(),s.trash&&s.hide()},(this.postProcessArg=this).protoblock.scale=i,this._newArtwork(0),this.regenerateArtwork(!0,[]),null!==this.text&&this._positionText(i),null!==this.container&&this.isCollapsible()&&(this._generateCollapseArtwork(function(e){e.collapseButtonBitmap.scaleX=e.collapseButtonBitmap.scaleY=e.collapseButtonBitmap.scale=i/3,e.expandButtonBitmap.scaleX=e.expandButtonBitmap.scaleY=e.expandButtonBitmap.scale=i/3,e.updateCache(),e._calculateBlockHitArea()}),this.collapseText.font=10*i+"px Sans",this._positionCollapseLabel(i))}},{key:"_newArtwork",value:function(e){var t,i;if(this.isInlineCollapsible())(t=new ProtoBlock("collapse-note")).scale=this.protoblock.scale,"interval"===this.name?t.extraWidth=80:t.extraWidth=50,t.zeroArgBlock(),i=t.generator(),this.collapseArtwork=i[0],i=this.protoblock.generator(this.clampCount[0]);else if(this.isCollapsible())(t=new ProtoBlock("collapse")).scale=this.protoblock.scale,t.extraWidth=50,t.basicBlockCollapsed(),i=t.generator(),this.collapseArtwork=i[0],i=this.protoblock.generator(this.clampCount[0]);else if("ifthenelse"===this.name)i=this.protoblock.generator(this.clampCount[0],this.clampCount[1]);else if("clamp"===this.protoblock.style)i=this.protoblock.generator(this.clampCount[0]);else if("argflowclamp"===this.protoblock.style)i=this.protoblock.generator(this.clampCount[0]);else switch(this.name){case"equal":case"greater":case"less":i=this.protoblock.generator(this.clampCount[0]);break;case"makeblock":case"calcArg":case"doArg":case"namedcalcArg":case"nameddoArg":i=this.protoblock.generator(this.argClampSlots),this.size=2;for(var s=0;s<this.argClampSlots.length;s++)this.size+=this.argClampSlots[s];this.docks=[],this.docks.push([i[1][0][0],i[1][0][1],this.protoblock.dockTypes[0]]);break;default:i=this.isArgBlock()||this.isTwoArgBlock()?this.protoblock.generator(this.clampCount[0]):this.protoblock.generator(),this.size+=e}switch(this.name){case"nameddoArg":for(var l=1;l<i[1].length-1;l++)this.docks.push([i[1][l][0],i[1][l][1],"anyin"]);this.docks.push([i[1][2][0],i[1][2][1],"in"]);break;case"namedcalcArg":for(var o=1;o<i[1].length;o++)this.docks.push([i[1][o][0],i[1][o][1],"anyin"]);break;case"doArg":this.docks.push([i[1][1][0],i[1][1][1],this.protoblock.dockTypes[1]]);for(var a=2;a<i[1].length-1;a++)this.docks.push([i[1][a][0],i[1][a][1],"anyin"]);this.docks.push([i[1][3][0],i[1][3][1],"in"]);break;case"makeblock":case"calcArg":this.docks.push([i[1][1][0],i[1][1][1],this.protoblock.dockTypes[1]]);for(var n=2;n<i[1].length;n++)this.docks.push([i[1][n][0],i[1][n][1],"anyin"])}this.artwork=i[0];for(var c=0;c<this.docks.length;c++)this.docks[c][0]=i[1][c][0],this.docks[c][1]=i[1][c][1];this.width=i[2],this.height=i[3],this.hitHeight=i[4]}},{key:"imageLoad",value:function(){var e=10*this.protoblock.scale;this.text=new createjs.Text("",e+"px Sans",platformColor.blockText),this.generateArtwork(!0,[])}},{key:"_addImage",value:function(){var i=new Image,s=this;i.onload=function(){var e=new createjs.Bitmap(i);if("media"===s.name)for(var t=0;t<s.container.children.length;t++)if("media"===s.container.children[t].name)return;e.name="media",s.container.addChild(e),s._positionMedia(e,i.width,i.height,s.protoblock.scale),s.imageBitmap=e,s.updateCache()},-1!==this.image.search("xmlns")?i.src="data:image/svg+xml;base64,"+window.btoa(window.base64Encode(this.image)):i.src=this.image}},{key:"regenerateArtwork",value:function(e){null!=this.bitmap&&this.container.removeChild(this.bitmap),null!=this.highlightBitmap&&this.container.removeChild(this.highlightBitmap),null!=this.disconnectedBitmap&&this.container.removeChild(this.disconnectedBitmap),null!=this.disconnectedHighlightBitmap&&this.container.removeChild(this.disconnectedHighlightBitmap),e&&null!==this.collapseBlockBitmap&&(this.container.removeChild(this.collapseButtonBitmap),this.container.removeChild(this.expandButtonBitmap),this.container.removeChild(this.collapseBlockBitmap),this.container.removeChild(this.highlightCollapseBlockBitmap)),this.generateArtwork(!1)}},{key:"generateArtwork",value:function(i){var l=this.blocks.blockList.indexOf(this),o="",a=function(e,t){null!=t.highlightBitmap&&t.container.removeChild(t.highlightBitmap),t.highlightBitmap=e,t.container.addChild(t.highlightBitmap),t.highlightBitmap.x=0,t.highlightBitmap.y=0,t.highlightBitmap.name="bmp_highlight_"+l,t.activity.logo.runningLilypond||(t.highlightBitmap.cursor="pointer"),t.highlightBitmap.visible=!1,i||t.container.uncache();t._createCache(function(e,t){e.activity.refreshCanvas();var i=e.blocks.blockList.indexOf(e);t?(e._loadEventHandlers(),null!==e.image&&e._addImage(),e._finishImageLoad()):(e.isCollapsible()&&e._ensureDecorationOnTop(),e.blocks.adjustDocks(i,!0),e._positionText(e.protoblock.scale),e.isCollapsible()&&(e.bitmap.visible=!e.collapsed,e.highlightBitmap.visible=!1,e.updateCache()),null!=e.postProcess&&(e.postProcess(e.postProcessArg),e.postProcess=null))},i)},n=function(e,t){null!=t.disconnectedHighlightBitmap&&t.container.removeChild(t.disconnectedHighlightBitmap),t.disconnectedHighlightBitmap=e,t.container.addChild(t.disconnectedHighlightBitmap),t.disconnectedHighlightBitmap.x=0,t.disconnectedHighlightBitmap.y=0,t.disconnectedHighlightBitmap.name="bmp_disconnect_highlight_"+l,t.activity.logo.runningLilypond||(t.disconnectedHighlightBitmap.cursor="pointer"),t.disconnectedHighlightBitmap.visible=!1;for(var i=(t.protoblock.disabled?t.artwork.replace(/fill_color/g,DISABLEDFILLCOLOR).replace(/stroke_color/g,DISABLEDSTROKECOLOR):t.artwork.replace(/fill_color/g,PALETTEHIGHLIGHTCOLORS[t.protoblock.palette.name]).replace(/stroke_color/g,HIGHLIGHTSTROKECOLORS[t.protoblock.palette.name])).replace("block_label",safeSVG(o)),s=1;s<t.protoblock.staticLabels.length;s++)i=i.replace("arg_label_"+s,t.protoblock.staticLabels[s]);_blockMakeBitmap(i,a,t)},c=function(e,t){null!=t.disconnectedBitmap&&t.container.removeChild(t.disconnectedBitmap),t.disconnectedBitmap=e,t.container.addChild(t.disconnectedBitmap),t.disconnectedBitmap.x=0,t.disconnectedBitmap.y=0,t.disconnectedBitmap.name="bmp_disconnect_"+l,t.activity.logo.runningLilypond||(t.disconnectedBitmap.cursor="pointer"),t.disconnectedBitmap.visible=!1;for(var i=(t.protoblock.disabled?t.artwork.replace(/fill_color/g,DISABLEDFILLCOLOR).replace(/stroke_color/g,DISABLEDSTROKECOLOR):t.artwork.replace(/fill_color/g,platformColor.paletteColors[t.protoblock.palette.name][3]).replace(/stroke_color/g,HIGHLIGHTSTROKECOLORS[t.protoblock.palette.name])).replace("block_label",safeSVG(o)),s=1;s<t.protoblock.staticLabels.length;s++)i=i.replace("arg_label_"+s,t.protoblock.staticLabels[s]);_blockMakeBitmap(i,n,t)};for(this.overrideName&&"outputtools"!==this.name?["namedbox","storein2","nameddo","nameddoArg","namedcalc","namedcalcArg"].includes(this.name)?(o=this.overrideName,getTextWidth(o,"bold 20pt Sans")>TEXTWIDTH&&(o=o.substr(0,STRINGLEN)+"...")):o=this.overrideName:0<this.protoblock.staticLabels.length&&!this.protoblock.image&&(o=SPECIALINPUTS.includes(this.name)?"":this.protoblock.staticLabels[0]);this.protoblock.staticLabels.length<this.protoblock.args+1;)this.protoblock.staticLabels.push("");if(i){this.protoblock.scale=this.blocks.blockScale;var e=this.protoblock.generator();this.artwork=e[0];for(var t=0;t<e[1].length;t++)this.docks.push([e[1][t][0],e[1][t][1],this.protoblock.dockTypes[t]]);this.width=e[2],this.height=e[3],this.hitHeight=e[4]}for(var s=(this.protoblock.disabled?this.artwork.replace(/fill_color/g,DISABLEDFILLCOLOR).replace(/stroke_color/g,DISABLEDSTROKECOLOR):this.artwork.replace(/fill_color/g,PALETTEFILLCOLORS[this.protoblock.palette.name]).replace(/stroke_color/g,PALETTESTROKECOLORS[this.protoblock.palette.name])).replace("block_label",safeSVG(o)),h=1;h<this.protoblock.staticLabels.length;h++)s=s.replace("arg_label_"+h,this.protoblock.staticLabels[h]);this.blocks.blockArt[this.blocks.blockList.indexOf(this)]=s,_blockMakeBitmap(s,function(e,t){null!=t.bitmap&&t.container.removeChild(t.bitmap),t.bitmap=e,t.container.addChild(t.bitmap),t.bitmap.x=0,t.bitmap.y=0,t.bitmap.name="bmp_"+l,t.bitmap.cursor="pointer",t.activity.refreshCanvas();for(var i=(t.protoblock.disabled?t.artwork.replace(/fill_color/g,DISABLEDFILLCOLOR).replace(/stroke_color/g,DISABLEDSTROKECOLOR):t.artwork.replace(/fill_color/g,platformColor.disconnected).replace(/stroke_color/g,HIGHLIGHTSTROKECOLORS[t.protoblock.palette.name])).replace("block_label",safeSVG(o)),s=1;s<t.protoblock.staticLabels.length;s++)i=i.replace("arg_label_"+s,t.protoblock.staticLabels[s]);_blockMakeBitmap(i,c,t)},this)}},{key:"_finishImageLoad",value:function(){var e,t,i,s;if(SPECIALINPUTS.includes(this.name)){if(null==this.value)switch(this.name){case"text":this.value="---";break;case"solfege":case"eastindiansolfege":this.value="sol";break;case"scaledegree2":this.value="5";break;case"customNote":this.value=this.activity.logo.synth.startingPitch.substring(0,this.activity.logo.synth.startingPitch.length-1)+"(+0)";break;case"notename":this.value="G";break;case"rest":this.value="rest";break;case"boolean":this.value=!0;break;case"number":this.value=NUMBERBLOCKDEFAULT;break;case"modename":this.value=DEFAULTMODE;break;case"chordname":this.value=DEFAULTCHORD;break;case"accidentalname":this.value=DEFAULTACCIDENTAL;break;case"intervalname":this.value=DEFAULTINTERVAL;break;case"invertmode":this.value=DEFAULTINVERT;break;case"voicename":this.value=DEFAULTVOICE;break;case"noisename":this.value=DEFAULTNOISE;break;case"drumname":this.value=DEFAULTDRUM;break;case"effectsname":this.value=DEFAULTEFFECT;break;case"filtertype":this.value=DEFAULTFILTERTYPE;break;case"oscillatortype":this.value=DEFAULTOSCILLATORTYPE;break;case"temperamentname":this.value="equal";break;case"grid":this.value="Cartesian";break;case"wrapmode":this.value="on"}"solfege"===this.name?(t=splitSolfege(this.value),i=i18nSolfege(t[0]),"♮"!==(s=t[1])&&(i+=s)):"eastindiansolfege"===this.name?(t=splitSolfege(this.value),i=WESTERN2EISOLFEGENAMES[t[0]],"♮"!==(s=t[1])&&(i+=s)):"scaledegree2"===this.name?(i=(t=splitScaleDegree(this.value))[0],"♮"!==(s=t[1])&&(i+=s)):i="drumname"===this.name?getDrumName(this.value):"noisename"===this.name?getNoiseName(this.value):"outputtools"===this.name?this.overrideName:"grid"===this.name?_(this.value):null!==this.value?this.value.toString():"???",!WIDENAMES.includes(this.name)&&getTextWidth(i,"bold 20pt Sans")>TEXTWIDTH&&(i=i.substr(0,STRINGLEN)+"..."),this.text.text=i,this.container.addChild(this.text),this._positionText(this.protoblock.scale)}else this.protoblock.parameter&&(this.container.addChild(this.text),this._positionText(this.protoblock.scale));this.isCollapsible()?(this.isInlineCollapsible()?((e=new ProtoBlock("collapse-note")).scale=this.protoblock.scale,"interval"===this.name?e.extraWidth=80:e.extraWidth=50,e.zeroArgBlock()):((e=new ProtoBlock("collapse")).scale=this.protoblock.scale,e.extraWidth=50,e.basicBlockCollapsed()),t=e.generator(),this.collapseArtwork=t[0],this.isCollapsible()&&this._generateCollapseArtwork(function(e){e.loadComplete=!0,null!==e.postProcess&&(e.postProcess(e.postProcessArg),e.postProcess=null)})):(this.loadComplete=!0,null!==this.postProcess&&(this.postProcess(this.postProcessArg),this.postProcess=null),this.blocks.cleanupAfterLoad(this.name)),this.activity.refreshCanvas()}},{key:"_generateCollapseArtwork",value:function(t){var s=this.blocks.blockList.indexOf(this),i=function(e){null!==t&&t(e),e.activity.refreshCanvas(),e.blocks.cleanupAfterLoad(e.name),e.trash&&(e.collapseText.visible=!1,e.collapseButtonBitmap.visible=!1,e.expandButtonBitmap.visible=!1)},l=function(e){var t=new Image;t.onload=function(){e.collapseButtonBitmap=new createjs.Bitmap(t),e.collapseButtonBitmap.scaleX=e.collapseButtonBitmap.scaleY=e.collapseButtonBitmap.scale=e.protoblock.scale/3,e.container.addChild(e.collapseButtonBitmap),e.collapseButtonBitmap.x=2*e.protoblock.scale,e.isInlineCollapsible()?e.collapseButtonBitmap.y=4*e.protoblock.scale:e.collapseButtonBitmap.y=10*e.protoblock.scale,e.collapseButtonBitmap.visible=!e.collapsed,i(e)},t.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(COLLAPSEBUTTON))},o=function(e){var t=new Image;t.onload=function(){e.expandButtonBitmap=new createjs.Bitmap(t),e.expandButtonBitmap.scaleX=e.expandButtonBitmap.scaleY=e.expandButtonBitmap.scale=e.protoblock.scale/3,e.container.addChild(e.expandButtonBitmap),e.expandButtonBitmap.visible=e.collapsed,e.expandButtonBitmap.x=2*e.protoblock.scale,e.isInlineCollapsible()?e.expandButtonBitmap.y=4*e.protoblock.scale:e.expandButtonBitmap.y=10*e.protoblock.scale,l(e)},t.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(EXPANDBUTTON))},a=function(e,t){if(t.highlightCollapseBlockBitmap=e,t.highlightCollapseBlockBitmap.name="highlight_collapse_"+s,t.container.addChild(t.highlightCollapseBlockBitmap),t.highlightCollapseBlockBitmap.visible=!1,null===t.collapseText){var i=10*t.protoblock.scale;switch(t.name){case"action":t.collapseText=new createjs.Text(_("action"),i+"px Sans",platformColor.blockText);break;case"temperament1":t.collapseText=new createjs.Text(_("temperament"),i+"px Sans",platformColor.blockText);break;case"start":t.collapseText=new createjs.Text(_("start"),i+"px Sans",platformColor.blockText);break;case"matrix":t.collapseText=new createjs.Text(_("matrix"),i+"px Sans",platformColor.blockText);break;case"status":t.collapseText=new createjs.Text(_("status"),i+"px Sans",platformColor.blockText);break;case"pitchdrummatrix":t.collapseText=new createjs.Text(_("drum mapper"),i+"px Sans",platformColor.blockText);break;case"rhythmruler":t.collapseText=new createjs.Text(_("ruler"),i+"px Sans",platformColor.blockText);break;case"timbre":t.collapseText=new createjs.Text(_("timbre"),i+"px Sans",platformColor.blockText);break;case"pitchstaircase":t.collapseText=new createjs.Text(_("stair"),i+"px Sans",platformColor.blockText);break;case"tempo":t.collapseText=new createjs.Text(_("tempo"),i+"px Sans",platformColor.blockText);break;case"modewidget":t.collapseText=new createjs.Text(_("mode"),i+"px Sans",platformColor.blockText);break;case"pitchslider":t.collapseText=new createjs.Text(_("slider"),i+"px Sans",platformColor.blockText);break;case"musickeyboard":t.collapseText=new createjs.Text(_("keyboard"),i+"px Sans",platformColor.blockText);break;case"drum":t.collapseText=new createjs.Text(_("drum"),i+"px Sans",platformColor.blockText);break;case"rhythmruler2":t.collapseText=new createjs.Text(_("rhythm maker"),i+"px Sans",platformColor.blockText);break;case"newnote":t.collapseText=new createjs.Text(_("note value"),i+"px Sans",platformColor.blockText);break;case"interval":t.collapseText=new createjs.Text(_("scalar interval"),i+"px Sans",platformColor.blockText);break;case"osctime":t.collapseText=new createjs.Text(_("milliseconds"),i+"px Sans",platformColor.blockText);break;case"temperament":t.collapseText=new createjs.Text(_("temperament"),i+"px Sans",platformColor.blockText);break;case"definemode":t.collapseText=new createjs.Text(_("mode"),i+"px Sans",platformColor.blockText);break;default:t.collapseText=new createjs.Text("foobar",i+"px Sans",platformColor.blockText)}t.collapseText.textAlign="left",t.collapseText.textBaseline="alphabetic",t.container.addChild(t.collapseText)}t._positionCollapseLabel(t.protoblock.scale),t.collapseText.visible=t.collapsed,t._ensureDecorationOnTop(),t.blocks.blockCollapseArt[t.blocks.blockList.indexOf(t)]=t.collapseArtwork.replace(/fill_color/g,PALETTEFILLCOLORS[t.protoblock.palette.name]).replace(/stroke_color/g,PALETTESTROKECOLORS[t.protoblock.palette.name]).replace("block_label",safeSVG(t.collapseText.text)),o(t)},e=this.collapseArtwork.replace(/fill_color/g,PALETTEFILLCOLORS[this.protoblock.palette.name]).replace(/stroke_color/g,PALETTESTROKECOLORS[this.protoblock.palette.name]).replace("block_label","");_blockMakeBitmap(e,function(e,t){t.collapseBlockBitmap=e,t.collapseBlockBitmap.name="collapse_"+s,t.container.addChild(t.collapseBlockBitmap),t.collapseBlockBitmap.visible=t.collapsed,t.activity.refreshCanvas();e=t.collapseArtwork;_blockMakeBitmap(e.replace(/fill_color/g,PALETTEHIGHLIGHTCOLORS[t.protoblock.palette.name]).replace(/stroke_color/g,HIGHLIGHTSTROKECOLORS[t.protoblock.palette.name]).replace("block_label",""),a,t)},this)}},{key:"hide",value:function(){this.container.visible=!1,this.isCollapsible()&&(null!==this.collapseText&&(this.collapseText.visible=!1),null!==this.expandButtonBitmap&&(this.expandButtonBitmap.visible=!1),null!==this.collapseButtonBitmap)&&(this.collapseButtonBitmap.visible=!1),this.updateCache(),this.activity.refreshCanvas()}},{key:"isDisconnected",value:function(){return null!==this.disconnectedBitmap&&null===this.connections[0]&&!(COLLAPSIBLES.includes(this.name)&&!INLINECOLLAPSIBLES.includes(this.name)||!this.isArgBlock()&&null!==last(this.connections)&&("hidden"!==this.blocks.blockList[last(this.connections)].name||null!==last(this.blocks.blockList[last(this.connections)].connections)))}},{key:"show",value:function(){this.trash||this.inCollapsed||(this.container.visible=!0,this.isCollapsible()?this.collapsed?(this.bitmap.visible=!1,this.highlightBitmap.visible=!1,this.collapseBlockBitmap.visible=!0,this.highlightCollapseBlockBitmap.visible=!1,this.collapseText.visible=!0,this.expandButtonBitmap.visible=!0,this.collapseButtonBitmap.visible=!1,null!==this.disconnectedBitmap&&(this.disconnectedBitmap.visible=!1),null!==this.disconnectedHighlightBitmap&&(this.disconnectedHighlightBitmap.visible=!1)):(this.isDisconnected()?(this.disconnectedBitmap.visible=!0,this.bitmap.visible=!1):(null!==this.disconnectedBitmap&&(this.disconnectedBitmap.visible=!1),this.bitmap.visible=!0),this.highlightBitmap.visible=!1,null!==this.disconnectedHighlightBitmap&&(this.disconnectedHighlightBitmap.visible=!1),this.collapseBlockBitmap.visible=!1,this.highlightCollapseBlockBitmap.visible=!1,this.collapseText.visible=!1,this.expandButtonBitmap.visible=!1,this.collapseButtonBitmap.visible=!0):(this.isDisconnected()?(this.disconnectedBitmap.visible=!0,this.bitmap.visible=!1):(null!==this.disconnectedBitmap&&(this.disconnectedBitmap.visible=!1),this.bitmap.visible=!0),this.highlightBitmap.visible=!1,null!==this.disconnectedHighlightBitmap&&(this.disconnectedHighlightBitmap.visible=!1)),this.updateCache(),this.activity.refreshCanvas())}},{key:"isValueBlock",value:function(){return"value"===this.protoblock.style}},{key:"isNoHitBlock",value:function(){return NOHIT.includes(this.name)}},{key:"isArgBlock",value:function(){return"value"===this.protoblock.style||"arg"===this.protoblock.style}},{key:"isTwoArgBlock",value:function(){return"twoarg"===this.protoblock.style}},{key:"isTwoArgBooleanBlock",value:function(){return["equal","greater","less"].includes(this.name)}},{key:"isClampBlock",value:function(){return"clamp"===this.protoblock.style||this.isDoubleClampBlock()||this.isArgFlowClampBlock()}},{key:"isArgFlowClampBlock",value:function(){return"argflowclamp"===this.protoblock.style}},{key:"isLeftClampBlock",value:function(){return this.protoblock.isLeftClamp}},{key:"isDoubleClampBlock",value:function(){return"doubleclamp"===this.protoblock.style}},{key:"isNoRunBlock",value:function(){return"action"===this.name}},{key:"isArgClamp",value:function(){return"argclamp"===this.protoblock.style||"argclamparg"===this.protoblock.style}},{key:"isExpandableBlock",value:function(){return this.protoblock.expandable}},{key:"getBlockId",value:function(){return"_"+blockBlocks.blockList.indexOf(this).toString()}},{key:"removeChildBitmap",value:function(e){for(var t=0;t<this.container.children.length;t++)if(this.container.children[t].name===e){this.container.removeChild(this.container.children[t]);break}}},{key:"loadThumbnail",value:function(e){var s,t=this.blocks.blockList.indexOf(this),l=this;null===this.blocks.blockList[t].value&&null===e||((s=new Image).onload=function(){l.removeChildBitmap("media");var e=new createjs.Bitmap(s),t=(e.name="media",new createjs.Container),i=(t.addChild(e),s.width>s.height?600<s.width&&(e.scaleX=e.scaleY=e.scale=600/s.width):450<s.height&&(e.scaleX=e.scaleY=e.scale=450/s.height),s.src||"");i.startsWith("data:image/gif")?l.value=i:(i=t.getBounds(),t.cache(i.x,i.y,i.width,i.height),l.value=t.bitmapCache.getCacheDataURL()),l.imageBitmap=e,l._positionMedia(e,e.image.width,e.image.height,l.protoblock.scale),l.container.addChild(e),l.updateCache()},s.src=null===e?this.value:e)}},{key:"_doOpenMedia",value:function(t){var i=this,s="media"==i.name?docById("myMedia"):docById("audio"),l=function(){window.scroll(0,0);var e=new FileReader;e.onloadend=function(){e.result&&("media"===i.name?(i.value=e.result,i.loadThumbnail(null)):(i.value=[s.files[0].name,e.result],i.blocks.updateBlockText(t)),s.value="")},"media"===i.name||"audiofile"===i.name?e.readAsDataURL(s.files[0]):e.readAsText(s.files[0]),s.removeEventListener("change",l)};s.addEventListener("change",l,!1),s.focus(),s.click(),window.scroll(0,0)}},{key:"setCollapsedState",value:function(){this.inCollapsed=!0,this.hide()}},{key:"setUncollapsedState",value:function(e){null!==e&&this.blocks.blockList[e].collapsed||(this.inCollapsed=!1,this.show())}},{key:"collapseToggle",value:function(){var e=this.blocks.blockList.indexOf(this);if(this.blocks.findDragGroup(e),null!==this.collapseBlockBitmap){var t,i=this.collapsed;if(this.collapsed=!i,this.collapseButtonBitmap.visible=i,this.expandButtonBitmap.visible=!i,this.collapseBlockBitmap.visible=!i,this.highlightCollapseBlockBitmap.visible=!1,this.collapseText.visible=!i,this.isInlineCollapsible()&&this.collapseText.visible)switch(this.name){case"newnote":this._newNoteLabel();break;case"interval":this._intervalLabel();break;case"osctime":this._oscTimeLabel()}if(this.bitmap.visible=this.collapsed,this.highlightBitmap.visible=!1,null!==this.disconnectedBitmap&&(this.disconnectedBitmap.visible=!1),null!==this.disconnectedHighlightBitmap&&(this.disconnectedHighlightBitmap.visible=!1),"action"===this.name&&(null!==this.connections[1]?(t=this.blocks.blockList[this.connections[1]].value,getTextWidth(t,"bold 20pt Sans")>TEXTWIDTH&&(t=t.substr(0,STRINGLEN)+"..."),this.collapseText.text=t):this.collapseText.text=""),this.container.setChildIndex(this.collapseText,this.container.children.length-1),this.isInlineCollapsible())this._toggle_inline(e,i);else if(0<this.blocks.dragGroup.length)for(var s=1;s<this.blocks.dragGroup.length;s++){var l=this.blocks.dragGroup[s];this.collapsed?this.blocks.blockList[l].setCollapsedState():this.blocks.blockList[l].setUncollapsedState(this.blocks.insideInlineCollapsibleBlock(l))}this.unhighlight(),this.container.cacheID&&this.container.uncache(),this._createCache(function(e){e.activity.refreshCanvas()}),this.updateCache(),this.unhighlight(),this.activity.refreshCanvas()}}},{key:"_intervalLabel",value:function(){for(var e=DEGREES.split(" "),t={},i=0;i<e.length;i++)t[i]=e[i];for(var s=[],l=0,o=this.blocks.blockList.indexOf(this);null!==o;){var a=o,n=this.blocks.blockList[o].connections[1],n=this.blocks.blockList[n];if("number"===n.name?Math.abs(n.value)in t?n.value<0?s.push("-"+t[-n.value]):s.push("+"+t[n.value]):n.value<0?s.push("-"+n.value):s.push("+"+n.value):s.push(""),5<(l+=1))break;o=this.blocks.findNestedIntervalBlock(this.blocks.blockList[o].connections[2])}for(var c="",h=s.length;0<h;h--)c+=" "+s[h-1];var r,u,p="",b=this.blocks.findNoteBlock(a);null===b||(null!==(o=this.blocks.blockList[b].connections[1])&&"divide"===this.blocks.blockList[o].name&&(u=this.blocks.blockList[o].connections[1],r=this.blocks.blockList[o].connections[2],"number"===this.blocks.blockList[u].name)&&"number"===this.blocks.blockList[r].name&&(p=this.blocks.blockList[u].value+"/"+this.blocks.blockList[r].value,this.blocks.blockList[r].value in NSYMBOLS)&&(p+=NSYMBOLS[this.blocks.blockList[r].value]),o=this.blocks.findFirstPitchBlock(this.blocks.blockList[b].connections[2]),u=this._getPitch(o),null===o)||""===u?this.collapseText.text=_("scalar interval")+c:(o=this.blocks.findFirstPitchBlock(last(this.blocks.blockList[o].connections)),this.collapseText.text=null===o?u+" | "+p+c:u+"... | "+p+c)}},{key:"_newNoteLabel",value:function(){var e,t="",i=this.connections[1],s=null,l=(null!==i&&"divide"===this.blocks.blockList[i].name&&(l=this.blocks.blockList[i].connections[1],e=this.blocks.blockList[i].connections[2],"number"===this.blocks.blockList[l].name)&&"number"===this.blocks.blockList[e].name&&(t=this.blocks.blockList[l].value+"/"+this.blocks.blockList[e].value,(s=this.blocks.blockList[e].value)in NSYMBOLS)&&(t+=NSYMBOLS[s]),i=this.connections[2],i=this.blocks.findFirstPitchBlock(i),this._getPitch(i));null===i?(null!==s&&s in NSYMBOLS&&(t=t.replace(NSYMBOLS[s],RSYMBOLS[s])),this.collapseText.text=_("silence")+" | "+t):""===l&&""===t?this.collapseText.text=_("note value"):(l===_("silence")&&null!==s&&s in NSYMBOLS&&(t=t.replace(NSYMBOLS[s],RSYMBOLS[s])),i=this.blocks.findFirstPitchBlock(last(this.blocks.blockList[i].connections)),this.collapseText.text=null===i?l+" | "+t:l+"... | "+t)}},{key:"_oscTimeLabel",value:function(){var e,t,i="",s=this.connections[1],l=(null!==s&&"divide"===this.blocks.blockList[s].name&&(l=this.blocks.blockList[s].connections[1],t=this.blocks.blockList[s].connections[2],null!==l)&&null!==t&&"divide"===this.blocks.blockList[t].name&&(e=this.blocks.blockList[t].connections[1],t=this.blocks.blockList[t].connections[2],null!==e)&&null!==t&&"number"===this.blocks.blockList[e].name&&"number"===this.blocks.blockList[t].name&&(i=this.blocks.blockList[l].value/this.blocks.blockList[e].value*this.blocks.blockList[t].value),s=this.connections[2],s=this.blocks.findFirstPitchBlock(s),this._getPitch(s));null===s?this.collapseText.text=_("silence")+" | "+i:""===l&&""===i?this.collapseText.text=_("note value"):(s=this.blocks.findFirstPitchBlock(last(this.blocks.blockList[s].connections)),this.collapseText.text=""!==i?null===s?l+" | "+i.toFixed(0):l+"... | "+i.toFixed(0):l+"...")}},{key:"_getPitch",value:function(e){if(null===e)return"";var t;switch(this.blocks.blockList[e].name){case"pitch":if(l=this.blocks.blockList[e].connections[1],o=this.blocks.blockList[e].connections[2],"number"===this.blocks.blockList[o].name){if("solfege"===this.blocks.blockList[l].name)return t=_("ti la sol fa mi re do").split(" "),s=this.blocks.blockList[l].value.replace(SHARP,"").replace(FLAT,"").replace(DOUBLESHARP,"").replace(DOUBLEFLAT,""),-1===(i=["ti","la","sol","fa","mi","re","do"].indexOf(s))?s+" "+this.blocks.blockList[o].value:this.blocks.blockList[l].value.includes(SHARP)?t[i]+SHARP+" "+this.blocks.blockList[o].value:this.blocks.blockList[l].value.includes(FLAT)?t[i]+FLAT+" "+this.blocks.blockList[o].value:this.blocks.blockList[l].value.includes(DOUBLESHARP)?t[i]+DOUBLESHARP+" "+this.blocks.blockList[o].value:this.blocks.blockList[l].value.includes(DOUBLEFLAT)?t[i]+DOUBLEFLAT+" "+this.blocks.blockList[o].value:t[i]+" "+this.blocks.blockList[o].value;if("notename"===this.blocks.blockList[l].name)return this.blocks.blockList[l].value+" "+this.blocks.blockList[o].value;if("scaledegree2"===this.blocks.blockList[l].name)return t=(s=splitScaleDegree(this.blocks.blockList[l].value))[0],s[1]!==NATURAL&&(t+=s[1]),t+" "+this.blocks.blockList[o].value}break;case"nthmodalpitch":var i,s,l=this.blocks.blockList[e].connections[1],o=this.blocks.blockList[e].connections[2];if("number"===this.blocks.blockList[o].name)if("number"===this.blocks.blockList[l].name)return i=DEGREES.split(" "),0<(s=this.blocks.blockList[l].value-1)&&s<i.length?i[s]+" "+this.blocks.blockList[o].value:this.blocks.blockList[l].value+" "+this.blocks.blockList[o].value;break;case"hertz":if(l=this.blocks.blockList[e].connections[0],"number"===this.blocks.blockList[l].name)return this.blocks.blockList[l].value+"HZ";break;case"steppitch":return l=this.blocks.blockList[e].connections[1],"number"===this.blocks.blockList[l].name&&this.blocks.blockList[l].value<0?_("down")+" "+Math.abs(this.blocks.blockList[l].value):_("up")+" "+this.blocks.blockList[l].value;case"pitchnumber":if(l=this.blocks.blockList[e].connections[1],"number"===this.blocks.blockList[l].name)return _("pitch")+" "+this.blocks.blockList[l].value;break;case"playdrum":return _("drum");case"rest2":return _("silence");default:return""}}},{key:"_toggle_inline",value:function(e,t){if(null!==this.connections[1]){this.blocks.findDragGroup(this.connections[1]);for(var i=0;i<this.blocks.dragGroup.length;i++){var s=this.blocks.dragGroup[i];this.blocks.blockList[s].container.visible=t,this.blocks.blockList[s].inCollapsed=!t}}if(null!==this.connections[2]){this.blocks.findDragGroup(this.connections[2]);for(var l=0;l<this.blocks.dragGroup.length;l++){var o=this.blocks.dragGroup[l],a=this.blocks.insideInlineCollapsibleBlock(o);null!==a&&this.blocks.blockList[a].collapsed?(this.blocks.blockList[o].container.visible=!1,this.blocks.blockList[o].inCollapsed=!0):(this.blocks.blockList[o].container.visible=t,this.blocks.blockList[o].inCollapsed=!t)}}if(null!=this.connections[3]){var n=this.docks.length,c=t?this.blocks.blockList[e].docks[n-1][1]-this.blocks.blockList[e].docks[n-2][1]:this.blocks.blockList[e].docks[n-2][1]-this.blocks.blockList[e].docks[n-1][1];this.blocks.findDragGroup(this.connections[3]);for(var h=0;h<this.blocks.dragGroup.length;h++)this.blocks.moveBlockRelative(this.blocks.dragGroup[h],0,c);this.blocks.adjustDocks(e,!0)}n=[];this.blocks.findNestedClampBlocks(e,n),0<n.length&&(this.blocks.clampBlocksToCheck=n,this.blocks.adjustExpandableClampBlock()),this.activity.refreshCanvas()}},{key:"_positionText",value:function(e){this.text.textBaseline="alphabetic",this.text.textAlign="right";this.text.font=10*e+"px Sans",this.text.x=Math.floor(TEXTX*e/2+.5),this.text.y=Math.floor(TEXTY*e/2+.5),SPECIALINPUTS.includes(this.name)?(this.text.textAlign="center",this.text.x=Math.floor(VALUETEXTX*e/2+10),EXTRAWIDENAMES.includes(this.name)?this.text.x*=3:WIDENAMES.includes(this.name)?this.text.x=Math.floor(1.75*this.text.x+.5):"text"===this.name&&(this.text.x=Math.floor(this.width/2+.5))):"nameddo"===this.name?(this.text.textAlign="center",this.text.x=Math.floor(this.width/2+.5)):0===this.protoblock.args?this.text.x=Math.floor(this.width-25+.5):this.isCollapsible()?this.text.x+=Math.floor(15*e):(this.text.textAlign="left","booleanout"===this.docks[0][2]&&(this.text.y=Math.floor(this.docks[0][1]+.5)));e=this.container.children.length-1;this.container.setChildIndex(this.text,e),this.updateCache()}},{key:"_positionMedia",value:function(e,t,i,s){e.scaleX=e.scaleY=e.scale=i<t?MEDIASAFEAREA[2]/t*s/2:MEDIASAFEAREA[3]/i*s/2,e.x=(MEDIASAFEAREA[0]-10)*s/2,e.y=MEDIASAFEAREA[1]*s/2}},{key:"_positionCollapseLabel",value:function(e){this.isInlineCollapsible()?(this.collapseText.x=Math.floor((COLLAPSETEXTX+STANDARDBLOCKHEIGHT)*e/2+.5),this.collapseText.y=Math.floor((COLLAPSETEXTY-8)*e/2+.5)):(this.collapseText.x=Math.floor((COLLAPSETEXTX+30)*e/2+.5),this.collapseText.y=Math.floor(COLLAPSETEXTY*e/2+.5));e=this.container.children.length-1;this.container.setChildIndex(this.collapseText,e)}},{key:"_calculateBlockHitArea",value:function(){var e=new createjs.Shape;e.graphics.beginFill("platformColor.hitAreaGraphicsBeginFill").drawRect(0,0,this.width,this.hitHeight),this.container.hitArea=e}},{key:"_loadEventHandlers",value:function(){var h=this,r=this,u=this.blocks.blockList.indexOf(this),i=(this._calculateBlockHitArea(),this.container.on("mouseover",function(){_getStatic("contextWheelDiv").style.display="none",r.activity.logo.runningLilypond||(document.body.style.cursor="pointer"),r.blocks.selectionModeOn||r.blocks.highlight(u,!0),r.blocks.activeBlock=u}),!1),p=!1,s=!1,b=window.hasMouse;this.container.on("click",function(e){if(_getStatic("helpfulWheelDiv")&&"none"!==_getStatic("helpfulWheelDiv").style.display&&(_getStatic("helpfulWheelDiv").style.display="none"),"nativeEvent"in e){if("button"in e.nativeEvent&&2==e.nativeEvent.button)return r.blocks.stageClick=!0,_getStatic("wheelDiv").style.display="none",r.blocks.activeBlock=u,void piemenuBlockContext(r);if("ctrlKey"in e.nativeEvent&&e.nativeEvent.ctrlKey)return r.blocks.activeBlock=u,void piemenuBlockContext(r);if("shiftKey"in e.nativeEvent&&e.nativeEvent.shiftKey)return void(r.activity.turtles.running()?(r.activity.logo.doStopTurtles(),setTimeout(function(){r.activity.logo.runLogoCommands(topBlock)},250)):r.activity.logo.runLogoCommands(topBlock))}var t;r.blocks.getLongPressStatus()||(r.blocks.activeBlock=u,i=!0,s)||(s=!0,setTimeout(function(){s=!1},500),hideDOMLabel(),r._checkWidgets(!1),e=e.stageX/r.activity.getStageScale()-r.container.x,!p&&r.isCollapsible()&&e<30/r.activity.getStageScale()?r.collapseToggle():!window.hasMouse&&b||window.hasMouse&&!p?["media","audiofile","loadFile"].includes(r.name)?r._doOpenMedia(u):SPECIALINPUTS.includes(r.name)?r.trash||(r._triggerLongPress?r._triggerLongPress=!1:r._changeLabel()):r.blocks.getLongPressStatus()||r.blocks.stageClick||(t=r.blocks.findTopBlock(u),r.activity.runMode="normal",r.activity.logo.synth.resume(),r.activity.turtles.running()?(r.activity.logo.doStopTurtles(),setTimeout(function(){r.activity.logo.runLogoCommands(t)},250)):r.activity.logo.runLogoCommands(t)):p||r.blocks.getLongPressStatus()||r.blocks.stageClick||(t=r.blocks.findTopBlock(u),r.activity.runMode="normal",r.activity.logo.synth.resume(),r.activity.turtles.running()?(r.activity.logo.doStopTurtles(),setTimeout(function(){r.activity.logo.runLogoCommands(t)},250)):r.activity.logo.runLogoCommands(t)))}),this.container.on("mousedown",function(e){if(docById("contextWheelDiv").style.display="none",r.blocks.mouseDownTime=(new Date).getTime(),r.blocks.longPressTimeout=setTimeout(function(){r.blocks.activeBlock=r.blocks.blockList.indexOf(r),r._triggerLongPress=!0,r.blocks.triggerLongPress()},LONGPRESSTIME),h.collapseButtonBitmap&&h.expandButtonBitmap){var t=h.container.globalToLocal(e.stageX,e.stageY);if(h.collapseButtonBitmap.getBounds().contains(t.x,t.y)||h.expandButtonBitmap.getBounds().contains(t.x,t.y))return void r.activity.trashcan.hide()}r.activity.trashcan.show(),r.blocks.raiseStackToTop(u),null!=r.collapseContainer&&r.activity.blocksContainer.setChildIndex(r.collapseContainer,r.activity.blocksContainer.children.length-1),p=!1,r.original={x:e.stageX/r.activity.getStageScale(),y:e.stageY/r.activity.getStageScale()},r.offset={x:Math.round(r.container.x-r.original.x),y:Math.round(r.container.y-r.original.y)}}),this.container.on("pressmove",function(e){if(e.nativeEvent.preventDefault(),"rest2"!==r.name&&("vspace"!==(null==r?void 0:r.name)||"rest2"!==(null==(s=r.blocks.blockList[r.connections[1]])?void 0:s.name))){for(var t,i=r.blocks.blockList[r.connections[1]];null!=i;){if("rest2"===(null==(t=i)?void 0:t.name))return void h.activity.errorMsg(_("Silence block cannot be removed."),i);i=null==(t=i)?void 0:t.blocks.blockList[i.connections[1]]}window.hasMouse?p=!0:setTimeout(function(){p=20<Math.abs(e.stageX/r.activity.getStageScale()-r.original.x)+Math.abs(e.stageY/r.activity.getStageScale()-r.original.y)&&!window.hasMouse,b=!p},200);var s=r.container.x,l=r.container.y,o=Math.round(e.stageX/r.activity.getStageScale()+r.offset.x-s),a=Math.round(e.stageY/r.activity.getStageScale()+r.offset.y-l),s=l+a;if(0===r.activity.blocksContainer.y&&s<45&&(a+=45-s),e.stageX<10&&r.activity.scrollBlockContainer?r.blocks.moveAllBlocksExcept(r,10,0):e.stageX>window.innerWidth-10&&r.activity.scrollBlockContainer?r.blocks.moveAllBlocksExcept(r,-10,0):e.stageY>window.innerHeight-10?r.blocks.moveAllBlocksExcept(r,0,-10):e.stageY<60&&r.blocks.moveAllBlocksExcept(r,0,10),null!=r.blocks.longPressTimeout&&(clearTimeout(r.blocks.longPressTimeout),r.blocks.longPressTimeout=null,r.blocks.clearLongPress()),p||null==r.label||(r.label.style.display="none"),r.blocks.moveBlockRelative(u,o,a),r.activity.trashcan.overTrashcan(e.stageX/r.activity.getStageScale(),e.stageY/r.activity.getStageScale())?r.activity.trashcan.startHighlightAnimation():r.activity.trashcan.stopHighlightAnimation(),r.isValueBlock()&&"media"!==r.name&&r.container.setChildIndex(r.text,r.container.children.length-1),r.blocks.findDragGroup(u),0<r.blocks.dragGroup.length)for(var n=0;n<r.blocks.dragGroup.length;n++){var c=r.blocks.dragGroup[n];0!==n&&r.blocks.moveBlockRelative(c,o,a)}r.activity.refreshCanvas()}}),this.container.on("mouseout",function(e){r.blocks.getLongPressStatus()?(clearTimeout(r.blocks.longPressTimeout),r.blocks.longPressTimeout=null,r.blocks.clearLongPress()):r._mouseoutCallback(e,p,i,!1),r.blocks.selectionModeOn||r.blocks.unhighlight(u,!0),r.blocks.activeBlock=null,p=!1}),this.container.on("pressup",function(e){r.blocks.getLongPressStatus()?(clearTimeout(r.blocks.longPressTimeout),r.blocks.longPressTimeout=null,r.blocks.clearLongPress()):r._mouseoutCallback(e,p,i,!1),r.blocks.unhighlight(u,!0),r.blocks.activeBlock=null,p=!1})}},{key:"_mouseoutCallback",value:function(e,t,i,s){var l=this.blocks.blockList.indexOf(this);this.activity.logo.runningLilypond||(document.body.style.cursor="default"),t||this.activity.trashcan.hide(),null!=this.blocks.longPressTimeout&&(clearTimeout(this.blocks.longPressTimeout),this.blocks.longPressTimeout=null,this.blocks.clearLongPress()),t?this.activity.trashcan.overTrashcan(e.stageX/this.activity.getStageScale(),e.stageY/this.activity.getStageScale())?this.activity.trashcan.isVisible&&(this.blocks.sendStackToTrash(this),this.activity.textMsg(_("You can restore deleted blocks from the trash with the Restore From Trash button."),3e3)):(this.blocks.mouseDownTime=(new Date).getTime(),this.blocks.blockMoved(l),this.blocks.adjustDocks(this.blocks.blockList.indexOf(this),!0)):!SPECIALINPUTS.includes(this.name)&&!["media","loadFile"].includes(this.name)||i||(new Date).getTime()-this.blocks.mouseDownTime<500&&(this.trash||(this.blocks.mouseDownTime=(new Date).getTime(),"media"===this.name||"loadFile"===this.name?this._doOpenMedia(l):this._changeLabel())),s&&((e.stageX/this.activity.getStageScale()<this.container.x||e.stageX/this.activity.getStageScale()>this.container.x+this.width||e.stageY<this.container.y||e.stageY>this.container.y+this.hitHeight)&&(this._usePiemenu()||(this._labelChanged(!0,!0),hideDOMLabel(),this._checkWidgets(!1)),this.blocks.unhighlight(null),this.activity.refreshCanvas()),this.blocks.activeBlock=null)}},{key:"_usePiemenu",value:function(){var e;return this._check_meter_block=null,!!PIEMENUS.includes(this.name)||(e=this.blocks.blockList.indexOf(this),!!this.blocks.octaveNumber(e))||!!(this.blocks.noteValueNumber(e,2)||this.blocks.noteValueNumber(e,1)||this.blocks.octaveModifierNumber(e)||this.blocks.intervalModifierNumber(e)||this._usePieNumberC3()||this._usePieNumberC2()||this._usePieNumberC1())}},{key:"_usePieNumberC1",value:function(){var e=this.connections[0];return null!==e&&0!==this.blocks.blockList[this.connections[0]].protoblock.piemenuValuesC1.length&&this.blocks.blockList[e].connections[1]===this.blocks.blockList.indexOf(this)}},{key:"_usePieNumberC2",value:function(){var e=this.connections[0];return null!==e&&0!==this.blocks.blockList[this.connections[0]].protoblock.piemenuValuesC2.length&&this.blocks.blockList[e].connections[2]===this.blocks.blockList.indexOf(this)}},{key:"_usePieNumberC3",value:function(){var e=this.connections[0];return null!==e&&0!==this.blocks.blockList[this.connections[0]].protoblock.piemenuValuesC3.length&&this.blocks.blockList[e].connections[3]===this.blocks.blockList.indexOf(this)}},{key:"_ensureDecorationOnTop",value:function(){for(var e=0;e<this.container.children.length;e++)if("decoration"===this.container.children[e].name){var t=0;"drum"===this.name&&this.collapsed&&(t=25*this.protoblock.scale/2);for(var i=0;i<this.activity.turtles.getTurtleCount();i++)if(this.activity.turtles.getTurtle(i).startBlock===this){this.activity.turtles.getTurtle(i).decorationBitmap.x=this.width-t-30*this.protoblock.scale/2;break}this.container.setChildIndex(this.container.children[e],this.container.children.length-1);break}this.container.setChildIndex(this.bitmap,0),this.container.setChildIndex(this.highlightBitmap,0),null!==this.disconnectedBitmap&&this.container.setChildIndex(this.disconnectedBitmap,0),this.updateCache()}},{key:"_changeLabel",value:function(){function R(e){var t={"<":"lt",">":"gt",'"':"quot","'":"apos","&":"amp","\r":"#10","\n":"#13"};return e.toString().replace(/[<>"'\r\n&]/g,function(e){return"&"+t[e]+";"})}var H,e,t,i,s,l,o=this,F=this.container.x,a=this.container.y,U=this.activity.canvas.offsetLeft+28*this.blocks.blockScale,G=this.activity.canvas.offsetTop+6*this.blocks.blockScale,j=!1,n=(!window.hasMouse&&75<this.activity.blocksContainer.y+a&&(j=!0,H=this.activity.blocksContainer.y,this.activity.blocksContainer.y=75-a),e=(null!=this.label?this.label:this).value,_getStatic("labelDiv"));if("text"===this.name){var c=document.createElement("input"),c=(c.id="textLabel",c.style.position="absolute",c.style.webkitUserSelect="text",c.style.mozUserSelect="text",c.style.msUserSelect="text",c.className="text",c.type="text",n.innerHTML="",n.appendChild(c),this.label=c,this.label.value=R(e),this.label.style.display="",n.classList.add("hasKeyboard"),this.label.value.length);this.label.setSelectionRange(c,c)}else if("solfege"===this.name){var h=splitSolfege(this.value),c=_("ti la sol fa mi re do").split(" ");this.piemenuOKtoLaunch()&&piemenuPitches(this,c,SOLFNOTES,SOLFATTRS,h[0],h[1])}else if("scaledegree2"===this.name){h=splitScaleDegree(this.value);c="7 6 5 4 3 2 1".split(" ");this.piemenuOKtoLaunch()&&piemenuPitches(this,c,SCALENOTES,SOLFATTRS,h[0],h[1])}else if("customNote"===this.name)if(this.activity.logo.customTemperamentDefined){for(var r=getTemperamentKeys(),V={},u=[],p=0;p<r.length;p++)V[r[p]]=getTemperament(r[p]),isCustomTemperament(r[p])&&u.push(r[p]);c=null!==this.customID?this.customID:u[0],C=null!==this.value?this.value:getTemperament(c)[0][1],piemenuCustomNotes(this,V,u,c,C)}else{h=splitSolfege(this.value);c=_("ti la sol fa mi re do").split(" ");this.piemenuOKtoLaunch()&&piemenuPitches(this,c,SOLFNOTES,SOLFATTRS,h[0],h[1])}else if("eastindiansolfege"===this.name)C=(h=splitSolfege(this.value))[0],E=h[1],this.piemenuOKtoLaunch()&&piemenuPitches(this,EASTINDIANSOLFNOTES,SOLFNOTES,SOLFATTRS,h[0],h[1]);else if("notename"===this.name){c=["B","A","G","F","E","D","C"];""===(E=null!=this.value?(C=this.value[0],1===this.value.length?"♮":2===this.value.length?this.value[1]:this.value[1]+this.value[2]):(C="G","♮"))&&(E="♮"),this.piemenuOKtoLaunch()&&piemenuPitches(this,c,c,SOLFATTRS,C,E)}else if("modename"===this.name)h=null!=this.value?this.value:DEFAULTMODE,piemenuModes(this,h);else if("chordname"===this.name)c=null!=this.value?this.value:DEFAULTCHORD,piemenuChords(this,c);else if("accidentalname"===this.name)C=null!=this.value?this.value:DEFAULTACCIDENTAL,this.piemenuOKtoLaunch()&&piemenuAccidentals(this,ACCIDENTALLABELS,ACCIDENTALNAMES,C);else if("intervalname"===this.name)E=null!=this.value?this.value:DEFAULTINTERVAL,this.piemenuOKtoLaunch()&&piemenuIntervals(this,E);else if("invertmode"===this.name){for(var h=null!=this.value?this.value:DEFAULTINVERT,W=[],Y=[],b=0;b<INVERTMODES.length;b++)W.push(_(INVERTMODES[b][1])),Y.push(INVERTMODES[b][1]);this.piemenuOKtoLaunch()&&piemenuBasic(this,W,Y,h)}else if("drumname"===this.name){for(var m,k=null!=this.value?this.value:DEFAULTDRUM,d=[],X=[],K=[],z=[],v=0;v<DRUMNAMES.length;v++)EFFECTSNAMES.includes(DRUMNAMES[v][1])||(m=_(DRUMNAMES[v][1]),400<getTextWidth(m,"bold 30pt Sans")?d.push(m.substr(0,8)+"..."):d.push(m),X.push(DRUMNAMES[v][1]),z.includes(DRUMNAMES[v][4])||z.push(DRUMNAMES[v][4]),K.push(z.indexOf(DRUMNAMES[v][4])));piemenuVoices(this,d,X,K,k)}else if("effectsname"===this.name){null!=this.value?k=this.value:N=DEFAULTEFFECT;for(var g,q=[],Z=[],$=[],J=[],f=0;f<DRUMNAMES.length;f++)EFFECTSNAMES.includes(DRUMNAMES[f][1])&&(g=_(DRUMNAMES[f][1]),400<getTextWidth(g,"Bold 30pt Sans")?q.push(g.substr(0,8)+"..."):q.push(g),Z.push(DRUMNAMES[f][1]),J.includes(DRUMNAMES[f][4])||J.push(DRUMNAMES[f][4]),$.push(J.indexOf(DRUMNAMES[f][4])));piemenuVoices(this,q,Z,$,N)}else if("filtertype"===this.name){for(var L=null!=this.value?this.value:DEFAULTFILTERTYPE,Q=[],ee=[],B=0;B<FILTERTYPES.length;B++)Q.push(_(FILTERTYPES[B][0])),ee.push(FILTERTYPES[B][1]);piemenuBasic(this,Q,ee,L,platformColor.piemenuBasic)}else if("oscillatortype"===this.name){L=null!=this.value?this.value:DEFAULTOSCILLATORTYPE;for(var te=[],ie=[],T=0;T<OSCTYPES.length;T++)te.push(_(OSCTYPES[T][1])),ie.push(OSCTYPES[T][1]);piemenuBasic(this,te,ie,L,platformColor.piemenuBasic)}else if("voicename"===this.name){for(var y,c=null!=this.value?this.value:DEFAULTVOICE,se=[],le=[],oe=[],ae=[],x=0;x<VOICENAMES.length;x++)this.activity.beginnerMode&&"custom"===VOICENAMES[x][1]||(y=_(VOICENAMES[x][1]),400<getTextWidth(y,"bold 30pt Sans")?se.push(y.substr(0,8)+"..."):se.push(y),le.push(VOICENAMES[x][1]),ae.includes(VOICENAMES[x][3])||ae.push(VOICENAMES[x][3]),oe.push(ae.indexOf(VOICENAMES[x][3])));piemenuVoices(this,se,le,oe,c)}else if("noisename"===this.name){for(var C=null!=this.value?this.value:DEFAULTNOISE,ne=[],ce=[],he=[],re=[],S=0;S<NOISENAMES.length;S++){var ue=NOISENAMES[S][0];600<getTextWidth(ue,"bold 30pt Sans")?ne.push(ue.substr(0,16)+"..."):ne.push(ue),ce.push(NOISENAMES[S][1]),re.includes(NOISENAMES[S][3])||re.push(NOISENAMES[S][3]),he.push(re.indexOf(NOISENAMES[S][3]))}piemenuVoices(this,ne,ce,he,C,90)}else if("temperamentname"===this.name){for(var E=null!=this.value?this.value:DEFAULTTEMPERAMENT,pe=[],be=[],A=getTemperamentsList(),w=0;w<A.length;w++)this.activity.beginnerMode&&"custom"===A[w][1]||(0===A[w][0].length?pe.push(A[w][2]):pe.push(A[w][0]),be.push(A[w][1]));piemenuBasic(this,pe,be,E,platformColor.piemenuBasic)}else if("boolean"===this.name){var O=null==this.value||this.value,h=[_("true"),_("false")];piemenuBoolean(this,h,[!0,!1],O)}else if("grid"===this.name){O=this.value;var k=[],N=[],N=_THIS_IS_TURTLE_BLOCKS_?(k=[_("Cartesian"),_("polar"),_("Cartesian/Polar"),_("none")],["Cartesian","polar","Cartesian/Polar","none"]):(k=[_("Cartesian"),_("polar"),_("Cartesian/Polar"),_("treble"),_("grand staff"),_("mezzo-soprano"),_("alto"),_("tenor"),_("bass"),_("none")],["Cartesian","polar","Cartesian/Polar","treble","grand staff","mezzo-soprano","alto","tenor","bass","none"]);piemenuBasic(this,k,N,O,platformColor.piemenuBasic)}else if("outputtools"===this.name)O=this.privateData,L=this.activity.beginnerMode?(l=this.protoblock.extraSearchTerms.slice(0,6),this.protoblock.iemenuLabels.slice(0,6)):(l=this.protoblock.extraSearchTerms,this.protoblock.piemenuLabels),l.includes(O)||(O=l[3]),piemenuBasic(this,L,l,O,platformColor.piemenuBasic);else if("wrapmode"===this.name){for(var c=null!=this.value?this.value:"on",me=[],ke=[],de=[[_("on2"),"on"],[_("off"),"off"]],D=0;D<de.length;D++)me.push(_(de[D][1])),ke.push(de[D][1]);piemenuBasic(this,me,ke,c)}else{C=this.blocks.blockList.indexOf(this);if(this.blocks.octaveNumber(C))piemenuNumber(this,[8,7,6,5,4,3,2,1],this.value);else if(this.blocks.noteValueNumber(C,2)){E=this.connections[0];null!==E&&null!==(E=this.blocks.blockList[E].connections[0])&&["rhythm2","stuplet"].includes(this.blocks.blockList[E].name)?piemenuNumber(this,[2,4,8,16],this.value):piemenuNoteValue(this,this.value)}else if(this.blocks.noteValueNumber(C,1)){var ve=this.blocks.noteValueValue(C);if(1===ve)I=[8,7,6,5,4,3,2,1];else for(var I=[],ge=0;ge<Math.min(ve,16);ge++)I.push(ge+1);h=this.connections[0];null!==h&&null!==(h=this.blocks.blockList[h].connections[0])&&["neighbor","neighbor2","rhythm2","stuplet"].includes(this.blocks.blockList[h].name)&&(I=[3,2,1]),piemenuNumber(this,I,this.value)}else if(this.blocks.octaveModifierNumber(C))piemenuNumber(this,[-2,-1,0,1,2],this.value);else if(this.blocks.intervalModifierNumber(C))piemenuNumber(this,this.blocks.blockList[this.blocks.blockList[this.connections[0]].connections[0]].protoblock.piemenuValuesC1,this.value);else if(this._usePieNumberC3())piemenuNumber(this,this.blocks.blockList[this.connections[0]].protoblock.piemenuValuesC3,this.value);else if(this._usePieNumberC2())piemenuNumber(this,this.blocks.blockList[this.connections[0]].protoblock.piemenuValuesC2,this.value);else if(this._usePieNumberC1())switch(this.blocks.blockList[this.connections[0]].name){case"setturtlecolor":case"setcolor":case"sethue":case"setshade":case"settranslucency":case"setgrey":piemenuColor(this,this.blocks.blockList[this.connections[0]].protoblock.piemenuValuesC1,this.value,this.blocks.blockList[this.connections[0]].name);break;case"pitchnumber":for(var fe,P,M=0;M<this.blocks.blockList.length;M++)"settemperament"===this.blocks.blockList[M].name&&null!==this.blocks.blockList[M].connections[0]&&(fe=this.blocks.blockList[M].connections[1],P=this.blocks.blockList[fe].value);if("equal"===(P=void 0===P?"equal":P))piemenuNumber(this,[-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12],this.value);else{for(var Le=[],Be=0;Be<getTemperament(P).pitchNumber;Be++)Le.push(Be);piemenuNumber(this,Le,this.value)}break;default:piemenuNumber(this,this.blocks.blockList[this.connections[0]].protoblock.piemenuValuesC1,this.value)}else{k=document.createElement("input"),N=(k.id="numberLabel",k.style.position="absolute",k.style.webkitUserSelect="text",k.style.mozUserSelect="text",k.style.msUserSelect="text",k.className="number",k.type="number",k.step="any",n.innerHTML="",n.appendChild(k),this.label=k,this.label.value=R(e),n.classList.add("hasKeyboard"),this.label.value.length),L=this.label.type;this.label.type="text",this.label.setSelectionRange(N,N),this.label.type=L}}this._usePiemenu()||(t=!1,i=function(e){t&&(o._labelChanged(!0,!0),e.preventDefault(),n.classList.remove("hasKeyboard"),window.scroll(0,0),o.label.removeEventListener("keypress",s),j)&&(o.activity.blocksContainer.y=H,o.activity.blocksContainer.update())},"text"!==this.name&&"number"!==this.name||(this.label.addEventListener("blur",i),this.label.addEventListener("input",function(){o._labelChanged(!1,!0)})),s=function(e){[13,10,9].includes(e.keyCode)&&i(e)},this.label.addEventListener("keypress",s),this.label.addEventListener("change",function(){o._labelChanged(!1,!0)}),l=Math.round((F+this.activity.blocksContainer.x)*this.activity.getStageScale()+U),O=Math.round((a+this.activity.blocksContainer.y)*this.activity.getStageScale()+G),this.label.style.transform="translate3d(".concat(l,"px, ").concat(O,"px, 0)"),this.label.style.left="0px",this.label.style.top="0px",this.label.style.width=Math.round(150*this.blocks.blockScale*this.protoblock.scale/2)+"px",this.label.style.fontSize=Math.round(20*this.blocks.blockScale*this.protoblock.scale/2)+"px",this.label.style.display="",this.label.focus(),null!=this.labelattr&&(this.labelattr.style.display=""),setTimeout(function(){o.label.style.display="",o.label.focus(),t=!0},100))}},{key:"_exitKeyPressed",value:function(e){[13,10,9].includes(e.keyCode)&&(this._labelChanged(!0,!1),e.preventDefault(),this.label.removeEventListener("keypress",this._exitKeyPressed))}},{key:"piemenuOKtoLaunch",value:function(){return null===this._piemenuExitTime||200<(new Date).getTime()-this._piemenuExitTime}},{key:"_checkWidgets",value:function(e){var t=this.blocks.blockList.indexOf(this),i=this.blocks.findTopBlock(t),s=document.getElementsByClassName("wftTitle"),l=!1;if(!1===e)for(var o=0;o<s.length;o++)if(!1===l)switch(s[o].innerHTML){case"oscilloscope":case"tempo":case"rhythm maker":case"pitch slider":case"pitch staircase":case"status":case"phrase maker":case"lego bricks":case"custom mode":case"music keyboard":case"pitch drum":case"meter":case"temperament":case"mode":case"timbre":l=!0,this.blocks.blockList[i].protoblock.staticLabels[0]==s[o].innerHTML&&this.blocks.reInitWidget(i,1500)}}},{key:"_labelChanged",value:function(e,t){if(null===this||null===this.label)this._labelLock=!1;else{this._labelLock=!0,e&&(this.label.style.display="none",null!=this.labelattr&&(this.labelattr.style.display="none"),docById("wheelDiv").style.display="none"),void 0===t&&(docById("wheelDiv").style.display="none");var i=this.value,s=this.label.value;if(null!=this.labelattr){var l=this.labelattr.value;switch(l){case"𝄪":case"♯":case"𝄫":case"♭":s+=l}}var o=this.connections[0];if(i!==s||(this._labelLock=!1,"text"===this.name&&null!==o&&"storein"===this.blocks.blockList[o].name)){var a,n,c,h,o=this.connections[0];if("text"===this.name&&null!=o)switch(this.blocks.blockList[o].name){case"action":this.blocks.palettes.removeActionPrototype(i),(r=this.blocks.findUniqueActionName(s))!==s&&(s=r,this.value=s,m=this.value.toString(),getTextWidth(m,"bold 20pt Sans")>TEXTWIDTH&&(m=m.substr(0,STRINGLEN)+"..."),this.text.text=m,this.label.value=s,this.updateCache());break;case"pitch":var r,u,s=r=this.blocks.findUniqueCustomName(s),p=getTemperament("custom"),b=!1;for(u in p)"pitchNumber"!==u&&i===p[u][1]&&(p[u][1]=s,b=!0);b&&addTemperamentToDictionary("custom",p),this.value=s;var m=this.value.toString();getTextWidth(m,"bold 20pt Sans")>TEXTWIDTH&&(m=m.substr(0,STRINGLEN)+"..."),this.text.text=m,this.label.value=s,this.updateCache()}if("number"===this.name?(a=null!==(t=this.connections[0])?this.blocks.blockList[t].connections[0]:null,"-"===this.value?this.value=-1:null!==a&&s<0&&("newnote"===this.blocks.blockList[t].name||"newnote"==this.blocks.blockList[a].name)?(this.label.value=0,this.value=0):this.value=Number(s),isNaN(this.value)&&(a=this.blocks.blockList.indexOf(this),this.activity.errorMsg(s+": "+_("Not a number"),a),this.activity.refreshCanvas(),this.value=i),null!=t&&"pitch"===this.blocks.blockList[t].name&&(8<this.value||this.value<1)&&(a=this.blocks.blockList.indexOf(this),this.activity.errorMsg(_("Octave value must be between 1 and 8."),a),this.activity.refreshCanvas(),this.label.value=i,this.value=i),10<String(this.value).length&&(t=this.blocks.blockList.indexOf(this),this.activity.errorMsg(_("Numbers can have at most 10 digits."),t),this.activity.refreshCanvas(),this.label.value=i,this.value=i)):this.value=s,"solfege"===this.name?(n=splitSolfege(this.value),c=i18nSolfege(n[0]),"♮"!==(h=n[1])&&(c+=h)):"eastindiansolfege"===this.name?(n=splitSolfege(this.value),c=WESTERN2EISOLFEGENAMES[n[0]],"♮"!==(h=n[1])&&(c+=h)):c="modename"===this.name?this.value+" "+getModeNumbers(this.value):this.value.toString(),!WIDENAMES.includes(this.name)&&getTextWidth(c,"bold 20pt Sans")>TEXTWIDTH){for(var k=c.length-5,d=c.substr(0,k)+"...";getTextWidth(d,"bold 20pt Sans")>TEXTWIDTH&&(d=c.substr(0,--k)+"...",!(k<=STRINGLEN)););c=d}if(this.text.text=c,e&&(this.label.style.display="none",docById("wheelDiv").style.display="none"),this.container.setChildIndex(this.text,this.container.children.length-1),this.updateCache(),"text"===this.name&&null!=o){var v=this.blocks.blockList[o];switch(v.name){case"action":this.blocks.renameDos(i,s),i===_("action")&&(this.blocks.newNameddoBlock(s,this.blocks.actionHasReturn(o),this.blocks.actionHasArgs(o)),this.blocks.setActionProtoVisibility(!1)),this.blocks.newNameddoBlock(s,this.blocks.actionHasReturn(o),this.blocks.actionHasArgs(o));for(var g=this.blocks.palettes.dict.action,f=0;f<g.protoList.length;f++){var L=g.protoList[f];i===_("action")?"nameddo"===L.name&&0===L.defaults.length&&(L.hidden=!0):"nameddo"===L.name&&L.defaults[0]===i&&g.remove(L,i)}i===_("action")&&(this.blocks.newNameddoBlock(s,this.blocks.actionHasReturn(o),this.blocks.actionHasArgs(o)),this.blocks.setActionProtoVisibility(!1)),this.blocks.renameNameddos(i,s),this.blocks.palettes.hide(),this.blocks.palettes.updatePalettes("action"),this.blocks.palettes.show();break;case"storein":v.connections[1]===this.blocks.blockList.indexOf(this)&&e&&("box"!==this.value&&(this.blocks.newStorein2Block(this.value),this.blocks.newNamedboxBlock(this.value)),this.blocks.renameBoxes(i,s),this.blocks.renameNamedboxes(i,s),this.blocks.renameStoreinBoxes(i,s),this.blocks.renameStorein2Boxes(i,s),this.blocks.palettes.hide(),this.blocks.palettes.updatePalettes("boxes"),this.blocks.palettes.show());break;case"setdrum":case"playdrum":"http"===s.slice(0,4)&&this.activity.logo.synth.loadSynth(0,s);break;case"temperament1":var B=getTemperament(i);deleteTemperamentFromList(i),addTemperamentToDictionary(s,B),updateTemperaments()}}this._labelLock=!1,["drumname","effectsname","voicename","noisename"].includes(this.name)&&this.activity.logo.synth.loadSynth(0,getDrumSynthName(this.value))}}}}]))(),$=function(){for(var e=new Array,t=0;t<e.length;t++){var i=e[t];if("string"==typeof i&&(i=docById(i)),1===e.length)return i;e.push(i)}return e};window.hasMouse=!1,document.addEventListener("mousemove",function(){window.hasMouse=!0});
function _typeof(i){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(i)}function _slicedToArray(i,t){return _arrayWithHoles(i)||_iterableToArrayLimit(i,t)||_unsupportedIterableToArray(i,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(i,t){var s;if(i)return"string"==typeof i?_arrayLikeToArray(i,t):"Map"===(s="Object"===(s={}.toString.call(i).slice(8,-1))&&i.constructor?i.constructor.name:s)||"Set"===s?Array.from(i):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?_arrayLikeToArray(i,t):void 0}function _arrayLikeToArray(i,t){(null==t||t>i.length)&&(t=i.length);for(var s=0,h=Array(t);s<t;s++)h[s]=i[s];return h}function _iterableToArrayLimit(i,t){var s=null==i?null:"undefined"!=typeof Symbol&&i[Symbol.iterator]||i["@@iterator"];if(null!=s){var h,e,_,n,r=[],o=!0,a=!1;try{if(_=(s=s.call(i)).next,0===t){if(Object(s)!==s)return;o=!1}else for(;!(o=(h=_.call(s)).done)&&(r.push(h.value),r.length!==t);o=!0);}catch(i){a=!0,e=i}finally{try{if(!o&&null!=s.return&&(n=s.return(),Object(n)!==n))return}finally{if(a)throw e}}return r}}function _arrayWithHoles(i){if(Array.isArray(i))return i}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,t){for(var s=0;s<t.length;s++){var h=t[s];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,_toPropertyKey(h.key),h)}}function _createClass(i,t,s){return t&&_defineProperties(i.prototype,t),s&&_defineProperties(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i}function _toPropertyKey(i){i=_toPrimitive(i,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(i,t){if("object"!=_typeof(i)||!i)return i;var s=i[Symbol.toPrimitive];if(void 0===s)return("string"===t?String:Number)(i);s=s.call(i,t||"default");if("object"!=_typeof(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}var SVG=(()=>_createClass(function i(){_classCallCheck(this,i),this._x=0,this._y=0,this._minX=1e4,this._minY=1e4,this._maxX=-1e4,this._maxY=-1e4,this._width=0,this._height=0,this.docks=[],this._scale=1,this._orientation=0,this._radius=8,this._strokeWidth=1,this._innies=[],this._outie=!1,this._innieX1=(9-this._strokeWidth)/2,this._innieY1=3,this._innieX2=(9-this._strokeWidth)/2,this._innieY2=(9-this._strokeWidth)/2,this._inniesSpacer=9,this._padding=this._innieY1+this._strokeWidth,this._slot=!0,this._cap=!1,this._tab=!0,this._bool=!1,this._slotX=10,this._slotY=2,this._tail=!1,this._porch=!1,this._porchX=this._innieX1+this._innieX2+4*this._strokeWidth,this._porchY=this._innieY2,this._expandX=30,this._expandX2=0,this._expandY=0,this._expandY2=0,this._clampCount=1,this._clampSlots=[1],this._arm=!0,this._else=!1,this._draw_inniess=!0,this._fill="fill_color",this._stroke="stroke_color",this.margins=[0,0,0,0],this._fontSize=10,this._labelOffset=0,this._computeSlotSize()},[{key:"setFontSize",value:function(i){this._fontSize=i}},{key:"setLabelOffset",value:function(i){this._labelOffset=i}},{key:"setDrawInniess",value:function(i){this._draw_inniess=i}},{key:"getWidth",value:function(){return this._width}},{key:"getHeight",value:function(){return this._height}},{key:"clearDocks",value:function(){this.docks=[]}},{key:"setScale",value:function(i){this._scale=i,this._computeSlotSize()}},{key:"setOrientation",value:function(i){this._orientation=i}},{key:"setClampCount",value:function(i){this._clampCount=i;var t=this._clampSlots.length;if(t<i)for(var s=0;s<i-t;s++)this._clampSlots.push(1)}},{key:"setClampSlots",value:function(i,t){i>this._clampCount.length-1&&this.setClampCount(i+1),this._clampSlots[i]=t}},{key:"setExpand",value:function(i,t,s,h){this._expandDimensions=[i,t,s,h];i=_slicedToArray(this._expandDimensions,4);this._expandX=i[0],this._expandY=i[1],this._expandX2=i[2],this._expandY2=i[3]}},{key:"setstrokeWidth",value:function(i){this._strokeWidth=i,this._calc_porch_params(),this._computeSlotSize()}},{key:"setColors",value:function(i){this._fill=i[0],this._stroke=i[1]}},{key:"setFillColor",value:function(i){this._fill=i}},{key:"setStrokeColor",value:function(i){this._stroke=i}},{key:"setInnies",value:function(i){for(var t=0;t<i.length;t++)this._innies.push(i[t])}},{key:"setOutie",value:function(i){this._outie=i}},{key:"setSlot",value:function(i){(this._slot=i)&&(this._cap=!1)}},{key:"setCap",value:function(i){(this._cap=i)&&(this._slot=!1)}},{key:"setTab",value:function(i){(this._tab=i)&&(this._tail=!1)}},{key:"setTail",value:function(i){(this._tail=i)&&(this._tab=!1)}},{key:"setPorch",value:function(i){this._porch=i}},{key:"setBoolean",value:function(i){this._bool=i}},{key:"setElse",value:function(i){this._else=i}},{key:"setArm",value:function(i){this._arm=i}},{key:"_computeSlotSize",value:function(){this._slotSize=2*this._innieY2+this._inniesSpacer+this._padding}},{key:"_resetMinMax",value:function(){this._minX=1e4,this._minY=1e4,this._maxX=-1e4,this._maxY=-1e4}},{key:"_checkMinMax",value:function(){this._x<this._minX&&(this._minX=this._x),this._y<this._minY&&(this._minY=this._y),this._x>this._maxX&&(this._maxX=this._x),this._y>this._maxY&&(this._maxY=this._y)}},{key:"_calculateXY",value:function(){var i=this._strokeWidth/2,t=this._strokeWidth/2+this._radius;return this.margins[0]=i+this._strokeWidth+.5,this.margins[1]=this._strokeWidth+.5,this._outie&&(i+=this._innieX1+this._innieX2,this.margins[0]+=this._innieX1+this._innieX2),this._cap?(t+=3*this._slotY,this.margins[1]+=3*this._slotY):this._slot&&(this.margins[1]+=this._slotY),this.margins[0]*=this._scale,this.margins[1]*=this._scale,this.margins[0]=Math.floor(this.margins[0]),this.margins[1]=Math.floor(this.margins[1]),[i,t]}},{key:"_calculateWH",value:function(i){this._width=i?(this._maxX-this._minX+this._strokeWidth)*this._scale:(this._maxX-this._minX)*this._scale,0===this.margins[2]?this.margins[2]=(this._strokeWidth+.5)*this._scale:this.margins[2]=this._width-this.margins[2],this._height=i?(this._maxY-this._minY+this._strokeWidth)*this._scale:(this._maxY-this._minY)*this._scale,0===this.margins[3]?this._tab?this.margins[3]=(this._slotY+this._strokeWidth+.5)*this._scale:this.margins[3]=(2*this._slotY+this._strokeWidth+.5)*this._scale:this.margins[3]=this._height-this.margins[3],this.margins[2]=Math.floor(this.margins[2]+.5),this.margins[3]=Math.floor(this.margins[3]+.5)}},{key:"_newPath",value:function(i,t){return'<path d="m'+(this._x=i)+" "+(this._y=t)+" "}},{key:"_closePath",value:function(){return'z" '}},{key:"text",value:function(i,t,s,h,e,_){var n;switch(this._x=i,this._y=t,this._checkMinMax(),this._x=i+h,this._y=t-s,this._checkMinMax(),e){case"left":case"start":n="start";break;case"middle":case"center":n="middle";break;case"right":case"end":n="end"}for(var r=t,o=_.split("\n"),a='<text style="font-size:'+s+"px;fill:"+platformColor.blockText+";font-family:sans-serif;text-anchor:"+n+'">',l=0;l<o.length;l++)a+='<tspan x="'+Math.floor(i+.5)+'" y="'+Math.floor(r+.5)+'">'+o[l]+"</tspan>",r+=s;return a+="</text>"}},{key:"_lineTo",value:function(i,t){return this._checkMinMax(),this._x===i&&this._y===t?"":(this._x=i,this._y=t,this._checkMinMax(),"L "+i+" "+t+" ")}},{key:"_rLineTo",value:function(i,t){return 0===i&&0===t?"":this._lineTo(this._x+i,this._y+t)}},{key:"_arcTo",value:function(i,t,s,h,e,_){return this._checkMinMax(),0===s?this._lineTo(i,t):(this._x=i,this._y=t,this._checkMinMax(),"A "+s+" "+s+" "+h+" "+e+" "+_+" "+i+" "+t+" ")}},{key:"_rarcTo",value:function(i,t,s,h,e){return 0===this._radius?"":this._arcTo(this._x+i*this._radius,this._y+t*this._radius,this._radius,s,h,e)}},{key:"_corner",value:function(i,t,s,h,e,_,n,r){var o,a="";return 0<this._radius&&(o=this._radius/2,_&&(i*t==1?a+=this._rLineTo(i*o,0):r||(a+=this._rLineTo(0,t*o))),a+=this._arcTo(this._x+i*o,this._y+t*o,o,s,h,e),n)&&(i*t==1?a+=this._rLineTo(0,t*o):r||(a+=this._rLineTo(i*o,0))),a}},{key:"_iCorner",value:function(i,t,s,h,e,_,n){var r="",o=this._strokeWidth+this._radius/2;return _&&(r=i*t==-1?this._rLineTo(i*(o-this._strokeWidth),0):this._rLineTo(0,t*(o-this._strokeWidth))),r+=this._arcTo(this._x+i*o,this._y+t*o,o,s,h,e),n&&(r+=i*t==-1?this._rLineTo(0,t*(o-this._strokeWidth)):this._rLineTo(i*(o-this._strokeWidth),0)),r}},{key:"_doInnie",value:function(){return this.docks.push([(this._x+this._strokeWidth)*this._scale,(this._y+this._innieY2)*this._scale]),0===this.margins[2]&&(this.margins[1]=(this._y-this._innieY1)*this._scale,this.margins[2]=(this._x-this._innieX1-this._innieX2-2*this._strokeWidth)*this._scale),this.margins[3]=(this._y+this._innieY2+this._innieY1)*this._scale,this._rLineTo(-this._innieX1,0)+this._rLineTo(0,-this._innieY1)+this._rLineTo(-this._innieX2,0)+this._rLineTo(0,this._innieY2+2*this._innieY1)+this._rLineTo(this._innieX2,0)+this._rLineTo(0,-this._innieY1)+this._rLineTo(this._innieX1,0)}},{key:"_doOutie",value:function(){return this._outie?(this.docks.unshift([this._x*this._scale,this._y*this._scale]),this._rLineTo(0,-this._strokeWidth)+this._rLineTo(-this._innieX1-2*this._strokeWidth,0)+this._rLineTo(0,this._innieY1)+this._rLineTo(-this._innieX2+2*this._strokeWidth,0)+this._rLineTo(0,-this._innieY2-2*this._innieY1+2*this._strokeWidth)+this._rLineTo(this._innieX2-2*this._strokeWidth,0)+this._rLineTo(0,this._innieY1)+this._rLineTo(this._innieX1+2*this._strokeWidth,0)+this._rLineTo(0,-this._strokeWidth)):this._rLineTo(0,-this._innieY2)}},{key:"_doSlot",value:function(){return this._slot?(this.docks.push([(this._x+this._slotX/2)*this._scale,this._y*this._scale]),this._rLineTo(0,this._slotY)+this._rLineTo(this._slotX,0)+this._rLineTo(0,-this._slotY)):this._cap?(this.docks.push([(this._x+this._slotX/2)*this._scale,this._y*this._scale]),this._rLineTo(this._slotX/2,3*-this._slotY)+this._rLineTo(this._slotX/2,3*this._slotY)):this._rLineTo(this._slotX,0)}},{key:"_doTail",value:function(){return!this._outie&&this._tail?(this.docks.push([(this._x+this._slotX/2)*this._scale,this._y*this._scale]),this._rLineTo(-this._slotX/2,3*this._slotY)+this._rLineTo(-this._slotX/2,3*-this._slotY)):this._rLineTo(-this._slotX,0)}},{key:"_doTab",value:function(){return this._outie?this._rLineTo(-this._slotX,0):(this.docks.push([(this._x-this._slotX/2)*this._scale,(this._y+this._strokeWidth)*this._scale]),this._rLineTo(-this._strokeWidth,0)+this._rLineTo(0,this._slotY)+this._rLineTo(-this._slotX+2*this._strokeWidth,0)+this._rLineTo(0,-this._slotY)+this._rLineTo(-this._strokeWidth,0))}},{key:"_doPorch",value:function(i){return i?this._rLineTo(0,this._porchY+this._innieY1)+this._rLineTo(this._porchX-this._radius,0)+this._corner(1,1,90,0,1,!0,!0,!1):this._rLineTo(0,this._porchY-this._padding)+this._rLineTo(this._porchX-this._radius,0)+this._corner(1,1,90,0,1,!0,!0,!1)}},{key:"_startBoolean",value:function(i,t){i=this._newPath(i,t);return this._radius-=this._strokeWidth,this.docks.push([this._x*this._scale,this._y*this._scale]),i+=this._rarcTo(1,-1,90,0,1),this._radius+=this._strokeWidth,(i+=this._rLineTo(this._strokeWidth,0))+this._rLineTo(0,-this._expandY)}},{key:"_doBoolean",value:function(){return this.docks.push([(this._x-this._radius+this._strokeWidth)*this._scale,(this._y+this._radius)*this._scale]),this.margins[2]=(this._x-this._radius-this._strokeWidth)*this._scale,this._rarcTo(-1,1,90,0,0)+this._rarcTo(1,1,90,0,0)}},{key:"_endBoolean",value:function(i){var t="";return i||(t=this._rLineTo(1.5*-this._radius,0)),t=(t+=this._rLineTo(0,-this._strokeWidth))+this._rLineTo(-this._strokeWidth,0),this._radius-=this._strokeWidth,t+=this._rarcTo(-1,-1,90,0,1),this._radius+=this._strokeWidth,t+=this._closePath(),this._calculateWH(!0),t+=this._style()}},{key:"_header",value:function(i){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+Math.floor(this._width+2*this._strokeWidth+.5)+'" height="'+Math.floor(this._height+.5)+'">'+this._transform(i)+'<filter id="dropshadow" height="130%">             <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>             <feOffset dx="2" dy="2" result="offsetblur"/>             <feComponentTransfer xmlns="http://www.w3.org/2000/svg">             <feFuncA type="linear" slope="0.2"/> </feComponentTransfer>             <feMerge> <feMergeNode/> <feMergeNode in="SourceGraphic"/> </feMerge>             </filter>'}},{key:"_transform",value:function(i){var t="";return 0!==this._orientation&&(t='<g transform = "rotate('+this._orientation+" "+this._width/2+" "+this._height/2+')">'),i?'<g transform="translate('+-this._minX+", "+-this._minY+')">':'<g transform="scale('+this._scale+", "+this._scale+')">'+t}},{key:"_footer",value:function(){return 0!==this._orientation?"</g></g></svg>":"</g></svg>"}},{key:"_style",value:function(){return'style="fill:'+this._fill+";fill-opacity:1;stroke:"+this._stroke+";stroke-width:"+this._strokeWidth+';stroke-linecap:round;stroke-opacity:1;filter:url(#dropshadow);" />'}},{key:"basicBlock",value:function(){this._resetMinMax();var i=this._calculateXY(),t=i[0],i=i[1],s=(this.margins[2]=0,this.margins[3]=0,this._newPath(t,i)),i=(s=(s=(s+=this._corner(1,-1,90,0,1,!0,!0,!1))+this._doSlot())+this._rLineTo(this._expandX,0),this._x);if(this._bool?s=(s+=this._rLineTo(3,0))+this._rLineTo(0,2):s+=this._corner(1,1,90,0,1,!0,!0,!1),this._bool)s+=this._doBoolean();else if(0===this._innies.length)s+=this._rLineTo(0,this._padding);else for(var h=0;h<this._innies.length;h++)this._innies[h]&&(s+=this._doInnie()),0===h?s+=this._rLineTo(0,this._expandY):1===h&&0<this._expandY2&&(s+=this._rLineTo(0,this._expandY2)),0===h&&this._porch?s+=this._doPorch(!1):this._innies.length-1>h&&(s+=this._rLineTo(0,2*this._innieY2+this._inniesSpacer));this._bool?s=(s+=this._rLineTo(0,2))+this._rLineTo(-3,0):s+=this._corner(-1,1,90,0,1,!0,!0,!1),s=(s+=this._lineTo(i,this._y))+this._rLineTo(-this._expandX,0),this._tab?s+=this._doTab():s+=this._doTail(),s=(s+=this._corner(-1,-1,90,0,1,!0,!0,!1))+this._rLineTo(0,-this._expandY),this._innies.includes(!0)&&(s=(s+=this._lineTo(t,this._radius+this._innieY2+this._strokeWidth/2))+this._doOutie()),this._calculateWH(!0);for(var s=(s+=this._closePath())+this._style(),e=this._width-this._scale*(this._innieX1+this._innieX2)-4*this._strokeWidth+this._labelOffset*this._scale,_=this._height/2+this._fontSize/(5/this._scale),i=this._innies.length,n=(2<i&&2*Math.round(i/2)!==i&&(_-=2*this._fontSize),s+=this.text(e/this._scale,_/this._scale,this._fontSize,this._width,"right","block_label"),0),r=((this._slot||this._outie)&&(n=1),1),o=0;o<this._innies.length;o++)this._innies[o]&&(_=this.docks[n][1]-this._fontSize/(8/this._scale)+this._scale,s+=this.text(e/this._scale,_/this._scale,this._fontSize/1.5,this._width,"right","arg_label_"+r),r+=1,n+=1);return s+=this._footer(),this._header(!1)+s}},{key:"basicBox",value:function(){this._resetMinMax(),this.setOutie(!0);var i=this._strokeWidth/2+this._innieX1+this._innieX2,t=(this.margins[0]=(i+this._strokeWidth+.5)*this._scale,this.margins[1]=(this._strokeWidth+.5)*this._scale,this.margins[2]=0,this.margins[3]=0,this._newPath(i,this._strokeWidth/2)),i=(t=(t=(t=(t=(t=(t+=this._rLineTo(this._expandX,0))+this._rLineTo(0,2*this._radius+this._innieY2+this._expandY))+this._rLineTo(-this._expandX,0))+this._lineTo(i,this._radius+this._innieY2+this._strokeWidth/2))+this._doOutie())+this._closePath(),this._calculateWH(!0),t+=this._style(),2*(this._innieX1+this._innieX2)+4*this._strokeWidth+this._labelOffset*this._scale),s=this._height/2+this._fontSize/2,t=(t+=this.text(i/this._scale,s/this._scale,this._fontSize,this._width,"left","block_label"))+this._footer();return this._header(!1)+t}},{key:"booleanAndOr",value:function(){this._resetMinMax();var i=this._startBoolean(this._strokeWidth/2,5.5*this._radius+this._strokeWidth/2+this._innieY2+this._inniesSpacer+this._expandY),t=(i=(i=(i+=this._rLineTo(0,3.5*-this._radius-this._innieY2-this._inniesSpacer-this._strokeWidth))+this._rarcTo(1,-1,90,0,1))+this._rLineTo(this._radius/2+this._expandX,0),this._x),t=(i=(i=(i=(i=(i=(i=(i=(i=(i+=this._rLineTo(0,this._radius/2))+this._doBoolean())+this._rLineTo(0,1.5*this._radius+this._innieY2+this._inniesSpacer))+this._rLineTo(0,this._expandY))+this._doBoolean())+this._rLineTo(0,this._radius/2))+this._lineTo(t,this._y))+this._rLineTo(-this._expandX,0))+this._endBoolean(!1),this.margins[0]=(this._radius+this._strokeWidth+.5)*this._scale,this.margins[1]=this._strokeWidth*this._scale,this.margins[2]=this._strokeWidth*this._scale,this.margins[3]=this._strokeWidth*this._scale,this._width-this._scale*(this._innieX1+this._innieX2)-4*this._strokeWidth+this._labelOffset*this._scale),s=this._height/2+this._fontSize/2,i=(i+=this.text(t/this._scale,s/this._scale,this._fontSize,this._width,"right","block_label"))+this._footer();return this._header(!1)+i}},{key:"booleanNot",value:function(i){this._resetMinMax();var t="",t=this._innies[0]||i?this._startBoolean(this._strokeWidth/2,1.25*this._radius+this._strokeWidth/2):this._startBoolean(this._strokeWidth/2,2*this._radius+this._strokeWidth/2),s=(t+=this._rLineTo(0,-this._strokeWidth),this._innies[0]?t+=this._rLineTo(0,-this._radius/4):t+=i?this._rLineTo(0,-this._radius/4):this._rarcTo(1,-1,90,0,1),t+=this._rLineTo(this._radius/2+this._expandX,0),this._x),s=(this._innies[0]?t=(t=(t+=this._rLineTo(0,this._radius))+this._doInnie())+this._rLineTo(0,this._radius):i?t+=this._rLineTo(0,2*this._radius):t=(t=(t+=this._rLineTo(0,this._radius/2))+this._doBoolean())+this._rLineTo(0,this._radius/2),t+=this._lineTo(s,this._y),0<this._expandY2&&(t+=this._rLineTo(0,this._expandY2)),this._innies[0]?t=(t+=this._rLineTo(-this._radius/2-this._expandX,0))+this._rLineTo(0,-this._radius/4):t+=i?this._rLineTo(-this._radius/2-this._expandX,0):this._rLineTo(-this._expandX,0),0<this._expandY2&&!i?t+=this._rLineTo(0,-this._expandY2):i&&(t+=this._rLineTo(0,-2)),t+=this._endBoolean(i),i?(this.margins[0]=(this._radius+this._strokeWidth+.5)*this._scale,this.margins[2]=(this._radius+this._strokeWidth+.5)*this._scale):(this.margins[0]=(this._strokeWidth+.5)*this._scale,this.margins[2]=(this._strokeWidth+.5)*this._scale),this.margins[1]=this._strokeWidth*this._scale,this.margins[3]=this._strokeWidth*this._scale,this._width-2*(this._innieX1+this._innieX2)-4*this._strokeWidth+this._labelOffset*this._scale),i=this._height/2+this._fontSize/2;return t=(t+=this.text(s/this._scale,i/this._scale,this._fontSize,this._width,"right","block_label"))+this._footer(),this._header(!1)+t}},{key:"booleanCompare",value:function(){this._resetMinMax();var i=2*this._radius+2*this._innieY2+this._inniesSpacer+this._strokeWidth/2+this._expandY,t=this._strokeWidth/2,s='<g transform="matrix(1,0,0,1,0,-'+2*this._radius+')"> ',t=(s+=this._newPath(t,i+this._radius),this.docks.push([this._x*this._scale,(this._y-2*this._radius)*this._scale]),this._radius-=this._strokeWidth,s+=this._rarcTo(1,-1,90,0,1),this._radius+=this._strokeWidth,s=(s+=this._rLineTo(this._strokeWidth,0))+this._rLineTo(0,-this._expandY),i=-2*this._innieY2-this._inniesSpacer-this._strokeWidth,s=(s=(s=(s+=this._rLineTo(0,i+this._radius))+this._rarcTo(1,-1,90,0,1))+this._rLineTo(this._radius/2+this._expandX,0))+this._rLineTo(0,this._radius),this._x),i=(s+=this._doInnie(),this.docks[1][1]-=2*this._radius*this._scale,s+=this._rLineTo(0,this._expandY),this._porch?s+=this._doPorch(!1):s+=this._rLineTo(0,2*this._innieY2+this._inniesSpacer),s+=this._doInnie(),this.docks[2][1]-=2*this._radius*this._scale,s=(s=(s=(s=(s=(s=(s+=this._rLineTo(0,this._radius))+this._lineTo(t,this._y))+this._rLineTo(-this._expandX,0))+this._rLineTo(1.5*-this._radius,0))+this._rLineTo(0,-this._radius))+this._rLineTo(0,-this._strokeWidth))+this._rLineTo(-this._strokeWidth,0),this._radius-=this._strokeWidth,s+=this._rarcTo(-1,-1,90,0,1),this._radius+=this._strokeWidth,s+=this._closePath(),this._calculateWH(!0),s=s+this._style()+"</g>",this.margins[0]=(this._radius+this._strokeWidth)*this._scale,this.margins[1]=this._strokeWidth*this._scale,this.margins[2]=this._strokeWidth*this._scale,this._width-2*(this._innieX1+this._innieX2)-4*this._strokeWidth+this._labelOffset*this._scale),t=this._height/2+this._fontSize/2,s=(s+=this.text(i/this._scale,t/this._scale,this._fontSize,this._width,"right","block_label"))+this._footer();return this._header(!1)+s}},{key:"basicClamp",value:function(){var i,t,s=this._cap,h=this._slot,e=(this._resetMinMax(),i=this._outie?this._strokeWidth/2+this._innieX1+this._innieX2:this._strokeWidth/2,t=this._cap?this._strokeWidth/2+this._radius+3*this._slotY:this._strokeWidth/2+this._radius,this.margins[0]=(i+this._strokeWidth+.5)*this._scale,this.margins[1]=(this._strokeWidth+.5)*this._scale,this.margins[2]=0,this.margins[3]=0,this._newPath(i,t)),_=(e=(e+=this._corner(1,-1,90,0,1,!0,!0,!1))+this._doSlot(),this._cap&&(this._slot=!0,this._cap=!1),e+=this._rLineTo(this._radius+this._strokeWidth,0),this._x);if(e=(e+=this._rLineTo(this._expandX,0))+this._corner(1,1,90,0,1,!0,!0,!1),this._innies[0])for(var n=0;n<this._innies.length;n++)this._innies[n]&&(e+=this._doInnie()),0===n?e+=this._rLineTo(0,this._expandY):1===n&&0<this._expandY2&&(e+=this._rLineTo(0,this._expandY2)),0===n&&this._porch?e+=this._doPorch(!1):this._innies.length-1>n&&(e+=this._rLineTo(0,2*this._innieY2+this._inniesSpacer));else this._bool?e=(e+=this._rLineTo(0,2*this._padding+this._strokeWidth))+this._doBoolean():e+=this._rLineTo(0,this._padding),this.margins[2]=(this._x-this._strokeWidth+.5)*this._scale;for(var r,o=0;o<this._clampCount;o++){0<o&&(e=(e+=this._rLineTo(this._expandX,0))+this._rLineTo(0,3*this._padding));var e=(e+=this._corner(-1,1,90,0,1,!0,!0,!1))+this._lineTo(_,this._y),a=this._outie,a=(this._outie=!1,e+=this._doTab(),this._outie=a,e=(e+=this._iCorner(-1,1,90,0,0,!0,!0))+this._rLineTo(0,this._padding),1<this._clampSlots[o]&&(e+=this._rLineTo(0,this._slotSize*(this._clampSlots[o]-1))),e=(e+=this._rLineTo(0,this._expandY2))+this._iCorner(1,1,90,0,0,!0,!0),this._slot);this._slot=!0,e+=this._doSlot(),this._slot=a,this.docks.pop(),e+=this._rLineTo(this._radius,0)}0<this._clampCount&&(e=(e+=this._rLineTo(0,2*this._innieY1))+this._rLineTo(0,this._innieY1+3*this._strokeWidth)),e+=this._corner(-1,1,90,0,1,!0,!0,!1),0===this._clampCount&&(e+=this._lineTo(_,this._y)),e+=this._rLineTo(-this._radius-this._strokeWidth,0),this._tail?e+=this._doTail():e+=this._doTab(),this._cap=s,this._slot=h,e+=this._corner(-1,-1,90,0,1,!0,!0,!1),this._outie&&(e=(e+=this._lineTo(i,this._radius+this._innieY2+this._strokeWidth/2))+this._doOutie()),e+=this._closePath(),this._calculateWH(!0),e+=this._style(),d=this._outie?10*this._strokeWidth+this._innieX1+this._innieX2+this._labelOffset*this._scale:8*this._strokeWidth+this._labelOffset*this._scale,this._cap?r=(this._strokeWidth/2+this._radius+this._slotY)*this._scale:1<this._innies.length?(r=(this._strokeWidth/2+this._radius)*this._scale/2,r+=this._fontSize):r=(this._strokeWidth/2+this._radius)*this._scale/2,r+=(this._fontSize+1)*this._scale,this._bool&&(r+=this._fontSize/2),e+=this.text(d/this._scale,r/this._scale,this._fontSize,this._width,"left","block_label");var l=1;if(this._bool)for(var d=this._width-this._radius,c=0;c<this._clampCount;c++)r=this.docks[c+2][1]-this._fontSize+3*this._strokeWidth,e+=this.text(d/this._scale,r/this._scale,this._fontSize/1.5,this._width,"right","arg_label_"+l),l+=1;var u=0;(this._slot||this._outie)&&(u=1),l=1,d=this._width-this._scale*(this._innieX1+this._innieX2)-4*this._strokeWidth;for(var k=0;k<this._innies.length;k++)this._innies[k]&&(r=this.docks[u][1]-this._fontSize/(8/this._scale)+this._scale,e+=this.text(d/this._scale,r/this._scale,this._fontSize/1.5,this._width,"right","arg_label_"+l),l+=1,u+=1);return e+=this._footer(),this._header(!1)+e}},{key:"argClamp",value:function(){this._resetMinMax(),i=this._outie?this._strokeWidth/2+this._innieX1+this._innieX2:this._strokeWidth/2;for(var i,t=this._strokeWidth/2+this._radius,s=(this.margins[0]=(i+this._strokeWidth+.5)*this._scale,this.margins[1]=(this._strokeWidth+.5)*this._scale,this.margins[2]=0,this.margins[3]=0,this._newPath(i,t)),t=(s=(s=(s+=this._corner(1,-1,90,0,1,!0,!0,!1))+this._doSlot())+this._rLineTo(this._radius+this._strokeWidth,0),this._x),h=(s=(s+=this._rLineTo(this._expandX,0))+this._corner(1,1,90,0,1,!0,!0,!1),this._innies[0]?s+=this._doInnie():(s+=this._rLineTo(0,this._padding),this.margins[2]=(this._x-this._strokeWidth+.5)*this._scale),0),e=(s=(s=(s=(s+=this._corner(-1,1,90,0,1,!0,!0,!1))+this._lineTo(t,this._y))+this._iCorner(-1,1,90,0,0,!0,!0))+this._doInnie(),this._slotSize*(this._clampSlots[0][h]-1)),_=(0<e&&(s+=this._rLineTo(0,e)),h+=1,this._slotSize-this._innieY2),n=1;n<this._clampSlots[0].length;n++)s=(s+=this._rLineTo(0,_))+this._doInnie(),0<(e=this._slotSize*(this._clampSlots[0][h]-1))&&(s+=this._rLineTo(0,e)),h+=1;return s=(s=(s=(s=(s=(s=(s=(s+=this._rLineTo(0,this._expandY2))+this._iCorner(1,1,90,0,0,!0,!0))+this._rLineTo(this._radius,0))+this._rLineTo(0,2*this._innieY1))+this._rLineTo(0,this._innieY1+3*this._strokeWidth))+this._corner(-1,1,90,0,1,!0,!0,!1))+this._lineTo(t,this._y))+this._rLineTo(-this._radius-this._strokeWidth,0),this._tail?s+=this._doTail():s+=this._doTab(),s+=this._corner(-1,-1,90,0,1,!0,!0,!1),this._outie&&(s=(s+=this._lineTo(i,this._radius+this._innieY2+this._strokeWidth/2))+this._doOutie()),s+=this._closePath(),this._calculateWH(!0),s+=this._style(),t=this._outie?10*this._strokeWidth+this._innieX1+this._innieX2:8*this._strokeWidth,i=this._cap?(this._strokeWidth/2+this._radius+this._slotY)*this._scale:(this._strokeWidth/2+this._radius)*this._scale/2,i+=(this._fontSize+1)*this._scale,this._bool&&(i+=this._fontSize/2),s=(s+=this.text(t/this._scale,i/this._scale,this._fontSize,this._width,"left","block_label"))+this._footer(),this._header(!1)+s}},{key:"untilClamp",value:function(){this._resetMinMax();var i=this._strokeWidth/2,t=this._strokeWidth/2+this._radius,i=(this.margins[0]=(i+this._strokeWidth+.5)*this._scale,this.margins[1]=(this._strokeWidth+.5)*this._scale,this.margins[2]=0,this.margins[3]=0,this._newPath(i,t)),t=(i=(i=(i=(i+=this._corner(1,-1,90,0,1,!0,!0,!1))+this._doSlot())+this._rLineTo(this._radius+this._strokeWidth,0))+this._rLineTo(this._expandX,0),this._x),t=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i+=this._corner(1,1,90,0,1,!0,!0,!0))+this._rLineTo(0,2*this._innieY1))+this._corner(-1,1,90,0,1,!0,!0,!0))+this._lineTo(t,this._y))+this._rLineTo(-this._expandX,0))+this._doTab())+this._iCorner(-1,1,90,0,0,!0,!0))+this._rLineTo(0,this._expandY))+this._iCorner(1,1,90,0,0,!0,!0))+this._doSlot(),this.docks.pop(),i+=this._rLineTo(this._radius,0),this._innies[0]?i+=this._doInnie():this.margins[2]=(this._x-this._strokeWidth+.5)*this._scale,i+=this._rLineTo(0,this._radius+this._expandY2),this._bool&&(i+=this._doBoolean()),i=(i=(i=(i=(i+=this._corner(-1,1,90,0,1,!0,!0,!1))+this._rLineTo(-this._radius-this._strokeWidth,0))+this._doTab())+this._corner(-1,-1,90,0,1,!0,!0,!1))+this._closePath(),this._calculateWH(!0),i+=this._style(),4*this._strokeWidth),s=this.docks[2][1];return i+=this.text(t/this._scale,s/this._scale,this._fontSize,this._width,"left","block_label"),this._bool&&(t=this._width-this._radius,s=this.docks[1][1]-this._fontSize,i+=this.text(t/this._scale,s/this._scale,this._fontSize/1.5,this._width,"right","arg_label_1")),this._bool&&(t=this.docks[1][0],s=this.docks[1][1],this.docks[1][0]=this.docks[2][0],this.docks[1][1]=this.docks[2][1],this.docks[2][0]=t,this.docks[2][1]=s),i+=this._footer(),this._header(!1)+i}},{key:"statusBlock",value:function(){this._resetMinMax();var i=this._calculateXY(),t=i[0],i=i[1],t=(this.margins[2]=0,this.margins[3]=0,this._newPath(t,i)),i=(t=(t+=this._corner(1,-1,90,0,1,!0,!0,!1))+this._rLineTo(this._expandX,0),this._x),t=(t=(t=(t=(t=(t=(t+=this._corner(1,1,90,0,1,!0,!0,!1))+this._rLineTo(0,this._expandY))+this._corner(-1,1,90,0,1,!0,!0,!1))+this._lineTo(i,this._y))+this._rLineTo(-this._expandX,0))+this._corner(-1,-1,90,0,1,!0,!0,!1))+this._rLineTo(0,-this._expandY);return this._calculateWH(!0),t=(t=(t+=this._closePath())+this._style())+this._footer(),this._header(!1)+t}}]))();"undefined"!=typeof module&&module.exports&&(module.exports={SVG:SVG});
function _regeneratorKeys(t){var e,i=Object(t),o=[];for(e in i)o.unshift(e);return function t(){for(;o.length;)if((e=o.pop())in i)return t.value=e,t.done=!1,t;return t.done=!0,t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regenerator(){var b,t="function"==typeof Symbol?Symbol:{},e=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function o(t,e,i,o){var s,n,c,l,a,r,h,u,k,e=e&&e.prototype instanceof L?e:L,e=Object.create(e.prototype);return _regeneratorDefine2(e,"_invoke",(s=t,n=i,h=o||[],u=!1,k={p:r=0,n:0,v:b,a:_,f:_.bind(b,4),d:function(t,e){return c=t,l=0,a=b,k.n=e,d}},function(t,e,i){if(1<r)throw TypeError("Generator is already running");for(u&&1===e&&_(e,i),l=e,a=i;(p=l<2?b:a)||!u;){c||(l?l<3?(1<l&&(k.n=-1),_(l,a)):k.n=a:k.v=a);try{if(r=2,c){if(p=c[t=l?t:"next"]){if(!(p=p.call(c,a)))throw TypeError("iterator result is not an object");if(!p.done)return p;a=p.value,l<2&&(l=0)}else 1===l&&(p=c.return)&&p.call(c),l<2&&(a=TypeError("The iterator does not provide a '"+t+"' method"),l=1);c=b}else if((p=(u=k.n<0)?a:s.call(n,k))!==d)break}catch(t){c=b,l=1,a=t}finally{r=1}}return{value:p,done:u}}),!0),e;function _(t,e){for(l=t,a=e,p=0;!u&&r&&!i&&p<h.length;p++){var i,o=h[p],s=k.p,n=o[2];3<t?(i=n===e)&&(a=o[(l=o[4])?5:l=3],o[4]=o[5]=b):o[0]<=s&&((i=t<2&&s<o[1])?(l=0,k.v=e,k.n=o[1]):s<n&&(i=t<3||o[0]>e||n<e)&&(o[4]=t,o[5]=e,k.n=n,l=0))}if(i||1<t)return d;throw u=!0,e}}var d={};function L(){}function s(){}function n(){}var p=Object.getPrototypeOf,t=[][e]?p(p([][e]())):(_regeneratorDefine2(p={},e,function(){return this}),p),c=n.prototype=L.prototype=Object.create(t);function l(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,n):(t.__proto__=n,_regeneratorDefine2(t,i,"GeneratorFunction")),t.prototype=Object.create(c),t}return _regeneratorDefine2(c,"constructor",s.prototype=n),_regeneratorDefine2(n,"constructor",s),_regeneratorDefine2(n,i,s.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,i,"Generator"),_regeneratorDefine2(c,e,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:l}})()}function _regeneratorDefine2(t,e,i,o){var n=Object.defineProperty;try{n({},"",{})}catch(t){n=0}(_regeneratorDefine2=function(t,e,i,o){function s(e,i){_regeneratorDefine2(t,e,function(t){return this._invoke(e,i,t)})}e?n?n(t,e,{value:i,enumerable:!o,configurable:!o,writable:!o}):t[e]=i:(s("next",0),s("throw",1),s("return",2))})(t,e,i,o)}function asyncGeneratorStep(t,e,i,o,s,n,c){try{var l=t[n](c),a=l.value}catch(t){return void i(t)}l.done?e(a):Promise.resolve(a).then(o,s)}function _asyncToGenerator(l){return function(){var t=this,c=arguments;return new Promise(function(e,i){var o=l.apply(t,c);function s(t){asyncGeneratorStep(o,e,i,s,n,"next",t)}function n(t){asyncGeneratorStep(o,e,i,s,n,"throw",t)}s(void 0)})}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var MINIMUMDOCKDISTANCE=400,LONGSTACK=300,CAMERAVALUE="##__CAMERA__##",VIDEOVALUE="##__VIDEO__##",NOTEBLOCKS=["newnote","osctime"],PITCHBLOCKS=["pitch","steppitch","hertz","pitchnumber","nthmodalpitch","playdrum"],ALLOWED_CONNECTIONS=new Set(["vspaceout:vspacein","vspacein:vspaceout","in:out","out:in","in:vspaceout","vspaceout:in","out:vspacein","vspacein:out","numberin:numberout","numberin:anyout","numberout:numberin","anyout:numberin","textin:textout","textin:anyout","textout:textin","anyout:textin","booleanout:booleanin","booleanin:booleanout","mediain:mediaout","mediaout:mediain","mediain:textout","textout:mediain","filein:fileout","fileout:filein","casein:caseout","caseout:casein","vspaceout:casein","casein:vspaceout","vspacein:caseout","caseout:vspacein","solfegein:anyout","solfegein:solfegeout","solfegein:textout","solfegein:noteout","solfegein:scaledegreeout","solfegein:numberout","anyout:solfegein","solfegeout:solfegein","textout:solfegein","noteout:solfegein","scaledegreeout:solfegein","numberout:solfegein","notein:solfegeout","notein:scaledegreeout","notein:textout","notein:noteout","solfegeout:notein","scaledegreeout:notein","textout:notein","noteout:notein","pitchout:anyin","gridout:anyin","anyin:textout","anyin:mediaout","anyin:numberout","anyin:anyout","anyin:fileout","anyin:solfegeout","anyin:scaledegreeout","anyin:noteout","textout:anyin","mediaout:anyin","numberout:anyin","anyout:anyin","fileout:anyin","solfegeout:anyin","scaledegreeout:anyin","noteout:anyin"]),Blocks=_createClass(function Blocks(activity){var _this=this;_classCallCheck(this,Blocks),this.activity=activity,this.storage=this.activity.storage,this.trashcan=this.activity.trashcan,this.turtles=this.activity.turtles,this.boundary=this.activity.boundary,this.macroDict=this.activity.macroDict,this.stageClick=!1,this.trashStacks=[],this.protoBlockDict={},this.blockList=[],this.blockArt={},this.blockCollapseArt={},this.mouseDownTime=0,this.longPressTimeout=null,this.pasteDx=0,this.pasteDy=0,this.selectedStack=null,this.selectedBlocksObj=null,this._loopCounter=0,this._sizeCounter=0,this._searchCounter=0,this.highlightedBlock=null,this.activeBlock=null,this.visible=!0,this.dragGroup=[],this.stackList=[],this._expandablesList=[],this._loadCounter=0,this._adjustTheseDocks=[],this.blocksToCollapse=[],this._checkTwoArgBlocks=[],this._checkArgClampBlocks=[],this.clampBlocksToCheck=[],this.noRunBlocks=[],this._homeButtonContainers=[],this.blockScale=DEFAULTBLOCKSCALE,this.inLongPress=!1,this.customTemperamentDefined=!1,this.isBlockMoving=!1,this.selectionModeOn=!1,this.selectedBlocks=[],this.deleteActionTimeout=0,this.getLongPressStatus=function(){return _this.inLongPress},this.clearLongPress=function(){_this.inLongPress=!1},this.setBlockScale=(()=>{var e=_asyncToGenerator(_regenerator().m(function t(e){var i,o,s,n,c;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:for(o in console.debug("New block scale is "+e),_this.blockScale=e,_this.blockList)_this.blockList[o].resize(e);for(s in _this.findStacks(),_this.stackList)_this.adjustDocks(_this.stackList[s],!0);for(n in _this.blockList)_this.blockList[n].trash&&_this.blockList[n].hide();for(i in _this.activity.palettes.dict)for(c in _this.activity.palettes.dict[i].protoList)_this.activity.palettes.dict[i].protoList[c].scale=e;return t.n=1,delayExecution(100);case 1:_this.activity.refreshCanvas();case 2:return t.a(2)}},t)}));return function(t){return e.apply(this,arguments)}})(),this.extract=function(){null!=_this.activeBlock&&"rest2"!==_this.blockList[_this.activeBlock].name&&_this._extractBlock(_this.activeBlock,!0)},this._extractBlock=(()=>{var i=_asyncToGenerator(_regenerator().m(function t(e,i){var o,s,n,c,l;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:o=_this.blockList[e],s=o.connections[0],SPECIALINPUTS.includes(o.name)?(null!=s&&(n=_this.blockList[s].connections.indexOf(e),_this.blockList[s].connections[n]=null,o.connections[0]=null),_this.moveStackRelative(e,4*STANDARDBLOCKHEIGHT,0),_this.blockMoved(e)):(c=[],_this.findNestedClampBlocks(e,c),l=last(o.connections),n=null!=s?_this.blockList[s].connections.indexOf(e):null,(o.connections[0]=null)!=l&&("hidden"===_this.blockList[l].name||"hiddennoflow"===_this.blockList[l].name?(l=last(_this.blockList[l].connections),_this.blockList[last(o.connections)].connections[_this.blockList[last(o.connections)].connections.length-1]=null):o.connections[o.connections.length-1]=null,null!=l)&&(_this.blockList[l].connections[0]=s),null!=s&&(_this.blockList[s].connections[n]=l),_this.moveStackRelative(e,4*STANDARDBLOCKHEIGHT,0),_this.blockMoved(e),i&&null!=s&&(_this.adjustDocks(s,!0),0<c.length)&&(_this.clampBlocksToCheck=c,_this.adjustExpandableClampBlock()));case 1:return t.a(2)}},t)}));return function(t,e){return i.apply(this,arguments)}})(),this.bottomMostBlock=function(){var t,e=-1e3;for(t in _this.blockList)_this.blockList[t].container.y>e&&(e=_this.blockList[t].container.y);return e},this.toggleCollapsibles=function(){var t,e,i=!0,o=!1;for(t in _this.blockList)e=_this.blockList[t],["newnote","interval","osctime"].includes(e.name)||COLLAPSIBLES.includes(e.name)&&!e.trash&&(e.collapsed?o=!0:i=!1);if(i||!o)for(t in _this.blockList)e=_this.blockList[t],["newnote","interval","osctime"].includes(e.name)||COLLAPSIBLES.includes(e.name)&&!e.trash&&e.collapseToggle();else for(t in _this.blockList)e=_this.blockList[t],["newnote","interval","osctime"].includes(e.name)||!COLLAPSIBLES.includes(e.name)||e.trash||e.collapsed||e.collapseToggle()},this.setHomeContainers=function(t,e){return _this._setHomeButtonContainers=t,_this.boundary=e,_this},this._actionBlock=function(t){return["do","doArg","calc","calcArg"].includes(t)},this._namedActionBlock=function(t){return["nameddo","nameddoArg","namedcalc","namedcalcArg"].includes(t)},this._adjustBlockPositions=function(){_this.dragGroup.length<2||_this.adjustDocks(_this.dragGroup[0],!0)},this.adjustExpandableClampBlock=function(){if(0!==_this.clampBlocksToCheck.length){var t=_this,e=_this.clampBlocksToCheck.pop(),i=e[0],e=e[1],o=_this.blockList[i];if(!o.isArgFlowClampBlock()&&!o.isLeftClampBlock()){if(o.isArgBlock()||o.isTwoArgBlock())return;o.isArgClamp()&&_this._adjustArgClampBlock([i])}var s;i=e,o=(e=o).isArgFlowClampBlock()||e.isLeftClampBlock()?1:0===i?e.connections.length-2:e.connections.length-3,s=1,(t._sizeCounter=0)<o&&null!=e.connections[o]&&(_this._sizeCounter=0,s=Math.max(t._getStackSize(e.connections[o]),1)),0==(o=s-e.clampCount[i])||0===s&&1===e.clampCount[i]||e.updateSlots(i,o),0<t.clampBlocksToCheck.length&&t.adjustExpandableClampBlock()}},this._getNestingDepth=function(t){for(var e=0;null!==t;)t=_this.insideExpandableBlock(t),e+=1;return e},this._getBlockSize=function(t){t=_this.blockList[t];return["newnote","interval","osctime"].includes(t.name)&&t.collapsed?1:t.size},this._adjustArgClampBlock=function(t){if(0!==t.length){for(var t=t.pop(),e=_this.blockList[t],i=!1,o=["doArg","calcArg","makeblock"].includes(e.name)?2:1,s=e.argClampSlots,n=0;n<s.length;n++){var c=e.connections[o+n],l=1;null!=c&&(l=Math.max(_this._getBlockSize(c),1)),s[n]!==l&&(s[n]=l,i=!0)}i&&e.updateArgSlots(s)}},this._adjustExpandableTwoArgBlock=function(t){var e,i;0!==t.length&&(t=t.pop(),0!=(i=(e=null!=(i=(t=_this.blockList[t]).connections[e=1])?Math.max(_this._getBlockSize(i),1):e)-t.clampCount[0]))&&0!==e&&t.updateSlots(0,i)},this._addRemoveVspaceBlock=function(t){function e(t){return(t=last(r.blockList[t].connections))&&"vspace"===r.blockList[t].name?1+e(t):0}var a,i=_this.blockList[t],o=i.connections[i.connections.length-2],s=1,r=(null!=o&&(s=Math.max(_this._getBlockSize(o),1)),_this),o=e(t);if(s<o+1)for(var n=Math.abs(s-o-1),c=0;c<n;c++){var l=i.connections.length-1,h=_this.blockList[i.connections[l]],u=h.connections[1];null!=(i.connections[l]=u)&&(_this.blockList[u].connections[0]=t),h.connections=[null,null],h.trash=!0,h.hide()}else o+1<s&&_this._makeNewBlockWithConnections("vspace",_this.blockList.length,[null,null],a=function(t){var e=t[0],i=t[1],o=t[2],s=t[3],t=t[4],n=r.blockList[o],c=last(e.docks),l=c[0]-n.docks[0][0],c=c[1]-n.docks[0][1];n.container.x=e.container.x+l,n.container.y=e.container.y+c,n.connections[0]=r.blockList.indexOf(e),n.connections[1]=i,e.connections[e.connections.length-1]=o,i&&(r.blockList[i].connections[0]=o),s+1<t&&(l=r.blockList.length,e=last(r.blockList),i=last(e.connections),r._makeNewBlockWithConnections("vspace",l,[null,null],a,[e,i,l,s+1,t]))},[i,last(i.connections),_this.blockList.length,0,s-o-1])},this._getStackSize=function(t){var e,i,o,s,n=0;return _this._sizeCounter+=1,_this._sizeCounter>2*_this.blockList.length?console.debug("Infinite loop encountered detecting size of expandable block? "+t):null!=t&&(null==(e=_this.blockList[t])&&console.debug("Something very broken in _getStackSize."),e.isClampBlock()?((o=0)<(i=e.connections.length-2)&&(n=0===(o=null!=(s=e.connections[i])?_this._getStackSize(s):o)?1:o),e.isDoubleClampBlock()&&(o=0)<(i=e.connections.length-3)&&(n+=0===(o=null!=(s=e.connections[i])?_this._getStackSize(s):o)?1:o),n+=e.size):n=e.size,(-1!=_this.blocksToCollapse.indexOf(t)||["newnote","interval","osctime"].includes(e.name)&&e.collapsed)&&(n=1),1<e.connections.length)&&null!=(s=last(e.connections))&&(n+=_this._getStackSize(s)),n},this.adjustDocks=function(t,e){var i=_this.blockList[t];if(null!=e&&(_this._loopCounter=0),null==i)console.debug("Saw a null block: "+t);else if(null==i.connections)console.debug("Saw a block with null connections: "+t);else if(0===i.connections.length)console.debug("Saw a block with [] connections: "+t);else if(1!==i.docks.length)if(_this._loopCounter+=1,_this._loopCounter>2*_this.blockList.length)console.debug("Infinite loop encountered while adjusting docks: "+t+" "+_this.blockList);else{e=1;i.isTwoArgBooleanBlock()?e=0:i.isInlineCollapsible()&&i.collapsed&&(e=i.connections.length-1);for(var o=e;o<i.connections.length;o++){var s=i.docks[o],n=i.connections[o];if(null!==n)if(null===_this.blockList[n])console.debug("This is not good: we encountered a null block: "+n);else{for(var c=!1,l=void 0,l=0;l<_this.blockList[n].connections.length;l++)if(_this.blockList[n].connections[l]===t){c=!0;break}if(!c){console.debug("Did not find match for "+i.name+" ("+t+") and "+_this.blockList[n].name+" ("+n+")"),console.debug(i.connections),console.debug(_this.blockList[n].connections);break}var a,r=_this.blockList[n].docks[l],h=void 0,u=void 0,k=void 0,_=void 0;0<o?(h=s[0]-r[0],u=i.isInlineCollapsible()&&i.collapsed?(a=i.docks.length,a=i.docks[a-1][1]-i.docks[a-2][1],s[1]-a-r[1]):s[1]-r[1],null==i.container?console.debug("Does this ever happen any more?"):(k=i.container.x+h,_=i.container.y+u),_this._moveBlock(n,k,_)):(h=r[0]-s[0],u=r[1]-s[1],k=_this.blockList[n].container.x+h,_=_this.blockList[n].container.y+u,_this._moveBlock(t,k,_)),0<o&&_this.adjustDocks(n,!0)}}}},this.addDefaultBlock=function(t,e,c){if(null!=t){var i,o,l=_this;if("action"===_this.blockList[t].name)null==(i=_this.blockList[t].connections[1])&&_this._makeNewBlockWithConnections("text",0,[t],function(t){var e=t[0],i=t[1],t=l.blockList.length-1,o=(l.blockList[e].connections[1]=t,l.blockList[t].value=l.findUniqueActionName(_("action")),l.blockList[t].value);if(getTextWidth(o,"bold 20pt Sans")>TEXTWIDTH&&(o=o.substr(0,STRINGLEN)+"..."),l.blockList[t].text.text=o,l.blockList[t].container.updateCache(),l.blockList[t].value!==l.blockList[i].value){l.newNameddoBlock(l.blockList[t].value,l.actionHasReturn(e),l.actionHasArgs(e));for(var s=l.activity.palettes.dict.action,n=0;n<s.protoList.length&&!(()=>{var t=s.protoList[n];if("nameddo"===t.name&&t.defaults[0]===l.blockList[i].value)return setTimeout(function(){s.remove(t,l.blockList[i].value),delete l.protoBlockDict["myDo_"+l.blockList[i].value],l.activity.palettes.updatePalettes("action")},50),1})();n++);l.renameNameddos(l.blockList[i].value,l.blockList[t].value),c?l.renameDos(l.blockList[i].value,l.blockList[t].value,i):l.renameDos(l.blockList[i].value,l.blockList[t].value)}l.adjustDocks(e,!0)},[t,e]);else if("temperament1"===_this.blockList[t].name)null==(i=_this.blockList[t].connections[1])&&_this._makeNewBlockWithConnections("text",0,[t],function(t){var e=t[0],t=t[1],i=l.blockList.length-1;l.blockList[e].connections[1]=i,l.blockList[i].value=l.blockList[t].value,l.blockList[i].text.text=l.blockList[t].text.text,l.blockList[i].container.updateCache(),l.adjustDocks(e,!0)},[t,e]);else if("pitch"===_this.blockList[t].name){if(null==(i=_this.blockList[t].connections[2])&&_this._makeNewBlockWithConnections("number",0,[t],function(t){var e=t[0],t=t[1],i=_this.blockList.length-1,t=(_this.blockList[e].connections[2]=i,_this.blockList[t].value),t=(_this.blockList[i].value=t,_this.blockList[i].text.text=t.toString(),_this.blockList[i].container.children.length-1);_this.blockList[i].container.setChildIndex(_this.blockList[i].text,t),_this.blockList[i].container.updateCache(),_this.adjustDocks(e,!0)},[t,e]),null==_this.blockList[t].connections[1]){var s="solfege",n="sol";switch(_this.blockList[e].name){case"eastindiansolfege":s=_this.blockList[e].name,n="sol";break;case"scaledegree2":s=_this.blockList[e].name,n="5";break;case"notename":s=_this.blockList[e].name,n="G"}_this._makeNewBlockWithConnections(s,0,[t],function(t){var e,i=t[0],t=t[1],o=_this.blockList.length-1,s=(_this.blockList[i].connections[1]=o,_this.blockList[o].value=t,"eastindiansolfege"===_this.blockList[o].name?(s=splitSolfege(t),e=WESTERN2EISOLFEGENAMES[s[0]],"♮"!==(s=s[1])&&(e+=s),_this.blockList[o].text.text=e):_this.blockList[o].text.text=t.toString(),_this.blockList[o].container.children.length-1);_this.blockList[o].container.setChildIndex(_this.blockList[o].text,s),_this.blockList[o].container.updateCache(),_this.adjustDocks(i,!0)},[t,n])}}else"storein"===_this.blockList[t].name?null==(i=_this.blockList[t].connections[1])&&_this._makeNewBlockWithConnections("text",0,[t],function(t){var t=t[0],e=l.blockList.length-1,i=(l.blockList[t].connections[1]=e,l.blockList[e].value=_("box"),l.blockList[e].value);getTextWidth(i,"bold 20pt Sans")>TEXTWIDTH&&(i=i.substr(0,STRINGLEN)+"..."),l.blockList[e].text.text=i,l.blockList[e].container.updateCache(),l.adjustDocks(t,!0)},[t,e]):NOTEBLOCKS.includes(_this.blockList[t].name)&&(null==(i=_this.blockList[t].connections[2])?(o=_this.makeBlock("vspace","__NOARG__"),_this.blockList[t].connections[2]=o,_this.blockList[o].connections[0]=t,t=_this.makeBlock("rest2","__NOARG__"),_this.blockList[t].connections[0]=o,_this.blockList[t].connections[1]=null,_this.blockList[o].connections[1]=t):"vspace"===_this.blockList[i].name&&null==_this.blockList[i].connections[1]&&(o=_this.makeBlock("rest2","__NOARG__"),_this.blockList[o].connections[0]=i,_this.blockList[o].connections[1]=null,_this.blockList[i].connections[1]=o))}},this._deletePitchBlocks=function(t){for(var e=_this.blockList[t].connections[0],i=(null===e&&console.debug("Silence block was not inside a note block"),0);!NOTEBLOCKS.includes(_this.blockList[e].name);){if(t=e,null===(e=_this.blockList[e].connections[0])){console.debug("Silence block was not inside a note block");break}if((i+=1)>_this.blockList.length){console.debug("Connection loop???");break}}for(i=0;null!=t;){if(_this.blockList[t].connections.length<2){console.debug("value block encountered??? "+t);break}var o,s=last(_this.blockList[t].connections);if((PITCHBLOCKS.includes(_this.blockList[t].name)||["flat","sharp"].includes(_this.blockList[t].name)&&(o=_this.blockList[t].connections[1],_this._blockInStack(o,PITCHBLOCKS)))&&_this._extractBlock(t,!1),t=s,(i+=1)>_this.blockList.length){console.debug("Connection loop???");break}}},this.deleteNextDefault=function(t){var e;if(null!=t){var i=_this.blockList[t];if("vspace"!==(null==(e=i)?void 0:e.name)||"rest2"!==(null==(e=_this.blockList[i.connections[1]])?void 0:e.name)||"vspace"!==(null==(e=_this.blockList[i.connections[0]])?void 0:e.name)){for(var o,s=i=_this.blockList[t];"vspace"==(null==(o=s)?void 0:o.name);){if("vspace"!=(null==(o=s)?void 0:o.name))break;if("newnote"==(null==(o=s=_this.blockList[s.connections[0]])?void 0:o.name))return}if("rest2"===i.name)_this._deletePitchBlocks(t);else if(i&&1===i.connections.length)console.debug("Value block encountered? "+i.name);else for(;null!=last(i.connections);){var n=i.connections.length-1,c=i.connections[n];if("rest2"===_this.blockList[c].name){var l=_this.blockList[c];l.hide(),l.trash=!0,i.connections[n]=l.connections[1];break}i=_this.blockList[c]}}}},this.deletePreviousDefault=function(t){var e,i=_this.blockList[t];if("rest2"!==(null==(e=_this.blockList[i.connections[0]])?void 0:e.name)||"vspace"!==(null==(e=_this.blockList[t])?void 0:e.name)){if(_this._blockInStack(t,["rest2"]))return _this._deletePitchBlocks(t),_this.blockList[t].connections[0];for(;null!=i.connections[0];){var o=i.connections[0];if(NOTEBLOCKS.includes(_this.blockList[o].name))break;if("rest2"===_this.blockList[o].name){var s=o,n=_this.blockList[s];n.hide(),n.trash=!0;for(var c=0;c<_this.blockList[n.connections[0]].connections.length;c++)if(_this.blockList[n.connections[0]].connections[c]===s){_this.blockList[n.connections[0]].connections[c]=_this.blockList.indexOf(i);break}i.connections[0]=n.connections[0];break}i=_this.blockList[o]}}return i.connections[0]},this.reInitWidget=(()=>{var i=_asyncToGenerator(_regenerator().m(function t(e,i){return _regenerator().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,delayExecution(i);case 1:_this.blockList[e].trash||_this.activity.logo.runLogoCommands(e);case 2:return t.a(2)}},t)}));return function(t,e){return i.apply(this,arguments)}})(),this.blockMoved=(()=>{var e=_asyncToGenerator(_regenerator().m(function t(e){var j,i,o,R,s,n,c,l,a,r,h,M,u,F,U,k,b,H,V,z,d,L,p,m,f,g,v,K,B,y,C,q,x,T,A,D,w,S,N,E,X,Y,J,O,Z,I,Q,$,tt,et,P,G,W;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(j=_this.findTopBlock(e),_this.clampBlocksToCheck=[],null==e)return console.debug("blockMoved called with null block."),t.a(2);t.n=1;break;case 1:i=_this.insideExpandableBlock(e),o=0,(R=null)!=i&&(R=i),s=!1;case 2:if(null==i)t.n=4;else{if((o+=1)>2*_this.blockList.length)return console.debug("Infinite loop encountered checking for expandables?"),t.a(3,4);t.n=3}break;case 3:"ifthenelse"===_this.blockList[i].name?(_this.clampBlocksToCheck.push([i,0]),_this.clampBlocksToCheck.push([i,1])):_this.clampBlocksToCheck.push([i,0]),i=_this.insideExpandableBlock(i),t.n=2;break;case 4:if(_this._checkTwoArgBlocks=[],n=[],null==(c=_this.blockList[e]))return console.debug("null block found in blockMoved method: "+e),t.a(2);t.n=5;break;case 5:if(null!=(l=c.connections[0])&&(a=_this.blockList[l]),c.isArgBlock()&&null!=l&&(_this.blockList[l].isTwoArgBlock()||_this.blockList[l].isArgClamp()?a.connections[1]===e&&_this._checkTwoArgBlocks.push(l):(_this.blockList[l].isArgBlock()&&_this.blockList[l].isExpandableBlock()||_this.blockList[l].isArgClamp())&&a.connections[1]===e&&_this._checkTwoArgBlocks.push(l)),r=document.getElementsByClassName("wftTitle"),null==l){t.n=12;break}h=1;case 6:if(h<a.connections.length){if(a.connections[h]===e)return a.connections[h]=null,t.a(3,8);t.n=7}else t.n=8;break;case 7:h++,t.n=6;break;case 8:c.connections[0]=null,_this.raiseStackToTop(e),M=!1,u=0;case 9:u<r.length?!1!==M?t.n=11:(G=r[u].innerHTML,t.n="oscilloscope"===G||"tempo"===G||"rhythm maker"===G||"pitch slider"===G||"pitch staircase"===G||"status"===G||"phrase maker"===G||"lego bricks"===G||"custom mode"===G||"music keyboard"===G||"pitch drum"===G||"meter"===G||"temperament"===G||"timbre"===G?10:11):t.n=12;break;case 10:return M=!0,_this.blockList[j].protoblock.staticLabels[0]===r[u].innerHTML&&_this.reInitWidget(j,1500),t.a(3,11);case 11:u++,t.n=9;break;case 12:F=c.container.x+c.docks[0][0],U=c.container.y+c.docks[0][1],b=k=null,H=MINIMUMDOCKDISTANCE/DEFAULTBLOCKSCALE*_this.blockScale,V=c.docks[0][2],z=!0,d=0;case 13:if(d<_this.blockList.length){if(d===e)return t.a(3,24);t.n=14}else t.n=25;break;case 14:if(_this.blockList[d].inCollapsed)return t.a(3,24);t.n=15;break;case 15:if(COLLAPSIBLES.includes(_this.blockList[d].name))if(!INLINECOLLAPSIBLES.includes(_this.blockList[d].name)&&_this.blockList[d].collapsed)return t.a(3,24);t.n=16;break;case 16:if(_this.blockList[d].trash)return t.a(3,24);t.n=17;break;case 17:G=1,_this.blockList[d].isInlineCollapsible()&&_this.blockList[d].collapsed&&(G=_this.blockList[d].connections.length-1),L=G;case 18:if(L<_this.blockList[d].connections.length){if(L===_this.blockList[d].docks.length)return t.a(3,24);t.n=19}else t.n=24;break;case 19:if(L===_this.blockList[d].connections.length-1&&null!=_this.blockList[d].connections[L]&&_this.blockList[_this.blockList[d].connections[L]].isNoHitBlock())return t.a(3,23);t.n=20;break;case 20:if(["backward","status"].includes(_this.blockList[d].name)&&1===L&&null!=_this.blockList[d].connections[1]&&_this.blockList[_this.blockList[d].connections[1]].isNoHitBlock())return t.a(3,23);t.n=21;break;case 21:if("action"===_this.blockList[d].name&&2===L&&null!=_this.blockList[d].connections[2]&&_this.blockList[_this.blockList[d].connections[2]].isNoHitBlock())return t.a(3,23);t.n=22;break;case 22:_this._testConnectionType(V,_this.blockList[d].docks[L][2])&&(g=_this.blockList[d].container.x+_this.blockList[d].docks[L][0],p=_this.blockList[d].container.y+_this.blockList[d].docks[L][1],(g=(g-F)*(g-F)+(p-U)*(p-U))<H)&&(k=d,b=L,H=g);case 23:L++,t.n=18;break;case 24:d++,t.n=13;break;case 25:null==k?t.n=53:(p=_this._countBlocksInStack(_this.findTopBlock(k)),LONGSTACK<p&&_this.activity.errorMsg(_("Consider breaking this stack into parts.")),c.connections[0]=k,null!=(m=_this.blockList[k].connections[b])?t.n=26:(!_this.blockList[k].isArgClamp()||-1!==["doArg","calcArg","makeblock"].indexOf(_this.blockList[k].name)&&1===b||["doArg","nameddoArg"].includes(_this.blockList[k].name)&&b===_this.blockList[k].connections.length-1||(g=_this._getBlockSize(e),E=_this.blockList[k].argClampSlots,S=b-1,["doArg","calcArg","makeblock"].includes(_this.blockList[k].name)&&(S=b-2),E[S]!==g&&(E[S]=g,_this.blockList[k].updateArgSlots(E))),t.n=45));break;case 26:if(z=!1,_this.blockList[k].isArgClamp())if(-1===["doArg","calcArg","makeblock"].indexOf(_this.blockList[k].name)||1!==b)t.n=27;else{for(_this.blockList[m].connections[0]=null,_this.findDragGroup(m),v=0;v<_this.dragGroup.length;v++)_this.moveBlockRelative(_this.dragGroup[v],40,40);t.n=32}else t.n=33;break;case 27:["doArg","nameddoArg"].includes(_this.blockList[k].name)&&b===_this.blockList[k].connections.length-1?(f=_this.findBottomBlock(e),_this.blockList[m].connections[0]=f,_this.blockList[f].connections[_this.blockList[f].connections.length-1]=m,t.n=32):t.n=28;break;case 28:K=_this._getBlockSize(e),B=_this.blockList[k].argClampSlots,y=_this.blockList[k].connections.indexOf(m),C=y-1,["doArg","calcArg","makeblock"].includes(_this.blockList[k].name)&&(C=y-2),x=q=null,T=C;case 29:if(T<B.length){if(null==_this.blockList[k].connections[y+T-C])return x=y+T-C,t.a(3,31);t.n=30}else t.n=31;break;case 30:T++,t.n=29;break;case 31:if(null==x){for(B.push(1),"makeblock"!==_this.blockList[k].name&&_this._newLocalArgBlock(B.length),x=y+q-C,_this.blockList[k].connections.push(null),A=B.length-1;C+1<A;A--)B[A]=B[A-1];for(D=_this.blockList[k].connections.length-1;y+1<D;D--)_this.blockList[k].connections[D]=_this.blockList[k].connections[D-1]}b+=1,B[C+1]=K,_this.blockList[k].updateArgSlots(B);case 32:t.n=45;break;case 33:if(c.isArgBlock()){if(_this.blockList[m].connections[0]=null,"number"===_this.blockList[m].name)_this.sendStackToTrash(_this.blockList[m]);else for(_this.findDragGroup(m),w=0;w<_this.dragGroup.length;w++)_this.moveBlockRelative(_this.dragGroup[w],40,40);if("action"!==_this.blockList[k].name)t.n=41;else{if(s=!0,c.value!==_this.blockList[m].value)return S=c.connections[0],c.connections[0]=null,N=_this.findUniqueActionName(c.value),c.connections[0]=S,N!==c.value&&(c.value=N,E=N,getTextWidth(E,"bold 20pt Sans")>TEXTWIDTH&&(E=E.substr(0,STRINGLEN)+"..."),c.text.text=E,c.container.updateCache()),t.n=34,delayExecution(75);t.n=40}}else t.n=44;break;case 34:N=_this.blockList[m].value,null!=_this.protoBlockDict["myDo_"+N]&&(delete _this.protoBlockDict["myDo_"+N],_this.activity.palettes.dict.action.hideMenu(!0)),_this.newNameddoBlock(c.value,_this.actionHasReturn(k),_this.actionHasArgs(k)),X=_this.activity.palettes.dict.action,Y=0;case 35:if(Y<X.protoList.length){if("nameddo"===(J=X.protoList[Y]).name&&J.staticLabels[0]===_this.blockList[m].value)return t.n=36,delayExecution(50);t.n=38}else t.n=39;break;case 36:return X.remove(J,_this.blockList[m].value),delete _this.protoBlockDict["myDo_"+_this.blockList[m].value],_this.activity.palettes.hide(),_this.activity.palettes.updatePalettes("action"),t.n=37,delayExecution(500);case 37:return _this.activity.palettes.show(),t.a(3,39);case 38:Y++,t.n=35;break;case 39:_this.renameNameddos(_this.blockList[m].value,c.value),_this.renameDos(_this.blockList[m].value,c.value);case 40:t.n=43;break;case 41:if("storein"!==_this.blockList[k].name);else if(1===b&&"box"!==c.value)return _this.newStorein2Block(c.value),_this.newNamedboxBlock(c.value),t.n=42,delayExecution(50);t.n=43;break;case 42:_this.activity.palettes.updatePalettes("boxes");case 43:t.n=45;break;case 44:"argclamparg"!==c.protoblock.style&&(_this.blockList[e].isArgFlowClampBlock()?console.debug("HOW DID WE GET HERE?"):(f=_this.findBottomBlock(e),_this.blockList[m].connections[0]=f,_this.blockList[f].connections[_this.blockList[f].connections.length-1]=m));case 45:if(_this.blockList[k].connections[b]=e,null!=_this._insideNoteBlock(e)&&1<_this.blockList[e].connections.length&&(z?k=_this.deletePreviousDefault(e):f&&_this.deleteNextDefault(f)),"action"!==_this.blockList[k].name||s){t.n=49;break}O=0;case 46:if(O<_this.blockList.length){if(O===k)return t.a(3,48);t.n=47}else t.n=49;break;case 47:"action"===_this.blockList[O].name&&null!=_this.blockList[O].connections[1]&&_this.blockList[_this.blockList[O].connections[1]].value===_this.blockList[e].value&&(_this.blockList[e].value=_this.findUniqueActionName(_this.blockList[e].value),W=_this.blockList[e].value,getTextWidth(W,"bold 20pt Sans")>TEXTWIDTH&&(W=W.substr(0,STRINGLEN)+"..."),_this.blockList[e].text.text=W,_this.blockList[e].container.updateCache(),_this.newNameddoBlock(_this.blockList[e].value,_this.actionHasReturn(O),_this.actionHasArgs(O)),_this.setActionProtoVisibility(!1));case 48:O++,t.n=46;break;case 49:if(_this.adjustDocks(k,!0),Z=!1,null!==l){t.n=53;break}I=0;case 50:I<r.length?(Q=_this,!1!==Z?t.n=52:($=void 0,W=r[I].innerHTML,t.n="oscilloscope"===W||"tempo"===W||"rhythm maker"===W||"pitch slider"===W||"pitch staircase"===W||"status"===W||"phrase maker"===W||"lego bricks"===W||"custom mode"===W||"music keyboard"===W||"pitch drum"===W||"meter"===W||"temperament"===W||"timbre"===W?51:52)):t.n=53;break;case 51:return Z=!0,$=Q.findTopBlock(e),_this.blockList[$].protoblock.staticLabels[0]==r[I].innerHTML&&_this.reInitWidget($,1500),t.a(3,52);case 52:I++,t.n=50;break;case 53:if((c.isArgBlock()||["calcArg","namedcalcArg","makeblock"].includes(c.name))&&null!=k&&((_this.blockList[k].isTwoArgBlock()||_this.blockList[k].isArgBlock()&&_this.blockList[k].isExpandableBlock())&&_this.blockList[k].connections[1]===e&&!_this._checkTwoArgBlocks.includes(k)&&_this._checkTwoArgBlocks.push(k),P=_this.blockList[k].connections.length,_this.blockList[k].connections[P-2]!==e||_this.blockList[k].isArgClamp()||"in"!==_this.blockList[k].docks[P-1][2]||n.push(k)),_this.addDefaultBlock(R,e,s),0<n.length)for(tt=0;tt<n.length;tt++)_this._addRemoveVspaceBlock(n[tt]);for(0<_this._checkTwoArgBlocks.length&&_this._adjustExpandableTwoArgBlock(_this._checkTwoArgBlocks),et=0;et<n.length;et++)_this.adjustDocks(n[et],!0);i=_this.insideExpandableBlock(e),o=0;case 54:if(null==i)t.n=56;else{if((o+=1)>2*_this.blockList.length)return console.debug("Infinite loop checking for expandables?"),console.debug(_this.blockList),t.a(3,56);t.n=55}break;case 55:"ifthenelse"===_this.blockList[i].name?(_this.clampBlocksToCheck.push([i,0]),_this.clampBlocksToCheck.push([i,1])):_this.clampBlocksToCheck.push([i,0]),i=_this.insideExpandableBlock(i),t.n=54;break;case 56:_this.isBlockMoving=!1,_this.adjustExpandableClampBlock(),_this.activity.refreshCanvas(),_this.activity.turtles.running()&&(_this.activity.logo.doStopTurtles(),P=document.getElementById("stop"))&&(P.style.color="white");case 57:return t.a(2)}},t)}));return function(t){return e.apply(this,arguments)}})(),this._testConnectionType=function(t,e){return ALLOWED_CONNECTIONS.has(t+":"+e)},this.updateBlockPositions=function(){for(var t in _this.blockList)_this._moveBlock(t,_this.blockList[t].container.x,_this.blockList[t].container.y)},this.bringToTop=function(){for(var t in _this._adjustTheseStacks=[],_this.blockList)null==_this.blockList[t].connections[0]&&_this._adjustTheseStacks.push(t);for(var e=0;e<_this._adjustTheseStacks.length;e++)_this.raiseStackToTop(_this._adjustTheseStacks[e]);_this.activity.refreshCanvas()},this.checkBounds=function(){var t,e=!0;for(t in _this.blockList)if(null==_this.blockList[t].connections[0]&&_this.blockList[t].offScreen(_this.boundary)){_this.activity.setHomeContainers(!0),e=!1;break}e&&(_this.activity.setHomeContainers(!1),_this.boundary.hide())},this.moveBlock=function(t,e,i){_this._moveBlock(t,e,i),_this.adjustDocks(t,!0)},this._moveBlock=function(t,e,i){t=_this.blockList[t];null!=t.container?(t.container.x=Math.floor(e+.5),t.container.y=Math.floor(i+.5),_this.checkBounds()):console.debug("No container yet for block "+t.name)},this.moveBlockRelative=function(t,e,i){_this.inLongPress=!1,_this.isBlockMoving=!0;t=_this.blockList[t];null!=t.container?(t.container.x+=e,t.container.y+=i,_this.checkBounds()):console.debug("No container yet for block "+t.name)},this.moveStackRelative=function(t,e,i){if(_this.findDragGroup(t),0<_this.dragGroup.length)for(var o=0;o<_this.dragGroup.length;o++)_this.moveBlockRelative(_this.dragGroup[o],e,i)},this.moveAllBlocksExcept=function(t,e,i){for(var o in _this.blockList)_this.blockList[_this.findTopBlock(o)]!==t&&_this.moveBlockRelative(o,e,i)},this.updateBlockText=function(t){var e,i,o=_this.blockList[t],s=8;if(null!=o.text){switch(o.name){case"loadFile":try{c=o.value[0].toString()}catch(t){c=_("open file")}s=10;break;case"audiofile":try{null===o.value[0]?c=_("audio file"):(c=o.value[0].toString(),getTextWidth(c,"bold 20pt Sans")>TEXTWIDTH&&(c=c.substr(0,STRINGLEN)+"..."))}catch(t){c=_("audio file")}break;case"solfege":null===o.value&&(o.value="sol"),e=splitSolfege(o.value),c=i18nSolfege(e[0]),(i=e[1])!==NATURAL&&(c+=i);break;case"scaledegree2":null===o.value&&(o.value="4"),c=(e=splitScaleDegree(o.value))[0],(i=e[1])!==NATURAL&&(c+=i);break;case"customNote":c=_(o.value);break;case"eastindiansolfege":null===o.value&&(o.value="sol"),e=splitSolfege(o.value),c=WESTERN2EISOLFEGENAMES[e[0]],(i=e[1])!==NATURAL&&(c+=i);break;case"modename":null===o.value&&(o.value=DEFAULTMODE),c=_(o.value);break;case"chordname":null===o.value&&(o.value=DEFAULTCHORD),c=_(o.value);break;case"accidentalname":case"intervalname":if(null===o.value)switch(o.name){case"accidentalname":o.value=DEFAULTACCIDENTAL;break;case"intervalname":o.value=DEFAULTINTERVAL}e=o.value.split(" "),c=_(e[0])+" "+e[1];break;case"grid":c=_(o.value);break;case"filtertype":case"drumname":case"effectsname":case"voicename":case"oscillatortype":case"invertmode":if(null===o.value)switch(o.name){case"filtertype":o.value=DEFAULTFILTERTYPE;break;case"drumname":o.value=DEFAULTDRUM;break;case"effectsname":o.value=DEFAULTEFFECT;break;case"voicename":o.value=DEFAULTVOICE;break;case"oscillatortype":o.value=DEFAULTOSCILLATORTYPE;break;case"invertmode":o.value=DEFAULTINVERT}c=_(o.value);break;case"noisename":c=getNoiseName(o.value);break;case"temperamentname":for(var n=getTemperamentsList(),c=_(n[0][1]),l=0;l<n.length;l++)if(n[l][1]===o.value){c=0===n[l][0].length?n[l][2]:n[l][0];break}break;case"wrapmode":c="on"===o.value?_("on2"):_("off");break;case"boolean":c=o.value?_("true"):_("false");break;default:c=null==o.value?"":"string"!=typeof o.value?o.value.toString():o.value}!WIDENAMES.includes(o.name)&&c.length>s&&(c=c.substr(0,s-1)+"..."),o.text.text=c;var a=o.container.children.length-1;o.container.setChildIndex(o.text,a),o.loadComplete?o.container.updateCache():console.debug("Load not yet complete for ("+t+") "+o.name)}},this.findTopBlock=function(t){if(null==t)return null;var e=_this.blockList[t];if(null!=e.connections&&0!==e.connections.length)if(1<e.connections.length&&null!=e.connections[0]&&e.connections[0]===last(e.connections))console.debug("WARNING: CORRUPTED BLOCK DATA. Block "+e.name+" ("+t+") is connected to the same block "+_this.blockList[e.connections[0]].name+" ("+e.connections[0]+") twice.");else for(var i=0;null!=e.connections[0];){if((i+=1)>2*_this.blockList.length){console.debug("infinite loop finding topBlock?"),console.debug(_this.blockList.indexOf(e)+" "+e.name);break}t=e.connections[0],e=_this.blockList[t]}return t},this.sameGeneration=function(t,e){if(null!=t&&null!=e){if(t===e)return!0;var i=_this.blockList[t];if(null!=i.connections&&0!==i.connections.length)for(var o=0;null!=last(i.connections);){if((o+=1)>2*_this.blockList.length){console.debug("infinite loop finding bottomBlock?");break}var s=last(i.connections),i=_this.blockList[s];if(s===e)return!0}}return!1},this._blockInStack=function(t,e){for(var i=0;null!=t;){if(e.includes(_this.blockList[t].name))return!0;if(t=1<_this.blockList[t].connections.length?last(_this.blockList[t].connections):null,(i+=1)>_this.blockList.length){console.debug("infinite loop finding block name in stack");break}}return!1},this.findBottomBlock=function(t){if(null==t)return null;var e=_this.blockList[t];if(null!=e.connections&&0!==e.connections.length)for(var i=0;null!=last(e.connections);){if((i+=1)>2*_this.blockList.length){console.debug("infinite loop finding bottomBlock?");break}t=last(e.connections),e=_this.blockList[t]}return t},this._countBlocksInStack=function(t){var e=0;if(null!==t){e+=1;for(var i=1;i<_this.blockList[t].connections.length;i++)e+=_this._countBlocksInStack(_this.blockList[t].connections[i])}return e},this.findStacks=function(){_this.stackList=[];for(var t=0;t<_this.blockList.length;t++)null==_this.blockList[t].connections[0]&&_this.stackList.push(t)},this._findClamps=function(){_this._expandablesList=[],_this.findStacks();for(var t=0;t<_this.stackList.length;t++)_this._searchCounter=0,_this._searchForExpandables(_this.stackList[t]);_this._searchForArgFlow()},this._findTwoArgs=function(){_this._expandablesList=[];for(var t=0;t<_this.blockList.length;t++)(_this.blockList[t].isArgBlock()&&_this.blockList[t].isExpandableBlock()||_this.blockList[t].isTwoArgBlock())&&_this._expandablesList.push(t)},this._searchForArgFlow=function(){for(var t in _this.blockList)_this.blockList[t].isArgFlowClampBlock()&&(_this._searchCounter=0,_this._searchForExpandables(t),_this._expandablesList.push(t))},this._searchForExpandables=function(t){for(var e;null!=t&&null!=_this.blockList[t]&&!_this.blockList[t].isValueBlock();){if(_this._searchCounter+=1,_this._searchCounter>2*_this.blockList.length){console.debug("infinite loop searching for Expandables? "+_this._searchCounter),console.debug(t+" "+_this.blockList[t].name);break}_this.blockList[t].isClampBlock()?(_this._expandablesList.push(t),e=_this.blockList[t].connections.length-2,_this._searchForExpandables(_this.blockList[t].connections[e]),"ifthenelse"===_this.blockList[t].name&&_this._searchForExpandables(_this.blockList[t].connections[2])):_this.blockList[t].isArgClamp()&&_this._expandablesList.push(t),t=1<_this.blockList[t].connections.length?last(_this.blockList[t].connections):null}},this._expandTwoArgs=function(){_this._findTwoArgs(),_this._adjustExpandableTwoArgBlock(_this._expandablesList),_this.activity.refreshCanvas()},this._expandClamps=function(){_this._findClamps(),_this.clampBlocksToCheck=[];for(var t=0;t<_this._expandablesList.length;t++)"ifthenelse"===_this.blockList[_this._expandablesList[t]].name?(_this.clampBlocksToCheck.push([_this._expandablesList[t],0]),_this.clampBlocksToCheck.push([_this._expandablesList[t],1])):_this.clampBlocksToCheck.push([_this._expandablesList[t],0]);_this.adjustExpandableClampBlock(),_this.activity.refreshCanvas()},this.changeDisabledStatus=function(t,e){for(var i in _this.blockList){i=_this.blockList[i];i.name===t&&(i.protoblock.disabled=e,i.regenerateArtwork(!1))}},this.unhighlightAll=function(){for(var t in _this.blockList)_this.unhighlight(t)},this.unhighlight=function(t){_this.visible&&(null!==(t=null===(t=t)?_this.highlightedBlock:t)&&_this.blockList[t].unhighlight(),_this.highlightedBlock===t)&&(_this.highlightedBlock=null)},this.highlight=function(t,e){_this.visible&&null!==t&&(e&&_this.unhighlight(null),_this.blockList[t].highlight(),_this.highlightedBlock=t)},this.hide=function(){for(var t in _this.blockList)_this.blockList[t].hide();_this.visible=!1},this.show=function(){for(var t in _this.blockList)_this.blockList[t].show();_this.visible=!0},this._makeNewBlockWithConnections=function(t,e,i,o,s){var n=_this.makeNewBlock(t,o,s);if(null===n)console.debug("could not make block "+t);else for(var c=0;c<i.length&&c!==n.docks.length;c++)null==i[c]?n.connections.push(null):n.connections.push(i[c]+e)},this.makeNewBlock=function(t,e,i){return null==_this.protoBlockDict[t]?(console.debug("makeNewBlock: no prototype for "+t),null):(["sine","sawtooth","triangle","square"].includes(t)&&_this.activity.logo.synth.loadSynth(0,t),["namedbox","nameddo","namedcalc","nameddoArg","namedcalcArg","outputtools"].includes(t)?_this.blockList.push(new Block(_this.protoBlockDict[t],_this,i[1])):"namedarg"===t?_this.blockList.push(new Block(_this.protoBlockDict[t],_this,"arg "+i[1])):_this.blockList.push(new Block(_this.protoBlockDict[t],_this)),null==last(_this.blockList)?(console.debug("failed to make protoblock for "+t),null):((t=last(_this.blockList)).copySize(),t.postProcess=e,t.postProcessArg=i,t.container=new createjs.Container,_this.activity.blocksContainer.addChild(t.container),t.container.snapToPixelEnabled=!0,t.container.x=0,t.container.y=0,t.imageLoad(),t))},this.makeBlock=function(t,e){var i,o,n=_this,s=function(t){var e=t[0],i=t[1];switch(n.blockList[e].value=i,n.blockList[e].name){case"drumname":case"effectsname":case"voicename":case"oscillatortype":case"invertmode":case"filtertype":case"noisename":n.blockList[e].text.text=_(i);break;case"temperamentname":var o=getTemperamentsList();n.blockList[e].text.text=_(o[0][1]);for(var s=0;s<o.length;s++)if(o[s][1]===i){n.blockList[e].text.text=o[s][0];break}break;case"wrapmode":n.blockList[e].text.text="on"===i?_("on2"):_("off");break;case"boolean":n.blockList[e].text.text=i?_("true"):_("false");break;default:n.blockList[e].text.text=i}n.blockList[e].container.updateCache()},c=null,l=_this.blockList.length,a=("start"===t?(s=function(t){n.blockList[t].value=n.turtles.getTurtleCount(),n.turtles.addTurtle(n.blockList[t])},c=l):"outputtools"===t?(s=function(t){n.blockList[l].value=null,n.blockList[l].privateData=t[1]},c=[l,e]):"text"===t?c=[l,_("text")]:"boolean"===t?c=[l,!0]:"solfege"===t?c=[l,"sol"]:"scaledegree2"===t?c=[l,"5"]:"customNote"===t?(i=_this.activity.logo.synth.startingPitch.length,c=[l,_this.activity.logo.synth.startingPitch.substring(0,i-1)+"(+0%)"]):"notename"===t?c=[l,"G"]:"drumname"===t?c=[l,DEFAULTDRUM]:"effectsname"===t?c=[l,DEFAULTEFFECT]:"filtertype"===t?c=[l,DEFAULTFILTER]:"oscillatortype"===t?c=[l,DEFAULTOSCILLATORTYPE]:"voicename"===t?c=[l,DEFAULTVOICE]:"noisename"===t?c=[l,DEFAULTNOISE]:"eastindiansolfege"===t?(s=function(t){var e=t[0],t=t[1];n.blockList[e].value=t,n.blockList[e].text.text=WESTERN2EISOLFEGENAMES[t],n.blockList[e].container.updateCache()},c=[l,"sol"]):"modename"===t?(s=function(t){var e=t[0],t=t[1];n.blockList[e].value=t,n.blockList[e].text.text=t,n.blockList[e].container.updateCache()},c=[l,DEFAULTMODE]):"chordname"===t?(s=function(t){var e=t[0],t=t[1];n.blockList[e].value=t,n.blockList[e].text.text=t,n.blockList[e].container.updateCache()},c=[l,DEFAULTCHORD]):"accidentalname"===t?(s=function(t){var e=t[0],t=t[1],t=(n.blockList[e].value=t).split(" ");n.blockList[e].text.text=_(t[0])+" "+t[1],n.blockList[e].container.updateCache()},c=[l,DEFAULTACCIDENTAL]):"intervalname"===t?(s=function(t){var e=t[0],t=t[1],t=(n.blockList[e].value=t).split(" ");n.blockList[e].text.text=_(t[0])+" "+t[1],n.blockList[e].container.updateCache()},c=[l,DEFAULTINTERVAL]):"temperamentname"===t?c=[l,DEFAULTTEMPERAMENT]:"invertmode"===t?c=[l,DEFAULTINVERT]:"number"===t?(s=function(t){var e=t[0],t=Number(t[1]);n.blockList[e].value=t,n.blockList[e].text.text=t.toString(),n.blockList[e].container.updateCache()},c=[l,NUMBERBLOCKDEFAULT]):"loudness"===t||"pitchness"===t?s=function(){n.activity.logo.initMediaDevices()}:"media"===t?(s=function(t){var e=t[0],t=t[1];n.blockList[e].value=t,n.blockList[e].image=null==t?"images/load-media.svg":null},c=[l,null]):"camera"===t?(s=function(t){var e=t[0],t=t[1];n.blockList[e].value=CAMERAVALUE,n.blockList[e].image=null==t?"images/camera.svg":null},c=[l,null]):"video"===t?(s=function(t){var e=t[0],t=t[1];n.blockList[e].value=VIDEOVALUE,n.blockList[e].image=null==t?"images/video.svg":null},c=[l,null]):"loadFile"===t?(s=function(t){n.updateBlockText(t[0])},c=[l,null]):["storein2","namedbox","nameddo","namedcalc","nameddoArg","namedcalcArg","namedarg"].includes(t)?(s=function(t){n.blockList[l].value=null,n.blockList[l].privateData=t[1]},c=[l,e]):"newnote"===t?(s=function(){},c=[l,null]):s=null,!1);for(o in n.protoBlockDict)if(n.protoBlockDict[o].name===t){if("__NOARG__"===e){n.makeNewBlock(o,s,c),a=!0;break}if(n.protoBlockDict[o].defaults[0]===e){n.makeNewBlock(o,s,c),a=!0;break}if(["namedbox","nameddo","namedcalc","nameddoArg","namedcalcArg","namedarg"].includes(t)){if(void 0===n.protoBlockDict[o].defaults[0]){n.makeNewBlock(o,s,c),a=!0;break}}else{if("storein2"===t){s=function(t){var e=n.blockList[l].connections[0];t[1]===_("store in box")?n.blockList[e].privateData=_("box"):(n.blockList[e].privateData=t[1],"box1"===t[1]?n.blockList[e].overrideName=_("box1"):"box2"===t[1]?n.blockList[e].overrideName=_("box2"):n.blockList[e].overrideName=t[1],n.blockList[e].regenerateArtwork(!1))},c=[l,e],n.makeNewBlock(o,s,c),a=!0;break}if("outputtools"===t&&void 0===n.protoBlockDict[o].defaults[0]){n.makeNewBlock(o,s,c),a=!0;break}}}a||console.debug(t+" not found!!");for(var r=_this.blockList.length-1,h=_this.blockList[r],u=0;u<h.docks.length;u++)h.connections.push(null);for(var k=1+r,b=0;b<h.protoblock.defaults.length;b++)(()=>{var i=h.protoblock.defaults[b],t=("action"===h.name&&(i=_this.findUniqueActionName(_("action")))!==_("action")&&(_this.newNameddoBlock(i,!1,!1),_this.activity.palettes.updatePalettes("action")),l=_this.blockList.length,h.docks.length>b&&"anyin"===h.docks[b+1][2]?null==i?console.debug("cannot set default value"):"string"==typeof i?(s=function(t){var e=t[0],t=(n.blockList[e].value=t[1],i.toString());!WIDENAMES.includes(n.blockList[e].name)&&getTextWidth(t,"bold 20pt Sans")>TEXTWIDTH&&(t=t.substr(0,STRINGLEN)+"..."),n.blockList[e].text.text=t,n.blockList[e].container.updateCache()},_this.makeNewBlock("text",s,[l,i])):(s=function(t){var e=t[0],t=Number(t[1]);n.blockList[e].value=t,n.blockList[e].text.text=t.toString()},_this.makeNewBlock("number",s,[l,i])):"textin"===h.docks[b+1][2]?(s=function(t){var e=t[0],t=t[1],t=(n.blockList[e].value=t).toString();!WIDENAMES.includes(n.blockList[e].name)&&getTextWidth(t,"bold 20pt Sans")>TEXTWIDTH&&(t=t.substr(0,STRINGLEN)+"..."),n.blockList[e].text.text=t},_this.makeNewBlock("text",s,[l,i])):"solfegein"===h.docks[b+1][2]?(s=function(t){var e=t[0],t=t[1],t=(n.blockList[e].value=t,i18nSolfege(t.toString()));n.blockList[e].text.text=t},_this.makeNewBlock("solfege",s,[l,i])):"notein"===h.docks[b+1][2]?(s=function(t){var e=t[0],t=t[1],t=(n.blockList[e].value=t).toString();n.blockList[e].text.text=t},_this.makeNewBlock("notename",s,[l,i])):"mediain"===h.docks[b+1][2]?(s=function(t){var e=t[0],t=t[1];n.blockList[e].value=t},_this.makeNewBlock("media",s,[l,i])):"filein"===h.docks[b+1][2]?(s=function(t){n.updateBlockText(t)},_this.makeNewBlock("loadFile",s,l)):(s=function(t){var e=t[0],t=t[1];n.blockList[e].value=t,n.blockList[e].text.text=t.toString()},_this.makeNewBlock("number",s,[l,i])),_this.blockList[k+b]);t.connections=[r],t.value=i,h.connections[b+1]=k+b})();return _this.updateBlockPositions(),_this.adjustDocks(r,!0),_this.activity.refreshCanvas(),r},this.findDragGroup=function(t){null==t?console.debug("null block passed to findDragGroup"):(_this.dragLoopCounter=0,_this.dragGroup=[],_this._calculateDragGroup(t))},this._calculateDragGroup=function(t){if(_this.dragLoopCounter+=1,_this.dragLoopCounter>_this.blockList.length)console.debug("Maximum loop counter exceeded in calculateDragGroup... this is bad. "+t);else if(null==t)console.debug("null block passed to calculateDragGroup");else{var e=_this.blockList[t];if(null==e)console.debug("null block encountered... this is bad. "+t);else if(null==e.connections)_this.dragGroup=[t];else if(0===e.connections.length)_this.dragGroup=[t];else{_this.dragGroup.push(t);for(var i=1;i<e.connections.length;i++){var o=e.connections[i];null!=o&&_this._calculateDragGroup(o)}}}},this.setActionProtoVisibility=function(t){for(var e=_this.activity.palettes.dict.action,i=!1,o=0;o<e.protoList.length;o++){var s=e.protoList[o];"nameddo"===s.name&&0===s.defaults.length&&s.hidden===t&&(s.hidden=!t,i=!0)}i&&_this.activity.palettes.updatePalettes("action")},this.findUniqueActionName=function(t,e){t===_("action")&&_this.setActionProtoVisibility(!0);var i,o,s=[];for(i in _this.blockList)"text"!==_this.blockList[i].name&&"string"!==_this.blockList[i].name||_this.blockList[i].trash||null===(o=_this.blockList[i].connections[0])||"action"!==_this.blockList[o].name||_this.blockList[o].trash||e!==o&&s.push(_this.blockList[i].value);for(var n=1,c=t;s.includes(c);)c=t+n.toString(),n+=1;return c},this.findUniqueCustomName=function(t){var e,i,o=[];for(e in _this.blockList)"text"!==_this.blockList[e].name||_this.blockList[e].trash||null==(i=_this.blockList[e].connections[0])||"pitch"!==_this.blockList[i].name||_this.blockList[i].trash||o.push(_this.blockList[e].value);for(var s=1,n=t;o.includes(n);)n=t+s.toString(),s+=1;return n},this.findUniqueTemperamentName=function(t){var e,i,o=[];for(e in _this.blockList)"text"!==_this.blockList[e].name||_this.blockList[e].trash||null==(i=_this.blockList[e].connections[0])||"temperament1"!==_this.blockList[i].name||_this.blockList[i].trash||o.push(_this.blockList[e].value);for(var s=1,n=t;o.includes(n);)n=t+s.toString(),s+=1;return n},this._findDrumURLs=function(){for(var t in _this.blockList){var e;"text"!==_this.blockList[t].name&&"string"!==_this.blockList[t].name||null!=(e=_this.blockList[t].connections[0])&&["playdrum","setdrum","playnoise","setvoice"].includes(_this.blockList[e].name)&&"http"===_this.blockList[t].value.slice(0,4)&&_this.activity.logo.synth.loadSynth(0,_this.blockList[t].value)}},this.renameBoxes=function(t,e){if(t!==e&&t!==_("box"))for(var i in _this.blockList)if("text"===_this.blockList[i].name){var o=_this.blockList[i].connections[0];if(null!=o&&"box"===_this.blockList[o].name&&_this.blockList[i].value===t){_this.blockList[i].value=e,_this.blockList[i].text.text=e;try{_this.blockList[i].container.updateCache()}catch(t){console.debug(t)}}}},this.renameStoreinBoxes=function(t,e){if(t!==e&&t!==_("box"))for(var i in _this.blockList)if("text"===_this.blockList[i].name){var o=_this.blockList[i].connections[0];if(null!=o&&"storein"===_this.blockList[o].name&&_this.blockList[i].value===t){_this.blockList[i].value=e,_this.blockList[i].text.text=e;try{_this.blockList[i].container.updateCache()}catch(t){console.debug(t)}}}else if("storein2"===_this.blockList[i].name&&_this.blockList[i].privateData===t){_this.blockList[i].privateData=e,_this.blockList[i].overrideName="box1"===e?_("box1"):"box2"===e?_("box2"):e,_this.blockList[i].regenerateArtwork();try{_this.blockList[i].container.updateCache()}catch(t){console.debug(t)}}},this.renameStorein2Boxes=function(t,e){if(t!==e&&t!==_("box"))for(var i in _this.blockList)if("storein2"===_this.blockList[i].name&&_this.blockList[i].privateData===t){_this.blockList[i].privateData=e,_this.blockList[i].overrideName="box1"===e?_("box1"):"box2"===e?_("box2"):e,_this.blockList[i].regenerateArtwork();try{_this.blockList[i].container.updateCache()}catch(t){console.debug(t)}}},this.renameNamedboxes=function(t,e){if(t!==e&&t!==_("box"))for(var i in _this.blockList)if("namedbox"===_this.blockList[i].name&&_this.blockList[i].privateData===t){_this.blockList[i].privateData=e,_this.blockList[i].overrideName="box1"===e?_("box1"):"box2"===e?_("box2"):e,_this.blockList[i].regenerateArtwork();try{_this.blockList[i].container.updateCache()}catch(t){console.debug(t)}}},this.renameDos=function(t,e,i){if(t!==e)for(var o in _this.blockList){var s,n;o!==i&&(s=_this.blockList[o],null!=(n=_this.blockList[s.connections[0]])&&["do","calc","doArg","calcArg","action","offbeatdo","onbeatdo","listen"].includes(n.name)&&("onbeatdo"!==n.name&&"listen"!==n.name||2===n.connections.indexOf(o))&&s.value===t)&&(s.value=e,n=s.value,getTextWidth(n,"bold 20pt Sans")>TEXTWIDTH&&(n=n.substr(0,STRINGLEN)+"..."),s.text.text=n,s.container.updateCache())}},this.renameNameddos=function(t,e){if(t!==e){for(var i in _this.blockList){var o;["nameddo","namedcalc","nameddoArg","namedcalcArg"].includes(_this.blockList[i].name)&&_this.blockList[i].privateData===t&&(o=_this.blockList[i].privateData=e,getTextWidth(o,"bold 20pt Sans")>TEXTWIDTH&&(o=o.substr(0,STRINGLEN)+"..."),_this.blockList[i].overrideName=o,_this.blockList[i].regenerateArtwork())}for(var s=_this.activity.palettes.dict.action,n=!1,c=0;c<s.protoList.length;c++){var l=s.protoList[c];-1!==["nameddo","namedcalc","nameddoArg","namedcalcArg"].indexOf(l.name)&&l.defaults[0]===t&&(l.defaults[0]=e,n=!0)}n&&_this.activity.palettes.updatePalettes("action")}},this.newStoreinBlock=function(t){var e;null==t?console.debug("null name passed to newStoreinBlock"):"myStorein_"+t in _this.protoBlockDict||(e=new ProtoBlock("storein"),(_this.protoBlockDict["myStorein_"+t]=e).palette=_this.activity.palettes.dict.boxes,e.defaults.push(t),e.defaults.push(NUMBERBLOCKDEFAULT),e.staticLabels.push(_("store in"),_("name"),_("value")),e.adjustWidthToLabel(),e.twoArgBlock(),e.dockTypes[1]="anyin",e.dockTypes[2]="anyin","box"!==t&&_this.activity.palettes.dict.boxes.add(e,!0))},this.newStorein2Block=function(t){var e;null==t?console.debug("null name passed to newStorein2Block"):"yourStorein2_"+t in _this.protoBlockDict||(e=new ProtoBlock("storein2"),(_this.protoBlockDict["yourStorein2_"+t]=e).palette=_this.activity.palettes.dict.boxes,e.defaults.push(t),e.staticLabels.push(t),e.adjustWidthToLabel(),e.oneArgBlock(),e.dockTypes[1]="anyin","box"!==t&&_this.activity.palettes.dict.boxes.add(e,!0))},this.newNamedboxBlock=function(t){var e;null==t?console.debug("null name passed to newNamedboxBlock"):"myBox_"+t in _this.protoBlockDict||(e=new ProtoBlock("namedbox"),(_this.protoBlockDict["myBox_"+t]=e).palette=_this.activity.palettes.dict.boxes,e.defaults.push(t),e.staticLabels.push(t),e.parameterBlock(),"box"!==t&&e.palette.add(e,!0))},this._newLocalArgBlock=(()=>{var e=_asyncToGenerator(_regenerator().m(function t(e){var i,o;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if("myArg_"+(i="arg_"+e)in _this.protoBlockDict)return t.a(2);t.n=1;break;case 1:if(o=new ProtoBlock("namedarg"),(_this.protoBlockDict["myArg_"+i]=o).palette=_this.activity.palettes.dict.action,o.defaults.push(e),o.staticLabels.push("arg "+e),o.parameterBlock(),"arg_1"===i)return t.a(2);t.n=2;break;case 2:return o.palette.add(o,!0),t.n=3,delayExecution(100);case 3:_this.activity.palettes.updatePalettes("action");case 4:return t.a(2)}},t)}));return function(t){return e.apply(this,arguments)}})(),this._removeNamedoEntries=function(t){_this.protoBlockDict["myDo_"+t]?(_this.protoBlockDict["myDo_"+t].hide=!0,delete _this.protoBlockDict["myDo_"+t]):_this.protoBlockDict["myCalc_"+t]?(_this.protoBlockDict["myCalc_"+t].hide=!0,delete _this.protoBlockDict["myCalc_"+t]):_this.protoBlockDict["myDoArg_"+t]?(_this.protoBlockDict["myDoArg_"+t].hide=!0,delete _this.protoBlockDict["myDoArg_"+t]):_this.protoBlockDict["myCalcArg_"+t]&&(_this.protoBlockDict["myCalcArg_"+t].hide=!0,delete _this.protoBlockDict["myCalcArg_"+t])},this.newNameddoBlock=function(t,e,i){return t!==_("action")&&(e&&i?_this.newNamedcalcArgBlock(t):!e&&i?_this.newNameddoArgBlock(t):e&&!i?_this.newNamedcalcBlock(t):void 0===_this.protoBlockDict["myDo_"+t]&&(e=new ProtoBlock("nameddo"),(_this.protoBlockDict["myDo_"+t]=e).palette=_this.activity.palettes.dict.action,e.defaults.push(t),e.staticLabels.push(t),e.zeroArgBlock(),e.palette.add(e,!0),_this.activity.palettes.updatePalettes(),!0))},this.newNamedcalcBlock=function(t){var e;return void 0===_this.protoBlockDict["myCalc_"+t]&&(e=new ProtoBlock("namedcalc"),(_this.protoBlockDict["myCalc_"+t]=e).palette=_this.activity.palettes.dict.action,e.defaults.push(t),e.staticLabels.push(t),e.zeroArgBlock(),e.palette.add(e,!0),!0)},this.newNameddoArgBlock=function(t){var e;return void 0===_this.protoBlockDict["myDoArg_"+t]&&(e=new ProtoBlock("nameddoArg"),(_this.protoBlockDict["myDoArg_"+t]=e).palette=_this.activity.palettes.dict.action,e.defaults.push(t),e.staticLabels.push(t),e.zeroArgBlock(),e.palette.add(e,!0),!0)},this.newNamedcalcArgBlock=function(t){var e;return void 0===_this.protoBlockDict["myCalcArg_"+t]&&(e=new ProtoBlock("namedcalcArg"),(_this.protoBlockDict["myCalcArg_"+t]=e).palette=_this.activity.palettes.dict.action,e.defaults.push(t),e.staticLabels.push(t),e.zeroArgBlock(),e.palette.add(e,!0),!0)},this._insideArgClamp=function(t){return null==_this.blockList[t]?(console.debug("null block in blockList? "+t),null):null!=_this.blockList[t].connections[0]&&(t=_this.blockList[t].connections[0],_this.blockList[t].isArgClamp())?t:null},this.findNestedClampBlocks=function(t,e){return null==_this.blockList[t]?(console.debug("null block in blockList? "+t),[]):null==_this.blockList[t].connections[0]?e:(t=_this.blockList[t].connections[0],_this.blockList[t].isClampBlock()&&(_this.blockList[t].isDoubleClampBlock()?(e.push([t,0]),e.push([t,1])):e.push([t,0])),_this.findNestedClampBlocks(t,e))},this.insideExpandableBlock=function(t){var e;return null==_this.blockList[t]?(console.debug("null block in blockList? "+t),null):null==_this.blockList[t].connections[0]?null:(e=_this.blockList[t].connections[0],!_this.blockList[e].isExpandableBlock()||!_this.blockList[e].isArgFlowClampBlock()&&!_this.blockList[e].isLeftClampBlock()&&t===last(_this.blockList[e].connections)?_this.insideExpandableBlock(e):e)},this._insideNoteBlock=function(t){var e;return null==_this.blockList[t]?(console.debug("null block in blockList? "+t),null):null==_this.blockList[t].connections[0]?null:(e=_this.blockList[t].connections[0],_this.blockList[e].isExpandableBlock()?"forever"===_this.blockList[t].name&&_this._isConnectedToNoteValue(e)?(_this.activity.errorMsg(_("Forever loop detected inside a note value block. Unexpected things may happen.")),null):t===last(_this.blockList[e].connections)?_this._insideNoteBlock(e):t!==_this.blockList[e].connections[1]&&NOTEBLOCKS.includes(_this.blockList[e].name)?e:null:_this._insideNoteBlock(e))},this._isConnectedToNoteValue=function(t){return!!NOTEBLOCKS.includes(_this.blockList[t].name)||null!=_this.blockList[t].connections[0]&&(t=_this.blockList[t].connections[0],_this._isConnectedToNoteValue(t))},this.findBlockInstance=function(t){for(var e in _this.blockList)if(_this.blockList[e].name===t&&!_this.blockList[e].trash)return!0;return!1},this.insideInlineCollapsibleBlock=function(t){var e;return null===t||null===(e=_this.blockList[t].connections[0])?null:_this.blockList[e].isInlineCollapsible()&&t!==last(_this.blockList[e].connections)?e:_this.insideInlineCollapsibleBlock(e)},this.findNoteBlock=function(t){var e,i;return null===t?null:"newnote"===_this.blockList[t].name?t:(i=last(_this.blockList[t].connections),_this.blockList[t].isClampBlock()&&(e=_this.blockList[t].connections.length-2,i=_this.blockList[t].connections[e]),_this.findNoteBlock(i))},this.findNestedIntervalBlock=function(t){var e,i;return null===t?null:"interval"===_this.blockList[t].name?t:(i=last(_this.blockList[t].connections),_this.blockList[t].isClampBlock()&&(e=_this.blockList[t].connections.length-2,i=_this.blockList[t].connections[e]),_this.findNestedIntervalBlock(i))},this.findFirstPitchBlock=function(t){return null===t?null:PITCHBLOCKS.includes(_this.blockList[t].name)||"rest2"===_this.blockList[t].name?t:(t=last(_this.blockList[t].connections),_this.findFirstPitchBlock(t))},this.findPitchOctave=function(t){return null!==t&&["pitch","setpitchnumberoffset","invert1","tofrequency","nthmodalpitch"].includes(_this.blockList[t].name)&&null!==(t=_this.blockList[t].connections[2])&&"number"===_this.blockList[t].name?_this.blockList[t].value:4},this.setPitchOctave=function(t,e){null!==t&&["pitch","setpitchnumberoffset","invert1","tofrequency","nthmodalpitch"].includes(_this.blockList[t].name)&&null!==(t=_this.blockList[t].connections[2])&&"number"===_this.blockList[t].name&&((t=_this.blockList[t]).value=e,t.text.text=e.toString(),e=t.container.children.length-1,t.container.setChildIndex(t.text,e),t.container.updateCache())},this.intervalModifierNumber=function(t){var e;return null!==t&&(e=(t=_this.blockList[t]).connections[0],"number"===t.name)&&null!==e&&"plus"===_this.blockList[e].name&&null!==(t=_this.blockList[e].connections[0])&&!!["interval","setscalartransposition","semitoneinterval","settransposition"].includes(_this.blockList[t].name)},this.octaveModifierNumber=function(t){if(null!==t){var e=_this.blockList[t],i=e.connections[0];if("number"===e.name&&null!==i&&"multiply"===_this.blockList[i].name){e=_this.blockList[i].connections[1];if(_this.blockList[i].connections[1]===t&&(e=_this.blockList[i].connections[2]),"modelength"===_this.blockList[e].name)return!0;if("number"===_this.blockList[e].name&&12===_this.blockList[e].value)return!0}}return!1},this.noteValueNumber=function(t,e){if(null!==t){var i=_this.blockList[t],o=i.connections[0];if("number"===i.name&&null!==o&&"divide"===_this.blockList[o].name&&_this.blockList[o].connections[e]===_this.blockList.indexOf(i)){var s=_this.blockList[o].connections[0];if(null!==s)switch(_this.blockList[s].name){case"newnote":case"pickup":case"tuplet4":case"newstaccato":case"newslur":case"elapsednotes2":return _this.blockList[s].connections[1]===o?!0:!1;case"meter":return _this.blockList[t]._check_meter_block=s,_this.blockList[s].connections[2]===o?!0:!1;case"setbpm3":case"setbpm2":case"setmasterbpm2":case"stuplet":case"rhythm2":case"newswing2":case"vibrato":case"neighbor":case"neighbor2":return _this.blockList[s].connections[2]===o?!0:!1;default:return!1}}}return!1},this.noteValueValue=function(t){if(null!==t){var e=_this.blockList[t].connections[0],i=_this.blockList[e].connections[0];if(null!==i)switch(_this.blockList[i].name){case"newnote":case"pickup":case"tuplet4":case"newstaccato":case"newslur":case"elapsednotes2":return _this.blockList[i].connections[1]===e?(i=_this.blockList[e].connections[2],_this.blockList[i].value):1;case"meter":return _this.blockList[t]._check_meter_block=i,_this.blockList[i].connections[2]===e?_this.blockList[i].connections[1]===e?(i=_this.blockList[e].connections[2],_this.blockList[i].value):1:1;case"setbpm3":case"setbpm2":case"setmasterbpm2":case"stuplet":case"rhythm2":case"newswing2":case"vibrato":case"neighbor":case"neighbor2":return _this.blockList[i].connections[2]===e?_this.blockList[i].connections[1]===e?(i=_this.blockList[e].connections[2],_this.blockList[i].value):1:1;default:return 1}}return 1},this.octaveNumber=function(t){var e;return null!==t&&(!(null===(e=_this.blockList[t]).connections[0]||!["pitch","setpitchnumberoffset","invert1","tofrequency","nthmodalpitch"].includes(_this.blockList[e.connections[0]].name)||_this.blockList[e.connections[0]].connections[2]!==t)||null!==e.connections[0]&&"customsample"===_this.blockList[e.connections[0]].name&&_this.blockList[e.connections[0]].connections[3]===t)},this.meter_block_changed=function(t){if(null!==t&&"meter"===_this.blockList[t].name){var e=_this.blockList[t].connections[2];if(null!==e&&"divide"===_this.blockList[e].name){t=_this.blockList[e].connections[1];if(null!==t&&"number"===_this.blockList[t].name){var i=_this.blockList[t].value,t=_this.blockList[e].connections[2];if(null!==t&&"number"===_this.blockList[t].name)for(var o,s,n,c,l,a=_this.blockList[t].value,r=0;r<_this.blockList.length;r++)["setbpm3","setmasterbpm2"].includes(_this.blockList[r].name)&&null!==(o=_this.blockList[r].connections[1])&&"number"===_this.blockList[o].name&&(s=_this.blockList[o].value,null!==(e=_this.blockList[r].connections[2]))&&"divide"===_this.blockList[e].name&&null!==(n=_this.blockList[e].connections[1])&&"number"===_this.blockList[n].name&&(c=_this.blockList[n].value,null!==(l=_this.blockList[e].connections[2]))&&"number"===_this.blockList[l].name&&(s*=c*a/_this.blockList[l].value*i,_this.blockList[o].value=s,_this.updateBlockText(o),_this.blockList[n].value=i,_this.updateBlockText(n),_this.blockList[l].value=a,_this.updateBlockText(l))}}}},this.prepareStackForCopy=function(){null==_this.activeBlock?(_this.activity.errorMsg(_("There is no block selected.")),console.debug("No active block to copy.")):(_this.selectedStack=_this.activeBlock,_this.selectedBlocksObj=JSON.parse(JSON.stringify(_this._copyBlocksToObj(!1))),_this.pasteDx=0,_this.pasteDy=0)},this.triggerLongPress=function(){null!=_this.longPressTimeout&&(clearTimeout(_this.longPressTimeout),_this.longPressTimeout=null),_this.inLongPress=!0,piemenuBlockContext(_this.blockList[_this.activeBlock])},this.pasteStack=function(){if(null!=_this.selectedStack){for(var t in _this.activity.palettes.dict)_this.activity.palettes.dict[t].hideMenu(!0);null!=_this.selectedBlocksObj&&("none"!==docById("helpfulWheelDiv").style.display?(_this.selectedBlocksObj[0][2]=docById("helpfulWheelDiv").offsetLeft+240-_this.activity.blocksContainer.x,_this.selectedBlocksObj[0][3]=docById("helpfulWheelDiv").offsetTop+130-_this.activity.blocksContainer.y,docById("helpfulWheelDiv").style.display="none"):(_this.selectedBlocksObj[0][2]=175-_this.activity.blocksContainer.x+_this.pasteDx,_this.selectedBlocksObj[0][3]=75-_this.activity.blocksContainer.y+_this.pasteDy,_this.pasteDx+=21,_this.pasteDy+=21),_this.loadNewBlocks(_this.selectedBlocksObj),_this.activity.__tick())}},this.saveStack=function(){if(console.debug(_this.selectedStack),null!==_this.selectedStack){var t=_this._copyBlocksToObj(!0),e="---";if(["temperament1","definemode","action"].includes(t[0][1])){var i=t[0][4][1];null==i?console.debug("action not named... skipping"):e="string"==typeof t[i][1][1]?t[i][1][1]:"number"==typeof t[i][1][1]?t[i][1][1].toString():t[i][1][1].value}else for(var o=0;o<t.length;o++)if(["show","turtleshell","customsample"].includes(t[o][1])){switch(t[o][1]){case"show":e=_("Show").toLowerCase()+"-"+MathUtility.doRandom(0,1e3);break;case"turtleshell":e=_("avatar")+"-"+MathUtility.doRandom(0,1e3);break;case"sample":e=_("sample")+"-"+MathUtility.doRandom(0,1e3);break;default:e=t[o][1]+"-"+MathUtility.doRandom(0,1e3)}break}_this.storage.macros=prepareMacroExports(e,t,_this.macroDict),_this.addToMyPalette(e),_this.activity.palettes.updatePalettes("myblocks")}},this._copyBlocksToObj=function(t){var e,i=[],o={};_this.findDragGroup(_this.selectedStack);for(var s=0;s<_this.dragGroup.length;s++){var n=_this.blockList[_this.dragGroup[s]],c=0===s?(e=75-_this.activity.blocksContainer.x,75-_this.activity.blocksContainer.y):e=0,l=void 0;if(n.isValueBlock())switch(n.name){case"media":case"audiofile":l=t?[s,[n.name,{value:n.value}],e,c,[]]:[s,[n.name,null],e,c,[]];break;case"namedbox":case"namedarg":l=[s,[n.name,{value:n.privateData}],e,c,[]];break;default:l=[s,[n.name,{value:n.value}],e,c,[]]}else l=["storein2","nameddo","namedcalc","nameddoArg","namedcalcArg","outputtools"].includes(n.name)?[s,[n.name,{value:n.privateData}],e,c,[]]:[s,n.name,e,c,[]];o[_this.dragGroup[s]]=s,i.push(l)}for(var a=0;a<_this.dragGroup.length;a++)for(var r=_this.blockList[_this.dragGroup[a]],h=0;h<r.connections.length;h++)null===r.connections[h]?i[a][4].push(null):i[a][4].push(o[r.connections[h]]);return i},this.addToMyPalette=function(t){var e=new ProtoBlock("macro_"+t),i="macro_"+t;_this.protoBlockDict[i]=e,console.debug("Adding "+t+" to myblocks palette"),"myblocks"in _this.activity.palettes.dict||_this.activity.palettes.add("myblocks"),e.palette=_this.activity.palettes.dict.myblocks,e.zeroArgBlock(),e.staticLabels.push(_(t)),_this.protoBlockDict[i].palette.add(_this.protoBlockDict[i])},this.findBlockInstance=function(t){for(var e in _this.blockList)if(_this.blockList[e].name===t&&!_this.blockList[e].trash)return!0;return!1},this.loadNewBlocks=function(u){for(var t=null,e=0;e<u.length;e++)if("number"==typeof u[e][1]){t=e;break}null!==t&&(console.debug("Removing deprecated playback queue from project"),u.splice(t,u.length-t));for(var i=0;i<u.length;i++){var o,s=u[i];for(o in s[4])if(s[4][o]===s[0])return console.debug("Circular connection in block data: "+s),console.debug("Punting loading of new blocks!"),void console.debug(u)}for(var n=[],c=[],l=0;l<_this.blockList.length;l++)_this.blockList[l].trash||("action"===_this.blockList[l].name?null!=_this.blockList[l].connections[1]&&n.push(_this.blockList[_this.blockList[l].connections[1]].value):"storein"===_this.blockList[l].name&&null!=_this.blockList[l].connections[1]&&c.push(_this.blockList[_this.blockList[l].connections[1]].value));_this._checkTwoArgBlocks=[],_this._checkArgClampBlocks=[];var a={},r={},h={},k={};_this.blocksToCollapse=[];for(var b=0;b<u.length;b++){var d,L=u[b];if(!((d="string"==typeof L[1]?L[1]:L[1][0])in _this.protoBlockDict))switch(d){case"hat":d="action";break;case"string":d="text";break;default:console.debug("skipping "+d);continue}["arg","twoarg"].includes(_this.protoBlockDict[d].style)&&_this.protoBlockDict[d].expandable&&_this._checkTwoArgBlocks.push(_this.blockList.length+b),["clamp","argclamp","argclamparg","doubleclamp","argflowclamp"].includes(_this.protoBlockDict[d].style)&&_this._checkArgClampBlocks.push(_this.blockList.length+b);var p;switch(d){case"text":void 0===a[p=L[1][1]]&&(a[p]=[]),a[p].push(b);break;case"action":case"hat":null!=L[4][1]&&(r[b]=L[4][1]);break;case"storein":null!=L[4][1]&&(h[b]=L[4][1]);break;case"nameddo":case"namedcalc":case"nameddoArg":case"namedcalcArg":k[b]=L[1][1].value;break;case"do":case"stack":null!=L[4][1]&&(k[b]=L[4][1])}COLLAPSIBLES.includes(d)&&"object"===_typeof(L[1])&&1<L[1].length&&"object"===_typeof(L[1][1])&&"collapsed"in L[1][1]&&L[1][1].collapsed&&_this.blocksToCollapse.push(_this.blockList.length+b)}var m,f,g=!1;for(m in h){var v=u[h[m]];c.includes(v[1][1])||(d="string"==typeof v[1][1]?v[1][1]:v[1][1].value,_this.newStorein2Block(d),_this.newNamedboxBlock(d),g=!0)}for(f in r){for(var B=u[r[f]],y=((d="string"==typeof B[1][1]?B[1][1]:B[1][1].value)===_("action")&&_this.setActionProtoVisibility(!0),d),W=1;n.includes(d);)if(d=y+W.toString(),(W+=1)>_this.blockList.length){console.debug("Could not generate unique action name.");break}n.push(d),y!==d&&(console.debug("action "+y+" is being renamed "+d),B[1][1]={value:d});var C,j=void 0;for(C in k){var x=u[C],j="string"==typeof x[1]?x[1]:x[1][0];["nameddo","namedcalc","nameddoArg","namedcalcArg"].includes(j)?x[1][1].value===y&&(x[1][1]={value:d}):"string"==typeof(x=u[k[C]])[1][1]?x[1][1]===y&&(x[1][1]=d):x[1][1].value===y&&(x[1][1]={value:d})}}g&&_this.activity.palettes.updatePalettes("action");for(var T,A,D=u.length,w=0,S=0;S<D;S++)switch(d="object"===_typeof(u[S][1])?u[S][1][0]:u[S][1]){case"arpeggio":case"articulation":case"backward":case"crescendo":case"drift":case"duplicatenotes":case"interval":case"invert1":case"fill":case"flat":case"hollowline":case"multiplybeatfactor":case"note":case"newnote":case"newslur":case"newstaccato":case"newswing":case"newswing2":case"osctime":case"pluck":case"ratiointerval":case"rhythmicdot":case"semitoneinterval":case"setbpm":case"setnotevolume2":case"setratio":case"setscalartransposition":case"settransposition":case"setvoice":case"sharp":case"skipnotes":case"slur":case"staccato":case"swing":case"tie":case"tuplet2":case"vibrato":var N,E,O=u[S][4].length;null==last(u[S][4])?(console.debug("last connection of "+d+" is null: adding hidden block"),console.debug(u[S][4]),u[S][4][O-1]=D+w,u.push([D+w,"hidden",0,0,[S,null]]),w+=1):(E=u[S][4][O-1],N=void 0,"hidden"!==(N="object"===_typeof(u[E][1])?u[E][1][0]:u[E][1])&&(console.debug("last connection of "+d+" is "+N+": adding hidden block"),u[S][4][O-1]=D+w,u[E][4][0]=D+w,u.push([D+w,"hidden",0,0,[S,E]]),w+=1)),["note","slur","staccato","swing"].includes(d)&&(N=u[S][4][2],u[S][4][2]=D+w,null==N?u.push([D+w,"vspace",0,0,[S,null]]):(u[N][4][0]=D+w,u.push([D+w,"vspace",0,0,[S,N]])),w+=1,E=u[S][4][1],u[S][4][1]=D+w,null==E?(u.push([D+w,"divide",0,0,[S,D+w+1,D+w+2]]),u.push([D+w+1,["number",{value:1}],0,0,[D+w]]),u.push([D+w+2,["number",{value:1}],0,0,[D+w]]),w+=3):(u[E][4][0]=D+w,u.push([D+w,"divide",0,0,[S,D+w+1,E]]),u.push([D+w+1,["number",{value:1}],0,0,[D+w]]),w+=2),"object"===_typeof(u[S][1])?u[S][1][0]="new"+d:u[S][1]="new"+d);break;case"action":O=u[S][4].length,null==u[S][4][2]?(console.debug("last connection of "+d+" is null: adding hidden block"),u[S][4][2]=D+w,u.push([D+w,"hidden",0,0,[S,null]]),w+=1):(T=u[S][4][2],A=void 0,"hidden"!==(A="object"===_typeof(u[T][1])?u[T][1][0]:u[T][1])&&(console.debug("last connection of "+d+" is "+A+": adding hidden block"),u[S][4][2]=D+w,u[T][4][0]=D+w,u.push([D+w,"hidden",0,0,[S,T]]),w+=1))}_this._adjustTheseStacks=[],_this._adjustTheseDocks=[],_this._loadCounter=u.length,_this.activity&&_this.activity.logo&&_this.activity.logo.synth&&_this.activity.logo.synth.preloadProjectSamples(u);for(var I=_this.blockList.length,P=_this.blockList.length,G=0;G<_this._loadCounter;G++)(()=>{var t,e,i=I+G,o=u[G],s=("object"===_typeof(o[1])?1===o[1].length?t=[o[1][0],{value:null}]:["number","string"].includes(_typeof(o[1][1]))?(t=[o[1][0],{value:o[1][1]}],COLLAPSIBLES.includes(o[1][0])&&(t[1].collapsed=!1)):t=o[1]:(t=[o[1],{value:null}],COLLAPSIBLES.includes(o[1])&&(t[1].collapsed=!1)),t[0]),c=(null==t[1]?e=null:(e=t[1].value,null==t[1].text&&0),s in BACKWARDCOMPATIBILIYDICT&&(s=BACKWARDCOMPATIBILIYDICT[s]),_this);switch(_this.findBlockInstance("temperament1")&&(_this.customTemperamentDefined=!0),s){case"start":o[4][0]=null,o[4][2]=null,_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0],t=t[1];c.blockList[e].value=c.turtles.getTurtleCount(),c.turtles.addTurtle(c.blockList[e],t)},[i,t[1]]);break;case"action":case"hat":o[4][0]=null,o[4][3]=null,_this._makeNewBlockWithConnections("action",I,o[4],null,null);break;case"temperament1":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var t=t[1],e="custom";void 0!==t.customName&&(e=t.customName),void 0!==t.customTemperamentNotes&&(deleteTemperamentFromList(e),addTemperamentToDictionary(e,t.customTemperamentNotes),updateTemperaments()),void 0!==t.startingPitch&&(c.activity.logo.synth.startingPitch=t.startingPitch),void 0!==t.octaveSpace&&setOctaveRatio(t.octaveSpace),c.activity.logo.customTemperamentDefined=!0,c.protoBlockDict.custompitch.hidden=!1,c.activity.palettes.updatePalettes("pitch")},[i,t[1]]);break;case"storein2":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0],t=t[1];c.blockList[e].privateData=t,c.blockList[e].value=null,c.blockList[e].overrideName="box1"===t?_("box1"):"box2"===t?_("box2"):t,c.blockList[e].regenerateArtwork()},[i,e]);break;case"namedbox":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0],t=t[1];c.blockList[e].privateData=t,c.blockList[e].overrideName="box1"===t?_("box1"):"box2"===t?_("box2"):t,c.blockList[e].value=null,c.blockList[e].regenerateArtwork()},[i,e]);break;case"namedarg":case"namedcalc":case"nameddo":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0];c.blockList[e].privateData=t[1],c.blockList[e].value=null},[i,e]);break;case"doArg":_this._makeNewBlockWithConnections("doArg",I,o[4],function(t){var e=t[0],i=t[1].length-4;if(0<i){for(var o=c.blockList[e].argClampSlots,s=0;s<i;s++)o.push(1),c._newLocalArgBlock(o.length),c.blockList[e].connections.push(null);c.blockList[e].updateArgSlots(o);for(var n=0;n<t[1].length;n++)null!=t[1][n]?c.blockList[e].connections[n]=t[1][n]+P:c.blockList[e].connections[n]=t[1][n]}c._checkArgClampBlocks.push(e)},[i,o[4]]);break;case"nameddoArg":_this._makeNewBlockWithConnections("nameddoArg",I,o[4],function(t){var e=t[0],i=(c.blockList[e].privateData=t[1],c.blockList[e].value=null,t[2].length-3);if(0<i){for(var o=c.blockList[e].argClampSlots,s=0;s<i;s++)o.push(1),c._newLocalArgBlock(o.length),c.blockList[e].connections.push(null);c.blockList[e].updateArgSlots(o);for(var n=0;n<t[2].length;n++)null!=t[2][n]?c.blockList[e].connections[n]=t[2][n]+P:c.blockList[e].connections[n]=t[2][n]}c._checkArgClampBlocks.push(e)},[i,e,o[4]]);break;case"calcArg":_this._makeNewBlockWithConnections("calcArg",I,o[4],function(t){var e=t[0],i=t[1].length-3;if(0<i){for(var o=c.blockList[e].argClampSlots,s=0;s<i;s++)o.push(1),c._newLocalArgBlock(o.length),c.blockList[e].connections.push(null);c.blockList[e].updateArgSlots(o);for(var n=0;n<t[1].length;n++)null!=t[1][n]?c.blockList[e].connections[n]=t[1][n]+P:c.blockList[e].connections[n]=t[1][n]}c._checkArgClampBlocks.push(e)},[i,o[4]]);break;case"namedcalcArg":_this._makeNewBlockWithConnections("namedcalcArg",I,o[4],function(t){var e=t[0],i=(c.blockList[e].privateData=t[1],c.blockList[e].value=null,t[2].length-2);if(0<i){for(var o=c.blockList[e].argClampSlots,s=0;s<i;s++)o.push(1),c._newLocalArgBlock(o.length),c.blockList[e].connections.push(null);c.blockList[e].updateArgSlots(o);for(var n=0;n<t[2].length;n++)null!=t[2][n]?c.blockList[e].connections[n]=t[2][n]+P:c.blockList[e].connections[n]=t[2][n]}c._checkArgClampBlocks.push(e)},[i,e,o[4]]);break;case"makeblock":_this._makeNewBlockWithConnections("makeblock",I,o[4],function(t){var e=t[0],i=t[1].length-3;if(0<i){for(var o=c.blockList[e].argClampSlots,s=0;s<i;s++)o.push(1),c.blockList[e].connections.push(null);c.blockList[e].updateArgSlots(o);for(var n=0;n<t[1].length;n++)null!=t[1][n]?c.blockList[e].connections[n]=t[1][n]+P:c.blockList[e].connections[n]=t[1][n]}c._checkArgClampBlocks.push(e)},[i,o[4]]);break;case"number":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0];c.blockList[e].value=Number(t[1]),c.updateBlockText(e)},[i,e]);break;case"outputtools":_this._makeNewBlockWithConnections("outputtools",I,o[4],function(t){var e=t[0],t=t[1];c.blockList[e].privateData=t,c.blockList[e].overrideName=t},[i,u[G][1][1].value]);break;case"text":case"solfege":case"scaledegree2":case"customNote":case"eastindiansolfege":case"notename":case"modename":case"chordname":case"temperamentname":case"invertmode":case"filtertype":case"oscillatortype":case"accidentalname":case"intervalname":case"grid":case"boolean":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0];c.blockList[e].value=t[1],c.updateBlockText(e)},[i,e]);break;case"drumname":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0];c.blockList[e].value=t[1],c.updateBlockText(e)},[i,e]),null===e&&(e=DEFAULTDRUM),c.activity.logo.synth.loadSynth(0,getDrumSynthName(e));break;case"effectsname":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0];c.blockList[e].value=t[1],c.updateBlockText(e)},[i,e]),null===e&&(e=DEFAULTEFFECT),c.activity.logo.synth.loadSynth(0,getDrumSynthName(e));break;case"voicename":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0],t=t[1];["simple 1","simple 2","simple 3","simple 4"].includes(t)&&(t="sine"),c.blockList[e].value=t,c.updateBlockText(e)},[i,e]);try{null===e&&(e=DEFAULTVOICE),_this.activity.logo.synth.loadSynth(0,getVoiceSynthName(e))}catch(t){console.debug(t)}break;case"noisename":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0];c.blockList[e].value=t[1],c.updateBlockText(e)},[i,e]);try{null===e&&(e=DEFAULTNOISE),_this.activity.logo.synth.loadSynth(0,getNoiseSynthName(e))}catch(t){console.debug(t)}break;case"loudness":case"pitchness":_this._makeNewBlockWithConnections(s,I,o[4],null,[]),_this.activity.logo.initMediaDevices();break;case"media":_this._makeNewBlockWithConnections(s,I,o[4],function(t){var e=t[0],t=t[1];null!=(c.blockList[e].value=t)&&c.blockList[e].loadThumbnail(null)},[i,e]);break;case"camera":_this._makeNewBlockWithConnections(s,I,o[4],function(t){t=t[0];c.blockList[t].value=CAMERAVALUE},[i,e]);break;case"video":_this._makeNewBlockWithConnections(s,I,o[4],function(t){t=t[0];c.blockList[t].value=VIDEOVALUE},[i,e]);break;case"red":case"black":_this._makeNewBlockWithConnections("number",I,o[4],function(t){c.blockList[t].value=0,c.updateBlockText(t)},i);break;case"white":_this._makeNewBlockWithConnections("number",I,o[4],function(t){c.blockList[t].value=100,c.updateBlockText(t)},i);break;case"orange":_this._makeNewBlockWithConnections("number",I,o[4],function(t){c.blockList[t].value=10,c.updateBlockText(t)},i);break;case"yellow":_this._makeNewBlockWithConnections("number",I,o[4],function(t){c.blockList[t].value=20,c.updateBlockText(t)},i);break;case"green":_this._makeNewBlockWithConnections("number",I,o[4],function(t){c.blockList[t].value=40,c.updateBlockText(t)},i);break;case"blue":_this._makeNewBlockWithConnections("number",I,o[4],function(t){c.blockList[t].value=70,c.updateBlockText(t)},i);break;case"loadFile":_this._makeNewBlockWithConnections(s,I,o[4],function(t){c.blockList[t[0]].value=t[1],c.updateBlockText(t[0])},[i,e]);break;case"wrapmode":_this._makeNewBlockWithConnections(s,I,o[4],function(t){c.blockList[t[0]].value=t[1],c.updateBlockText(t[0])},[i,e]);break;case"audiofile":_this._makeNewBlockWithConnections(s,I,o[4],function(t){c.blockList[t[0]].value=t[1],c.updateBlockText(t[0])},[i,e]);break;default:if(s in _this.protoBlockDict&&null!=_this.protoBlockDict[s])_this._makeNewBlockWithConnections(s,I,o[4],null);else{var n,l=s,a=o[4].length,r=!0,h=o[4][0];switch(null!==h?(n=u[h][4].indexOf(G),"string"==typeof u[h][1]?void 0!==_this.protoBlockDict[u[h][1]]&&"in"!==_this.protoBlockDict[u[h][1]].dockTypes[n]&&(r=!1):void 0!==_this.protoBlockDict[u[h][1][0]]&&"in"!==_this.protoBlockDict[u[h][1][0]].dockTypes[n]&&(r=!1)):null!==(h=last(o[4]))&&(n=u[h][4].indexOf(G),"string"==typeof u[h][1])&&(void 0!==_this.protoBlockDict[u[h][1]]?"out"!==_this.protoBlockDict[u[h][1]].dockTypes[n]&&(r=!1):void 0!==_this.protoBlockDict[u[h][1][0]]&&"out"!==_this.protoBlockDict[u[h][1][0]].dockTypes[n]&&(r=!1)),r?console.debug(a+": substituting nop flow block for "+s):console.debug(a+": substituting nop arg block for "+s),a){case 1:l="nopValueBlock";break;case 2:l=r?"nopZeroArgBlock":"nopOneArgMathBlock";break;case 3:l=r?"nopOneArgBlock":"nopTwoArgMathBlock";break;case 4:l="nopTwoArgBlock";break;default:5<a&&console.debug("WARNING: arg count exceed."),l="nopThreeArgBlock"}_this._makeNewBlockWithConnections(l,I,o[4],function(t){c.blockList[t[0]].privateData=t[1]},[i,s])}}i===_this.blockList.length-1&&null==_this.blockList[i].connections[0]&&(_this.blockList[i].container.x=o[2],_this.blockList[i].container.y=o[3],_this._adjustTheseDocks.push(i),null==o[4][0]&&_this._adjustTheseStacks.push(i),o[2]<0||o[3]<0||o[2]>_this.activity.canvas.width||o[3]>_this.activity.canvas.height)&&_this.activity.setHomeContainers(!0)})()},this.cleanupAfterLoad=_asyncToGenerator(_regenerator().m(function t(){var e,i,o,s,n,c,l,a;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(--_this._loadCounter,0<_this._loadCounter)return t.a(2);t.n=1;break;case 1:for(_this._findDrumURLs(),_this.updateBlockPositions(),_this._cleanupStacks(),e=0;e<_this.blocksToCollapse.length;e++)_this.blockList[_this.blocksToCollapse[e]].collapseToggle();for(o in _this.blocksToCollapse=[],_this.activity.refreshCanvas(),i=!1,_this.blockList)_this.blockList[o].trash||"action"!==_this.blockList[o].name||(s=_this.blockList[o],null!=(s=s.connections[1])&&_this.blockList[s].value!==_("action")&&_this.newNameddoBlock(_this.blockList[s].value,_this.actionHasReturn(o),_this.actionHasArgs(o))&&(i=!0));for(n in i&&_this.activity.palettes.updatePalettes("action"),i=!1,_this.blockList)_this.blockList[n].trash||"storein"!==_this.blockList[n].name||(c=_this.blockList[n],null==(c=c.connections[1]))||_this.blockList[c].value===_("box")||null===(l=_this.blockList[c].value)||null!=_this.protoBlockDict["myStorein_"+l]&&null!=_this.protoBlockDict["yourStorein2_"+l]||(_this.newStorein2Block(_this.blockList[c].value),_this.newNamedboxBlock(_this.blockList[c].value),i=!0);document.body.style.cursor="default",document.getElementById("load-container").style.display="none",_this.activity.stopLoadAnimation&&_this.activity.stopLoadAnimation(),a=new Event("finishedLoading"),document.dispatchEvent(a);case 2:return t.a(2)}},t)})),this._cleanupStacks=function(){for(var t=[],e=0;e<_this._checkArgClampBlocks.length;e++){var i=_this._checkArgClampBlocks[e];t.push([i,_this._getNestingDepth(i),"1arg"])}for(var o=0;o<_this._checkTwoArgBlocks.length;o++){var s=_this._checkTwoArgBlocks[o];t.push([s,_this._getNestingDepth(s),"2arg"])}for(var t=(t=t.sort(function(t,e){return t[1]-e[1]})).reverse(),n=0;n<t.length;n++)"1arg"===t[n][2]?_this._adjustArgClampBlock([t[n][0]]):_this._adjustExpandableTwoArgBlock([t[n][0]]);for(var c=0;c<_this._adjustTheseDocks.length;c++)_this.adjustDocks(_this._adjustTheseDocks[c],!0),_this._expandClamps();for(var l=0;l<_this._adjustTheseStacks.length;l++)_this.raiseStackToTop(_this._adjustTheseStacks[l])},this.actionHasReturn=function(t){if("action"===_this.blockList[t].name){_this.findDragGroup(t);for(var e=0;e<_this.dragGroup.length;e++)if("return"===_this.blockList[_this.dragGroup[e]].name)return!0}return!1},this.actionHasArgs=function(t){if("action"===_this.blockList[t].name){_this.findDragGroup(t);for(var e=0;e<_this.dragGroup.length;e++)if("arg"===_this.blockList[_this.dragGroup[e]].name||"namedarg"===_this.blockList[_this.dragGroup[e]].name)return!0}return!1},this.raiseStackToTop=function(t){for(var t=_this.findTopBlock(t),e=(_this.findDragGroup(t),_this.activity.blocksContainer.children.length-1),i=0;i<_this.dragGroup.length;i++)_this.activity.blocksContainer.setChildIndex(_this.blockList[_this.dragGroup[i]].container,e),--e;_this.activity.refreshCanvas},this.deleteActionBlock=(()=>{var e=_asyncToGenerator(_regenerator().m(function t(e){var i,o,s,n,c,l,a;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(!(l=_this.blockList[e.connections[1]])){t.n=13;break}i=l.value,c=_regeneratorKeys(_this.blockList);case 1:if((l=c()).done){t.n=11;break}if(o=l.value,o=_this.blockList[o],["nameddo","namedcalcArg","nameddoArg","do","calc","calcArg","doArg"].includes(o.name)){t.n=2;break}return t.a(3,1);case 2:if(null!==o.connections[0])return t.a(3,1);t.n=3;break;case 3:if("calc"===o.name);else if(null!==last(o.connections))return t.a(3,1);t.n=4;break;case 4:if("calcArg"!==o.name);else if(null!==o.connections[2])return t.a(3,1);t.n=5;break;case 5:if("doArg"!==o.name);else if(null!==o.connections[2])return t.a(3,1);t.n=6;break;case 6:if("namedcalcArg"!==o.name);else if(null!==o.connections[1])return t.a(3,1);t.n=7;break;case 7:n=s=void 0,a=o.name,t.n="doArg"===a||"calcArg"===a||"calc"===a||"do"===a?8:"nameddoArg"===a||"namedcalcArg"===a||"nameddo"===a?9:10;break;case 8:return null!==o.connections[1]&&(s=_this.blockList[o.connections[1]],n=s.value),t.a(3,10);case 9:return s=null,n=o.privateData,t.a(3,10);case 10:n===i&&(o.trash=!0,null!==s)&&(s.hide(),s.trash=!0),t.n=1;break;case 11:return _this.deleteActionTimeout+=50,a=_this.deleteActionTimeout,t.n=12,delayExecution(a);case 12:_this.deleteActionTimeout-=50,_this.activity.palettes.removeActionPrototype(i);case 13:return t.a(2)}},t)}));return function(t){return e.apply(this,arguments)}})(),this.sendStackToTrash=function(t){for(var e in _this.activity.palettes.dict)_this.activity.palettes.dict[e].hideMenu(!0);_this.activity.refreshCanvas();var i=_this.blockList.indexOf(t),o=(_this.trashStacks.push(i),t.connections[0]);if(null!=o){for(var s in _this.blockList[o].connections)if(_this.blockList[o].connections[s]===i){_this.blockList[o].connections[s]=null;break}var n=_this.insideExpandableBlock(i);t.connections[0]=null,_this.addDefaultBlock(n,i)}"start"===t.name||"drum"===t.name?null!=(n=t.value)&&(console.debug("putting turtle "+n+" in the trash"),(a=_this.turtles.turtleList[n].companionTurtle)&&(_this.turtles.turtleList[a].inTrash=!0,_this.turtles.turtleList[a].container.visible=!1),_this.turtles.turtleList[n].inTrash=!0,_this.turtles.turtleList[n].container.visible=!1):"action"!==t.name||t.trash||_this.deleteActionBlock(t),_this.findDragGroup(i);for(var c=0;c<_this.dragGroup.length;c++){var l=_this.dragGroup[c],l=(_this.blockList[l].trash=!0,_this.blockList[l].hide(),_this.blockList[l].protoblock.staticLabels[0]);closeBlkWidgets(_(l)),_this.activity.refreshCanvas()}if(null!=o){var a=_this.findTopBlock(o);_this.findDragGroup(a),_this._checkTwoArgBlocks=[],_this._checkArgClampBlocks=[];for(var r=0;r<_this.dragGroup.length;r++){var h=_this.dragGroup[r],u=_this.blockList[h];u.isTwoArgBlock()||u.isArgBlock()&&u.isExpandableBlock()||u.isArgClamp()?_this._checkTwoArgBlocks.push(h):["clamp","argclamp","argclamparg","doubleclamp","argflowclamp"].includes(u.protoblock.style)&&_this._checkArgClampBlocks.push(h)}_this._cleanupStacks(),_this.activity.refreshCanvas()}_this.activity.refreshCanvas(),_this.activity.trashcan.stopHighlightAnimation(),document.getElementById("hideContents").click()},this.clearParameterBlocks=function(){for(var t in _this.blockList)_this.blockList[t].protoblock.parameter&&null!==_this.blockList[t].text&&"audiofile"!==_this.blockList[t].name&&(_this.blockList[t].text.text="",_this.blockList[t].container.updateCache());_this.activity.refreshCanvas()},this.updateParameterBlock=function(logo,turtle,blk){var name=_this.blockList[blk].name;if(_this.blockList[blk].protoblock.parameter&&null!==_this.blockList[blk].text){var value=0;if("function"==typeof _this.blockList[blk].protoblock.updateParameter)value=_this.blockList[blk].protoblock.updateParameter(logo,turtle,blk);else{if(!(name in logo.evalParameterDict))return;eval(logo.evalParameterDict[name])}if(null==value)_this.blockList[blk].text.text="";else if("string"==typeof value)6<value.length&&(value=value.substr(0,5)+"..."),_this.blockList[blk].text.text=value;else if("divide"===name)_this.blockList[blk].text.text=mixedNumber(value);else try{_this.blockList[blk].text.text=value.toString()}catch(error){console.warn("Error converting value to string:",value,error),_this.blockList[blk].text.text=""}_this.blockList[blk].container.updateCache(),_this.activity.refreshCanvas()}},this.blockSetter=function(logo,blk,value,turtle){if("function"==typeof _this.blockList[blk].protoblock.setter)_this.blockList[blk].protoblock.setter(logo,value,turtle,blk);else{if(!(_this.blockList[blk].name in logo.evalSetterDict))throw new Error;eval(logo.evalSetterDict[_this.blockList[blk].name])}},this.hideBlocks=function(){_this.activity.palettes.hide(),_this.hide(),_this.activity.refreshCanvas()},this.showBlocks=function(){_this.activity.palettes.show(),_this.show(),_this.bringToTop(),_this.activity.refreshCanvas()},this.setSelection=function(t){_this.selectionModeOn=t},this.setSelectionToActivity=function(t){_this.activity.setSelectionMode(t)},this.unhighlightSelectedBlocks=function(t,e){_this.blockList[t].unhighlightSelectedBlocks(t,e)},this.setSelectedBlocks=function(t){_this.selectedBlocks=t},this.isCoordinateOnBlock=function(o,s){return this.blockList.some(function(t){var e,i;return!t.trash&&(e=t.container.x,i=t.container.y,e<=o)&&o<=e+t.width&&i<=s&&s<=i+t.height})}});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var Boundary=(()=>_createClass(function e(t){_classCallCheck(this,e),this._container=new createjs.Container,this._stage=t,this._stage.addChild(this._container),this._stage.setChildIndex(this._container,0)},[{key:"setScale",value:function(e,t,i){this.destroy(),this.create(e,t,i)}},{key:"destroy",value:function(){0<this._container.children.length&&this._container.removeChild(this._container.children[0])}},{key:"offScreen",value:function(e,t){return e<this.x||e>this.x+this.dx||t<this.y||t>this.y+this.dy}},{key:"create",value:function(e,t,i){var r,n=this;this.w=e/i,this.x=68,this.dx=this.w-136,this.h=t/i,this.y=68,this.dy=this.h-81;(r=new Image).onload=function(){var e=new createjs.Bitmap(r);n._container.addChild(e)},r.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(BOUNDARY.replace("HEIGHT",n.h).replace("WIDTH",n.w).replace("Y",n.y).replace("X",n.x).replace("DY",n.dy).replace("DX",n.dx).replace("stroke_color","#e08080")))}},{key:"hide",value:function(){this._container.visible=!1}},{key:"show",value:function(){this._container.visible=!0}}]))();"undefined"!=typeof module&&module.exports&&(module.exports=Boundary);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var y,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var i,o,a,u,s,c,f,l,m,t=t&&t.prototype instanceof d?t:d,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(i=e,o=n,f=r||[],l=!1,m={p:c=0,n:0,v:y,a:h,f:h.bind(y,4),d:function(e,t){return a=e,u=0,s=y,m.n=t,p}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(l&&1===t&&h(t,n),u=t,s=n;(g=u<2?y:s)||!l;){a||(u?u<3?(1<u&&(m.n=-1),h(u,s)):m.n=s:m.v=s);try{if(c=2,a){if(g=a[e=u?e:"next"]){if(!(g=g.call(a,s)))throw TypeError("iterator result is not an object");if(!g.done)return g;s=g.value,u<2&&(u=0)}else 1===u&&(g=a.return)&&g.call(a),u<2&&(s=TypeError("The iterator does not provide a '"+e+"' method"),u=1);a=y}else if((g=(l=m.n<0)?s:i.call(o,m))!==p)break}catch(e){a=y,u=1,s=e}finally{c=1}}return{value:g,done:l}}),!0),t;function h(e,t){for(u=e,s=t,g=0;!l&&c&&!n&&g<f.length;g++){var n,r=f[g],i=m.p,o=r[2];3<e?(n=o===t)&&(s=r[(u=r[4])?5:u=3],r[4]=r[5]=y):r[0]<=i&&((n=e<2&&i<r[1])?(u=0,m.v=t,m.n=r[1]):i<o&&(n=e<3||r[0]>t||o<t)&&(r[4]=e,r[5]=t,m.n=o,u=0))}if(n||1<e)return p;throw l=!0,t}}var p={};function d(){}function i(){}function o(){}var g=Object.getPrototypeOf,e=[][t]?g(g([][t]())):(_regeneratorDefine2(g={},t,function(){return this}),g),a=o.prototype=d.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",i.prototype=o),_regeneratorDefine2(o,"constructor",i),_regeneratorDefine2(o,n,i.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,n,"Generator"),_regeneratorDefine2(a,t,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:u}})()}function _regeneratorDefine2(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(_regeneratorDefine2=function(e,t,n,r){function i(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))})(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function _asyncToGenerator(u){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=u.apply(e,a);function i(e){asyncGeneratorStep(r,t,n,i,o,"next",e)}function o(e){asyncGeneratorStep(r,t,n,i,o,"throw",e)}i(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var GIFAnimator=(()=>{return _createClass(function e(){_classCallCheck(this,e),this.animations=new Map,this.frameRequestId=null,this.isRunning=!1,this.gifCounter=0},[{key:"isAnimatedGIF",value:function(e){return"string"==typeof e&&e.startsWith("data:image/gif")}},{key:"generateGifId",value:function(){return"gif_".concat(Date.now(),"_").concat(this.gifCounter++)}},{key:"createAnimation",value:(u=_asyncToGenerator(_regenerator().m(function e(t,n,r,i,o,a,u){var s,c,f,l,m;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,window.SuperGif){e.n=1;break}throw new Error("libgif.js (SuperGif) is not loaded");case 1:return(s=document.createElement("img")).src=t,s.style.display="none",document.body.appendChild(s),c=new SuperGif({gif:s}),e.n=2,new Promise(function(e){return c.load(e)});case 2:if((f=c.get_length())<=1)return document.body.removeChild(s),e.a(2,null);e.n=3;break;case 3:return m=c.get_canvas(),(l=document.createElement("canvas")).width=m.width,l.height=m.height,m={gifPlayer:c,frames:f,frameCanvas:l,frameCtx:l.getContext("2d"),currentFrame:0,lastFrameTime:0,canvas:n,x:r,y:i,width:o,height:a,rotation:u,disposed:!1,imgElement:s},l=this.generateGifId(),this.animations.set(l,m),this.isRunning||this.start(),e.a(2,l);case 4:return e.p=4,m=e.v,console.error("Failed to create GIF animation:",m),e.a(2,null)}},e,this,[[0,4]])})),function(e,t,n,r,i,o,a){return u.apply(this,arguments)})},{key:"renderFrame",value:function(e){var t=e.canvas.getContext("2d"),n=(t.save(),t.translate(e.x,e.y),t.rotate(e.rotation*Math.PI/180),t.clearRect(-e.width/2-2,-e.height/2-2,e.width+4,e.height+4),t.restore(),e.gifPlayer.move_to(e.currentFrame),e.gifPlayer.get_canvas());t.save(),t.translate(e.x,e.y),t.rotate(e.rotation*Math.PI/180),t.drawImage(n,-e.width/2,-e.height/2,e.width,e.height),t.restore()}},{key:"animate",value:function(n){var r=this;this.isRunning&&(this.animations.forEach(function(e,t){e.disposed?(e.gifPlayer.pause(),document.body.removeChild(e.imgElement),r.animations.delete(t)):e.lastFrameTime?120<=n-e.lastFrameTime&&(r.renderFrame(e),e.currentFrame=(e.currentFrame+1)%e.frames,e.lastFrameTime=n):(e.lastFrameTime=n,r.renderFrame(e))}),0<this.animations.size?this.frameRequestId=requestAnimationFrame(function(e){return r.animate(e)}):this.isRunning=!1)}},{key:"start",value:function(){var t=this;this.isRunning||(this.isRunning=!0,this.frameRequestId=requestAnimationFrame(function(e){return t.animate(e)}))}},{key:"updatePosition",value:function(e,t,n,r){e=this.animations.get(e);e&&!e.disposed&&(e.x=t,e.y=n,e.rotation=r)}},{key:"stopAnimation",value:function(e){var t=this.animations.get(e);t&&(t.disposed=!0,this.animations.delete(e))}},{key:"stopAll",value:function(){this.animations.forEach(function(e){return e.disposed=!0}),this.animations.clear(),this.frameRequestId&&(cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null),this.isRunning=!1}},{key:"getActiveCount",value:function(){return this.animations.size}}]);var u})();"undefined"!=typeof module&&module.exports&&(module.exports=GIFAnimator);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,a){for(var i=0;i<a.length;i++){var t=a[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,_toPropertyKey(t.key),t)}}function _createClass(e,a,i){return a&&_defineProperties(e.prototype,a),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,a){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===a?String:Number)(e);i=i.call(e,a||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var LanguageBox=(()=>_createClass(function e(a){_classCallCheck(this,e),this.activity=a,this._language=a.storage.languagePreference},[{key:"enUS_onclick",value:function(){this._language="enUS",this.hide()}},{key:"enUK_onclick",value:function(){this._language="enUK",this.hide()}},{key:"ko_onclick",value:function(){this._language="ko",this.hide()}},{key:"ja_onclick",value:function(){this._language="ja-kanji",this.activity.storage.kanaPreference="kanji",this.hide()}},{key:"kana_onclick",value:function(){this._language="ja-kana",this.activity.storage.kanaPreference="kana",this.hide()}},{key:"es_onclick",value:function(){this._language="es",this.hide()}},{key:"pt_onclick",value:function(){this._language="pt",this.hide()}},{key:"zhCN_onclick",value:function(){this._language="zh_CN",this.hide()}},{key:"th_onclick",value:function(){this._language="th",this.hide()}},{key:"hi_onclick",value:function(){this._language="hi",this.hide()}},{key:"ibo_onclick",value:function(){this._language="ibo",this.hide()}},{key:"ar_onclick",value:function(){this._language="ar",this.hide()}},{key:"he_onclick",value:function(){this._language="he",this.hide()}},{key:"te_onclick",value:function(){this._language="te",this.hide()}},{key:"tr_onclick",value:function(){this._language="tr",this.hide()}},{key:"ayc_onclick",value:function(){this._language="ayc",this.hide()}},{key:"quz_onclick",value:function(){this._language="quz",this.hide()}},{key:"gug_onclick",value:function(){this._language="gug",this.hide()}},{key:"ur_onclick",value:function(){this._language="ur",this.hide()}},{key:"OnClick",value:function(){this.reload()}},{key:"reload",value:function(){window.location.reload()}},{key:"hide",value:function(){var a=this,e="<a href='#' class='language-link' onMouseOver='this.style.opacity = 0.5'onMouseOut='this.style.opacity = 1'>",i="</a>",t={default:_("Refresh your browser to change your language preference."),enUS:"Refresh your browser to change your language preference.",enUK:"Refresh your browser to change your language preference.",ja:"言語を変えるには、ブラウザをこうしんしてください。",kana:"げんごを かえるには、ブラウザを こうしんしてください。",ko:"언어 기본 설정을 변경하려면 브라우저를 새로 고치십시오.",es:"Actualice su navegador para cambiar su preferencia de idioma.",pt:"Atualize seu navegador para alterar sua preferência de idioma.",zh_CN:"刷新浏览器以更改您的语言偏好",th:"รีเฟรชเบราเซอร์เพื่อเปลี่ยนการตั้งค่าภาษาของคุณ",hi:"अपनी भाषा की वरीयता बदलने के लिए अपना ब्राउज़र ताज़ा करें",te:"మీ భాష ప్రాధాన్యతను మార్చడానికి మీ బ్రౌజర్‌ని రిఫ్రెష్ చేయండి.",tr:"dil tercihinizi değiştirmek için tarayıcınızı yenileyin",ibo:"Mee ka nchọgharị gị gbanwee mmasị asụsụ gị.",ar:"حدث المتصفح لتغيير تفضيلات اللغة.",he:"רענן את הדפדפן כדי לשנות את העדפת השפה שלך.",ayc:"Actualice su navegador para cambiar su preferencia de idioma.",quz:"Actualice su navegador para cambiar su preferencia de idioma.",gug:"Actualice su navegador para cambiar su preferencia de idioma.",ur:"اپنی زبان کی ترجیح کو تبدیل کرنے کے لئے اپنے براؤزر کو تازہ دم کریں۔"};if(localStorage.getItem("languagePreference")===this._language){this._language.includes("ja")&&(this._language=this._language.split("-")[0]);try{localStorage.setItem("languagePreference",this._language)}catch(e){console.warn("Could not save language preference:",e)}this.activity.textMsg(_("Music Blocks is already set to this language."))}else this.activity.storage.languagePreference=this._language,"ja"===this._language&&"kana"===this.activity.storage.kanaPreference?this.activity.textMsg(e+t.kana+i):(this._language.includes("ja")&&(this._language=this._language.split("-")[0]),this.activity.textMsg(e+t[this._language]+i));document.querySelectorAll(".language-link").forEach(function(e){e.addEventListener("click",function(){return a.OnClick()})})}}]))();"undefined"!=typeof module&&module.exports&&(module.exports=LanguageBox);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var LILYPONDHEADER='\\version "2.18.2"\n\n% ****************************************************************\n% \n% WHAT IS THIS? -- This is a LilyPond file generated from Music\n% Blocks software (Read about it at www.musicblocks.net).\n% \n% DOWNLOAD LILYPOND -- In order to create notation with this file,\n% you will need to download and install LilyPond software onto your\n% computer (http://lilypond.org/download.html). Frescobaldi\n% software is also handy for editing LilyPond files\n% (http://frescobaldi.org/download).\n% \n% LILYPOND INSTRUCTIONS -- For instructions on how to further\n% manipulate musical notation using LilyPond software, please\n% read the Introduction (http://lilypond.org/text-input.html) and\n% the Manual\n% (http://lilypond.org/doc/v2.18/Documentation/learning/index.html).\n% \n% GLOSSARY -- A glossary with helpful examples may be found here\n% (http://www.lilypond.org/doc/v2.19/Documentation/music-glossary/).\n% \n% MUTOPIA -- You may also benefit from studying scores from the\n% Mutopia Project website, which has freely sharable music notation\n% generated with LilyPond (http://www.mutopiaproject.org/).\n% \n% HACKLILY -- You can explore your Lilypond output in a web browser\n% at (http://hacklily.org/).\n% \n% COMMENTS -- Some of the code below is commented out. You can\n% enable it by deleting the % that precedes the text or, in the\n% case of a commented section, deleting the %{ and %} that surrounds\n% the section.\n% \n% ****************************************************************\n\n% Please add your own name, the title of your musical creation,\n% and the intended copyright below.\n% The copyright is great for sharing (and re-sharing)!\n% Read more about it here (http://creativecommons.org/licenses/by-sa/4.0/).\n% Of course, you can use any copyright you like -- you made it!\n\\header {\n   dedication = \\markup {\n      \\abs-fontsize #8 \\sans "Made with LilyPond and Music Blocks" \\with-url #"http://musicblocks.sugarlabs.org/" {\n         \\abs-fontsize #8 \\sans "(http://musicblocks.sugarlabs.org/)"\n      }\n   }\n   title = "My Music Blocks Creation"\n%   subtitle = "Subtitle"\n%   instrument = "Instrument"\n   composer = "Mr. Mouse"\n%   arranger = "Arranger"\n   copyright = "Mr. Mouse (c) 2020 -- CC-BY-SA"\n   tagline = "Made from Music Blocks v.2.2"\n   footer = \\markup {\n      \\with-url #"http://musicblocks.sugarlabs.org/" "Made with Music Blocks Software v.2.2" Engraved on \\simple #(strftime "%Y-%m-%d" (localtime (current-time)))\n   }\n   currentYear = \\markup {\n      \\simple #(strftime "%Y" (localtime (current-time)))\n   }\n   copyTag =  " free to distribute, modify, and perform"\n   copyType = \\markup {\n      \\with-url #"http://creativecommons.org/licenses/by-sa/3.0/" "Creative Commons Attribution ShareAlike 3.0 (Unported) License "\n   }\n   copyright = \\markup {\n      \\override #\'(baseline-skip . 0 ) \\right-column {\n         \\sans \\bold \\with-url #"http://musicblocks.net" {\n            \\abs-fontsize #9  "Music " \\concat {\n               \\abs-fontsize #12 \\with-color #white \\char ##x01C0 \\abs-fontsize #9 "Blocks "\n            }\n         }\n      }\n      \\override #\'(baseline-skip . 0 ) \\center-column {\n         \\abs-fontsize #11.9 \\with-color #grey \\bold {\n            \\char ##x01C0 \\char ##x01C0\n         }\n      }\n      \\override #\'(baseline-skip . 0 ) \\column {\n         \\abs-fontsize #8 \\sans \\concat {\n            " Typeset using " \\with-url #"http://www.lilypond.org" "LilyPond software " \\char ##x00A9 " " \\currentYear " by " \\composer " " \\char ##x2014 " " \\footer\n         }\n         \\concat {\n            \\concat {\n               \\abs-fontsize #8 \\sans {\n                  " " \\copyType \\char ##x2014 \\copyTag\n               }\n            }\n            \\abs-fontsize #13 \\with-color #white \\char ##x01C0\n         }\n      }\n   }\n   tagline = ##f\n}\n\n% To change the meter make adjustments in the following section.\n% You must also delete the % before \\meter everywhere it appears below.\nmeter = {\n%   \\time 3/4\n%   \\key c \\minor\n   \\numericTimeSignature\n%   \\partial 4 \n%   \\tempo "Andante" 4=90\n}\n\n',getLilypondHeader=function(){return LILYPONDHEADER},processLilypondNotes=function(V,t,o){t.notationNotes[o]="\\meter\n";for(var n,e,a,l,u=function(t){"number"==typeof t&&(t=(o=frequencyToPitch(t))[0]+o[1]);var o,n={"♮":"!","♯":"is","♭":"es",10:"''''''''",1:",, ",2:", ",3:"",4:"'",5:"''",6:"'''",7:"''''",8:"''''''",9:"'''''''"};return t.replace(/[♮♯♭]|10|[1-9]/g,function(t){return n[t]}).toLowerCase()},i=0,r=!1,s=!1,g=!1,c=!1,p=0,N=0,O=!1,T=function(t,o,n,e){for(var a,i,r=0,s=0;s<e;){if(N=2*t.notation.notationStaging[o][n+r][NOTATIONDURATION],"object"===_typeof(l=t.notation.notationStaging[o][n+r][NOTATIONNOTE])){for(1<l.length&&(t.notationNotes[o]+="<"),a=0;a<l.length;a++)t.notationNotes[o]+=u(l[a]),(1===l.length||a<l.length-1)&&(t.notationNotes[o]+=" ");l[NOTATIONSTACCATO]&&(t.notationNotes[o]+=" \\staccato "),1<l.length&&(t.notationNotes[o]+=">"),t.notationNotes[o]+=t.notation.notationStaging[o][n+r][NOTATIONROUNDDOWN]}else"tie"===t.notation.notationStaging[o][n+r]&&(t.notationNotes[o]+="~");r++,s++}return n+r-1<t.notation.notationStaging[o].length-1?"string"==typeof(i=t.notation.notationStaging[o][n+r])&&")"===i?(t.notationNotes[o]+=")} ",n+=1):"string"==typeof i&&"markup"===i?(t.notationNotes[o]+="^\\markup { \\abs-fontsize #6 { "+t.notation.notationStaging[o][n+r+1]+" } } } ",r+=2):"string"==typeof i&&"markdown"===i?(t.notationNotes[o]+="_\\markup {"+t.notation.notationStaging[o][n+r+1]+"} } ",r+=2):t.notationNotes[o]+="} ":t.notationNotes[o]+="} ",r},f=0;f<t.notation.notationStaging[o].length;f++)if("string"==typeof(h=t.notation.notationStaging[o][f]))switch(h){case"swing":t.notationNotes[o]+="\\tempo swing\n";break;case"tempo":t.notationNotes[o]+="\\tempo "+t.notation.notationStaging[o][f+2]+" = "+t.notation.notationStaging[o][f+1]+"\n",f+=2;break;case"markup":t.notationNotes[o]+="^\\markup { \\abs-fontsize #6 { "+t.notation.notationStaging[o][f+1]+" } } ",f+=1;break;case"markdown":t.notationNotes[o]+="_\\markup { "+t.notation.notationStaging[o][f+1]+" } ",f+=1;break;case"break":0<f&&(t.notationNotes[o]+="\n"),i=0;break;case"begin articulation":c=!0;break;case"end articulation":c=!1;break;case"begin crescendo":t.notationNotes[o]+="  ",s=!0;break;case"begin decrescendo":t.notationNotes[o]+="  ",g=!0;break;case"end crescendo":case"end decrescendo":t.notationNotes[o]+="\\! ";break;case"begin slur":r=!0;break;case"end slur":t.notationNotes[o]+=")  ";break;case"begin harmonics":t.notationNotes[o]+="\\harmonicsOn ";break;case"end harmonics":t.notationNotes[o]+="\\harmonicsOff ";break;case"tie":t.notationNotes[o]+="~";break;case"key":if(n=t.notation.notationStaging[o][f+1]+" "+t.notation.notationStaging[o][f+2],e=t.notation.notationStaging[o][f+1].toLowerCase().replace(FLAT,"es").replace(SHARP,"is").replace(NATURAL,"").replace(DOUBLESHARP,"isis").replace(DOUBLEFLAT,"eses"),a=t.notation.notationStaging[o][f+2],["major","minor","ionian","dorian","phrygian","lydian","mixolydian","aeolian","locrian"].includes(a))t.notationNotes[o]+=" \\key "+e+" \\"+a+"\n";else{for(var h=getScaleAndHalfSteps(n),d="\n"+a.replace(/ /g,"_")+" = #`(",C="",m=void 0,b=-1,y=0;y<h[1].length;y++)if(""!==h[1][y]){if(h[0][y].substr(0,1)===C){d="";break}if(C=h[0][y].substr(0,1),b<(m=["C","D","E","F","G","A","B"].indexOf(h[0][y].substr(0,1)))){if(1<m-b)for(var A=b+1;A<m;A++)d+="("+A+" . ,NATURAL) ";b=m,1===h[0][y].length?d+="("+m+" . ,NATURAL) ":h[0][y].substr(1,1)===FLAT?d+="("+m+" . ,FLAT) ":d+="("+m+" . ,SHARP) "}}if(""!==d){if(m<6)for(var L=m+1;L<7;L++)d+="("+L+" . ,NATURAL) ";d+=")\n",V.freygish+=d,t.notationNotes[o]+=" \\key "+e+" \\"+a.replace(/ /g,"_")+"\n"}}f+=2;break;case"meter":t.notationNotes[o]+=" \\time "+t.notation.notationStaging[o][f+1]+"/"+t.notation.notationStaging[o][f+2]+"\n",f+=2;break;case"pickup":t.notationNotes[o]+=" \\partial "+t.notation.notationStaging[o][f+1]+"\n",f+=1;break;case"voice one":O?t.notationNotes[o]+="}\n\\new Voice { \\voiceOne ":(t.notationNotes[o]+="<< { \\voiceOne ",O=!0);break;case"voice two":O?t.notationNotes[o]+="}\n\\new Voice { \\voiceTwo ":(t.notationNotes[o]+="<< { \\voiceTwo ",O=!0);break;case"voice three":O?t.notationNotes[o]+="}\n\\new Voice { \\voiceThree ":(t.notationNotes[o]+="<< { \\voiceThree ",O=!0);break;case"voice four":O?t.notationNotes[o]+="}\n\\new Voice { \\voiceFour ":(t.notationNotes[o]+="<< { \\voiceFour ",O=!0);break;case"one voice":t.notationNotes[o]+="}\n>> \\oneVoice\n",O=!1;break;default:t.notationNotes[o]+=h}else{i%8==0&&0<i&&(t.notationNotes[o]+="\n"),i+=1;"string"==typeof h[NOTATIONNOTE]?u(h[NOTATIONNOTE]):(l=h[NOTATIONNOTE],u(l[0]));var S,k,w,v=0,I=null,U=0,D=null,E=0;if(null!=h[NOTATIONTUPLETVALUE]){var P=void 0,p=1/t.notation.notationStaging[o][f][NOTATIONDURATION],N=1/t.notation.notationStaging[o][f][NOTATIONROUNDDOWN],U=1/(h[NOTATIONTUPLETVALUE][0]*h[NOTATIONTUPLETVALUE][1]);null===D?(D=h[NOTATIONROUNDDOWN],E=1):h[NOTATIONROUNDDOWN]>D&&(P=h[NOTATIONROUNDDOWN]/D,D=h[NOTATIONROUNDDOWN],E=E*P+1),(null===I||h[NOTATIONTUPLETVALUE][1]<I)&&(I=h[NOTATIONTUPLETVALUE][1]);for(var _=1,R=1;R<h[NOTATIONTUPLETVALUE][0]*h[NOTATIONTUPLETVALUE][1];){if(f+_>=t.notation.notationStaging[o].length){v=_;break}if("tie"===t.notation.notationStaging[o][f+_])R++,_++;else{if([1,.5,.25,.125,.0625].includes(U)){v=_;break}if(null===t.notation.notationStaging[o][f+_][NOTATIONTUPLETVALUE]){v=_;break}if(t.notation.notationStaging[o][f+_][NOTATIONTUPLETVALUE][0]!==h[NOTATIONTUPLETVALUE][0]){v=_;break}t.notation.notationStaging[o][f+_][NOTATIONROUNDDOWN]>D?(P=t.notation.notationStaging[o][f+_][NOTATIONROUNDDOWN]/D,D=t.notation.notationStaging[o][f+_][NOTATIONROUNDDOWN],E=E*P+1):t.notation.notationStaging[o][f+_][NOTATIONROUNDDOWN]<D?E+=P=D/t.notation.notationStaging[o][f+_][NOTATIONROUNDDOWN]:E+=1,p+=1/t.notation.notationStaging[o][f+_][NOTATIONDURATION],N+=1/t.notation.notationStaging[o][f+_][NOTATIONROUNDDOWN],U+=1/(t.notation.notationStaging[o][f+_][NOTATIONTUPLETVALUE][0]*t.notation.notationStaging[o][f+_][NOTATIONTUPLETVALUE][1]),_++,R++}}}if(null!=h[NOTATIONTUPLETVALUE]&&0<h[NOTATIONTUPLETVALUE][0]*h[NOTATIONTUPLETVALUE][1])0===v?(k=(I=toFraction(N/p))[0]*p,I=I[0]*I[1],S=void 0,Math.floor(k)!==k&&(k=(S=toFraction(+k))[0],I=S[1]),t.notationNotes[o]+="\\tuplet "+k+"/"+I+" { ",f+=T(t,o,f,h[NOTATIONTUPLETVALUE][0]*h[NOTATIONTUPLETVALUE][1])-1):(k=(S=toFraction(E/D/U))[0],I=S[1],w=void 0,Math.floor(k)!==k&&(k=(w=toFraction(+k))[0],I=w[1]),t.notationNotes[o]+="\\tuplet "+k+"/"+I+" { ",f+=T(t,o,f,v)-1);else{if("object"===_typeof(l)){1<l.length&&(t.notationNotes[o]+="<");for(var M=0;M<l.length;M++)t.notationNotes[o]+=u(l[M]),M<l.length-1&&(t.notationNotes[o]+=" ");1<l.length&&(t.notationNotes[o]+=">"),t.notationNotes[o]+=h[NOTATIONDURATION];for(var x=0;x<h[NOTATIONDOTCOUNT];x++)t.notationNotes[o]+=".";c&&(t.notationNotes[o]+="->")}t.notationNotes[o]+=" ",h[NOTATIONSTACCATO]&&(t.notationNotes[o]+="\\staccato ")}N=p=0,r&&(r=!1,t.notationNotes[o]+="(  "),s&&(s=!1,t.notationNotes[o]+="\\< "),g&&(g=!1,t.notationNotes[o]+="\\> ")}},saveLilypondOutput=function(t){var o,n=[_("mouse"),_("brown rat"),_("mole"),_("chipmunk"),_("red squirrel"),_("guinea pig"),_("capybara"),_("coypu"),_("black rat"),_("grey squirrel"),_("flying squirrel"),_("bat")],e=["treble","bass","bass_8","percussion"],a=["zero","one","two","three","four","five","six","seven","eight","nine"],i=0,r=[],s=i+=Object.keys(t.logo.notation.notationStaging).length;for(o in t.logo.notation.notationDrumStaging){for(var C=!1,l=0;l<t.logo.notation.notationDrumStaging[o].length;l++){var u=t.logo.notation.notationDrumStaging[o][l];"object"===_typeof(u)&&"object"===_typeof(u[0])&&"R"!==u[0][0]&&(C=!0)}t.logo.notation.notationStaging[i.toString()]=C?t.logo.notation.notationDrumStaging[o]:[],i+=1}console.debug("saving as lilypond: "+i),t.logo.notationOutput+="% You can change the MIDI instruments below to anything on this list:\n% (http://lilypond.org/doc/v2.18/documentation/notation/midi-instruments)\n\n";var g,c=0,p=[];for(g in t.logo.notation.notationStaging){var N=g;if("string"==typeof g&&(N=Number(g)),0<t.logo.notation.notationStaging[g].length){for(var O=0,T=0,f=0;f<t.logo.notation.notationStaging[g].length;f++){var h=t.logo.notation.notationStaging[g][f];if("object"===_typeof(h))for(var d=0;d<h[0].length;d++)"R"!==h[0][d]&&("string"==typeof h[0][d]?O+=Number(h[0][d].substr(-1)):O+=frequencyToPitch(h[0][d])[1],T+=1)}if(s-1<N)r.push("percussion");else if(0<T)switch(console.debug(O+" "+T+" "+Math.floor(.5+O/T)),Math.floor(.5+O/T)){case 0:case 1:case 2:r.push("bass_8");break;case 3:r.push("bass");break;default:r.push("treble")}else r.push("treble");this.freygish="",processLilypondNotes(this,t.logo,g),""!==this.freygish&&(t.logo.notationOutput+=this.freygish);var m="",b="";if(s-1<N)m=(m=_("drum")+a[N-s]).replace(/ /g,"").replace(".",""),t.logo.notationOutput+=m+" = {\n",t.logo.notationOutput+="\\drummode {\n",t.logo.notationOutput+=t.logo.notationNotes[g],c===i-1&&(t.logo.notationOutput+=' \\bar "|."'),t.logo.notationOutput+="\n}\n",t.logo.notationOutput+="\n}\n\n";else{m=(m=""===(m=g in t.turtles.turtleList&&((m=t.turtles.getTurtle(g).name)===_("start")||m===_("start drum")||m===N.toString())?n[N%12]:m)?n[N%12]:m).replace(/ /g,"").replace(".",""),t.logo.notationOutput+=m+" = {\n",t.logo.notationOutput+=t.logo.notationNotes[g],c===i-1&&(t.logo.notationOutput+=' \\bar "|."'),t.logo.notationOutput+="\n}\n\n";var y="",A="",L="",S="",k="",x=0,w=m.indexOf("_");if(1===m.length)b=m,p[g]=b;else if(-1===w){for(var v=2;v<m.length;v++)if(2===v?y=m.slice(0,2):y+=m.charAt(v-1),!p.includes(y)){b=y,p[g]=b;break}}else if(A=m.slice(0,w),L=m.slice(w+1,m.length),S=A.charAt(0),k=L.charAt(0),p.includes(y=S+k)){if(1!==x)for(var y="",I=1;I<m.length;I++){if(k+=L.charAt(I),!p.includes(y=S+k)){b=y,p[g]=b;break}if(S+=A.charAt(I),!p.includes(y=S+k)){b=y,p[g]=b;break}}}else b=y,p[g]=b,x=1}t.logo.notationOutput+=m.replace(/ /g,"").replace(".","")+"Voice = ",t.logo.notationOutput+=s-1<N?"\\new DrumStaff \\with {\n":"\\new Staff \\with {\n",t.logo.notationOutput+='   \\clef "'+last(r)+'"\n',t.logo.notationOutput+='   instrumentName = "'+m+'"\n',s-1<N?(t.logo.notationOutput+='   shortInstrumentName = "d'+(N-s)+'"\n',t.logo.notationOutput+='   midiInstrument = "snare drum"\n'):(t.logo.notationOutput+='   shortInstrumentName = "'+b+'"\n',t.logo.notationOutput+='   midiInstrument = "acoustic grand"\n'),t.logo.notationOutput+='\n} { \\clef "'+last(r)+'" \\'+m.replace(/ /g,"").replace(".","")+" }\n\n"}else r.push("");c+=1}t.logo.notationOutput+="\n\\score {\n",t.logo.notationOutput+="   <<\n";for(var U=0;U<e.length;U++){var D,E=void 0;for(D in t.logo.notationNotes){var P=D;r[P="string"==typeof D?Number(D):P]===e[U]&&0<t.logo.notation.notationStaging[D].length&&(s-1<P?E=_("drum")+a[P-s]:(E=""===(E=D in t.turtles.turtleList?t.turtles.getTurtle(D).name:P in t.turtles.turtleList?t.turtles.getTurtle(P).name:_("mouse"))?_("mouse"):E)!==_("start")&&E!==_("start drum")&&E!==P.toString()||(E=n[P%12]),E=E.replace(/ /g,"").replace(".",""),t.logo.notationOutput+="      \\"+E+"Voice\n")}}t.logo.notationOutput+=t.logo.guitarOutputHead;for(var Y=0;Y<e.length;Y++){var R,M=void 0;for(R in t.logo.notationNotes){var V=R;"string"==typeof R&&(V=Number(R)),r[0]===e[Y]&&0<t.logo.notation.notationStaging[R].length&&(s-1<V?M=_("drum")+a[V-s]:(M=R in t.turtles.turtleList?t.turtles.getTurtle(R).name:V in t.turtles.turtleList?t.turtles.getTurtle(V).name:_("mouse"))!==_("start")&&M!==_("start drum")&&M!==V.toString()||(M=n[V%12]),M=M.replace(/ /g,"").replace(".",""),t.logo.notationOutput+='         \\context TabVoice = "'+M+'" \\'+M.replace(/ /g,"").replace(".","")+"\n")}}t.logo.notationOutput+=t.logo.guitarOutputEnd,t.logo.notationOutput+="\n   >>\n   \\layout {}\n\n",t.logo.notationOutput+=t.logo.MIDIOutput,t.logo.notationOutput+="% MUSIC BLOCKS CODE\n",t.logo.notationOutput+="% Below is the code for the Music Blocks project that generated this Lilypond file.\n%{\n\n";var H=t.prepareExport();return t.logo.notationOutput+=H.replace(/]],/g,"]],\n"),t.logo.notationOutput+="\n%}\n\n",t.logo.notationOutput};"undefined"!=typeof module&&module.exports&&(module.exports={LILYPONDHEADER:LILYPONDHEADER,getLilypondHeader:getLilypondHeader,processLilypondNotes:processLilypondNotes,saveLilypondOutput:saveLilypondOutput});
function _regenerator(){var g,e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",t=e.toStringTag||"@@toStringTag";function r(e,n,t,r){var o,i,a,c,u,s,p,f,d,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype);return _regeneratorDefine2(n,"_invoke",(o=e,i=t,p=r||[],f=!1,d={p:s=0,n:0,v:g,a:l,f:l.bind(g,4),d:function(e,n){return a=e,c=0,u=g,d.n=n,m}},function(e,n,t){if(1<s)throw TypeError("Generator is already running");for(f&&1===n&&l(n,t),c=n,u=t;(b=c<2?g:u)||!f;){a||(c?c<3?(1<c&&(d.n=-1),l(c,u)):d.n=u:d.v=u);try{if(s=2,a){if(b=a[e=c?e:"next"]){if(!(b=b.call(a,u)))throw TypeError("iterator result is not an object");if(!b.done)return b;u=b.value,c<2&&(c=0)}else 1===c&&(b=a.return)&&b.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+e+"' method"),c=1);a=g}else if((b=(f=d.n<0)?u:o.call(i,d))!==m)break}catch(e){a=g,c=1,u=e}finally{s=1}}return{value:b,done:f}}),!0),n;function l(e,n){for(c=e,u=n,b=0;!f&&s&&!t&&b<p.length;b++){var t,r=p[b],o=d.p,i=r[2];3<e?(t=i===n)&&(u=r[(c=r[4])?5:c=3],r[4]=r[5]=g):r[0]<=o&&((t=e<2&&o<r[1])?(c=0,d.v=n,d.n=r[1]):o<i&&(t=e<3||r[0]>n||i<n)&&(r[4]=e,r[5]=n,d.n=i,c=0))}if(t||1<e)return m;throw f=!0,n}}var m={};function y(){}function o(){}function i(){}var b=Object.getPrototypeOf,e=[][n]?b(b([][n]())):(_regeneratorDefine2(b={},n,function(){return this}),b),a=i.prototype=y.prototype=Object.create(e);function c(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,t,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",o.prototype=i),_regeneratorDefine2(i,"constructor",o),_regeneratorDefine2(i,t,o.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,t,"Generator"),_regeneratorDefine2(a,n,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:c}})()}function _regeneratorDefine2(e,n,t,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,n,t,r){function o(n,t){_regeneratorDefine2(e,n,function(e){return this._invoke(n,t,e)})}n?i?i(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(o("next",0),o("throw",1),o("return",2))})(e,n,t,r)}function asyncGeneratorStep(e,n,t,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(c){return function(){var e=this,a=arguments;return new Promise(function(n,t){var r=c.apply(e,a);function o(e){asyncGeneratorStep(r,n,t,o,i,"next",e)}function i(e){asyncGeneratorStep(r,n,t,o,i,"throw",e)}o(void 0)})}}requirejs.config({baseUrl:"lib",shim:{easel:{exports:"createjs"},"p5.min":{exports:"p5"},"p5-adapter":{deps:["p5.min"]},"p5.sound.min":{deps:["p5-adapter"]},"p5.dom.min":{deps:["p5.min"]},"p5-sound-adapter":{deps:["p5.sound.min"]}},paths:{utils:"../js/utils",widgets:"../js/widgets",activity:"../js",easel:"../lib/easeljs",twewn:"../lib/tweenjs",prefixfree:"../bower_components/prefixfree/prefixfree.min",samples:"../sounds/samples",planet:"../js/planet",tonejsMidi:"../node_modules/@tonejs/midi/dist/Midi","p5.min":"../lib/p5.min","p5.sound.min":"../lib/p5.sound.min","p5.dom.min":"../lib/p5.dom.min","p5-adapter":"../js/p5-adapter","p5-sound-adapter":"../js/p5-sound-adapter",i18next:["../lib/i18next.min","https://cdn.jsdelivr.net/npm/i18next@23.11.5/dist/umd/i18next.min"],i18nextHttpBackend:["../lib/i18nextHttpBackend.min","https://cdn.jsdelivr.net/npm/i18next-http-backend@2.5.1/i18nextHttpBackend.min"]},packages:[]}),requirejs(["i18next","i18nextHttpBackend"],function(t,r){function n(){document.querySelectorAll("[data-i18n]").forEach(function(e){var n=e.getAttribute("data-i18n");e.textContent=t.t(n)})}function e(){return(e=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,new Promise(function(n){t.use(r).init({lng:"en",fallbackLng:"en",keySeparator:!1,nsSeparator:!1,interpolation:{escapeValue:!1},backend:{loadPath:"locales/{{lng}}.json?v="+Date.now()}},function(e){e&&console.error("i18next init failed:",e),window.i18next=t,n(t)})});case 1:t.changeLanguage("en",function(e){e?console.error("Error changing language:",e):n()}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),t.on("languageChanged",n),requirejs(["utils/utils","activity/activity"]);case 2:return e.a(2)}},e)}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()});
function _regenerator(){var b,t="function"==typeof Symbol?Symbol:{},e=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function r(t,e,i,r){var n,o,l,s,a,u,c,g,h,e=e&&e.prototype instanceof d?e:d,e=Object.create(e.prototype);return _regeneratorDefine2(e,"_invoke",(n=t,o=i,c=r||[],g=!1,h={p:u=0,n:0,v:b,a:p,f:p.bind(b,4),d:function(t,e){return l=t,s=0,a=b,h.n=e,k}},function(t,e,i){if(1<u)throw TypeError("Generator is already running");for(g&&1===e&&p(e,i),s=e,a=i;(v=s<2?b:a)||!g;){l||(s?s<3?(1<s&&(h.n=-1),p(s,a)):h.n=a:h.v=a);try{if(u=2,l){if(v=l[t=s?t:"next"]){if(!(v=v.call(l,a)))throw TypeError("iterator result is not an object");if(!v.done)return v;a=v.value,s<2&&(s=0)}else 1===s&&(v=l.return)&&v.call(l),s<2&&(a=TypeError("The iterator does not provide a '"+t+"' method"),s=1);l=b}else if((v=(g=h.n<0)?a:n.call(o,h))!==k)break}catch(t){l=b,s=1,a=t}finally{u=1}}return{value:v,done:g}}),!0),e;function p(t,e){for(s=t,a=e,v=0;!g&&u&&!i&&v<c.length;v++){var i,r=c[v],n=h.p,o=r[2];3<t?(i=o===e)&&(a=r[(s=r[4])?5:s=3],r[4]=r[5]=b):r[0]<=n&&((i=t<2&&n<r[1])?(s=0,h.v=e,h.n=r[1]):n<o&&(i=t<3||r[0]>e||o<e)&&(r[4]=t,r[5]=e,h.n=o,s=0))}if(i||1<t)return k;throw g=!0,e}}var k={};function d(){}function n(){}function o(){}var v=Object.getPrototypeOf,t=[][e]?v(v([][e]())):(_regeneratorDefine2(v={},e,function(){return this}),v),l=o.prototype=d.prototype=Object.create(t);function s(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,o):(t.__proto__=o,_regeneratorDefine2(t,i,"GeneratorFunction")),t.prototype=Object.create(l),t}return _regeneratorDefine2(l,"constructor",n.prototype=o),_regeneratorDefine2(o,"constructor",n),_regeneratorDefine2(o,i,n.displayName="GeneratorFunction"),_regeneratorDefine2(l),_regeneratorDefine2(l,i,"Generator"),_regeneratorDefine2(l,e,function(){return this}),_regeneratorDefine2(l,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:s}})()}function _regeneratorDefine2(t,e,i,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}(_regeneratorDefine2=function(t,e,i,r){function n(e,i){_regeneratorDefine2(t,e,function(t){return this._invoke(e,i,t)})}e?o?o(t,e,{value:i,enumerable:!r,configurable:!r,writable:!r}):t[e]=i:(n("next",0),n("throw",1),n("return",2))})(t,e,i,r)}function asyncGeneratorStep(t,e,i,r,n,o,l){try{var s=t[o](l),a=s.value}catch(t){return void i(t)}s.done?e(a):Promise.resolve(a).then(r,n)}function _asyncToGenerator(s){return function(){var t=this,l=arguments;return new Promise(function(e,i){var r=s.apply(t,l);function n(t){asyncGeneratorStep(r,e,i,n,o,"next",t)}function o(t){asyncGeneratorStep(r,e,i,n,o,"throw",t)}n(void 0)})}}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,n,o,l,s=[],a=!0,u=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;a=!1}else for(;!(a=(r=o.call(i)).done)&&(s.push(r.value),s.length!==e);a=!0);}catch(t){u=!0,n=t}finally{try{if(!a&&null!=i.return&&(l=i.return(),Object(l)!==l))return}finally{if(u)throw n}}return s}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t,e){var i,r,n,o,l="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(l)return n=!(r=!0),{s:function(){l=l.call(t)},n:function(){var t=l.next();return r=t.done,t},e:function(t){n=!0,i=t},f:function(){try{r||null==l.return||l.return()}finally{if(n)throw i}}};if(Array.isArray(t)||(l=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return l&&(t=l),o=0,{s:e=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var i;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(i="Object"===(i={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var DEFAULTVOLUME=50,PREVIEWVOLUME=80,DEFAULTDELAY=500,OSCVOLUMEADJUSTMENT=1.5,TONEBPM=240,TARGETBPM=90,TURTLESTEP=-1,NOTEDIV=8,NOMICERRORMSG="The microphone is not available.",NANERRORMSG="Not a number.",NOSTRINGERRORMSG="Not a string.",NOBOXERRORMSG="Cannot find box",NOACTIONERRORMSG="Cannot find action.",NOINPUTERRORMSG="Missing argument.",NOSQRTERRORMSG="Cannot take square root of negative number.",ZERODIVIDEERRORMSG="Cannot divide by zero.",EMPTYHEAPERRORMSG="empty heap.",POSNUMBER="Argument must be a positive number",INVALIDPITCH=_("Not a valid pitch name"),NOTATIONNOTE=0,NOTATIONDURATION=1,NOTATIONDOTCOUNT=2,NOTATIONTUPLETVALUE=3,NOTATIONROUNDDOWN=4,NOTATIONINSIDECHORD=5,NOTATIONSTACCATO=6,Queue=_createClass(function t(e,i,r,n){_classCallCheck(this,t),this.blk=e,this.count=i,this.parentBlk=r,this.args=n}),Logo=function(){function Logo(t){_classCallCheck(this,Logo),this.activity=t,this.blockList=this.activity.blocks.blockList,this._onStopTurtle=this.activity.onStopTurtle,this._onRunTurtle=this.activity.onRunTurtle,this._meSpeak=this.activity.meSpeak,this.reflection=null,this.phraseMaker=null,this.legoWidget=null,this.pitchDrumMatrix=null,this.arpeggio=null,this.rhythmRuler=null,this.timbre=null,this.pitchStaircase=null,this.temperament=null,this.tempo=null,this.pitchSlider=null,this.musicKeyboard=null,this.modeWidget=null,this.Oscilloscope=null,this.oscilloscopeTurtles=[],this.meterWidget=null,this.statusMatrix=null,this.legobricks=null,this.evalFlowDict={},this.evalArgDict={},this.evalParameterDict={},this.evalSetterDict={},this.evalOnStartList={},this.evalOnStopList={},this.pluginVars={},this.pluginReturnValue=null,this.eventList={},this.receivedArg=null,this.inputValues={},this.boxes={},this.actions={},this.returns={},this.turtleHeaps={},this.turtleDicts={},this.switchCases={},this.switchBlocks={},this._lastNoteTimeout=null,this._alreadyRunning=!1,this._prematureRestart=!1,this._runningBlock=null,this._ignoringBlock=null,this._currentlyHighlightedBlock=null,this.time=0,this.firstNoteTime=null,this._turtleDelay=0,this.sounds=[],this.cameraID=null,this.stopTurtle=!1,this.lastKeyCode=null,this.showPitchDrumMatrix=!1,this.inPitchDrumMatrix=!1,this.inRhythmRuler=!1,this.rhythmRulerMeasure=null,this.inPitchStaircase=!1,this.inTempo=!1,this.inPitchSlider=!1,this.inMusicKeyboard=!1,this._currentDrumBlock=null,this.inTimbre=!1,this.inArpeggio=!1,this.insideModeWidget=!1,this.insideMeterWidget=!1,this.insideTemperament=!1,this.inMatrix=!1,this.inLegoWidget=!1,this.tupletRhythms=[],this.addingNotesToTuplet=!1,this.drumBlocks=[],this.pitchBlocks=[],this.connectionStore={},this.connectionStoreLock=!1,this.tuplet=!1,this.tupletParams=[],this._notation=new Notation(this.activity),this.notationOutput="",this.notationNotes={},this.MIDIOutput="",this.guitarOutputHead="",this.guitarOutputEnd="",this.runningLilypond=!1,this.collectingStats=!1,this.runningAbc=!1,this.runningMxml=!1,this.runningMIDI=!1,this._checkingCompletionState=!1,this.recording=!1,this.recordingBuffer={hasData:!1,notationOutput:"",notationNotes:{},notationStaging:{},notationDrumStaging:{}},this.temperamentSelected=[],this.customTemperamentDefined=!1,this.specialArgs=[],this.synth=new Synth,this.synth.changeInTemperament=!1,this.modeBlock=null,this._meterBlock=null,this.inStatusMatrix=!1,this.inOscilloscope=!1,this.updatingStatusMatrix=!1,this.statusFields=[],this._midiData={},this.stepQueue={},this._unhighlightStepQueue={},this.svgOutput="",this.svgBackground=!0,this.mic=null,this.volumeAnalyser=null,this.pitchAnalyser=null}return _createClass(Logo,[{key:"onStopTurtle",get:function(){return this._onStopTurtle},set:function(t){this._onStopTurtle=t}},{key:"onRunTurtle",get:function(){return this._onRunTurtle},set:function(t){this._onRunTurtle=t}},{key:"turtleDelay",get:function(){return this._turtleDelay},set:function(t){this._turtleDelay=t}},{key:"notation",get:function(){return this._notation}},{key:"_restoreConnections",value:function(){for(var t in this.connectionStore)for(var e in this.connectionStore[t])for(var i=this.connectionStore[t][e].length,r=0;r<i;r++){var n=this.connectionStore[t][e].pop();this.blockList[n[0]].connections[n[1]]=n[2],null!=n[2]&&(this.blockList[n[2]].connections[0]=n[0])}}},{key:"prepSynths",value:function(){for(var t in this.synth.newTone(),this.activity.turtles.turtleList){var e,i=this.activity.turtles.ithTurtle(t);for(e in t in instruments||(instruments[t]={},instrumentsFilters[t]={},instrumentsEffects[t]={}),DEFAULTVOICE in instruments[t]||this.synth.createDefaultSynth(t),instruments[0])e in instruments[t]||(this.synth.loadSynth(t,e),e in instrumentsFilters[0]&&(instrumentsFilters[t][e]=instrumentsFilters[0][e]),e in instrumentsEffects[0]&&(instrumentsEffects[t][e]=instrumentsEffects[0][e]));i.singer.synthVolume={"electronic synth":[DEFAULTVOLUME],noise1:[DEFAULTVOLUME],noise2:[DEFAULTVOLUME],noise3:[DEFAULTVOLUME]},i.singer.synthVolume[DEFAULTVOICE]=[DEFAULTVOLUME]}for(var r in this.activity.turtles.turtleList)for(var n in this.activity.turtles.ithTurtle(r).singer.synthVolume)Singer.setSynthVolume(this,r,n,DEFAULTVOLUME)}},{key:"resetSynth",value:function(t){for(var e in DEFAULTVOICE in instruments[t]||this.synth.createDefaultSynth(t),Singer.setMasterVolume(this.activity.logo,DEFAULTVOLUME),this.activity.turtles.turtleList)for(var i in this.activity.turtles.ithTurtle(e).singer.synthVolume)Singer.setSynthVolume(this,e,i,DEFAULTVOLUME);this.synth.start()}},{key:"initMediaDevices",value:function(){var e=new Tone.UserMedia;try{e.open()}catch(t){this.activity.errorMsg(NOMICERRORMSG),e=null}this.mic=e,this.limit=16384}},{key:"clearNoteParams",value:function(t,e,i){t.singer.oscList[e]=[],t.singer.noteBeat[e]=[],t.singer.noteBeatValues[e]=[],t.singer.noteValue[e]=null,t.singer.notePitches[e]=[],t.singer.noteOctaves[e]=[],t.singer.noteCents[e]=[],t.singer.noteHertz[e]=[],t.singer.embeddedGraphics[e]=[],t.singer.noteDrums[e]=null!==i?i:[]}},{key:"processSpeak",value:function(t){var e,i="";for(e in t)new RegExp("^[A-Za-z,. ]$").test(t[e])&&(i+=t[e]);null!==this.meSpeak&&this.meSpeak.speak(i)}},{key:"processShow",value:function(t,e,i,r){var n,o=this.activity.turtles.getTurtle(t);"string"==typeof r?14===(n=r.length)&&r.substr(0,14)===CAMERAVALUE?doUseCamera([i],this.activity.turtles,t,!1,this.cameraID,this.setCameraID,this.activity.errorMsg):13===n&&r.substr(0,13)===VIDEOVALUE?doUseCamera([i],this.activity.turtles,t,!0,this.cameraID,this.setCameraID,this.activity.errorMsg):10<n&&"data:image"===r.substr(0,10)?o.doShowImage(i,r):8<n&&"https://"===r.substr(0,8)||7<n&&"http://"===r.substr(0,7)||7<n&&"file://"===r.substr(0,7)?o.doShowURL(i,r):o.doShowText(i,r):"object"===_typeof(r)&&null!==e&&"loadFile"===this.blockList[this.blockList[e].connections[2]].name?r?o.doShowText(i,r[1]):this.activity.errorMsg(_("You must select a file.")):o.doShowText(i,r)}},{key:"setCameraID",value:function(t){this.cameraID=t}},{key:"setTurtleListener",value:function(t,e,i){t=this.activity.turtles.ithTurtle(t);e in t.listeners&&this.activity.stage.removeEventListener(e,t.listeners[e],!1),t.listeners[e]=i,this.activity.stage.addEventListener(e,i,!1)}},{key:"setDispatchBlock",value:function(t,e,i){var r,e=this.activity.turtles.ithTurtle(e),n=null;null!==(n=!e.singer.inDuplicate&&0<e.singer.backward.length&&(r="backward"===this.blockList[last(e.singer.backward)].name?1:2,this.activity.blocks.sameGeneration(this.blockList[last(e.singer.backward)].connections[r],t))?this.blockList[t].connections[0]:last(this.blockList[t].connections))&&(n in e.endOfClampSignals?e.endOfClampSignals[n].push(i):e.endOfClampSignals[n]=[i])}},{key:"parseArg",value:function parseArg(logo,turtle,blk,parentBlk,receivedArg){var tur=logo.activity.turtles.ithTurtle(turtle),cblk,a;if(null==blk)return logo.activity.errorMsg(NOINPUTERRORMSG,parentBlk),null;if(!logo.blockList[blk].protoblock.parameter||tur.parameterQueue.includes(blk)||tur.parameterQueue.push(blk),"function"==typeof logo.blockList[blk].protoblock.arg)return logo.blockList[blk].value=logo.blockList[blk].protoblock.arg(logo,turtle,blk,receivedArg);if("intervalname"===logo.blockList[blk].name)return"string"==typeof logo.blockList[blk].value?(tur.singer.noteDirection=getIntervalDirection(logo.blockList[blk].value),getIntervalNumber(logo.blockList[blk].value)):0;if(logo.blockList[blk].isValueBlock())return logo.blockList[blk].value;if(["anyout","numberout","textout","booleanout"].includes(logo.blockList[blk].protoblock.dockTypes[0])){switch(logo.blockList[blk].name){case"dectofrac":logo.inStatusMatrix&&"print"===logo.blockList[logo.blockList[blk].connections[0]].name?logo.statusFields.push([blk,"dectofrac"]):(cblk=logo.blockList[blk].connections[1],null===cblk?(logo.activity.errorMsg(NOINPUTERRORMSG,blk),logo.blockList[blk].value=0):(a=logo.parseArg(logo,turtle,cblk,blk,receivedArg),"number"==typeof a?logo.blockList[blk].value=a<0?"-"+mixedNumber(-a):mixedNumber(a):(logo.activity.errorMsg(NANERRORMSG,blk),logo.blockList[blk].value=0)));break;case"hue":logo.inStatusMatrix&&"print"===logo.blockList[logo.blockList[blk].connections[0]].name?logo.statusFields.push([blk,"color"]):logo.blockList[blk].value=logo.activity.turtles.getTurtle(turtle).painter.color;break;case"returnValue":0<logo.returns[turtle].length?logo.blockList[blk].value=logo.returns[turtle].pop():logo.blockList[blk].value=0;break;default:logo.blockList[blk].name in logo.evalArgDict?(console.log("running eval on "+logo.blockList[blk].name),eval(logo.evalArgDict[logo.blockList[blk].name])):console.error("I do not know how to "+logo.blockList[blk].name)}return logo.blockList[blk].value}return blk}},{key:"updateNotation",value:function(t,e,i,r,n,o){null==o&&(o=!0);var l=this.activity.turtles.ithTurtle(i),e=1/e,s=(l.singer.notesPlayed[0]/l.singer.notesPlayed[1]-l.singer.pickup-e)*l.singer.noteValuePerBeat%l.singer.beatsPerMeasure/l.singer.noteValuePerBeat,s=l.singer.beatsPerMeasure/l.singer.noteValuePerBeat-s;if(o&&s<e){var a=s,u=l.singer.beatsPerMeasure/l.singer.noteValuePerBeat,c=rationalToFraction(e-s);if(0<a){for(var g=0;u<a;)++g,a-=u;var h=rationalToFraction(a);for(0!==h[0]&&this.updateNotation(t,h[1]/h[0],i,r,n,!1),(0<g||0<c[0])&&("R"!==t[0]&&(this.notation.notationInsertTie(i),this.notation.notationDrumStaging[i].push("tie")),h=rationalToFraction(1/u));0<g;)--g,0!==h[0]&&this.updateNotation(t,h[1]/h[0],i,r,n,!1),0<c[0]&&"R"!==t[0]&&(this.notation.notationInsertTie(i),this.notation.notationDrumStaging[i].push("tie"))}0<c[0]&&0!==c[0]&&this.updateNotation(t,c[1]/c[0],i,r,n,!1)}else(o=this.notation).doUpdateNotation.apply(o,arguments)}},{key:"notationMIDI",value:function(t,e,i,r,n,o){this._midiData[r]||(this._midiData[r]=[]),e=e&&e[0],this._midiData[r].push({note:t,duration:i,bpm:n,instrument:o,drum:e})}},{key:"clearTurtleRun",value:function(t){var e=this.activity.turtles.ithTurtle(t);null!==e.delayTimeout&&(clearTimeout(e.delayTimeout),e.delayTimeout=null,this.runFromBlockNow(this,t,e.delayParameters.blk,e.delayParameters.flow,e.delayParameters.arg))}},{key:"doBreak",value:function(t){for(var e,i=null,r=-1,n=t.queue.length-1;-1<n;n--){if(["forever","repeat","while","until"].includes(this.blockList[t.queue[n].blk].name)){r=t.queue[n].blk,i=this.blockList[r],t.queue.pop();break}if(["forever","repeat","while","until"].includes(this.blockList[t.queue[n].parentBlk].name)){r=t.queue[n].parentBlk,i=this.blockList[r],t.queue.pop();break}}null==i?t.queue.pop():"while"!==i.name&&"until"!==i.name||null!=(e=last(i.connections))&&(e=new Queue(e,1,r),t.parentFlowQueue.push(r),t.queue.push(e))}},{key:"initTurtle",value:function(t){this.connectionStore[t]={},this.connectionStoreLock=!1,this.switchCases[t]={},this.switchBlocks[t]=[],this.returns[t]=[],this.notation.notationStaging[t]=[],this.notation.notationDrumStaging[t]=[],this.notation.pickupPoint[t]=null,this.notation.pickupPOW2[t]=!1,this.activity.turtles.ithTurtle(t).initTurtle(this.runningLilypond||this.runningAbc||this.runningMxml||this.runningMIDI)}},{key:"doStopTurtles",value:function(){for(var t in this.stopTurtle=!0,this.activity.turtles.markAllAsStopped(),this.sounds)this.sounds[t].stop();for(var e in this.sounds=[],this.activity.turtles.turtleList){for(var i in instruments[e])this.synth.stopSound(e,i);var r=this.activity.turtles.getTurtle(e).companionTurtle;r&&(this.activity.turtles.getTurtle(r).running=!1,r=this.activity.turtles.getTurtle(r).interval)&&clearInterval(r)}this.synth.stop(),this.synth.recorder&&"recording"==this.synth.recorder.state&&this.synth.recorder.stop(),null!=this.cameraID&&doStopVideoCam(this.cameraID,this.setCameraID),this.onStopTurtle(),this.activity.blocks.bringToTop(),this.stepQueue={};var n,o=_createForOfIteratorHelper(this.activity.turtles.turtleList);try{for(o.s();!(n=o.n()).done;)n.value.unhighlightQueue=[]}catch(t){o.e(t)}finally{o.f()}this._restoreConnections(),document.body.style.cursor="default",this.activity.showBlocksAfterRun&&(this.activity.blocks.showBlocks(),document.getElementById("stop").style.color="white"),this.activity.showBlocksAfterRun=!1}},{key:"step",value:function(){for(var t in this.stepQueue){var e;0<this.stepQueue[t].length&&(t in this._unhighlightStepQueue&&null!=this._unhighlightStepQueue[t]&&(this.activity.blocks.visible&&this.activity.blocks.unhighlight(this._unhighlightStepQueue[t]),this._unhighlightStepQueue[t]=null),null!=(e=this.stepQueue[t].pop()))&&this.runFromBlockNow(this,t,e,0,null)}}},{key:"runLogoCommands",value:function runLogoCommands(startHere,env){var _this=this,arg;for(arg in this._prematureRestart=this._alreadyRunning,this._alreadyRunning&&null!==this._runningBlock?this._ignoringBlock=this._runningBlock:this._ignoringBlock=null,null!=this._lastNoteTimeout&&(clearTimeout(this._lastNoteTimeout),this._lastNoteTimeout=null),this._restoreConnections(),this.activity.saveLocally(),this.evalOnStartList)eval(this.evalOnStartList[arg]);this.stopTurtle=!1,this.activity.blocks.unhighlightAll(),this.activity.blocks.bringToTop(),this.activity.hideMsgs(),this.time=(new Date).getTime(),this.firstNoteTime=null,0===this.activity.turtles.getTurtleCount()&&this.activity.turtles.add(null),Singer.masterBPM=TARGETBPM,Singer.defaultBPMFactor=TONEBPM/TARGETBPM,this.synth.changeInTemperament=!1,this._checkingCompletionState=!1;var _iterator2=_createForOfIteratorHelper(this.activity.turtles.turtleList),_step2,turtle;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _turtle9=_step2.value;_turtle9.embeddedGraphicsFinished=!0}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}for(turtle in this.prepSynths(),this.notation.notationStaging={},this.notation.notationDrumStaging={},this.activity.turtles.turtleList)this.initTurtle(turtle);this.inPitchDrumMatrix=!1,this.inMatrix=!1,this.inLegoWidget=!1,this.inMusicKeyboard=!1,this.inTimbre=!1,this.inArpeggio=!1,this.inRhythmRuler=!1,this.insideModeWidget=!1,this.insideMeterWidget=!1,this.insideTemperament=!1,this.rhythmRulerMeasure=null,this._currentDrumBlock=null,this.inStatusMatrix=!1,this.pitchBlocks=[],this.drumBlocks=[],this.tuplet=!1,this.modeBlock=null,this._meterBlock=null;var _iterator3=_createForOfIteratorHelper(this.activity.turtles.turtleList),_step3,_turtle4;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _turtle0=_step3.value,listener;for(listener in _turtle0.listeners)this.activity.stage.removeEventListener(listener,_turtle0.listeners[listener],!1);_turtle0.listeners={}}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}for(_turtle4 in this.activity.turtles.turtleList){var requiredTurtle=this.activity.turtles.getTurtle(_turtle4);requiredTurtle.container.x=this.activity.turtles.turtleX2screenX(requiredTurtle.x),requiredTurtle.container.y=this.activity.turtles.turtleY2screenY(requiredTurtle.y)}window.widgetWindows.isOpen("status")&&(null===this.statusMatrix&&(this.statusMatrix=new StatusMatrix),this.statusMatrix.init(this.activity));var startBlocks=[];this.activity.blocks.findStacks(),this.actions={};for(var blk=0,c,b,name;blk<this.activity.blocks.stackList.length;blk++){["start","drum","status","oscilloscope"].includes(this.blockList[this.activity.blocks.stackList[blk]].name)?this.blockList[this.activity.blocks.stackList[blk]].trash||startBlocks.push(this.activity.blocks.stackList[blk]):"action"===this.blockList[this.activity.blocks.stackList[blk]].name&&(c=this.blockList[this.activity.blocks.stackList[blk]].connections[1],b=this.blockList[this.activity.blocks.stackList[blk]].connections[2],null==c||null==b||this.blockList[this.activity.blocks.stackList[blk]].trash||(name=this.parseArg(this,0,c,null),this.actions[name]=b))}this.svgOutput="",this.svgBackground=!0;var _iterator4=_createForOfIteratorHelper(this.activity.turtles.turtleList),_step4,_turtle5;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _turtle1=_step4.value;_turtle1.parentFlowQueue=[],_turtle1.unhighlightQueue=[],_turtle1.parameterQueue=[]}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}for(_turtle5 in 0===this.turtleDelay&&this.activity.blocks.clearParameterBlocks(),this.onRunTurtle(),0===this.activity.turtles.getTurtleCount()&&this.activity.turtles.addTurtle(null),this.activity.turtles.turtleList)this.activity.turtles.getTurtle(_turtle5).running=!1;if(0===this.activity.turtles.turtleCount())this.activity.errorMsg(NOACTIONERRORMSG,null,_("start"));else if(null!=startHere){for(var _turtle6=0;this.activity.turtles.getTurtle(_turtle6).inTrash&&_turtle6<this.activity.turtles.getTurtleCount();)++_turtle6;["start","drum"].includes(this.blockList[startHere].name)&&(_turtle6=this.blockList[startHere].value);var tur=this.activity.turtles.ithTurtle(_turtle6);tur.queue=[],tur.parentFlowQueue=[],tur.unhighlightQueue=[],tur.parameterQueue=[],tur.running=!0,this.runFromBlock(this,_turtle6,startHere,0,env)}else if(0<startBlocks.length){for(var delayStart=0,_b=0,_turtle7,_tur;_b<startBlocks.length;_b++){["status","oscilloscope"].includes(this.blockList[startBlocks[_b]].name)&&!this.blockList[startBlocks[_b]].trash&&(_turtle7=0,_tur=this.activity.turtles.ithTurtle(_turtle7),_tur.queue=[],_tur.parentFlowQueue=[],_tur.unhighlightQueue=[],_tur.parameterQueue=[],_tur.running=!0,delayStart=250,this.runFromBlock(this,_turtle7,startBlocks[_b],0,env))}setTimeout(function(){0!==delayStart&&_this.onRunTurtle();for(var t,e,i=0;i<startBlocks.length;i++)["status","oscilloscope"].includes(_this.blockList[startBlocks[i]].name)||(t=_this.blockList[startBlocks[i]].value,(e=_this.activity.turtles.ithTurtle(t)).queue=[],e.parentFlowQueue=[],e.unhighlightQueue=[],e.parameterQueue=[],e.inTrash)||(e.running=!0,_this.runFromBlock(_this,t,startBlocks[i],0,env))},delayStart)}else document.body.style.cursor="default";this.activity.refreshCanvas()}},{key:"runFromBlock",value:function(t,e,i,r,n){var o,l;null==(this._runningBlock=i)||(this.receivedArg=n,o=t.activity.turtles.ithTurtle(e),l=t.turtleDelay+o.waitTime,o.doWait(0),t.stopTurtle)||(t.turtleDelay===TURTLESTEP?(e in t.stepQueue||(t.stepQueue[e]=[]),t.stepQueue[e].push(i)):(o.delayParameters={blk:i,flow:r,arg:n},o.delayTimeout=setTimeout(function(){return t.runFromBlockNow(t,e,i,r,n)},l)))}},{key:"runFromBlockNow",value:function runFromBlockNow(logo,turtle,blk,isflow,receivedArg,queueStart){this._alreadyRunning=!0,this.receivedArg=receivedArg,void 0===queueStart&&(queueStart=0);var args=[];if(0<logo.blockList[blk].protoblock.args)for(var i=1;i<=logo.blockList[blk].protoblock.args;i++)"in"===logo.blockList[blk].protoblock.dockTypes[i]?null!==logo.blockList[blk].connections[i]&&args.push(logo.blockList[blk].connections[i]):args.push(logo.parseArg(logo,turtle,logo.blockList[blk].connections[i],blk,receivedArg)),0<logo.activity.turtles.ithTurtle(turtle).singer.inNoteBlock.length&&void 0!==logo.blockList[blk].connections[i]&&void 0!==logo.blockList[logo.blockList[blk].connections[i]]&&"currentpitch"===logo.blockList[logo.blockList[blk].connections[i]].name&&logo.specialArgs.push([args,logo,turtle,blk,receivedArg,null,isflow]);var tur=logo.activity.turtles.ithTurtle(turtle),nextFlow=null,c,nextFlow,queueBlock,childFlow=(logo.blockList[blk].isValueBlock()||(nextFlow=0<tur.singer.backward.length&&(c="backward"===logo.blockList[last(tur.singer.backward)].name?1:2,logo.activity.blocks.sameGeneration(logo.blockList[last(tur.singer.backward)].connections[c],blk))?(nextFlow=logo.blockList[blk].connections[0],"action"===logo.blockList[nextFlow].name||"backward"===logo.blockList[nextFlow].name?null:logo.activity.blocks.sameGeneration(logo.blockList[last(tur.singer.backward)].connections[c],nextFlow)?logo.blockList[blk].connections[0]:last(logo.blockList[blk].connections)):last(logo.blockList[blk].connections),-1===nextFlow&&(nextFlow=null),queueBlock=new Queue(nextFlow,1,blk,receivedArg),null!=nextFlow&&tur.queue.push(queueBlock)),null),childFlowCount=0,actionArgs=[],blockLabels,blockName,label,value,displayText,_queueBlock,_queueBlock;if(!logo.activity.blocks.visible||tur.singer.suppressOutput||0!==tur.singer.justCounting.length||(null!==logo._currentlyHighlightedBlock&&logo._currentlyHighlightedBlock!==blk&&logo.activity.blocks.unhighlight(logo._currentlyHighlightedBlock),logo.activity.blocks.highlight(blk,!1),logo._currentlyHighlightedBlock=blk),logo.blockList[blk].isArgBlock()){logo.blockList[blk].isArgBlock()||["anyout","numberout","textout","booleanout"].includes(logo.blockList[blk].protoblock.dockTypes[0])?(args.push(logo.parseArg(logo,turtle,blk,logo.receivedArg)),blockLabels={width:_("width"),height:_("height"),rightpos:_("right (screen)"),leftpos:_("left (screen)"),toppos:_("top (screen)"),bottompos:_("bottom (screen)")},blockName=logo.blockList[blk].name,label=blockLabels[blockName],null==logo.blockList[blk].value?logo.activity.textMsg("null block value"):(value=logo.blockList[blk].value.toString(),displayText=label?label+": "+value:value,logo.activity.textMsg(displayText))):logo.activity.errorMsg("I do not know how to "+logo.blockList[blk].name+".",blk),logo.stopTurtle=!0}else{var res=null,res=logo.blockList[blk].name in logo.evalFlowDict?(console.log("running eval on "+logo.blockList[blk].name),logo.pluginReturnValue=null,eval(logo.evalFlowDict[logo.blockList[blk].name]),logo.pluginReturnValue):logo.blockList[blk].protoblock.flow(args,logo,turtle,blk,receivedArg,actionArgs,isflow);if(res){var _res=res,_res2=_slicedToArray(_res,3),cf=_res2[0],cfc=_res2[1],ret=_res2[2];if(void 0!==cf&&(childFlow=cf),void 0!==cfc&&(childFlowCount=cfc),ret)return ret}}if(blk!==logo._ignoringBlock&&blk in tur.endOfClampSignals)for(;0<tur.endOfClampSignals[blk].length;){var signal=tur.endOfClampSignals[blk].pop();null!=signal&&logo.activity.stage.dispatchEvent(signal)}logo.statusMatrix&&logo.statusMatrix.isOpen&&!logo.inStatusMatrix&&logo.statusMatrix.updateAll(),null!=childFlow&&(_queueBlock="doArg"===logo.blockList[blk].name||"nameddoArg"===logo.blockList[blk].name?new Queue(childFlow,childFlowCount,blk,actionArgs):new Queue(childFlow,childFlowCount,blk,receivedArg),null!=tur.parentFlowQueue)&&(tur.parentFlowQueue.push(blk),tur.queue.push(_queueBlock));var nextBlock=null,parentBlk=null,passArg=null;if(tur.queue.length>queueStart&&(nextBlock=last(tur.queue).blk,parentBlk=last(tur.queue).parentBlk,passArg=last(tur.queue).args,1===last(tur.queue).count?tur.queue.pop():--last(tur.queue).count),null!=nextBlock){if(parentBlk!==blk&&(logo.turtleDelay===TURTLESTEP?logo._unhighlightStepQueue[turtle]=blk:tur.singer.suppressOutput||0!==tur.singer.justCounting.length||setTimeout(function(){logo.activity.blocks.visible&&(logo.activity.blocks.unhighlight(blk),logo._currentlyHighlightedBlock===blk)&&(logo._currentlyHighlightedBlock=null)},logo.turtleDelay+tur.waitTime)),!(0<tur.singer.backward.length&&null==logo.blockList[blk].connections[0]||0===tur.singer.backward.length&&null==last(logo.blockList[blk].connections))||tur.singer.suppressOutput||0!==tur.singer.justCounting.length||void 0!==tur.unhighlightQueue&&(0<tur.parentFlowQueue.length&&0<tur.queue.length&&last(tur.queue).parentBlk!==last(tur.parentFlowQueue)?tur.unhighlightQueue.push(last(tur.parentFlowQueue)):0<tur.unhighlightQueue.length&&setTimeout(function(){var t;logo.activity.blocks.visible?(t=tur.unhighlightQueue.pop(),logo.activity.blocks.unhighlight(t),logo._currentlyHighlightedBlock===t&&(logo._currentlyHighlightedBlock=null)):tur.unhighlightQueue.pop()},logo.turtleDelay)),0!==logo.turtleDelay)for(var pblk in tur.parameterQueue)logo.activity.blocks.updateParameterBlock(logo,turtle,tur.parameterQueue[pblk]);isflow?logo.runFromBlockNow(logo,turtle,nextBlock,isflow,passArg,queueStart):logo.runFromBlock(logo,turtle,nextBlock,isflow,passArg)}else{if(logo._alreadyRunning=!1,logo._prematureRestart)logo.activity.turtles.getTurtle(turtle).running=!1;else{for(var b in tur.endOfClampSignals)for(var _i=0;_i<tur.endOfClampSignals[b].length;_i++)null==tur.endOfClampSignals[b][_i]||null!=tur.butNotThese[b]&&-1!==tur.butNotThese[b].indexOf(_i)||tur.singer.runningFromEvent||logo.activity.stage.dispatchEvent(tur.endOfClampSignals[b][_i]);logo.activity.turtles.getTurtle(turtle).painter.closeSVG(),logo.activity.turtles.getTurtle(turtle).running=!1,logo.activity.turtles.running()||0!==queueStart||logo.onStopTurtle()}var comp=logo.activity.turtles.getTurtle(turtle).companionTurtle,interval,__checkCompletionState=(comp&&(logo.activity.turtles.getTurtle(comp).running=!1,interval=logo.activity.turtles.getTurtle(comp).interval,interval)&&clearInterval(interval),function(){if(!logo.activity.turtles.running()&&0===queueStart&&0===tur.singer.justCounting.length){if(logo.runningLilypond)logo.collectingStats?(logo.projectStats=getStatsFromNotation(logo.activity),logo.activity.statsWindow.displayInfo(logo.projectStats)):logo.activity.save.afterSaveLilypond(),logo.collectingStats=!1,logo.runningLilypond=!1;else if(logo.runningAbc)logo.activity.save.afterSaveAbc(),logo.runningAbc=!1;else if(logo.runningMxml)logo.activity.save.afterSaveMxml(),logo.runningMxml=!1;else if(logo.runningMIDI)logo.activity.save.afterSaveMIDI(),logo.runningMIDI=!1;else if(tur.singer.suppressOutput)logo.recording||logo.activity.errorMsg(_("Playback is ready."));else if(logo.notationOutput&&0<logo.notationOutput.length){logo.recordingBuffer.hasData=!0,logo.recordingBuffer.notationOutput=logo.notationOutput,logo.recordingBuffer.notationNotes=JSON.parse(JSON.stringify(logo.notationNotes)),logo.recordingBuffer.notationStaging={},logo.recordingBuffer.notationDrumStaging={};for(var t=0;t<logo.activity.turtles.getTurtleCount();t++)logo.notation.notationStaging[t]&&(logo.recordingBuffer.notationStaging[t]=_toConsumableArray(logo.notation.notationStaging[t])),logo.notation.notationDrumStaging[t]&&(logo.recordingBuffer.notationDrumStaging[t]=_toConsumableArray(logo.notation.notationDrumStaging[t]))}logo._lastNoteTimeout=setTimeout(function(){logo._lastNoteTimeout=null,tur.singer.runningFromEvent=!1,tur.singer.suppressOutput&&logo.recording&&(tur.singer.suppressOutput=!1)},1e3)}});setTimeout(__checkCompletionState,100)}}},{key:"dispatchTurtleSignals",value:(()=>{var n=_asyncToGenerator(_regenerator().m(function t(e,i,r,n){var s,a,o,l,u,c,g,h,p,b,k,d,v,y,f,m,T,S,O,_,L,A,E,N,R,D,w,I,M=this;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(s=this.activity.turtles.ithTurtle(e),0===Object.keys(s.singer.embeddedGraphics).length)return t.a(2);t.n=1;break;case 1:if(r in s.singer.embeddedGraphics){t.n=2;break}return t.a(2);case 2:if(0===s.singer.embeddedGraphics[r].length)return t.a(2);t.n=3;break;case 3:s.embeddedGraphicsFinished||(n+=.1),s.embeddedGraphicsFinished=!1,a=s.singer.suppressOutput,o=function(t,e,i,r){var n;switch(e){case"penup":case"pendown":break;default:n=M.parseArg(M,t,M.blockList[i].connections[1],i,M.receivedArg)}function o(t){switch(t){case"penup":s.painter.doPenUp();break;case"pendown":s.painter.doPenDown();break;case"setcolor":s.painter.doSetColor(n);break;case"sethue":s.painter.doSetHue(n);break;case"setshade":s.painter.doSetValue(n);break;case"settranslucency":s.painter.doSetPenAlpha(n);break;case"setgrey":s.painter.doSetChroma(n);break;case"setpensize":s.painter.doSetPensize(n)}}a?o(e):setTimeout(function(){return o(e)},r)},l=function(){var t;s.singer.suppressOutput?(t=s.painter.penState,s.painter.penState=!1,s.painter.doSetXY(0,0),s.painter.doSetHeading(0),s.painter.penState=t,M.svgBackground=!0):(s.painter.penState=!1,s.painter.doSetHeading(0),s.painter.doSetXY(0,0),s.painter.penState=!0)},u=function(t,e,i,r,n){var o=M.parseArg(M,t,M.blockList[e].connections[1],e,M.receivedArg)*n;if(a){t=s.painter.penState;s.painter.penState=!1,s.painter.doRight(o),s.painter.penState=t}else for(var l=0;l<NOTEDIV/s.singer.dispatchFactor;l++)(()=>{var t=i+l*r*s.singer.dispatchFactor,e=o/(NOTEDIV/s.singer.dispatchFactor);setTimeout(function(){return s.painter.doRight(e)},t)})()},c=function(e,i,t){var r;a?(r=M.parseArg(M,e,M.blockList[i].connections[1],i,M.receivedArg),s.painter.doSetHeading(r)):setTimeout(function(){var t=M.parseArg(M,e,M.blockList[i].connections[1],i,M.receivedArg);s.painter.doSetHeading(t)},t)},g=function(t,e,i,r,n){var o=M.parseArg(M,t,M.blockList[e].connections[1],e,M.receivedArg)*n;if(a){t=s.painter.penState;s.painter.penState=!1,s.painter.doForward(o),s.painter.penState=t}else for(var l=0;l<NOTEDIV/s.singer.dispatchFactor;l++)(()=>{var t=i+l*r*s.singer.dispatchFactor,e=o/(NOTEDIV/s.singer.dispatchFactor);0===l?setTimeout(function(){return s.painter.doForward(e,"first")},t):l===Math.ceil(NOTEDIV/s.singer.dispatchFactor)-1?setTimeout(function(){return s.painter.doForward(e,"last")},t):setTimeout(function(){return s.painter.doForward(e,"middle")},t)})()},h=function(i,r,t){var e,n;a?(e=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),n=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg),s.painter.doScrollXY(e,n)):setTimeout(function(){var t=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),e=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg);s.painter.doScrollXY(t,e)},t)},p=function(i,r,t){var e,n,o;a?(e=s.painter.penState,n=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),o=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg),s.painter.penState=!1,s.painter.doSetXY(n,o),s.painter.penState=e):setTimeout(function(){var t=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),e=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg);s.painter.doSetXY(t,e)},t)},b=function(t,e,i){var r,n;a||(r=M.parseArg(M,t,M.blockList[e].connections[1],e,M.receivedArg),n=M.parseArg(M,t,M.blockList[e].connections[2],e,M.receivedArg),setTimeout(function(){return M.processShow(t,null,r,n)},i))},k=function(t,e,i){var r;a||(r=M.parseArg(M,t,M.blockList[e].connections[1],e,M.receivedArg),setTimeout(function(){return M.processSpeak(r)},i))},d=function(t,e,i){var r;a||void 0!==(r=M.parseArg(M,t,M.blockList[e].connections[1],e,M.receivedArg))&&setTimeout(function(){return M.activity.textMsg(r.toString())},i)},v=function(t,e,i,r){var n=M.parseArg(M,t,M.blockList[e].connections[1],e,M.receivedArg),o=M.parseArg(M,t,M.blockList[e].connections[2],e,M.receivedArg);if(a){t=s.painter.penState;s.painter.penState=!1,s.painter.doArc(n,o),s.painter.penState=t}else for(var l=0;l<NOTEDIV/s.singer.dispatchFactor;l++)(()=>{var t=i+l*r*s.singer.dispatchFactor,e=n/(NOTEDIV/s.singer.dispatchFactor);setTimeout(function(){return s.painter.doArc(e,o)},t)})()},y=function(i,r,t){var e,n;a?(e=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),n=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg),s.painter.cp1x=e,s.painter.cp1y=n):setTimeout(function(){var t=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),e=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg);s.painter.cp1x=t,s.painter.cp1y=e},t)},f=function(i,r,t){var e,n;a?(e=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),n=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg),s.painter.cp2x=e,s.painter.cp2y=n):setTimeout(function(){var t=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),e=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg);s.painter.cp2x=t,s.painter.cp2y=e},t)},T=!(m=function(i,r,t){var e,n,o;a?(e=s.painter.penState,n=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),o=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg),s.painter.penState=!1,s.painter.doBezier(n,o),s.painter.penState=e):setTimeout(function(){var t=M.parseArg(M,i,M.blockList[r].connections[1],r,M.receivedArg),e=M.parseArg(M,i,M.blockList[r].connections[2],r,M.receivedArg);s.painter.doBezier(t,e)},t)}),O=!(S=function(t,e){var i;a?(i=s.painter.penState,s.painter.penState=!1,T=T?(s.painter.doEndFill(),!1):(s.painter.doStartFill(),!0),s.painter.penState=i):setTimeout(function(){T=T?(s.painter.doEndFill(),!1):(s.painter.doStartFill(),!0)},e)}),_=function(t,e){a?O=O?(s.painter.doEndHollowLine(),!1):(s.painter.doStartHollowLine(),!0):setTimeout(function(){O=O?(s.painter.doEndHollowLine(),!1):(s.painter.doStartHollowLine(),!0)},e)},A=L=0;case 4:A<s.singer.embeddedGraphics[r].length?(I=s.singer.embeddedGraphics[r][A],I=this.blockList[I].name,t.n="forward"===I||"back"===I||"right"===I||"left"===I||"arc"===I?5:6):t.n=8;break;case 5:return++L,t.a(3,7);case 6:return t.a(3,7);case 7:A++,t.n=4;break;case 8:(E=995*(i-n)/NOTEDIV)<0&&(E=0),0<L&&(E/=L),N=1e3*n,s.singer.dispatchFactor=200<E?NOTEDIV/32:100<E?NOTEDIV/16:50<E?NOTEDIV/8:25<E?NOTEDIV/4:12.5<E?NOTEDIV/2:NOTEDIV,R=0;case 9:R<s.singer.embeddedGraphics[r].length?(D=s.singer.embeddedGraphics[r][R],w=this.blockList[D].name,I=w,t.n="setcolor"===I||"sethue"===I||"setshade"===I||"settranslucency"===I||"setgrey"===I||"setpensize"===I?10:"penup"===I||"pendown"===I?11:"clear"===I?12:"fill"===I?13:"hollowline"===I?14:"controlpoint1"===I?15:"controlpoint2"===I?16:"bezier"===I?17:"setheading"===I?18:"right"===I?19:"left"===I?20:"forward"===I?21:"back"===I?22:"setxy"===I?23:"scrollxy"===I?24:"show"===I?25:"speak"===I?26:"print"===I?27:"arc"===I?28:29):t.n=31;break;case 10:return o(e,w,D,N),t.a(3,30);case 11:return a||o(e,w,null,N),t.a(3,30);case 12:return l(),t.a(3,30);case 13:return S(e,N),t.a(3,30);case 14:return _(e,N),t.a(3,30);case 15:return y(e,D,N),t.a(3,30);case 16:return f(e,D,N),t.a(3,30);case 17:return m(e,D,N),t.a(3,30);case 18:return c(e,D,N),t.a(3,30);case 19:return u(e,D,N,E,1),N+=NOTEDIV*E,t.a(3,30);case 20:return u(e,D,N,E,-1),N+=NOTEDIV*E,t.a(3,30);case 21:return g(e,D,N,E,1),N+=NOTEDIV*E,t.a(3,30);case 22:return g(e,D,N,E,-1),N+=NOTEDIV*E,t.a(3,30);case 23:return p(e,D,N),t.a(3,30);case 24:return h(e,D,N),t.a(3,30);case 25:return b(e,D,N),t.a(3,30);case 26:return k(e,D,N),t.a(3,30);case 27:return d(e,D,N),t.a(3,30);case 28:return v(e,D,N,E),N+=NOTEDIV*E,t.a(3,30);case 29:return t.a(3,30);case 30:R++,t.n=9;break;case 31:return t.n=32,delayExecution(1e3*i);case 32:s.embeddedGraphicsFinished=!0;case 33:return t.a(2)}},t,this)}));return function(t,e,i,r){return n.apply(this,arguments)}})()}])}();"undefined"!=typeof module&&module.exports&&(module.exports={Queue:Queue,Logo:Logo,DEFAULTVOLUME:DEFAULTVOLUME,PREVIEWVOLUME:PREVIEWVOLUME,DEFAULTDELAY:DEFAULTDELAY,OSCVOLUMEADJUSTMENT:OSCVOLUMEADJUSTMENT,TONEBPM:TONEBPM,TARGETBPM:TARGETBPM,TURTLESTEP:TURTLESTEP,NOTEDIV:NOTEDIV,NOMICERRORMSG:NOMICERRORMSG,NANERRORMSG:NANERRORMSG,NOSTRINGERRORMSG:NOSTRINGERRORMSG,NOBOXERRORMSG:NOBOXERRORMSG,NOACTIONERRORMSG:NOACTIONERRORMSG,NOINPUTERRORMSG:NOINPUTERRORMSG,NOSQRTERRORMSG:NOSQRTERRORMSG,ZERODIVIDEERRORMSG:ZERODIVIDEERRORMSG,EMPTYHEAPERRORMSG:EMPTYHEAPERRORMSG,POSNUMBER:POSNUMBER,NOTATIONNOTE:NOTATIONNOTE,NOTATIONDURATION:NOTATIONDURATION,NOTATIONDOTCOUNT:NOTATIONDOTCOUNT,NOTATIONTUPLETVALUE:NOTATIONTUPLETVALUE,NOTATIONROUNDDOWN:NOTATIONROUNDDOWN,NOTATIONINSIDECHORD:NOTATIONINSIDECHORD,NOTATIONSTACCATO:NOTATIONSTACCATO});
var blockIsMacro=function(e,l){e=e.blocks.protoBlockDict[l];return!(!e||!e.macroFunc)||-1<["actionhelp","amsynthhelp","archelp","articulationhelp","beatvaluehelp","bottomposhelp","box1help","box2help","bpmhelp","broadcasthelp","chorushelp","clickhelp","currentpitchhelp","cursordownhelp","cursorouthelp","cursoroverhelp","cursoruphelp","decrescendohelp","deltapitchhelp","dishelp","dohelp","dothelp","doublyhelp","duphelp","effectshelp","eihelp","elapsedhelp","elifhelp","everybeathelp","fillhelp","fmsynthhelp","foreverhelp","forwardhelp","harmonichelp","ifhelp","intervalhelp","inverthelp","lrhelp","makehelp","mapdrumhelp","mousebuttonhelp","movablehelp","multiplybeathelp","neighborhelp","neighbor2help","swinghelp","notecounterhelp","oneOf","oneofhelp","osctimehelp","outputtools","phaserhelp","pitchnumberhelp","randomhelp","registerhelp","repeathelp","samplerhelp","setdrumhelp","settimbrehelp","scalartranshelp","skiphelp","slurhelp","staccatohelp","switchhelp","tiehelp","tremolohelp","untilhelp","vibratohelp","waitforhelp","whilehelp","wraphelp","xyhelp"].indexOf(l)},getMacroExpansion=function(e,l,u,n){var e=e.blocks.protoBlockDict[l];return e&&e.macroFunc?e.macroFunc(u,n):(e={actionhelp:[[0,"action",u,n,[null,31,1,null]],[1,"settimbre",0,0,[0,2,4,3]],[2,["voicename",{value:"guitar"}],0,0,[1]],[3,"hidden",0,0,[1,null]],[4,"newnote",0,0,[1,5,8,12]],[5,"divide",0,0,[4,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"vspace",0,0,[4,9]],[9,"pitch",0,0,[8,10,11,null]],[10,["solfege",{value:"sol"}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"hidden",0,0,[4,13]],[13,"newnote",0,0,[12,14,17,21]],[14,"divide",0,0,[13,15,16]],[15,["number",{value:1}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"vspace",0,0,[13,18]],[18,"pitch",0,0,[17,19,20,null]],[19,["solfege",{value:"mi"}],0,0,[18]],[20,["number",{value:4}],0,0,[18]],[21,"hidden",0,0,[13,22]],[22,"newnote",0,0,[21,23,26,30]],[23,"divide",0,0,[22,24,25]],[24,["number",{value:1}],0,0,[23]],[25,["number",{value:2}],0,0,[23]],[26,"vspace",0,0,[22,27]],[27,"pitch",0,0,[26,28,29,null]],[28,["solfege",{value:"sol"}],0,0,[27]],[29,["number",{value:4}],0,0,[27]],[30,"hidden",0,0,[22,null]],[31,["text",{value:_("action")}],0,0,[0]]],archelp:[[0,"everybeatdo",u,n,[null,1,null]],[1,["text",{value:"action"}],0,0,[0]],[2,["action",{collapsed:!1}],u,n+100,[null,3,4,null]],[3,["text",{value:"action"}],0,0,[2]],[4,"hidden",0,0,[2,5]],[5,"arc",0,0,[4,8,7,null]],[6,["number",{value:360}],0,0,[8]],[7,["number",{value:100}],0,0,[5]],[8,"multiply",0,0,[5,9,6]],[9,"mynotevalue",0,0,[8]]],amsynthhelp:[[0,["newnote",{collapsed:!1}],0,0,[9,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]],[9,"settimbre",u,n+200,[null,10,0,11]],[10,["voicename",{value:"custom"}],0,0,[9]],[11,"hidden",0,0,[9,null]],[12,["timbre",{collapsed:!1}],u,n,[null,13,15,14]],[13,["text",{value:"custom"}],0,0,[12]],[14,"hiddennoflow",0,0,[12,null]],[15,"amsynth",0,0,[12,16,null]],[16,["number",{value:1}],0,0,[15]]],acticulationhelp:[[0,"articulation",u,n,[null,31,1,null]],[1,"settimbre",0,0,[0,2,4,3]],[2,["voicename",{value:"guitar"}],0,0,[1]],[3,"hidden",0,0,[1,null]],[4,"newnote",0,0,[1,5,8,12]],[5,"divide",0,0,[4,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"vspace",0,0,[4,9]],[9,"pitch",0,0,[8,10,11,null]],[10,["solfege",{value:"sol"}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"hidden",0,0,[4,13]],[13,"newnote",0,0,[12,14,17,21]],[14,"divide",0,0,[13,15,16]],[15,["number",{value:1}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"vspace",0,0,[13,18]],[18,"pitch",0,0,[17,19,20,null]],[19,["solfege",{value:"mi"}],0,0,[18]],[20,["number",{value:4}],0,0,[18]],[21,"hidden",0,0,[13,22]],[22,"newnote",0,0,[21,23,26,30]],[23,"divide",0,0,[22,24,25]],[24,["number",{value:1}],0,0,[23]],[25,["number",{value:2}],0,0,[23]],[26,"vspace",0,0,[22,27]],[27,"pitch",0,0,[26,28,29,null]],[28,["solfege",{value:"sol"}],0,0,[27]],[29,["number",{value:4}],0,0,[27]],[30,"hidden",0,0,[22,null]],[31,["number",{value:25}],0,0,[0]]],beatvaluehelp:[[0,"setheading",u,n,[null,2,null]],[1,"beatvalue",0,0,[2]],[2,"multiply",0,0,[0,1,3]],[3,["number",{value:90}],0,0,[2]]],bottomposhelp:[[0,"setheading",u,n,[2,1,14]],[1,["number",{value:0}],0,0,[0]],[2,["start",{collapsed:!1}],u,n,[null,0,null]],[3,"if",0,0,[4,13,8,null]],[4,"forward",0,0,[14,5,3]],[5,["number",{value:10}],0,0,[4]],[6,"setxy",0,0,[8,7,10,9]],[7,["number",{value:0}],0,0,[6]],[8,"penup",0,0,[3,6]],[9,"pendown",0,0,[6,null]],[10,"bottompos",0,0,[6]],[11,"toppos",0,0,[13]],[12,"y",0,0,[13]],[13,"greater",0,0,[3,12,11]],[14,"forever",0,0,[0,4,null]]],box1help:[[0,["storein2",{value:"box1"}],u,n,[null,1,null]],[1,["number",{value:1}],0,0,[0]],[2,["namedbox",{value:"box1"}],0,0,[11]],[3,"incrementOne",0,0,[10,4,null]],[4,["namedbox",{value:"box1"}],0,0,[3]],[5,["nameddo",{value:_("action")}],0,0,[10,null]],[6,["nameddo",{value:_("action")}],0,0,[8,null]],[7,"backward",0,0,[10,8,9]],[8,"hidden",0,0,[7,6]],[9,"hidden",0,0,[7,null]],[10,"ifthenelse",u,n+100,[null,11,5,7,3]],[11,"equal",0,0,[10,2,12]],[12,["number",{value:1}],0,0,[11]]],box2help:[[0,["nameddo",{value:_("action")}],u,n,[1,null]],[1,"if",u,n+100,[null,7,0,2]],[2,"increment",0,0,[1,3,5,null]],[3,["namedbox",{value:"box2"}],0,0,[2]],[4,["namedbox",{value:"box2"}],0,0,[7]],[5,["number",{value:4}],0,0,[2]],[6,["number",{value:4}],0,0,[7]],[7,"greater",0,0,[1,4,6]],[8,["storein2",{value:"box2"}],u,n,[null,9,null]],[9,["number",{value:1}],0,0,[8]]],bpmhelp:[[0,["start",{collapsed:!1}],u,n,[null,1,null]],[1,"setbpm3",0,0,[0,2,3,6]],[2,["number",{value:30}],0,0,[1]],[3,"divide",0,0,[1,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"vspace",0,0,[1,7]],[7,["newnote",{collapsed:!1}],0,0,[6,8,11,15]],[8,"divide",0,0,[7,9,10]],[9,["number",{value:1}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"vspace",0,0,[7,12]],[12,"pitch",0,0,[11,13,14,null]],[13,["solfege",{value:"sol"}],0,0,[12]],[14,["number",{value:4}],0,0,[12]],[15,"hidden",0,0,[7,null]]],broadcasthelp:[[0,"listen",u,n,[null,7,1,null]],[1,["text",{value:"action"}],0,0,[0]],[2,"listen",u,n+100,[null,3,4,null]],[3,["text",{value:"event"}],0,0,[2]],[4,["text",{value:"action"}],0,0,[2]],[5,"dispatch",u,n+200,[null,6,null]],[6,["text",{value:"event"}],0,0,[5]],[7,"myclick",0,0,[0]]],chorushelp:[[0,"chorus",u,n,[null,1,2,3,4,null]],[1,["number",{value:1.5}],0,0,[0]],[2,["number",{value:3.5}],0,0,[0]],[3,["number",{value:70}],0,0,[0]],[4,["newnote",{collapsed:!1}],0,0,[0,5,8,12]],[5,"divide",0,0,[4,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"vspace",0,0,[4,9]],[9,"pitch",0,0,[8,10,11,null]],[10,["solfege",{value:"sol"}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"hidden",0,0,[4,null]]],clickhelp:[[0,["start",{collapsed:!1}],u,n,[null,1,null]],[1,"setturtlename2",0,0,[0,2,3]],[2,["text",{value:"snare drum"}],0,0,[1]],[3,"listen",0,0,[1,5,4,null]],[4,["text",{value:"action"}],0,0,[3]],[5,"myclick",0,0,[3]],[6,["action",{collapsed:!1}],u,n+200,[null,7,8,null]],[7,["text",{value:"action"}],0,0,[6]],[8,"hidden",0,0,[6,9]],[9,["newnote",{collapsed:!1}],0,0,[8,10,13,15]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"playdrum",0,0,[13,16,null]],[15,"hidden",0,0,[9,null]],[16,"turtlename",0,0,[14]]],currentpitchhelp:[[0,"newnote",u,n,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,9]],[9,"print",0,0,[8,10,null]],[10,["outputtools",{value:"pitch in hertz"}],0,0,[9,11]],[11,"currentpitch",0,0,[10]]],cursordownhelp:[[0,["start",{collapsed:!1}],u,n,[null,1,null]],[1,"setturtlename2",0,0,[0,2,3]],[2,["text",{value:"snare drum"}],0,0,[1]],[3,"listen",0,0,[1,5,4,null]],[4,["text",{value:"action"}],0,0,[3]],[5,"mycursordown",0,0,[3]],[6,["action",{collapsed:!1}],u,n+200,[null,7,8,null]],[7,["text",{value:"action"}],0,0,[6]],[8,"hidden",0,0,[6,9]],[9,["newnote",{collapsed:!1}],0,0,[8,10,13,15]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"playdrum",0,0,[13,16,null]],[15,"hidden",0,0,[9,null]],[16,"turtlename",0,0,[14]]],cursorouthelp:[[0,["start",{collapsed:!1}],u,n,[null,1,null]],[1,"setturtlename2",0,0,[0,2,3]],[2,["text",{value:"snare drum"}],0,0,[1]],[3,"listen",0,0,[1,5,4,null]],[4,["text",{value:"action"}],0,0,[3]],[5,"mycursorout",0,0,[3]],[6,["action",{collapsed:!1}],u,n+200,[null,7,8,null]],[7,["text",{value:"action"}],0,0,[6]],[8,"hidden",0,0,[6,9]],[9,["newnote",{collapsed:!1}],0,0,[8,10,13,15]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"playdrum",0,0,[13,16,null]],[15,"hidden",0,0,[9,null]],[16,"turtlename",0,0,[14]]],cursoroverhelp:[[0,["start",{collapsed:!1}],u,n,[null,1,null]],[1,"setturtlename2",0,0,[0,2,3]],[2,["text",{value:"snare drum"}],0,0,[1]],[3,"listen",0,0,[1,5,4,null]],[4,["text",{value:"action"}],0,0,[3]],[5,"mycursorover",0,0,[3]],[6,["action",{collapsed:!1}],u,n+200,[null,7,8,null]],[7,["text",{value:"action"}],0,0,[6]],[8,"hidden",0,0,[6,9]],[9,["newnote",{collapsed:!1}],0,0,[8,10,13,15]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"playdrum",0,0,[13,16,null]],[15,"hidden",0,0,[9,null]],[16,"turtlename",0,0,[14]]],cursoruphelp:[[0,["start",{collapsed:!1}],u,n,[null,1,null]],[1,"setturtlename2",0,0,[0,2,3]],[2,["text",{value:"snare drum"}],0,0,[1]],[3,"listen",0,0,[1,5,4,null]],[4,["text",{value:"action"}],0,0,[3]],[5,"mycursorup",0,0,[3]],[6,["action",{collapsed:!1}],u,n+200,[null,7,8,null]],[7,["text",{value:"action"}],0,0,[6]],[8,"hidden",0,0,[6,9]],[9,["newnote",{collapsed:!1}],0,0,[8,10,13,15]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"playdrum",0,0,[13,16,null]],[15,"hidden",0,0,[9,null]],[16,"turtlename",0,0,[14]]],crescendohelp:[[0,"crescendo",u,n,[null,31,1,null]],[1,"settimbre",0,0,[0,2,4,3]],[2,["voicename",{value:"guitar"}],0,0,[1]],[3,"hidden",0,0,[1,null]],[4,"newnote",0,0,[1,5,8,12]],[5,"divide",0,0,[4,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"vspace",0,0,[4,9]],[9,"pitch",0,0,[8,10,11,null]],[10,["solfege",{value:"sol"}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"hidden",0,0,[4,13]],[13,"newnote",0,0,[12,14,17,21]],[14,"divide",0,0,[13,15,16]],[15,["number",{value:1}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"vspace",0,0,[13,18]],[18,"pitch",0,0,[17,19,20,null]],[19,["solfege",{value:"mi"}],0,0,[18]],[20,["number",{value:4}],0,0,[18]],[21,"hidden",0,0,[13,22]],[22,"newnote",0,0,[21,23,26,30]],[23,"divide",0,0,[22,24,25]],[24,["number",{value:1}],0,0,[23]],[25,["number",{value:2}],0,0,[23]],[26,"vspace",0,0,[22,27]],[27,"pitch",0,0,[26,28,29,null]],[28,["solfege",{value:"sol"}],0,0,[27]],[29,["number",{value:4}],0,0,[27]],[30,"hidden",0,0,[22,null]],[31,["number",{value:5}],0,0,[0]]],decrescendohelp:[[0,"decrescendo",u,n,[null,31,1,null]],[1,"settimbre",0,0,[0,2,4,3]],[2,["voicename",{value:"guitar"}],0,0,[1]],[3,"hidden",0,0,[1,null]],[4,"newnote",0,0,[1,5,8,12]],[5,"divide",0,0,[4,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"vspace",0,0,[4,9]],[9,"pitch",0,0,[8,10,11,null]],[10,["solfege",{value:"sol"}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"hidden",0,0,[4,13]],[13,"newnote",0,0,[12,14,17,21]],[14,"divide",0,0,[13,15,16]],[15,["number",{value:1}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"vspace",0,0,[13,18]],[18,"pitch",0,0,[17,19,20,null]],[19,["solfege",{value:"mi"}],0,0,[18]],[20,["number",{value:4}],0,0,[18]],[21,"hidden",0,0,[13,22]],[22,"newnote",0,0,[21,23,26,30]],[23,"divide",0,0,[22,24,25]],[24,["number",{value:1}],0,0,[23]],[25,["number",{value:2}],0,0,[23]],[26,"vspace",0,0,[22,27]],[27,"pitch",0,0,[26,28,29,null]],[28,["solfege",{value:"sol"}],0,0,[27]],[29,["number",{value:4}],0,0,[27]],[30,"hidden",0,0,[22,null]],[31,["number",{value:5}],0,0,[0]]],deletehelp:[[0,"start",u,n,[null,18,null]],[1,["makeblock",{}],496,139,[5,2,3,4,7]],[2,["text",{value:"note"}],611,139,[1]],[3,["solfege",{value:"sol"}],525,171,[1]],[4,["number",{value:4}],525,202,[1]],[5,["storein",{}],418,107,[18,6,1,8]],[6,["text",{value:"box"}],496,107,[5]],[7,["number",{value:4}],525,234,[1]],[8,["vspace",{}],418,170,[5,9]],[9,["vspace",{}],418,202,[8,10]],[10,["vspace",{}],418,234,[9,11]],[11,["vspace",{}],418,266,[10,13]],[12,["namedbox",{value:"box"}],507,298,[13]],[13,["runblock",{}],418,298,[11,12,20]],[14,["deleteblock",{}],418,394,[16,15,null]],[15,["namedbox",{value:"box"}],527,394,[14]],[16,["wait",{}],418,362,[20,17,14]],[17,["number",{value:2}],492,362,[16]],[18,["print",{}],418,75,[0,19,5]],[19,["text",{value:"Hello Note!"}],492,75,[18]],[20,["print",{}],418,330,[13,21,16]],[21,["text",{value:"Goodbye Note!"}],492,330,[20]]],deltapitchhelp:[[0,["action",{collapsed:!1}],u,n+100,[null,1,2,null]],[1,["text",{value:"action"}],0,0,[0]],[2,"hidden",0,0,[0,3]],[3,"forward",533,361,[2,6,null]],[4,"everybeatdo",u,n,[null,5,null]],[5,["text",{value:"action"}],0,0,[4]],[6,"deltapitch",0,0,[3]]],dishelp:[[0,"dis",u,n,[null,11,1,10]],[1,"newnote",u,n,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"hidden",0,0,[1,null]],[10,"hidden",0,0,[0,null]],[11,["number",{value:40}],0,0,[0]]],dohelp:[[0,"do",u,n,[null,2,3]],[1,["text",{value:"part 2"}],790,122,[2]],[2,"oneOf",0,0,[0,4,1]],[3,"vspace",0,0,[0,null]],[4,["text",{value:"part 1"}],0,0,[2]]],dothelp:[[0,["newnote",{collapsed:!1}],0,0,[18,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]],[9,["newnote",{collapsed:!1}],0,0,[20,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:3}],0,0,[10]],[12,["number",{value:8}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["solfege",{value:"sol"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"hidden",0,0,[9,null]],[18,"rhythmicdot2",u,n,[null,19,0,20]],[19,["number",{value:1}],0,0,[18]],[20,"hidden",0,0,[18,9]]],doublyhelp:[[0,"semitoneinterval",u,n,[null,1,6,7]],[1,"plus",0,0,[0,8,3]],[2,["intervalname",{value:"augmented 5"}],0,0,[8]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,["number",{value:12}],0,0,[3]],[6,"vspace",0,0,[0,9]],[7,"hidden",0,0,[0,18]],[8,"doubly",0,0,[1,2]],[9,["newnote",{collapsed:!1}],0,0,[6,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["solfege",{value:"sol"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"hidden",0,0,[9,null]],[18,["newnote",{collapsed:!1}],0,0,[7,19,22,26]],[19,"divide",0,0,[18,20,21]],[20,["number",{value:1}],0,0,[19]],[21,["number",{value:4}],0,0,[19]],[22,"vspace",0,0,[18,23]],[23,"pitch",0,0,[22,24,25,27]],[24,["solfege",{value:"sol"}],0,0,[23]],[25,["number",{value:4}],0,0,[23]],[26,"hidden",0,0,[18,null]],[27,"pitch",0,0,[23,28,29,null]],[28,["solfege",{value:"mi"}],0,0,[27]],[29,["number",{value:5}],0,0,[27]]],duosynthhelp:[[0,"duosynth",u,n,[15,1,2,null]],[1,["number",{value:10}],0,0,[0]],[2,["number",{value:5}],0,0,[0]],[3,["newnote",{collapsed:!1}],0,0,[12,4,7,11]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:2}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"pitch",0,0,[7,9,10,null]],[9,["solfege",{value:"sol"}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"hidden",0,0,[3,null]],[12,"settimbre",u,n+200,[null,13,3,14]],[13,["voicename",{value:"custom"}],0,0,[12]],[14,"hidden",0,0,[12,null]],[15,["timbre",{collapsed:!1}],u,n,[null,16,0,17]],[16,["text",{value:"custom"}],0,0,[15]],[17,"hiddennoflow",0,0,[15,null]]],duphelp:[[0,["newnote",{collapsed:!1}],0,0,[18,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,9]],[9,["newnote",{collapsed:!1}],0,0,[8,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["solfege",{value:"mi"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"hidden",0,0,[9,null]],[18,"duplicatenotes",u,n,[null,19,0,20]],[19,["number",{value:2}],0,0,[18]],[20,"hidden",0,0,[18,null]],[21,["newnote",{collapsed:!1}],u,n+400,[null,22,25,29]],[22,"divide",0,0,[21,23,24]],[23,["number",{value:1}],0,0,[22]],[24,["number",{value:4}],0,0,[22]],[25,"vspace",0,0,[21,26]],[26,"pitch",0,0,[25,27,28,null]],[27,["solfege",{value:"sol"}],0,0,[26]],[28,["number",{value:4}],0,0,[26]],[29,"hidden",0,0,[21,30]],[30,["newnote",{collapsed:!1}],0,0,[29,31,34,38]],[31,"divide",0,0,[30,32,33]],[32,["number",{value:1}],0,0,[31]],[33,["number",{value:4}],0,0,[31]],[34,"vspace",0,0,[30,35]],[35,"pitch",0,0,[34,36,37,null]],[36,["solfege",{value:"sol"}],0,0,[35]],[37,["number",{value:4}],0,0,[35]],[38,"hidden",0,0,[30,39]],[39,["newnote",{collapsed:!1}],0,0,[38,40,43,47]],[40,"divide",0,0,[39,41,42]],[41,["number",{value:1}],0,0,[40]],[42,["number",{value:4}],0,0,[40]],[43,"vspace",0,0,[39,44]],[44,"pitch",0,0,[43,45,46,null]],[45,["solfege",{value:"mi"}],0,0,[44]],[46,["number",{value:4}],0,0,[44]],[47,"hidden",0,0,[39,48]],[48,["newnote",{collapsed:!1}],0,0,[47,49,52,56]],[49,"divide",0,0,[48,50,51]],[50,["number",{value:1}],0,0,[49]],[51,["number",{value:4}],0,0,[49]],[52,"vspace",0,0,[48,53]],[53,"pitch",0,0,[52,54,55,null]],[54,["solfege",{value:"mi"}],0,0,[53]],[55,["number",{value:4}],0,0,[53]],[56,"hidden",0,0,[48,null]]],effectshelp:[[0,"newnote",u,n,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"playdrum",0,0,[4,6,null]],[6,["drumname",{value:_("duck")}],0,0,[5]],[7,"hidden",0,0,[0,null]]],eihelp:[[0,"newnote",u,n,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["eastindiansolfege",{value:"pa"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]]],elifhelp:[[0,["newnote",{collapsed:!1}],0,0,[16,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,6]],[5,"hidden",0,0,[0,null]],[6,"playdrum",0,0,[4,7,null]],[7,["drumname",{value:"kick drum"}],0,0,[6]],[8,["newnote",{collapsed:!1}],0,0,[16,9,12,15]],[9,"divide",0,0,[8,10,11]],[10,["number",{value:1}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"vspace",0,0,[8,13]],[13,"playdrum",0,0,[12,14,null]],[14,["drumname",{value:"snare drum"}],0,0,[13]],[15,"hidden",0,0,[8,null]],[16,"ifthenelse",0,0,[17,18,8,0,null]],[17,"forever",u,n,[null,16,null]],[18,"mousebutton",0,0,[16]]],elapsedhelp:[[0,["newnote",{collapsed:!1}],0,0,[6,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,8]],[5,"hidden",0,0,[0,null]],[6,"repeat",0,0,[19,7,0,null]],[7,["number",{value:400}],0,0,[6]],[8,"playdrum",0,0,[4,9,null]],[9,["drumname",{value:"kick drum"}],0,0,[8]],[10,["action",{collapsed:!1}],u,n+200,[null,11,12,null]],[11,["text",{value:"action"}],0,0,[10]],[12,"hidden",0,0,[10,13]],[13,"setshade",0,0,[12,18,14]],[14,"forward",0,0,[13,15,16]],[15,["number",{value:100}],0,0,[14]],[16,"right",0,0,[14,17,null]],[17,["number",{value:90}],0,0,[16]],[18,"elapsednotes",0,0,[13]],[19,"everybeatdo",u,n,[null,20,6]],[20,["text",{value:"action"}],0,0,[19]]],everybeathelp:[[0,["action",{collapsed:!1}],u,n+100,[null,1,2,null]],[1,["text",{value:"action"}],0,0,[0]],[2,"hidden",0,0,[0,3]],[3,"ifthenelse",0,0,[2,4,5,7,16]],[4,"equal",0,0,[3,13,12]],[5,"setcolor",0,0,[3,8,null]],[6,["number",{value:0}],0,0,[7]],[7,"setshade",0,0,[3,6,null]],[8,"elapsednotes2",0,0,[5,9]],[9,"divide",0,0,[8,10,11]],[10,["number",{value:1}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,["number",{value:1}],0,0,[4]],[13,"beatvalue",0,0,[4]],[14,"mynotevalue",0,0,[22]],[15,"deltapitch",0,0,[19]],[16,"forward",0,0,[3,19,21]],[17,"scrollxy",0,0,[21,22,18,null]],[18,["number",{value:0}],0,0,[17]],[19,"multiply",0,0,[16,15,20]],[20,["number",{value:10}],0,0,[19]],[21,"vspace",0,0,[16,17]],[22,"multiply",0,0,[17,14,23]],[23,["number",{value:25}],0,0,[22]],[24,"everybeatdo",u,n,[null,25,null]],[25,["text",{value:"action"}],0,0,[24]]],fillhelp:[[0,"fill",u,n,[null,2,1]],[1,"hidden",0,0,[0,null]],[2,"repeat",0,0,[0,3,4,null]],[3,["number",{value:4}],0,0,[2]],[4,"forward",0,0,[2,5,6]],[5,["number",{value:100}],0,0,[4]],[6,"right",0,0,[4,7,null]],[7,["number",{value:90}],0,0,[6]]],fmsynthhelp:[[0,["newnote",{collapsed:!1}],0,0,[9,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]],[9,"settimbre",u,n+200,[null,10,0,11]],[10,["voicename",{value:"custom"}],0,0,[9]],[11,"hidden",0,0,[9,null]],[12,["timbre",{collapsed:!1}],u,n,[null,13,15,14]],[13,["text",{value:"custom"}],0,0,[12]],[14,"hiddennoflow",0,0,[12,null]],[15,"fmsynth",0,0,[12,16,null]],[16,["number",{value:1}],0,0,[15]]],foreverhelp:[[0,"forever",u,n,[null,1,null]],[1,["nameddo",{value:_("action")}],0,0,[0,null]]],forwardhelp:[[0,"repeat",u,n,[null,1,6,null]],[1,["number",{value:4}],0,0,[0]],[2,"forward",0,0,[11,3,4]],[3,["number",{value:100}],0,0,[2]],[4,"right",0,0,[2,5,null]],[5,["number",{value:90}],0,0,[4]],[6,["newnote",{collapsed:!1}],0,0,[0,7,10,14]],[7,"divide",0,0,[6,8,9]],[8,["number",{value:1}],0,0,[7]],[9,["number",{value:4}],0,0,[7]],[10,"vspace",0,0,[6,11]],[11,"pitch",0,0,[10,12,13,2]],[12,["solfege",{value:"sol"}],0,0,[11]],[13,["number",{value:4}],0,0,[11]],[14,"hidden",0,0,[6,null]]],harmonichelp:[[0,"harmonic2",u,n,[null,11,1,10]],[1,"newnote",u,n,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"hidden",0,0,[1,null]],[10,"hidden",0,0,[0,null]],[11,["number",{value:1}],0,0,[0]]],ifhelp:[[0,"forever",u,n,[null,1,null]],[1,"if",0,0,[0,2,3,null]],[2,"mousebutton",0,0,[1]],[3,["newnote",{collapsed:!1}],0,0,[1,4,7,10]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"playdrum",0,0,[7,9,null]],[9,["drumname",{value:"kick drum"}],0,0,[8]],[10,"hidden",0,0,[3,null]]],intervalhelp:[[0,["interval",{collapsed:!1}],u,n,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:2}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,9]],[8,"hidden",0,0,[0,18]],[9,["newnote",{collapsed:!1}],0,0,[7,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["solfege",{value:"sol"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"hidden",0,0,[9,null]],[18,["newnote",{collapsed:!1}],0,0,[8,19,22,26]],[19,"divide",0,0,[18,20,21]],[20,["number",{value:1}],0,0,[19]],[21,["number",{value:4}],0,0,[19]],[22,"vspace",0,0,[18,23]],[23,"pitch",0,0,[22,24,25,27]],[24,["solfege",{value:"sol"}],0,0,[23]],[25,["number",{value:4}],0,0,[23]],[26,"hidden",0,0,[18,null]],[27,"pitch",0,0,[23,28,29,null]],[28,["solfege",{value:"ti"}],0,0,[27]],[29,["number",{value:4}],0,0,[27]]],inverthelp:[[0,"invert1",u,n,[null,1,2,3,5,4]],[1,["solfege",{value:"do"}],0,0,[0]],[2,["number",{value:5}],0,0,[0]],[3,["invertmode",{value:"even"}],0,0,[0]],[4,"hidden",0,0,[0,14]],[5,["newnote",{collapsed:!1}],0,0,[0,6,9,13]],[6,"divide",0,0,[5,7,8]],[7,["number",{value:1}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"vspace",0,0,[5,10]],[10,"pitch",0,0,[9,11,12,null]],[11,["solfege",{value:"fa"}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"hidden",0,0,[5,null]],[14,["newnote",{collapsed:!1}],0,0,[4,15,18,22]],[15,"divide",0,0,[14,16,17]],[16,["number",{value:1}],0,0,[15]],[17,["number",{value:4}],0,0,[15]],[18,"vspace",0,0,[14,19]],[19,"pitch",0,0,[18,20,21,null]],[20,["solfege",{value:"sol"}],0,0,[19]],[21,["number",{value:5}],0,0,[19]],[22,"hidden",0,0,[14,null]]],lrhelp:[[0,["start",{collapsed:!1}],0,0,[null,3,null]],[1,"forever",0,0,[3,5,null]],[2,"if",0,0,[5,7,8,null]],[3,"setheading",0,0,[0,4,1]],[4,["number",{value:90}],0,0,[3]],[5,"forward",0,0,[1,6,2]],[6,["number",{value:10}],0,0,[5]],[7,"greater",0,0,[2,12,14]],[8,"penup",0,0,[2,10]],[9,"pendown",0,0,[10,null]],[10,"setxy",0,0,[8,13,11,9]],[11,"y",0,0,[10]],[12,"x",0,0,[7]],[13,"leftpos",0,0,[10]],[14,"rightpos",0,0,[7]]],makehelp:[[0,"start",u,n,[null,5,null]],[1,["makeblock",{}],496,107,[5,2,3,4,7]],[2,["text",{value:"note"}],611,107,[1]],[3,["solfege",{value:"sol"}],525,139,[1]],[4,["number",{value:4}],525,170,[1]],[5,["storein",{}],418,75,[0,6,1,8]],[6,["text",{value:"box"}],496,75,[5]],[7,["number",{value:4}],525,202,[1]],[8,["vspace",{}],418,138,[5,9]],[9,["vspace",{}],418,170,[8,10]],[10,["vspace",{}],418,202,[9,11]],[11,["vspace",{}],418,234,[10,13]],[12,["namedbox",{value:"box"}],507,266,[13]],[13,["runblock",{}],418,266,[11,12,null]],[14,["newnote",{collapsed:!1}],771,284,[null,15,18,22]],[15,["divide",{}],903,284,[14,16,17]],[16,["number",{value:1}],989,284,[15]],[17,["number",{value:4}],989,316,[15]],[18,["vspace",{}],785,316,[14,19]],[19,["pitch",{}],785,348,[18,20,21,null]],[20,["solfege",{value:"sol"}],859,348,[19]],[21,["number",{value:4}],859,380,[19]],[22,["hidden",{}],771,442,[14,null]]],mapdrumhelp:[[0,["newnote",{collapsed:!1}],0,0,[9,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]],[9,"mapdrum",u,n,[null,10,0,11]],[10,["drumname",{value:"kick drum"}],0,0,[9]],[11,"hidden",0,0,[9,12]],[12,["newnote",{collapsed:!1}],0,0,[11,13,16,20]],[13,"divide",0,0,[12,14,15]],[14,["number",{value:1}],0,0,[13]],[15,["number",{value:4}],0,0,[13]],[16,"vspace",0,0,[12,17]],[17,"pitch",0,0,[16,18,19,null]],[18,["solfege",{value:"sol"}],0,0,[17]],[19,["number",{value:4}],0,0,[17]],[20,"hidden",0,0,[12,null]]],mousebuttonhelp:[[0,["start",{collapsed:!1}],u,n,[null,1,null]],[1,"forever",0,0,[0,2,null]],[2,"ifthenelse",0,0,[1,8,7,6,3]],[3,"setxy",0,0,[2,4,5,null]],[4,"mousex",0,0,[3]],[5,"mousey",0,0,[3]],[6,"penup",0,0,[2,null]],[7,"pendown",0,0,[2,null]],[8,"mousebutton",0,0,[2]]],movablehelp:[[0,["start",{collapsed:!1}],u,n,[null,1,null]],[1,"setkey2",0,0,[0,2,3,4]],[2,["notename",{value:"B"}],0,0,[1]],[3,["modename",{value:"aeolian"}],0,0,[1]],[4,"movable",0,0,[1,5,7]],[5,["boolean",{value:!0}],0,0,[4]],[6,"repeat",0,0,[15,16,17,null]],[7,["newnote",{collapsed:!1}],0,0,[4,8,11,15]],[8,"divide",0,0,[7,9,10]],[9,["number",{value:1}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"vspace",0,0,[7,12]],[12,"pitch",0,0,[11,13,14,null]],[13,["solfege",{value:"do"}],0,0,[12]],[14,["number",{value:4}],0,0,[12]],[15,"hidden",0,0,[7,6]],[16,"modelength",0,0,[6]],[17,["newnote",{collapsed:!1}],0,0,[6,18,21,24]],[18,"divide",0,0,[17,19,20]],[19,["number",{value:1}],0,0,[18]],[20,["number",{value:4}],0,0,[18]],[21,"vspace",0,0,[17,22]],[22,"steppitch",0,0,[21,23,null]],[23,["number",{value:1}],0,0,[22]],[24,"hidden",0,0,[17,null]]],multiplybeathelp:[[0,"multiplybeatfactor",u,n,[null,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"vspace",0,0,[0,12]],[5,"hidden",0,0,[0,21]],[6,"multiplybeatfactor",0,0,[29,7,10,11]],[7,"divide",0,0,[6,9,8]],[8,["number",{value:1}],0,0,[7]],[9,["number",{value:2}],0,0,[7]],[10,"vspace",0,0,[6,30]],[11,"hidden",0,0,[6,39]],[12,["newnote",{collapsed:!1}],0,0,[4,13,16,20]],[13,"divide",0,0,[12,14,15]],[14,["number",{value:1}],0,0,[13]],[15,["number",{value:4}],0,0,[13]],[16,"vspace",0,0,[12,17]],[17,"pitch",0,0,[16,18,19,null]],[18,["solfege",{value:"sol"}],0,0,[17]],[19,["number",{value:4}],0,0,[17]],[20,"hidden",0,0,[12,null]],[21,["newnote",{collapsed:!1}],0,0,[5,22,25,29]],[22,"divide",0,0,[21,23,24]],[23,["number",{value:1}],0,0,[22]],[24,["number",{value:8}],0,0,[22]],[25,"vspace",0,0,[21,26]],[26,"pitch",0,0,[25,27,28,null]],[27,["solfege",{value:"sol"}],0,0,[26]],[28,["number",{value:4}],0,0,[26]],[29,"hidden",0,0,[21,6]],[30,["newnote",{collapsed:!1}],0,0,[10,31,34,38]],[31,"divide",0,0,[30,32,33]],[32,["number",{value:1}],0,0,[31]],[33,["number",{value:4}],0,0,[31]],[34,"vspace",0,0,[30,35]],[35,"pitch",0,0,[34,36,37,null]],[36,["solfege",{value:"sol"}],0,0,[35]],[37,["number",{value:4}],0,0,[35]],[38,"hidden",0,0,[30,null]],[39,["newnote",{collapsed:!1}],0,0,[11,40,43,47]],[40,"divide",0,0,[39,41,42]],[41,["number",{value:1}],0,0,[40]],[42,["number",{value:2}],0,0,[40]],[43,"vspace",0,0,[39,44]],[44,"pitch",0,0,[43,45,46,null]],[45,["solfege",{value:"sol"}],0,0,[44]],[46,["number",{value:4}],0,0,[44]],[47,"hidden",0,0,[39,null]]],neighborhelp:[[0,"neighbor",u,n,[null,1,3,2,6]],[1,["number",{value:1}],0,0,[0]],[2,"vspace",0,0,[0,7]],[3,"divide",0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:16}],0,0,[3]],[6,"hidden",0,0,[0,null]],[7,["newnote",{collapsed:!1}],0,0,[2,8,11,15]],[8,"divide",0,0,[7,9,10]],[9,["number",{value:1}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"vspace",0,0,[7,12]],[12,"pitch",0,0,[11,13,14,null]],[13,["solfege",{value:"sol"}],0,0,[12]],[14,["number",{value:4}],0,0,[12]],[15,"hidden",0,0,[7,null]]],neighbor2help:[[0,"neighbor2",u,n,[null,1,3,2,6]],[1,["number",{value:1}],0,0,[0]],[2,"vspace",0,0,[0,7]],[3,"divide",0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:16}],0,0,[3]],[6,"hidden",0,0,[0,null]],[7,["newnote",{collapsed:!1}],0,0,[2,8,11,15]],[8,"divide",0,0,[7,9,10]],[9,["number",{value:1}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"vspace",0,0,[7,12]],[12,"pitch",0,0,[11,13,14,null]],[13,["solfege",{value:"sol"}],0,0,[12]],[14,["number",{value:4}],0,0,[12]],[15,"hidden",0,0,[7,null]]],notecounterhelp:[[0,"notecounter",u,n,[null,1]],[1,["newnote",{collapsed:!1}],0,0,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"hidden",0,0,[1,10]],[10,["newnote",{collapsed:!1}],0,0,[9,11,14,18]],[11,"divide",0,0,[10,12,13]],[12,["number",{value:1}],0,0,[11]],[13,["number",{value:4}],0,0,[11]],[14,"vspace",0,0,[10,15]],[15,"pitch",0,0,[14,16,17,null]],[16,["solfege",{value:"sol"}],0,0,[15]],[17,["number",{value:4}],0,0,[15]],[18,"hidden",0,0,[10,null]]],oneofhelp:[[0,["newnote",{collapsed:!1}],u,n,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,8,6,null]],[6,["number",{value:4}],0,0,[5]],[7,"hidden",0,0,[0,null]],[8,"oneOf",0,0,[5,9,10]],[9,["solfege",{value:"sol"}],0,0,[8]],[10,["solfege",{value:"la"}],0,0,[8]]],osctimehelp:[[0,"osctime",u,n,[null,2,1,7]],[1,"vspace",0,0,[0,5]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1e3}],0,0,[2]],[4,"divide",0,0,[2,8,9]],[5,"hertz",0,0,[1,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,10]],[8,["number",{value:3}],0,0,[4]],[9,["number",{value:2}],0,0,[4]],[10,"setmasterbpm2",0,0,[7,11,12,15]],[11,["number",{value:90}],0,0,[10]],[12,"divide",0,0,[10,13,14]],[13,["number",{value:1}],0,0,[12]],[14,["number",{value:4}],0,0,[12]],[15,"vspace",0,0,[10,16]],[16,["newnote",{collapsed:!1}],0,0,[15,17,20,24]],[17,"divide",0,0,[16,18,19]],[18,["number",{value:1}],0,0,[17]],[19,["number",{value:4}],0,0,[17]],[20,"vspace",0,0,[16,21]],[21,"pitch",0,0,[20,22,23,null]],[22,["solfege",{value:"sol"}],0,0,[21]],[23,["number",{value:4}],0,0,[21]],[24,"hidden",0,0,[16,null]]],outputtoolshelp:[[0,["status",{collapsed:!1}],u,n,[null,1,4]],[1,"hidden",0,0,[0,19]],[2,"print",0,0,[11,6,13]],[3,"print",0,0,[17,5,7]],[4,"hiddennoflow",0,0,[0,null]],[5,["outputtools",{value:"pitch number"}],0,0,[3,21]],[6,["outputtools",{value:"nth degree"}],0,0,[2,22]],[7,"print",0,0,[3,8,9]],[8,["outputtools",{value:"pitch in hertz"}],0,0,[7,23]],[9,"print",0,0,[7,10,11]],[10,["outputtools",{value:"scalar class"}],0,0,[9,24]],[11,"print",0,0,[9,12,2]],[12,["outputtools",{value:"scale degree"}],0,0,[11,25]],[13,"print",0,0,[2,14,null]],[14,["outputtools",{value:"staff y"}],0,0,[13,26]],[15,"print",0,0,[19,16,17]],[16,["outputtools",{value:"solfege syllable"}],0,0,[15,27]],[17,"print",0,0,[15,18,3]],[18,["outputtools",{value:"pitch class"}],0,0,[17,28]],[19,"print",0,0,[1,20,15]],[20,["outputtools",{value:"letter class"}],0,0,[19,29]],[21,"currentpitch",0,0,[5]],[22,"currentpitch",0,0,[6]],[23,"currentpitch",0,0,[8]],[24,"currentpitch",0,0,[10]],[25,"currentpitch",0,0,[12]],[26,"currentpitch",0,0,[14]],[27,"currentpitch",0,0,[16]],[28,"currentpitch",0,0,[18]],[29,"currentpitch",0,0,[20]]],phaserhelp:[[0,"phaser",u,n,[null,1,2,3,4,null]],[1,["number",{value:.5}],0,0,[0]],[2,["number",{value:3}],0,0,[0]],[3,["number",{value:392}],0,0,[0]],[4,["newnote",{collapsed:!1}],0,0,[0,5,8,12]],[5,"divide",0,0,[4,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"vspace",0,0,[4,9]],[9,"pitch",0,0,[8,10,11,null]],[10,["solfege",{value:"sol"}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"hidden",0,0,[4,null]]],pitchnumberhelp:[[0,"setpitchnumberoffset",u,n,[null,1,2,3]],[1,["notename",{value:"C"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]],[3,["newnote",{collapsed:!1}],0,0,[0,4,7,10]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"pitchnumber",0,0,[7,9,null]],[9,["number",{value:7}],0,0,[8]],[10,"hidden",0,0,[3,11]],[11,["newnote",{collapsed:!1}],0,0,[10,12,15,19]],[12,"divide",0,0,[11,13,14]],[13,["number",{value:1}],0,0,[12]],[14,["number",{value:4}],0,0,[12]],[15,"vspace",0,0,[11,16]],[16,"pitch",0,0,[15,17,18,null]],[17,["solfege",{value:"sol"}],0,0,[16]],[18,["number",{value:4}],0,0,[16]],[19,"hidden",0,0,[11,null]]],randomhelp:[[0,["newnote",{collapsed:!1}],u,n,[null,1,3,7]],[1,"divide",0,0,[0,2,8]],[2,["number",{value:1}],0,0,[1]],[3,"vspace",0,0,[0,4]],[4,"pitch",0,0,[3,5,6,null]],[5,["solfege",{value:"sol"}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"hidden",0,0,[0,null]],[8,"random",0,0,[1,9,10]],[9,["number",{value:1}],0,0,[8]],[10,["number",{value:16}],0,0,[8]]],registerhelp:[[0,["newnote",{collapsed:!1}],u,n,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:5}],0,0,[5]],[8,"hidden",0,0,[0,18]],[9,["newnote",{collapsed:!1}],0,0,[18,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:2}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["solfege",{value:"sol"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"hidden",0,0,[9,null]],[18,"register",0,0,[8,19,9]],[19,["number",{value:1}],0,0,[18]]],repeathelp:[[0,["newnote",{collapsed:!1}],0,0,[9,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"la"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]],[9,"repeat",u,n,[null,10,0,null]],[10,["number",{value:4}],0,0,[9]]],samplerhelp:[[0,["customsample",{value:["","","do",4]}],u,n,[null,1,2,3]],[1,["audiofile",{value:["",""]}],0,0,[0]],[2,["solfege",{value:"do"}],0,0,[0]],[3,["number",{value:4}],0,0,[0]]],setdrumhelp:[[0,["newnote",{collapsed:!1}],0,0,[9,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]],[9,"setdrum",u,n,[null,10,0,null]],[10,["drumname",{value:"kick drum"}],0,0,[9]]],scalartranshelp:[[0,["newnote",{collapsed:!1}],0,0,[15,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]],[9,"setscalartransposition",u,n,[null,10,15,16]],[10,"plus",0,0,[9,11,12]],[11,["number",{value:3}],0,0,[10]],[12,"multiply",0,0,[10,13,14]],[13,["number",{value:0}],0,0,[12]],[14,"modelength",0,0,[12]],[15,"vspace",0,0,[9,0]],[16,"hidden",0,0,[9,17]],[17,["newnote",{collapsed:!1}],0,0,[16,18,21,25]],[18,"divide",0,0,[17,19,20]],[19,["number",{value:1}],0,0,[18]],[20,["number",{value:4}],0,0,[18]],[21,"vspace",0,0,[17,22]],[22,"pitch",0,0,[21,23,24,null]],[23,["solfege",{value:"do"}],0,0,[22]],[24,["number",{value:5}],0,0,[22]]],settimbrehelp:[[0,"settimbre",u,n,[null,1,3,2]],[1,["voicename",{value:"guitar"}],0,0,[0]],[2,"hidden",0,0,[0,null]],[3,["newnote",{collapsed:!1}],0,0,[0,4,7,11]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"pitch",0,0,[7,9,10,null]],[9,["solfege",{value:"sol"}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"hidden",0,0,[3,null]]],skiphelp:[[0,["newnote",{collapsed:!1}],0,0,[18,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,9]],[9,["newnote",{collapsed:!1}],0,0,[8,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["solfege",{value:"sol"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"hidden",0,0,[9,21]],[18,"skipnotes",u,n,[null,19,0,20]],[19,["number",{value:2}],0,0,[18]],[20,"hidden",0,0,[18,39]],[21,["newnote",{collapsed:!1}],0,0,[17,22,25,29]],[22,"divide",0,0,[21,23,24]],[23,["number",{value:1}],0,0,[22]],[24,["number",{value:4}],0,0,[22]],[25,"vspace",0,0,[21,26]],[26,"pitch",0,0,[25,27,28,null]],[27,["solfege",{value:"mi"}],0,0,[26]],[28,["number",{value:4}],0,0,[26]],[29,"hidden",0,0,[21,30]],[30,["newnote",{collapsed:!1}],0,0,[29,31,34,38]],[31,"divide",0,0,[30,32,33]],[32,["number",{value:1}],0,0,[31]],[33,["number",{value:4}],0,0,[31]],[34,"vspace",0,0,[30,35]],[35,"pitch",0,0,[34,36,37,null]],[36,["solfege",{value:"mi"}],0,0,[35]],[37,["number",{value:4}],0,0,[35]],[38,"hidden",0,0,[30,null]],[39,["newnote",{collapsed:!1}],0,0,[20,40,43,47]],[40,"divide",0,0,[39,41,42]],[41,["number",{value:1}],0,0,[40]],[42,["number",{value:4}],0,0,[40]],[43,"vspace",0,0,[39,44]],[44,"pitch",0,0,[43,45,46,null]],[45,["solfege",{value:"sol"}],0,0,[44]],[46,["number",{value:4}],0,0,[44]],[47,"hidden",0,0,[39,48]],[48,["newnote",{collapsed:!1}],0,0,[47,49,52,56]],[49,"divide",0,0,[48,50,51]],[50,["number",{value:1}],0,0,[49]],[51,["number",{value:4}],0,0,[49]],[52,"vspace",0,0,[48,53]],[53,"pitch",0,0,[52,54,55,null]],[54,["solfege",{value:"mi"}],0,0,[53]],[55,["number",{value:4}],0,0,[53]],[56,"hidden",0,0,[48,null]]],slurhelp:[[0,["newnote",{collapsed:!1}],0,0,[22,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,9]],[9,["newnote",{collapsed:!1}],0,0,[8,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["solfege",{value:"mi"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"hidden",0,0,[9,null]],[18,"newslur",u,n,[null,19,22,23]],[19,"divide",0,0,[18,20,21]],[20,["number",{value:1}],0,0,[19]],[21,["number",{value:16}],0,0,[19]],[22,"vspace",0,0,[18,0]],[23,"hidden",0,0,[18,null]]],staccatohelp:[[0,["newnote",{collapsed:!1}],0,0,[22,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,9]],[9,["newnote",{collapsed:!1}],0,0,[8,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["solfege",{value:"mi"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"hidden",0,0,[9,null]],[18,"newstaccato",u,n,[null,19,22,23]],[19,"divide",0,0,[18,20,21]],[20,["number",{value:1}],0,0,[19]],[21,["number",{value:32}],0,0,[19]],[22,"vspace",0,0,[18,0]],[23,"hidden",0,0,[18,null]]],switchhelp:[[0,"switch",u,n,[null,5,8,4]],[1,"case",0,0,[8,2,9,3]],[2,["number",{value:1}],0,0,[1]],[3,"defaultcase",0,0,[1,18,null]],[4,"hidden",0,0,[0,null]],[5,"random",0,0,[0,6,7]],[6,["number",{value:0}],0,0,[5]],[7,["number",{value:1}],0,0,[5]],[8,"vspace",0,0,[0,1]],[9,["newnote",{collapsed:!1}],0,0,[1,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["solfege",{value:"sol"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"hidden",0,0,[9,null]],[18,["newnote",{collapsed:!1}],0,0,[3,19,22,26]],[19,"divide",0,0,[18,20,21]],[20,["number",{value:1}],0,0,[19]],[21,["number",{value:4}],0,0,[19]],[22,"vspace",0,0,[18,23]],[23,"pitch",0,0,[22,24,25,null]],[24,["solfege",{value:"mi"}],0,0,[23]],[25,["number",{value:4}],0,0,[23]],[26,"hidden",0,0,[18,null]]],swinghelp:[[0,"newswing2",u,n,[null,1,6,9,10]],[1,"hspace",0,0,[0,2]],[2,"hspace",0,0,[1,3]],[3,"divide",0,0,[2,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:24}],0,0,[3]],[6,"divide",0,0,[0,7,8]],[7,["number",{value:1}],0,0,[6]],[8,["number",{value:8}],0,0,[6]],[9,"vspace",0,0,[0,11]],[10,"hidden",0,0,[0,29]],[11,["newnote",{collapsed:!1}],0,0,[9,12,15,19]],[12,"divide",0,0,[11,13,14]],[13,["number",{value:1}],0,0,[12]],[14,["number",{value:8}],0,0,[12]],[15,"vspace",0,0,[11,16]],[16,"pitch",0,0,[15,17,18,null]],[17,["solfege",{value:"sol"}],0,0,[16]],[18,["number",{value:4}],0,0,[16]],[19,"hidden",0,0,[11,20]],[20,["newnote",{collapsed:!1}],0,0,[19,21,24,28]],[21,"divide",0,0,[20,22,23]],[22,["number",{value:1}],0,0,[21]],[23,["number",{value:8}],0,0,[21]],[24,"vspace",0,0,[20,25]],[25,"pitch",0,0,[24,26,27,null]],[26,["solfege",{value:"sol"}],0,0,[25]],[27,["number",{value:4}],0,0,[25]],[28,"hidden",0,0,[20,null]],[29,["newnote",{collapsed:!1}],0,0,[10,30,33,37]],[30,"divide",0,0,[29,31,32]],[31,["number",{value:1}],0,0,[30]],[32,["number",{value:6}],0,0,[30]],[33,"vspace",0,0,[29,34]],[34,"pitch",0,0,[33,35,36,null]],[35,["solfege",{value:"sol"}],0,0,[34]],[36,["number",{value:4}],0,0,[34]],[37,"hidden",0,0,[29,38]],[38,["newnote",{collapsed:!1}],0,0,[37,39,42,46]],[39,"divide",0,0,[38,40,41]],[40,["number",{value:1}],0,0,[39]],[41,["number",{value:12}],0,0,[39]],[42,"vspace",0,0,[38,43]],[43,"pitch",0,0,[42,44,45,null]],[44,["solfege",{value:"sol"}],0,0,[43]],[45,["number",{value:4}],0,0,[43]],[46,"hidden",0,0,[38,null]]],tiehelp:[[0,["newnote",{collapsed:!1}],0,0,[19,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,9]],[9,"hidden",0,0,[8,10]],[10,["newnote",{collapsed:!1}],0,0,[9,11,14,18]],[11,"divide",0,0,[10,12,13]],[12,["number",{value:1}],0,0,[11]],[13,["number",{value:2}],0,0,[11]],[14,"vspace",0,0,[10,15]],[15,"pitch",0,0,[14,16,17,null]],[16,["solfege",{value:"sol"}],0,0,[15]],[17,["number",{value:4}],0,0,[15]],[18,"hidden",0,0,[10,null]],[19,"tie",u,n,[null,0,20]],[20,"hidden",0,0,[19,null]]],tremolohelp:[[0,"tremolo",0,0,[null,1,2,3,12]],[1,["number",{value:10}],0,0,[0]],[2,["number",{value:50}],0,0,[0]],[3,["newnote",{collapsed:!1}],0,0,[0,4,7,11]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"pitch",0,0,[7,9,10,null]],[9,["solfege",{value:"sol"}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"hidden",0,0,[3,null]],[12,"hidden",0,0,[0,null]]],untilhelp:[[0,"until",u,n,[null,1,2,null]],[1,"mousebutton",0,0,[0]],[2,["newnote",{collapsed:!1}],0,0,[0,3,6,10]],[3,"divide",0,0,[2,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"vspace",0,0,[2,7]],[7,"pitch",0,0,[6,8,9,null]],[8,["solfege",{value:"sol"}],0,0,[7]],[9,["number",{value:4}],0,0,[7]],[10,"hidden",0,0,[2,null]]],vibratohelp:[[0,"vibrato",u,n,[null,1,3,2,6]],[1,["number",{value:5}],0,0,[0]],[2,"vspace",0,0,[0,7]],[3,"divide",0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:16}],0,0,[3]],[6,"hidden",0,0,[0,null]],[7,["newnote",{collapsed:!1}],0,0,[2,8,11,15]],[8,"divide",0,0,[7,9,10]],[9,["number",{value:1}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"vspace",0,0,[7,12]],[12,"pitch",0,0,[11,13,14,null]],[13,["solfege",{value:"sol"}],0,0,[12]],[14,["number",{value:4}],0,0,[12]],[15,"hidden",0,0,[7,null]]],waitforhelp:[[0,"waitFor",0,0,[null,1,2]],[1,"mousebutton",0,0,[0]],[2,["newnote",{collapsed:!1}],0,0,[0,3,6,10]],[3,"divide",0,0,[2,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"vspace",0,0,[2,7]],[7,"pitch",0,0,[6,8,9,null]],[8,["solfege",{value:"sol"}],0,0,[7]],[9,["number",{value:4}],0,0,[7]],[10,"hidden",0,0,[2,null]]],whilehelp:[[0,"mousebutton",0,0,[1]],[1,"while",u,n,[null,0,2,null]],[2,["newnote",{collapsed:!1}],0,0,[1,3,6,9]],[3,"divide",0,0,[2,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"vspace",0,0,[2,7]],[7,"playdrum",0,0,[6,8,null]],[8,["drumname",{value:"kick drum"}],0,0,[7]],[9,"hidden",0,0,[2,null]]],wraphelp:[[0,"forward",0,0,[4,1,2]],[1,["number",{value:1e3}],0,0,[0]],[2,"right",0,0,[0,3,null]],[3,["number",{value:144}],0,0,[2]],[4,"repeat",0,0,[6,5,0,null]],[5,["number",{value:5}],0,0,[4]],[6,"wrap",u,n,[null,7,4,8]],[7,["wrapmode",{value:"on"}],0,0,[6]],[8,"hidden",0,0,[6,null]]],xyhelp:[[0,"forever",0,0,[null,1,null]],[1,["newnote",{collapsed:!1}],0,0,[0,2,5,7]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:8}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"hertz",0,0,[5,17,14]],[7,"hidden",0,0,[1,null]],[8,"hertz",0,0,[14,18,13]],[9,"minus",0,0,[17,15,11]],[10,"minus",0,0,[18,16,12]],[11,"x",0,0,[9]],[12,"y",0,0,[10]],[13,"vspace",0,0,[8,null]],[14,"vspace",0,0,[6,8]],[15,"mousex",0,0,[9]],[16,"mousey",0,0,[10]],[17,"abs",0,0,[6,9]],[18,"abs",0,0,[8,10]]]},!["namedbox","nameddo","namedcalc","namedarg","nameddoArg"].includes(l)&&l in e?e[l]:null)};"undefined"!=typeof module&&module.exports&&(module.exports=blockIsMacro,module.exports=getMacroExpansion);
function _regenerator(){var v,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",t=e.toStringTag||"@@toStringTag";function n(e,r,t,n){var a,o,u,i,l,s,c,d,f,r=r&&r.prototype instanceof y?r:y,r=Object.create(r.prototype);return _regeneratorDefine2(r,"_invoke",(a=e,o=t,c=n||[],d=!1,f={p:s=0,n:0,v:v,a:p,f:p.bind(v,4),d:function(e,r){return u=e,i=0,l=v,f.n=r,h}},function(e,r,t){if(1<s)throw TypeError("Generator is already running");for(d&&1===r&&p(r,t),i=r,l=t;(m=i<2?v:l)||!d;){u||(i?i<3?(1<i&&(f.n=-1),p(i,l)):f.n=l:f.v=l);try{if(s=2,u){if(m=u[e=i?e:"next"]){if(!(m=m.call(u,l)))throw TypeError("iterator result is not an object");if(!m.done)return m;l=m.value,i<2&&(i=0)}else 1===i&&(m=u.return)&&m.call(u),i<2&&(l=TypeError("The iterator does not provide a '"+e+"' method"),i=1);u=v}else if((m=(d=f.n<0)?l:a.call(o,f))!==h)break}catch(e){u=v,i=1,l=e}finally{s=1}}return{value:m,done:d}}),!0),r;function p(e,r){for(i=e,l=r,m=0;!d&&s&&!t&&m<c.length;m++){var t,n=c[m],a=f.p,o=n[2];3<e?(t=o===r)&&(l=n[(i=n[4])?5:i=3],n[4]=n[5]=v):n[0]<=a&&((t=e<2&&a<n[1])?(i=0,f.v=r,f.n=n[1]):a<o&&(t=e<3||n[0]>r||o<r)&&(n[4]=e,n[5]=r,f.n=o,i=0))}if(t||1<e)return h;throw d=!0,r}}var h={};function y(){}function a(){}function o(){}var m=Object.getPrototypeOf,e=[][r]?m(m([][r]())):(_regeneratorDefine2(m={},r,function(){return this}),m),u=o.prototype=y.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,t,"GeneratorFunction")),e.prototype=Object.create(u),e}return _regeneratorDefine2(u,"constructor",a.prototype=o),_regeneratorDefine2(o,"constructor",a),_regeneratorDefine2(o,t,a.displayName="GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,t,"Generator"),_regeneratorDefine2(u,r,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:i}})()}function _regeneratorDefine2(e,r,t,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(_regeneratorDefine2=function(e,r,t,n){function a(r,t){_regeneratorDefine2(e,r,function(e){return this._invoke(r,t,e)})}r?o?o(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(a("next",0),a("throw",1),a("return",2))})(e,r,t,n)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,r){var t,n,a,o,u="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(u)return a=!(n=!0),{s:function(){u=u.call(e)},n:function(){var e=u.next();return n=e.done,e},e:function(e){a=!0,t=e},f:function(){try{n||null==u.return||u.return()}finally{if(a)throw t}}};if(Array.isArray(e)||(u=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length)return u&&(e=u),o=0,{s:r=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){var t;if(e)return"string"==typeof e?_arrayLikeToArray(e,r):"Map"===(t="Object"===(t={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}function asyncGeneratorStep(e,r,t,n,a,o,u){try{var i=e[o](u),l=i.value}catch(e){return void t(e)}i.done?r(l):Promise.resolve(l).then(n,a)}function _asyncToGenerator(i){return function(){var e=this,u=arguments;return new Promise(function(r,t){var n=i.apply(e,u);function a(e){asyncGeneratorStep(n,r,t,a,o,"next",e)}function o(e){asyncGeneratorStep(n,r,t,a,o,"throw",e)}a(void 0)})}}var defaultTempo=90,standardDurations=[{value:"1/1",duration:1},{value:"1/2",duration:.5},{value:"1/4",duration:.25},{value:"1/8",duration:.125},{value:"1/16",duration:.0625},{value:"1/32",duration:.03125},{value:"1/64",duration:.015625},{value:"1/128",duration:.0078125}],getClosestStandardNoteValue=function(e){for(var r=standardDurations[0],t=Math.abs(e-r.duration),n=1;n<standardDurations.length;n++){var a=Math.abs(e-standardDurations[n].duration);a<t&&(r=standardDurations[n],t=a)}return r.value.split("/").map(Number)},transcribeMidi=(()=>{var t=_asyncToGenerator(_regenerator().m(function e(r,m){var t,b,g,_,S,A,T,D,k,w,I,O,M,C,n,a,o,j,u,i,l,s,c,d,f,p,v;return _regenerator().w(function(e){for(;;)if(0===e.n){for(t=r,b=getReverseDrumMidi(),g=[],_=[],A=[],I=!(w=100),O=k=D=T=S=0,M=[],C=[],n=(n=t.header.tempos)&&0<n.length?Math.round(n[0].bpm):defaultTempo,a=[4,4],o=(o=t.header.timeSignatures)&&0<o.length?o[0].timeSignature:a,j=!1,t.tracks.forEach(function(l,e){var u=0;if(!I&&l.notes.length){var r=_.length,t="electronic synth";if(l.instrument.name&&!l.instrument.percussion){var n,a=_createForOfIteratorHelper(VOICENAMES);try{for(a.s();!(n=a.n()).done;){var o=n.value;-1<l.instrument.name.indexOf(o[1])&&(t=o[0])}}catch(e){a.e(e)}finally{a.f()}}else l.instrument.percussion&&(j=!0);M[O]=0,C[O]=t;var i,s="track".concat(O,"chunk").concat(S),c=(_.push([r,["action",{collapsed:!1}],150,100,[null,r+1,r+2,null]],[r+1,["text",{value:s}],0,0,[r]]),[]),d=(g.push(l.instrument.percussion&&(9===l.channel||10===l.channel)),l.notes.forEach(function(e,r){var t,n=e.name,a=Math.round(100*e.time)/100,o=Math.round(100*(e.time+e.duration))/100;0!==e.duration&&(e=c[c.length-1],0===r&&0<a&&c.push({start:0,end:a,notes:["R"]}),e&&e.start===a&&e.end===o?e.notes.push(n):e&&e.start<=a&&e.end>a?(r=_toConsumableArray(e.notes),t=e.end,e.end=a,c.push({start:a,end:o,notes:[].concat(_toConsumableArray(r),[n])}),o<t&&c.push({start:o,end:t,notes:r})):(e&&e.end<a&&c.push({start:e.end,end:a,notes:["R"]}),c.push({start:a,end:o,notes:[n]})))}),0),f=[],p=function(){var e,r=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=_.length,n="track".concat(O,"chunk").concat(S);A.push(n),M[O]++,0==u?(_.push.apply(_,_toConsumableArray(f)),u=1):(f[0][4][0]=e=t,_.push.apply(_,[[t,["action",{collapsed:!1}],100+w,100+w,[null,t+1,e+2,null]],[t+1,["text",{value:n}],0,0,[t]]].concat(_toConsumableArray(f)))),r&&(_[_.length-1][4][1]=null),f=[],S++,w+=100};for(i in c){var v=c[i].end-c[i].start,v=getClosestStandardNoteValue(3*v/8);k=Math.max(k,v[1])}var h,y=function(){var e,r,t,i,n,a,o;return I?0:(a=(o=c[h]).notes,o=o.end-o.start,(e=16<=(d+=o)||0<D&&D%24==0)&&(T+=D,d=D=0),r=h==c.length-1,t=e||r,i=0==h,n=_.length+f.length,o=getClosestStandardNoteValue(3*o/8),o=getClosestStandardNoteValue(o[0]/o[1]),0!=u&&(n+=2),a=((e,r,t)=>{var n=[];if("R"==r[0])n.push([e,"rest2",0,0,[t,null]]);else if(j){var a=b[l.notes[0].midi][0]||"kick drum";n.push([e,"playdrum",0,0,[i?t:e-1,e+1,null]],[e+1,["drumname",{value:a}],0,0,[e]]),e+=2}else for(var o in r){var u=r[o];n.push([e,"pitch",0,0,[0==o?t:e-3,e+1,e+2,o==r.length-1?null:e+3]],[e+1,["notename",{value:u.substring(0,u.length-1)}],0,0,[e]],[e+2,["number",{value:parseInt(u[u.length-1])}],0,0,[e]]),e+=3}return n})(n+5,a,n),f.push([n,["newnote",{collapsed:!0}],0,0,[i?n-2:n-1,n+1,n+4,n+a.length+5]],[n+1,"divide",0,0,[n,n+2,n+3]],[n+2,["number",{value:o[0]}],0,0,[n+1]],[n+3,["number",{value:o[1]}],0,0,[n+1]],[n+4,"vspace",0,0,[n,n+5]]),D++,a[0][4][0]=n+4,f=f.concat(a),o=_.length+f.length,0!=u&&(o+=2),f.push([o,"hidden",0,0,[n,t?null:o+1]]),(e||r)&&p(r),m<=T?(activity.textMsg("MIDI file is too large. Generating only ".concat(m," noteblocks")),I=!0,0):void 0)};for(h in c)if(0===y())break;0<f.length&&p(!0),O++,document.body.style.cursor="wait"}}),u=_.length,s=l=i=0;s<O;s++){for(c=u+i+6,d=u+i,f=!0,g[s]?(_.push([u+i,["start",{collapsed:!1}],300+w,100,[null,u+i+14+M[s],null]],[u+i+1,"meter",0,0,[u+i+14+M[s],u+i+2,u+i+3,u+i+6]],[u+i+2,["number",{value:o[0]}],0,0,[u+i+1]],[u+i+3,"divide",0,0,[u+i+1,u+i+4,u+i+5]],[u+i+4,["number",{value:1}],0,0,[u+i+3]],[u+i+5,["number",{value:o[1]}],0,0,[u+i+3]],[u+i+6,"vspace",0,0,[u+i+1,u+i+8+M[s]]],[u+i+7,"hidden",0,0,[u+i+13+M[s],u+i+8]]),f=!1,i+=8):(_.push([u+i,["start",{collapsed:!1}],300+w,100,[null,u+i+16+M[s],null]],[u+i+1,"meter",0,0,[u+i+16+M[s],u+i+2,u+i+3,u+i+6]],[u+i+2,["number",{value:o[0]}],0,0,[u+i+1]],[u+i+3,"divide",0,0,[u+i+1,u+i+4,u+i+5]],[u+i+4,["number",{value:1}],0,0,[u+i+3]],[u+i+5,["number",{value:o[1]}],0,0,[u+i+3]],[u+i+6,"vspace",0,0,[u+i+1,u+i+10+M[s]]],[u+i+7,"settimbre",0,0,[u+i+15+M[s],u+i+8,u+i+10,u+i+9]],[u+i+8,["voicename",{value:C[s]}],0,0,[u+i+7]],[u+i+9,"hidden",0,0,[u+i+7,null]]),i+=10),p=0;p<M[s];p++)_.push([u+i,["nameddo",{value:A[l]}],0,0,[f?u+i-3:u+i-1,u+i+1]]),i++,f=!1,l++;_[u+i-1][4][1]=null,v=_.length,_.push([v,["setbpm3"],0,0,[c,v+1,v+2,v+5]],[v+1,["number",{value:n}],0,0,[v]],[v+2,"divide",0,0,[v,v+3,v+4]],[v+3,["number",{value:1}],0,0,[v+2]],[v+4,["number",{value:o[1]}],0,0,[v+2]],[v+5,"vspace",0,0,[v,c+1]]),i+=6,_.push([u+i,"setturtlename2",0,0,[d,u+i+1,d+1]],[u+i+1,["text",{value:"track".concat(s)}],0,0,[u+i]]),i+=2}return activity.blocks.loadNewBlocks(_),e.a(2,null)}},e)}));return function(e,r){return t.apply(this,arguments)}})();"undefined"!=typeof module&&module.exports&&(module.exports={getClosestStandardNoteValue:getClosestStandardNoteValue,transcribeMidi:transcribeMidi});
function _createForOfIteratorHelper(e,t){var n,r,o,i,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return o=!(r=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return r=e.done,e},e:function(e){o=!0,n=e},f:function(){try{r||null==a.return||a.return()}finally{if(o)throw n}}};if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),i=0,{s:t=function(){},n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}saveMxmlOutput=function(k){for(var O=["voice two","voice one","one voice"],t="",x=0,M=function(e){t+="    ".repeat(x)+e+"\n"},P=function(e){M('<direction placement="above">'),x++,M("<direction-type>"),x++,M('<wedge type="'.concat(e,'"/>')),x--,M("</direction-type>"),x--,M("</direction>")},_=function(e,t,n,r){M('<measure number="'.concat(e,'"> <attributes> <divisions>').concat(t,"</divisions> <key> <fifths>0</fifths> </key> <time> <beats>").concat(n,"</beats> <beat-type>").concat(r,"</beat-type> </time> <clef>  <sign>G</sign> <line>2</line> </clef> </attributes>"))},e=(M("<?xml version='1.0' encoding='UTF-8'?>"),M('<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">'),M('<score-partwise version="3.1">'),x++,M("<part-list>"),x++,Object.keys(k.notation.notationStaging).forEach(function(e){0!==k.notation.notationStaging[e].length&&(voiceNum=parseInt(e)+1,M('<score-part id="P'.concat(voiceNum,'">')),x++,M("<part-name> Voice #".concat(voiceNum," </part-name>")),x--,M("</score-part>"))}),x--,M("</part-list>"),x--,Object.keys(k.notation.notationStaging).forEach(function(e){if(0!==k.notation.notationStaging[e].length){voiceNum=parseInt(e)+1,x++,M('<part id="P'.concat(voiceNum,'">')),x++;for(var t=1,n=32,r=4,o=4,i=!1,a=-1,c=-1,s=-1,l=!1,u=null,p=!0,d=(x++,n),f=k.notation.notationStaging[e],y=0;y<f.length;y++){var m=f[y];if(!["tie","begin slur","end slur"].includes(m)&&!O.includes(m))if("key"===m)y+=2;else if("begin crescendo"===m)P("crescendo");else if("begin decrescendo"===m)P("diminuendo");else if("end crescendo"===m||"end decrescendo"===m)M("<direction>"),x++,M("<direction-type>"),x++,M('<wedge type="stop"/>'),x--,M("</direction-type>"),x--,M("</direction>");else if("tempo"===m){var v=f[y+1],g=f[y+2],v=Math.floor(v*(4/g));l?M('<sound tempo="'.concat(v,'"/>')):u='<sound tempo="'.concat(v,'"/>'),y+=2}else if("meter"===m)a=(c=f[y+1])*(1/(s=f[y+2])/(1/32)),y+=2,i=!0;else{var b,h=!1,w=_createForOfIteratorHelper(m[0]);try{for(w.s();!(b=w.n()).done;){for(var I=b.value,A=32/m[1],S=0;S<m[2];S++)A+=A/2;d<A&&!h&&l&&(M("</measure>"),t++,d=n,l=!1),h||(d===n&&(p?(_(t,n,r,o),p=!1):i?(d=n=a,_(t,a,r=c,o=s),i=!1):M('<measure number="'.concat(t,'">')),l=!0,null!==u)&&(M(u),u=null),d-=A);var T="♭"===I[1]?-1:"♯"===I[1]?1:0;M("<note>"),x++,h&&M("<chord/>"),"R"===I[0]?M("<rest/>"):(M("<pitch>"),x++,M("<step>".concat(I[0],"</step>")),0!=T&&M("<alter>".concat(T,"</alter>")),M("<octave>".concat(I[I.length-1],"</octave>")),x--,M("</pitch>")),M("<duration>".concat(A,"</duration>")),"tie"===f[y+1]?M('<tie type="start"/>'):"tie"===f[y-1]&&M('<tie type="stop"/>'),x--,M("<notations>"),x++,M("<articulations>"),x++,m[6]&&M('<staccato placement="below"/>'),x--,M("</articulations>"),x--,"begin slur"===f[y-1]&&(x++,M('<slur type="start"/>'),x--),"end slur"===f[y+1]&&(x++,M('<slur type="stop"/>'),x--),M("</notations>"),M("</note>"),h=!0}}catch(e){w.e(e)}finally{w.f()}}}x--,l&&(x++,M("<barline>"),x++,M("<bar-style>light-heavy</bar-style>"),x--,M("</barline>"),x--,M("</measure>")),x--,M("</part>"),x--}}),M("</score-partwise>"),1e5),n=0;n<t.length-1;n++)"P"!==t[n]&&"#"!==t[n]||!"123456789".includes(t[n+1])||(e=Math.min(e,parseInt(t[n+1])));for(var t=t.split(""),r=0;r<t.length-1;r++)"P"!==t[r]&&"#"!==t[r]||!"123456789".includes(t[r+1])||(t[r+1]=parseInt(t[r+1])-e+1);return t=t.join("")},"undefined"!=typeof module&&module.exports&&(module.exports=saveMxmlOutput);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,n,i){return n&&_defineProperties(t.prototype,n),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,n){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===n?String:Number)(t);i=i.call(t,n||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var Notation=(()=>_createClass(function t(n){_classCallCheck(this,t),this.activity=n,this._notationStaging={},this._notationDrumStaging={},this._markup={},this._pickupPOW2={},this._pickupPoint={}},[{key:"notationStaging",get:function(){return this._notationStaging},set:function(t){this._notationStaging=t}},{key:"notationDrumStaging",get:function(){return this._notationDrumStaging},set:function(t){this._notationDrumStaging=t}},{key:"notationMarkup",get:function(){return this._notationMarkup},set:function(t){this._notationMarkup=t}},{key:"pickupPOW2",get:function(){return this._pickupPOW2}},{key:"pickupPoint",get:function(){return this._pickupPoint}},{key:"_notationMarkup",value:function(t,n,i){i?this._notationStaging[t].push("markdown",n):this._notationStaging[t].push("markup",n),this._pickupPoint[t]=null}},{key:"doUpdateNotation",value:function(t,n,i,o,e){var n=durationToNoteValue(n),a=this.activity.turtles.ithTurtle(i);if(this._notationStaging[i].push([t,n[0],n[1],n[2],n[3],o,0<a.singer.staccato.length&&0<last(a.singer.staccato)]),0===e.length?this._notationDrumStaging[i].push([["R"],n[0],n[1],n[2],n[3],o,!1]):["noise1","noise2","noise3"].includes(e[0])||(a=getDrumSymbol(e[0]),this._notationDrumStaging[i].push([[a],n[0],n[1],n[2],n[3],o,!1])),this._pickupPoint[i]=null,"object"===_typeof(t)&&i in this._markup){for(var u=0;u<this._markup[i].length;u++){var s=this._markup[i][u];"number"==typeof s?this._notationMarkup(i,toFixed2(s),!1):0<s.length&&this._notationMarkup(i,s,!0)}this._markup[i]=[]}}},{key:"notationVoices",value:function(t,n){switch(n){case 1:this._notationStaging[t].push("voice one");break;case 2:this._notationStaging[t].push("voice two");break;case 3:this._notationStaging[t].push("voice three");break;case 4:this._notationStaging[t].push("voice four");break;default:this._notationStaging[t].push("one voice")}this._pickupPoint[t]=null}},{key:"notationKey",value:function(t,n,i){this._notationStaging[t].push("key",n,i),this._pickupPoint[t]=null}},{key:"notationMeter",value:function(t,n,i){if(null!=this._pickupPoint[t]){var o,e,a=this._notationStaging[t].length-this._pickupPoint[t],u=[];for(o in a)u.push(this._notationStaging[t].pop());for(e in this._notationStaging[t].push("meter",n,i),a)this._notationStaging[t].push(u.pop())}else this._notationStaging[t].push("meter",n,i);this._pickupPoint[t]=null}},{key:"notationSwing",value:function(t){this._notationStaging[t].push("swing")}},{key:"notationTempo",value:function(t,n,i){i=convertFactor(i);null!==i&&this._notationStaging[t].push("tempo",n,i)}},{key:"notationPickup",value:function(t,n){if(0!==n){var i=this._notationStaging[t].length,o=convertFactor(n);if(null!==o)this._notationStaging[t].push("pickup",o),this._pickupPOW2[t]=!0;else for(var e=rationalToFraction(1-n),a=0;a<e[0];a++)this.activity.logo.updateNotation(["R"],e[1],t,!1,"");this._pickupPoint[t]=i}}},{key:"__notationHarmonic",value:function(t){this._notationStaging.push("harmonic"),this._pickupPoint[t]=null}},{key:"notationLineBreak",value:function(t){this._pickupPoint[t]=null}},{key:"notationBeginArticulation",value:function(t){this._notationStaging[t].push("begin articulation"),this._pickupPoint[t]=null}},{key:"notationEndArticulation",value:function(t){this._notationStaging[t].push("end articulation"),this._pickupPoint[t]=null}},{key:"notationBeginCrescendo",value:function(t,n){0<n?this._notationStaging[t].push("begin crescendo"):this._notationStaging[t].push("begin decrescendo"),this._pickupPoint[t]=null}},{key:"notationEndCrescendo",value:function(t,n){0<n?this._notationStaging[t].push("end crescendo"):this._notationStaging[t].push("end decrescendo"),this._pickupPoint[t]=null}},{key:"notationBeginSlur",value:function(t){this._notationStaging[t].push("begin slur"),this._pickupPoint[t]=null}},{key:"notationEndSlur",value:function(t){this._notationStaging[t].push("end slur"),this._pickupPoint[t]=null}},{key:"notationInsertTie",value:function(t){this._notationStaging[t].push("tie"),this._pickupPoint[t]=null}},{key:"notationRemoveTie",value:function(t){this._notationStaging[t].pop(),this._pickupPoint[t]=null}},{key:"notationBeginHarmonics",value:function(t){this._notationStaging[t].push("begin harmonics"),this._pickupPoint[t]=null}},{key:"notationEndHarmonics",value:function(t){this._notationStaging[t].push("end harmonics"),this._pickupPoint[t]=null}}],[{key:"notationMarkup",value:function(t,n){t in this._markup?this._markup[t].push(n):this._markup[t]=[n]}}]))();"undefined"!=typeof module&&module.exports&&(module.exports=Notation);
define(["p5.min"],function(o){return console.log("p5-adapter: p5 loaded"),!window.p5&&o&&(window.p5=o),window.Tone?(console.log("p5-adapter: Saving OriginalTone"),window.OriginalTone=window.Tone):console.warn("p5-adapter: window.Tone not found!"),window.AudioContext&&(window.OriginalAudioContext=window.AudioContext),window.webkitAudioContext&&(window.OriginalWebkitAudioContext=window.webkitAudioContext),window.AudioNode&&window.AudioNode.prototype&&(window.OriginalAudioNodeConnect=window.AudioNode.prototype.connect),o});
define(["p5.sound.min"],function(){var n;console.log("p5-sound-adapter: p5.sound loaded"),window.OriginalAudioContext&&window.AudioContext!==window.OriginalAudioContext&&(console.log("p5-sound-adapter: Restoring AudioContext"),window.AudioContext=window.OriginalAudioContext),window.OriginalWebkitAudioContext&&window.webkitAudioContext!==window.OriginalWebkitAudioContext&&(console.log("p5-sound-adapter: Restoring webkitAudioContext"),window.webkitAudioContext=window.OriginalWebkitAudioContext),window.OriginalTone?window.Tone!==window.OriginalTone?(console.log("p5-sound-adapter: Restoring MusicBlocks Tone.js"),window.Tone=window.OriginalTone):console.log("p5-sound-adapter: Tone was not overwritten by p5.sound"):console.warn("p5-sound-adapter: No OriginalTone to restore!"),window.AudioNode&&window.AudioNode.prototype&&((n=window.AudioNode.prototype.connect).isP5AdapterPatched?console.log("p5-sound-adapter: AudioNode.prototype.connect already patched"):(console.log("p5-sound-adapter: Forcing patch of AudioNode.prototype.connect to support chaining"),window.AudioNode.prototype.connect=function(){var o=n.apply(this,arguments);return void 0===o?arguments[0]:o},window.AudioNode.prototype.connect.isP5AdapterPatched=!0))});
function _regenerator(){var p,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",o=e.toStringTag||"@@toStringTag";function i(e,t,o,i){var a,l,n,r,s,c,d,u,h,t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(a=e,l=o,d=i||[],u=!1,h={p:c=0,n:0,v:p,a:m,f:m.bind(p,4),d:function(e,t){return n=e,r=0,s=p,h.n=t,y}},function(e,t,o){if(1<c)throw TypeError("Generator is already running");for(u&&1===t&&m(t,o),r=t,s=o;(b=r<2?p:s)||!u;){n||(r?r<3?(1<r&&(h.n=-1),m(r,s)):h.n=s:h.v=s);try{if(c=2,n){if(b=n[e=r?e:"next"]){if(!(b=b.call(n,s)))throw TypeError("iterator result is not an object");if(!b.done)return b;s=b.value,r<2&&(r=0)}else 1===r&&(b=n.return)&&b.call(n),r<2&&(s=TypeError("The iterator does not provide a '"+e+"' method"),r=1);n=p}else if((b=(u=h.n<0)?s:a.call(l,h))!==y)break}catch(e){n=p,r=1,s=e}finally{c=1}}return{value:b,done:u}}),!0),t;function m(e,t){for(r=e,s=t,b=0;!u&&c&&!o&&b<d.length;b++){var o,i=d[b],a=h.p,l=i[2];3<e?(o=l===t)&&(s=i[(r=i[4])?5:r=3],i[4]=i[5]=p):i[0]<=a&&((o=e<2&&a<i[1])?(r=0,h.v=t,h.n=i[1]):a<l&&(o=e<3||i[0]>t||l<t)&&(i[4]=e,i[5]=t,h.n=l,r=0))}if(o||1<e)return y;throw u=!0,t}}var y={};function f(){}function a(){}function l(){}var b=Object.getPrototypeOf,e=[][t]?b(b([][t]())):(_regeneratorDefine2(b={},t,function(){return this}),b),n=l.prototype=f.prototype=Object.create(e);function r(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(n),e}return _regeneratorDefine2(n,"constructor",a.prototype=l),_regeneratorDefine2(l,"constructor",a),_regeneratorDefine2(l,o,a.displayName="GeneratorFunction"),_regeneratorDefine2(n),_regeneratorDefine2(n,o,"Generator"),_regeneratorDefine2(n,t,function(){return this}),_regeneratorDefine2(n,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:i,m:r}})()}function _regeneratorDefine2(e,t,o,i){var l=Object.defineProperty;try{l({},"",{})}catch(e){l=0}(_regeneratorDefine2=function(e,t,o,i){function a(t,o){_regeneratorDefine2(e,t,function(e){return this._invoke(t,o,e)})}t?l?l(e,t,{value:o,enumerable:!i,configurable:!i,writable:!i}):e[t]=o:(a("next",0),a("throw",1),a("return",2))})(e,t,o,i)}function asyncGeneratorStep(e,t,o,i,a,l,n){try{var r=e[l](n),s=r.value}catch(e){return void o(e)}r.done?t(s):Promise.resolve(s).then(i,a)}function _asyncToGenerator(r){return function(){var e=this,n=arguments;return new Promise(function(t,o){var i=r.apply(e,n);function a(e){asyncGeneratorStep(i,t,o,a,l,"next",e)}function l(e){asyncGeneratorStep(i,t,o,a,l,"throw",e)}a(void 0)})}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i,a,l,n,r=[],s=!0,c=!1;try{if(l=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;s=!1}else for(;!(s=(i=l.call(o)).done)&&(r.push(i.value),r.length!==t);s=!0);}catch(e){c=!0,a=e}finally{try{if(!s&&null!=o.return&&(n=o.return(),Object(n)!==n))return}finally{if(c)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var o,i,a,l,n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return a=!(i=!0),{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw o}}};if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),l=0,{s:t=function(){},n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var o;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(o="Object"===(o={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:o)||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=Array(t);o<t;o++)i[o]=e[o];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var PALETTE_SCALE_FACTOR=.5,PALETTE_WIDTH_FACTOR=3,paletteBlockButtonPush=function(e,t,o){return e.makeBlock(t,o)},makePaletteIcons=function(e,t,o){var i=new Image;return i.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(e)),t&&(i.width=t),o&&(i.height=o),i},Palettes=(()=>_createClass(function e(t){_classCallCheck(this,e),this.activity=t,this.cellSize=Math.floor(this.activity.cellSize*PALETTE_SCALE_FACTOR+.5),this.paletteWidth=55*PALETTE_WIDTH_FACTOR,this.scrollDiff=0,this.originalSize=55,this.firstTime=!0,this.background=null,this.mouseOver=!1,this.activePalette=null,this.paletteObject=null,this.paletteVisible=!1,this.pluginsDeleteStatus=!1,this.visible=!0,this.scale=1,this.mobile=!1,this.top=75+LEADING,this.current=DEFAULTPALETTE,this.x=[],this.y=[],this.pluginMacros={},this.dict={},this.selectorButtonsOff=[],this.selectorButtonsOn=[],this.buttons={},this.labels={},this.pluginPalettes=[]},[{key:"init",value:function(){this.halfCellSize=Math.floor(this.cellSize/2)}},{key:"init_selectors",value:function(){for(var e=0;e<MULTIPALETTES.length;e++)this._makeSelectorButton(e)}},{key:"deltaY",value:function(e){var t=parseInt(document.getElementById("palette").style.top);document.getElementById("palette").style.top=t+e+"px"}},{key:"_makeSelectorButton",value:function(e){var t=this,o=(console.debug("makeSelectorButton "+e),document.getElementById("palette")||((i=document.createElement("div")).id="palette",i.setAttribute("class","disable_highlighting"),i.classList.add("flex-palette"),i.setAttribute("style","position: absolute; z-index: 1000; left :0px; top:"+this.top+"px"),i.innerHTML='<div style="height:fit-content">\n                    <table width="'.concat(1.5*this.cellSize,'" bgcolor="white">\n                        <thead>\n                            <tr></tr>\n                        </thead>\n                    </table>\n                    <table width ="').concat(4.5*this.cellSize,'" bgcolor="white">\n                        <thead>\n                            <tr>\n                                <td style= "width:28px"></td>\n                            </tr>\n                        </thead>\n                        <tbody></tbody>\n                    </table>\n                </div>'),i.childNodes[0].style.border="1px solid ".concat(platformColor.selectorSelected),document.body.appendChild(i)),docById("palette").children[0].children[0].children[0].children[0]),i=o.insertCell(),a=(i.width=1.5*this.cellSize,i.height=1.5*this.cellSize,i.style.position="relative",i.style.backgroundColor=platformColor.paletteBackground,i.appendChild(makePaletteIcons(PALETTEICONS[MULTIPALETTEICONS[e]].replace("background_fill_color",platformColor.paletteLabelBackground).replace(/stroke_color/g,platformColor.strokeColor).replace(/fill_color/g,platformColor.fillColor),1.5*this.cellSize,1.5*this.cellSize)),document.createElement("div"));a.style.position="absolute",a.style.zIndex="10",a.style.top="0",a.style.width="100%",a.style.height="1px",a.style.background=platformColor.paletteLabelBackground,i.appendChild(a),i.onmouseover=function(){t.showSelection(e,o),t.makePalettes(e)}}},{key:"showSelection",value:function(e,t){for(var o=0;o<MULTIPALETTES.length;o++){var i=void 0;o===e?(i=makePaletteIcons(PALETTEICONS[MULTIPALETTEICONS[o]].replace("background_fill_color",platformColor.paletteLabelSelected).replace(/stroke_color/g,platformColor.strokeColor).replace(/fill_color/g,platformColor.fillColor),this.cellSize,this.cellSize),t.children[o].children[1].style.background=platformColor.paletteLabelSelected):(i=makePaletteIcons(PALETTEICONS[MULTIPALETTEICONS[o]].replace("background_fill_color",platformColor.paletteLabelBackground).replace(/stroke_color/g,platformColor.strokeColor).replace(/fill_color/g,platformColor.fillColor),this.cellSize,this.cellSize),t.children[o].children[1].style.background=platformColor.paletteLabelBackground),t.children[o].children[0].src=i.src}}},{key:"setSize",value:function(e){return this.cellSize=Math.floor(e*PALETTE_SCALE_FACTOR+.5),this}},{key:"setMobile",value:function(e){return(this.mobile=e)&&this._hideMenus(),this}},{key:"setSearch",value:function(e,t){return this.activity.showSearchWidget=e,this.activity.hideSearchWidget=t,this}},{key:"getSearchPos",value:function(){return[this.cellSize,this.top+1.75*this.cellSize]}},{key:"getPluginMacroExpansion",value:function(e,t,o){console.debug(this.pluginMacros[e]);e=this.pluginMacros[e];return null!=e&&(e[0][2]=t,e[0][3]=o),e}},{key:"countProtoBlocks",value:function(e){var t,o=0;for(t in this.activity.blocks.protoBlockDict)null!==this.activity.blocks.protoBlockDict[t].palette&&this.activity.blocks.protoBlockDict[t].palette.name===e&&(o+=1);return o}},{key:"getProtoNameAndPalette",value:function(e){for(var t in this.activity.blocks.protoBlockDict){if(e===this.activity.blocks.protoBlockDict[t].name&&!this.activity.blocks.protoBlockDict[t].hidden)return[t,this.activity.blocks.protoBlockDict[t].palette.name,this.activity.blocks.protoBlockDict[t].name];if(e===t&&!this.activity.blocks.protoBlockDict[t].hidden)return[t,this.activity.blocks.protoBlockDict[t].palette.name,this.activity.blocks.protoBlockDict[t].name]}return[null,null,null]}},{key:"makePalettes",value:function(e){var t,o=docById("palette"),i=o.children[0].children[1].children[1],a=(i.parentNode.removeChild(i),i=o.children[0].children[1].appendChild(document.createElement("tbody")),this.makeSearchButton("search",makePaletteIcons(PALETTEICONS.search,this.cellSize,this.cellSize),i),_createForOfIteratorHelper(MULTIPALETTES[e]));try{for(a.s();!(t=a.n()).done;){var l=t.value;this.activity.beginnerMode&&SKIPPALETTES.includes(l)||"myblocks"===l&&0===this.countProtoBlocks("myblocks")||this.makeButton(l,makePaletteIcons(PALETTEICONS[l],this.cellSize,this.cellSize),i)}}catch(e){a.e(e)}finally{a.f()}}},{key:"makeSearchButton",value:function(e,t,o){var o=o.insertRow(-1),i=o.insertCell(-1),a=o.insertCell(-1);i.appendChild(t),i.style.padding="4px",i.style.boxSizing="content-box",i.style.width="".concat(this.cellSize,"px"),i.style.height="".concat(this.cellSize,"px"),a.textContent=toTitleCase(_(e)),a.style.color=platformColor.paletteText,o.style.borderBottom="1px solid #0CAFFF",a.style.fontSize="kana"===localStorage.kanaPreference?"12px":"16px",a.style.padding="4px",o.style.display="flex",o.style.flexDirection="row",o.style.alignItems="center",o.style.width="126px",o.style.backgroundColor=platformColor.paletteBackground,this._loadPaletteButtonHandler(e,o)}},{key:"makeButton",value:function(e,t,o){var i=o.insertRow(-1),o=i.insertCell(-1),a=i.insertCell(-1);o.appendChild(t),o.style.padding="4px",o.style.boxSizing="content-box",o.style.width="".concat(this.cellSize,"px"),o.style.height="".concat(this.cellSize,"px"),a.textContent=toTitleCase(_(e)),a.style.color=platformColor.paletteText,a.style.fontSize="kana"===localStorage.kanaPreference?"12px":"16px",a.style.padding="4px",i.style.display="flex",i.style.flexDirection="row",i.style.alignItems="center",i.style.width="126px",i.style.backgroundColor=platformColor.paletteBackground,i.addEventListener("mouseover",function(){i.style.backgroundColor=platformColor.hoverColor}),i.addEventListener("mouseout",function(){i.style.backgroundColor=platformColor.paletteBackground}),this._loadPaletteButtonHandler(e,i)}},{key:"showPalette",value:function(e){this.mobile||(this.dict[e].showMenu(!0),this.activePalette=e)}},{key:"_showMenus",value:function(){}},{key:"_hideMenus",value:function(){this.activity.hideSearchWidget(!0),docById("PaletteBody")&&docById("PaletteBody").parentNode.removeChild(docById("PaletteBody"))}},{key:"getInfo",value:function(){for(var e in this.dict)console.debug(this.dict[e].getInfo())}},{key:"updatePalettes",value:function(e){var t;null!=e&&e in this.dict&&(t=!1,docById("PaletteBody")&&(t=!0),this.dict[e].hideMenu(),t)&&this.dict[e].show(),this.mobile&&this.hide()}},{key:"hide",value:function(){docById("palette").style.visibility="hidden"}},{key:"show",value:function(){docById("palette").style.visibility="visible"}},{key:"clear",value:function(){try{for(var e in this.dict){var t;this.dict.hasOwnProperty(e)&&(t=this.dict[e])&&"function"==typeof t.hideMenu&&t.hideMenu()}var o=docById("palette"),i=(o&&o.parentNode.removeChild(o),this.dict={},this.visible=!1,this.activePalette=null,this.paletteObject=null,document.createElement("div"));i.id="palette",i.setAttribute("class","disable_highlighting"),i.classList.add("flex-palette"),i.setAttribute("style","position: fixed; z-index: 1000; left: 0px; top: ".concat(60+this.top,"px; overflow-y: auto;")),i.innerHTML='<div style="height:fit-content">\n                    <table width="'.concat(1.5*this.cellSize,'" bgcolor="white">\n                        <thead>\n                            <tr></tr>\n                        </thead>\n                    </table>\n                    <table width="').concat(4.5*this.cellSize,'" bgcolor="white">\n                        <thead>\n                            <tr>\n                                <td style= "width:28px"></td>\n                            </tr>\n                        </thead>\n                        <tbody>\n                        </tbody>\n                    </table>\n                </div>'),i.childNodes[0].style.border="1px solid ".concat(platformColor.selectorSelected),document.body.appendChild(i)}catch(e){console.error("Error clearing palettes:",e)}}},{key:"setBlocks",value:function(e){return this.blocks=e,this}},{key:"add",value:function(e){return this.dict[e]=new Palette(this,e),this}},{key:"_loadPaletteButtonHandler",value:function(e,t){var o,i=this;t.onmouseover=function(){"search"===e?document.body.style.cursor="text":(document.body.style.cursor="pointer",clearTimeout(o),o=setTimeout(function(){return i.showPalette(e)},400))},t.onmouseout=function(){return clearTimeout(o)},t.onclick=function(){"search"==e?(i._hideMenus(),i.activity.showSearchWidget()):i.showPalette(e)},t.onmouseup=function(){document.body.style.cursor="default"},t.onmouseleave=function(){document.body.style.cursor="default"}}},{key:"removeActionPrototype",value:function(e){for(var t=!1,o=0;o<this.dict.action.protoList.length;o++){var i=this.dict.action.protoList[o];if(-1!==["nameddo","namedcalc","nameddoArg","namedcalcArg"].indexOf(i.name)&&i.defaults[0]===e){this.dict.action.remove(i,e),this.activity.blocks.protoBlockDict["myDo_"+e]?delete this.activity.blocks.protoBlockDict["myDo_"+e]:this.activity.blocks.protoBlockDict["myCalc_"+e]?delete this.activity.blocks.protoBlockDict["myCalc_"+e]:this.activity.blocks.protoBlockDict["myDoArg_"+e]?delete this.activity.blocks.protoBlockDict["myDoArg_"+e]:this.activity.blocks.protoBlockDict["myCalcArg_"+e]&&delete this.activity.blocks.protoBlockDict["myCalcArg_"+e],t=!0;break}}t&&this.updatePalettes("action")}}]))(),PaletteModel=(()=>_createClass(function e(t,o,i){_classCallCheck(this,e),this.palette=t,this.palettes=o,this.activity=o.activity,this.name=i,this.blocks=[]},[{key:"update",value:function(){for(var e in this.blocks=[],this.palette.protoList){var t=this.palette.protoList[e];this.blocks.push(this.makeBlockInfo(e,t,t.name,t.name))}}},{key:"makeBlockInfo",value:function(e,t,o,i){var a;switch(o){case"storein":i="store in "+t.defaults[0],a=t.defaults[0];break;case"storein2":i="store in2 "+t.staticLabels[0],a=t.staticLabels[0];break;case"box":i=t.defaults[0],a=t.defaults[0];break;case"namedbox":a=void 0===t.defaults[0]?(i="namedbox",_("box")):(i=t.defaults[0],t.defaults[0]);break;case"namedarg":a=void 0===t.defaults[0]?(i="namedarg","1"):(i=t.defaults[0],t.defaults[0]);break;case"nameddo":a=void 0===t.defaults[0]?(i="nameddo",_("action")):(i=t.defaults[0],t.defaults[0]);break;case"nameddoArg":a=void 0===t.defaults[0]?(i="nameddoArg",_("action")):(i=t.defaults[0],t.defaults[0]);break;case"namedcalc":a=void 0===t.defaults[0]?(i="namedcalc",_("action")):(i=t.defaults[0],t.defaults[0]);break;case"namedcalcArg":a=void 0===t.defaults[0]?(i="namedcalcArg",_("action")):(i=t.defaults[0],t.defaults[0])}var l=this.activity.blocks.protoBlockDict[o],n=(null===l&&console.debug("Could not find block "+o),"");switch(l.name){case"grid":n=_("Grid").toLowerCase();break;case"text":n=_("text");break;case"drumname":n=_("drum");break;case"effectsname":n=_("effect");break;case"solfege":n=i18nSolfege("sol");break;case"eastindiansolfege":n=_("sargam");break;case"scaledegree2":n=_("scale degree");break;case"modename":n=_("mode name");break;case"invertmode":n=_("invert mode");break;case"voicename":n=_("voice name");break;case"customNote":n=_("custom pitch");break;case"temperamentname":n=_("temperament");break;case"accidentalname":n=_("accidental");break;case"notename":n="G";break;case"intervalname":n=_("interval name");break;case"boolean":n=_("true");break;case"number":n=NUMBERBLOCKDEFAULT.toString();break;case"less":case"greater":case"equal":n=l.staticLabels[0];break;case"namedarg":n="arg "+a;break;case"outputtools":n=_("pitch converter");break;default:o!=i?n="storein"===o&&t.defaults[0]===_("box")?_("store in"):"storein2"===o?t.staticLabels[0]===_("store in box")?_("store in box"):_("store in")+" "+t.staticLabels[0]:t.defaults[0]:0<l.staticLabels.length?""===(n=l.staticLabels[0])&&(n="loadFile"===o?_("open file"):o):n=o}-1!=["do","nameddo","namedbox","namedcalc","doArg","calcArg","nameddoArg","namedcalcArg"].indexOf(l.name)&&null!=n&&getTextWidth(n,"bold 20pt Sans")>TEXTWIDTH&&(n=n.substr(0,STRINGLEN)+"..."),l.image&&(n="");var r=l.scale;switch(l.scale=DEFAULTBLOCKSCALE,l.name){case"namedbox":case"namedarg":(s=new SVG).setScale(l.scale),s.setExpand(60,0,0,0),s.setOutie(!0),c=s.basicBox(),d=s.docks,u=s.getHeight();break;case"nameddo":(s=new SVG).setScale(l.scale),s.setExpand(60,0,0,0),c=s.basicBlock(),d=s.docks,u=s.getHeight();break;default:var s=l.generator(),c=s[0],d=s[1],u=s[3]}l.scale=r,c=(l.disabled?c.replace(/fill_color/g,DISABLEDFILLCOLOR).replace(/stroke_color/g,DISABLEDSTROKECOLOR):c.replace(/fill_color/g,PALETTEFILLCOLORS[l.palette.name]).replace(/stroke_color/g,PALETTESTROKECOLORS[l.palette.name])).replace("block_label",safeSVG(n));for(var h=0;h<=l.args;h++)c=c.replace("arg_label_"+h,l.staticLabels[h]||"");return{blk:e,blkname:o,modname:i,height:STANDARDBLOCKHEIGHT,actualHeight:u,label:n,artwork:c,artwork64:"data:image/svg+xml;base64,"+window.btoa(base64Encode(c)),docks:d,image:t.image,scale:t.scale,palettename:this.palette.name,hidden:t.hidden}}}]))(),Palette=function(){function Palette(e,t){_classCallCheck(this,Palette),this.palettes=e,this.activity=e.activity,this.name=t,this.model=new PaletteModel(this,e,t),this.visible=!1,this.menuContainer=null,this.protoList=[],this.protoContainers={},this.protoHeights={},this.background=null,this.size=0,this.columns=0,this.draggingProtoBlock=!1,this.mouseHandled=!1,this.upButton=null,this.downButton=null,this.fadedUpButton=null,this.fadedDownButton=null,this.count=0,this._outsideClickListener=null}return _createClass(Palette,[{key:"hide",value:function(){this.hideMenu()}},{key:"show",value:function(){this.showMenu(!0)}},{key:"hideMenu",value:function(){docById("palette").childNodes[0].style.borderRight="1px solid ".concat(platformColor.selectorSelected),this._hideMenuItems()}},{key:"showMenu",value:function(e){var t=this,o=docById("palette"),i=(o.childNodes[0].style.borderRight="0",docById("PaletteBody")&&o.removeChild(docById("PaletteBody")),document.createElement("table")),a=(i.id="PaletteBody",window.innerHeight-this.palettes.top-this.palettes.cellSize-26);i.insertAdjacentHTML("afterbegin",'<thead></thead><tbody style = "display: block;   width: 100% ; height:auto ; max-height: '.concat(a,'px;  overflow: auto; overflow-x: hidden;" id="PaletteBody_items" class="PalScrol"></tbody>')),i.style.minWidth="180px",i.style.background=platformColor.paletteBackground,i.style.float="left",i.style.border="1px solid ".concat(platformColor.selectorSelected),[i.childNodes[0],i.childNodes[1]].forEach(function(e){e.style.boxSizing="border-box",e.style.padding="8px"}),o.appendChild(i),this.menuContainer=i,e&&((a=(a=this.menuContainer.children[0]).insertRow()).style.backgroundColor=platformColor.paletteLabelBackground,a.innerHTML='<td style ="width: 100%; height: 42px; box-sizing: border-box; display: flex; flex-direction: row; align-items: center; justify-content: space-between;"></td>',(a=a.children[0]).style.padding="8px",(o=makePaletteIcons(PALETTEICONS[this.name],this.palettes.cellSize,this.palettes.cellSize)).style.borderRadius="4px",o.style.padding="2px",o.style.backgroundColor=platformColor.paletteBackground,a.appendChild(o),(i=document.createElement("span")).textContent=toTitleCase(_(this.name)),i.style.fontWeight="bold",i.style.color=platformColor.textColor,a.appendChild(i),(e=document.createElement("span")).style.height="".concat(this.palettes.cellSize,"px"),(o=makePaletteIcons(CLOSEICON.replace("fill_color",platformColor.selectorSelected),this.palettes.cellSize,this.palettes.cellSize)).onclick=function(){return t.hideMenu()},o.onmouseover=function(){return document.body.style.cursor="pointer"},o.onmouseleave=function(){return document.body.style.cursor="default"},e.appendChild(o),a.appendChild(e)),this._showMenuItems(),this._outsideClickListener&&document.removeEventListener("click",this._outsideClickListener),this._outsideClickListener=function(e){t.menuContainer.contains(e.target)||(t.hideMenu(),document.removeEventListener("click",t._outsideClickListener),t._outsideClickListener=null)},setTimeout(function(){document.addEventListener("click",t._outsideClickListener)},0)}},{key:"_hideMenuItems",value:function(){"search"===this.name&&null!==this.activity.hideSearchWidget&&this.activity.hideSearchWidget(!0),docById("PaletteBody")&&docById("palette").removeChild(docById("PaletteBody"))}},{key:"_showMenuItems",value:function _showMenuItems(){var _this4=this,paletteList=(this.model.update(),docById("PaletteBody_items")),blocks=this.model.blocks,protoListScope=(blocks.reverse(),_toConsumableArray(this.protoList)),_loop=(last(blocks).blkname!=last(protoListScope).name&&protoListScope.reverse(),function _loop(blk){var b=blocks[blk];if(b.hidden)return 1;var itemRow=paletteList.insertRow(),itemCell=itemRow.insertCell(),img=makePaletteIcons(b.artwork),down=(b.image&&(img=["media","camera","video"].includes(b.blkname)?makePaletteIcons(eval(b.blkname+"PALETTE")):makePaletteIcons(_this4.activity.pluginsImages[b.blkname])),img.onmouseover=function(){return document.body.style.cursor="pointer"},img.onmouseleave=function(){return document.body.style.cursor="default"},img.ondragstart=function(){return!1},function(e){function i(e){var t;e.preventDefault(),e="touchmove"===e.type?(t=e.touches[0].clientX,e.touches[0].clientY):(t=e.pageX,e.pageY),t=t,e=e,img.style.left=t-img.offsetWidth/2+"px",img.style.top=e-img.offsetHeight/2+"px"}function t(e){document.body.style.cursor="default",document.removeEventListener("mousemove",i),document.removeEventListener("touchmove",i),img.onmouseup=null,img.ontouchend=null;var t=parseInt(img.style.left),o=parseInt(img.style.top);img.style.position=a,img.style.zIndex=l,document.body.removeChild(img),itemCell.appendChild(img),n._makeBlockFromProtoblock(protoListScope[blk],!0,b.modname,e,(t||n.activity.blocksContainer.x+100)-n.activity.blocksContainer.x,(o||n.activity.blocksContainer.y+100)-n.activity.blocksContainer.y)}var a=img.style.position,l=img.style.zIndex,n=(img.style.position="absolute",img.style.zIndex=1e3,document.body.appendChild(img),i(e),document.addEventListener("touchmove",i,{passive:!1}),document.addEventListener("mousemove",i),_this4);img.ontouchend=t,img.onmouseup=t});img.ontouchstart=down,img.onmousedown=down,itemCell.style.width="".concat(img.width,"px"),itemCell.style.paddingRight="".concat(_this4.palettes.cellSize,"px"),itemCell.appendChild(img)}),blk;for(blk in blocks)_loop(blk);this.palettes.mobile&&this.hide()}},{key:"setupGrabScroll",value:function(t){function o(){document.body.style.cursor="default"}function i(e){e=e.clientY-a,t.scrollTop=l-e,document.body.style.cursor="grabbing"}var a,l;t.onmousedown=function(e){a=e.clientY,l=t.scrollTop,t.onmousemove=i,t.onmouseup=o,t.onmouseleave=o}}},{key:"getInfo",value:function(){var e,t=this.name+" palette:";for(e in this.protoList)t+=" "+this.protoList[e].name;return t}},{key:"remove",value:function(e,t){e=this.protoList.indexOf(e);-1!==e&&this.protoList.splice(e,1);for(var o=0;o<this.model.blocks.length;o++){if(["nameddo","nameddoArg","namedcalc","namedcalcArg"].includes(this.model.blocks[o].blkname)&&this.model.blocks[o].modname===t){this.model.blocks.splice(o,1);break}if(["storein"].includes(this.model.blocks[o].blkname)&&this.model.blocks[o].modname===_("store in")+" "+t){this.model.blocks.splice(o,1);break}}}},{key:"add",value:function(e,t){return this.protoList.includes(e)||this.protoList.push(e),this}},{key:"makeBlockFromSearch",value:function(e,t,o){this._makeBlockFromPalette(e,t,o),this.activity.hideSearchWidget()}},{key:"_makeBlockFromPalette",value:function(e,t,o){if(null===e)console.debug("null protoblk?");else{var i,a;switch(e.name){case"do":t="do "+e.defaults[0],i=e.name,a=e.defaults[0];break;case"storein":t="store in "+e.defaults[0],i=e.name,a=e.defaults[0];break;case"storein2":console.debug("storein2 "+e.defaults[0]+" "+e.staticLabels[0]),t="store in2 "+e.defaults[0],i=e.name,a=e.staticLabels[0];break;case"box":t=e.defaults[0],i=e.name,a=e.defaults[0];break;case"namedbox":a=void 0===e.defaults[0]?(t="namedbox",_("box")):(console.debug(e.defaults[0]),t=e.defaults[0],e.defaults[0]),i=e.name;break;case"namedarg":a=void 0===e.defaults[0]?(t="namedarg","1"):(t=e.defaults[0],e.defaults[0]),i=e.name;break;case"nameddo":a=void 0===e.defaults[0]?(t="nameddo",_("action")):(t=e.defaults[0],e.defaults[0]),i=e.name;break;case"nameddoArg":a=void 0===e.defaults[0]?(t="nameddoArg",_("action")):(t=e.defaults[0],e.defaults[0]),i=e.name;break;case"namedcalc":a=void 0===e.defaults[0]?(t="namedcalc",_("action")):(t=e.defaults[0],e.defaults[0]),i=e.name;break;case"namedcalcArg":a=void 0===e.defaults[0]?(t="namedcalcArg",_("action")):(t=e.defaults[0],e.defaults[0]),i=e.name;break;case"outputtools":a=void 0===e.defaults[0]?(t="outputtools","letter class"):(t=e.defaults[0],e.defaults[0]),i=e.name;break;default:a="nameddo"===t?_("action"):"__NOARG__",i=t}var l,n=this.activity.blocks.blockList.length;if(["namedbox","nameddo","namedcalc","nameddoArg","namedcalcArg"].includes(e.name)||!blockIsMacro(this.activity,t))return!["namedbox","nameddo","namedcalc","nameddoArg","namedcalcArg"].includes(e.name)&&t in this.palettes.pluginMacros?(this._makeBlockFromProtoblock(e,!0,t,null,100,100),o(n),n):(o(l=paletteBlockButtonPush(this.activity.blocks,i,a)),l);this._makeBlockFromProtoblock(e,!0,t,null,100,100),o(n)}}},{key:"_makeBlockFromProtoblock",value:function(e,t,o,M,i,a){var l=this;if(t){this.draggingProtoBlock=t=!1;t=null;if("status"===e.name){for(var n=0;n<this.activity.blocks.blockList.length;n++){var r=this.activity.blocks.blockList[n];if("status"===r.name&&!r.trash)return void console.log("Status block already exists, preventing creation of another one")}null===this.activity.logo.statusMatrix&&(this.activity.logo.statusMatrix=new StatusMatrix),this.activity.logo.statusFields&&(this.activity.logo.statusFields=[]);for(var s=["modelength","deltapitch2","deltapitch","currentkey","currentmode","x","y","grey","shade","pensize","color","elapsednotes","beatfactor","notevalue","beatvalue","measurevalue","bpmfactor","currentpitch"],c=[],d=new Set,u=0;u<this.activity.blocks.blockList.length;u++){var h=this.activity.blocks.blockList[u];if(!h.trash){var m,p=_createForOfIteratorHelper(s);try{for(p.s();!(m=p.n()).done;){var y=m.value;if(h.name===y&&!d.has(y)){this.activity.logo.statusFields&&this.activity.logo.statusFields.push([u,y]),c.push([u,y]),d.add(y);break}}}catch(e){p.e(e)}finally{p.f()}}}for(var f=[],b=new Set,k=0;k<this.activity.blocks.blockList.length;k++){var v=this.activity.blocks.blockList[k];"namedbox"!==v.name||v.trash||!v.overrideName||b.has(v.overrideName)||(this.activity.logo.statusFields&&this.activity.logo.statusFields.push([k,"namedbox"]),f.push(k),b.add(v.overrideName))}for(var g=[[0,"status",i,a,[null,1,2]],[1,"hidden",0,0,[0,0<c.length||0<f.length?3:null]],[2,"hiddennoflow",0,0,[0,null]]],_=2,C=1,S=0;S<c.length;S++){var L=_slicedToArray(c[S],2),x=L[0],L=L[1],x=activity.blocks.blockList[x];g.push([_+1,"print",0,0,[C,_+2,!(S===c.length-1)||0<f.length?_+3:null]]),g.push([_+2,[L,{value:x.value}],0,0,[C=_+1]]),_+=2}for(var T=0;T<f.length;T++){var B=activity.blocks.blockList[f[T]];console.log("Adding box block to status:",B),g.push([_+1,"print",0,0,[C,_+2,T<f.length-1?_+3:null]]),g.push([_+2,["namedbox",{value:B.overrideName}],0,0,[C=_+1]]),_+=2}console.log("blocks"),t=g,this.activity.logo.statusMatrix.init(this.activity),this.activity.logo.inStatusMatrix=!1,this.activity.logo.statusMatrix.updateAll()}else["namedbox","nameddo","namedcalc","nameddoArg","namedcalcArg"].includes(e.name)||null===(t=getMacroExpansion(this.activity,o,i,a))&&o in this.palettes.pluginMacros&&(t=this.palettes.getPluginMacroExpansion(o,i,a));if(null!==t){this.activity.blocks.loadNewBlocks(t);t=this.activity.blocks.blockList.length-1,t=this.activity.blocks.findTopBlock(t);this.activity.blocks.blockList[t].container.x<2*this.activity.palettes.paletteWidth&&this.activity.blocks.moveBlock(t,2*this.activity.palettes.paletteWidth,this.activity.blocks.blockList[t].container.y)}else if("myblocks"===this.name){for(var P=o.replace("macro_",""),w=[],A=0;A<this.activity.macroDict[P].length;A++){var I=this.activity.macroDict[P][A][1],E=[],E="string"==typeof I?I:"string"==typeof I[1]?"number"===I[0]?[I[0],Number(I[1])]:[I[0],I[1]]:"number"==typeof I[1]?"number"===I[0]?[I[0],I[1]]:[I[0],I[1].toString()]:"number"===I[0]?[I[0],Number(I[1].value)]:[I[0],{value:I[1].value}],D=[this.activity.macroDict[P][A][0],E,this.activity.macroDict[P][A][2],this.activity.macroDict[P][A][3],this.activity.macroDict[P][A][4]];w.push(D)}w[0][2]=i,w[0][3]=a,this.activity.blocks.loadNewBlocks(w);var t=this.activity.blocks.blockList.length-1,O=this.activity.blocks.findTopBlock(t);this.activity.blocks.blockList[O].container.x<2*this.activity.palettes.paletteWidth&&this.activity.blocks.moveBlock(O,2*this.activity.palettes.paletteWidth,this.activity.blocks.blockList[O].container.y),setTimeout(function(){l.activity.blocks.blockList[O].collapseToggle()},500)}else D=this._makeBlockFromPalette(e,o,function(e){for(var t in l.activity.blocks.findDragGroup(e),l.activity.blocks.dragGroup)l.activity.blocks.moveBlockRelative(l.activity.blocks.dragGroup[t],i,a);l.activity.blocks.blockMoved(e),l.activity.blocks.checkBounds()}),this.activity.blocks.blockList[D].container.x<2*this.activity.palettes.paletteWidth&&this.activity.blocks.moveBlock(D,2*this.activity.palettes.paletteWidth,this.activity.blocks.blockList[D].container.y)}}}])}(),initPalettes=(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:for(o=0;o<BUILTINPALETTES.length;o++)t.add(BUILTINPALETTES[o]);t.init_selectors(),t.makePalettes(0),console.debug("Time to show the palettes."),t.show();case 1:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})();"undefined"!=typeof module&&module.exports&&(module.exports={Palettes:Palettes,initPalettes:initPalettes});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var PASTEBOX='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg version="1.1" width="300" height="55" id="svg1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs1" /> <rect width="300" height="55" x="0" y="0" style="fill:#f0f0f0;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.0351" id="rect1" /> <g transform="translate(244.943,-0.05299642)" style="display:block;fill:#000000" id="g1"> <path d="m 27.557,5.053 c -12.43,0 -22.5,10.076 -22.5,22.497 0,12.432 10.07,22.503 22.5,22.503 12.431,0 22.5,-10.071 22.5,-22.503 0,-12.421 -10.07,-22.497 -22.5,-22.497 z m 10.199,28.159 c 1.254,1.256 1.257,3.291 0,4.545 -0.628,0.629 -1.451,0.943 -2.274,0.943 -0.822,0 -1.644,-0.314 -2.27,-0.94 l -5.76,-5.761 -5.76,5.761 c -0.627,0.626 -1.449,0.94 -2.271,0.94 -0.823,0 -1.647,-0.314 -2.275,-0.943 -1.254,-1.254 -1.254,-3.289 0.004,-4.545 l 5.758,-5.758 -5.758,-5.758 c -1.258,-1.254 -1.258,-3.292 -0.004,-4.546 1.255,-1.254 3.292,-1.259 4.546,0 l 5.76,5.759 5.76,-5.759 c 1.252,-1.259 3.288,-1.254 4.544,0 1.257,1.254 1.254,3.292 0,4.546 l -5.758,5.758 z" style="display:inline;fill:#000000" id="path1" /> </g> <g id="g4" transform="translate(18,-0.05299642)"> <g transform="translate(176.943)" style="display:block;fill:#008000" id="g2"> <path d="m 27.557,5.053 c -12.43,0 -22.5,10.076 -22.5,22.497 0,12.432 10.07,22.503 22.5,22.503 12.431,0 22.5,-10.071 22.5,-22.503 0,-12.421 -10.07,-22.497 -22.5,-22.497 z" style="display:inline;fill:#008000" id="path1-3" /> </g> <path id="path3" style="fill:#ffffff;stroke:#ffffff;stroke-width:6;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1" d="m 216.1272,19.380148 -16.33945,16.345703 z m -23.25273,8.640234 6.91328,7.705469 z" /> </g></svg>',PasteBox=(()=>_createClass(function t(e){_classCallCheck(this,t),this.activity=e,this._container=null,this.save=null,this.close=null,this._scale=1},[{key:"hide",value:function(){null!=this._container&&(this._container.visible=!1,this.activity.refreshCanvas(),docById("paste").value="",docById("paste").style.visibility="hidden")}},{key:"createBox",value:function(t,e,i){null==this._container&&(this._scale=t,this._container=new createjs.Container,this.activity.stage.addChild(this._container),this._container.x=e,this._container.y=i,this._makeBoxBitmap(PASTEBOX,"box",function(t,e,i){t._container.addChild(i),t._loadClearContainerHandler(),t._container.visible=!0,t.activity.refreshCanvas()},null))}},{key:"show",value:function(){this._container.visible=!0,this.activity.refreshCanvas(),docById("paste").style.visibility="visible"}},{key:"getPos",value:function(){return[this._container.x,this._container.y]}},{key:"_loadClearContainerHandler",value:function(){var i=this,t=new createjs.Shape,n=(this.bounds=this._container.getBounds(),t.graphics.beginFill("#FFF").drawRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height),t.x=0,t.y=0,this._container.hitArea=t,!1);this._container.on("click",function(t){var e;n||(n=!0,setTimeout(function(){n=!1},500),e=t.stageX/i._scale-i._container.x,t=t.stageY/i._scale-i._container.y,console.log(e,t),200<e&&e<250&&t<55&&(i.activity.pasted(),i.hide()),250<e&&t<55&&i.hide())})}},{key:"_makeBoxBitmap",value:function(t,e,i,n){var o=this,a=new Image;a.onload=function(){var t=new createjs.Bitmap(a);i(o,e,t,n)},a.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(t))}}]))();"undefined"!=typeof module&&module.exports&&(module.exports=PasteBox);
function _createForOfIteratorHelper(e,t){var l,i,a,n,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return a=!(i=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return i=e.done,e},e:function(e){a=!0,l=e},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw l}}};if(Array.isArray(e)||(o=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var l;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(l="Object"===(l={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:l)||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,i=Array(t);l<t;l++)i[l]=e[l];return i}function _regenerator(){var d,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",l=e.toStringTag||"@@toStringTag";function i(e,t,l,i){var a,n,o,s,c,h,r,u,m,t=t&&t.prototype instanceof _?t:_,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(a=e,n=l,r=i||[],u=!1,m={p:h=0,n:0,v:d,a:v,f:v.bind(d,4),d:function(e,t){return o=e,s=0,c=d,m.n=t,W}},function(e,t,l){if(1<h)throw TypeError("Generator is already running");for(u&&1===t&&v(t,l),s=t,c=l;(g=s<2?d:c)||!u;){o||(s?s<3?(1<s&&(m.n=-1),v(s,c)):m.n=c:m.v=c);try{if(h=2,o){if(g=o[e=s?e:"next"]){if(!(g=g.call(o,c)))throw TypeError("iterator result is not an object");if(!g.done)return g;c=g.value,s<2&&(s=0)}else 1===s&&(g=o.return)&&g.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),s=1);o=d}else if((g=(u=m.n<0)?c:a.call(n,m))!==W)break}catch(e){o=d,s=1,c=e}finally{h=1}}return{value:g,done:u}}),!0),t;function v(e,t){for(s=e,c=t,g=0;!u&&h&&!l&&g<r.length;g++){var l,i=r[g],a=m.p,n=i[2];3<e?(l=n===t)&&(c=i[(s=i[4])?5:s=3],i[4]=i[5]=d):i[0]<=a&&((l=e<2&&a<i[1])?(s=0,m.v=t,m.n=i[1]):a<n&&(l=e<3||i[0]>t||n<t)&&(i[4]=e,i[5]=t,m.n=n,s=0))}if(l||1<e)return W;throw u=!0,t}}var W={};function _(){}function a(){}function n(){}var g=Object.getPrototypeOf,e=[][t]?g(g([][t]())):(_regeneratorDefine2(g={},t,function(){return this}),g),o=n.prototype=_.prototype=Object.create(e);function s(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,n):(e.__proto__=n,_regeneratorDefine2(e,l,"GeneratorFunction")),e.prototype=Object.create(o),e}return _regeneratorDefine2(o,"constructor",a.prototype=n),_regeneratorDefine2(n,"constructor",a),_regeneratorDefine2(n,l,a.displayName="GeneratorFunction"),_regeneratorDefine2(o),_regeneratorDefine2(o,l,"Generator"),_regeneratorDefine2(o,t,function(){return this}),_regeneratorDefine2(o,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:i,m:s}})()}function _regeneratorDefine2(e,t,l,i){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}(_regeneratorDefine2=function(e,t,l,i){function a(t,l){_regeneratorDefine2(e,t,function(e){return this._invoke(t,l,e)})}t?n?n(e,t,{value:l,enumerable:!i,configurable:!i,writable:!i}):e[t]=l:(a("next",0),a("throw",1),a("return",2))})(e,t,l,i)}function asyncGeneratorStep(e,t,l,i,a,n,o){try{var s=e[n](o),c=s.value}catch(e){return void l(e)}s.done?t(c):Promise.resolve(c).then(i,a)}function _asyncToGenerator(s){return function(){var e=this,o=arguments;return new Promise(function(t,l){var i=s.apply(e,o);function a(e){asyncGeneratorStep(i,t,l,a,n,"next",e)}function n(e){asyncGeneratorStep(i,t,l,a,n,"throw",e)}a(void 0)})}}var setWheelSize=function(e){var t=document.getElementById("wheelDiv"),l=window.innerWidth;t.style.position="absolute",t.style.zIndex="20000",1200<=l?(t.style.width=e+"px",t.style.height=e+"px"):768<=l?(t.style.width=e-50+"px",t.style.height=e-50+"px"):(t.style.width=e-100+"px",t.style.height=e-100+"px"),t.style.height=t.style.width},getPieMenuSize=function(e){e=e.blocks.turtles._canvas;return Math.min(e.width,e.height)},enableWheelScroll=(setWheelSize(),window.addEventListener("resize",setWheelSize),function(i,a){var n,e,t=document.getElementById("wheelDiv");t&&i&&(t._scrollHandler&&t.removeEventListener("wheel",t._scrollHandler),n=!1,t._scrollHandler=e=function(e){if(e.preventDefault(),e.stopPropagation(),!n){n=!0;for(var e=0<e.deltaY?1:-1,e=i.selectedNavItemIndex+e,t=(e<0?e=a-1:a<=e&&(e=0),[]),l=0;l<i.navItems.length;l++)t[l]=i.navItems[l].navigateFunction,i.navItems[l].navigateFunction=null;i.navigateWheel(e),setTimeout(function(){for(var e=0;e<i.navItems.length;e++)i.navItems[e].navigateFunction=t[e]},50),setTimeout(function(){n=!1},150)}},t.addEventListener("wheel",e,{passive:!1}))}),piemenuPitches=function(h,r,u,e,t,l,m){var v=null;if(!h.blocks.stageClick){void 0===m&&(m=!1);var d=null!==h.connections[0]&&["pitch","setpitchnumberoffset","invert1","tofrequency"].includes(h.blocks.blockList[h.connections[0]].name),i=(null!==h.connections[0]&&["setkey","setkey2"].includes(h.blocks.blockList[h.connections[0]].name)&&(r=["C","G","D","A","E","B","F"],u=["C","G","D","A","E","B","F"]),docById("wheelDiv")),a=(i.style.display="",i.style.opacity="0",getPieMenuSize(h));if(h._pitchWheel=new wheelnav("wheelDiv",null,a,a),m||(h._accidentalsWheel=new wheelnav("_accidentalsWheel",h._pitchWheel.raphael)),d&&(h._octavesWheel=new wheelnav("_octavesWheel",h._pitchWheel.raphael)),h._exitWheel=new wheelnav("_exitWheel",h._pitchWheel.raphael),wheelnav.cssMode=!0,h._pitchWheel.keynavigateEnabled=!1,h._pitchWheel.colors=platformColor.pitchWheelcolors,h._pitchWheel.slicePathFunction=slicePath().DonutSlice,h._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),h._pitchWheel.slicePathCustom.minRadiusPercent=.2,h._pitchWheel.slicePathCustom.maxRadiusPercent=m?.75:.5,h._pitchWheel.sliceSelectedPathCustom=h._pitchWheel.slicePathCustom,h._pitchWheel.sliceInitPathCustom=h._pitchWheel.slicePathCustom,h._pitchWheel.animatetime=0,h._pitchWheel.createWheel(r),h._exitWheel.colors=platformColor.exitWheelcolors,h._exitWheel.slicePathFunction=slicePath().DonutSlice,h._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),h._exitWheel.slicePathCustom.minRadiusPercent=0,h._exitWheel.slicePathCustom.maxRadiusPercent=.2,h._exitWheel.sliceSelectedPathCustom=h._exitWheel.slicePathCustom,h._exitWheel.sliceInitPathCustom=h._exitWheel.slicePathCustom,h._exitWheel.clickModeRotate=!1,h._exitWheel.initWheel(["×"," "]),h._exitWheel.navItems[1].enabled=!1,h._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",h._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",h._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",h._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",h._exitWheel.createWheel(),!m){h._accidentalsWheel.colors=platformColor.accidentalsWheelcolors,h._accidentalsWheel.slicePathFunction=slicePath().DonutSlice,h._accidentalsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),h._accidentalsWheel.slicePathCustom.minRadiusPercent=.5,h._accidentalsWheel.slicePathCustom.maxRadiusPercent=.75,h._accidentalsWheel.sliceSelectedPathCustom=h._accidentalsWheel.slicePathCustom,h._accidentalsWheel.sliceInitPathCustom=h._accidentalsWheel.slicePathCustom;for(var n=[],o=0;o<e.length;o++)n.push(e[o]);for(var s=0;s<9;s++)n.push(null),h._accidentalsWheel.colors.push(platformColor.accidentalsWheelcolorspush);h._accidentalsWheel.animatetime=0,h._accidentalsWheel.createWheel(n),h._accidentalsWheel.setTooltips([_("double sharp"),_("sharp"),_("natural"),_("flat"),_("double flat")])}d&&(h._octavesWheel.colors=platformColor.octavesWheelcolors,h._octavesWheel.slicePathFunction=slicePath().DonutSlice,h._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),h._octavesWheel.slicePathCustom.minRadiusPercent=.75,h._octavesWheel.slicePathCustom.maxRadiusPercent=.95,h._octavesWheel.sliceSelectedPathCustom=h._octavesWheel.slicePathCustom,h._octavesWheel.sliceInitPathCustom=h._octavesWheel.slicePathCustom,h._octavesWheel.animatetime=0,h._octavesWheel.createWheel(["8","7","6","5","4","3","2","1",null,null,null,null,null,null]));var c,W,g=h.container.x,y=h.container.y,p=h.activity.canvas.offsetLeft+28*h.blocks.blockScale,x=h.activity.canvas.offsetTop+6*h.blocks.blockScale,b=(docById("wheelDiv").style.position="absolute",setWheelSize(300),a/2),g=(docById("wheelDiv").style.left=Math.min(h.blocks.turtles._canvas.width-a,Math.max(0,Math.round((g+h.activity.blocksContainer.x)*h.activity.getStageScale()+p)-b))+"px",docById("wheelDiv").style.top=Math.min(h.blocks.turtles._canvas.height-a,Math.max(0,Math.round((y+h.activity.blocksContainer.y)*h.activity.getStageScale()+x)-b))+"px",u.indexOf(t)),f=(v=g=-1===g?m?0:4:g,h._pitchWheel.navigateWheel(g),{A:2,B:1,C:0,D:6,E:5,F:4,G:3}),I={major:1,dorian:2,phrygian:3,lydian:4,mixolydian:5,minor:6,locrian:7}[h.activity.KeySignatureEnv[1]],P=["",SHARP,FLAT];for(W in P){for(var C in NOTENAMES)if(buildScale(NOTENAMES[C]+P[W]+" major")[0][I-1]===h.activity.KeySignatureEnv[0]){c=NOTENAMES[C]+P[W];break}if(void 0!==c)break}for(var S=(S=buildScale(c+" major")[0]).splice(0,S.length-1),k=0;k<f[c[0]];k++)S.push(S.shift());""!==l&&l!==NATURAL||(h.activity.KeySignatureEnv[2]||"solfege"!==h.name)&&("notename"!==h.name||null!=h.connections[0]&&["setkey","setkey2"].includes(h.blocks.blockList[h.connections[0]].name))||(l=(S[6-g][0]===FIXEDSOLFEGE[t]||S[6-g][0]===t?S[6-g]:EQUIVALENTACCIDENTALS[S[6-g]]).substr(1),h.value=h.value.replace(SHARP,"").replace(FLAT,"").replace(DOUBLESHARP,"").replace(DOUBLEFLAT,""),h.value+=l,h.text.text=h.value),m||(p=2,l===DOUBLESHARP?p=0:l===SHARP?p=1:l===NATURAL||""===l?p=2:l===FLAT?p=3:l===DOUBLEFLAT&&(p=4),h._accidentalsWheel.navigateWheel(p)),d&&(a=h.blocks.findPitchOctave(h.connections[0]),h._octavesWheel.navigateWheel(8-a)),i.style.transition="opacity 0.15s ease-in",setTimeout(function(){i.style.opacity="1"},50);for(var D=h,w=(()=>{var e=_asyncToGenerator(_regenerator().m(function e(){var t,l,i,a,n,o,s,c;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,E();case 1:if(D.activity.logo.synth||(console.debug("Creating synth in logo"),D.activity.logo.synth=new Synth),D.activity.logo.synth.tone||D.activity.logo.synth.newTone(),n=D._pitchWheel.navItems[D._pitchWheel.selectedNavItemIndex].title,a=r.indexOf(n),t=0,6<(v=null===v?a:v)+(i=3<(i=a-v)?i-7:i<-3?7+i:i)?t=-1:v+i<0&&(t=1),i=u[v=a],m)e.n=3;else{if(l=D._accidentalsWheel.navItems[D._accidentalsWheel.selectedNavItemIndex].title," "===n)return e.a(2);e.n=2}break;case 2:"♮"!==l&&(i+=l);case 3:if(a=d?Number(D._octavesWheel.navItems[D._octavesWheel.selectedNavItemIndex].title):4,(a+=t)<1?a=1:8<a&&(a=8),d&&0!==t&&(D._octavesWheel.navigateWheel(8-a),D.blocks.setPitchOctave(D.connections[0],a)),n=h.activity.KeySignatureEnv[0]+" "+h.activity.KeySignatureEnv[1],o="scaledegree2"==D.name?(i=i.replace(l,""),i=SOLFEGENAMES[i-1],i+=l,getNote(i,a,0,n,!0,null,D.activity.errorMsg,D.activity.logo.synth.inTemperament)):getNote(i,a,0,n,h.activity.KeySignatureEnv[2],null,D.activity.errorMsg,D.activity.logo.synth.inTemperament),m||(o[0]=o[0].replace(SHARP,"#").replace(FLAT,"b")),instruments[0]&&instruments[0][DEFAULTVOICE]){e.n=7;break}return e.p=4,D.activity.logo.synth.createDefaultSynth(0),e.n=5,D.activity.logo.synth.loadSynth(0,DEFAULTVOICE);case 5:e.n=7;break;case 6:return e.p=6,s=e.v,console.debug("Error initializing synth:",s),e.a(2);case 7:D.activity.logo.synth.tone||D.activity.logo.synth.newTone(),e.p=8,D.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),D.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),e.n=10;break;case 9:return e.p=9,s=e.v,console.debug("Error setting volume:",s),e.a(2);case 10:if(D._triggerLock){e.n=15;break}return D._triggerLock=!0,e.p=11,e.n=12,D.activity.logo.synth.trigger(0,[o[0]+o[1]],1/8,DEFAULTVOICE,null,null,!1);case 12:e.n=14;break;case 13:e.p=13,c=e.v,console.debug("Error triggering note:",c);case 14:return e.p=14,setTimeout(function(){D._triggerLock=!1},125),e.f(14);case 15:e.n=17;break;case 16:e.p=16,c=e.v,console.error("Error in pitch preview:",c);case 17:return e.a(2)}},e,null,[[11,13,14,15],[8,9],[4,6],[0,16]])}));return function(){return e.apply(this,arguments)}})(),E=(()=>{var e=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Tone.start();case 1:console.debug("Audio context started"),e.n=3;break;case 2:e.p=2,t=e.v,console.debug("Error starting audio context:",t);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}})(),N=(()=>{var e=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,E();case 1:return D.activity.logo.synth.tone||D.activity.logo.synth.newTone(),e.n=2,w();case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}})(),M=0;M<u.length;M++)h._pitchWheel.navItems[M].navigateFunction=N;if(!m)for(var A=0;A<e.length;A++)h._accidentalsWheel.navItems[A].navigateFunction=N;if(d)for(var L=0;L<8;L++)h._octavesWheel.navItems[L].navigateFunction=N;h._exitWheel.navItems[0].navigateFunction=function(){D._piemenuExitTime=(new Date).getTime();var e=D._pitchWheel.navItems[D._pitchWheel.selectedNavItemIndex].title,t=!m&&D._accidentalsWheel?D._accidentalsWheel.navItems[D._accidentalsWheel.selectedNavItemIndex].title:"";"♮"===t||""===t?(D.text.text=e,D.value=e):(D.text.text=e+t,D.value=e+t),D.container.setChildIndex(D.text,D.container.children.length-1),D.updateCache(),docById("wheelDiv").style.display="none",D._pitchWheel.removeWheel(),m||D._accidentalsWheel.removeWheel(),D._exitWheel.removeWheel(),d&&D._octavesWheel.removeWheel()}}},piemenuCustomNotes=function(e,t,l,i,a){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";var n,o=null!==e.connections[0]&&["pitch","setpitchnumberoffset","invert1","tofrequency"].includes(e.blocks.blockList[e.connections[0]].name),s=(e._customWheel=new wheelnav("wheelDiv",null,800,800),e._cusNoteWheel=new wheelnav("_cusNoteWheel",e._customWheel.raphael),e._exitWheel=new wheelnav("_exitWheel",e._customWheel.raphael),o&&(e._octavesWheel=new wheelnav("_octavesWheel",e._customWheel.raphael)),wheelnav.cssMode=!0,e._customWheel.keynavigateEnabled=!1,e._customWheel.colors=platformColor.intervalNameWheelcolors,e._customWheel.slicePathFunction=slicePath().DonutSlice,e._customWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._customWheel.slicePathCustom.minRadiusPercent=.1,e._customWheel.slicePathCustom.maxRadiusPercent=.5,e._customWheel.sliceSelectedPathCustom=e._customWheel.slicePathCustom,e._customWheel.sliceInitPathCustom=e._customWheel.slicePathCustom,e._customWheel.titleRotateAngle=0,e._customWheel.animatetime=0,e._customWheel.clickModeRotate=!1,e._customWheel.createWheel(l),e._cusNoteWheel.colors=platformColor.intervalWheelcolors,e._cusNoteWheel.slicePathFunction=slicePath().DonutSlice,e._cusNoteWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._cusNoteWheel.slicePathCustom.minRadiusPercent=.5,e._cusNoteWheel.slicePathCustom.maxRadiusPercent=.85,e._cusNoteWheel.titleFont="100 24px Impact, sans-serif",e._cusNoteWheel.sliceSelectedPathCustom=e._cusNoteWheel.slicePathCustom,e._cusNoteWheel.sliceInitPathCustom=e._cusNoteWheel.slicePathCustom,o&&(e._octavesWheel.colors=platformColor.octavesWheelcolors,e._octavesWheel.slicePathFunction=slicePath().DonutSlice,e._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._octavesWheel.slicePathCustom.minRadiusPercent=.85,e._octavesWheel.slicePathCustom.maxRadiusPercent=1,e._octavesWheel.sliceSelectedPathCustom=e._octavesWheel.slicePathCustom,e._octavesWheel.sliceInitPathCustom=e._octavesWheel.slicePathCustom,e._octavesWheel.animatetime=0,e._octavesWheel.createWheel(["8","7","6","5","4","3","2","1",null,null,null,null,null,null])),e._cusNoteWheel.clickModeRotate=!1,e._cusNoteWheel.titleRotateAngle=180,e._cusNoteWheel.animatetime=0,{}),c=[],h=0,r=0,u=_createForOfIteratorHelper(l);try{for(u.s();!(n=u.n()).done;)var m=n.value,r=r>t[m].pitchNumber?r:t[m].pitchNumber}catch(e){u.e(e)}finally{u.f()}var v,d=_createForOfIteratorHelper(l);try{for(d.s();!(v=d.n()).done;){var W,_=v.value;for(W in s[_]=[],t[_])if("pitchNumber"!==W&&"interval"!==W)if("number"==typeof t[_][W])s[_].push(W),h++;else if(3===t[_][W].length)s[_].push(t[_][W][1]),h++;else for(var g=0;g<t[_][W].length;g++)s[_].push(t[_][W][1]),h++;for(var y=r-h;0<y;y--);h=0}}catch(e){d.e(e)}finally{d.f()}i in s||(i=s[0]);for(var p=0;p<r;p++)p<s[i].length?c.push(s[i][p]):c.push("");e._cusNoteWheel.navAngle=-180/l.length+180/c.length,e._cusNoteWheel.createWheel(c),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.1,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();for(var x,b=e,f=e.container.x,I=e.container.y,P=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,C=e.activity.canvas.offsetTop+6*e.blocks.blockScale,S=(docById("wheelDiv").style.position="absolute",setWheelSize(400),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-400,Math.max(0,Math.round((f+e.activity.blocksContainer.x)*e.activity.getStageScale()+P)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-450,Math.max(0,Math.round((I+e.activity.blocksContainer.y)*e.activity.getStageScale()+C)-200))+"px",o&&(f=e.blocks.findPitchOctave(e.connections[0]),e._octavesWheel.navigateWheel(8-f)),0);S<l.length;S++)(l=>{b._customWheel.navItems[l].navigateFunction=function(){b.customID=b._customWheel.navItems[b._customWheel.selectedNavItemIndex].title,c=[];for(var e=0;e<r;e++)e<s[b._customWheel.navItems[l].title].length?c.push(s[b._customWheel.navItems[l].title][e]):c.push("");for(var t=0;t<c.length;t++)0===c[t].length?b._cusNoteWheel.navItems[t].navItem.hide():(b._cusNoteWheel.navItems[t].title=c[t],b._cusNoteWheel.navItems[t].navItem.title=c[t],b._cusNoteWheel.navItems[t].basicNavTitleMax.title=c[t],b._cusNoteWheel.navItems[t].basicNavTitleMin.title=c[t],b._cusNoteWheel.navItems[t].hoverNavTitleMax.title=c[t],b._cusNoteWheel.navItems[t].hoverNavTitleMin.title=c[t],b._cusNoteWheel.navItems[t].selectedNavTitleMax.title=c[t],b._cusNoteWheel.navItems[t].selectedNavTitleMin.title=c[t],b._cusNoteWheel.navItems[t].initNavTitle.title=c[t],b._cusNoteWheel.navItems[t].navItem.show());b._customWheel.refreshWheel(),b._cusNoteWheel.navigateWheel(0)}})(S);for(x=0;x<l.length&&i!==l[x];x++);x===l.length&&(x=0),e._customWheel.navigateWheel(x);var k,D=a;for(k in t[i])if("pitchNumber"!=k&&t[i][k][1]==D){D=+k;break}"number"!=typeof D||isNaN(D)||e._cusNoteWheel.navigateWheel(r*l.indexOf(i)+D);var w=function(){var e=b._customWheel.navItems[b._customWheel.selectedNavItemIndex].title,t=b._cusNoteWheel.navItems[b._cusNoteWheel.selectedNavItemIndex].title,l=(b.value=t,b.text.text=t,4),l=(o&&(l=Number(b._octavesWheel.navItems[b._octavesWheel.selectedNavItemIndex].title),b.blocks.setPitchOctave(b.connections[0],l)),b.container.setChildIndex(b.text,b.container.children.length-1),b.updateCache(),getNote(t,l,0,"C major",!1,null,b.activity.errorMsg,e));b.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(b.activity.logo.synth.createDefaultSynth(0),b.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),b.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),b.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),b._triggerLock||(b._triggerLock=!0,void 0!==(e=b.activity.logo.synth.getCustomFrequency([t+l[1]],b.customID))&&"undefined"!==e&&instruments[0][DEFAULTVOICE].triggerAttackRelease(e,1/8)),setTimeout(function(){b._triggerLock=!1},125)};if(o)for(var E=0;E<8;E++)e._octavesWheel.navItems[E].navigateFunction=w;for(var N=0;N<c.length;N++)e._cusNoteWheel.navItems[N].navigateFunction=w;e._exitWheel.navItems[0].navigateFunction=function(){b._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none"}}},piemenuNthModalPitch=function(i,a,e){if(e%1!=0&&(e=Math.floor(e+.5)),!i.blocks.stageClick){for(var n=[],t=0;t<a.length;t++)n.push(a[t].toString());n.push(null),docById("wheelDiv").style.display="";for(var l=getPieMenuSize(i),l=(i._pitchWheel=new wheelnav("wheelDiv",null,l,l),i._octavesWheel=new wheelnav("_octavesWheel",i._pitchWheel.raphael),i._exitWheel=new wheelnav("_exitWheel",i._pitchWheel.raphael),wheelnav.cssMode=!0,i._pitchWheel.keynavigateEnabled=!1,i._pitchWheel.colors=platformColor.pitchWheelcolors,i._pitchWheel.slicePathFunction=slicePath().DonutSlice,i._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),i._pitchWheel.slicePathCustom.minRadiusPercent=.35,i._pitchWheel.slicePathCustom.maxRadiusPercent=.72,i._pitchWheel.sliceSelectedPathCustom=i._pitchWheel.slicePathCustom,i._pitchWheel.sliceInitPathCustom=i._pitchWheel.slicePathCustom,i._pitchWheel.animatetime=0,i._pitchWheel.createWheel(n),i._exitWheel.colors=platformColor.exitWheelcolors,i._exitWheel.slicePathFunction=slicePath().DonutSlice,i._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),i._exitWheel.slicePathCustom.minRadiusPercent=0,i._exitWheel.slicePathCustom.maxRadiusPercent=.2,i._exitWheel.sliceSelectedPathCustom=i._exitWheel.slicePathCustom,i._exitWheel.sliceInitPathCustom=i._exitWheel.slicePathCustom,i._exitWheel.clickModeRotate=!1,i._exitWheel.initWheel(["×"," "]),i._exitWheel.navItems[1].enabled=!1,i._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",i._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",i._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",i._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",i._exitWheel.createWheel(),i._octavesWheel.colors=platformColor.octavesWheelcolors,i._octavesWheel.slicePathFunction=slicePath().DonutSlice,i._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),i._octavesWheel.slicePathCustom.minRadiusPercent=.8,i._octavesWheel.slicePathCustom.maxRadiusPercent=1,i._octavesWheel.sliceSelectedPathCustom=i._octavesWheel.slicePathCustom,i._octavesWheel.sliceInitPathCustom=i._octavesWheel.slicePathCustom,i._octavesWheel.animatetime=0,i._octavesWheel.createWheel(["8","7","6","5","4","3","2","1",null,null,null,null,null,null]),docById("labelDiv")),l=(l.innerHTML='<input id="numberLabel" style="position: absolute; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text;" class="number" type="number" value="'.concat(e,'" />'),l.classList.add("hasKeyboard"),i.label=docById("numberLabel"),i.label.addEventListener("keypress",i._exitKeyPressed.bind(i)),i.container.x),o=i.container.y,s=i.activity.canvas.offsetLeft+28*i.blocks.blockScale,c=i.activity.canvas.offsetTop+6*i.blocks.blockScale,l=(docById("wheelDiv").style.position="absolute",setWheelSize(300),Math.round((l+i.activity.blocksContainer.x)*i.activity.getStageScale()+s)),s=Math.round((o+i.activity.blocksContainer.y)*i.activity.getStageScale()+c),o=(i.label.style.left=l+"px",i.label.style.top=s+"px",docById("wheelDiv").style.left=Math.min(Math.max(l-75,0),i.blocks.turtles._canvas.width-300)+"px",docById("wheelDiv").style.top=s-300<0?s+40+"px":s-300+"px",i.label.style.width=Math.round(150*i.blocks.blockScale)*i.protoblock.scale/2+"px",i.label.style.fontSize=Math.round(20*i.blocks.blockScale*i.protoblock.scale/2)+"px",a.indexOf(e)),c=(i._pitchWheel.navigateWheel(o),i.blocks.findPitchOctave(i.connections[0])),h=(i._octavesWheel.navigateWheel(8-c),i),r=(i.label.addEventListener("change",function(){h._labelChanged(!1,!1)}),function(){var e=h._pitchWheel.navItems[h._pitchWheel.selectedNavItemIndex].title,e=n.indexOf(e),t=0,l=(7==n[e]?t=1:n[e]<0&&(t=-1),Number(h._octavesWheel.navItems[h._octavesWheel.selectedNavItemIndex].title)),t=((l+=t)<1?l=1:8<l&&(l=8),i.activity.KeySignatureEnv[0]+" "+i.activity.KeySignatureEnv[1]),t=0<=a[e]?nthDegreeToPitch(t,a[e]):nthDegreeToPitch(t,7+a[e]);h.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(h.activity.logo.synth.createDefaultSynth(0),h.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),h.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),h.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),h._triggerLock||(h._triggerLock=!0,h.activity.logo.synth.trigger(0,[t.replace(SHARP,"#").replace(FLAT,"b")+l],1/8,DEFAULTVOICE,null,null)),setTimeout(function(){h._triggerLock=!1},125),e=h._pitchWheel.navItems[h._pitchWheel.selectedNavItemIndex].title,t=n.indexOf(e),h.value=a[t],h.text.text=e,h.container.setChildIndex(h.text,h.container.children.length-1),h.updateCache(),t=Number(h._octavesWheel.navItems[h._octavesWheel.selectedNavItemIndex].title),h.blocks.setPitchOctave(h.connections[0],t)}),u=0;u<a.length;u++)i._pitchWheel.navItems[u].navigateFunction=r;for(var m=0;m<8;m++)i._octavesWheel.navItems[m].navigateFunction=r;i._exitWheel.navItems[0].navigateFunction=function(){h._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",h._pitchWheel.removeWheel(),h._exitWheel.removeWheel(),h._octavesWheel.removeWheel()}}},piemenuAccidentals=function(e,t,l,i){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";for(var a=getPieMenuSize(e),n=(e._accidentalWheel=new wheelnav("wheelDiv",null,a,a),e._exitWheel=new wheelnav("_exitWheel",e._accidentalWheel.raphael),[]),o=0;o<t.length;o++)n.push(last(t[o].split(" ")));n.push(null),wheelnav.cssMode=!0,e._accidentalWheel.keynavigateEnabled=!1,e._accidentalWheel.colors=platformColor.accidentalsWheelcolors,e._accidentalWheel.slicePathFunction=slicePath().DonutSlice,e._accidentalWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._accidentalWheel.slicePathCustom.minRadiusPercent=.2,e._accidentalWheel.slicePathCustom.maxRadiusPercent=.6,e._accidentalWheel.sliceSelectedPathCustom=e._accidentalWheel.slicePathCustom,e._accidentalWheel.sliceInitPathCustom=e._accidentalWheel.slicePathCustom,e._accidentalWheel.titleRotateAngle=0,e._accidentalWheel.animatetime=0,e._accidentalWheel.createWheel(n),e._accidentalWheel.setTooltips(t),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var s=e,c=function(){s._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",s._accidentalWheel.removeWheel(),s._exitWheel.removeWheel()},a=e.container.x,h=e.container.y,r=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,u=e.activity.canvas.offsetTop+6*e.blocks.blockScale,a=(docById("wheelDiv").style.position="absolute",setWheelSize(300),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-300,Math.max(0,Math.round((a+e.activity.blocksContainer.x)*e.activity.getStageScale()+r)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-350,Math.max(0,Math.round((h+e.activity.blocksContainer.y)*e.activity.getStageScale()+u)-200))+"px",l.indexOf(i));e._accidentalWheel.navigateWheel(a=-1===a?2:a);for(var m=0;m<t.length;m++)e._accidentalWheel.navItems[m].navigateFunction=function(){var e;e=s._accidentalWheel.navItems[s._accidentalWheel.selectedNavItemIndex].title,e=n.indexOf(e),s.value=l[e],s.text.text=t[e],s.container.setChildIndex(s.text,s.container.children.length-1),s.updateCache(),c()};e._exitWheel.navItems[0].navigateFunction=function(){c()}}},piemenuNoteValue=function(e,t){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";for(var i=[3,2,7,5],a={2:[1,2,4,8,16,32],3:[1,3,6,9,12,27],5:[1,5,10,15,20,25],7:[1,7,14,21,28,35]},l=e.connections[0],l=(null!==l&&null!==(l=e.blocks.blockList[l].connections[0])&&["neighbor","neighbor2"].includes(e.blocks.blockList[l].name)&&(a={2:[8,16,32,64],3:[9,12,27,54],5:[10,15,20,25],7:[14,21,28,35]}),getPieMenuSize(e)),n=(e._noteValueWheel=new wheelnav("wheelDiv",null,l,l),e._exitWheel=new wheelnav("_exitWheel",e._noteValueWheel.raphael),e._tabsWheel=new wheelnav("_tabsWheel",e._noteValueWheel.raphael),[]),o=0;o<i.length;o++)n.push(i[o].toString());wheelnav.cssMode=!0,e._noteValueWheel.keynavigateEnabled=!1,e._noteValueWheel.colors=platformColor.noteValueWheelcolors,e._noteValueWheel.slicePathFunction=slicePath().DonutSlice,e._noteValueWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._noteValueWheel.slicePathCustom.minRadiusPercent=.2,e._noteValueWheel.slicePathCustom.maxRadiusPercent=.6,e._noteValueWheel.sliceSelectedPathCustom=e._noteValueWheel.slicePathCustom,e._noteValueWheel.sliceInitPathCustom=e._noteValueWheel.slicePathCustom,e._noteValueWheel.animatetime=0,e._noteValueWheel.clickModeRotate=!1,e._noteValueWheel.createWheel(n),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();for(var s=[],c=0;c<i.length;c++)for(var h=0;h<a[i[c]].length;h++)s.push(a[i[c]][h].toString());e._tabsWheel.colors=platformColor.tabsWheelcolors,e._tabsWheel.slicePathFunction=slicePath().DonutSlice,e._tabsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._tabsWheel.slicePathCustom.minRadiusPercent=.6,e._tabsWheel.slicePathCustom.maxRadiusPercent=.8,e._tabsWheel.sliceSelectedPathCustom=e._tabsWheel.slicePathCustom,e._tabsWheel.sliceInitPathCustom=e._tabsWheel.slicePathCustom,e._tabsWheel.clickModeRotate=!1,e._tabsWheel.navAngle=-180/i.length+180/(i.length*a[i[0]].length),e._tabsWheel.createWheel(s);for(var r=e,u=function(){r._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",r._noteValueWheel.removeWheel(),r._exitWheel.removeWheel(),r.label.style.display="none",null!==r._check_meter_block&&r.blocks.meter_block_changed(r._check_meter_block)},m=docById("labelDiv"),m=(m.innerHTML='<input id="numberLabel" style="position: absolute; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text;" class="number" type="number" value="'.concat(t,'" />'),m.classList.add("hasKeyboard"),e.label=docById("numberLabel"),e.label.addEventListener("keypress",e._exitKeyPressed.bind(e)),e.label.addEventListener("change",function(){r._labelChanged(!1,!1)}),e.container.x),v=e.container.y,d=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,W=e.activity.canvas.offsetTop+6*e.blocks.blockScale,_=(docById("wheelDiv").style.position="absolute",setWheelSize(300),l/2),m=Math.round((m+e.activity.blocksContainer.x)*e.activity.getStageScale()+d),d=Math.round((v+e.activity.blocksContainer.y)*e.activity.getStageScale()+W),g=(e.label.style.left=m+"px",e.label.style.top=d+"px",docById("wheelDiv").style.left=Math.min(Math.max(m-(_-75),0),e.blocks.turtles._canvas.width-l)+"px",docById("wheelDiv").style.top=d-l<0?d+40+"px":d-l+"px",e.label.style.width=Math.round(150*e.blocks.blockScale)*e.protoblock.scale/2+"px",function(){for(var e=0;e<i.length;e++)for(var t=0;t<a[i[0]].length;t++){var l=e*a[i[0]].length;r._noteValueWheel.selectedNavItemIndex===e?r._tabsWheel.navItems[l+t].navItem.show():r._tabsWheel.navItems[l+t].navItem.hide()}}),y=0;y<n.length;y++)e._noteValueWheel.navItems[y].navigateFunction=g;if(1===t)e._noteValueWheel.navigateWheel(1),e._tabsWheel.navigateWheel(0);else{for(var p=0;p<i.length;p++){for(var x=void 0,x=0;x<a[i[p]].length;x++)if(a[i[p]][x]===t){e._noteValueWheel.navigateWheel(p),e._tabsWheel.navigateWheel(p*a[i[p]].length+x);break}if(x<a[i[p]].length)break}p===i.length&&(e._noteValueWheel.navigateWheel(1),e._tabsWheel.navigateWheel(2))}e.label.style.fontSize=Math.round(20*e.blocks.blockScale*e.protoblock.scale/2)+"px",e.label.style.display="",e.label.focus();for(var b=0;b<s.length;b++)e._tabsWheel.navItems[b].navigateFunction=function(){r.text.text=r._tabsWheel.navItems[r._tabsWheel.selectedNavItemIndex].title,r.value=Number(r.text.text),r.container.setChildIndex(r.text,r.container.children.length-1),r.updateCache(),u()};e._exitWheel.navItems[0].navigateFunction=function(){u()}}},piemenuNumber=function(e,t,l){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";for(var i=getPieMenuSize(e),a=(e._numberWheel=new wheelnav("wheelDiv",null,i,i),e._exitWheel=new wheelnav("_exitWheel",e._numberWheel.raphael),[]),n=0;n<t.length;n++)a.push(t[n].toString());if(a.push(null),wheelnav.cssMode=!0,e._numberWheel.keynavigateEnabled=!1,e._numberWheel.colors=platformColor.numberWheelcolors,e._numberWheel.slicePathFunction=slicePath().DonutSlice,e._numberWheel.slicePathCustom=slicePath().DonutSliceCustomization(),16<t.length?(e._numberWheel.slicePathCustom.minRadiusPercent=.6,e._numberWheel.slicePathCustom.maxRadiusPercent=1):10<t.length?(e._numberWheel.slicePathCustom.minRadiusPercent=.5,e._numberWheel.slicePathCustom.maxRadiusPercent=.9):(e._numberWheel.slicePathCustom.minRadiusPercent=.2,e._numberWheel.slicePathCustom.maxRadiusPercent=.6),e._numberWheel.sliceSelectedPathCustom=e._numberWheel.slicePathCustom,e._numberWheel.sliceInitPathCustom=e._numberWheel.slicePathCustom,"setbpm3"===e.blocks.blockList[e.connections[0]].name||"setmasterbpm2"===e.blocks.blockList[e.connections[0]].name?(e._numberWheel.titleRotateAngle=0,l=90===l?90:l<40?40:l<60?2*Math.floor(e.value/2):l<72?3*Math.floor(e.value/3):l<120?4*Math.floor(e.value/4):l<144?6*Math.floor(e.value/6):l<208?8*Math.floor(e.value/8):208):"setheading"===e.blocks.blockList[e.connections[0]].name&&(e._numberWheel.navAngle=-90),e._numberWheel.animatetime=0,e._numberWheel.createWheel(a),20<e._numberWheel.navItems.length)for(var o=0;o<e._numberWheel.navItems.length;o++)e._numberWheel.navItems[o].titleAttr.font="30 30px sans-serif",e._numberWheel.navItems[o].titleSelectedAttr.font="30 30px sans-serif";e._exitWheel.colors=platformColor.exitWheelcolors2,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×","-","+"]),e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.navItems[1].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[1].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[1].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[1].titleHoverAttr.cursor="pointer",e._exitWheel.navItems[2].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[2].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[2].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[2].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var s=e,c=function(){s.value=t[s._numberWheel.selectedNavItemIndex],s.text.text=a[s._numberWheel.selectedNavItemIndex],s.container.setChildIndex(s.text,s.container.children.length-1),s.updateCache()},h=function(){s._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",s._numberWheel.removeWheel(),s._exitWheel.removeWheel(),s.label.style.display="none",null!==s._check_meter_block&&s.blocks.meter_block_changed(s._check_meter_block)},i=docById("labelDiv"),i=(i.innerHTML='<input id="numberLabel" style="position: absolute; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text;" class="number" type="number" value="'.concat(l,'" />'),i.classList.add("hasKeyboard"),e.label=docById("numberLabel"),e.label.addEventListener("keypress",e._exitKeyPressed.bind(e)),e.label.addEventListener("change",function(){s._labelChanged(!1,!1)}),e.container.x),r=e.container.y,u=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,m=e.activity.canvas.offsetTop+6*e.blocks.blockScale,i=(docById("wheelDiv").style.position="absolute",setWheelSize(300),Math.round((i+e.activity.blocksContainer.x)*e.activity.getStageScale()+u)),u=Math.round((r+e.activity.blocksContainer.y)*e.activity.getStageScale()+m),r=(e.label.style.left=i+"px",e.label.style.top=u+"px",docById("wheelDiv").style.left=Math.min(Math.max(i-75,0),e.blocks.turtles._canvas.width-300)+"px",docById("wheelDiv").style.top=u-300<0?u+40+"px":u-300+"px",e.label.style.width=Math.round(150*e.blocks.blockScale)*e.protoblock.scale/2+"px",t.indexOf(l));(-1===r||l<1||8<l)&&(l=Math.min(Math.max(l,1),8),r=t.indexOf(l)),l%1!=0&&(l=Math.min(Math.max(Math.floor(l+.5),1),8),r=t.indexOf(l)),-1!==r&&e._numberWheel.navigateWheel(r),e.label.style.fontSize=Math.round(20*e.blocks.blockScale*e.protoblock.scale/2)+"px",e.label.style.display="",e.label.focus();for(var v=0;v<a.length;v++)e._numberWheel.navItems[v].navigateFunction=function(){c(),h()};e._exitWheel.navItems[0].navigateFunction=function(){h()},e._exitWheel.navItems[1].navigateFunction=function(){var e=s.connections[0];null!=(e=s.blocks.blockList[e])&&e.connections[0];1<s.value&&--s.value,s.text.text=s.value.toString(),s.container.setChildIndex(s.text,s.container.children.length-1),s.updateCache(),s.label.value=s.value},e._exitWheel.navItems[2].navigateFunction=function(){s.connections[0];s.value<8&&(s.value+=1),s.text.text=s.value.toString(),s.container.setChildIndex(s.text,s.container.children.length-1),s.updateCache(),s.label.value=s.value};var d=function(){var e=s._numberWheel.navItems[s._numberWheel.selectedNavItemIndex].title,e=a.indexOf(e),e=numberToPitch(t[e]+3);s.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(s.activity.logo.synth.createDefaultSynth(0),s.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),s.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),s.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),e[0]=e[0].replace(SHARP,"#").replace(FLAT,"b"),s._triggerLock||(s._triggerLock=!0,s.activity.logo.synth.trigger(0,e[0]+(e[1]+3),1/8,DEFAULTVOICE,null,null)),setTimeout(function(){s._triggerLock=!1},125),c()},W=function(){var e=s._numberWheel.navItems[s._numberWheel.selectedNavItemIndex].title,e=a.indexOf(e),e=frequencyToPitch(t[e]);s.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(s.activity.logo.synth.createDefaultSynth(0),s.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),s.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),s.activity.logo.synth.setVolume(0,DEFAULTVOICE,PREVIEWVOLUME),e[0]=e[0].replace(SHARP,"#").replace(FLAT,"b"),s._triggerLock||(s._triggerLock=!0,s.activity.logo.synth.trigger(0,e[0]+e[1],1/8,DEFAULTVOICE,null,null)),setTimeout(function(){s._triggerLock=!1},125),c()};if(e._usePieNumberC1()&&"pitchnumber"===e.blocks.blockList[e.connections[0]].name)for(var _=0;_<t.length;_++)e._numberWheel.navItems[_].navigateFunction=d;if(e._usePieNumberC1()&&"hertz"===e.blocks.blockList[e.connections[0]].name)for(var g=0;g<t.length;g++)e._numberWheel.navItems[g].navigateFunction=W}},piemenuColor=function(e,t,l,i){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";for(var a=getPieMenuSize(e),n=(e._numberWheel=new wheelnav("wheelDiv",null,a,a),e._exitWheel=new wheelnav("_exitWheel",e._numberWheel.raphael),[]),o=0;o<t.length;o++)n.push(t[o].toString());if(wheelnav.cssMode=!0,e._numberWheel.keynavigateEnabled=!1,e._numberWheel.colors=[],"setcolor"===i||"setturtlecolor"===i)for(var s=0;s<t.length;s++)e._numberWheel.colors.push(COLORS40[Math.floor(t[s]/2.5)][2]);else if("sethue"===i)for(var c=0;c<t.length;c++)e._numberWheel.colors.push(getMunsellColor(t[c],50,50));else{if("setshade"===i)for(var h=0;h<t.length;h++)e._numberWheel.colors.push(getMunsellColor(0,t[h],0));else if("settranslucency"===i)for(var r=0;r<t.length;r++)e._numberWheel.colors.push(getMunsellColor(35,70,100-t[r]));else for(var u=0;u<t.length;u++)e._numberWheel.colors.push(getMunsellColor(60,60,t[u]));for(var m=0;m<t.length;m++)n.push(null)}e._numberWheel.slicePathFunction=slicePath().DonutSlice,e._numberWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._numberWheel.slicePathCustom.minRadiusPercent=.6,e._numberWheel.slicePathCustom.maxRadiusPercent=1,e._numberWheel.sliceSelectedPathCustom=e._numberWheel.slicePathCustom,e._numberWheel.sliceInitPathCustom=e._numberWheel.slicePathCustom,e._numberWheel.animatetime=0,e._numberWheel.createWheel(n),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var v=e,d=function(){v._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",v._numberWheel.removeWheel(),v._exitWheel.removeWheel(),v.label.style.display="none"},a=docById("labelDiv"),i=(a.innerHTML='<input id="numberLabel" style="position: absolute; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text;" class="number" type="number" value="'.concat(l,'" />'),a.classList.add("hasKeyboard"),e.label=docById("numberLabel"),e.label.addEventListener("keypress",e._exitKeyPressed.bind(e)),e.label.addEventListener("change",function(){v._labelChanged(!1,!1)}),e.container.x),a=e.container.y,W=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,_=e.activity.canvas.offsetTop+6*e.blocks.blockScale,i=(docById("wheelDiv").style.position="absolute",setWheelSize(300),Math.round((i+e.activity.blocksContainer.x)*e.activity.getStageScale()+W)),W=Math.round((a+e.activity.blocksContainer.y)*e.activity.getStageScale()+_),a=(e.label.style.left=i+"px",e.label.style.top=W+"px",docById("wheelDiv").style.left=Math.min(Math.max(i-75,0),e.blocks.turtles._canvas.width-300)+"px",docById("wheelDiv").style.top=W-300<0?W+40+"px":W-300+"px",e.label.style.width=Math.round(150*e.blocks.blockScale)*e.protoblock.scale/2+"px",t.indexOf(l));e._numberWheel.navigateWheel(a=-1===a?0:a),e.label.style.fontSize=Math.round(20*e.blocks.blockScale*e.protoblock.scale/2)+"px",e.label.style.display="",e.label.focus();for(var g=0;g<n.length;g++)e._numberWheel.navItems[g].navigateFunction=function(){v.value=t[v._numberWheel.selectedNavItemIndex],v.text.text=n[v._numberWheel.selectedNavItemIndex],v.container.setChildIndex(v.text,v.container.children.length-1),v.updateCache(),d()};e._exitWheel.navItems[0].navigateFunction=function(){d()}}},piemenuBasic=function(e,t,l,i,a){if(!e.blocks.stageClick){void 0===a&&(a=platformColor.piemenuBasicundefined),docById("wheelDiv").style.display="";for(var n=800,o=("outputtools"===e.name||"grid"===e.name?n=1e3:"temperamentname"===e.name&&(n=1200),e._basicWheel=new wheelnav("wheelDiv",null,n,n),e._exitWheel=new wheelnav("_exitWheel",e._basicWheel.raphael),[]),s=0;s<t.length;s++)o.push(t[s]);wheelnav.cssMode=!0,e._basicWheel.keynavigateEnabled=!1,e._basicWheel.colors=a,e._basicWheel.slicePathFunction=slicePath().DonutSlice,e._basicWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._basicWheel.slicePathCustom.minRadiusPercent=.2,e._basicWheel.slicePathCustom.maxRadiusPercent=1,e._basicWheel.sliceSelectedPathCustom=e._basicWheel.slicePathCustom,e._basicWheel.sliceInitPathCustom=e._basicWheel.slicePathCustom,e._basicWheel.animatetime=0,"wrapmode"!==e.name&&(e._basicWheel.titleRotateAngle=0),e._basicWheel.createWheel(o),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var c=e,h=function(){c._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",c._basicWheel.removeWheel()},n=e.container.x,a=e.container.y,r=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,u=e.activity.canvas.offsetTop+6*e.blocks.blockScale,n=(docById("wheelDiv").style.position="absolute",setWheelSize(300),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-300,Math.max(0,Math.round((n+e.activity.blocksContainer.x)*e.activity.getStageScale()+r)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-350,Math.max(0,Math.round((a+e.activity.blocksContainer.y)*e.activity.getStageScale()+u)-200))+"px",l.indexOf(i));e._basicWheel.navigateWheel(n=-1===n?1:n);for(var m=0;m<t.length;m++)e._basicWheel.navItems[m].navigateFunction=function(){var e;e=c._basicWheel.navItems[c._basicWheel.selectedNavItemIndex].title,e=o.indexOf(e),"outputtools"===c.name?(c.overrideName=l[e],c.privateData=l[e]):c.value=l[e],c.text.text=t[e],c.container.setChildIndex(c.text,c.container.children.length-1),c.updateCache(),h()};e._exitWheel.navItems[0].navigateFunction=function(){h()}}},piemenuBoolean=function(e,t,l,i){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";for(var a=getPieMenuSize(e),n=(e._booleanWheel=new wheelnav("wheelDiv",null,a,a),[]),o=0;o<t.length;o++)n.push(t[o]);wheelnav.cssMode=!0,e._booleanWheel.keynavigateEnabled=!1,e._booleanWheel.colors=platformColor.booleanWheelcolors,e._booleanWheel.slicePathFunction=slicePath().DonutSlice,e._booleanWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._booleanWheel.slicePathCustom.minRadiusPercent=0,e._booleanWheel.slicePathCustom.maxRadiusPercent=.6,e._booleanWheel.sliceSelectedPathCustom=e._booleanWheel.slicePathCustom,e._booleanWheel.sliceInitPathCustom=e._booleanWheel.slicePathCustom,e._booleanWheel.animatetime=0,e._booleanWheel.createWheel(n);var s=e,c=function(){var e=s._booleanWheel.navItems[s._booleanWheel.selectedNavItemIndex].title,e=n.indexOf(e);s.value=l[e],s.text.text=t[e],s.container.setChildIndex(s.text,s.container.children.length-1),s.updateCache()},h=function(){s._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",s._booleanWheel.removeWheel()},a=e.container.x,r=e.container.y,u=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,m=e.activity.canvas.offsetTop+6*e.blocks.blockScale,a=(docById("wheelDiv").style.position="absolute",setWheelSize(300),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-300,Math.max(0,Math.round((a+e.activity.blocksContainer.x)*e.activity.getStageScale()+u)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-350,Math.max(0,Math.round((r+e.activity.blocksContainer.y)*e.activity.getStageScale()+m)-200))+"px",l.indexOf(i));e._booleanWheel.navigateWheel(a=-1===a?0:a),e._booleanWheel.navItems[0].navigateFunction=function(){c(),h()},e._booleanWheel.navItems[1].navigateFunction=function(){c(),h()}}},piemenuChords=function(e,t){if(!e.blocks.stageClick){docById("wheelDiv").style.display="",e._chordWheel=new wheelnav("wheelDiv",null,1e3,1e3),e._exitWheel=new wheelnav("_exitWheel",e._chordWheel.raphael);for(var l=[],i=0;i<CHORDNAMES.length;i++){var a=_(CHORDNAMES[i]);0===a.length?l.push(CHORDNAMES[i]):l.push(a)}wheelnav.cssMode=!0,e._chordWheel.keynavigateEnabled=!1,e._chordWheel.colors=platformColor.modeWheelcolors,e._chordWheel.slicePathFunction=slicePath().DonutSlice,e._chordWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._chordWheel.slicePathCustom.minRadiusPercent=.2,e._chordWheel.slicePathCustom.maxRadiusPercent=1,e._chordWheel.sliceSelectedPathCustom=e._chordWheel.slicePathCustom,e._chordWheel.sliceInitPathCustom=e._chordWheel.slicePathCustom,e._chordWheel.titleRotateAngle=0,e._chordWheel.animatetime=0,e._chordWheel.createWheel(l);for(var n=0;n<e._chordWheel.navItems.length;n++)e._chordWheel.navItems[n].titleAttr.font="32 32px sans-serif",e._chordWheel.navItems[n].titleSelectedAttr.font="32 32px sans-serif";e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var o=e,s=function(){o._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",o._chordWheel.removeWheel()},c=e.container.x,h=e.container.y,r=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,u=e.activity.canvas.offsetTop+6*e.blocks.blockScale,c=(docById("wheelDiv").style.position="absolute",setWheelSize(400),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-300,Math.max(0,Math.round((c+e.activity.blocksContainer.x)*e.activity.getStageScale()+r)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-350,Math.max(0,Math.round((h+e.activity.blocksContainer.y)*e.activity.getStageScale()+u)-200))+"px",l.indexOf(t));e._chordWheel.navigateWheel(c=-1===c?0:c),enableWheelScroll(e._chordWheel,l.length);for(var m=0;m<l.length;m++)e._chordWheel.navItems[m].navigateFunction=function(){o.text.text=o._chordWheel.navItems[o._chordWheel.selectedNavItemIndex].title,o.value=CHORDNAMES[o._chordWheel.selectedNavItemIndex],o.container.setChildIndex(o.text,o.container.children.length-1),o.updateCache(),s()};e._exitWheel.navItems[0].navigateFunction=function(){s()}}},piemenuVoices=function(e,i,a,t,l,n){if(!e.blocks.stageClick){for(var o=platformColor.piemenuVoicesColors,s=[],c=0;c<i.length;c++)s.push(o[t[c]%o.length]);docById("wheelDiv").style.display="","kana"===localStorage.kanaPreference?e._voiceWheel=new wheelnav("wheelDiv",null,1200,1200):e._voiceWheel=new wheelnav("wheelDiv",null,800,800),e._exitWheel=new wheelnav("_exitWheel",e._voiceWheel.raphael),wheelnav.cssMode=!0,e._voiceWheel.keynavigateEnabled=!1,e._voiceWheel.colors=s,e._voiceWheel.slicePathFunction=slicePath().DonutSlice,e._voiceWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._voiceWheel.slicePathCustom.minRadiusPercent=.2,e._voiceWheel.slicePathCustom.maxRadiusPercent=1,e._voiceWheel.sliceSelectedPathCustom=e._voiceWheel.slicePathCustom,e._voiceWheel.sliceInitPathCustom=e._voiceWheel.slicePathCustom,e._voiceWheel.titleRotateAngle=void 0===n?0:n,e._voiceWheel.animatetime=0,e._voiceWheel.createWheel(i);for(var h=0;h<e._voiceWheel.navItems.length;h++)e._voiceWheel.navItems[h].titleAttr.font="30 30px sans-serif",e._voiceWheel.navItems[h].titleSelectedAttr.font="30 30px sans-serif";e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var r=e,u=function(){var e=r._voiceWheel.navItems[r._voiceWheel.selectedNavItemIndex].title,e=i.indexOf(e),t=a[e],e=0,l=r.activity.turtles.ithTurtle(0);l.singer.instrumentNames.includes(t)||(l.singer.instrumentNames.push(t),t===DEFAULTVOICE&&r.activity.logo.synth.createDefaultSynth(0),r.activity.logo.synth.loadSynth(0,t),e=500),setTimeout(function(){Singer.setSynthVolume(r.activity.logo,0,t,DEFAULTVOLUME),r.activity.logo.synth.trigger(0,"G4",.25,t,null,null,!1),r.activity.logo.synth.start()},e),l=r._voiceWheel.navItems[r._voiceWheel.selectedNavItemIndex].title,e=i.indexOf(l),r.value=a[e],r.text.text=l,null===getDrumName(r.value)?r.activity.logo.synth.loadSynth(0,getVoiceSynthName(r.value)):r.activity.logo.synth.loadSynth(0,getDrumSynthName(r.value)),r.container.setChildIndex(r.text,r.container.children.length-1),r.updateCache()},n=e.container.x,m=e.container.y,v=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,d=e.activity.canvas.offsetTop+6*e.blocks.blockScale,n=(docById("wheelDiv").style.position="absolute",setWheelSize(400),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-400,Math.max(0,Math.round((n+e.activity.blocksContainer.x)*e.activity.getStageScale()+v)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-450,Math.max(0,Math.round((m+e.activity.blocksContainer.y)*e.activity.getStageScale()+d)-200))+"px",a.indexOf(l));e._voiceWheel.navigateWheel(n=-1===n?0:n),enableWheelScroll(e._voiceWheel,i.length);for(var W=0;W<a.length;W++)e._voiceWheel.navItems[W].navigateFunction=u;e._exitWheel.navItems[0].navigateFunction=function(){r._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none"}}},piemenuIntervals=function(e,t){if(!e.blocks.stageClick){docById("wheelDiv").style.display="";for(var l=localStorage.languagePreference,a=(e._intervalNameWheel="ja"===l?new wheelnav("wheelDiv",null,1500,1500):new wheelnav("wheelDiv",null,800,800),e._intervalWheel=new wheelnav("block._intervalWheel",e._intervalNameWheel.raphael),e._exitWheel=new wheelnav("_exitWheel",e._intervalNameWheel.raphael),wheelnav.cssMode=!0,e._intervalNameWheel.keynavigateEnabled=!1,e._intervalNameWheel.colors=platformColor.intervalNameWheelcolors,e._intervalNameWheel.slicePathFunction=slicePath().DonutSlice,e._intervalNameWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._intervalNameWheel.slicePathCustom.minRadiusPercent=.2,e._intervalNameWheel.slicePathCustom.maxRadiusPercent=.8,e._intervalNameWheel.sliceSelectedPathCustom=e._intervalNameWheel.slicePathCustom,e._intervalNameWheel.sliceInitPathCustom=e._intervalNameWheel.slicePathCustom,e._intervalNameWheel.titleRotateAngle=0,e._intervalNameWheel.clickModeRotate=!1,[]),i=0;i<INTERVALS.length;i++)a.push(_(INTERVALS[i][1]));e._intervalNameWheel.animatetime=0,e._intervalNameWheel.createWheel(a),e._intervalWheel.colors=platformColor.intervalWheelcolors,e._intervalWheel.slicePathFunction=slicePath().DonutSlice,e._intervalWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._intervalWheel.slicePathCustom.minRadiusPercent=.8,e._intervalWheel.slicePathCustom.maxRadiusPercent=1,e._intervalWheel.sliceSelectedPathCustom=e._intervalWheel.slicePathCustom,e._intervalWheel.sliceInitPathCustom=e._intervalWheel.slicePathCustom,e._intervalWheel.clickModeRotate=!1,e._intervalWheel.navAngle=-180/a.length+180/(8*a.length);for(var n=[],o=e._intervalWheel.animatetime=0;o<INTERVALS.length;o++)for(var s=1;s<9;s++)n.push(s.toString());e._intervalWheel.createWheel(n),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.2,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×"," "]),e._exitWheel.navItems[1].enabled=!1,e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();for(var c=e,l=e.container.x,h=e.container.y,r=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,u=e.activity.canvas.offsetTop+6*e.blocks.blockScale,m=(docById("wheelDiv").style.position="absolute",setWheelSize(400),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-400,Math.max(0,Math.round((l+e.activity.blocksContainer.x)*e.activity.getStageScale()+r)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-450,Math.max(0,Math.round((h+e.activity.blocksContainer.y)*e.activity.getStageScale()+u)-200))+"px",0);m<INTERVALS.length;m++)((l,i)=>{c._intervalNameWheel.navItems[l].navigateFunction=function(){for(var e=0;e<a.length;e++)for(var t=0;t<8;t++)e===l&&i.includes(t+1)?c._intervalWheel.navItems[8*e+t].navItem.show():c._intervalWheel.navItems[8*e+t].navItem.hide()}})(m,INTERVALS[m][2]);for(var v=t.split(" "),d=0;d<INTERVALS.length&&v[0]!==INTERVALS[d][1];d++);d===INTERVALS.length&&(d=0),e._intervalNameWheel.navigateWheel(d),enableWheelScroll(e._intervalNameWheel,a.length);for(var l=Number(v[1]),W=(INTERVALS[d][2].includes(l)?e._intervalWheel.navigateWheel(l-1):e._intervalWheel.navigateWheel(INTERVALS[d][2][0]-1),function(){var e=c._intervalNameWheel.navItems[c._intervalNameWheel.selectedNavItemIndex].title,t=c._intervalWheel.navItems[c._intervalWheel.selectedNavItemIndex].title,e=(c.value=INTERVALS[c._intervalNameWheel.selectedNavItemIndex][1]+" "+t,c.text.text="perfect 1"===e?_("unison"):e+" "+t,c.container.setChildIndex(c.text,c.container.children.length-1),c.updateCache(),getNote("C",4,INTERVALVALUES[c.value][0],"C major",!1,null,null));e[0]=e[0].replace(SHARP,"#").replace(FLAT,"b"),c.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(c.activity.logo.synth.createDefaultSynth(0),c.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),c.activity.logo.synth.setMasterVolume(DEFAULTVOLUME),Singer.setSynthVolume(c.activity.logo,0,DEFAULTVOICE,DEFAULTVOLUME),c._triggerLock||(c._triggerLock=!0,c.activity.logo.synth.trigger(0,["C4",e[0]+e[1]],1/8,DEFAULTVOICE,null,null)),setTimeout(function(){c._triggerLock=!1},125)}),g=0;g<8*a.length;g++)e._intervalWheel.navItems[g].navigateFunction=W;e._exitWheel.navItems[0].navigateFunction=function(){c._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none"}}},piemenuModes=function(e,g){if(!e.blocks.stageClick){var t,l="C",y="7",i=!1,a=e.connections[0],n=(null!==a&&"setkey2"===e.blocks.blockList[a].name&&null!==(a=e.blocks.blockList[a].connections[1])&&"notename"===e.blocks.blockList[a].name&&(l=e.blocks.blockList[a].value),docById("wheelDiv").style.display="",e._modeWheel=new wheelnav("wheelDiv",null,1200,1200),e._modeGroupWheel=new wheelnav("_modeGroupWheel",e._modeWheel.raphael),e._modeNameWheel=null,e._exitWheel=new wheelnav("_exitWheel",e._modeWheel.raphael),wheelnav.cssMode=!0,e._modeWheel.colors=platformColor.modeWheelcolors,e._modeWheel.slicePathFunction=slicePath().DonutSlice,e._modeWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._modeWheel.slicePathCustom.minRadiusPercent=.85,e._modeWheel.slicePathCustom.maxRadiusPercent=1,e._modeWheel.sliceSelectedPathCustom=e._modeWheel.slicePathCustom,e._modeWheel.sliceInitPathCustom=e._modeWheel.slicePathCustom,e._modeWheel.clickModeRotate=!1,e._modeWheel.navAngle=-90,e._modeWheel.animatetime=0,e._modeWheel.createWheel(["0","1","2","3","4","5","6","7","8","9","10","11"]),e._modeGroupWheel.colors=platformColor.modeGroupWheelcolors,e._modeGroupWheel.slicePathFunction=slicePath().DonutSlice,e._modeGroupWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._modeGroupWheel.slicePathCustom.minRadiusPercent=.15,e._modeGroupWheel.slicePathCustom.maxRadiusPercent=.3,e._modeGroupWheel.sliceSelectedPathCustom=e._modeGroupWheel.slicePathCustom,e._modeGroupWheel.sliceInitPathCustom=e._modeGroupWheel.slicePathCustom,e._modeGroupWheel.navAngle=-90,e._modeGroupWheel.animatetime=0,[]);for(t in MODE_PIE_MENUS)n.push(t);e._modeGroupWheel.createWheel(n),e._exitWheel.colors=platformColor.exitWheelcolors,e._exitWheel.slicePathFunction=slicePath().DonutSlice,e._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),e._exitWheel.slicePathCustom.minRadiusPercent=0,e._exitWheel.slicePathCustom.maxRadiusPercent=.15,e._exitWheel.sliceSelectedPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.sliceInitPathCustom=e._exitWheel.slicePathCustom,e._exitWheel.clickModeRotate=!1,e._exitWheel.initWheel(["×","▶"]),e._exitWheel.navItems[0].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[0].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[0].titleHoverAttr.cursor="pointer",e._exitWheel.navItems[1].sliceSelectedAttr.cursor="pointer",e._exitWheel.navItems[1].sliceHoverAttr.cursor="pointer",e._exitWheel.navItems[1].titleSelectedAttr.cursor="pointer",e._exitWheel.navItems[1].titleHoverAttr.cursor="pointer",e._exitWheel.createWheel();var o,p=e,s=function(){if(" "===p._modeNameWheel.navItems[p._modeNameWheel.selectedNavItemIndex].title)p._modeNameWheel.navigateWheel((p._modeNameWheel.selectedNavItemIndex+1)%p._modeNameWheel.navItems.length);else{if(p.text.text=p._modeNameWheel.navItems[p._modeNameWheel.selectedNavItemIndex].title,p.text.text===_("major")+" / "+_("ionian"))p.value="major";else if(p.text.text===_("minor")+" / "+_("aeolian"))p.value="aeolian";else for(var e=0;e<MODE_PIE_MENUS[y].length;e++){var t=MODE_PIE_MENUS[y][e];if(_(t)===p.text.text){p.value=t;break}}p.container.setChildIndex(p.text,p.container.children.length-1),p.updateCache()}},x=function(e,t){p._modeNameWheel.navItems[e].navigateFunction=function(){for(var e=0;e<12;e++)t.includes(e)?p._modeWheel.navItems[e].navItem.show():p._modeWheel.navItems[e].navItem.hide();s()}},c=function(){var e=0,t=(i&&(e=12),p._modeWheel.selectedNavItemIndex),t=getNote(l,4,t+e,l+" chromatic",!1,null,null);t[0]=t[0].replace(SHARP,"#").replace(FLAT,"b"),p.activity.turtles.ithTurtle(0).singer.instrumentNames.includes(DEFAULTVOICE)||(p.activity.logo.synth.createDefaultSynth(0),p.activity.logo.synth.loadSynth(0,DEFAULTVOICE)),p.activity.logo.synth.setMasterVolume(DEFAULTVOLUME),p.activity.logo.synth.setVolume(0,DEFAULTVOICE,DEFAULTVOLUME),p.activity.logo.synth.trigger(0,[t[0]+t[1]],1/12,DEFAULTVOICE,null,null)},h=function(e,t){t<e.length&&(e[t]<12?(i=!1,p._modeWheel.navigateWheel(e[t])):(i=!0,p._modeWheel.navigateWheel(0)),o=setTimeout(function(){h(e,t+1)},100))},a=e.container.x,r=e.container.y,u=e.activity.canvas.offsetLeft+28*e.blocks.blockScale,m=e.activity.canvas.offsetTop+6*e.blocks.blockScale;docById("wheelDiv").style.position="absolute",setWheelSize(600),docById("wheelDiv").style.left=Math.min(e.blocks.turtles._canvas.width-600,Math.max(0,Math.round((a+e.activity.blocksContainer.x)*e.activity.getStageScale()+u)-200))+"px",docById("wheelDiv").style.top=Math.min(e.blocks.turtles._canvas.height-650,Math.max(0,Math.round((r+e.activity.blocksContainer.y)*e.activity.getStageScale()+m)-200))+"px";for(var v=0;v<12;v++)p._modeWheel.navItems[v].navigateFunction=c;for(y in MODE_PIE_MENUS){for(var d=void 0,d=0;d<MODE_PIE_MENUS[y].length;d++)if(MODE_PIE_MENUS[y][d]===g)break;if(d<MODE_PIE_MENUS[y].length)break}"major"===g&&(y="7");for(var W=function(){for(var e=p._modeGroupWheel.selectedNavItemIndex,t=y=p._modeGroupWheel.navItems[e].title,e=!1,l=(null===p._modeNameWheel&&(p._modeNameWheel=new wheelnav("_modeNameWheel",p._modeWheel.raphael),e=!0),p._modeNameWheel.keynavigateEnabled=!1,[]),i=0;i<MODE_PIE_MENUS[t].length;i++){var a=MODE_PIE_MENUS[t][i];l.push(" "===a?platformColor.modePieMenusIfColorPush:platformColor.modePieMenusElseColorPush)}p._modeNameWheel.colors=l,p._modeNameWheel.slicePathFunction=slicePath().DonutSlice,p._modeNameWheel.slicePathCustom=slicePath().DonutSliceCustomization(),p._modeNameWheel.slicePathCustom.minRadiusPercent=.3,p._modeNameWheel.slicePathCustom.maxRadiusPercent=.85,p._modeNameWheel.sliceSelectedPathCustom=p._modeNameWheel.slicePathCustom,p._modeNameWheel.sliceInitPathCustom=p._modeNameWheel.slicePathCustom,p._modeNameWheel.titleRotateAngle=0,p._modeNameWheel.navAngle=-90;for(var n=new Array,o=0;o<MODE_PIE_MENUS[t].length;o++){var s=MODE_PIE_MENUS[t][o];switch(s){case"ionian":case"major":n.push(_("major")+" / "+_("ionian"));break;case"aeolian":case"minor":n.push(_("minor")+" / "+_("aeolian"));break;default:" "===s?n.push(" "):n.push(_(s))}}if(p._modeNameWheel.animatetime=0,e)p._modeNameWheel.createWheel(n);else{for(var c=0;c<p._modeNameWheel.navItems.length;c++)p._modeNameWheel.navItems[c].title=n[c],p._modeNameWheel.navItems[c].basicNavTitleMax.title=n[c],p._modeNameWheel.navItems[c].basicNavTitleMin.title=n[c],p._modeNameWheel.navItems[c].hoverNavTitleMax.title=n[c],p._modeNameWheel.navItems[c].hoverNavTitleMin.title=n[c],p._modeNameWheel.navItems[c].selectedNavTitleMax.title=n[c],p._modeNameWheel.navItems[c].selectedNavTitleMin.title=n[c],p._modeNameWheel.navItems[c].initNavTitle.title=n[c],p._modeNameWheel.navItems[c].fillAttr=l[c],p._modeNameWheel.navItems[c].sliceHoverAttr.fill=l[c],p._modeNameWheel.navItems[c].slicePathAttr.fill=l[c],p._modeNameWheel.navItems[c].sliceSelectedAttr.fill=l[c];p._modeNameWheel.refreshWheel()}if("ja"===localStorage.languagePreference)for(var h=0;h<p._modeNameWheel.navItems.length;h++)p._modeNameWheel.navItems[h].titleAttr.font="30 30px sans-serif",p._modeNameWheel.navItems[h].titleSelectedAttr.font="30 30px sans-serif";for(var r=0,u=0;u<MODE_PIE_MENUS[t].length;u++){var m=MODE_PIE_MENUS[t][u],v=[0];if(" "!==m)for(var d=MUSICALMODES[m],W=0;W<d.length;W++)v.push(last(v)+d[W]);x(r,v),r+=1}for(r=0;r<MODE_PIE_MENUS[t].length&&MODE_PIE_MENUS[t][r]!==g;r++);r===n.length&&(r=0),p._modeNameWheel.navigateWheel(r)},b=0;b<e._modeGroupWheel.navItems.length;b++)e._modeGroupWheel.navItems[b].navigateFunction=W;for(var f=0;f<e._modeGroupWheel.navItems.length;f++)if(e._modeGroupWheel.navItems[f].title===y){e._modeGroupWheel.navigateWheel(f);break}e._exitWheel.navItems[0].navigateFunction=function(){o&&clearTimeout(o),p._piemenuExitTime=(new Date).getTime(),docById("wheelDiv").style.display="none",null!==p._modeNameWheel&&p._modeNameWheel.removeWheel()},e._exitWheel.navItems[1].navigateFunction=function(){for(var e=[0],t=MUSICALMODES[p.value],l=0;l<t.length-1;l++)e.push(last(e)+t[l]);e.push(12),e.push(12);for(var i=t.length-1;0<=i;i--)e.push(last(e)-t[i]);docById("wheelnav-_exitWheel-title-1").style.fill="#ffffff",docById("wheelnav-_exitWheel-title-1").style.pointerEvents="none",docById("wheelnav-_exitWheel-slice-1").style.pointerEvents="none",setTimeout(function(){var e=docById("wheelnav-_exitWheel-title-1"),t=docById("wheelnav-_exitWheel-slice-1");e&&t&&(e.style.fill="#000000",e.style.pointerEvents="auto",t.style.pointerEvents="auto")},2e3),h(e,0)}}},piemenuBlockContext=function(e){var t,l,i,a,n,o,s,c,h,r;null!==e.blocks.activeBlock&&(l=t=0,a=(i=e).blocks.blockList.indexOf(e),docById("contextWheelDiv").style.position="absolute",o=e.blocks.blockList[a].container.x,h=e.blocks.blockList[a].container.y,c=e.activity.canvas.offsetLeft+28*e.activity.getStageScale(),n=e.activity.canvas.offsetTop+6*e.activity.getStageScale(),docById("contextWheelDiv").style.left=Math.round((o+e.activity.blocksContainer.x)*e.activity.getStageScale()+c)-150+"px",docById("contextWheelDiv").style.top=Math.round((h+e.activity.blocksContainer.y)*e.activity.getStageScale()+n)-150+"px",docById("contextWheelDiv").style.display="",o=["imgsrc:header-icons/copy-button.svg","imgsrc:header-icons/extract-button.svg","imgsrc:header-icons/empty-trash-button.svg","imgsrc:header-icons/cancel-button.svg"],s=e.blocks.findTopBlock(a),["customsample","temperament1","definemode","show","turtleshell","action"].includes(e.name)&&o.push("imgsrc:header-icons/save-blocks-button.svg"),c=e.blocks.blockList[e.blocks.activeBlock].protoblock.helpString?(o.push("imgsrc:header-icons/help-button.svg"),o.length-1):null,(h=new wheelnav("contextWheelDiv",null,250,250)).colors=platformColor.wheelcolors,h.slicePathFunction=slicePath().DonutSlice,h.slicePathCustom=slicePath().DonutSliceCustomization(),h.slicePathCustom.minRadiusPercent=.2,h.slicePathCustom.maxRadiusPercent=.6,h.sliceSelectedPathCustom=h.slicePathCustom,h.sliceInitPathCustom=h.slicePathCustom,h.clickModeRotate=!1,h.initWheel(o),h.createWheel(),h.navItems[0].setTooltip(_("Duplicate")),h.navItems[1].setTooltip(_("Extract")),h.navItems[2].setTooltip(_("Move to trash")),h.navItems[3].setTooltip(_("Close")),["customsample","temperament1","definemode","show","turtleshell","action"].includes(e.blocks.blockList[s].name)&&h.navItems[4].setTooltip(_("Save stack")),null!==c&&h.navItems[c].setTooltip(_("Help")),h.navItems[0].selected=!1,r=function(){i.blocks.activeBlock=a,i.blocks.prepareStackForCopy(),i.blocks.pasteDx=t,i.blocks.pasteDy=l,i.blocks.pasteStack(),t+=21,l+=21,i.activity.helpfulWheelItems.forEach(function(e){"Paste previous stack"===e.label&&(e.display=!0,e.fn=r.bind(i))})},h.navItems[0].navigateFunction=function(){"customsample"===e.blocks.blockList[s].name?i.activity.errorMsg(_("In order to copy a sample, you must reload the widget, import the sample again, and export it.")):r()},h.navItems[1].navigateFunction=function(){i.blocks.activeBlock=a,i.blocks.extract(),docById("contextWheelDiv").style.display="none"},h.navItems[2].navigateFunction=function(){i.blocks.activeBlock=a,i.blocks.extract(),i.blocks.sendStackToTrash(i.blocks.blockList[a]),docById("contextWheelDiv").style.display="none",activity.textMsg(_("You can restore deleted blocks from the trash with the Restore From Trash button."),3e3)},h.navItems[3].navigateFunction=function(){docById("contextWheelDiv").style.display="none"},document.body.addEventListener("click",function(e){var t=document.getElementById("contextWheelDiv");"block"===window.getComputedStyle(t).display&&(t.style.display="none")}),["customsample","temperament1","definemode","show","turtleshell","action"].includes(e.name)&&(h.navItems[4].navigateFunction=function(){i.blocks.activeBlock=a,i.blocks.prepareStackForCopy(),i.blocks.saveStack()}),null!==c&&(h.navItems[c].navigateFunction=function(){i.blocks.activeBlock=a,new HelpWidget(i,!0),docById("contextWheelDiv").style.display="none"}),setTimeout(function(){i.blocks.stageClick=!1},500))},piemenuGrid=function(t){docById("wheelDivptm").style.display="none";for(var e,l,i=t.turtles.gridButton.getBoundingClientRect().x,a=t.turtles.gridButton.getBoundingClientRect().y,i=(docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="400px",docById("wheelDivptm").style.width="400px",docById("wheelDivptm").style.left=Math.min(t.turtles._canvas.width-200,Math.max(0,i*t.getStageScale()))-350+"px",docById("wheelDivptm").style.top=Math.min(t.turtles._canvas.height-250,Math.max(0,a*t.getStageScale()))+"px",docById("wheelDivptm").style.display="",l=_THIS_IS_TURTLE_BLOCKS_?(e=["imgsrc: images/grid/blank.svg","imgsrc: images/grid/Cartesian.svg","imgsrc: images/grid/Cartesian polar.svg","imgsrc: images/grid/Polar.svg",""],["Blank","Cartesian","Cartesian/Polar","Polar","Blank"]):(e=["imgsrc: images/grid/blank.svg","imgsrc: images/grid/Cartesian.svg","imgsrc: images/grid/Cartesian polar.svg","imgsrc: images/grid/Polar.svg","imgsrc: images/grid/Treble.svg","imgsrc: images/grid/Grand.svg","imgsrc: images/grid/Mezzo-soprano.svg","imgsrc: images/grid/Alto.svg","imgsrc: images/grid/Tenor.svg","imgsrc: images/grid/Bass.svg"],["Blank","Cartesian","Cartesian/Polar","Polar","Treble","Grand","Mezzo Soprano","Alto","Tenor","Bass"]),t.turtles.gridWheel=new wheelnav("wheelDivptm",null,300,300),t.turtles._exitWheel=new wheelnav("_exitWheel",t.turtles.gridWheel.raphael),t.turtles.gridWheel.keynavigateEnabled=!1,t.turtles.gridWheel.slicePathFunction=slicePath().DonutSlice,t.turtles.gridWheel.slicePathCustom=slicePath().DonutSliceCustomization(),t.turtles.gridWheel.colors=platformColor.gridWheelcolors.wheel,t.turtles.gridWheel.slicePathCustom.minRadiusPercent=.3,t.turtles.gridWheel.slicePathCustom.maxRadiusPercent=1,t.turtles.gridWheel.sliceSelectedPathCustom=t.turtles.gridWheel.slicePathCustom,t.turtles.gridWheel.sliceInitPathCustom=t.turtles.gridWheel.slicePathCustom,t.turtles.gridWheel.animatetime=0,t.turtles.gridWheel.clickModeRotate=!0,platformColor.gridWheelcolors.selected),a=i.fill,i=i.stroke,i=(t.turtles.gridWheel.sliceHoverAttr={fill:a,stroke:i,"stroke-width":2},t.turtles.gridWheel.sliceSelectedAttr={fill:a,stroke:i,"stroke-width":2},t.turtles.gridWheel.clockwise=!1,t.turtles.gridWheel.initWheel(e),t.turtles.gridWheel.createWheel(),null!=(a=t.turtles.currentGrid)?a:0),n=(t.turtles.gridWheel.navigateWheel(i),0);n<l.length;n++)(e=>{t.turtles.gridWheel.navItems[e].navigateFunction=function(){t.hideGrids(),t.turtles.currentGrid=e,t.turtles.doGrid(e)},t.turtles.gridWheel.navItems[e].setTooltip(l[e])})(n);t.turtles._exitWheel.colors=platformColor.exitWheelcolors,t.turtles._exitWheel.slicePathFunction=slicePath().DonutSlice,t.turtles._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),t.turtles._exitWheel.slicePathCustom.minRadiusPercent=0,t.turtles._exitWheel.slicePathCustom.maxRadiusPercent=.3,t.turtles._exitWheel.sliceSelectedPathCustom=t.turtles._exitWheel.slicePathCustom,t.turtles._exitWheel.sliceInitPathCustom=t.turtles._exitWheel.slicePathCustom,t.turtles._exitWheel.clickModeRotate=!1,t.turtles._exitWheel.createWheel(["×"," "]),t.turtles._exitWheel.navItems[0].navigateFunction=function(){s(t)},"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none");function o(e){docById("wheelDivptm").contains(e.target)||(s(t),document.removeEventListener("mousedown",o))}var s=function(e){docById("wheelDivptm").style.display="none",e.turtles.gridWheel.removeWheel(),e.turtles._exitWheel.removeWheel()};document.addEventListener("mousedown",o)},piemenuKey=function(r){docById("chooseKeyDiv").style.display="block",docById("movable").style.display="block";for(var e,u=new wheelnav("chooseKeyDiv",null,1300,1300),m=new wheelnav("keyNameWheel2",u.raphael),i=["C","G","D","A","E","B/C♭","F♯/G♭","C♯/D♭","G♯/A♭","D♯/E♭","A♯/B♭","F"],a=(wheelnav.cssMode=!0,u.slicePathFunction=slicePath().DonutSlice,u.slicePathCustom=slicePath().DonutSliceCustomization(),u.slicePathCustom.minRadiusPercent=.6,u.slicePathCustom.maxRadiusPercent=.9,u.sliceSelectedPathCustom=u.slicePathCustom,u.sliceInitPathCustom=u.slicePathCustom,u.titleRotateAngle=0,u.colors=platformColor.pitchWheelcolors,u.animatetime=0,u.createWheel(i),m.colors=platformColor.pitchWheelcolors,m.slicePathFunction=slicePath().DonutSlice,m.slicePathCustom=slicePath().DonutSliceCustomization(),m.slicePathCustom.minRadiusPercent=.9,m.slicePathCustom.maxRadiusPercent=1,m.sliceSelectedPathCustom=m.slicePathCustom,m.sliceInitPathCustom=m.slicePathCustom,[]),t=0;t<i.length;t++)2<i[t].length?(e=i[t].split("/"),a.push(e[0]),a.push(e[1])):(a.push(""),a.push(""));m.navAngle=-7.45,m.animatetime=0,m.createWheel(a);for(var v=new wheelnav("modenameWheel",u.raphael),l=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"],n=(v.slicePathFunction=slicePath().DonutSlice,v.slicePathCustom=slicePath().DonutSliceCustomization(),v.slicePathCustom.minRadiusPercent=.2,v.slicePathCustom.maxRadiusPercent=.6,v.sliceSelectedPathCustom=v.slicePathCustom,v.sliceInitPathCustom=v.slicePathCustom,v.titleRotateAngle=0,v.colors=platformColor.modeGroupWheelcolors,v.animatetime=0,v.createWheel(l),new wheelnav("exitWheel",u.raphael)),o=(n.slicePathFunction=slicePath().DonutSlice,n.slicePathCustom=slicePath().DonutSliceCustomization(),n.slicePathCustom.minRadiusPercent=0,n.slicePathCustom.maxRadiusPercent=.2,n.sliceSelectedPathCustom=n.slicePathCustom,n.sliceInitPathCustom=n.slicePathCustom,n.titleRotateAngle=0,n.clickModeRotate=!1,n.colors=platformColor.exitWheelcolors,n.animatetime=0,n.createWheel(["×"," "]),event.clientX),s=event.clientY,c=(docById("chooseKeyDiv").style.left=o-175+"px",docById("chooseKeyDiv").style.top=s+50+"px",docById("movable").style.left=o-110+"px",docById("movable").style.top=s+400+"px",n.navItems[0].navigateFunction=function(){docById("chooseKeyDiv").style.display="none",docById("movable").style.display="none";for(var e=document.getElementsByName("movable"),t=0;t<e.length;t++)e[t].checked&&(r.KeySignatureEnv[2]="true"==e[t].value);u.removeWheel(),m.removeWheel(),v.removeWheel(),r.storage.KeySignatureEnv=r.KeySignatureEnv;var l,i=!1,a=[];for(l in r.blocks.blockList)"setkey2"!==r.blocks.blockList[l].name||r.blocks.blockList[l].trash||(i=!0,a.push(l));if(!i){r.blocks.findStacks();var n,o,s,c,h=r.blocks.stackList;for(o in h.sort(),h)"start"===r.blocks.blockList[h[o]].name&&(s=r.blocks.blockList[h[o]].connections[1],c=r.KeySignatureEnv[2]?(r.blocks._makeNewBlockWithConnections("movable",0,[h[o],null,null],null,null),n=r.logo.blocks.blockList.length-1,r.blocks._makeNewBlockWithConnections("boolean",0,[n],null,null),r.blocks.blockList[n].connections[1]=r.blocks.blockList.length-1,[n,null,null,s]):[h[o],null,null,s],r.blocks._makeNewBlockWithConnections("setkey2",0,c,null,null),c=r.blocks.blockList.length-1,r.blocks.blockList[s].connections[0]=c,r.KeySignatureEnv[2]?(r.blocks.blockList[h[o]].connections[1]=n,r.blocks.blockList[n].connections[2]=c):r.blocks.blockList[h[o]].connections[1]=c,r.blocks.adjustExpandableClampBlock(),r.blocks._makeNewBlockWithConnections("notename",0,[c],null,null),r.blocks.blockList[c].connections[1]=r.blocks.blockList.length-1,r.blocks.blockList[r.blocks.blockList.length-1].value=r.KeySignatureEnv[0],r.blocks._makeNewBlockWithConnections("modename",0,[c],null,null),r.blocks.blockList[c].connections[2]=r.blocks.blockList.length-1,r.blocks.blockList[r.blocks.blockList.length-1].value=r.KeySignatureEnv[1],r.textMsg(_("You have chosen key for your pitch preview.")+r.KeySignatureEnv[0]+" "+r.KeySignatureEnv[1]))}},function(e){var e=getNote(e,4,null,e+" "+r.KeySignatureEnv[1],!1,null,null),t=(e[0]=e[0].replace(SHARP,"#").replace(FLAT,"b"),r.turtles.ithTurtle(0));t.singer.instrumentNames.includes(DEFAULTVOICE)||(t.singer.instrumentNames.push(DEFAULTVOICE),r.logo.synth.createDefaultSynth(0),r.logo.synth.loadSynth(0,DEFAULTVOICE)),r.logo.synth.setMasterVolume(DEFAULTVOLUME),Singer.setSynthVolume(r.logo,0,DEFAULTVOICE,DEFAULTVOLUME),r.logo.synth.trigger(0,[e[0]+e[1]],1/12,DEFAULTVOICE,null,null)}),h=function(l){u.navItems[l].navigateFunction=function(){for(var e,t=0;t<a.length;t++)Math.floor(t/2)!=l?m.navItems[t].navItem.hide():2<i[l].length&&m.navItems[t].navItem.show();e=u.navItems[u.selectedNavItemIndex].title,m.navigateWheel(2*u.selectedNavItemIndex),""===e?u.navigateWheel((u.selectedNavItemIndex+1)%u.navItems.length):e.length<=2&&(r.KeySignatureEnv[0]=e),r.storage.KeySignatureEnv=r.KeySignatureEnv,0<=l&&l<5||9<l&&l<12?c(r.KeySignatureEnv[0]):(e=(e=u.navItems[u.selectedNavItemIndex].title).split("/"),c(e[0]))}},d=0;d<i.length;d++)h(d);for(var W=0;W<l.length;W++)v.navItems[W].navigateFunction=function(){var e;""===(e=v.navItems[v.selectedNavItemIndex].title)?v.navigateWheel((v.selectedNavItemIndex+1)%v.navItems.length):r.KeySignatureEnv[1]=e,r.storage.KeySignatureEnv=r.KeySignatureEnv};for(var g=0;g<a.length;g++)m.navItems[g].navigateFunction=function(){var e;e=m.navItems[m.selectedNavItemIndex].title,r.KeySignatureEnv[0]=e,r.storage.KeySignatureEnv=r.KeySignatureEnv};void 0!==r.storage.KeySignatureEnv?(o=r.storage.KeySignatureEnv.split(","),r.KeySignatureEnv[0]=o[0],r.KeySignatureEnv[1]=o[1],r.KeySignatureEnv[2]="true"==o[2]):r.KeySignatureEnv=["C","major",!1],r.storage.KeySignatureEnv=r.KeySignatureEnv;var y=i.indexOf(r.KeySignatureEnv[0]);if(-1===y){if(-1!==(y=a.indexOf(r.KeySignatureEnv[0]))){u.navigateWheel(Math.floor(y/2)),m.navigateWheel(y);for(var p=0;p<a.length;p++)m.navItems[p].navItem.hide(),(y%2==0?(m.navItems[y].navItem.show(),m.navItems[y+1]):(m.navItems[y].navItem.show(),m.navItems[y-1])).navItem.show()}}else u.navigateWheel(y),m.navItems[2*y].navItem.hide(),m.navItems[2*y+1].navItem.hide();s=l.indexOf(r.KeySignatureEnv[1]);-1!==s&&v.navigateWheel(s)},piemenuDissectNumber=function(t){function l(){docById("wheelDiv").style.display="none",n.removeWheel(),o.removeWheel()}var i=t.activity.beginnerMode?[2,3,4]:[2,3,4,5,7],e=parseInt(t._dissectNumber.value)||2,a=(docById("wheelDiv").style.display="",getPieMenuSize({blocks:t.activity.logo.blocks})),n=new wheelnav("wheelDiv",null,a,a),o=new wheelnav("_exitWheel",n.raphael),a=i.map(function(e){return e.toString()}),a=(a.push(null),wheelnav.cssMode=!0,n.keynavigateEnabled=!1,n.colors=platformColor.numberWheelcolors,n.slicePathFunction=slicePath().DonutSlice,n.slicePathCustom=slicePath().DonutSliceCustomization(),n.slicePathCustom.minRadiusPercent=.2,n.slicePathCustom.maxRadiusPercent=.6,n.sliceSelectedPathCustom=n.slicePathCustom,n.sliceInitPathCustom=n.slicePathCustom,n.animatetime=0,n.createWheel(a),o.colors=platformColor.exitWheelcolors2,o.slicePathFunction=slicePath().DonutSlice,o.slicePathCustom=slicePath().DonutSliceCustomization(),o.slicePathCustom.minRadiusPercent=0,o.slicePathCustom.maxRadiusPercent=.2,o.sliceSelectedPathCustom=o.slicePathCustom,o.sliceInitPathCustom=o.slicePathCustom,o.clickModeRotate=!1,o.initWheel(["×","-","+"]),o.navItems[0].sliceSelectedAttr.cursor="pointer",o.navItems[0].sliceHoverAttr.cursor="pointer",o.navItems[0].titleSelectedAttr.cursor="pointer",o.navItems[0].titleHoverAttr.cursor="pointer",o.navItems[1].sliceSelectedAttr.cursor="pointer",o.navItems[1].sliceHoverAttr.cursor="pointer",o.navItems[1].titleSelectedAttr.cursor="pointer",o.navItems[1].titleHoverAttr.cursor="pointer",o.navItems[2].sliceSelectedAttr.cursor="pointer",o.navItems[2].sliceHoverAttr.cursor="pointer",o.navItems[2].titleSelectedAttr.cursor="pointer",o.navItems[2].titleHoverAttr.cursor="pointer",o.createWheel(),t._dissectNumber.getBoundingClientRect()),s=t.activity.canvas.offsetLeft+28,c=t.activity.canvas.offsetTop+6,s=(docById("wheelDiv").style.position="absolute",setWheelSize(300),Math.round(a.left-s)),c=Math.round(a.top-c),s=(docById("wheelDiv").style.left=Math.max(0,s-300-10)+"px",docById("wheelDiv").style.top=Math.max(0,c+a.height/2-150)+"px",i.indexOf(e));-1!==s&&n.navigateWheel(s);for(var h=0;h<i.length;h++)n.navItems[h].navigateFunction=function(){var e;e=n.selectedNavItemIndex,e=i[e],t._dissectNumber.value=e,l()};o.navItems[0].navigateFunction=function(){l()},o.navItems[1].navigateFunction=function(){var e=parseInt(t._dissectNumber.value),e=i.indexOf(e);0<e&&(e=i[e-1],t._dissectNumber.value=e)},o.navItems[2].navigateFunction=function(){var e=parseInt(t._dissectNumber.value),e=i.indexOf(e);e<i.length-1&&(e=i[e+1],t._dissectNumber.value=e)}};
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var p,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,a,i,c,l,s,u,d,y,t=t&&t.prototype instanceof m?t:m,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=n,u=r||[],d=!1,y={p:s=0,n:0,v:p,a:f,f:f.bind(p,4),d:function(e,t){return i=e,c=0,l=p,y.n=t,v}},function(e,t,n){if(1<s)throw TypeError("Generator is already running");for(d&&1===t&&f(t,n),c=t,l=n;(h=c<2?p:l)||!d;){i||(c?c<3?(1<c&&(y.n=-1),f(c,l)):y.n=l:y.v=l);try{if(s=2,i){if(h=i[e=c?e:"next"]){if(!(h=h.call(i,l)))throw TypeError("iterator result is not an object");if(!h.done)return h;l=h.value,c<2&&(c=0)}else 1===c&&(h=i.return)&&h.call(i),c<2&&(l=TypeError("The iterator does not provide a '"+e+"' method"),c=1);i=p}else if((h=(d=y.n<0)?l:o.call(a,y))!==v)break}catch(e){i=p,c=1,l=e}finally{s=1}}return{value:h,done:d}}),!0),t;function f(e,t){for(c=e,l=t,h=0;!d&&s&&!n&&h<u.length;h++){var n,r=u[h],o=y.p,a=r[2];3<e?(n=a===t)&&(l=r[(c=r[4])?5:c=3],r[4]=r[5]=p):r[0]<=o&&((n=e<2&&o<r[1])?(c=0,y.v=t,y.n=r[1]):o<a&&(n=e<3||r[0]>t||a<t)&&(r[4]=e,r[5]=t,y.n=a,c=0))}if(n||1<e)return v;throw d=!0,t}}var v={};function m(){}function o(){}function a(){}var h=Object.getPrototypeOf,e=[][t]?h(h([][t]())):(_regeneratorDefine2(h={},t,function(){return this}),h),i=a.prototype=m.prototype=Object.create(e);function c(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,n,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,n,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:c}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=c.apply(e,i);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var PlanetInterface=_createClass(function e(t){var a=this;_classCallCheck(this,e),this.planet=null,this.iframe=null,this.mainCanvas=null,this.activity=t,this.hideMusicBlocks=function(){a.activity.hideSearchWidget(),window.widgetWindows.hideAllWindows(),a.activity.logo.doStopTurtles(),docById("helpElem").style.visibility="hidden",document.querySelector(".canvasHolder").classList.add("hide"),document.querySelector("#canvas").style.display="none",document.querySelector("#theme-color").content="#8bc34a";var e=a;setTimeout(function(){e.activity.stage.enableDOMEvents(!1)},250),window.scroll(0,0)},this.showMusicBlocks=function(){document.title=a.activity.planet.getCurrentProjectName(),document.getElementById("toolbars").style.display="block",document.getElementById("palette").style.display="block",a.activity.prepSearchWidget(),window.widgetWindows.showWindows(),document.querySelector(".canvasHolder").classList.remove("hide"),document.querySelector("#canvas").style.display="",document.querySelector("#theme-color").content=platformColor.header,a.activity.stage.enableDOMEvents(!0),window.scroll(0,0),docById("buttoncontainerBOTTOM").style.display="block",docById("buttoncontainerTOP").style.display="block"},this.showPlanet=function(){var e=docById("overlayCanvas").toDataURL("image/png");a.planet.open(e),a.iframe.style.display="block",a.iframe.style.zIndex="9999";try{a.iframe.contentWindow.document.getElementById("local-tab").click()}catch(e){console.error(e)}},this.hidePlanet=function(){a.iframe.style.display="none"},this.openPlanet=function(){a.saveLocally(),a.hideMusicBlocks(),a.showPlanet()},this.closePlanet=function(){a.hidePlanet(),a.showMusicBlocks()},this.loadProjectFromData=function(e,t){if(void 0===t&&(t=!1),a.closePlanet(),t||a.activity.sendAllToTrash(!1,!0),void 0===e)a.errorMsg(_("project undefined"));else{a.activity.textMsg(a.getCurrentProjectName()),a.activity.loading=!0,document.body.style.cursor="wait",a.activity.doLoadAnimation(),a.activity._allClear(!1),a.activity.blocks.palettes._hideMenus(!0);var n=function(){document.removeEventListener("finishedLoading",n)};document.addEventListener?document.addEventListener("finishedLoading",n):document.attachEvent("finishedLoading",n);try{var r=JSON.parse(e);a.activity.blocks.loadNewBlocks(r)}catch(e){a.errorMsg(e)}a.activity.loading=!1,document.body.style.cursor="default"}},this.loadProjectFromFile=function(){document.querySelector("#myOpenFile").focus(),document.querySelector("#myOpenFile").click(),window.scroll(0,0)},this.newProject=function(){a.closePlanet(),a.initialiseNewProject(),a.activity._loadStart(),a.saveLocally()},this.initialiseNewProject=function(e){a.planet.ProjectStorage.initialiseNewProject(e),a.activity.sendAllToTrash(),a.activity.refreshCanvas(),a.activity.blocks.trashStacks=[]},this.saveLocally=function(){a.activity.stage.update(event);var n,r,o=a.activity.prepareExport(),e=doSVG(a.activity.canvas,a.activity.logo,a.activity.turtles,320,240,320/a.activity.canvas.width);try{null==e||""===e?a.planet.ProjectStorage.saveLocally(o,null):(n=new Image,r=a,n.onload=function(){var e=new createjs.Bitmap(n),t=e.getBounds();e.cache(t.x,t.y,t.width,t.height),r.planet.ProjectStorage.saveLocally(o,e.bitmapCache.getCacheDataURL())},n.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(e)))}catch(e){if(e.code!==DOMException.QUOTA_EXCEEDED_ERR&&"Not enough space to save locally"!==e.message)throw console.error(e),e;a.activity.textMsg(_("Error: Unable to save because you ran out of local storage. Try deleting some saved projects."))}},this.openCurrentProject=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,a.planet.ProjectStorage.getCurrentProjectData();case 1:return e.a(2,e.v)}},e)})),this.openProjectFromPlanet=function(e,t){a.planet.openProjectFromPlanet(e,t)},this.onConverterLoad=function(){window.Converter=a.planet.Converter},this.getCurrentProjectName=function(){return a.planet.ProjectStorage.getCurrentProjectName()},this.getCurrentProjectDescription=function(){return a.planet.ProjectStorage.getCurrentProjectDescription()},this.getCurrentProjectImage=function(){return a.planet.ProjectStorage.getCurrentProjectImage()},this.getTimeLastSaved=function(){return a.planet.ProjectStorage.TimeLastSaved},this.init=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return a.iframe=document.getElementById("planet-iframe"),e.p=1,e.n=2,a.iframe.contentWindow.makePlanet(_THIS_IS_MUSIC_BLOCKS_,a.activity.storage,window._);case 2:a.planet=a.iframe.contentWindow.p,a.planet.setLoadProjectFromData(a.loadProjectFromData.bind(a)),a.planet.setPlanetClose(a.closePlanet.bind(a)),a.planet.setLoadNewProject(a.newProject.bind(a)),a.planet.setLoadProjectFromFile(a.loadProjectFromFile.bind(a)),a.planet.setOnConverterLoad(a.onConverterLoad.bind(a)),e.n=4;break;case 3:e.p=3,t=e.v,console.error(t),a.planet=null;case 4:window.Converter=a.planet.Converter,a.mainCanvas=a.activity.canvas;case 5:return e.a(2)}},e,null,[[1,3]])}))});"undefined"!=typeof module&&module.exports&&(module.exports=PlanetInterface);
function _callSuper(t,e,s){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,s||[],_getPrototypeOf(t).constructor):e.apply(t,s))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperty(t,e,s){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var s=t[Symbol.toPrimitive];if(void 0===s)return("string"===e?String:Number)(t);s=s.call(t,e||"default");if("object"!=_typeof(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}var ProtoBlock=(()=>_createClass(function t(e){_classCallCheck(this,t),this.name=e,this.palette=null,this.style=null,this.generator=null,this.expandable=!1,this.parameter=!1,this.args=0,this.defaults=[],this.size=1,this.dockTypes=[],this.staticLabels=[],this.fontsize=null,this.extraWidth=0,this.scale=DEFAULTBLOCKSCALE,this.image=null,this.hidden=!1,this.disabled=!1,this.deprecated=!1,this.textWidth=0,this.labelOffset=0,this.beginnerModeBlock=!1},[{key:"adjustWidthToLabel",value:function(){var t,e;0!==this.staticLabels.length&&(t=new createjs.Container,e=new createjs.Text(this.staticLabels[0],this.fontSize+"px Sans","#000000"),t.addChild(e),e=t.getBounds(),this.textWidth=e.width,this.extraWidth+=Math.max(e.width-30,0))}},{key:"zeroArgBlock",value:function(){this.args=0,this.dockTypes.push("out"),this.dockTypes.push("in"),this.generator=this.zeroArgBlockGenerator}},{key:"zeroArgBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setTab(!0),t.setSlot(!0),this.fontsize&&t.setFontSize(this.fontsize),t.setExpand(10+this.extraWidth,0,0,0),[t.basicBlock(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"hiddenBlockFlow",value:function(){this.args=0,this.size=0,this.dockTypes.push("out"),this.dockTypes.push("in"),this.generator=this.hiddenBlockFlowGenerator}},{key:"hiddenBlockNoFlow",value:function(){this.args=0,this.size=0,this.dockTypes.push("out"),this.dockTypes.push("unavailable"),this.generator=this.hiddenBlockFlowGenerator}},{key:"hiddenBlockFlowGenerator",value:function(){var t=new SVG;t.setScale(this.scale),t.setSlot(!0),t.setTab(!0),this.fontsize&&t.setFontSize(this.fontsize),t.basicBlock();return t.docks[1][1]=t.docks[0][1],['<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"><text style="font-size:10px;fill:#000000;font-family:sans-serif;text-anchor:end"><tspan x="46.333333333333336" y="13.5">block_label</tspan></text></svg>',t.docks,0,0,0]}},{key:"basicBlockNoFlow",value:function(){this.args=0,this.dockTypes.push("out"),this.dockTypes.push("unavailable"),this.generator=this.basicBlockNoFlowGenerator}},{key:"basicBlockNoFlowGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setSlot(!0),t.setTail(!0),this.fontsize&&t.setFontSize(this.fontsize),t.setExpand(30+this.extraWidth,0,0,0),[t.basicBlock(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"basicBlockCollapsed",value:function(){this.args=0,this.dockTypes.push("unavailable"),this.dockTypes.push("unavailable"),this.generator=this.basicBlockCollapsedGenerator}},{key:"basicBlockCollapsedGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setCap(!0),t.setTail(!0),this.fontsize&&t.setFontSize(this.fontsize),t.setExpand(30+this.extraWidth,0,0,0),[t.basicBlock(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"oneArgBlock",value:function(){this.args=1,this.dockTypes.push("out"),this.dockTypes.push("numberin"),this.dockTypes.push("in"),this.generator=this.oneArgBlockGenerator}},{key:"oneArgBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setTab(!0),t.setInnies([!0]),t.setSlot(!0),this.fontsize&&t.setFontSize(this.fontsize),t.setExpand(30+this.extraWidth,0,0,0),[t.basicBlock(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"oneBooleanArgBlock",value:function(){this.args=1,this.size=1,this.dockTypes.push("out"),this.dockTypes.push("booleanin"),this.dockTypes.push("in"),this.generator=this.oneBooleanArgBlockGenerator}},{key:"oneBooleanArgBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setTab(!0),t.setSlot(!0),t.setBoolean(!0),t.setClampCount(0),this.fontsize&&t.setFontSize(this.fontsize),t.setExpand(30+this.extraWidth,0,0,0),[t.basicBlock(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"twoArgBlock",value:function(){this.expandable=!0,this.style="twoarg",this.size=2,this.args=2,this.dockTypes.push("out"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("in"),this.generator=this.twoArgBlockGenerator}},{key:"twoArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setInnies([!0,!0]),e.setSlot(!0),t?e.setExpand(30+this.extraWidth,(t-1)*STANDARDBLOCKHEIGHT/2,0,0):e.setExpand(30+this.extraWidth,0,0,0),this.fontsize&&e.setFontSize(this.fontsize),[e.basicBlock(),e.docks,e.getWidth(),e.getHeight(),e.getHeight()]}},{key:"threeArgBlock",value:function(){this.expandable=!0,this.style="twoarg",this.size=3,this.args=3,this.dockTypes.push("out"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("in"),this.generator=this.threeArgBlockGenerator}},{key:"threeArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setInnies([!0,!0,!0]),e.setSlot(!0),t?e.setExpand(30+this.extraWidth,(t-1)*STANDARDBLOCKHEIGHT/2,0,0):e.setExpand(30+this.extraWidth,0,0,0),this.fontsize&&e.setFontSize(this.fontsize),[e.basicBlock(),e.docks,e.getWidth(),e.getHeight(),e.getHeight()]}},{key:"fourArgBlock",value:function(){this.expandable=!0,this.style="twoarg",this.size=4,this.args=4,this.dockTypes.push("out"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("in"),this.generator=this.fourArgBlockGenerator}},{key:"fourArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setInnies([!0,!0,!0,!0]),e.setSlot(!0),t?e.setExpand(30+this.extraWidth,(t-1)*STANDARDBLOCKHEIGHT/2,0,0):e.setExpand(30+this.extraWidth,0,0,0),this.fontsize&&e.setFontSize(this.fontsize),[e.basicBlock(),e.docks,e.getWidth(),e.getHeight(),e.getHeight()]}},{key:"oneArgMathBlock",value:function(){this.style="arg",this.size=1,this.args=1,this.parameter=!0,this.dockTypes.push("numberout"),this.dockTypes.push("numberin"),this.generator=this.oneArgMathBlockGenerator}},{key:"oneArgMathBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setSlot(!1),t.setInnies([!0]),t.setOutie(!0),t.setTab(!1),this.fontsize&&t.setFontSize(this.fontsize),t.setExpand(30+this.extraWidth,0,0,0),[t.basicBlock(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"twoArgMathBlock",value:function(){this.expandable=!0,this.style="arg",this.size=2,this.args=2,this.parameter=!0,this.dockTypes.push("numberout"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.generator=this.twoArgMathBlockGenerator}},{key:"twoArgMathBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setSlot(!1),e.setInnies([!0,!0]),e.setOutie(!0),e.setTab(!1),t?e.setExpand(30+this.extraWidth,(t-1)*STANDARDBLOCKHEIGHT/2,0,0):e.setExpand(30+this.extraWidth,0,0,0),this.fontsize&&e.setFontSize(this.fontsize),[e.basicBlock(),e.docks,e.getWidth(),e.getHeight(),e.getHeight()]}},{key:"threeArgMathBlock",value:function(){this.expandable=!0,this.style="arg",this.size=3,this.args=3,this.parameter=!0,this.dockTypes.push("numberout"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.generator=this.threeArgMathBlockGenerator}},{key:"threeArgMathBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setSlot(!1),e.setInnies([!0,!0,!0]),e.setOutie(!0),e.setTab(!1),t?e.setExpand(30+this.extraWidth,(t-1)*STANDARDBLOCKHEIGHT/2,0,0):e.setExpand(30+this.extraWidth,0,0,0),this.fontsize&&e.setFontSize(this.fontsize),[e.basicBlock(),e.docks,e.getWidth(),e.getHeight(),e.getHeight()]}},{key:"fourArgMathBlock",value:function(){this.expandable=!0,this.style="arg",this.size=4,this.args=4,this.parameter=!0,this.dockTypes.push("numberout"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.generator=this.fourArgMathBlockGenerator}},{key:"fourArgMathBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setSlot(!1),e.setInnies([!0,!0,!0,!0]),e.setOutie(!0),e.setTab(!1),t?e.setExpand(30+this.extraWidth,(t-1)*STANDARDBLOCKHEIGHT/2,0,0):e.setExpand(30+this.extraWidth,0,0,0),this.fontsize&&e.setFontSize(this.fontsize),[e.basicBlock(),e.docks,e.getWidth(),e.getHeight(),e.getHeight()]}},{key:"valueBlock",value:function(){this.style="value",this.size=1,this.args=0,this.dockTypes.push("numberout"),this.generator=this.valueBlockGenerator}},{key:"valueBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setExpand(60+this.extraWidth,0,0,0),t.setOutie(!0),this.fontsize&&t.setFontSize(this.fontsize),[t.basicBox(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"mediaBlock",value:function(){this.style="value",this.size=2,this.args=0,this.dockTypes.push("mediaout"),this.generator=this.mediaBlockGenerator}},{key:"mediaBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setExpand(60+this.extraWidth,23,0,0),t.setOutie(!0),this.fontsize&&t.setFontSize(this.fontsize),[t.basicBox(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"stackClampZeroArgBlock",value:function(){this.style="clamp",this.expandable=!0,this.size=3,this.args=1,this.dockTypes.push("unavailable"),this.dockTypes.push("in"),this.dockTypes.push("unavailable"),this.generator=this.stackClampZeroArgBlockGenerator}},{key:"stackClampZeroArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setCap(!0),e.setTail(!0),e.setExpand(20+this.extraWidth,0,0,0),e.setLabelOffset(this.labelOffset),t?e.setClampSlots(0,t):e.setClampSlots(0,1),this.fontsize&&e.setFontSize(this.fontsize),[e.basicClamp(),e.docks,e.getWidth(),e.getHeight(),e.docks[1][1]]}},{key:"flowClampBlock",value:function(){this.style="clamp",this.expandable=!0,this.size=2,this.args=1,this.dockTypes.push("out"),this.dockTypes.push("in"),this.dockTypes.push("in"),this.generator=this.flowClampBlockGenerator}},{key:"flowClampBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setSlot(!0),e.setExpand(20+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,1),this.fontsize&&e.setFontSize(this.fontsize),[e.basicClamp(),e.docks,e.getWidth(),e.getHeight(),e.docks[1][1]]}},{key:"flowClampOneArgBlock",value:function(){this.style="clamp",this.expandable=!0,this.size=2,this.args=2,this.dockTypes.push("out"),this.dockTypes.push("numberin"),this.dockTypes.push("in"),this.dockTypes.push("in"),this.generator=this.flowClampOneArgBlockGenerator}},{key:"flowClampOneArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setSlot(!0),e.setInnies([!0]),e.setLabelOffset(this.labelOffset),e.setExpand(20+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,1),this.fontsize&&e.setFontSize(this.fontsize),[e.basicClamp(),e.docks,e.getWidth(),e.getHeight(),e.docks[2][1]]}},{key:"flowClampTwoArgBlock",value:function(){this.style="clamp",this.expandable=!0,this.size=3,this.args=3,this.dockTypes.push("out"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("in"),this.dockTypes.push("in"),this.generator=this.flowClampTwoArgBlockGenerator}},{key:"flowClampTwoArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setSlot(!0),e.setInnies([!0,!0]),e.setExpand(20+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,1),this.fontsize&&e.setFontSize(this.fontsize),[e.basicClamp(),e.docks,e.getWidth(),e.getHeight(),e.docks[3][1]]}},{key:"flowClampThreeArgBlock",value:function(){this.style="clamp",this.expandable=!0,this.size=4,this.args=4,this.dockTypes.push("out"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.dockTypes.push("textin"),this.dockTypes.push("in"),this.dockTypes.push("in"),this.generator=this.flowClampThreeArgBlockGenerator}},{key:"flowClampThreeArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setSlot(!0),e.setInnies([!0,!0,!0]),e.setExpand(20+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,1),this.fontsize&&e.setFontSize(this.fontsize),[e.basicClamp(),e.docks,e.getWidth(),e.getHeight(),e.docks[4][1]]}},{key:"argClampOneArgBlock",value:function(){this.style="argclamp",this.expandable=!0,this.size=3,this.args=2,this.dockTypes.push("out"),this.dockTypes.push("textin"),this.dockTypes.push("anyin"),this.dockTypes.push("in"),this.generator=this.argClampOneArgBlockGenerator}},{key:"argClampOneArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setSlot(!0),e.setInnies([!0]),e.setExpand(20+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,[1]),this.fontsize&&e.setFontSize(this.fontsize),[e.argClamp(),e.docks,e.getWidth(),e.getHeight(),(e.docks[1][1]+e.docks[2][1])/2]}},{key:"argClampOneArgMathBlock",value:function(){this.style="argclamparg",this.expandable=!0,this.size=3,this.args=2,this.dockTypes.push("anyout"),this.dockTypes.push("textin"),this.dockTypes.push("anyin"),this.generator=this.argClampOneArgMathBlockGenerator}},{key:"argClampOneArgMathBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setInnies([!0]),e.setOutie(!0),e.setTab(!1),e.setSlot(!1),e.setExpand(20+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,[1]),this.fontsize&&e.setFontSize(this.fontsize),[e.argClamp(),e.docks,e.getWidth(),e.getHeight(),(e.docks[1][1]+e.docks[2][1])/2]}},{key:"argClampBlock",value:function(){this.style="argclamp",this.expandable=!0,this.size=3,this.args=1,this.dockTypes.push("out"),this.dockTypes.push("anyin"),this.dockTypes.push("in"),this.generator=this.argClampBlockGenerator}},{key:"argClampBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setSlot(!0),e.setExpand(20+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,[1]),this.fontsize&&e.setFontSize(this.fontsize),[e.argClamp(),e.docks,e.getWidth(),e.getHeight(),2*e.docks[1][1]/3]}},{key:"argClampMathBlock",value:function(){this.style="argclamparg",this.expandable=!0,this.size=3,this.args=1,this.dockTypes.push("anyout"),this.dockTypes.push("anyin"),this.generator=this.argClampMathBlockGenerator}},{key:"argClampMathBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setOutie(!0),e.setTab(!1),e.setSlot(!1),e.setExpand(20+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,[1]),this.fontsize&&e.setFontSize(this.fontsize),[e.argClamp(),e.docks,e.getWidth(),e.getHeight(),2*e.docks[1][1]/3]}},{key:"flowClampBooleanArgBlock",value:function(){this.style="clamp",this.expandable=!0,this.size=3,this.args=2,this.dockTypes.push("out"),this.dockTypes.push("booleanin"),this.dockTypes.push("in"),this.dockTypes.push("in"),this.generator=this.flowClampBooleanArgBlockGenerator}},{key:"flowClampBooleanArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setBoolean(!0),e.setSlot(!0),e.setExpand(this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,1),this.fontsize&&e.setFontSize(this.fontsize),[e.basicClamp(),e.docks,e.getWidth(),e.getHeight(),e.docks[2][1]]}},{key:"doubleFlowClampBooleanArgBlock",value:function(){this.style="doubleclamp",this.expandable=!0,this.size=4,this.args=3,this.dockTypes.push("out"),this.dockTypes.push("booleanin"),this.dockTypes.push("in"),this.dockTypes.push("in"),this.dockTypes.push("in"),this.generator=this.doubleFlowClampBooleanArgBlockGenerator}},{key:"doubleFlowClampBooleanArgBlockGenerator",value:function(t,e){var s=new SVG;return s.setScale(this.scale),s.setTab(!0),s.setSlot(!0),s.setBoolean(!0),s.setClampCount(2),e?s.setClampSlots(0,e):s.setClampSlots(0,1),t?s.setClampSlots(1,t):s.setClampSlots(1,1),s.setExpand(this.extraWidth,0,0,0),this.fontsize&&s.setFontSize(this.fontsize),[s.basicClamp(),s.docks,s.getWidth(),s.getHeight(),s.docks[2][1]]}},{key:"flowClampZeroArgBlock",value:function(){this.style="clamp",this.expandable=!0,this.size=2,this.args=1,this.dockTypes.push("out"),this.dockTypes.push("in"),this.dockTypes.push("in"),this.generator=this.flowClampZeroArgBlockGenerator}},{key:"flowClampZeroArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setTab(!0),e.setSlot(!0),e.setExpand(10+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,1),this.fontsize&&e.setFontSize(this.fontsize),[e.basicClamp(),e.docks,e.getWidth(),e.getHeight(),e.docks[1][1]]}},{key:"argFlowClampBlock",value:function(){this.style="argflowclamp",this.expandable=!0,this.size=3,this.args=1,this.dockTypes.push("anyout"),this.dockTypes.push("in"),this.generator=this.argFlowClampGenerator}},{key:"argFlowClampGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setSlot(!1),e.setOutie(!0),e.setExpand(20+this.extraWidth,0,0,0),t?e.setClampSlots(0,t):e.setClampSlots(0,[1]),this.fontsize&&e.setFontSize(this.fontsize),[e.basicClamp(),e.docks,e.getWidth(),e.getHeight(),e.docks[1][1]]}},{key:"stackClampOneArgBlock",value:function(){this.style="clamp",this.expandable=!0,this.size=3,this.args=2,this.dockTypes.push("unavailable"),this.dockTypes.push("anyin"),this.dockTypes.push("in"),this.dockTypes.push("unavailable"),this.generator=this.stackClampOneArgBlockGenerator}},{key:"stackClampOneArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),e.setCap(!0),e.setTail(!0),e.setInnies([!0]),e.setExpand(10+this.extraWidth,0,0,0),e.setLabelOffset(this.labelOffset),t?e.setClampSlots(0,t):e.setClampSlots(0,1),this.fontsize&&e.setFontSize(this.fontsize),[e.basicClamp(),e.docks,e.getWidth(),e.getHeight(),e.docks[2][1]]}},{key:"booleanZeroArgBlock",value:function(){this.style="arg",this.size=1,this.args=0,this.dockTypes.push("booleanout"),this.generator=this.booleanZeroArgBlockGenerator}},{key:"booleanZeroArgBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setExpand(60+this.extraWidth,0,0,4),this.fontsize&&t.setFontSize(this.fontsize),[t.booleanNot(!0),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"booleanOneArgBlock",value:function(){this.style="arg",this.size=2,this.args=1,this.parameter=!0,this.dockTypes.push("booleanout"),this.dockTypes.push("textin"),this.generator=this.booleanOneArgBlockGenerator}},{key:"booleanOneArgBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setExpand(20+this.extraWidth,0,0,0),this.fontsize&&t.setFontSize(this.fontsize),t.setInnies([!0]),[t.booleanNot(!0),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"booleanOneBooleanArgBlock",value:function(){this.style="arg",this.size=2,this.args=1,this.parameter=!0,this.dockTypes.push("booleanout"),this.dockTypes.push("booleanin"),this.generator=this.booleanOneBooleanArgBlockGenerator}},{key:"booleanOneBooleanArgBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setExpand(20+this.extraWidth,0,0,0),this.fontsize&&t.setFontSize(this.fontsize),[t.booleanNot(!1),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"booleanTwoBooleanArgBlock",value:function(){this.style="arg",this.size=3,this.args=2,this.parameter=!0,this.dockTypes.push("booleanout"),this.dockTypes.push("booleanin"),this.dockTypes.push("booleanin"),this.generator=this.booleanTwoBooleanArgBlockGenerator}},{key:"booleanTwoBooleanArgBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setExpand(20+this.extraWidth,0,0,0),this.fontsize&&t.setFontSize(this.fontsize),[t.booleanAndOr(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}},{key:"booleanTwoArgBlock",value:function(){this.style="arg",this.size=2,this.args=2,this.parameter=!0,this.expandable=!0,this.dockTypes.push("booleanout"),this.dockTypes.push("numberin"),this.dockTypes.push("numberin"),this.generator=this.booleanTwoArgBlockGenerator}},{key:"booleanTwoArgBlockGenerator",value:function(t){var e=new SVG;return e.setScale(this.scale),t?e.setExpand(10+this.extraWidth,(t-1)*STANDARDBLOCKHEIGHT/2,0,0):e.setExpand(10+this.extraWidth,0,0,0),this.fontsize&&e.setFontSize(this.fontsize),[e.booleanCompare(),e.docks,e.getWidth(),e.getHeight(),e.getHeight()]}},{key:"parameterBlock",value:function(){this.style="arg",this.parameter=!0,this.size=1,this.args=0,this.dockTypes.push("numberout"),this.generator=this.parameterBlockGenerator}},{key:"parameterBlockGenerator",value:function(){var t=new SVG;return t.setScale(this.scale),t.setExpand(70+this.extraWidth,0,0,0),t.setOutie(!0),this.fontsize&&t.setFontSize(this.fontsize),[t.basicBox(),t.docks,t.getWidth(),t.getHeight(),t.getHeight()]}}]))(),isObject=function(t){return t&&"object"===_typeof(t)&&!Array.isArray(t)},_mergeDeep=function(t){for(var e=arguments.length,s=new Array(1<e?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];if(!s.length)return t;var o=s.shift();if(isObject(t)&&isObject(o))for(var a in o)isObject(o[a])?(t[a]||Object.assign(t,_defineProperty({},a,{})),_mergeDeep(t[a],o[a])):Object.assign(t,_defineProperty({},a,o[a]));return _mergeDeep.apply(void 0,[t].concat(s))},BaseBlock=(()=>{function e(t){return _classCallCheck(this,e),(t=_callSuper(this,e,[t])).macroFunc=null,t._style={},t.beginnerModeBlock=!1,t.deprecated=!1,t.extraSearchTerms=[],t.helpString=[],t.piemenuValuesC1=[],t.piemenuValuesC2=[],t.piemenuValuesC3=[],t.piemenuLabels=[],t.lang=localStorage.languagePreference||navigator.language,t}return _inherits(e,ProtoBlock),_createClass(e,[{key:"setPalette",value:function(t,e){this.palette=e.palettes.dict[t]}},{key:"setHelpString",value:function(t){this.helpString=t}},{key:"formBlock",value:function(t){var e=this;if(_mergeDeep(this._style,t),(t=this._style).args||(t.args=0),(t=this._style).argTypes||(t.argTypes=[]),(t=this._style).argLabels||(t.argLabels=[]),(t=this._style).defaults||(t.defaults=[]),(t=this._style).flows||(t.flows={}),(t=this._style.flows).labels||(t.labels=[]),1<this._style.args&&(this.expandable=!0),0<this._style.flows.labels.length?("arg"===this._style.flows.type?this.style="argclamp":"value"===this._style.flows.type?this.style="value":2==this._style.flows.labels.length?this.style="doubleclamp":this.style="clamp",this.expandable=!0):"value"===this._style.flows.type?this.style="value":this._style.flows.left?(this.style="arg",this.parameter=!0):2===this._style.args&&(this.style="twoarg"),"value"===this._style.flows.type&&2===this._style.args&&(this.expandable=!0),this.args=this._style.flows.labels.length+this._style.args,0!==this.size&&(this.size=1+this._style.flows.labels.length),"booleanin"===this._style.argTypes[0]||"booleanin"===this._style.argTypes[1]?this.size++:this.size+=Math.max(0,this._style.args-1),"arg"===this._style.flows.type&&this.size++,this._style.image&&(this.size++,this.image=this._style.image),this.staticLabels=[this._style.name||""],this.dockTypes=[],this.defaults=[],this._style.argLabels.forEach(function(t){return e.staticLabels.push(t)}),this._style.flows.labels.forEach(function(t){return e.staticLabels.push(t)}),this._style.flows.left&&this.dockTypes.push(this._style.outType||"numberout"),this._style.flows.top&&this.dockTypes.push("cap"===this._style.flows.top?"unavailable":"out"),"number"==typeof this._style.args)for(var s=0;s<this._style.args;s++)this.dockTypes.push(this._style.argTypes[s]||"numberin"),s<this._style.defaults.length&&this.defaults.push(this._style.defaults[s]);if("arg"===this._style.flows.type)for(var i=0;i<this._style.flows.labels.length;i++)this.dockTypes.push(this._style.flows.types[i]||"numberin");for(var o=0;o<this._style.flows.labels.length;o++)this.dockTypes.push("in");this._style.flows.bottom&&this.dockTypes.push("tail"===this._style.flows.bottom?"unavailable":"in"),this.generator=function(){var t=new SVG,e=(t.setScale(this.scale),"cap"===this._style.flows.top?t.setCap(!0):t.setSlot(this._style.flows.top),"tail"===this._style.flows.bottom?t.setTail(!0):this._style.flows.bottom&&t.setTab(!0),this._style.flows.left&&t.setOutie(!0),"value"===this._style.flows.type?60:20);this._style.flows.type||(e+=10),"booleanout"===this._style.outType&&2===this._style.args?e-=30:"booleanin"===this._style.argTypes[0]&&(e-=5),0!==this.size&&t.setExpand(e+this.extraWidth,this.image?23:0,0,"booleanout"!==this._style.outType||this._style.args?0:4);for(var s=arguments.length;s<this._style.flows.labels.length;s++)t.setClampSlots(s,1);t.setClampCount(this._style.flows.labels.length);for(var i,o=0;o<arguments.length;o++)null==this._style.flows.type?t.setExpand(30+this.extraWidth,(arguments[arguments.length-o-1]-1)*STANDARDBLOCKHEIGHT/2,0,0):"value"==this._style.flows.type?t.setExpand(60+this.extraWidth,(arguments[arguments.length-o-1]-1)*STANDARDBLOCKHEIGHT/2,0,0):t.setClampSlots(o,arguments[arguments.length-o-1]||1);return"booleanin"===this._style.argTypes[0]?t.setBoolean(!0):"number"==typeof this._style.args&&t.setInnies(Array(this._style.args).fill(!0)),this._style.canCollapse&&t.setLabelOffset(15),this.fontsize&&t.setFontSize(this.fontsize),e="arg"===this._style.flows.type?t.argClamp():"flow"===this._style.flows.type?t.basicClamp():"booleanout"===this._style.outType?1!==this._style.args&&this._style.args?"booleanin"===this._style.argTypes[0]?t.booleanAndOr():t.booleanCompare():t.booleanNot(!this._style.args):"value"===this._style.flows.type?t.basicBox():t.basicBlock(),0===this.size&&(e='<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"><text style="font-size:10px;fill:#000000;font-family:sans-serif;text-anchor:end"><tspan x="46.333333333333336" y="13.5">block_label</tspan></text></svg>',t.docks[1][1]=t.docks[0][1]),this.isLeftClamp="clamp"===this.style&&1==this._style.flows.left&&0===this._style.args&&"flow"==this._style.flows.type,i=this._style.flows.top||this._style.flows.bottom?t.docks[t.docks.length-this._style.flows.labels.length-1][1]:this.isLeftClamp?t.docks[t.docks.length-this._style.flows.labels.length][1]:t.getHeight(),0===this.size?[e,t.docks,0,0,0]:[e="bool"===this._style.flows.left?t.booleanNot(!0):e,t.docks,t.getWidth(),t.getHeight(),i]}}},{key:"makeMacro",value:function(t){this.macroFunc=t}},{key:"updateDockValue",value:function(t,e){this.dockTypes[t]=e}},{key:"changeName",value:function(t){this.name=t}},{key:"beginnerBlock",value:function(t){this.beginnerModeBlock=t}},{key:"appleNoteBlock",value:function(){this.style="basic",this.size=1,this.args=0,this.dockTypes.push("out"),this.dockTypes.push("in"),this.generator=this.appleNoteBlockGenerator}},{key:"appleNoteBlockGenerator",value:function(){var t,e=new SVG,s=(e.setScale(this.scale),e.setTab(!0),e.setSlot(!0),e.setExpand(30+this.extraWidth,0,0,0),this.fontsize&&e.setFontSize(this.fontsize),e.basicBlock());switch(this.name){case"wholeNote":t='<g transform="translate(-312.0000,-493.37592) scale(1.1)">\n                    <g transform="translate(7.9606,5.6125499)" style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1">\n                        <path d="m 369.80263,457.99537 q 1.104,0 1.872,0.432 0.768,0.416 0.768,1.2 0,0.752 -0.752,1.168 -0.752,0.4 -1.808,0.4 -1.104,0 -1.856,-0.416 -0.752,-0.416 -0.752,-1.232 0,-0.576 0.464,-0.944 0.48,-0.368 1.008,-0.48 0.528,-0.128 1.056,-0.128 z m -0.864,1.136 q 0,0.672 0.304,1.184 0.304,0.512 0.784,0.512 0.736,0 0.736,-0.8 0,-0.64 -0.304,-1.136 -0.288,-0.512 -0.8,-0.512 -0.72,0 -0.72,0.752 z" />\n                    </g>\n                </g>';break;case"halfNote":t='<g transform="translate(-290.23523,-445.37592)">\n                    <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1">\n                        <path d="m 375.23523,465.70392 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-9.472 0.352,0 0,10.352 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 0.736,0.48 q 0.848,0 1.712,-0.72 0.88,-0.72 0.88,-1.072 0,-0.224 -0.192,-0.224 -0.592,0 -1.632,0.688 -1.024,0.672 -1.024,1.12 0,0.208 0.256,0.208 z" />\n                    </g>\n                </g>';break;case"sixteenthNote":t='<g transform="translate(-92.21292,-422.51877)">\n                    <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1">\n                        <path d="m 182.21292,442.84677 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-9.472 0.336,0 q 0.064,0.56 0.4,1.088 0.352,0.512 0.8,0.944 0.448,0.416 0.88,0.864 0.448,0.432 0.752,1.024 0.304,0.576 0.304,1.232 0,0.544 -0.256,1.104 0.304,0.448 0.304,1.184 0,1.232 -0.608,2.24 l -0.384,0 q 0.56,-1.12 0.56,-2.032 0,-0.512 -0.256,-0.96 -0.24,-0.448 -0.752,-0.816 -0.496,-0.368 -0.832,-0.56 -0.32,-0.192 -0.896,-0.48 l 0,5.52 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 6.464,-5.904 q 0,-1.648 -2.624,-3.072 0,0.464 0.192,0.88 0.192,0.416 0.512,0.752 0.32,0.32 0.656,0.592 0.336,0.272 0.688,0.608 0.352,0.32 0.544,0.608 0.032,-0.256 0.032,-0.368 z" />\n                    </g>\n                </g>';break;case"thirtysecondNote":t='<g transform="translate(-540.78433,-233.88335)">\n                    <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1">\n                        <path d="m 630.78433,254.27535 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-11.536 0.352,0 q 0.048,0.56 0.384,1.072 0.336,0.496 0.768,0.912 0.432,0.4 0.864,0.848 0.432,0.448 0.72,1.104 0.304,0.656 0.304,1.456 0,0.48 -0.16,1.056 0.224,0.416 0.224,0.912 0,0.512 -0.24,0.976 0.304,0.448 0.304,1.168 0,1.232 -0.608,2.24 l -0.384,0 q 0.56,-1.12 0.56,-2.032 0,-0.512 -0.256,-0.96 -0.24,-0.448 -0.752,-0.816 -0.496,-0.368 -0.832,-0.56 -0.32,-0.192 -0.896,-0.48 l 0,5.52 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 6.448,-7.872 q 0,-0.496 -0.208,-0.928 -0.192,-0.432 -0.64,-0.832 -0.432,-0.416 -0.784,-0.672 -0.352,-0.256 -0.976,-0.656 0.032,0.448 0.352,0.896 0.32,0.432 0.704,0.752 0.4,0.32 0.848,0.8 0.464,0.464 0.704,0.912 l 0,-0.272 z m 0,2.096 q 0,-0.4 -0.16,-0.768 -0.144,-0.368 -0.32,-0.608 -0.16,-0.256 -0.592,-0.608 -0.416,-0.352 -0.672,-0.528 -0.256,-0.176 -0.848,-0.576 0.064,0.48 0.4,0.976 0.336,0.48 0.72,0.816 0.4,0.336 0.832,0.784 0.448,0.432 0.64,0.784 l 0,-0.272 z" />\n                    </g>\n                </g>';break;case"sixtyfourthNote":t='<g transform="translate(-255.3223,-318.39492)">\n                    <g transform="translate(3.1093785,1.6864426)" style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1">\n                        <path d="m 342.21292,337.13248 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-11.568 0.336,0 q 0.064,0.64 0.384,1.104 0.336,0.464 0.752,0.768 0.416,0.304 0.832,0.656 0.416,0.336 0.688,0.928 0.288,0.592 0.288,1.44 0,0.24 -0.144,0.768 0.256,0.608 0.256,1.376 0,0.32 -0.16,0.896 0.224,0.416 0.224,0.912 0,0.496 -0.24,0.96 0.304,0.448 0.304,1.024 0,0.384 -0.08,0.688 -0.08,0.304 -0.16,0.448 -0.08,0.144 -0.368,0.608 l -0.384,0 q 0.08,-0.16 0.192,-0.368 0.112,-0.224 0.16,-0.32 0.064,-0.096 0.112,-0.24 0.064,-0.144 0.08,-0.288 0.016,-0.144 0.016,-0.32 0,-0.272 -0.096,-0.512 -0.08,-0.256 -0.176,-0.432 -0.096,-0.192 -0.32,-0.4 -0.224,-0.208 -0.368,-0.32 -0.144,-0.128 -0.464,-0.304 -0.304,-0.192 -0.432,-0.256 -0.128,-0.064 -0.48,-0.224 -0.336,-0.176 -0.4,-0.208 l 0,4.064 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 6.352,-8.384 q 0,-0.352 -0.144,-0.688 -0.128,-0.352 -0.288,-0.576 -0.16,-0.224 -0.48,-0.496 -0.32,-0.272 -0.512,-0.4 -0.192,-0.144 -0.592,-0.384 -0.384,-0.24 -0.496,-0.32 0.032,0.432 0.352,0.832 0.32,0.384 0.704,0.656 0.4,0.272 0.816,0.72 0.432,0.432 0.624,0.912 0.016,-0.176 0.016,-0.256 z m 0.016,2.128 q 0,-0.208 -0.048,-0.4 -0.032,-0.192 -0.08,-0.336 -0.048,-0.16 -0.176,-0.336 -0.128,-0.176 -0.208,-0.288 -0.08,-0.112 -0.272,-0.272 -0.192,-0.176 -0.288,-0.256 -0.096,-0.08 -0.352,-0.256 -0.24,-0.176 -0.336,-0.224 -0.096,-0.064 -0.384,-0.24 -0.288,-0.192 -0.384,-0.256 0.032,0.464 0.368,0.88 0.336,0.416 0.736,0.704 0.4,0.272 0.816,0.688 0.416,0.416 0.576,0.864 0.032,-0.192 0.032,-0.272 z m -0.016,1.936 q 0,-0.848 -0.624,-1.504 -0.608,-0.672 -1.872,-1.392 0.064,0.464 0.384,0.896 0.336,0.416 0.72,0.688 0.4,0.272 0.8,0.704 0.4,0.416 0.576,0.88 0.016,-0.064 0.016,-0.272 z" />\n                    </g>\n                </g>'}return[s.replace("</svg>","".concat(t,"</svg>")),e.docks,e.getWidth(),e.getHeight(),e.getHeight()]}},{key:"setup",value:function(t){t.blocks.protoBlockDict[this.name]=this,t.beginnerMode&&!this.beginnerModeBlock&&(this.hidden=!0),this._style.name&&this.adjustWidthToLabel(),this.palette?this.palette.add(this):console.warn("Block "+this.name+" was not added to a palette!")}}])})(),ValueBlock=(()=>{function s(t,e){return _classCallCheck(this,s),(t=_callSuper(this,s,[t])).formBlock({name:e=e||void 0,flows:{left:!0,type:"value"}},!!e),t}return _inherits(s,BaseBlock),_createClass(s)})(),BooleanBlock=(()=>{function e(t){return _classCallCheck(this,e),(t=_callSuper(this,e,[t])).formBlock({flows:{left:!0,type:"value"},outType:"booleanout"}),t}return _inherits(e,BaseBlock),_createClass(e)})(),BooleanSensorBlock=(()=>{function s(t,e){return _classCallCheck(this,s),(t=_callSuper(this,s,[t])).formBlock({name:e=e||void 0,flows:{left:!0,type:"value"},outType:"booleanout"}),t}return _inherits(s,BaseBlock),_createClass(s)})(),FlowBlock=(()=>{function s(t,e){return _classCallCheck(this,s),(t=_callSuper(this,s,[t])).formBlock({name:e=e||void 0,flows:{top:!0,bottom:!0}},!!e),t}return _inherits(s,BaseBlock),_createClass(s)})(),LeftBlock=(()=>{function s(t,e){return _classCallCheck(this,s),(t=_callSuper(this,s,[t])).formBlock({name:e=e||void 0,flows:{left:!0,type:null}},!!e),t}return _inherits(s,BaseBlock),_createClass(s)})(),FlowClampBlock=(()=>{function e(t){return _classCallCheck(this,e),(t=_callSuper(this,e,[t])).extraWidth=20,t.formBlock({flows:{type:"flow",labels:[""]}}),t}return _inherits(e,FlowBlock),_createClass(e)})(),StackClampBlock=(()=>{function e(t){return _classCallCheck(this,e),(t=_callSuper(this,e,[t])).extraWidth=40,t.formBlock({flows:{top:"cap",bottom:"tail",type:"flow",labels:[""]}}),t}return _inherits(e,BaseBlock),_createClass(e)})();"undefined"!=typeof module&&module.exports&&(module.exports=ProtoBlock);
var _TACAT;function _createForOfIteratorHelper(e,r){var t,o,n,i,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return n=!(o=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){n=!0,t=e},f:function(){try{o||null==a.return||a.return()}finally{if(n)throw t}}};if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length)return a&&(e=a),i=0,{s:r=function(){},n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){var t;if(e)return"string"==typeof e?_arrayLikeToArray(e,r):"Map"===(t="Object"===(t={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=Array(r);t<r;t++)o[t]=e[t];return o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,r){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);t=t.call(e,r||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT={rest:"ignore",square:"ignore",triangle:"ignore",sine:"ignore",sawtooth:"ignore",invert2:"ignore",invert:"ignore",rhythm:"ignore",rhythmruler:"ignore",swing:"ignore",newswing:"ignore",rhythmicdot:"ignore",note:"ignore",harmonic:"ignore",neighbor:"ignore",setvoice:"ignore",synthname:"ignore",setkey:"ignore",drum:"ignore",saveabc:"ignore",savelilypond:"ignore",savesvg:"ignore",flat:"ignore",sharp:"ignore",diminished:"ignore",augmented:"ignore",perfect:"ignore",minor:"ignore",major:"ignore",invertmode:"pitchfactor",transpositionfactor:"pitchfactor",consonantstepsizedown:"pitchfactor",consonantstepsizeup:"pitchfactor",deltapitch:"pitchfactor",mypitch:"pitchfactor",setpitchnumberoffset:"pitchfactor",number2pitch:"pitchfactor",number2octave:"pitchfactor",accidentalname:"ignore",eastindiansolfege:"ignore",notename:"ignore",solfege:"ignore",invert1:"transpose",register:"transpose",settransposition:"transpose",setratio:"transpose",interval:"pitch",accidental:"pitch",hertz:"pitch",pitchnumber:"pitch",scaledegree:"pitch",steppitch:"pitch",pitch:"pitch",oscillator:"ignore",filtertype:"ignore",oscillatortype:"ignore",envelope:"ignore",filter:"ignore",tuplet2:"rhythm",tuplet3:"rhythm",tuplet4:"rhythm",stuplet:"rhythm",rhythm2:"rhythm",timbre:"ignore",modewidget:"ignore",tempo:"ignore",temperament:"ignore",pitchdrummatrix:"ignore",pitchslider:"ignore",musickeyboard:"ignore",pitchstaircase:"ignore",rhythmruler2:"ignore",matrix:"ignore",status:"ignore",mynotevalue:"rhythmfactor",duplicatefactor:"rhythmfactor",skipfactor:"rhythmfactor",osctime:"rhythm",newswing2:"rhythm",backward:"rhythm",skipnotes:"rhythm",duplicatenotes:"rhythm",multiplybeatfactor:"rhythm",tie:"rhythm",rhythmicdot2:"rhythm",rest2:"note",newnote:"note",beatfactor:"rhythmfactor",bpmfactor:"rhythmfactor",measurevalue:"rhythmfactor",beatvalue:"rhythmfactor",notecounter:"rhythmfactor",elapsednotes:"rhythmfactor",elapsednotes2:"rhythmfactor",drift:"rhythmfactor",offbeatdo:"rhythm",onbeatdo:"rhythm",setmasterbpm2:"rhythm",setmasterbpm:"rhythm",setbpm2:"rhythm",setbpm:"rhythm",pickup:"rhythm",meter:"rhythm",staccatofactor:"tonefactor",slurfactor:"tonefactor",amsynth:"ignore",fmsynth:"ignore",duosynth:"ignore",partial:"tone",harmonic2:"tone",neighbor2:"tone",dis:"tone",tremolo:"tone",phaser:"tone",chorus:"tone",vibrato:"tone"},"setvoice","tone"),"glide","tone"),"slur","tone"),"staccato","tone"),"newslur","tone"),"newstaccato","tone"),"synthname","tone"),"voicename","tone"),"settimbre","tone"),"settemperament","tone"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"modename","ignore"),"doubly","pitchchord"),"intervalname","ignore"),"intervalnumber","ignore"),"currentinterval","ignore"),"measureintervalsemitones","pitchfactor"),"measureintervalscalar","pitchfactor"),"arpeggio","pitchchord"),"chordname","ignore"),"chordinterval","pitchchord"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"semitoneinterval","pitchchord"),"interval","pitchchord"),"ratiointerval","pitchchord"),"definemode","pitchchord"),"movable","pitchchord"),"modelength","pitchfactor"),"key","pitchchord"),"setkey2","pitchchord"),"drumname","ignore"),"effectsname","ignore"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"setdrum","tone"),"playdrum","tone"),"heading","coord"),"y","coord"),"x","coord"),"clear","forward"),"controlpoint2","ignore"),"controlpoint1","ignore"),"bezier","arc"),"arc","arc"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"setheading","setxy"),"setxy","setxy"),"right","forward"),"left","forward"),"back","forward"),"forward","forward"),"beginfill","fill"),"endfill","fill"),"fillscreen","fill"),"grey","pen"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"shade","pen"),"color","pen"),"pensize","pen"),"setfont","pen"),"background","fill"),"hollowline","fill"),"fill","fill"),"penup","pen"),"pendown","pen"),"setpensize","pen"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"settranslucency","pen"),"sethue","pen"),"setshade","pen"),"setgrey","pen"),"setcolor","pen"),"int","boolean"),"not","boolean"),"and","boolean"),"or","boolean"),"greater","boolean"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"less","boolean"),"equal","boolean"),"boolean","boolean"),"eval","ignore"),"mod","number"),"power","number"),"sqrt","number"),"abs","number"),"divide","number"),"multiply","number"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"neg","number"),"minus","number"),"plus","number"),"oneOf","random"),"random","random"),"number","ignore"),"incrementOne","box"),"increment","box"),"box","ignore"),"namedbox","ignore"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"storein2","box"),"storein","box"),"do","action"),"return","action"),"returnToUrl","action"),"calc","action"),"namedcalc","action"),"nameddoArg","action"),"namedcalcArg","action"),"doArg","action"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"calcArg","action"),"arg","action"),"namedarg","action"),"listen","action"),"dispatch","action"),"start","ignore"),"action","action"),"nameddo","action"),"loaHeapFromApp","box"),"saveHeapToApp","box"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"showHeap","box"),"heapLength","box"),"heapEmpty","box"),"emptyHeap","box"),"saveHeap","programming"),"loadHeap","programming"),"indexHeap","box"),"setHeapEntry","box"),"pop","box"),"push","box"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"getDict","box"),"setDict","box"),"leftpos","ignore"),"rightpos","ignore"),"toppos","ignore"),"bottompos","ignore"),"width","ignore"),"height","ignore"),"stopplayback","ignore"),"playback","ignore"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"speak","media"),"camera","ignore"),"video","ignore"),"loadFile","ignore"),"stopvideocam","ignore"),"tone","media"),"tofrequency","media"),"turtleshell","media"),"show","media"),"media","ignore"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"text","ignore"),"hiddennoflow","ignore"),"hidden","ignore"),"defaultcase","ignore"),"case","ignore"),"switch","iften"),"clamp","ignore"),"break","ignore"),"waitFor","ifthen"),"until","ifthen"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"while","ifthen"),"ifthenelse","ifthen"),"if","ifthen"),"forever","repeat"),"repeat","repeat"),"nopValueBlock","ignore"),"nopOneArgMathBlock","ignore"),"nopTwoArgMathBlock","ignore"),"nopZeroArgBlock","ignore"),"nopOneArgBlock","ignore"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"nopTwoArgBlock","ignore"),"nopThreeArgBlock","ignore"),"openpalette","programming"),"deleteblock","programming"),"moveblock","programming"),"runblock","programming"),"dockblock","programming"),"makeblock","programming"),"saveabc","ignore"),"savelilypond","ignore"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"savesvg","ignore"),"nobackground","ignore"),"showblocks","ignore"),"hideblocks","ignore"),"openProject","ignore"),"vspace","ignore"),"hspace","ignore"),"wait","ignore"),"comment","ignore"),"print","ignore"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"pitchness","sensor"),"loudness","sensor"),"myclick","sensor"),"getblue","sensor"),"getgreen","sensor"),"getred","sensor"),"getcolorpixel","sensor"),"time","sensor"),"mousey","sensor"),"mousex","sensor"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"mousebutton","sensor"),"toascii","sensor"),"keyboard","sensor"),"stopTurtle","mice"),"startTurtle","mice"),"turtlecolor","mice"),"turtleheading","mice"),"setxyturtle","mice"),"yturtle","mice"),"xturtle","mice"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"turtleelapsednotes","mice"),"turtlepitch","mice"),"turtlenote","mice"),"turtlenote2","mice"),"turtlesync","mice"),"turtlename","ignore"),"setturtlename","mice"),"setturtlename2","mice"),"notevolumefactor","tone"),"setsynthvolume2","tone");var TACAT=_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TACAT,"setsynthvolume","tone"),"setnotevolume","tone"),"setnotevolume2","tone"),"articulation","tone"),"crescendo","tone"),TAPAL={beat:"notesp",note:"notesp",rhythm:"notesp",rhythmfactor:"notesp",pitch:"pitchp",pitchchord:"pitchp",transpose:"pitchp",pitchfactor:"pitchp",tone:"tonep",forward:"turtlep",arc:"turtlep",coord:"turtlep",setxy:"turtlep",pen:"penp",fill:"penp",random:"numberp",boolean:"numberp",repeat:"flowp",ifthen:"flowp",action:"boxp",box:"boxp",sensor:"sensorp",media:"mediap",mice:"micep",number:"numberp",programming:"numberp",ignore:"numberp"},TASCORE={note:1,beat:10,rhythm:5,rhythmfactor:5,pitchchord:3,pitch:1,transpose:5,pitchfactor:5,tone:5,forward:3,arc:3,setxy:2.5,coord:4,turtlep:5,pen:2.5,fill:2.5,penp:5,number:.5,boolean:2.5,random:2.5,repeat:2.5,ifthen:5,flowp:2.5,box:2.5,action:2.5,boxp:0,media:5,mediap:0,programming:5,mice:7.5,micep:2.5,ignore:0,sensor:5,sensorp:0},PALS=["notesp","pitchp","tonep","turtlep","penp","numberp","flowp","boxp","sensorp","mediap","micep"],PALLABELS=[_("rhythm"),_("pitch"),_("tone"),_("mouse"),_("pen"),_("number"),_("flow"),_("action"),_("sensors"),_("media"),_("mice")],analyzeProject=function(e){for(var r=[],t=0;t<e.blocks.blockList.length;t++)if(!e.blocks.blockList[t].trash){switch(e.blocks.blockList[t].name){case"rhythmicdot":case"tie":case"drift":case"osctime":case"sharp":case"flat":case"fill":case"hollowline":case"start":if(null==e.blocks.blockList[t].connections[1])continue;break;case"note":case"multiplybeatfactor":case"duplicatenotes":case"skipnotes":case"setbpm":case"settransposition":case"staccato":case"slur":case"swing":case"crescendo":case"setnotevolume2":case"vibrato":case"tremolo":case"dis":case"chorus":case"phaser":case"action":if(null==e.blocks.blockList[t].connections[2])continue;break;case"tuplet2":if(null==e.blocks.blockList[t].connections[3])continue;break;case"invert":if(null==e.blocks.blockList[t].connections[4])continue;break;default:if(null==e.blocks.blockList[t].connections[0]&&null==last(e.blocks.blockList[t].connections))continue}r.push(e.blocks.blockList[t].name)}for(var o=[],n=0;n<PALS.length;n++)o.push(0);for(var i=[],a=[],p=0;p<r.length;p++)r[p]in TACAT?TACAT[r[p]]in i||i.push(TACAT[r[p]]):console.debug(r[p]+" not in catalog");for(var s=0;s<i.length;s++)i[s]in TAPAL&&(TAPAL[i[s]]in a||a.push(TAPAL[i[s]]));for(var c=0;c<i.length;c++)i[c]in TASCORE&&(o[PALS.indexOf(TAPAL[i[c]])]+=TASCORE[i[c]]);for(var f=0;f<a.length;f++)a[f]in TASCORE&&(o[PALS.indexOf(a[f])]+=TASCORE[a[f]]);return o},scoreToChartData=function(e){for(var r=[],t=0,o=0;o<e.length;o++)t<e[o]&&(t=e[o]);var n=0<t?100/t:1;1<n&&(n=1);for(var i=0;i<e.length;i++)r.push(e[i]*n);return{labels:PALLABELS,datasets:[{label:"",fillColor:"rgba(220,220,220,0.4)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:r}]}},getChartOptions=function(e){return{onAnimationComplete:e,scaleShowLine:!0,angleShowLineOut:!0,scaleShowLabels:!1,scaleBeginAtZero:!0,angleLineColor:"rgba(0,0,0,.2)",angleLineWidth:10,pointLabelFontFamily:"Arial",pointLabelFontStyle:"normal",pointLabelFontSize:30,pointLabelFontColor:"#666",pointDot:!0,pointDotRadius:18,pointDotStrokeWidth:6,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:12,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'}},runAnalytics=function(e){var r=e.logo,t=e.turtles;r.runningLilypond=!0,r.notationNotes={};for(var o=0;o<t.getTurtleCount();o++)r.notation.notationStaging[o]=[],r.notation.notationDrumStaging[o]=[],t.getTurtle(o).painter.doClear(!0,!0,!0);document.body.style.cursor="wait",r.collectingStats=!0,r.runLogoCommands()},getStatsFromNotation=function(o){var e,n={},r=o.logo.notation,i=(n.duples=0,n.triplets=0,n.quintuplets=0,n.pitchNames=new Set,n.articulation={begin:[],end:[]},n.pitches=[],n.numberOfNotes=0);for(e in r.notationStaging)for(var t in r.notationStaging[e]){var a=r.notationStaging[e][t];if("object"==_typeof(a)&&a[0].length){var p,s=_createForOfIteratorHelper(a[0]);try{for(s.s();!(p=s.n()).done;)(()=>{var e,r,t=p.value;isCustomTemperament(o.logo.synth.inTemperament)?(e=o.logo.synth.getCustomFrequency(t,o.logo.synth.inTemperament),0<(r=getTemperament(o.logo.synth.inTemperament).filter(function(e){return e[3]===t.slice(0,t.length-1)})).length&&(t=r[0][1]+t[t.length-1])):e=o.logo.synth._getFrequency(t),""===t.slice(0,t.length-1)?n.pitchNames.add("R"):n.pitchNames.add(t.slice(0,t.length-1)),n.pitches.push(e),null==n.lowestNote?isNaN(e)||(n.lowestNote=[t,i,e]):e<n.lowestNote[2]&&(n.lowestNote=[t,i,e]),null==n.highestNote?isNaN(e)||(n.highestNote=[t,i,e]):e>n.highestNote[2]&&(n.highestNote=[t,i,e]),n.numberOfNotes++,i++})()}catch(e){s.e(e)}finally{s.f()}}2==a[1]?n.duples++:3==a[1]?n.triplets++:5==a[1]&&n.quintuplets++,"string"!=typeof a||"begin articulation"!=a&&"end articulation"!=a||n.articulation.begin.push(t)}var c,f=o.blocks.blockList,d=(n.rests=0,n.ornaments=0,_createForOfIteratorHelper(f));try{for(d.s();!(c=d.n()).done;){var l=c.value;l.trash||("rest2"===l.name&&n.rests++,"ornaments"===l.protoblock.palette.name&&n.ornaments++)}}catch(e){d.e(e)}finally{d.f()}return n};"undefined"!=typeof module&&module.exports&&(module.exports={TACAT:TACAT,TAPAL:TAPAL,TASCORE:TASCORE,PALS:PALS,PALLABELS:PALLABELS,analyzeProject:analyzeProject,scoreToChartData:scoreToChartData,getChartOptions:getChartOptions,runAnalytics:runAnalytics,getStatsFromNotation:getStatsFromNotation});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var themeConfigs={dark:{textColor:"#E2E2E2",blockText:"#E2E2E2",dialogueBox:"#1C1C1C",strokeColor:"#E2E2E2",fillColor:"#F9F9F9",blueButton:"#0066FF",blueButtonHover:"#023a76",cancelButton:"#f1f1f1",cancelButtonHover:"#afafaf",hoverColor:"#808080",widgetButton:"#225A91",widgetButtonSelect:"#979797",widgetBackground:"#454545",disconnected:"#5C5C5C",header:"#1E88E5",aux:"#1976D2",sub:"#64B5F6",rule:"#303030",ruleColor:"#303030",trashColor:"#757575",trashBorder:"#424242",trashActive:"#E53935",background:"#303030",paletteSelected:"#1E1E1E",paletteBackground:"#1C1C1C",paletteLabelBackground:"#022363",paletteLabelSelected:"#01143b",paletteText:"#BDBDBD",rulerHighlight:"#FFEB3B",selectorBackground:"#64B5F6",selectorSelected:"#1E88E5",labelColor:"#BDBDBD",rhythmcellcolor:"#303030",stopIconcolor:"#D50000",hitAreaGraphicsBeginFill:"#121212",orange:"#FB8C00"},light:{textColor:"black",blockText:"#282828",dialogueBox:"#fff",strokeColor:"#E2E2E2",fillColor:"#F9F9F9",blueButton:"#0066FF",blueButtonHover:"#023a76",cancelButton:"#f1f1f1",cancelButtonHover:"#afafaf",hoverColor:"#E0E0E0",widgetBackground:"#ccc",widgetButton:"#8cc6ff",widgetButtonSelect:"#C8C8C8",disconnected:"#C4C4C4",header:"#4DA6FF",aux:"#1A8CFF",sub:"#8CC6FF",rule:"#E2E2E2",ruleColor:"#E2E2E2",trashColor:"#C0C0C0",trashBorder:"#808080",trashActive:"#FF0000",background:"#F9F9F9",paletteSelected:"#F3F3F3",paletteBackground:"#FFFFFF",paletteLabelBackground:"#8CC6FF",paletteLabelSelected:"#1A8CFF",paletteText:"#666666",rulerHighlight:"#FFBF00",selectorBackground:"#8CC6FF",selectorSelected:"#1A8CFF",labelColor:"#a0a0a0",rhythmcellcolor:"#c8c8c8",stopIconcolor:"#ea174c",hitAreaGraphicsBeginFill:"#FFF",orange:"#e37a00"}},ThemeBox=(()=>_createClass(function e(t){_classCallCheck(this,e),this.activity=t,this._theme=t.storage.themePreference||"light",this._themes=["light","dark"]},[{key:"light_onclick",value:function(){this._theme="light",this.setPreference()}},{key:"dark_onclick",value:function(){this._theme="dark",this.setPreference()}},{key:"applyThemeInstantly",value:function(){var t=this,o=document.body,e=(this._themes.forEach(function(e){e===t._theme?o.classList.add(e):o.classList.remove(e)}),themeConfigs[this._theme]&&Object.assign(window.platformColor,themeConfigs[this._theme]),document.querySelector("meta[name=theme-color]")),e=(e&&window.platformColor&&(e.content=window.platformColor.header),document.getElementById("canvas"));e&&(e.style.backgroundColor=window.platformColor.background),this.activity.turtles&&(this.activity.turtles._locked=!1,this.activity.turtles._backgroundColor=window.platformColor.background,this.activity.turtles.makeBackground(),this.activity.refreshCanvas()),this.updateThemeIcon(),this.refreshUIComponents(),this.activity.textMsg(_("Theme switched to "+this._theme+" mode."),2e3)}},{key:"updateThemeIcon",value:function(){var e,t=document.getElementById("themeSelectIcon");t&&(e=document.getElementById(this._theme))&&(t.innerHTML=e.innerHTML)}},{key:"refreshUIComponents",value:function(){var t=this;if(this.activity.palettes)try{var e=document.getElementById("palette");e&&e.childNodes[0]&&(e.childNodes[0].style.border="1px solid ".concat(window.platformColor.selectorSelected))}catch(e){console.debug("Could not refresh palette:",e)}document.querySelectorAll("#floatingWindows > .windowFrame").forEach(function(e){"dark"===t._theme?(e.style.backgroundColor="#454545",e.style.borderColor="#000000"):(e.style.backgroundColor="",e.style.borderColor="")}),this.activity.refreshCanvas&&this.activity.refreshCanvas();e=document.getElementById("planet-iframe");if(e&&e.contentDocument)try{var o=e.contentDocument.body;o&&this._themes.forEach(function(e){e===t._theme?o.classList.add(e):o.classList.remove(e)})}catch(e){console.debug("Could not update planet iframe theme:",e)}}},{key:"reload",value:function(){window.location.reload()}},{key:"setPreference",value:function(){if(localStorage.getItem("themePreference")===this._theme)this.activity.textMsg(_("Music Blocks is already set to this theme."));else{this.activity.storage.themePreference=this._theme;try{localStorage.setItem("themePreference",this._theme)}catch(e){console.warn("Could not save theme preference:",e)}this.applyThemeInstantly()}}}]))();"undefined"!=typeof module&&module.exports&&(module.exports=ThemeBox);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var WRAP=!0,$j=jQuery.noConflict(),play_button_debounce_timeout=null,Toolbar=(()=>_createClass(function e(){var n=this;_classCallCheck(this,e),_defineProperty(this,"disableTooltips",function(e){e(".tooltipped").tooltip("remove"),n.tooltipsDisabled=!0}),_defineProperty(this,"closeAuxToolbar",function(e){var t=docById("aux-toolbar");"block"===t.style.display&&(e(n.activity,!1),e=docById("menu"),t.style.display="none",e.innerHTML="menu",docById("toggleAuxBtn").className-="blue darken-1")}),this.stopIconColorWhenPlaying=window.platformColor.stopIconcolor,this.language=localStorage.languagePreference,void 0===this.language&&(this.language=navigator.language),this.tooltipsDisabled=!1},[{key:"init",value:function(e){this.activity=e,n=_THIS_IS_MUSIC_BLOCKS_?(t=[["mb-logo",_("About Music Blocks")],["play",_("Play")],["stop",_("Stop")],["record",_("Record")],["Full screen",_("Full screen")],["FullScreen",_("Full screen")],["Toggle Fullscreen",_("Toggle Fullscreen")],["newFile",_("New project")],["load",_("Load project from file")],["saveButton",_("Save project")],["saveButtonAdvanced",_("Save project as HTML")],["planetIcon",_("Find and share projects")],["planetIconDisabled",_("Offline. Sharing is unavailable")],["toggleAuxBtn",_("Auxiliary menu")],["helpIcon",_("Help")],["runSlowlyIcon",_("Run slowly")],["runStepByStepIcon",_("Run step by step")],["displayStatsIcon",_("Display statistics")],["loadPluginIcon",_("Load plugin")],["delPluginIcon",_("Delete plugin")],["enableHorizScrollIcon",_("Enable horizontal scrolling")],["disableHorizScrollIcon",_("Disable horizontal scrolling")],["themeSelectIcon",_("Change theme")],["light",_("Light Mode")],["dark",_("Dark Mode")],["mergeWithCurrentIcon",_("Merge with current project")],["chooseKeyIcon",_("Set Pitch Preview")],["toggleJavaScriptIcon",_("JavaScript Editor")],["restoreIcon",_("Restore")],["beginnerMode",_("Switch to beginner mode")],["advancedMode",_("Switch to advanced mode")],["languageSelectIcon",_("Select language")],["save-html-beg",_("Save project as HTML"),"innerHTML"],["save-png-beg",_("Save mouse artwork as PNG"),"innerHTML"],["save-html",_("Save project as HTML"),"innerHTML"],["save-midi",_("Save project as MIDI"),"innerHTML"],["save-svg",_("Save mouse artwork as SVG"),"innerHTML"],["save-png",_("Save mouse artwork as PNG"),"innerHTML"],["save-wav",_("Save music as WAV"),"innerHTML"],["save-abc",_("Save sheet music as ABC"),"innerHTML"],["save-ly",_("Save sheet music as Lilypond"),"innerHTML"],["save-mxml",_("Save sheet music as MusicXML"),"innerHTML"],["save-blockartwork-svg",_("Save block artwork as SVG"),"innerHTML"],["save-blockartwork-png",_("Save block artwork as PNG"),"innerHTML"],["new-project",_("Confirm"),"innerHTML"],["enUS",_("English (United States)"),"innerHTML"],["enUK",_("English (United Kingdom)"),"innerHTML"],["ja",_("日本語"),"innerHTML"],["ko",_("한국어"),"innerHTML"],["es",_("español"),"innerHTML"],["pt",_("português"),"innerHTML"],["kana",_("にほんご"),"innerHTML"],["zhCN",_("中文"),"innerHTML"],["th",_("ภาษาไทย"),"innerHTML"],["tr",_("Turkish"),"innerHTML"],["ayc",_("aymara"),"innerHTML"],["quz",_("quechua"),"innerHTML"],["gug",_("guarani"),"innerHTML"],["hi",_("हिंदी"),"innerHTML"],["ibo",_("igbo"),"innerHTML"],["ar",_("عربى"),"innerHTML"],["te",_("తెలుగు"),"innerHTML"],["he",_("עִברִית"),"innerHTML"],["ur",_("اردو"),"innerHTML"]],[_("About Music Blocks"),_("Play"),_("Stop"),_("Record"),_("Full screen"),_("Full screen"),_("Toggle Fullscreen"),_("New project"),_("Load project from file"),_("Save project"),_("Save project"),_("Find and share projects"),_("Offline. Sharing is unavailable"),_("Auxiliary menu"),_("Help"),_("Run slowly"),_("Run step by step"),_("Display statistics"),_("Load plugin"),_("Delete plugin"),_("Enable horizontal scrolling"),_("Disable horizontal scrolling"),_("Change theme"),_("Light Mode"),_("Dark Mode"),_("Merge with current project"),_("Set Pitch Preview"),_("JavaScript Editor"),_("Restore"),_("Switch to beginner mode"),_("Switch to advanced mode"),_("Select language"),_("Save project as HTML"),_("Save project as MIDI"),_("Save mouse artwork as SVG"),_("Save mouse artwork as PNG"),_("Save music as WAV"),_("Save sheet music as ABC"),_("Save sheet music as Lilypond"),_("Save block artwork as SVG"),_("Save block artwork as PNG"),_("Confirm"),_("Select language"),_("Save project as HTML"),_("Save turtle artwork as PNG"),_("Save project as HTML"),_("Save turtle artwork as SVG"),_("Save turtle artwork as PNG"),_("Save block artwork as SVG"),_("Save block artwork as PNG"),_("Confirm"),_("English (United States)"),_("English (United Kingdom)"),_("日本語"),_("한국인"),_("español"),_("português"),_("にほんご"),_("中文"),_("ภาษาไทย"),_("Turkish"),_("aymara"),_("quechua"),_("guarani"),_("हिंदी"),_("తెలుగు"),_("igbo"),_("عربى"),_("עִברִית"),_("اردو")]):(t=[["mb-logo",_("About Turtle Blocks")],["play",_("Play")],["stop",_("Stop")],["record",_("Record")],["Full screen",_("Full screen")],["FullScreen",_("Full screen")],["Toggle Fullscreen",_("Toggle Fullscreen")],["newFile",_("New project")],["load",_("Load project from file")],["saveButton",_("Save project")],["saveButtonAdvanced",_("Save project as HTML")],["planetIcon",_("Find and share projects")],["planetIconDisabled",_("Offline. Sharing is unavailable")],["toggleAuxBtn",_("Auxiliary menu")],["helpIcon",_("Help")],["runSlowlyIcon",_("Run slowly")],["runStepByStepIcon",_("Run step by step")],["displayStatsIcon",_("Display statistics")],["loadPluginIcon",_("Load plugin")],["delPluginIcon",_("Delete plugin")],["enableHorizScrollIcon",_("Enable horizontal scrolling")],["disableHorizScrollIcon",_("Disable horizontal scrolling")],["themeSelectIcon",_("Change theme")],["light",_("Light Mode")],["dark",_("Dark Mode")],["mergeWithCurrentIcon",_("Merge with current project")],["toggleJavaScriptIcon",_("JavaScript Editor")],["restoreIcon",_("Restore")],["beginnerMode",_("Switch to beginner mode")],["advancedMode",_("Switch to advanced mode")],["languageSelectIcon",_("Select language")],["save-html-beg",_("Save project as HTML"),"innerHTML"],["save-png-beg",_("Save turtle artwork as PNG"),"innerHTML"],["save-html",_("Save project as HTML"),"innerHTML"],["save-svg",_("Save turtle artwork as SVG"),"innerHTML"],["save-png",_("Save turtle artwork as PNG"),"innerHTML"],["save-blockartwork-svg",_("Save block artwork as SVG"),"innerHTML"],["save-blockartwork-png",_("Save block artwork as PNG"),"innerHTML"],["new-project",_("Confirm"),"innerHTML"],["enUS",_("English (United States)"),"innerHTML"],["enUK",_("English (United Kingdom)"),"innerHTML"],["ja",_("日本語"),"innerHTML"],["ko",_("한국인"),"innerHTML"],["es",_("español"),"innerHTML"],["pt",_("português"),"innerHTML"],["kana",_("にほんご"),"innerHTML"],["zhCN",_("中文"),"innerHTML"],["th",_("ภาษาไทย"),"innerHTML"],["tr",_("Turkish"),"innerHTML"],["ayc",_("aymara"),"innerHTML"],["quz",_("quechua"),"innerHTML"],["gug",_("guarani"),"innerHTML"],["hi",_("हिंदी"),"innerHTML"],["ibo",_("igbo"),"innerHTML"],["ar",_("عربى"),"innerHTML"],["te",_("తెలుగు"),"innerHTML"],["he",_("עִברִית"),"innerHTML"],["ur",_("اردو"),"innerHTML"]],[_("About Turtle Blocks"),_("Play"),_("Stop"),_("Record"),_("Full screen"),_("Full screen"),_("Toggle Fullscreen"),_("New project"),_("Load project from file"),_("Save project"),_("Save project as HTML"),_("Find and share projects"),_("Offline. Sharing is unavailable"),_("Auxiliary menu"),_("Help"),_("Run slowly"),_("Run step by step"),_("Display statistics"),_("Load plugin"),_("Delete plugin"),_("Enable horizontal scrolling"),_("Disable horizontal scrolling"),_("Change theme"),_("Light Mode"),_("Dark Mode"),_("Merge with current project"),_("JavaScript Editor"),_("Restore"),_("Switch to beginner mode"),_("Switch to advanced mode"),_("Select language"),_("Save project as HTML"),_("Save turtle artwork as PNG"),_("Save project as HTML"),_("Save turtle artwork as SVG"),_("Save turtle artwork as PNG"),_("Save block artwork as SVG"),_("Save block artwork as PNG"),_("Confirm"),_("English (United States)"),_("English (United Kingdom)"),_("日本語"),_("한국인"),_("español"),_("português"),_("にほんご"),_("中文"),_("ภาษาไทย"),_("Turkish"),_("aymara"),_("quechua"),_("guarani"),_("हिंदी"),_("తెలుగు"),_("igbo"),_("عربى"),_("עִברִית"),_("اردو")]);var t,n,e=docById("beginnerMode"),o=docById("advancedMode");this.activity.beginnerMode?(o.style.display="block",e.style.display="none"):(o.style.display="none",e.style.display="display");for(var i=0;i<t.length;i++){var a=t[i],c=n[i],l=docById(a[0]);3===t[i].length?null!=l&&(l.innerHTML=a[1]):null!=l&&l.setAttribute("data-tooltip",c)}this.tooltipsDisabled||$j(".tooltipped").tooltip({html:!0,delay:100}),$j(".tooltipped").on("click",function(){$j(this).tooltip("close")}),$j(".materialize-iso, .dropdown-trigger").dropdown({constrainWidth:!1,hover:!1,belowOrigin:!0})}},{key:"renderLogoIcon",value:function(e){var t=this,n=docById("mb-logo");"ja"===this.language&&(n.innerHTML='<img style="width: 100%; transform: scale(0.85);" src="images/logo-ja.svg">'),n.onmouseenter=function(){document.body.style.cursor="pointer"},n.onmouseleave=function(){document.body.style.cursor="default"},n.onclick=function(){e(t.activity)}}},{key:"renderPlayIcon",value:function(e){var t=this,n=docById("play"),o=docById("stop"),i=docById("record"),a=!1;function c(){a?(n.onclick=l,a=!1):(n.onclick=null,console.log("Wait for next 2 seconds to play the music"))}var l=n.onclick=function(){a=!1,e(t.activity),c(),o.style.color=t.stopIconColorWhenPlaying,saveButton.disabled=!0,saveButtonAdvanced.disabled=!0,saveButtonAdvanced.className=saveButton.className="grey-text inactiveLink",i.className="grey-text inactiveLink",a=!0,play_button_debounce_timeout=setTimeout(function(){c()},2e3),o.addEventListener("click",function(){clearTimeout(play_button_debounce_timeout),a=!0,t.activity.hideMsgs(),c()})}}},{key:"renderStopIcon",value:function(e){var t=this,n=docById("stop"),o=docById("record");n.onclick=function(){e(t.activity),n.style.color="white",saveButton.disabled=!1,saveButtonAdvanced.disabled=!1,saveButtonAdvanced.className=saveButton.className="",o.className=""}}},{key:"renderNewProjectIcon",value:function(e){var t=this,n=docById("modal-container"),o=docById("newdropdown"),i=(o.innerHTML="",document.createElement("div")),i=(i.classList.add("new-project-title"),i.textContent=_("New project"),o.appendChild(i),document.createElement("div")),i=(i.id="confirmation-message",i.textContent=_("Are you sure you want to create a new project?"),o.appendChild(i),document.createElement("li")),a=document.createElement("div"),i=(a.classList.add("confirm-button"),a.id="new-project",a.textContent=_("Confirm"),i.appendChild(a),o.appendChild(i),n.style.display="flex",a.onclick=function(){n.style.display="none",e(t.activity)},document.createElement("li")),a=document.createElement("div");a.classList.add("cancel-button"),a.id="cancel-project",a.textContent=_("Cancel"),i.appendChild(a),o.appendChild(i),a.onclick=function(){n.style.display="none"},n.style.display="flex"}},{key:"renderLoadIcon",value:function(e){var t=this;docById("load").onclick=function(){e(t.activity)}}},{key:"renderThemeSelectIcon",value:function(t,e){var n=this,o=document.getElementById("themeSelectIcon"),i=(e.forEach(function(e){localStorage.themePreference===e&&(o.innerHTML=document.getElementById(e).innerHTML)}),docById("themeSelectIcon")),a=e;i.onclick=function(){a.forEach(function(e){docById(e).onclick=function(){return t["".concat(e,"_onclick")](n.activity)}})}}},{key:"renderWrapIcon",value:function(){var e=this,t=docById("wrapTurtle"),n=_("Turtle Wrap Off");t.setAttribute("data-tooltip",n),$j(".tooltipped").tooltip({html:!0,delay:100}),t.onclick=function(){(WRAP=!WRAP)?(n=_("Turtle Wrap Off"),e.activity.textMsg(_("Turtle Wrap On"),3e3),e.activity.helpfulWheelItems.forEach(function(e){"Turtle Wrap Off"===e.label?e.display=!0:"Turtle Wrap On"===e.label&&(e.display=!1)})):(n=_("Turtle Wrap On"),e.activity.textMsg(_("Turtle Wrap Off"),3e3),e.activity.helpfulWheelItems.forEach(function(e){"Turtle Wrap Off"===e.label?e.display=!1:"Turtle Wrap On"===e.label&&(e.display=!0)})),t.setAttribute("data-tooltip",n),$j(".tooltipped").tooltip({html:!0,delay:100})}}},{key:"changeWrap",value:function(e){var t=docById("wrapTurtle"),n="";(WRAP=!WRAP)?(n=_("Turtle Wrap Off"),e.textMsg(_("Turtle Wrap On"),3e3),e.helpfulWheelItems.forEach(function(e){"Turtle Wrap Off"===e.label?e.display=!0:"Turtle Wrap On"===e.label&&(e.display=!1)})):(n=_("Turtle Wrap On"),e.textMsg(_("Turtle Wrap Off"),3e3),e.helpfulWheelItems.forEach(function(e){"Turtle Wrap Off"===e.label?e.display=!1:"Turtle Wrap On"===e.label&&(e.display=!0)})),t.setAttribute("data-tooltip",n),$j(".tooltipped").tooltip({html:!0,delay:100}),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none")}},{key:"renderSaveIcons",value:function(n,o,i,a,c,l,r,s,d,u,y){var v=this,e=docById("saveButton"),t=docById("saveButtonAdvanced");this.activity.beginnerMode?"ja"===this.language?e.onclick=function(){n(v.activity)}:(e.style.display="block",t.style.display="none",e.onclick=function(){var e=docById("save-html-beg"),e=(console.debug(e),e.onclick=function(){n(v.activity)},docById("save-png-beg"));console.debug(e),""==o(v.activity.canvas,v.activity.logo,v.activity.turtles,v.activity.canvas.width,v.activity.canvas.height,1)?(e.disabled=!0,e.className="grey-text inactiveLink"):(e.disabled=!1,e.className="",e.onclick=function(){c(v.activity)})}):(console.debug("ADVANCED MODE BUTTONS"),e.style.display="none",t.style.display="block",t.onclick=function(){docById("save-html").onclick=function(){n(v.activity)};var e=docById("save-svg"),t=docById("save-png");console.debug(t),""==o(v.activity.canvas,v.activity.logo,v.activity.turtles,v.activity.canvas.width,v.activity.canvas.height,1)?(e.disabled=!0,t.disabled=!0,e.className="grey-text inactiveLink",t.className="grey-text inactiveLink"):(e.disabled=!1,t.disabled=!1,e.className="",t.className="",e.onclick=function(){i(v.activity)},t.onclick=function(){c(v.activity)}),_THIS_IS_MUSIC_BLOCKS_&&(docById("save-midi").onclick=function(){a(v.activity)},docById("save-wav").onclick=function(){l(v.activity)},docById("save-ly").onclick=function(){r(v.activity)},docById("save-abc").onclick=function(){s(v.activity)},docById("save-mxml").onclick=function(){d(v.activity)}),docById("save-blockartwork-svg").onclick=function(){u(v.activity)},docById("save-blockartwork-png").onclick=function(){y(v.activity)}})}},{key:"updateRecordButton",value:function(e){var t=this,n=docById("record"),o=fnBrowserDetect();["firefox","safari"].includes(o)?n.classList.add("hide"):(n.style.display="block",n.innerHTML='<i class="material-icons main">'.concat(RECORDBUTTON,"</i>"),n.onclick=function(){return e(t.activity)})}},{key:"renderPlanetIcon",value:function(e,t){var n=this,o=docById("planetIcon"),i=docById("planetIconDisabled");e?o.onclick=function(){docById("toolbars").style.display="none",docById("wheelDiv").style.display="none",docById("contextWheelDiv").style.display="none",t(n.activity)}:(o.style.display="none",i.style.display="block")}},{key:"renderMenuIcon",value:function(e){var t=this,n=docById("menu"),o=docById("aux-toolbar");n.onclick=function(){docById("search").classList.toggle("open"),""==o.style.display||"none"==o.style.display?(e(t.activity,!1),o.style.display="block",n.innerHTML="more_vert",docById("toggleAuxBtn").className="blue darken-1"):(e(t.activity,!0),o.style.display="none",n.innerHTML="menu",docById("toggleAuxBtn").className-="blue darken-1",docById("chooseKeyDiv").style.display="none",docById("movable").style.display="none")}}},{key:"renderRunSlowlyIcon",value:function(e){var t=this,n=docById("runSlowlyIcon");this.activity.beginnerMode&&"ja"===this.language&&(n.style.display="none"),n.onclick=function(){e(t.activity),docById("stop").style.color=t.stopIconColorWhenPlaying}}},{key:"renderHelpIcon",value:function(e){var t=this;docById("helpIcon").onclick=function(){e(t.activity)}}},{key:"renderModeSelectIcon",value:function(n,o,i,a,c,l){function e(e){var t;r.activity.beginnerMode=!r.activity.beginnerMode;try{localStorage.setItem("beginnerMode",r.activity.beginnerMode.toString())}catch(e){console.error(e)}u(),r.tooltipsDisabled||$j(".tooltipped").tooltip({html:!0,delay:100}),$j(".materialize-iso, .dropdown-trigger").dropdown({constrainWidth:!1,hover:!1,belowOrigin:!0}),n&&n(r.activity),null!=(t=r.activity.palettes)&&t.updatePalettes&&r.activity.palettes.updatePalettes(),r.activity.refreshCanvas&&r.activity.refreshCanvas()}var r=this,s=docById("beginnerMode"),d=docById("advancedMode"),u=function(){s.style.display=r.activity.beginnerMode?"none":"block",d.style.display=r.activity.beginnerMode?"block":"none";var e=docById("record"),t=(e&&(r.activity.beginnerMode?e.style.display="none":(e.style.display="block",r.updateRecordButton(),e.onclick=function(){return o(r.activity)})),r.activity.beginnerMode?(["displayStatsIcon","loadPluginIcon","delPluginIcon","enableHorizScrollIcon","disableHorizScrollIcon","toggleJavaScriptIcon"].forEach(function(e){e=docById(e);e&&(e.style.display="none")}),r.activity.helpfulWheelItems&&r.activity.helpfulWheelItems.forEach(function(e){"Enable horizontal scrolling"===e.label&&(e.display=!1)})):((e=docById("displayStatsIcon"))&&(e.style.display="block",e.onclick=function(){return i(r.activity)}),(e=docById("loadPluginIcon"))&&(e.style.display="block",e.onclick=function(){return a(r.activity)}),(e=docById("delPluginIcon"))&&(e.style.display="block",e.onclick=function(){return c(r.activity)}),e=docById("enableHorizScrollIcon"),t=docById("disableHorizScrollIcon"),e&&(e.style.display="block",e.onclick=function(){l(r.activity)}),t&&(t.onclick=function(){l(r.activity)}),(e=docById("toggleJavaScriptIcon"))&&(e.style.display="block"),r.activity.helpfulWheelItems&&r.activity.helpfulWheelItems.forEach(function(e){"Enable horizontal scrolling"===e.label&&(e.display=!0)})),docById("saveButton")),e=docById("saveButtonAdvanced");t&&(t.style.display=r.activity.beginnerMode?"block":"none"),e&&(e.style.display=r.activity.beginnerMode?"none":"block"),r.activity.toolbar.renderSaveIcons(r.activity.save.saveHTML.bind(r.activity.save),doSVG,r.activity.save.saveSVG.bind(r.activity.save),r.activity.save.saveMIDI.bind(r.activity.save),r.activity.save.savePNG.bind(r.activity.save),r.activity.save.saveWAV.bind(r.activity.save),r.activity.save.saveLilypond.bind(r.activity.save),r.activity.save.saveAbc.bind(r.activity.save),r.activity.save.saveMxml.bind(r.activity.save),r.activity.save.saveBlockArtwork.bind(r.activity.save),r.activity.save.saveBlockArtworkPNG.bind(r.activity.save))};s.onclick=null,d.onclick=null,s.onclick=e,d.onclick=e,u()}},{key:"renderRunStepIcon",value:function(e){var t=this,n=docById("runStepByStepIcon");this.activity.beginnerMode&&"ja"===this.language&&(n.style.display="none"),n.onclick=function(){e(t.activity)}}},{key:"renderMergeIcon",value:function(e){var t=this;docById("mergeWithCurrentIcon").onclick=function(){e(t.activity)}}},{key:"renderRestoreIcon",value:function(e){var t=this;docById("restoreIcon").onclick=function(){e(t.activity)}}},{key:"renderChooseKeyIcon",value:function(e){var t,n=this;_THIS_IS_MUSIC_BLOCKS_&&(t=docById("chooseKeyIcon"),docById("chooseKeyDiv").style.display="none",t.onclick=function(){e(n.activity)})}},{key:"renderJavaScriptIcon",value:function(e){var t=this;docById("toggleJavaScriptIcon").onclick=function(){return e(t.activity)}}},{key:"renderLanguageSelectIcon",value:function(t){var n=this,e=docById("languageSelectIcon"),o=["enUS","enUK","es","pt","ko","ja","kana","zhCN","th","tr","ayc","quz","gug","hi","ibo","ar","te","he","ur"];e.onclick=function(){o.forEach(function(e){docById(e).onclick=function(){return t["".concat(e,"_onclick")](n.activity)}})}}}]))();"undefined"!=typeof module&&module.exports&&(module.exports=Toolbar);
function _typeof(i){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(i)}function _classCallCheck(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,_toPropertyKey(n.key),n)}}function _createClass(i,e,t){return e&&_defineProperties(i.prototype,e),t&&_defineProperties(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function _defineProperty(i,e,t){return(e=_toPropertyKey(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _toPropertyKey(i){i=_toPrimitive(i,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(i,e){if("object"!=_typeof(i)||!i)return i;var t=i[Symbol.toPrimitive];if(void 0===t)return("string"===e?String:Number)(i);t=t.call(i,e||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}var Trashcan=(()=>{function a(i){_classCallCheck(this,a),this.activity=i,this.isVisible=!1,this._scale=1,this._iconsize=55,this._container=new createjs.Container,this._borderHighlightBitmap=null,this._isHighlightInitialized=!1,this._inAnimation=!1,this._animationInterval=null,this._highlightPower=255,this._animationLevel=0,this.animationTime=500,this.activity.trashContainer.addChild(this._container),this.activity.trashContainer.setChildIndex(this._container,0),this.resizeEvent(1),this._makeTrash()}return _createClass(a,[{key:"_makeBorderHighlight",value:function(i){var e=this,t=new Image,n=(t.onload=function(){e._borderHighlightBitmap=new createjs.Bitmap(t),e._borderHighlightBitmap.scaleX=e.activity.cellSize/e._iconsize,e._borderHighlightBitmap.scaleY=e.activity.cellSize/e._iconsize,e._isHighlightInitialized?e._container.removeChildAt(e._container.children.length-1):(e._container.visible=!1,e._isHighlightInitialized=!0),e._container.addChild(e._borderHighlightBitmap),e._borderHighlightBitmap.visible=!0},"rgb("+this._highlightPower+","+this._highlightPower+","+this._highlightPower+")");i&&(n=platformColor.trashActive),t.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(BORDER.replace("stroke_color",n)))}},{key:"_makeBorder",value:function(){var e=this,t=new Image;t.onload=function(){var i=new createjs.Bitmap(t);i.scaleX=e.activity.cellSize/e._iconsize,i.scaleY=e.activity.cellSize/e._iconsize,e._container.addChild(i),e._makeBorderHighlight(!1)},t.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(BORDER.replace("stroke_color",platformColor.trashBorder)))}},{key:"_makeTrash",value:function(){var e=this,t=new Image;t.onload=function(){var i=new createjs.Bitmap(t);e._container.addChild(i),e._iconsize=i.getBounds().width,i.scaleX=e.activity.cellSize/e._iconsize,i.scaleY=e.activity.cellSize/e._iconsize,i.x=(a.TRASHWIDTH-e.activity.cellSize)/2*i.scaleX,i.y=(a.TRASHHEIGHT-e.activity.cellSize)/2*i.scaleY,e._makeBorder()},t.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(TRASHICON.replace(/fill_color/g,platformColor.trashBorder)))}},{key:"updateContainerPosition",value:function(){this._container.x=window.innerWidth/this._scale-a.TRASHWIDTH-2*this._iconsize,this._container.y=window.innerHeight/this._scale-a.TRASHHEIGHT-5/4*this._iconsize}},{key:"shouldResize",value:function(i,e){return this._container.x!==i||this._container.y!==e}},{key:"resizeEvent",value:function(i){this._scale=i,this.updateContainerPosition();var e,t=this;function n(){var i=(window.innerWidth/t._scale-a.TRASHWIDTH)/2,e=window.innerHeight/t._scale-a.TRASHHEIGHT;t.shouldResize(i,e)&&t.updateContainerPosition()}window.addEventListener("resize",function(){clearTimeout(e),e=setTimeout(n,300)})}},{key:"hide",value:function(){createjs.Tween.get(this._container).to({alpha:0},200).set({visible:!1})}},{key:"show",value:function(){this.stopHighlightAnimation(),createjs.Tween.get(this._container).to({alpha:0,visible:!0}).to({alpha:1},200)}},{key:"startHighlightAnimation",value:function(){var i=this;this._inAnimation||(this._inAnimation=!0,this._animationInterval=setInterval(function(){i._animationLevel+=20,i._animationLevel>=i.animationTime?(i.isVisible=!0,i._makeBorderHighlight(!0),i.activity.refreshCanvas(),clearInterval(i._animationInterval)):(i._highlightPower=parseInt(255-i._animationLevel/i.animationTime*255,10),i._makeBorderHighlight(!1),i.activity.refreshCanvas())},20),this._switchHighlightVisibility(!0))}},{key:"stopHighlightAnimation",value:function(){this._inAnimation&&(clearInterval(this._animationInterval),this._inAnimation=!1,this.isVisible=!1,this._animationLevel=0,this._highlightPower=255,this._makeBorderHighlight(!1),this._switchHighlightVisibility(!1))}},{key:"_switchHighlightVisibility",value:function(i){last(this._container.children).visible=i,this._container.children[1].visible=!i,this._container.visible=!0,this.activity.refreshCanvas()}},{key:"overTrashcan",value:function(i,e){var t=this._container.x,n=this._container.y;return!(i<t||t+a.TRASHWIDTH<i||e<n)}}])})();_defineProperty(Trashcan,"TRASHWIDTH",120),_defineProperty(Trashcan,"TRASHHEIGHT",120),"undefined"!=typeof module&&module.exports&&(module.exports=Trashcan);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var DEFAULTCOLOR=0,DEFAULTVALUE=50,DEFAULTCHROMA=100,DEFAULTSTROKE=5,DEFAULTFONT="sans-serif",Painter=(()=>_createClass(function t(e){_classCallCheck(this,t),this.turtle=e,this.turtles=e.turtles,this.activity=e.activity,this._svgOutput="",this._svgPath=!1,this._color=DEFAULTCOLOR,this._value=DEFAULTVALUE,this._chroma=DEFAULTCHROMA,this._stroke=DEFAULTSTROKE,this._font=DEFAULTFONT,this.cp1x=0,this.cp1y=100,this.cp2x=100,this.cp2y=100,this._canvasColor="rgba(255,0,49,1)",this._canvasAlpha=1,this._fillState=!1,this._hollowState=!1,this._penDown=!0,this.wrap=null,this._cachedCanvas=null,this._cachedCanvasWidth=0,this._cachedCanvasHeight=0,this._pendingCanvasUpdate=!1,this._rafId=null},[{key:"svgOutput",get:function(){return this._svgOutput},set:function(t){this._svgOutput=t}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}},{key:"chroma",get:function(){return this._chroma},set:function(t){this._chroma=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"font",get:function(){return this._font}},{key:"canvasColor",get:function(){return this._canvasColor},set:function(t){this._canvasColor=t}},{key:"canvasAlpha",get:function(){return this._canvasAlpha},set:function(t){this._canvasAlpha=t}},{key:"penState",get:function(){return this._penDown},set:function(t){this._penDown=t}},{key:"_scheduleCanvasUpdate",value:function(){var t=this;this._pendingCanvasUpdate||(this._pendingCanvasUpdate=!0,this._rafId=requestAnimationFrame(function(){t._pendingCanvasUpdate=!1,t._rafId=null,t.activity.refreshCanvas()}))}},{key:"_getCanvasDimensions",value:function(){var t=this.turtle.ctx.canvas;return this._cachedCanvas!==t&&(this._cachedCanvas=t,this._cachedCanvasWidth=t.width,this._cachedCanvasHeight=t.height),{width:this._cachedCanvasWidth,height:this._cachedCanvasHeight}}},{key:"_outOfBounds",value:function(t,e,i,s){return i<t||t<0||s<e||e<0}},{key:"_move",value:function(t,e,i,s,r,h){var a,n,l,o,u,c,v,_,x,p,d,g,f,y,m=this.turtles,C=m.scale,k=r?(t=m.turtleX2screenX(t),e=m.turtleY2screenY(e),a=m.turtleX2screenX(i),m.turtleY2screenY(s)):(a=i,s);this._penDown&&this._hollowState?(this.closeSVG(),this._svgPath=!0,n=this.stroke,this.stroke=1,this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",l=n<3?.5:(n-2)/2,y=(this.turtle.orientation-90)*Math.PI/180,o=l*Math.sin(y),u=-l*Math.cos(y),this.turtle.ctx.moveTo(t+o,e+u),this._svgOutput+='<path d="M '+(t+o)*C+","+(e+u)*C+" ",this.turtle.ctx.lineTo(a+o,k+u),this._svgOutput+=(c=(a+o)*C)+","+(k+u)*C+" ",y=(this.turtle.orientation+90)*Math.PI/180,o=l*Math.sin(y),u=-l*Math.cos(y),_=this.turtle.orientation/180*Math.PI,x=a,p=k,this.turtle.ctx.arc(x,p,l,d=_-Math.PI,_,!1),c=(a+o)*C,v=(k+u)*C,g=l*C,f=Math.max(Math.floor(n,1)),this._svgArc(f,x*C,p*C,g,d),this._svgOutput+=c+","+v+" ",this.turtle.ctx.lineTo(t+o,e+u),this._svgOutput+=(c=(t+o)*C)+","+(e+u)*C+" ",y=(this.turtle.orientation-90)*Math.PI/180,o=l*Math.sin(y),u=-l*Math.cos(y),_=(this.turtle.orientation+180)/180*Math.PI,x=t,p=e,this.turtle.ctx.arc(x,p,l,d=_-Math.PI,_,!1),c=(t+o)*C,v=(e+u)*C,this._svgArc(f,x*C,p*C,g=l*C,d),this._svgOutput+=c+","+v+" ",this.closeSVG(),this.turtle.ctx.stroke(),this.turtle.ctx.closePath(),this.stroke=n,this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",this.turtle.ctx.moveTo(a,k)):this._penDown?(y=this.turtle.orientation*Math.PI/180,h?(this.turtle.ctx.lineCap="butt","first"===h&&(this.turtle.ctx.beginPath(),this.turtle.ctx.arc(t,e,this.stroke/2,y,Math.PI+y,!1),this.turtle.ctx.fill()),this.turtle.ctx.beginPath(),this.turtle.ctx.moveTo(t,e),this.turtle.ctx.lineTo(a,k),this.turtle.ctx.stroke(),"last"===h&&(this.turtle.ctx.beginPath(),this.turtle.ctx.arc(a,k,this.stroke/2,y,Math.PI+y,!0),this.turtle.ctx.fill())):this.turtle.ctx.lineTo(a,k),this._svgPath||(this._svgPath=!0,this._svgOutput+='<path d="M '+t*C+","+e*C+" "),this._svgOutput+=a*C+","+k*C+" ",h||this.turtle.ctx.stroke(),this._fillState||this.turtle.ctx.closePath()):this.turtle.ctx.moveTo(a,k),this.turtle.penstrokes.image=this.turtle.canvas,this.turtle.container.x=a,this.turtle.container.y=k,r?(this.turtle.x=i,this.turtle.y=s):(this.turtle.x=m.screenX2turtleX(i),this.turtle.y=m.screenY2turtleY(s))}},{key:"_svgArc",value:function(t,e,i,s,r,h){for(var a=r,n=null==h?Math.PI/t:(h-r)/t,l=0;l<t;l++){var o=e+s*Math.cos(a),u=i+s*Math.sin(a);this._svgOutput+=o+","+u+" ",a+=n}}},{key:"_arc",value:function(t,e,i,s,r,h,a,n,l,o,u){var c,v,_,x,p,d,g,f,y,m=this.turtles,C=m.scale,m=u?(t=m.turtleX2screenX(t),e=m.turtleY2screenY(e),i=m.turtleX2screenX(i),s=m.turtleY2screenY(s),c=m.turtleX2screenX(r),m.turtleY2screenY(h)):(c=r,h),n=o?(v=n,l):(v=n-Math.PI,l-Math.PI);this._penDown&&this._hollowState?(this.closeSVG(),this._svgPath=!0,l=this.stroke,this.stroke=1,this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",_=l<3?.5:(l-2)/2,d=(this.turtle.orientation+90)*Math.PI/180,p=_*Math.sin(d),g=-_*Math.cos(d),x=o?(this.turtle.ctx.moveTo(i+p,s+g),y=(i+p)*C,(s+g)*C):(this.turtle.ctx.moveTo(i-p,s-g),y=(i-p)*C,(s-g)*C),this._svgOutput+='<path d="M '+y+","+x+" ",this.turtle.ctx.arc(t,e,a+_,v,n,o),y=Math.max(Math.floor(a*Math.abs(v-n)/2),2),x=Math.max(Math.floor(l,1)),this._svgArc(y,t*C,e*C,(a+_)*C,v,n),d=(this.turtle.orientation+90)*Math.PI/180,p=_*Math.sin(d),g=-_*Math.cos(d),p=c,d=m,f=(g=n)+Math.PI,this.turtle.ctx.arc(p,d,_,g,f,o),this._svgArc(x,p*C,d*C,_*C,g,f),this.turtle.ctx.arc(t,e,a-_,n,v,!o),this._svgArc(y,t*C,e*C,(a-_)*C,n,v),p=i,d=s,g=v-Math.PI,f=v,this.turtle.ctx.arc(p,d,_,g,f,o),this._svgArc(x,p*C,d*C,_*C,g,f),this.closeSVG(),this.turtle.ctx.stroke(),this.turtle.ctx.closePath(),this.stroke=l,this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",this.turtle.ctx.moveTo(c,m)):this._penDown?(this.turtle.ctx.arc(t,e,a,v,n,o),this._svgPath||(this._svgPath=!0,this._svgOutput+='<path d="M '+i*C+","+s*C+" "),this._svgOutput+="A "+(y=a*C)+","+y+" 0 0 "+(o?0:1)+" "+c*C+","+m*C+" ",this.turtle.ctx.stroke(),this._fillState||this.turtle.ctx.closePath()):this.turtle.ctx.moveTo(c,m),this.turtle.container.x=c,this.turtle.container.y=m,u?(this.turtle.x=r,this.turtle.y=h):(this.turtle.x=this.screenX2turtles.turtleX(r),this.turtle.y=this.screenY2turtles.turtleY(h))}},{key:"_doArcPart",value:function(t,e){this._processColor(),this._fillState||(this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",this.turtle.ctx.beginPath(),this.turtle.ctx.moveTo(this.turtle.container.x,this.turtle.container.y));var i,s,r,h,t=Number(t),a=t/180*Math.PI,n=this.turtle.orientation/180*Math.PI,e=Number(e),l=this.turtles.screenX2turtleX(this.turtle.container.x),o=this.turtles.screenY2turtleY(this.turtle.container.y),u=t<0?(i=!0,t=-t,s=l-Math.cos(n)*e,r=o+Math.sin(n)*e,h=s+Math.cos(n+a)*e,r-Math.sin(n+a)*e):(i=!1,s=l+Math.cos(n)*e,r=o-Math.sin(n)*e,h=s-Math.cos(n+a)*e,r+Math.sin(n+a)*e);this._arc(s,r,l,o,h,u,e,n,n+a,i,!0),i?this.doRight(-t):this.doRight(t),this._scheduleCanvasUpdate()}},{key:"_processColor",value:function(){"#"===this._canvasColor[0]&&(this._canvasColor=hex2rgb(this._canvasColor.split("#")[1]));var t=this._canvasColor.substr(0,this._canvasColor.length-2);this.turtle.ctx.strokeStyle=t+this._canvasAlpha+")",this.turtle.ctx.fillStyle=t+this._canvasAlpha+")"}},{key:"closeSVG",value:function(){var t;this._svgPath&&(t=(t=this._canvasColor.replace(/rgba/g,"rgb")).substr(0,this._canvasColor.length-4)+");",this._svgOutput+='" style="stroke-linecap:round;fill:',this._svgOutput+=this._fillState?t+"fill-opacity:"+this._canvasAlpha+";":"none;",this._svgOutput+="stroke:"+t+"stroke-opacity:"+this._canvasAlpha+";",t=this.stroke*this.turtles.scale,this._svgOutput+="stroke-width:"+t+'pt;" />',this._svgPath=!1)}},{key:"doForward",value:function(t,e){this._processColor(),this._fillState||(this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",this.turtle.ctx.beginPath(),this.turtle.ctx.moveTo(this.turtle.container.x,this.turtle.container.y));var i=this.turtles,s=i.screenX2turtleX(this.turtle.container.x),r=i.screenY2turtleY(this.turtle.container.y),h=this.turtle.orientation*Math.PI/180,a=s+Number(t)*Math.sin(h),n=r+Number(t)*Math.cos(h),l=this._getCanvasDimensions(),o=l.width,u=l.height,l=this._outOfBounds(i.turtleX2screenX(a),i.turtleY2screenY(n),o,u),c=null!==this.wrap?this.wrap:WRAP;if(!this._fillState&&c&&l){var v,_;for(0<t?(v=5*Math.sin(h),_=5*Math.cos(h)):(v=-5*Math.sin(h),_=-5*Math.cos(h),t=-t);0<=t;)this.turtle.container.x>o&&(this.turtle.container.x=0,this.turtle.ctx.moveTo(this.turtle.container.x,this.turtle.container.y)),this.turtle.container.x<0&&(this.turtle.container.x=o,this.turtle.ctx.moveTo(this.turtle.container.x,this.turtle.container.y)),this.turtle.container.y>u&&(this.turtle.container.y=0,this.turtle.ctx.moveTo(this.turtle.container.x,this.turtle.container.y)),this.turtle.container.y<0&&(this.turtle.container.y=u,this.turtle.ctx.moveTo(this.turtle.container.x,this.turtle.container.y)),r=i.screenY2turtleY(this.turtle.container.y),s=i.screenX2turtleX(this.turtle.container.x),this._move(s,r,a=s+v,n=r+_,!0),this.turtle.container.x=i.turtleX2screenX(a),this.turtle.container.y=i.turtleY2screenY(n),this.turtle.ctx.moveTo(this.turtle.container.x,this.turtle.container.y),t-=5}else this._move(s,r,a,n,!0,e);this._scheduleCanvasUpdate();c=this.turtle._view;c&&"function"==typeof c._updateMediaPositions&&c._updateMediaPositions()}},{key:"doRight",value:function(t){for(this.turtle.orientation+=Number(t);this.turtle.orientation<0;)this.turtle.orientation+=360;this.turtle.orientation%=360,this.turtle.container.rotation=this.turtle.orientation,this.turtle.blinking()||this.turtle.updateCache()}},{key:"doSetXY",value:function(t,e){this._processColor(),this._fillState||(this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",this.turtle.ctx.beginPath(),this.turtle.ctx.moveTo(this.turtle.container.x,this.turtle.container.y));var i=this.turtles.screenX2turtleX(this.turtle.container.x),s=this.turtles.screenY2turtleY(this.turtle.container.y),t=Number(t),e=Number(e),i=(this._move(i,s,t,e,!0),this._scheduleCanvasUpdate(),this.turtle._view);i&&"function"==typeof i._updateMediaPositions&&i._updateMediaPositions()}},{key:"doSetHeading",value:function(t){for(this.turtle.orientation=Number(t);this.turtle.orientation<0;)this.turtle.orientation+=360;this.turtle.orientation%=360,this.turtle.container.rotation=this.turtle.orientation,this.turtle.blinking()||this.turtle.updateCache()}},{key:"doArc",value:function(t,e){e<0&&(e=-e);for(var i,t=Number(t),s=(t<0?(i=-1,t=-t):i=1,t%90),r=Math.floor(t/90),h=0;h<r;h++)this._doArcPart(90*i,e);0<s&&this._doArcPart(s*i,e)}},{key:"setControlPoint1",value:function(t){this.cp1x=t[0],this.cp1y=t[1]}},{key:"setControlPoint2",value:function(t){this.cp2x=t[0],this.cp2y=t[1]}},{key:"doBezier",value:function(t,e){var i,s,r,h,a,n,l,o,u,c,v,_,x,p,d,g,f,y,m=this.cp1x,C=this.cp1y,k=this.cp2x,M=this.cp2y,P=this.turtles,S=P.scale;this._penDown&&this._hollowState?(i=P.turtleX2screenX(t),s=P.turtleY2screenY(e),p=P.turtleX2screenX(this.turtle.x),d=P.turtleY2screenY(this.turtle.y),P.turtleX2screenX(m),P.turtleY2screenY(C),P.turtleX2screenX(k),P.turtleY2screenY(M),this.closeSVG(),b=this.stroke,this.stroke=1,this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",g=b<3?.5:(b-2)/2,x=Math.max(Math.floor(b,1)),(_=180*(_=Math.atan2(m-this.turtle.x,C-this.turtle.y))/Math.PI)<0&&(_+=360),(v=180*(v=Math.atan2(t-k,e-M))/Math.PI)<0&&(v+=360),r=g*Math.sin(h=(_-90)*Math.PI/180),h=-g*Math.cos(h),n=(v-90)*Math.PI/180,l=p-r,o=d-h,a=g*Math.sin(n),n=-g*Math.cos(n),u=i+a,c=s+n,this._svgPath=!0,_=(180+_)/180*Math.PI,this.turtle.ctx.arc(p=p,d=d,g,f=_-Math.PI,y=_,!1),this._svgArc(x,p*S,d*S,g*S,f,y),_=v/180*Math.PI,p=i,d=s,this.turtle.ctx.arc(p,d,g,f=_-Math.PI,y=_,!1),this._svgArc(x,p*S,d*S,g*S,f,y),v=(i=P.turtleX2screenX(t))*S,_=(s=P.turtleY2screenY(e))*S,this.turtle.ctx.stroke(),this.turtle.ctx.closePath(),this.stroke=b,this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",this.turtle.ctx.moveTo(i,s),this._svgOutput+="M "+v+","+_+" ",this.turtle.x=t,this.turtle.y=e):this._penDown?(this._processColor(),this.turtle.ctx.lineWidth=this.stroke,this.turtle.ctx.lineCap="round",this.turtle.ctx.beginPath(),this.turtle.ctx.moveTo(this.turtle.container.x,this.turtle.container.y),i=P.turtleX2screenX(t),s=P.turtleY2screenY(e),x=P.turtleX2screenX(m),p=P.turtleY2screenY(C),d=P.turtleX2screenX(k),g=P.turtleY2screenY(M),this.turtle.ctx.bezierCurveTo(x+r,p+h,d+a,g+n,u,c),this.turtle.ctx.bezierCurveTo(d-a,g-n,x-r,p-h,l,o),this.turtle.ctx.bezierCurveTo(x,p,d,g,i,s),this._svgPath||(this._svgPath=!0,f=P.turtleX2screenX(this.turtle.x),y=P.turtleY2screenY(this.turtle.y),this._svgOutput+='<path d="M '+f*S+","+y*S+" "),this._svgOutput+="C "+x*S+","+p*S+" "+d*S+","+g*S+" "+i*S+","+s*S,this.closeSVG(),this.turtle.x=t,this.turtle.y=e,this.turtle.ctx.stroke(),this._fillState||this.turtle.ctx.closePath()):(this.turtle.x=t,this.turtle.y=e,i=P.turtleX2screenX(t),s=P.turtleY2screenY(e)),this.turtle.container.x=i,this.turtle.container.y=s;var b=180*Math.atan2(t-k,e-M)/Math.PI;this.doSetHeading(b)}},{key:"doClearMedia",value:function(){if(this.turtle.media&&0!==this.turtle.media.length){for(var t=this.activity.gifAnimator,e=0;e<this.turtle.media.length;e++){var i=this.turtle.media[e];"gif"===i.type&&t&&i.stop(),this.turtle.imageContainer.removeChild(this.turtle.media[e]),this.turtles.stage.removeChild(this.turtle.media[e]),delete this.turtle.media[e]}this.turtle.media=[]}}},{key:"doClear",value:function(t,e,i){var s=this.turtles,i=(i&&(this.turtle.x=0,this.turtle.y=0,this.turtle.orientation=0,s.gx=this.turtle.ctx.canvas.width,s.gy=this.turtle.ctx.canvas.height),s.getIndexOfTurtle(this)%10);t&&(this.color=10*i,this.value=DEFAULTVALUE,this.chroma=DEFAULTCHROMA,this.stroke=DEFAULTSTROKE,this._font=DEFAULTFONT),this.turtle.container.x=s.turtleX2screenX(this.turtle.x),this.turtle.container.y=s.turtleY2screenY(this.turtle.y),e&&(this.turtle.name!==_("start")&&this.turtle.rename(_("start")),this.turtle.skinChanged)&&(t=(t=TURTLESVG).replace(/fill_color/g,FILLCOLORS.at(i)).replace(/stroke_color/g,STROKECOLORS.at(i)),this.turtle.doTurtleShell(55,"data:image/svg+xml;base64,"+window.btoa(base64Encode(t))),this.turtle.skinChanged=!1),this.turtle.container.rotation=this.turtle.orientation,null!==this.turtle._bitmap&&(this.turtle._bitmap.rotation=this.turtle.orientation),this.turtle.updateCache(),this.doClearMedia(),this._penDown=!0,this._fillState=!1,this._hollowState=!1,this._canvasColor=getMunsellColor(this.color,this.value,this.chroma),"#"===this._canvasColor[0]&&(this._canvasColor=hex2rgb(this._canvasColor.split("#")[1])),this._svgOutput="",this._svgPath=!1,this.turtle.penstrokes.image=null,this.turtle.ctx.beginPath(),this.turtle.ctx.clearRect(0,0,this.turtle.canvas.width,this.turtle.canvas.height),null!=s.c1ctx&&(s.c1ctx.beginPath(),s.c1ctx.clearRect(0,0,3*this.turtle.canvas.width,3*this.turtle.canvas.height)),this.turtle.penstrokes.image=this.turtle.canvas,this._scheduleCanvasUpdate()}},{key:"doScrollXY",value:function(t,e){var i=this.turtle.ctx.getImageData(0,0,this.turtle.ctx.canvas.width,this.turtle.ctx.canvas.height),s=this.turtles,i=(null==s.canvas1&&(s.gx=this.turtle.ctx.canvas.width,s.gy=this.turtle.ctx.canvas.height,s.canvas1=document.createElement("canvas"),s.canvas1.width=3*this.turtle.ctx.canvas.width,s.canvas1.height=3*this.turtle.ctx.canvas.height,s.c1ctx=s.canvas1.getContext("2d"),s.c1ctx.rect(0,0,3*this.turtle.ctx.canvas.width,3*this.turtle.ctx.canvas.height),s.c1ctx.fillStyle="#F9F9F9",s.c1ctx.fill()),s.c1ctx.putImageData(i,s.gx,s.gy),s.gy-=e,s.gx-=t,s.gx=2*this.turtle.ctx.canvas.width>s.gx?s.gx:2*this.turtle.ctx.canvas.width,s.gx=s.gx<0?0:s.gx,s.gy=2*this.turtle.ctx.canvas.height>s.gy?s.gy:2*this.turtle.ctx.canvas.height,s.gy=s.gy<0?0:s.gy,s.c1ctx.getImageData(s.gx,s.gy,this.turtle.ctx.canvas.width,this.turtle.ctx.canvas.height));this.turtle.ctx.putImageData(i,0,0);for(var r=0;r<s.getTurtleCount();r++){var h=s.getTurtle(r);h.inTrash||h.painter.penState&&(h.painter._processColor(),this.turtle.ctx.lineWidth=h.painter.stroke,this.turtle.ctx.lineCap="round",this.turtle.ctx.beginPath(),this.turtle.ctx.moveTo(h.container.x+t,h.container.y+e),this.turtle.ctx.lineTo(h.container.x,h.container.y),this.turtle.ctx.stroke(),this.turtle.ctx.closePath())}this._scheduleCanvasUpdate()}},{key:"doSetColor",value:function(t){this.closeSVG(),this.color=Number(t);t=getcolor(this.color);this.canvasValue=t[0],this.value=t[0],this.canvasChroma=t[1],this.chroma=t[1],this._canvasColor=t[2],this._processColor()}},{key:"doSetChroma",value:function(t){this.closeSVG(),this.chroma=Number(t),this._canvasColor=getMunsellColor(this.color,this.value,this.chroma),this._processColor()}},{key:"doSetValue",value:function(t){this.closeSVG(),this.value=Number(t),this._canvasColor=getMunsellColor(this.color,this.value,this.chroma),this._processColor()}},{key:"doSetHue",value:function(t){this.closeSVG(),this.color=Number(t),this._canvasColor=getMunsellColor(this.color,this.value,this.chroma),this._processColor()}},{key:"doSetPenAlpha",value:function(t){this.canvasAlpha=t}},{key:"doSetPensize",value:function(t){this.closeSVG(),this.stroke=t,this.turtle.ctx.lineWidth=this.stroke}},{key:"doPenUp",value:function(){this.closeSVG(),this._penDown=!1}},{key:"doPenDown",value:function(){this._penDown=!0}},{key:"doStartFill",value:function(){this.turtle.ctx.beginPath(),this._fillState=!0}},{key:"doEndFill",value:function(){this.turtle.ctx.fill(),this.turtle.ctx.closePath(),this.closeSVG(),this._fillState=!1}},{key:"doStartHollowLine",value:function(){this._hollowState=!0}},{key:"doEndHollowLine",value:function(){this._hollowState=!1}},{key:"doSetFont",value:function(t){this._font=t,this.turtle.updateCache()}}]))();"undefined"!=typeof module&&module.exports&&(module.exports=Painter);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s,n,i,o,g=[],a=!0,l=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;a=!1}else for(;!(a=(s=i.call(r)).done)&&(g.push(s.value),g.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{if(!a&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw n}}return g}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var r,s,n,i,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(s=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return s=e.done,e},e:function(e){n=!0,r=e},f:function(){try{s||null==o.return||o.return()}finally{if(n)throw r}}};if(Array.isArray(e)||(o=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),i=0,{s:t=function(){},n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,_toPropertyKey(s.key),s)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var Singer=(()=>{function ze(e){_classCallCheck(this,ze),this.turtle=e,this.turtles=e.turtles,this.attack=[],this.decay=[],this.sustain=[],this.release=[],this.scalarTransposition=0,this.scalarTranspositionValues=[],this.transposition=0,this.transpositionValues=[],this.transpositionRatios=[],this.defaultNoteValue=4,this.register=0,this.beatFactor=1,this.dotCount=0,this.oscList={},this.noteBeat={},this.noteValue={},this.noteDrums={},this.notePitches={},this.noteOctaves={},this.noteCents={},this.noteHertz={},this.noteBeatValues={},this.embeddedGraphics={},this.delayedNotes=[],this.lastNotePlayed=null,this.lastPitchPlayed={},this.previousNotePlayed=null,this.noteStatus=null,this.noteDirection=0,this.pitchNumberOffset=39,this.currentOctave=4,this.currentCalculatedOctave={},this.inHarmonic=[],this.partials=[],this.inNeighbor=[],this.neighborStepPitch=[],this.neighborNoteValue=[],this.inDefineMode=!1,this.defineMode=[],this.notesPlayed=[0,1],this.whichNoteToCount=1,this.tallyNotes=0,this.movable=!1,this.bpm=[],this.previousTurtleTime=0,this.turtleTime=0,this.pushedNote=!1,this.duplicateFactor=1,this.arpeggio=[],this.arpeggioIndex=0,this.inDuplicate=!1,this.skipFactor=1,this.skipIndex=0,this.instrumentNames=[],this.inCrescendo=[],this.crescendoDelta=[],this.crescendoInitialVolume={DEFAULTVOICE:[DEFAULTVOLUME]},this.intervals=[],this.semitoneIntervals=[],this.chordIntervals=[],this.ratioIntervals=[],this.staccato=[],this.glide=[],this.glideOverride=0,this.swing=[],this.swingTarget=[],this.swingCarryOver=0,this.tie=!1,this.tieNotePitches=[],this.tieNoteExtras=[],this.tieCarryOver=0,this.tieFirstDrums=[],this.synthVolume={},this.drift=0,this.drumStyle=[],this.voices=[],this.backward=[],this.vibratoIntensity=[],this.vibratoRate=[],this.distortionAmount=[],this.tremoloFrequency=[],this.tremoloDepth=[],this.rate=[],this.octaves=[],this.baseFrequency=[],this.chorusRate=[],this.delayTime=[],this.chorusDepth=[],this.neighborArgNote1=[],this.neighborArgNote2=[],this.neighborArgBeat=[],this.neighborArgCurrentBeat=[],this.panner=null,this.inNoteBlock=[],this.multipleVoices=!1,this.invertList=[],this.beatList=[],this.factorList=[],this.keySignature="C major",this.pitchDrumTable={},this.defaultStrongBeats=!1,this.pickup=0,this.beatsPerMeasure=4,this.noteValuePerBeat=4,this.currentBeat=0,this.currentMeasure=0,this.justCounting=[],this.justMeasuring=[],this.firstPitch=[],this.lastPitch=[],this.suppressOutput=!1,this.dispatchFactor=1,this.inverted=!1}return _createClass(ze,null,[{key:"playSynthBlock",value:function(e,t,r,s,n){var i;1===e.length&&(i=frequencyToPitch(e[0]),r.inMatrix?(r.phraseMaker.addRowBlock(n),r.pitchBlocks.includes(n)||r.pitchBlocks.push(n),r.phraseMaker.rowLabels.push(t.logo.blocks.blockList[n].name),r.phraseMaker.rowArgs.push(e[0])):r.inLegoWidget&&!r.inMatrix?(r.legoWidget.addRowBlock(n),r.pitchBlocks.includes(n)||r.pitchBlocks.push(n),r.legoWidget.rowLabels.push(t.logo.blocks.blockList[n].name),r.legoWidget.rowArgs.push(e[0])):r.inPitchSlider?r.pitchSlider.frequency=e[0]:((r=t.turtles.ithTurtle(s)).singer.oscList[last(r.singer.inNoteBlock)].push(t.blocks.blockList[n].name),r.singer.notePitches[last(r.singer.inNoteBlock)].push(i[0]),r.singer.noteOctaves[last(r.singer.inNoteBlock)].push(i[1]),r.singer.noteCents[last(r.singer.inNoteBlock)].push(i[2]),0!==i[2]?r.singer.noteHertz[last(r.singer.inNoteBlock)].push(pitchToFrequency(i[0],i[1],i[2],r.singer.keySignature)):r.singer.noteHertz[last(r.singer.inNoteBlock)].push(0),r.singer.noteBeatValues[last(r.singer.inNoteBlock)].push(r.singer.beatFactor),r.singer.pushedNote=!0))}},{key:"addScalarTransposition",value:function(e,t,r,s,n){if(0===n)return[r,s];var i=e.activity,o=i.turtles.ithTurtle(t),g=getNote(r,s,0,o.singer.keySignature,o.singer.movable,null,i.errorMsg,e.synth.inTemperament);if(isCustomTemperament(e.synth.inTemperament))g=getNote(g[0],g[1],(0<n?getStepSizeUp:getStepSizeDown)(o.singer.keySignature,g[0],n,e.synth.inTemperament),o.singer.keySignature,o.singer.movable,null,i.errorMsg,e.synth.inTemperament);else for(var a=0;a<Math.abs(n);a++)g=getNote(g[0],g[1],(0<n?getStepSizeUp:getStepSizeDown)(o.singer.keySignature,g[0]),o.singer.keySignature,o.singer.movable,null,i.logo.errorMsg,e.synth.inTemperament);return g}},{key:"scalarDistance",value:function(e,t,r,s){if(s===r)return 0;for(var n,e=e.activity,i=!1,o=(r<s&&(r=(n=[s,r])[0],s=n[1],i=!0),e.turtles.ithTurtle(t)),g=r+o.singer.pitchNumberOffset,a=s+o.singer.pitchNumberOffset,l=0,u=numberToPitch(a);l++<100&&!(g<=(a+=getStepSizeUp(o.singer.keySignature,u[0],1)));)u=numberToPitch(a);return i?l:-l}},{key:"calculateInvert",value:function(e,t,r,s){for(var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,i=e.activity,o=i.turtles.ithTurtle(t),g=0,r=getNote(r,s,n,o.singer.keySignature,o.singer.movable,null,i.errorMsg),a=pitchToNumber(r[0],r[1],o.singer.keySignature)-o.singer.pitchNumberOffset,l=o.singer.invertList.length-1;0<=l;l--){var u=getNote(o.singer.invertList[l][0],o.singer.invertList[l][1],-n,o.singer.keySignature,o.singer.movable,null,i.errorMsg),h=pitchToNumber(u[0],u[1],o.singer.keySignature)-o.singer.pitchNumberOffset;"even"===o.singer.invertList[l][2]?a+=2*(g+=h-a):"odd"===o.singer.invertList[l][2]?a+=2*(g+=h-a+.5):(h=ze.scalarDistance(e,t,h,a),u=ze.addScalarTransposition(e,t,u[0],u[1],-h),g+=((h=pitchToNumber(u[0],u[1],o.singer.keySignature)-o.singer.pitchNumberOffset)-a)/2,a=h)}return g}},{key:"noteCounter",value:function(e,t,r){if(null===r)return 0;var s,n=e.activity,i=n.turtles.ithTurtle(t),o=i.singer.suppressOutput,g=JSON.stringify(e.boxes),a=JSON.stringify(e.turtleHeaps[t]),l=JSON.stringify(e.turtleDicts[t]),u=i.x,h=i.y,c=i.painter.color,p=i.painter.value,m=i.painter.chroma,y=i.painter.stroke,d=i.painter.canvasAlpha,v=i.orientation,f=i.painter.penState,b=i.singer.whichNoteToCount,N=i.singer.previousTurtleTime,k=i.singer.turtleTime;for(s in i.singer.suppressOutput=!0,i.singer.justCounting.push(!0),i.endOfClampSignals)for(var T in i.butNotThese[s]=[],i.endOfClampSignals[s])i.butNotThese[s].push(T);var S=i.singer.notesPlayed,P=i.singer.tallyNotes,r=(i.running=!0,i.singer.whichNoteToCount+=i.singer.inNoteBlock.length,n.logo.runFromBlockNow(e,t,r,!0,[],n.turtles.getTurtle(t).queue.length),rationalSum(i.singer.notesPlayed,[-S[0],S[1]]));return i.singer.notesPlayed=S,i.singer.tallyNotes=P,e.boxes=null==g?{}:JSON.parse(g),null==a?e.turtleHeaps={}:e.turtleHeaps[t]=JSON.parse(a),null==l?e.turtleDicts={}:e.turtleDicts[t]=JSON.parse(l),i.painter.doPenUp(),i.painter.doSetXY(u,h),i.painter.color=c,i.painter.value=p,i.painter.chroma=m,i.painter.stroke=y,i.painter.canvasAlpha=d,i.painter.doSetHeading(v),i.painter.penState=f,i.singer.previousTurtleTime=N,i.singer.turtleTime=k,i.singer.whichNoteToCount=b,i.singer.justCounting.pop(),i.singer.suppressOutput=o,i.butNotThese={},r[0]/r[1]}},{key:"numberOfNotes",value:function(e,t,r){var s,n,i;return null===r?0:(s=e.activity,(n=s.turtles.ithTurtle(t)).singer.notesPlayed,n.singer.tallyNotes,i={suppressOutput:n.singer.suppressOutput,boxes:JSON.stringify(e.boxes),turtleHeaps:JSON.stringify(e.turtleHeaps[t]),turtleDicts:JSON.stringify(e.turtleDicts[t]),x:n.x,y:n.y,color:n.painter.color,value:n.painter.value,chroma:n.painter.chroma,stroke:n.painter.stroke,canvasAlpha:n.painter.canvasAlpha,orientation:n.orientation,penState:n.painter.penState,whichNoteToCount:n.singer.whichNoteToCount,prevTurtleTime:n.singer.previousTurtleTime,turtleTime:n.singer.turtleTime,noteCount:n.singer.notesPlayed,tallyNotes:n.singer.tallyNotes},n.singer.suppressOutput=!0,n.singer.justCounting.push(!0),Object.keys(n.endOfClampSignals).forEach(function(e){n.butNotThese[e]=Object.keys(n.endOfClampSignals[e])}),n.running=!0,n.singer.whichNoteToCount+=n.singer.inNoteBlock.length,s.logo.runFromBlockNow(e,t,r,!0,[],[],s.turtles.getTurtle(t).queue.length),e=n.singer.tallyNotes-i.tallyNotes,Object.assign(n.singer,{notesPlayed:i.noteCount,tallyNotes:i.tallyNotes,previousTurtleTime:i.prevTurtleTime,turtleTime:i.turtleTime,whichNoteToCount:i.whichNoteToCount,suppressOutput:i.suppressOutput}),Object.assign(n.painter,{color:i.color,value:i.value,chroma:i.chroma,stroke:i.stroke,canvasAlpha:i.canvasAlpha,penState:i.penState}),s.logo.boxes=JSON.parse(i.boxes),s.logo.turtleHeaps[t]=JSON.parse(i.turtleHeaps),s.logo.turtleDicts[t]=JSON.parse(i.turtleDicts),n.painter.doPenUp(),n.painter.doSetXY(i.x,i.y),n.painter.doSetHeading(i.orientation),n.painter.doSetXY(saveX,saveY),n.painter.color=saveColor,n.painter.value=saveValue,n.painter.chroma=saveChroma,n.painter.stroke=saveStroke,n.painter.canvasAlpha=saveCanvasAlpha,n.painter.doSetHeading(saveOrientation),n.painter.penState=savePenState,n.singer.suppressOutput=saveSuppressStatus,n.singer.previousTurtleTime=savePrevTurtleTime,n.singer.turtleTime=saveTurtleTime,n.singer.whichNoteToCount=saveWhichNoteToCount,n.singer.justCounting.pop(),n.butNotThese={},e)}},{key:"setMasterVolume",value:function(e,t,r){var s,n,i=e.activity,o=(t=Math.min(Math.max(t,0),100),r?(s=i.logo.blockList[r].connections[0],r=last(i.logo.blockList[r].connections),e.synth.setMasterVolume(t,s,r)):e.synth.setMasterVolume(t),_createForOfIteratorHelper(i.turtles.turtleList));try{for(o.s();!(n=o.n()).done;){var g,a=n.value;for(g in a.singer.synthVolume)a.singer.synthVolume[g].push(t)}}catch(e){o.e(e)}finally{o.f()}}},{key:"setSynthVolume",value:function(e,t,r,s,n){switch(s=Math.min(Math.max(s,0),100),r){case"noise1":case"noise2":case"noise3":e.synth.setVolume(t,r,s/25,n);break;default:e.synth.setVolume(t,r,s,n)}}},{key:"processPitch",value:function(u,e,t,r,s,n){var h=u.turtles.ithTurtle(s),i=ze.addScalarTransposition(u.logo,s,e,t,h.singer.scalarTransposition),o=_slicedToArray(i,2),c=(e=o[0],t=o[1],0<h.singer.inNeighbor.length&&(i=getNote(e,t,h.singer.transposition,h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament),h.singer.neighborArgNote1.push(i[0]+i[1]),"neighbor2"===u.blocks.blockList[last(h.singer.inNeighbor)].name?(g=ze.addScalarTransposition(u.logo,s,e,t,parseInt(h.singer.neighborStepPitch)),0!==h.singer.transposition&&(g=getNote(g[0],g[1],h.singer.transposition,h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament))):g=getNote(e,t,h.singer.transposition+parseInt(h.singer.neighborStepPitch),h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament),h.singer.neighborArgNote2.push(g[0]+g[1])),0<h.singer.invertList.length?ze.calculateInvert(u.logo,s,e,t):0);if(0<h.singer.justMeasuring.length){var o=h.singer.transposition,g=(i=getNote(e,t,o,h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament),h.singer.justMeasuring.length),o=pitchToNumber(i[0],i[1],h.singer.keySignature)-h.singer.pitchNumberOffset;h.singer.firstPitch.length<g?h.singer.firstPitch.push(o):h.singer.lastPitch.length<g&&h.singer.lastPitch.push(o)}else if(u.logo.inPitchDrumMatrix){"rest"!==e.toLowerCase()&&(u.logo.pitchDrumMatrix.addRowBlock(n),u.logo.pitchBlocks.includes(n)||u.logo.pitchBlocks.push(n));for(var V=0<h.singer.duplicateFactor.length?h.singer.duplicateFactor:1,a=0;a<V;a++){var l=2*c+h.singer.transposition,p=h.singer.arpeggio.length,l=l+r,p=(0<p&&a<p&&(l+=h.singer.arpeggio[a]),getNote(e,t,l,h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament));p[0]=noteIsSolfege(e)?getSolfege(p[0]):p[0],0<h.singer.drumStyle.length?u.logo.pitchDrumMatrix.drums.push(last(h.singer.drumStyle)):(u.logo.pitchDrumMatrix.rowLabels.push(p[0]),u.logo.pitchDrumMatrix.rowArgs.push(p[1]))}}else if(u.logo.inMatrix){"rest"!==e.toLowerCase()&&(u.logo.phraseMaker.addRowBlock(n),u.logo.pitchBlocks.includes(n)||u.logo.pitchBlocks.push(n));for(var _=0<h.singer.duplicateFactor.length?h.singer.duplicateFactor:1,m=0;m<_;m++){var y=2*c+h.singer.transposition,d=h.singer.arpeggio.length,y=y+r,d=(0<d&&m<d&&(y+=h.singer.arpeggio[m]),getNote(e,t,y,h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament));h.singer.previousNotePlayed=h.singer.lastNotePlayed,h.singer.lastNotePlayed=[d[0]+d[1],4],"C"===h.singer.keySignature[0]&&"major"===h.singer.keySignature[1].toLowerCase()&&noteIsSolfege(e)&&(d[0]=getSolfege(d[0])),0<h.singer.drumStyle.length?(u.logo.phraseMaker.rowLabels.push(last(h.singer.drumStyle)),u.logo.phraseMaker.rowArgs.push(-1)):(u.logo.phraseMaker.rowLabels.push(d[0]),u.logo.phraseMaker.rowArgs.push(d[1]))}}else if(u.logo.inLegoWidget&&!u.logo.inMatrix){"rest"!==e.toLowerCase()&&(u.logo.legoWidget.addRowBlock(n),u.logo.pitchBlocks.includes(n)||u.logo.pitchBlocks.push(n));for(var E=0<h.singer.duplicateFactor.length?h.singer.duplicateFactor:1,v=0;v<E;v++){var f=2*c+h.singer.transposition,b=h.singer.arpeggio.length,f=f+r,b=(0<b&&v<b&&(f+=h.singer.arpeggio[v]),getNote(e,t,f,h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament));h.singer.previousNotePlayed=h.singer.lastNotePlayed,h.singer.lastNotePlayed=[b[0]+b[1],4],"C"===h.singer.keySignature[0]&&"major"===h.singer.keySignature[1].toLowerCase()&&noteIsSolfege(e)&&(b[0]=getSolfege(b[0])),0<h.singer.drumStyle.length?(u.logo.legoWidget.rowLabels.push(last(h.singer.drumStyle)),u.logo.legoWidget.rowArgs.push(-1)):(u.logo.legoWidget.rowLabels.push(b[0]),u.logo.legoWidget.rowArgs.push(b[1]))}}else if(0<h.singer.inNoteBlock.length){h.singer.inverted=0<h.singer.invertList.length;for(var N=function(e,t,r,s){for(var n,i=2*c+h.singer.transposition,o=h.singer.arpeggio.length,g=e,a=(0<o&&(n=getNote(e,t,0,h.singer.keySignature,h.singer.movable,s,u.errorMsg,u.logo.synth.inTemperament),isNaN(h.singer.arpeggio[h.singer.arpeggioIndex][0])?g="rest":i+=getInterval(h.singer.arpeggio[h.singer.arpeggioIndex][0],h.singer.keySignature,n[0])+h.singer.arpeggio[h.singer.arpeggioIndex][1],h.singer.arpeggioIndex+=1,h.singer.arpeggioIndex===o)&&(h.singer.arpeggioIndex=0),n=getNote(g,t,i+h.singer.register*SEMITONES,h.singer.keySignature,h.singer.movable,s,u.errorMsg,u.logo.synth.inTemperament),1),l=0;l<h.singer.transpositionRatios.length;l++)a*=h.singer.transpositionRatios[l];return 1!=a&&(e=pitchToFrequency(n[0],n[1],n[2],h.singer.keySignature),n=frequencyToPitch(e*a)),0!==n[2]&&0===r&&(r=n[2]),0<h.singer.drumStyle.length&&(o=last(h.singer.drumStyle),h.singer.pitchDrumTable[n[0]+n[1]]=o),h.singer.notePitches[last(h.singer.inNoteBlock)].push(n[0]),h.singer.noteOctaves[last(h.singer.inNoteBlock)].push(n[1]),h.singer.noteCents[last(h.singer.inNoteBlock)].push(r),h.singer.noteHertz[last(h.singer.inNoteBlock)].push(0===r?0:pitchToFrequency(n[0],n[1],r,h.singer.keySignature)),n},k=N(e,t,r),T=0;T<h.singer.intervals.length;T++){var S=getNote(k[0],k[1],getInterval(h.singer.intervals[T],h.singer.keySignature,k[0]),h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament);N(S[0],S[1],r)}for(var P=0;P<h.singer.semitoneIntervals.length;P++){var O=getNote(k[0],k[1],h.singer.semitoneIntervals[P][0],h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament);N(O[0],O[1],r,h.singer.semitoneIntervals[P][1])}for(var C=0;C<h.singer.chordIntervals.length;C++){var j=getNote(k[0],k[1],getInterval(h.singer.chordIntervals[C][0],h.singer.keySignature,k[0])+h.singer.chordIntervals[C][1],h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament);N(j[0],j[1],r)}for(var B=0;B<h.singer.ratioIntervals.length;B++){var M=pitchToFrequency(k[0],k[1],0,h.singer.keySignature)*h.singer.ratioIntervals[B],M=frequencyToPitch(M);N(M[0],M[1],M[2])}0<h.singer.inNoteBlock.length&&h.singer.noteBeatValues[last(h.singer.inNoteBlock)].push(h.singer.beatFactor),h.singer.pushedNote=!0}else if(0<h.singer.drumStyle.length){g=last(h.singer.drumStyle),o=h.singer.transposition,o=getNote(e,t,o,h.singer.keySignature,h.singer.movable,null,u.errorMsg);h.singer.pitchDrumTable[o[0]+o[1]]=g}else if(u.logo.inPitchStaircase){for(var w=pitchToFrequency(e,t,0,h.singer.keySignature),A=getNote(e,t,0,h.singer.keySignature,h.singer.movable,null,u.errorMsg),D=0;D<u.logo.pitchStaircase.Stairs.length;D++){if(u.logo.pitchStaircase.Stairs[D][2]<parseFloat(w))return void u.logo.pitchStaircase.Stairs.splice(D,0,[A[0],A[1],parseFloat(w),1,1]);if(u.logo.pitchStaircase.Stairs[D][2]===parseFloat(w))return void u.logo.pitchStaircase.Stairs.splice(D,1,[A[0],A[1],parseFloat(w),1,1])}u.logo.pitchStaircase.Stairs.push([A[0],A[1],parseFloat(w),1,1]),u.logo.pitchStaircase.stairPitchBlocks.push(n)}else if(u.logo.inMusicKeyboard){o=2*c+h.singer.transposition,g=getNote(e,t,o,h.singer.keySignature,h.singer.movable,null,u.errorMsg);g[0]=noteIsSolfege(e)?getSolfege(g[0]):g[0],0===h.singer.drumStyle.length&&(u.logo.musicKeyboard.instruments.push(last(h.singer.instrumentNames)),u.logo.musicKeyboard.noteNames.push(g[0]),u.logo.musicKeyboard.octaves.push(g[1]),u.logo.musicKeyboard.addRowBlock(n),h.singer.lastNotePlayed=[i[0]+i[1],4])}else{u.logo.clearNoteParams(h,n,[]),void 0===h.singer.currentCalculatedOctave&&(h.singer.currentCalculatedOctave=4),h.singer.inNoteBlock.push(n),h.singer.inverted=0<h.singer.invertList.length;for(var L=function(e,t,r,s){var n=2*c+h.singer.transposition,e=getNote(e,t,n+h.singer.register*SEMITONES,h.singer.keySignature,h.singer.movable,s,u.errorMsg,u.logo.synth.inTemperament);return 0<h.singer.drumStyle.length&&(t=last(h.singer.drumStyle),h.singer.pitchDrumTable[e[0]+e[1]]=t),h.singer.notePitches[last(h.singer.inNoteBlock)].push(e[0]),h.singer.noteOctaves[last(h.singer.inNoteBlock)].push(e[1]),h.singer.noteCents[last(h.singer.inNoteBlock)].push(r),h.singer.noteHertz[last(h.singer.inNoteBlock)].push(0===r?0:pitchToFrequency(e[0],e[1],r,h.singer.keySignature)),e},I=L(e,t,r),F=0;F<h.singer.intervals.length;F++){var R=getNote(I[0],I[1],getInterval(h.singer.intervals[F],h.singer.keySignature,I[0]),h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament);L(R[0],R[1],r)}for(var x=0;x<h.singer.semitoneIntervals.length;x++){var H=getNote(I[0],I[1],h.singer.semitoneIntervals[x][0],h.singer.keySignature,h.singer.movable,null,u.errorMsg,u.logo.synth.inTemperament);L(H[0],H[1],r,h.singer.semitoneIntervals[x][1])}0<h.singer.inNoteBlock.length&&h.singer.noteBeatValues[last(h.singer.inNoteBlock)].push(h.singer.beatFactor),h.singer.pushedNote=!0,ze.processNote(u,h.singer.defaultNoteValue,!1,n,s,function(){h.singer.inNoteBlock.splice(h.singer.inNoteBlock.indexOf(n),1)})}}},{key:"processNote",value:function(e,V,E,t,r,j){var s=e.turtles.ithTurtle(r),n=TONEBPM/(0<s.singer.bpm.length?last(s.singer.bpm):ze.masterBPM),R=Number(last(s.singer.bpm)),i=E?0===V?0:1e3*n/V:V,E=0,H=0,q=0,z=0,W=0,U=0,J=0,K=0,G=0,Y=0,X=0,$=0,o=[],Q=[],Z=[],ee=0,te=0,re=!1,se=!1,ne=!1,ie=!1,oe=!1,ge=!1,ae=null,le=!1,g=0;if(s.inSetTimbre&&last(s.singer.instrumentNames)&&((u=last(s.singer.instrumentNames))in instrumentsEffects[r]&&((l=instrumentsEffects[r][u]).vibratoActive&&(E=l.vibratoRate,q=l.vibratoIntensity,re=!0),l.distortionActive&&(z=l.distortionAmount,se=!0),l.tremoloActive&&(W=l.tremoloFrequency,U=l.tremoloDepth,ne=!0),l.phaserActive&&(J=l.rate,K=l.octaves,G=l.baseFrequency,ie=!0),l.chorusActive)&&(Y=l.chorusRate,X=l.delayTime,$=l.chorusDepth,oe=!0),u in instrumentsFilters[r])&&(ae=instrumentsFilters[r][u]),0<s.singer.vibratoRate.length&&(E=last(s.singer.vibratoRate),q=last(s.singer.vibratoIntensity),re=!0),0<s.singer.distortionAmount.length&&(z=last(s.singer.distortionAmount),se=!0),0<s.singer.tremoloDepth.length&&(W=last(s.singer.tremoloFrequency),U=last(s.singer.tremoloDepth),ne=!0),0<s.singer.rate.length&&(J=last(s.singer.rate),K=last(s.singer.octaves),G=last(s.singer.baseFrequency),ie=!0),0<s.singer.chorusRate.length&&(Y=last(s.singer.chorusRate),X=last(s.singer.delayTime),$=last(s.singer.chorusDepth),oe=!0),o=[1],0<s.singer.inHarmonic.length&&(0===o.length?e.errorMsg(_("You must have at least one Partial block inside of a Weighted-partial block")):o=last(s.singer.partials)),0<s.singer.inNeighbor.length){for(var ue=s.singer.neighborArgNote1.length,he=0;he<ue;he++)Q.push(s.singer.neighborArgNote1.pop()),Z.push(s.singer.neighborArgNote2.pop());ee=n/last(s.singer.neighborArgBeat),te=n/last(s.singer.neighborArgCurrentBeat),ge=!0}var ce=0;if(0<s.singer.inCrescendo.length&&0===s.singer.crescendoDelta.length)for(var pe in s.singer.inCrescendo.pop(),s.singer.synthVolume)ze.setSynthVolume(e.logo,r,DEFAULTVOICE,last(s.singer.synthVolume[pe]));else if(0<s.singer.crescendoDelta.length)for(var a in last(s.singer.synthVolume[DEFAULTVOICE])===last(s.singer.crescendoInitialVolume[DEFAULTVOICE])&&0===s.singer.justCounting.length&&e.logo.notation.notationBeginCrescendo(r,last(s.singer.crescendoDelta)),s.singer.synthVolume){var me=last(s.singer.synthVolume[a]),ye=s.singer.synthVolume[a].length;s.singer.synthVolume[a][ye-1]+=last(s.singer.crescendoDelta),s.singer.suppressOutput||(ze.setSynthVolume(e.logo,r,a,me),e.logo.synth.rampTo(r,a,me,last(s.singer.synthVolume[a]),n/i))}if(e.logo.inTimbre){var l=getNote(s.singer.notePitches[last(s.singer.inNoteBlock)][0],s.singer.noteOctaves[last(s.singer.inNoteBlock)][0],0,s.singer.keySignature,s.singer.movable,null,e.errorMsg);e.logo.timbre.notesToPlay.push([l[0]+l[1],1/i]),s.singer.previousNotePlayed=s.singer.lastNotePlayed,s.singer.lastNotePlayed=[l[0]+l[1],i]}else if(e.logo.inArpeggio){var u=getNote(s.singer.notePitches[last(s.singer.inNoteBlock)][0],s.singer.noteOctaves[last(s.singer.inNoteBlock)][0],0,s.singer.keySignature,s.singer.movable,null,e.errorMsg);e.logo.arpeggio.notesToPlay.push([u[0]+u[1],1/i]),s.singer.previousNotePlayed=s.singer.lastNotePlayed,s.singer.lastNotePlayed=[u[0]+u[1],i]}else if(e.logo.inMatrix||e.logo.tuplet){if(0<s.singer.inNoteBlock.length){e.logo.phraseMaker.addColBlock(t,1);for(var de=e.logo.phraseMaker.blockNo||-1,ve=0;ve<e.logo.pitchBlocks.length;ve++)e.logo.phraseMaker.addNode(e.logo.pitchBlocks[ve],t,0,de);for(var fe=0;fe<e.logo.drumBlocks.length;fe++)e.logo.phraseMaker.addNode(e.logo.drumBlocks[fe],t,0,de)}}else if(e.logo.inLegoWidget&&!e.logo.inMatrix)s.singer.inNoteBlock.length,i*=s.singer.beatFactor,e.logo.tuplet?e.logo.addingNotesToTuplet?(l=e.logo.tupletRhythms.length-1,e.logo.tupletRhythms[l].push(i)):(e.logo.tupletRhythms.push(["notes",e.logo.tupletParams.length-1,i]),e.logo.addingNotesToTuplet=!0):e.logo.tupletRhythms.push(["",1,i]);else{null===e.logo.firstNoteTime&&(e.logo.firstNoteTime=(new Date).getTime());u=((new Date).getTime()-e.logo.firstNoteTime)/1e3,l=0===s.singer.drift?Math.max(u-s.singer.turtleTime,0):0,u=s.singer.tie?s.singer.tieCarryOver:0;if(s.singer.tie){var h=last(s.singer.inNoteBlock);if(0<s.singer.tieCarryOver){var c,be,Ne=!0;if(!(Ne=s.singer.tieNotePitches.length===s.singer.notePitches[last(s.singer.inNoteBlock)].length&&(c=(y=function(e){return e.map(function(e){return"".concat(e[0],":").concat(e[1],":").concat(e[2])}).sort()})(s.singer.tieNotePitches),be=y(s.singer.notePitches[last(s.singer.inNoteBlock)].map(function(e,t){return[e,s.singer.noteOctaves[last(s.singer.inNoteBlock)][t],s.singer.noteCents[last(s.singer.inNoteBlock)][t]]})),c.length===be.length)&&c.every(function(e,t){return e===be[t]})?Ne:!1)){e.errorMsg(_("You can only tie notes of the same pitch. Did you mean to use slur?"),h);for(var p=[],m=0;m<s.singer.notePitches[last(s.singer.inNoteBlock)].length;m++)p.push([s.singer.notePitches[h][m],s.singer.noteOctaves[h][m],s.singer.noteCents[h][m],s.singer.noteHertz[h][m],h]);var y=[h,s.singer.oscList[h],s.singer.noteBeat[h],s.singer.noteBeatValues[h],s.singer.noteDrums[h],s.singer.embeddedGraphics[h]],h=s.singer.tieNoteExtras[0];s.singer.inNoteBlock.push(h),s.singer.notePitches[h]=[],s.singer.noteOctaves[h]=[],s.singer.noteCents[h]=[],s.singer.noteHertz[h]=[];for(var d=0;d<s.singer.tieNotePitches.length;d++)s.singer.notePitches[h].push(s.singer.tieNotePitches[d][0]),s.singer.noteOctaves[h].push(s.singer.tieNotePitches[d][1]),s.singer.noteCents[h].push(s.singer.tieNotePitches[d][2]),s.singer.noteHertz[h].push(s.singer.tieNotePitches[d][3]);if(s.singer.oscList[h]=s.singer.tieNoteExtras[1],s.singer.noteBeat[h]=s.singer.tieNoteExtras[2],s.singer.noteBeatValues[h]=s.singer.tieNoteExtras[3],s.singer.noteDrums[h]=s.singer.tieNoteExtras[4],s.singer.embeddedGraphics[h]=s.singer.tieNoteExtras[5],0===s.singer.justCounting.length)for(var ke=0;ke<s.singer.notePitches[h].length;ke++)e.logo.notation.notationRemoveTie(r);s.singer.tie=!1,u=0,ze.processNote(e,s.singer.tieCarryOver,!1,h,r),s.singer.inNoteBlock.pop(),s.singer.suppressOutput||s.doWait(Math.max(n/s.singer.tieCarryOver-l,0)),u=s.singer.tieCarryOver,s.singer.tieCarryOver=0,s.singer.tie=!0,s.singer.notePitches[h=y[0]]=[],s.singer.noteOctaves[h]=[],s.singer.noteCents[h]=[],s.singer.noteHertz[h]=[];for(var v=0;v<p.length;v++)s.singer.notePitches[h].push(p[v][0]),s.singer.noteOctaves[h].push(p[v][1]),s.singer.noteCents[h].push(p[v][2]),s.singer.noteHertz[h].push(p[v][3]);s.singer.oscList[h]=y[1],s.singer.noteBeat[h]=y[2],s.singer.noteBeatValues[h]=y[3],s.singer.noteDrums[h]=y[4],s.singer.embeddedGraphics[h]=y[5]}}if(0===s.singer.tieCarryOver){s.singer.tieNotePitches=[],s.singer.tieCarryOver=i;for(var f=0;f<s.singer.notePitches[h].length;f++)s.singer.tieNotePitches.push([s.singer.notePitches[h][f],s.singer.noteOctaves[h][f],s.singer.noteCents[h][f],s.singer.noteHertz[h][f]]);s.singer.tieNoteExtras=[h,s.singer.oscList[h],s.singer.noteBeat[h],s.singer.noteBeatValues[h],s.singer.noteDrums[h],[]],s.singer.tieFirstDrums=s.singer.noteDrums[h],i=0}else ce=s.singer.tieCarryOver,i=1/(1/i+1/s.singer.tieCarryOver),s.singer.tieCarryOver=0}var b=i=0<s.singer.swing.length&&(null==last(s.singer.swingTarget)&&(s.singer.swingTarget[s.singer.swingTarget.length-1]=i),c=last(s.singer.swing),i===last(s.singer.swingTarget))&&(0===s.singer.swingCarryOver?(i=1/(1/i+1/c),s.singer.swingCarryOver=c):(i=i===c?0:1/(1/i-1/c),s.singer.swingCarryOver=0),i<0)?0:i;if(0<b)if(s.singer.previousTurtleTime=s.singer.turtleTime,1===s.singer.inNoteBlock.length)s.singer.turtleTime+=n/b,s.singer.suppressOutput||s.doWait(Math.max(n/b-l,0)),s.singer.delayedNotes=[];else{for(var le=!0,g=0,Te=0;Te<s.singer.delayedNotes.length&&(0<Te&&(g+=n*s.singer.delayedNotes[Te-1][1]),s.singer.delayedNotes[Te][0]!==t);Te++);console.log("Note in note "+t+" delay "+g)}var Se=!1,N=(1<s.singer.skipFactor&&(0<s.singer.skipIndex%s.singer.skipFactor&&(Se=!0),s.singer.skipIndex+=1),[]),Pe=[];if(null!==last(s.singer.inNoteBlock)||le){var k=last(s.singer.inNoteBlock);if(void 0!==s.singer.notePitches[k]){if(1<s.singer.notePitches[k].length)for(;s.singer.notePitches[k].includes("rest");)s.singer.notePitches[k].splice(s.singer.notePitches[k].indexOf("rest"),1);if(0===s.singer.notePitches[k].length&&s.singer.notePitches[last(s.singer.inNoteBlock)].push("rest"),!e.logo.stopTurtle){s.singer.inNoteBlock.length===s.singer.whichNoteToCount&&(s.singer.notesPlayed=rationalSum(s.singer.notesPlayed,[1,V]),s.singer.tallyNotes++);var T=[],Oe=[];if(s.singer.noteBeat[t]=i,isFinite(b)){for(var S,Ne=0<s.singer.glide.length?last(s.singer.glide):0,P=n/i,Ce=(0<s.singer.staccato.length&&(P=(M=last(s.singer.staccato))<0?n*(1/i-1/M):i<M?n/M:n/i),re&&(H=P*(b/E)),[]),Be=0;Be<s.singer.notePitches[k].length;Be++){var Me=s.singer.notePitches[k][Be],we=!1;if(1===Me.length)for(var O=0;O<s.singer.notePitches[k].length;O++)Be===O||s.singer.noteOctaves[k][Be]!==s.singer.noteOctaves[k][O]||Me+"♯"!==s.singer.notePitches[k][O]&&Me+"♭"!==s.singer.notePitches[k][O]||(we=!0);Ce.push(we)}if(0<s.singer.notePitches[k].length){for(var C,Ae,B=0;B<s.singer.notePitches[k].length;B++)"rest"===s.singer.notePitches[k][B]||Se?(S="R",s.singer.previousNotePlayed=s.singer.lastNotePlayed):(C=getNote(s.singer.notePitches[k][B],s.singer.noteOctaves[k][B],0,s.singer.keySignature,s.singer.movable,null,e.errorMsg,e.logo.synth.inTemperament),S=0!==s.singer.noteCents[k][B]?0!==s.singer.noteHertz[k][B]?s.singer.noteHertz[k][B]:Math.floor(pitchToFrequency(C[0],C[1],s.singer.noteCents[k][B],s.singer.keySignature)):C[0]+C[1]),"R"!==S&&(0<(C=o.indexOf(1))&&(S=noteToFrequency(S,s.singer.keySignature)*(C+1)),T.push(S)),0<b?(0<ce&&0===B&&0===s.singer.justCounting.length&&e.logo.notation.notationInsertTie(r),0===s.singer.justCounting.length&&(0<s.singer.noteDrums[k].length?(N.includes(S)||N.push(S),Pe.includes(s.singer.noteDrums[k][0])||Pe.push(s.singer.noteDrums[k][0])):Ce[B]?N.includes(S+"♮")||N.push(S+"♮"):N.includes(S)||N.push(S))):0<s.singer.tieCarryOver&&(0!==s.singer.justCounting.length||N.includes(S)||N.push(S)),B===s.singer.notePitches[k].length-1&&(Ae=void 0,0<b?Ae=0<ce?1/(1/b-1/ce):b:0<s.singer.tieCarryOver&&(Ae=s.singer.tieCarryOver),e.logo.runningLilypond||e.logo.runningMxml||e.logo.runningAbc||e.logo.runningMIDI)&&(e.logo.notationMIDI(N,Pe,Ae,r,R||90,last(s.singer.instrumentNames)),e.logo.updateNotation(N,Ae,r,-1,Pe));for(var De=isCustomTemperament(e.logo.synth.inTemperament)?e.logo.synth.getCustomFrequency(T):e.logo.synth.getFrequency(T,e.logo.synth.changeInTemperament),M=e.logo.synth.startingPitch,Le=pitchToFrequency(M.substring(0,M.length-1),Number(M.slice(-1)),0,null),Ie=getTemperament(e.logo.synth.inTemperament).pitchNumber,Fe=[],w=0;w<De.length;w++)void 0!==De[w]&&(Fe[w]=De[w]/Le,w,(Ie*(Math.log10(Fe[w])/Math.log10(getOctaveRatio()))).toFixed(0),w,rationalToFraction(Fe[w])[0],w,rationalToFraction(Fe[w])[1]);if(s.singer.suppressOutput||s.blink(b,last(ze.masterVolume)),0<T.length){M=T[0].length;s.singer.currentOctave="number"==typeof T[0]?frequencyToPitch(T[0])[1]:parseInt(T[0].slice(M-1)),s.singer.currentCalculatedOctave=s.singer.currentOctave;for(var xe=0;xe<T.length;xe++)"string"==typeof T[xe]&&(T[xe]=T[xe].replace(/♭/g,"b").replace(/♯/g,"#"));if(0<b&&!Se){var A={doVibrato:re,doDistortion:se,doTremolo:ne,doPhaser:ie,doChorus:oe,doPartials:!0,doPortamento:!0,doNeighbor:ge,vibratoIntensity:q,vibratoFrequency:H,distortionAmount:z,tremoloFrequency:W,tremoloDepth:U,rate:J,octaves:K,baseFrequency:G,chorusRate:Y,delayTime:X,chorusDepth:$,partials:o,portamento:Ne,neighborArgNote1:Q,neighborArgNote2:Z,neighborArgBeat:ee,neighborArgCurrentBeat:te},Ve=!1;if(0<s.singer.drumStyle.length&&t in e.blocks.blockList)for(var D=e.blocks.blockList[t].connections[0],D=e.blocks.blockList[D];"setdrum"!==D.name;){if("settimbre"===D.name){Ve=!0;break}if(null===(D=D.connections[0]))break;D=e.blocks.blockList[D]}if(0<s.singer.oscList[k].length)1<T.length&&e.errorMsg(last(s.singer.oscList[k])+": "+_("synth cannot play chords."),t),s.singer.suppressOutput||e.logo.synth.trigger(r,T,P,last(s.singer.oscList[k]),A,null,!1,g);else if(0<s.singer.drumStyle.length&&!Ve)s.singer.suppressOutput||e.logo.synth.trigger(r,T,P,last(s.singer.drumStyle),null,null,!1,g);else for(var _e,L=0;L<T.length;L++)T[L]in s.singer.pitchDrumTable&&!Ve?s.singer.suppressOutput||e.logo.synth.trigger(r,T[L],P,s.singer.pitchDrumTable[T[L]],null,null,!1,g):last(s.singer.instrumentNames)?s.singer.suppressOutput||(0<s.singer.glide.length?0===s.singer.glideOverride?e.logo.synth.trigger(r,T[L],P,last(s.singer.instrumentNames),A,ae,!0,g):(_e=n/s.singer.glideOverride,e.logo.synth.trigger(r,T[L],_e,last(s.singer.instrumentNames),A,ae,!1,g),s.singer.glideOverride=0):e.logo.synth.trigger(r,T[L],P,last(s.singer.instrumentNames),A,ae,!1,g)):0<s.singer.voices.length&&last(s.singer.voices)?s.singer.suppressOutput||e.logo.synth.trigger(r,T[L],P,last(s.singer.voices),A,null,!1,g):s.singer.suppressOutput||e.logo.synth.trigger(r,T[L],P,DEFAULTVOICE,A,null,!1,g)}s.singer.previousNotePlayed=s.singer.lastNotePlayed,s.singer.lastNotePlayed=[T[0],i],s.singer.noteStatus=[T,i],s.singer.lastPitchPlayed=s.singer.lastNotePlayed}}if(0<s.singer.noteDrums[k].length){for(var Ee=0;Ee<s.singer.noteDrums[k].length;Ee++)Oe.push(s.singer.noteDrums[k][Ee]);for(var je,Re=0;Re<s.singer.tieFirstDrums.length;Re++)Oe.includes(s.singer.tieFirstDrums[Re])||Oe.push(s.singer.tieFirstDrums[Re]);if(0!==s.singer.notePitches[k].length||s.singer.suppressOutput||s.blink(b,last(ze.masterVolume)),s.singer.tie&&0<s.singer.tieCarryOver||0<b){if(s.singer.tie&&0===i?je=0:(je=P,0<u&&(s.singer.tieFirstDrums=[])),0<je&&!Se)for(var He=0;He<Oe.length;He++)0<s.singer.drumStyle.length?s.singer.suppressOutput||e.logo.synth.trigger(r,["C2"],je,last(s.singer.drumStyle),null,null,!1,g):s.singer.suppressOutput||e.logo.synth.trigger(r,["C2"],je,Oe[He],null,null,!1,g);0===T.length&&(s.singer.previousNotePlayed=s.singer.lastNotePlayed,s.singer.lastNotePlayed=["C2",i],s.singer.noteStatus=[["C2"],i],s.singer.lastPitchPlayed=s.singer.lastNotePlayed)}}s.singer.suppressOutput||Se||e.logo.synth.start(),s.singer.tie&&0===i?0<u?e.logo.dispatchTurtleSignals(r,n/s.singer.tieCarryOver,t,n/u):e.logo.dispatchTurtleSignals(r,n/s.singer.tieCarryOver,t,0):0<u?e.logo.dispatchTurtleSignals(r,P-n/u,t,n/u):e.logo.dispatchTurtleSignals(r,P,t,0),s.singer.embeddedGraphics[t]=[],setTimeout(function(){e.blocks.visible&&t in e.blocks.blockList&&e.blocks.unhighlight(t)},1e3*P)}}}if(0<e.logo.specialArgs.length){for(var I=e.logo.specialArgs.pop(),F=I[3],qe=[],x=1;x<=e.blocks.blockList[F].protoblock.args;x++)"in"===e.blocks.blockList[F].protoblock.dockTypes[x]?null!==e.blocks.blockList[F].connections[x]&&qe.push(e.blocks.blockList[F].connections[x]):qe.push(e.logo.parseArg(e.logo,I[2],e.blocks.blockList[F].connections[x],F,I[4]));"function"==typeof e.blocks.blockList[F].protoblock.flow&&e.blocks.blockList[F].protoblock.flow(qe,I[1],I[2],I[3],I[4],I[5],I[6])}}}s.singer.pushedNote=!1,null!=j&&j(),e.stage.update()}}])})();_defineProperty(Singer,"masterBPM",TARGETBPM),_defineProperty(Singer,"defaultBPMFactor",TONEBPM/TARGETBPM),_defineProperty(Singer,"masterVolume",[DEFAULTVOLUME]),"undefined"!=typeof module&&module.exports&&(module.exports=Singer);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regenerator(){var p,t="function"==typeof Symbol?Symbol:{},e=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function n(t,e,i,n){var r,s,a,o,h,c,u,l,g,e=e&&e.prototype instanceof d?e:d,e=Object.create(e.prototype);return _regeneratorDefine2(e,"_invoke",(r=t,s=i,u=n||[],l=!1,g={p:c=0,n:0,v:p,a:f,f:f.bind(p,4),d:function(t,e){return a=t,o=0,h=p,g.n=e,_}},function(t,e,i){if(1<c)throw TypeError("Generator is already running");for(l&&1===e&&f(e,i),o=e,h=i;(m=o<2?p:h)||!l;){a||(o?o<3?(1<o&&(g.n=-1),f(o,h)):g.n=h:g.v=h);try{if(c=2,a){if(m=a[t=o?t:"next"]){if(!(m=m.call(a,h)))throw TypeError("iterator result is not an object");if(!m.done)return m;h=m.value,o<2&&(o=0)}else 1===o&&(m=a.return)&&m.call(a),o<2&&(h=TypeError("The iterator does not provide a '"+t+"' method"),o=1);a=p}else if((m=(l=g.n<0)?h:r.call(s,g))!==_)break}catch(t){a=p,o=1,h=t}finally{c=1}}return{value:m,done:l}}),!0),e;function f(t,e){for(o=t,h=e,m=0;!l&&c&&!i&&m<u.length;m++){var i,n=u[m],r=g.p,s=n[2];3<t?(i=s===e)&&(h=n[(o=n[4])?5:o=3],n[4]=n[5]=p):n[0]<=r&&((i=t<2&&r<n[1])?(o=0,g.v=e,g.n=n[1]):r<s&&(i=t<3||n[0]>e||s<e)&&(n[4]=t,n[5]=e,g.n=s,o=0))}if(i||1<t)return _;throw l=!0,e}}var _={};function d(){}function r(){}function s(){}var m=Object.getPrototypeOf,t=[][e]?m(m([][e]())):(_regeneratorDefine2(m={},e,function(){return this}),m),a=s.prototype=d.prototype=Object.create(t);function o(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,_regeneratorDefine2(t,i,"GeneratorFunction")),t.prototype=Object.create(a),t}return _regeneratorDefine2(a,"constructor",r.prototype=s),_regeneratorDefine2(s,"constructor",r),_regeneratorDefine2(s,i,r.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,i,"Generator"),_regeneratorDefine2(a,e,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:o}})()}function _regeneratorDefine2(t,e,i,n){var s=Object.defineProperty;try{s({},"",{})}catch(t){s=0}(_regeneratorDefine2=function(t,e,i,n){function r(e,i){_regeneratorDefine2(t,e,function(t){return this._invoke(e,i,t)})}e?s?s(t,e,{value:i,enumerable:!n,configurable:!n,writable:!n}):t[e]=i:(r("next",0),r("throw",1),r("return",2))})(t,e,i,n)}function asyncGeneratorStep(t,e,i,n,r,s,a){try{var o=t[s](a),h=o.value}catch(t){return void i(t)}o.done?e(h):Promise.resolve(h).then(n,r)}function _asyncToGenerator(o){return function(){var t=this,a=arguments;return new Promise(function(e,i){var n=o.apply(t,a);function r(t){asyncGeneratorStep(n,e,i,r,s,"next",t)}function s(t){asyncGeneratorStep(n,e,i,r,s,"throw",t)}r(void 0)})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var Turtle=(()=>{return _createClass(function t(e,i,n,r,s){_classCallCheck(this,t),importMembers(this,"",[e,i,n,r,s]),this.activity=e,this.singer=new Singer(this),this.painter=new Painter(this),this._waitTime=0,this.embeddedGraphicsFinished=!0,this.inSetTimbre=!1,this._blinkFinished=!0},[{key:"blinking",value:function(){return!this._blinkFinished}},{key:"doWait",value:function(t){this._waitTime=1e3*Number(t)}},{key:"_createCache",value:function(){var t=this;this.bounds=this.container.getBounds(),null==this.bounds?setTimeout(function(){t._createCache()},200):this.container.cache(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height)}},{key:"updateCache",value:(t=_asyncToGenerator(_regenerator().m(function t(){return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(null==this.bounds)return console.debug("Block container for "+this.name+" not yet ready."),t.n=1,delayExecution(300);t.n=2;break;case 1:this.updateCache(),t.n=3;break;case 2:this.container.updateCache(),this.activity.refreshCanvas();case 3:return t.a(2)}},t,this)})),function(){return t.apply(this,arguments)})},{key:"stopBlink",value:function(){null==this._blinkTimeout&&this._blinkFinished||(clearTimeout(this._blinkTimeout),this._blinkTimeout=null,this.container.visible=!0,this.activity.refreshCanvas(),this._blinkFinished=!0)}},{key:"blink",value:(i=_asyncToGenerator(_regenerator().m(function t(e,i){return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if("CursorOver"+this.id in this.listeners||"CursorOut"+this.id in this.listeners)return t.a(2);t.n=1;break;case 1:if(this._blinkTimeout=null,16<e)return t.a(2);t.n=2;break;case 2:return this.stopBlink(),this._blinkFinished=!1,this.container.visible=!1,this.activity.refreshCanvas(),t.n=3,delayExecution(100);case 3:this._blinkTimeout=t.v,this._blinkFinished=!0,this.container.visible=!0,this.activity.refreshCanvas();case 4:return t.a(2)}},t,this)})),function(t,e){return i.apply(this,arguments)})},{key:"initTurtle",value:function(t){this.doWait(0),this.endOfClampSignals={},this.butNotThese={},this.embeddedGraphicsFinished=!0,this.inSetTimbre=!1,this.painter.cp1x=0,this.painter.cp1y=100,this.painter.cp2x=100,this.painter.cp2y=100,this.singer.attack=[],this.singer.decay=[],this.singer.sustain=[],this.singer.release=[],this.singer.scalarTransposition=0,this.singer.scalarTranspositionValues=[],this.singer.transposition=0,this.singer.transpositionValues=[],this.singer.register=0,this.singer.beatFactor=1,this.singer.dotCount=0,this.singer.noteBeat={},this.singer.noteValue={},this.singer.oscList={},this.singer.noteDrums={},this.singer.notePitches={},this.singer.noteOctaves={},this.singer.noteCents={},this.singer.noteHertz={},this.singer.noteBeatValues={},this.singer.embeddedGraphics={},this.singer.lastNotePlayed=null,this.singer.previousNotePlayed=null,this.singer.noteStatus=null,this.singer.noteDirection=0,this.singer.pitchNumberOffset=39,this.singer.currentOctave=4,this.singer.inHarmonic=[],this.singer.partials=[],this.singer.inNeighbor=[],this.singer.neighborStepPitch=[],this.singer.neighborNoteValue=[],this.singer.inDefineMode=!1,this.singer.defineMode=[],this.singer.notesPlayed=[0,1],this.singer.whichNoteToCount=1,this.singer.movable=!1,this.singer.bpm=[],this.singer.previousTurtleTime=0,this.singer.turtleTime=0,this.singer.pushedNote=!1,this.singer.duplicateFactor=1,this.singer.inDuplicate=!1,this.singer.skipFactor=1,this.singer.skipIndex=0,this.singer.instrumentNames=[DEFAULTVOICE],this.singer.inCrescendo=[],this.singer.crescendoDelta=[],this.singer.crescendoInitialVolume={DEFAULTVOICE:[DEFAULTVOLUME]},this.singer.intervals=[],this.singer.semitoneIntervals=[],this.singer.staccato=[],this.singer.glide=[],this.singer.glideOverride=0,this.singer.swing=[],this.singer.swingTarget=[],this.singer.swingCarryOver=0,this.singer.tie=!1,this.singer.tieNotePitches=[],this.singer.tieNoteExtras=[],this.singer.tieCarryOver=0,this.singer.tieFirstDrums=[],this.singer.drift=0,this.singer.drumStyle=[],this.singer.voices=[],this.singer.backward=[],this.singer.vibratoIntensity=[],this.singer.vibratoRate=[],this.singer.distortionAmount=[],this.singer.tremoloFrequency=[],this.singer.tremoloDepth=[],this.singer.rate=[],this.singer.octaves=[],this.singer.baseFrequency=[],this.singer.chorusRate=[],this.singer.delayTime=[],this.singer.chorusDepth=[],this.singer.neighborArgNote1=[],this.singer.neighborArgNote2=[],this.singer.neighborArgBeat=[],this.singer.neighborArgCurrentBeat=[],this.singer.inNoteBlock=[],this.singer.multipleVoices=!1,this.singer.invertList=[],this.singer.beatList=[],this.singer.factorList=[],this.singer.keySignature="C major",this.singer.pitchDrumTable={},this.singer.defaultStrongBeats=!1,this.singer.pickup=0,this.singer.beatsPerMeasure=4,this.singer.noteValuePerBeat=4,this.singer.currentBeat=0,this.singer.currentMeasure=0,this.singer.justCounting=[],this.singer.justMeasuring=[],this.singer.firstPitch=[],this.singer.lastPitch=[],this.singer.suppressOutput=t,this.singer.dispatchFactor=1,this.singer.runningFromEvent=!1}},{key:"waitTime",get:function(){return this._waitTime}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"turtles",get:function(){return this._turtles}},{key:"startBlock",get:function(){return this._startBlock},set:function(t){this._startBlock=t}},{key:"queue",get:function(){return this._queue},set:function(t){this._queue=t}},{key:"parentFlowQueue",get:function(){return this._parentFlowQueue},set:function(t){this._parentFlowQueue=t}},{key:"unhighlightQueue",get:function(){return this._unhighlightQueue},set:function(t){this._unhighlightQueue=t}},{key:"parameterQueue",get:function(){return this._parameterQueue},set:function(t){this._parameterQueue=t}},{key:"listeners",get:function(){return this._listeners},set:function(t){this._listeners=t}},{key:"media",get:function(){return this._media},set:function(t){this._media=t}},{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"running",get:function(){return this._running},set:function(t){this._running=t}},{key:"inTrash",get:function(){return this._trash},set:function(t){this._trash=t}},{key:"decorationBitmap",get:function(){return this._decorationBitmap}},{key:"container",get:function(){return this._container},set:function(t){this._container=t}},{key:"bitmap",get:function(){return this._bitmap},set:function(t){this._bitmap=t}},{key:"imageContainer",get:function(){return this._imageContainer},set:function(t){this._imageContainer=t}},{key:"penstrokes",get:function(){return this._penstrokes},set:function(t){this._penstrokes=t}},{key:"skinChanged",get:function(){return this._skinChanged},set:function(t){this._skinChanged=t}},{key:"orientation",get:function(){return this._orientation},set:function(t){this._orientation=t}},{key:"canvas",get:function(){return this._canvas}},{key:"ctx",get:function(){return this._ctx}}]);var i,t})();Turtle.TurtleModel=(()=>_createClass(function t(e,i,n,r,s){_classCallCheck(this,t),this.activity=e,this._id=i,this._name=n,this._turtles=r,this._startBlock=s,this._queue=[],this._parentFlowQueue=[],this._unhighlightQueue=[],this._parameterQueue=[],this._listeners={},this.endOfClampSignals={},this.butNotThese={},this.delayTimeout={},this.delayParameters={},this._media=[],this._x=0,this._y=0,this._running=!1,this._trash=!1},[{key:"rename",value:function(t){this._name=t;t=this._startBlock;null!=t&&(t.overrideName=this._name,t.collapseText.text=this._name,t.regenerateArtwork(!1),t.value=this._turtles.getIndexOfTurtle(this))}}]))(),Turtle.TurtleView=(()=>{return _createClass(function t(){_classCallCheck(this,t),this._decorationBitmap=null,this._decorationBaseScale=.5,this._container=null,this._bitmap=null,this._imageContainer=null,this._penstrokes=null,this._skinChanged=!1,this._orientation=0,this._canvas=document.getElementById("overlayCanvas"),this._ctx=this._canvas.getContext("2d")},[{key:"doShowImage",value:(i=_asyncToGenerator(_regenerator().m(function t(e,i){var n,r,s,a,o,h=this;return _regenerator().w(function(t){for(;;)switch(t.p=t.n){case 0:if(null===i)return t.a(2);t.n=1;break;case 1:if(n=this.activity.gifAnimator,this._activeGifId&&n&&(n.stopAnimation(this._activeGifId),(r=this._ctx).save(),r.translate(this.container.x,this.container.y),r.rotate(this.orientation*Math.PI/180),r.clearRect(-500,-500,1e3,1e3),r.restore(),this._activeGifId=null),n&&n.isAnimatedGIF(i))return t.p=2,r=Number(e),t.n=3,n.createAnimation(i,this._canvas,this.container.x,this.container.y,r,r,this.orientation);t.n=6;break;case 3:if(null!==(s=t.v))return this._activeGifId=s,this._media.push({type:"gif",id:s,stop:function(){return n.stopAnimation(s)}}),this.activity.refreshCanvas(),t.a(2);t.n=4;break;case 4:t.n=6;break;case 5:t.p=5,o=t.v,console.warn("GIF animation failed, falling back to static image:",o);case 6:(a=new Image).onload=function(){var t=new createjs.Bitmap(a);h.imageContainer.addChild(t),h._media.push(t),t.scaleX=Number(e)/a.width,t.scaleY=t.scaleX,t.scale=t.scaleX,t.x=h.container.x,t.y=h.container.y,t.regX=a.width/2,t.regY=a.height/2,t.rotation=h.orientation,h.activity.refreshCanvas()},a.src=i;case 7:return t.a(2)}},t,this,[[2,5]])})),function(t,e){return i.apply(this,arguments)})},{key:"_updateMediaPositions",value:function(){var e,i=this;this._media&&(e=this.activity.gifAnimator,this._media.forEach(function(t){"gif"===t.type&&e?e.updatePosition(t.id,i.container.x,i.container.y,i.orientation):t instanceof createjs.Bitmap&&(t.x=i.container.x,t.y=i.container.y,t.rotation=i.orientation)}))}},{key:"doTurtleShell",value:function(t,i){var n,r,s=this;null!==i&&(n=Number(t),(r=new Image).src=i,r.onload=function(){s.container.removeChild(s._bitmap),s._bitmap=new createjs.Bitmap(r),s.container.addChild(s._bitmap),s._bitmap.scaleX=n/r.width,s._bitmap.scaleY=s._bitmap.scaleX,s._bitmap.scale=s._bitmap.scaleX,s._bitmap.x=0,s._bitmap.y=0,s._bitmap.regX=r.width/2,s._bitmap.regY=r.height/2,s._bitmap.rotation=s.orientation,s._skinChanged=!0,s.container.uncache();var t=s.container.getBounds(),e=(s.container.cache(t.x,t.y,t.width,t.height),new createjs.Shape),t=(e.graphics.beginFill("#FFF").drawRect(0,0,t.width,t.height),e.x=-t.width/2,e.y=-t.height/2,s.container.hitArea=e,s._startBlock);null!=t&&(t.container.removeChild(s._decorationBitmap),s._decorationBitmap=new createjs.Bitmap(i),t.container.addChild(s._decorationBitmap),s._decorationBitmap.name="decoration",s._decorationBaseScale=27.5/r.width,e=t.width,s._decorationBitmap.x=e-30*t.protoblock.scale/2,s._decorationBitmap.y=20*t.protoblock.scale/2,s._decorationBitmap.scaleX=s._decorationBaseScale*t.protoblock.scale/2,s._decorationBitmap.scaleY=27.5/r.height*t.protoblock.scale/2,s._decorationBitmap.scale=s._decorationBaseScale*t.protoblock.scale/2,t.updateCache()),s.activity.refreshCanvas()})}},{key:"resizeDecoration",value:function(t,e){this._decorationBitmap.x=e-30*t/2,this._decorationBitmap.y=20*t/2,this._decorationBitmap.scaleX=this._decorationBitmap.scaleY=this._decorationBitmap.scale=this._decorationBaseScale*t/2}},{key:"doShowText",value:function(t,e){if(null!==e)for(var i="string"!=typeof e?[e.toString()]:e.split("\\n"),n=t.toString()+"px "+this.painter.font,r=0;r<i.length;r++){var s=new createjs.Text(i[r],n,this.painter.canvasColor),a=(s.textAlign="left",s.textBaseline="alphabetic",this.turtles.stage.addChild(s),this._media.push(s),s.x=this.container.x,s.y=this.container.y+r*t,s.rotation=this.orientation,s.x*this.turtles.scale),s=s.y*this.turtles.scale,o=t*this.turtles.scale;this.painter.svgOutput+='<text x="'+a+'" y = "'+s+'" fill="'+this.painter.canvasColor+'" font-family = "'+this.painter.font+'" font-size = "'+o+'">'+e+"</text>",this.activity.refreshCanvas()}}},{key:"makeTurtleBitmap",value:function(t,i,n){var r=this,s=new Image;s.onload=function(){var t,e=new createjs.Bitmap(s),e=(r._bitmap=e,r._bitmap.regX=27,r._bitmap.regY=27,r._bitmap.cursor="pointer",r.container.addChild(r._bitmap),r._createCache(),r._startBlock);n&&null!=e&&(e.updateCache(),r._decorationBitmap=r._bitmap.clone(),e.container.addChild(r._decorationBitmap),r._decorationBitmap.name="decoration",t=e.width,r._decorationBitmap.x=t-40*e.protoblock.scale/2,r._decorationBitmap.y=35*e.protoblock.scale/2,r._decorationBitmap.scaleX=r._decorationBitmap.scaleY=r._decorationBitmap.scale=.5*e.protoblock.scale/2,e.updateCache()),i.refreshCanvas()},s.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(t))}}]);var i})();
var LOGODEFAULT,NUMBERBLOCKDEFAULT,DATAOBJS,HELPCONTENT,TITLESTRING,BUILTINPALETTES,BUILTINPALETTESFORL23N,MULTIPALETTES,SKIPPALETTES,MULTIPALETTEICONS,VERSION="3.7.0",LOGOJA1=LOGODEFAULT,LOGOJA=LOGODEFAULT,GUIDEURL=_("guide url"),DEFAULTPALETTE=_THIS_IS_TURTLE_BLOCKS_?(LOGOJA=LOGOJA1=LOGODEFAULT='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100" height="100" viewBox="0 0 55 55" style="fill:#ffffff;stroke:#000000;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round"> <path d="m 53.481267,28.305392 c -0.209367,-1.54431 -0.683684,-3.963142 -2.434581,-4.798755 -1.109828,-0.528975 -7.180267,0.535648 -11.31572,0.588453 0.144519,2.488312 -0.778093,5.155238 -3.939898,9.809475 -1.886409,3.241636 -10.411329,3.515578 -10.800417,3.494271 L 1.4324287,37.296302 c 1.1691172,1.648067 3.6860922,3.761922 6.4671469,4.112101 -0.7457525,0.657744 -3.0978837,3.276679 -3.2729735,6.681202 -0.00463,0.07596 0.00185,0.409469 0,0.409469 l 7.4343649,0 c 0.254761,-1.852802 0.9755,-5.273073 2.895929,-6.51445 1.432215,-0.0083 2.73844,-0.166752 3.757481,-0.1158 2.352131,0.116727 7.112904,-0.04725 10.314545,-0.276067 0.02409,0.01297 0.03891,0.273288 0.06392,0.28811 2.092739,1.107049 2.853314,4.766332 3.119191,6.619133 l 7.434366,0 c -9.27e-4,0 0.0056,-0.333504 9.26e-4,-0.409469 -0.173237,-3.361908 -3.144204,-6.569107 -4.146569,-7.513109 2.836638,-1.260832 7.123094,-5.459279 8.243113,-6.678423 0.294595,-0.318681 1.391453,-1.678638 2.22614,-2.303032 0.782809,-0.584558 3.337822,-0.893976 4.296647,-0.935664 0.960677,-0.04169 3.004317,0.407616 3.004317,0.407616 0,0 0.306638,-2.060315 0.210294,-2.762527 z" style="stroke-width:1.92499995;stroke-miterlimit:4;stroke-dasharray:none" /> <circle cx="59.484001" cy="37.223999" r="1.109" transform="matrix(0.92640065,0,0,0.92640065,-6.9147758,-8.3090122)" style="stroke-width:1.18739116;stroke-miterlimit:4;stroke-dasharray:none" /> <g transform="matrix(1.0320878,0,0,0.99904752,-0.184081,0.02418615)"> <path d="m 10.571891,36.919704 5.798216,-14.14899 -5.012466,-5.534784 c -1.4233734,1.718282 -2.480637,3.711241 -2.8150389,5.046387 -0.451356,1.79814 0,7.96332 0.5856365,10.1437 l -2.8182215,4.571955 4.0512949,-0.148486 z" style="fill:#186dee;fill-opacity:1;stroke-width:1.92499995;stroke-miterlimit:4;stroke-dasharray:none" /> <path d="m 15.827351,23.138991 12.64663,-0.323916 3.118775,-3.975828 c -0.869792,-1.299255 -2.013342,-2.558133 -3.475701,-3.315433 -4.355888,-2.256648 -8.269084,-3.109957 -13.966045,-0.280847 -1.311618,0.652319 -1.961058,1.152293 -2.772806,1.934717 z" style="fill:#ffb504;fill-opacity:1;stroke-width:1.92499995;stroke-miterlimit:4;stroke-dasharray:none" /> <path d="M 28.827609,22.944786 16.350738,23.050047 10.704106,37.127591 29.0947,37.332873 c 3.504125,-0.134986 4.499519,-1.032283 5.462399,-1.962597 z" style="fill:#009a57;fill-opacity:1;stroke-width:1.92499995;stroke-miterlimit:4;stroke-dasharray:none" /> <path d="m 34.981054,23.766238 c 0,0 -2.011809,-2.505097 -3.098182,-4.441418 l -2.902193,3.701262 5.37511,12.556508 c 0.907909,-0.615531 2.256487,-2.511987 2.898435,-3.491812 2.418679,-3.238079 2.693228,-7.998903 2.693228,-7.998903 z" style="fill:#d8432e;fill-opacity:1;stroke-width:1.92499995;stroke-miterlimit:4;stroke-dasharray:none" /> </g> </svg>',"guide url"!==GUIDEURL&&""!==GUIDEURL||(GUIDEURL="https://github.com/sugarlabs/turtleblocksjs/tree/master/guide/README.md"),NUMBERBLOCKDEFAULT=100,"turtle"):(LOGOJA1='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="14.227637mm" height="14.552083mm" viewBox="0 0 14.227637 14.552083" version="1.1" id="svg1917"> <defs id="defs1911" /> <metadata id="metadata1914"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <g id="layer1" transform="matrix(0.24123394,0,0,0.24123394,-22.428724,-13.126892)"> <g transform="matrix(0.35277777,0,0,-0.35277777,5.3347636,163.32003)" id="g1838"> <g transform="translate(399.8154,296.855)" id="g22"> <path id="path24" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c -1.236,-9.538 -8.742,-20.454 -20.52,-32.751 0.991,-3.791 2.1,-7.838 3.358,-12.192 1.198,-4.11 2.348,-8.111 3.463,-12.016 2.369,0.184 4.918,0.165 7.649,-0.097 10.995,-1.077 18.478,-8.518 21.847,-18.174 v 59.419 C 15.797,-4.727 9.248,4.822 -0.186,9.196 0.341,6.208 0.4,3.052 0,0" /> </g> <g transform="translate(405.3779,180.7212)" id="g26"> <path id="path28" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c -1.713,-1.584 -3.497,-2.963 -5.33,-4.162 1.183,-14.957 -1.662,-25.43 -7.801,-33.201 -1.713,-2.171 -3.537,-3.994 -5.437,-5.509 h 1.25 c 15.217,0 27.552,12.336 27.552,27.552 V 16.066 C 8.287,10.16 4.924,4.564 0,0" /> </g> <g transform="translate(382.1484,308.4634)" id="g30"> <path id="path32" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 0,0 C -8.555,0.407 -10.788,-9.805 -5.019,-35.432 14.11,-16.584 12.704,-0.609 0,0" /> </g> <g transform="translate(339.479,150.1611)" id="g34"> <path id="path36" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c 0,8.541 6.922,15.464 15.463,15.464 8.543,0 15.465,-6.923 15.465,-15.464 0,-2.427 -0.576,-4.714 -1.572,-6.759 2.039,-2.401 6.344,-3.426 12.302,0.96 5.713,4.215 9.417,14.465 10.009,27.95 -18.905,-6.227 -40.507,2.477 -48.891,12.44 -10.596,12.629 -19.691,49.994 17.168,74.23 3.465,2.281 6.617,4.548 9.463,6.81 -1.48,5.411 -2.819,10.841 -3.905,16.419 -2.211,11.291 -1.32,20.057 1.446,26.386 h -90.446 c -15.217,0 -27.552,-12.336 -27.552,-27.553 V 15.24 c 0,-15.216 12.335,-27.552 27.552,-27.552 H 6.133 C 2.413,-9.488 0,-5.032 0,0" /> </g> <g transform="translate(380.792,227.7183)" id="g38"> <path id="path40" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c -11.295,-6.08 -9.406,-22.011 -3.695,-23.773 6.563,-2.019 4.549,-7.577 -0.506,-7.577 -5.041,0 -14.13,2.025 -16.152,14.643 -1.518,9.483 3.521,22.383 17.019,27.144 -2.009,6.225 -3.992,12.284 -5.842,18.3 -2.576,-2.472 -5.291,-4.997 -8.146,-7.569 -17.368,-15.672 -23.229,-36.353 -10.602,-54.541 9.433,-13.583 25.072,-14.185 37.86,-8.148 -0.549,5.492 -1.533,11.283 -3.027,17.249 C 4.759,-15.656 2.391,-7.639 0,0" /> </g> <g transform="translate(402.3506,194.3457)" id="g42"> <path id="path44" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 0,0 C 12.566,12.577 2.91,36.234 -13.439,35.569 -9.396,20.879 -6.159,7.796 -4.168,-3.619 -2.699,-2.504 -1.296,-1.278 0,0" /> </g> <g transform="translate(388.9111,229.9146)" id="g46"> <path id="path48" style="fill:#64a6f9;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 0,0 C 16.35,0.665 26.006,-22.992 13.439,-35.569 12.144,-36.847 10.74,-38.073 9.271,-39.188 7.28,-27.772 4.043,-14.689 0,0 m -36.043,-35.569 c -12.627,18.188 -6.767,38.868 10.602,54.541 2.855,2.572 5.57,5.097 8.146,7.569 1.85,-6.016 3.833,-12.075 5.842,-18.3 -13.498,-4.762 -18.537,-17.661 -17.019,-27.144 2.022,-12.618 11.111,-14.643 16.152,-14.643 5.055,0 7.069,5.558 0.506,7.577 -5.711,1.762 -7.6,17.693 3.695,23.773 2.39,-7.639 4.759,-15.656 6.909,-24.272 1.494,-5.967 2.478,-11.757 3.026,-17.249 -12.787,-6.037 -28.426,-5.435 -37.859,8.148 M -6.763,78.549 C 5.941,77.94 7.348,61.965 -11.781,43.117 c -5.77,25.627 -3.536,35.839 5.018,35.432 M 3.336,-86.556 c 6.139,7.771 8.983,18.244 7.801,33.201 1.833,1.198 3.617,2.578 5.33,4.162 4.924,4.564 8.287,10.159 10.234,16.066 V -8.29 C 23.332,1.367 15.85,8.807 4.854,9.884 c -2.731,0.262 -5.28,0.282 -7.649,0.097 -1.115,3.905 -2.265,7.907 -3.463,12.016 -1.258,4.355 -2.367,8.401 -3.357,12.192 11.777,12.298 19.283,23.214 20.519,32.751 0.401,3.052 0.341,6.208 -0.185,9.196 -3.317,1.818 -7.103,2.73 -11.571,2.65 h -21.632 c -2.766,-6.329 -3.658,-15.198 -1.446,-26.489 1.086,-5.578 2.425,-11.008 3.905,-16.42 -2.846,-2.262 -5.998,-4.528 -9.463,-6.809 -36.859,-24.236 -27.764,-61.601 -17.168,-74.23 8.384,-9.963 29.986,-18.667 48.891,-12.441 -0.592,-13.484 -4.297,-23.734 -10.009,-27.949 -5.958,-4.386 -10.263,-3.361 -12.302,-0.961 0.996,2.045 1.572,4.332 1.572,6.76 0,8.541 -6.922,15.464 -15.465,15.464 -8.541,0 -15.463,-6.923 -15.463,-15.464 0,-5.032 2.221,-9.627 5.942,-12.452 h 41.195 c 1.9,1.516 3.918,3.477 5.631,5.649" /> </g> <g transform="translate(257.4902,211.418)" id="g50"> <path id="path52" style="fill:#d8e9fd;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 2.389,0.612 c 16.112,4.117 18.275,13.571 17.013,19.984 l 13.727,3.51 21.672,-84.727 -16.712,-4.276 -14.923,58.354 -20.171,-5.16 z" /> </g> <g transform="translate(280.3423,284.8091)" id="g54"> <path id="path56" style="fill:#64a6f9;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c 0,11.978 8.763,13.014 12.028,13.014 7.052,0 12.651,-4.146 12.651,-11.615 0,-6.325 -4.096,-9.537 -7.673,-11.975 -4.875,-3.421 -7.412,-5.078 -8.243,-6.792 h 15.966 v -6.426 H -0.413 c 0.258,4.299 0.57,8.81 8.553,14.615 6.636,4.823 9.28,6.69 9.28,10.839 0,2.435 -1.555,5.236 -5.08,5.236 C 7.259,6.896 7.105,2.697 7.051,0 Z" /> </g> <g transform="translate(321.2446,245.8525)" id="g58"> <path id="path60" style="fill:#f1d01e;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 1.446,-0.413 c 2.765,-0.789 7.907,-1.975 9.634,4.08 0.489,1.71 0.921,6.217 -4.144,7.661 -6.319,1.805 -8.031,-4.184 -8.499,-5.829 l -8.554,2.442 c 2.501,8.751 9.221,13.597 19.75,10.588 6.252,-1.784 13.575,-7.293 10.753,-17.163 -1.353,-4.738 -5.157,-6.854 -8.129,-7.287 l -0.038,-0.132 c 1.513,-0.931 6.215,-4.905 3.941,-12.865 -2.52,-8.825 -10.821,-13.213 -20.229,-10.527 -4.411,1.261 -15.971,5.634 -11.801,20.241 l 9.016,-2.576 -0.082,-0.048 c -0.715,-2.501 -1.672,-8.347 4.514,-10.112 3.683,-1.05 7.62,0.526 9.104,5.726 1.823,6.38 -4.286,8.411 -8.563,9.631 z" /> </g> <g transform="translate(362.2236,150.3657)" id="g62"> <path id="path64" style="fill:#c50018;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c 0,-4.129 -3.348,-7.474 -7.475,-7.474 -4.129,0 -7.476,3.345 -7.476,7.474 0,4.129 3.347,7.478 7.476,7.478 C -3.348,7.478 0,4.129 0,0" /> </g> </g> </g> </svg>',LOGOJA='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.1" id="svg2" xml:space="preserve" width="55" height="55" viewBox="0 0 55 55"><metadata id="metadata8"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs id="defs6"><clipPath clipPathUnits="userSpaceOnUse" id="clipPath18"><path d="M 0,532.918 H 745.508 V 0 H 0 Z" id="path16" /></clipPath></defs><g id="g10" transform="matrix(0.26053262,0,0,-0.26053262,-76.348511,95.783412)"><g id="g1350"><g transform="translate(501.8008,190.7261)" id="g20"><path id="path22" style="fill:#719dd4;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c 0,-18.786 -15.229,-34.016 -34.016,-34.016 h -138.368 c -18.787,0 -34.016,15.23 -34.016,34.016 v 142.769 c 0,18.786 15.229,34.015 34.016,34.015 H -34.016 C -15.229,176.784 0,161.555 0,142.769 Z" /></g><g transform="translate(482.2988,353.0142)" id="g24"><path id="path26" style="fill:#64a6f9;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c -1.527,-11.774 -10.793,-25.251 -25.334,-40.434 1.223,-4.679 2.594,-9.675 4.145,-15.051 1.48,-5.074 2.898,-10.014 4.275,-14.835 2.926,0.227 6.072,0.204 9.445,-0.119 13.574,-1.331 22.811,-10.516 26.971,-22.438 V -19.52 C 19.502,-5.836 11.418,5.953 -0.23,11.353 0.42,7.664 0.494,3.768 0,0" /></g><g transform="translate(489.166,209.6392)" id="g28"><path id="path30" style="fill:#64a6f9;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c -2.115,-1.955 -4.318,-3.658 -6.58,-5.138 1.459,-18.466 -2.053,-31.395 -9.631,-40.989 -2.115,-2.681 -4.367,-4.932 -6.713,-6.802 h 1.543 c 18.787,0 34.016,15.23 34.016,34.016 V 19.835 C 10.23,12.543 6.078,5.635 0,0" /></g><g transform="translate(460.4863,367.3462)" id="g32"><path id="path34" style="fill:#64a6f9;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 0,0 C -10.561,0.502 -13.318,-12.105 -6.195,-43.743 17.42,-20.475 15.686,-0.752 0,0" /></g><g transform="translate(407.8086,171.9106)" id="g36"><path id="path38" style="fill:#64a6f9;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c 0,10.545 8.547,19.092 19.092,19.092 10.545,0 19.092,-8.547 19.092,-19.092 0,-2.996 -0.711,-5.82 -1.942,-8.345 2.518,-2.963 7.832,-4.229 15.188,1.186 7.052,5.204 11.625,17.858 12.357,34.506 -23.34,-7.687 -50.01,3.058 -60.359,15.358 -13.082,15.592 -24.311,61.722 21.195,91.643 4.277,2.815 8.168,5.614 11.682,8.406 -1.826,6.682 -3.479,13.385 -4.821,20.271 -2.73,13.94 -1.629,24.762 1.786,32.575 H -78.392 c -18.787,0 -34.016,-15.23 -34.016,-34.016 V 18.815 c 0,-18.786 15.229,-34.015 34.016,-34.015 H 7.572 C 2.979,-11.714 0,-6.212 0,0" /></g><g transform="translate(458.8125,267.6606)" id="g40"><path id="path42" style="fill:#64a6f9;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c -13.943,-7.506 -11.613,-27.174 -4.563,-29.35 8.104,-2.492 5.618,-9.353 -0.625,-9.353 -6.222,0 -17.443,2.5 -19.939,18.077 -1.875,11.707 4.348,27.633 21.012,33.511 -2.481,7.685 -4.93,15.166 -7.213,22.593 -3.18,-3.052 -6.533,-6.169 -10.057,-9.345 -21.443,-19.349 -28.678,-44.88 -13.09,-67.334 11.647,-16.77 30.955,-17.513 46.741,-10.06 -0.678,6.781 -1.891,13.93 -3.737,21.295 C 5.875,-19.328 2.951,-9.431 0,0" /></g><g transform="translate(485.4277,226.4595)" id="g44"><path id="path46" style="fill:#64a6f9;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 0,0 C 15.516,15.527 3.592,44.733 -16.592,43.912 -11.6,25.777 -7.604,9.625 -5.145,-4.468 -3.332,-3.091 -1.6,-1.578 0,0" /></g><g transform="translate(468.8359,270.3716)" id="g48"><path id="path50" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 0,0 C 20.184,0.821 32.107,-28.385 16.592,-43.912 14.992,-45.49 13.26,-47.003 11.447,-48.38 8.988,-34.287 4.992,-18.135 0,0 m -44.498,-43.912 c -15.588,22.454 -8.354,47.985 13.09,67.334 3.523,3.176 6.877,6.293 10.056,9.345 2.284,-7.427 4.733,-14.908 7.213,-22.593 -16.664,-5.878 -22.886,-21.804 -21.011,-33.511 2.496,-15.577 13.716,-18.077 19.939,-18.077 6.242,0 8.729,6.861 0.625,9.353 -7.051,2.176 -9.381,21.844 4.563,29.35 2.951,-9.431 5.875,-19.328 8.529,-29.966 1.846,-7.365 3.058,-14.514 3.736,-21.295 -15.785,-7.453 -35.094,-6.71 -46.74,10.06 M -8.35,96.975 C 7.336,96.223 9.07,76.5 -14.545,53.231 -21.668,84.869 -18.91,97.477 -8.35,96.975 M 4.119,-106.859 c 7.578,9.593 11.09,22.523 9.631,40.989 2.262,1.479 4.465,3.182 6.58,5.138 6.078,5.634 10.231,12.543 12.635,19.835 v 30.663 C 28.805,1.688 19.568,10.873 5.994,12.203 c -3.373,0.323 -6.519,0.347 -9.445,0.119 -1.377,4.822 -2.795,9.762 -4.276,14.835 -1.55,5.376 -2.921,10.372 -4.144,15.052 14.541,15.183 23.807,28.659 25.334,40.434 0.494,3.767 0.42,7.664 -0.231,11.352 -4.093,2.244 -8.767,3.371 -14.283,3.272 h -26.707 c -3.414,-7.814 -4.515,-18.763 -1.785,-32.703 1.342,-6.886 2.994,-13.589 4.82,-20.271 -3.513,-2.792 -7.404,-5.591 -11.681,-8.406 C -81.91,5.966 -70.682,-40.164 -57.6,-55.756 c 10.35,-12.3 37.02,-23.045 60.36,-15.358 -0.733,-16.648 -5.305,-29.302 -12.358,-34.506 -7.355,-5.415 -12.67,-4.149 -15.187,-1.186 1.23,2.525 1.941,5.349 1.941,8.345 0,10.545 -8.547,19.092 -19.092,19.092 -10.544,0 -19.091,-8.547 -19.091,-19.092 0,-6.212 2.742,-11.885 7.336,-15.372 h 50.859 c 2.346,1.871 4.836,4.293 6.951,6.974" /></g><g transform="translate(306.5874,247.5366)" id="g52"><path id="path54" style="fill:#d8e9fd;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 0,0 2.95,0.756 C 22.843,5.839 25.512,17.51 23.953,25.427 L 40.9,29.761 67.657,-74.841 47.023,-80.12 28.601,-8.078 3.698,-14.448 Z" /></g><g transform="translate(334.8003,338.1431)" id="g56"><path id="path58" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c 0,14.787 10.818,16.066 14.851,16.066 8.705,0 15.617,-5.118 15.617,-14.338 0,-7.81 -5.057,-11.775 -9.473,-14.785 -6.017,-4.223 -9.151,-6.269 -10.177,-8.385 h 19.711 v -7.934 H -0.51 c 0.32,5.309 0.703,10.877 10.559,18.044 8.193,5.953 11.457,8.26 11.457,13.382 0,3.006 -1.92,6.463 -6.272,6.463 C 8.962,8.513 8.771,3.33 8.706,0 Z" /></g><g transform="translate(385.2969,290.0483)" id="g60"><path id="path62" style="fill:#f1d01e;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 1.785,-0.51 c 3.414,-0.973 9.762,-2.438 11.895,5.036 0.603,2.113 1.136,7.676 -5.117,9.459 C 0.762,16.214 -1.352,8.819 -1.93,6.788 L -12.49,9.804 C -9.402,20.608 -1.105,26.59 11.893,22.876 19.611,20.673 28.652,13.872 25.168,1.687 23.498,-4.163 18.801,-6.775 15.133,-7.31 l -0.047,-0.163 c 1.867,-1.149 7.672,-6.055 4.865,-15.882 C 16.84,-34.25 6.592,-39.668 -5.023,-36.352 c -5.446,1.557 -19.717,6.956 -14.568,24.99 l 11.13,-3.182 -0.102,-0.058 c -0.882,-3.088 -2.064,-10.305 5.573,-12.485 4.547,-1.296 9.408,0.65 11.24,7.07 2.25,7.875 -5.291,10.384 -10.572,11.889 z" /></g><g transform="translate(435.8887,172.1636)" id="g64"><path id="path66" style="fill:#c50018;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 0,0 c 0,-5.098 -4.133,-9.228 -9.229,-9.228 -5.097,0 -9.23,4.13 -9.23,9.228 0,5.098 4.133,9.231 9.23,9.231 C -4.133,9.231 0,5.098 0,0" /></g></g></g></svg>',LOGODEFAULT='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg1121" version="1.1" viewBox="0 0 34.131249 14.552089" height="55.000019" width="129"> <defs id="defs1115"> <clipPath id="clipPath4337" clipPathUnits="userSpaceOnUse"> <rect y="552" x="588" height="1436" width="1900" id="rect4339" style="fill:#a3b5c4;fill-opacity:1;stroke:none;stroke-width:15;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> </clipPath> </defs> <metadata id="metadata1118"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <g transform="matrix(1.086782,0,0,1.086782,-1.5473245,-1.305799)" id="g1812"> <ellipse transform="matrix(0.01046099,0,0,0.01046099,1.0167389,-6.2048529)" clip-path="url(#clipPath4337)" ry="768" rx="748" cy="1476" cx="1540" id="path4333" style="display:inline;fill:#a3b5c4;fill-opacity:1;stroke:none;stroke-width:15;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <ellipse ry="1.7826859" rx="1.6939216" cy="8.8343534" cx="16.446739" id="path4256" style="display:inline;fill:#c9dad8;fill-opacity:1;stroke:#c9dad8;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4328" d="m 17.630266,13.48709 0.32547,0.392044 0.34766,0.27369 0.310676,0.110955 0.236705,-0.05178 0.140544,-0.184926 0.19972,0.08137 0.155338,0.04438 0.613954,-0.421632 0.421631,-0.251499 c 0,0 0.887645,-0.0074 1.605157,-0.554777 0.717513,-0.547381 0.495602,-0.650939 0.495602,-0.650939 l -0.03699,-0.429029 -0.539984,-0.717513 -0.554777,-0.569571 -0.229309,-0.147941 c 0,0 -0.02219,-0.04438 -0.07397,-0.04438 -0.05178,0 -0.244103,-0.07397 -0.517793,0.04438 -0.273691,0.118353 -0.466014,0.170132 -0.843263,0.384646 -0.377248,0.214514 -0.710115,0.421631 -0.835865,0.495602 -0.12575,0.07397 -0.7471,0.429028 -0.7471,0.429028 l -0.09616,0.658336 z" style="display:inline;fill:#f8f8f8;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.01046099px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path4330" d="m 18.081485,13.117239 c 0,0 1.017202,0.219808 1.490613,-0.13525 0.68255,-0.674097 1.655893,-1.154731 1.870355,-1.745308 0.108257,-0.298116 0.09265,-0.372377 -0.08018,-0.637191 -0.784085,-1.1169523 -2.186023,0.483563 -2.186023,0.483563 l -1.220511,1.042983 z" style="display:inline;fill:#c9dad8;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.01046099px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path4281" d="m 18.923638,11.911166 c 0,0 -2.262073,0.360073 -1.245807,1.631426 1.016268,1.271354 1.33159,0.468415 1.33159,0.468415 0,0 0.237364,0.284021 0.550221,-0.01289 0.312857,-0.29691 0.801657,-0.486563 0.801657,-0.486563 0,0 0.833419,-0.08158 1.728851,-0.640345 0.895432,-0.558769 0.02545,-1.494644 0.02545,-1.494644 0,0 -0.704002,-0.914305 -1.191158,-1.062004 -0.487155,-0.147699 -1.260206,-0.205963 -1.260206,-0.205963 z" style="display:inline;fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path5926" d="m 16.889165,3.9907067 c -0.205925,0.00902 -0.490584,0.016452 -0.682434,0.094306 -0.36351,0.1131625 -0.784019,0.3065916 -1.102039,0.4145197 C 14.805707,4.6009993 14.528383,4.8675841 14.442515,4.7707676 14.31485,4.6268244 14.224353,4.595363 14.045689,4.497559 13.801781,4.399505 13.873773,4.4448272 13.660866,4.3863283 13.513681,4.3458871 13.44829,4.2882958 13.047954,4.3023567 c -0.216087,0.00759 -0.47351,0.00804 -0.660081,0.089725 -0.374615,0.1640178 -0.299,0.2484757 -0.538572,0.4900252 -0.165108,0.1664709 -0.223029,0.5749831 -0.282041,0.818858 -0.06939,0.2867776 -0.0547,0.6010393 -0.02031,0.9674031 0.02761,0.2941965 0.09173,0.4973939 0.249388,0.759063 0.135084,0.2241989 0.324561,0.2835828 0.54659,0.4972893 0.07774,0.07483 0.368398,-0.038965 0.48488,-0.015104 0.108709,0.02227 -0.04817,0.2167088 -0.0532,0.2453834 -0.0538,0.2395169 -0.110503,0.087771 -0.0806,0.6274261 0.348123,2.0266892 1.005089,-1.0672647 0.326649,0.6686194 -0.05298,0.135564 -0.437594,0.3888068 -0.503368,0.5868538 -0.01267,0.165109 0.197835,0.19408 0.318997,0.178049 0.06266,0.480395 0.124982,1.042048 0.522242,1.372439 0.120177,0.106402 0.286652,0.09447 0.429317,0.126443 0.221641,0.268128 0.448668,0.557066 0.784087,0.689774 0.283845,0.148435 0.624913,0.051 0.896138,0.233065 0.712925,0.360901 1.59437,0.227424 2.240307,-0.214367 0.239736,-0.02584 0.501243,0.05119 0.751391,0.02222 0.575898,-0.02006 1.167207,-0.240005 1.523962,-0.711502 0.0729,-0.066 0.102081,-0.17814 0.168803,-0.240635 0.06616,0.0833 0.201079,0.165289 0.285653,0.05502 0.193072,-0.253436 0.223413,-0.595104 0.327145,-0.882559 0.08658,0.03641 0.0842,0.265734 0.19082,0.175968 0.08858,-0.27751 0.231055,-0.589554 0.157487,-0.875103 C 21.094968,9.8641514 20.994799,9.7109879 20.959751,9.6709914 21.06973,9.6649214 21.392146,9.6074124 21.364226,9.434279 21.284902,9.2640651 20.930324,9.0580893 20.78147,8.9636893 20.627489,7.0823629 20.831941,7.9730043 20.374475,6.5721668 20.286693,6.296366 20.179582,6.0253908 20.039149,5.7673778 19.814155,5.3540076 19.50363,4.9739075 19.050031,4.6605328 18.694157,4.4866157 18.779167,4.4124578 18.416319,4.2842118 18.040916,4.114893 17.923126,4.1144294 17.706217,4.0495514 17.421993,4.0042382 17.176226,3.9934611 16.889165,3.9907067 Z m -0.416777,3.7702345 c 0.258005,0.00976 0.429259,0.254814 0.527501,0.468441 -0.04651,0.1209123 -0.217613,0.1803318 -0.314316,0.2708005 -0.05227,0.030898 -0.195057,0.1419829 -0.07397,0.1762583 0.167574,-0.00801 0.341125,-0.101776 0.502363,-0.081253 0.0388,0.3136927 0.01038,0.7255031 -0.295939,0.9021495 -0.316884,0.082827 -0.562053,-0.2121416 -0.676829,-0.471618 -0.147096,-0.3666902 -0.185934,-0.8428431 0.07651,-1.1669988 0.06531,-0.068268 0.160011,-0.1063475 0.254678,-0.09778 z m 2.859244,2.5757878 c -0.07673,0.184758 -0.230659,0.330156 -0.407011,0.413252 -0.05539,0.150705 0.04004,0.35438 0.0297,0.483234 -0.04907,-0.160357 -0.0016,-0.361426 -0.108875,-0.496757 -0.07018,-0.02271 -0.147747,-0.0281 -0.211741,-0.07206 0.212794,0.117717 0.49561,0.03924 0.604766,-0.182094 0.02934,-0.03762 0.08159,-0.145575 0.09316,-0.145571 z m -0.965372,0.141988 c 0.04566,0.03409 0.204897,0.162857 0.07744,0.06785 -0.01641,-0.01138 -0.09019,-0.07086 -0.07744,-0.06785 z" style="display:inline;fill:#c9dad8;fill-opacity:1;stroke:none;stroke-width:0.05230495;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4257" d="m 18.562292,4.3406543 c 0,0 -0.01823,-0.1260925 0.05503,-0.2630911 0.107065,-0.2002118 0.364043,-0.4099485 0.661951,-0.5965291 0.390579,-0.2446202 0.878105,-0.4015772 1.457653,0.035985 0.150331,0.1135008 0.27512,0.3561849 0.43652,0.5462458 0,0 0.443822,0.5325871 0.05918,1.7900829 C 20.847978,7.110845 20.24142,6.5338754 20.24142,6.5338754 Z" style="display:inline;fill:#c9dad8;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.01046099px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path4259" d="m 15.544962,4.3156298 c 0.674016,0.862017 2.224945,3.3646467 2.552481,2.1357471 0.20922,-0.9101061 0.01532,-2.3025973 0.01532,-2.3025973 0,0 -1.252038,-0.4658857 -2.567802,0.1668502 z" style="display:inline;fill:#899bb0;fill-opacity:1;fill-rule:evenodd;stroke:#899bb0;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4276" d="m 14.55326,9.3192563 c 0,0 -0.167376,0.052305 1.098404,0.3347517 1.26578,0.2824467 1.621453,-0.6695034 1.621453,-0.6695034 0,0 1.035638,-1.5168436 2.144503,-0.3033687 0,0 0.282447,0.3033687 0.784575,0.2929077 0,0 0.313829,-0.1778368 0.575354,-0.010461 0.261525,0.1673759 0.491667,0.3242907 0.491667,0.3242907 0,0 0.387056,0.3661347 -0.292908,0.3556737 0,0 0.4289,0.1046099 -0.08369,1.339007 l -0.146454,-0.334752 c 0,0 -0.20922,1.401773 -0.575354,0.868262 0,0 -0.168567,0.284042 -0.549335,0.538111 -0.461704,0.308073 -1.20062,0.579034 -1.882846,0.335382 0,0 -0.929436,1.023563 -2.512402,0.121125 0,0 -0.871728,0.166552 -1.457543,-0.816781 0,0 -0.805496,0.198759 -0.95195,-1.495922 0,0 -0.679965,0.04184 -0.04184,-0.543971 0.63812,-0.5858155 1.203014,-0.4602836 1.203014,-0.4602836 z" style="display:inline;fill:#f8f8f8;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.01046099px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path4365" d="m 13.538544,5.3179276 c -0.01698,0.00333 -0.295429,0.00411 -0.542614,-0.1287894 -0.126298,-0.067906 -0.247026,-0.1270069 -0.29127,-0.1859807 -0.03564,-0.047508 0.0041,-0.1114587 -0.06685,-0.053022 -0.949852,0.7828116 -0.485867,2.0489157 0.391518,2.3817499 0,0 0.16803,-0.930502 1.084571,-1.9878057" style="display:inline;fill:#f8f8f8;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.01046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4367" d="m 18.969129,4.5514697 c 0,0 0.961615,0.6805271 1.19832,1.6125543 0,0 1.153939,-1.7309068 -0.07397,-2.4262282 0,0 -0.207118,0.79888 -1.124351,0.8136739 z" style="display:inline;fill:#f8f8f8;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.01046099px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path4215" d="m 12.838685,10.209018 c 0.144399,1.761682 0.938601,1.472882 0.938601,1.472882 0.63536,1.0108 1.429561,0.82308 1.429561,0.82308 1.371802,0.837522 2.527003,-0.101079 2.527003,-0.101079 1.934963,0.31768 2.411483,-0.924162 2.411483,-0.924162 0.375441,0.577601 0.606481,-0.808641 0.606481,-0.808641 0.05776,-0.11552 0.144401,0.34656 0.144401,0.34656 0.462079,-1.2129605 0.08324,-1.377833 0.08324,-1.377833 1.010801,0.02888 -0.203626,-0.702874 -0.203626,-0.702874 -0.02553,-1.0590654 -0.02508,-1.3292131 -0.390054,-2.3334378 0.809797,0.2163877 0.811057,-0.9606589 0.94917,-1.2297877 0.199919,-0.5390245 -0.0356,-1.5044904 -0.679641,-1.9195323 -0.265411,-0.1710387 -0.6002,-0.2486009 -1.002486,-0.1643198 -0.302755,0.1390128 -0.69254,0.3949895 -0.907628,0.6086619 -0.193613,0.1923395 -0.219649,0.3032114 -0.195442,0.415557" style="fill:none;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4227" d="m 12.838685,10.211495 c 0,0 -0.909721,0.0986 0.25992,-0.8111179 0,0 0.49096,-0.4187608 1.472881,-0.05776" style="fill:none;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4229" d="M 12.904904,9.565553 C 12.505653,8.7738548 12.670797,8.1656037 12.850244,7.958294" style="fill:none;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4201" d="m 14.581303,4.8227692 c 0,0 1.795749,-1.4517066 3.967207,-0.5150309" style="display:inline;fill:none;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path style="display:inline;fill:none;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 12.913527,7.8996581 C 10.894356,8.3520143 11.168402,4.2545247 12.764952,4.3025073 13.383569,4.2857373 14.097424,4.267855 14.65681,5.001513" id="path4207" /> <path id="path4233" d="m 18.340331,10.454499 c 0,0 0.66424,0.722 1.010801,-0.17328" style="display:inline;fill:none;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4235" d="m 18.889052,10.728859 0.0722,0.56316" style="display:inline;fill:none;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4251" d="m 14.13482,5.3440801 c -0.178391,0 -0.632946,0.00698 -0.994192,-0.086816 C 12.90873,5.1970519 12.715284,5.0953125 12.658026,4.9235378" style="display:inline;fill:none;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4301" d="m 12.672906,11.249959 c 0,0 -1.213113,0.880247 -0.724909,1.545981 l 0.59916,0.532586 0.821072,0.443823 1.227907,0.06657 0.806277,-0.147941 0.414234,-0.184926 0.443822,0.37725 0.399441,0.01479 0.229308,-0.110956 0.687924,-0.273691 0.362456,-0.284786 0.207117,-0.314373 -0.02959,-0.340264 c 0,0 -0.384646,-1.161335 -0.79888,-1.346261 0,0 -0.532587,-0.576969 -1.272291,-0.08137 0,0 -1.116952,0.369852 -2.085964,0.04438 -0.969012,-0.32547 -1.287085,0.05918 -1.287085,0.05918 z" style="display:inline;fill:#f8f8f8;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.01046099px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path4325" d="m 11.85318,12.481094 c 0,0 1.220511,-0.702719 3.06977,-0.184927 0,0 0.917234,0.162736 1.508996,-0.06657 0.591764,-0.229309 0.791483,0.27369 0.791483,0.27369 0,0 0.466014,0.843262 0.39944,0.902438 l 0.177529,-0.05178 0.266293,-0.340264 0.07397,-0.258897 -0.140543,-0.429028 -0.273691,-0.576968 -0.310676,-0.443822 -0.251499,-0.184927 -0.421631,-0.184925 -0.406838,0.02959 -0.606556,0.251499 c 0,0 -1.028189,0.288485 -2.2487,-0.184925 0,0 -0.902438,-0.162736 -1.516392,0.983806 l -0.118353,0.399439 z" style="display:inline;fill:#c9dad8;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.01046099px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /> <path id="path4279" d="m 16.833672,13.785217 c 0.153423,-0.102967 1.454122,-0.405144 1.27153,-1.107052 -0.18259,-0.701906 -0.810488,-2.18308 -1.962749,-1.621151 -1.152264,0.561932 -2.428271,0.04422 -2.428271,0.04422 0,0 -0.502575,-0.191198 -0.917137,0.04475 -0.414562,0.235951 -0.835691,0.624285 -0.96967,1.263836 -0.133982,0.639557 1.559745,1.341991 1.559745,1.341991 0,0 1.628567,0.238813 2.395693,-0.276035 0,0 0.629729,0.697771 1.050859,0.309437 z" style="display:inline;fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path d="m 17.114016,8.5098241 a 0.94989708,0.58640587 78.078062 0 1 -0.340613,1.0406955 0.94989708,0.58640587 78.078062 0 1 -0.776562,-0.678756 0.94989708,0.58640587 78.078062 0 1 0.23956,-1.1290216 0.94989708,0.58640587 78.078062 0 1 0.807736,0.5318372 l -0.503878,0.3563839 z" id="path4265" style="display:inline;fill:#505050;fill-opacity:1;stroke-width:0.10460994;stroke-miterlimit:4;stroke-dasharray:none" /> <path d="M 20.413977,8.0315906 A 0.85676325,0.52891095 78.078062 0 1 20.10676,8.9702498 0.85676325,0.52891095 78.078062 0 1 19.406336,8.3580431 0.85676325,0.52891095 78.078062 0 1 19.622407,7.3397176 0.85676325,0.52891095 78.078062 0 1 20.350948,7.8194108 l -0.454474,0.3214416 z" id="path4265-2" style="display:inline;fill:#505050;fill-opacity:1;stroke-width:0.10460994;stroke-miterlimit:4;stroke-dasharray:none" /> <path id="path5720" d="m 21.134832,7.6963634 c -0.112318,-0.027757 -0.262497,-0.081054 -0.333731,-0.1184383 -0.144005,-0.075573 -0.299329,-0.2698653 -0.299329,-0.374426 0,-0.096607 -0.193298,-0.846814 -0.294133,-1.1415597 C 19.91785,5.2148827 19.426736,4.6758205 18.806808,4.5243423 18.574543,4.4675893 18.37796,4.3777172 18.37796,4.3282851 c 0,-0.1165874 0.518787,-0.372059 0.755587,-0.3720818 0.225129,-2.09e-5 0.551773,0.1955105 0.754007,0.4513556 0.08958,0.113326 0.336843,0.5587874 0.549476,0.9899141 0.630891,1.2791719 1.127464,1.9684738 1.567563,2.1759633 0.217308,0.1024518 0.226116,0.111942 0.130881,0.1410215 -0.159835,0.048804 -0.77495,0.037681 -1.000642,-0.018094 z" style="fill:#000000;fill-opacity:0;stroke-width:0.05230495;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none" /> <path id="path4245" d="m 15.544387,4.3143709 c 0,0 1.555226,2.1088053 2.078276,2.2761811 0.523049,0.1673759 0.550099,-1.2673939 0.550099,-1.2673939 0,0 0.01046,-0.8054962 -0.03138,-1.16117" style="fill:none;fill-rule:evenodd;stroke:none;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <path id="path4249" d="m 18.944377,4.5456262 c 0.250182,0.02965 0.853235,-0.055903 1.134665,-0.7723694" style="fill:none;fill-rule:evenodd;stroke:#505050;stroke-width:0.1046099;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /> <text id="text4245" y="2.0512714" x="11.557299" style="font-style:normal;font-weight:normal;font-size:0.12553188px;line-height:0%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.01046099px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" xml:space="preserve"><tspan style="font-size:0.4184396px;line-height:1.25;stroke-width:0.01046099px" y="2.0512714" x="11.557299" id="tspan4247"> </tspan></text> </g> </svg>',"guide url"!==GUIDEURL&&""!==GUIDEURL||(GUIDEURL="127.0.0.1"===window.location.hostname||"localhost"===window.location.hostname?"Docs/guide/index.html":"https://musicblocks.sugarlabs.org/Docs/guide/index.html"),NUMBERBLOCKDEFAULT=4,"rhythm"),MULTIPALETTENAMES=_THIS_IS_TURTLE_BLOCKS_?(TITLESTRING=_("Turtle Blocks"),BUILTINPALETTES=["search","rhythm","meter","pitch","intervals","tone","ornament","volume","drum","flow","action","boxes","widgets","graphics","pen","number","boolean","media","sensors","heap","dictionary","ensemble","extras","program","myblocks"],BUILTINPALETTESFORL23N=[_("search"),_("rhythm"),_("meter"),_("pitch"),_("intervals"),_("tone"),_("ornament"),_("volume"),_("drum"),_("flow"),_("action"),_("boxes"),_("widgets"),_("graphics"),_("pen"),_("number"),_("boolean"),_("media"),_("sensors"),_("heap"),_("dictionary"),_("ensemble"),_("extras"),_("program"),_("my blocks")],MULTIPALETTES=[["graphics","pen","media","sensors","ensemble"],["flow","action","boxes","number","boolean","heap","dictionary","extras","program","myblocks"],["rhythm","meter","pitch","intervals","tone","ornament","volume","drum","widgets"]],SKIPPALETTES=["heap","dictionary","extras","program","meter","pitch","intervals","tone","ornament","volume","drum","widgets"],MULTIPALETTEICONS=["artwork","logic","music"],[_("artwork"),_("logic"),_("Music").toLowerCase()]):(TITLESTRING=_("Music Blocks"),BUILTINPALETTES=["search","rhythm","meter","pitch","intervals","tone","ornament","volume","drum","flow","action","boxes","widgets","graphics","pen","number","boolean","media","sensors","heap","dictionary","ensemble","extras","program","myblocks"],BUILTINPALETTESFORL23N=[_("search"),_("rhythm"),_("meter"),_("pitch"),_("intervals"),_("tone"),_("ornament"),_("volume"),_("drum"),_("flow"),_("action"),_("boxes"),_("widgets"),_("graphics"),_("pen"),_("number"),_("boolean"),_("media"),_("sensors"),_("heap"),_("dictionary"),_("ensemble"),_("extras"),_("program"),_("my blocks")],MULTIPALETTES=[["rhythm","meter","pitch","intervals","tone","ornament","volume","drum","widgets"],["flow","action","boxes","number","boolean","heap","dictionary","extras","program","myblocks"],["graphics","pen","media","sensors","ensemble"]],SKIPPALETTES=["heap","dictionary","extras","program"],MULTIPALETTEICONS=["music","logic","artwork"],[_("Music").toLowerCase(),_("logic"),_("artwork")]),getMainToolbarButtonNames=function(e){return-1<["popdown-palette","run","step","step-music","stop-turtle","hard-stop-turtle","palette","help","sugarizer-stop","beginner","advanced","planet","planet-disabled","open","save","new"].indexOf(e)},getAuxToolbarButtonNames=function(e){return-1<["paste-disabled","Cartesian","compile","utility","restore-trash","hide-blocks","collapse-blocks","go-home"].indexOf(e)},createDefaultStack=function(){var e;DATAOBJS=_THIS_IS_TURTLE_BLOCKS_?[[0,"start",screen.width/3,100,[null,1,null]],[1,"repeat",0,0,[0,2,4,3]],[2,["number",{value:4}],0,0,[1]],[3,"hidden",0,0,[1,null]],[4,"forward",0,0,[1,5,6]],[5,["number",{value:100}],0,0,[4]],[6,"right",0,0,[4,7,null]],[7,["number",{value:90}],0,0,[6]]]:"ja"===(e=void 0===(e=localStorage.languagePreference)?navigator.language:e)?[[0,"start",screen.width/2+28,100,[null,1,null]],[1,"settimbre",0,0,[0,2,4,3]],[2,["voicename",{value:"guitar"}],0,0,[1]],[3,"hidden",0,0,[1,null]],[4,"newnote",0,0,[1,5,8,12]],[5,"divide",0,0,[4,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:2}],0,0,[5]],[8,"vspace",0,0,[4,9]],[9,"pitch",0,0,[8,10,11,null]],[10,["solfege",{value:"do"}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"hidden",0,0,[4,13]],[13,"newnote",0,0,[12,14,17,21]],[14,"divide",0,0,[13,15,16]],[15,["number",{value:1}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"vspace",0,0,[13,18]],[18,"pitch",0,0,[17,19,20,null]],[19,["solfege",{value:"mi"}],0,0,[18]],[20,["number",{value:4}],0,0,[18]],[21,"hidden",0,0,[13,22]],[22,"newnote",0,0,[21,23,26,30]],[23,"divide",0,0,[22,24,25]],[24,["number",{value:1}],0,0,[23]],[25,["number",{value:4}],0,0,[23]],[26,"vspace",0,0,[22,27]],[27,"pitch",0,0,[26,28,29,null]],[28,["solfege",{value:"sol"}],0,0,[27]],[29,["number",{value:4}],0,0,[27]],[30,"hidden",0,0,[22,31]],[31,"newnote",0,0,[30,32,35,39]],[32,"divide",0,0,[31,33,34]],[33,["number",{value:1}],0,0,[32]],[34,["number",{value:1}],0,0,[32]],[35,"vspace",0,0,[31,36]],[36,"pitch",0,0,[35,37,38,null]],[37,["solfege",{value:"do"}],0,0,[36]],[38,["number",{value:5}],0,0,[36]],[39,"hidden",0,0,[31,null]]]:[[0,"start",screen.width/2+28,100,[null,1,null]],[1,"settimbre",0,0,[0,2,4,3]],[2,["voicename",{value:"guitar"}],0,0,[1]],[3,"hidden",0,0,[1,null]],[4,"newnote",0,0,[1,5,8,12]],[5,"divide",0,0,[4,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"vspace",0,0,[4,9]],[9,"pitch",0,0,[8,10,11,null]],[10,["solfege",{value:"sol"}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"hidden",0,0,[4,13]],[13,"newnote",0,0,[12,14,17,21]],[14,"divide",0,0,[13,15,16]],[15,["number",{value:1}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"vspace",0,0,[13,18]],[18,"pitch",0,0,[17,19,20,null]],[19,["solfege",{value:"mi"}],0,0,[18]],[20,["number",{value:4}],0,0,[18]],[21,"hidden",0,0,[13,22]],[22,"newnote",0,0,[21,23,26,30]],[23,"divide",0,0,[22,24,25]],[24,["number",{value:1}],0,0,[23]],[25,["number",{value:2}],0,0,[23]],[26,"vspace",0,0,[22,27]],[27,"pitch",0,0,[26,28,29,null]],[28,["solfege",{value:"sol"}],0,0,[27]],[29,["number",{value:4}],0,0,[27]],[30,"hidden",0,0,[22,null]]]},createHelpContent=function(e){var t=localStorage.languagePreference,o=(void 0===t&&(t=navigator.language),LOGODEFAULT);"ja"===t&&(o=LOGOJA),HELPCONTENT=_THIS_IS_TURTLE_BLOCKS_?[[_("Welcome to Turtle Blocks"),_("Turtle Blocks is a Logo-inspired turtle that draws colorful pictures with snap-together visual-programming blocks.")+_("The current version is")+" "+VERSION,"data:image/svg+xml;base64,"+window.btoa(base64Encode(o))],[_("Play"),_("Click the run button to run the project in fast mode."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(RUNBUTTON))],[_("Stop"),_("Stop the turtle.")+" "+_("You can also type Alt-S to stop."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(STOPTURTLEBUTTON))]]:[[_("Welcome to Music Blocks"),_("Music Blocks is a collection of tools for exploring fundamental musical concepts in a fun way.")+" "+_("The current version is")+" "+VERSION,"data:image/svg+xml;base64,"+window.btoa(base64Encode(o))],[_("Meet Mr. Mouse!"),_("Mr Mouse is our Music Blocks conductor.")+" "+_("Mr Mouse encourages you to explore Music Blocks.")+" "+_("Let us start our tour!"),"data:image/svg+xml;base64,"+window.btoa(base64Encode(MOUSEPALETTEICON))],[_("Guide"),_("A detailed guide to Music Blocks is available."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(o)),GUIDEURL,_("Music Blocks Guide")],[_("Play"),_("Click the run button to run the project in fast mode."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(RUNBUTTON))],[_("Stop"),_("Stop the music (and the mice).")+" "+_("You can also type Alt-S to stop."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(STOPTURTLEBUTTON))]],e.beginnerMode||HELPCONTENT.push([_("Record"),_("Record your project as video."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(RECORDHELPBUTTON))]),HELPCONTENT.push([_("Toggle Fullscreen"),_("Toggle Fullscreen mode."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(FULLSCREENBUTTON))]),HELPCONTENT.push([_("New project"),_("Initialize a new project."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(NEWBUTTON))]),HELPCONTENT.push([_("Load project from file"),_("You can also load projects from the file system."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(LOADBUTTON))]),e.beginnerMode?HELPCONTENT.push([_("Save project"),_("Save project as HTML")+"<br/>"+_("Save mouse artwork as PNG"),"data:image/svg+xml;base64,"+window.btoa(base64Encode(SAVEBUTTON))]):_THIS_IS_TURTLE_BLOCKS_?HELPCONTENT.push([_("Save"),_("Save project")+": "+_("Save your project to a file.")+"<br/><br/>"+_("Save turtle artwork as SVG")+": "+_("Save graphics from your project to as SVG.")+"<br/><br/>"+_("Save turtle artwork as PNG")+": "+_("Save graphics from your project as PNG.")+"<br/><br/>"+_("Save block artwork as SVG")+": "+_("Save block artwork as an SVG file."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(SAVEBUTTON))]):HELPCONTENT.push([_("Save project"),_("Save project as HTML")+"<br/>"+_("Save project as MIDI")+"<br/>"+_("Save music as WAV")+"<br/>"+_("Save sheet music as ABC, Lilypond or MusicXML")+"<br/>"+_("Save block artwork as SVG or PNG"),"data:image/svg+xml;base64,"+window.btoa(base64Encode(SAVEBUTTON))]),HELPCONTENT.push([_("Load samples from server"),_("This button opens a viewer for loading example projects."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(PLANETBUTTON))]),HELPCONTENT.push([_("Expand/collapse option toolbar"),_("Click this button to expand or collapse the auxiliary toolbar."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(MENUBUTTON))]),HELPCONTENT.push([_("Help"),_("Displays help messages for the main and auxiliary toolbar, right-click contextual menu for blocks and canvas, and palettes."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(HELPBUTTON))]),HELPCONTENT.push([_("Run slowly"),_("Click to run the project in slow mode."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(SLOWBUTTON))]),HELPCONTENT.push([_("Run step by step"),_("Click to run the project step by step."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(STEPBUTTON))]),e.beginnerMode||(HELPCONTENT.push([_("Display statistics"),_("Display statistics about your Music project."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(STATSBUTTON))]),HELPCONTENT.push([_("Load plugin"),_("Load a selected plugin."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(PLUGINSBUTTON))]),HELPCONTENT.push([_("Delete plugin"),_("Delete a selected plugin."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(PLUGINSDELETEBUTTON))]),HELPCONTENT.push([_("Enable scrolling"),_("You can scroll the blocks on the canvas."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(SCROLLUNLOCKBUTTON))])),HELPCONTENT.push([_("Change theme"),_("Switch between dark and light mode."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(DARKMODEBUTTON))]),HELPCONTENT.push([_("Merge with current project"),_("Click to add another project into the current one."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(OPENMERGEBUTTON))]),HELPCONTENT.push([_("Wrap Turtle"),_("Turn Turtle wrapping On or Off."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(WRAPTURTLEBUTTON))]),HELPCONTENT.push([_("Set Pitch Preview"),_("Click to set the current pitch."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(PITCHPREVIEWHELPBUTTON))]),e.beginnerMode||HELPCONTENT.push([_("JavaScript Editor"),_("Converts Music Block programs to JavaScript."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(JAVASCRIPTBUTTON))]),HELPCONTENT.push([_("Restore"),_("Restore blocks from the trash."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(RESTORETRASHBUTTON))]),HELPCONTENT.push([_("Switch mode"),_("Switch between beginner and advance modes."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(ADVANCEDBUTTON))]),HELPCONTENT.push([_("Select language"),_("Select your language preference."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(LANGUAGEBUTTON))]),HELPCONTENT.push([_("Contextual Menu for Blocks"),_("Right-click on a block to access common actions."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(BLOCKMENUBUTTON))]),HELPCONTENT.push([_("Delete"),_("To delete a block, right-click on it. Then you will see the delete option"),"data:image/svg+xml;base64,"+window.btoa(base64Encode(EMPTYTRASHCONFIRMBUTTON))]),HELPCONTENT.push([_("Copy"),_("To copy a block, right-click on it. Then you will see the copy option"),"data:image/svg+xml;base64,"+window.btoa(base64Encode(COPYBUTTON))]),HELPCONTENT.push([_("Extract"),_("To extract a block, right-click on it. Then you will see the extract option"),"data:image/svg+xml;base64,"+window.btoa(base64Encode(EXTRACTBUTTON))]),_THIS_IS_MUSIC_BLOCKS_&&HELPCONTENT.push([_("Keyboard shortcuts"),_("You can type d to create a do block and r to create a re block etc."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(SHORTCUTSBUTTON))]),e.beginnerMode||HELPCONTENT.push([_("Contextual Menu for Canvas"),_("Right-click on the canvas to perform additional canvas-related tasks."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(CANVASMENUBUTTON))]),HELPCONTENT.push([_("Grid"),_("Turn on/off lines for cartesian or polar grids.")+"<br/>"+_("Turn on/off music staffs."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(CARTESIANBUTTON))]),HELPCONTENT.push([_("Clear"),_("Clear the screen and return the mice to their initial positions."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(CLEARBUTTON))]),HELPCONTENT.push([_("Collapse"),_("Collapse the graphics window."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(COLLAPSEBUTTON))]),HELPCONTENT.push([_("Home"),_("Return all blocks to the center of the screen."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(GOHOMEBUTTON))]),HELPCONTENT.push([_("Show/hide blocks"),_("Hide or show the blocks and the palettes."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(HIDEBLOCKSBUTTON))]),HELPCONTENT.push([_("Expand/collapse blocks"),_("Expand or collapse start and action stacks."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(COLLAPSEBLOCKSBUTTON))]),HELPCONTENT.push([_("Decrease block size"),_("Decrease the size of the blocks."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(SMALLERBUTTON))]),HELPCONTENT.push([_("Increase block size"),_("Increase the size of the blocks."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(BIGGERBUTTON))]),e.beginnerMode||HELPCONTENT.push([_("Select"),_("Left-click and drag on workspace to select multiple blocks."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(SELECTHELPBUTTON))]),_THIS_IS_MUSIC_BLOCKS_&&HELPCONTENT.push([_("Palette buttons"),_("This toolbar contains the palette buttons including Rhythm Pitch Tone Action and more.")+" "+_("Click to show the palettes of blocks and drag blocks from the palettes onto the canvas to use them."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(RHYTHMPALETTEHELPICON))]),_THIS_IS_TURTLE_BLOCKS_?(HELPCONTENT.push([_("Guide"),_("A detailed guide to Turtle Blocks is available."),"data:image/svg+xml;base64,"+window.btoa(base64Encode(o)),GUIDEURL,_("Turtle Blocks Guide")]),HELPCONTENT.push([_("About"),_("Turtle Blocks is an open source collection of tools for exploring musical concepts.")+" "+_("A full list of contributors can be found in the Turtle Blocks GitHub repository.")+" "+_("Turtle Blocks is licensed under the AGPL.")+" "+_("The current version is")+" "+VERSION,"data:image/svg+xml;base64,"+window.btoa(base64Encode(o)),"https://github.com/sugarlabs/turtleblocksjs",_("Turtle Blocks GitHub repository")]),HELPCONTENT.push([_("Congratulations."),_("You have finished the tour. Please enjoy Turtle Blocks!"),"data:image/svg+xml;base64,"+window.btoa(base64Encode(o))])):(HELPCONTENT.push([_("About"),_("Music Blocks is an open source collection of tools for exploring musical concepts.")+" "+_("A full list of contributors can be found in the Music Blocks GitHub repository.")+" "+_("Music Blocks is licensed under the AGPL.")+" "+_("The current version is")+" "+VERSION,"data:image/svg+xml;base64,"+window.btoa(base64Encode(o)),"https://github.com/sugarlabs/musicblocks",_("Music Blocks GitHub repository")]),HELPCONTENT.push([_("Congratulations!"),_("You have finished the tour. Please enjoy Music Blocks!"),"data:image/svg+xml;base64,"+window.btoa(base64Encode(o))]))};"undefined"!=typeof module&&module.exports&&(module.exports={createDefaultStack:createDefaultStack,LOGOJA1:LOGOJA1,NUMBERBLOCKDEFAULT:NUMBERBLOCKDEFAULT,DEFAULTPALETTE:DEFAULTPALETTE,TITLESTRING:TITLESTRING});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var CONTAINERSCALEFACTOR=4,Turtles=(()=>_createClass(function e(t){_classCallCheck(this,e),importMembers(this,"",[t]),this.initActions()},[{key:"initActions",value:function(){setupRhythmActions(this.activity),setupMeterActions(this.activity),setupPitchActions(this.activity),setupIntervalsActions(this.activity),setupToneActions(this.activity),setupOrnamentActions(this.activity),setupVolumeActions(this.activity),setupDrumActions(this.activity),setupDictActions(this.activity)}},{key:"addTurtle",value:function(e,t){this.add(e,t),this.isShrunk()&&((e=this.getTurtle(this.getTurtleCount()-1)).container.scaleX=CONTAINERSCALEFACTOR,e.container.scaleY=CONTAINERSCALEFACTOR,e.container.scale=CONTAINERSCALEFACTOR)}},{key:"add",value:function(e,t){var a=this,n=(null!==e&&e.value!==this.getTurtleCount()&&(e.value=this.getTurtleCount()),"object"===_typeof(t)&&0<Object.keys(t).length),i=n&&"id"in t&&t.id!==1/0?t.id:Date.now(),r=n&&"name"in t?t.name:_("start"),o=new Turtle(this.activity,i,r,this,e),l=(this.addTurtleStageProps(o,n,t),this.activity.stage),s=this.getTurtleCount()%10;if(this.pushTurtle(o),null!==e){if("start"===e.name)this.createArtwork(o,s,!0);else{for(var u=0;u<this.getTurtleCount();u++)if(this.getTurtle(u).companionTurtle===this.getTurtleCount()-1){s=u%10;break}this.createArtwork(o,s,!1)}this.createHitArea(o),o.container.on("mousedown",function(e){var t=a.scale,n=o.container.x-e.stageX/t,i=o.container.y-e.stageY/t;l.dispatchEvent("CursorDown"+o.id),o.container.removeAllEventListeners("pressmove"),o.container.on("pressmove",function(e){a.isShrunk()||o.running||(o.container.x=e.stageX/t+n,o.container.y=e.stageY/t+i,o.x=a.screenX2turtleX(o.container.x),o.y=a.screenY2turtleY(o.container.y),a.activity.refreshCanvas())})}),o.container.on("pressup",function(){l.dispatchEvent("CursorUp"+o.id)}),o.container.on("click",function(){l.dispatchEvent("click"+o.id)}),o.container.on("mouseover",function(){l.dispatchEvent("CursorOver"+o.id),o.running||(o.container.scaleX*=1.2,o.container.scaleY=o.container.scaleX,o.container.scale=o.container.scaleX,a.activity.refreshCanvas())}),o.container.on("mouseout",function(){l.dispatchEvent("CursorOut"+o.id),o.running||(o.container.scaleX/=1.2,o.container.scaleY=o.container.scaleX,o.container.scale=o.container.scaleX,a.activity.refreshCanvas())}),document.getElementById("loader").className="",this.addTurtleGraphicProps(o,n,t),this.activity.refreshCanvas()}}},{key:"markAllAsStopped",value:function(){for(var e=0;e<this.getTurtleCount();e++)this.getTurtle(e).running=!1;this.activity.refreshCanvas()}},{key:"masterStage",get:function(){return this._masterStage},set:function(e){this._masterStage=e}},{key:"stage",get:function(){return this._stage},set:function(e){this._stage=e,this._stage.addChild(this._borderContainer)}},{key:"canvas",get:function(){return this._canvas},set:function(e){this._canvas=e}},{key:"borderContainer",get:function(){return this._borderContainer}},{key:"hideMenu",get:function(){return this._hideMenu},set:function(e){this._hideMenu=e}},{key:"doClear",get:function(){return this._doClear},set:function(e){this._doClear=e}},{key:"hideGrids",get:function(){return this._hideGrids},set:function(e){this._hideGrids=e}},{key:"doGrid",get:function(){return this._doGrid},set:function(e){this._doGrid=e}},{key:"turtleList",get:function(){return this._turtleList}},{key:"scale",get:function(){return this._scale}}]))();Turtles.TurtlesModel=(()=>_createClass(function e(t){_classCallCheck(this,e),this.activity=t,this._masterStage=null,this._stage=null,this._canvas=null,this._hideMenu=null,this._doClear=null,this._hideGrids=null,this._doGrid=null,this._borderContainer=new createjs.Container,this._masterStage=this.activity.stage,this._stage=this.activity.turtleContainer,this._stage.addChild(this._borderContainer),this._canvas=this.activity.canvas,this._hideMenu=this.activity.hideAuxMenu,this._hideGrids=this.activity.hideGrids,this._doGrid=this.activity._doCartesianPolar,this._turtleList=[]},[{key:"initializeTurtleList",value:function(e){this._turtleList=e}},{key:"getTurtle",value:function(e){var t=this._turtleList[e];if(t)return t;throw new Error("Turtle ".concat(e," not found"))}},{key:"getTurtleCount",value:function(){return this._turtleList.length}},{key:"pushTurtle",value:function(e){this._turtleList.includes(e)||this._turtleList.push(e)}},{key:"getIndexOfTurtle",value:function(e){return this._turtleList.indexOf(e)}},{key:"removeTurtle",value:function(e){var t,n;0<=e&&e<this._turtleList.length&&(void 0!==(t=this._turtleList[e]).interval&&(n=t.interval,clearInterval(n),t.interval=void 0),this._turtleList.splice(e,1))}},{key:"addTurtleStageProps",value:function(e,t,n){t&&("xcor"in n&&(e.x=n.xcor),"ycor"in n)&&(e.y=n.ycor);t=this._stage;e.imageContainer=new createjs.Container,t.addChild(e.imageContainer),e.penstrokes=new createjs.Bitmap,t.addChild(e.penstrokes),e.container=new createjs.Container,t.addChild(e.container),e.container.x=this.turtleX2screenX(e.x),e.container.y=this.turtleY2screenY(e.y)}},{key:"createHitArea",value:function(e){var t=new createjs.Shape;t.graphics.beginFill("#FFF").drawEllipse(-27,-27,55,55),t.x=0,t.y=0,e.container.hitArea=t}},{key:"addTurtleGraphicProps",value:function(e,t,n){setTimeout(function(){t&&("heading"in n&&e.painter.doSetHeading(n.heading),"pensize"in n&&e.painter.doSetPensize(n.pensize),"grey"in n&&e.painter.doSetChroma(n.grey),"shade"in n&&e.painter.doSetValue(n.shade),"color"in n&&e.painter.doSetColor(n.color),"name"in n)&&e.rename(n.name)},2e3)}},{key:"running",value:function(){for(var e=0;e<this.getTurtleCount();e++)if(this.getTurtle(e).running)return!0;return!1}},{key:"ithTurtle",value:function(e){return this.getTurtle(e)}},{key:"companionTurtle",value:function(e){for(var t=0;t<this.getTurtleCount();t++)if(this.getTurtle(t).companionTurtle===e)return t;return e}},{key:"turtleCount",value:function(){for(var e=0,t=0;t<this.getTurtleCount();t++)this.companionTurtle(t)!==t||this.getTurtle(t).inTrash||(e+=1);return e}}]))(),Turtles.TurtlesView=(()=>_createClass(function e(){var n=this;_classCallCheck(this,e),this._scale=1,this._w=1200,this._h=900,this._isShrunk=!1,this._expandedBoundary=null,this._collapsedBoundary=null,this._expandButton=null,this._collapseButton=null,this._clearButton=null,this.gridButton=null,this.collapse=null,this.expand=null,this._backgroundColor=platformColor.background,this._locked=!1,this._queue=[],this.currentGrid=null,window.addEventListener("resize",function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=Math.min(e/1200,t/900),t=Math.round(1200*e),e=Math.round(900*e);n._w=t,n._h=e})},[{key:"setStageScale",value:function(e){this.stage.scaleX=e,this.stage.scaleY=e,this.activity.refreshCanvas()}},{key:"doScale",value:function(e,t,n){this._locked?this._queue=[e,t,n]:(this._scale=n,this._w=e/n,this._h=t/n),this.makeBackground()}},{key:"isShrunk",value:function(){return this._isShrunk}},{key:"setGridLabel",value:function(e){this._gridLabel=e}},{key:"setBackgroundColor",value:function(e){e=-1===e?platformColor.background:this.getTurtle(e).painter.canvasColor;this._backgroundColor=e,this.makeBackground(),this.activity.refreshCanvas()}},{key:"deltaY",value:function(e){this.stage.y+=e}},{key:"_invertY",value:function(e){return this.canvas.height/(2*this._scale)-e}},{key:"screenX2turtleX",value:function(e){return e-this.canvas.width/(2*this._scale)}},{key:"screenY2turtleY",value:function(e){return this._invertY(e)}},{key:"turtleX2screenX",value:function(e){return this.canvas.width/(2*this._scale)+e}},{key:"turtleY2screenY",value:function(e){return this._invertY(e)}},{key:"createArtwork",value:function(e,t,n){var i=(i=n?TURTLESVG:METRONOMESVG).replace(/fill_color/g,FILLCOLORS[t]).replace(/stroke_color/g,STROKECOLORS[t]);e.makeTurtleBitmap(i,this.activity,n),e.painter.color=10*t,e.painter.canvasColor=getMunsellColor(e.painter.color,DEFAULTVALUE,DEFAULTCHROMA)}},{key:"makeBackground",value:function(e){function t(){var e=window.innerWidth,t=window.innerHeight;a._w=e,a._h=t}function n(){a._locked=!0;var e=new Image,t=(e.onload=function(){null!==a._expandedBoundary&&(a._expandedBoundary.visible=!1),a._expandedBoundary=new createjs.Bitmap(e),a._expandedBoundary.x=0,a._expandedBoundary.y=55+LEADING,o.addChild(a._expandedBoundary),f()},a._w-5),n=a._h-55-LEADING;e.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(MBOUNDARY.replace("HEIGHT",a._h).replace("WIDTH",a._w).replace("Y",10/CONTAINERSCALEFACTOR).replace("X",10/CONTAINERSCALEFACTOR).replace("DY",n).replace("DX",t).replace("stroke_color",platformColor.ruleColor).replace("fill_color",a._backgroundColor).replace("STROKE",20/CONTAINERSCALEFACTOR)))}var i,a=this,r=this.activity,o=this.borderContainer,l=(o.removeAllChildren(),this.stage),s=function(e,t,n,i){var a=document.createElement("div"),t=(a.setAttribute("id",""+t.name),a.setAttribute("class","tooltipped"),a.setAttribute("data-tooltip",t.label),a.setAttribute("data-position","bottom"),jQuery.noConflict()(".tooltipped").tooltip({html:!0,delay:100}),a.onmouseover=function(){r.loading||(document.body.style.cursor="pointer",a.style.transition="0.1s ease-out",a.style.transform="scale(1.15)")},a.onmouseout=function(){r.loading||(document.body.style.cursor="default",a.style.transition="0.15s ease-out",a.style.transform="scale(1)")},new Image);return t.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(e)),a.appendChild(t),a.setAttribute("style","position: absolute; right:"+(document.body.clientWidth-n)+"px;  top: "+i+"px;"),docById("buttoncontainerTOP").appendChild(a),a},u=function(){var n;l.removeAllEventListeners("pressmove"),l.removeAllEventListeners("mousedown"),l.on("mousedown",function(e){n={y:e.stageY-l.y,x:e.stageX-l.x}}),l.on("pressmove",function(e){var t=e.stageX-n.x,e=e.stageY-n.y;l.x=Math.max(0,Math.min(3*a._w/4,t)),l.y=Math.max(55,Math.min(3*a._h/4,e)),r.refreshCanvas()})},c=function(){a.hideMenu(),a.activity.hideGrids(),a.setStageScale(.25),a._collapsedBoundary.visible=!0,a._expandedBoundary.visible=!1,l.x=3*a._w/4-10,l.y=55+LEADING+6,a._isShrunk=!0;for(var e=0;e<a.getTurtleCount();e++){var t=a.getTurtle(e);t.container.scaleX=CONTAINERSCALEFACTOR,t.container.scaleY=CONTAINERSCALEFACTOR,t.container.scale=CONTAINERSCALEFACTOR}a.masterStage.removeChild(l),a.masterStage.addChild(l),u(),a.activity.refreshCanvas()},d=function(){a.gridButton=s(CARTESIANBUTTON,{name:"Grid",label:_("Grid")},a._w-10-165,70+LEADING+6);var e=a;a.gridButton.onclick=function(){piemenuGrid(e.activity)}},h=function(){a._clearButton=s(CLEARBUTTON,{name:"Clear",label:_("Clear")},a._w-5-110,70+LEADING+6),a._clearButton.onclick=function(){a.activity._allClear()}},y=function(){a._collapseButton=s(COLLAPSEBUTTON,{name:"Collapse",label:_("Collapse")},a._w-55,70+LEADING+6),a._collapseButton.onclick=function(){var e,t=docById("aux-toolbar");"block"===t.style.display&&(e=docById("menu"),t.style.display="none",e.innerHTML="menu",docById("toggleAuxBtn").className-="blue darken-1"),a._expandButton.style.visibility="visible",a._collapseButton.style.visibility="hidden",a.activity.helpfulWheelItems.forEach(function(e){"Expand"===e.label?e.display=!0:"Collapse"!==e.label&&"Grid"!==e.label||(e.display=!1)}),c()}},p=(this.collapse=function(){var e,t=docById("aux-toolbar");"block"===t.style.display&&(e=docById("menu"),t.style.display="none",e.innerHTML="menu",docById("toggleAuxBtn").className-="blue darken-1"),a._expandButton.style.visibility="visible",a._collapseButton.style.visibility="hidden",a.gridButton.style.visibility="hidden",a.activity.helpfulWheelItems.forEach(function(e){"Expand"===e.label?e.display=!0:"Collapse"!==e.label&&"Grid"!==e.label||(e.display=!1)}),c(),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",a.activity.__tick())},function(){a._expandButton=s(EXPANDBUTTON,{name:"Expand",label:_("Expand")},a._w-55,70+LEADING+6),null!==a._expandButton&&(a._expandButton.style.visibility="hidden"),a._expandButton.onclick=function(){a.expand()}}),v=(this.expand=function(){var e,t=docById("aux-toolbar");"block"===t.style.display&&(e=docById("menu"),t.style.display="none",e.innerHTML="menu",docById("toggleAuxBtn").className-="blue darken-1"),a.hideMenu(),a.setStageScale(1),a._expandedBoundary.visible=!0,a.gridButton.style.visibility="visible",a._collapseButton.style.visibility="visible",a._expandButton.style.visibility="hidden",a.activity.helpfulWheelItems.forEach(function(e){"Expand"===e.label?e.display=!1:"Collapse"!==e.label&&"Grid"!==e.label||(e.display=!0)}),a._collapsedBoundary.visible=!1,l.removeAllEventListeners("pressmove"),l.removeAllEventListeners("mousedown"),l.x=0,l.y=0,a._isShrunk=!1;for(var n=0;n<a.getTurtleCount();n++){var i=a.getTurtle(n);i.container.scaleX=1,i.container.scaleY=1,i.container.scale=1}a._clearButton.scaleX=1,a._clearButton.scaleY=1,a._clearButton.scale=1,a._clearButton.x=a._w-5-110,null!==a.gridButton&&(a.gridButton.scaleX=1,a.gridButton.scaleY=1,a.gridButton.scale=1,a.gridButton.x=a._w-10-165,a.gridButton.visible=!0),null!==a.currentGrid&&a.activity.turtles.doGrid(0),a.masterStage.removeChild(l),a.masterStage.addChildAt(l,0),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",a.activity.__tick())},function(){var e=!1,t=(docById("buttoncontainerTOP")&&(jQuery.noConflict()(".tooltipped").tooltip("close"),docById("buttoncontainerTOP").parentElement.removeChild(docById("buttoncontainerTOP")),e=!0),document.createElement("div"));document.body.appendChild(t),t.style.display=e?"block":"none",t.setAttribute("id","buttoncontainerTOP"),y(),p(),h(),d(),jQuery.noConflict()(".tooltipped").each(function(){jQuery.noConflict()(this).tooltip({html:!0,delay:100})}),a._locked=!1}),f=function(){var e=new Image,t=(e.onload=function(){null!==a._collapsedBoundary&&(a._collapsedBoundary.visible=!1),a._collapsedBoundary=new createjs.Bitmap(e),a._collapsedBoundary.x=0,a._collapsedBoundary.y=55+LEADING,o.addChild(a._collapsedBoundary),a._collapsedBoundary.visible=!1},a._w-20),n=a._h-55-LEADING;e.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(MBOUNDARY.replace("HEIGHT",a._h).replace("WIDTH",a._w).replace("Y",10).replace("X",10).replace("DY",n).replace("DX",t).replace("stroke_color",platformColor.ruleColor).replace("fill_color",a._backgroundColor).replace("STROKE",20))),v()},m=(this._locked||n(),!1);return window.addEventListener("resize",function(){navigator.hardwareConcurrency&&4<=navigator.hardwareConcurrency?m||(window.requestAnimationFrame(function(){t(),n(),f(),m=!1}),m=!0):(clearTimeout(i),i=setTimeout(function(){t(),n(),f()},150))}),this}}]))(),"undefined"!=typeof module&&module.exports&&(module.exports=Turtles);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function o(e,t,n,o){var a,r,i,l,c,u,d,s,f,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(a=e,r=n,d=o||[],s=!1,f={p:u=0,n:0,v:m,a:p,f:p.bind(m,4),d:function(e,t){return i=e,l=0,c=m,f.n=t,v}},function(e,t,n){if(1<u)throw TypeError("Generator is already running");for(s&&1===t&&p(t,n),l=t,c=n;(y=l<2?m:c)||!s;){i||(l?l<3?(1<l&&(f.n=-1),p(l,c)):f.n=c:f.v=c);try{if(u=2,i){if(y=i[e=l?e:"next"]){if(!(y=y.call(i,c)))throw TypeError("iterator result is not an object");if(!y.done)return y;c=y.value,l<2&&(l=0)}else 1===l&&(y=i.return)&&y.call(i),l<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),l=1);i=m}else if((y=(s=f.n<0)?c:a.call(r,f))!==v)break}catch(e){i=m,l=1,c=e}finally{u=1}}return{value:y,done:s}}),!0),t;function p(e,t){for(l=e,c=t,y=0;!s&&u&&!n&&y<d.length;y++){var n,o=d[y],a=f.p,r=o[2];3<e?(n=r===t)&&(c=o[(l=o[4])?5:l=3],o[4]=o[5]=m):o[0]<=a&&((n=e<2&&a<o[1])?(l=0,f.v=t,f.n=o[1]):a<r&&(n=e<3||o[0]>t||r<t)&&(o[4]=e,o[5]=t,f.n=r,l=0))}if(n||1<e)return v;throw s=!0,t}}var v={};function g(){}function a(){}function r(){}var y=Object.getPrototypeOf,e=[][t]?y(y([][t]())):(_regeneratorDefine2(y={},t,function(){return this}),y),i=r.prototype=g.prototype=Object.create(e);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,r):(e.__proto__=r,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",a.prototype=r),_regeneratorDefine2(r,"constructor",a),_regeneratorDefine2(r,n,a.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,n,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:l}})()}function _regeneratorDefine2(e,t,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}(_regeneratorDefine2=function(e,t,n,o){function a(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(a("next",0),a("throw",1),a("return",2))})(e,t,n,o)}function asyncGeneratorStep(e,t,n,o,a,r,i){try{var l=e[r](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(o,a)}function _asyncToGenerator(l){return function(){var e=this,i=arguments;return new Promise(function(t,n){var o=l.apply(e,i);function a(e){asyncGeneratorStep(o,t,n,a,r,"next",e)}function r(e){asyncGeneratorStep(o,t,n,a,r,"throw",e)}a(void 0)})}}global.Midi=jest.fn().mockImplementation(function(){return{header:{ticksPerBeat:480},addTrack:jest.fn(function(){return{addNote:jest.fn(),name:"",instrument:{number:0},channel:0}}),toArray:jest.fn(function(){return new Uint8Array([1,2,3])})}}),global.jQuery=jest.fn(function(){return{on:jest.fn(),trigger:jest.fn()}}),global.jQuery.noConflict=jest.fn(function(){return global.jQuery}),global._=jest.fn(function(e){return e}),global._THIS_IS_TURTLE_BLOCKS_=!0,global.TITLESTRING="Music Blocks",global.GUIDEURL="Docs/guide/guide.html",global.fileExt=jest.fn(function(e){return!e||1===(e=e.split(".")).length||""===e[0]&&2===e.length?"":e.pop()}),global.window={isElectron:!1,prompt:jest.fn()},global.document={createElement:jest.fn(function(){return{setAttribute:jest.fn(),click:jest.fn()}}),body:{appendChild:jest.fn(),removeChild:jest.fn()}},global.docById=jest.fn(function(e){return document.getElementById(e)}),global.docByClass=jest.fn(function(e){return document.getElementsByClassName(e)}),global.mockRunLogoCommands=jest.fn(),global.mockDownload=jest.fn();var _require=require("../SaveInterface"),SaveInterface=_require.SaveInterface,_require2=require("../lilypond"),LILYPONDHEADER=_require2.LILYPONDHEADER;global.LILYPONDHEADER=LILYPONDHEADER,global.instance=new SaveInterface,describe("SaveInterface",function(){var e,t;beforeEach(function(){e={beginnerMode:!1,PlanetInterface:{getCurrentProjectName:jest.fn(function(){return"My Project"})}},t=new SaveInterface(e)}),it("should initialize with the correct default values",function(){expect(t.activity).toBe(e),expect(t.filename).toBeNull(),expect(t.notationConvert).toBe(""),expect(t.timeLastSaved).toBe(-100)}),it("should store activity instance correctly",function(){var e={beginnerMode:!0},t=new SaveInterface(e);expect(t.activity).toBe(e)})}),describe("download",function(){var t;beforeEach(function(){var e={beginnerMode:!1,PlanetInterface:{getCurrentProjectName:jest.fn(function(){return"My Project"})}};t=new SaveInterface(e),document.body.innerHTML="",mockDownloadURL=jest.spyOn(t,"downloadURL"),Object.defineProperty(window,"prompt",{writable:!0,value:jest.fn(function(){return"My Project.abc"})})}),it("should set correct filename and extension when defaultfilename is provided",function(){t.download("abc","data","custom"),expect(mockDownloadURL).toHaveBeenCalledWith("custom.abc","data")}),it("should default filename to 'My Project.abc' if defaultfilename is null",function(){t.download("abc","data",null),expect(mockDownloadURL).toHaveBeenCalledWith("My Project.abc","data")}),it("should append the extension if not present in the filename",function(){t.download("wav","data","My Project"),expect(mockDownloadURL).toHaveBeenCalledWith("My Project.wav","data")}),it("should not append the extension if already present in the filename",function(){t.download("xml","data","My Project"),expect(mockDownloadURL).toHaveBeenCalledWith("My Project.xml","data")}),t=new SaveInterface,it("should create an anchor tag and trigger a download",function(){document.body.appendChild=jest.fn(),document.body.removeChild=jest.fn();var e=jest.fn();jest.spyOn(document,"createElement").mockImplementation(function(){return{setAttribute:jest.fn(),click:e}}),t.downloadURL("test.txt","data:text/plain;base64,SGVsbG8gd29ybGQ="),expect(document.createElement).toHaveBeenCalledWith("a"),expect(e).toHaveBeenCalled(),expect(document.body.appendChild).toHaveBeenCalled(),expect(document.body.removeChild).toHaveBeenCalled()}),afterEach(function(){jest.restoreAllMocks()})}),describe("save HTML methods",function(){var t;beforeEach(function(){t={htmlSaveTemplate:"<html><body><h1>{{ project_name }}</h1><p>{{ project_description }}</p><img src='{{ project_image }}'/><div>{{ data }}</div></body></html>",prepareExport:jest.fn(function(){return"Mock Exported Data"}),PlanetInterface:{getCurrentProjectDescription:jest.fn(function(){return"Mock Description"}),getCurrentProjectName:jest.fn(function(){return"Mock Project"}),getCurrentProjectImage:jest.fn(function(){return"mock-image.png"})}}}),it("should replace placeholders with actual project data",function(){var e=(e=t.htmlSaveTemplate).replace(/{{ project_description }}/g,t.PlanetInterface.getCurrentProjectDescription()).replace(/{{ project_name }}/g,t.PlanetInterface.getCurrentProjectName()).replace(/{{ data }}/g,t.prepareExport()).replace(/{{ project_image }}/g,t.PlanetInterface.getCurrentProjectImage());expect(e).toContain("<h1>Mock Project</h1>"),expect(e).toContain("<p>Mock Description</p>"),expect(e).toContain("<img src='mock-image.png'/>"),expect(e).toContain("<div>Mock Exported Data</div>")}),it("should call prepareHTML and download the file",function(){var e=jest.fn(function(){return"<html>Mock HTML</html>"}),t={save:{prepareHTML:e,download:mockDownload}};instance.saveHTML(t),expect(e).toHaveBeenCalled(),expect(mockDownload).toHaveBeenCalledWith("html","data:text/plain;charset=utf-8,%3Chtml%3EMock%20HTML%3C%2Fhtml%3E",null)}),jest.useFakeTimers(),it("should call prepareHTML and download the file with the correct filename",function(){var e=jest.fn(function(){return"<html>Mock HTML</html>"}),t=jest.fn(function(){return"MockProject"}),n={save:{prepareHTML:e,downloadURL:mockDownloadURL},PlanetInterface:{getCurrentProjectName:t}};instance.saveHTMLNoPrompt(n),jest.runAllTimers(),expect(e).toHaveBeenCalled(),expect(t).toHaveBeenCalled(),expect(mockDownloadURL).toHaveBeenCalledWith("MockProject.html","data:text/plain;charset=utf-8,%3Chtml%3EMock%20HTML%3C%2Fhtml%3E")})}),describe("saveMIDI Method",function(){var e,t;beforeEach(function(){t={runningMIDI:!1,runLogoCommands:jest.fn()},e={logo:t}}),it("should set runningMIDI to true and run logo commands",function(){instance.saveMIDI(e),expect(e.logo.runningMIDI).toBe(!0),expect(e.logo.runLogoCommands).toHaveBeenCalled(),expect(document.body.style.cursor).toBe("wait")})}),describe("afterSaveMIDI",function(){beforeEach(function(){global.activity={logo:{_midiData:{0:[{note:["G4"],duration:4,bpm:90,instrument:"guitar"},{note:["E4"],duration:4,bpm:90,instrument:"guitar"}]}},save:{download:jest.fn()}},global.URL.createObjectURL=jest.fn(function(){return"mockURL"}),jest.useFakeTimers(),global.getMidiInstrument=jest.fn(function(){return{default:0,guitar:25}}),global.getMidiDrum=jest.fn(function(){return{"snare drum":38,"kick drum":36}})}),afterEach(function(){jest.clearAllMocks()}),it("should generate MIDI and trigger download",function(){instance.afterSaveMIDI(),jest.runAllTimers(),expect(Midi).toHaveBeenCalled(),expect(activity.save.download).toHaveBeenCalledWith("midi","mockURL",null),expect(activity.logo._midiData).toEqual({}),expect(document.body.style.cursor).toBe("default")}),it("should create instrument tracks and add notes correctly",function(){instance.afterSaveMIDI(),jest.runAllTimers();var e=Midi.mock.results[0].value.addTrack.mock.results.map(function(e){return e.value}).find(function(e){return"Track 1 - guitar"===e.name});expect(e.instrument.number).toBe(25),expect(e.addNote).toHaveBeenNthCalledWith(1,{name:"G4",time:0,duration:.6666666666666666,velocity:.8}),expect(e.addNote).toHaveBeenNthCalledWith(2,{name:"E4",time:.6666666666666666,duration:.6666666666666666,velocity:.8})})}),describe("save artwork methods",function(){beforeEach(function(){document.body.innerHTML='\n            <canvas id="overlayCanvas"></canvas>\n        ',docById.mockImplementation(function(e){return document.getElementById(e)})}),it("should call doSVG and download the SVG file",function(){var e=jest.fn(function(){return"<svg>Mock SVG</svg>"}),t=(global.doSVG=e,{save:{download:mockDownload},canvas:{width:500,height:500},logo:"mockLogo",turtles:"mockTurtles"});instance.saveSVG(t),expect(e).toHaveBeenCalledWith(t.canvas,t.logo,t.turtles,t.canvas.width,t.canvas.height,1),expect(mockDownload).toHaveBeenCalledWith("svg","data:image/svg+xml;utf8,<svg>Mock SVG</svg>",null)}),it("should call toDataURL and download the PNG file",function(){var e={toDataURL:jest.fn(function(){return"data:image/png;base64,mockdata"})},t=(global.docById=jest.fn(function(){return e}),{save:{download:mockDownload}});instance.savePNG(t),expect(e.toDataURL).toHaveBeenCalledWith("image/png"),expect(mockDownload).toHaveBeenCalledWith("png","data:image/png;base64,mockdata",null)}),it("should call printBlockSVG and download the SVG file",function(){var e=jest.fn(function(){return"<svg>Mock SVG</svg>"}),t={save:{download:mockDownload},printBlockSVG:e};instance.saveBlockArtwork(t),expect(e).toHaveBeenCalled(),expect(mockDownload).toHaveBeenCalledWith("svg","data:image/svg+xml;utf8,<svg>Mock SVG</svg>",null)}),it("should call printBlockPNG and download the PNG file",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(function(){return Promise.resolve("data:image/png;base64,mockdata")}),n={save:{download:mockDownload},printBlockPNG:t},e.n=1,instance.saveBlockArtworkPNG(n);case 1:expect(t).toHaveBeenCalled(),expect(mockDownload).toHaveBeenCalledWith("png","data:image/png;base64,mockdata",null);case 2:return e.a(2)}},e)})))}),describe("saveWAV & saveABC methods",function(){beforeEach(function(){global._=jest.fn(function(e){return e}),global.ABCHEADER="X:1\nT:Music Blocks composition\nC:Mr. Mouse\nL:1/16\nM:C\n"}),it("should start audio recording and update UI",function(){var e=jest.fn(),t=jest.fn(),n=jest.fn(),o={logo:{recording:!1,synth:{setupRecorder:e,recorder:{start:t}},runLogoCommands:mockRunLogoCommands},textMsg:n};instance.saveWAV(o),expect(document.body.style.cursor).toBe("wait"),expect(o.logo.recording).toBe(!0),expect(e).toHaveBeenCalled(),expect(t).toHaveBeenCalled(),expect(mockRunLogoCommands).toHaveBeenCalled(),expect(n).toHaveBeenCalledWith("Your recording is in progress.")}),it("should prepare and run ABC notation commands",function(){var e={logo:{runningAbc:!1,notationOutput:"",notationNotes:{},recordingBuffer:{hasData:!1,notationOutput:"",notationNotes:{}},notation:{notationStaging:{},notationDrumStaging:{}},runLogoCommands:mockRunLogoCommands},turtles:{turtleList:[{painter:{doClear:jest.fn()}}],getTurtleCount:jest.fn(function(){return 1}),getTurtle:function(e){return this.turtleList[e]}}};instance.saveAbc(e),expect(document.body.style.cursor).toBe("wait"),expect(e.logo.runningAbc).toBe(!0),expect(mockRunLogoCommands).toHaveBeenCalled()}),it("should encode and download ABC notation output",function(){var e=jest.fn(function(){return"mock_abc_data"}),t=(global.saveAbcOutput=e,{save:{download:mockDownload}});instance.afterSaveAbc.call({activity:t}),expect(e).toHaveBeenCalledWith(t),expect(mockDownload).toHaveBeenCalledWith("abc","data:text;utf8,mock_abc_data",null)})}),describe("saveLilypond Methods",function(){var e,t,n,o;beforeEach(function(){document.body.innerHTML='\n            <div id="lilypondModal" style="display: none;">\n                <div class="modal-content" tabindex="-1">\n                    <span class="close">×</span>\n                    <div id="fileNameText">File name</div>\n                    <input type="text" id="fileName" value="TestProject.ly" tabindex="-1">\n                    <p></p>\n                    <div id="titleText">Project title</div>\n                    <input type="text" id="title" tabindex="-1">\n                    <p></p>\n                    <div id="authorText">Project author</div>\n                    <input type="text" id="author" tabindex="-1">\n                    <p></p>\n                    <div id="MIDIText">Include MIDI output?</div>\n                    <input type="checkbox" id="MIDICheck" tabindex="-1">\n                    <p></p>\n                    <div id="guitarText">Include guitar tablature output?</div>\n                    <input type="checkbox" id="guitarCheck" tabindex="-1">\n                    <p></p>\n                    <p><button id="submitLilypond">Save as Lilypond</button></p>\n                </div>\n            </div>\n        ',global.docById=jest.fn(function(e){return document.getElementById(e)}),jest.spyOn(document,"getElementById").mockImplementation(function(e){return document.querySelector("#".concat(e))}),document.execCommand=jest.fn(),global.platform={FF:!1},global.jQuery=jest.fn(function(e){return e===window?{on:jest.fn()}:{appendTo:jest.fn().mockReturnThis(),val:jest.fn().mockReturnThis(),select:jest.fn(),remove:jest.fn(),on:jest.fn()}}),global.jQuery.noConflict=jest.fn().mockImplementation(function(){return global.jQuery}),e={PlanetInterface:{getCurrentProjectName:jest.fn(function(){return"Test Project"})},storage:{getItem:jest.fn(function(){return JSON.stringify("Custom Author")}),setItem:jest.fn()},save:{saveLYFile:jest.fn(),download:jest.fn()},logo:{runningLilypond:!1,MIDIOutput:"",guitarOutputHead:"",guitarOutputEnd:"",notationOutput:"",notationNotes:{},recordingBuffer:{hasData:!1,notationOutput:"",notationNotes:{}},notation:{notationStaging:[],notationDrumStaging:[]},runLogoCommands:jest.fn()},textMsg:jest.fn(),errorMsg:jest.fn(),download:jest.fn()},n=_objectSpread(_objectSpread({},e),{},{turtles:{turtleList:[{painter:{doClear:jest.fn()}}],getTurtleCount:jest.fn(function(){return 1}),getTurtle:function(e){return this.turtleList[e]}}}),(instance=new SaveInterface).activity=e,instance.notationConvert="ly",instance.afterSaveLilypondLY=jest.fn(),t=new SaveInterface(n),mockSaveLilypondOutput=jest.fn(function(){return"Lilypond Data"}),global.saveLilypondOutput=mockSaveLilypondOutput,o=jest.fn(),window.Converter={ly2pdf:jest.fn()},lydata="Lilypond Data",filename="TestProject.pdf",dataurl="data:application/pdf;base64,abc123",document.body.style.cursor=""}),it("should open the Lilypond modal and populate fields",function(){instance.saveLilypond(e),expect(docById("lilypondModal").style.display).toBe("block"),expect(docById("fileName").value).toBe("Test Project.ly"),expect(docById("title").value).toBe("Test Project"),expect(docById("author").value).toBe("Custom Author")}),it("should close the modal when close button is clicked",function(){instance.saveLilypond(e),docByClass("close")[0].click(),expect(e.logo.runningLilypond).toBe(!1),expect(docById("lilypondModal").style.display).toBe("none")}),it("should call saveLYFile when save button is clicked",function(){instance.saveLilypond(e),docById("submitLilypond").click(),expect(e.save.saveLYFile).toHaveBeenCalledWith(!1)}),afterEach(function(){jest.clearAllMocks()}),it("should save a Lilypond file with default settings",function(){t.saveLYFile(),expect(global.docById).toHaveBeenCalledWith("fileName")}),it("should save a Lilypond file with PDF conversion",function(){t.saveLYFile(!0),expect(t.notationConvert).toBe("pdf")}),it("should handle MIDI and guitar output settings correctly",function(){o.mockImplementation(function(e){return{fileName:{value:"testFile"},title:{value:"My Project"},author:{value:"Mr. Mouse"},MIDICheck:{checked:!0},guitarCheck:{checked:!0},lilypondModal:{style:{display:"block"}}}[e]}),t.saveLYFile();expect(n.logo.MIDIOutput).toContain("% MIDI SECTION\n% Delete the %{ and %} below to include MIDI output.\n%{\n\\midi {\n   \\tempo 4=90\n}\n%}\n\n}")}),it("should call saveLilypondOutput and afterSaveLilypondLY",function(){instance.afterSaveLilypond("ignored.ly"),expect(mockSaveLilypondOutput).toHaveBeenCalledWith(instance.activity),expect(instance.afterSaveLilypondLY).toHaveBeenCalledWith("Lilypond Data","TestProject.ly"),expect(instance.notationConvert).toBe("")}),it('should set cursor to "wait" and call ly2pdf with correct arguments',function(){instance.afterSaveLilypondPDF(lydata,filename),expect(document.body.style.cursor).toBe("wait"),expect(window.Converter.ly2pdf).toHaveBeenCalledWith(lydata,expect.any(Function))}),it('should reset cursor to "default" and call activity.save.download on success',function(){window.Converter.ly2pdf.mockImplementation(function(e,t){t(!0,dataurl)}),instance.afterSaveLilypondPDF(lydata,filename),expect(document.body.style.cursor).toBe("default"),expect(e.save.download).toHaveBeenCalledWith("pdf",dataurl,filename)}),it('should reset cursor to "default" and call errorMsg on failure',function(){var n="Conversion failed";window.Converter.ly2pdf.mockImplementation(function(e,t){t(!1,n)}),console.debug=jest.fn(),instance.afterSaveLilypondPDF(lydata,filename),expect(document.body.style.cursor).toBe("default"),expect(console.debug).toHaveBeenCalledWith("Error: "+n),expect(e.errorMsg).toHaveBeenCalledWith("Failed to convert Lilypond to PDF. Please try saving as .ly file instead.",5e3),expect(e.save.download).not.toHaveBeenCalled()})}),describe("MXML Methods",function(){var n,o,a,r;beforeEach(function(){var e={doClear:jest.fn()},t={doClear:jest.fn()};a={runningMxml:!(r={turtleList:[{painter:e},{painter:t}],getTurtleCount:function(){return this.turtleList.length},getTurtle:function(e){return this.turtleList[e]}}),notation:{notationStaging:{},notationDrumStaging:{}},runLogoCommands:jest.fn()},o={logo:a,turtles:r},(n=new SaveInterface).activity=o,n.download=jest.fn(),global.saveMxmlOutput=jest.fn().mockReturnValue("<score>Mock MXML Data</score>")}),it("should initialize MXML state and clear turtle canvases",function(){n.saveMxml("test.mxml"),expect(o.logo.runningMxml).toBe(!0),expect(o.logo.notation.notationStaging[0]).toEqual([]),expect(o.logo.notation.notationStaging[1]).toEqual([]),expect(o.logo.notation.notationDrumStaging[0]).toEqual([]),expect(o.logo.notation.notationDrumStaging[1]).toEqual([]),expect(r.turtleList[0].painter.doClear).toHaveBeenCalledWith(!0,!0,!0),expect(r.turtleList[1].painter.doClear).toHaveBeenCalledWith(!0,!0,!0),expect(o.logo.runLogoCommands).toHaveBeenCalled()}),it("should generate XML and trigger download",function(){var e="TestScore.xml",t=(n.afterSaveMxml(e),expect(global.saveMxmlOutput).toHaveBeenCalledWith(o.logo),"data:text;utf8,"+encodeURIComponent("<score>Mock MXML Data</score>"));expect(n.download).toHaveBeenCalledWith("xml",t,e),expect(o.logo.runningMxml).toBe(!1)}),it("should handle empty data gracefully",function(){global.saveMxmlOutput.mockReturnValue(""),n.afterSaveMxml("empty.xml"),expect(n.download).toHaveBeenCalledWith("xml","data:text;utf8,"+encodeURIComponent(""),"empty.xml")})});
global.NOTATIONNOTE=0,global.NOTATIONDURATION=1,global.NOTATIONDOTCOUNT=2,global.NOTATIONTUPLETVALUE=3,global.NOTATIONROUNDDOWN=4,global.NOTATIONINSIDECHORD=5,global.NOTATIONSTACCATO=6,global.frequencyToPitch=jest.fn(function(t){return 440===t?["A","4"]:["G♯","4"]}),global.toFraction=jest.fn(function(t){return[1,1]});var _require=require("../abc"),getABCHeader=_require.getABCHeader,processABCNotes=_require.processABCNotes,saveAbcOutput=_require.saveAbcOutput,ACCIDENTAL_MAP=_require.ACCIDENTAL_MAP,OCTAVE_NOTATION_MAP=_require.OCTAVE_NOTATION_MAP;describe("getABCHeader",function(){it("should return the correct ABC header",function(){expect(getABCHeader()).toBe("X:1\nT:Music Blocks composition\nC:Mr. Mouse\nL:1/16\nM:C\n")})}),describe("processABCNotes - Basic Note Processing",function(){var o;beforeEach(function(){o={notationNotes:{0:""},notation:{notationStaging:{0:[[["G♯4"],4,0,null,null,-1,!1],[["F4"],4,0,null,null,-1,!1],[["G♯4"],2,0,null,null,-1,!1]]}}}}),it("should process notes and update notationNotes correctly",function(){processABCNotes(o,"0"),expect(o.notationNotes[0]).toBe("G^4 G^4 F4 F4 G^2 G^8 ")}),it("should insert a newline after every 8 notes",function(){for(var t=[],n=0;n<9;n++)t.push([["C4"],4,0,null,null,-1,!1]);o.notation.notationStaging[0]=t,processABCNotes(o,"0"),expect(o.notationNotes[0]).toMatch(/\n/)})}),describe("processABCNotes - Advanced Note Handling",function(){var n;beforeEach(function(){n={notationNotes:{0:""},notation:{notationStaging:{0:[]}}}}),it("should handle frequency (number) inputs",function(){n.notation.notationStaging[0]=[[[440],4,0,null,null,-1,!1]],processABCNotes(n,"0"),expect(n.notationNotes[0]).toContain("A4"),expect(global.frequencyToPitch).toHaveBeenCalledWith(440)}),it("should handle staccato and dots",function(){n.notation.notationStaging[0]=[[["C4"],4,2,null,null,-1,!0]],processABCNotes(n,"0"),expect(n.notationNotes[0]).toContain("C4.."),expect(n.notationNotes[0]).toContain(".")}),it("should convert durations using the map and fallback to string",function(){n.notation.notationStaging[0]=[[["C4"],64,0,null,null,-1,!1],[["D4"],32,0,null,null,-1,!1],[["E4"],1,0,null,null,-1,!1],[["F4"],5,0,null,null,-1,!1]],processABCNotes(n,"0");var t=n.notationNotes[0];expect(t).toContain("C1/4"),expect(t).toContain("D1/2"),expect(t).toContain("E16"),expect(t).toContain("F5")})}),describe("processABCNotes - Control Strings",function(){var n;beforeEach(function(){n={notationNotes:{0:""},notation:{notationStaging:{0:[]}}}}),it("should handle all string commands correctly",function(){n.notation.notationStaging[0]=["break",[["C4"],4,0,null,null,-1,!1],"break","begin articulation",[["D4"],4,0,null,null,-1,!1],"end articulation","begin crescendo","end crescendo","begin decrescendo","end decrescendo","begin slur",[["E4"],4,0,null,null,-1,!1],"end slur","tie","voice one","voice two","voice three","voice four","one voice","unknown command"],processABCNotes(n,"0");var t=n.notationNotes[0];expect(t).toContain("\n"),expect(t).toContain("!<(!"),expect(t).toContain("!<)!"),expect(t).toContain("!>(!"),expect(t).toContain("V:1"),expect(t).toContain("V:2"),expect(t).toContain("V:3"),expect(t).toContain("V:4"),expect(t).toContain("unknown command")}),it("should handle meter command",function(){n.notation.notationStaging[0]=["meter","4","4"],processABCNotes(n,"0"),expect(n.notationNotes[0]).toContain("M:4/4")}),it("should handle pickup command",function(){n.notation.notationStaging[0]=["pickup","8"],processABCNotes(n,"0"),expect(n.notationNotes[0]).toContain("K: pickup=8")})}),describe("processABCNotes - Chords",function(){var n;beforeEach(function(){n={notationNotes:{0:""},notation:{notationStaging:{0:[]}}}}),it("should handle chords correctly (Start, Middle, End)",function(){n.notation.notationStaging[0]=[[["C4"],4,0,null,null,123,!1],[["E4"],4,0,null,null,123,!1],[["G4"],4,0,null,null,123,!1],[["A4"],4,0,null,null,999,!1]],processABCNotes(n,"0");var t=n.notationNotes[0];expect(t).toContain("C4 [C"),expect(t).toContain("E4"),expect(t).toContain("G4 G]4")}),it("should handle articulation inside chords",function(){n.notation.notationStaging[0]=["begin articulation",[["C4"],4,0,null,null,55,!1],[["E4"],4,0,null,null,55,!1],"end articulation"],processABCNotes(n,"0"),expect(n.notationNotes[0]).toContain("C4 [C")})}),describe("processABCNotes - Tuplet Handling",function(){var t;beforeEach(function(){t={notationNotes:{0:""},notation:{notationStaging:{0:[]}}}}),it("should process standard tuplets correctly",function(){t.notation.notationStaging[0]=[[["G♯4"],4,0,3,2,-1,!1],[["F4"],4,0,3,2,-1,!1],[["G♯4"],4,0,3,2,-1,!1]],processABCNotes(t,"0"),expect(t.notationNotes[0]).toBe("(1:1G^ 2G^ 2G^ 2 ")}),it("should handle array of notes (chords) inside tuplets",function(){t.notation.notationStaging[0]=[[["C4","E4"],4,0,1,1,-1,!1]],processABCNotes(t,"0"),expect(t.notationNotes[0]).toContain("[C E ]")}),it("should handle staccato inside tuplets",function(){t.notation.notationStaging[0]=[[["C4","E4"],4,0,1,1,-1,!0]],processABCNotes(t,"0"),expect(t.notationNotes[0]).toContain(".")}),it("should handle incomplete/mixed tuplets logic",function(){t.notation.notationStaging[0]=[[["A4"],4,0,3,2,-1,!1],[["B4"],4,0,3,2,-1,!1]],processABCNotes(t,"0"),expect(t.notationNotes[0]).toContain("(")}),it("should handle tuplet with matching chord IDs (skip logic)",function(){t.notation.notationStaging[0]=[[["A4"],4,0,2,2,100,!1],[["B4"],4,0,2,2,100,!1],[["C4"],4,0,2,2,-1,!1]],processABCNotes(t,"0"),expect(t.notationNotes[0]).not.toBe("")})}),describe("processABCNotes - Edge Cases for 100% Coverage",function(){var n;beforeEach(function(){n={notationNotes:{0:""},notation:{notationStaging:{0:[]}}}}),it("should handle array of notes in NOTATIONNOTE field",function(){n.notation.notationStaging[0]=[[["C4","E4"],4,0,null,null,-1,!1]],processABCNotes(n,"0"),expect(n.notationNotes[0]).toContain("C4")}),it("should handle incomplete tuplets with different tuplet values",function(){n.notation.notationStaging[0]=[[["A4"],4,0,3,2,-1,!1],[["B4"],4,0,5,2,-1,!1]],processABCNotes(n,"0"),expect(n.notationNotes[0]).toContain("(")}),it("should handle closing parenthesis in notation staging",function(){n.notation.notationStaging[0]=[[["C4"],4,0,3,2,-1,!1],[["D4"],4,0,3,2,-1,!1],[["E4"],4,0,3,2,-1,!1],")"],processABCNotes(n,"0"),expect(n.notationNotes[0]).not.toBe("")}),it("should handle chords with multiple notes outside tuplets",function(){n.notation.notationStaging[0]=[[["C4","E4","G4"],4,0,null,null,-1,!1]],processABCNotes(n,"0");var t=n.notationNotes[0];expect(t).toContain("["),expect(t).toContain("]")}),it("should handle dots when closing chords",function(){n.notation.notationStaging[0]=[[["C4"],4,2,null,null,456,!1],[["E4"],4,2,null,null,456,!1],[["G4"],4,0,null,null,-1,!1]],processABCNotes(n,"0"),expect(n.notationNotes[0]).toContain(" ")})}),describe("saveAbcOutput",function(){var n;beforeEach(function(){n={logo:{notationOutput:"",notationNotes:{0:""},notation:{notationStaging:{0:[[["G♯4"],4,0,null,null,-1,!1]]}}},turtles:{ithTurtle:function(t){return{singer:{keySignature:"C major"}}}}}}),it("should generate the correct ABC notation output with key signature replacements",function(){n.turtles.ithTurtle=function(){return{singer:{keySignature:"B ♭ major"}}};var t=saveAbcOutput(n);expect(t).toContain("K:Bb MAJOR"),expect(t).toContain("b")})}),describe("processABCNotes - Tuplet Handling",function(){it("should process tuplets correctly",function(){var t={notationNotes:{0:""},notation:{notationStaging:{0:[[["G♯4"],4,0,3,2,-1,!1],[["F4"],4,0,3,2,-1,!1],[["G♯4"],4,0,3,2,-1,!1]]}}};processABCNotes(t,"0"),expect(t.notationNotes[0]).toBe("(1:1G^ 2G^ 2G^ 2 ")})}),describe("OCTAVE_NOTATION_MAP",function(){it("should correctly map octaves to ABC notation",function(){expect(OCTAVE_NOTATION_MAP[10]).toBe("'''''"),expect(OCTAVE_NOTATION_MAP[2]).toBe(",,"),expect(OCTAVE_NOTATION_MAP[1]).toBe(",,,"),expect(OCTAVE_NOTATION_MAP[0]).toBeUndefined()})}),describe("ACCIDENTAL_MAP",function(){test("should correctly map accidentals to ABC notation",function(){expect(ACCIDENTAL_MAP["♯"]).toBe("^"),expect(ACCIDENTAL_MAP["♭"]).toBe("_")}),test("should return undefined for unmapped accidentals",function(){expect(ACCIDENTAL_MAP["♮"]).toBeUndefined()})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var fs=require("fs"),path=require("path"),vm=require("vm");describe("Activity Event Listener Management",function(){var n,t,r,e;beforeAll(function(){var e=path.resolve(__dirname,"../activity.js"),e=fs.readFileSync(e,"utf8"),t=e.indexOf("const activity = new Activity();"),t=(e=(e=-1!==t?e.substring(0,t):e).replace(/constructor\s*\(\)\s*\{/,"constructor() { this._listeners = []; return;"),{window:global.window,document:global.document,console:global.console,_:function(e){return e},define:function(){},require:function(){},setTimeout:setTimeout,createjs:{},Turtles:_createClass(function e(){_classCallCheck(this,e)}),Palettes:_createClass(function e(){_classCallCheck(this,e)}),Blocks:_createClass(function e(){_classCallCheck(this,e)}),Logo:_createClass(function e(){_classCallCheck(this,e)}),LanguageBox:_createClass(function e(){_classCallCheck(this,e)}),ThemeBox:_createClass(function e(){_classCallCheck(this,e)}),SaveInterface:_createClass(function e(){_classCallCheck(this,e)}),StatsWindow:_createClass(function e(){_classCallCheck(this,e)}),Trashcan:_createClass(function e(){_classCallCheck(this,e)}),PasteBox:_createClass(function e(){_classCallCheck(this,e)}),HelpWidget:_createClass(function e(){_classCallCheck(this,e)}),globalActivity:null,_THIS_IS_MUSIC_BLOCKS_:!0,LEADING:0,MYDEFINES:[]});e+="\n this.Activity = Activity;",vm.createContext(t);try{vm.runInContext(e,t)}catch(e){console.error("VM Execution Error:",e)}n=t.Activity}),beforeEach(function(){if(!n)throw console.error("Activity class not loaded"),new Error("Could not load Activity class");n.prototype.prepSearchWidget;n.prototype.prepSearchWidget=function(){},n.prototype._create2Ddrag=function(){},n.prototype._createDrag=function(){},t=new n,r=document.createElement("div"),e=jest.fn()}),afterEach(function(){t.cleanupEventListeners()}),test("should track listeners when added",function(){t.addEventListener(r,"click",e),expect(t._listeners).toHaveLength(1),expect(t._listeners[0]).toEqual(expect.objectContaining({target:r,type:"click",listener:e}))}),test("should remove listeners from tracking when removed",function(){t.addEventListener(r,"click",e),t.removeEventListener(r,"click",e),expect(t._listeners).toHaveLength(0)}),test("should handle object options in removeEventListener (robust equality)",function(){t.addEventListener(r,"click",e,{capture:!0}),t.removeEventListener(r,"click",e,{capture:!0}),expect(t._listeners).toHaveLength(0)}),test("should clean up all listeners",function(){var e=jest.fn();t.addEventListener(r,"click",e),t.cleanupEventListeners(),expect(t._listeners).toHaveLength(0)}),test("should handle boolean options vs object options",function(){t.addEventListener(r,"click",e,!0),t.removeEventListener(r,"click",e,{capture:!0}),expect(t._listeners).toHaveLength(0)})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}global._THIS_IS_TURTLE_BLOCKS_=!0;var _require=require("../artwork"),showMaterialHighlight=_require.showMaterialHighlight,hideButtonHighlight=_require.hideButtonHighlight,hidePaletteNameDisplay=_require.hidePaletteNameDisplay,COLLAPSEBUTTONXOFF=_require.COLLAPSEBUTTONXOFF,STANDARDBLOCKHEIGHT=_require.STANDARDBLOCKHEIGHT,FILLCOLORS=_require.FILLCOLORS,TURTLESVG=_require.TURTLESVG;global.createjs={Shape:jest.fn(function(){return{graphics:{f:jest.fn().mockReturnThis(),drawCircle:jest.fn().mockReturnThis()},alpha:0,x:0,y:0}}),Tween:{get:jest.fn(function(){return{to:jest.fn().mockReturnThis()}})},Ease:{circInOut:jest.fn()}},describe("artwork.js Test Suite",function(){var t;beforeEach(function(){t={addChild:jest.fn(),removeChild:jest.fn()}}),test("showMaterialHighlight creates highlight and active shapes",function(){var e=showMaterialHighlight(50,50,10,{rawX:100,rawY:100},1,t);expect(e).toHaveProperty("highlight"),expect(e).toHaveProperty("active"),expect(t.addChild).toHaveBeenCalledWith(e.highlight,e.active)}),test("hideButtonHighlight removes highlight properly",function(){jest.useFakeTimers();var e={highlight:{},active:{}};hideButtonHighlight(e,t),jest.runAllTimers(),expect(t.removeChild).toHaveBeenCalledWith(e.active,e.highlight),jest.useRealTimers()}),test("hidePaletteNameDisplay removes palette text after delay",function(){jest.useFakeTimers();var e={};hidePaletteNameDisplay(e,t),jest.runAllTimers(),expect(t.removeChild).toHaveBeenCalledWith(e),jest.useRealTimers()}),test("Constants are correctly defined",function(){expect(_typeof(COLLAPSEBUTTONXOFF)).toBe("number"),expect(_typeof(STANDARDBLOCKHEIGHT)).toBe("number"),expect(Array.isArray(FILLCOLORS)).toBe(!0),expect(_typeof(TURTLESVG)).toBe("string")})});
describe("Browser Action Behavior",function(){var n,t,e,i;beforeEach(function(){e=window.open,i=jest.fn(),window.open=i,n={browserAction:{onClicked:{addListener:jest.fn(function(e){n.browserAction.onClicked.callback=e})}},tabs:{create:jest.fn()},runtime:{onInstalled:{addListener:jest.fn(function(e){n.runtime.onInstalled.callback=e})}}},t={browserAction:{onClicked:{addListener:jest.fn(function(e){t.browserAction.onClicked.callback=e})}},runtime:{onInstalled:{addListener:jest.fn(function(e){t.runtime.onInstalled.callback=e})},getURL:jest.fn(function(e){return"chrome-extension://fake-id/".concat(e)})}},global.browser=n,global.chrome=t,Object.defineProperty(global.navigator,"userAgent",{writable:!0,value:""})}),afterEach(function(){jest.clearAllMocks(),delete global.browser,delete global.chrome,window.open=e}),it("should set up Firefox-specific listeners when user agent is Firefox",function(){navigator.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0",jest.resetModules();var e=require("../background.js"),e=e.isFirefox;expect(e).toBe(!0),expect(n.browserAction.onClicked.addListener).toHaveBeenCalledTimes(1),expect(n.runtime.onInstalled.addListener).toHaveBeenCalledTimes(1)}),it("should set up Chrome-specific listeners when user agent is not Firefox",function(){navigator.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36",jest.resetModules();var e=require("../background.js"),e=e.isFirefox;expect(e).toBe(!1),expect(t.browserAction.onClicked.addListener).toHaveBeenCalledTimes(1),expect(t.runtime.onInstalled.addListener).toHaveBeenCalledTimes(1)}),it("should create a new tab with index.html when browserAction is clicked in Firefox",function(){navigator.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0",jest.resetModules(),require("../background.js"),n.browserAction.onClicked.callback({id:"tab-123"}),expect(n.tabs.create).toHaveBeenCalledWith({url:"index.html"})}),it("should create a new tab with index.html when extension is installed in Firefox",function(){navigator.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0",jest.resetModules(),require("../background.js"),n.runtime.onInstalled.callback({reason:"install"}),expect(n.tabs.create).toHaveBeenCalledWith({url:"index.html"})}),it("should open index.html in a new window when browserAction is clicked in Chrome",function(){navigator.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36",jest.resetModules(),require("../background.js"),t.browserAction.onClicked.callback({id:"tab-123"}),expect(window.open).toHaveBeenCalledWith("chrome-extension://fake-id/index.html"),expect(t.runtime.getURL).toHaveBeenCalledWith("index.html")}),it("should open index.html in a new window when extension is installed in Chrome",function(){navigator.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36",jest.resetModules(),require("../background.js"),t.runtime.onInstalled.callback({reason:"install"}),expect(window.open).toHaveBeenCalledWith("chrome-extension://fake-id/index.html"),expect(t.runtime.getURL).toHaveBeenCalledWith("index.html")}),it("should properly export module values for Node.js environment",function(){navigator.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0",jest.resetModules();var e=require("../background.js"),e=(expect(e.isFirefox).toBe(!0),expect(e.browserAction).toBe(n.browserAction),navigator.userAgent="Chrome",jest.resetModules(),require("../background.js"));expect(e.isFirefox).toBe(!1),expect(e.browserAction).toBe(t.browserAction)})});
var base64Utils=require("../base64Utils");global.TextEncoder=require("util").TextEncoder,global.TextDecoder=require("util").TextDecoder,describe("base64Utils",function(){test("base64Encode should correctly encode a string to Base64",function(){expect(base64Utils.base64Encode("hello")).toBe("aGVsbG8="),expect(base64Utils.base64Encode("Base64 Encoding!")).toBe("QmFzZTY0IEVuY29kaW5nIQ=="),expect(base64Utils.base64Encode("123456")).toBe("MTIzNDU2")}),test("base64Decode should correctly decode a Base64 string",function(){expect(base64Utils.base64Decode("aGVsbG8=")).toBe("hello"),expect(base64Utils.base64Decode("QmFzZTY0IEVuY29kaW5nIQ==")).toBe("Base64 Encoding!"),expect(base64Utils.base64Decode("MTIzNDU2")).toBe("123456")}),test("base64Encode and base64Decode should be reversible",function(){var e="Reversible Test!",s=base64Utils.base64Encode(e),s=base64Utils.base64Decode(s);expect(s).toBe(e)}),test("base64Encode should handle empty strings",function(){expect(base64Utils.base64Encode("")).toBe("")}),test("base64Decode should handle empty strings",function(){expect(base64Utils.base64Decode("")).toBe("")})});
var _require=require("../basicblocks"),initBasicProtoBlocks=_require.initBasicProtoBlocks,BACKWARDCOMPATIBILIYDICT=_require.BACKWARDCOMPATIBILIYDICT,mockActivity={blocks:{palettes:{},protoBlockDict:{block1:{palette:{add:jest.fn()}},block2:{palette:{add:jest.fn()}},blockWithoutPalette:{}}},palettes:{}},setupFunctions=["setupRhythmBlockPaletteBlocks","setupRhythmBlocks","setupMeterBlocks","setupPitchBlocks","setupIntervalsBlocks","setupToneBlocks","setupOrnamentBlocks","setupVolumeBlocks","setupDrumBlocks","setupWidgetBlocks","setupFlowBlocks","setupNumberBlocks","setupActionBlocks","setupBoxesBlocks","setupBooleanBlocks","setupHeapBlocks","setupDictBlocks","setupExtrasBlocks","setupProgramBlocks","setupGraphicsBlocks","setupPenBlocks","setupMediaBlocks","setupSensorsBlocks","setupEnsembleBlocks"];setupFunctions.forEach(function(t){global[t]=jest.fn()}),describe("initBasicProtoBlocks",function(){beforeEach(function(){jest.clearAllMocks()}),it("should assign palettes to activity.blocks.palettes",function(){initBasicProtoBlocks(mockActivity),expect(mockActivity.blocks.palettes).toBe(mockActivity.palettes)}),it("should call all setup functions with activity",function(){initBasicProtoBlocks(mockActivity),setupFunctions.forEach(function(t){expect(global[t]).toHaveBeenCalledWith(mockActivity)})}),it("should add blocks with palettes to their respective palettes",function(){initBasicProtoBlocks(mockActivity),expect(mockActivity.blocks.protoBlockDict.block1.palette.add).toHaveBeenCalledWith(mockActivity.blocks.protoBlockDict.block1),expect(mockActivity.blocks.protoBlockDict.block2.palette.add).toHaveBeenCalledWith(mockActivity.blocks.protoBlockDict.block2),expect(mockActivity.blocks.protoBlockDict.blockWithoutPalette.palette).toBeUndefined()})}),describe("BACKWARDCOMPATIBILIYDICT",function(){it("should be defined and not empty",function(){expect(BACKWARDCOMPATIBILIYDICT).toBeDefined(),expect(Object.keys(BACKWARDCOMPATIBILIYDICT).length).toBeGreaterThan(0)}),it("should correctly map old block names to new block names",function(){expect(BACKWARDCOMPATIBILIYDICT.fullscreen).toBe("vspace"),expect(BACKWARDCOMPATIBILIYDICT.seth).toBe("setheading"),expect(BACKWARDCOMPATIBILIYDICT.random2).toBe("random")})});
var _require=require("../blockfactory"),SVG=_require.SVG,_require2=require("../utils/platformstyle"),platformColor=_require2.platformColor;global.platformColor=platformColor,jest.mock("../utils/platformstyle",function(){return{platformColor:{header:"#FFFFFF"}}}),describe("SVG Class",function(){var e;beforeEach(function(){e=new SVG,SVG.prototype._calc_porch_params=jest.fn()}),describe("Constructor",function(){it("should initialize with default values",function(){expect(e._x).toBe(0),expect(e._y).toBe(0),expect(e._width).toBe(0),expect(e._height).toBe(0),expect(e._scale).toBe(1),expect(e._fill).toBe("fill_color"),expect(e._stroke).toBe("stroke_color")})}),describe("Attribute Methods",function(){it("should set font size correctly",function(){e.setFontSize(14),expect(e._fontSize).toBe(14)}),it("should set label offset correctly",function(){e.setLabelOffset(5),expect(e._labelOffset).toBe(5)}),it("should enable or disable drawing innies",function(){e.setDrawInniess(!1),expect(e._draw_inniess).toBe(!1)}),it("should return width and height",function(){expect(e.getWidth()).toBe(0),expect(e.getHeight()).toBe(0)}),it("should clear docks",function(){e.docks=[[10,20]],e.clearDocks(),expect(e.docks).toEqual([])}),it("should set scale",function(){e.setScale(2),expect(e._scale).toBe(2)}),it("should set orientation",function(){e.setOrientation(45),expect(e._orientation).toBe(45)}),it("should set clamp count",function(){e.setClampCount(3),expect(e._clampCount).toBe(3),expect(e._clampSlots.length).toBe(3)}),it("should set clamp slots",function(){e.setClampSlots(1,5),expect(e._clampSlots[1]).toBe(5)}),it("should set expand dimensions",function(){e.setExpand(100,50,30,20),expect(e._expandX).toBe(100),expect(e._expandY).toBe(50),expect(e._expandX2).toBe(30),expect(e._expandY2).toBe(20)}),it("should set stroke width",function(){e.setstrokeWidth(2),expect(e._strokeWidth).toBe(2)}),it("should set colors",function(){e.setColors(["red","blue"]),expect(e._fill).toBe("red"),expect(e._stroke).toBe("blue")}),it("should set fill color",function(){e.setFillColor("green"),expect(e._fill).toBe("green")}),it("should set stroke color",function(){e.setStrokeColor("black"),expect(e._stroke).toBe("black")}),it("should set innies",function(){e.setInnies([!0,!1,!0]),expect(e._innies).toEqual([!0,!1,!0])}),it("should set outie",function(){e.setOutie(!0),expect(e._outie).toBe(!0)}),it("should set slot",function(){e.setSlot(!1),expect(e._slot).toBe(!1),expect(e._cap).toBe(!1)}),it("should set cap",function(){e.setCap(!0),expect(e._cap).toBe(!0),expect(e._slot).toBe(!1)}),it("should set tab",function(){e.setTab(!0),expect(e._tab).toBe(!0),expect(e._tail).toBe(!1)}),it("should set tail",function(){e.setTail(!0),expect(e._tail).toBe(!0),expect(e._tab).toBe(!1)}),it("should set porch",function(){e.setPorch(!0),expect(e._porch).toBe(!0)}),it("should set boolean",function(){e.setBoolean(!0),expect(e._bool).toBe(!0)}),it("should set else",function(){e.setElse(!0),expect(e._else).toBe(!0)}),it("should set arm",function(){e.setArm(!0),expect(e._arm).toBe(!0)})}),describe("SVG Block Generation Methods",function(){it("should generate basic block SVG",function(){var t=e.basicBlock();expect(t).toContain("<svg"),expect(t).toContain("</svg>")}),it("should generate basic box SVG",function(){var t=e.basicBox();expect(t).toContain("<svg"),expect(t).toContain("</svg>")}),it("should generate boolean and-or block SVG",function(){var t=e.booleanAndOr();expect(t).toContain("<svg"),expect(t).toContain("</svg>")}),it("should generate boolean not block SVG",function(){var t=e.booleanNot(!1);expect(t).toContain("<svg"),expect(t).toContain("</svg>")}),it("should generate boolean compare block SVG",function(){var t=e.booleanCompare();expect(t).toContain("<svg"),expect(t).toContain("</svg>")}),it("should generate basic clamp block SVG",function(){var t=e.basicClamp();expect(t).toContain("<svg"),expect(t).toContain("</svg>")}),it("should generate arg clamp block SVG",function(){var t=e.argClamp();expect(t).toContain("<svg"),expect(t).toContain("</svg>")}),it("should generate until clamp block SVG",function(){var t=e.untilClamp();expect(t).toContain("<svg"),expect(t).toContain("</svg>")}),it("should generate status block SVG",function(){var t=e.statusBlock();expect(t).toContain("<svg"),expect(t).toContain("</svg>")})})});
global.base64Encode=jest.fn(function(e){return e}),global.createjs={Container:jest.fn(function(){return{children:[],addChild:jest.fn(),removeChild:jest.fn(),visible:!0}}),Bitmap:jest.fn()},global.window={btoa:jest.fn(function(e){return Buffer.from(e).toString("base64")})},global.BOUNDARY='\n<svg xmlns="http://www.w3.org/2000/svg" width="WIDTH" height="HEIGHT">\n    <rect x="X" y="Y" width="DX" height="DY" stroke="stroke_color" fill="none" stroke-width="2"/>\n</svg>\n';var Boundary=require("../boundary");describe("Boundary Class",function(){var e,n;beforeEach(function(){e={addChild:jest.fn(),setChildIndex:jest.fn()},n=new Boundary(e)}),afterEach(function(){jest.clearAllMocks()}),it("should initialize with a container and add it to the stage",function(){expect(e.addChild).toHaveBeenCalledWith(n._container),expect(e.setChildIndex).toHaveBeenCalledWith(n._container,0)}),it("should call create and destroy methods when setting scale",function(){var e=jest.spyOn(n,"create"),t=jest.spyOn(n,"destroy");n.setScale(800,600,2),expect(t).toHaveBeenCalled(),expect(e).toHaveBeenCalledWith(800,600,2)}),it("should correctly determine if a point is off-screen",function(){n.create(800,600,2),expect(n.offScreen(50,50)).toBe(!0),expect(n.offScreen(n.x+1,n.y+1)).toBe(!1),expect(n.offScreen(n.x+n.dx+1,n.y+n.dy+1)).toBe(!0)}),it("should hide and show the container",function(){n.hide(),expect(n._container.visible).toBe(!1),n.show(),expect(n._container.visible).toBe(!0)}),it("should destroy the first child in the container",function(){var e={};n._container.children.push(e),n.destroy(),expect(n._container.removeChild).toHaveBeenCalledWith(e)}),it("should create a boundary with the correct dimensions and add it to the container",function(){var e={onload:null,src:""},t=jest.spyOn(global,"Image").mockImplementation(function(){return e});n.create(800,600,2),expect(e.onload).not.toBeNull(),expect(e.src).toContain("data:image/svg+xml;base64,"),t.mockRestore()})});
var LanguageBox=require("../languagebox"),mockActivity={storage:{languagePreference:"enUS",kanaPreference:null},textMsg:jest.fn()};Object.defineProperty(global,"localStorage",{value:{getItem:jest.fn(),setItem:jest.fn()},writable:!0}),document.querySelectorAll=jest.fn(function(){return[]}),global._=jest.fn(function(e){return e}),describe("LanguageBox Class",function(){var t;beforeEach(function(){jest.clearAllMocks(),t=new LanguageBox(mockActivity)}),it("should reload the window when OnClick is called",function(){var e=jest.spyOn(t,"reload").mockImplementation();t.OnClick(),expect(e).toHaveBeenCalled()}),it("should display 'already set' message when the selected language is the same",function(){localStorage.getItem.mockReturnValue("enUS"),mockActivity.textMsg.mockImplementation(),t._language="enUS",t.hide(),expect(mockActivity.textMsg).toHaveBeenCalledWith("Music Blocks is already set to this language.")}),it("should display the refresh message when a new language is selected",function(){localStorage.getItem.mockReturnValue("ja"),mockActivity.textMsg.mockImplementation(),t._language="enUS",t.hide(),expect(mockActivity.textMsg).toHaveBeenCalledWith(expect.stringContaining("Refresh your browser to change your language preference."))}),it("should display the correct message when hide is called for 'ja'",function(){localStorage.getItem.mockReturnValue("enUS"),mockActivity.textMsg.mockImplementation(),t._language="ja",t.hide(),expect(mockActivity.textMsg).toHaveBeenCalledWith(expect.stringContaining("言語を変えるには、ブラウザをこうしんしてください。"))}),it("should attach click listeners to language links when hide is called",function(){var e=[{addEventListener:jest.fn()},{addEventListener:jest.fn()}];document.querySelectorAll.mockReturnValue(e),t.hide(),e.forEach(function(e){expect(e.addEventListener).toHaveBeenCalledWith("click",expect.any(Function))})}),describe("Language selection methods",function(){it("should set language to enUS and call hide when enUS_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.enUS_onclick(),expect(t._language).toBe("enUS"),expect(e).toHaveBeenCalled()}),it("should set language to enUK and call hide when enUK_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.enUK_onclick(),expect(t._language).toBe("enUK"),expect(e).toHaveBeenCalled()}),it("should set language to ko and call hide when ko_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.ko_onclick(),expect(t._language).toBe("ko"),expect(e).toHaveBeenCalled()}),it("should set language to ja, set kanji preference, and call hide when ja_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.ja_onclick(),expect(t._language).toBe("ja-kanji"),expect(mockActivity.storage.kanaPreference).toBe("kanji"),expect(e).toHaveBeenCalled()}),it("should set language to ja, set kana preference, and call hide when kana_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.kana_onclick(),expect(t._language).toBe("ja-kana"),expect(mockActivity.storage.kanaPreference).toBe("kana"),expect(e).toHaveBeenCalled()}),it("should set language to es and call hide when es_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.es_onclick(),expect(t._language).toBe("es"),expect(e).toHaveBeenCalled()}),it("should set language to pt and call hide when pt_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.pt_onclick(),expect(t._language).toBe("pt"),expect(e).toHaveBeenCalled()}),it("should set language to zh_CN and call hide when zhCN_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.zhCN_onclick(),expect(t._language).toBe("zh_CN"),expect(e).toHaveBeenCalled()}),it("should set language to th and call hide when th_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.th_onclick(),expect(t._language).toBe("th"),expect(e).toHaveBeenCalled()}),it("should set language to hi and call hide when hi_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.hi_onclick(),expect(t._language).toBe("hi"),expect(e).toHaveBeenCalled()}),it("should set language to ibo and call hide when ibo_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.ibo_onclick(),expect(t._language).toBe("ibo"),expect(e).toHaveBeenCalled()}),it("should set language to ar and call hide when ar_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.ar_onclick(),expect(t._language).toBe("ar"),expect(e).toHaveBeenCalled()}),it("should set language to he and call hide when he_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.he_onclick(),expect(t._language).toBe("he"),expect(e).toHaveBeenCalled()}),it("should set language to te and call hide when te_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.te_onclick(),expect(t._language).toBe("te"),expect(e).toHaveBeenCalled()}),it("should set language to ayc and call hide when ayc_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.ayc_onclick(),expect(t._language).toBe("ayc"),expect(e).toHaveBeenCalled()}),it("should set language to quz and call hide when quz_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.quz_onclick(),expect(t._language).toBe("quz"),expect(e).toHaveBeenCalled()}),it("should set language to gug and call hide when gug_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.gug_onclick(),expect(t._language).toBe("gug"),expect(e).toHaveBeenCalled()}),it("should set language to ur and call hide when ur_onclick is called",function(){var e=jest.spyOn(t,"hide").mockImplementation();t.ur_onclick(),expect(t._language).toBe("ur"),expect(e).toHaveBeenCalled()})}),describe("Japanese kana handling",function(){it("should display kana message when Japanese language is selected with kana preference",function(){localStorage.getItem.mockReturnValue("enUS"),mockActivity.storage.kanaPreference="kana",mockActivity.textMsg.mockImplementation(),t._language="ja",t.hide(),expect(mockActivity.textMsg).toHaveBeenCalledWith(expect.stringContaining("げんごを かえるには、ブラウザを こうしんしてください。"))})})});
function _defineProperty(t,o,n){return(o=_toPropertyKey(o))in t?Object.defineProperty(t,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[o]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,o){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===o?String:Number)(t);n=n.call(t,o||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var frequencyToPitch=jest.fn(function(t){return["C","4"]}),getScaleAndHalfSteps=jest.fn(function(){return[["C","D","E","F","G","A","B"],["","","","","","",""]]}),toFraction=jest.fn(function(t){return[t,1]}),NOTATIONDURATION=1,NOTATIONNOTE=0,NOTATIONROUNDDOWN=2,NOTATIONSTACCATO=6,NOTATIONTUPLETVALUE=3,NOTATIONDOTCOUNT=4,_require=(global.frequencyToPitch=frequencyToPitch,global.getScaleAndHalfSteps=getScaleAndHalfSteps,global.toFraction=toFraction,global.NOTATIONDURATION=NOTATIONDURATION,global.NOTATIONNOTE=NOTATIONNOTE,global.NOTATIONROUNDDOWN=NOTATIONROUNDDOWN,global.NOTATIONSTACCATO=NOTATIONSTACCATO,global.NOTATIONTUPLETVALUE=NOTATIONTUPLETVALUE,global.NOTATIONDOTCOUNT=NOTATIONDOTCOUNT,global.SHARP="♯",global.FLAT="♭",global.NATURAL="♮",global.DOUBLESHARP="𝄪",global.DOUBLEFLAT="𝄫",global._=jest.fn(function(t){return t}),global.last=jest.fn(function(t){return t[t.length-1]}),require("../lilypond")),getLilypondHeader=_require.getLilypondHeader,processLilypondNotes=_require.processLilypondNotes,saveLilypondOutput=_require.saveLilypondOutput;describe("getLilypondHeader",function(){test("should return the LilyPond header as a string",function(){var t=getLilypondHeader();expect(_typeof(t)).toBe("string"),expect(t).toContain('\\version "2.18.2"'),expect(t).toContain("Made with LilyPond and Music Blocks"),expect(t).toContain("Creative Commons Attribution ShareAlike 3.0")})}),describe("processLilypondNotes",function(){var n,e,i;beforeEach(function(){n={notationNotes:_defineProperty({},e="0","0"),notation:{notationStaging:_defineProperty({},e,[[["G4"],4,0,null,0,-1,!1],"meter",4,4])}},i=""}),test('should initialize notationNotes with "\\meter\n" and process staging commands',function(){processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\meter\n"),expect(n.notationNotes[e]).toContain(" \\time 4/4\n")}),test("should process a note object correctly",function(){n.notation.notationStaging[e]=[[["G4"],4,0,null,0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\meter\ng'4 "),expect(n.notationNotes[e]).toContain("4")}),test("should process a key signature correctly",function(){n.notation.notationStaging[e]=["key","C","major"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\key c \\major")}),test("should process a tempo change correctly",function(){n.notation.notationStaging[e]=["tempo",120,"Allegro"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tempo Allegro = 120")}),test("should process a slur correctly",function(){n.notation.notationStaging[e]=["begin slur",[["G4"],4,0,null,0,-1,!1],"end slur"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\meter\ng'4 (  )  ")}),test("should process a crescendo correctly",function(){n.notation.notationStaging[e]=["begin crescendo",[["G4"],4,0,null,0,-1,!1],"end crescendo"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\meter\n  g'4 \\< \\! ")}),test("should process a decrescendo correctly",function(){n.notation.notationStaging[e]=["begin decrescendo",[["G4"],4,0,null,0,-1,!1],"end decrescendo"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\meter\n  g'4 \\> \\! ")}),test("should process a tuplet correctly",function(){n.notation.notationStaging[e]=[[["G4"],4,0,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\meter\n\\tuplet Infinity/1 { g' 0} ")}),test("should process a markup command correctly",function(){n.notation.notationStaging[e]=["markup","Test Markup"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("^\\markup { \\abs-fontsize #6 { Test Markup } } ")}),test("should process a markdown command correctly",function(){n.notation.notationStaging[e]=["markdown","Test Markdown"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("_\\markup { Test Markdown } ")}),test("should process a break command correctly",function(){n.notation.notationStaging[e]=[[["G4"],4,0,null,0,-1,!1],"break",[["E4"],4,0,null,0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\n")}),test("should process articulation commands correctly",function(){n.notation.notationStaging[e]=["begin articulation",[["G4"],4,0,null,0,-1,!1],"end articulation"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("->")}),test("should process a pickup command correctly",function(){n.notation.notationStaging[e]=["pickup",4,[["G4"],4,0,null,0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\partial 4\n")}),test("should process voice commands correctly",function(){n.notation.notationStaging[e]=["voice one",[["G4"],4,0,null,0,-1,!1],"voice two",[["E4"],4,0,null,0,-1,!1],"one voice"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("<< { \\voiceOne "),expect(n.notationNotes[e]).toContain("}\n\\new Voice { \\voiceTwo "),expect(n.notationNotes[e]).toContain("}\n>> \\oneVoice\n")}),test("should process a tie command correctly",function(){n.notation.notationStaging[e]=["tie"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("~")}),test("should append unrecognized command as is",function(){n.notation.notationStaging[e]=["unrecognized"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("unrecognized")}),test("should process note object with dot notation",function(){n.notation.notationStaging[e]=[[["G4"],4,0,null,2,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("4..")}),test("should process note object with staccato",function(){n.notation.notationStaging[e]=[[["G4"],4,0,null,0,-1,!0]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\staccato ")}),test("should process custom key modes (freygish) correctly",function(){getScaleAndHalfSteps.mockReturnValueOnce([["C","D","E","F","G","A","B"],["","♭","","","","♭",""]]),n.notation.notationStaging[e]=["key","C","myCustomMode"],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\myCustomMode")}),test("should insert newline after 8 notes",function(){for(var t=[],o=0;o<9;o++)t.push([["G4"],4,0,null,0,-1,!1]);n.notation.notationStaging[e]=t,processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\n")}),test("should handle incomplete tuplet gracefully",function(){n.notation.notationStaging[e]=[[["G4"],4,0,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet")}),test("should handle tuplet with non-integer fraction",function(){toFraction.mockReturnValueOnce([3.5,2]).mockReturnValueOnce([7,4]),n.notation.notationStaging[e]=[[["G4"],4,0,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet 7/4")}),test("should process chord with multiple notes correctly",function(){n.notation.notationStaging[e]=[[["G4","B4","D5"],4,0,null,0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("<"),expect(n.notationNotes[e]).toContain(">"),expect(n.notationNotes[e]).toContain("g'"),expect(n.notationNotes[e]).toContain("b'")}),test("should handle tuplet with notes of varying durations",function(){n.notation.notationStaging[e]=[[["G4"],8,4,[3,2],0,-1,!1],[["A4"],4,2,[3,2],0,-1,!1],[["B4"],8,4,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet")}),test("should handle tuplet with varying tuplet factors",function(){n.notation.notationStaging[e]=[[["G4"],4,2,[3,4],0,-1,!1],[["A4"],4,2,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet")}),test("should handle tie command within tuplet",function(){n.notation.notationStaging[e]=[[["G4"],4,2,[3,2],0,-1,!1],"tie",[["A4"],4,2,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("~"),expect(n.notationNotes[e]).toContain("\\tuplet")}),test("should break tuplet when reaching POW2 duration (0.5)",function(){n.notation.notationStaging[e]=[[["G4"],4,2,[3,2],0,-1,!1],[["A4"],4,2,[3,2],0,-1,!1],[["B4"],4,2,[3,2],0,-1,!1],[["C4"],4,0,null,0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet")}),test("should handle null tuplet value interrupting tuplet",function(){n.notation.notationStaging[e]=[[["G4"],4,2,[3,2],0,-1,!1],[["A4"],4,0,null,0,-1,!1],[["B4"],4,2,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet")}),test("should break tuplet when tuplet factor changes",function(){n.notation.notationStaging[e]=[[["G4"],4,2,[3,2],0,-1,!1],[["A4"],4,2,[5,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet")}),test("should handle tuplet with mixed NOTATIONROUNDDOWN values (greater)",function(){n.notation.notationStaging[e]=[[["G4"],4,2,[3,2],0,-1,!1],[["A4"],8,4,[3,2],0,-1,!1],[["B4"],4,2,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet")}),test("should handle tuplet with mixed NOTATIONROUNDDOWN values (less)",function(){n.notation.notationStaging[e]=[[["G4"],4,4,[3,2],0,-1,!1],[["A4"],8,2,[3,2],0,-1,!1],[["B4"],4,4,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet")}),test("should handle tuplet with equal NOTATIONROUNDDOWN values",function(){n.notation.notationStaging[e]=[[["G4"],4,2,[3,2],0,-1,!1],[["A4"],4,2,[3,2],0,-1,!1],[["B4"],4,2,[3,2],0,-1,!1]],processLilypondNotes(i,n,e),expect(n.notationNotes[e]).toContain("\\tuplet")})}),describe("saveLilypondOutput",function(){var o;beforeEach(function(){global.RODENTS=["mouse","brown rat","mole","chipmunk","red squirrel","guinea pig","capybara","coypu","black rat","grey squirrel","flying squirrel","bat"],o={logo:{notation:{notationStaging:{0:[[["G4"],4,0,null,0,-1,!1]],1:[[["E4"],4,0,null,0,-1,!1]]},notationDrumStaging:{}},notationNotes:{},notationOutput:"",guitarOutputHead:"",guitarOutputEnd:"",MIDIOutput:""},turtles:{turtleList:{0:{name:"Turtle 0"},1:{name:"Turtle 1"}},getTurtle:function(t){return this.turtleList[t]}},prepareExport:jest.fn(function(){return JSON.stringify({project:"data"})})}}),test("should generate LilyPond output correctly",function(){var t=saveLilypondOutput(o);expect(t).toContain("% You can change the MIDI instruments below to anything on this list:"),expect(t).toContain("\\score {"),expect(t).toContain("\\layout {}"),expect(t).toContain("% MUSIC BLOCKS CODE"),expect(t).toContain('{"project":"data"}')}),test("should handle drum staging correctly",function(){o.logo.notation.notationDrumStaging={0:[[["C4"],4,0,null,0,-1,!1]]};var t=saveLilypondOutput(o);expect(t).toContain("\\drummode {")}),test("should handle empty drum staging correctly",function(){o.logo.notation.notationDrumStaging={0:[]};var t=saveLilypondOutput(o);expect(t).not.toContain("\\drummode {")}),test("should handle multiple turtles correctly",function(){var t=saveLilypondOutput(o);expect(t).toContain("Turtle0 = {"),expect(t).toContain("Turtle1 = {")}),test("should handle unique short instrument names correctly",function(){o.turtles.turtleList={0:{name:"Turtle 0"},1:{name:"Turtle 1"},2:{name:"Turtle 2"}};var t=saveLilypondOutput(o);expect(t).toContain('shortInstrumentName = "Tu"')}),test("should handle empty notation staging correctly",function(){o.logo.notation.notationStaging={};var t=saveLilypondOutput(o);expect(t).not.toContain('% You can change the MIDI instruments below to anything on this list:\n% (http://lilypond.org/doc/v2.18/documentation/notation/midi-instruments)\n\n\\score {\n <<\n\n >> \\layout {}\n% MUSIC BLOCKS CODE\n% Below is the code for the Music Blocks project that generated this Lilypond file.\n%{\n\n{"project":"data"}\n%}\n\n')}),test("should handle empty notation output correctly",function(){o.logo.notationOutput="";var t=saveLilypondOutput(o);expect(t).toContain("% You can change the MIDI instruments below to anything on this list:")}),test("should fallback to RODENTS names if instrument name is empty",function(){o.turtles.getTurtle=jest.fn(function(t){return{name:""}}),o.turtles.turtleList={0:{}},saveLilypondOutput(o),expect(o.logo.notationOutput).toContain(RODENTS[0])}),test("should handle multiple turtles with different clefs correctly",function(){o.logo.notationNotes={0:"\\note0",1:"\\note1"},o.logo.notation.notationStaging={0:["note"],1:["note"]},clef=["treble","bass_8"],CLEFS=["treble","bass_8"];var t=saveLilypondOutput(o);expect(t).toContain('\\context TabVoice = "Turtle0" \\Turtle0'),expect(t).toContain('shortInstrumentName = "Tu"'),expect(t).toContain("Turtle1Voice = \\new Staff \\with {")}),test("should ensure last turtle adds a bar",function(){o.logo.notationNotes[0]="g'4 ",o.logo.notation.notationStaging[0]=["note"],turtleCount=1;var t=saveLilypondOutput(o);expect(t).toContain(' \\bar "|."')}),test("should correctly handle score block generation",function(){o.logo.notationNotes[0]="\\note0",o.logo.notation.notationStaging[0]=["note"],o.logo.notationNotes[1]="\\note1",o.logo.notation.notationStaging[1]=["note"],CLEFS=["treble","bass_8"];var t=saveLilypondOutput(o);expect(t).toContain("\\score {"),expect(t).toContain("\\layout {}")}),test("should handle music blocks code correctly",function(){o.prepareExport=jest.fn(function(){return'{"musicBlocks": ["block1", "block2"]}'});var t=saveLilypondOutput(o);expect(t).toContain("% MUSIC BLOCKS CODE"),expect(t).toContain('{"musicBlocks": ["block1", "block2"]}')}),test("should handle custom mode definitions correctly",function(){o.logo.notation.notationStaging[0].push("custom mode");var t=saveLilypondOutput(o);expect(t).toContain("custom mode")}),test("should properly format guitar tab output",function(){o.logo.guitarOutputHead="% Guitar Output Head\n",o.logo.guitarOutputEnd="% Guitar Output End\n",o.logo.notationNotes={0:"\\note0"},o.logo.notation.notationStaging={0:["note"]};var t=saveLilypondOutput(o);expect(t).toContain("% Guitar Output Head"),expect(t).toContain("% Guitar Output End")}),test("should handle MIDI output correctly",function(){o.logo.MIDIOutput="% MIDI Output";var t=saveLilypondOutput(o);expect(t).toContain("% MIDI Output")}),test("should handle instrument short name collisions (no spaces)",function(){o.turtles.turtleList={0:{name:"Trumpet"},1:{name:"Trombone"},2:{name:"Tuba"}},o.logo.notation.notationStaging={0:["note"],1:["note"],2:["note"]},frequencyToPitch.mockReturnValue(["C",4]);var t=saveLilypondOutput(o);expect(t).toContain('shortInstrumentName = "Tr"'),expect(t).toContain('instrumentName = "Trombone"')}),test("should handle instrument short name collisions (with spaces)",function(){o.turtles.turtleList={0:{name:"Violin One"},1:{name:"Violin Two"}},o.logo.notation.notationStaging={0:["note"],1:["note"]};var t=saveLilypondOutput(o);expect(t).toContain('shortInstrumentName = "Vi"'),expect(t).toContain('shortInstrumentName = "Vio"')}),test("should map special turtle names (start, numeric) to Rodent names",function(){o.turtles.turtleList={0:{name:"start"},1:{name:"start drum"},2:{name:"2"}},o.logo.notation.notationStaging={0:["note"],1:["note"],2:["note"]};var t=saveLilypondOutput(o);expect(t).toContain('instrumentName = "mouse"'),expect(t).toContain('instrumentName = "mole"')}),test("should select bass_8 clef for very low notes",function(){frequencyToPitch.mockReturnValue(["C",1]),o.logo.notation.notationStaging={0:[[["C1"],4,0,null,0,-1,!1]]};var t=saveLilypondOutput(o);expect(t).toContain('\\clef "bass_8"')}),test("should select bass clef for mid-low notes",function(){frequencyToPitch.mockReturnValue(["C",3]),o.logo.notation.notationStaging={0:[[["C3"],4,0,null,0,-1,!1]]};var t=saveLilypondOutput(o);expect(t).toContain('\\clef "bass"')}),test("should handle rest notes in octave calculation",function(){o.logo.notation.notationStaging={0:[[["R"],4,0,null,0,-1,!1]]};var t=saveLilypondOutput(o);expect(t).toBeDefined()}),test("should handle numeric frequency in octave calculation",function(){frequencyToPitch.mockReturnValue(["A",4]),o.logo.notation.notationStaging={0:[[[440],4,0,null,0,-1,!1]]};var t=saveLilypondOutput(o);expect(t).toBeDefined(),expect(frequencyToPitch).toHaveBeenCalledWith(440)}),test("should handle short name collision for names without spaces (longer loop)",function(){o.turtles.turtleList={0:{name:"Trumpet"},1:{name:"Trombone"},2:{name:"Triangle"}},o.logo.notation.notationStaging={0:["note"],1:["note"],2:["note"]};var t=saveLilypondOutput(o);expect(t).toContain('shortInstrumentName = "Tr"'),expect(t).toContain('shortInstrumentName = "Tro"'),expect(t).toContain('shortInstrumentName = "Tri"')})});
function _regenerator(){var p,e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",t=e.toStringTag||"@@toStringTag";function r(e,n,t,r){var o,a,i,c,u,l,s,f,g,n=n&&n.prototype instanceof v?n:v,n=Object.create(n.prototype);return _regeneratorDefine2(n,"_invoke",(o=e,a=t,s=r||[],f=!1,g={p:l=0,n:0,v:p,a:d,f:d.bind(p,4),d:function(e,n){return i=e,c=0,u=p,g.n=n,h}},function(e,n,t){if(1<l)throw TypeError("Generator is already running");for(f&&1===n&&d(n,t),c=n,u=t;(y=c<2?p:u)||!f;){i||(c?c<3?(1<c&&(g.n=-1),d(c,u)):g.n=u:g.v=u);try{if(l=2,i){if(y=i[e=c?e:"next"]){if(!(y=y.call(i,u)))throw TypeError("iterator result is not an object");if(!y.done)return y;u=y.value,c<2&&(c=0)}else 1===c&&(y=i.return)&&y.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+e+"' method"),c=1);i=p}else if((y=(f=g.n<0)?u:o.call(a,g))!==h)break}catch(e){i=p,c=1,u=e}finally{l=1}}return{value:y,done:f}}),!0),n;function d(e,n){for(c=e,u=n,y=0;!f&&l&&!t&&y<s.length;y++){var t,r=s[y],o=g.p,a=r[2];3<e?(t=a===n)&&(u=r[(c=r[4])?5:c=3],r[4]=r[5]=p):r[0]<=o&&((t=e<2&&o<r[1])?(c=0,g.v=n,g.n=r[1]):o<a&&(t=e<3||r[0]>n||a<n)&&(r[4]=e,r[5]=n,g.n=a,c=0))}if(t||1<e)return h;throw f=!0,n}}var h={};function v(){}function o(){}function a(){}var y=Object.getPrototypeOf,e=[][n]?y(y([][n]())):(_regeneratorDefine2(y={},n,function(){return this}),y),i=a.prototype=v.prototype=Object.create(e);function c(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,t,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,t,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,t,"Generator"),_regeneratorDefine2(i,n,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:c}})()}function _regeneratorDefine2(e,n,t,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,n,t,r){function o(n,t){_regeneratorDefine2(e,n,function(e){return this._invoke(n,t,e)})}n?a?a(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(o("next",0),o("throw",1),o("return",2))})(e,n,t,r)}function asyncGeneratorStep(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(n,t){var r=c.apply(e,i);function o(e){asyncGeneratorStep(r,n,t,o,a,"next",e)}function a(e){asyncGeneratorStep(r,n,t,o,a,"throw",e)}o(void 0)})}}describe("loader.js coverage",function(){beforeEach(function(){jest.resetModules(),t=jest.spyOn(console,"error").mockImplementation(function(){}),document.body.innerHTML='\n            <div data-i18n="title">Original Title</div>\n            <span data-i18n="label">Original Label</span>\n        ',c={use:jest.fn().mockReturnThis(),init:jest.fn(),changeLanguage:jest.fn(),t:jest.fn(function(e){return"TRANSLATED_".concat(e)}),on:jest.fn()},u={},n=jest.fn(),(i=jest.fn()).config=n,global.requirejs=i,global.window=document.defaultView}),afterEach(function(){jest.restoreAllMocks()});var i,n,c,u,t,r=(()=>{var e=_asyncToGenerator(_regenerator().m(function e(){var n,t,r,o,a=arguments;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return r=(n=0<a.length&&void 0!==a[0]?a[0]:{}).initError,t=void 0!==r&&r,o=void 0!==(r=n.langError)&&r,i.mockImplementation(function(e,n){return"i18next"===e[0]?(c.init.mockImplementation(function(e,n){n(t?"Init Failed":null)}),c.changeLanguage.mockImplementation(function(e,n){n(o?"Lang Change Failed":null)}),n(c,u)):null}),require("../loader.js"),e.n=1,new Promise(function(e){return process.nextTick(e)});case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}})();test("Configures requirejs correctly",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r();case 1:expect(n).toHaveBeenCalledWith(expect.objectContaining({baseUrl:"lib",paths:expect.any(Object),shim:expect.any(Object)}));case 2:return e.a(2)}},e)}))),test("Full success path: initializes i18n, updates DOM, and loads app",_asyncToGenerator(_regenerator().m(function e(){var n,t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return Object.defineProperty(document,"readyState",{value:"complete",configurable:!0}),e.n=1,r();case 1:expect(c.use).toHaveBeenCalledWith(u),expect(c.init).toHaveBeenCalledWith(expect.objectContaining({lng:"en"}),expect.any(Function)),expect(window.i18next).toBe(c),expect(c.changeLanguage).toHaveBeenCalledWith("en",expect.any(Function)),n=document.querySelector('[data-i18n="title"]'),t=document.querySelector('[data-i18n="label"]'),expect(c.t).toHaveBeenCalledWith("title"),expect(c.t).toHaveBeenCalledWith("label"),expect(n.textContent).toBe("TRANSLATED_title"),expect(t.textContent).toBe("TRANSLATED_label"),expect(c.on).toHaveBeenCalledWith("languageChanged",expect.any(Function)),expect(i).toHaveBeenCalledWith(["utils/utils","activity/activity"]);case 2:return e.a(2)}},e)}))),test("Handles i18next initialization error",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r({initError:!0});case 1:expect(t).toHaveBeenCalledWith("i18next init failed:","Init Failed"),expect(window.i18next).toBe(c);case 2:return e.a(2)}},e)}))),test("Handles changeLanguage error",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r({langError:!0});case 1:expect(t).toHaveBeenCalledWith("Error changing language:","Lang Change Failed");case 2:return e.a(2)}},e)}))),test("Handles DOMContentLoaded when document is loading",_asyncToGenerator(_regenerator().m(function e(){var n,t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return Object.defineProperty(document,"readyState",{value:"loading",configurable:!0}),n=jest.spyOn(document,"addEventListener"),e.n=1,r();case 1:expect(n).toHaveBeenCalledWith("DOMContentLoaded",expect.any(Function)),t=n.mock.calls.find(function(e){return"DOMContentLoaded"===e[0]})[1],c.t.mockClear(),t(),expect(c.t).toHaveBeenCalled();case 2:return e.a(2)}},e)}))),test("Triggering languageChanged event updates content",_asyncToGenerator(_regenerator().m(function e(){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r();case 1:n=c.on.mock.calls.find(function(e){return"languageChanged"===e[0]}),n=n[1],c.t.mockClear(),n(),expect(c.t).toHaveBeenCalled();case 2:return e.a(2)}},e)})))});
global._=function(e){return e},global.Notation=jest.fn().mockImplementation(function(){return{notationStaging:{},notationDrumStaging:{},pickupPoint:{},pickupPOW2:{},doUpdateNotation:jest.fn(),notationInsertTie:jest.fn()}}),global.Synth=jest.fn().mockImplementation(function(){return{newTone:jest.fn(),createDefaultSynth:jest.fn(),loadSynth:jest.fn(),start:jest.fn(),stop:jest.fn(),stopSound:jest.fn(),changeInTemperament:!1,recorder:null}}),global.Singer={setSynthVolume:jest.fn(),setMasterVolume:jest.fn(),masterBPM:90,defaultBPMFactor:1},global.instruments={},global.instrumentsFilters={},global.instrumentsEffects={},global.DEFAULTVOICE="electronic synth",global.StatusMatrix=jest.fn(),global.last=function(e){return e[e.length-1]},global.getIntervalDirection=jest.fn(function(){return 1}),global.getIntervalNumber=jest.fn(function(){return 5}),global.mixedNumber=jest.fn(function(e){return e.toString()}),global.rationalToFraction=jest.fn(function(e){return[1,Math.round(1/e)]}),global.doStopVideoCam=jest.fn(),global.CAMERAVALUE="camera:",global.VIDEOVALUE="video:",global.doUseCamera=jest.fn(),global.delayExecution=jest.fn(function(e,t){return t()}),global.getStatsFromNotation=jest.fn(),global.Tone={UserMedia:jest.fn().mockImplementation(function(){return{open:jest.fn()}})},jest.mock("tone",function(){return{UserMedia:jest.fn().mockImplementation(function(){return{open:jest.fn()}})}});var _require=require("../logo"),Queue=_require.Queue,Logo=_require.Logo,DEFAULTVOLUME=_require.DEFAULTVOLUME,PREVIEWVOLUME=_require.PREVIEWVOLUME,DEFAULTDELAY=_require.DEFAULTDELAY,OSCVOLUMEADJUSTMENT=_require.OSCVOLUMEADJUSTMENT,TONEBPM=_require.TONEBPM,TARGETBPM=_require.TARGETBPM,TURTLESTEP=_require.TURTLESTEP,NOTEDIV=_require.NOTEDIV,NOMICERRORMSG=_require.NOMICERRORMSG,NANERRORMSG=_require.NANERRORMSG,NOSTRINGERRORMSG=_require.NOSTRINGERRORMSG,NOBOXERRORMSG=_require.NOBOXERRORMSG,NOACTIONERRORMSG=_require.NOACTIONERRORMSG,NOINPUTERRORMSG=_require.NOINPUTERRORMSG,NOSQRTERRORMSG=_require.NOSQRTERRORMSG,ZERODIVIDEERRORMSG=_require.ZERODIVIDEERRORMSG,EMPTYHEAPERRORMSG=_require.EMPTYHEAPERRORMSG,POSNUMBER=_require.POSNUMBER;describe("Queue Class",function(){test("constructor initializes all properties correctly",function(){var e=new Queue(1,5,0,["arg1","arg2"]);expect(e.blk).toBe(1),expect(e.count).toBe(5),expect(e.parentBlk).toBe(0),expect(e.args).toEqual(["arg1","arg2"])}),test("constructor handles null arguments",function(){var e=new Queue(null,0,null,null);expect(e.blk).toBeNull(),expect(e.count).toBe(0),expect(e.parentBlk).toBeNull(),expect(e.args).toBeNull()}),test("constructor handles empty array args",function(){var e=new Queue(10,3,5,[]);expect(e.args).toEqual([])})}),describe("Logo Constants",function(){test("DEFAULTVOLUME is 50",function(){expect(DEFAULTVOLUME).toBe(50)}),test("PREVIEWVOLUME is 80",function(){expect(PREVIEWVOLUME).toBe(80)}),test("DEFAULTDELAY is 500",function(){expect(DEFAULTDELAY).toBe(500)}),test("OSCVOLUMEADJUSTMENT is 1.5",function(){expect(OSCVOLUMEADJUSTMENT).toBe(1.5)}),test("TONEBPM is 240",function(){expect(TONEBPM).toBe(240)}),test("TARGETBPM is 90",function(){expect(TARGETBPM).toBe(90)}),test("TURTLESTEP is -1",function(){expect(TURTLESTEP).toBe(-1)}),test("NOTEDIV is 8",function(){expect(NOTEDIV).toBe(8)}),test("Error messages are defined correctly",function(){expect(NOMICERRORMSG).toBe("The microphone is not available."),expect(NANERRORMSG).toBe("Not a number."),expect(NOSTRINGERRORMSG).toBe("Not a string."),expect(NOBOXERRORMSG).toBe("Cannot find box"),expect(NOACTIONERRORMSG).toBe("Cannot find action."),expect(NOINPUTERRORMSG).toBe("Missing argument."),expect(NOSQRTERRORMSG).toBe("Cannot take square root of negative number."),expect(ZERODIVIDEERRORMSG).toBe("Cannot divide by zero."),expect(EMPTYHEAPERRORMSG).toBe("empty heap."),expect(POSNUMBER).toBe("Argument must be a positive number")})}),describe("Logo Class",function(){var n,o;beforeEach(function(){global.instruments={0:{}},global.instrumentsFilters={0:{}},global.instrumentsEffects={0:{}},n={blocks:{blockList:[],findStacks:jest.fn(),stackList:[],unhighlightAll:jest.fn(),bringToTop:jest.fn(),showBlocks:jest.fn(),unhighlight:jest.fn(),visible:!0,clearParameterBlocks:jest.fn(),sameGeneration:jest.fn(function(){return!1})},turtles:{turtleList:[],getTurtleCount:jest.fn(function(){return 1}),turtleCount:jest.fn(function(){return 1}),ithTurtle:jest.fn(function(e){return{singer:{synthVolume:{},backward:[],inDuplicate:!1,notesPlayed:[0,1],pickup:0,noteValuePerBeat:1,beatsPerMeasure:4},listeners:{},parameterQueue:[],initTurtle:jest.fn()}}),getTurtle:jest.fn(function(e){return{painter:{color:50},container:{x:0,y:0},x:0,y:0,running:!1,inTrash:!1,companionTurtle:null,doShowImage:jest.fn(),doShowURL:jest.fn(),doShowText:jest.fn()}}),markAllAsStopped:jest.fn(),add:jest.fn(),addTurtle:jest.fn(),turtleX2screenX:jest.fn(function(e){return e}),turtleY2screenY:jest.fn(function(e){return e})},stage:{removeEventListener:jest.fn(),addEventListener:jest.fn()},onStopTurtle:jest.fn(),onRunTurtle:jest.fn(),meSpeak:{speak:jest.fn()},errorMsg:jest.fn(),saveLocally:jest.fn(),hideMsgs:jest.fn(),showBlocksAfterRun:!1},global.window={widgetWindows:{isOpen:jest.fn(function(){return!1})}},global.document={body:{style:{cursor:"default"}},getElementById:jest.fn(function(){return{style:{color:""}}})},o=new Logo(n)}),describe("Constructor",function(){test("initializes activity reference",function(){expect(o.activity).toBe(n)}),test("initializes default volume-related properties",function(){expect(o.stopTurtle).toBe(!1),expect(o.time).toBe(0),expect(o.firstNoteTime).toBeNull()}),test("initializes widget properties to null/false",function(){expect(o.reflection).toBeNull(),expect(o.phraseMaker).toBeNull(),expect(o.inMatrix).toBe(!1),expect(o.inPitchDrumMatrix).toBe(!1),expect(o.inRhythmRuler).toBe(!1)}),test("initializes empty dictionaries",function(){expect(o.boxes).toEqual({}),expect(o.actions).toEqual({}),expect(o.returns).toEqual({}),expect(o.turtleHeaps).toEqual({}),expect(o.turtleDicts).toEqual({})}),test("initializes notation object",function(){expect(o._notation).toBeDefined()}),test("initializes synth",function(){expect(o.synth).toBeDefined()})}),describe("Setters and Getters",function(){test("onStopTurtle getter and setter work correctly",function(){var e=jest.fn();o.onStopTurtle=e,expect(o.onStopTurtle).toBe(e)}),test("onRunTurtle getter and setter work correctly",function(){var e=jest.fn();o.onRunTurtle=e,expect(o.onRunTurtle).toBe(e)}),test("turtleDelay getter and setter work correctly",function(){o.turtleDelay=100,expect(o.turtleDelay).toBe(100)}),test("notation getter returns notation object",function(){expect(o.notation).toBe(o._notation)})}),describe("setCameraID",function(){test("sets cameraID property",function(){o.setCameraID("camera123"),expect(o.cameraID).toBe("camera123")})}),describe("clearNoteParams",function(){test("clears all note parameters for a turtle",function(){var e={singer:{oscList:{},noteBeat:{},noteBeatValues:{},noteValue:{},notePitches:{},noteOctaves:{},noteCents:{},noteHertz:{},embeddedGraphics:{},noteDrums:{}}};o.clearNoteParams(e,0,null),expect(e.singer.oscList[0]).toEqual([]),expect(e.singer.noteBeat[0]).toEqual([]),expect(e.singer.noteValue[0]).toBeNull(),expect(e.singer.notePitches[0]).toEqual([]),expect(e.singer.noteDrums[0]).toEqual([])}),test("uses provided drums array when not null",function(){var e={singer:{oscList:{},noteBeat:{},noteBeatValues:{},noteValue:{},notePitches:{},noteOctaves:{},noteCents:{},noteHertz:{},embeddedGraphics:{},noteDrums:{}}};o.clearNoteParams(e,0,["kick","snare"]),expect(e.singer.noteDrums[0]).toEqual(["kick","snare"])})}),describe("processSpeak",function(){test("filters text to only valid characters",function(){o.meSpeak={speak:jest.fn()},o.processSpeak("Hello, World! 123"),expect(o.meSpeak.speak).toHaveBeenCalledWith("Hello, World ")}),test("handles empty string",function(){o.meSpeak={speak:jest.fn()},o.processSpeak(""),expect(o.meSpeak.speak).toHaveBeenCalledWith("")})}),describe("setTurtleListener",function(){test("adds event listener to stage",function(){var e=jest.fn();n.turtles.ithTurtle=jest.fn(function(){return{listeners:{}}}),o.setTurtleListener(0,"testListener",e),expect(n.stage.addEventListener).toHaveBeenCalledWith("testListener",e,!1)}),test("removes existing listener before adding new one",function(){var e=jest.fn(),t=jest.fn();n.turtles.ithTurtle=jest.fn(function(){return{listeners:{testListener:e}}}),o.setTurtleListener(0,"testListener",t),expect(n.stage.removeEventListener).toHaveBeenCalledWith("testListener",e,!1)})}),describe("initTurtle",function(){test("initializes connection store for turtle",function(){n.turtles.ithTurtle=jest.fn(function(){return{initTurtle:jest.fn()}}),o.initTurtle(0),expect(o.connectionStore[0]).toEqual({}),expect(o.switchCases[0]).toEqual({}),expect(o.switchBlocks[0]).toEqual([]),expect(o.returns[0]).toEqual([])})}),describe("doStopTurtles",function(){test("sets stopTurtle to true",function(){o.sounds=[],o.synth={stop:jest.fn(),stopSound:jest.fn(),recorder:null},o.doStopTurtles(),expect(o.stopTurtle).toBe(!0)}),test("marks all turtles as stopped",function(){o.sounds=[],o.synth={stop:jest.fn(),stopSound:jest.fn(),recorder:null},o.doStopTurtles(),expect(n.turtles.markAllAsStopped).toHaveBeenCalled()}),test("stops all sounds",function(){var e={stop:jest.fn()};o.sounds=[e],o.synth={stop:jest.fn(),stopSound:jest.fn(),recorder:null},o.doStopTurtles(),expect(e.stop).toHaveBeenCalled(),expect(o.sounds).toEqual([])}),test("clears step queue",function(){o.sounds=[],o.synth={stop:jest.fn(),stopSound:jest.fn(),recorder:null},o.stepQueue={0:[1,2,3]},o.doStopTurtles(),expect(o.stepQueue).toEqual({})})}),describe("step",function(){test("processes step queue for each turtle",function(){o.stepQueue={0:[1]},o._unhighlightStepQueue={0:5},o.runFromBlockNow=jest.fn(),n.blocks.visible=!0,o.step(),expect(n.blocks.unhighlight).toHaveBeenCalledWith(5)}),test("handles empty step queue",function(){o.stepQueue={0:[]},o.runFromBlockNow=jest.fn(),o.step(),expect(o.runFromBlockNow).not.toHaveBeenCalled()})}),describe("_restoreConnections",function(){test("restores broken connections",function(){var e={connections:[null,2]},t={connections:[null]};o.blockList=[e,null,t],o.connectionStore={0:{5:[[0,1,2]]}},o._restoreConnections(),expect(e.connections[1]).toBe(2),expect(t.connections[0]).toBe(0)}),test("handles empty connection store",function(){o.connectionStore={},expect(function(){return o._restoreConnections()}).not.toThrow()})}),describe("doBreak",function(){test("pops from queue when no parent loop found",function(){var e={queue:[{blk:0,parentBlk:1}],parentFlowQueue:[]};o.blockList=[{name:"print"},{name:"print"}],o.doBreak(e),expect(e.queue.length).toBe(0)})})}),describe("Logo parseArg",function(){var t,n;beforeEach(function(){t={blocks:{blockList:[]},turtles:{ithTurtle:jest.fn(function(){return{parameterQueue:[],singer:{noteDirection:0}}})},errorMsg:jest.fn()},n=new Logo(t)}),test("returns null for null block",function(){var e=n.parseArg(n,0,null,0,null);expect(e).toBeNull(),expect(t.errorMsg).toHaveBeenCalled()}),test("handles value blocks",function(){n.blockList=[{name:"number",value:42,protoblock:{parameter:!1},isValueBlock:function(){return!0}}];var e=n.parseArg(n,0,0,null,null);expect(e).toBe(42)}),test("handles interval name blocks",function(){t.turtles.ithTurtle=jest.fn(function(){return{parameterQueue:[],singer:{noteDirection:0}}}),n.blockList=[{name:"intervalname",value:"fifth",protoblock:{parameter:!1},isValueBlock:function(){return!1}}];n.parseArg(n,0,0,null,null);expect(getIntervalNumber).toHaveBeenCalledWith("fifth")})});
var blockIsMacro=require("../macros"),getMacroExpansion=require("../macros");global._=jest.fn(function(o){return o}),describe("blockIsMacro",function(){var o;beforeEach(function(){o={blocks:{protoBlockDict:Object.create(null)}}}),test("should return true if block is in BLOCKISMACRO list",function(){expect(Boolean(blockIsMacro(o,"actionhelp"))).toBe(!0)}),test("should return false if block is neither in protoBlockDict nor BLOCKISMACRO",function(){expect(Boolean(blockIsMacro(o,"nonExistentBlock"))).toBe(!1)})}),describe("getMacroExpansion",function(){var e;beforeEach(function(){e={blocks:{protoBlockDict:{}}}}),test("should return macro expansion from protoBlockDict if macroFunc exists",function(){var o=jest.fn(function(){return[["mockedExpansion"]]});e.blocks.protoBlockDict.customMacro={macroFunc:o},expect(getMacroExpansion(e,"customMacro",10,20)).toEqual([["mockedExpansion"]]),expect(o).toHaveBeenCalledWith(10,20)}),test("should return predefined macro expansion for known blocks",function(){var o=getMacroExpansion(e,"actionhelp",10,20);expect(Array.isArray(o)).toBe(!0),expect(o.length).toBeGreaterThan(0)}),test("should return null for unknown macros",function(){expect(getMacroExpansion(e,"unknownMacro",10,20)).toBeNull()})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var o,i,a,c,u,s,f,l,d,t=t&&t.prototype instanceof b?t:b,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,i=r,f=n||[],l=!1,d={p:s=0,n:0,v:m,a:p,f:p.bind(m,4),d:function(e,t){return a=e,c=0,u=m,d.n=t,y}},function(e,t,r){if(1<s)throw TypeError("Generator is already running");for(l&&1===t&&p(t,r),c=t,u=r;(g=c<2?m:u)||!l;){a||(c?c<3?(1<c&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,a){if(g=a[e=c?e:"next"]){if(!(g=g.call(a,u)))throw TypeError("iterator result is not an object");if(!g.done)return g;u=g.value,c<2&&(c=0)}else 1===c&&(g=a.return)&&g.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+e+"' method"),c=1);a=m}else if((g=(l=d.n<0)?u:o.call(i,d))!==y)break}catch(e){a=m,c=1,u=e}finally{s=1}}return{value:g,done:l}}),!0),t;function p(e,t){for(c=e,u=t,g=0;!l&&s&&!r&&g<f.length;g++){var r,n=f[g],o=d.p,i=n[2];3<e?(r=i===t)&&(u=n[(c=n[4])?5:c=3],n[4]=n[5]=m):n[0]<=o&&((r=e<2&&o<n[1])?(c=0,d.v=t,d.n=n[1]):o<i&&(r=e<3||n[0]>t||i<t)&&(n[4]=e,n[5]=t,d.n=i,c=0))}if(r||1<e)return y;throw l=!0,t}}var y={};function b(){}function o(){}function i(){}var g=Object.getPrototypeOf,e=[][t]?g(g([][t]())):(_regeneratorDefine2(g={},t,function(){return this}),g),a=i.prototype=b.prototype=Object.create(e);function c(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",o.prototype=i),_regeneratorDefine2(i,"constructor",o),_regeneratorDefine2(i,r,o.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,r,"Generator"),_regeneratorDefine2(a,t,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:c}})()}function _regeneratorDefine2(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,t,r,n){function o(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function _asyncToGenerator(c){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=c.apply(e,a);function o(e){asyncGeneratorStep(n,t,r,o,i,"next",e)}function i(e){asyncGeneratorStep(n,t,r,o,i,"throw",e)}o(void 0)})}}var _require=require("../midi"),getClosestStandardNoteValue=_require.getClosestStandardNoteValue,transcribeMidi=_require.transcribeMidi,mockMidi={header:{ppq:480,tempos:[{bpm:120}],timeSignatures:[{timeSignature:[4,4],ticks:0}]},tracks:[{instrument:{name:"acoustic grand piano",family:"piano",number:0,percussion:!1},channel:1,notes:[{name:"C4",midi:60,time:0,duration:.5,velocity:.8},{name:"E4",midi:64,time:.5,duration:.75,velocity:.9},{name:"G4",midi:67,time:1.25,duration:.5,velocity:.85}]},{instrument:{name:"acoustic guitar (nylon)",family:"guitar",number:24,percussion:!1},channel:2,notes:[{name:"G3",midi:55,time:0,duration:.6,velocity:.7},{name:"C4",midi:60,time:.6,duration:.8,velocity:.75}]},{instrument:{name:"drums",family:"percussion",number:128,percussion:!0},channel:9,notes:[{name:"Snare Drum",midi:38,time:0,duration:.3,velocity:.9},{name:"Kick Drum",midi:36,time:.5,duration:.3,velocity:.8}]}]};describe("getClosestStandardNoteValue",function(){it("should return the closest standard note duration for a given input",function(){expect(getClosestStandardNoteValue(1)).toEqual([1,1]),expect(getClosestStandardNoteValue(.0078125)).toEqual([1,128])})}),describe("transcribeMidi",function(){var i;beforeEach(function(){global.getReverseDrumMidi=jest.fn(function(){return{38:["snare drum"],36:["kick drum"],41:["tom tom"]}}),global.VOICENAMES=[["piano","acoustic grand piano"],["guitar","acoustic guitar (nylon)"]],global.activity={textMsg:jest.fn(),blocks:{loadNewBlocks:jest.fn(),palettes:{_hideMenus:jest.fn()},trashStacks:[]}},i=jest.spyOn(activity.blocks,"loadNewBlocks")}),afterEach(function(){jest.clearAllMocks()}),it("should process all tracks and generate blocks",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,transcribeMidi(mockMidi);case 1:expect(i).toHaveBeenCalled(),t=i.mock.calls[0][0],expect(Array.isArray(t)).toBe(!0),expect(t.length).toBeGreaterThan(0);case 2:return e.a(2)}},e)}))),it("should handle default tempo correctly",_asyncToGenerator(_regenerator().m(function e(){var t,r,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=_objectSpread(_objectSpread({},mockMidi),{},{header:_objectSpread(_objectSpread({},mockMidi.header),{},{tempos:[]})}),e.n=1,transcribeMidi(t);case 1:expect(i).toHaveBeenCalled(),t=i.mock.calls[0][0],r=t.find(function(e){return Array.isArray(e[1])&&"setbpm3"===e[1][0]}),expect(r).toBeDefined(),n=t.find(function(e){return e[0]===r[4][1]}),expect(n).toBeDefined(),expect(n[1][1].value).toBe(90);case 2:return e.a(2)}},e)}))),it("should skip tracks with no notes",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=_objectSpread(_objectSpread({},mockMidi),{},{tracks:[_objectSpread(_objectSpread({},mockMidi.tracks[0]),{},{notes:[]})]}),e.n=1,transcribeMidi(t);case 1:expect(i).toHaveBeenCalled(),t=i.mock.calls[0][0],r=t.filter(function(e){return Array.isArray(e[1])&&"setturtlename2"===e[1][0]}),expect(r.length).toBe(0);case 2:return e.a(2)}},e)}))),it("should handle percussion instruments correctly",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,transcribeMidi(mockMidi);case 1:expect(i).toHaveBeenCalled(),t=i.mock.calls[0][0],t=t.filter(function(e){return"playdrum"===e[1]}),expect(t.length).toBeGreaterThan(0);case 2:return e.a(2)}},e)}))),it("should assign correct instruments to tracks",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,transcribeMidi(mockMidi);case 1:expect(i).toHaveBeenCalled(),t=i.mock.calls[0][0],t=t.filter(function(e){return Array.isArray(e[1])&&"settimbre"===e[1][0]}),r=mockMidi.tracks.filter(function(e){return!e.instrument.percussion}),t.forEach(function(e,t){t=r[t].instrument.name;expect(e[1][1].value).toBe(t)});case 2:return e.a(2)}},e)}))),it("should generate correct note durations",_asyncToGenerator(_regenerator().m(function e(){var o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,transcribeMidi(mockMidi);case 1:expect(i).toHaveBeenCalled(),o=i.mock.calls[0][0],o.filter(function(e){return Array.isArray(e[1])&&"newnote"===e[1][0]}).forEach(function(t){var r=o.find(function(e){return e[0]===t[4][1]}),e=(expect(r).toBeDefined(),o.find(function(e){return e[0]===r[4][1]})),n=o.find(function(e){return e[0]===r[4][2]});expect(e).toBeDefined(),expect(n).toBeDefined(),expect(e[1][1].value).toBeGreaterThan(0),expect(n[1][1].value).toBeGreaterThan(0)});case 2:return e.a(2)}},e)}))),it("should generate rest notes for gaps between notes",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,transcribeMidi(mockMidi);case 1:expect(i).toHaveBeenCalled(),t=i.mock.calls[0][0],t=t.filter(function(e){return"rest2"===e[1]}),expect(t.length).toBeGreaterThan(0);case 2:return e.a(2)}},e)})))});
var saveMxmlOutput=require("../mxml");describe("saveMxmlOutput",function(){it("should return a valid XML string for a basic input",function(){var t=saveMxmlOutput({notation:{notationStaging:{0:[[["C"],4,0]],1:[]}}});expect(t).toContain("<?xml version='1.0' encoding='UTF-8'?>"),expect(t).toContain('<score-partwise version="3.1">'),expect(t).toContain("<part-list>"),expect(t).toContain('<score-part id="P1">'),expect(t).toContain('<part id="P1">')}),it("should handle multiple voices",function(){var t=saveMxmlOutput({notation:{notationStaging:{0:[[["C"],4,0],[["D"],4,0]],1:[[["E"],4,0],[["F"],4,0]]}}});expect(t).toContain('<score-part id="P1">'),expect(t).toContain('<score-part id="P2">'),expect(t).toContain('<part id="P1">'),expect(t).toContain('<part id="P2">'),expect(t).toContain("<step>C</step>"),expect(t).toContain("<step>E</step>")}),it("should ignore specified elements",function(){var t=saveMxmlOutput({notation:{notationStaging:{0:["voice one",[["C"],4,0],"voice two"]}}});expect(t).not.toContain("voice one"),expect(t).not.toContain("voice two"),expect(t).toContain("<step>C</step>")}),it("should handle tempo changes",function(){var t=saveMxmlOutput({notation:{notationStaging:{0:["tempo",120,4,[["C"],4,0]]}}});expect(t).toContain('<sound tempo="120"/>'),expect(t).toContain("<step>C</step>")}),it("should handle meter changes",function(){var t=saveMxmlOutput({notation:{notationStaging:{0:["meter",3,4,[["C"],4,0]]}}});expect(t).toContain("<time>"),expect(t).toContain("<beat-type>4</beat-type>"),expect(t).toContain("<step>C</step>")}),it("should handle crescendo and decrescendo markings",function(){var t=saveMxmlOutput({notation:{notationStaging:{0:["begin crescendo",[["C"],4,0],"end crescendo","begin decrescendo",[["D"],4,0],"end decrescendo"]}}});expect(t).toContain('<wedge type="crescendo"/>'),expect(t).toContain('<wedge type="diminuendo"/>'),expect(t).toContain('<wedge type="stop"/>'),expect(t).toContain("<step>C</step>"),expect(t).toContain("<step>D</step>")}),it("should handle tied notes",function(){var t=saveMxmlOutput({notation:{notationStaging:{0:[[["C"],4,0],"tie",[["C"],4,0]]}}});expect(t).toContain('<tie type="start"/>'),expect(t).toContain('<tie type="stop"/>')})});
var Notation=require("../notation"),_require=require("../utils/musicutils"),durationToNoteValue=_require.durationToNoteValue,convertFactor=_require.convertFactor,getDrumSymbol=_require.getDrumSymbol;global.convertFactor=convertFactor,global.durationToNoteValue=durationToNoteValue,global.getDrumSymbol=getDrumSymbol,global._=require("lodash"),global.last=function(t){return t[t.length-1]},global.toFixed2=function(t){return parseFloat(t.toFixed(2))},global.rationalToFraction=jest.fn().mockReturnValue([1,2]),jest.mock("../utils/musicutils.js",function(){return{durationToNoteValue:jest.fn().mockReturnValue([1,1,1,1]),convertFactor:jest.fn().mockReturnValue(4),getDrumSymbol:jest.fn().mockReturnValue("drums")}}),describe("Notation Class",function(){var o;beforeEach(function(){var t={turtles:{ithTurtle:jest.fn().mockReturnValue({singer:{staccato:[]}})},logo:{updateNotation:jest.fn()}};(o=new Notation(t))._notationStaging=[[]],o._notationStaging.turtle1=[],o._notationDrumStaging={},o._notationDrumStaging.turtle1=[],o._markup={},o._markup.turtle1=[],o._pickupPOW2={},o._pickupPOW2.turtle1=!1,o._pickupPoint={},o._pickupPoint.turtle1=null}),describe("Setters and Getters",function(){it("should correctly set and get notationStaging",function(){var t={turtle1:["note1","note2"]};o.notationStaging=t,expect(o.notationStaging).toEqual(t)}),it("should correctly set and get notationDrumStaging",function(){var t={turtle1:["drum1","drum2"]};o.notationDrumStaging=t,expect(o.notationDrumStaging).toEqual(t)}),it("should correctly set and get notationMarkup",function(){var t={turtle1:["markup1","markup2"]};o.notationMarkup=t,expect(o.notationMarkup).toEqual(t)}),it("should correctly return pickupPOW2 and pickupPoint",function(){expect(o.pickupPOW2).toEqual({turtle1:!1}),expect(o.pickupPoint).toEqual({turtle1:null})})}),describe("Notation Utility Methods",function(){it("should update notation correctly with doUpdateNotation",function(){var t="turtle1";o.doUpdateNotation("C4",4,t,!1,[]),expect(o._notationStaging[t]).toContainEqual(expect.arrayContaining(["C4",expect.any(Number),expect.any(Number)]))}),it("should update notation with drum correctly",function(){var t="turtle1";o.doUpdateNotation("C4",4,t,!1,["kick"]),expect(o._notationDrumStaging[t]).toContainEqual(expect.arrayContaining([["drums"],expect.any(Number),expect.any(Number)]))}),it("should update notation with noise correctly",function(){var t="turtle1";o.doUpdateNotation("C4",4,t,!1,["noise1"]),expect(o._notationDrumStaging[t].length).toBe(0)}),it("should handle object notes with markup",function(){var t={0:"C4",1:"D4"},n="turtle1";o._markup={turtle1:["articulation","staccato"]},o.doUpdateNotation(t,4,n,!1,[]),expect(o._notationStaging[n]).toContainEqual(expect.arrayContaining([t,expect.any(Number),expect.any(Number)]))}),it("should add notation markup using _notationMarkup",function(){var t="turtle1";o._notationMarkup(t,"staccato",!0),expect(o._notationStaging[t]).toEqual(["markdown","staccato"])}),it("should add notation markup above using _notationMarkup",function(){var t="turtle1";o._notationMarkup(t,"staccato",!1),expect(o._notationStaging[t]).toEqual(["markup","staccato"])}),it("should add a pickup using notationPickup",function(){var t="turtle1";o.notationPickup(t,2),expect(convertFactor).toHaveBeenCalledWith(2),expect(o._notationStaging[t]).toEqual(["pickup",4])}),it("should add a voice using notationVoices",function(){var t="turtle1";o.notationVoices(t,2),expect(o._notationStaging[t]).toContain("voice two")}),it("should handle different voice numbers correctly",function(){var t="turtle1";o.notationVoices(t,1),expect(o._notationStaging[t]).toContain("voice one"),o._notationStaging[t]=[],o.notationVoices(t,3),expect(o._notationStaging[t]).toContain("voice three"),o._notationStaging[t]=[],o.notationVoices(t,4),expect(o._notationStaging[t]).toContain("voice four"),o._notationStaging[t]=[],o.notationVoices(t,5),expect(o._notationStaging[t]).toContain("one voice"),o._notationStaging[t]=[],o.notationVoices(t,6),expect(o._notationStaging[t]).toContain("one voice")}),it("should set key using notationKey",function(){var t="turtle1",n="major";o.notationKey(t,"C",n),expect(o._notationStaging[t]).toEqual(["key","C",n])}),it("should set meter using notationMeter",function(){var t="turtle1";o.notationMeter(t,4,4),expect(o._notationStaging[t]).toEqual(["meter",4,4])}),it("should handle notationSwing",function(){var t="turtle1";o.notationSwing(t),expect(o._notationStaging[t]).toContain("swing")}),it("should handle notationTempo",function(){var t="turtle1";o.notationTempo(t,120,4),expect(o._notationStaging[t]).toEqual(["tempo",120,4])})}),describe("Line Breaks and Harmonics",function(){it("should add line break notation",function(){var t="turtle1";o.notationLineBreak(t),expect(o._pickupPoint[t]).toBeNull()}),it("should add harmonics notation",function(){var t="turtle1";o.__notationHarmonic(t),expect(o._pickupPoint[t]).toBeNull()}),it("should begin harmonics",function(){var t="turtle1";o.notationBeginHarmonics(t),expect(o._notationStaging[t]).toEqual(["begin harmonics"])}),it("should end harmonics",function(){var t="turtle1";o.notationEndHarmonics(t),expect(o._notationStaging[t]).toEqual(["end harmonics"])})}),describe("Articulation Controls",function(){it("should begin articulation",function(){var t="turtle1";o.notationBeginArticulation(t),expect(o._notationStaging[t]).toEqual(["begin articulation"])}),it("should end articulation",function(){var t="turtle1";o.notationEndArticulation(t),expect(o._notationStaging[t]).toEqual(["end articulation"])}),it("should begin crescendo",function(){var t="turtle1";o.notationBeginCrescendo(t,2),expect(o._notationStaging[t]).toEqual(["begin crescendo"])}),it("should begin decrescendo",function(){var t="turtle1";o.notationBeginCrescendo(t,-2),expect(o._notationStaging[t]).toEqual(["begin decrescendo"])}),it("should end crescendo",function(){var t="turtle1";o.notationEndCrescendo(t,2),expect(o._notationStaging[t]).toEqual(["end crescendo"])}),it("should end decrescendo",function(){var t="turtle1";o.notationEndCrescendo(t,-2),expect(o._notationStaging[t]).toEqual(["end decrescendo"])})}),describe("Slur and Tie Controls",function(){it("should begin slur",function(){var t="turtle1";o.notationBeginSlur(t),expect(o._notationStaging[t]).toEqual(["begin slur"])}),it("should end slur",function(){var t="turtle1";o.notationEndSlur(t),expect(o._notationStaging[t]).toEqual(["end slur"])}),it("should insert tie",function(){var t="turtle1";o.notationInsertTie(t),expect(o._notationStaging[t]).toEqual(["tie"])}),it("should remove tie",function(){var t="turtle1",n=(o._notationStaging[t].push("some element"),o._notationStaging[t].length);o.notationRemoveTie(t),expect(o._notationStaging[t].length).toBe(n-1),expect(o._pickupPoint[t]).toBeNull()})}),describe("Static Methods",function(){it("should handle notation markup via static method",function(){var t=Notation._markup;Notation._markup={turtle1:[]},Notation.notationMarkup("turtle1","staccato"),expect(Notation._markup.turtle1).toContain("staccato"),Notation._markup=t})}),describe("Edge Cases",function(){it("should handle empty or invalid input for notationPickup",function(){var t="turtle1";o.notationPickup(t,0),expect(o._notationStaging[t].length).toBe(0)})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var h,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function o(e,t,n,o){var r,i,c,l,a,s,u,d,f,t=t&&t.prototype instanceof y?t:y,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(r=e,i=n,u=o||[],d=!1,f={p:s=0,n:0,v:h,a:p,f:p.bind(h,4),d:function(e,t){return c=e,l=0,a=h,f.n=t,b}},function(e,t,n){if(1<s)throw TypeError("Generator is already running");for(d&&1===t&&p(t,n),l=t,a=n;(g=l<2?h:a)||!d;){c||(l?l<3?(1<l&&(f.n=-1),p(l,a)):f.n=a:f.v=a);try{if(s=2,c){if(g=c[e=l?e:"next"]){if(!(g=g.call(c,a)))throw TypeError("iterator result is not an object");if(!g.done)return g;a=g.value,l<2&&(l=0)}else 1===l&&(g=c.return)&&g.call(c),l<2&&(a=TypeError("The iterator does not provide a '"+e+"' method"),l=1);c=h}else if((g=(d=f.n<0)?a:r.call(i,f))!==b)break}catch(e){c=h,l=1,a=e}finally{s=1}}return{value:g,done:d}}),!0),t;function p(e,t){for(l=e,a=t,g=0;!d&&s&&!n&&g<u.length;g++){var n,o=u[g],r=f.p,i=o[2];3<e?(n=i===t)&&(a=o[(l=o[4])?5:l=3],o[4]=o[5]=h):o[0]<=r&&((n=e<2&&r<o[1])?(l=0,f.v=t,f.n=o[1]):r<i&&(n=e<3||o[0]>t||i<t)&&(o[4]=e,o[5]=t,f.n=i,l=0))}if(n||1<e)return b;throw d=!0,t}}var b={};function y(){}function r(){}function i(){}var g=Object.getPrototypeOf,e=[][t]?g(g([][t]())):(_regeneratorDefine2(g={},t,function(){return this}),g),c=i.prototype=y.prototype=Object.create(e);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(c),e}return _regeneratorDefine2(c,"constructor",r.prototype=i),_regeneratorDefine2(i,"constructor",r),_regeneratorDefine2(i,n,r.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,n,"Generator"),_regeneratorDefine2(c,t,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:l}})()}function _regeneratorDefine2(e,t,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,t,n,o){function r(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))})(e,t,n,o)}function asyncGeneratorStep(e,t,n,o,r,i,c){try{var l=e[i](c),a=l.value}catch(e){return void n(e)}l.done?t(a):Promise.resolve(a).then(o,r)}function _asyncToGenerator(l){return function(){var e=this,c=arguments;return new Promise(function(t,n){var o=l.apply(e,c);function r(e){asyncGeneratorStep(o,t,n,r,i,"next",e)}function i(e){asyncGeneratorStep(o,t,n,r,i,"throw",e)}r(void 0)})}}function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../palette"),Palettes=_require.Palettes,initPalettes=_require.initPalettes;global.LEADING=10,global.DEFAULTPALETTE="default",global.MULTIPALETTES=[["rhythm","pitch"],["flow","action"],["graphics","pen"]],global.PALETTEICONS={search:"<svg></svg>",rhythm:"<svg></svg>",pitch:"<svg></svg>",flow:"<svg></svg>",action:"<svg></svg>",graphics:"<svg></svg>",pen:"<svg></svg>",myblocks:"<svg></svg>"},global.MULTIPALETTEICONS=["music","logic","artwork"],global.SKIPPALETTES=["heap","dictionary"],global.toTitleCase=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},global._=function(e){return e},global.platformColor={selectorSelected:"#000",paletteBackground:"#fff",strokeColor:"#333",fillColor:"#666",paletteLabelBackground:"#ccc",paletteLabelSelected:"#aaa",hoverColor:"#ddd",paletteText:"#000"},global.base64Encode=function(e){return e},global.localStorage={kanaPreference:"default"},describe("Palettes Class",function(){var o,r;beforeEach(function(){var t={style:{visibility:"visible",top:"100px"},children:[{children:[{children:[{insertCell:jest.fn(function(){return{appendChild:jest.fn(),style:{}}})}]},{children:[{},{parentNode:{removeChild:jest.fn()},appendChild:jest.fn(function(){return{}}),insertRow:jest.fn(function(){return{insertCell:jest.fn(function(){return{appendChild:jest.fn(),style:{}}}),style:{},addEventListener:jest.fn()}})}]}],style:{border:""}}]};global.document={createElement:jest.fn(function(){return{id:"",setAttribute:jest.fn(),classList:{add:jest.fn()},appendChild:jest.fn(),style:{},innerHTML:"",childNodes:[{style:{}}]}}),body:{appendChild:jest.fn(),style:{cursor:"default"}}},global.docById=jest.fn(function(e){return"PaletteBody"===e?{parentNode:{removeChild:jest.fn()}}:"palette"===e?_objectSpread(_objectSpread({},t),{},{children:[{children:[{children:[{insertCell:jest.fn(function(){return{appendChild:jest.fn(),style:{}}})}]},{children:[{},{removeChild:jest.fn(),appendChild:jest.fn(function(){return{}}),parentNode:{removeChild:jest.fn()},insertRow:jest.fn(function(){return{insertCell:jest.fn(function(){return{appendChild:jest.fn(),style:{},textContent:""}}),style:{},addEventListener:jest.fn()}})}]}],style:{border:""}}]}):{style:{},appendChild:jest.fn(),removeChild:jest.fn()}}),o={cellSize:50,blocks:{protoBlockDict:{},makeBlock:jest.fn(function(){return{}})},hideSearchWidget:jest.fn(),showSearchWidget:jest.fn(),palettes:{},beginnerMode:!1},r=new Palettes(o)}),describe("Constructor",function(){test("initializes properties correctly",function(){expect(r.activity).toBe(o),expect(r.cellSize).toBe(Math.floor(25.5))}),test("initializes paletteWidth correctly",function(){expect(r.paletteWidth).toBe(165)}),test("initializes empty dictionaries",function(){expect(r.dict).toEqual({}),expect(r.buttons).toEqual({}),expect(r.labels).toEqual({})}),test("initializes default state values",function(){expect(r.visible).toBe(!0),expect(r.mobile).toBe(!1),expect(r.activePalette).toBeNull()}),test("initializes plugin arrays",function(){expect(r.pluginMacros).toEqual({}),expect(r.pluginPalettes).toEqual([])})}),describe("init method",function(){test("sets halfCellSize",function(){r.init(),expect(r.halfCellSize).toBe(Math.floor(r.cellSize/2))})}),describe("setSize method",function(){test("updates cellSize and returns this",function(){var e=r.setSize(100);expect(r.cellSize).toBe(Math.floor(50.5)),expect(e).toBe(r)}),test("handles small sizes",function(){r.setSize(10),expect(r.cellSize).toBe(Math.floor(5.5))}),test("handles large sizes",function(){r.setSize(200),expect(r.cellSize).toBe(Math.floor(100.5))})}),describe("setMobile method",function(){test("updates mobile flag and hides menus when true",function(){var e=jest.spyOn(r,"_hideMenus"),t=r.setMobile(!0);expect(r.mobile).toBe(!0),expect(e).toHaveBeenCalled(),expect(t).toBe(r)}),test("updates mobile flag but does not hide menus when false",function(){var e=jest.spyOn(r,"_hideMenus");r.setMobile(!1),expect(r.mobile).toBe(!1),expect(e).not.toHaveBeenCalled()})}),describe("setSearch method",function(){test("sets showSearchWidget and hideSearchWidget on activity",function(){var e=jest.fn(),t=jest.fn(),n=r.setSearch(e,t);expect(o.showSearchWidget).toBe(e),expect(o.hideSearchWidget).toBe(t),expect(n).toBe(r)})}),describe("getSearchPos method",function(){test("returns correct search position",function(){var e=r.getSearchPos();expect(e).toEqual([r.cellSize,r.top+1.75*r.cellSize])})}),describe("getPluginMacroExpansion method",function(){test("returns macro expansion and updates coordinates",function(){r.pluginMacros={testMacro:[[0,"block",0,0,[null]]]};var e=r.getPluginMacroExpansion("testMacro",100,200);expect(e[0][2]).toBe(100),expect(e[0][3]).toBe(200)}),test("returns null for non-existent macro",function(){r.pluginMacros={};var e=r.getPluginMacroExpansion("nonExistent",0,0);expect(e).toBeUndefined()})}),describe("countProtoBlocks method",function(){test("counts blocks in a palette",function(){o.blocks.protoBlockDict={block1:{palette:{name:"rhythm"}},block2:{palette:{name:"rhythm"}},block3:{palette:{name:"pitch"}},block4:{palette:null}};var e=r.countProtoBlocks("rhythm");expect(e).toBe(2)}),test("returns 0 for empty palette",function(){o.blocks.protoBlockDict={};var e=r.countProtoBlocks("rhythm");expect(e).toBe(0)}),test("returns 0 for non-existent palette",function(){o.blocks.protoBlockDict={block1:{palette:{name:"rhythm"}}};var e=r.countProtoBlocks("nonExistent");expect(e).toBe(0)})}),describe("getProtoNameAndPalette method",function(){test("returns correct values for existing block by name",function(){o.blocks.protoBlockDict={testBlock:{name:"testBlock",palette:{name:"testPalette"},hidden:!1}};var e=r.getProtoNameAndPalette("testBlock");expect(e).toEqual(["testBlock","testPalette","testBlock"])}),test("returns correct values for existing block by key",function(){o.blocks.protoBlockDict={blockKey:{name:"differentName",palette:{name:"testPalette"},hidden:!1}};var e=r.getProtoNameAndPalette("blockKey");expect(e).toEqual(["blockKey","testPalette","differentName"])}),test("returns nulls for non-existent block",function(){o.blocks.protoBlockDict={};var e=r.getProtoNameAndPalette("nonExistent");expect(e).toEqual([null,null,null])}),test("skips hidden blocks",function(){o.blocks.protoBlockDict={hiddenBlock:{name:"hiddenBlock",palette:{name:"test"},hidden:!0}};var e=r.getProtoNameAndPalette("hiddenBlock");expect(e).toEqual([null,null,null])})}),describe("hide and show methods",function(){test("hide sets visibility to hidden",function(){r.hide(),expect(docById("palette").style.visibility).toBe("hidden")}),test("show sets visibility to visible",function(){r.show(),expect(docById("palette").style.visibility).toBe("visible")})}),describe("showPalette method",function(){test("returns early when mobile is true",function(){r.mobile=!0,r.dict={testPalette:{showMenu:jest.fn()}},r.showPalette("testPalette"),expect(r.dict.testPalette.showMenu).not.toHaveBeenCalled()}),test("shows palette and sets activePalette when not mobile",function(){r.mobile=!1,r.dict={testPalette:{showMenu:jest.fn()}},r.showPalette("testPalette"),expect(r.dict.testPalette.showMenu).toHaveBeenCalledWith(!0),expect(r.activePalette).toBe("testPalette")})}),describe("_hideMenus method",function(){test("calls hideSearchWidget",function(){r._hideMenus(),expect(o.hideSearchWidget).toHaveBeenCalledWith(!0)}),test("removes PaletteBody if it exists",function(){var t=jest.fn();global.docById=jest.fn(function(e){return"PaletteBody"===e?{parentNode:{removeChild:t}}:null}),r._hideMenus(),expect(t).toHaveBeenCalled()})}),describe("updatePalettes method",function(){test("handles null showPalette parameter",function(){r.updatePalettes(null)}),test("hides and shows palette when it exists and was open",function(){var e=jest.fn(),t=jest.fn();r.dict={testPalette:{hideMenu:e,show:t}},global.docById=jest.fn(function(e){return"PaletteBody"===e?{}:{style:{}}}),r.updatePalettes("testPalette"),expect(e).toHaveBeenCalled(),expect(t).toHaveBeenCalled()}),test("hides palette when mobile is true",function(){var e=jest.spyOn(r,"hide");r.mobile=!0,r.updatePalettes("test"),expect(e).toHaveBeenCalled()})}),describe("setBlocks method",function(){test("sets blocks property and returns this",function(){var e={test:!0},t=r.setBlocks(e);expect(r.blocks).toBe(e),expect(t).toBe(r)})}),describe("add method",function(){test("adds new palette to dict and returns this",function(){var e=r.add("newPalette");expect(r.dict.newPalette).toBeDefined(),expect(e).toBe(r)})}),describe("removeActionPrototype method",function(){test("does not throw when action palette has empty protoList",function(){r.dict={action:{protoList:[]}},expect(function(){return r.removeActionPrototype("nonExistent")}).not.toThrow()}),test("does not update when no matching block found",function(){var e=jest.spyOn(r,"updatePalettes");r.dict={action:{protoList:[{name:"someOtherBlock",defaults:["otherAction"]}]}},r.removeActionPrototype("nonExistent"),expect(e).not.toHaveBeenCalled()})}),describe("clear method",function(){test("clears dict and resets state",function(){global.document={createElement:jest.fn(function(){return{id:"",setAttribute:jest.fn(),classList:{add:jest.fn()},innerHTML:"",childNodes:[{style:{}}]}}),body:{appendChild:jest.fn()}},global.docById=jest.fn(function(e){return"palette"===e?{parentNode:{removeChild:jest.fn()}}:null}),r.dict={test:{hideMenu:jest.fn()}},r.visible=!0,r.activePalette="test",r.clear(),expect(r.dict).toEqual({}),expect(r.visible).toBe(!1),expect(r.activePalette).toBeNull()}),test("handles errors gracefully",function(){global.docById=jest.fn(function(){throw new Error("Test error")}),r.dict={},expect(function(){return r.clear()}).not.toThrow()})}),describe("getInfo method",function(){test("logs info for each palette",function(){var e=jest.spyOn(console,"debug").mockImplementation();r.dict={test1:{getInfo:function(){return"info1"}},test2:{getInfo:function(){return"info2"}}},r.getInfo(),expect(e).toHaveBeenCalledWith("info1"),expect(e).toHaveBeenCalledWith("info2"),e.mockRestore()})})}),describe("initPalettes function",function(){var t;beforeEach(function(){t={add:jest.fn().mockReturnThis(),init_selectors:jest.fn(),makePalettes:jest.fn(),show:jest.fn()},global.BUILTINPALETTES=["rhythm","pitch","flow"]}),test("adds all built-in palettes",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,initPalettes(t);case 1:expect(t.add).toHaveBeenCalledWith("rhythm"),expect(t.add).toHaveBeenCalledWith("pitch"),expect(t.add).toHaveBeenCalledWith("flow");case 2:return e.a(2)}},e)}))),test("initializes selectors",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,initPalettes(t);case 1:expect(t.init_selectors).toHaveBeenCalled();case 2:return e.a(2)}},e)}))),test("makes palettes with index 0",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,initPalettes(t);case 1:expect(t.makePalettes).toHaveBeenCalledWith(0);case 2:return e.a(2)}},e)}))),test("shows palettes after initialization",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,initPalettes(t);case 1:expect(t.show).toHaveBeenCalled();case 2:return e.a(2)}},e)}))),test("handles empty BUILTINPALETTES",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return global.BUILTINPALETTES=[],e.n=1,initPalettes(t);case 1:expect(t.add).not.toHaveBeenCalled();case 2:return e.a(2)}},e)})))}),describe("Palettes edge cases",function(){var t,n;beforeEach(function(){global.docById=jest.fn(function(){return{style:{visibility:"visible",top:"100px"}}}),t={cellSize:50,blocks:{protoBlockDict:{}},hideSearchWidget:jest.fn(),showSearchWidget:jest.fn(),beginnerMode:!1},n=new Palettes(t)}),test("handles beginner mode skipping palettes",function(){t.beginnerMode=!0,global.SKIPPALETTES=["heap","dictionary"],t.blocks.protoBlockDict={block1:{palette:{name:"heap"}}};var e=n.countProtoBlocks("heap");expect(e).toBe(1)}),test("handles null palette in protoBlockDict",function(){t.blocks.protoBlockDict={nullPaletteBlock:{palette:null,name:"test",hidden:!1}};var e=n.countProtoBlocks("anyPalette");expect(e).toBe(0)}),test("setSize with zero results in zero cellSize",function(){n.setSize(0),expect(n.cellSize).toBe(0)})});
var PasteBox=require("../pastebox");describe("PasteBox",function(){var e=global.Image,t=global.window,n=global.createjs,a=global.docById,o=global.base64Encode;afterAll(function(){global.Image=e,global.window=t,global.createjs=n,global.docById=a,global.base64Encode=o}),describe("constructor / hide / show / getPos",function(){var e,t,n;beforeEach(function(){t={stage:{addChild:jest.fn()},refreshCanvas:jest.fn(),pasted:jest.fn()},n=jest.fn(),global.docById=n,global.base64Encode=jest.fn(function(e){return e}),global.window={btoa:jest.fn(function(e){return e})},e=new PasteBox(t)}),it("should initialize with the correct default values",function(){expect(e.activity).toBe(t),expect(e._container).toBeNull(),expect(e.save).toBeNull(),expect(e.close).toBeNull(),expect(e._scale).toBe(1)}),it("should hide the container and clear the paste element",function(){e._container={visible:!0},n.mockReturnValue({value:"foo",style:{visibility:"visible"}}),e.hide(),expect(e._container.visible).toBe(!1),expect(t.refreshCanvas).toHaveBeenCalled(),expect(n).toHaveBeenCalledWith("paste"),expect(n("paste").value).toBe(""),expect(n("paste").style.visibility).toBe("hidden")}),it("should make the container visible and show the paste element",function(){e._container={visible:!1},n.mockReturnValue({style:{visibility:"hidden"}}),e.show(),expect(e._container.visible).toBe(!0),expect(t.refreshCanvas).toHaveBeenCalled(),expect(n).toHaveBeenCalledWith("paste"),expect(n("paste").style.visibility).toBe("visible")}),it("should return the position of the container",function(){e._container={x:12,y:34},expect(e.getPos()).toEqual([12,34])})}),describe("createBox()",function(){var a,o;beforeEach(function(){o={stage:{addChild:jest.fn()},refreshCanvas:jest.fn(),pasted:jest.fn()},global.base64Encode=jest.fn(function(e){return e}),global.window={btoa:jest.fn(function(e){return e})},a=new PasteBox(o)}),it("should create a container and add it to the stage",function(){var e={addChild:jest.fn(),x:0,y:0,visible:!1};global.createjs={Container:jest.fn(function(){return e}),Bitmap:jest.fn(),Shape:jest.fn()},jest.spyOn(a,"_makeBoxBitmap"),a.createBox(2,10,20),expect(a._scale).toBe(2),expect(global.createjs.Container).toHaveBeenCalled(),expect(o.stage.addChild).toHaveBeenCalledWith(e),expect(e.x).toBe(10),expect(e.y).toBe(20),expect(a._makeBoxBitmap).toHaveBeenCalledWith(expect.any(String),"box",expect.any(Function),null)}),it("should create a bitmap from SVG data and call the callback",function(){var e={addChild:jest.fn(),x:0,y:0,visible:!1,getBounds:jest.fn(function(){return{x:0,y:0,width:300,height:55}}),on:jest.fn(),hitArea:null},t={type:"BITMAP"},n=(global.createjs={Container:jest.fn(function(){return e}),Bitmap:jest.fn(function(){return t}),Shape:jest.fn(function(){return{graphics:{beginFill:jest.fn().mockReturnThis(),drawRect:jest.fn().mockReturnThis()}}})},{onload:null,src:""});global.Image=jest.fn(function(){return n}),(a=new PasteBox(o)).createBox(1,0,0),expect(n.onload).toBeInstanceOf(Function),n.onload(),expect(e.addChild).toHaveBeenCalledWith(t),expect(e.visible).toBe(!0),expect(o.refreshCanvas).toHaveBeenCalled()})}),describe("_loadClearContainerHandler click‐handler",function(){var e,t,n;beforeEach(function(){t={pasted:jest.fn(),refreshCanvas:jest.fn()},global.docById=jest.fn().mockReturnValue({value:"",style:{visibility:"visible"}}),global.createjs={Shape:jest.fn(function(){return{graphics:{beginFill:jest.fn().mockReturnThis(),drawRect:jest.fn().mockReturnThis()}}})},(e=new PasteBox(t))._scale=1,e._container={getBounds:jest.fn(function(){return{x:0,y:0,width:300,height:55}}),on:jest.fn(function(e,t){n=t}),hitArea:null,x:200,y:0,visible:!0},e._loadClearContainerHandler()}),it("should set up the click handler for the container",function(){expect(e._container.on).toHaveBeenCalledWith("click",expect.any(Function))}),it("calls pasted() + hide() when clicking in paste area",function(){n({stageX:410,stageY:25}),expect(t.pasted).toHaveBeenCalled(),expect(e._container.visible).toBe(!1),expect(t.refreshCanvas).toHaveBeenCalled(),expect(global.docById).toHaveBeenCalledWith("paste")}),it("only calls hide() when clicking in close area",function(){n({stageX:460,stageY:10}),expect(t.pasted).not.toHaveBeenCalled(),expect(e._container.visible).toBe(!1),expect(t.refreshCanvas).toHaveBeenCalled(),expect(global.docById).toHaveBeenCalledWith("paste")}),it("does nothing when clicking outside both areas",function(){n({stageX:300,stageY:60}),expect(t.pasted).not.toHaveBeenCalled(),expect(t.refreshCanvas).not.toHaveBeenCalled(),expect(e._container.visible).toBe(!0)}),it("debounces rapid clicks in paste area",function(){jest.useFakeTimers(),n({stageX:410,stageY:25}),n({stageX:410,stageY:25}),jest.advanceTimersByTime(500),n({stageX:410,stageY:25}),expect(t.pasted).toHaveBeenCalledTimes(2),jest.useRealTimers()})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function o(e,t,n,o){var r,a,c,i,l,s,u,d,f,t=t&&t.prototype instanceof y?t:y,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(r=e,a=n,u=o||[],d=!1,f={p:s=0,n:0,v:m,a:p,f:p.bind(m,4),d:function(e,t){return c=e,i=0,l=m,f.n=t,v}},function(e,t,n){if(1<s)throw TypeError("Generator is already running");for(d&&1===t&&p(t,n),i=t,l=n;(j=i<2?m:l)||!d;){c||(i?i<3?(1<i&&(f.n=-1),p(i,l)):f.n=l:f.v=l);try{if(s=2,c){if(j=c[e=i?e:"next"]){if(!(j=j.call(c,l)))throw TypeError("iterator result is not an object");if(!j.done)return j;l=j.value,i<2&&(i=0)}else 1===i&&(j=c.return)&&j.call(c),i<2&&(l=TypeError("The iterator does not provide a '"+e+"' method"),i=1);c=m}else if((j=(d=f.n<0)?l:r.call(a,f))!==v)break}catch(e){c=m,i=1,l=e}finally{s=1}}return{value:j,done:d}}),!0),t;function p(e,t){for(i=e,l=t,j=0;!d&&s&&!n&&j<u.length;j++){var n,o=u[j],r=f.p,a=o[2];3<e?(n=a===t)&&(l=o[(i=o[4])?5:i=3],o[4]=o[5]=m):o[0]<=r&&((n=e<2&&r<o[1])?(i=0,f.v=t,f.n=o[1]):r<a&&(n=e<3||o[0]>t||a<t)&&(o[4]=e,o[5]=t,f.n=a,i=0))}if(n||1<e)return v;throw d=!0,t}}var v={};function y(){}function r(){}function a(){}var j=Object.getPrototypeOf,e=[][t]?j(j([][t]())):(_regeneratorDefine2(j={},t,function(){return this}),j),c=a.prototype=y.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(c),e}return _regeneratorDefine2(c,"constructor",r.prototype=a),_regeneratorDefine2(a,"constructor",r),_regeneratorDefine2(a,n,r.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,n,"Generator"),_regeneratorDefine2(c,t,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:i}})()}function _regeneratorDefine2(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,n,o){function r(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))})(e,t,n,o)}function asyncGeneratorStep(e,t,n,o,r,a,c){try{var i=e[a](c),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(o,r)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,n){var o=i.apply(e,c);function r(e){asyncGeneratorStep(o,t,n,r,a,"next",e)}function a(e){asyncGeneratorStep(o,t,n,r,a,"throw",e)}r(void 0)})}}var PlanetInterface=require("../planetInterface"),mockActivity=(global.platformColor={header:"#8bc34a"},global._THIS_IS_MUSIC_BLOCKS_={},global.doSVG=jest.fn(),{hideSearchWidget:jest.fn(),prepSearchWidget:jest.fn(),sendAllToTrash:jest.fn(),refreshCanvas:jest.fn(),_loadStart:jest.fn(),doLoadAnimation:jest.fn(),textMsg:jest.fn(),stage:{enableDOMEvents:jest.fn(),update:jest.fn()},blocks:{loadNewBlocks:jest.fn(),palettes:{_hideMenus:jest.fn()},trashStacks:[]},logo:{doStopTurtles:jest.fn()},canvas:{},turtles:{},loading:!1,prepareExport:jest.fn(),_allClear:jest.fn()}),docById=(document.body.innerHTML='\n  <div id="helpElem"></div>\n  <div class="canvasHolder"></div>\n  <div id="canvas"></div>\n  <meta id="theme-color">\n  <div id="toolbars"></div>\n  <div id="palette"></div>\n  <div id="buttoncontainerBOTTOM"></div>\n  <div id="buttoncontainerTOP"></div>\n  <canvas id="overlayCanvas"></canvas>\n  <iframe id="planet-iframe"></iframe>\n  <input id="myOpenFile" type="file">\n',jest.fn(function(e){return document.getElementById(e)}));global.docById=docById,beforeAll(function(){mockCanvas={click:jest.fn()},window.widgetWindows={hideAllWindows:jest.fn(),showWindows:jest.fn()},window.scroll=jest.fn()}),describe("PlanetInterface",function(){var o;beforeEach(function(){o=new PlanetInterface(mockActivity)}),test("hideMusicBlocks hides relevant elements and disables DOM events",function(){o.hideMusicBlocks(),expect(mockActivity.hideSearchWidget).toHaveBeenCalled(),expect(mockActivity.logo.doStopTurtles).toHaveBeenCalled(),expect(docById("helpElem").style.visibility).toBe("hidden"),expect(document.querySelector(".canvasHolder").classList.contains("hide")).toBe(!0),expect(document.querySelector("#canvas").style.display).toBe("none"),expect(document.querySelector("#theme-color").content).toBe("#8bc34a")}),test("showMusicBlocks shows relevant elements and enables DOM events",function(){mockActivity.planet={getCurrentProjectName:jest.fn(function(){return"Test Project"})},o.showMusicBlocks(),expect(document.title).toBe("Test Project"),expect(docById("toolbars").style.display).toBe("block"),expect(docById("palette").style.display).toBe("block"),expect(mockActivity.prepSearchWidget).toHaveBeenCalled(),expect(document.querySelector(".canvasHolder").classList.contains("hide")).toBe(!1),expect(document.querySelector("#canvas").style.display).toBe("")}),test("hidePlanet hides the planet interface",function(){o.iframe=document.querySelector("#planet-iframe"),o.hidePlanet(),expect(o.iframe.style.display).toBe("none")}),test("openPlanet calls saveLocally, hideMusicBlocks, and showPlanet",function(){jest.spyOn(o,"saveLocally").mockImplementation(function(){}),jest.spyOn(o,"hideMusicBlocks").mockImplementation(function(){}),jest.spyOn(o,"showPlanet").mockImplementation(function(){}),o.openPlanet(),expect(o.saveLocally).toHaveBeenCalled(),expect(o.hideMusicBlocks).toHaveBeenCalled(),expect(o.showPlanet).toHaveBeenCalled()}),test("closePlanet calls hidePlanet and showMusicBlocks",function(){jest.spyOn(o,"hidePlanet").mockImplementation(function(){}),jest.spyOn(o,"showMusicBlocks").mockImplementation(function(){}),o.closePlanet(),expect(o.hidePlanet).toHaveBeenCalled(),expect(o.showMusicBlocks).toHaveBeenCalled()}),test("newProject calls closePlanet, initialiseNewProject, _loadStart, and saveLocally",function(){jest.spyOn(o,"closePlanet").mockImplementation(function(){}),jest.spyOn(o,"initialiseNewProject").mockImplementation(function(){}),jest.spyOn(o,"saveLocally").mockImplementation(function(){}),o.newProject(),expect(o.closePlanet).toHaveBeenCalled(),expect(o.initialiseNewProject).toHaveBeenCalled(),expect(mockActivity._loadStart).toHaveBeenCalled(),expect(o.saveLocally).toHaveBeenCalled()}),test("onConverterLoad sets window.Converter",function(){o.planet={Converter:"mockConverter"},o.onConverterLoad(),expect(window.Converter).toBe("mockConverter")}),test("getCurrentProjectName returns name from ProjectStorage",function(){o.planet={ProjectStorage:{getCurrentProjectName:jest.fn(function(){return"ProjectX"})}},expect(o.getCurrentProjectName()).toBe("ProjectX")}),test("initialiseNewProject should reset project state",function(){o.planet={ProjectStorage:{initialiseNewProject:jest.fn()}},o.initialiseNewProject("New Name"),expect(o.planet.ProjectStorage.initialiseNewProject).toHaveBeenCalledWith("New Name"),expect(mockActivity.sendAllToTrash).toHaveBeenCalled(),expect(mockActivity.refreshCanvas).toHaveBeenCalled(),expect(mockActivity.blocks.trashStacks).toEqual([])}),test("loadProjectFromData: default merge=false",function(){o.iframe={style:{display:"block"}},mockActivity.blocks.loadNewBlocks.mockClear(),o.getCurrentProjectName=jest.fn(function(){return"foo"}),o.loadProjectFromData(JSON.stringify({whatever:1})),expect(mockActivity.sendAllToTrash).toHaveBeenCalledWith(!1,!0),expect(mockActivity.textMsg).toHaveBeenCalledWith("foo"),expect(mockActivity.loading).toBe(!1),expect(mockActivity.blocks.loadNewBlocks).toHaveBeenCalledWith({whatever:1}),expect(document.body.style.cursor).toBe("default")}),test("loadProjectFromFile focuses, clicks, scrolls",function(){var e=document.getElementById("myOpenFile");e.focus=jest.fn(),e.click=jest.fn(),o.loadProjectFromFile(),expect(e.focus).toHaveBeenCalled(),expect(e.click).toHaveBeenCalled(),expect(window.scroll).toHaveBeenCalledWith(0,0)}),test("saveLocally: svgData empty → saveLocally(data, null)",function(){doSVG.mockReturnValue("");var e={x:1};mockActivity.prepareExport.mockReturnValue(e),o.planet={ProjectStorage:{saveLocally:jest.fn()}},o.saveLocally(),expect(o.planet.ProjectStorage.saveLocally).toHaveBeenCalledWith(e,null)}),test("getCurrentProjectDescription/Image/TimeLastSaved",function(){var e=new Date(2020,1,1);o.planet={ProjectStorage:{getCurrentProjectDescription:function(){return"desc"},getCurrentProjectImage:function(){return"img.png"},TimeLastSaved:e}},expect(o.getCurrentProjectDescription()).toBe("desc"),expect(o.getCurrentProjectImage()).toBe("img.png"),expect(o.getTimeLastSaved()).toBe(e)}),test("openCurrentProject returns promise data",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return o.planet={ProjectStorage:{getCurrentProjectData:jest.fn(_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,123)},e)})))}},e.n=1,expect(o.openCurrentProject()).resolves.toBe(123);case 1:return e.a(2)}},e)}))),test("openProjectFromPlanet proxies arguments",function(){o.planet={openProjectFromPlanet:jest.fn()},o.openProjectFromPlanet("ID42","oops"),expect(o.planet.openProjectFromPlanet).toHaveBeenCalledWith("ID42","oops")}),test("hideMusicBlocks also calls widgetWindows.hideAllWindows and disables DOM events after 250ms",function(){jest.useFakeTimers(),o.hideMusicBlocks(),expect(window.widgetWindows.hideAllWindows).toHaveBeenCalled(),expect(mockActivity.stage.enableDOMEvents).not.toHaveBeenCalledWith(!1),jest.advanceTimersByTime(250),expect(mockActivity.stage.enableDOMEvents).toHaveBeenCalledWith(!1),jest.useRealTimers()}),test("init(): success wires up planet, Converter, handlers, and mainCanvas",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return global._THIS_IS_MUSIC_BLOCKS_={},t=document.getElementById("planet-iframe"),t=t.contentWindow,n={Converter:"CONV",setLoadProjectFromData:jest.fn(),setPlanetClose:jest.fn(),setLoadNewProject:jest.fn(),setLoadProjectFromFile:jest.fn(),setOnConverterLoad:jest.fn()},t.makePlanet=jest.fn(_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)}))),t.p=n,e.n=1,o.init();case 1:expect(o.planet).toBe(n),expect(n.setLoadProjectFromData).toHaveBeenCalledWith(expect.any(Function)),expect(n.setPlanetClose).toHaveBeenCalledWith(expect.any(Function)),expect(n.setLoadNewProject).toHaveBeenCalledWith(expect.any(Function)),expect(n.setLoadProjectFromFile).toHaveBeenCalledWith(expect.any(Function)),expect(n.setOnConverterLoad).toHaveBeenCalledWith(expect.any(Function)),expect(window.Converter).toBe("CONV"),expect(o.mainCanvas).toBe(mockActivity.canvas);case 2:return e.a(2)}},e)}))),test("showPlanet: catch block when local-tab missing",function(){document.getElementById("overlayCanvas").toDataURL=function(){return"PNG"},o.planet={open:jest.fn()},o.iframe=document.getElementById("planet-iframe"),o.iframe.contentWindow={document:{getElementById:function(){return null}}},console.error=jest.fn(),o.showPlanet(),expect(console.error).toHaveBeenCalled()}),test("saveLocally: non-empty SVG triggers image‑onload path",function(e){doSVG.mockReturnValue("<svg/>"),mockActivity.prepareExport.mockReturnValue("EXPORT"),global.base64Encode=jest.fn(function(e){return e}),o.planet={ProjectStorage:{saveLocally:jest.fn()}},global.Image=(()=>_createClass(function e(){_classCallCheck(this,e)},[{key:"src",set:function(e){this.onload()}}]))(),global.createjs={Bitmap:(()=>_createClass(function e(t){_classCallCheck(this,e)},[{key:"getBounds",value:function(){return{x:0,y:0,width:1,height:1}}},{key:"cache",value:function(e,t,n,o){this.bitmapCache={getCacheDataURL:function(){return"DATAURL"}}}}]))()},o.saveLocally(),setTimeout(function(){expect(o.planet.ProjectStorage.saveLocally).toHaveBeenCalledWith("EXPORT","DATAURL"),e()},0)})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var ProtoBlock=require("../protoblocks");global.createjs={Container:jest.fn(function(){return{addChild:jest.fn(),getBounds:jest.fn(function(){return{width:50}})}}),Text:jest.fn(function(e,t,o){return{text:e,font:t,color:o}})},global.SVG=jest.fn(function(){return{setScale:jest.fn(),setTab:jest.fn(),setSlot:jest.fn(),setFontSize:jest.fn(),setExpand:jest.fn(),basicBlock:jest.fn(function(){return"<svg></svg>"}),docks:[[0,0]],getWidth:jest.fn(function(){return 100}),getHeight:jest.fn(function(){return 50})}}),global.DEFAULTBLOCKSCALE=1,global.STANDARDBLOCKHEIGHT=20,describe("ProtoBlock",function(){var t;beforeEach(function(){t=new ProtoBlock("TestBlock")}),test("should initialize with default properties",function(){expect(t.name).toBe("TestBlock"),expect(t.palette).toBeNull(),expect(t.style).toBeNull(),expect(t.generator).toBeNull(),expect(t.expandable).toBe(!1),expect(t.args).toBe(0),expect(t.defaults).toEqual([])}),test("adjustWidthToLabel should set textWidth and extraWidth",function(){t.staticLabels.push("Example Label"),t.adjustWidthToLabel(),expect(t.textWidth).toBe(50),expect(t.extraWidth).toBeGreaterThan(0)}),test("zeroArgBlock should set correct properties",function(){t.zeroArgBlock(),expect(t.args).toBe(0),expect(t.dockTypes).toEqual(["out","in"]),expect(_typeof(t.generator)).toBe("function")}),test("zeroArgBlockGenerator should return SVG details",function(){t.zeroArgBlock();var e=t.generator();expect(e).toEqual(["<svg></svg>",[[0,0]],100,50,50])}),test("oneArgBlock should set correct properties",function(){t.oneArgBlock(),expect(t.args).toBe(1),expect(t.dockTypes).toEqual(["out","numberin","in"])}),test("twoArgBlock should configure expandable block",function(){t.twoArgBlock(),expect(t.expandable).toBe(!0),expect(t.args).toBe(2),expect(t.dockTypes).toContain("numberin")}),test("hiddenBlockFlow should set generator correctly",function(){t.hiddenBlockFlow(),expect(t.size).toBe(0),expect(t.dockTypes).toContain("in")}),test("booleanZeroArgBlock should configure boolean output",function(){t.booleanZeroArgBlock(),expect(t.dockTypes).toContain("booleanout")}),test("parameterBlock should set up a value output block",function(){t.parameterBlock(),expect(t.dockTypes).toContain("numberout"),expect(t.parameter).toBe(!0)})});
global._=function(t){return t};var _require=require("../rubrics"),TACAT=_require.TACAT,TAPAL=_require.TAPAL,TASCORE=_require.TASCORE,PALS=_require.PALS,PALLABELS=_require.PALLABELS,analyzeProject=_require.analyzeProject,scoreToChartData=_require.scoreToChartData,getChartOptions=_require.getChartOptions,runAnalytics=_require.runAnalytics,getStatsFromNotation=_require.getStatsFromNotation,_require2=require("../utils/musicutils"),isCustomTemperament=_require2.isCustomTemperament;global.last=jest.fn(),global.isCustomTemperament=isCustomTemperament,global.TextEncoder=require("util").TextEncoder,global.TextDecoder=require("util").TextDecoder,jest.mock("../utils/musicutils",function(){return{isCustomTemperament:jest.fn(function(){return!1}),getTemperament:jest.fn(function(){return[]})}}),jest.mock("../utils/utils.js",function(){return{_:jest.fn(function(t){return t})}}),describe("rubrics.js test suite",function(){describe("analyzeProject",function(){it("should return an array of scores",function(){var t=analyzeProject({blocks:{blockList:[{name:"note",connections:[null,{}]},{name:"setbpm",connections:[null,{},{}]},{name:"random",connections:[null]}]}});expect(Array.isArray(t)).toBe(!0),expect(t.length).toBe(PALS.length)}),it("should ignore blocks in trash",function(){var t=analyzeProject({blocks:{blockList:[{name:"note",trash:!0,connections:[null,{}]},{name:"setbpm",trash:!1,connections:[null,{},{}]}]}});expect(t).toBeInstanceOf(Array)})}),describe("scoreToChartData",function(){it("should return a properly formatted chart data object",function(){var t=[10,20,30,40,50],e=scoreToChartData(t);expect(e).toHaveProperty("labels"),expect(e).toHaveProperty("datasets"),expect(Array.isArray(e.labels)).toBe(!0),expect(e.datasets).toHaveLength(1),expect(e.datasets[0]).toHaveProperty("data"),expect(e.datasets[0].data.length).toBe(t.length)})}),describe("getChartOptions",function(){it("should return an object with correct chart settings",function(){var t=jest.fn(),e=getChartOptions(t);expect(e).toHaveProperty("onAnimationComplete",t),expect(e).toHaveProperty("scaleShowLine",!0),expect(e).toHaveProperty("datasetFill",!0)})}),describe("runAnalytics",function(){it("should set correct properties on logo object",function(){var t={logo:{runningLilypond:!1,collectingStats:!1,notation:{notationStaging:{},notationDrumStaging:{}},runLogoCommands:jest.fn()},turtles:{turtleList:[{painter:{doClear:jest.fn()}}],getTurtleCount:jest.fn(function(){return 1}),getTurtle:jest.fn(function(t){return{painter:{doClear:jest.fn()}}})}};runAnalytics(t),expect(t.logo.runningLilypond).toBe(!0),expect(t.logo.collectingStats).toBe(!0),expect(t.logo.runLogoCommands).toHaveBeenCalled()})}),describe("getStatsFromNotation",function(){it("should return an object with musical statistics",function(){var t={logo:{notation:{notationStaging:{0:[["C4","D4"],3],1:[["E4","F4"],5]}},synth:{inTemperament:!1,_getFrequency:jest.fn(function(t){return 100*t.length})}},blocks:{blockList:[{name:"rest2",trash:!1,protoblock:{palette:{name:"ornaments"}}}]}},t=getStatsFromNotation(t);expect(t).toHaveProperty("numberOfNotes"),expect(t.numberOfNotes).toBeGreaterThan(0),expect(t).toHaveProperty("rests",1),expect(t).toHaveProperty("ornaments",1)})})});
global._=jest.fn(function(e){return e}),window.platformColor={header:"#4DA6FF",selectorSelected:"#1A8CFF"},document.body.innerHTML='\n    <meta name="theme-color" content="#4DA6FF">\n    <canvas id="canvas"></canvas>\n    <div id="themeSelectIcon"></div>\n    <div id="light"><i class="material-icons">brightness_7</i></div>\n    <div id="dark"><i class="material-icons">brightness_4</i></div>\n    <div id="palette"><div></div></div>\n';var ThemeBox=require("../themebox");describe("ThemeBox",function(){var t,n;beforeEach(function(){t={storage:{themePreference:"light"},textMsg:jest.fn(),refreshCanvas:jest.fn(),palettes:{}},jest.spyOn(global.Storage.prototype,"getItem").mockImplementation(function(e){return"themePreference"===e?"light":null}),jest.spyOn(global.Storage.prototype,"setItem").mockImplementation(function(){}),document.body.classList.remove("light","dark"),n=new ThemeBox(t)}),afterEach(function(){jest.restoreAllMocks()}),test("constructor initializes theme from activity storage",function(){expect(n._theme).toBe("light")}),test("light_onclick() sets theme to light",function(){n.light_onclick(),expect(n._theme).toBe("light"),expect(localStorage.getItem).toHaveBeenCalledWith("themePreference"),expect(t.textMsg).toHaveBeenCalledWith("Music Blocks is already set to this theme.")}),test("dark_onclick() sets theme to dark and applies instantly",function(){var e=jest.spyOn(n,"reload").mockImplementation();n.dark_onclick(),expect(n._theme).toBe("dark"),expect(t.storage.themePreference).toBe("dark"),expect(e).not.toHaveBeenCalled(),expect(t.textMsg).toHaveBeenCalledWith("Theme switched to dark mode.",2e3)}),test("setPreference() applies theme instantly without reload",function(){var e=jest.spyOn(n,"reload").mockImplementation();localStorage.getItem.mockReturnValue("light"),n._theme="dark",n.setPreference(),expect(t.storage.themePreference).toBe("dark"),expect(e).not.toHaveBeenCalled(),expect(document.body.classList.contains("dark")).toBe(!0),expect(document.body.classList.contains("light")).toBe(!1)}),test("setPreference() does not change if theme is unchanged",function(){var e=jest.spyOn(n,"reload").mockImplementation();n.light_onclick(),expect(e).not.toHaveBeenCalled(),expect(t.textMsg).toHaveBeenCalledWith("Music Blocks is already set to this theme.")}),test("applyThemeInstantly() updates body classes correctly",function(){n._theme="dark",n.applyThemeInstantly(),expect(document.body.classList.contains("dark")).toBe(!0),expect(document.body.classList.contains("light")).toBe(!1)}),test("applyThemeInstantly() updates canvas background for dark mode",function(){n._theme="dark",n.applyThemeInstantly();var e=document.getElementById("canvas");expect(e.style.backgroundColor).toBe("rgb(48, 48, 48)")}),test("applyThemeInstantly() updates canvas background for light mode",function(){n._theme="light",n.applyThemeInstantly();var e=document.getElementById("canvas");expect(e.style.backgroundColor).toBe("rgb(249, 249, 249)")})});
function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var _require=require("../utils/platformstyle"),platformColor=_require.platformColor,Toolbar=(global.platformColor=platformColor,jest.mock("../utils/platformstyle",function(){return{platformColor:{stopIconColor:"#ea174c"}}}),global.jQuery=jest.fn(function(){return{on:jest.fn(),trigger:jest.fn(),tooltip:jest.fn(),dropdown:jest.fn()}}),global.jQuery.noConflict=jest.fn(function(){return global.jQuery}),global.window={localStorage:{languagePreference:"en"},navigator:{language:"en-US"},document:{getElementById:jest.fn(function(){return{style:{}}})}},global.localStorage=window.localStorage,require("../toolbar"));global.document.getElementById=jest.fn(function(e){return{id:e,style:{},setAttribute:jest.fn(),innerHTML:"",classList:{add:jest.fn()},appendChild:jest.fn()}}),global.docById=jest.fn(function(e){return{id:e,setAttribute:jest.fn(),innerHTML:"",style:{},classList:{add:jest.fn()},appendChild:jest.fn()}}),global._=jest.fn(function(e){return e}),global.$j=jest.fn(function(){return{tooltip:jest.fn(),dropdown:jest.fn()}}),describe("Toolbar Class",function(){var o,a;beforeEach(function(){global.window.localStorage.languagePreference="en",global._THIS_IS_MUSIC_BLOCKS_=!1,o=new Toolbar,a={beginnerMode:!0}}),afterEach(function(){jest.clearAllMocks()}),test("initializes with correct properties and sets activity",function(){var e={someProp:"someValue"};o.init(e),expect(o.activity).toEqual(e),expect(o.language).toBe("en"),expect(o.tooltipsDisabled).toBe(!1)}),test("sets correct strings for _THIS_IS_MUSIC_BLOCKS_ true",function(){global._THIS_IS_MUSIC_BLOCKS_=!0,o.init({}),expect(global._).toHaveBeenCalledTimes(134),expect(global._).toHaveBeenNthCalledWith(1,"About Music Blocks")}),test("sets correct strings for _THIS_IS_MUSIC_BLOCKS_ false",function(){global._THIS_IS_MUSIC_BLOCKS_=!1,o.init({}),expect(global._).toHaveBeenCalledTimes(116),expect(global._).toHaveBeenNthCalledWith(1,"About Turtle Blocks")}),test("handles language fallback when localStorage is empty",function(){delete global.window.localStorage.languagePreference,o.init({}),expect(o.language).toBe("en")}),test("falls back to navigator language if localStorage is empty",function(){delete global.window.localStorage.languagePreference,o=new Toolbar,expect(o.language).toBe("en-US")}),test("init sets activity and updates beginner/advanced mode display",function(){var t={style:{display:""},setAttribute:jest.fn(),classList:{add:jest.fn()}},n={style:{display:""},setAttribute:jest.fn(),classList:{add:jest.fn()}};global.docById.mockImplementation(function(e){return"beginnerMode"===e?t:"advancedMode"===e?n:{setAttribute:jest.fn(),style:{},classList:{add:jest.fn()}}}),o.init(a),expect(o.activity).toBe(a),expect(t.style.display).toBe("none"),expect(n.style.display).toBe("block"),expect(t.setAttribute).toHaveBeenCalled(),expect(n.setAttribute).toHaveBeenCalled()}),beforeEach(function(){jest.useFakeTimers(),jest.spyOn(global,"clearTimeout"),global.saveButton={disabled:!1,className:""},global.saveButtonAdvanced={disabled:!1,className:""}}),afterEach(function(){jest.useRealTimers()}),test("renderLogoIcon sets up logo with correct interactions",function(){var t={"mb-logo":{innerHTML:"",onmouseenter:null,onmouseleave:null,onclick:null,style:{}}},e=(global.docById=jest.fn(function(e){return t[e]}),global.document={body:{style:{cursor:""}}},new Toolbar),n=(e.activity={},e.language="en",jest.fn());e.renderLogoIcon(n),expect(t["mb-logo"].innerHTML).toBe(""),expect(_typeof(t["mb-logo"].onmouseenter)).toBe("function"),expect(_typeof(t["mb-logo"].onmouseleave)).toBe("function"),expect(_typeof(t["mb-logo"].onclick)).toBe("function"),t["mb-logo"].onmouseenter(),expect(document.body.style.cursor).toBe("pointer"),t["mb-logo"].onmouseleave(),expect(document.body.style.cursor).toBe("default"),t["mb-logo"].onclick(),expect(n).toHaveBeenCalledWith(e.activity),e.language="ja",e.renderLogoIcon(n),expect(t["mb-logo"].innerHTML).toContain("logo-ja.svg"),expect(t["mb-logo"].innerHTML).toContain("transform: scale(0.85)"),t["mb-logo"].onclick(),expect(n).toHaveBeenCalledTimes(2)}),test("renderPlayIcon sets onclick and updates play/stop button behavior",function(){var t={play:{onclick:global.play_button_debounce_timeout=null,addEventListener:jest.fn()},stop:{style:{color:""},addEventListener:jest.fn()},record:{className:""}},e=(global.docById.mockImplementation(function(e){return t[e]||{}}),{hideMsgs:jest.fn(),beginnerMode:!0}),n=(o.activity=e,jest.fn());o.renderPlayIcon(n),t.play.onclick(),expect(n).toHaveBeenCalledWith(e),expect(t.stop.style.color).toBe(o.stopIconColorWhenPlaying),expect(global.saveButtonAdvanced.disabled).toBe(!0),expect(global.saveButton.className).toBe("grey-text inactiveLink"),expect(t.record.className).toBe("grey-text inactiveLink"),expect(t.stop.addEventListener).toHaveBeenCalledWith("click",expect.any(Function)),(0,t.stop.addEventListener.mock.calls[0][1])(),expect(e.hideMsgs).toHaveBeenCalled(),delete global.play_button_debounce_timeout}),test("renderStopIcon sets onclick and updates stop button behavior",function(){var t={onclick:null,style:{color:""}},n={className:"recording"},e=(global.docById.mockImplementation(function(e){return"stop"===e?t:"record"===e?n:{}}),jest.fn());o.renderStopIcon(e),t.onclick(),expect(e).toHaveBeenCalled(),expect(t.style.color).toBe("white"),expect(global.saveButton.disabled).toBe(!1),expect(global.saveButtonAdvanced.disabled).toBe(!1),expect(global.saveButton.className).toBe(""),expect(global.saveButtonAdvanced.className).toBe(""),expect(n.className).toBe("")}),test("renderNewProjectIcon displays modal and handles confirmation",function(){var t={"modal-container":{style:{display:""}},newdropdown:{innerHTML:"",appendChild:jest.fn()}},e=(global.docById=jest.fn(function(e){return t[e]}),global.document={createElement:jest.fn(function(e){return{tagName:e,classList:{add:jest.fn()},textContent:"",style:{},onclick:null,appendChild:jest.fn()}})},global._=jest.fn(function(e){return e}),new Toolbar),n=(e.activity=a,jest.fn()),e=(e.renderNewProjectIcon(n),expect(t["modal-container"].style.display).toBe("flex"),expect(t.newdropdown.innerHTML).toBe(""),t.newdropdown.appendChild.mock.calls),o=e[0][0],l=e[1][0],e=e[2][0].firstChild;expect(o.textContent).toBe("New project"),expect(l.textContent).toBe("Are you sure you want to create a new project?"),expect(l.id).toBe("confirmation-message"),expect(e.textContent).toBe("Confirm"),expect(e.id).toBe("new-project"),e.onclick(),expect(t["modal-container"].style.display).toBe("none"),expect(n).toHaveBeenCalledWith(a)}),test("renderLoadIcon sets onclick and updates tooltip",function(){var e={setAttribute:jest.fn(),onclick:null},t=(global.docById.mockReturnValue(e),jest.fn());o.renderLoadIcon(t),expect(e.onclick).toBeInstanceOf(Function),e.onclick(),expect(t).toHaveBeenCalledWith(o.activity)}),test("renderThemeSelectIcon sets onclick and updates theme selection",function(){var e={onclick:null},t=["light","dark"],n={setAttribute:jest.fn()};global.docById.mockReturnValue(e),global.localStorage.themePreference="light",o.renderThemeSelectIcon(n,t),expect(e.onclick).toBeInstanceOf(Function),e.onclick(),t.forEach(function(e){"light"===e&&expect(global.localStorage.themePreference).toBe("light")})}),test("renderWrapIcon toggles WRAP and updates tooltip",function(){var e={helpfulWheelItems:[{label:"Turtle Wrap Off",display:!1},{label:"Turtle Wrap On",display:!0}],textMsg:jest.fn()},t=(o.activity=e,{setAttribute:jest.fn(),onclick:null});global.docById.mockReturnValue(t),global.$j=jest.fn(function(){return{tooltip:jest.fn()}}),global.WRAP=!1,o.renderWrapIcon(),expect(t.onclick).toBeInstanceOf(Function),t.onclick(),expect(global.WRAP).toBe(!1),expect(t.setAttribute).toHaveBeenCalledWith("data-tooltip","Turtle Wrap Off"),expect(e.helpfulWheelItems[0].display).toBe(!1),t.onclick(),expect(t.setAttribute).toHaveBeenCalledWith("data-tooltip","Turtle Wrap On"),expect(e.helpfulWheelItems[0].display).toBe(!0)}),test("changeWrap toggles WRAP and updates tooltip",function(){var e={helpfulWheelItems:[{label:"Turtle Wrap Off",display:!1},{label:"Turtle Wrap On",display:!0}],textMsg:jest.fn()},t={setAttribute:jest.fn()},n={style:{display:"block"}};global._=jest.fn(function(e){return e}),global.$j=jest.fn(function(){return{tooltip:jest.fn()}}),global.WRAP=!1,global.docById=jest.fn(function(e){return"wrapTurtle"===e?t:"helpfulWheelDiv"===e?n:{}}),expect(global.WRAP).toBe(!1),expect(e.helpfulWheelItems[0].display).toBe(!1),expect(e.helpfulWheelItems[1].display).toBe(!0),o.changeWrap(e),expect(t.setAttribute).toHaveBeenCalledWith("data-tooltip","Turtle Wrap On"),n.style.display="none",o.changeWrap(e),expect(n.style.display).toBe("none")}),test("renderSaveIcons handles all save button states correctly",function(){var t={saveButton:{onclick:null,style:{display:""}},saveButtonAdvanced:{onclick:null,style:{display:""}},"save-html-beg":{onclick:null},"save-png-beg":{onclick:null,disabled:!1,className:""},"save-html":{onclick:null},"save-svg":{onclick:null,disabled:!1,className:""},"save-png":{onclick:null,disabled:!1,className:""},"save-midi":{onclick:null},"save-wav":{onclick:null},"save-ly":{onclick:null},"save-abc":{onclick:null},"save-mxml":{onclick:null},"save-blockartwork-svg":{onclick:null},"save-blockartwork-png":{onclick:null}},e=(global.docById=jest.fn(function(e){return t[e]||{onclick:null}}),{beginnerMode:!0,language:"en",canvas:{width:100,height:100},logo:{},turtles:{},_THIS_IS_MUSIC_BLOCKS_:!1}),n={html_onclick:jest.fn(),doSVG_onclick:jest.fn(),svg_onclick:jest.fn(),midi_onclick:jest.fn(),png_onclick:jest.fn(),wave_onclick:jest.fn(),ly_onclick:jest.fn(),abc_onclick:jest.fn(),mxml_onclick:jest.fn(),blockartworksvg_onclick:jest.fn(),blockartworkpng_onclick:jest.fn()},o=new Toolbar;o.activity=e,o.renderSaveIcons.apply(o,_toConsumableArray(Object.values(n))),expect(t.saveButton.style.display).toBe("block"),expect(t.saveButtonAdvanced.style.display).toBe("none"),t.saveButton.onclick(),t["save-html-beg"].onclick(),expect(n.html_onclick).toHaveBeenCalledWith(e),n.doSVG_onclick.mockReturnValueOnce(""),t.saveButton.onclick(),expect(t["save-png-beg"].disabled).toBe(!0),expect(t["save-png-beg"].className).toBe("grey-text inactiveLink"),n.doSVG_onclick.mockReturnValueOnce("<svg>data</svg>"),t.saveButton.onclick(),expect(t["save-png-beg"].disabled).toBe(!1),expect(t["save-png-beg"].className).toBe(""),t["save-png-beg"].onclick(),expect(n.png_onclick).toHaveBeenCalledWith(e),e.language="ja",o.renderSaveIcons.apply(o,_toConsumableArray(Object.values(n))),t.saveButton.onclick(),expect(n.html_onclick).toHaveBeenCalledWith(e),e.beginnerMode=!1,e._THIS_IS_MUSIC_BLOCKS_=!0,o.renderSaveIcons.apply(o,_toConsumableArray(Object.values(n))),expect(t.saveButton.style.display).toBe("none"),expect(t.saveButtonAdvanced.style.display).toBe("block"),t.saveButtonAdvanced.onclick(),n.doSVG_onclick.mockReturnValueOnce(""),t.saveButtonAdvanced.onclick(),expect(t["save-svg"].disabled).toBe(!0),expect(t["save-png"].disabled).toBe(!0),expect(t["save-svg"].className).toBe("grey-text inactiveLink"),expect(t["save-png"].className).toBe("grey-text inactiveLink"),t["save-svg"].onclick(),expect(n.svg_onclick).toHaveBeenCalledWith(e),t["save-png"].onclick(),expect(n.png_onclick).toHaveBeenCalledWith(e),t["save-blockartwork-svg"].onclick(),expect(n.blockartworksvg_onclick).toHaveBeenCalledWith(e),t["save-blockartwork-png"].onclick(),expect(n.blockartworkpng_onclick).toHaveBeenCalledWith(e)}),test("updateRecordButton hides record button",function(){var e={classList:{add:jest.fn()},style:{display:""},innerHTML:""};global.docById.mockReturnValue(e),global.fnBrowserDetect=jest.fn(function(){return"firefox"}),o.updateRecordButton(jest.fn()),expect(e.classList.add).toHaveBeenCalledWith("hide"),expect(e.style.display).toBe("")}),test("renderPlanetIcon sets onclick and updates planet icon behavior",function(){var t={planetIcon:{onclick:null,style:{display:""}},planetIconDisabled:{style:{display:""}},toolbars:{style:{display:""}},wheelDiv:{style:{display:""}},contextWheelDiv:{style:{display:""}}},e=(global.docById.mockImplementation(function(e){return t[e]||{}}),jest.fn());o.activity={},o.renderPlanetIcon(!0,e),expect(t.planetIcon.onclick).toBeInstanceOf(Function),t.planetIcon.onclick(),expect(e).toHaveBeenCalledWith(o.activity),expect(t.toolbars.style.display).toBe("none"),expect(t.wheelDiv.style.display).toBe("none"),expect(t.contextWheelDiv.style.display).toBe("none"),o.renderPlanetIcon(!1,e),expect(t.planetIcon.style.display).toBe("none"),expect(t.planetIconDisabled.style.display).toBe("block")}),test("renderMenuIcon toggles menu visibility",function(){var t={menu:{onclick:null,innerHTML:"",style:{}},"aux-toolbar":{style:{display:""}},search:{classList:{toggle:jest.fn()}},toggleAuxBtn:{className:""},chooseKeyDiv:{style:{display:""}},movable:{style:{display:""}}},e=(global.docById.mockImplementation(function(e){return t[e]||{}}),jest.fn()),n=(o.activity={},o.renderMenuIcon(e),expect(t.menu.onclick).toBeInstanceOf(Function),t.menu.onclick);t["aux-toolbar"].style.display="none",n(),expect(e).toHaveBeenCalledWith(o.activity,!1),expect(t.menu.innerHTML).toBe("more_vert"),expect(t.toggleAuxBtn.className).toBe("blue darken-1"),expect(t.search.classList.toggle).toHaveBeenCalledWith("open"),t["aux-toolbar"].style.display="block",n(),expect(e).toHaveBeenCalledWith(o.activity,!0),expect(t["aux-toolbar"].style.display).toBe("none"),expect(t.menu.innerHTML).toBe("menu"),expect(t.toggleAuxBtn.className).toBe(NaN),expect(t.chooseKeyDiv.style.display).toBe("none")}),test("renderRunSlowlyIcon sets onclick and triggers slow run functionality",function(){var t={onclick:null,style:{display:""}},n={style:{color:""}},e=(global.docById.mockImplementation(function(e){return"runSlowlyIcon"===e?t:"stop"===e?n:{}}),o.activity={beginnerMode:!1},o.language="en",o.stopIconColorWhenPlaying="#ff0000",jest.fn());o.renderRunSlowlyIcon(e),expect(t.onclick).toBeInstanceOf(Function),t.onclick(),expect(e).toHaveBeenCalledWith(o.activity),expect(n.style.color).toBe("#ff0000"),expect(t.style.display).toBe(""),o.activity.beginnerMode=!0,o.language="ja",o.renderRunSlowlyIcon(e),expect(t.style.display).toBe("none")}),test("renderHelpIcon sets onclick and updates tooltip",function(){var e={setAttribute:jest.fn(),onclick:null},t=(global.docById.mockReturnValue(e),jest.fn());o.renderHelpIcon(t),expect(e.onclick).toBeInstanceOf(Function),e.onclick(),expect(t).toHaveBeenCalledWith(o.activity)}),test("renderModeSelectIcon handles mode switching and UI updates",function(){var t={beginnerMode:{onclick:null,style:{display:""}},advancedMode:{onclick:null,style:{display:""}},record:{style:{display:""},onclick:null},displayStatsIcon:{style:{display:""},onclick:null},loadPluginIcon:{style:{display:""},onclick:null},delPluginIcon:{style:{display:""},onclick:null},enableHorizScrollIcon:{style:{display:""},onclick:null},disableHorizScrollIcon:{style:{display:""},onclick:null},toggleJavaScriptIcon:{style:{display:""}},saveButton:{style:{display:""}},saveButtonAdvanced:{style:{display:""}}},e=(global.docById=jest.fn(function(e){return t[e]}),global.localStorage={setItem:jest.fn()},global.$j=jest.fn(function(){return{tooltip:jest.fn(),dropdown:jest.fn()}}),jest.fn(function(){return"<svg>mock</svg>"})),n=(global.doSVG=e,{beginnerMode:!0,helpfulWheelItems:[{label:"Enable horizontal scrolling",display:!1}],palettes:{updatePalettes:jest.fn()},refreshCanvas:jest.fn(),save:{saveHTML:jest.fn(),saveSVG:jest.fn(),saveMIDI:jest.fn(),savePNG:jest.fn(),saveWAV:jest.fn(),saveLilypond:jest.fn(),saveAbc:jest.fn(),saveMxml:jest.fn(),saveBlockArtwork:jest.fn(),saveBlockArtworkPNG:jest.fn()},toolbar:{renderSaveIcons:jest.fn(),updateRecordButton:jest.fn()}}),o=new Toolbar,l=(o.activity=n,o.tooltipsDisabled=!1,{onclick:jest.fn(),rec_onclick:jest.fn(),analytics_onclick:jest.fn(),openPlugin_onclick:jest.fn(),delPlugin_onclick:jest.fn(),setScroller:jest.fn()}),o=(o.renderModeSelectIcon(l.onclick,l.rec_onclick,l.analytics_onclick,l.openPlugin_onclick,l.delPlugin_onclick,l.setScroller),expect(t.beginnerMode.style.display).toBe("none"),expect(t.advancedMode.style.display).toBe("block"),expect(t.record.style.display).toBe("none"),["displayStatsIcon","loadPluginIcon","delPluginIcon","enableHorizScrollIcon","toggleJavaScriptIcon"].forEach(function(e){expect(t[e].style.display).toBe("none")}),expect(n.helpfulWheelItems[0].display).toBe(!1),n.toolbar.renderSaveIcons.mock.calls[0]);expect(n.toolbar.renderSaveIcons).toHaveBeenCalled(),o[0](),expect(n.save.saveHTML).toHaveBeenCalled(),expect(o[1]).toBe(e),o[2](),expect(n.save.saveSVG).toHaveBeenCalled(),o[3](),expect(n.save.saveMIDI).toHaveBeenCalled(),o[4](),expect(n.save.savePNG).toHaveBeenCalled(),o[5](),expect(n.save.saveWAV).toHaveBeenCalled(),o[6](),expect(n.save.saveLilypond).toHaveBeenCalled(),o[7](),expect(n.save.saveAbc).toHaveBeenCalled(),o[8](),expect(n.save.saveMxml).toHaveBeenCalled(),o[9](),expect(n.save.saveBlockArtwork).toHaveBeenCalled(),o[10](),expect(n.save.saveBlockArtworkPNG).toHaveBeenCalled()}),test("renderRunStepIcon sets onclick and handles Japanese beginner mode",function(){var t={onclick:null,style:{display:""}},e=(global.docById.mockImplementation(function(e){return"runStepByStepIcon"===e?t:{}}),{beginnerMode:!1}),n=new Toolbar,o=(n.activity=e,n.language="en",jest.fn());n.renderRunStepIcon(o),expect(t.onclick).toBeInstanceOf(Function),t.onclick(),expect(o).toHaveBeenCalledWith(e),expect(t.style.display).toBe(""),n.language="ja",e.beginnerMode=!0,n.renderRunStepIcon(o),expect(t.style.display).toBe("none")}),test("renderMergeIcon sets onclick and triggers merge functionality",function(){var e={onclick:null},t=(global.docById.mockReturnValue(e),jest.fn());o.renderMergeIcon(t),expect(e.onclick).toBeInstanceOf(Function),e.onclick(),expect(t).toHaveBeenCalledWith(o.activity)}),test("renderRestoreIcon sets onclick and triggers restore functionality",function(){var e={onclick:null},t=(global.docById.mockReturnValue(e),jest.fn());o.renderRestoreIcon(t),expect(e.onclick).toBeInstanceOf(Function),e.onclick(),expect(t).toHaveBeenCalledWith(o.activity)}),test("renderChooseKeyIcon sets onclick and toggles key selection visibility",function(){var t={onclick:null},n={style:{display:"none"}},e=(global.docById.mockImplementation(function(e){return"chooseKeyIcon"===e?t:"chooseKeyDiv"===e?n:{}}),jest.fn());global._THIS_IS_MUSIC_BLOCKS_=!0,o.renderChooseKeyIcon(e),expect(t.onclick).toBeInstanceOf(Function),t.onclick(),expect(e).toHaveBeenCalledWith(o.activity),expect(n.style.display).toBe("none")}),test("renderJavaScriptIcon sets onclick and triggers JavaScript editor",function(){var e={onclick:null},t=(global.docById.mockReturnValue(e),jest.fn());o.renderJavaScriptIcon(t),expect(e.onclick).toBeInstanceOf(Function),e.onclick(),expect(t).toHaveBeenCalledWith(o.activity)}),test("renderLanguageSelectIcon sets onclick and updates language selection",function(){var e={onclick:null},t={setAttribute:jest.fn()};global.docById.mockReturnValue(e),o.renderLanguageSelectIcon(t),expect(e.onclick).toBeInstanceOf(Function),e.onclick(),expect(global.localStorage.languagePreference).toBeDefined()}),test("disableTooltips removes tooltips and sets tooltipsDisabled to true",function(){var e=jest.fn(function(){return{tooltip:jest.fn()}});o.disableTooltips(e),expect(e).toHaveBeenCalledWith(".tooltipped"),expect(o.tooltipsDisabled).toBe(!0)}),test("closeAuxToolbar hides auxiliary toolbar if visible",function(){var t={"aux-toolbar":{style:{display:"block"}},menu:{innerHTML:""},toggleAuxBtn:{className:"some-class blue darken-1"}},e=(global.docById.mockImplementation(function(e){return t[e]||{}}),jest.fn());o.activity={},o.closeAuxToolbar(e),expect(t["aux-toolbar"].style.display).toBe("none"),expect(t.menu.innerHTML).toBe("menu"),expect(e).toHaveBeenCalledWith(o.activity,!1)})});
var Trashcan=require("../trash"),mockActivity={trashContainer:{addChild:jest.fn(),setChildIndex:jest.fn()},cellSize:50,refreshCanvas:jest.fn()},mockTo=jest.fn().mockReturnThis(),mockSet=jest.fn().mockReturnThis(),mockCreatejs={Container:jest.fn(function(){return{addChild:jest.fn(),removeChildAt:jest.fn(),getBounds:jest.fn(function(){return{width:100,height:100}}),children:[{visible:!1},{visible:!1}],visible:!1,x:0,y:0}}),Bitmap:jest.fn(function(){return{scaleX:1,scaleY:1,x:0,y:0,getBounds:jest.fn(function(){return{width:100}})}}),Tween:{get:jest.fn(function(){return{to:mockTo,set:mockSet}})},Shape:jest.fn(function(){return{graphics:{beginFill:jest.fn().mockReturnThis(),drawRect:jest.fn().mockReturnThis()}}})};global.createjs=mockCreatejs,global.platformColor={trashActive:"red",trashBorder:"blue"},global.base64Encode=jest.fn(function(e){return e}),global.BORDER="mock_border_svg",global.TRASHICON="mock_trash_icon_svg",global.last=jest.fn(function(e){return e[e.length-1]}),global.Image=jest.fn(function(){var e={};return e.onload=jest.fn(),Object.defineProperty(e,"src",{set:function(){e.onload()}}),e}),jest.spyOn(global.window,"addEventListener").mockImplementation(function(){}),jest.useFakeTimers(),describe("Trashcan Class",function(){var e;beforeEach(function(){jest.clearAllMocks(),e=new Trashcan(mockActivity)}),it("should initialize with correct default values",function(){expect(e.activity).toBe(mockActivity),expect(e.isVisible).toBe(!1),expect(e._scale).toBe(1),expect(mockActivity.trashContainer.addChild).toHaveBeenCalled(),expect(mockActivity.trashContainer.setChildIndex).toHaveBeenCalled()}),it("should check if resize is needed",function(){e._container.x=100,e._container.y=100,expect(e.shouldResize(200,100)).toBe(!0),expect(e.shouldResize(100,100)).toBe(!1)}),it("should resize and debounce the event listener",function(){e.resizeEvent(1),(0,window.addEventListener.mock.calls[0][1])(),jest.advanceTimersByTime(300)}),it("should hide the trashcan using animation",function(){e.hide(),expect(mockCreatejs.Tween.get).toHaveBeenCalledWith(e._container),expect(mockTo).toHaveBeenCalledWith({alpha:0},200),expect(mockSet).toHaveBeenCalledWith({visible:!1})}),it("should show the trashcan using animation",function(){e.show(),expect(mockCreatejs.Tween.get).toHaveBeenCalledWith(e._container),expect(mockTo).toHaveBeenCalledWith({alpha:0,visible:!0}),expect(mockTo).toHaveBeenCalledWith({alpha:1},200)}),it("should start and stop highlight animation",function(){e.startHighlightAnimation(),jest.advanceTimersByTime(3e3),expect(e._inAnimation).toBe(!0)}),it("should not restart highlight animation if already running",function(){e._inAnimation=!0,e.startHighlightAnimation(),expect(e._inAnimation).toBe(!0)}),it("should toggle highlight visibility correctly",function(){e._switchHighlightVisibility(!0),expect(mockActivity.refreshCanvas).toHaveBeenCalled(),e._switchHighlightVisibility(!1),expect(mockActivity.refreshCanvas).toHaveBeenCalledTimes(2)}),it("should detect if coordinates are over the trashcan",function(){e._container.x=100,e._container.y=100,expect(e.overTrashcan(150,150)).toBe(!0),expect(e.overTrashcan(50,150)).toBe(!1),expect(e.overTrashcan(150,50)).toBe(!1),expect(e.overTrashcan(300,300)).toBe(!1)})});
var Painter=require("../turtle-painter"),mockTurtle=(global.WRAP=!0,{turtles:{screenX2turtleX:jest.fn(),screenY2turtleY:jest.fn(),turtleX2screenX:jest.fn(),turtleY2screenY:jest.fn(),scale:1},activity:{refreshCanvas:jest.fn()},container:{x:0,y:0,rotation:0},ctx:{beginPath:jest.fn(),clearRect:jest.fn(),stroke:jest.fn(),closePath:jest.fn(),moveTo:jest.fn(),lineTo:jest.fn(),arc:jest.fn(),canvas:{width:800,height:600}},penstrokes:{image:null},orientation:0,updateCache:jest.fn(),blinking:jest.fn().mockReturnValue(!1)});describe("Painter Class",function(){var e;beforeEach(function(){jest.spyOn(window,"requestAnimationFrame").mockImplementation(function(e){return e()}),e=new Painter(mockTurtle)}),afterEach(function(){window.requestAnimationFrame.mockRestore()}),describe("Constructor",function(){test("should initialize with default values",function(){expect(e._color).toBe(0),expect(e._stroke).toBe(5),expect(e._penDown).toBe(!0)})}),describe("Setters and Getters",function(){test("should set and get color",function(){e.color=10,expect(e.color).toBe(10)}),test("should set and get stroke",function(){e.stroke=8,expect(e.stroke).toBe(8)})}),describe("Actions",function(){test("should move forward",function(){e.doForward(10),expect(mockTurtle.activity.refreshCanvas).toHaveBeenCalled()}),test("should turn right",function(){e.doRight(90),expect(mockTurtle.orientation).toBe(90)})})});
var _this=void 0,Singer=(global.DEFAULTVOLUME=100,global.TARGETBPM=120,global.TONEBPM=60,require("../turtle-singer")),mockGlobals={getNote:jest.fn().mockReturnValue(["C",4]),isCustomTemperament:jest.fn(),getStepSizeUp:jest.fn().mockReturnValue(1),numberToPitch:jest.fn().mockReturnValue(["C",4]),pitchToNumber:jest.fn().mockReturnValue(60)};global.getNote=mockGlobals.getNote,global.isCustomTemperament=mockGlobals.isCustomTemperament,global.getStepSizeUp=mockGlobals.getStepSizeUp,global.numberToPitch=mockGlobals.numberToPitch,global.pitchToNumber=mockGlobals.pitchToNumber,global.last=jest.fn(function(e){return e[e.length-1]}),describe("Singer Class",function(){var t,e,o,n;beforeEach(function(){t={turtles:[],singer:new Singer(_this),synthVolume:{DEFAULTVOICE:[100]},inNoteBlock:[0],notePitches:{0:[]},noteOctaves:{0:[]},noteCents:{0:[]},noteHertz:{0:[]}},e={turtles:{ithTurtle:jest.fn().mockReturnValue(t),turtleList:[t]},logo:{synth:{setMasterVolume:jest.fn(),setVolume:jest.fn(),rampTo:jest.fn()},pitchDrumMatrix:{addRowBlock:jest.fn()},notation:{notationInsertTie:jest.fn(),notationRemoveTie:jest.fn()},firstNoteTime:null,stopTurtle:!1,inPitchDrumMatrix:!1,inMatrix:!1,clearNoteParams:jest.fn(),blockList:{mockBlk:{connections:[0,0]}}}},o={activity:e,synth:{setMasterVolume:jest.fn(),setVolume:jest.fn(),rampTo:jest.fn(),getFrequency:jest.fn(),getCustomFrequency:jest.fn()},inPitchDrumMatrix:!1,inMatrix:!1,clearNoteParams:jest.fn()},n=new Singer(t)}),test("should initialize with correct default values",function(){expect(n.turtle).toBe(t),expect(n.turtles).toBe(t.turtles),expect(n.defaultNoteValue).toBe(4),expect(n.register).toBe(0),expect(n.beatFactor).toBe(1),expect(n.currentOctave).toBe(4)}),test("should correctly add scalar transposition",function(){var e=Singer.addScalarTransposition(o,t,"C",4,2);expect(e).toEqual(["C",4])}),test("should correctly calculate scalar distance",function(){var e=Singer.scalarDistance(o,t,60,62);expect(e).toBeGreaterThan(0)}),test("should correctly calculate inversion",function(){var e=Singer.calculateInvert(o,t,"C",4);expect(e).toBe(0)}),test("should set master volume correctly",function(){Singer.setMasterVolume(o,50,"mockBlk"),expect(o.synth.setMasterVolume).toHaveBeenCalledWith(50,0,0)}),test("should set synth volume correctly",function(){Singer.setSynthVolume(o,t,"noise1",80,"mockBlk"),expect(o.synth.setVolume).toHaveBeenCalledWith(t,"noise1",3.2,"mockBlk")})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}global._=jest.fn(function(e){return e}),global._THIS_IS_TURTLE_BLOCKS_=!0;var _require=require("../turtledefs"),createDefaultStack=_require.createDefaultStack,LOGOJA1=_require.LOGOJA1,NUMBERBLOCKDEFAULT=_require.NUMBERBLOCKDEFAULT,DEFAULTPALETTE=_require.DEFAULTPALETTE,TITLESTRING=_require.TITLESTRING;global.GUIDEURL="guide url",global.RUNBUTTON="RUNBUTTON",global.STOPBUTTON="STOPBUTTON",global.HELPTURTLEBUTTON="HELPTURTLEBUTTON",global.LANGUAGEBUTTON="LANGUAGEBUTTON","guide url"===GUIDEURL&&(GUIDEURL="https://github.com/sugarlabs/turtleblocksjs/tree/master/guide/README.md"),describe("turtledefs.js",function(){test("LOGOJA1 should be properly initialized",function(){expect(LOGOJA1).toBeDefined(),expect(_typeof(LOGOJA1)).toBe("string")}),test("NUMBERBLOCKDEFAULT should be initialized correctly",function(){expect(NUMBERBLOCKDEFAULT).toBeDefined(),expect(NUMBERBLOCKDEFAULT).toBe(100)}),test("DEFAULTPALETTE should have correct value",function(){expect(DEFAULTPALETTE).toBe("turtle")}),test("GUIDEURL should default to the correct URL",function(){expect(GUIDEURL).toBe("https://github.com/sugarlabs/turtleblocksjs/tree/master/guide/README.md")}),test("TITLESTRING should be defined",function(){expect(TITLESTRING).toBeDefined()}),test("createDefaultStack function should be callable",function(){expect(_typeof(createDefaultStack)).toBe("function")})});
var Turtles=require("../turtles");global.createjs={Container:jest.fn().mockImplementation(function(){return{addChild:jest.fn(),removeAllChildren:jest.fn(),on:jest.fn(),removeAllEventListeners:jest.fn()}}),Bitmap:jest.fn().mockImplementation(function(){return{}})},global.importMembers=jest.fn(),global.setupRhythmActions=jest.fn(),global.setupMeterActions=jest.fn(),global.setupPitchActions=jest.fn(),global.setupIntervalsActions=jest.fn(),global.setupToneActions=jest.fn(),global.setupOrnamentActions=jest.fn(),global.setupVolumeActions=jest.fn(),global.setupDrumActions=jest.fn(),global.setupDictActions=jest.fn(),global.Turtle=jest.fn().mockImplementation(function(){return{painter:{doSetHeading:jest.fn(),doSetPensize:jest.fn(),doSetChroma:jest.fn(),doSetValue:jest.fn(),doSetColor:jest.fn()},rename:jest.fn(),container:{scaleX:1,scaleY:1,scale:1,on:jest.fn(),removeAllEventListeners:jest.fn()}}}),describe("Turtles Class",function(){var e,t;beforeEach(function(){e={stage:{addChild:jest.fn(),removeChild:jest.fn()},refreshCanvas:jest.fn(),turtleContainer:new createjs.Container,hideAuxMenu:jest.fn(),hideGrids:jest.fn(),_doCartesianPolar:jest.fn()},(t=new Turtles(e)).activity=e,t.getTurtleCount=jest.fn().mockReturnValue(0),t.getTurtle=jest.fn(function(){return{container:{scaleX:1,scaleY:1,scale:1}}}),t.pushTurtle=jest.fn(),t.addTurtleStageProps=jest.fn(),t.createArtwork=jest.fn(),t.createHitArea=jest.fn(),t.addTurtleGraphicProps=jest.fn(),t.isShrunk=jest.fn().mockReturnValue(!1),document.body.innerHTML='<div id="loader"></div>'}),test("should initialize properly",function(){expect(t.activity).not.toBeUndefined(),expect(global.importMembers).toHaveBeenCalledWith(t,"",[e])}),test("should call initActions on construction",function(){var e=jest.spyOn(t,"initActions");t.initActions(),expect(e).toHaveBeenCalled()}),test("should add a turtle properly",function(){t.addTurtle({},{id:1,name:"TestTurtle"}),expect(t.getTurtleCount).toHaveBeenCalled(),expect(t.pushTurtle).toHaveBeenCalled(),expect(t.addTurtleStageProps).toHaveBeenCalled(),expect(t.createArtwork).toHaveBeenCalled(),expect(t.createHitArea).toHaveBeenCalled(),expect(t.addTurtleGraphicProps).toHaveBeenCalled(),expect(t.isShrunk).toHaveBeenCalled()}),test("should toggle running state correctly",function(){t.markAllAsStopped(),expect(e.refreshCanvas).toHaveBeenCalled()})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(t,e,n){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,n||[],_getPrototypeOf(t).constructor):e.apply(t,n))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function setupActionBlocks(g){var t=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["return"])).setPalette("action",g),t.setHelpString([_("The Return block will return a value from an action."),"documentation",""]),t.formBlock({name:_("return"),args:1,defaults:[100],argTypes:["anyin"]}),t}return _inherits(e,FlowBlock),_createClass(e,[{key:"flow",value:function(t,e,n){1===t.length&&e.returns[n].push(t[0])}}])})(),e=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["returnToUrl"])).setPalette("action",g),t.setHelpString([_("The Return to URL block will return a value to a webpage."),"documentation",""]),t.formBlock({name:_("return to URL"),args:1,defaults:[100],argTypes:["anyin"]}),t}return _inherits(e,FlowBlock),_createClass(e,[{key:"flow",value:function(t){var e,n,r=this.getHref();if(0<r.indexOf("?")&&0<(r=r.split("?"))[1].indexOf("&"))for(var o,a=r[1].split("&"),l=0;l<a.length;l++)0<a[l].indexOf("=")&&"outurl"===(o=a[l].split("="))[0].toLowerCase()&&(e=o[1]);1===t.length&&((r={}).result=t[0],t=JSON.stringify(r),(n=new XMLHttpRequest).open("POST",e,!0),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&alert(n.responseText)},n.send(t))}},{key:"getHref",value:function(){return window.location.href}}])})(),n=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["calc"])).setPalette("action",g),t.setHelpString([_("The Calculate block returns a value calculated by an action."),"documentation",""]),t.formBlock({name:_("calculate"),outType:"anyout",args:1,defaults:[_("action")],argTypes:["anyin"]}),t}return _inherits(e,LeftBlock),_createClass(e)})(),r=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["namedcalc"])).setPalette("action",g),t.setHelpString([_("The Calculate block returns a value calculated by an action."),"documentation",""]),t.extraWidth=20,t.formBlock({name:_("action")}),t}return _inherits(e,ValueBlock),_createClass(e,[{key:"arg",value:function(t,e,n,r){var o=g.blocks.blockList[n].privateData;return o in t.actions?(g.turtles.getTurtle(e).running=!0,t.runFromBlockNow(t,e,t.actions[o],!0,r,g.turtles.getTurtle(e).queue.length),t.returns[e].shift()):(g.errorMsg(NOACTIONERRORMSG,n,o),0)}}])})(),o=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["nameddoArg"])).setPalette("action",g),t.setHelpString([_("The Do block is used to initiate an action."),"documentation",""]),t.formBlock({name:"ja"===t.lang?_("do1"):_("do"),flows:{type:"arg",types:["anyin"]}}),t}return _inherits(e,FlowClampBlock),_createClass(e,[{key:"flow",value:function(t,e,n,r,o,a){for(var l=g.blocks.blockList[r].privateData;0<a.length;)a.pop();if(0<g.blocks.blockList[r].argClampSlots.length)for(var s,i=0;i<g.blocks.blockList[r].argClampSlots.length;i++)null!=g.blocks.blockList[r].connections[i+1]?(s=e.parseArg(e,n,g.blocks.blockList[r].connections[i+1],r,o),a.push(s)):a.push(null);var c,u,p,f=g.turtles.ithTurtle(n);if(l in e.actions)return 0===f.singer.justCounting.length&&e.notation.notationLineBreak(n),0<f.singer.backward.length?(c=g.blocks.findBottomBlock(e.actions[l]),p=g.blocks.findTopBlock(e.actions[l]),f.singer.backward.push(p),e.setDispatchBlock(r,n,u="_backward_action_"+n+"_"+r),null===(p=g.blocks.blockList[p].connections[2])?f.singer.backward.pop():p in f.endOfClampSignals?f.endOfClampSignals[p].push(u):f.endOfClampSignals[p]=[u],e.setTurtleListener(n,u,function(t){return f.singer.backward.pop()})):c=e.actions[l],[c,1];g.errorMsg(NOACTIONERRORMSG,r,l)}}])})(),a=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["namedcalcArg"])).setPalette("action",g),t.setHelpString([_("The Calculate block returns a value calculated by an action."),"documentation",""]),t.formBlock({name:_("calculate"),flows:{type:"arg",types:["anyin"],labels:[""]},outType:"anyout"}),t}return _inherits(e,LeftBlock),_createClass(e,[{key:"arg",value:function(t,e,n,r){var o=g.blocks.blockList[n].privateData,a=[];if(0<g.blocks.blockList[n].argClampSlots.length)for(var l=0;l<g.blocks.blockList[n].argClampSlots.length;l++){var s=t.parseArg(t,e,g.blocks.blockList[n].connections[l+1],n,r);a.push(s)}return o in t.actions?(g.turtles.getTurtle(e).running=!0,t.runFromBlockNow(t,e,t.actions[o],!0,a,g.turtles.getTurtle(e).queue.length),t.returns[e].pop()):(g.errorMsg(NOACTIONERRORMSG,n,o),0)}}])})(),l=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["doArg"])).setPalette("action",g),t.setHelpString([_("The Do block is used to initiate an action."),"documentation",""]),t.formBlock({name:"ja"===t.lang?_("do1"):_("do"),flows:{type:"arg",types:["anyin"]},args:1,argTypes:["anyin"],defaults:[_("action")]}),t}return _inherits(e,FlowClampBlock),_createClass(e,[{key:"flow",value:function(t,e,n,r,o,a){for(;0<a.length;)a.pop();if(0<g.blocks.blockList[r].argClampSlots.length)for(var l,s=0;s<g.blocks.blockList[r].argClampSlots.length;s++)null!=g.blocks.blockList[r].connections[s+2]?(l=e.parseArg(e,n,g.blocks.blockList[r].connections[s+2],r,o),a.push(l)):a.push(null);if(1<=t.length){if(t[0]in e.actions)return 0===g.turtles.ithTurtle(n).singer.justCounting.length&&e.notation.notationLineBreak(n),[e.actions[t[0]],1];g.errorMsg(NOACTIONERRORMSG,r,t[0])}}}])})(),s=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["calcArg"])).setPalette("action",g),t.setHelpString([_("The Calculate block returns a value calculated by an action."),"documentation",""]),t.formBlock({name:_("calculate"),outType:"anyout",flows:{type:"arg",types:["anyin"],labels:[""]},args:1,argTypes:["anyin"],defaults:[_("action")]}),t}return _inherits(e,LeftBlock),_createClass(e,[{key:"arg",value:function(t,e,n,r){var o=[];if(0<g.blocks.blockList[n].argClampSlots.length)for(var a=0;a<g.blocks.blockList[n].argClampSlots.length;a++){var l=t.parseArg(t,e,g.blocks.blockList[n].connections[a+2],n,r);o.push(l)}var s=g.blocks.blockList[n].connections[1];return null===s?(g.errorMsg(NOINPUTERRORMSG,n),0):(s=t.parseArg(t,e,s,n,r))in t.actions?(g.turtles.getTurtle(e).running=!0,t.runFromBlockNow(t,e,t.actions[s],!0,o,g.turtles.getTurtle(e).queue.length),t.returns[e].pop()):(g.errorMsg(NOACTIONERRORMSG,n,s),0)}}])})(),i=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["arg"])).setPalette("action",g),t.setHelpString([_("The Arg block contains the value of an argument passed to an action."),"documentation",""]),t.formBlock({name:_("arg"),outType:"anyout",args:1,defaults:[1],argTypes:["numberin"]}),t}return _inherits(e,LeftBlock),_createClass(e,[{key:"arg",value:function(t,e,n,r){var o=g.blocks.blockList[n].connections[1];return null===o?(g.errorMsg(NOINPUTERRORMSG,n),0):(t=t.parseArg(t,e,o,n,r),(e=r)&&e.length>=Number(t)?e[Number(t)-1]:(g.errorMsg(_("Invalid argument"),n),0))}}])})(),c=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["namedarg"])).setPalette("action",g),t.setHelpString([_("The Arg block contains the value of an argument passed to an action."),"documentation",""]),t.formBlock({name:_("arg")+1,flows:{type:"value"}}),t}return _inherits(e,LeftBlock),_createClass(e,[{key:"arg",value:function(t,e,n,r){var o=g.blocks.blockList[n].privateData;return null!==r&&r.length>=Number(o)?r[Number(o)-1]:(g.errorMsg(_("Invalid argument"),n),0)}}])})(),u=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["do"])).setPalette("action",g),t.beginnerBlock(!0),t.setHelpString([_("The Do block is used to initiate an action.")+" "+_("In the example, it is used with the One of block to choose a random phase."),"documentation",null,"dohelp"]),t.formBlock({name:"ja"===t.lang?_("do1"):_("do"),args:1,defaults:[_("action")],argTypes:["anyin"]}),t}return _inherits(e,FlowBlock),_createClass(e,[{key:"flow",value:function(t,e,n,r){if(0!==t.length){if(t[0]in e.actions)return 0===g.turtles.ithTurtle(n).singer.justCounting.length&&e.notation.notationLineBreak(n),[e.actions[t[0]],1];console.debug("action "+t[0]+" not found"),g.errorMsg(NOACTIONERRORMSG,r,t[0])}}}])})(),p=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["listen"])).setPalette("action",g),t.beginnerBlock(!0),"ja"===t.lang?(t.extraWidth=15,t.setHelpString([_("The Listen block is used to listen for an event such as a mouse click."),"documentation",null,"broadcasthelp"])):t.setHelpString([_("The Listen block is used to listen for an event such as a mouse click.")+" "+_("When the event happens, an action is taken."),"documentation",null,"broadcasthelp"]),t.formBlock({name:_("on"),args:2,argTypes:["anyin","anyin"],argLabels:[_("event"),"ja"===t.lang?_("do1"):_("do")],defaults:[_("event"),_("action")]}),t}return _inherits(e,FlowBlock),_createClass(e,[{key:"flow",value:function(n,r,o,a,l){var s;2===n.length&&(n[1]in r.actions?(s=g.turtles.ithTurtle(o),r.setTurtleListener(o,n[0],function(t){var e;s.running?(e=new Queue(r.actions[n[1]],1,a),s.parentFlowQueue.push(a),s.queue.push(e)):(s.singer.runningFromEvent=!0,e=((new Date).getTime()-g.logo.firstNoteTime)/1e3,s.singer.turtleTime=e,r.runFromBlockNow(r,o,r.actions[n[1]],!1,l))})):g.errorMsg(NOACTIONERRORMSG,a,n[1]))}}])})(),f=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["dispatch"])).setPalette("action",g),t.beginnerBlock(!0),t.setHelpString([_("The Broadcast block is used to trigger an event."),"documentation",null,"broadcasthelp"]),t.formBlock({name:_("broadcast"),args:1,defaults:[_("event")],argTypes:["anyin"]}),t}return _inherits(e,FlowBlock),_createClass(e,[{key:"flow",value:function(t,e){var n;1===t.length&&(t[0]in e.eventList||(n=new Event(t[0]),e.eventList[t[0]]=n),g.stage.dispatchEvent(t[0]))}}])})(),h=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["start"])).setPalette("action",g),t.beginnerBlock(!0),t.setHelpString([_("Each Start block is a separate voice.")+" "+_("All of the Start blocks run at the same time when the Play button is pressed."),"documentation",""]),t.formBlock({name:_("start"),canCollapse:!0}),t}return _inherits(e,StackClampBlock),_createClass(e,[{key:"flow",value:function(t){if(1===t.length)return[t[0],1]}}])})(),k=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e)).changeName("startdrum"),t.formBlock({name:_("start drum")}),t.makeMacro(function(t,e){return[[0,"start",t,e,[null,1,null]],[1,"setdrum",0,0,[0,2,null,3]],[2,["drumname",{value:"kick drum"}],0,0,[1]],[3,"hidden",0,0,[1,null]]]}),t}return _inherits(e,h),_createClass(e)})(),d=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["action"])).setPalette("action",g),t.beginnerBlock(!0),t.setHelpString([_("The Action block is used to group together blocks so that they can be used more than once.")+" "+_("It is often used for storing a phrase of music that is repeated."),"documentation",null,"actionhelp"]),t.formBlock({canCollapse:!0,name:_("action"),args:1,argLabels:[""],defaults:[_("action")],argTypes:["anyin"]}),t.makeMacro(function(t,e){return[[0,"action",t,e,[null,1,2,null]],[1,["text",{value:_("action")}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),t}return _inherits(e,StackClampBlock),_createClass(e,[{key:"flow",value:function(t,e,n,r){if(0!==t.length){if(t[0]in e.actions)return 0===g.turtles.ithTurtle(n).singer.justCounting.length&&e.notation.notationLineBreak(n),[e.actions[t[0]],1];console.debug("action "+t[0]+" not found"),g.errorMsg(NOACTIONERRORMSG,r,t[0])}}}])})(),b=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["nameddo"])).setPalette("action",g),t.setHelpString([_("The Do block is used to initiate an action."),"documentation",""]),t.extraWidth=30,t.formBlock({name:_("action")}),t.hidden=!0,t}return _inherits(e,FlowBlock),_createClass(e,[{key:"flow",value:function(t,e,n,r){var o,a,l=g.blocks.blockList[r].privateData,s=(l in e.actions||g.errorMsg(NOACTIONERRORMSG,r,l),g.turtles.ithTurtle(n));return 0===s.singer.justCounting.length&&e.notation.notationLineBreak(n),0<s.singer.backward.length?(o=g.blocks.findBottomBlock(e.actions[l]),a=g.blocks.findTopBlock(e.actions[l]),s.singer.backward.push(a),e.setDispatchBlock(r,n,r="_backward_action_"+n+"_"+r),null===(a=g.blocks.blockList[a].connections[2])?s.singer.backward.pop():a in s.endOfClampSignals?s.endOfClampSignals[a].push(r):s.endOfClampSignals[a]=[r],e.setTurtleListener(n,r,function(t){return s.singer.backward.pop()})):o=e.actions[l],[o,1]}}])})(),m=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e,["temperament1"])).setPalette("action",g),t.formBlock({name:_("define temperament"),args:1,canCollapse:!0,argLabels:[""],defaults:["custom"],argTypes:["text"]}),t.makeMacro(function(t,e){return[[0,"temperament1",t,e,[null,1,2,null]],[1,["text",{value:"custom"}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),t.hidden=!0,t}return _inherits(e,StackClampBlock),_createClass(e,[{key:"flow",value:function(){}}])})();(new t).setup(g),(new e).setup(g),(new n).setup(g),(new r).setup(g),(new o).setup(g),(new a).setup(g),(new l).setup(g),(new s).setup(g),(new i).setup(g),(new c).setup(g),(new u).setup(g),(new p).setup(g),(new f).setup(g),(new k).setup(g),(new h).setup(g),(new d).setup(g),(new b).setup(g),(new m).setup(g)}"undefined"!=typeof module&&module.exports&&(module.exports={setupActionBlocks:setupActionBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupBooleanBlocks(a){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["not"])).setPalette("boolean",a),e.setHelpString([_("The Not block is the logical not operator."),"documentation",""]),e.parameter=!0,e.formBlock({name:_("not"),args:1,argTypes:["booleanin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1];if(null===n)return a.errorMsg(NOINPUTERRORMSG,r),!1;e=e.parseArg(e,t,n,r,o);try{return!e}catch(e){return console.debug(e),a.errorMsg(NOINPUTERRORMSG,r),!1}}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["and"])).setPalette("boolean",a),e.setHelpString([_("The And block is the logical and operator."),"documentation",""]),e.parameter=!0,e.formBlock({name:_("and"),args:2,argTypes:["booleanin","booleanin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1],l=a.blocks.blockList[r].connections[2];return null===n||null===l?(a.errorMsg(NOINPUTERRORMSG,r),!1):(n=e.parseArg(e,t,n,r,o),e=e.parseArg(e,t,l,r,o),n&&e)}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["or"])).setPalette("boolean",a),e.setHelpString([_("The Or block is the logical or operator."),"documentation",""]),e.parameter=!0,e.formBlock({name:_("or"),args:2,argTypes:["booleanin","booleanin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1],l=a.blocks.blockList[r].connections[2];return null===n||null===l?(a.errorMsg(NOINPUTERRORMSG,r),!1):(n=e.parseArg(e,t,n,r,o),e=e.parseArg(e,t,l,r,o),n||e)}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["xor"])).setPalette("boolean",a),e.setHelpString([_("The XOR block is the logical XOR operator."),"documentation",""]),e.parameter=!0,e.formBlock({name:_("xor"),args:2,argTypes:["booleanin","booleanin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1],l=a.blocks.blockList[r].connections[2];return null===n||null===l?(a.errorMsg(NOINPUTERRORMSG,r),!1):(n=e.parseArg(e,t,n,r,o),e=e.parseArg(e,t,l,r,o),n&&!e||!n&&e)}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["greater"])).setPalette("boolean",a),e.beginnerBlock(!0),e.setHelpString([_("The Greater-than block returns True if the top number is greater than the bottom number."),"documentation",""]),e.fontsize=14,e.parameter=!0,e.formBlock({name:">",args:2,argTypes:["numberin","numberin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1],l=a.blocks.blockList[r].connections[2];if(null===n||null===l)return a.errorMsg(NOINPUTERRORMSG,r),!1;n=e.parseArg(e,t,n,r,o),e=e.parseArg(e,t,l,r,o);try{return Number(n)>Number(e)}catch(e){return console.debug(e),a.errorMsg(NOINPUTERRORMSG,r),!1}}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["less"])).setPalette("boolean",a),e.beginnerBlock(!0),e.setHelpString([_("The Less-than block returns True if the top number is less than the bottom number."),"documentation",""]),e.fontsize=14,e.parameter=!0,e.formBlock({name:"<",args:2,argTypes:["numberin","numberin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1],l=a.blocks.blockList[r].connections[2];if(null===n||null===l)return a.errorMsg(NOINPUTERRORMSG,r),!1;n=e.parseArg(e,t,n,r,o),e=e.parseArg(e,t,l,r,o);try{return Number(n)<Number(e)}catch(e){return console.debug(e),a.errorMsg(NOINPUTERRORMSG,r),!1}}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["less_than_or_equal_to"])).setPalette("boolean",a),e.setHelpString([_("The Less-than-or-equal-to block returns True if the top number is less than or equal to the bottom number."),"documentation",""]),e.fontsize=14,e.parameter=!0,e.formBlock({name:"≤",args:2,argTypes:["numberin","numberin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1],l=a.blocks.blockList[r].connections[2];if(null===n||null===l)return a.errorMsg(NOINPUTERRORMSG,r),!1;n=e.parseArg(e,t,n,r,o),e=e.parseArg(e,t,l,r,o);try{return Number(n)<=Number(e)}catch(e){return console.debug(e),a.errorMsg(NOINPUTERRORMSG,r),!1}}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["greater_than_or_equal_to"])).setPalette("boolean",a),e.setHelpString([_("The Greater-than-or-equal-to block returns True if the top number is greater than or equal to the bottom number."),"documentation",""]),e.fontsize=14,e.parameter=!0,e.formBlock({name:"≥",args:2,argTypes:["numberin","numberin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1],l=a.blocks.blockList[r].connections[2];if(null===n||null===l)return a.errorMsg(NOINPUTERRORMSG,r),!1;n=e.parseArg(e,t,n,r,o),e=e.parseArg(e,t,l,r,o);try{return Number(n)>=Number(e)}catch(e){return console.debug(e),a.errorMsg(NOINPUTERRORMSG,r),!1}}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["equal"])).setPalette("boolean",a),e.beginnerBlock(!0),e.setHelpString([_("The Equal block returns True if the two numbers are equal."),"documentation",""]),e.fontsize=14,e.parameter=!0,e.formBlock({name:"=",args:2,argTypes:["anyin","anyin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1],l=a.blocks.blockList[r].connections[2];if(null===n||null===l)return a.errorMsg(NOINPUTERRORMSG,r),!1;n=e.parseArg(e,t,n,r,o),e=e.parseArg(e,t,l,r,o);try{return n===e}catch(e){return console.debug(e),a.errorMsg(NOINPUTERRORMSG,r),!1}}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["not_equal_to"])).setPalette("boolean",a),e.setHelpString([_("The Not-equal-to block returns True if the two numbers are not equal to each other."),"documentation",""]),e.fontsize=14,e.parameter=!0,e.formBlock({name:"!=",args:2,argTypes:["anyin","anyin"]}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return a.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(e,t,r,o){var n=a.blocks.blockList[r].connections[1],l=a.blocks.blockList[r].connections[2];if(null===n||null===l)return a.errorMsg(NOINPUTERRORMSG,r),!1;n=e.parseArg(e,t,n,r,o),e=e.parseArg(e,t,l,r,o);try{return n!==e}catch(e){return console.debug(e),a.errorMsg(NOINPUTERRORMSG,r),!1}}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["boolean"])).setPalette("boolean",a),e.setHelpString([_("The Boolean block is used to specify true or false."),"documentation",""]),e.formBlock({name:"boolean"}),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"arg",value:function(e,t,r){return"string"==typeof a.blocks.blockList[r].value?a.blocks.blockList[r].value===_("true")||"true"===a.blocks.blockList[r].value:a.blocks.blockList[r].value}}])})();(new e).setup(a),(new o).setup(a),(new t).setup(a),(new r).setup(a),(new u).setup(a),(new s).setup(a),(new n).setup(a),(new l).setup(a),(new i).setup(a),(new c).setup(a),(new b).setup(a)}"undefined"!=typeof module&&module.exports&&(module.exports={setupBooleanBlocks:setupBooleanBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _superPropGet(e,t,o,r){var n=_get(_getPrototypeOf(1&r?e.prototype:e),t,o);return 2&r&&"function"==typeof n?function(e){return n.apply(o,e)}:n}function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,o){var r=_superPropBase(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:o):r.value}).apply(null,arguments)}function _superPropBase(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupBoxesBlocks(s){var e=(()=>{function t(e){return _classCallCheck(this,t),(e=_callSuper(this,t,[e||"increment"])).setPalette("boxes",s),e.beginnerBlock(!0),s.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Add-to block is used to add to the value stored in a box."),"documentation",""]):e.setHelpString([_("The Add-to block is used to add to the value stored in a box.")+" "+_("It can also be used with other blocks such as Color and Pen size."),"documentation",""]),e.formBlock({name:_("add"),args:2,argLabels:[_("to"),"ja"===e.lang?_("value1"):_("value")],argTypes:["anyin","anyin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,r){var n=2===e.length?e[1]:1;if(0<e.length){r=s.blocks.blockList[r].connections[1];if("text"===s.blocks.blockList[r].name){var l=s.blocks.blockList[r].value;if(l in t.boxes)return void(t.boxes[l]=t.boxes[l]+n)}l=e[0]+n;"namedbox"===s.blocks.blockList[r].name&&-1!==(e=SOLFEGENAMES.indexOf(s.blocks.blockList[r].value))&&(l=SOLFEGENAMES[(e=e>=SOLFEGENAMES.length?0:e)+n]);try{s.blocks.blockSetter(t,r,l,o)}catch(e){s.errorMsg(_("Block does not support incrementing."),r)}}}}])})(),t=(()=>{function n(){var e;return _classCallCheck(this,n),(e=_callSuper(this,n,["incrementOne"])).setPalette("boxes",s),e.beginnerBlock(!0),e.setHelpString([_("The Add-1-to block adds one to the value stored in a box."),"documentation",""]),e.formBlock({name:_("add 1 to"),args:1,argTypes:["anyin"],argLabels:[""]}),e}return _inherits(n,e),_createClass(n,[{key:"flow",value:function(e,t,o,r){e[1]=1,_superPropGet(n,"flow",this,3)([e,t,o,r])}}])})(),o=(()=>{function n(){var e;return _classCallCheck(this,n),(e=_callSuper(this,n,["decrementOne"])).setPalette("boxes",s),e.beginnerBlock(!0),e.setHelpString([_("The Subtract-1-from block subtracts one from the value stored in a box."),"documentation",""]),e.formBlock({name:_("subtract 1 from"),args:1,argTypes:["anyin"],argLabels:[""]}),e}return _inherits(n,e),_createClass(n,[{key:"flow",value:function(e,t,o,r){e[1]=-1,_superPropGet(n,"flow",this,3)([e,t,o,r])}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["box"])).setPalette("boxes",s),e.parameter=!0,e.setHelpString([_("The Box block returns the value stored in a box."),"documentation",null,"box1help"]),e.formBlock({name:_("box"),outType:"anyout",args:1,defaults:[_("box")],argTypes:["anyin"]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,o){var r=s.blocks.blockList[o].connections[1],t=e.parseArg(e,t,r,o,e.receivedArg);return t in e.boxes?e.boxes[t]:(s.errorMsg(NOBOXERRORMSG,o,t),0)}},{key:"setter",value:function(e,t,o,r){var n=s.blocks.blockList[r].connections[1],o=e.parseArg(e,o,n,r,e.receivedArg);o in e.boxes?e.boxes[o]=t:s.errorMsg(NOBOXERRORMSG,r,o)}},{key:"arg",value:function(e,t,o,r){var n=s.blocks.blockList[o].connections[1];return null===n?(s.errorMsg(NOINPUTERRORMSG,o),0):(t=e.parseArg(e,t,n,o,r))in e.boxes?e.boxes[t]:(s.errorMsg(NOBOXERRORMSG,o,t),0)}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["namedbox"])).setPalette("boxes",s),e.beginnerBlock(!0),e.parameter=!0,e.setHelpString([_("The Box block returns the value stored in a box."),"documentation",""]),e.extraWidth=20,e.formBlock({name:_("box"),outType:"anyout"}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,o){var r=s.blocks.blockList[o].privateData;return r in e.boxes?e.boxes[r]:(s.errorMsg(NOBOXERRORMSG,o,r),0)}},{key:"setter",value:function(e,t,o,r){var n=s.blocks.blockList[r].privateData;n in e.boxes?e.boxes[n]=t:s.errorMsg(NOBOXERRORMSG,r,n)}},{key:"arg",value:function(e,t,o){var r=s.blocks.blockList[o].privateData;if(e.inStatusMatrix&&"print"===s.blocks.blockList[s.blocks.blockList[o].connections[0]].name)e.statusFields.push([o,s.blocks.blockList[o].name]);else if(!e.updatingStatusMatrix)return r in e.boxes?e.boxes[r]:(s.errorMsg(NOBOXERRORMSG,o,r),0)}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["storein2"])).setPalette("boxes",s),e.beginnerBlock(!0),e.setHelpString([_("The Store in block will store a value in a box."),"documentation",""]),e.formBlock({name:_("store in box"),args:1,argTypes:["anyin"],defaults:[4]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,r){1===e.length&&(r=s.blocks.blockList[r].privateData,t.boxes[r]=e[0])}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["storein"])).setPalette("boxes",s),e.beginnerBlock(!0),e.setHelpString([_("The Store in block will store a value in a box."),"documentation",""]),e.formBlock({name:_("store in"),args:2,argTypes:["anyin","anyin"],defaults:[_("box"),4],argLabels:"ja"===e.lang?[_("name1"),_("value1")]:[_("name"),_("value")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t){2===e.length&&(t.boxes[e[0]]=e[1])}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["box2"])).setPalette("boxes",s),e.beginnerBlock(!0),e.setHelpString([_("The Box2 block returns the value stored in Box2."),"documentation",null,"box2help"]),e.formBlock({name:_("box2")}),e.makeMacro(function(e,t){return[[0,["namedbox",{value:"box2"}],e,t,[null]]]}),e}return _inherits(t,ValueBlock),_createClass(t)})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["storebox2"])).setPalette("boxes",s),e.beginnerBlock(!0),e.setHelpString([_("The Store in Box2 block is used to store a value in Box2."),"documentation",null,"box2help"]),e.formBlock({name:_("store in box2"),args:1,defaults:[4]}),e.makeMacro(function(e,t){return[[0,["storein2",{value:"box2"}],e,t,[null,1,null]],[1,["number",{value:4}],e,t,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["box1"])).setPalette("boxes",s),e.beginnerBlock(!0),e.setHelpString([_("The Box1 block returns the value stored in Box1."),"documentation",null,"box1help"]),e.formBlock({name:_("box1")}),e.makeMacro(function(e,t){return[[0,["namedbox",{value:"box1"}],e,t,[null]]]}),e}return _inherits(t,ValueBlock),_createClass(t)})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["storebox1"])).setPalette("boxes",s),e.beginnerBlock(!0),e.setHelpString([_("The Store in Box1 block is used to store a value in Box1."),"documentation",null,"box1help"]),e.formBlock({name:_("store in box1"),args:1,defaults:[4]}),e.makeMacro(function(e,t){return[[0,["storein2",{value:"box1"}],e,t,[null,1,null]],[1,["number",{value:4}],e,t,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})();(new o).setup(s),(new t).setup(s),(new e).setup(s),(new r).setup(s),(new n).setup(s),(new l).setup(s),(new a).setup(s),(new i).setup(s),(new c).setup(s),(new u).setup(s),(new b).setup(s)}"undefined"!=typeof module&&module.exports&&(module.exports={setupBoxesBlocks:setupBoxesBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupDictBlocks(a){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["showDict"])).setPalette("dictionary",a),e.beginnerBlock(!0),e.hidden=!0,e.deprecated=!0,e.setHelpString([_("The Show-dictionary block displays the contents of the dictionary at the top of the screen."),"documentation",""]),e.formBlock({name:_("show dictionary"),args:1,argTypes:["anyin"],defaults:[_("My Dictionary")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?a.errorMsg(NOINPUTERRORMSG,n):Turtle.DictActions.showDict(e[0],r)}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["dictionary"])).setPalette("dictionary",a),e.beginnerBlock(!0),e.setHelpString([_("The Dictionary block returns a dictionary."),"documentation",""]),e.formBlock({name:_("dictionary"),args:1,argTypes:["anyin"],defaults:[_("My Dictionary")]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,n){var o=a.blocks.blockList[r].connections[1];return null===o?(a.errorMsg(NOINPUTERRORMSG,r),0):(e=e.parseArg(e,t,o,r,n),Turtle.DictActions.getDict(e,t))}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["getDict"])).setPalette("dictionary",a),e.beginnerBlock(!0),e.setHelpString([_("The Get-dict block returns a value in the dictionary for a specified key."),"documentation",""]),e.formBlock({name:_("get value"),args:2,argTypes:["anyin","anyin"],argLabels:[_("name"),"ja"===e.lang?_("key2"):_("key")],defaults:[_("My Dictionary"),"ja"===e.lang?_("key2"):_("key")]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,n){var o=a.blocks.blockList[r].connections[1],i=a.blocks.blockList[r].connections[2];return null===o||null===i?(a.errorMsg(NOINPUTERRORMSG,r),0):(o=e.parseArg(e,t,o,r,n),e=e.parseArg(e,t,i,r,n),Turtle.DictActions.getValue(o,e,t,r))}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setDict"])).setPalette("dictionary",a),e.beginnerBlock(!0),e.setHelpString([_("The Set-dict block sets a value in the dictionary for a specified key."),"documentation",""]),e.formBlock({name:_("set value"),args:3,argTypes:["anyin","anyin","anyin"],argLabels:[_("name"),"ja"===e.lang?_("key2"):_("key"),_("value")],defaults:[_("My Dictionary"),"ja"===e.lang?_("key2"):_("key"),0]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]||null===e[1]||null===e[2]?a.errorMsg(NOINPUTERRORMSG,n):(n=Turtle.DictActions).setValue.apply(n,_toConsumableArray(e).concat([r]))}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["getDict2"])).setPalette("dictionary",a),e.beginnerBlock(!0),e.setHelpString([_("The Get-dict block returns a value in the dictionary for a specified key."),"documentation",""]),e.formBlock({name:_("get value"),args:1,argTypes:["anyin"],defaults:["ja"===e.lang?_("key2"):_("key")]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,n){var o,i=a.blocks.blockList[r].connections[1];return null===i?(a.errorMsg(NOINPUTERRORMSG,r),0):(o=a.turtles.ithTurtle(t).name,e=e.parseArg(e,t,i,r,n),Turtle.DictActions.getValue(o,e,t,r))}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setDict2"])).setPalette("dictionary",a),e.beginnerBlock(!0),e.setHelpString([_("The Set-dict block sets a value in the dictionary for a specified key."),"documentation",""]),e.formBlock({name:_("set value"),args:2,argTypes:["anyin","anyin"],argLabels:["ja"===e.lang?_("key2"):_("key"),_("value")],defaults:["ja"===e.lang?_("key2"):_("key"),0]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]||null===e[1]?a.errorMsg(NOINPUTERRORMSG,n):(n=Turtle.DictActions).setValue.apply(n,[a.turtles.ithTurtle(r).name].concat(_toConsumableArray(e),[r]))}}])})();(new t).setup(a),(new e).setup(a),(new n).setup(a),(new r).setup(a),(new i).setup(a),(new o).setup(a)}"undefined"!=typeof module&&module.exports&&(module.exports={setupDictBlocks:setupDictBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _construct(e,t,r){var n;return _isNativeReflectConstruct()?Reflect.construct.apply(null,arguments):((n=[null]).push.apply(n,t),t=new(e.bind.apply(e,n)),r&&_setPrototypeOf(t,r.prototype),t)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupDrumBlocks(u){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["noisename",_("noise name")])).setPalette("drum",u),e.formBlock({outType:"textout"}),e.extraWidth=50,e.setHelpString([_("The Noise name block is used to select a noise synthesizer."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t)})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["drumname",_("drum name")])).setPalette("drum",u),e.formBlock({outType:"textout"}),e.extraWidth=50,e.setHelpString([_("The Drum name block is used to select a drum."),"documentation",null,"note4"]),e}return _inherits(t,ValueBlock),_createClass(t)})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["effectsname",_("effects name")])).setPalette("drum",u),e.formBlock({outType:"textout"}),e.extraWidth=50,e.setHelpString([_("The Effects name block is used to select a sound effect."),"documentation",null,"effectshelp"]),e}return _inherits(t,ValueBlock),_createClass(t)})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["playnoise",_("noise")])).setPalette("drum",u),e.setHelpString([_("The Play noise block will generate white, pink, or brown noise."),"documentation",""]),e.formBlock({args:1,defaults:[_("white noise")],argTypes:["anyin"]}),e.makeMacro(function(e,t){return[[0,"playnoise",e,t,[null,1,null]],[1,["noisename",{value:DEFAULTNOISE}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o=e[0];1===e.length&&null!=o&&"string"==typeof o||(u.errorMsg(NOINPUTERRORMSG,n),o="noise1"),Singer.DrumActions.playNoise(o,r,n)}}])})();var o,l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mapdrum"])).setPalette("drum",u),e.setHelpString([_("Replace every instance of a pitch with a drum sound."),"documentation",null,"mapdrumhelp"]),e.formBlock({name:_("map pitch to drum"),args:1,argTypes:["anyin"]}),e.makeMacro(function(e,t){return[[0,"mapdrum",e,t,[null,1,3,2]],[1,["drumname",{value:"kick drum"}],0,0,[0]],[2,"hidden",0,0,[0,null]],[3,"pitch",0,0,[0,4,5,null]],[4,["solfege",{value:"sol"}],0,0,[3]],[5,["number",{value:4}],0,0,[3]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){return Singer.DrumActions.mapPitchToDrum(e[0],r,n),[e[1],1]}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setdrum"])).setPalette("drum",u),e.beginnerBlock(!0),u.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Set drum block will select a drum sound to replace the pitch of any contained notes."),"documentation",null,"rhythmruler2"]):e.setHelpString([_("The Set drum block will select a drum sound to replace the pitch of any contained notes.")+" "+_("In the example above, a kick drum sound will be played instead of sol."),"documentation",null,"setdrumhelp"]),e.formBlock({name:_("set drum"),args:1,argTypes:["anyin"]}),e.makeMacro(function(e,t){return[[0,"setdrum",e,t,[null,1,2,7]],[1,["drumname",{value:DEFAULTDRUM}],0,0,[0]],[2,"rhythm2",0,0,[0,3,4,null]],[3,["number",{value:1}],0,0,[2]],[4,"divide",0,0,[2,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:1}],0,0,[4]],[7,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){return Singer.DrumActions.setDrum(e[0],r,n),[e[1],1]}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["playeffect",_("sound effect")])).setPalette("drum",u),e.beginnerBlock(!0),e.formBlock({args:1,argTypes:["anyin"]}),e.makeMacro(function(e,t){return[[0,"playdrum",e,t,[null,1,null]],[1,["effectsname",{value:DEFAULTEFFECT}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["playdrum",_("drum")])).setPalette("drum",u),e.beginnerBlock(!0),e.setHelpString([_("You can use multiple Drum blocks within a Note block."),"documentation",null,"note4"]),e.formBlock({args:1,argTypes:["anyin"]}),e.makeMacro(function(e,t){return[[0,"playdrum",e,t,[null,1,null]],[1,["drumname",{value:DEFAULTDRUM}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o=e[0],o=(1===e.length&&null!=o&&"string"==typeof o||(u.errorMsg(NOINPUTERRORMSG,n),DEFAULTDRUM),Singer.DrumActions.GetDrumname(e[0])),l=u.turtles.ithTurtle(r);if(0<l.singer.drumStyle.length&&(o=last(l.singer.drumStyle)),t.inPitchDrumMatrix)t.pitchDrumMatrix.drums.push(o),t.pitchDrumMatrix.addColBlock(n),t.drumBlocks.includes(n)||t.drumBlocks.push(n);else if(t.inMatrix)t.phraseMaker.rowLabels.push(o),t.phraseMaker.rowArgs.push(-1),t.phraseMaker.addRowBlock(n),t.drumBlocks.includes(n)||t.drumBlocks.push(n);else if(t.inMusicKeyboard)t.musicKeyboard.instruments.push(o),t.musicKeyboard.noteNames.push("drum"),t.musicKeyboard.octaves.push(null),t.musicKeyboard.addRowBlock(n);else{if(!(0<l.singer.inNoteBlock.length||null==u.blocks.blockList[n].connections[0]&&null==last(u.blocks.blockList[n].connections)))return void console.debug("PLAY DRUM ERROR: missing context");Singer.DrumActions.playDrum(e[0],r,n)}0<l.singer.inNoteBlock.length&&l.singer.noteBeatValues[last(l.singer.inNoteBlock)].push(l.singer.beatFactor),l.singer.pushedNote=!0}}])})();(new e).setup(u),(new t).setup(u),(new r).setup(u),(new n).setup(u),o=(()=>{function t(r,n,o,l){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,void 0===n?[r,_(r)]:[r,_(n)])).setPalette("drum",u),e.formBlock({args:1}),e.makeMacro(function(e,t){return[[0,"playdrum",e,t,[null,1,null]],[1,[o?"drumname":"effectsname",{value:l||o&&n||r}],0,0,[0]]]}),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t)})(),[["duck"],["cat"],["cricket"],["dog"],["bottle"],["bubbles"],["chine","chime",!0],["clang"],["clap"],["slap"],["crash"],["splash"],["cowbell","cow bell",!0],["ridebell","ride bell",!0],["fingercymbals","finger cymbals",!0],["trianglebell","triangle bell",!0],["hihat","hi hat",!0],["darbuka","darbuka drum",!0],["cup","cup drum",!0],["floortom","floor tom",!0,"floor tom tom"],["tom","tom tom",!0],["kick","kick drum",!0],["snare","snare drum",!0]].forEach(function(e){_construct(o,_toConsumableArray(e)).setup(u)}),(new l).setup(u),(new a).setup(u),(new i).setup(u),(new s).setup(u)}"undefined"!=typeof module&&module.exports&&(module.exports={setupDrumBlocks:setupDrumBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function getTargetTurtle(e,t){for(var r in t=t.toString(),e.turtleList){var l=e.ithTurtle(r);if(!l.inTrash)if(l.name.toString()===t)return r}return console.debug('turtle "'.concat(t,'" not found')),null}function _blockFindTurtle(e,t,r,l){var n=e.blocks.blockList[r].connections[1];return null===n?(console.debug("Could not find connecting block"),null):null===(t=e.logo.parseArg(e.logo,t,n,r,l))?(console.debug("Could not find target turtle name from arg"),null):e.turtles.getTurtle(getTargetTurtle(e.turtles,t))}function setupEnsembleBlocks(f){var e=(()=>{function n(){_classCallCheck(this,n),e=_callSuper(this,n,["turtleheap",_THIS_IS_MUSIC_BLOCKS_?_("mouse index heap"):_("turtle index heap")]),t=e,l="ensemble",r=_THIS_IS_MUSIC_BLOCKS_?[_("The Mouse index heap block returns a value in the heap at a specified location for a specified mouse."),"documentation",""]:[_("The Turtle index heap block returns a value in the heap at a specified location for a specified turtle."),"documentation",""],t.setPalette(l,f),t.setHelpString(r);var e,t,r,l={args:2,defaults:[_THIS_IS_MUSIC_BLOCKS_?_("Mr. Mouse"):_("Yertle"),1],argTypes:["anyin","numberin"],argLabels:[_THIS_IS_MUSIC_BLOCKS_?_("mouse name"):_("turtle name"),_("index")]};return e.formBlock(l),e}return _inherits(n,LeftBlock),_createClass(n,[{key:"arg",value:function(e,t,r,l){var n=f.blocks.blockList[r].connections[1];if(null===n)return f.errorMsg(NOINPUTERRORMSG,r),-1;var n=e.parseArg(e,t,n,r,l),s=getTargetTurtle(f.turtles,n);if(s<0)return-1;n=f.blocks.blockList[r].connections[2];if(null!==n){var o=e.parseArg(e,t,n,r,l);if("number"==typeof o){s in e.turtleHeaps||(e.turtleHeaps[s]=[]),o<1&&(o=1,f.errorMsg(_("Index must be > 0."))),1e3<o&&(o=1e3,f.errorMsg(_("Maximum heap size is 1000.")));for(;e.turtleHeaps[s].length<o;)e.turtleHeaps[s].push(0);return e.turtleHeaps[s][o-1]}}f.errorMsg(NANERRORMSG,r)}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["stopTurtle",_("stop mouse")])).setHelpString([_("The Stop mouse block stops the specified mouse."),"documentation",""]),e.formBlock({args:1,defaults:[_("Mr. Mouse")],argTypes:["anyin"]})):((e=_callSuper(this,t,["stopTurtle",_("stop turtle")])).setHelpString([_("The Stop turtle block stops the specified turtle."),"documentation",""]),e.formBlock({args:1,defaults:[_("Yertle")],argTypes:["anyin"]})),e.setPalette("ensemble",f),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l){var n;null===e[0]?f.errorMsg(NOINPUTERRORMSG,l):null===(n=getTargetTurtle(f.turtles,e[0]))?_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Cannot find mouse")+" "+e[0],l):f.errorMsg(_("Cannot find turtle")+" "+e[0],l):((e=f.turtles.ithTurtle(n)).queue=[],e.parentFlowQueue=[],e.unhighlightQueue=[],e.parameterQueue=[],console.debug("stopping "+n),f.turtles.ithTurtle(r).running=!1,t.doBreak(e))}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["startTurtle",_("start mouse")])).setPalette("ensemble",f),e.setHelpString([_("The Start mouse block starts the specified mouse."),"documentation",""]),e.formBlock({args:1,defaults:[_("Mr. Mouse")],argTypes:["anyin"]})):((e=_callSuper(this,t,["startTurtle",_("start turtle")])).setPalette("ensemble",f),e.setHelpString([_("The Start turtle block starts the specified turtle."),"documentation",""]),e.formBlock({args:1,defaults:[_("Yertle")],argTypes:["anyin"]})),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l,n,s,o){if(console.debug("start mouse from mouse "+r),null===e[0])f.errorMsg(NOINPUTERRORMSG,l);else{r=getTargetTurtle(f.turtles,e[0]);if(null===r)_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Cannot find mouse")+" "+e[0],l):f.errorMsg(_("Cannot find turtle")+" "+e[0],l);else{var u=f.turtles.ithTurtle(r);if(u.running)_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Mouse is already running."),l):f.errorMsg(_("Turtle is already running."),l);else{u.queue=[],u.running=!0,u.parentFlowQueue=[],u.unhighlightQueue=[];for(var a=!(u.parameterQueue=[]),i=null,c=0;c<f.blocks.blockList.length;c++)if(f.blocks.blockList[c]===u.startBlock){a=!0,i=c;break}a?(console.debug("STARTING "+r+" "+i),t.runFromBlock(t,r,i,o,n)):f.errorMsg(_("Cannot find start block")+" "+e[0],l)}}}}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["turtlecolor",_("mouse color")])).setHelpString([_("The Mouse color block returns the pen color of the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=_callSuper(this,t,["turtlecolor",_("turtle color")])).setHelpString([_("The Turtle color block returns the pen color of the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",f),e.hidden=e.deprecated=!0,_assertThisInitialized(e)}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,l){r=_blockFindTurtle(f,t,r,l);return(r||f.turtles.getTurtle(t)).painter.color}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["turtleheading",_("mouse heading")])).setHelpString([_("The Mouse heading block returns the heading of the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=_callSuper(this,t,["turtleheading",_("turtle heading")])).setHelpString([_("The Turtle heading block returns the heading of the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",f),e.hidden=e.deprecated=!0,_assertThisInitialized(e)}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,l){r=_blockFindTurtle(f,t,r,l);return(r||f.turtles.getTurtle(t)).orientation}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["setxyturtle",_("set mouse")])).setHelpString(),e.formBlock({args:3,defaults:[_("Mr. Mouse"),0,0],argTypes:["anyin","numberin","numberin"],argLabels:["ja"===e.lang?_("name1"):_("name"),_("x"),_("y")]})):((e=_callSuper(this,t,["setxyturtle",_("set turtle")])).setHelpString(),e.formBlock({args:3,defaults:[_("Yertle"),0,0],argTypes:["anyin","numberin","numberin"],argLabels:["ja"===e.lang?_("name1"):_("name"),_("x"),_("y")]})),e.setPalette("ensemble",f),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l){var n=getTargetTurtle(f.turtles,e[0]);null===n?_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Cannot find mouse")+" "+e[0],l):f.errorMsg(_("Cannot find turtle")+" "+e[0],l):3===e.length&&("string"==typeof e[1]||"string"==typeof e[2]?(f.errorMsg(NANERRORMSG,l),t.stopTurtle=!0):f.turtles.getTurtle(n).painter.doSetXY(e[1],e[2]))}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),e=_callSuper(this,t,["setturtle"]),_THIS_IS_MUSIC_BLOCKS_?(e.setHelpString([_("The Set mouse block sends a stack of blocks to be run by the specified mouse."),"documentation",""]),e.formBlock({name:_("set mouse"),args:1,defaults:[_("Mr. Mouse")],argTypes:["anyin"]})):(e.setHelpString([_("The Set turtle block sends a stack of blocks to be run by the specified turtle."),"documentation",""]),e.formBlock({name:_("set turtle"),args:1,defaults:[_("Yertle")],argTypes:["anyin"]})),e.setPalette("ensemble",f),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l,n,s,o){var u=getTargetTurtle(f.turtles,e[0]);null!==u?t.runFromBlock(t,u,e[1],o,n):_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Cannot find mouse")+" "+e[0],l):f.errorMsg(_("Cannot find turtle")+" "+e[0],l)}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["yturtle",_("mouse y")])).setHelpString([_("The Y mouse block returns the Y position of the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=_callSuper(this,t,["yturtle",_("turtle y")])).setHelpString([_("The Y turtle block returns the Y position of the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",f),_assertThisInitialized(e)}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,l){r=_blockFindTurtle(f,t,r,l);return r||(r=f.turtles.getTurtle(t),console.debug("Mouse not found. Using current mouse value instead.")),f.turtles.screenY2turtleY(r.container.y)}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["xturtle",_("mouse x")])).setHelpString([_("The X mouse block returns the X position of the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=_callSuper(this,t,["xturtle",_("turtle x")])).setHelpString([_("The X turtle block returns the X position of the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",f),_assertThisInitialized(e)}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,l){r=_blockFindTurtle(f,t,r,l);return r||(r=f.turtles.getTurtle(t),console.debug("Mouse not found. Using current mouse value instead.")),f.turtles.screenX2turtleX(r.container.x)}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["turtleelapsednotes",_("mouse notes played")])).setHelpString([_("The Mouse elapse notes block returns the number of notes played by the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=_callSuper(this,t,["turtlelapsednotes",_("turtle notes played")])).setHelpString([_("The Turtle elapse notes block returns the number of notes played by the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",f),e.hidden=e.deprecated=!0,_assertThisInitialized(e)}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,l){var r=_blockFindTurtle(f,t,r,l);return r?(l=f.turtles.ithTurtle(r)).singer.notesPlayed[0]/l.singer.notesPlayed[1]:(r=f.turtles.ithTurtle(t)).singer.notesPlayed[0]/r.singer.notesPlayed[1]}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["turtlepitch",_("mouse pitch number")])).setHelpString([_("The Mouse pitch block returns the current pitch number being played by the specified mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=_callSuper(this,t,["turtlepitch",_("turtle pitch number")])).setHelpString([_("The Turtle pitch block returns the current pitch number being played by the specified turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",f),e.hidden=e.deprecated=!0,_assertThisInitialized(e)}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,l){for(var n=null,s=f.blocks.blockList[r].connections[1],o=e.parseArg(e,t,s,r,l),u=f.turtles.ithTurtle(t),a=0;a<f.turtles.getTurtleCount();a++){var i=f.turtles.getTurtle(a);if(o===i.name){var c,g=void 0;g=null!==i.singer.lastNotePlayed?(c=i.singer.lastNotePlayed[0].length,[i.singer.lastNotePlayed[0].slice(0,c-1),parseInt(i.singer.lastNotePlayed[0].slice(c-1))]):0<i.singer.notePitches.length?getNote(i.singer.notePitches[0],i.singer.noteOctaves[0],0,i.singer.keySignature,u.singer.movable,null,f.errorMsg,e.synth.inTemperament):(console.debug("Cannot find a note for mouse "+t),f.errorMsg(INVALIDPITCH,r),["G",4]),n=pitchToNumber(g[0],g[1],i.singer.keySignature)-u.singer.pitchNumberOffset,f.blocks.blockList[r].value=n;break}}null===n&&(_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Cannot find mouse")+" "+o,r):f.errorMsg(_("Cannot find turtle")+" "+o,r),l=null!==u.singer.lastNotePlayed?(s=u.singer.lastNotePlayed[0].length,[u.singer.lastNotePlayed[0].slice(0,s-1),parseInt(u.singer.lastNotePlayed[0].slice(s-1))]):0<u.singer.notePitches.length?getNote(u.singer.notePitches[last(u.singer.inNoteBlock)][0],u.singer.noteOctaves[last(u.singer.inNoteBlock)][0],0,u.singer.keySignature,u.singer.movable,null,f.errorMsg,e.synth.inTemperament):(console.debug("Cannot find a note for mouse "+t),f.errorMsg(INVALIDPITCH,r),["G",4]),n=pitchToNumber(l[0],l[1],u.singer.keySignature)-u.singer.pitchNumberOffset,f.blocks.blockList[r].value=n)}}])})(),g=(()=>{function l(e,t){var r;return _classCallCheck(this,l),_THIS_IS_MUSIC_BLOCKS_?((r=_callSuper(this,l,[e||"turtlenote",t||_("mouse note value")])).setHelpString(),r.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((r=_callSuper(this,l,[e||"turtlenote",t||_("turtle note value")])).setHelpString(),r.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),r.setPalette("ensemble",f),r.hidden=r.deprecated=!0,_assertThisInitialized(r)}return _inherits(l,LeftBlock),_createClass(l,[{key:"arg",value:function(e,t,r,l){for(var n=null,s=f.blocks.blockList[r].connections[1],o=e.parseArg(e,t,s,r,l),u=0;u<f.turtles.getTurtleCount();u++){var a=f.turtles.ithTurtle(u);if(o===a.name){n=0<a.singer.inNoteBlock.length&&last(a.singer.inNoteBlock)in a.singer.noteValue?1/a.singer.noteValue[last(a.singer.inNoteBlock)]:null!==a.singer.lastNotePlayed?a.singer.lastNotePlayed[1]:0<a.singer.notePitches.length?a.singer.noteBeat[last(a.singer.inNoteBlock)]:-1,"turtlenote"===f.blocks.blockList[r].name?f.blocks.blockList[r].value=n:f.blocks.blockList[r].value=0!==n?1/n:0;break}}null===n&&(_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Cannot find mouse")+" "+o,r):f.errorMsg(_("Cannot find turtle")+" "+o,r),f.blocks.blockList[r].value=-1)}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["turtlenote2",_("mouse note value")])).setHelpString(),e.hidden=e.deprecated=!0,e}return _inherits(t,g),_createClass(t)})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["turtlesync",_("mouse sync")])).setHelpString([_("The Mouse sync block aligns the beat count between mice."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=_callSuper(this,t,["turtlesync",_("turtle sync")])).setHelpString([_("The Turtle sync block aligns the beat count between turtles."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",f),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l){var n;null===e[0]?f.errorMsg(NOINPUTERRORMSG,l):null===(n=getTargetTurtle(f.turtles,e[0]))?_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Cannot find mouse")+" "+e[0],l):f.errorMsg(_("Cannot find turtle")+" "+e[0],l):f.turtles.ithTurtle(r).singer.turtleTime=f.turtles.ithTurtle(n).singer.turtleTime}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),e=_callSuper(this,t,["foundturtle"]),_THIS_IS_MUSIC_BLOCKS_?(e.setHelpString([_("The Found mouse block will return true if the specified mouse can be found."),"documentation",""]),e.formBlock({name:_("found mouse"),flows:{left:"bool"},args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):(e.setHelpString([_("The Found turtle block will return true if the specified turtle can be found."),"documentation",""]),e.formBlock({name:_("found turtle"),flows:{left:"bool"},args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",f),e}return _inherits(t,BooleanBlock),_createClass(t,[{key:"arg",value:function(e,t,r,l){var n=f.blocks.blockList[r].connections[1],e=e.parseArg(e,t,n,r,l);return null!==getTargetTurtle(f.turtles,e)}}])})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?((e=_callSuper(this,t,["newturtle",_("new mouse")])).setHelpString([_("The New mouse block will create a new mouse."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):((e=_callSuper(this,t,["newturtle",_("new turtle")])).setHelpString([_("The New turtle block will create a new turtle."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e.setPalette("ensemble",f),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,r,t,l,n){var s,o,u=f.blocks.blockList[l].connections[1],a=r.parseArg(r,t,u,l,n);null===getTargetTurtle(f.turtles,a)?(s=f.blocks.blockList.length,u=[[0,"start",f.turtles.turtleX2screenX(f.turtles.getTurtle(t).x),f.turtles.turtleY2screenY(f.turtles.getTurtle(t).y),[null,1,null]],[1,"setturtlename2",0,0,[0,2,null]],[2,["text",{value:a}],0,0,[1]]],o=function(){var e=f.blocks.blockList[s].value,t=f.turtles.ithTurtle(e);r.initTurtle(e),t.queue=[],t.parentFlowQueue=[],t.unhighlightQueue=[],t.parameterQueue=[],t.running=!0,r.runFromBlock(r,e,s,0,n),f.stage.dispatchEvent(a),document.removeEventListener("finishedLoading",o)},document.addEventListener?document.addEventListener("finishedLoading",o):document.attachEvent("finishedLoading",o),f.blocks.loadNewBlocks(u)):(console.debug("Turtle "+a+" already exists."),f.stage.dispatchEvent(a))}}])})(),S=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?(e=_callSuper(this,t,["setturtlecolor",_("set mouse color")])).setHelpString([_("The Set-mouse-color block is used to set the color of a mouse."),"documentation",null,"clickhelp"]):(e=_callSuper(this,t,["setturtlecolor",_("set turtle color")])).setHelpString([_("The Set-turtle-color block is used to set the color of a turtle."),"documentation",null,"clickhelp"]),e.setPalette("ensemble",f),e.beginnerBlock(!0),e.piemenuValuesC1=[0,10,20,30,40,50,60,70,80,90],e.formBlock({args:1,argTypes:["anyin"],defaults:[0]}),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l){var n;null===e[0]?f.errorMsg(NOINPUTERRORMSG,l):(0!=(r=(l=f.turtles.ithTurtle(f.turtles.companionTurtle(r))).orientation)&&l.painter.doSetHeading(0),e="number"==typeof e[0]?(n=getMunsellColor(e[0],50,100),getMunsellColor(e[0],70,80)):(n=getMunsellColor(0,50,100),getMunsellColor(0,70,80)),n=TURTLESVG.replace(/fill_color/g,n).replace(/stroke_color/g,e),l.doTurtleShell(55,"data:image/svg+xml;base64,"+window.btoa(base64Encode(n))),0!=r&&l.painter.doSetHeading(r))}}])})(),T=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?(e=_callSuper(this,t,["turtlename",_("mouse name")])).setHelpString([_("The Mouse-name block returns the name of a mouse."),"documentation",null,"clickhelp"]):(e=_callSuper(this,t,["turtlename",_("turtle name")])).setHelpString([_("The Turtle-name block returns the name of a turtle."),"documentation",null,"clickhelp"]),e.setPalette("ensemble",f),e.beginnerBlock(!0),e.formBlock({outType:"textout"}),_assertThisInitialized(e)}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t){return f.turtles.getTurtle(t).name}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?(e=_callSuper(this,t,["turtlecount",_("mouse count")])).setHelpString([_("The Mouse-count block returns the number of mice."),"documentation",null,"clickhelp"]):(e=_callSuper(this,t,["turtlecount",_("turtle count")])).setHelpString([_("The Turtle-count block returns the number of turtles."),"documentation",null,"clickhelp"]),e.setPalette("ensemble",f),e.formBlock({outType:"numberout"}),_assertThisInitialized(e)}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(){return f.turtles.turtleCount()}}])})();[e,t,r,l,n,s,o,u,a,i,c,g,h,p,(()=>{function t(){var e;return _classCallCheck(this,t),_THIS_IS_MUSIC_BLOCKS_?(e=_callSuper(this,t,["nthturtle",_("nth mouse name")])).setHelpString([_("The Nth-Mouse name block returns the name of the nth mouse."),"documentation",null,"clickhelp"]):(e=_callSuper(this,t,["nthturtle",_("nth turtle name")])).setHelpString([_("The Nth-Turtle name block returns the name of the nth turtle."),"documentation",null,"clickhelp"]),e.setPalette("ensemble",f),e.formBlock({outType:"textout",args:1,defaults:[1]}),_assertThisInitialized(e)}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,l){var n=f.blocks.blockList[r].connections[1];return null===n?(f.errorMsg(NOINPUTERRORMSG,r),0):"number"==typeof(e=e.parseArg(e,t,n,r,l))?0<=--e&&e<f.turtles.getTurtleCount()?f.turtles.getTurtle(e).name:(_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Cannot find mouse")):f.errorMsg(_("Cannot find turtle")),""):(f.errorMsg(_("Index must be > 0.")),"")}}])})(),k,d,m,T,S,(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setturtlename",_("set name")])).setPalette("ensemble",f),e.setHelpString(),_THIS_IS_MUSIC_BLOCKS_?e.formBlock({args:2,defaults:[-1,_("Mr. Mouse")],argTypes:["anyin","anyin"],argLabels:[_("source"),_("target")]}):e.formBlock({args:2,defaults:[-1,_("Yertle")],argTypes:["anyin","anyin"],argLabels:[_("source"),_("target")]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l){var n=!1;if(null===e[0]||null===e[1])f.errorMsg(NOINPUTERRORMSG,l);else{if(-1===e[0])f.turtles.getTurtle(r).rename(e[1]),n=!0;else if("number"==typeof e[0]){var s=Math.floor(e[0]);0<=s&&s<f.turtles.getTurtleCount()&&(f.turtles.getTurtle(s).rename(e[1]),n=!0)}else for(var o=0;o<f.turtles.getTurtleCount();o++)if(f.turtles.getTurtle(o).name===e[0]){f.turtles.getTurtle(o).rename(e[1]),n=!0;break}n?f.turtles.getTurtle(r).rename(e[1]):_THIS_IS_MUSIC_BLOCKS_?f.errorMsg(_("Cannot find mouse")+" "+e[0],l):f.errorMsg(_("Cannot find turtle")+" "+e[0],l)}}}])})(),(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setturtlename2",_("set name")])).setPalette("ensemble",f),e.beginnerBlock(!0),_THIS_IS_MUSIC_BLOCKS_?(e.setHelpString([_("The Set-name block is used to name a mouse."),"documentation",null,"clickhelp"]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Mr. Mouse")]})):(e.setHelpString([_("The Set-name block is used to name a turtle."),"documentation",null,"clickhelp"]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("Yertle")]})),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l){null===e[0]?f.errorMsg(NOINPUTERRORMSG,l):f.turtles.getTurtle(r).rename(e[0])}}])})()].forEach(function(e){(new e).setup(f)})}"undefined"!=typeof module&&module.exports&&(module.exports={setupEnsembleBlocks:setupEnsembleBlocks,getTargetTurtle:getTargetTurtle});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupExtrasBlocks(u){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["float2string",_("fraction")])).setPalette("extras",u),e.setHelpString([_("Convert a float to a fraction")+" 0.5 -> 1/2","documentation",null,"float2string"]),e.parameter=!0,e.formBlock({args:1,argTypes:["anyin"]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,n){var s=u.blocks.blockList[r].connections[1];return null===s?(u.errorMsg(NOINPUTERRORMSG,r),"0/1"):"number"==typeof(e=e.parseArg(e,t,s,r,n))?e<0?(e*=-1,"-"+mixedNumber(e)):mixedNumber(e):(u.errorMsg(NANERRORMSG,r),"0/1")}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["saveabc"])).setPalette("extras",u),e.setHelpString(),e.formBlock({name:_("save as ABC"),args:1,argTypes:["textin"],defaults:[_("title")+".abc"]}),e.hidden=!0,e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e){1===e.length&&u.save.afterSaveAbc(e[0])}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["savelilypond"])).setPalette("extras",u),e.setHelpString(),e.formBlock({name:_("save as Lilypond"),args:1,argTypes:["textin"],defaults:[_("title")+".ly"]}),e.hidden=!0,e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e){1===e.length&&u.save.afterSaveLilypond(e[0])}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["savesvg"])).setPalette("extras",u),e.setHelpString(),e.formBlock({name:_("save as SVG"),args:1,argTypes:["textin"],defaults:[_("title")+".svg"]}),e.hidden=!0,e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?u.errorMsg(NOINPUTERRORMSG,n):1===e.length&&(t.svgBackground&&(t.svgOutput='<rect x="0" y="0" height="'+t.canvas.height+'" width="'+t.canvas.width+'" fill="'+platformColor.background+'"/> '+t.svgOutput),u.save.saveSVG(e[0]))}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nobackground",_("no background")])).setPalette("extras",u),e.setHelpString([_("The No background block eliminates the background from the saved SVG output."),"documentation","","makehelp"]),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t){t.svgBackground=!1}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["showblocks",_("show blocks")])).setPalette("extras",u),e.setHelpString([_("The Show blocks block shows the blocks."),"documentation",""]),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t){u.blocks.showBlocks(),t.turtleDelay=DEFAULTDELAY}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["hideblocks",_("Hide blocks").toLowerCase()])).setPalette("extras",u),e.setHelpString([_("The Hide blocks block hides the blocks."),"documentation",""]),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t){u.blocks.hideBlocks(),t.activity.showBlocksAfterRun=!1,t.turtleDelay=0}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["vspace","↓"])).setPalette("extras",u),e.setHelpString([_("The Space block is used to add space between blocks."),"documentation",""]),e.extraWidth=-10,e.updateDockValue(0,"vspaceout"),e.updateDockValue(1,"vspacein"),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(){}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["hspace","←"])).setPalette("extras",u),e.setHelpString([_("The Space block is used to add space between blocks."),"documentation",""]),e.extraWidth=-10,e.formBlock({args:1,argTypes:["anyin"],outType:"anyout"}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,n){var s=u.blocks.blockList[r].connections[1];return e.parseArg(e,t,s,r,n)}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["wait",_("wait")])).setPalette("extras",u),e.setHelpString([_("The Wait block pauses the program for a specified number of seconds."),"documentation",""]),e.formBlock({args:1,defaults:[1]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){var n,r=u.turtles.ithTurtle(r);1===e.length&&(n=(0<TONEBPM/r.singer.bpm.length?last(r.singer.bpm):Singer.masterBPM)/(1/e[0]),r.singer.previousTurtleTime=r.singer.turtleTime,r.singer.turtleTime+=n,r.doWait(e[0]))}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["comment"])).setPalette("extras",u),e.setHelpString([_("The Comment block prints a comment at the top of the screen when the program is running in slow mode."),"documentation",""]),e.formBlock({name:_("comment"),args:1,defaults:["Music Blocks"],argTypes:["anyin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){null!==e[0]&&!u.turtles.ithTurtle(r).singer.suppressOutput&&0<t.turtleDelay&&u.textMsg(e[0].toString())}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),e=_callSuper(this,t,["print",_("print")]),u.beginnerMode?e.setPalette("media",u):e.setPalette("extras",u),e.beginnerBlock(!0),e.setHelpString([_("The Print block displays text at the top of the screen."),"documentation",""]),e.formBlock({args:1,defaults:["Music Blocks"],argTypes:["anyin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var s,a=u.blocks.blockList[n].connections[1];if(t.inOscilloscope&&null!==a){for(var o=u.blocks.blockList[a].value,l=-1,i=0;i<u.turtles.getTurtleCount();i++){var c=u.turtles.getTurtle(i);c.inTrash||c.name===o&&(l=i)}-1<l&&t.oscilloscopeTurtles.indexOf(u.turtles.getTurtle(l))<0&&t.oscilloscopeTurtles.push(u.turtles.getTurtle(l))}else t.inMatrix?t.phraseMaker.lyricsON=!0:t.inStatusMatrix||1===e.length&&null!==e[0]&&((s=u.turtles.ithTurtle(r)).singer.suppressOutput?t.runningLilypond&&0<s.singer.inNoteBlock.length&&t.notation.notationMarkup(r,e[0].toString()):"grid"===u.blocks.blockList[a].name?(new k).flow(e,t,r,n):0<s.singer.inNoteBlock.length?s.singer.embeddedGraphics[last(s.singer.inNoteBlock)].push(n):u.textMsg(e[0].toString()))}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["drum"])).setPalette("extras",u),e.setHelpString(),e.formBlock({name:_("start drum"),canCollapse:!0}),e.hidden=e.deprecated=!0,e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e){if(1===e.length)return[e[0],1]}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["displaygrid",_("display grid")])).setPalette("extras",u),e.beginnerBlock(!0),e.setHelpString([_("The Display Grid Block changes the grid type"),"documentation",null]),e.formBlock({args:1,defaults:["Cartesian"],argTypes:["gridin"]}),e.makeMacro(function(e,t){return[[0,"displaygrid",e,t,[null,1,null]],[1,["grid",{value:"Cartesian"}],0,0,[0]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e){e&&e[0]||(e=["Cartesian"]);var t=u.blocks.activity;switch(u.hideGrids(),e[0]){case _("Cartesian"):case"Cartesian":t._showCartesian();break;case _("polar"):case"polar":t._showPolar();break;case _("Cartesian/Polar"):case"Cartesian/Polar":t._showPolar(),t._showCartesian();break;case _("treble"):case"treble":t._showTreble();break;case _("grand staff"):case"grand staff":t._showGrand();break;case _("mezzo-soprano"):case"mezzo-soprano":t._showSoprano();break;case _("alto"):case"alto":t._showAlto();break;case _("tenor"):case"tenor":t._showTenor();break;case _("bass"):case"bass":t._showBass();break;case _("none"):}}}])})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["grid"])).setPalette("extras",u),e.setHelpString(),e.formBlock({outType:"gridout"}),e}return _inherits(t,ValueBlock),_createClass(t)})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nopValueBlock",_("unknown")])).setPalette("extras",u),e.setHelpString(),e.formBlock({outType:"anyout"}),e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t)})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nopOneArgMathBlock",_("unknown")])).setPalette("extras",u),e.setHelpString(),e.formBlock({args:1,argTypes:["anyin"],outType:"anyout"}),e.hidden=!0,e}return _inherits(t,LeftBlock),_createClass(t)})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nopOneArgMathBlock",_("unknown")])).setPalette("extras",u),e.setHelpString(),e.formBlock({args:2,argTypes:["anyin","anyin"],outType:"anyout"}),e.hidden=!0,e}return _inherits(t,LeftBlock),_createClass(t)})(),w=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nopZeroArgBlock",_("unknown")])).setPalette("extras",u),e.setHelpString(),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t)})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nopOneArgBlock",_("unknown")])).setPalette("extras",u),e.setHelpString(),e.formBlock({args:1,argTypes:["anyin"]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t)})(),C=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nopTwoArgBlock",_("unknown")])).setPalette("extras",u),e.setHelpString(),e.formBlock({args:2,argTypes:["anyin","anyin"]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t)})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nopThreeArgBlock",_("unknown")])).setPalette("extras",u),e.setHelpString(),e.formBlock({args:3,argTypes:["anyin","anyin","anyin"]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t)})(),S=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nopFourArgBlock",_("unknown")])).setPalette("extras",u),e.setHelpString(),e.formBlock({args:4,argTypes:["anyin","anyin","anyin","anyin"]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t)})(),B=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["debugger",_("debugger")])).setPalette("extras",u),e.setHelpString([_("The Debug block adds a debug point in your code. When reached, execution will pause and you can inspect variables."),"documentation","","debugger"]),e.formBlock({name:_("debugger")}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var s=u.runMode;"slow"!==s&&"step"!==s||(u.logo.turtleDelay=-1)}}])})();(new t).setup(u),(new r).setup(u),(new n).setup(u),(new s).setup(u),(new a).setup(u),(new o).setup(u),(new e).setup(u),(new f).setup(u),(new k).setup(u),(new g).setup(u),(new l).setup(u),(new i).setup(u),(new c).setup(u),(new p).setup(u),(new h).setup(u),(new B).setup(u),(new d).setup(u),(new y).setup(u),(new b).setup(u),(new w).setup(u),(new v).setup(u),(new C).setup(u),(new m).setup(u),(new S).setup(u)}"undefined"!=typeof module&&module.exports&&(module.exports={setupExtrasBlocks:setupExtrasBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var k,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function o(e,t,n,o){var r,l,i,s,a,c,u,f,p,t=t&&t.prototype instanceof w?t:w,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(r=e,l=n,u=o||[],f=!1,p={p:c=0,n:0,v:k,a:h,f:h.bind(k,4),d:function(e,t){return i=e,s=0,a=k,p.n=t,_}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(f&&1===t&&h(t,n),s=t,a=n;(d=s<2?k:a)||!f;){i||(s?s<3?(1<s&&(p.n=-1),h(s,a)):p.n=a:p.v=a);try{if(c=2,i){if(d=i[e=s?e:"next"]){if(!(d=d.call(i,a)))throw TypeError("iterator result is not an object");if(!d.done)return d;a=d.value,s<2&&(s=0)}else 1===s&&(d=i.return)&&d.call(i),s<2&&(a=TypeError("The iterator does not provide a '"+e+"' method"),s=1);i=k}else if((d=(f=p.n<0)?a:r.call(l,p))!==_)break}catch(e){i=k,s=1,a=e}finally{c=1}}return{value:d,done:f}}),!0),t;function h(e,t){for(s=e,a=t,d=0;!f&&c&&!n&&d<u.length;d++){var n,o=u[d],r=p.p,l=o[2];3<e?(n=l===t)&&(a=o[(s=o[4])?5:s=3],o[4]=o[5]=k):o[0]<=r&&((n=e<2&&r<o[1])?(s=0,p.v=t,p.n=o[1]):r<l&&(n=e<3||o[0]>t||l<t)&&(o[4]=e,o[5]=t,p.n=l,s=0))}if(n||1<e)return _;throw f=!0,t}}var _={};function w(){}function r(){}function l(){}var d=Object.getPrototypeOf,e=[][t]?d(d([][t]())):(_regeneratorDefine2(d={},t,function(){return this}),d),i=l.prototype=w.prototype=Object.create(e);function s(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",r.prototype=l),_regeneratorDefine2(l,"constructor",r),_regeneratorDefine2(l,n,r.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,n,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:s}})()}function _regeneratorDefine2(e,t,n,o){var l=Object.defineProperty;try{l({},"",{})}catch(e){l=0}(_regeneratorDefine2=function(e,t,n,o){function r(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?l?l(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))})(e,t,n,o)}function asyncGeneratorStep(e,t,n,o,r,l,i){try{var s=e[l](i),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(o,r)}function _asyncToGenerator(s){return function(){var e=this,i=arguments;return new Promise(function(t,n){var o=s.apply(e,i);function r(e){asyncGeneratorStep(o,t,n,r,l,"next",e)}function l(e){asyncGeneratorStep(o,t,n,r,l,"throw",e)}r(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupFlowBlocks(b){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["backward"])).setPalette("flow",b),e.beginnerBlock(!0),e.setHelpString([_("The Backward block runs code in reverse order (Musical retrograde)."),"documentation",""]),e.formBlock({name:_("backward")}),e.makeMacro(function(e,t){return[[0,"backward",e,t,[null,1,null]],[1,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,o){var r=b.turtles.ithTurtle(n),e=(r.singer.backward.push(o),b.blocks.findBottomBlock(e[0])),l="_backward_"+n+"_"+o,o=(t.setDispatchBlock(o,n,l),b.blocks.blockList[o].connections[2]);null===o?r.singer.backward.pop():o in r.endOfClampSignals?r.endOfClampSignals[o].push(l):r.endOfClampSignals[o]=[l];return t.setTurtleListener(n,l,function(e){return r.singer.backward.pop()}),[e,1]}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["duplicatenotes"])).setPalette("flow",b),e.piemenuValuesC1=[2,3,4,5,6,7,8],e.setHelpString([_("The Duplicate block will run each block multiple times.")+" "+_("The output of the example is: Sol, Sol, Sol, Sol, Re, Re, Re, Re, Sol, Sol, Sol, Sol."),"documentation",null,"duphelp"]),e.formBlock({name:_("Duplicate").toLowerCase(),args:1,defaults:[2]}),e.makeMacro(function(e,t){return[[0,"duplicatenotes",e,t,[null,1,null,2]],[1,["number",{value:2}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,l,i,s,t){if(void 0!==e[1]){var n=null===e[0]||"number"!=typeof e[0]||e[0]<1?(b.errorMsg(NOINPUTERRORMSG,s),2):e[0],a=Math.floor(n);if(a<1)b.errorMsg(ZERODIVIDEERRORMSG,s),l.stopTurtle=!0;else{for(var c=b.turtles.ithTurtle(i),n=(c.singer.duplicateFactor*=a,"_duplicate_"+i),u=(l.setDispatchBlock(s,i,n),function(e,t){for(var n in l.connectionStore)if(n!==t.toString())for(var o in l.connectionStore[n])if(o===e.toString())return n;return null}),o=(c.singer.inDuplicate=!0,(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var n,o,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return c.singer.inDuplicate=!1,c.singer.duplicateFactor/=a,e.n=1,function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10;return new Promise(function(e){var t=0,n=function(){l.connectionStoreLock?t<o?(t++,setTimeout(n,r)):(console.warn("connectionStoreLock: Max retries reached, forcing lock acquisition"),l.connectionStoreLock=!0,e(!0)):(l.connectionStoreLock=!0,e(!0))};n()})}();case 1:try{if(null===u(s,i))for(n=l.connectionStore[i][s].length,o=0;o<n;o++)r=l.connectionStore[i][s].pop(),b.blocks.blockList[r[0]].connections[r[1]]=r[2],null!=r[2]&&(b.blocks.blockList[r[2]].connections[0]=r[0]);else delete l.connectionStore[i][s]}finally{l.connectionStoreLock=!1}case 2:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})()),r=(l.setTurtleListener(i,n,o),0);l.connectionStoreLock&&r<1e3;)r++;1e3<=r&&console.warn("connectionStoreLock: Max attempts reached in DuplicateBlock flow"),l.connectionStoreLock=!0;var f=u(s,i);if(null!=f){l.connectionStore[i][s]=[];for(var p=l.connectionStore[f][s].length;0<p;p--){var h=[l.connectionStore[f][s][p-1][0],l.connectionStore[f][s][p-1][1],l.connectionStore[f][s][p-1][2]],h=(l.connectionStore[i][s].push(h),h[0]),h=("hidden"===b.blocks.blockList[h].name&&(h=b.blocks.blockList[h].connections[0]),new Queue(h,a,s,t));c.parentFlowQueue.push(s),c.queue.push(h)}}else{for(var k,_=b.blocks.findBottomBlock(e[1]);_!=s;)"hidden"!==b.blocks.blockList[_].name&&(k=new Queue(_,a,s,t),c.parentFlowQueue.push(s),c.queue.push(k)),_=b.blocks.blockList[_].connections[0];for(l.connectionStore[i][s]=[],_=e[1];null!=_;){var w=b.blocks.blockList[_].connections.length-1,d=b.blocks.blockList[_].connections[w];null!=d&&"hidden"===b.blocks.blockList[d].name?(l.connectionStore[i][s].push([d,1,b.blocks.blockList[d].connections[1]]),_=b.blocks.blockList[d].connections[1],b.blocks.blockList[d].connections[1]=null):(l.connectionStore[i][s].push([_,w,d]),b.blocks.blockList[_].connections[w]=null,_=d),null!=_&&(b.blocks.blockList[_].connections[0]=null)}}l.connectionStoreLock=!1}}}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["defaultcase"])).setPalette("flow",b),e.setHelpString([_("The Default block is used inside of a Switch to define the default action."),"documentation",null,"switchhelp"]),e.formBlock({name:_("default")}),e.updateDockValue(0,"caseout"),e.updateDockValue(2,"casein"),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,o){var r=last(t.switchBlocks[n]);null===r?(b.errorMsg(_("The Case Block must be used inside of a Switch Block."),o),t.stopTurtle=!0):(o=t.switchCases[n][r].length,t.switchCases[n][r][o-1].push(["__default__",e[0]]))}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["case"])).setPalette("flow",b),e.setHelpString([_("The Case block is used inside of a Switch to define matches."),"documentation",null,"switchhelp"]),e.formBlock({name:_("case"),args:1,argTypes:["anyin"]}),e.updateDockValue(0,"caseout"),e.updateDockValue(3,"casein"),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,o){var r=last(t.switchBlocks[n]);null===r?(b.errorMsg(_("The Case Block must be used inside of a Switch Block."),o),t.stopTurtle=!0):(o=t.switchCases[n][r].length,t.switchCases[n][r][o-1].push([e[0],e[1]]))}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["switch"])).setPalette("flow",b),e.setHelpString([_("The Switch block will run the code in the matching Case."),"documentation",null,"switchhelp"]),e.formBlock({name:_("switch"),args:1,argTypes:["anyin"]}),e.makeMacro(function(e,t){return[[0,"switch",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"case",0,0,[0,3,null,4]],[3,["number",{value:1}],0,0,[2]],[4,"defaultcase",0,0,[2,null,null]],[5,"hidden",0,0,[0,null]]]}),e.updateDockValue(2,"casein"),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,l,i,t){var s=b.turtles.ithTurtle(i),n=(l.switchBlocks[i].push(t),t in l.switchCases[i]?l.switchCases[i][t].push([]):l.switchCases[i][t]=[[]],"_switch_"+t+"_"+i);l.setDispatchBlock(t,i,n);return l.setTurtleListener(i,n,function(){for(var e=last(l.switchBlocks[i]),t=b.blocks.blockList[e].connections[1],n=null==t?"__default__":l.parseArg(l,i,t,l.receivedArg),o=null,r=0;r<last(l.switchCases[i][e]).length;r++){if(last(l.switchCases[i][e])[r][0]===n){o=last(l.switchCases[i][e])[r][1];break}"__default__"===last(l.switchCases[i][e])[r][0]&&(o=last(l.switchCases[i][e])[r][1])}null!=o&&(t=new Queue(o,1,e,null),s.parentFlowQueue.push(e),s.queue.push(t)),l.switchCases[i][e].pop(),l.switchBlocks[i].pop()}),[e[1],1]}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["clamp"])).setPalette("flow",b),e.setHelpString(),e.hidden=!0,e.formBlock({name:""},!1),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e){if(1===e.length)return[e[0],1]}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["break"])).setPalette("flow",b),e.setHelpString([_("The Stop block will stop a loop")+": "+_("Forever, Repeat, While, or Until."),"documentation",""]),e.formBlock({name:_("Stop").toLowerCase(),flows:{top:!0,bottom:"tail",type:""}}),e}return _inherits(t,BaseBlock),_createClass(t,[{key:"flow",value:function(e,t,n,o){n=b.turtles.ithTurtle(n),t.doBreak(n),t=b.blocks.blockList[o].connections[0];null==t||n.singer.suppressOutput||0!==n.singer.justCounting.length||n.unhighlightQueue.push(t)}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["waitFor"])).setPalette("flow",b),e.setHelpString([_("The Waitfor block will wait until the condition is true."),"documentation",null,"waitforhelp"]),e.formBlock({name:_("wait for"),args:1,argTypes:["booleanin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,o){if(1===e.length){var r=b.turtles.ithTurtle(n);if(e[0]){for(var l=!1,i=r.queue.length-1;0<i;i--)r.queue[i].parentBlk===o&&(l?r.queue.pop():l=!0);null===t.firstNoteTime&&(t.firstNoteTime=(new Date).getTime());n=((new Date).getTime()-this.firstNoteTime)/1e3;r.singer.turtleTime=n,r.singer.previousTurtleTime=n}else{e=b.blocks.blockList[o].connections[0],t=new Queue(o,1,e);r.parentFlowQueue.push(e),r.queue.push(t),r.doWait(.05)}}}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["until"])).setPalette("flow",b),e.setHelpString([_("The Until block will repeat until the condition is true."),"documentation",null,"untilhelp"]),e.formBlock({name:_("until"),flows:{labels:["ja"===e.lang?_("do2"):_("do")]},args:1,argTypes:["booleanin"]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,o){if(2===e.length){var r=b.turtles.ithTurtle(n);if(e[0])for(var l=r.queue.length-1;0<l;l--)r.queue[l].parentBlk===o&&r.queue.pop();else{var n=r.queue.length,n=(0<n&&r.queue[n-1].parentBlk===o&&r.queue.pop(),b.blocks.blockList[o].connections[0]),i=new Queue(o,1,n);r.parentFlowQueue.push(n),r.queue.push(i)}return[e[1],1]}}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["while"])).setPalette("flow",b),e.setHelpString([_("The While block will repeat while the condition is true."),"documentation",null,"whilehelp"]),e.formBlock({name:_("while"),flows:{labels:["ja"===e.lang?_("do2"):_("do")]},args:1,argTypes:["booleanin"]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,o){if(2===e.length){var r,l=b.turtles.ithTurtle(n);if(e[0])0<(n=l.queue.length)&&l.queue[n-1].parentBlk===o&&l.queue.pop(),n=b.blocks.blockList[o].connections[0],r=new Queue(o,1,n),l.parentFlowQueue.push(n),l.queue.push(r);else for(var i=l.queue.length-1;0<i;i--)l.queue[i].parentBlk===o&&l.queue.pop();return[e[1],1]}}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["ifthenelse"])).setPalette("flow",b),e.beginnerBlock(!0),b.beginnerMode&&"ja"===e.lang?e.setHelpString([_("Conditionals lets your program take different actions depending on the condition.")+" "+_("In this example if the mouse button is pressed a snare drum will play."),"documentation",null,"elifhelp"]):e.setHelpString([_("Conditionals lets your program take different actions depending on the condition.")+" "+_("In this example if the mouse button is pressed a snare drum will play, else a kick drum will play."),"documentation",null,"elifhelp"]),e.formBlock({name:_("if"),flows:{labels:[_("then"),_("else")]},args:1,argTypes:["booleanin"]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e){if(3===e.length)return e[0]?[e[1],1]:[e[2],1]}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["if"])).setPalette("flow",b),e.beginnerBlock(!0),b.beginnerMode&&e.lang,e.setHelpString([_("Conditionals lets your program take different actions depending on the condition.")+" "+_("In this example if the mouse button is pressed a snare drum will play."),"documentation",null,"ifhelp"]),e.formBlock({name:_("if"),flows:{labels:[_("then")]},args:1,argTypes:["booleanin"]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e){if(2===e.length&&e[0])return[e[1],1]}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["forever"])).setPalette("flow",b),e.beginnerBlock(!0),e.setHelpString([_("The Forever block will repeat the contained blocks forever.")+" "+_("In this example of a simple drum machine a kick drum will play 1/4 notes forever."),"documentation",null,"foreverhelp"]),e.formBlock({name:_("forever")}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n){if(1===e.length)return[e[0],b.turtles.ithTurtle(n).singer.suppressOutput?20:-1]}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["repeat"])).setPalette("flow",b),e.beginnerBlock(!0),e.setHelpString([_("The Repeat block will repeat the contained blocks.")+" "+_("In this example the note will be played 4 times."),"documentation",null,"repeathelp"]),e.formBlock({name:_("repeat"),args:1,argLabels:[""],defaults:[4]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,o){if(void 0!==e[1])return null===e[0]||"number"!=typeof e[0]||e[0]<1?(e[0]<0&&b.errorMsg(POSNUMBER,o),[null,0]):(o=e[0],[e[1],Math.floor(o)])}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["duplicatefactor",_("duplicate factor")])).setPalette("flow",b),e.setHelpString(),e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t,n){e.inStatusMatrix&&"print"===b.blocks.blockList[b.blocks.blockList[n].connections[0]].name?e.statusFields.push([n,"duplicate"]):b.blocks.blockList[n].value=b.turtles.ithTurtle(t).singer.duplicateFactor}}])})(),w=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["hiddennoflow"])).setPalette("flow",b),e.setHelpString(),e.dockTypes[e.dockTypes.length-1]="unavailable",e.size=0,e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(){}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["hidden"])).setPalette("flow",b),e.setHelpString(),e.size=0,e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(){}}])})();(new e).setup(b),(new t).setup(b),(new n).setup(b),(new o).setup(b),(new r).setup(b),(new l).setup(b),(new i).setup(b),(new s).setup(b),(new a).setup(b),(new c).setup(b),(new u).setup(b),(new f).setup(b),(new p).setup(b),(new h).setup(b),(new k).setup(b),(new w).setup(b),(new d).setup(b)}"undefined"!=typeof module&&(module.exports={setupFlowBlocks:setupFlowBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupGraphicsBlocks(i){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["heading",_("heading")])).setPalette("graphics",i),e.beginnerBlock(!0),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Heading block returns the orientation of the mouse."),"documentation",""]):e.setHelpString([_("The Heading block returns the orientation of the turtle."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"setter",value:function(e,t,r){i.turtles.getTurtle(i.turtles.companionTurtle(r)).painter.doSetHeading(t)}},{key:"updateParameter",value:function(e,t){return toFixed2(i.turtles.getTurtle(i.turtles.companionTurtle(t)).orientation)}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[r].connections[0]].name)return i.turtles.getTurtle(i.turtles.companionTurtle(t)).orientation;e.statusFields.push([r,"heading"])}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["y"])).setPalette("graphics",i),e.beginnerBlock(!0),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Y block returns the vertical position of the mouse."),"documentation",null,"xyhelp"]):e.setHelpString([_("The Y block returns the vertical position of the turtle."),"documentation",null,"xyhelp"]),e.formBlock({name:"ja"===e.lang?_("y3"):_("y")}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"setter",value:function(e,t,r){r=i.turtles.getTurtle(i.turtles.companionTurtle(r));r.painter.doSetXY(r.x,t)}},{key:"updateParameter",value:function(e,t){return toFixed2(i.turtles.getTurtle(i.turtles.companionTurtle(t)).y)}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[r].connections[0]].name)return i.turtles.screenY2turtleY(i.turtles.getTurtle(i.turtles.companionTurtle(t)).container.y);e.statusFields.push([r,"y"])}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["x"])).setPalette("graphics",i),e.beginnerBlock(!0),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The X block returns the horizontal position of the mouse."),"documentation",null,"xyhelp"]):e.setHelpString([_("The X block returns the horizontal position of the turtle."),"documentation",null,"xyhelp"]),e.formBlock({name:"ja"===e.lang?_("x3"):_("x")}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"setter",value:function(e,t,r){r=i.turtles.getTurtle(i.turtles.companionTurtle(r));r.painter.doSetXY(t,r.y)}},{key:"updateParameter",value:function(e,t){return toFixed2(i.turtles.getTurtle(i.turtles.companionTurtle(t)).x)}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[r].connections[0]].name)return i.turtles.screenX2turtleX(i.turtles.getTurtle(i.turtles.companionTurtle(t)).container.x);e.statusFields.push([r,"x"])}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["scrollxy",_("scroll xy")])).setPalette("graphics",i),e.beginnerBlock(!0),e.setHelpString([_("The Scroll XY block moves the canvas."),"documentation",null,"everybeathelp"]),e.formBlock({args:2,defaults:[100,0],argLabels:"ja"===e.lang?[_("x2"),_("y2")]:[_("x"),_("y")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o=i.turtles.ithTurtle(i.turtles.companionTurtle(r));2===e.length&&("string"==typeof e[0]||"string"==typeof e[1]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push([e[0],e[1]])):0<o.singer.inNoteBlock.length?o.singer.embeddedGraphics[last(o.singer.inNoteBlock)].push(n):(t=i.turtles.getTurtle(i.turtles.companionTurtle(r)),o.singer.suppressOutput?(n=t.painter.penState,t.painter.penState=!1,t.painter.doScrollXY(e[0],e[1]),t.painter.penState=n):t.painter.doScrollXY(e[0],e[1])))}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["clear",_("Clear").toLowerCase()])).setPalette("graphics",i),e.setHelpString(),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){r=i.turtles.ithTurtle(i.turtles.companionTurtle(r));t.inMatrix||(0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.singer.suppressOutput?(n=r.painter.penState,r.painter.penState=!1,r.painter.doSetXY(0,0),r.painter.doSetHeading(0),r.painter.penState=n):(t.svgBackground=!0,r.painter.doClear(!0,!0,!0)))}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["controlpoint2"])).setPalette("graphics",i),e.setHelpString([_("The Control-point 2 block sets the second control point for the Bezier curve."),"documentation",""]),e.formBlock({name:_("control point 2"),args:2,defaults:[100,25],argLabels:"ja"===e.lang?[_("x1"),_("y1")]:[_("x"),_("y")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){r=i.turtles.ithTurtle(i.turtles.companionTurtle(r));2===e.length&&("string"==typeof e[0]||"string"==typeof e[1]?i.errorMsg(NANERRORMSG,n):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.setControlPoint2(e))}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["controlpoint1"])).setPalette("graphics",i),e.setHelpString([_("The Control-point 1 block sets the first control point for the Bezier curve."),"documentation",""]),e.formBlock({name:_("control point 1"),args:2,defaults:[100,75],argLabels:"ja"===e.lang?[_("x1"),_("y1")]:[_("x"),_("y")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){r=i.turtles.ithTurtle(i.turtles.companionTurtle(r));2===e.length&&("string"==typeof e[0]||"string"==typeof e[1]?i.errorMsg(NANERRORMSG,n):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.setControlPoint1(e))}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["bezier"])).setPalette("graphics",i),e.setHelpString([_("The Bezier block draws a Bezier curve."),"documentation",""]),e.formBlock({name:_("bezier"),args:2,defaults:[0,100],argLabels:"ja"===e.lang?[_("x1"),_("y1")]:[_("x"),_("y")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){r=i.turtles.ithTurtle(i.turtles.companionTurtle(r));2===e.length&&("string"==typeof e[0]||"string"==typeof e[1]?i.errorMsg(NANERRORMSG,n):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.singer.suppressOutput?(n=r.painter.penState,r.painter.penState=!1,r.painter.doBezier(e[0],e[1]),r.painter.penState=n):r.painter.doBezier(e[0],e[1]))}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["arc"])).setPalette("graphics",i),e.beginnerBlock(!0),e.piemenuValuesC1=[15,30,45,60,75,90,105,120,135,150,165,180,195,210,225,240,255,270,285,300,315,330,345,360],e.piemenuValuesC2=[25,50,75,100,125,150,175,200,225,250,275,300],e.setHelpString([_("The Arc block moves the turtle in an arc."),"documentation",null,"archelp"]),e.formBlock({name:_("arc"),args:2,defaults:[90,100],argLabels:[_("angle"),_("radius")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),r=i.turtles.ithTurtle(r).painter.wrap;2===e.length&&(!(5e3<e[1]||e[1]<-5e3)||0!=r&&null!=r?(2e4<e[1]||e[1]<-2e4)&&1==r?i.errorMsg(_("Value must be within -20000 to 20000 when Wrap Mode is on."),n):"string"==typeof e[0]||"string"==typeof e[1]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push([e[0],e[1]])):0<o.singer.inNoteBlock.length?o.singer.embeddedGraphics[last(o.singer.inNoteBlock)].push(n):o.singer.suppressOutput?(r=o.painter.penState,o.painter.penState=!1,o.painter.doArc(e[0],e[1]),o.painter.penState=r):o.painter.doArc(e[0],e[1]):i.errorMsg(_("Value must be within -5000 to 5000 when Wrap Mode is off."),n))}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setheading",_("set heading")])).setPalette("graphics",i),e.beginnerBlock("ja"!==e.lang),e.piemenuValuesC1=[0,30,45,60,90,120,135,150,180,210,225,240,270,300,315,330],e.setHelpString([_("The Set heading block sets the heading of the turtle."),"documentation",""]),e.formBlock({args:1,defaults:[0]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){r=i.turtles.ithTurtle(i.turtles.companionTurtle(r));1===e.length&&("string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.doSetHeading(e[0]))}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setxy"])).setPalette("graphics",i),e.beginnerBlock(!0),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Set XY block moves the mouse to a specific position on the screen."),"documentation",""]):e.setHelpString([_("The Set XY block moves the turtle to a specific position on the screen."),"documentation",""]),e.formBlock({name:_("set xy"),args:2,defaults:[0,0],argLabels:"ja"===e.lang?[_("x1"),_("y1")]:[_("x"),_("y")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),r=i.turtles.ithTurtle(r).painter.wrap;2===e.length&&(!(5e3<e[0]||5e3<e[1]||e[0]<-5e3||e[1]<-5e3)||0!=r&&null!=r?(2e4<e[0]||2e4<e[1]||e[0]<-2e4||e[1]<-2e4)&&1==r?i.errorMsg(_("Value must be within -20000 to 20000 when Wrap Mode is on."),n):"string"==typeof e[0]||"string"==typeof e[1]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push([e[0],e[1]])):0<o.singer.inNoteBlock.length?o.singer.embeddedGraphics[last(o.singer.inNoteBlock)].push(n):o.singer.suppressOutput?(r=o.painter.penState,o.painter.penState=!1,o.painter.doSetXY(e[0],e[1]),o.painter.penState=r):o.painter.doSetXY(e[0],e[1]):i.errorMsg(_("Value must be within -5000 to 5000 when Wrap Mode is off."),n))}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["right"])).setPalette("graphics",i),e.beginnerBlock(!0),e.piemenuValuesC1=[0,30,60,90,120,150,180,210,240,270,300,330],_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Right block turns the mouse to the right."),"documentation",null,"forwardhelp"]):e.setHelpString([_("The Right block turns the turtle to the right."),"documentation",null,"forwardhelp"]),e.formBlock({name:"ja"===e.lang?_("right1"):_("right"),args:1,defaults:[90]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){r=i.turtles.ithTurtle(i.turtles.companionTurtle(r));1===e.length&&("string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.singer.suppressOutput?(t=r.painter.penState,r.painter.penState=!1,r.painter.doRight(e[0]),r.painter.penState=t):r.painter.doRight(e[0]))}}])})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["left"])).setPalette("graphics",i),e.beginnerBlock(!0),e.piemenuValuesC1=[330,300,270,240,210,180,150,120,90,60,30,0],_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Left block turns the mouse to the left."),"documentation",null,"forwardhelp"]):e.setHelpString([_("The Left block turns the turtle to the left."),"documentation",null,"forwardhelp"]),e.formBlock({name:"ja"===e.lang?_("left1"):_("left"),args:1,defaults:[90]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){r=i.turtles.ithTurtle(i.turtles.companionTurtle(r));1===e.length&&("string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.singer.suppressOutput?(t=r.painter.penState,r.painter.penState=!1,r.painter.doRight(-e[0]),r.painter.penState=t):r.painter.doRight(-e[0]))}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["back",_("back")])).setPalette("graphics",i),e.beginnerBlock(!0),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Back block moves the mouse backward."),"documentation",null,"forwardhelp"]):e.setHelpString([_("The Back block moves the turtle backward."),"documentation",null,"forwardhelp"]),e.formBlock({args:1,defaults:[100]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),r=i.turtles.ithTurtle(r).painter.wrap;1===e.length&&(!(5e3<e[0]||e[0]<-5e3)||0!=r&&null!=r?(2e4<e[0]||e[0]<-2e4)&&1==r?i.errorMsg(_("Value must be within -20000 to 20000 when Wrap Mode is on."),n):"string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<o.singer.inNoteBlock.length?o.singer.embeddedGraphics[last(o.singer.inNoteBlock)].push(n):o.singer.suppressOutput?(r=o.painter.penState,o.painter.penState=!1,o.painter.doForward(-e[0]),o.painter.penState=r):o.painter.doForward(-e[0]):i.errorMsg(_("Value must be within -5000 to 5000 when Wrap Mode is off."),n))}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["forward",_("forward")])).setPalette("graphics",i),e.beginnerBlock(!0),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Forward block moves the mouse forward."),"documentation",null,"forwardhelp"]):e.setHelpString([_("The Forward block moves the turtle forward."),"documentation",null,"forwardhelp"]),e.formBlock({args:1,defaults:[100]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),r=i.turtles.ithTurtle(r).painter.wrap;1===e.length&&(!(5e3<e[0]||e[0]<-5e3)||0!=r&&null!=r?(2e4<e[0]||e[0]<-2e4)&&1==r?i.errorMsg(_("Value must be within -20000 to 20000 when Wrap Mode is on."),n):"string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<o.singer.inNoteBlock.length?o.singer.embeddedGraphics[last(o.singer.inNoteBlock)].push(n):o.singer.suppressOutput?(r=o.painter.penState,o.painter.penState=!1,o.painter.doForward(e[0]),o.painter.penState=r):o.painter.doForward(e[0]):i.errorMsg(_("Value must be within -5000 to 5000 when Wrap Mode is off."),n))}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["wrapmode"])).setPalette("graphics",i),e.formBlock({outType:"textout"}),e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t)})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["wrap",_("wrap")])).setPalette("graphics",i),e.beginnerBlock(!0),e.setHelpString([_("The Wrap block enables or disables screen wrapping for the graphics actions within it."),"documentation",null,"wraphelp"]),e.formBlock({name:_("wrap"),args:1,defaults:["on"],argTypes:["textin"]}),e.makeMacro(function(e,t){return[[0,"wrap",e,t,[null,1,null,2]],[1,["wrapmode",{value:"on"}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o,s,l;if(void 0!==e[1])return null===e[0]&&i.errorMsg(NOINPUTERRORMSG,n),l=null===e[0]?"on":e[0],s="_wrap_"+r,(o=i.turtles.ithTurtle(r)).painter.wrap="on"===l,void 0!==n&&n in i.blocks.blockList?t.setDispatchBlock(n,r,s):MusicBlocks.isRun&&null!==(l=Mouse.getMouseFromTurtle(o))&&l.MB.listeners.push(s),t.setTurtleListener(r,s,function(){o.painter.wrap=null}),[e[1],1]}}])})();(new e).setup(i),(new t).setup(i),(new r).setup(i),(new d).setup(i),(new m).setup(i),(new n).setup(i),(new o).setup(i),(new a).setup(i),(new s).setup(i),(new l).setup(i),(new u).setup(i),(new c).setup(i),(new p).setup(i),(new h).setup(i),(new g).setup(i),(new k).setup(i),(new f).setup(i)}"undefined"!=typeof module&&module.exports&&(module.exports={setupGraphicsBlocks:setupGraphicsBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupHeapBlocks(l){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["heap"])).setPalette("heap",l),e.beginnerBlock(!0),e.setHelpString([_("The Heap block returns the heap."),"documentation",""]),e.formBlock({name:_("heap"),outType:"numberout"}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==l.blocks.blockList[l.blocks.blockList[r].connections[0]].name)return JSON.stringify(e.turtleHeaps[t]);e.statusFields.push([r,"heap"])}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["showHeap"])).setPalette("heap",l),e.hidden=e.deprecated=!0,e.beginnerBlock(!0),e.setHelpString([_("The Show-heap block displays the contents of the heap at the top of the screen."),"documentation",""]),e.formBlock({name:_("show heap")}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){r in t.turtleHeaps||(t.turtleHeaps[r]=[]),l.textMsg(JSON.stringify(t.turtleHeaps[r]))}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["heapLength"])).setPalette("heap",l),e.beginnerBlock(!0),e.setHelpString([_("The Heap-length block returns the length of the heap."),"documentation",""]),e.formBlock({name:_("heap length"),outType:"numberout"}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t,r){if(t in e.turtleHeaps||(e.turtleHeaps[t]=[]),!e.inStatusMatrix||"print"!==l.blocks.blockList[l.blocks.blockList[r].connections[0]].name)return e.turtleHeaps[t].length;e.statusFields.push([r,"heapLength"])}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["heapEmpty"])).setPalette("heap",l),e.beginnerBlock(!0),e.setHelpString([_("The Heap-empty? block returns true if the heap is empty."),"documentation",""]),e.formBlock({name:_("heap empty?"),outType:"booleanout"}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t){return!(t in e.turtleHeaps)||0===e.turtleHeaps[t].length}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["emptyHeap"])).setPalette("heap",l),e.beginnerBlock(!0),e.setHelpString([_("The Empty-heap block empties the heap."),"documentation",""]),e.formBlock({name:_("empty heap")}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){t.turtleHeaps[r]=[]}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["reverseHeap"])).setPalette("heap",l),e.beginnerBlock(!0),e.setHelpString([_("The Reverse-heap block reverses the order of the heap."),"documentation",""]),e.formBlock({name:_("reverse heap")}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){t.turtleHeaps[r]=t.turtleHeaps[r].reverse()}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["indexHeap"])).setPalette("heap",l),e.beginnerBlock(!0),e.setHelpString([_("The Index-heap block returns a value in the heap at a specified location."),"documentation",""]),e.formBlock({name:_("index heap"),args:1,defaults:[1]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,n){var o=l.blocks.blockList[r].connections[1];if(null===o)l.errorMsg(NOINPUTERRORMSG,r);else{var a=e.parseArg(e,t,o,r,n);if("number"==typeof a){t in e.turtleHeaps||(e.turtleHeaps[t]=[]),-1===a?a=e.turtleHeaps[t].length:a<1&&(a=1,l.errorMsg(_("Index must be > 0."))),1e3<a&&(a=1e3,l.errorMsg(_("Maximum heap size is 1000.")));for(;e.turtleHeaps[t].length<a;)e.turtleHeaps[t].push(0);return e.turtleHeaps[t][a-1]}l.errorMsg(NANERRORMSG,r)}return 0}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setHeapEntry"])).setPalette("heap",l),e.beginnerBlock(!0),e.setHelpString([_("The Set-heap entry block sets a value in he heap at the specified location."),"documentation",""]),e.formBlock({name:_("set heap"),args:2,argTypes:["numberin","anyin"],defaults:[1,100],argLabels:[_("index"),"ja"===e.lang?_("value1"):_("value")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){if(null===e[0]||null===e[1])l.errorMsg(NOINPUTERRORMSG,n);else if("number"!=typeof e[0]||"number"!=typeof e[1])l.errorMsg(NANERRORMSG,n);else{r in t.turtleHeaps||(t.turtleHeaps[r]=[]);var o=Math.floor(e[0]);for(o<1&&(l.errorMsg(_("Index must be > 0.")),o=1),1e3<o&&(l.errorMsg(_("Maximum heap size is 1000.")),o=1e3);t.turtleHeaps[r].length<o;)t.turtleHeaps[r].push(0);t.turtleHeaps[r][o-1]=e[1]}}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pop"])).setPalette("heap",l),e.beginnerBlock(!0),e.setHelpString([_("The Pop block removes the value at the top of the heap."),"documentation",""]),e.formBlock({name:_("pop")}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t){return t in e.turtleHeaps&&0<e.turtleHeaps[t].length?e.turtleHeaps[t].pop():(l.errorMsg(_("empty heap")),0)}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["push"])).setPalette("heap",l),e.beginnerBlock(!0),e.setHelpString([_("The Push block adds a value to the top of the heap."),"documentation",""]),e.formBlock({name:_("push"),args:1,argTypes:["anyin"],defaults:[1]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?l.errorMsg(NOINPUTERRORMSG,n):(r in t.turtleHeaps||(t.turtleHeaps[r]=[]),t.turtleHeaps[r].push(e[0]))}}])})();(new e).setup(l),(new t).setup(l),(new r).setup(l),(new n).setup(l),(new o).setup(l),(new a).setup(l),(new s).setup(l),(new i).setup(l),(new u).setup(l),(new p).setup(l)}"undefined"!=typeof module&&module.exports&&(module.exports={setupHeapBlocks:setupHeapBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,a,i,l,s,u,c,p,f,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=n,c=r||[],p=!1,f={p:u=0,n:0,v:m,a:h,f:h.bind(m,4),d:function(e,t){return i=e,l=0,s=m,f.n=t,v}},function(e,t,n){if(1<u)throw TypeError("Generator is already running");for(p&&1===t&&h(t,n),l=t,s=n;(k=l<2?m:s)||!p;){i||(l?l<3?(1<l&&(f.n=-1),h(l,s)):f.n=s:f.v=s);try{if(u=2,i){if(k=i[e=l?e:"next"]){if(!(k=k.call(i,s)))throw TypeError("iterator result is not an object");if(!k.done)return k;s=k.value,l<2&&(l=0)}else 1===l&&(k=i.return)&&k.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+e+"' method"),l=1);i=m}else if((k=(p=f.n<0)?s:o.call(a,f))!==v)break}catch(e){i=m,l=1,s=e}finally{u=1}}return{value:k,done:p}}),!0),t;function h(e,t){for(l=e,s=t,k=0;!p&&u&&!n&&k<c.length;k++){var n,r=c[k],o=f.p,a=r[2];3<e?(n=a===t)&&(s=r[(l=r[4])?5:l=3],r[4]=r[5]=m):r[0]<=o&&((n=e<2&&o<r[1])?(l=0,f.v=t,f.n=r[1]):o<a&&(n=e<3||r[0]>t||a<t)&&(r[4]=e,r[5]=t,f.n=a,l=0))}if(n||1<e)return v;throw p=!0,t}}var v={};function g(){}function o(){}function a(){}var k=Object.getPrototypeOf,e=[][t]?k(k([][t]())):(_regeneratorDefine2(k={},t,function(){return this}),k),i=a.prototype=g.prototype=Object.create(e);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,n,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,n,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:l}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function _asyncToGenerator(l){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=l.apply(e,i);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupIntervalsBlocks(S){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["settemperament",_("set temperament")])).setPalette("intervals",S),e.beginnerBlock(!0),e.setHelpString([_("The Set temperament block is used to choose the tuning system used by Music Blocks."),"documentation",""]),e.formBlock({args:3,argLabels:[_("temperament"),_("pitch"),_("octave")]}),e.makeMacro(function(e,t){return[[0,"settemperament",e,t,[null,1,2,3,null]],[1,["temperamentname",{value:"equal"}],0,0,[0]],[2,["notename",{value:"C"}],0,0,[0]],[3,["number",{value:4}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e){Singer.IntervalsActions.setTemperament(e[0],e[1],e[2])}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["temperamentname",_("temperament name")])).setPalette("tone",S),e.setHelpString([_("The Temperament name block is used to select a tuning method."),"documentation",""]),e.extraWidth=50,e.hidden=!0,e.formBlock({outType:"anyout"}),e}return _inherits(t,ValueBlock),_createClass(t)})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["modename"])).setPalette("intervals",S),e.setHelpString(),e.formBlock({outType:"textout"}),e.extraWidth=50,e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t)})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["chordname"])).setPalette("intervals",S),e.setHelpString(),e.formBlock({outType:"textout"}),e.extraWidth=50,e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t)})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["doubly",_("doubly")])).setPalette("intervals",S),e.setHelpString([_("The Doubly block will double the size of an interval."),"documentation",null,"doublyhelp"]),e.formBlock({outType:"anyout",args:1,argTypes:["anyin"]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,n,r){var o=S.blocks.blockList[n].connections[1];if(null===o)return S.errorMsg(NOINPUTERRORMSG,n),0;for(var a=o,i=!0;i;){var l=S.blocks.blockList[a];if("intervalname"===l.name)return"a"===l.value[0]?e.parseArg(e,t,o,n,r)+1:"d"===l.value[0]?e.parseArg(e,t,o,n,r)-1:e.parseArg(e,t,o,n,r);if("doubly"!==l.name)return"number"==typeof(l=e.parseArg(e,t,o,n,r))?2*l:"string"==typeof l?l+l:l;if(null===(a=S.blocks.blockList[a].connections[1]))return i=!1,0}}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["intervalname"])).setPalette("intervals",S),e.setHelpString(),e.extraWidth=50,e.formBlock({outType:"numberout"}),e}return _inherits(t,ValueBlock),_createClass(t)})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["intervalnumber",_("interval number")])).setPalette("intervals",S),e.setHelpString([_("The Interval number block returns the number of scalar steps in the current interval."),"documentation",""]),e.formBlock({outType:"numberout"}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==S.blocks.blockList[S.blocks.blockList[n].connections[0]].name)return Singer.IntervalsActions.GetIntervalNumber(t);e.statusFields.push([n,"intervalnumber"])}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["currentinterval",_("current interval")])).setPalette("intervals",S),e.setHelpString([_("The Current interval block returns the name of scalar steps in the current interval."),"documentation",""]),e.formBlock({outType:"numberout"}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==S.blocks.blockList[S.blocks.blockList[n].connections[0]].name)return Singer.IntervalsActions.GetCurrentInterval(t);e.statusFields.push([n,"currentinterval"])}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["measureintervalsemitones"])).setPalette("intervals",S),e.setHelpString([_("The Semi-tone interval block measures the distance between two notes in semi-tones."),"documentation",""]),e.formBlock({name:_("semi-tone interval measure"),flows:{labels:[""],type:"flow"}}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,n){var r=S.blocks.blockList[n].connections[1];if(null===r)return S.errorMsg(NOINPUTERRORMSG,n),0;var o,a=S.turtles.ithTurtle(t),n=a.singer.suppressOutput,i=JSON.stringify(e.boxes),l=JSON.stringify(e.turtleHeaps[t]),s=JSON.stringify(e.turtleDicts[t]),u=a.x,c=a.y,p=a.painter.color,f=a.painter.value,h=a.painter.chroma,m=a.painter.stroke,v=a.painter.canvasAlpha,g=a.orientation,k=a.painter.penState;for(o in a.singer.suppressOutput=!0,a.singer.justCounting.push(!0),a.singer.justMeasuring.push(!0),a.endOfClampSignals)for(var b in a.butNotThese[o]=[],a.endOfClampSignals[o])a.butNotThese[o].push(b);var d=a.singer.notesPlayed,y=0;return a.running=!0,e.runFromBlockNow(e,t,r,!0,[],a.queue.length),0<a.singer.firstPitch.length&&0<a.singer.lastPitch.length?(y=last(a.singer.lastPitch)-last(a.singer.firstPitch),a.singer.firstPitch.pop(),a.singer.lastPitch.pop()):(y=0,S.errorMsg(_("You must use two pitch blocks when measuring an interval."))),a.singer.notesPlayed=d,e.boxes=JSON.parse(i),e.turtleHeaps[t]=JSON.parse(l),e.turtleDicts[t]=JSON.parse(s),a.painter.doPenUp(),a.painter.doSetXY(u,c),a.painter.color=p,a.painter.value=f,a.painter.chroma=h,a.painter.stroke=m,a.painter.canvasAlpha=v,a.painter.doSetHeading(g),a.painter.penState=k,a.singer.justCounting.pop(),a.singer.justMeasuring.pop(),a.singer.suppressOutput=n,a.butNotThese={},y}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["measureintervalscalar"])).setPalette("intervals",S),e.setHelpString([_("The Scalar interval block measures the distance between two notes in the current key and mode."),"documentation",""]),e.formBlock({name:_("scalar interval measure"),flows:{labels:[""],type:"flow"}}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,n){var r=S.blocks.blockList[n].connections[1];if(null===r)return S.errorMsg(NOINPUTERRORMSG,n),0;var o,a=S.turtles.ithTurtle(t),n=a.singer.suppressOutput,i=JSON.stringify(e.boxes),l=JSON.stringify(e.turtleHeaps[t]),s=JSON.stringify(e.turtleDicts[t]),u=a.x,c=a.y,p=a.painter.color,f=a.painter.value,h=a.painter.chroma,m=a.painter.stroke,v=a.painter.canvasAlpha,g=a.orientation,k=a.painter.penState;for(o in a.singer.suppressOutput=!0,a.singer.justCounting.push(!0),a.singer.justMeasuring.push(!0),a.endOfClampSignals)for(var b in a.butNotThese[o]=[],a.endOfClampSignals[o])a.butNotThese[o].push(b);var d=a.singer.notesPlayed,y=(a.running=!0,0);return e.runFromBlockNow(e,t,r,!0,[],a.queue.length),0<a.singer.firstPitch.length&&0<a.singer.lastPitch.length?(y=Singer.scalarDistance(e,t,last(a.singer.firstPitch),last(a.singer.lastPitch)),a.singer.firstPitch.pop(),a.singer.lastPitch.pop()):(y=0,S.errorMsg(_("You must use two pitch blocks when measuring an interval."))),a.singer.notesPlayed=d,e.boxes=JSON.parse(i),e.turtleHeaps[t]=JSON.parse(l),e.turtleDicts[t]=JSON.parse(s),a.painter.doPenUp(),a.painter.doSetXY(u,c),a.painter.color=p,a.painter.value=f,a.painter.chroma=h,a.painter.stroke=m,a.painter.canvasAlpha=v,a.painter.doSetHeading(g),a.painter.penState=k,a.singer.justCounting.pop(),a.singer.justMeasuring.pop(),a.singer.suppressOutput=n,a.butNotThese={},y}}])})();var c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["perfect"])).setPalette("intervals",S),e.setHelpString(),e.formBlock({name:_("perfect"),args:1,defaults:[5]}),e.hidden=!0,e}return _inherits(t,FlowClampBlock),_createClass(t)})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["semitoneinterval"])).setPalette("intervals",S),e.piemenuValuesC1=[-12,-11,-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12],e.setHelpString([_("The Semi-tone interval block calculates a relative interval based on half steps.")+" "+_("In the figure, we add sol# to sol."),"documentation",""]),e.formBlock({name:_("semi-tone interval")+" (+/–)",args:1,defaults:[5]}),e.makeMacro(function(e,t){return[[0,"semitoneinterval",e,t,[null,1,6,7]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:5}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,["number",{value:12}],0,0,[3]],[6,"vspace",0,0,[0,null]],[7,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1])return Singer.IntervalsActions.setSemitoneInterval(e[0],n,r),[e[1],1]}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["arpeggio"])).setPalette("intervals",S),e.setHelpString([_("The Arpeggio block will run each note block multiple times, adding a transposition based on the specified chord.")+" "+_("The output of the example is: do, mi, sol, sol, ti, mi"),"documentation",null,""]),e.formBlock({name:_("arpeggio"),argTypes:["textin"],args:1,defaults:[DEFAULTCHORD]}),e.makeMacro(function(e,t){return[[0,"arpeggio",e,t,[null,1,null,2]],[1,["chordname",{value:DEFAULTCHORD}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,a,i,l,t){if(e[0],void 0!==e[1]){var n=CHORDNAMES.indexOf(e[0]),s=(-1===n&&(n=CHORDNAMES.indexOf(DEFAULTCHORD)),Math.floor(CHORDVALUES[n].length)),u=S.turtles.ithTurtle(i);u.singer.duplicateFactor*=s,u.singer.arpeggio=[];for(var r=0;r<CHORDVALUES[n].length;r++)u.singer.arpeggio.push(CHORDVALUES[n][r]);for(var o="_duplicate_"+i,c=(a.setDispatchBlock(l,i,o),function(e,t){for(var n in a.connectionStore)if(n!==t.toString())for(var r in a.connectionStore[n])if(r===e.toString())return n;return null}),p=(u.singer.inDuplicate=!0,(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var n,r,o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return u.singer.inDuplicate=!1,u.singer.duplicateFactor/=s,u.singer.arpeggio=[],e.n=1,function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10;return new Promise(function(e){var t=0,n=function(){a.connectionStoreLock?t<r?(t++,setTimeout(n,o)):(console.warn("connectionStoreLock: Max retries reached, forcing lock acquisition"),a.connectionStoreLock=!0,e(!0)):(a.connectionStoreLock=!0,e(!0))};n()})}();case 1:try{if(null===c(l,i))for(n=a.connectionStore[i][l].length,r=0;r<n;r++)o=a.connectionStore[i][l].pop(),S.blocks.blockList[o[0]].connections[o[1]]=o[2],null!=o[2]&&(S.blocks.blockList[o[2]].connections[0]=o[0]);else delete a.connectionStore[i][l]}finally{a.connectionStoreLock=!1}case 2:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})()),f=(a.setTurtleListener(i,o,p),0);a.connectionStoreLock&&f<1e3;)f++;1e3<=f&&console.warn("connectionStoreLock: Max attempts reached in ArpeggioBlock flow"),a.connectionStoreLock=!0;var h=c(l,i);if(null!=h){a.connectionStore[i][l]=[];for(var m=a.connectionStore[h][l].length;0<m;m--){var v=[a.connectionStore[h][l][m-1][0],a.connectionStore[h][l][m-1][1],a.connectionStore[h][l][m-1][2]],v=(a.connectionStore[i][l].push(v),v[0]),v=("hidden"===S.blocks.blockList[v].name&&(v=S.blocks.blockList[v].connections[0]),new Queue(v,s,l,t));u.parentFlowQueue.push(l),u.queue.push(v)}}else{for(var g,k=S.blocks.findBottomBlock(e[1]);k!=l;)"hidden"!==S.blocks.blockList[k].name&&(g=new Queue(k,s,l,t),u.parentFlowQueue.push(l),u.queue.push(g)),k=S.blocks.blockList[k].connections[0];for(a.connectionStore[i][l]=[],k=e[1];null!=k;){var b=S.blocks.blockList[k].connections.length-1,d=S.blocks.blockList[k].connections[b];null!=d&&"hidden"===S.blocks.blockList[d].name?(a.connectionStore[i][l].push([d,1,S.blocks.blockList[d].connections[1]]),k=S.blocks.blockList[d].connections[1],S.blocks.blockList[d].connections[1]=null):(a.connectionStore[i][l].push([k,b,d]),S.blocks.blockList[k].connections[b]=null,k=d),null!=k&&(S.blocks.blockList[k].connections[0]=null)}}a.connectionStoreLock=!1}}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["chordinterval"])).setPalette("intervals",S),e.setHelpString([_("The Chord block calculates common chords.")+" "+_("In the figure, we generate a C-major chord."),"documentation",""]),e.formBlock({name:_("chord"),args:1,argTypes:["textin"],defaults:[DEFAULTCHORD]}),e.makeMacro(function(e,t){return[[0,"chordinterval",e,t,[null,1,null,2]],[1,["chordname",{value:DEFAULTCHORD}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1]){var o=CHORDNAMES.indexOf(e[0]);-1==o&&(o=CHORDNAMES.indexOf(DEFAULTCHORD));for(var a=0;a<CHORDVALUES[o].length;a++)isNaN(CHORDVALUES[o][a][0])||0===CHORDVALUES[o][a][0]&&0===CHORDVALUES[o][a][1]||Singer.IntervalsActions.setChordInterval(CHORDVALUES[o][a],n,r);return[e[1],1]}}}])})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["ratiointerval"])).setPalette("intervals",S),e.setHelpString([_("The Ratio Interval block calculates an interval based on a ratio."),"documentation",""]),e.formBlock({name:_("ratio interval"),args:1,argTypes:["anyin"],defaults:[1.5]}),e.makeMacro(function(e,t){return[[0,"ratiointerval",e,t,[null,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:3}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var o,a;if(void 0!==e[1])return o=S.blocks.blockList[r].connections[1],a=e[0],null===o?(S.errorMsg(NOINPUTERRORMSG,r),a=1):"intervalname"===S.blocks.blockList[o].name&&(a=(o=S.blocks.blockList[o].value)in INTERVALVALUES?INTERVALVALUES[o][2]:(console.log("could not find "+o+" in INTERVALVALUES"),1)),(isNaN(a)||a<0)&&(a=1,console.debug("ratio "+a+" must be a number > 0")),Singer.IntervalsActions.setRatioInterval(a,n,r),[e[1],1]}}])})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["interval"])).setPalette("intervals",S),e.piemenuValuesC1=[-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7],e.beginnerBlock(!0),e.setHelpString([_("The Scalar interval block calculates a relative interval based on the current mode, skipping all notes outside of the mode.")+" "+_("In the figure, we add la to sol."),"documentation",null,"intervalhelp"]),e.formBlock({name:_("scalar interval")+" (+/–)",args:1,defaults:[5]}),e.makeMacro(function(e,t){return[[0,"interval",e,t,[null,1,null,2]],[1,["number",{value:5}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1])return Singer.IntervalsActions.setScalarInterval(e[0],n,r),[e[1],1]}}])})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["definemode"])).setPalette("intervals",S),e.setHelpString([_("The Define mode block allows you to define a custom mode by specifying pitch numbers."),"documentation",null,"definemode"]),e.formBlock({name:_("define mode"),args:1,canCollapse:!0,argTypes:["textin"],defaults:_("custom")}),e.makeMacro(function(e,t){return[[0,"definemode",e,t,[null,1,2,16]],[1,["text",{value:"custom"}],0,0,[0]],[2,"pitchnumber",0,0,[0,3,4]],[3,["number",{value:0}],0,0,[2]],[4,"pitchnumber",0,0,[2,5,6]],[5,["number",{value:2}],0,0,[4]],[6,"pitchnumber",0,0,[4,7,8]],[7,["number",{value:4}],0,0,[6]],[8,"pitchnumber",0,0,[6,9,10]],[9,["number",{value:5}],0,0,[8]],[10,"pitchnumber",0,0,[8,11,12]],[11,["number",{value:7}],0,0,[10]],[12,"pitchnumber",0,0,[10,13,14]],[13,["number",{value:9}],0,0,[12]],[14,"pitchnumber",0,0,[12,15,null]],[15,["number",{value:11}],0,0,[14]],[16,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[1])return Singer.IntervalsActions.defineMode(e[0],n,r),[e[1],1]}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["movable",_("movable Do")])).setPalette("intervals",S),e.beginnerBlock(!0),e.setHelpString([_("When Movable do is false, the solfege note names are always tied to specific pitches,")+" "+_('eg "do" is always "C-natural" when Movable do is true, the solfege note names are assigned to scale degrees "do" is always the first degree of the major scale.'),"documentation",null,"moveablehelp"]),e.size=0,e.formBlock({args:1,argTypes:["booleanin"]}),e.makeMacro(function(e,t){return[[0,"movable",e,t,[null,1,null]],[1,["boolean",{value:!0}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n){1===e.length&&Singer.IntervalsActions.setMovableDo(e[0],n)}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["modelength",_("mode length")])).setPalette("intervals",S),e.beginnerBlock(!0),e.parameter=!0,e.setHelpString([_("The Mode length block is the number of notes in the current scale.")+" "+_("Most Western scales have 7 notes."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==S.blocks.blockList[S.blocks.blockList[n].connections[0]].name)return Singer.IntervalsActions.getModeLength(t);e.statusFields.push([n,"modelength"])}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["currentmode",_("current mode")])).setPalette("intervals",S),e.parameter=!0,e.setHelpString(),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==S.blocks.blockList[S.blocks.blockList[n].connections[0]].name)return Singer.IntervalsActions.getCurrentMode(t);e.statusFields.push([n,"currentmode"])}}])})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["key",_("current key")])).setPalette("intervals",S),e.parameter=!0,e.setHelpString(),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return S.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==S.blocks.blockList[S.blocks.blockList[n].connections[0]].name)return Singer.IntervalsActions.getCurrentKey(t);e.statusFields.push([n,"key"])}}])})(),C=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setkey",_("set key")])).setPalette("intervals",S),e.beginnerBlock(!0),e.setHelpString(),e.formBlock({args:1,argTypes:["textin"],defaults:["C"]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n){1===e.length&&(S.turtles.ithTurtle(n).singer.keySignature=e[0])}}])})(),w=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setkey2",_("set key")])).setPalette("intervals",S),e.beginnerBlock(!0),S.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Set key block is used to set the key and mode,"),"documentation",""]):e.setHelpString([_("The Set key block is used to set the key and mode,")+" "+_("eg C Major"),"documentation",null,"movablehelp"]),e.formBlock({args:2,argTypes:["anyin","anyin"],argLabels:[_("key"),_("mode")]}),e.makeMacro(function(e,t){return[[0,"setkey2",e,t,[null,1,2,null]],[1,["notename",{value:"C"}],0,0,[0]],[2,["modename",{value:"major"}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var o;2===e.length&&(o=Singer.IntervalsActions.GetModename(e[1]),t.modeBlock=S.blocks.blockList[r].connections[2],Singer.IntervalsActions.setKey(e[0],e[1],n,r),t.insideModeWidget)&&(S.turtles.ithTurtle(0).singer.keySignature=e[0]+" "+o,t.notation.notationKey(0,e[0],o))}}])})();(new e).setup(S),(new t).setup(S),(new r).setup(S),(new n).setup(S),(new o).setup(S),(new a).setup(S),(new i).setup(S),(new l).setup(S),(new s).setup(S),(new u).setup(S),new((()=>{function t(n,r,o){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,[(o?"down":"")+n+r,_((o?"down ":"")+n)+" "+r])).setPalette("intervals",S),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"semitoneinterval",e,t,[null,1,6,7]]].concat([o?[1,"minus",0,0,[0,8,3]]:[1,"plus",0,0,[0,2,3]]],[[2,["intervalname",{value:n+" "+r}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,["number",{value:12}],0,0,[3]],[6,"vspace",0,0,[0,null]],[7,"hidden",0,0,[0,null]]],_toConsumableArray(o?[[8,"neg",0,0,[1,2]]]:[]))}),e}return _inherits(t,FlowBlock),_createClass(t)})())("major",3,!1).setup(S),(new c).setup(S),(new f).setup(S),(new h).setup(S),(new m).setup(S),(new p).setup(S),(new v).setup(S),(new g).setup(S),(new k).setup(S),(new b).setup(S),(new d).setup(S),(new y).setup(S),(new C).setup(S),(new w).setup(S)}
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,_toPropertyKey(a.key),a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupMediaBlocks(s){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["rightpos",_("right (screen)")])).setPalette("media",s),e.beginnerBlock(!0),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Right block returns the position of the right of the canvas.")+" "+_("In this example, the mouse moves right until it reaches the right edge of the canvas; then it reappears at the left of the canvas."),"documentation",null,"lrhelp"]):e.setHelpString([_("The Right block returns the position of the right of the canvas.")+" "+_("In this example, the turtle moves right until it reaches the right edge of the canvas; then it reappears at the left of the canvas."),"documentation",null,"lrhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(){return toFixed2(s.turtles._canvas.width/(2*s.turtles.scale))}},{key:"arg",value:function(){return s.turtles._canvas.width/(2*s.turtles.scale)}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["leftpos",_("left (screen)")])).setPalette("media",s),e.beginnerBlock(!0),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Left block returns the position of the left of the canvas.")+" "+_("In this example, the mouse moves right until it reaches the right edge of the canvas; then it reappears at the left of the canvas."),"documentation",null,"lrhelp"]):e.setHelpString([_("The Left block returns the position of the left of the canvas.")+" "+_("In this example, the turtle moves right until it reaches the right edge of the canvas; then it reappears at the left of the canvas."),"documentation",null,"lrhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(){return toFixed2(s.turtles._canvas.width/(2*s.turtles.scale)*-1)}},{key:"arg",value:function(){return s.turtles._canvas.width/(2*s.turtles.scale)*-1}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["toppos",_("top (screen)")])).setPalette("media",s),e.beginnerBlock(!0),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Top block returns the position of the top of the canvas.")+" "+_("In this example, the mouse moves upward until it reaches the top edge of the canvas; then it reappears at the bottom of the canvas."),"documentation",null,"bottomposhelp"]):e.setHelpString([_("The Top block returns the position of the top of the canvas.")+" "+_("In this example, the turtle moves upward until it reaches the top edge of the canvas; then it reappears at the bottom of the canvas."),"documentation",null,"bottomposhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(){return toFixed2(s.turtles._canvas.height/(2*s.turtles.scale))}},{key:"arg",value:function(){return s.turtles._canvas.height/(2*s.turtles.scale)}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["bottompos",_("bottom (screen)")])).setPalette("media",s),e.beginnerBlock(!0),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Bottom block returns the position of the bottom of the canvas.")+" "+_("In this example, the mouse moves upward until it reaches the top edge of the canvas; then it reappears at the bottom of the canvas."),"documentation",null,"bottomposhelp"]):e.setHelpString([_("The Bottom block returns the position of the bottom of the canvas.")+" "+_("In this example, the turtle moves upward until it reaches the top edge of the canvas; then it reappears at the bottom of the canvas."),"documentation",null,"bottomposhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(){return toFixed2(s.turtles._canvas.height/(2*s.turtles.scale)*-1)}},{key:"arg",value:function(){return s.turtles._canvas.height/(2*s.turtles.scale)*-1}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["width",_("width")])).setPalette("media",s),e.beginnerBlock(!0),e.parameter=!0,e.setHelpString([_("The Width block returns the width of the canvas."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(){return toFixed2(s.turtles._canvas.width/s.turtles.scale)}},{key:"arg",value:function(){return s.turtles._canvas.width/s.turtles.scale}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["height",_("height")])).setPalette("media",s),e.beginnerBlock(!0),e.parameter=!0,e.setHelpString([_("The Height block returns the height of the canvas."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(){return toFixed2(s.turtles._canvas.height/s.turtles.scale)}},{key:"arg",value:function(){return s.turtles._canvas.height/s.turtles.scale}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["stopplayback",_("stop play")])).setPalette("media",s),e.setHelpString(),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t){for(var r in t.sounds)t.sounds[r].stop();t.sounds=[]}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["erasemedia",_("erase media")])).setPalette("media",s),e.setHelpString([_("The Erase Media block erases text and images."),"documentation",""]),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){s.turtles.ithTurtle(r).painter.doClearMedia()}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["playback",_("play back")])).setPalette("media",s),e.setHelpString(),e.formBlock({args:1,defaults:[null],argTypes:["mediain"]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,a){null===e[0]?s.errorMsg(NOINPUTERRORMSG,a):(a=new Howl({urls:[e[0]]}),t.sounds.push(a),a.play())}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["speak",_("speak")])).setPalette("media",s),e.beginnerBlock(!0),e.setHelpString([_("The Speak block outputs to the text-to-speech synthesizer"),"documentation",""]),e.formBlock({args:1,defaults:["hello"],argTypes:["textin"]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,a){r=s.turtles.ithTurtle(r);1===e.length&&null!==t.meSpeak&&(0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(a):r.singer.suppressOutput||t.processSpeak(e[0]))}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["camera",_("camera")])).setPalette("media",s),e.setHelpString([_("The Camera block connects a webcam to the Show block."),"documentation",""]),e.formBlock({image:"images/camera.svg"}),e}return _inherits(t,ValueBlock),_createClass(t)})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["video",_("video")])).setPalette("media",s),e.setHelpString([_("The Video block selects video for use with the Show block."),"documentation",""]),e.formBlock({image:"images/video.svg"}),e}return _inherits(t,ValueBlock),_createClass(t)})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["loadFile",_("open file")])).setPalette("media",s),e.setHelpString([_("The Open file block opens a file for use with the Show block."),"documentation",""]),e.formBlock({outType:"fileout"}),e.parameter=!1,e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t,r){return s.blocks.blockList[r].value}}])})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["stopvideocam",_("stop media")])).setPalette("media",s),e.setHelpString([_("The Stop media block stops audio or video playback."),"documentation",""]),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t){null!=t.cameraID&&doStopVideoCam(t.cameraID,t.setCameraID)}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["tone",_("hertz")])).setPalette("media",s),e.piemenuValuesC1=[220,247,262,294,330,349,392,440,494,523,587,659,698,784,880],e.setHelpString(),e.formBlock({args:2,defaults:[392,1e3/3],argLabels:[_("frequency"),_("duration (MS)")]}),e.formBlock(function(e,t){return[[0,"drift",e,t,[null,1,null]],[1,"osctime",0,0,[0,3,2,null]],[2,"vspace",0,0,[1,6]],[3,"divide",0,0,[1,4,5]],[4,["number",{value:1e3}],0,0,[3]],[5,["number",{value:3}],0,0,[3]],[6,"hertz",0,0,[2,7,null]],[7,["number",{value:392}],0,0,[6]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(){}}])})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["tofrequency",_("note to frequency")])).setPalette("media",s),e.parameter=!0,e.setHelpString([_("The To frequency block converts a pitch name and octave to Hertz."),"documentation",""]),e.formBlock({args:2,defaults:["G",4],argTypes:["notein","anyin"],argLabels:["ja"===e.lang?_("name2"):_("name"),_("octave")]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(s.blocks.blockList[r].value)}},{key:"arg",value:function(e,t,r,a){var n=s.turtles.ithTurtle(t),o=s.blocks.blockList[r].connections[1],l=s.blocks.blockList[r].connections[2];return null===o||null===l?(s.errorMsg(NOINPUTERRORMSG,r),392):(o=e.parseArg(e,t,o,r,a),e=Math.floor(calcOctave(n.singer.currentOctave,e.parseArg(e,t,l,r,a),n.singer.lastNotePlayed,o)),Math.round(pitchToFrequency(o,e,0,n.singer.keySignature)))}}])})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["turtleshell",_("avatar")])).setPalette("media",s),e.beginnerBlock(!0),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Avatar block is used to change the appearance of the mouse."),"documentation",null,"turtleshell"]):e.setHelpString([_("The Avatar block is used to change the appearance of the turtle."),"documentation",null,"turtleshell"]),e.formBlock({args:2,defaults:[55,null],argTypes:["numberin","anyin"],argLabels:[_("size"),_("image")]}),e.makeMacro(function(e,t){return[[0,"turtleshell",e,t,[null,1,2,3]],[1,["number",{value:55}],0,0,[0]],[2,"media",0,0,[0]],[3,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,a){2===e.length&&("string"==typeof e[0]?s.errorMsg(NANERRORMSG,a):s.turtles.getTurtle(r).doTurtleShell(e[0],e[1]))}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["show"])).setPalette("media",s),e.beginnerBlock(!0),e.setHelpString([_("The Show block is used to display text or images on the canvas."),"documentation",""]),e.formBlock({name:"ja"===e.lang?_("show1"):_("Show").toLowerCase(),args:2,argLabels:[_("size"),_("obj")],defaults:[24,_("text")],argTypes:["numberin","anyin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,a){var n=s.turtles.ithTurtle(r);2===e.length&&(0<n.singer.inNoteBlock.length?n.singer.embeddedGraphics[last(n.singer.inNoteBlock)].push(a):n.singer.suppressOutput||t.processShow(r,a,e[0],e[1]))}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["media",_("media")])).setPalette("media",s),e.beginnerBlock(!0),e.setHelpString([_("The Media block is used to import an image."),"documentation",null,"turtleshell"]),e.formBlock({image:"images/load-media.svg",outType:"mediaout"}),e}return _inherits(t,ValueBlock),_createClass(t)})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["text",_("text")])).extraWidth=30,e.setPalette("media",s),e.beginnerBlock(!0),e.setHelpString([_("The Text block holds a text string."),"documentation",""]),e.formBlock({outType:"textout"}),e}return _inherits(t,ValueBlock),_createClass(t)})();(new e).setup(s),(new t).setup(s),(new r).setup(s),(new a).setup(s),(new n).setup(s),(new o).setup(s),(new h).setup(s),(new l).setup(s),(new u).setup(s),(new c).setup(s),(new p).setup(s),(new f).setup(s),(new m).setup(s),(new d).setup(s),(new g).setup(s),(new v).setup(s),(new i).setup(s),(new k).setup(s),(new b).setup(s),(new y).setup(s)}"undefined"!=typeof module&&module.exports&&(module.exports={setupMediaBlocks:setupMediaBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupMeterBlocks(s){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["currentmeter",_("current meter")])).setPalette("meter",s),e.parameter=!0,e.setHelpString(),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==s.blocks.blockList[s.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getCurrentMeter(t);e.statusFields.push([r,"currentmeter"])}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["beatfactor",_("beat factor")])).setPalette("meter",s),e.parameter=!0,e.setHelpString([_("The Beat factor block returns the ratio of the note value to the meter note value."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"setter",value:function(e,t,r){s.turtles.ithTurtle(r).singer.beatFactor=t}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==s.blocks.blockList[s.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getBeatFactor(t);e.statusFields.push([r,"beatfactor"])}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["bpmfactor"])).setPalette("meter",s),e.parameter=!0,e.setHelpString([_("The Beats per minute block returns the current beats per minute."),"documentation",""]),e.formBlock({name:"ja"===e.lang?_("beats per minute2"):_("beats per minute")}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"setter",value:function(e,t,r){var r=s.turtles.ithTurtle(r),n=r.singer.bpm.length;0<n?r.singer.bpm[n-1]=t:r.singer.bpm.push(t)}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==s.blocks.blockList[s.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getBPM(t);e.statusFields.push([r,"bpm"])}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["measurevalue",_("measure count")])).setPalette("meter",s),e.parameter=!0,e.setHelpString([_("The Measure count block returns the current measure."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==s.blocks.blockList[s.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getMeasureCount(t);e.statusFields.push([r,"measurevalue"])}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["beatvalue",_("beat count")])).setPalette("meter",s),e.beginnerBlock(!0),e.parameter=!0,s.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Beat count block is the number of the current beat,")+" "+_("In the figure, it is used to take an action on the first beat of each measure."),"documentation",null,"everybeathelp"]):e.setHelpString([_("The Beat count block is the number of the current beat,")+" "+_("eg 1, 2, 3, or 4.")+" "+_("In the figure, it is used to take an action on the first beat of each measure."),"documentation",null,"beatvaluehelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==s.blocks.blockList[s.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getBeatCount(t);e.statusFields.push([r,"beatvalue"])}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["notecounter",_("sum note values")])).setPalette("meter",s),e.parameter=!0,e.setHelpString([_("The Note counter block can be used to count the number of contained notes."),"documentation",null,"notecounterhelp"]),e.formBlock({flows:{labels:[""],type:"flow"}}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){var n=s.blocks.blockList[r].connections[1];return null===n?(s.errorMsg(NOINPUTERRORMSG,r),0):Singer.noteCounter(e,t,n)}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["notecounter2",_("note counter")])).setPalette("meter",s),e.parameter=!0,e.setHelpString([_("The Note counter block can be used to count the number of contained notes."),"documentation",null,"notecounterhelp"]),e.formBlock({flows:{labels:[""],type:"flow"}}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){var n=s.blocks.blockList[r].connections[1];return null===n?(s.errorMsg(NOINPUTERRORMSG,r),0):Singer.numberOfNotes(e,t,n)}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["elapsednotes",_("whole notes played")])).setPalette("meter",s),e.parameter=!0,e.beginnerBlock(!0),e.setHelpString([_("The Whole notes played block returns the total number of whole notes played."),"documentation",null,"elapsedhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==s.blocks.blockList[s.blocks.blockList[r].connections[0]].name)return Singer.MeterActions.getWholeNotesPlayed(t);e.statusFields.push([r,"elapsednotes"])}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["elapsednotes2",_("notes played")])).setPalette("meter",s),e.beginnerBlock(!0),e.parameter=!0,s.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Beat count block is the number of the current beat,")+" "+_("In the figure, it is used to take an action on the first beat of each measure."),"documentation",null,"everybeathelp"]):e.setHelpString([_("The Beat count block is the number of the current beat,")+" "+_("eg 1, 2, 3, or 4.")+" "+_("In the figure, it is used to take an action on the first beat of each measure."),"documentation",null,"beatvaluehelp"]),e.formBlock({args:1}),e.makeMacro(function(e,t){return[[0,"elapsednotes2",e,t,[null,1]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]]]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r,n){var o;if(!e.inStatusMatrix||"print"!==s.blocks.blockList[s.blocks.blockList[r].connections[0]].name)return o=s.blocks.blockList[r].connections[1],o=e.parseArg(e,t,o,r,n),Singer.MeterActions.getNotesPlayed(o,t);e.statusFields.push([r,"elapsednotes2"])}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["drift"])).setPalette("meter",s),e.setHelpString([_("The No clock block decouples the notes from the master clock."),"documentation",""]),e.formBlock({name:_("no clock")}),e.makeMacro(function(e,t){return[[0,"drift",e,t,[null,null,1]],[1,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){if(void 0!==e[0])return Singer.MeterActions.setNoClock(r,n),[e[0],1]}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["offbeatdo",_("on weak beat do")])).setPalette("meter",s),e.setHelpString([_("The On-weak-beat block lets you specify actions to take on weak (off) beats."),"documentation",null,"everybeathelp"]),e.formBlock({args:1,argTypes:["textin"],defaults:[_("action")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n,o,a,l){e[0]in t.actions?Singer.MeterActions.onWeakBeatDo(e[0],l,o,r,n):s.errorMsg(NOACTIONERRORMSG,n,e[1])}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["onbeatdo",_("on strong beat")])).setPalette("meter",s),e.piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],e.setHelpString([_("The On-strong-beat block lets you specify actions to take on specified beats."),"documentation",null,"everybeathelp"]),e.formBlock({args:2,argTypes:["numberin","textin"],defaults:[1,_("action")],argLabels:[_("beat"),"ja"===e.lang?_("do1"):_("do")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n,o,a,l){2===e.length&&(e[1]in t.actions?Singer.MeterActions.onStrongBeatDo(e[0],e[1],l,o,r,n):s.errorMsg(NOACTIONERRORMSG,n,e[1]))}}])})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["everybeatdonew",_("on every beat do")])).setPalette("meter",s),e.beginnerBlock(!0),e.setHelpString([_("The On-every-beat block lets you specify actions to take on every beat."),"documentation",null,"everybeathelp"]),e.formBlock({args:1,argTypes:["textin"],defaults:[_("action")]}),e.makeMacro(function(e,t){return[[0,["everybeatdonew",{}],e,t,[null,1,null]],[1,["text",{value:"action"}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n,o,a,l){e[0]in t.actions?Singer.MeterActions.onEveryBeatDo(e[0],l,o,r,n):s.errorMsg(NOACTIONERRORMSG,n,e[1])}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["everybeatdo",_("on every note do")])).setPalette("meter",s),e.beginnerBlock(!0),e.setHelpString([_("The On-every-note block lets you specify actions to take on every note."),"documentation",null,"everybeathelp"]),e.formBlock({args:1,argTypes:["textin"],defaults:[_("action")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n,o,a,l){e[0]in t.actions?Singer.MeterActions.onEveryNoteDo(e[0],l,o,r,n):s.errorMsg(NOACTIONERRORMSG,n,e[1])}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setmasterbpm2",_("master beats per minute")])).setPalette("meter",s),e.piemenuValuesC1=[42,46,50,54,58,63,69,76,84,90,96,104,112,120,132,144,160,176,192,208],e.beginnerBlock(!0),e.setHelpString([_("The Master beats per minute block sets the number of 1/4 notes per minute for every voice."),"documentation",null,"setmasterbpm2"]),e.formBlock({args:2,defaults:[90,.25],argLabels:[_("bpm"),_("beat value")]}),e.makeMacro(function(e,t){return[[0,"setmasterbpm2",e,t,[null,1,2,5]],[1,["number",{value:90}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&(Singer.MeterActions.setMasterBPM(e[0],e[1],n),t.notation.notationTempo(r,e[0],e[1])),t.inTempo&&(t.tempo.BPMBlocks.push(n),r=s.blocks.blockList[n].connections[1],t.tempo.BPMs.push(s.blocks.blockList[r].text.text))}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setmasterbpm",_("master beats per minute")])).setPalette("meter",s),e.formBlock({args:1,defaults:[90]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){1===e.length&&"number"==typeof e[0]&&(e[0]<30?(s.errorMsg(_("Beats per minute must be > 30."),n),Singer.masterBPM=30):1e3<e[0]?(s.errorMsg(_("Maximum beats per minute is 1000."),n),Singer.masterBPM=1e3):Singer.masterBPM=e[0],Singer.defaultBPMFactor=TONEBPM/Singer.masterBPM),t.inTempo&&(t.tempo.BPMBlocks.push(n),e=s.blocks.blockList[n].connections[1],t.tempo.BPMs.push(s.blocks.blockList[e].text.text))}}])})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setbpm3",_("beats per minute")])).setPalette("meter",s),e.piemenuValuesC1=[42,46,50,54,58,63,69,76,84,90,96,104,112,120,132,144,160,176,192,208],e.beginnerBlock(!0),e.setHelpString([_("The Beats per minute block sets the number of 1/4 notes per minute."),"documentation",null,"bpmhelp"]),e.formBlock({args:2,defaults:[90,.25],argLabels:[_("bpm"),_("beat value")]}),e.makeMacro(function(e,t){return[[0,"setbpm3",e,t,[null,1,2,5]],[1,["number",{value:90}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&(Singer.MeterActions.setBPM(e[0],e[1],r,n),t.notation.notationTempo(r,e[0],e[1])),t.inTempo&&(t.tempo.BPMBlocks.push(n),r=s.blocks.blockList[n].connections[1],t.tempo.BPMs.push(s.blocks.blockList[r].text.text))}}])})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setbpm2"])).setPalette("meter",s),e.formBlock({name:_("beats per minute"),args:2,argLabels:[_("bpm"),_("beat value")],defaults:[90,.25]}),e.makeMacro(function(e,t){return[[0,"setbpm2",e,t,[null,1,3,2,6]],[1,["number",{value:90}],0,0,[0]],[2,"vspace",0,0,[0,null]],[3,"divide",0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"hidden",0,0,[0,null]]]}),e.hidden=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o,a=s.turtles.ithTurtle(r);if(3===e.length&&"number"==typeof e[0]&&"number"==typeof e[1])return o=e[0]*e[1]/.25,e[0]<30?(s.errorMsg(_("Beats per minute must be > 30.")),o=30):1e3<e[0]&&(s.errorMsg(_("Maximum beats per minute is 1000.")),o=1e3),t.notation.notationTempo(r,e[0],e[1]),a.singer.bpm.push(o),t.setDispatchBlock(n,r,o="_bpm_"+r),t.setTurtleListener(r,o,function(e){a.singer.bpm.pop()}),[e[2],1]}}])})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setbpm"])).setPalette("meter",s),e.formBlock({name:_("beats per minute"),args:1,defaults:[90]}),e.makeMacro(function(e,t){return[[0,"setbpm",e,t,[null,1,null,2]],[1,["number",{value:90}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e.hidden=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o,a=s.turtles.ithTurtle(r);if(2===e.length&&"number"==typeof e[0])return o=e[0]<30?(s.errorMsg(_("Beats per minute must be > 30."),n),30):1e3<e[0]?(s.errorMsg(_("Maximum beats per minute is 1000."),n),1e3):e[0],a.singer.bpm.push(o),t.setDispatchBlock(n,r,o="_bpm_"+r),t.setTurtleListener(r,o,function(e){a.singer.bpm.pop()}),[e[1],1]}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pickup",_("pickup")])).setPalette("meter",s),e.setHelpString([_("The Pickup block is used to accommodate any notes that come in before the beat."),"documentation",null,"pickup"]),e.extraWidth=15,e.formBlock({args:1,defaults:[0]}),e.makeMacro(function(e,t){return[[0,"pickup",e,t,[null,1,4]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:0}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o=e[0];1!==e.length||"number"!=typeof e[0]||o<0?s.errorMsg(NOINPUTERRORMSG,n):Singer.MeterActions.setPickup(o,r,s)}}])})(),S=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["meter",_("meter")])).setPalette("meter",s),e.piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],e.beginnerBlock(!0),e.setHelpString([_("The beat of the music is determined by the Meter block (by default, 4 1/4 notes per measure)."),"documentation",null,"meter"]),e.extraWidth=15,e.formBlock({args:2,defaults:[4,.25],argLabels:[_("number of beats"),_("note value")]}),e.makeMacro(function(e,t){return[[0,"meter",e,t,[null,1,2,5]],[1,["number",{value:4}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var o=null===e[0]||"number"!=typeof e[0]?4:e[0],a=null===e[1]||"number"!=typeof e[1]?.25:e[1];null!==e[0]&&"number"==typeof e[0]&&null!==e[1]&&"number"==typeof e[1]||s.errorMsg(NOINPUTERRORMSG,n),t.insideMeterWidget&&(t._meterBlock=n),t.inMusicKeyboard&&(t.musicKeyboard.meterArgs=e),Singer.MeterActions.setMeter(o,a,r)}}])})();(new e).setup(s),(new t).setup(s),(new r).setup(s),(new n).setup(s),(new o).setup(s),(new a).setup(s),(new l).setup(s),(new u).setup(s),(new i).setup(s),(new c).setup(s),(new p).setup(s),(new b).setup(s),(new m).setup(s),(new f).setup(s),(new k).setup(s),(new h).setup(s),(new v).setup(s),(new g).setup(s),(new y).setup(s),(new d).setup(s),(new S).setup(s)}"undefined"!=typeof module&&module.exports&&(module.exports=setupMeterBlocks);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupNumberBlocks(u){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["int"])).setPalette("number",u),e.setHelpString([_("The Int block returns an integer."),"documentation",""]),e.formBlock({name:_("int"),args:1,argTypes:["anyin"],defaults:[100]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,r,n){if(e.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[r].connections[0]].name)e.statusFields.push([r,"int"]);else{var o=u.blocks.blockList[r].connections[1];if(null===o)return u.errorMsg(NOINPUTERRORMSG,r),0;e=e.parseArg(e,t,o,r,n);try{return MathUtility.doInt(e)}catch(e){return this.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}}}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mod"])).setPalette("number",u),e.setHelpString([_("The Mod block returns the remainder from a division."),"documentation",""]),e.formBlock({name:_("mod"),args:2,defaults:[100,12]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(t,e,r,n){if(t.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[r].connections[0]].name)t.statusFields.push([r,"mod"]);else{var o=u.blocks.blockList[r].connections[1],s=u.blocks.blockList[r].connections[2];if(null===o||null===s)return u.errorMsg(NOINPUTERRORMSG,r),0;o=t.parseArg(t,e,o,r,n);if("string"==typeof o)try{o=parseInt(o)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}e=t.parseArg(t,e,s,r,n);if("string"==typeof e)try{e=parseInt(e)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}try{return MathUtility.doMod(o,e)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}}}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["power"])).setPalette("number",u),e.setHelpString([_("The Power block calculates a power function."),"documentation",""]),e.fontsize=14,e.formBlock({name:"^",args:2,defaults:[2,4]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(t,e,r,n){if(t.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[r].connections[0]].name)t.statusFields.push([r,"power"]);else{var o=u.blocks.blockList[r].connections[1],s=u.blocks.blockList[r].connections[2];if(null===o||null===s)return u.errorMsg(NOINPUTERRORMSG,r),null!==o?t.parseArg(t,e,o,r,n):0;o=t.parseArg(t,e,o,r,n),e=t.parseArg(t,e,s,r,n);try{return MathUtility.doPower(o,e)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}}}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["sqrt"])).setPalette("number",u),e.setHelpString([_("The Sqrt block returns the square root."),"documentation",""]),e.formBlock({name:_("sqrt"),args:1,defaults:[64]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(t,r,n,e){if(t.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[n].connections[0]].name)t.statusFields.push([n,u.blocks.blockList[n].name]);else{var o=u.blocks.blockList[n].connections[1];if(null===o)return u.errorMsg(NOINPUTERRORMSG,n),0;r=t.parseArg(t,r,o,n,e);try{return MathUtility.doSqrt(r)}catch(e){if(t.stopTurtle=!0,"NanError"===e)u.errorMsg(NANERRORMSG,n);else if("NoSqrtError"===e)return u.errorMsg(NOSQRTERRORMSG,n),MathUtility.doSqrt(-r);return 0}}}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["abs"])).setPalette("number",u),e.setHelpString([_("The Abs block returns the absolute value."),"documentation",""]),e.formBlock({name:_("abs"),args:1}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(e,t,r,n){if(e.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[r].connections[0]].name)e.statusFields.push([r,u.blocks.blockList[r].name]);else{var o=u.blocks.blockList[r].connections[1];if(null===o)return u.errorMsg(NOINPUTERRORMSG,r),0;e=e.parseArg(e,t,o,r,n);try{return MathUtility.doAbs(e)}catch(e){return this.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}}}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["distance"])).setPalette("number",u),e.setHelpString([_("The Distance block returns the distance between two points. For example, between the mouse and the center of the screen."),"documentation",""]),e.formBlock({name:_("distance"),args:4,defaults:[0,0,100,100],argTypes:["anyin","anyin","anyin","anyin"],outType:"anyout",argLabels:["x1","y1","x2","y2"]}),e.makeMacro(function(e,t){return[[0,"distance",e,t,[null,1,2,3,4]],[1,["number",{value:0}],0,0,[0]],[2,["number",{value:0}],0,0,[0]],[3,"x",0,0,[0]],[4,"y",0,0,[0]]]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(e,t,r,n){if(e.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[r].connections[0]].name)e.statusFields.push([r,"distance"]);else{var o=u.blocks.blockList[r].connections[1],s=u.blocks.blockList[r].connections[2],l=u.blocks.blockList[r].connections[3],c=u.blocks.blockList[r].connections[4];if(null===o||null===s||null===l||null===c)return u.errorMsg(NOINPUTERRORMSG,r),0;o=e.parseArg(e,t,o,r,n),s=e.parseArg(e,t,s,r,n),l=e.parseArg(e,t,l,r,n),e=e.parseArg(e,t,c,r,n);try{return MathUtility.doCalculateDistance(o,s,l,e)}catch(e){return u.errorMsg(NANERRORMSG,r),0}}}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["divide"])).setPalette("number",u),e.beginnerBlock(!0),e.setHelpString([_("The Divide block is used to divide."),"documentation",null,"note1"]),e.fontsize=9,e.formBlock({name:"ja"===e.lang?"➗":"/",args:2,argTypes:["anyin","anyin"],defaults:[1,4]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return u.blocks.blockList[r].value}},{key:"arg",value:function(t,e,r,n){if(t.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[r].connections[0]].name)t.statusFields.push([r,"divide"]);else{var o=u.blocks.blockList[r].connections[1],s=u.blocks.blockList[r].connections[2];if(null===o||null===s)return u.errorMsg(NOINPUTERRORMSG,r),null!==o?t.parseArg(t,e,o,r,n):0;o=t.parseArg(t,e,o,r,n);if("string"==typeof o)try{o=parseInt(o)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}e=t.parseArg(t,e,s,r,n);if("string"==typeof e)try{e=parseInt(e)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}try{return MathUtility.doDivide(o,e)}catch(e){return t.stopTurtle=!0,"NanError"===e?u.errorMsg(NANERRORMSG,r):"DivByZeroError"===e&&u.errorMsg(ZERODIVIDEERRORMSG,r),0}}}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["multiply"])).setPalette("number",u),e.beginnerBlock(!0),e.setHelpString([_("The Multiply block is used to multiply."),"documentation",""]),e.fontsize=14,e.formBlock({name:"×",args:2,argTypes:["anyin","anyin"],defaults:[1,12]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(t,e,r,n){if(t.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[r].connections[0]].name)t.statusFields.push([r,"multiply"]);else{var o=u.blocks.blockList[r].connections[1],s=u.blocks.blockList[r].connections[2];if(null===o||null===s)return u.errorMsg(NOINPUTERRORMSG,r),null!==o?t.parseArg(t,e,o,r,n):null!==s?t.parseArg(t,e,s,r,n):0;var l=u.turtles.ithTurtle(e),c=u.blocks.blockList[r].connections[0];if(null!==c&&"pitch"===u.blocks.blockList[c].name){var c=u.blocks.blockList[c].connections[1],i="string"==typeof u.blocks.blockList[o].value?calcOctave(l.singer.currentOctave,u.blocks.blockList[o].value,l.singer.lastNotePlayed,u.blocks.blockList[c].value):t.parseArg(t,e,o,r,n),a="string"==typeof u.blocks.blockList[s].value?calcOctave(l.singer.currentOctave,u.blocks.blockList[s].value,l.singer.lastNotePlayed,u.blocks.blockList[c].value):t.parseArg(t,e,s,r,n);try{return MathUtility.doMultiply(i,a)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}}else{if("string"==typeof(i=t.parseArg(t,e,o,r,n)))try{i=parseInt(i)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}if("string"==typeof(a=t.parseArg(t,e,s,r,n)))try{a=parseInt(a)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}try{return MathUtility.doMultiply(i,a)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}}}}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["neg"])).setPalette("number",u),e.setHelpString(),e.fontsize=14,e.formBlock({name:"–",args:1,argTypes:["anyin"],outType:"numberout"}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return u.blocks.blockList[r].value}},{key:"arg",value:function(t,r,n,e){if(t.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[n].connections[0]].name)t.statusFields.push([n,"neg"]);else{var o=u.blocks.blockList[n].connections[1];if(null===o)return u.errorMsg(NOINPUTERRORMSG,n),0;r=t.parseArg(t,r,o,n,e);if("string"==typeof r)try{r=parseInt(r)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,n),0}try{return MathUtility.doNegate(r)}catch(e){return r}}}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["minus"])).setPalette("number",u),e.beginnerBlock(!0),e.setHelpString([_("The Minus block is used to subtract."),"documentation",""]),e.fontsize=14,e.formBlock({name:"–",args:2,defaults:[8,4],argTypes:["anyin","anyin"]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(t,e,r,n){if(t.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[r].connections[0]].name)t.statusFields.push([r,"minus"]);else{var o=u.blocks.blockList[r].connections[1],s=u.blocks.blockList[r].connections[2];if(null===o||null===s)return u.errorMsg(NOINPUTERRORMSG,r),null!==o?t.parseArg(t,e,o,r,n):null!==s?-1*t.parseArg(t,e,s,r,n):0;var l=u.turtles.ithTurtle(e),c=u.blocks.blockList[r].connections[0];if(null!==c&&"pitch"===u.blocks.blockList[c].name)var c=u.blocks.blockList[c].connections[1],i="string"==typeof u.blocks.blockList[o].value?calcOctave(l.singer.currentOctave,u.blocks.blockList[o].value,l.singer.lastNotePlayed,u.blocks.blockList[c].value):t.parseArg(t,e,o,r,n),a="string"==typeof u.blocks.blockList[s].value?calcOctave(l.singer.currentOctave,u.blocks.blockList[s].value,l.singer.lastNotePlayed,u.blocks.blockList[c].value):t.parseArg(t,e,s,r,n);else{if("string"==typeof(i=t.parseArg(t,e,o,r,n)))try{i=parseInt(i)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}if("string"==typeof(a=t.parseArg(t,e,s,r,n)))try{a=parseInt(a)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}}try{return MathUtility.doMinus(i,a)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}}}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["plus"])).setPalette("number",u),e.beginnerBlock(!0),e.setHelpString([_("The Plus block is used to add."),"documentation",""]),e.fontsize=14,e.formBlock({name:"+",outType:"anyout",args:2,defaults:[2,2],argTypes:["anyin","anyin"]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return"string"==typeof u.blocks.blockList[r].value?u.blocks.blockList[r].value:toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(e,t,r,n){if(e.inStatusMatrix&&"print"===u.blocks.blockList[u.blocks.blockList[r].connections[0]].name)e.statusFields.push([r,"plus"]);else{var o=u.blocks.blockList[r].connections[1],s=u.blocks.blockList[r].connections[2];if(null===o||null===s)return u.errorMsg(NOINPUTERRORMSG,r),null!==o?e.parseArg(e,t,o,r,n):null!==s?e.parseArg(e,t,s,r,n):0;var l,c,i=u.turtles.ithTurtle(t),a=u.blocks.blockList[r].connections[0];if(null!==a&&"pitch"===u.blocks.blockList[a].name){if("accidentalname"===u.blocks.blockList[s].name)return("namedbox"===u.blocks.blockList[o].name?e.boxes[u.blocks.blockList[o].overrideName]:u.blocks.blockList[o].value)+(c=u.blocks.blockList[s].value.split(" "))[c.length-1];c=u.blocks.blockList[a].connections[1],l="string"==typeof u.blocks.blockList[o].value?calcOctave(i.singer.currentOctave,u.blocks.blockList[o].value,i.singer.lastNotePlayed,u.blocks.blockList[c].value):e.parseArg(e,t,o,r,n),c="string"==typeof u.blocks.blockList[s].value?calcOctave(i.singer.currentOctave,u.blocks.blockList[s].value,i.singer.lastNotePlayed,u.blocks.blockList[c].value):e.parseArg(e,t,s,r,n)}else l=e.parseArg(e,t,o,r,n),c=e.parseArg(e,t,s,r,n);if(!isNaN(l)&&!isNaN(c))return MathUtility.doPlus(l,c);try{return MathUtility.doPlus(l,c)}catch(e){return(u.errorMsg(NOINPUTERRORMSG,r),console.debug(l+" "+c),console.debug(e),isNaN(l))?isNaN(c)?0:c:l}}}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["oneOf"])).setPalette("number",u),e.beginnerBlock(!0),e.setHelpString([_("The One-of block returns one of two choices."),"documentation",null,"oneofhelp"]),e.formBlock({name:_("one of"),args:2,argLabels:[_("this"),_("that")],outType:"anyout",argTypes:["anyin","anyin"],defaults:[-90,90]}),e.makeMacro(function(e,t){return[[0,"oneOf",e,t,[null,1,2,null]],[1,["number",{value:0}],0,0,[0]],[2,["number",{value:1}],0,0,[0]]]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return"string"==typeof u.blocks.blockList[r].value?u.blocks.blockList[r].value:toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(e,t,r,n){var o,s,l=u.blocks.blockList[r].connections[1],c=u.blocks.blockList[r].connections[2];return null!==l&&(o=e.parseArg(e,t,l,r,n)),null!==c&&(s=e.parseArg(e,t,c,r,n)),null===l||null===c?(u.errorMsg(NOINPUTERRORMSG,r),null!==l?o:null!==c?s:0):MathUtility.doOneOf(o,s)}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["random"])).setPalette("number",u),e.beginnerBlock(!0),e.setHelpString([_("The Random block returns a random number."),"documentation",null,"randomhelp"]),e.formBlock({name:_("random"),args:2,argLabels:[_("min"),_("max")],argTypes:["anyin","anyin"],defaults:[0,12]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return"string"==typeof u.blocks.blockList[r].value?u.blocks.blockList[r].value:toFixed2(u.blocks.blockList[r].value)}},{key:"arg",value:function(t,e,r,n){var o=u.blocks.blockList[r].connections[0],s=u.blocks.blockList[r].connections[1],l=u.blocks.blockList[r].connections[2];if(null===s||null===l)return u.errorMsg(NOINPUTERRORMSG,r),0;var c,s=t.parseArg(t,e,s,r,n),e=t.parseArg(t,e,l,r,n),l=void 0;if(null!==o){for(var i=u.blocks.blockList[o];"hspace"===i.name;)i=u.blocks.blockList[i.connections[0]];"pitch"===i.name&&(l=u.blocks.blockList[i.connections[2]].value)}try{return void 0===l?"object"===_typeof(c=MathUtility.doRandom(s,e,l))?c[0]:c:MathUtility.doRandom(s,e,l)}catch(e){return t.stopTurtle=!0,u.errorMsg(NANERRORMSG,r),0}}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["number",_("number")])).setPalette("number",u),e.beginnerBlock(!0),e.setHelpString([_("The Number block holds a number."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t,r){try{return Number(u.blocks.blockList[r].value)}catch(e){return console.debug(e),0}}}])})();(new s).setup(u),(new e).setup(u),(new t).setup(u),(new r).setup(u),(new n).setup(u),(new o).setup(u),(new l).setup(u),(new c).setup(u),(new i).setup(u),(new a).setup(u),(new b).setup(u),(new k).setup(u),(new p).setup(u),(new f).setup(u)}"undefined"!=typeof module&&module.exports&&(module.exports={setupNumberBlocks:setupNumberBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupOrnamentBlocks(i){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["staccatofactor",_("staccato factor")])).parameter=!0,e.setPalette("ornament",i),e.setHelpString(),e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return i.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){t=i.turtles.ithTurtle(t);if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[n].connections[0]].name)return 0<t.singer.staccato.length?last(t.singer.staccato):0;e.statusFields.push([n,"staccato"])}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["slurfactor",_("slur factor")])).setPalette("ornament",i),e.setHelpString(),e.parameter=!0,e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return i.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){t=i.turtles.ithTurtle(t);if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[n].connections[0]].name)return 0<t.singer.staccato.length?-last(t.singer.staccato):0;e.statusFields.push([n,"slur"])}}])})(),n=(()=>{function t(e){return _classCallCheck(this,t),(e=_callSuper(this,t,[e||"neighbor"])).setPalette("ornament",i),e.piemenuValuesC1=[-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7],e.setHelpString(),e.formBlock({name:_("neighbor")+" (+/–)",args:2,defaults:[1,1/16],argLabels:[_("semi-tone interval"),_("note value")]}),e.makeMacro(function(e,t){return[[0,"neighbor",e,t,[null,1,3,2,6]],[1,["number",{value:1}],0,0,[0]],[2,"vspace",0,0,[0,null]],[3,"divide",0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:16}],0,0,[3]],[6,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){if("number"==typeof e[0]&&"number"==typeof e[1])return Singer.OrnamentActions.doNeighbor(e[0],e[1],n,r),[e[2],1];i.errorMsg(NANERRORMSG,r),t.stopTurtle=!0}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["neighbor2"])).piemenuValuesC1=[-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7],e.beginnerBlock(!0),e.setHelpString([_("The Neighbor block rapidly switches between neighboring pitches."),"documentation",null,"neighbor2help"]),e.formBlock({name:_("neighbor")+" (+/–)",args:2,defaults:[1,1/16],argLabels:[_("scalar interval"),_("note value")]}),e.makeMacro(function(e,t){return[[0,"neighbor2",e,t,[null,1,3,2,6]],[1,["number",{value:1}],0,0,[0]],[2,"vspace",0,0,[0,null]],[3,"divide",0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:16}],0,0,[3]],[6,"hidden",0,0,[0,null]]]}),e}return _inherits(t,n),_createClass(t)})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["glide"])).setPalette("ornament",i),e.setHelpString(),e.formBlock({name:_("glide"),args:1,defaults:[1/16]}),e.makeMacro(function(e,t){return[[0,"glide",e,t,[null,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:16}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e.hidden=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var o,l;if(void 0!==e[1])return l=null===e[0]||"number"!=typeof e[0]?(i.errorMsg(NOINPUTERRORMSG,r),1/16):e[0],(o=i.turtles.ithTurtle(n)).singer.glide.push(l),0===o.singer.justCounting.length&&t.notation.notationBeginSlur(n),o.singer.glideOverride=Singer.noteCounter(t,n,e[1]),console.debug("length of glide "+o.singer.glideOverride),t.setDispatchBlock(r,n,l="_glide_"+n),t.setTurtleListener(n,l,function(e){0===o.singer.justCounting.length&&t.notation.notationEndSlur(n),o.singer.glide.pop()}),[e[1],1]}}])})(),l=(()=>{function t(e){return _classCallCheck(this,t),(e=_callSuper(this,t,[e||"slur"])).setPalette("ornament",i),e.setHelpString(),e.formBlock({name:_("slur"),args:1,defaults:[16]}),e.makeMacro(function(e,t){return[[0,"slur",e,t,[null,1,null,2]],[1,["number",{value:16}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e.hidden=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var o;if(void 0!==e[1])return null!==(o=e[0])&&"number"==typeof o||(i.errorMsg(NOINPUTERRORMSG,r),o=1/16),Singer.OrnamentActions.setSlur(o,n,r),[e[1],1]}}])})(),u=(()=>{function t(e){return _classCallCheck(this,t),(e=_callSuper(this,t,[e||"staccato"])).setPalette("ornament",i),e.setHelpString(),e.formBlock({name:_("staccato"),args:1,defaults:[32]}),e.makeMacro(function(e,t){return[[0,"staccato",e,t,[null,1,null,2]],[1,["number",{value:32}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e.hidden=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var o;if(void 0!==e[1])return null!==(o=e[0])&&"number"==typeof o||(i.errorMsg(NOINPUTERRORMSG,r),o=1/32),Singer.OrnamentActions.setStaccato(o,n,r),[e[1],1]}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["newslur"])).beginnerBlock(!0),e.setHelpString([_("The Slur block lengthens the sustain of notes while maintaining the specified rhythmic value of the notes."),"documentation",null,"slurhelp"]),e.formBlock({name:_("slur"),args:1,defaults:[1/16]}),e.makeMacro(function(e,t){return[[0,"newslur",e,t,[null,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:16}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e.hidden=!1,e}return _inherits(t,l),_createClass(t)})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["newstaccato"])).beginnerBlock(!0),e.setHelpString([_("The Staccato block shortens the length of the actual note while maintaining the specified rhythmic value of the notes."),"documentation",null,"staccatohelp"]),e.formBlock({name:_("staccato"),args:1,defaults:[1/32]}),e.makeMacro(function(e,t){return[[0,"newstaccato",e,t,[null,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:32}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e.hidden=!1,e}return _inherits(t,u),_createClass(t)})();(new e).setup(i),(new t).setup(i),(new n).setup(i),(new r).setup(i),(new o).setup(i),(new l).setup(i),(new u).setup(i),(new a).setup(i),(new s).setup(i)}"undefined"!=typeof module&&module.exports&&(module.exports={setupOrnamentBlocks:setupOrnamentBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupPenBlocks(i){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["purple",_("purple")])).setPalette("pen",i),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setcolor",e,t,[null,1,null]],[1,["number",{value:90}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["blue",_("blue")])).setPalette("pen",i),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setcolor",e,t,[null,1,null]],[1,["number",{value:70}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["green",_("green")])).setPalette("pen",i),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setcolor",e,t,[null,1,null]],[1,["number",{value:40}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["yellow",_("yellow")])).setPalette("pen",i),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setcolor",e,t,[null,1,null]],[1,["number",{value:20}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["orange",_("orange")])).setPalette("pen",i),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setcolor",e,t,[null,1,null]],[1,["number",{value:10}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["red",_("red")])).setPalette("pen",i),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setcolor",e,t,[null,1,null]],[1,["number",{value:0}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["white",_("white")])).setPalette("pen",i),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setshade",e,t,[null,1,null]],[1,["number",{value:100}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["black",_("black")])).setPalette("pen",i),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setshade",e,t,[null,1,null]],[1,["number",{value:0}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["beginfill",_("begin fill")])).setPalette("pen",i),e.setHelpString(),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){i.turtles.getTurtle(i.turtles.companionTurtle(r)).painter.doStartFill()}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["endfill",_("end fill")])).setPalette("pen",i),e.setHelpString(),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){i.turtles.getTurtle(i.turtles.companionTurtle(r)).painter.doEndFill()}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["fillscreen",_("background")])).setPalette("pen",i),e.setHelpString(),e.formBlock({args:3}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){var n,l,o,s=i.turtles.getTurtle(i.turtles.companionTurtle(r));3===e.length&&(n=s.painter.color,l=s.painter.value,o=s.painter.chroma,s.painter.doSetHue(e[0]),s.painter.doSetValue(e[1]),s.painter.doSetChroma(e[2]),i.turtles.setBackgroundColor(i.turtles.companionTurtle(r)),s.painter.doSetHue(n),s.painter.doSetValue(l),s.painter.doSetChroma(o),t.svgOutput="")}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["grey",_("grey")])).setPalette("pen",i),e.parameter=!0,e.setHelpString([_("The Grey block returns the current pen grey value."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t){return toFixed2(i.turtles.getTurtle(i.turtles.companionTurtle(t)).painter.chroma)}},{key:"setter",value:function(e,t,r){i.turtles.getTurtle(i.turtles.companionTurtle(r)).painter.doSetChroma(t)}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[r].connections[0]].name)return i.turtles.getTurtle(i.turtles.companionTurtle(t)).painter.chroma;e.statusFields.push([r,"grey"])}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["shade",_("shade")])).setPalette("pen",i),e.parameter=!0,e.setHelpString([_("The Shade block returns the current pen shade value."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t){return toFixed2(i.turtles.getTurtle(i.turtles.companionTurtle(t)).painter.value)}},{key:"setter",value:function(e,t,r){i.turtles.getTurtle(i.turtles.companionTurtle(r)).painter.doSetValue(t)}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[r].connections[0]].name)return i.turtles.getTurtle(i.turtles.companionTurtle(t)).painter.value;e.statusFields.push([r,"shade"])}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["color",_("color")])).setPalette("pen",i),e.beginnerBlock(!0),e.parameter=!0,e.setHelpString([_("The Color block returns the current pen color."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t){return toFixed2(i.turtles.getTurtle(i.turtles.companionTurtle(t)).painter.color)}},{key:"setter",value:function(e,t,r){i.turtles.getTurtle(i.turtles.companionTurtle(r)).painter.doSetColor(t)}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[r].connections[0]].name)return i.turtles.getTurtle(i.turtles.companionTurtle(t)).painter.color;e.statusFields.push([r,"color"])}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pensize",_("pen size")])).setPalette("pen",i),e.parameter=!0,e.setHelpString([_("The Pen size block returns the current pen size value."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t){return toFixed2(i.turtles.getTurtle(i.turtles.companionTurtle(t)).painter.stroke)}},{key:"setter",value:function(e,t,r){i.turtles.getTurtle(i.turtles.companionTurtle(r)).painter.doSetPensize(t)}},{key:"arg",value:function(e,t,r){if(!e.inStatusMatrix||"print"!==i.blocks.blockList[i.blocks.blockList[r].connections[0]].name)return i.turtles.getTurtle(i.turtles.companionTurtle(t)).painter.stroke;e.statusFields.push([r,"pensize"])}}])})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setfont",_("set font")])).setPalette("pen",i),e.setHelpString([_("The Set font block sets the font used by the Show block."),"documentation",""]),e.formBlock({args:1,defaults:[DEFAULTFONT],argTypes:["textin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?i.errorMsg(NOINPUTERRORMSG,n):"string"==typeof e[0]&&i.turtles.getTurtle(i.turtles.companionTurtle(r)).painter.doSetFont(e[0])}}])})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["background",_("background")])).setPalette("pen",i),e.beginnerBlock(!0),e.setHelpString([_("The Background block sets the window background color."),"documentation",""]),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r){i.turtles.setBackgroundColor(i.turtles.companionTurtle(r)),t.svgOutput=""}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["hollowline"])).setPalette("pen",i),e.setHelpString([_("The Hollow line block creates a line with a hollow center."),"documentation",""]),e.formBlock({name:_("hollow line")}),e.makeMacro(function(e,t){return[[0,"hollowline",e,t,[null,null,1]],[1,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var l,o;if(void 0!==e[0])return 0<(l=i.turtles.ithTurtle(i.turtles.companionTurtle(r))).singer.inNoteBlock.length?l.singer.embeddedGraphics[last(l.singer.inNoteBlock)].push(n):l.painter.doStartHollowLine(),t.setDispatchBlock(n,r,o="_hollowline_"+r),t.setTurtleListener(r,o,function(){0<l.singer.inNoteBlock.length?l.singer.embeddedGraphics[last(l.singer.inNoteBlock)].push(n):l.painter.doEndHollowLine()}),[e[0],1]}}])})(),w=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["fill"])).setPalette("pen",i),e.beginnerBlock(!0),e.setHelpString([_("The Fill block fills in a shape with a color."),"documentation",null,"fillhelp"]),e.formBlock({name:_("fill")}),e.makeMacro(function(e,t){return[[0,"fill",e,t,[null,null,1]],[1,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var l,o;if(void 0!==e[0])return 0<(l=i.turtles.ithTurtle(i.turtles.companionTurtle(r))).singer.inNoteBlock.length?l.singer.embeddedGraphics[last(l.singer.inNoteBlock)].push(n):l.singer.suppressOutput?(o=l.painter.penState,l.painter.penState=!1,l.painter.doStartFill(),l.painter.penState=o):l.painter.doStartFill(),t.setDispatchBlock(n,r,o="_fill_"+r),t.setTurtleListener(r,o,function(){var e;0<l.singer.inNoteBlock.length?l.singer.embeddedGraphics[last(l.singer.inNoteBlock)].push(n):l.singer.suppressOutput?(e=l.painter.penState,l.painter.penState=!1,l.painter.doEndFill(),l.painter.penState=e):l.painter.doEndFill()}),[e[0],1]}}])})(),S=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["penup",_("pen up")])).setPalette("pen",i),e.beginnerBlock(!0),e.setHelpString([_("The Pen-up block raises the pen so that it does not draw."),"documentation",""]),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){r=i.turtles.ithTurtle(i.turtles.companionTurtle(r));0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.doPenUp()}}])})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pendown",_("pen down")])).setPalette("pen",i),e.beginnerBlock(!0),e.setHelpString([_("The Pen-down block lowers the pen so that it draws."),"documentation",""]),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){r=i.turtles.ithTurtle(i.turtles.companionTurtle(r));0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.doPenDown()}}])})(),C=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setpensize",_("set pen size")])).setPalette("pen",i),e.piemenuValuesC1=[1,2,3,5,10,15,25,50,100],e.beginnerBlock(!0),e.setHelpString([_("The Set-pen-size block changes the size of the pen."),"documentation",""]),e.formBlock({args:1,defaults:[5]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?i.errorMsg(NOINPUTERRORMSG,n):(r=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),"string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.doSetPensize(e[0]))}}])})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["settranslucency",_("set translucency")])).setPalette("pen",i),e.piemenuValuesC1=[100,90,80,70,60,50,40,30,20,10,0],e.setHelpString([_("The Set translucency block changes the opacity of the pen."),"documentation",""]),e.formBlock({args:1,defaults:[50]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?i.errorMsg(NOINPUTERRORMSG,n):(r=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),"string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):(t=e[0]%101,r.painter.doSetPenAlpha(1-t/100)))}}])})(),B=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["sethue",_("set hue")])).setPalette("pen",i),e.piemenuValuesC1=[0,10,20,30,40,50,60,70,80,90],e.setHelpString([_("The Set hue block changes the color of the pen."),"documentation",""]),e.formBlock({args:1,defaults:[0]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?i.errorMsg(NOINPUTERRORMSG,n):(r=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),"string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.doSetHue(e[0]))}}])})(),T=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setshade",_("set shade")])).setPalette("pen",i),e.piemenuValuesC1=[100,90,80,70,60,50,40,30,20,10,0],e.beginnerBlock(!0),e.setHelpString([_("The Set-shade block changes the pen color from dark to light."),"documentation",""]),e.formBlock({args:1,defaults:[50]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?i.errorMsg(NOINPUTERRORMSG,n):(r=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),"string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.doSetValue(e[0]))}}])})(),P=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setgrey",_("set grey")])).setPalette("pen",i),e.piemenuValuesC1=[100,90,80,70,60,50,40,30,20,10,0],e.setHelpString([_("The Set grey block changes the vividness of the pen color."),"documentation",""]),e.formBlock({args:1,defaults:[100]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?i.errorMsg(NOINPUTERRORMSG,n):(r=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),"string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.doSetChroma(e[0]))}}])})(),M=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setcolor",_("set color")])).setPalette("pen",i),e.piemenuValuesC1=[0,10,20,30,40,50,60,70,80,90],e.beginnerBlock(!0),e.setHelpString([_("The Set-color block changes the pen color."),"documentation",""]),e.formBlock({args:1,defaults:[0]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===e[0]?i.errorMsg(NOINPUTERRORMSG,n):(r=i.turtles.ithTurtle(i.turtles.companionTurtle(r)),"string"==typeof e[0]?i.errorMsg(NANERRORMSG,n):t.inMatrix?(t.phraseMaker.addRowBlock(n),t.pitchBlocks.includes(n)||t.pitchBlocks.push(n),t.phraseMaker.rowLabels.push(i.blocks.blockList[n].name),t.phraseMaker.rowArgs.push(e[0])):0<r.singer.inNoteBlock.length?r.singer.embeddedGraphics[last(r.singer.inNoteBlock)].push(n):r.painter.doSetColor(e[0]))}}])})();(new e).setup(i),(new t).setup(i),(new r).setup(i),(new n).setup(i),(new l).setup(i),(new o).setup(i),(new s).setup(i),(new a).setup(i),(new u).setup(i),(new c).setup(i),(new p).setup(i),(new h).setup(i),(new k).setup(i),(new f).setup(i),(new d).setup(i),(new g).setup(i),(new m).setup(i),(new b).setup(i),(new w).setup(i),(new y).setup(i),(new S).setup(i),(new C).setup(i),(new v).setup(i),(new B).setup(i),(new T).setup(i),(new P).setup(i),(new M).setup(i)}"undefined"!=typeof module&&module.exports&&(module.exports={setupPenBlocks:setupPenBlocks});
function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=Array(t);n<t;n++)l[n]=e[n];return l}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,r,s,a,i=[],o=!0,c=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(l=s.call(n)).done)&&(i.push(l.value),i.length!==t);o=!0);}catch(e){c=!0,r=e}finally{try{if(!o&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupPitchBlocks(f){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["rest"])).setPalette("pitch",f),e.hidden=e.deprecated=!0,e}return _inherits(t,ValueBlock),_createClass(t)})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["square",_("square")])).setPalette("pitch",f),e.formBlock({args:1,defaults:[440]}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"square",0,0,[4,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){Singer.playSynthBlock(e,f,t,n,l)}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["triangle",_("triangle")])).setPalette("pitch",f),e.formBlock({args:1,defaults:[440]}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"triangle",0,0,[4,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){Singer.playSynthBlock(e,f,t,n,l)}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["sine",_("sine")])).setPalette("pitch",f),e.formBlock({args:1,defaults:[440]}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"sine",0,0,[4,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){Singer.playSynthBlock(e,f,t,n,l)}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["sawtooth",_("sawtooth")])).setPalette("pitch",f),e.formBlock({args:1,defaults:[440]}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"sawtooth",0,0,[4,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){Singer.playSynthBlock(e,t,n,l)}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["invertmode"])).setPalette("pitch",f),e.formBlock({outType:"textout"}),e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t)})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["transpositionfactor",_("transposition")])).setPalette("pitch",f),e.hidden=!0,e.parameter=!0,e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return f.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==f.blocks.blockList[f.blocks.blockList[n].connections[0]].name)return f.turtles.ithTurtle(f.turtles.companionTurtle(t)).singer.transposition;e.statusFields.push([n,"transposition"])}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["consonantstepsizedown",_("scalar step down")])).setPalette("pitch",f),e.parameter=!0,e.setHelpString([_("The Scalar step down block returns the number of semi-tones down to the previous note in the current key and mode."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return f.blocks.blockList[n].value}},{key:"arg",value:function(e,t){return Singer.PitchActions.consonantStepSize("down",t)}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["consonantstepsizeup",_("scalar step up")])).setPalette("pitch",f),e.parameter=!0,e.setHelpString([_("The Scalar step up block returns the number of semi-tones up to the next note in the current key and mode."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return f.blocks.blockList[n].value}},{key:"arg",value:function(e,t){return Singer.PitchActions.consonantStepSize("up",t)}}])})(),c=(()=>{function n(e,t){return _classCallCheck(this,n),(e=_callSuper(this,n,[e||"deltapitch",t||_("change in pitch")])).setPalette("pitch",f),e.parameter=!0,e.setHelpString([_("The Change in pitch block is the difference (in half steps) between the current pitch being played and the previous pitch played."),"documentation",null,"deltapitchhelp"]),e}return _inherits(n,ValueBlock),_createClass(n,[{key:"updateParameter",value:function(e,t,n){return f.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){return e.inStatusMatrix&&"print"===f.blocks.blockList[f.blocks.blockList[n].connections[0]].name&&e.statusFields.push([n,"mypitch"]),Singer.PitchActions.deltaPitch(f.blocks.blockList[n].name,t)}}])})(),u=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,["deltapitch2",_("scalar change in pitch")])}return _inherits(e,c),_createClass(e)})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mypitch",_("pitch number")])).setPalette("pitch",f),e.beginnerBlock(!0),e.parameter=!0,e.hidden=!0,e.setHelpString([_("The Pitch number block is the value of the pitch of the note currently being played."),"documentation",null,"everybeathelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return f.blocks.blockList[n].value}},{key:"setter",value:function(e,t,n){n=f.turtles.ithTurtle(f.turtles.companionTurtle(n)),n.singer.previousNotePlayed=n.singer.lastNotePlayed,t=numberToPitch(Math.floor(t)+n.singer.pitchNumberOffset);n.singer.lastNotePlayed=[t[0]+t[1],n.singer.lastNotePlayed[1]]}},{key:"arg",value:function(e,t,n){var l;if(!e.inStatusMatrix||"print"!==f.blocks.blockList[f.blocks.blockList[n].connections[0]].name)return l=null!==(t=f.turtles.ithTurtle(f.turtles.companionTurtle(t))).singer.lastNotePlayed?"string"==typeof t.singer.lastNotePlayed[0]?(l=t.singer.lastNotePlayed[0].length,[t.singer.lastNotePlayed[0].slice(0,l-1),parseInt(t.singer.lastNotePlayed[0].slice(l-1))]):frequencyToPitch(t.singer.lastNotePlayed[0]):t.singer.inNoteBlock in t.singer.notePitches&&0<t.singer.notePitches[last(t.singer.inNoteBlock)].length?getNote(t.singer.notePitches[last(t.singer.inNoteBlock)][0],t.singer.noteOctaves[last(t.singer.inNoteBlock)][0],0,t.singer.keySignature,t.singer.movable,null,f.errorMsg):(null!==t.singer.lastNotePlayed&&f.errorMsg(INVALIDPITCH,n),["G",4]),pitchToNumber(l[0],l[1],t.singer.keySignature)-t.singer.pitchNumberOffset;e.statusFields.push([n,"mypitch"])}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pitchinhertz",_("pitch in hertz")])).setPalette("pitch",f),e.parameter=!0,e.hidden=!0,e.setHelpString([_("The Pitch in Hertz block is the value in Hertz of the pitch of the note currently being played."),"documentation",""]),e.beginnerBlock(!0),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return f.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(e.inStatusMatrix&&"print"===f.blocks.blockList[f.blocks.blockList[n].connections[0]].name)e.statusFields.push([n,"pitchinhertz"]);else{n=f.turtles.ithTurtle(f.turtles.companionTurtle(t));if(null!==n.singer.lastNotePlayed)return e.synth._getFrequency(n.singer.lastNotePlayed[0],e.synth.changeInTemperament)}}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["currentpitch",_("current pitch")])).setPalette("pitch",f),e.beginnerBlock(!0),e.parameter=!0,e.formBlock({outType:"pitchout"}),e.setHelpString([_("The Current Pitch block is used with the Pitch Converter block. In the example above, current pitch, sol 4, is displayed as 392 hertz."),"documentation",null,"currentpitchhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return f.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){t=f.turtles.ithTurtle(f.turtles.companionTurtle(t));return(e.inStatusMatrix&&"outputtools"===f.blocks.blockList[f.blocks.blockList[n].connections[0]].name||null===t.singer.lastNotePlayed)&&null===t.singer.lastNotePlayed?"G4":t.singer.lastNotePlayed[0]}}])})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["outputtools",_("pitch converter")])).setPalette("pitch",f),e.beginnerBlock(!0),e.extraWidth=50,e.setHelpString([_("This block converts the pitch value of the last note played into different formats such as hertz, letter name, pitch number, et al."),"documentation",null,"outputtoolshelp"]),e.extraSearchTerms=["pitch number","pitch in hertz","alphabet","letter class","solfege class","staff y","solfege syllable","pitch class","scalar class","scale degree","nth degree","pitch to shade","pitch to color"],e.piemenuLabels=[_("pitch number"),_("pitch in hertz"),_("alphabet"),_("letter class"),_("solfege class"),_("staff y"),_("solfege syllable"),_("pitch class"),_("scalar class"),_("scale degree"),_("nth degree"),_("pitch to shade"),_("pitch to color")],e.formBlock({args:1,argTypes:["anyin"]}),e.parameter=!1,e.makeMacro(function(e,t){return[[0,["outputtools",{value:"letter class"}],e,t,[null,1,null]],[1,["currentpitch"],0,0,[0]]]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,n,l){var r,s,a,i,o,c;if(!e.inStatusMatrix||"print"!==f.blocks.blockList[f.blocks.blockList[n].connections[0]].name)return r=f.blocks.blockList[n].connections[1],s=f.turtles.ithTurtle(f.turtles.companionTurtle(t)),null!=r&&(a=e.parseArg(e,t,r,n,l)),"notename"===f.blocks.blockList[r].name?i=a+(s.singer.currentOctave||4):"solfege"===f.blocks.blockList[r].name||"eastindiansolfege"===f.blocks.blockList[r].name?((l=-1!=(t=a).indexOf(SHARP)?SHARP:-1!=t.indexOf(FLAT)?FLAT:-1!=t.indexOf(DOUBLEFLAT)?DOUBLEFLAT:-1!=t.indexOf(DOUBLESHARP)?DOUBLESHARP:NATURAL)!=NATURAL&&(t=t.replace(l,"")),i=FIXEDSOLFEGE[t],l!=NATURAL&&(i+=l),i+=s.singer.currentOctave||4):"number"===f.blocks.blockList[r].name?i=f.blocks.blockList[r].value<55?(t=numberToPitch(f.blocks.blockList[r].value+s.singer.pitchNumberOffset))[0]+t[1]:a:"scaledegree2"===f.blocks.blockList[r].name?(i=scaleDegreeToPitchMapping(s.singer.keySignature,f.blocks.blockList[r].value,s.singer.movable,null),i+=s.singer.currentOctave||4):"string"==typeof a?(l=Number(a),isNaN(l)?(t=a.charAt(a.length-1),o="","12345678".includes(t)&&(o=t,a=a.slice(0,a.length-1)),SOLFEGENAMES1.includes(a)?((c=(t=a).includes(SHARP)?SHARP:t.includes(FLAT)?FLAT:t.includes(DOUBLEFLAT)?DOUBLEFLAT:t.includes(DOUBLESHARP)?DOUBLESHARP:NATURAL)!=NATURAL&&(t=t.replace(c,"")),i=FIXEDSOLFEGE[t],c!=NATURAL&&(i+=c),0===o.length?i+=s.singer.currentOctave||4:i+=o):i=NOTENAMES1.includes(a)||ALLNOTENAMES.includes(a)?0===o.length?a+(s.singer.currentOctave||4):a+o:a):i=l<55?(t=numberToPitch(l+s.singer.pitchNumberOffset))[0]+t[1]:l):i="number"==typeof a&&f.blocks.blockList[r].value<55?(c=numberToPitch(f.blocks.blockList[r].value+s.singer.pitchNumberOffset))[0]+c[1]:a,getPitchInfo(f,f.blocks.blockList[n].privateData,i,s);e.statusFields.push([n,"outputtools"])}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["oneOfPitchBlock",_("one of")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"oneOf",e,t,[null,1,2,null]],[1,["solfege",{value:"do"}],0,0,[0]],[2,["solfege",{value:"sol"}],0,0,[0]]]}),e}return _inherits(t,ValueBlock),_createClass(t)})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["midi",_("MIDI")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"setpitchnumberoffset",e,t,[null,1,2,null]],[1,["notename",{value:"C"}],0,0,[0]],[2,["number",{value:-1}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setpitchnumberoffset",_("set pitch number offset")])).setPalette("pitch",f),e.setHelpString([_("The Set pitch number offset block is used to set the offset for mapping pitch numbers to pitch and octave."),"documentation",null,"pitchnumberhelp"]),e.formBlock({args:2,defaults:["C",4],argTypes:["anyin","anyin"],argLabels:["ja"===e.lang?_("name2"):_("name"),_("octave")]}),e.makeMacro(function(e,t){return[[0,"setpitchnumberoffset",e,t,[null,1,2,null]],[1,["notename",{value:"C"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){null!==e[0]&&null!==e[1]||f.errorMsg(NOINPUTERRORMSG,l);l=null===e[0]?"C":e[0],e=null===e[1]?4:e[1];Singer.PitchActions.setPitchNumberOffset(l,e,n,f)}}])})(),g=(()=>{function n(e,t){return _classCallCheck(this,n),(e=_callSuper(this,n,[e||"number2pitch",t||_("number to pitch")])).setPalette("pitch",f),e.setHelpString([_("The Number to pitch block will convert a pitch number to a pich name."),"documentation",""]),e.formBlock({args:1,defaults:[55]}),e}return _inherits(n,LeftBlock),_createClass(n,[{key:"arg",value:function(t,e,n,l){var r=f.blocks.blockList[n].connections[1],r=t.parseArg(t,e,r,n,l);try{var s="number2pitch"===f.blocks.blockList[n].name?"pitch":"octave";return Singer.PitchActions.numToPitch(r,s,e)}catch(e){"NoArgError"===e?(f.errorMsg(NOINPUTERRORMSG,n),t.stopTurtle=!0):console.error(e)}}}])})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["number2octave",_("number to octave")])).setHelpString([_("The Number to octave block will convert a pitch number to an octave."),"documentation",""]),e}return _inherits(t,g),_createClass(t)})(),S=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["ytopitch",_("y to pitch")])).setPalette("pitch",f),e.setHelpString([_("Y to pitch block will convert a staff y position to corresponding pitch notation."),"documentation",""]),e.formBlock({args:1,defaults:[50]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,n,l){var r,s=f.blocks.blockList[n].connections[0],a=f.blocks.blockList[n].connections[1],i=f.turtles.ithTurtle(f.turtles.companionTurtle(t)),o=keySignatureToMode(i.singer.keySignature),c=MUSICALMODES[o[1]].length,i=buildScale(i.singer.keySignature)[0],u=0,t=(u=null!==a?e.parseArg(e,t,a,n,l):u)+YSTAFFNOTEHEIGHT/2,l=Math.floor(t/YSTAFFOCTAVEHEIGHT),u=(t%=YSTAFFOCTAVEHEIGHT,l+4),h=Math.floor(t/YSTAFFNOTEHEIGHT);if(null===s){if(null===a)return"G4"}else{if("pitchnumber"==f.blocks.blockList[s].name)return null===a?7:(t=h,(t-=NOTENAMES.indexOf(o[0][0]))<0&&(t+=c),r=i[t],(t=-1===(t=NOTESSHARP.indexOf(r))?NOTESFLAT.indexOf(r):t)+12*l);if("nthmodalpitch"==f.blocks.blockList[s].name)return null===a?5:((r=h-NOTENAMES.indexOf(o[0][0]))<0&&(r+=c),r+l*c);if("print"==f.blocks.blockList[s].name){if(e.inStatusMatrix&&e.statusFields.push([n,"ytopitch"]),null===a)return"G4"}else{if("pitch"==f.blocks.blockList[s].name)return null===a?["sol",4]:((t=h-NOTENAMES.indexOf(o[0][0]))<0&&(t+=c),[i[t],u]);if(null===a)return"G4"}}for(;h<0;)h+=NOTENAMES.length;return NOTENAMES[h]+u}}])})(),C=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["accidentalname",_("accidental selector")])).setPalette("pitch",f),e.setHelpString([_("The Accidental selector block is used to choose between double-sharp, sharp, natural, flat, and double-flat."),"documentation",""]),e.formBlock({outType:"textout"}),e.extraWidth=50,e}return _inherits(t,ValueBlock),_createClass(t)})(),P=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["eastindiansolfege",_("east indian solfege")])).setPalette("pitch",f),e.setHelpString([_("Pitch can be specified in terms of ni dha pa ma ga re sa."),"documentation",null,"eihelp"]),e.formBlock({outType:"solfegeout"}),e}return _inherits(t,ValueBlock),_createClass(t)})(),T=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["notename",_("note name")])).setPalette("pitch",f),e.setHelpString([_("Pitch can be specified in terms of C D E F G A B."),"documentation",null,"note2"]),e.formBlock({outType:"noteout"}),e.beginnerBlock(!0),e}return _inherits(t,ValueBlock),_createClass(t)})(),w=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["solfege",_("solfege")])).setPalette("pitch",f),e.setHelpString([_("Pitch can be specified in terms of do re mi fa sol la ti."),"documentation",null,"note1"]),e.formBlock({outType:"solfegeout"}),e.beginnerBlock(!0),e}return _inherits(t,ValueBlock),_createClass(t)})(),N=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["customNote"])).setPalette("pitch",f),e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r;if(null!==e[0]&&null!==e[1])return r=e[0],Singer.processPitch(f,r,e[1],0);f.errorMsg(NOINPUTERRORMSG,l),t.stopTurtle=!0}}])})(),L=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["invert1"])).setPalette("pitch",f),e.setHelpString([_("The Invert block rotates any contained notes around a target note."),"documentation",null,"inverthelp"]),e.formBlock({name:_("Invert").toLowerCase(),args:3,defaults:["sol",4,_("even")],argTypes:["solfegein","anyin","anyin"],argLabels:["ja"===e.lang?_("name2"):_("name"),_("octave"),_("even")+"/"+_("odd")+"/"+_("scalar")]}),e.makeMacro(function(e,t){return[[0,"invert1",e,t,[null,1,2,3,null,4]],[1,["solfege",{value:"sol"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]],[3,["invertmode",{value:"even"}],0,0,[0]],[4,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r,s,a;if(void 0!==e[3])return null!==e[0]&&null!==e[1]&&null!==e[2]||f.errorMsg(NOINPUTERRORMSG,l),r=null===e[0]?"sol":e[0],s=null===e[1]?4:e[1],a=null===e[2]?"even":e[2],Singer.PitchActions.invert(r,s,a,n,l),[e[3],1]}}])})(),B=(()=>{function n(e,t){return _classCallCheck(this,n),(e=_callSuper(this,n,[e||"invert2",t||_("invert (odd)")])).setPalette("pitch",f),e.formBlock({args:2,defaults:["sol",4],argTypes:["solfegein","anyin"],argLabels:[_("note"),_("octave")]}),e.hidden=e.deprecated=!0,e}return _inherits(n,FlowClampBlock),_createClass(n,[{key:"flow",value:function(e,t,n,l){var r=f.turtles.ithTurtle(f.turtles.companionTurtle(n)),s=("invert"===f.blocks.blockList[l].name?r.singer.invertList.push([e[0],e[1],"even"]):r.singer.invertList.push([e[0],e[1],"odd"]),"_invert_"+n);t.setDispatchBlock(l,n,s);return t.setTurtleListener(n,s,function(e){return r.singer.invertList.pop()}),[e[2],1]}}])})(),A=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["invert",_("invert (even)")])).setPalette("pitch",f),e.formBlock({args:2,defaults:["sol",4],argTypes:["solfegein","anyin"],argLabels:[_("note"),_("octave")]}),e.makeMacro(function(e,t){return[[0,"invert",e,t,[null,1,2,null,3]],[1,["solfege",{value:"sol"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e.hidden=!0,e}return _inherits(t,B),_createClass(t)})(),O=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["register",_("register")])).setPalette("pitch",f),e.piemenuValuesC1=[-3,-2,-1,0,1,2,3],e.setHelpString([_("The Register block provides an easy way to modify the register (octave) of the notes that follow it."),"documentation",null,"registerhelp"]),e.formBlock({args:1,defaults:[0]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n){null!==e[0]&&"number"==typeof e[0]&&Singer.PitchActions.setRegister(e[0],n)}}])})(),M=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["50cents",_("50 cents")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"settransposition",e,t,[null,12,1,2]],[1,"vspace",0,0,[0,3]],[2,"hidden",0,0,[0,null]],[3,["newnote",{collapsed:!1}],0,0,[1,4,7,11]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"pitch",0,0,[7,9,10,null]],[9,["solfege",{value:"sol"}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"hidden",0,0,[3,null]],[12,"divide",0,0,[0,13,14]],[13,["number",{value:50}],0,0,[12]],[14,["number",{value:100}],9,0,[12]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),E=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["settransposition"])).setPalette("pitch",f),e.piemenuValuesC1=[-12,-11,-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12],e.setHelpString([_("The Semi-tone transposition block will shift the pitches contained inside Note blocks up (or down) by half steps.")+" "+_("In the example shown above, sol is shifted up to sol#."),"documentation",""]),e.formBlock({name:_("semi-tone transpose"),args:1,defaults:["1"]}),e.makeMacro(function(e,t){return[[0,"settransposition",e,t,[null,1,6,7]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,["number",{value:12}],0,0,[3]],[6,"vspace",0,0,[0,null]],[7,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){return void 0!==e[1]&&null!==e[0]&&"number"==typeof e[0]?(Singer.PitchActions.setSemitoneTranspose(e[0],n,l),[e[1],1]):void 0}}])})(),R=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setratio"])).setPalette("pitch",f),e.setHelpString([_("The Transpose by Ratio block will shift the pitches contained inside Note blocks up (or down) by a ratio"),"documentation",""]),e.formBlock({name:_("transpose by ratio"),args:1,defaults:[1.5]}),e.makeMacro(function(e,t){return[[0,"setratio",e,t,[null,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:3}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r,s;if(void 0!==e[1])return r=f.blocks.blockList[l].connections[1],s=e[0],null===r?(f.errorMsg(NOINPUTERRORMSG,l),s=1):"intervalname"===f.blocks.blockList[r].name&&(s=(r=f.blocks.blockList[r].value)in INTERVALVALUES?INTERVALVALUES[r][2]:(console.log("could not find "+r+" in INTERVALVALUES"),1)),(isNaN(s)||s<0)&&(s=1,console.debug("ratio "+s+" must be a number > 0")),Singer.PitchActions.setRatioTranspose(s,n,l),[e[1],1]}}])})(),F=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["octave",_("octave")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"settransposition",e,t,[null,1,4,5]],[1,"multiply",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:12}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),H=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["custompitch",_("custom pitch")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"pitch",e,t,[null,1,2,null]],[1,["customNote",{value:"C(+0¢)"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]]]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){if(null!==e[0]&&null!==e[1])return Singer.PitchActions.playPitch(e[0],e[1],0,n,l);f.errorMsg(NOINPUTERRORMSG,l),t.stopTurtle=!0}}])})(),I=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["downsixth",_("down sixth")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"minus",0,0,[0,2,3]],[2,["number",{value:-5}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),U=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["downthird",_("down third")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"minus",0,0,[0,2,3]],[2,["number",{value:-2}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),x=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["seventh",_("seventh")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:6}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),D=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["sixth",_("sixth")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:5}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),V=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["fifth",_("fifth")])).setPalette("pitch",f),e.beginnerBlock(!0),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:4}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),G=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["fourth",_("fourth")])).setPalette("pitch",f),e.beginnerBlock(!0),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,7]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:3}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,null]],[7,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),j=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["third",_("third")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:2}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),z=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["second",_("second")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),q=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["unison",_("unison")])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,6,8]],[1,"plus",0,0,[0,2,3]],[2,["number",{value:0}],0,0,[1]],[3,"multiply",0,0,[1,4,5]],[4,["number",{value:0}],0,0,[3]],[5,"modelength",0,0,[3]],[6,"vspace",0,0,[0,7]],[7,"vspace",0,0,[6,null]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),W=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setscalartransposition"])).setPalette("pitch",f),e.piemenuValuesC1=[-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7],e.setHelpString([_("The Scalar transposition block will shift the pitches contained inside Note blocks up (or down) the scale.")+" "+_("In the example shown above, sol is shifted up to la."),"documentation",null,"scalartranshelp"]),e.formBlock({name:_("scalar transpose")+" (+/–)",args:1,defaults:["1"]}),e.makeMacro(function(e,t){return[[0,"setscalartransposition",e,t,[null,1,null,2]],[1,["number",{value:1}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),f.beginnerMode&&e.beginnerModeBlock||(e.hidden=!0),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r;if(void 0!==e[1])return null!==(r=e[0])&&"number"==typeof r||(f.errorMsg(NOINPUTERRORMSG,l),r=0),Singer.PitchActions.setScalarTranspose(r,n,l),[e[1],1]}}])})(),K=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["accidental"])).setPalette("pitch",f),e.setHelpString([_("The Accidental block is used to create sharps and flats"),"documentation",null,"accidental"]),e.formBlock({name:_("accidental override"),args:1,argTypes:["anyin"]}),e.makeMacro(function(e,t){return[[0,"accidental",e,t,[null,11,1,10]],[1,"newnote",e,t,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"hidden",0,0,[1,null]],[10,"hidden",0,0,[0,null]],[11,["accidentalname",{value:"natural ♮"}],0,0,[0]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r;if(void 0!==e[1])return null!==(r=e[0])&&"string"==typeof r||(f.errorMsg(NOINPUTERRORMSG,l),r="sharp"),Singer.PitchActions.setAccidental(r,n,l),[e[1],1]}}])})(),Y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["flat"])).setPalette("pitch",f),e.formBlock({name:_("flat")+" ♭"}),e.makeMacro(function(e,t){return[[0,"accidental",e,t,[null,11,1,10]],[1,"newnote",e,t,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"hidden",0,0,[1,null]],[10,"hidden",0,0,[0,null]],[11,["accidentalname",{value:"flat ♭"}],0,0,[0]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r;if(void 0!==e[0])return(r=f.turtles.ithTurtle(f.turtles.companionTurtle(n))).singer.transposition+=0<r.singer.invertList.length?1:-1,t.setDispatchBlock(l,n,l="_flat_"+n),t.setTurtleListener(n,l,function(e){return r.singer.transposition+=0<r.singer.invertList.length?-1:1}),[e[0],1]}}])})(),X=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["sharp"])).setPalette("pitch",f),e.formBlock({name:_("sharp")+" ♯"}),e.makeMacro(function(e,t){return[[0,"accidental",e,t,[null,11,1,10]],[1,"newnote",e,t,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"hidden",0,0,[1,null]],[10,"hidden",0,0,[0,null]],[11,["accidentalname",{value:"sharp ♯"}],0,0,[0]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r;if(void 0!==e[0])return(r=f.turtles.ithTurtle(f.turtles.companionTurtle(n))).singer.transposition+=0<r.singer.invertList.length?-1:1,t.setDispatchBlock(l,n,l="_sharp_"+n),t.setTurtleListener(n,l,function(e){return r.singer.transposition+=0<r.singer.invertList.length?1:-1}),[e[0],1]}}])})(),$=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["hertz",_("hertz")])).setPalette("pitch",f),e.beginnerBlock(!0),e.setHelpString([_("The Hertz block (in combination with a Number block) will play a sound at the specified frequency."),"documentation",null,"note3"]),e.formBlock({args:1,defaults:["ja"===e.lang?440:392]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r=e[0],s=((null===r||"number"!=typeof r||r<=0)&&(f.errorMsg(NOINPUTERRORMSG,l),r=392),frequencyToPitch(r)),a=f.turtles.ithTurtle(f.turtles.companionTurtle(n));if("?"===s[0])f.errorMsg(INVALIDPITCH,l),t.stopTurtle=!0;else if(t.inMatrix)t.phraseMaker.addRowBlock(l),t.pitchBlocks.includes(l)||t.pitchBlocks.push(l),t.phraseMaker.rowLabels.push(f.blocks.blockList[l].name),t.phraseMaker.rowArgs.push(r.toFixed(0)),a.singer.lastNotePlayed=[s[0]+s[1],4];else if(t.inLegoWidget)t.legoWidget.addRowBlock(l),t.pitchBlocks.includes(l)||t.pitchBlocks.push(l),t.legoWidget.rowLabels.push(f.blocks.blockList[l].name),t.legoWidget.rowArgs.push(r.toFixed(0)),a.singer.lastNotePlayed=[s[0]+s[1],4];else if(t.inMusicKeyboard)t.musicKeyboard.instruments.push(last(a.singer.instrumentNames)),t.musicKeyboard.noteNames.push("hertz"),t.musicKeyboard.octaves.push(r),t.musicKeyboard.addRowBlock(l),a.singer.lastNotePlayed=[s[0]+s[1],4];else if(t.inPitchStaircase){for(var i=r,o=s,c=0,u=0;u<t.pitchStaircase.Stairs.length;u++){if(t.pitchStaircase.Stairs[u][2]<parseFloat(i))return t.pitchStaircase.Stairs.splice(u,0,[o[0],o[1],parseFloat(i)]),void(c=1);if(t.pitchStaircase.Stairs[u][2]===parseFloat(i))return t.pitchStaircase.Stairs.splice(u,1,[o[0],o[1],parseFloat(i)]),void(c=1)}0===c&&t.pitchStaircase.Stairs.push([o[0],o[1],parseFloat(i)]),t.pitchStaircase.stairPitchBlocks.push(l)}else{if(!t.inPitchSlider)return Singer.PitchActions.playHertz(r,n,l);t.pitchSlider.frequencies.push(e[0])}}}])})(),J=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pitchnumber",_("pitch number")])).setPalette("pitch",f),e.beginnerBlock(!0),e.setHelpString([_("The Pitch Number block will play a pitch associated by its number, e.g. 0 for C and 7 for G."),"documentation",null,"note5"]),e.formBlock({args:1,defaults:[7]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){e=null===e[0]?(f.errorMsg(NOINPUTERRORMSG,l),7):"number"!=typeof e[0]?(f.errorMsg(NANERRORMSG,l),7):Math.round(e[0]);return Singer.PitchActions.playPitchNumber(e,n,l)}}])})(),Q=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["scaledegree",_("nth modal pitch")])).setPalette("pitch",f),e.setHelpString([_("nth Modal Pitch takes the pattern of pitches in semitones for a mode and makes each point a degree of the mode,")+" "+_("starting from 1 and regardless of tonal framework (i.e. not always 8 notes in the octave)"),"documentation",""]),e.hidden=!0,e.formBlock({args:2,defaults:[4,4],argLabels:[_("number"),_("octave")],argTypes:["numberin","anyin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r=null!==e[0]?e[0]:"sol",s=null!==e[1]?e[1]:4;if(null!==e[0]&&null!==e[1]||f.errorMsg(NOINPUTERRORMSG,l),"number"==typeof r)return Singer.PitchActions.playNthModalPitch(r,s,n,l);f.errorMsg(INVALIDPITCH,l),t.stopTurtle=!0}}])})(),Z=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["nthmodalpitch",_("nth modal pitch")])).setPalette("pitch",f),e.piemenuValuesC1=[7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7],e.setHelpString([_("Nth Modal Pitch takes a number as an input as the nth degree for the given mode. 0 is the first position, 1 is the second, -1 is the note before the first etc.")+" "+_("The pitches change according to the mode specified without any need for respellings."),"documentation",""]),e.formBlock({args:2,defaults:[4,4],argLabels:[_("number"),_("octave")],argTypes:["numberin","anyin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r=null!==e[0]?e[0]:"sol",s=null!==e[1]?e[1]:4;if(null!==e[0]&&null!==e[1]||f.errorMsg(NOINPUTERRORMSG,l),"number"==typeof r)return Singer.PitchActions.playNthModalPitch(r,s,n,l);f.errorMsg(INVALIDPITCH,l),t.stopTurtle=!0}}])})(),ee=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["scaledegree2",_("scale degree")])).setPalette("pitch",f),e.extraWidth=10,e.setHelpString([_("Scale Degree is a common convention in music. Scale Degree offers seven possible positions in the scale (1-7) and can be modified via accidentals.")+" "+_("Scale Degree 1 is always the first pitch in a given scale, regardless of octave."),"documentation",""]),e.formBlock({outType:"scaledegreeout"}),e.makeMacro(function(e,t){return[[0,"pitch",e,t,[null,1,2,null]],[1,["scaledegree2",{value:"5"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]]]}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t,n){return f.blocks.blockList[n].value}}])})(),te=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["steppitch",_("scalar step")+" (+/–)"])).setPalette("pitch",f),e.piemenuValuesC1=[-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7],e.beginnerBlock(!0),e.setHelpString([_("The Scalar Step block (in combination with a Number block) will play the next pitch in a scale,")+" "+_("eg if the last note played was sol, Scalar Step 1 will play la."),"documentation",""]),e.formBlock({args:1,defaults:[1],argTypes:["anyin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){return Singer.PitchActions.stepPitch(e[0],n,l)}}])})(),ne=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pitch2",_("pitch")+" G4"])).setPalette("pitch",f),e.makeMacro(function(e,t){return[[0,"pitch",e,t,[null,1,2,null]],[1,["notename",{value:"G"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]]]}),e.beginnerBlock(!0),e}return _inherits(t,FlowBlock),_createClass(t)})(),le=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pitch",_("pitch")])).setPalette("pitch",f),e.beginnerBlock(!0),e.setHelpString([_("The Pitch block specifies the pitch name and octave of a note that together determine the frequency of the note."),"documentation",null,"note1"]),e.formBlock({args:2,defaults:["sol",4],argTypes:["solfegein","anyin"],argLabels:["ja"===e.lang?_("name2"):_("name"),_("octave")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r,s,a,i,o,c=null!==e[0]?e[0]:"sol",e=null!==e[1]?e[1]:4,u=("object"===_typeof(c)&&(e=c[1],c=c[0]),null!==c&&null!==e||f.errorMsg(NOINPUTERRORMSG,l),f.turtles.ithTurtle(f.turtles.companionTurtle(n))),h=f.blocks.blockList[l].connections[1],p=null;return null!==h&&(p=f.blocks.blockList[h].name),a=isNaN(Number(c[0]))&&isNaN(Number(c[1]))?"number"!=typeof c&&isNaN(Number(c))?("object"===_typeof(c)&&(e=c[1],c=c[0]),SOLFEGENAMES1.includes(c.toLowerCase())||NOTENAMES1.includes(c.toUpperCase())?(o=c.charAt(c.length-1),[SHARP,FLAT,DOUBLESHARP,DOUBLEFLAT].includes(o)?c=c.substr(0,c.length-1):o=NATURAL,r=NOTENAMES.includes(c.toUpperCase())?SOLFEGECONVERSIONTABLE[c.toUpperCase()]:c,r=o!==NATURAL?r+o:r,o=Math.floor(calcOctave(u.singer.currentOctave,e,u.singer.lastNotePlayed,r)),0):(o=calcOctave(u.singer.currentOctave,e,u.singer.lastNotePlayed,c),r=(s=[c,Math.floor(Math.min(9,Math.max(0,o))),0])[0],o=s[1],s[2])):(c=Number(c))<=12?(c<1&&(f.errorMsg(INVALIDPITCH,l),c=7),r=nthDegreeToPitch(u.singer.keySignature,Math.round(c)),o=Math.floor(calcOctave(u.singer.currentOctave,e,u.singer.lastNotePlayed,r)),0):((c<A0||c>C8)&&(f.errorMsg(INVALIDPITCH,l),c=392),r=(s=_slicedToArray(frequencyToPitch(c),3))[0],o=s[1],s[2]):(o="scaledegree2"===p?(p=(s=f.blocks.blockList[h].value).includes(SHARP)?SHARP:s.includes(FLAT)?FLAT:s.includes(DOUBLESHARP)?DOUBLESHARP:s.includes(DOUBLEFLAT)?DOUBLEFLAT:NATURAL,s=Number(s.replace(p,"")),p!=NATURAL&&(r+=p),h=keySignatureToMode(u.singer.keySignature),(p=s<=0)?a=s+7*(Math.floor(Math.abs(s)/7)+1):0==(a=Math.floor(s)%7)&&(a=7),s=Math.abs(s),i=NOTESTEP[h[0].substr(0,1)]-1,h[0].substr(1)===FLAT?i--:h[0].substr(1)===SHARP&&i++,r=scaleDegreeToPitchMapping(u.singer.keySignature,a,u.singer.movable,null),h=i,h+=NOTESFLAT.includes(r)?NOTESFLAT.indexOf(r)-i:NOTESSHARP.indexOf(r)-i,(p?-1:1)*((p?Math.floor((s+1)/7):Math.floor((s-1)/7))+(p?i<h?1:0:h<i?1:0))+Math.floor(calcOctave(u.singer.currentOctave,e,u.singer.lastNotePlayed,r))):(r=c,e),0),Singer.PitchActions.playPitch(r,o,a,n,l)}}])})();(new i).setup(f),(new o).setup(f),(new e).setup(f),(new t).setup(f),(new n).setup(f),(new l).setup(f),(new r).setup(f),(new s).setup(f),(new a).setup(f),(new c).setup(f),(new u).setup(f),(new h).setup(f),(new p).setup(f),(new g).setup(f),(new y).setup(f),(new S).setup(f),(new m).setup(f),(new d).setup(f),(new N).setup(f),(new b).setup(f),(new v).setup(f),(new L).setup(f),(new B).setup(f),(new A).setup(f),(new O).setup(f),(new R).setup(f),(new M).setup(f),(new E).setup(f),(new F).setup(f),(new I).setup(f),(new U).setup(f),(new x).setup(f),(new D).setup(f),(new V).setup(f),(new G).setup(f),(new j).setup(f),(new z).setup(f),(new q).setup(f),(new W).setup(f),(new C).setup(f),(new K).setup(f),(new Y).setup(f),(new X).setup(f),(new k).setup(f),(new ee).setup(f),(new P).setup(f),(new T).setup(f),(new w).setup(f),(new $).setup(f),(new J).setup(f),(new Q).setup(f),(new Z).setup(f),(new te).setup(f),(new H).setup(f),(new ne).setup(f),(new le).setup(f)}"undefined"!=typeof module&&module.exports&&(module.exports={setupPitchBlocks:setupPitchBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var l=t[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupProgramBlocks(y){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["loadHeapFromApp"])).setPalette("program",y),e.setHelpString([_("The Load-heap-from-app block loads the heap from a web page."),"documentation",""]),e.formBlock({name:_("load heap from App"),args:2,argTypes:["textin","textin"],defaults:["appName","localhost"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(t,o,e,l){if(null===t[0]||null===t[1])y.errorMsg(NOINPUTERRORMSG,l);else{var l=[],r=t[1],t=t[0],s=new XMLHttpRequest,n=[];if(s.open("GET",r,!1),s.send(),4!==s.readyState||200!==s.status)return 4===s.readyState&&200!==s.status?(console.debug("fetched the wrong page or network error..."),void y.errorMsg(_("404: Page not found"))):void y.errorMsg("xmlHttp.readyState: "+s.readyState);console.debug(s.responseText);try{l=JSON.parse(s.responseText)}catch(e){console.debug(e),y.errorMsg(_("Error parsing JSON data:")+e)}t in o.turtleHeaps&&(n=o.turtleHeaps[e]);try{o.turtleHeaps[t]=l}catch(e){o.turtleHeaps[t]=n,console.debug(e)}}}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["saveHeapToApp"])).setPalette("program",y),e.setHelpString([_("The Save-heap-to-app block saves the heap to a web page."),"documentation",""]),e.formBlock({name:_("save heap to App"),args:2,argTypes:["textin","textin"],defaults:["appName","localhost"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){var r;null===e[0]||null===e[1]?y.errorMsg(NOINPUTERRORMSG,l):(l=e[1],(e=e[0])in t.turtleHeaps?(t=JSON.stringify(t.turtleHeaps[e]),(r=new XMLHttpRequest).open("POST",l,!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(t)):y.errorMsg(_("Cannot find a valid heap for")+" "+e))}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["loadHeap"])).setPalette("program",y),e.setHelpString([_("The Load-heap block loads the heap from a file."),"documentation",""]),e.formBlock({name:_("load heap"),args:1,argTypes:["filein"],defaults:[[null,null]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){var l=y.blocks.blockList[l],r=o in t.turtleHeaps?t.turtleHeaps[o]:[],l=l.connections[1];if(null!=l&&"loadFile"===y.blocks.blockList[l].name)if(1!==e.length)y.errorMsg(_("You must select a file."));else try{if(t.turtleHeaps[o]=JSON.parse(y.blocks.blockList[l].value[1]),!Array.isArray(t.turtleHeaps[o]))throw"is not array"}catch(e){t.turtleHeaps[o]=r,y.errorMsg(_("The file you selected does not contain a valid heap."))}else y.errorMsg(_("The loadHeap block needs a loadFile block."))}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setHeap"])).setPalette("program",y),e.setHelpString([_("The Set-heap block loads the heap."),"documentation",""]),e.formBlock({name:_("set heap"),args:1,argTypes:["anyin"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){var l=y.blocks.blockList[l],r=o in t.turtleHeaps?t.turtleHeaps[o]:[],l=l.connections[1];if(null!==l)try{if(t.turtleHeaps[o]=JSON.parse(y.blocks.blockList[l].value),!Array.isArray(t.turtleHeaps[o]))throw"is not array"}catch(e){t.turtleHeaps[o]=r,y.errorMsg(_("The block you selected does not contain a valid heap."))}else y.errorMsg(_("The Set heap block needs a heap."))}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["loadDict"])).setPalette("program",y),e.setHelpString([_("The Load-dictionary block loads a dictionary from a file."),"documentation",""]),e.formBlock({name:_("load dictionary"),args:2,argTypes:["textin","filein"],argLabels:[_("name"),_("file")],defaults:[_("My Dictionary"),[null,null]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){var r=y.blocks.blockList[l];if(null===e[0])y.errorMsg(NOINPUTERRORMSG,l);else if(null===e[1])y.errorMsg(NOINPUTERRORMSG,l);else{l=e[0],r=(o in t.turtleDicts||(t.turtleDicts[o]={}),r.connections[2]);if(null!=r&&"loadFile"===y.blocks.blockList[r].name)if(2!==e.length)y.errorMsg(_("You must select a file."));else try{var s=JSON.parse(y.blocks.blockList[r].value[1]),n=getTargetTurtle(y.turtles,l);if(null!==n)for(var a=Object.keys(s),c=0;c<a.length;c++)Turtle.DictActions.setDictValue(n,o,a[c],s[a[c]]);else l in t.turtleDicts[o]||(t.turtleDicts[o][l]={})}catch(e){y.errorMsg(_("The file you selected does not contain a valid dictionary."))}else y.errorMsg(_("The load dictionary block needs a load file block."))}}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setDictionary"])).setPalette("program",y),e.setHelpString([_("The Set-dictionary block loads a dictionary."),"documentation",""]),e.formBlock({name:_("set dictionary"),args:2,argTypes:["textin","anyin"],argLabels:[_("name"),_("dictionary")],defaults:[_("My Dictionary")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){var r=y.blocks.blockList[l];if(null===e[0])y.errorMsg(NOINPUTERRORMSG,l);else if(null===e[1])y.errorMsg(NOINPUTERRORMSG,l);else{l=e[0],e=(o in t.turtleDicts||(t.turtleDicts[o]={}),r.connections[2]);if(null!=e)try{var s=JSON.parse(y.blocks.blockList[e].value),n=getTargetTurtle(y.turtles,l);if(null!==n)for(var a=Object.keys(s),c=0;c<a.length;c++)Turtle.DictActions.setDictValue(n,o,a[c],s[a[c]]);else l in t.turtleDicts[o]||(t.turtleDicts[o][l]={})}catch(e){y.errorMsg(_("The block you selected does not contain a valid dictionary."))}else y.errorMsg(_("The set dictionary block needs a dictionary."))}}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["saveHeap"])).setPalette("program",y),e.setHelpString([_("The Save-heap block saves the heap to a file."),"documentation",""]),e.formBlock({name:_("save heap"),args:1,argTypes:["textin"],defaults:["heap.json"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o){null!==e[0]&&o in t.turtleHeaps&&y.save.download("json","data:text/json;charset-utf-8,"+JSON.stringify(t.turtleHeaps[o]),e[0])}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["saveDict"])).setPalette("program",y),e.setHelpString([_("The Save-dictionary block saves a dictionary to a file."),"documentation",""]),e.formBlock({name:_("save dictionary"),args:2,argTypes:["textin","textin"],argLabels:[_("name"),_("file")],defaults:[_("My Dictionary"),"dictionary.json"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){var r;null===e[0]||null===e[1]?y.errorMsg(NOINPUTERRORMSG,l):(l=e[0],o in t.turtleDicts||(t.turtleDicts[o]={}),null===(r=getTargetTurtle(y.turtles,l))?y.save.download("json","data:text/json;charset-utf-8,"+JSON.stringify(t.turtleDicts[o][l]),e[1]):y.save.download("json","data:text/json;charset-utf-8,"+Turtle.DictActions.SerializeDict(r,o),e[1]))}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["openpalette"])).setPalette("program",y),e.setHelpString([_("The Open palette block opens a palette."),"documentation",""]),e.formBlock({name:_("open palette"),args:1,argTypes:["textin"],defaults:[_("rhythm")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){if(e.length<1)y.errorMsg(NOINPUTERRORMSG,l);else for(var r in y.blocks.palettes.dict)if(_(y.blocks.palettes.dict[r].name)===e[0].toLowerCase())return y.blocks.palettes.hide(),y.blocks.palettes.dict[r].show(),void y.blocks.palettes.show()}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["deleteblock"])).setPalette("program",y),e.setHelpString([_("The Delete block block removes a block."),"documentation","","deletehelp"]),e.formBlock({name:_("delete block"),args:1}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){if(e.length<1)y.errorMsg(NOINPUTERRORMSG,l),t.stopTurtle=!0;else if(e[0]<0||e[0]>y.blocks.blockList.length-1)y.errorMsg(NOINPUTERRORMSG,l);else if(!y.blocks.blockList[e[0]].trash){var r=y.blocks.blockList[e[0]].connections[0];if((y.blocks.blockList[e[0]].connections[0]=null)!==r)for(var s=0;s<y.blocks.blockList[r].connections.length;s++)y.blocks.blockList[r].connections[s]===e[0]&&(y.blocks.blockList[r].connections[s]=null);y.blocks.sendStackToTrash(y.blocks.blockList[e[0]]),y.blocks.adjustDocks(r,!0)}}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["moveblock"])).setPalette("program",y),e.setHelpString([_("The Move block block moves a block."),"documentation",""]),e.formBlock({name:_("move block"),args:3,argLabels:[_("block number"),_("x"),_("y")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){var r;e.length<3||e[0]<0||e[0]>y.blocks.blockList.length-1?y.errorMsg(NOINPUTERRORMSG,l):(l=y.turtles.turtleX2screenX(e[1]),r=y.turtles.turtleY2screenY(e[2]),y.blocks.moveBlock(e[0],l,r))}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["runblock"])).setPalette("program",y),e.setHelpString([_("The Run block block runs a block. It accepts two types of arguments: block number or block name."),"documentation",""]),e.formBlock({name:_("run block"),args:1,argTypes:["anyin"],defaults:[0]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l,r){if(!(e.length<1)){if("string"==typeof e[0])for(var s=0;s<y.blocks.blockList.length;s++)if(0<y.blocks.blockList[s].protoblock.staticLabels.length&&y.blocks.blockList[s].protoblock.staticLabels[0]===e[0])return void(e[0]=s);var n,a;if("string"==typeof e[0]&&(e[0]=-1),!(e[0]<0||e[0]>y.blocks.blockList.length-1))return"start"!==y.blocks.blockList[e[0]].name?[e[0],1]:(n=y.blocks.blockList[e[0]].value,a=y.turtles.ithTurtle(n),console.debug("run start "+n),t.initTurtle(n),a.queue=[],a.parentFlowQueue=[],a.unhighlightQueue=[],a.parameterQueue=[],a.running=!0,void t.runFromBlock(t,n,e[0],0,r))}y.errorMsg(NOINPUTERRORMSG,l)}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["dockblock"])).setPalette("program",y),e.setHelpString([_("The Dock block block connections two blocks."),"documentation",""]),e.formBlock({name:_("connect blocks"),args:3,argLabels:[_("target block"),_("connection number"),_("block number")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){if(e.length<3)console.debug(e.length+" < 3"),y.errorMsg(NOINPUTERRORMSG,l);else if(e[0]<0||e[0]>y.blocks.blockList.length-1)console.debug(e[0]+" > "+y.blocks.blockList.length-1),y.errorMsg(NOINPUTERRORMSG,l);else if(e[0]===e[2])console.debug(e[0]+" == "+e[2]),y.errorMsg(NOINPUTERRORMSG,l);else if(e[2]<0||e[2]>y.blocks.blockList.length-1)console.debug(e[2]+" > "+y.blocks.blockList.length-1),y.errorMsg(NOINPUTERRORMSG,l);else{if(-1===e[1])e[1]=y.blocks.blockList[e[0]].connections.length-1;else if(e[1]<1||e[1]>y.blocks.blockList[e[0]].connections.length-1)return console.debug(e[1]+" out of bounds"),void y.errorMsg(NOINPUTERRORMSG,l);var r=y.blocks.blockList[e[0]].connections[e[1]];if(null!==r)if("hidden"===y.blocks.blockList[r].name)e[0]=r,e[1]=1;else{for(var s=0;s<y.blocks.blockList[r].connections.length;s++)if(y.blocks.blockList[r].connections[s]===e[0])return void(y.blocks.blockList[r].connections[s]=null);y.blocks.blockList[e[0]].connections[e][1]=null}y.blocks.blockList[e[0]].connections[e[1]]=e[2],y.blocks.blockList[e[2]].connections[0]=e[0],y.blocks.adjustDocks(e[0],!0)}}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["makeblock"])).setPalette("program",y),e.setHelpString([_("The Make block block creates a new block."),"documentation","","makehelp"]),e.formBlock({name:_("make block"),args:1,argTypes:["anyin"],outType:"numberout",flows:{type:"arg",types:["anyin"],labels:[""]},defaults:[_("note")]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"arg",value:function(e,t,o,l){y.blocks.showBlocks();var r=[null];if(0<y.blocks.blockList[o].argClampSlots.length)for(var s=0;s<y.blocks.blockList[o].argClampSlots.length;s++){var n=e.parseArg(e,t,y.blocks.blockList[o].connections[s+2],o,l);r.push(n)}var a,c,i,u=y.blocks.blockList[o].connections[1],u=e.parseArg(e,t,u,o,l),p=y.blocks.blockList.length,k=y.turtles.ithTurtle(t),f=y.turtles.turtleX2screenX(k.x),b=y.turtles.turtleY2screenY(k.y);if(k.doWait(1),u===_("note")){switch(r.length){case 1:a="sol",i=c=4;break;case 2:a=r[1],i=c=4;break;case 3:a=r[1],c=r[2],i=4;break;default:a=r[1],c=r[2],i=r[3]}y.blocks.loadNewBlocks([[0,"newnote",f,b,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:i}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:a}],0,0,[5]],[7,["number",{value:c}],0,0,[5]],[8,"hidden",0,0,[0,null]]])}else if(u===_("start"))y.blocks.loadNewBlocks([[0,"start",f,b,[null,null,null]]]);else if(u===_("silence"))y.blocks.loadNewBlocks([[0,"rest2",f,b,[null,null]]]);else{var k=y.blocks.palettes.getProtoNameAndPalette(u),h=k[0],k=k[2];if(null===h)return y.errorMsg(_("Cannot find block")+" "+u),console.debug("Cannot find block "+u),0;for(var g=[[0,k,f,b,[null]]],d=1;d<y.blocks.protoBlockDict[h].dockTypes.length;d++)d<r.length?("number"==typeof r[d]?(["anyin","numberin"].includes(y.blocks.protoBlockDict[h].dockTypes[d])||y.errorMsg(_("Warning: block argument type mismatch")),g.push([d,["number",{value:r[d]}],0,0,[0]])):"string"==typeof r[d]?(["anyin","textin"].includes(y.blocks.protoBlockDict[h].dockTypes[d])||y.errorMsg(_("Warning: block argument type mismatch")),g.push([d,["string",{value:r[d]}],0,0,[0]])):g[0][4].push(null),g[0][4].push(d)):g[0][4].push(null);y.blocks.loadNewBlocks(g)}return console.debug("BLOCKNUMBER "+p),p}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["openProject"])).setPalette("program",y),e.setHelpString([_("The Open project block is used to open a project from a web page."),"documentation",""]),e.formBlock({name:_("open project"),args:1,argTypes:["textin"],defaults:["url"]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,o,l){null===e[0]?y.errorMsg(NOINPUTERRORMSG,l):(e=>{if(new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.) {3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e))return 1;y.errorMsg(_("Please enter a valid URL."))})(l=e[0])&&((e=window.open(l,"_blank"))?e.focus():alert("Please allow popups for this site"))}}])})();(new i).setup(y),(new u).setup(y),(new p).setup(y),(new k).setup(y),(new f).setup(y),(new b).setup(y),(new c).setup(y),(new e).setup(y),(new t).setup(y),(new a).setup(y),(new r).setup(y),(new s).setup(y),(new n).setup(y),(new o).setup(y),(new l).setup(y)}"undefined"!=typeof module&&module.exports&&(module.exports={setupProgramBlocks:setupProgramBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var language=localStorage.languagePreference||navigator.language,rhythmBlockPalette="ja"===language?"rhythm":"widgets";function setupRhythmBlockPaletteBlocks(d){var e=(()=>{function t(e){return _classCallCheck(this,t),(e=_callSuper(this,t,[e||"rhythm"])).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.formBlock({name:"ja"===e.lang?_("rhythm1"):_("rhythm"),args:2,defaults:[3,4],argLabels:[_("number of notes"),_("note value")],argTypes:["anyin","anyin"]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l){var n=null===e[0]||"number"!=typeof e[0]||e[0]<1?(d.errorMsg(NOINPUTERRORMSG,l),3):e[0],u=null===e[1]||"number"!=typeof e[1]||e[1]<=0?(d.errorMsg(NOINPUTERRORMSG,l),.25):e[1],a="rhythm2"===d.blocks.blockList[l].name?1/u:u;if(t.inMatrix||t.tuplet){if(t.inMatrix){t.phraseMaker.addColBlock(l,n);for(var o=0;o<n;o++)t.tupletRhythms.push(["individual",1,a])}for(var s=0;s<e[0];s++)Singer.processNote(d,a,!1,l,r)}else if(t.inRhythmRuler){null===t.rhythmRulerMeasure?t.rhythmRulerMeasure=n*u:t.rhythmRulerMeasure!=n*u&&d.textMsg(_("polyphonic rhythm"));for(var i=-1,c=0;c<t.rhythmRuler.Drums.length;c++){var h=t.rhythmRuler.Drums.length-c-1;if(t.rhythmRuler.Drums[h]===t._currentDrumBlock){i=h;break}}if(-1!==i)for(var p=0;p<n;p++)t.rhythmRuler.Rulers[i][0].push(a)}else{for(var m=d.turtles.ithTurtle(r),u=(0<m.singer.drumStyle.length?(t.clearNoteParams(m,l,m.singer.drumStyle),m.singer.inNoteBlock.push(l)):(t.clearNoteParams(m,l,[]),m.singer.inNoteBlock.push(l),m.singer.notePitches[last(m.singer.inNoteBlock)]=["G"],m.singer.noteOctaves[last(m.singer.inNoteBlock)]=[4],m.singer.noteCents[last(m.singer.inNoteBlock)]=[0]),TONEBPM/(0<m.singer.bpm.length?last(m.singer.bpm):Singer.masterBPM)),f=null==u?1:u/a,v=0;v<n;v++)((e,t,r,l,n)=>{setTimeout(function(){return Singer.processNote(d,e,!1,t,r,l)},n)})(a,l,r,v===n-1?function(){delete m.singer.noteDrums[l],m.singer.inNoteBlock.splice(m.singer.inNoteBlock.indexOf(l),1)}:null,v*f*1e3);m.doWait((n-1)*f)}}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["rhythm2"])).setPalette(rhythmBlockPalette,d),e.beginnerBlock(!0),e.piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],e.setHelpString([_("The Rhythm block is used to generate rhythm patterns."),"documentation",null,"rhythm2"]),e.extraWidth=10,e.formBlock({name:"ja"===e.lang?_("rhythm1"):_("rhythm"),args:2,defaults:[3,4],argLabels:[_("number of notes"),_("note value")],argTypes:["anyin","anyin"]}),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:3}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,e),_createClass(t)})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),isAppleBrowser()?(e=_callSuper(this,t,["sixtyfourthNote",_("1/64 note")])).appleNoteBlock():e=_callSuper(this,t,["sixtyfourthNote",_("1/64 note")+" 𝅘𝅥𝅱"]),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:64}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t)})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),isAppleBrowser()?(e=_callSuper(this,t,["thirtysecondNote",_("1/32 note")])).appleNoteBlock():e=_callSuper(this,t,["thirtysecondNote",_("1/32 note")+" 𝅘𝅥𝅰"]),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:32}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t)})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),isAppleBrowser()?(e=_callSuper(this,t,["sixteenthNote",_("1/16 note")])).appleNoteBlock():e=_callSuper(this,t,["sixteenthNote",_("1/16 note")+" 𝅘𝅥𝅯"]),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:16}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t)})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["eighthNote",_("eighth note")+" ♪"])).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:8}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["quarterNote",_("quarter note")+" ♩"])).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),isAppleBrowser()?(e=_callSuper(this,t,["halfNote",_("half note")])).appleNoteBlock():e=_callSuper(this,t,["halfNote",_("half note")+" 𝅗𝅥"]),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t)})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),isAppleBrowser()?(e=_callSuper(this,t,["wholeNote",_("whole note")])).appleNoteBlock():e=_callSuper(this,t,["wholeNote",_("whole note")+" 𝅝"]),e.setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"rhythm2",e,t,[null,1,2,5]],[1,["number",{value:1}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:1}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),_assertThisInitialized(e)}return _inherits(t,FlowBlock),_createClass(t)})(),i=(()=>{function t(e){return _classCallCheck(this,t),(e=_callSuper(this,t,[e||"tuplet2"])).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.formBlock({name:_("tuplet"),args:2,defaults:[1,4],argLabels:[_("number of notes"),_("note value")]}),e.hidden=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l){t.inMatrix&&("tuplet3"===d.blocks.blockList[l].name?t.tupletParams.push([e[0],1/e[1]*d.turtles.ithTurtle(r).singer.beatFactor]):t.tupletParams.push([e[0],e[1]*d.turtles.ithTurtle(r).singer.beatFactor]),t.tuplet=!0,t.addingNotesToTuplet=!1);var n="_tuplet_"+r;t.setDispatchBlock(l,r,n);return t.setTurtleListener(r,n,function(e){t.inMatrix&&(t.tuplet=!1,t.addingNotesToTuplet=!1)}),[e[2],1]}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["tuplet3"])).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.formBlock({name:_("tuplet"),args:2,defaults:[1,4],argLabels:[_("number of notes"),_("note value")]}),e.makeMacro(function(e,t){return[[0,"tuplet3",e,t,[null,1,10,9,7]],[1,["number",{value:1}],0,0,[0]],[2,"rhythm2",0,0,[9,3,4,8]],[3,["number",{value:3}],0,0,[2]],[4,"divide",0,0,[2,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"hidden",0,0,[0,null]],[8,"vspace",0,0,[2,null]],[9,"vspace",0,0,[0,2]],[10,"divide",0,0,[0,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]]]}),e.hidden=!0,e}return _inherits(t,i),_createClass(t)})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["tuplet4"])).setPalette(rhythmBlockPalette,d),e.setHelpString([_("The Tuplet block is used to generate a group of notes played in a condensed amount of time."),"documentation",null,"tuplet4"]),e.extraWidth=30,e.formBlock({name:_("tuplet"),args:1,defaults:[.25],argLabels:[_("note value")]}),e.makeMacro(function(e,t){return[[0,"tuplet4",e,t,[null,1,4,17]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"rhythm2",0,0,[4,6,7,10]],[6,["number",{value:6}],0,0,[5]],[7,"divide",0,0,[5,8,9]],[8,["number",{value:1}],0,0,[7]],[9,["number",{value:16}],0,0,[7]],[10,"vspace",0,0,[5,11]],[11,"rhythm2",0,0,[10,12,13,16]],[12,["number",{value:1}],0,0,[11]],[13,"divide",0,0,[11,14,15]],[14,["number",{value:1}],0,0,[13]],[15,["number",{value:4}],0,0,[13]],[16,"vspace",0,0,[11,null]],[17,"hidden",0,0,[0,18]],[18,"hidden",0,0,[17,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,_,v,y){var t;if(void 0!==e[1])return t=null===e[0]||"number"!=typeof e[0]||e[0]<=0?(d.errorMsg(NOINPUTERRORMSG,y),.5):e[0],_.inMatrix||(_.tupletRhythms=[],_.tupletParams=[]),_.tuplet=!0,_.addingNotesToTuplet=!1,_.tupletParams.push([1,1/t*d.turtles.ithTurtle(v).singer.beatFactor]),_.setDispatchBlock(y,v,t="_tuplet_"+v),_.setTurtleListener(v,t,function(e){var t=d.turtles.ithTurtle(v);if(_.tuplet=!1,_.addingNotesToTuplet=!1,!_.inMatrix){for(var r=[],l=0;l<_.tupletRhythms.length;l++){for(var n=[_.tupletParams[_.tupletRhythms[l][1]]],u=(n.push([]),0),a=2;a<_.tupletRhythms[l].length;a++)u+=1/_.tupletRhythms[l][a],n[1].push(_.tupletRhythms[l][a]);for(var o=n[0][0]/(n[0][1]*u),s=2;s<_.tupletRhythms[l].length;s++)r.push(_.tupletRhythms[l][s]/o)}0<t.singer.drumStyle.length?_.clearNoteParams(t,y,t.singer.drumStyle):_.clearNoteParams(t,y,[DEFAULTDRUM]),t.singer.inNoteBlock.push(y);for(var i=0<TONEBPM/t.singer.bpm.length?last(t.singer.bpm):Singer.masterBPM,c=0,h=0,p=0;p<r.length;p++){var m=r[p],f=i/m;((e,t,r,l,n)=>{setTimeout(function(){return Singer.processNote(d,e,!1,t,r,l)},n)})(m,y,v,p===r.length-1?function(){delete t.singer.noteDrums[y],t.singer.inNoteBlock.splice(t.singer.inNoteBlock.indexOf(y),1)}:null,h),h+=1e3*f,c+=f}t.doWait(c-f)}}),[e[1],1]}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["stuplet7",_("septuplet")])).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"stuplet",e,t,[null,1,2,5]],[1,["number",{value:7}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["stuplet5",_("quintuplet")])).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"stuplet",e,t,[null,1,2,5]],[1,["number",{value:5}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["stuplet3",_("triplet")])).setPalette(rhythmBlockPalette,d),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"stuplet",e,t,[null,1,2,5]],[1,["number",{value:3}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["stuplet",_("simple tuplet")])).setPalette(rhythmBlockPalette,d),e.piemenuValuesC1=[3,5,7,11],e.beginnerBlock(_THIS_IS_MUSIC_BLOCKS_),e.setHelpString([_("Tuplets are a collection of notes that get scaled to a specific duration.")+" "+_("Using tuplets makes it easy to create groups of notes that are not based on a power of 2."),"documentation",null,"matrix"]),e.formBlock({args:2,defaults:[3,.5],argLabels:[_("number of notes"),_("note value")]}),e.makeMacro(function(e,t){return[[0,"stuplet",e,t,[null,1,2,5]],[1,["number",{value:3}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:2}],0,0,[2]],[5,"vspace",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,l){var n=null===e[0]||"number"!=typeof e[0]||e[0]<=0?(d.errorMsg(NOINPUTERRORMSG,l),3):e[0],u=null===e[1]||"number"!=typeof e[1]||e[1]<=0?(d.errorMsg(NOINPUTERRORMSG,l),.5):e[1],a=1/u*d.turtles.ithTurtle(r).singer.beatFactor;if(t.inMatrix||t.tuplet)if(t.phraseMaker.addColBlock(l,n),t.tuplet)for(var o=0;o<n;o++)t.addingNotesToTuplet||(t.tupletRhythms.push(["notes",0]),t.addingNotesToTuplet=!0),Singer.processNote(d,a,!1,l,r);else{t.tupletParams.push([1,a]);for(var s=["simple",0],i=0;i<n;i++)s.push(1/u*d.turtles.ithTurtle(r).singer.beatFactor);t.tupletRhythms.push(s)}else{var c=d.turtles.ithTurtle(r);0<c.singer.drumStyle.length?t.clearNoteParams(c,l,c.singer.drumStyle):t.clearNoteParams(c,l,[DEFAULTDRUM]),c.singer.inNoteBlock.push(l);for(var h=TONEBPM/(0<c.singer.bpm.length?last(c.singer.bpm):Singer.masterBPM)/a/n,p=0;p<n;p++)((e,t,r,l,n)=>{setTimeout(function(){return Singer.processNote(d,e,!1,t,r,l)},n)})(a*n,l,r,p===n-1?function(){delete c.singer.noteDrums[l],c.singer.inNoteBlock.splice(c.singer.inNoteBlock.indexOf(l),1)}:null,p*h*1e3);c.doWait((n-1)*h)}}}])})();(new e).setup(d),(new t).setup(d),(new r).setup(d),(new l).setup(d),(new n).setup(d),(new u).setup(d),(new a).setup(d),(new o).setup(d),(new s).setup(d),(new i).setup(d),(new c).setup(d),(new h).setup(d),(new p).setup(d),(new m).setup(d),(new f).setup(d),(new v).setup(d)}function isAppleBrowser(){var e=navigator.userAgent,t=e.includes("Macintosh"),r=e.includes("iPad")||e.includes("Macintosh")&&"ontouchend"in document,l=e.includes("Safari")&&!e.includes("Chrome"),e=e.includes("Chrome");return(t||r)&&(l||e)}_THIS_IS_TURTLE_BLOCKS_&&(rhythmBlockPalette="rhythm"),"undefined"!=typeof module&&module.exports&&(module.exports={setupRhythmBlockPaletteBlocks:setupRhythmBlockPaletteBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupRhythmBlocks(a){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mynotevalue",_("note value")])).setPalette("rhythm",a),e.parameter=!0,e.beginnerBlock(!0),e.setHelpString([_("The Note value block is the value of the duration of the note currently being played."),"documentation",null,"everybeathelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return mixedNumber(a.blocks.blockList[n].value)}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==a.blocks.blockList[a.blocks.blockList[n].connections[0]].name)return Singer.RhythmActions.getNoteValue(a.turtles.companionTurtle(t));e.statusFields.push([n,"mynotevalue"])}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["skipfactor","skip factor"])).setPalette("rhythm",a),e.setHelpString(),e.parameter=!0,e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return a.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==a.blocks.blockList[a.blocks.blockList[n].connections[0]].name)return a.turtles.ithTurtle(t).singer.skipFactor;e.statusFields.push([n,"skip"])}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["osctime"])).setPalette("rhythm",a),e.setHelpString([_("The Milliseconds block is similar to a Note block except that it uses time (in MS) to specify the note duration."),"documentation",null,"osctimehelp"]),e.formBlock({name:_("milliseconds"),args:1,defaults:[200],canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"osctime",e,t,[null,2,1,7]],[1,"vspace",0,0,[0,5]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1e3}],0,0,[2]],[4,"divide",0,0,[2,8,9]],[5,"hertz",0,0,[1,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]],[8,["number",{value:3}],0,0,[4]],[9,["number",{value:2}],0,0,[4]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(n,e,r,l,u){var t;if(void 0!==n[1])return null===n[0]||"number"!=typeof n[0]?a.errorMsg(NOINPUTERRORMSG,l):n[0]<=0&&a.errorMsg(_("Note value must be greater than 0."),l),t=null===n[0]||"number"!=typeof n[0]?.25:Math.abs(n[0]),Singer.RhythmActions.playNote(t,"osctime",r,l,function(){var e=a.turtles.ithTurtle(r),t=new Queue(n[1],1,l,u);e.parentFlowQueue.push(l),e.queue.push(t)}),[n[1],1]}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["swing"])).setPalette("rhythm",a),e.setHelpString(),e.formBlock({name:_("swing"),args:1,defaults:[32]}),e.makeMacro(function(e,t){return[[0,"swing",e,t,[null,1,null,2]],[1,["number",{value:32}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var l=a.turtles.ithTurtle(n),u=(l.singer.swing.push(e[0]),l.singer.swingTarget.push(null),l.singer.swingCarryOver=0,"_swing_"+n);t.setDispatchBlock(r,n,u);return t.setTurtleListener(n,u,function(e){l.singer.suppressOutput||(l.singer.swingTarget.pop(),l.singer.swing.pop()),l.singer.swingCarryOver=0}),[e[1],1]}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["newswing"])).setPalette("rhythm",a),e.setHelpString(),e.formBlock({name:_("swing"),args:1,defaults:[1/24]}),e.makeMacro(function(e,t){return[[0,"newswing",e,t,[null,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:16}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var l=a.turtles.ithTurtle(n),u=(l.singer.swing.push(1/e[0]),l.singer.swingTarget.push(null),l.singer.swingCarryOver=0,"_swing_"+n);t.setDispatchBlock(r,n,u);return t.setTurtleListener(n,u,function(e){l.singer.suppressOutput||(l.singer.swingTarget.pop(),l.singer.swing.pop()),l.singer.swingCarryOver=0}),[e[1],1]}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["newswing2"])).setPalette("rhythm",a),e.setHelpString([_("The Swing block works on pairs of notes (specified by note value), adding some duration (specified by swing value) to the first note and taking the same amount from the second note."),"documentation",null,"swinghelp"]),e.formBlock({name:_("swing"),args:2,defaults:[1/24,1/8],argLabels:[_("swing value"),_("note value")],canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"newswing2",e,t,[null,1,6,9,10]],[1,"hspace",0,0,[0,2]],[2,"hspace",0,0,[1,3]],[3,"divide",0,0,[2,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:24}],0,0,[3]],[6,"divide",0,0,[0,7,8]],[7,["number",{value:1}],0,0,[6]],[8,["number",{value:8}],0,0,[6]],[9,"vspace",0,0,[0,null]],[10,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var l,u;if(void 0!==e[2])return(null===e[0]||"number"!=typeof e[0]||e[0]<=0||null===e[1]||"number"!=typeof e[1]||e[1]<=0)&&a.errorMsg(NOINPUTERRORMSG,r),l=null===e[0]||"number"!=typeof e[0]||e[0]<=0?1/24:e[0],u=null===e[1]||"number"!=typeof e[1]||e[1]<=0?1/8:e[1],Singer.RhythmActions.addSwing(l,u,n,r),[e[2],1]}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["skipnotes"])).setPalette("rhythm",a),e.setHelpString([_("The Skip notes block will cause notes to be skipped."),"documentation",null,"skiphelp"]),e.formBlock({name:_("skip notes"),args:1,defaults:[2],canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"skipnotes",e,t,[null,1,null,2]],[1,["number",{value:2}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var l=a.turtles.ithTurtle(n),u=null===e[0]?0:e[0],o=(l.singer.skipFactor+=u,"_skip_"+n);t.setDispatchBlock(r,n,o);return t.setTurtleListener(n,o,function(e){l.singer.skipFactor-=u}),[e[1],1]}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["multiplybeatfactor"])).setPalette("rhythm",a),e.setHelpString([_("The Multiply note value block changes the duration of notes by changing their note values."),"documentation",null,"multiplybeathelp"]),e.formBlock({name:_("multiply note value"),args:1,defaults:[2],canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"multiplybeatfactor",e,t,[null,1,4,5]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"vspace",0,0,[0,null]],[5,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var l;if(void 0!==e[1])return(null===(l=e[0])||"number"!=typeof l||l<=0)&&(a.errorMsg(NOINPUTERRORMSG,r),l=2),Singer.RhythmActions.multiplyNoteValue(l,n,r),[e[1],1]}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["tie"])).setPalette("rhythm",a),e.beginnerBlock(!0),e.setHelpString([_("The Tie block works on pairs of notes, combining them into one note."),"documentation",null,"tiehelp"]),e.formBlock({name:_("tie"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"tie",e,t,[null,null,1]],[1,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){if(void 0!==e[0])return Singer.RhythmActions.doTie(n,r),[e[0],1]}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["rhythmicdot"])).setPalette("rhythm",a),e.setHelpString(),e.formBlock({name:_("dot"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"rhythmicdot",e,t,[null,null,1]],[1,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){null===e[0]&&a.errorMsg(NOINPUTERRORMSG,r);var l=1,u=a.turtles.ithTurtle(n),o=2-1/Math.pow(2,u.singer.dotCount),o=(u.singer.beatFactor*=o,0<=l?u.singer.dotCount+=l:-1===l?(a.errorMsg(_("An argument of -1 results in a note value of 0."),r),l=0):u.singer.dotCount+=1/l,2-1/Math.pow(2,u.singer.dotCount)),o=(u.singer.beatFactor/=o,"_dot_"+n);t.setDispatchBlock(r,n,o);return t.setTurtleListener(n,o,function(e){var t=2-1/Math.pow(2,u.singer.dotCount),t=(u.singer.beatFactor*=t,u.singer.dotCount-=0<=l?l:1/l,2-1/Math.pow(2,u.singer.dotCount));u.singer.beatFactor/=t}),[e[0],1]}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["rhythmicdot2"])).setPalette("rhythm",a),e.piemenuValuesC1=[1,2,3],e.setHelpString([_("The Dot block extends the duration of a note by 50%.")+" "+_("Eg a dotted quarter note will play for 3/8 (1/4 + 1/8) of a beat."),"documentation",null,"dothelp"]),e.formBlock({name:_("dot"),args:1,defaults:[1],canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"rhythmicdot2",e,t,[null,1,null,2]],[1,["number",{value:1}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){null===e[0]&&a.errorMsg(NOINPUTERRORMSG,r);var l=null===e[0]?0:e[0];return Singer.RhythmActions.doRhythmicDot(l,n,r),[e[1],1]}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["rest2",_("silence")])).setPalette("rhythm",a),e.beginnerBlock(!0),e.setHelpString([_("A rest of the specified note value duration can be constructed using a Silence block."),"documentation",null,"rest2"]),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,6]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"rest2",0,0,[4,null]],[6,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n){Singer.RhythmActions.playRest(n)}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["note4"])).setPalette("rhythm",a),e.beginnerBlock(!0),e.formBlock({name:"ja"===e.lang?_("note value drum"):_("note value")+" "+_("drum"),args:1,canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"playdrum",0,0,[4,6,null]],[6,["drumname",{value:DEFAULTDRUM}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(){}}])})(),m=(()=>{function n(e,t){return _classCallCheck(this,n),(e=_callSuper(this,n,[e])).setPalette("rhythm",a),e.setHelpString(),e.formBlock({name:_("note value")+" "+t,args:1,canCollapse:!0}),e}return _inherits(n,FlowClampBlock),_createClass(n,[{key:"flow",value:function(){}}])})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["note3",_("392 hertz")])).setHelpString(),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"hertz",0,0,[4,6,null]],[6,["number",{value:392}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e}return _inherits(t,m),_createClass(t,[{key:"flow",value:function(){}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["note5","7"])).setHelpString(),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitchnumber",0,0,[4,6,null]],[6,["number",{value:7}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e}return _inherits(t,m),_createClass(t,[{key:"flow",value:function(){}}])})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["note7","4 4"])).setHelpString(),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"nthmodalpitch",0,0,[4,6,7,null]],[6,["number",{value:4}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,m),_createClass(t,[{key:"flow",value:function(){}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["note8",_("scale degree")])).setHelpString(),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["scaledegree2",{value:"5"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,m),_createClass(t,[{key:"flow",value:function(){}}])})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["note6","+1"])).setHelpString(),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,7]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"steppitch",0,0,[4,6,null]],[6,["number",{value:1}],0,0,[5]],[7,"hidden",0,0,[0,null]]]}),e}return _inherits(t,m),_createClass(t,[{key:"flow",value:function(){}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["note2","G4"])).setHelpString(),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["notename",{value:"G"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,m),_createClass(t,[{key:"flow",value:function(){}}])})(),w=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["note1",i18nSolfege("sol")+"4"])).setHelpString(),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,m),_createClass(t,[{key:"flow",value:function(){}}])})(),C=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["note"])).setPalette("rhythm",a),e.setHelpString(),e.formBlock({name:"deprecated note value",args:1,defaults:[4],canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,2,5]],[1,["number",{value:8}],0,0,[0]],[2,"pitch",0,0,[0,3,4,null]],[3,["solfege",{value:"sol"}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(n,e,r,l,u){var t;if(void 0!==n[1])return null===n[0]||"number"!=typeof n[0]?a.errorMsg(NOINPUTERRORMSG,l):n[0]<=0&&a.errorMsg(_("Note value must be greater than 0."),l),t=null===n[0]||"number"!=typeof n[0]?.25:Math.abs(n[0]),Singer.RhythmActions.playNote(t,"note",r,l,function(){var e=a.turtles.ithTurtle(r),t=new Queue(n[1],1,l,u);e.parentFlowQueue.push(l),e.queue.push(t)}),[n[1],1]}}])})(),S=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["newnote"])).setPalette("rhythm",a),e.beginnerBlock(!0),e.setHelpString([_("The Note block is a container for one or more Pitch blocks.")+" "+_("The Note block specifies the duration (note value) of its contents."),"documentation",null,"note1"]),e.formBlock({name:_("note"),args:1,argLabels:["ja"===e.lang?_("value2"):_("value")],defaults:[.25],canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"newnote",e,t,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:"sol"}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(n,e,r,l,u){var t,o;if(void 0!==n[1])return null===n[0]||"number"!=typeof n[0]?a.errorMsg(NOINPUTERRORMSG,l):n[0]<=0&&a.errorMsg(_("Note value must be greater than 0."),l),t=null===n[0]||"number"!=typeof n[0]?.25:Math.abs(n[0]),0<(o=a.turtles.ithTurtle(r)).singer.inNoteBlock.length&&o.singer.delayedNotes.push([l,t]),Singer.RhythmActions.playNote(t,"newnote",r,l,function(){var e=a.turtles.ithTurtle(r),t=new Queue(n[1],1,l,u);e.parentFlowQueue.push(l),e.queue.push(t)}),[n[1],1]}}])})(),P=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["definefrequency"])).setPalette("rhythm",a),e.setHelpString(),e.formBlock({name:_("define frequency"),args:1}),e.hidden=!0,e}return _inherits(t,FlowClampBlock),_createClass(t)})(),M=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["octavespace",_("octave space")])).setPalette("rhythm",a),e.setHelpString(),e.formBlock({args:1}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t)})();(new e).setup(a),(new t).setup(a),(new n).setup(a),(new r).setup(a),(new l).setup(a),(new u).setup(a),(new o).setup(a),(new i).setup(a),(new s).setup(a),(new c).setup(a),(new p).setup(a),(new h).setup(a),(new f).setup(a),(new v).setup(a),(new d).setup(a),(new k).setup(a),(new g).setup(a),(new y).setup(a),(new b).setup(a),(new w).setup(a),(new C).setup(a),(new S).setup(a),(new P).setup(a),(new M).setup(a)}"undefined"!=typeof module&&module.exports&&(module.exports={setupRhythmBlocks:setupRhythmBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,l,u,s=[],a=!0,i=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;a=!1}else for(;!(a=(n=l.call(r)).done)&&(s.push(n.value),s.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{if(!a&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(i)throw o}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupSensorsBlocks(s){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["input"])).setPalette("sensors",s),e.parameter=!0,e.setHelpString([_("The Input block prompts for keyboard input."),"documentation",""]),e.formBlock({name:_("input"),args:1,argTypes:["anyin"],defaults:[_("Input a value")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,r,n,t){s.turtles.ithTurtle(n).doWait(120),docById("labelDiv").innerHTML='<input id="textLabel" style="position: absolute; -webkit-user-select: text;-moz-user-select: text;-ms-user-select: text;" class="input" type="text" value="" />';var o=docById("textLabel"),t=s.blocks.blockList[t].connections[1];null!==t&&(o.placeholder=s.blocks.blockList[t].value),o.style.left=s.turtles.getTurtle(n).container.x+"px",o.style.top=s.turtles.getTurtle(n).container.y+"px",o.focus(),docById("labelDiv").classList.add("hasKeyboard"),docById("textLabel").addEventListener("keypress",function(e){var t;13===e.keyCode&&(t=(e=docById("textLabel")).value,isNaN(t)?r.inputValues[n]=t:r.inputValues[n]=Number(t),e.blur(),e.style.display="none",r.clearTurtleRun(n),docById("labelDiv").classList.remove("hasKeyboard"))})}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["inputvalue",_("input value")])).setPalette("sensors",s),e.parameter=!0,e.setHelpString([_("The Input-value block stores the input."),"documentation",null,"input"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t){return t in e.inputValues?e.inputValues[t]:0}},{key:"arg",value:function(e,t,r){return t in e.inputValues?e.inputValues[t]:(s.errorMsg(NOINPUTERRORMSG,r),0)}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pitchness",_("pitch")])).setPalette("sensors",s),e.parameter=!0,e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(s.blocks.blockList[r].value)}},{key:"arg",value:function(e){if(null===e.mic)return 440;null===e.pitchAnalyser&&(e.pitchAnalyser=new Tone.Analyser({type:"fft",size:e.limit,smoothing:0}),e.mic.connect(e.pitchAnalyser));for(var t=e.pitchAnalyser.getValue(),r=1/0,n=0,o=0;o<e.limit;o++){var l=-t[o];l<r&&(r=l,n=o)}return n/(e.pitchAnalyser.sampleTime*e.limit*2)}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["loudness",_("loudness")])).setPalette("sensors",s),e.parameter=!0,e.beginnerBlock(!("ja"===e.lang)),e.setHelpString([_("The Loudness block returns the volume detected by the microphone."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(s.blocks.blockList[r].value)}},{key:"arg",value:function(e){if(null===e.mic)return 0;null===e.volumeAnalyser&&(e.volumeAnalyser=new Tone.Analyser({type:"waveform",size:e.limit}),e.mic.connect(e.volumeAnalyser));for(var t=e.volumeAnalyser.getValue(),r=0,n=0;n<e.limit;n++)r+=t[n]*t[n];var o=Math.sqrt(r/e.limit);return Math.round(100*o)}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["myclick",_("click")])).setPalette("sensors",s),e.beginnerBlock(!0),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Click block triggers an event if a mouse has been clicked."),"documentation",null,"clickhelp"]):e.setHelpString([_("The Click block triggers an event if a turtle has been clicked."),"documentation",null,"clickhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t){return"click"+s.turtles.getTurtle(t).id}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mycursorover",_("cursor over")])).setPalette("sensors",s),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Cursor over block triggers an event when the cursor is moved over a mouse."),"documentation",null,"cursoroverhelp"]):e.setHelpString([_("The Cursor over block triggers an event when the cursor is moved over a turtle."),"documentation",null,"cursoroverhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t){return"CursorOver"+s.turtles.getTurtle(t).id}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mycursorout",_("cursor out")])).setPalette("sensors",s),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Cursor out block triggers an event when the cursor is moved off of a mouse."),"documentation",null,"cursorouthelp"]):e.setHelpString([_("The Cursor out block triggers an event when the cursor is moved off of a turtle."),"documentation",null,"cursorouthelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t){return"CursorOut"+s.turtles.getTurtle(t).id}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mycursordown",_("cursor button down")])).setPalette("sensors",s),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Cursor button down block triggers an event when the cursor button is pressed on a mouse."),"documentation",null,"cursordownhelp"]):e.setHelpString([_("The Cursor button down block triggers an event when the cursor button is pressed on a turtle."),"documentation",null,"cursordownhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t){return"CursorDown"+s.turtles.getTurtle(t).id}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mycursorup",_("cursor button up")])).setPalette("sensors",s),_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Cursor button up block triggers an event when the cursor button is released while over a mouse."),"documentation",null,"cursoruphelp"]):e.setHelpString([_("The Cursor button up block triggers an event when the cursor button is released while over a turtle."),"documentation",null,"cursoruphelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t){return"CursorUp"+s.turtles.getTurtle(t).id}}])})(),c=(()=>{function l(e,t,r,n,o){return _classCallCheck(this,l),(e=_callSuper(this,l,[e,t])).colorIndex=r,e.setPalette("sensors",s),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([n,"documentation",""]):e.setHelpString([o,"documentation",""]),e}return _inherits(l,ValueBlock),_createClass(l,[{key:"updateParameter",value:function(e,t,r){return toFixed2(s.blocks.blockList[r].value)}},{key:"arg",value:function(e,t){t=s.turtles.getTurtle(t).painter.canvasColor,t=(t=t.includes("#")?hex2rgb(t.split("#")[1]):t).split("(")[1].split(","),t=Number(t[this.colorIndex]);return parseInt(t/2.55)}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["getcolorpixel",_("pixel color")])).setPalette("sensors",s),e.parameter=!0,_THIS_IS_MUSIC_BLOCKS_?e.setHelpString([_("The Get pixel block returns the color of the pixel under the mouse."),"documentation",""]):e.setHelpString([_("The Get pixel block returns the color of the pixel under the turtle."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return toFixed2(s.blocks.blockList[r].value)}},{key:"arg",value:function(e,t){var r;try{r=s.turtles.getTurtle(t)}catch(e){return this.getFallbackColor()}if(!r.container)return this.getFallbackColor();var t=r.container,n=t.x,t=t.y,o=r.container.visible;try{r.container.visible=!1,s.refreshCanvas();var l=this.getPixelData(n,t),u=this.detectColor(l);return r.container.visible=o,u}catch(e){return r.container.visible=o,this.getFallbackColor()}}},{key:"getPixelData",value:function(e,t){var r=docById("overlayCanvas"),r=null==r?void 0:r.getContext("2d");if(r)return r.getImageData(Math.floor(e),Math.floor(t),1,1).data;throw new Error("Canvas context unavailable")}},{key:"detectColor",value:function(e){if(4!==e.length)throw new Error("Invalid pixel data");var e=_slicedToArray(e,4),t=e[0],r=e[1],n=e[2];return 0===e[3]?this.getBackgroundColor():searchColors(t,r,n)}},{key:"getBackgroundColor",value:function(){var e=_slicedToArray(platformColor.background.match(/\(([^)]+)\)/)[1].split(/,\s*/).map(Number),3),t=e[0];return searchColors(t,e[1],e[2])}},{key:"getFallbackColor",value:function(){return searchColors(128,128,128)}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["time",_("time")])).setPalette("sensors",s),e.parameter=!0,e.beginnerBlock(!("ja"===e.lang)),e.setHelpString([_("The Time block returns the number of seconds that the program has been running."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e){return((new Date).getTime()-e.time)/1e3}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mousey",_("cursor y")])).setPalette("sensors",s),e.beginnerBlock(!0),e.parameter=!0,e.setHelpString([_("The Cursor Y block returns the vertical position of the mouse."),"documentation",null,"mousebuttonhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(){return s.getStageY()}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mousex",_("cursor x")])).setPalette("sensors",s),e.beginnerBlock(!0),e.parameter=!0,e.setHelpString([_("The Cursor X block returns the horizontal position of the mouse."),"documentation",null,"mousebuttonhelp"]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(){return s.getStageX()}}])})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mousebutton",_("mouse button")])).setHelpString([_("The Mouse-button block returns True if the mouse button is pressed."),"documentation",null,"mousebuttonhelp"]),e.setPalette("sensors",s),e.beginnerBlock(!0),e.parameter=!0,e.extraWidth=20,e}return _inherits(t,BooleanSensorBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value?_("true"):_("false")}},{key:"arg",value:function(){return s.getStageMouseDown()}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["toascii",_("to ASCII")])).setPalette("sensors",s),e.parameter=!0,e.setHelpString([_("The To ASCII block converts numbers to letters."),"documentation",""]),e.formBlock({args:1,defaults:[65]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e,t,r,n){var o;if(!e.inStatusMatrix||"print"!==s.blocks.blockList[s.blocks.blockList[r].connections[0]].name)return null===(o=s.blocks.blockList[r].connections[1])?(s.errorMsg(NOINPUTERRORMSG,r),"A"):"number"==typeof(t=e.parseArg(e,t,o,r,n))?t<1?0:String.fromCharCode(t):(s.errorMsg(NANERRORMSG,r),0);e.statusFields.push([r,"toascii"])}}])})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["keyboard",_("keyboard")])).setPalette("sensors",s),e.parameter=!0,e.setHelpString([_("The Keyboard block returns computer keyboard input."),"documentation",""]),e.makeMacro(function(e,t){return[[0,"toascii",e,t,[null,1]],[1,"keyboard",0,0,[0,null]]]}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,r){return s.blocks.blockList[r].value}},{key:"arg",value:function(e){e.lastKeyCode=s.getCurrentKeyCode();e=e.lastKeyCode;return s.clearCurrentKeyCode(),e}}])})();[{name:"getred",label:_("red"),index:0,helpMouse:_("The Get red block returns the red component of the pixel under the mouse."),helpTurtle:_("The Get red block returns the red component of the pixel under the turtle.")},{name:"getgreen",label:_("green"),index:1,helpMouse:_("The Get green block returns the green component of the pixel under the mouse."),helpTurtle:_("The Get green block returns the green component of the pixel under the turtle.")},{name:"getblue",label:_("blue"),index:2,helpMouse:_("The Get blue block returns the blue component of the pixel under the mouse."),helpTurtle:_("The Get blue block returns the blue component of the pixel under the turtle.")}].forEach(function(e){new c(e.name,e.label,e.index,e.helpMouse,e.helpTurtle).setup(s)}),(new p).setup(s),(new d).setup(s),(new m).setup(s),(new t).setup(s),(new e).setup(s),(new h).setup(s),(new r).setup(s),(new n).setup(s),(new u).setup(s),(new l).setup(s),(new i).setup(s),(new a).setup(s),(new o).setup(s),(new y).setup(s),(new f).setup(s),(new b).setup(s)}"undefined"!=typeof module&&module.exports&&(module.exports={setupSensorsBlocks:setupSensorsBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupToneBlocks(a){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["oscillator",_("Oscillator").toLowerCase()])).setPalette("tone",a),e.setHelpString(),e.formBlock({args:2,defaults:[_("triangle"),6],argLabels:[_("type"),_("partials")],argTypes:["anyin","numberin"]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var s=DEFAULTOSCILLATORTYPE,l=0;if(2===e.length&&"number"==typeof e[1]){for(var o in OSCTYPES)OSCTYPES[o][0]===e[0]?s=OSCTYPES[o][1]:OSCTYPES[o][1]===e[0]&&(s=e[0]);l=e[1]}t.inTimbre&&(0!=t.timbre.osc.length?a.errorMsg(_("You are adding multiple oscillator blocks.")):(t.timbre.oscParams=[],t.synth.createSynth(n,t.timbre.instrumentName,s,t.timbre.synthVals)),t.timbre.osc.push(r),t.timbre.oscParams.push(s),t.timbre.oscParams.push(l))}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["filtertype"])).setPalette("tone",a),e.setHelpString(),e.formBlock({outType:"textout"}),e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t)})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["oscillatortype"])).setPalette("tone",a),e.setHelpString(),e.formBlock({outType:"textout"}),e.hidden=!0,e}return _inherits(t,ValueBlock),_createClass(t)})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["duosynth",_("duo synth")])).setPalette("tone",a),e.piemenuValuesC1=[10,20,30,40,50,60,70,80,90,100],e.piemenuValuesC2=[10,20,30,40,50,60,70,80,90,100],e.setHelpString([_("The Duo synth block is a duo-frequency modulator used to define a timbre."),"documentation",null,"duosynthhelp"]),e.formBlock({args:2,defaults:[10,5],argLabels:[_("vibrato rate"),_("vibrato intensity")]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){Singer.ToneActions.defDuoSynth(e[0],e[1],n,r)}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["amsynth",_("AM synth")])).setPalette("tone",a),e.piemenuValuesC1=[1,2],e.setHelpString([_("The AM synth block is an amplitude modulator used to define a timbre."),"documentation",null,"amsynthhelp"]),e.formBlock({args:1,defaults:[1]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){Singer.ToneActions.defAMSynth(e[0],n,r)}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["fmsynth",_("FM synth")])).setPalette("tone",a),e.piemenuValuesC1=[1,5,10,15,20,25],e.setHelpString([_("The FM synth block is a frequency modulator used to define a timbre."),"documentation",null,"fmsynthhelp"]),e.formBlock({args:1,defaults:[10]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){Singer.ToneActions.defFMSynth(e[0],n,r)}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["partial",_("partial")])).setPalette("tone",a),e.setHelpString([_("The Partial block is used to specify a weight for a specific partial harmonic."),"documentation",""]),e.formBlock({args:1,defaults:[10]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n){"number"!=typeof e[0]||1<e[0]||e[0]<0?(a.errorMsg(_("Partial weight must be between 0 and 1.")),t.stopTurtle=!0):0<(t=a.turtles.ithTurtle(n)).singer.inHarmonic.length?(n=t.singer.inHarmonic.length-1,t.singer.partials[n].push(e[0])):a.errorMsg(_("Partial block should be used inside of a Weighted-partials block."))}}])})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["harmonic"])).setPalette("tone",a),e.setHelpString([_("The Weighted partials block is used to specify the partials associated with a timbre."),"documentation",""]),e.formBlock({name:_("weighted partials")}),e.makeMacro(function(e,t){return[[0,"harmonic",e,t,[null,2,1]],[1,"hidden",0,0,[0,null]],[2,"partial",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,"partial",0,0,[2,5,6]],[5,["number",{value:.2}],0,0,[4]],[6,"partial",0,0,[4,7,null]],[7,["number",{value:.01}],0,0,[6]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var s=a.turtles.ithTurtle(n),l=(s.singer.inHarmonic.push(r),s.singer.partials.push([]),"_harmonic_"+n+"_"+r);t.setDispatchBlock(r,n,l);return t.setTurtleListener(n,l,function(e){s.singer.inHarmonic.pop(),s.singer.partials.pop()}),[e[0],1]}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["harmonic2"])).piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10,11],e.setPalette("tone",a),e.setHelpString([_("The Harmonic block will add harmonics to the contained notes."),"documentation",null,"harmonichelp"]),e.formBlock({name:_("harmonic"),args:1,defaults:[1]}),e.makeMacro(function(e,t){return[[0,"harmonic2",e,t,[null,2,null,1]],[1,"hidden",0,0,[0,null]],[2,["number",{value:1}],0,0,[0]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){return Singer.ToneActions.doHarmonic(e[0],n,r),[e[1],1]}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["dis"])).setPalette("tone",a),e.piemenuValuesC1=[10,20,30,40,50,60,70,80,90,100],e.setHelpString([_("The Distortion block adds distortion to the pitch."),"documentation",null,"dishelp"]),e.formBlock({name:_("distortion"),args:1,defaults:[40]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){Singer.ToneActions.doDistortion(e[0],n,r);var s=a.turtles.ithTurtle(n);return t.inTimbre&&(instrumentsEffects[n][t.timbre.instrumentName].distortionActive=!0,t.timbre.distortionEffect.push(r),t.timbre.distortionParams.push(100*last(s.singer.distortionAmount)),instrumentsEffects[n][t.timbre.instrumentName].distortionAmount=e[0]),[e[1],1]}}])})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["tremolo"])).setPalette("tone",a),e.piemenuValuesC1=[.5,1,1.5,2,2.5,3,3.5,4,4.5,5,10,20],e.piemenuValuesC2=[0,10,20,30,40,50,60,70,80,90,100],e.beginnerBlock(!0),e.setHelpString([_("The Tremolo block adds a wavering effect.")+" "+_("Tremolo makes the sound pulse louder and quieter.")+" "+_("The rate controls how fast the sound pulses.")+" "+_("The depth controls the strength of the pulsing effect."),"documentation",null,"tremolohelp"]),e.formBlock({name:_("tremolo"),args:2,defaults:[10,50],argLabels:[_("rate"),_("depth")]}),e.makeMacro(function(e,t){return[[0,"tremolo",e,t,[null,1,2,null,3]],[1,["number",{value:10}],0,0,[0]],[2,["number",{value:50}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){Singer.ToneActions.doTremolo(e[0],e[1],n,r);var s=a.turtles.ithTurtle(n);return t.inTimbre&&(instrumentsEffects[n][t.timbre.instrumentName].tremoloActive=!0,t.timbre.tremoloEffect.push(r),t.timbre.tremoloParams.push(last(s.singer.tremoloFrequency)),instrumentsEffects[n][t.timbre.instrumentName].tremoloFrequency=e[0],t.timbre.tremoloParams.push(100*last(s.singer.tremoloDepth)),instrumentsEffects[n][t.timbre.instrumentName].tremoloDepth=e[1]),[e[2],1]}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["phaser"])).setPalette("tone",a),e.piemenuValuesC1=[.5,1,1.5,2,2.5,3,3.5,4,4.5,5,10,20],e.piemenuValuesC2=[1,2,3],e.piemenuValuesC3=[220,247,262,294,330,349,392,440,494,523,587,659,698,783,880],e.setHelpString([_("The Phaser block adds a sweeping sound."),"documentation",null,"phaserhelp"]),e.formBlock({name:_("phaser"),args:3,defaults:[.5,3,392],argLabels:[_("rate"),_("octaves"),_("base frequency")]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){Singer.ToneActions.doPhaser(e[0],e[1],e[2],n,r);var s=a.turtles.ithTurtle(n);return t.inTimbre&&(instrumentsEffects[n][t.timbre.instrumentName].phaserActive=!0,t.timbre.phaserEffect.push(r),t.timbre.phaserParams.push(last(s.singer.rate)),instrumentsEffects[n][t.timbre.instrumentName].rate=e[0],t.timbre.phaserParams.push(last(s.singer.octaves)),instrumentsEffects[n][t.timbre.instrumentName].octaves=e[1],t.timbre.phaserParams.push(last(s.singer.baseFrequency)),instrumentsEffects[n][t.timbre.instrumentName].baseFrequency=e[2]),[e[3],1]}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["chorus"])).setPalette("tone",a),e.piemenuValuesC1=[.5,1,1.5,2,2.5,3,3.5,4,4.5,5],e.piemenuValuesC2=[2,2.5,3,3.5,4,4.5,5,6,7,8,9,10],e.piemenuValuesC3=[0,10,20,30,40,50,60,70,80,90,100],e.beginnerBlock(!0),e.setHelpString([_("The Chorus block adds a chorus effect."),"documentation",null,"chorushelp"]),e.formBlock({name:_("chorus"),args:3,defaults:[1.5,3.5,70],argLabels:[_("rate"),_("delay (MS)"),_("depth")]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){Singer.ToneActions.doChorus(e[0],e[1],e[2],n,r);var s=a.turtles.ithTurtle(n);return t.inTimbre&&(instrumentsEffects[n][t.timbre.instrumentName].chorusActive=!0,t.timbre.chorusEffect.push(r),t.timbre.chorusParams.push(last(s.singer.chorusRate)),instrumentsEffects[n][t.timbre.instrumentName].chorusRate=e[0],t.timbre.chorusParams.push(last(s.singer.delayTime)),instrumentsEffects[n][t.timbre.instrumentName].delayTime=e[1],t.timbre.chorusParams.push(100*last(s.singer.chorusDepth)),instrumentsEffects[n][t.timbre.instrumentName].chorusDepth=e[2]),[e[3],1]}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["vibrato"])).setPalette("tone",a),e.piemenuValuesC1=[1,2,3,4,5,6,7,8,9,10],e.beginnerBlock(!0),e.setHelpString([_("The Vibrato block adds a rapid, slight variation in pitch."),"documentation",null,"vibratohelp"]),e.formBlock({name:_("vibrato"),args:2,defaults:[5,1/16],argLabels:[_("intensity"),_("rate")]}),e.makeMacro(function(e,t){return[[0,"vibrato",e,t,[null,1,3,2,6]],[1,["number",{value:5}],0,0,[0]],[2,"vspace",0,0,[0,null]],[3,"divide",0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:16}],0,0,[3]],[6,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){return Singer.ToneActions.doVibrato(e[0],e[1],n,r),[e[2],1]}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setvoice"])).setPalette("tone",a),e.setHelpString(),e.formBlock({name:_("set synth"),args:1,argTypes:["textin"],defaults:["violin"]}),e.makeMacro(function(e,t){return[[0,"setvoice",e,t,[null,1,null,2]],[1,["voicename",{value:"violin"}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e.hidden=e.deprecated=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){var s,l=null;for(s in VOICENAMES)VOICENAMES[s][0]===e[0]?l=VOICENAMES[s][1]:VOICENAMES[s][1]===e[0]&&(l=e[0]);if(null===l)for(var o in DRUMNAMES)DRUMNAMES[o][0]===e[0]?l=DRUMNAMES[o][1]:DRUMNAMES[o][1]===e[0]&&(l=e[0]);var i=a.turtles.ithTurtle(n);return null===l?a.errorMsg(NOINPUTERRORMSG,r):(i.singer.voices.push(l),t.setDispatchBlock(r,n,r="_setvoice_"+n),t.setTurtleListener(n,r,function(e){return i.singer.voices.pop()})),[e[1],1]}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["synthname",_("synth name")])).setPalette("tone",a),e.setHelpString(),e.formBlock({outType:"textout"}),e.hidden=e.deprecated=!0,e}return _inherits(t,ValueBlock),_createClass(t,[{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==a.blocks.blockList[a.blocks.blockList[n].connections[0]].name)return last(a.turtles.ithTurtle(t).singer.instrumentNames);e.statusFields.push([n,"synthname"])}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setdefaultinstrument",_("set default instrument")])).setPalette("tone",a),e.setHelpString([_("The set default instrument block changes the default instrument from electronic synth to the instrument of your choice."),"documentation",""]),e.makeMacro(function(e,t){return[[0,"setdefaultinstrument",e,t,[null,1,null]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]]]}),e.formBlock({args:1,argTypes:["anyin"],defaults:[DEFAULTVOICE]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){n=a.turtles.ithTurtle(n);null===e[0]?a.errorMsg(NOINPUTERRORMSG,r):0===n.singer.instrumentNames.length?n.singer.instrumentNames=[e[0]]:n.singer.instrumentNames[0]=e[0]}}])})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["voicename",_("set instrument")])).setPalette("tone",a),e.setHelpString([_("The Set instrument block selects a voice for the synthesizer,")+" "+_("eg guitar piano violin or cello."),"documentation",""]),e.formBlock({outType:"textout"}),e.extraWidth=50,e}return _inherits(t,ValueBlock),_createClass(t)})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["settimbre"])).setPalette("tone",a),e.beginnerBlock(!0),a.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Set instrument block selects a voice for the synthesizer,"),"documentation",""]):e.setHelpString([_("The Set instrument block selects a voice for the synthesizer,")+" "+_("eg guitar piano violin or cello."),"documentation",null,"settimbrehelp"]),e.formBlock({name:_("set instrument"),args:1,argTypes:["anyin"],defaults:[_("custom")]}),e.makeMacro(function(e,t){return[[0,"settimbre",e,t,[null,1,null,2]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,r){return null===e[0]?a.errorMsg(NOINPUTERRORMSG,r):(t.inRhythmRuler?(t._currentDrumBlock=r,t.rhythmRuler.Drums.push(r),t.rhythmRuler.Rulers.push([[],[]])):t.inSample&&(t.sample.timbreBlock=r,"object"===_typeof(e[0])?(t.sample.timbreBlock=r,t.sample.sampleName=e[0][0],t.sample.sampleData=e[0][1],2<e[0].length?(t.sample.samplePitch=e[0][2],t.sample.sampleOctave=e[0][3]):(t.sample.samplePitch="la",t.sample.sampleOctave=4)):(t.sample.sampleName="",t.sample.sampleData="",t.sample.samplePitch="la",t.sample.sampleOctave=4)),Singer.ToneActions.setTimbre(e[0],n,r)),[e[1],1]}}])})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["customsample",_("sample")])).setPalette("tone",a),e.beginnerBlock(!1),e.setHelpString([_("Import a sound file to use as an instrument and set its pitch center."),"documentation",null,"turtleshell"]),e.formBlock({outType:"textout",args:3,argTypes:["anyin","anyin","anyin"],argLabels:[_("file"),_("name"),_("octave")]}),e.parameter=!0,e.makeMacro(function(e,t){return[[0,["customsample",{value:["","","do",4]}],e,t,[null,1,2,3]],[1,["audiofile",{value:null}],0,0,[0]],[2,["solfege",{value:"do"}],0,0,[0]],[3,["number",{value:4}],0,0,[0]]]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return a.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){var r,s;if(!e.inStatusMatrix||"print"!==a.blocks.blockList[a.blocks.blockList[n].connections[0]].name)return null===a.blocks.blockList[n].value&&(a.blocks.blockList[n].value=["","","do",4]),null!=(s=a.blocks.blockList[n].connections[1])&&null!==a.blocks.blockList[s].value&&(r=a.blocks.blockList[s].value[0],s=a.blocks.blockList[s].value[1],a.blocks.blockList[n].value[0]=r,a.blocks.blockList[n].value[1]=s),null!=(r=a.blocks.blockList[n].connections[2])&&(s=a.blocks.blockList[r].value,a.blocks.blockList[n].value[2]=s),null!=(r=a.blocks.blockList[n].connections[3])&&(s=a.blocks.blockList[r].value,a.blocks.blockList[n].value[3]=s),a.blocks.blockList[n].value;e.statusFields.push([n,"customsample"])}}])})(),C=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["audiofile",""])).parameter=!0,e.extraWidth=20,e.setPalette("tone",a),e.hidden=!0,e.beginnerBlock(!1),e.setHelpString([_("Upload a sound file to connect with the sample block."),"documentation",""]),e.formBlock({outType:"textout"}),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return a.blocks.updateBlockText(n),a.blocks.blockList[n].value}}])})();(new e).setup(a),(new t).setup(a),(new n).setup(a),(new r).setup(a),(new s).setup(a),(new l).setup(a),(new o).setup(a),(new i).setup(a),(new u).setup(a),(new c).setup(a),(new m).setup(a),(new p).setup(a),(new h).setup(a),(new f).setup(a),(new C).setup(a),(new g).setup(a),(new k).setup(a),(new b).setup(a),(new d).setup(a),(new y).setup(a),(new v).setup(a)}"undefined"!=typeof module&&module.exports&&(module.exports={setupToneBlocks:setupToneBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupVolumeBlocks(c){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["synthvolumefactor",_("synth volume")])).setPalette("volume",c),e.parameter=!0,e.setHelpString([_("The Synth volume block returns the current volume of the current synthesizer."),"documentation",""]),e.formBlock({args:1,argTypes:["anyin"],defaults:[_("piano")]}),e.makeMacro(function(e,t){return[[0,"synthvolumefactor",e,t,[null,1]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]]]}),e}return _inherits(t,LeftBlock),_createClass(t,[{key:"updateParameter",value:function(e,t,n){return c.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n,l){var r;if(!e.inStatusMatrix||"print"!==c.blocks.blockList[c.blocks.blockList[n].connections[0]].name)return null!==(r=c.blocks.blockList[n].connections[1])?(r=e.parseArg(e,t,r,n,l),Singer.VolumeActions.getSynthVolume(r,t)):0;e.statusFields.push([n,"synth volume"])}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["notevolumefactor",_("master volume")])).setPalette("volume",c),e.parameter=!0,e.setHelpString([_("The Master volume block returns the master volume."),"documentation",""]),e}return _inherits(t,ValueBlock),_createClass(t,[{key:"setter",value:function(e,t,n){var l=Singer.masterVolume.length;Singer.masterVolume[l-1]=t,c.turtles.ithTurtle(n).singer.suppressOutput||Singer.VolumeActions.setMasterVolume(e,t)}},{key:"updateParameter",value:function(e,t,n){return c.blocks.blockList[n].value}},{key:"arg",value:function(e,t,n){if(!e.inStatusMatrix||"print"!==c.blocks.blockList[c.blocks.blockList[n].connections[0]].name)return Singer.VolumeActions.masterVolume;e.statusFields.push([n,"volume"])}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["ppp","ppp"])).setPalette("volume",c),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:10}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pp","pp"])).setPalette("volume",c),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:20}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["p","p"])).setPalette("volume",c),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:30}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mp","mp"])).setPalette("volume",c),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:40}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["mf","mf"])).setPalette("volume",c),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:50}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["f","f"])).setPalette("volume",c),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:60}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),i=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["ff","ff"])).setPalette("volume",c),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:80}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["fff","fff"])).setPalette("volume",c),e.setHelpString(),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:100}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),m=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setsynthvolume2",_("set synth volume")])).setPalette("volume",c),e.setHelpString(),e.formBlock({args:2,defaults:[DEFAULTVOICE,50],argTypes:["textin","numberin"],argLabels:[_("synth"),_("volume")]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){if(void 0!==e[2]){var r=null===e[0]||"string"!=typeof e[0]?(c.errorMsg(NOINPUTERRORMSG,l),DEFAULTVOICE):e[0],o=(null===e[1]||"number"!=typeof e[1]?(c.errorMsg(NOINPUTERRORMSG,l),a=50):0===(a=e[1]<0?0:100<e[1]?100:e[1])&&c.errorMsg(_("Setting volume to 0."),l),null);if(r===DEFAULTVOICE||r===_(DEFAULTVOICE)?o=DEFAULTVOICE:"custom"!==r&&e[0]!==_("custom")||(o="custom"),null===o)for(var u in VOICENAMES){if(VOICENAMES[u][0]===r){o=VOICENAMES[u][1];break}if(VOICENAMES[u][1]===r){o=r;break}}if(null===o)for(var s in DRUMNAMES){if(DRUMNAMES[s][0].replace("-"," ")===r){o=DRUMNAMES[s][1];break}if(DRUMNAMES[s][1].replace("-"," ")===r){o=r;break}}null===o&&(c.errorMsg(_("Synth not found"),l),o=DEFAULTVOICE);var i=c.turtles.ithTurtle(n),a=(i.singer.instrumentNames.includes(o)||(i.singer.instrumentNames.push(o),t.synth.loadSynth(n,o),void 0===i.singer.synthVolume[o]&&(i.singer.synthVolume[o]=[DEFAULTVOLUME],i.singer.crescendoInitialVolume[o]=[DEFAULTVOLUME])),i.singer.synthVolume[o].push(a),i.singer.suppressOutput||Singer.setSynthVolume(t,n,o,a),"_synthvolume_"+n);t.setDispatchBlock(l,n,a);return t.setTurtleListener(n,a,function(e){i.singer.synthVolume[o].pop(),0===i.singer.justCounting.length&&0<i.singer.synthVolume[o].length&&Singer.setSynthVolume(t,n,o,last(i.singer.synthVolume[o]))}),[e[2],1]}}}])})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setdrumvolume",_("set drum volume")])).setPalette("volume",c),e.beginnerBlock(!0),e.formBlock({args:2,defaults:[DEFAULTDRUM,50],argTypes:["textin","numberin"],argLabels:[_("drum"),_("volume")]}),e.makeMacro(function(e,t){return[[0,"setsynthvolume",e,t,[null,1,2,null]],[1,["drumname",{value:DEFAULTDRUM}],0,0,[0]],[2,["number",{value:50}],0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setsynthvolume",_("set synth volume")])).setPalette("volume",c),e.piemenuValuesC2=[0,10,20,30,40,50,60,70,80,90,100],e.beginnerBlock(!0),e.setHelpString([_("The Set synth volume block will change the volume of a particular synth,")+" "+_("eg guitar violin snare drum etc.")+" "+_("The default volume is 50.")+" "+_("The range is 0 for silence to 100 for full volume."),"documentation",""]),e.formBlock({args:2,defaults:[DEFAULTVOICE,50],argTypes:["textin","numberin"],argLabels:[_("synth"),_("volume")]}),e.makeMacro(function(e,t){return[[0,"setsynthvolume",e,t,[null,1,2,null]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:50}],0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r,o=e[0];null!==o&&"string"==typeof o||(c.errorMsg(NOINPUTERRORMSG,l),o=DEFAULTVOICE),null===e[1]||"number"!=typeof e[1]?(c.errorMsg(NOINPUTERRORMSG,l),r=50):0===(r=Math.max(Math.min(e[1],100),0))&&c.errorMsg(_("Setting volume to 0."),l),Singer.VolumeActions.setSynthVolume(o,r,n,l)}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setpanning",_("set panning")])).setPalette("volume",c),e.piemenuValuesC1=[100,80,60,40,20,0,-20,-40,-60,-80,-100],e.beginnerBlock(!0),e.setHelpString([_("The Set Panning block sets the panning for all synthesizers."),"documentation",""]),e.formBlock({args:1,defaults:[0]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){1===e.length&&("number"!=typeof e[0]?c.errorMsg(NANERRORMSG,l):(100!==e[0]&&-100!==e[0]||c.errorMsg(_("Warning: Sound is coming out from only the left or right side."),l),Singer.VolumeActions.setPanning(e[0],n)))}}])})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setnotevolume",_("set master volume")])).setPalette("volume",c),e.piemenuValuesC1=[0,10,20,30,40,50,60,70,80,90,100],e.beginnerBlock(!0),e.setHelpString([_("The Set master volume block sets the volume for all synthesizers."),"documentation",""]),e.formBlock({args:1,defaults:[50]}),e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){1===e.length&&("number"!=typeof e[0]?c.errorMsg(NANERRORMSG,l):Singer.VolumeActions.setMasterVolume(e[0],n,l))}}])})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["setnotevolume2"])).setPalette("volume",c),e.setHelpString(),e.formBlock({name:_("set master volume"),args:1,defaults:[50]}),e.makeMacro(function(e,t){return[[0,"setsynthvolume2",e,t,[null,1,2,null,3]],[1,["voicename",{value:DEFAULTVOICE}],0,0,[0]],[2,["number",{value:50}],0,0,[0]],[3,"hidden",0,0,[0,null]]]}),e.hidden=!0,e.deprecated=!0,e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r,o;if(void 0!==e[1])return null===e[0]||"number"!=typeof e[0]?(c.errorMsg(NOINPUTERRORMSG,l),o=50):0===(o=e[0]<0?0:100<e[0]?100:e[0])&&c.errorMsg(_("Setting volume to 0."),l),r=c.turtles.ithTurtle(n),Singer.masterVolume.push(o),r.singer.suppressOutput||Singer.setMasterVolume(t,o),t.setDispatchBlock(l,n,o="_volume_"+n),t.setTurtleListener(n,o,function(e){Singer.masterVolume.pop(),0===r.singer.justCounting.length&&0<Singer.masterVolume.length&&Singer.setMasterVolume(t,last(Singer.masterVolume))}),[e[1],1]}}])})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["articulation"])).setPalette("volume",c),e.piemenuValuesC1=[-25,-20,-15,-10,-5,0,5,10,15,20,25],e.setHelpString([_("The Set relative volume block changes the volume of the contained notes."),"documentation",null,"articulationhelp"]),e.formBlock({name:_("set relative volume"),args:1,defaults:[50]}),e.makeMacro(function(e,t){return[[0,"articulation",e,t,[null,1,null,2]],[1,["number",{value:25}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){var r;if(void 0!==e[1])return null!==(r=e[0])&&"number"==typeof r||(c.errorMsg(NOINPUTERRORMSG,l),r=0),Singer.VolumeActions.setRelativeVolume(r,n,l),[e[1],1]}}])})(),d=(()=>{function t(e){return _classCallCheck(this,t),(e=_callSuper(this,t,[e||"decrescendo"])).setPalette("volume",c),e.piemenuValuesC1=[1,2,3,4,5,10,15,20],e.beginnerBlock(!0),e.setHelpString([_("The Decrescendo block will decrease the volume of the contained notes by a specified amount for every note played.")+" "+_("For example if you have 7 notes in sequence contained in a Decrescendo block with a value of 5 the final note will be at 35% less than the starting volume."),"documentation",null,"crescendohelp"]),e.formBlock({name:_("decrescendo"),args:1,defaults:[5]}),e.makeMacro(function(e,t){return[[0,"decrescendo",e,t,[null,1,null,2]],[1,["number",{value:5}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,FlowClampBlock),_createClass(t,[{key:"flow",value:function(e,t,n,l){if(1<e.length&&0!==e[0])return Singer.VolumeActions.doCrescendo(c.blocks.blockList[l].name,e[0],n,l),[e[1],1]}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["crescendo"])).setPalette("volume",c),e.piemenuValuesC1=[1,2,3,4,5,10,15,20],e.beginnerBlock(!0),e.setHelpString([_("The Crescendo block will increase the volume of the contained notes by a specified amount for every note played.")+" "+_("For example if you have 7 notes in sequence contained in a Crescendo block with a value of 5 the final note will be at 35% more than the starting volume."),"documentation",null,"crescendohelp"]),e.formBlock({name:_("crescendo"),args:1,defaults:[5]}),e.makeMacro(function(e,t){return[[0,"crescendo",e,t,[null,1,null,2]],[1,["number",{value:5}],0,0,[0]],[2,"hidden",0,0,[0,null]]]}),e}return _inherits(t,d),_createClass(t)})();(new t).setup(c),(new e).setup(c),(new n).setup(c),(new l).setup(c),(new r).setup(c),(new o).setup(c),(new u).setup(c),(new s).setup(c),(new i).setup(c),(new a).setup(c),(new m).setup(c),(new f).setup(c),(new h).setup(c),(new p).setup(c),(new v).setup(c),(new y).setup(c),(new g).setup(c),(new d).setup(c),(new k).setup(c)}"undefined"!=typeof module&&module.exports&&(module.exports={setupVolumeBlocks:setupVolumeBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var r,n,l,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return l=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){l=!0,r=e},f:function(){try{n||null==i.return||i.return()}finally{if(l)throw r}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function setupWidgetBlocks(m){var e=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["envelope",_("Envelope").toLowerCase()])).setPalette("widgets",m),e.setHelpString(),e.formBlock({args:4,defaults:[1,50,60,1],argLabels:[_("attack"),_("decay"),_("sustain"),_("release")]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var l=m.turtles.ithTurtle(r);4===e.length&&"number"==typeof e[0]&&((e[0]<0||100<e[0])&&m.errorMsg(_("Attack value should be from 0 to 100.")),(e[1]<0||100<e[1])&&m.errorMsg(_("Decay value should be from 0 to 100.")),(e[2]<0||100<e[2])&&m.errorMsg(_("Sustain value should be from 0 to 100.")),(e[3]<0||100<e[3])&&m.errorMsg(_("Release value should be from 0-100.")),l.singer.attack.push(e[0]/100),l.singer.decay.push(e[1]/100),l.singer.sustain.push(e[2]/100),l.singer.release.push(e[3]/100)),t.inTimbre&&(t.timbre.synthVals.envelope.attack=last(l.singer.attack),t.timbre.synthVals.envelope.decay=last(l.singer.decay),t.timbre.synthVals.envelope.sustain=last(l.singer.sustain),t.timbre.synthVals.envelope.release=last(l.singer.release),0!=t.timbre.env.length?m.errorMsg(_("You are adding multiple envelope blocks.")):t.synth.createSynth(r,t.timbre.instrumentName,t.timbre.synthVals.oscillator.source,t.timbre.synthVals),t.timbre.env.push(n),t.timbre.ENVs.push(Math.round(100*last(l.singer.attack))),t.timbre.ENVs.push(Math.round(100*last(l.singer.decay))),t.timbre.ENVs.push(Math.round(100*last(l.singer.sustain))),t.timbre.ENVs.push(Math.round(100*last(l.singer.release))))}}])})(),t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["filter",_("Filter").toLowerCase()])).setPalette("widgets",m),e.setHelpString(),e.formBlock({args:3,defaults:[_("highpass"),-12,392],argLabels:[_("type"),_("rolloff"),_("frequency")],argTypes:["anyin","numberin","numberin"]}),e.hidden=!0,e}return _inherits(t,FlowBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){var l,a,i=DEFAULTFILTERTYPE;if(3===e.length&&"number"==typeof e[1]){for(var s in FILTERTYPES)FILTERTYPES[s][0]===e[0]?i=FILTERTYPES[s][1]:FILTERTYPES[s][1]===e[0]&&(i=e[0]);[-12,-24,-48,-96].includes(e[1])||m.errorMsg(_("Rolloff value should be either -12, -24, -48, or -96 decibels/octave.")),a=e[1],l=e[2],t.inTimbre&&(t.timbre.instrumentName in instrumentsFilters[r]||(instrumentsFilters[r][t.timbre.instrumentName]=[]),instrumentsFilters[r][t.timbre.instrumentName].push({filterType:i,filterRolloff:a,filterFrequency:l}),t.timbre.fil.push(n),t.timbre.filterParams.push(i),t.timbre.filterParams.push(a),t.timbre.filterParams.push(l))}}}])})(),r=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["temperament"])).setPalette("widgets",m),e.setHelpString([_("The Temperament tool is used to define custom tuning."),"documentation",null,"temperament"]),e.formBlock({args:1,name:_("temperament"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"temperament",e,t,[null,1,2,8]],[1,["temperamentname",{value:"equal"}],0,0,[0]],[2,"pitch",0,0,[0,3,4,5]],[3,["notename",{value:"C"}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"setkey2",0,0,[2,6,7,null]],[6,["notename",{value:"C"}],0,0,[5]],[7,["modename",{value:DEFAULTMODE}],0,0,[5]],[8,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.temperament&&(t.temperament=new TemperamentWidget),t.insideTemperament=!0,t.temperament.inTemperament=e[0];var l,a,e=[],i=("pitch"===m.blocks.blockList[m.blocks.blockList[n].connections[2]].name&&(i=m.blocks.blockList[m.blocks.blockList[n].connections[2]],l=m.blocks.blockList[i.connections[1]].value,a=m.blocks.blockList[i.connections[2]].value,i=m.blocks.blockList[i.connections[3]],e[0]=m.blocks.blockList[i.connections[1]].value,e[1]=m.blocks.blockList[i.connections[2]].value,t.synth.startingPitch=l+a,t.temperament.scale=e),"_temperament_"+r);t.setDispatchBlock(n,r,i);t.setTurtleListener(r,i,function(){t.temperament.init(m)})}}])})(),n=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["sampler"])).setPalette("widgets",m),e.parameter=!0,e.beginnerBlock(!1),e.setHelpString([_("Upload a sample and adjust its pitch center."),"documentation",null,"sampler"]),e.formBlock({name:_("sampler"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"sampler",e,t,[null,1,8]],[1,"settimbre",0,0,[0,2,6,7]],[2,["customsample",{value:["","","do",4]}],0,0,[1,3,4,5]],[3,["audiofile",{value:null}],0,0,[2]],[4,["solfege",{value:"do"}],0,0,[2]],[5,["number",{value:4}],0,0,[2]],[6,"vspace",0,0,[1,null]],[7,"hidden",0,0,[1,null]],[8,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.sample&&(t.sample=new SampleWidget),t.inSample=!0,t.sample=new SampleWidget;var l="_sampler_"+r;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(e){t.sample.init(m)}),[e[0],1]}}])})(),l=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["timbre"])).setPalette("widgets",m),e.setHelpString(),e.formBlock({name:_("timbre"),args:1,defaults:[_("custom")],canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"timbre",e,t,[null,1,3,2]],[1,["text",{value:_("custom")}],0,0,[0]],[2,"hiddennoflow",0,0,[0,null]],[3,"newnote",0,0,[0,4,7,11]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"pitch",0,0,[7,9,10,null]],[9,["solfege",{value:"sol"}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"hidden",0,0,[3,12]],[12,"newnote",0,0,[11,13,16,20]],[13,"divide",0,0,[12,14,15]],[14,["number",{value:1}],0,0,[13]],[15,["number",{value:4}],0,0,[13]],[16,"vspace",0,0,[12,17]],[17,"pitch",0,0,[16,18,19,null]],[18,["solfege",{value:"mi"}],0,0,[17]],[19,["number",{value:4}],0,0,[17]],[20,"hidden",0,0,[12,21]],[21,"newnote",0,0,[20,22,25,29]],[22,"divide",0,0,[21,23,24]],[23,["number",{value:1}],0,0,[22]],[24,["number",{value:2}],0,0,[22]],[25,"vspace",0,0,[21,26]],[26,"pitch",0,0,[25,27,28,null]],[27,["solfege",{value:"sol"}],0,0,[26]],[28,["number",{value:4}],0,0,[26]],[29,"hidden",0,0,[21,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.timbre&&(t.timbre=new TimbreWidget),t.inTimbre=!0,"string"==typeof e[0]?t.timbre.instrumentName=e[0]:(t.timbre.instrumentName=DEFAULTVOICE,m.errorMsg(NOINPUTERRORMSG,n)),instrumentsEffects[r][t.timbre.instrumentName]={},instrumentsEffects[r][t.timbre.instrumentName].vibratoActive=!1,instrumentsEffects[r][t.timbre.instrumentName].distortionActive=!1,instrumentsEffects[r][t.timbre.instrumentName].tremoloActive=!1,instrumentsEffects[r][t.timbre.instrumentName].phaserActive=!1,instrumentsEffects[r][t.timbre.instrumentName].chorusActive=!1,instrumentsFilters[r][t.timbre.instrumentName]=[],t.timbre.blockNo=n,t.timbre.env=[],t.timbre.ENVs=[],t.timbre.fil=[],t.timbre.filterParams=[],t.timbre.osc=[],t.timbre.oscParams=[],t.timbre.tremoloEffect=[],t.timbre.tremoloParams=[],t.timbre.vibratoEffect=[],t.timbre.vibratoParams=[],t.timbre.chorusEffect=[],t.timbre.chorusParams=[],t.timbre.phaserEffect=[],t.timbre.phaserParams=[],t.timbre.distortionEffect=[],t.timbre.distortionParams=[],t.timbre.AMSynthesizer=[],t.timbre.AMSynthParams=[],t.timbre.FMSynthesizer=[],t.timbre.FMSynthParams=[],t.timbre.duoSynthesizer=[],t.timbre.duoSynthParams=[],t.timbre.notesToPlay=[];var l="_timbre_"+r;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(){t.timbre.init(m)}),[e[1],1]}}])})(),a=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["meterwidget"])).setPalette("widgets",m),e.setHelpString([_("The Meter block opens a tool to select strong beats for the meter."),"documentation",null,"meterwidget"]),e.formBlock({name:_("meter"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,["meterwidget",{collapsed:!1}],e,t,[null,1,7]],[1,"meter",0,0,[0,2,3,6]],[2,["number",{value:4}],0,0,[1]],[3,"divide",0,0,[1,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"vspace",0,0,[1,null]],[7,"hidden",0,0,[0,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){t.insideMeterWidget=!0;var l="_meterwidget_"+r;t.setDispatchBlock(n,r,l);if(t.setTurtleListener(r,l,function(){t.meterWidget=new MeterWidget(m,n),t.insideMeterWidget=!1}),1===e.length)return[e[0],1]}}])})(),i=(()=>{function t(){var e;_classCallCheck(this,t),(e=_callSuper(this,t,["oscilloscope"])).setPalette("widgets",m),e.setHelpString([_("The oscilloscope block opens a tool to visualize waveforms."),"documentation",null,"oscilloscope"]),e.formBlock({name:_("oscilloscope"),canCollapse:!0});return e.makeMacro(function(e,t){var r,n,l,a,i,s,o=[[0,"oscilloscope",e,t,[null,1,null]]],u=_createForOfIteratorHelper(m.turtles.turtleList);try{for(u.s();!(r=u.n()).done;){var c=r.value;c.inTrash||(n=o,l=c,a=Math.max(0,o.length-2),i=c==m.turtles.getTurtle(m.turtles.getTurtleCount()-1),s=void 0,s=n.length,n.push([s,"print",0,0,[a,s+1,i?null:s+2]]),n.push([s+1,["text",{value:l.name}],0,0,[s,null]]),o=n)}}catch(e){u.e(e)}finally{u.f()}return o[0][4][2]=o.length,o.push([o.length,"hiddennoflow",0,0,[0,null]]),o}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){t.oscilloscopeTurtles=[],t.inOscilloscope=!0;var l="_oscilloscope_"+r;t.setDispatchBlock(n,r,l);if(t.setTurtleListener(r,l,function(){t.Oscilloscope=new Oscilloscope(m),t.inOscilloscope=!1}),1===e.length)return[e[0],1]}}])})(),s=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["modewidget"])).setPalette("widgets",m),e.beginnerBlock(!0),e.setHelpString([_("The Custom mode block opens a tool to explore musical mode (the spacing of the notes in a scale)."),"documentation",""]),e.formBlock({name:_("custom mode"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"modewidget",e,t,[null,1,4]],[1,"setkey2",0,0,[0,2,3,null]],[2,["notename",{value:"C"}],0,0,[1]],[3,["modename",{value:DEFAULTMODE}],0,0,[1]],[4,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){t.insideModeWidget=!0;var l="_modewidget_"+r;t.setDispatchBlock(n,r,l);if(t.setTurtleListener(r,l,function(){t.modeWidget=new ModeWidget(m),t.insideModeWidget=!1}),1===e.length)return[e[0],1]}}])})(),o=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["tempo"])).setPalette("widgets",m),e.beginnerBlock(!0),e.setHelpString([_("The Tempo block opens a metronome to visualize the beat."),"documentation",null,"tempo"]),e.formBlock({name:_("tempo"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"tempo",e,t,[null,1,6]],[1,"setmasterbpm2",0,0,[0,2,3,7]],[2,["number",{value:90}],0,0,[1]],[3,"divide",0,0,[1,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"hiddennoflow",0,0,[0,null]],[7,"vspace",0,0,[1,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.tempo&&(t.tempo=new Tempo),t.inTempo=!0,t.tempo.BPMBlocks=[],t.tempo.BPMs=[];var l="_tempo_"+r;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(){t.tempo.init(m)}),[e[0],1]}}])})(),u=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["arpeggiomatrix"])).setPalette("widgets",m),e.setHelpString([_("The Arpeggio Widget is used to compose chord sequences."),"documentation",""]),e.formBlock({name:_("arpeggio"),canCollapse:!0,args:1,defaults:[4]}),e.makeMacro(function(e,t){return[[0,"arpeggiomatrix",e,t,[null,1,3,2]],[1,["number",{value:4}],0,0,[0]],[2,"hiddennoflow",0,0,[0,null]],[3,"newnote",0,0,[0,4,7,null]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:16}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"pitch",0,0,[7,9,10,null]],[9,["solfege",{value:"do"}],0,0,[8]],[10,["number",{value:4}],0,0,[8]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.arpeggio&&(t.arpeggio=new Arpeggio),t.inArpeggio=!0,0<e.length&&1<e[0]&&e[0]<21&&(t.arpeggio.defaultCols=e[0]),t.arpeggio.notesToPlay=[];var l="_arpeggio_"+r;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(){t.arpeggio.init(m)}),[e[1],1]}}])})(),c=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pitchdrummatrix"])).setPalette("widgets",m),e.setHelpString([_("The Pitch drum matrix is used to map pitches to drum sounds."),"documentation",""]),e.formBlock({name:_("pitch-drum mapper"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"pitchdrummatrix",e,t,[null,1,16]],[1,"pitch",0,0,[0,2,3,4]],[2,["solfege",{value:"sol"}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"pitch",0,0,[1,5,6,7]],[5,["solfege",{value:"mi"}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"pitch",0,0,[4,8,9,10]],[8,["solfege",{value:"re"}],0,0,[7]],[9,["number",{value:4}],0,0,[7]],[10,"playdrum",0,0,[7,11,12]],[11,["drumname",{value:"kick drum"}],0,0,[10]],[12,"playdrum",0,0,[10,13,14]],[13,["drumname",{value:"snare drum"}],0,0,[12]],[14,"playdrum",0,0,[12,15,null]],[15,["drumname",{value:"ride bell"}],0,0,[14]],[16,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.pitchDrumMatrix&&(t.pitchDrumMatrix=new PitchDrumMatrix),t.inPitchDrumMatrix=!0,t.pitchDrumMatrix.rowLabels=[],t.pitchDrumMatrix.rowArgs=[],t.pitchDrumMatrix.drums=[],t.pitchDrumMatrix.clearBlocks();var l="_pitchdrummatrix_"+r;t.setDispatchBlock(n,r,l);if(t.setTurtleListener(r,l,function(){0===t.pitchDrumMatrix.drums.length||0===t.pitchDrumMatrix.rowLabels.length?m.errorMsg(_("You must have at least one pitch block and one drum block in the matrix."),n):(t.pitchDrumMatrix.init(m),t.pitchDrumMatrix.makeClickable())}),1===e.length)return[e[0],1]}}])})(),p=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pitchslider"])).setPalette("widgets",m),e.beginnerBlock(!0),e.setHelpString([_("The Pitch slider tool to is used to generate pitches at selected frequencies."),"documentation",""]),e.formBlock({name:_("pitch slider"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"pitchslider",e,t,[null,1,3]],[1,"hertz",0,0,[0,2,null]],[2,["number",{value:392}],0,0,[1]],[3,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.pitchSlider&&(t.pitchSlider=new PitchSlider),t.inPitchSlider=!0,t.pitchSlider.frequencies=[];var l="_pitchslider_"+r;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(){t.pitchSlider.init(m),t.inPitchSlider=!1}),[e[0],1]}}])})(),h=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["chromatic"])).setPalette("widgets",m),e.setHelpString(),e.formBlock({name:_("chromatic keyboard"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,["musickeyboard",{collapsed:!1}],e,t,[null,2,1]],[1,["hiddennoflow",{}],0,0,[0,null]],[2,["setkey2",{}],0,0,[0,3,4,5]],[3,["notename",{value:"C"}],0,0,[2]],[4,["modename",{value:"chromatic"}],0,0,[2]],[5,["pitch",{}],0,0,[2,6,7,8]],[6,["solfege",{value:"do"}],0,0,[5]],[7,["number",{value:5}],0,0,[5]],[8,["repeat",{}],0,0,[5,9,10,null]],[9,["modelength",{}],0,0,[8]],[10,["steppitch",{}],0,0,[8,11,null]],[11,["number",{value:-1}],0,0,[10]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(){}}])})(),d=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["musickeyboard2"])).setPalette("widgets",m),e.setHelpString(),e.formBlock({name:_("music keyboard"),canCollapse:!0}),e.beginnerBlock("ja"!==e.lang),e.makeMacro(function(e,t){return[[0,"setbpm3",0,0,[12,1,2,5]],[1,["number",{value:90}],0,0,[0]],[2,"divide",0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[0,6]],[6,"meter",0,0,[5,7,8,11]],[7,["number",{value:4}],0,0,[6]],[8,"divide",0,0,[6,9,10]],[9,["number",{value:1}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"vspace",0,0,[6,13]],[12,["musickeyboard",{collapsed:!1}],e,t,[null,0,28]],[13,"pitch",0,0,[11,14,15,16]],[14,["solfege",{value:"sol"}],0,0,[13]],[15,["number",{value:4}],0,0,[13]],[16,"pitch",0,0,[13,17,18,19]],[17,["solfege",{value:"fa"}],0,0,[16]],[18,["number",{value:4}],0,0,[16]],[19,"pitch",0,0,[16,20,21,22]],[20,["solfege",{value:"mi"}],0,0,[19]],[21,["number",{value:4}],0,0,[19]],[22,"pitch",0,0,[19,23,24,25]],[23,["solfege",{value:"re"}],0,0,[22]],[24,["number",{value:4}],0,0,[22]],[25,"pitch",0,0,[22,26,27,null]],[26,["solfege",{value:"do"}],0,0,[25]],[27,["number",{value:4}],0,0,[25]],[28,"hiddennoflow",0,0,[12,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t)})(),f=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["musickeyboard"])).setPalette("widgets",m),e.beginnerBlock(!0),m.beginnerMode&&"ja"===e.lang?e.setHelpString([_("The Music keyboard block opens a piano keyboard that can be used to create notes."),"documentation",null,"musickeyboardja"]):e.setHelpString([_("The Music keyboard block opens a piano keyboard that can be used to create notes."),"documentation",null,"musickeyboard2"]),e.formBlock({name:_("music keyboard"),canCollapse:!0}),e.hidden=!0,e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.musicKeyboard&&(t.musicKeyboard=new MusicKeyboard(m)),t.inMusicKeyboard=!0,t.musicKeyboard.blockNo=n,t.musicKeyboard.instruments=[],t.musicKeyboard.noteNames=[],t.musicKeyboard.octaves=[],t.musicKeyboard._rowBlocks=[];var l="_musickeyboard_"+r;t.setDispatchBlock(n,r,l);if(t.setTurtleListener(r,l,function(){t.musicKeyboard.init(t)}),1===e.length)return[e[0],1]}}])})(),b=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["pitchstaircase"])).setPalette("widgets",m),e.beginnerBlock(!0),e.setHelpString([_("The Pitch staircase tool to is used to generate pitches from a given ratio."),"documentation",null,"pitchstaircase"]),e.formBlock({name:_("pitch staircase"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"pitchstaircase",e,t,[null,1,4]],[1,"pitch",0,0,[0,2,3,null]],[2,["solfege",{value:"sol"}],0,0,[1]],[3,["number",{value:3}],0,0,[1]],[4,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.pitchStaircase&&(t.pitchStaircase=new PitchStaircase),t.pitchStaircase.Stairs=[],t.pitchStaircase.stairPitchBlocks=[],t.inPitchStaircase=!0;var l="_pitchstaircase_"+r;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(){t.pitchStaircase.init(m),t.inPitchStaircase=!1}),[e[0],1]}}])})(),v=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["rhythmruler3"])).setPalette("widgets",m),e.setHelpString(),e.formBlock({name:_("rhythm maker"),canCollapse:!0}),e.beginnerBlock(!0),e.makeMacro(function(e,t){return[[0,"rhythmruler2",e,t,[null,1,9]],[1,"setdrum",0,0,[0,2,3,8]],[2,["drumname",{value:"snare drum"}],0,0,[1]],[3,"rhythm2",0,0,[1,4,5,null]],[4,["number",{value:1}],0,0,[3]],[5,"divide",0,0,[3,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:1}],0,0,[5]],[8,"hidden",0,0,[1,null]],[9,"hiddennoflow",0,0,[0,null]]]}),e.hidden=!m.beginnerMode,e}return _inherits(t,StackClampBlock),_createClass(t)})(),g=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["rhythmruler2"])).setPalette("widgets",m),e.setHelpString([_("The Rhythm Maker block opens a tool to create drum machines."),"documentation",null,"rhythmruler2"]),e.formBlock({name:_("rhythm maker"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"rhythmruler2",e,t,[null,1,17]],[1,"setdrum",0,0,[0,2,3,8]],[2,["drumname",{value:"snare drum"}],0,0,[1]],[3,"rhythm2",0,0,[1,4,5,null]],[4,["number",{value:1}],0,0,[3]],[5,"divide",0,0,[3,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:1}],0,0,[5]],[8,"hidden",0,0,[1,9]],[9,"setdrum",0,0,[8,10,11,16]],[10,["drumname",{value:"kick drum"}],0,0,[9]],[11,"rhythm2",0,0,[9,12,13,null]],[12,["number",{value:1}],0,0,[11]],[13,"divide",0,0,[11,14,15]],[14,["number",{value:1}],0,0,[13]],[15,["number",{value:1}],0,0,[13]],[16,"hidden",0,0,[9,null]],[17,"hiddennoflow",0,0,[0,null]]]}),e.hidden=m.beginnerMode,e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null==t.rhythmRuler&&(t.rhythmRuler=new RhythmRuler),t.rhythmRuler.Rulers=[],t.rhythmRuler.Drums=[],t.inRhythmRuler=!0;var l="_rhythmruler_"+r;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(){t.rhythmRuler.init(m)}),[e[0],1]}}])})(),k=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["matrixgmajor",_("G major scale")])).setPalette("widgets",m),e.beginnerBlock(!0),e.makeMacro(function(e,t){return[[0,["matrix",{collapsed:!1}],e,t,[null,5,16]],[1,["solfege",{value:"sol"}],0,0,[10]],[2,["number",{value:5}],0,0,[10]],[3,"steppitch",0,0,[8,4,null]],[4,["number",{value:-1}],0,0,[3]],[5,"setkey2",0,0,[0,6,7,10]],[6,["notename",{value:"G"}],0,0,[5]],[7,["modename",{value:"major"}],0,0,[5]],[8,"repeat",0,0,[10,9,3,11]],[9,"modelength",0,0,[8]],[10,"pitch",0,0,[5,1,2,8]],[11,"rhythm2",0,0,[8,12,14,null]],[12,["number",{value:8}],0,0,[11]],[13,["number",{value:1}],0,0,[14]],[14,"divide",0,0,[11,13,15]],[15,["number",{value:4}],0,0,[14]],[16,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),y=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["matrixcmajor",_("C major scale")])).setPalette("widgets",m),e.beginnerBlock(!0),e.makeMacro(function(e,t){return[[0,["matrix",{collapsed:!1}],e,t,[null,5,16]],[1,["solfege",{value:"do"}],0,0,[10]],[2,["number",{value:5}],0,0,[10]],[3,"steppitch",0,0,[8,4,null]],[4,["number",{value:-1}],0,0,[3]],[5,"setkey2",0,0,[0,6,7,10]],[6,["notename",{value:"C"}],0,0,[5]],[7,["modename",{value:"major"}],0,0,[5]],[8,"repeat",0,0,[10,9,3,11]],[9,"modelength",0,0,[8]],[10,"pitch",0,0,[5,1,2,8]],[11,"rhythm2",0,0,[8,12,14,null]],[12,["number",{value:8}],0,0,[11]],[13,["number",{value:1}],0,0,[14]],[14,"divide",0,0,[11,13,15]],[15,["number",{value:4}],0,0,[14]],[16,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,FlowBlock),_createClass(t)})(),w=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["matrix"])).setPalette("widgets",m),e.beginnerBlock(!0),e.setHelpString([_("The Phrase Maker block opens a tool to create musical phrases."),"documentation",null,"matrix"]),e.formBlock({name:_("phrase maker"),canCollapse:!0}),m.beginnerMode?e.makeMacro(function(e,t){return[[0,"matrix",e,t,[null,1,33]],[1,"pitch",0,0,[0,2,3,4]],[2,["solfege",{value:"ti"}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"pitch",0,0,[1,5,6,7]],[5,["solfege",{value:"la"}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"pitch",0,0,[4,8,9,10]],[8,["solfege",{value:"sol"}],0,0,[7]],[9,["number",{value:4}],0,0,[7]],[10,"pitch",0,0,[7,11,12,13]],[11,["solfege",{value:"mi"}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"pitch",0,0,[10,14,15,16]],[14,["solfege",{value:"re"}],0,0,[13]],[15,["number",{value:4}],0,0,[13]],[16,"playdrum",0,0,[13,17,18]],[17,["drumname",{value:"snare drum"}],0,0,[16]],[18,"forward",0,0,[16,19,20]],[19,["number",{value:100}],0,0,[18]],[20,"right",0,0,[18,21,22]],[21,["number",{value:90}],0,0,[20]],[22,"rhythm2",0,0,[20,23,24,27]],[23,["number",{value:6}],0,0,[22]],[24,"divide",0,0,[22,25,26]],[25,["number",{value:1}],0,0,[24]],[26,["number",{value:4}],0,0,[24]],[27,"vspace",0,0,[22,28]],[28,"rhythm2",0,0,[27,29,30,null]],[29,["number",{value:1}],0,0,[28]],[30,"divide",0,0,[28,31,32]],[31,["number",{value:1}],0,0,[30]],[32,["number",{value:2}],0,0,[30]],[33,"hiddennoflow",0,0,[0,null]]]}):e.makeMacro(function(e,t){return[[0,"matrix",e,t,[null,1,35]],[1,"pitch",0,0,[0,2,3,4]],[2,["solfege",{value:"ti"}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"pitch",0,0,[1,5,6,7]],[5,["solfege",{value:"la"}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"pitch",0,0,[4,8,9,10]],[8,["solfege",{value:"sol"}],0,0,[7]],[9,["number",{value:4}],0,0,[7]],[10,"pitch",0,0,[7,11,12,13]],[11,["solfege",{value:"mi"}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"pitch",0,0,[10,14,15,16]],[14,["solfege",{value:"re"}],0,0,[13]],[15,["number",{value:4}],0,0,[13]],[16,"playdrum",0,0,[13,17,18]],[17,["drumname",{value:"snare drum"}],0,0,[16]],[18,"forward",0,0,[16,19,20]],[19,["number",{value:100}],0,0,[18]],[20,"right",0,0,[18,21,22]],[21,["number",{value:90}],0,0,[20]],[22,"print",0,0,[20,23,24]],[23,["text",{value:_("lyrics")}],0,0,[22]],[24,"rhythm2",0,0,[22,25,26,29]],[25,["number",{value:6}],0,0,[24]],[26,"divide",0,0,[24,27,28]],[27,["number",{value:1}],0,0,[26]],[28,["number",{value:4}],0,0,[26]],[29,"vspace",0,0,[24,30]],[30,"rhythm2",0,0,[29,31,32,null]],[31,["number",{value:1}],0,0,[30]],[32,"divide",0,0,[30,33,34]],[33,["number",{value:1}],0,0,[32]],[34,["number",{value:2}],0,0,[32]],[35,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,n,t,l){n.inMatrix=!0,null===n.phraseMaker&&(n.phraseMaker=new PhraseMaker),n.phraseMaker.blockNo=l,n.phraseMaker._instrumentName=DEFAULTVOICE,n.phraseMaker.rowLabels=[],n.phraseMaker.rowArgs=[],n.phraseMaker.graphicsBlocks=[],n.phraseMaker.clearBlocks(),n.phraseMaker.lyricsON=!1,n.tupletRhythms=[],n.tupletParams=[],n.addingNotesToTuplet=!1;var r="_matrix_"+t;n.setDispatchBlock(l,t,r);if(n.setTurtleListener(t,r,function(){if(0===n.tupletRhythms.length||0===n.phraseMaker.rowLabels.length)m.errorMsg(_("You must have at least one pitch block and one rhythm block in the matrix."),l);else{n.phraseMaker.blockNo=l,n.phraseMaker.sorted=!1,n.phraseMaker.init(m);for(var e=0;e<n.tupletRhythms.length;e++)switch(n.tupletRhythms[e][0]){case"notes":case"simple":var t=[n.tupletParams[n.tupletRhythms[e][1]]];t.push([]);for(var r=2;r<n.tupletRhythms[e].length;r++)t[1].push(n.tupletRhythms[e][r]);n.phraseMaker.addTuplet(t);break;default:n.phraseMaker.addNotes(n.tupletRhythms[e][1],n.tupletRhythms[e][2])}n.phraseMaker.makeClickable()}}),1===e.length)return[e[0],1]}}])})(),C=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["status"])).setPalette("widgets",m),e.beginnerBlock(!0),e.setHelpString([_("The Status block opens a tool for inspecting the status of Music Blocks as it is running."),"documentation",null,"status"]),e.formBlock({name:_("status"),canCollapse:!0}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.statusMatrix&&(t.statusMatrix=new StatusMatrix),t.statusMatrix.init(m),t.statusFields=[],t.inStatusMatrix=!0;var l="_status_"+r;t.setDispatchBlock(n,r,l);if(t.setTurtleListener(r,l,function(){t.statusMatrix.init(m),t.inStatusMatrix=!1}),1===e.length)return[e[0],1]}}])})(),S=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["reflection"])).setPalette("widgets",m),e.beginnerBlock(!0),e.setHelpString([_("The Reflection block opens a space for you to think about your learning."),null,"reflection"]),e.formBlock({name:_("reflection"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"reflection",e,t,[null,1]],[1,"print",0,0,[0,2,null]],[2,["text",{value:"Reflective Learning"}],0,0,[1]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.reflection&&(t.reflection=new ReflectionMatrix),t.reflection.init(m),t.statusFields=[],t.inReflectionMatrix=!0;var l="_reflection_"+r;t.setDispatchBlock(n,r,l);if(t.setTurtleListener(r,l,function(){t.reflection.init(m),t.inReflectionMatrix=!1}),1===e.length)return[e[0],1]}}])})(),M=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["legobricks"])).setPalette("widgets",m),e.parameter=!0,e.beginnerBlock(!0),e.setHelpString([_("The LEGO Bricks block opens a widget for designing virtual LEGO creations."),"documentation",null,"legobricks"]),e.formBlock({name:_("LEGO Bricks"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"legobricks",e,t,[null,1,18]],[1,"pitch",0,0,[0,2,3,4]],[2,["solfege",{value:"do"}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"pitch",0,0,[1,5,6,7]],[5,["solfege",{value:"re"}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"pitch",0,0,[4,8,9,10]],[8,["solfege",{value:"mi"}],0,0,[7]],[9,["number",{value:4}],0,0,[7]],[10,"pitch",0,0,[7,11,12,13]],[11,["solfege",{value:"fa"}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"pitch",0,0,[10,14,15,16]],[14,["solfege",{value:"sol"}],0,0,[13]],[15,["number",{value:4}],0,0,[13]],[16,"playdrum",0,0,[13,17,null]],[17,["drumname",{value:"kick drum"}],0,0,[16]],[18,"hiddennoflow",0,0,[0,null]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){t.inLegoWidget=!0,null===t.legoWidget&&(t.legoWidget=new LegoWidget),t.legoWidget.blockNo=n,t.legoWidget.rowLabels=[],t.legoWidget.rowArgs=[],t.legoWidget.clearBlocks();var l="_legobricks_"+r;t.setDispatchBlock(n,r,l);if(t.setTurtleListener(r,l,function(){0===t.legoWidget.rowLabels.length?m.errorMsg(_("You must have at least one pitch block in the LEGO bricks widget."),n):(t.legoWidget.blockNo=n,t.legoWidget.init(m)),t.inLegoWidget=!1}),1===e.length)return[e[0],1]}}])})(),B=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,["aidebugger"])).setPalette("widgets",m),e.parameter=!0,e.beginnerBlock(!0),e.setHelpString([_("Debug your music blocks project with new possibilities and more understanding."),"documentation",null,"aidebugger"]),e.formBlock({name:_("Debugger"),canCollapse:!0}),e.makeMacro(function(e,t){return[[0,"aidebugger",e,t,[null,1]],[1,"print",0,0,[0,2,null]],[2,["text",{value:"Debugger Initiated"}],0,0,[1]]]}),e}return _inherits(t,StackClampBlock),_createClass(t,[{key:"flow",value:function(e,t,r,n){null===t.sample&&(t.sample=new AIDebuggerWidget),t.inSample=!0,t.sample=new AIDebuggerWidget;var l="_sampler_"+r;t.setDispatchBlock(n,r,l);return t.setTurtleListener(r,l,function(e){t.sample.init(m)}),[e[0],1]}}])})();_THIS_IS_MUSIC_BLOCKS_&&((new e).setup(m),(new t).setup(m),(new r).setup(m),(new l).setup(m),(new a).setup(m),(new s).setup(m),(new o).setup(m),(new n).setup(m),(new u).setup(m),(new c).setup(m),(new i).setup(m),(new p).setup(m),(new h).setup(m),(new M).setup(m),(new S).setup(m),(new d).setup(m),(new f).setup(m),(new b).setup(m),(new v).setup(m),(new g).setup(m),(new k).setup(m),(new y).setup(m),(new w).setup(m)),(new B).setup(m),(new C).setup(m)}
function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,l=[],p=!0,s=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);p=!0);}catch(e){s=!0,o=e}finally{try{if(!p&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(s)throw o}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var r,n,o,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return o=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){o=!0,r=e},f:function(){try{n||null==i.return||i.return()}finally{if(o)throw r}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var ASTUtils=(()=>{function c(){_classCallCheck(this,c)}return _createClass(c,null,[{key:"BAREBONE_AST",get:function(){return JSON.parse(JSON.stringify(c._bareboneAST))}},{key:"_getSetAST",value:function(e,t){return{type:"ExpressionStatement",expression:{type:"AssignmentExpression",left:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"".concat(e)}},operator:"=",right:c._getArgsAST(t)[0]}}}},{key:"_getGetAST",value:function(e){return{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"".concat(e)}}}},{key:"_getIfAST",value:function(e,t,r,n){e={type:"IfStatement",test:c._getArgsAST(e)[0],consequent:{type:"BlockStatement",body:c._getBlockAST(t,n)},alternate:null};return void 0!==r&&(e.alternate={type:"BlockStatement",body:c._getBlockAST(r,n)}),e}},{key:"_getForLoopAST",value:function(e,t,r){return{type:"ForStatement",init:{type:"VariableDeclaration",kind:"let",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"i"+(r=void 0===r?0:r)},init:{type:"Literal",value:0}}]},test:{type:"BinaryExpression",left:{type:"Identifier",name:"i"+r},right:c._getArgsAST(e)[0],operator:"<"},update:{type:"UpdateExpression",argument:{type:"Identifier",name:"i"+r},operator:"++",prefix:!1},body:{type:"BlockStatement",body:c._getBlockAST(t,r+1)}}}},{key:"_getWhileLoopAST",value:function(e,t,r){return{type:"WhileStatement",test:c._getArgsAST(e)[0],body:{type:"BlockStatement",body:c._getBlockAST(t,r)}}}},{key:"_getDoWhileLoopAST",value:function(e,t,r){return{type:"DoWhileStatement",body:{type:"BlockStatement",body:c._getBlockAST(t,r)},test:c._getArgsAST(e)[0]}}},{key:"_getIncrementStmntAST",value:function(e,t){var r=e[0].split("_")[1];return{type:"ExpressionStatement",expression:{type:"AssignmentExpression",left:{type:"Identifier",name:r},operator:"=",right:{type:"BinaryExpression",left:{type:"Identifier",name:r},right:c._getArgsAST([e[1]])[0],operator:t?"+":"-"}}}}},{key:"_getMethodDefAST",value:function(e){return{type:"VariableDeclaration",kind:"let",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"".concat(e)},init:{type:"ArrowFunctionExpression",params:[{type:"Identifier",name:"mouse"}],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"ENDFLOW"}}}]},async:!0,expression:!1}}]}}},{key:"_getMethodCallAST",value:function(e,t,r){t={type:"ExpressionStatement",expression:{type:"AwaitExpression",argument:{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"".concat(JSInterface.getMethodName(e))}},arguments:c._getArgsAST(JSInterface.rearrangeMethodArgs(e,t))}}};return t=r&&(r.action&&(t.expression.argument.callee={type:"Identifier",name:"".concat(e)},t.expression.argument.arguments=[{type:"Identifier",name:"mouse"}]),!1===r.statement)?t.expression:t}},{key:"_getArgExpAST",value:function(e,t){var r,n,o={plus:["binexp","+"],minus:["binexp","-"],multiply:["binexp","*"],divide:["binexp","/"],mod:["binexp","%"],equal:["binexp","=="],less:["binexp","<"],greater:["binexp",">"],or:["binexp","|"],and:["binexp","&"],xor:["binexp","^"],not:["unexp","!"],neg:["unexp","-"],abs:["method","Math.abs"],sqrt:["method","Math.sqrt"],power:["method","Math.pow"],int:["method","Math.floor"]};function a(e,t){return{type:"CallExpression",callee:{type:"Identifier",name:"".concat(e)},arguments:c._getArgsAST(t)}}return e in o?"binexp"===o[e][0]?function(e,t,r){return{type:"BinaryExpression",left:c._getArgsAST([t])[0],right:c._getArgsAST([r])[0],operator:"".concat(e)}}.apply(void 0,[o[e][1]].concat(_toConsumableArray(t))):"unexp"===o[e][0]?(r=o[e][1],n=t[0],{type:"UnaryExpression",operator:"".concat(r),argument:c._getArgsAST([n])[0],prefix:!0}):a(o[e][1],t):a(JSInterface.getMethodName(e),t)}},{key:"_getArgsAST",value:function(e){if(null==e)return[];var t,r=[],n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var o,a,i,l=t.value;null===l?r.push({type:"Literal",value:null}):"object"===_typeof(l)?JSInterface.isGetter(l[0])?r.push(c._getGetAST(JSInterface.getGetterName(l[0]))):r.push(JSInterface.methodReturns(l[0])?c._getMethodCallAST(l[0],l[1],{statement:!1}):c._getArgExpAST(l[0],l[1])):"string"==typeof l&&1<l.split("_").length?(a=(o=_slicedToArray(l.split("_"),2))[0],i=o[1],"bool"===a?r.push({type:"Literal",value:"true"===i}):"box"===a&&r.push({type:"Identifier",name:i})):r.push({type:"Literal",value:l})}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"_getMethodCallClampAST",value:function(e,t,r,n){e=c._getMethodCallAST(e,t);return e.expression.argument.arguments.push({type:"ArrowFunctionExpression",params:[],body:{type:"BlockStatement",body:c._getBlockAST(r,n)},async:!0,expression:!1}),last(e.expression.argument.arguments).body.body.push({type:"ReturnStatement",argument:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"ENDFLOW"}}}),e}},{key:"_getBlockAST",value:function(e,t){if(null==e)return[];var r,n=[],o=_createForOfIteratorHelper(e);try{for(o.s();!(r=o.n()).done;){var a=r.value;if("if"===a[0])n.push(c._getIfAST(a[1],a[2],t));else if("ifthenelse"===a[0])n.push(c._getIfAST(a[1],a[2],a[3],t));else if("repeat"===a[0])n.push(c._getForLoopAST(a[1],a[2],t));else if("while"===a[0])n.push(c._getWhileLoopAST(a[1],a[2],t));else if("forever"===a[0])n.push(c._getWhileLoopAST([1e3],a[2],t));else if("until"===a[0])n.push(c._getDoWhileLoopAST(a[1],a[2],t));else if("break"===a[0])n.push({type:"BreakStatement",label:null});else if("switch"===a[0])n.push({type:"SwitchStatement",discriminant:c._getArgsAST(a[1])[0],cases:c._getBlockAST(a[2],t)});else if("case"===a[0]){var i,l={type:"SwitchCase",test:c._getArgsAST(a[1])[0],consequent:[{type:"BreakStatement",label:null}]},p=c._getBlockAST(a[2],t);for(i in p)l.consequent.splice(i,0,p[i]);n.push(l)}else if("defaultcase"===a[0])n.push({type:"SwitchCase",test:null,consequent:c._getBlockAST(a[2],t)});else if("increment"===a[0])n.push(c._getIncrementStmntAST(a[1],!0));else if("incrementOne"===a[0])n.push(c._getIncrementStmntAST([a[1][0],1],!0));else if("decrementOne"===a[0])n.push(c._getIncrementStmntAST([a[1][0],1],!1));else if("storein"===a[0])n.push({type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:a[1][0]},init:c._getArgsAST([a[1][1]])[0]}]});else if(1<a[0].split("_").length){var s=_slicedToArray(a[0].split("_"),2),u=s[0],y=s[1];"storein2"===u?n.push({type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:y},init:c._getArgsAST(a[1])[0]}]}):"nameddo"===u&&n.push(c._getMethodCallAST(y,a[1],{action:!0}))}else if(JSInterface.isSetter(a[0]))n.push(c._getSetAST(JSInterface.getSetterName(a[0]),a[1]));else{if(!JSInterface.isMethod(a[0]))throw'CANNOT PROCESS "'.concat(a[0],'" BLOCK');JSInterface.isClampBlock(a[0])?n.push(c._getMethodCallClampAST.apply(c,_toConsumableArray(a).concat([t]))):n.push(c._getMethodCallAST.apply(c,_toConsumableArray(a)))}}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"getMethodAST",value:function(e,t){var r,n=c._getMethodDefAST(e),o=c._getBlockAST(t);for(r in o)n.declarations[0].init.body.body.splice(r,0,o[r]);return n}},{key:"getMouseAST",value:function(e){var t,r=JSON.parse(JSON.stringify(c._mouseAST)),n=c._getBlockAST(e);for(t in n)r.expression.arguments[0].body.body.splice(t,0,n[t]);return r}}])})();_defineProperty(ASTUtils,"_bareboneAST",{type:"Program",sourceType:"script",body:[{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"MusicBlocks"},computed:!1,property:{type:"Identifier",name:"run"}},arguments:[]}}]}),_defineProperty(ASTUtils,"_mouseAST",{type:"ExpressionStatement",expression:{type:"NewExpression",callee:{type:"Identifier",name:"Mouse"},arguments:[{type:"ArrowFunctionExpression",params:[{type:"Identifier",name:"mouse"}],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"ENDMOUSE"}}}]},async:!0,expression:!1}]}}),"undefined"!=typeof module&&module.exports&&(module.exports=ASTUtils);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a,i,l=[],s=!0,c=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;s=!1}else for(;!(s=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=t.return&&(i=t.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,r){var t,n,o,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return o=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){o=!0,t=e},f:function(){try{n||null==i.return||i.return()}finally{if(o)throw t}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:r=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){var t;if(e)return"string"==typeof e?_arrayLikeToArray(e,r):"Map"===(t="Object"===(t={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,r){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);t=t.call(e,r||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}var AST2BlockList=(()=>_createClass(function e(){_classCallCheck(this,e)},null,[{key:"toBlockList",value:function(e,r){var e=((e,g)=>{var r,y=g.argument_blocks,t={},n=_createForOfIteratorHelper(e.body);try{for(n.s();!(r=n.n()).done;)!function e(r,t){var n=h(r);if(null===n)throw{prefix:"Unsupported statement: ",start:r.start,end:r.end};if(!("name"in n))return;var o={};"name_property"in n.ast?o.name=_defineProperty({},n.name,k(r,n.ast.name_property)):o.name=n.name;if(void 0!==n.arguments){var a,i=[],l=_createForOfIteratorHelper(n.ast.argument_properties);try{for(l.s();!(a=l.n()).done;){var s=a.value;i.push(k(r,s))}}catch(e){l.e(e)}finally{l.f()}var c=m(i);0<c.length&&(o.arguments=c)}if(void 0!==n.ast.children_properties){var u,f=_createForOfIteratorHelper(k(r,n.ast.children_properties[0]));try{for(f.s();!(u=f.n()).done;){var p=u.value;"ReturnStatement"!=p.type&&e(p,o)}}catch(e){f.e(e)}finally{f.f()}if(1<n.ast.children_properties.length){o.children.push({name:"else"});var y,v=_createForOfIteratorHelper(k(r,n.ast.children_properties[1]));try{for(v.s();!(y=v.n()).done;){var d=y.value;"ReturnStatement"!=d.type&&e(d,o)}}catch(e){v.e(e)}finally{v.f()}}}void 0===t.children&&(t.children=[]);t.children.push(o)}(r.value,t)}catch(e){n.e(e)}finally{n.f()}return console.log(JSON.stringify(t.children,null,2)),t.children;function k(e,r){var t,n=e,o=_createForOfIteratorHelper(r.split("."));try{for(o.s();!(t=o.n()).done;)var a=t.value,i=a.match(/(\w+)\[(\d+)\]/),n=i?(n=n[i[1]])[i[2]]:n[a]}catch(e){o.e(e)}finally{o.f()}return n}function h(e){var r,t=_createForOfIteratorHelper(g.body_blocks);try{for(t.s();!(r=t.n()).done;){var n=r.value;if("ast"in n){var o,a={},i=_createForOfIteratorHelper(n.ast.identifiers);try{for(i.s();!(o=i.n()).done;){var l=o.value;a[l.property]||(a[l.property]=[]),a[l.property].push(l)}}catch(e){i.e(e)}finally{i.f()}for(var s,c=!0,u=0,f=Object.entries(a);u<f.length;u++){var p,y=_slicedToArray(f[u],2),v=y[0],d=y[1],h=k(e,v),m=!1,_=_createForOfIteratorHelper(d);try{for(_.s();!(p=_.n()).done;){var b=p.value;if("value"in b){if(h===b.value){m=!0;break}}else{if("has_value"in b&&(!b.has_value&&null==h||b.has_value&&null!=h)){m=!0;break}if(!("has_value"in b)&&b.size===h.length){m=!0;break}}}}catch(e){_.e(e)}finally{_.f()}if(!m){c=!1;break}}if(c)return n.name_map&&(s=k(e,"expression.argument.callee.property.name"))&&n.name_map[s]&&(console.log(n.name_map[s]),n.name=n.name_map[s]),n}}}catch(e){t.e(e)}finally{t.f()}return null}function m(e){var r,t=[],n=_createForOfIteratorHelper(e);try{for(n.s();!(r=n.n()).done;){var o=r.value,a=null,i=(e=>{var r,t=_createForOfIteratorHelper(y);try{for(t.s();!(r=t.n()).done;){var n,o=r.value,a=o.ast,i=!0,l=_createForOfIteratorHelper(a.identifiers);try{for(l.s();!(n=l.n()).done;){var s=n.value,c=k(e,s.property);if("size"in s){if(c.length!==s.size){i=!1;break}}else if(c!==s.value){i=!1;break}}}catch(e){l.e(e)}finally{l.f()}if(i)return o}}catch(e){t.e(e)}finally{t.f()}return null})(o);if(!i)throw{prefix:"Unsupported argument type ".concat(o.type,": "),start:o.start,end:o.end};if("value_property"in i.ast)a=k(o,i.ast.value_property);else if(i.ast.identifier_property)a={identifier:k(o,i.ast.identifier_property)};else{var l=k(o,i.ast.name_property);if(!(l in i.name_map))throw{prefix:"Unsupported operator ".concat(l,": "),start:o.start,end:o.end};var s=i.name_map[l],c=[];if("arguments_property"in i.ast)c=k(o,i.ast.arguments_property);else{var u,f=_createForOfIteratorHelper(i.ast.argument_properties);try{for(f.s();!(u=f.n()).done;){var p=u.value;c.push(k(o,p))}}catch(e){f.e(e)}finally{f.f()}}if(void 0===(s="object"===_typeof(s)?s[c.length]:s))throw{prefix:"Unsupported argument count for ".concat(l,": "),start:o.start,end:o.end};a={name:s,arguments:m(c)}}null!==a&&t.push(a)}}catch(e){n.e(e)}finally{n.f()}return t}})(e,r),d=r;function m(e){var r,t=Array.isArray(e[1])?e[1][0]:e[1],n=_createForOfIteratorHelper(d.body_blocks);try{for(n.s();!(r=n.n()).done;){var o,a,i,l,s,c,u,f=r.value;if("name"in f&&f.name===t||"name_map"in f&&Object.values(f.name_map).includes(t))return o={count:(f.blocklist_connections||d.default_connections).length},-1!==(i=(a=f.blocklist_connections||d.default_connections).indexOf("parent_or_previous_sibling"))&&(o.prev=i),-1!==(l=a.indexOf("first_child"))&&(o.child=l),-1!==(s=a.indexOf("next_sibling"))&&(o.next=s),-1!==(c=a.indexOf("second_child"))&&(o.second_child=c),"body"in(u=f.default_vspaces||d.default_vspaces||{body:1})?{type:"block",connections:o,vspaces:u.body}:{type:"block",connections:o,argument_v_spaces:u.argument}}}catch(e){n.e(e)}finally{n.f()}return{type:"block",connections:{count:2,prev:0,next:1},vspaces:1,argument_v_spaces:0}}var t,n=[],o=200,a=_createForOfIteratorHelper(e);try{for(a.s();!(t=a.n()).done;){var i=_(t.value,n).blockNumber;n[i][2]=o,n[i][3]=200,o+=300}}catch(e){a.e(e)}finally{a.f()}return n;function _(e,r){var t,n,o=[],a=r.length,i=(o.push(a),r.push(o),"object"===_typeof(e.name)?(i=Object.keys(e.name)[0],o.push([i,{value:e.name[i]}])):"else"!==e.name&&o.push(e.name),o.push(0),o.push(0),m(o)),l=new Array(i.connections.count).fill(null),o=(o.push(l),((e,r,t)=>{if(void 0===e.arguments||0==e.arguments.length)return 0;var n,o=r[t],a=(m(o),0),i=Array.isArray(o[1])?o[1][0]:o[1],l=null,s=_createForOfIteratorHelper(d.body_blocks);try{for(s.s();!(n=s.n()).done;){var c=n.value;if(c.name===i){l=c;break}if(c.name_map)for(var u in c.name_map)i===c.name_map[u]&&(l=c,console.log(c),console.log(i))}}catch(e){s.e(e)}finally{s.f()}if(!l||!l.arguments)throw new Error("Cannot find argument configuration for: ".concat(i));for(var f=0;f<e.arguments.length;f++){var p,y=e.arguments[f],v=l.arguments[f];"note_or_solfege"===v.type?(p=new Set(["A","B","C","D","E","F","G"]),a+=h([p.has(y.charAt(0))?"notename":"solfege",{value:y}],f+1,r,t)):"ValueExpression"===v.type||"NumberExpression"===v.type||"BooleanExpression"===v.type?a+=g(y,f+1,r,t):a+=h([v.type,{value:"object"===_typeof(y)?y.identifier:y}],f+1,r,t)}return a})(e,r,a)),s=Math.max(1,o);return void 0!==e.children&&0<e.children.length&&(t=-1!==(n=e.children.findIndex(function(e){return"else"===e.name}))?e.children.slice(0,n):e.children,e=-1!==n?e.children.slice(n+1):[],s+=(t=c(t,o-i.argument_v_spaces,r)).vspaces,void 0!==i.connections.child&&(l[i.connections.child]=t.firstChildBlockNumber,void 0!==(t=m(o=r[t.firstChildBlockNumber])).connections.prev)&&(o[4][t.connections.prev]=a),-1!==n)&&(s+=(o=c(e,0,r)).vspaces,void 0!==i.connections.second_child)&&(l[i.connections.second_child]=o.firstChildBlockNumber,void 0!==(n=m(t=r[o.firstChildBlockNumber])).connections.prev)&&(t[4][n.connections.prev]=a),{blockNumber:a,vspaces:s}}function c(e,r,t){for(var n=[],o=0,a=0;a<r;a++)n.push(b(t)),o++;var i,l=_createForOfIteratorHelper(e);try{for(l.s();!(i=l.n()).done;)for(var s=_(i.value,t),c=(n.push(s.blockNumber),o+=s.vspaces,m(t[s.blockNumber])),u=0;u<s.vspaces-c.vspaces;u++)n.push(b(t))}catch(e){l.e(e)}finally{l.f()}for(var f=1;f<n.length;f++){var p=t[n[f]],y=m(p);void 0!==y.connections.prev&&(p[4][y.connections.prev]=n[f-1])}for(var v=0;v<n.length-1;v++){var d=t[n[v]],h=m(d);void 0!==h.connections.next&&(d[4][h.connections.next]=n[v+1])}return{firstChildBlockNumber:n[0],vspaces:o}}function b(e){var r=[],t=e.length;return r.push(t),e.push(r),r.push("vspace"),r.push(0),r.push(0),r.push([null,null]),t}function h(e,r,t,n){var o=[],a=t.length;return o.push(a),t.push(o),o.push(e),o.push(0),o.push(0),o.push([n]),t[n][4][r]=a,1}function g(e,r,t,n){var o=0,a=[],i=t.length,l=(a.push(i),t.push(a),_typeof(e));if("number"===(l="string"===l?"text":l)||"boolean"===l||"text"===l||"object"===l&&void 0!==e.identifier)a.push("object"===l?["namedbox",{value:e.identifier}]:[l,{value:e}]),a.push(0),a.push(0),a.push([n]),o=1;else{if("object"!==l)throw new Error("Unsupported value argument: ".concat(e));a.push(e.name),a.push(0),a.push(0);l=new Array(1+e.arguments.length).fill(null);l[0]=n,a.push(l),o=((e,r,t)=>{for(var n=0,o=0;o<e.length;o++)n+=g(e[o],o+1,r,t);return n})(e.arguments,t,i),0===e.arguments.length&&(o+=1)}return t[n][4][r]=i,o}}}]))();"undefined"!=typeof module&&module.exports&&(module.exports={AST2BlockList:AST2BlockList});
JSInterface._methodArgConstraints={playNote:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],playNoteMillis:[{type:"number",constraints:{min:0,max:1e5,integer:!1}},{type:"function",constraints:{async:!0}}],dot:[{type:"number",constraints:{min:0,max:10,integer:!0}},{type:"function",constraints:{async:!0}}],tie:[{type:"function",constraints:{async:!0}}],multiplyNoteValue:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],swing:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],setMeter:[{type:"number",constraints:{min:1,max:16,integer:!0}},{type:"number",constraints:{min:0,max:1e3,integer:!1}}],PICKUP:[{type:"number",constraints:{min:0,max:1e3,integer:!1}}],setBPM:[{type:"number",constraints:{min:40,max:208,integer:!0}},{type:"number",constraints:{min:0,max:10,integer:!1}}],setMasterBPM:[{type:"number",constraints:{min:40,max:208,integer:!0}},{type:"number",constraints:{min:0,max:10,integer:!1}}],onEveryNoteDo:[{type:"string",constraints:{type:"any"}}],onEveryBeatDo:[{type:"string",constraints:{type:"any"}}],onStrongBeatDo:[{type:"number",constraints:{min:1,max:16,integer:!0}},{type:"string",constraints:{type:"any"}}],onWeakBeatDo:[{type:"string",constraints:{type:"any"}}],setNoClock:[{type:"function",constraints:{async:!0}}],getNotesPlayed:[{type:"number",constraints:{min:0,max:1e3,integer:!1}}],playPitch:[{type:"string",constraints:{type:"solfegeorletter"}},{type:"number",constraints:{min:1,max:8,integer:!0}}],stepPitch:[{type:"number",constraints:{min:-7,max:7,integer:!0}}],playNthModalPitch:[{type:"number",constraints:{min:-7,max:7,integer:!0}},{type:"number",constraints:{min:1,max:8,integer:!0}}],playPitchNumber:[{type:"number",constraints:{min:-3,max:12,integer:!0}}],playHertz:[{type:"number",constraints:{min:20,max:2e4,integer:!1}}],setAccidental:[{type:"string",constraints:{type:"accidental"}},{type:"function",constraints:{async:!0}}],setScalarTranspose:[{type:"number",constraints:{min:-10,max:10,integer:!0}},{type:"function",constraints:{async:!0}}],setSemitoneTranspose:[{type:"number",constraints:{min:-10,max:10,integer:!0}},{type:"function",constraints:{async:!0}}],setRegister:[{type:"number",constraints:{min:-3,max:3,integer:!0}}],invert:[{type:"string",constraints:{type:"solfegeorletter"}},{type:"number",constraints:{min:1,max:8,integer:!0}},{type:"string",constraints:{type:"oneof",values:["even","odd","scalar"],defaultIndex:0}}],setPitchNumberOffset:[{type:"string",constraints:{type:"solfegeorletter"}},{type:"number",constraints:{min:1,max:8,integer:!0}}],numToPitch:[{type:"number",constraints:{min:0,max:100,integer:!0}}],numToOctave:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setKey:[{type:"string",constraints:{type:"letterkey"}},{type:"string",constraints:{type:"oneof",values:["major","ionian","dorian","phrygian","lydian","myxolydian","minor","aeolian"],defaultIndex:0}}],MOVABLEDO:[{type:"boolean"}],setScalarInterval:[{type:"number",constraints:{min:-7,max:7,integer:!0}},{type:"function",constraints:{async:!0}}],setSemitoneInterval:[{type:"number",constraints:{min:-12,max:12,integer:!0}},{type:"function",constraints:{async:!0}}],setTemperament:[{type:"string",constraints:{type:"oneof",values:["equal","just intonation","Pythagorean","1/3 comma meantone","1/4 comma meantone"],defaultIndex:0}},{type:"string",constraints:{type:"solfegeorletter"}},{type:"number",constraints:{min:0,max:10,integer:!0}}],setInstrument:[{type:"string",constraints:{type:"synth"}},{type:"function",constraints:{async:!0}}],doVibrato:[{type:"number",constraints:{min:0,max:10,integer:!1}},{type:"number",constraints:{min:0,max:10,integer:!1}},{type:"function",constraints:{async:!0}}],doChorus:[{type:"number",constraints:{min:0,max:10,integer:!1}},{type:"number",constraints:{min:0,max:10,integer:!1}},{type:"number",constraints:{min:0,max:100,integer:!1}},{type:"function",constraints:{async:!0}}],doPhaser:[{type:"number",constraints:{min:0,max:20,integer:!1}},{type:"number",constraints:{min:0,max:3,integer:!0}},{type:"number",constraints:{min:20,max:2e4,integer:!1}},{type:"function",constraints:{async:!0}}],doTremolo:[{type:"number",constraints:{min:0,max:20,integer:!1}},{type:"number",constraints:{min:0,max:100,integer:!0}},{type:"function",constraints:{async:!0}}],doDistortion:[{type:"number",constraints:{min:0,max:100,integer:!0}},{type:"function",constraints:{async:!0}}],doHarmonic:[{type:"number",constraints:{min:0,max:11,integer:!0}},{type:"function",constraints:{async:!0}}],setStaccato:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],setSlur:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],doNeighbor:[{type:"number",constraints:{min:-7,max:7,integer:!0}},{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],doCrescendo:[{type:"number",constraints:{min:0,max:100,integer:!1}},{type:"function",constraints:{async:!0}}],doDecrescendo:[{type:"number",constraints:{min:0,max:100,integer:!1}},{type:"function",constraints:{async:!0}}],PANNING:[{type:"number",constraints:{min:-100,max:100,integer:!0}}],MASTERVOLUME:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setRelativeVolume:[{type:"number",constraints:{min:-50,max:50,integer:!1}},{type:"function",constraints:{async:!0}}],setSynthVolume:[{type:"string",constraints:{type:"synth"}},{type:"number",constraints:{min:0,max:100,integer:!1}}],getSynthVolume:[{type:"string",constraints:{type:"synth"}}],playDrum:[{type:"string",constraints:{type:"drum"}}],setDrum:[{type:"string",constraints:{type:"drum"}},{type:"function",constraints:{async:!0}}],mapPitchToDrum:[{type:"string",constraints:{type:"drum"}},{type:"function",constraints:{async:!0}}],playNoise:[{type:"string",constraints:{type:"noise"}}],goForward:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],goBackward:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],turnRight:[{type:"number",constraints:{min:-360,max:360,integer:!1}}],turnLeft:[{type:"number",constraints:{min:-360,max:360,integer:!1}}],setXY:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}},{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],setHeading:[{type:"number",constraints:{min:-360,max:360,integer:!1}}],drawArc:[{type:"number",constraints:{min:-360,max:360,integer:!1}},{type:"number",constraints:{min:0,max:1e5,integer:!1}}],drawBezier:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}},{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],setBezierControlPoint1:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}},{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],scrollXY:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}},{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],setColor:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setGrey:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setShade:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setHue:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setTranslucency:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setPensize:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setValue:[[{type:"string",constraints:{type:"any"}},{type:"number",constraints:{min:-1e3,max:1e3,integer:!0}}],[{type:"string",constraints:{type:"any"}},{type:"number",constraints:{min:-1e3,max:1e3,integer:!0}}],[{type:"string",constraints:{type:"any"}},{type:"undefined"}]],getValue:[[{type:"string",constraints:{type:"any"}},{type:"number",constraints:{min:-1e3,max:1e3,integer:!0}}],[{type:"string",constraints:{type:"any"}},{type:"undefined"}]],getDict:[[{type:"string",constraints:{type:"any"}},{type:"undefined"}]],showDict:[[{type:"string",constraints:{type:"any"}},{type:"undefined"}]]},"undefined"!=typeof module&&module.exports&&(module.exports={JSInterface:JSInterface});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var r,n,o,i,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return o=!(n=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return n=t.done,t},e:function(t){o=!0,r=t},f:function(){try{n||null==s.return||s.return()}finally{if(o)throw r}}};if(Array.isArray(t)||(s=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return s&&(t=s),i=0,{s:e=function(){},n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var r;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(r="Object"===(r={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,r){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var Mouse=(()=>{function r(t){_classCallCheck(this,r);var e=globalActivity.turtles.getTurtleCount();r.MouseList.length<e?this.turtle=globalActivity.turtles.getTurtle(r.MouseList.length):(globalActivity.turtles.addTurtle(),this.turtle=globalActivity.turtles.getTurtle(e-1),r.AddedTurtles.push(this.turtle)),this.turtle.initTurtle(!1),this.flow=t,this.MB=new MusicBlocks(this),r.MouseList.push(this),r.TurtleMouseMap[this.turtle.id]=this}return _createClass(r,[{key:"run",value:function(){this.turtle.doWait(0),this.flow(this.MB)}}],[{key:"getMouseFromTurtle",value:function(t){return t.id in r.TurtleMouseMap?r.TurtleMouseMap[t.id]:null}}])})(),MusicBlocks=(_defineProperty(Mouse,"MouseList",[]),_defineProperty(Mouse,"TurtleMouseMap",{}),_defineProperty(Mouse,"AddedTurtles",[]),function(){function MusicBlocks(t){var e=this;_classCallCheck(this,MusicBlocks),this.mouse=t,this.turtle=t.turtle,this.turIndex=globalActivity.turtles.getIndexOfTurtle(this.turtle),this.listeners=[],-1===MusicBlocks._blockNo&&(MusicBlocks._blockNo=0),["GraphicsBlocksAPI","PenBlocksAPI","RhythmBlocksAPI","MeterBlocksAPI","PitchBlocksAPI","IntervalsBlocksAPI","ToneBlocksAPI","OrnamentBlocksAPI","VolumeBlocksAPI","DrumBlocksAPI","DictBlocksAPI"].forEach(function(t){return importMembers(e,t)})}return _createClass(MusicBlocks,[{key:"runCommand",value:function runCommand(command,args){var _this2=this;return new Promise(function(resolve){var returnVal;if("_anonymous"===command)void 0!==args&&args();else{var _cname,cname=null,className;for(className in MusicBlocks._methodList)if(-1!==MusicBlocks._methodList[className].indexOf(command)){cname=className;break}cname="Painter"===cname?_this2.turtle.painter:eval(cname),returnVal=void 0===args||Array.isArray(args)&&0===args.length?cname[command]():(_cname=cname)[command].apply(_cname,_toConsumableArray(args))}var delay=_this2.turtle.waitTime;_this2.turtle.doWait(0),setTimeout(function(){return resolve(returnVal)},delay)})}},{key:"ENDFLOW",get:function(){return new Promise(function(t){return t()})}},{key:"ENDFLOWCOMMAND",get:function(){var r=this;return new Promise(function(t){var e=r.listeners.pop(),e=(null!=e&&globalActivity.stage.dispatchEvent(e),r.turtle.waitTime);r.turtle.doWait(0),setTimeout(t,e)})}},{key:"ENDMOUSE",get:function(){var e=this;return new Promise(function(t){Mouse.MouseList.splice(Mouse.MouseList.indexOf(e.mouse),1),0===Mouse.MouseList.length&&MusicBlocks.init(!1),t()})}},{key:"print",value:function(t){JSEditor.logConsole('Mouse "'.concat(this.turtle.name,'" (').concat(globalActivity.turtles.getIndexOfTurtle(this.turtle),"): ").concat(t)),void 0===t?globalActivity.textMsg("undefined"):null===t?globalActivity.textMsg("null"):globalActivity.textMsg(t.toString())}},{key:"X",get:function(){return globalActivity.turtles.screenX2turtleX(this.turtle.container.x)}},{key:"Y",get:function(){return globalActivity.turtles.screenY2turtleY(this.turtle.container.y)}},{key:"HEADING",get:function(){return this.turtle.orientation}},{key:"PENSIZE",get:function(){return this.turtle.painter.stroke}},{key:"COLOR",get:function(){return this.turtle.painter.color}},{key:"SHADE",get:function(){return this.turtle.painter.value}},{key:"GREY",get:function(){return this.turtle.painter.chroma}},{key:"NOTEVALUE",get:function(){return Singer.RhythmActions.getNoteValue(this.turIndex)}},{key:"PICKUP",set:function(t){t=JSInterface.validateArgs("PICKUP",[t]),t=Math.max(0,t[0]);Singer.MeterActions.setPickup(t,this.turIndex)}},{key:"WHOLENOTESPLAYED",get:function(){return Singer.MeterActions.getWholeNotesPlayed(this.turIndex)}},{key:"BEATCOUNT",get:function(){return Singer.MeterActions.getBeatCount(this.turIndex)}},{key:"MEASURECOUNT",get:function(){return Singer.MeterActions.getMeasureCount(this.turIndex)}},{key:"BPM",get:function(){return Singer.MeterActions.getBPM(this.turIndex)}},{key:"BEATFACTOR",get:function(){return Singer.MeterActions.getBeatFactor(this.turIndex)}},{key:"CURRENTMETER",get:function(){return Singer.MeterActions.getCurrentMeter(this.turIndex)}},{key:"SCALARCHANGEINPITCH",get:function(){return Singer.PitchActions.deltaPitch("deltapitch2",this.turIndex)}},{key:"CHANGEINPITCH",get:function(){return Singer.PitchActions.deltaPitch("deltapitch",this.turIndex)}},{key:"SCALARSTEPUP",get:function(){return Singer.PitchActions.consonantStepSize("up",this.turIndex)}},{key:"SCALARSTEPDOWN",get:function(){return Singer.PitchActions.consonantStepSize("down",this.turIndex)}},{key:"MOVABLEDO",set:function(t){t=JSInterface.validateArgs("MOVABLEDO",[t]);Singer.IntervalsActions.setMovableDo(t[0],this.turIndex)}},{key:"CURRENTKEY",get:function(){return Singer.IntervalsActions.getCurrentKey(this.turIndex)}},{key:"CURRENTMODE",get:function(){return Singer.IntervalsActions.getCurrentMode(this.turIndex)}},{key:"MODELENGTH",get:function(){return Singer.IntervalsActions.getModeLength(this.turIndex)}},{key:"PANNING",set:function(t){t=JSInterface.validateArgs("PANNING",[t]);Singer.VolumeActions.setPanning(t[0],this.turIndex)}},{key:"MASTERVOLUME",get:function(){return Singer.VolumeActions.masterVolume},set:function(t){t=JSInterface.validateArgs("MASTERVOLUME",[t]);Singer.VolumeActions.setMasterVolume(t[0],this.turIndex)}}],[{key:"BLK",get:function(){return"B"+MusicBlocks._blockNo++}},{key:"init",value:function init(start){function CreateAPIMethodList(){["Painter","Singer.RhythmActions","Singer.MeterActions","Singer.PitchActions","Singer.IntervalsActions","Singer.ToneActions","Singer.OrnamentActions","Singer.VolumeActions","Singer.DrumActions","Turtle.DictActions"].forEach(function(className){if(MusicBlocks._methodList[className]=[],"Painter"===className){var _iterator=_createForOfIteratorHelper(Object.getOwnPropertyNames(eval(className+".prototype"))),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var methodName=_step.value;"constructor"===methodName||methodName.startsWith("_")||MusicBlocks._methodList[className].push(methodName)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}else{var _iterator2=_createForOfIteratorHelper(Object.getOwnPropertyNames(eval(className))),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _methodName=_step2.value;"length"!==_methodName&&"prototype"!==_methodName&&MusicBlocks._methodList[className].push(_methodName)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}})}start?(MusicBlocks.isRun=!0,CreateAPIMethodList()):(MusicBlocks.isRun=!1,MusicBlocks._methodList={});var _iterator3=_createForOfIteratorHelper(Mouse.AddedTurtles),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var turtle=_step3.value,turIndex=(turtle.container.visible=!1,turtle.inTrash=!0,globalActivity.turtles.getIndexOfTurtle(turtle));globalActivity.turtles.removeTurtle(turIndex)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}MusicBlocks._blockNo=-1,Mouse.MouseList=[],Mouse.TurtleMouseMap={}}},{key:"run",value:function(){var t,e=_createForOfIteratorHelper(Mouse.MouseList);try{for(e.s();!(t=e.n()).done;){var r,n=t.value;for(r in n.turtle.listeners)globalActivity.logo.stage&&n.turtle.listeners.hasOwnProperty(r)&&globalActivity.logo.stage.removeEventListener(r,n.turtle.listeners[r],!1);n.turtle.listeners={}}}catch(t){e.e(t)}finally{e.f()}globalActivity.logo.prepSynths(),globalActivity.logo.firstNoteTime=null,Mouse.MouseList.forEach(function(t){return t.run()})}}])}());_defineProperty(MusicBlocks,"_methodList",{}),_defineProperty(MusicBlocks,"_blockNo",-1),_defineProperty(MusicBlocks,"isRun",!1),"undefined"!=typeof module&&module.exports&&(module.exports={Mouse:Mouse,MusicBlocks:MusicBlocks});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var o,r,n,l,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return n=!(r=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return r=e.done,e},e:function(e){n=!0,o=e},f:function(){try{r||null==a.return||a.return()}finally{if(n)throw o}}};if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),l=0,{s:t=function(){},n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var o;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(o="Object"===(o={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:o)||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var JSGenerate=(()=>{function b(){_classCallCheck(this,b)}return _createClass(b,null,[{key:"generateStacksTree",value:function(){b.startBlocks=[],b.actionBlocks=[],b.startTrees=[],b.actionTrees=[],b.actionNames=[],globalActivity.blocks.findStacks();var e,t=_createForOfIteratorHelper(globalActivity.blocks.stackList);try{for(t.s();!(e=t.n()).done;){var o,r,n=e.value;"start"!==globalActivity.blocks.blockList[n].name||globalActivity.blocks.blockList[n].trash?"action"!==globalActivity.blocks.blockList[n].name||globalActivity.blocks.blockList[n].trash||(o=globalActivity.blocks.blockList[n].connections[1],r=globalActivity.blocks.blockList[n].connections[2],null!==o&&null!==r&&b.actionBlocks.push(n)):b.startBlocks.push(n)}}catch(e){t.e(e)}finally{t.f()}function l(e,t,o){for(var r,n=e.connections[e.connections.length-2-(o=void 0===o?0:o)],n=globalActivity.blocks.blockList[n];void 0!==n&&("hidden"!==n.name&&"vspace"!==n.name&&(["storein2","nameddo"].includes(n.name)?t.push([n.name+"_"+n.privateData]):t.push([n.name]),r=function e(t){for(var o=t.protoblock.args,r=("clamp"===t.protoblock.style?--o:"doubleclamp"===t.protoblock.style&&(o-=2),[]),n=1;n<=o;n++){var l=globalActivity.blocks.blockList[t.connections[n]];if(void 0===l)r.push(null);else if("clamp"===l.protoblock.style&&!0===l.protoblock._style.flows.left)console.warn('CANNOT PROCESS "'.concat(l.name,'" BLOCK')),r.push(null);else{for(;"hspace"===l.name;)l=globalActivity.blocks.blockList[l.connections[1]];"value"===l.protoblock.style?JSInterface.isGetter(l.name)?r.push([l.name,null]):"BooleanBlock"===l.protoblock.__proto__.__proto__.constructor.name?"boolean"===l.name?r.push("bool_"+l.value):r.push([l.name,e(l)]):"namedbox"===l.name?r.push("box_"+l.privateData):r.push(l.value):"arg"===l.protoblock.style&&r.push([l.name,e(l)])}}return r}(n),last(t).push(0===r.length?null:r),"clamp"===n.protoblock.style?last(t).push(l(n,[])):"doubleclamp"===n.protoblock.style?(last(t).push(l(n,[],1)),last(t).push(l(n,[],0))):last(t).push(null)),0<n.connections.length)&&void 0!==(n=globalActivity.blocks.blockList[last(n.connections)]););return t}var a,c=_createForOfIteratorHelper(b.startBlocks);try{for(c.s();!(a=c.n()).done;){var i=a.value;b.startTrees.push(l(globalActivity.blocks.blockList[i],[]))}}catch(e){c.e(e)}finally{c.f()}var s,u=_createForOfIteratorHelper(b.actionBlocks);try{for(u.s();!(s=u.n()).done;){var f=s.value,y=globalActivity.blocks.blockList[globalActivity.blocks.blockList[f].connections[1]].value;null!=y&&(b.actionNames.push(y),b.actionTrees.push(l(globalActivity.blocks.blockList[f],[])))}}catch(e){u.e(e)}finally{u.f()}}},{key:"printStacksTree",value:function(){function c(e,t){void 0===t&&(t=0);var o,r=_createForOfIteratorHelper(e);try{for(r.s();!(o=r.n()).done;){for(var n=o.value,l="",a=0;a<4*t;a++)l+=" ";console.log("%c"+l+"%c"+n[0]+" : %c"+function e(t){if(null===t||0===t.length)return"none";var o,r="(",n=_createForOfIteratorHelper(t);try{for(n.s();!(o=n.n()).done;){var l=o.value;null===l?r+="null":"object"===_typeof(l)?r+=l[0]+e(l[1]):r+=l,r+=", "}}catch(e){n.e(e)}finally{n.f()}return r=r.substring(0,r.length-2)+")"}(n[1]),"background: mediumslateblue","background; none","color: dodgerblue"),null!==n[2]&&(c(n[2],t+1),4===n.length)&&null!==n[3]&&(console.log("%c"+l+"** NEXTFLOW **","color: green"),c(n[3],t+1))}}catch(e){r.e(e)}finally{r.f()}}if(0===b.startTrees.length)console.log("%cno start trees generated","color: tomato");else{var e,t=_createForOfIteratorHelper(b.startTrees);try{for(t.s();!(e=t.n()).done;){var o=e.value;console.log("\n   %c START ","background: navy; color: white; font-weight: bold"),c(o),console.log("\n")}}catch(e){t.e(e)}finally{t.f()}}if(0===b.startTrees.length)console.log("%cno action trees generated","color: tomato");else{var r,n=_createForOfIteratorHelper(b.actionTrees);try{for(n.s();!(r=n.n()).done;){var l=r.value;console.log("\n   %c ACTION ","background: green; color: white; font-weight: bold"),c(l),console.log("\n")}}catch(e){n.e(e)}finally{n.f()}}}},{key:"generateCode",value:function(){b.generateFailed=!1,b.AST=JSON.parse(JSON.stringify(ASTUtils.BAREBONE_AST));try{for(var e=0;e<b.actionTrees.length;e++)b.AST.body.splice(e,0,ASTUtils.getMethodAST(b.actionNames[e],b.actionTrees[e]));for(var t=b.actionTrees.length,o=0;o<b.startTrees.length;o++)b.AST.body.splice(o+t,0,ASTUtils.getMouseAST(b.startTrees[o]))}catch(e){b.generateFailed=!0,console.error("CANNOT GENERATE ABSTRACT SYNTAX TREE\nError:",e)}if(!b.generateFailed)try{b.code=astring.generate(b.AST,{indent:"    "})}catch(e){b.generateFailed=!0,console.error("CANNOT GENERATE CODE\nError: INVALID ABSTRACT SYNTAX TREE")}var r;b.generateFailed&&((r=JSON.parse(JSON.stringify(ASTUtils.BAREBONE_AST))).body.splice(0,0,ASTUtils.getMouseAST([])),b.code=astring.generate(r))}},{key:"run",value:function(e,t){b.generateStacksTree(),e&&(console.log("\n   %c STACK TREES ","background: greenyellow; color: midnightblue; font-weight: bold"),b.printStacksTree()),b.generateCode(),e&t&&console.log("%c _______________________________________","color: darkorange"),t&&(console.log("\n   %c CODE ","background: greenyellow; color: midnightblue; font-weight: bold"),console.log(b.code))}}])})();_defineProperty(JSGenerate,"startBlocks",[]),_defineProperty(JSGenerate,"actionBlocks",[]),_defineProperty(JSGenerate,"startTrees",[]),_defineProperty(JSGenerate,"actionTrees",[]),_defineProperty(JSGenerate,"actionNames",[]),_defineProperty(JSGenerate,"AST",{}),_defineProperty(JSGenerate,"code",""),_defineProperty(JSGenerate,"generateFailed",!1),"undefined"!=typeof module&&module.exports&&(module.exports={JSGenerate:JSGenerate});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n,r,o,i,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return o=!(r=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return r=e.done,e},e:function(e){o=!0,n=e},f:function(){try{r||null==a.return||a.return()}finally{if(o)throw n}}};if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),i=0,{s:t=function(){},n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var JSInterface=(()=>{function x(){_classCallCheck(this,x),_defineProperty(this,"_methodArgConstraints",{playNote:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],playNoteMillis:[{type:"number",constraints:{min:0,max:1e5,integer:!1}},{type:"function",constraints:{async:!0}}],dot:[{type:"number",constraints:{min:0,max:10,integer:!0}},{type:"function",constraints:{async:!0}}],tie:[{type:"function",constraints:{async:!0}}],multiplyNoteValue:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],swing:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],setMeter:[{type:"number",constraints:{min:1,max:16,integer:!0}},{type:"number",constraints:{min:0,max:1e3,integer:!1}}],PICKUP:[{type:"number",constraints:{min:0,max:1e3,integer:!1}}],setBPM:[{type:"number",constraints:{min:40,max:208,integer:!0}},{type:"number",constraints:{min:0,max:10,integer:!1}}],setMasterBPM:[{type:"number",constraints:{min:40,max:208,integer:!0}},{type:"number",constraints:{min:0,max:10,integer:!1}}],onEveryNoteDo:[{type:"string",constraints:{type:"any"}}],onEveryBeatDo:[{type:"string",constraints:{type:"any"}}],onStrongBeatDo:[{type:"number",constraints:{min:1,max:16,integer:!0}},{type:"string",constraints:{type:"any"}}],onWeakBeatDo:[{type:"string",constraints:{type:"any"}}],setNoClock:[{type:"function",constraints:{async:!0}}],getNotesPlayed:[{type:"number",constraints:{min:0,max:1e3,integer:!1}}],playPitch:[{type:"string",constraints:{type:"solfegeorletter"}},{type:"number",constraints:{min:1,max:8,integer:!0}}],stepPitch:[{type:"number",constraints:{min:-7,max:7,integer:!0}}],playNthModalPitch:[{type:"number",constraints:{min:-7,max:7,integer:!0}},{type:"number",constraints:{min:1,max:8,integer:!0}}],playPitchNumber:[{type:"number",constraints:{min:-3,max:12,integer:!0}}],playHertz:[{type:"number",constraints:{min:20,max:2e4,integer:!1}}],setAccidental:[{type:"string",constraints:{type:"accidental"}},{type:"function",constraints:{async:!0}}],setScalarTranspose:[{type:"number",constraints:{min:-10,max:10,integer:!0}},{type:"function",constraints:{async:!0}}],setSemitoneTranspose:[{type:"number",constraints:{min:-10,max:10,integer:!0}},{type:"function",constraints:{async:!0}}],setRegister:[{type:"number",constraints:{min:-3,max:3,integer:!0}}],invert:[{type:"string",constraints:{type:"solfegeorletter"}},{type:"number",constraints:{min:1,max:8,integer:!0}},{type:"string",constraints:{type:"oneof",values:["even","odd","scalar"],defaultIndex:0}}],setPitchNumberOffset:[{type:"string",constraints:{type:"solfegeorletter"}},{type:"number",constraints:{min:1,max:8,integer:!0}}],numToPitch:[{type:"number",constraints:{min:0,max:100,integer:!0}}],numToOctave:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setKey:[{type:"string",constraints:{type:"letterkey"}},{type:"string",constraints:{type:"oneof",values:["major","ionian","dorian","phrygian","lydian","myxolydian","minor","aeolian"],defaultIndex:0}}],MOVABLEDO:[{type:"boolean"}],setScalarInterval:[{type:"number",constraints:{min:-7,max:7,integer:!0}},{type:"function",constraints:{async:!0}}],setSemitoneInterval:[{type:"number",constraints:{min:-12,max:12,integer:!0}},{type:"function",constraints:{async:!0}}],setTemperament:[{type:"string",constraints:{type:"oneof",values:["equal","just intonation","Pythagorean","1/3 comma meantone","1/4 comma meantone"],defaultIndex:0}},{type:"string",constraints:{type:"solfegeorletter"}},{type:"number",constraints:{min:0,max:10,integer:!0}}],setInstrument:[{type:"string",constraints:{type:"synth"}},{type:"function",constraints:{async:!0}}],doVibrato:[{type:"number",constraints:{min:0,max:10,integer:!1}},{type:"number",constraints:{min:0,max:10,integer:!1}},{type:"function",constraints:{async:!0}}],doChorus:[{type:"number",constraints:{min:0,max:10,integer:!1}},{type:"number",constraints:{min:0,max:10,integer:!1}},{type:"number",constraints:{min:0,max:100,integer:!1}},{type:"function",constraints:{async:!0}}],doPhaser:[{type:"number",constraints:{min:0,max:20,integer:!1}},{type:"number",constraints:{min:0,max:3,integer:!0}},{type:"number",constraints:{min:20,max:2e4,integer:!1}},{type:"function",constraints:{async:!0}}],doTremolo:[{type:"number",constraints:{min:0,max:20,integer:!1}},{type:"number",constraints:{min:0,max:100,integer:!0}},{type:"function",constraints:{async:!0}}],doDistortion:[{type:"number",constraints:{min:0,max:100,integer:!0}},{type:"function",constraints:{async:!0}}],doHarmonic:[{type:"number",constraints:{min:0,max:11,integer:!0}},{type:"function",constraints:{async:!0}}],setStaccato:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],setSlur:[{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],doNeighbor:[{type:"number",constraints:{min:-7,max:7,integer:!0}},{type:"number",constraints:{min:0,max:1e3,integer:!1}},{type:"function",constraints:{async:!0}}],doCrescendo:[{type:"number",constraints:{min:0,max:100,integer:!1}},{type:"function",constraints:{async:!0}}],doDecrescendo:[{type:"number",constraints:{min:0,max:100,integer:!1}},{type:"function",constraints:{async:!0}}],PANNING:[{type:"number",constraints:{min:-100,max:100,integer:!0}}],MASTERVOLUME:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setRelativeVolume:[{type:"number",constraints:{min:-50,max:50,integer:!1}},{type:"function",constraints:{async:!0}}],setSynthVolume:[{type:"string",constraints:{type:"synth"}},{type:"number",constraints:{min:0,max:100,integer:!1}}],getSynthVolume:[{type:"string",constraints:{type:"synth"}}],playDrum:[{type:"string",constraints:{type:"drum"}}],setDrum:[{type:"string",constraints:{type:"drum"}},{type:"function",constraints:{async:!0}}],mapPitchToDrum:[{type:"string",constraints:{type:"drum"}},{type:"function",constraints:{async:!0}}],playNoise:[{type:"string",constraints:{type:"noise"}}],goForward:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],goBackward:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],turnRight:[{type:"number",constraints:{min:-360,max:360,integer:!1}}],turnLeft:[{type:"number",constraints:{min:-360,max:360,integer:!1}}],setXY:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}},{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],setHeading:[{type:"number",constraints:{min:-360,max:360,integer:!1}}],drawArc:[{type:"number",constraints:{min:-360,max:360,integer:!1}},{type:"number",constraints:{min:0,max:1e5,integer:!1}}],drawBezier:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}},{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],setBezierControlPoint1:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}},{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],scrollXY:[{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}},{type:"number",constraints:{min:-1e5,max:1e5,integer:!1}}],setColor:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setGrey:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setShade:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setHue:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setTranslucency:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setPensize:[{type:"number",constraints:{min:0,max:100,integer:!0}}],setValue:[[{type:"string",constraints:{type:"any"}},{type:"number",constraints:{min:-1e3,max:1e3,integer:!0}}],[{type:"string",constraints:{type:"any"}},{type:"number",constraints:{min:-1e3,max:1e3,integer:!0}}],[{type:"string",constraints:{type:"any"}},{type:"undefined"}]],getValue:[[{type:"string",constraints:{type:"any"}},{type:"number",constraints:{min:-1e3,max:1e3,integer:!0}}],[{type:"string",constraints:{type:"any"}},{type:"undefined"}]],getDict:[[{type:"string",constraints:{type:"any"}},{type:"undefined"}]],showDict:[[{type:"string",constraints:{type:"any"}},{type:"undefined"}]]})}return _createClass(x,null,[{key:"isClampBlock",value:function(e){return x._clampBlocks.includes(e)}},{key:"isSetter",value:function(e){return e in x._setterNameLookup}},{key:"isGetter",value:function(e){return e in x._getterNameLookup}},{key:"isMethod",value:function(e){return e in x._methodNameLookup}},{key:"methodReturns",value:function(e){return x._returningMethods.includes(e)}},{key:"getSetterName",value:function(e){return x.isSetter(e)?x._setterNameLookup[e]:null}},{key:"getGetterName",value:function(e){return x.isGetter(e)?x._getterNameLookup[e]:null}},{key:"getMethodName",value:function(e){return x.isMethod(e)?x._methodNameLookup[e]:null}},{key:"rearrangeMethodArgs",value:function(e,t){return t=e in x._rearrangeArgsLookup?x._rearrangeArgsLookup[e].map(function(e){return t[e]}):t}},{key:"validateArgs",value:function(e,t){if(!(e in x._methodArgConstraints))return t;var n,r=x._methodArgConstraints[e],o=[];for(n in r){var i,a,s=[t[n],r[n]],c=s[0],m=s[1];if(Array.isArray(m)){var u,y=_createForOfIteratorHelper(m);try{for(y.s();!(u=y.n()).done;){var p=u.value;if(_typeof(c)===p.type){m=p;break}}}catch(e){y.e(e)}finally{y.f()}if(Array.isArray(m))throw s='TypeMismatch error: expected one of "'.concat(m.map(function(e){return e.type}).toString(),'" but found "').concat(_typeof(c),'"'),JSEditor.logConsole(s,"maroon"),s}if(_typeof(c)!==m.type)if("string"==typeof c&&"number"===m.type){if(isNaN(Number(c)))throw s='TypeMismatch error: expected "number" but found "string"',JSEditor.logConsole(s,"maroon"),s;c=Number(c)}else{if("string"!=typeof c||"boolean"!==m.type)throw s='TypeMismatch error: expected "'.concat(m.type,'" but found "').concat(_typeof(c),'"'),JSEditor.logConsole(s,"maroon"),s;c="true"===c.toLowerCase()||"false"!==c.toLowerCase()&&(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ',!0)),!0)}switch(m.type){case"number":c<m.constraints.min?(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ').concat(m.constraints.min)),c=m.constraints.min):c>m.constraints.max&&(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ').concat(m.constraints.max)),c=m.constraints.max),m.constraints.integer&&!Number.isInteger(c)&&(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ').concat(Math.floor(c))),c=Math.floor(c));break;case"function":if(m.constraints.async&&"AsyncFunction"!==c[Symbol.toStringTag])throw l="".concat(t[0],' error: expected "async" function'),JSEditor.logConsole(l,"maroon"),l;break;case"string":if("solfegeorletter"===m.constraints.type){var l=c.split(" "),d=["do","re","mi","fa","sol","la","ti"];d.includes(l[0].toLowerCase())||["c","d","e","f","g","a","b"].includes(l[0].toLowerCase())?(c=d.includes(l[0].toLowerCase())?l[0].toLowerCase():l[0].toUpperCase(),1<l.length&&(d=[SHARP,FLAT,NATURAL,DOUBLESHARP,DOUBLEFLAT],g={sharp:SHARP,flat:FLAT,doublesharp:DOUBLESHARP,doubleflat:DOUBLEFLAT},d.includes(l[1])?c+=l[1]:l[1].toLowerCase()in g&&(c+=g[l[1].toLowerCase()]))):(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ',"sol")),c="sol")}else if("accidental"===m.constraints.type){var d=["sharp ".concat(SHARP),"flat ".concat(FLAT),"natural ".concat(NATURAL),"double sharp ".concat(DOUBLESHARP),"double flat ".concat(DOUBLEFLAT)],g=[SHARP,FLAT,NATURAL,DOUBLESHARP,DOUBLEFLAT],f=["sharp","flat","natural","doublesharp","doubleflat"];g.includes(c)?c=d[g.indexOf(c)]:f.includes(c.toLowerCase())&&(c=d[f.indexOf(c.toLowerCase())])}else if("oneof"===m.constraints.type){var b,h=-1;for(b in m.constraints.values)if(m.constraints.values[b].toLowerCase()===c.toLowerCase()){h=b;break}c=-1!==h?m.constraints.values[h]:(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ').concat(m.constraints.values[m.constraints.defaultIndex])),m.constraints.values[m.constraints.defaultIndex])}else"synth"===m.constraints.type?c=["piano","harmonuium","mandolin","violin","viola","cello","bass","double bass","sitar","guitar","acoustic guitar","flute","clarinet","saxophone","tuba","trumpet","oboe","trombone","banjo","koto","dulcimer","electric guitar","bassoon","celeste","xylophone","electronic synth","sine","square","sawtooth","triangle","vibraphone"].includes(c)?c.toLowerCase():(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ').concat(DEFAULTVOICE)),DEFAULTVOICE):"drum"===m.constraints.type?c=["snare drum","kick drum","tom tom","floor tom tom","cup drum","darbuka drum","japanese drum","hi hat","ride bell","cow bell","triangle bell","finger cymbals","chime","gong","clang","crash","clap","slap","raindrop"].includes(c)?c.toLowerCase():(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ',"kick drum")),"kick drum"):"noise"===m.constraints.type?c="white noise"===c.toLowerCase()?"noise1":"brown noise"===c.toLowerCase()?"noise2":"pink noise"===c.toLowerCase()?"noise3":(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ',"white noise")),"noise1"):"letterkey"===m.constraints.type&&(f=c.split(" "),["c","d","e","f","g","a","b"].includes(f[0].toLowerCase())?(c=f[0].toUpperCase(),1<f.length&&(i=[SHARP,FLAT,NATURAL,DOUBLESHARP,DOUBLEFLAT],a={sharp:SHARP,flat:FLAT,doublesharp:DOUBLESHARP,doubleflat:DOUBLEFLAT},i.includes(f[1])?c+=f[1]:f[1].toLowerCase()in a&&(c+=a[f[1].toLowerCase()]))):(JSEditor.logConsole("".concat(c,' in "').concat(e,'" reset to ',"C")),c="C"))}o.push(c)}return o}}])})();_defineProperty(JSInterface,"_clampBlocks",["newnote","osctime","rhythmicdot2","tie","multiplybeatfactor","newswing2","drift","accidental","setscalartransposition","settransposition","invert1","definemode","interval","semitoneinterval","settimbre","vibrato","chorus","phaser","tremolo","dis","harmonic2","newstaccato","newslur","neighbor2","crescendo","decrescendo","articulation","setdrum","mapdrum"]),_defineProperty(JSInterface,"_returningMethods",["getDict","getDict2","dictionary"]),_defineProperty(JSInterface,"_setterNameLookup",{pickup:"PICKUP",moveble:"MOVABLE",setnotevolume:"MASTERVOLUME",setpanning:"PANNING"}),_defineProperty(JSInterface,"_getterNameLookup",{mynotevalue:"NOTEVALUE",elapsednotes:"WHOLENOTESPLAYED",beatvalue:"BEATCOUNT",measurevalue:"MEASURECOUNT",bpmfactor:"BPM",beatfactor:"BEATFACTOR",currentmeter:"CURRENTMETER",deltapitch2:"SCALARCHANGEINPITCH",deltapitch:"CHANGEINPITCH",consonantstepsizeup:"SCALARSTEPUP",consonantstepsizedown:"SCALARSTEPDOWN",key:"CURRENTKEY",currentmode:"CURRENTMODE",modelength:"MODELENGTH",notevolumefactor:"MASTERVOLUME",x:"X",y:"Y",heading:"HEADING",pensize:"PENSIZE",color:"COLOR",shade:"SHADE",grey:"GREY"}),_defineProperty(JSInterface,"_methodNameLookup",{newnote:"playNote",osctime:"playNoteMillis",rest2:"playRest",rhythmicdot2:"dot",tie:"tie",multiplybeatfactor:"multiplyNoteValue",newswing2:"swing",meter:"setMeter",setbpm3:"setBPM",setmasterbpm2:"setMasterBPM",everybeatdo:"onEveryNoteDo",everybeatdonew:"onEveryBeatDo",onbeatdo:"onStrongBeatDo",offbeatdo:"onWeakBeatDo",drift:"setNoClock",elapsednotes2:"getNotesPlayed",pitch:"playPitch",steppitch:"stepPitch",nthmodalpitch:"playNthModalPitch",pitchnumber:"playPitchNumber",hertz:"playHertz",accidental:"setAccidental",setscalartransposition:"setScalarTranspose",settransposition:"setSemitoneTranspose",register:"setRegister",invert1:"invert",setpitchnumberoffset:"setPitchNumberOffset",number2pitch:"numToPitch",number2octave:"numToOctave",setkey2:"setKey",interval:"setScalarInterval",semitoneinterval:"setSemitoneInterval",settemperament:"setTemperament",settimbre:"setInstrument",vibrato:"doVibrato",chorus:"doChorus",phaser:"doPhaser",tremolo:"doTremolo",dis:"doDistortion",harmonic2:"doHarmonic",newstaccato:"setStaccato",newslur:"setSlur",neighbor2:"doNeighbor",crescendo:"doCrescendo",decrescendo:"doDecrescendo",articulation:"setRelativeVolume",setsynthvolume:"setSynthVolume",synthvolumefactor:"getSynthVolume",playdrum:"playDrum",setdrum:"setDrum",mapdrum:"mapPitchToDrum",playnoise:"playNoise",random:"MathUtility.doRandom",oneOf:"MathUtility.doOneOf",distance:"MathUtility.doCalculateDistance",forward:"goForward",back:"goBackward",right:"turnRight",left:"turnLeft",setxy:"setXY",setheading:"setHeading",arc:"drawArc",bezier:"drawBezier",controlpoint1:"setBezierControlPoint1",controlpoint2:"setBezierControlPoint2",clear:"clear",scrollxy:"scrollXY",setcolor:"setColor",setgrey:"setGrey",setshade:"setShade",sethue:"setHue",settranslucency:"setTranslucency",setpensize:"setPensize",penup:"penUp",pendown:"penDown",background:"fillBackground",setfont:"setFont",dictionary:"getDict",setDict:"setValue",getDict:"getValue",setDict2:"setValue",getDict2:"getValue",print:"print"}),_defineProperty(JSInterface,"_rearrangeArgsLookup",{setDict:[1,2,0],getDict:[1,0]}),"undefined"!=typeof module&&module.exports&&(module.exports=JSInterface);
var fs=require("fs"),jsonContent=fs.readFileSync("ast2blocks.json","utf8"),minified=JSON.stringify(JSON.parse(jsonContent));fs.writeFileSync("ast2blocks.min.json",minified);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupDictActions(o){Turtle.DictActions=(()=>_createClass(function t(){_classCallCheck(this,t)},null,[{key:"_GetDict",value:function(t,e,r,n){var i=o.turtles.ithTurtle(t);return r===_("color")?i.painter.color:r===_("shade")?i.painter.value:r===_("grey")?i.painter.chroma:r===_("pen size")?i.painter.pensize:r===_("font")?i.painter.font:r===_("heading")?i.painter.turtle.orientation:"x"===r?o.turtles.screenX2turtleX(i.container.x):"y"===r?o.turtles.screenY2turtleY(i.container.y):r===_("notes played")?i.singer.notesPlayed[0]/i.singer.notesPlayed[1]:r===_("note value")?Singer.RhythmActions.getNoteValue(t):r===_("current pitch")?i.singer.lastNotePlayed[0]:r===_("pitch number")?(r=null!==i.singer.lastNotePlayed?(t=i.singer.lastNotePlayed[0].length,[i.singer.lastNotePlayed[0].slice(0,t-1),parseInt(i.singer.lastNotePlayed[0].slice(t-1))]):0<i.singer.notePitches.length?getNote(i.singer.notePitches[0],i.singer.noteOctaves[0],0,i.singer.keySignature,i.singer.movable,null,o.errorMsg,o.logo.synth.inTemperament):(o.errorMsg(INVALIDPITCH,n),["G",4]),pitchToNumber(r[0],r[1],i.singer.keySignature)-i.singer.pitchNumberOffset):void 0}},{key:"SetDictValue",value:function(t,e,r,n){var i,t=o.turtles.ithTurtle(t);r===_("color")?t.painter.doSetColor(n):r===_("shade")?t.painter.doSetValue(n):r===_("grey")?t.painter.doSetChroma(n):r===_("pen size")?t.painter.doSetPensize(n):r===_("font")?t.painter.doSetFont(n):r===_("heading")?t.painter.doSetHeading(n):"y"===r?(i=o.turtles.screenX2turtleX(t.container.x),t.painter.doSetXY(i,n)):"x"===r&&(i=o.turtles.screenY2turtleY(t.container.y),t.painter.doSetXY(n,i))}},{key:"SerializeDict",value:function(t,e){var r=o.turtles.ithTurtle(t),n={};if(n[_("color")]=r.painter.color,n[_("shade")]=r.painter.value,n[_("grey")]=r.painter.chroma,n[_("pen size")]=r.painter.stroke,n[_("font")]=r.painter.font,n[_("heading")]=r.painter.orientation,n.y=o.turtles.screenY2turtleY(r.container.y),n.x=o.turtles.screenX2turtleX(r.container.x),t in o.logo.turtleDicts[e])for(var i in o.logo.turtleDicts[e][t])n[i]=o.logo.turtleDicts[e][t][i];return JSON.stringify(n)}},{key:"getDict",value:function(t,e){e in o.logo.turtleDicts||(o.logo.turtleDicts[e]={});var r=getTargetTurtle(o.turtles,t);return null!==r?Turtle.DictActions.SerializeDict(r,e):JSON.stringify(t in o.logo.turtleDicts[e]?o.logo.turtleDicts[e][t]:{})}},{key:"showDict",value:function(t,e){o.textMsg(Turtle.DictActions.getDict(t,e))}},{key:"setValue",value:function(t,e,r,n){n in o.logo.turtleDicts||(o.logo.turtleDicts[n]={}),t in o.logo.turtleDicts[n]||(o.logo.turtleDicts[n][t]={}),o.logo.turtleDicts[n][t][e]=r,console.log(o.logo.turtleDicts[n])}},{key:"getValue",value:function(t,e,r,n){return t in o.logo.turtleDicts[r]?e in o.logo.turtleDicts[r][t]?o.logo.turtleDicts[r][t][e]:_("Key with this name does not exist in ")+t:_("Dictionary with this name does not exist")}}]))()}"undefined"!=typeof module&&module.exports&&(module.exports=setupDictActions);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){var t;if(e)return"string"==typeof e?_arrayLikeToArray(e,r):"Map"===(t="Object"===(t={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=Array(r);t<r;t++)o[t]=e[t];return o}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,n,i,l,u=[],s=!0,a=!1;try{if(i=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;s=!1}else for(;!(s=(o=i.call(t)).done)&&(u.push(o.value),u.length!==r);s=!0);}catch(e){a=!0,n=e}finally{try{if(!s&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(a)throw n}}return u}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,r){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);t=t.call(e,r||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupDrumActions(s){Singer.DrumActions=(()=>_createClass(function e(){_classCallCheck(this,e)},null,[{key:"GetDrumname",value:function(e){if("http"===e.slice(0,4))return e;for(var r=0,t=Object.entries(DRUMNAMES);r<t.length;r++){var o=_slicedToArray(t[r],2)[1];if(o[0]===e)return o[1];if(o[1]===e)return e}return DEFAULTDRUM}},{key:"playDrum",value:function(e,r,t){var e=Singer.DrumActions.GetDrumname(e),o=s.turtles.ithTurtle(r);0<o.singer.drumStyle.length&&(e=last(o.singer.drumStyle)),0<o.singer.inNoteBlock.length?(o.singer.noteDrums[last(o.singer.inNoteBlock)].push(e),void 0===o.singer.synthVolume[e]&&(o.singer.synthVolume[e]=[DEFAULTVOLUME],o.singer.crescendoInitialVolume[e]=[DEFAULTVOLUME])):(s.logo.clearNoteParams(o,t,[]),o.singer.inNoteBlock.push(t),o.singer.noteDrums[last(o.singer.inNoteBlock)].push(e),Singer.processNote(s,4,!1,t,r,function(){return o.singer.inNoteBlock.splice(o.singer.inNoteBlock.indexOf(t),1)})),o.singer.pushedNote=!0}},{key:"setDrum",value:function(e,r,t){var o,n=DEFAULTDRUM;for(o in DRUMNAMES)DRUMNAMES[o][0]===e?n=DRUMNAMES[o][1]:DRUMNAMES[o][1]===e&&(n=e);var i,l=s.turtles.ithTurtle(r),u=(l.singer.drumStyle.push(n),"_setdrum_"+r);void 0!==t&&t in s.blocks.blockList?s.logo.setDispatchBlock(t,r,u):MusicBlocks.isRun&&null!==(i=Mouse.getMouseFromTurtle(l))&&i.MB.listeners.push(u);s.logo.setTurtleListener(r,u,function(){l.singer.drumStyle.pop(),l.singer.pitchDrumTable={}}),s.logo.inRhythmRuler&&(s.logo._currentDrumBlock=t,s.logo.rhythmRuler.Drums.push(t),s.logo.rhythmRuler.Rulers.push([[],[]]))}},{key:"mapPitchToDrum",value:function(e,r,t){var o,n=DEFAULTDRUM;for(o in DRUMNAMES)DRUMNAMES[o][0]===e?n=DRUMNAMES[o][1]:DRUMNAMES[o][1]===e&&(n=e);var i,l=s.turtles.ithTurtle(r),u=(l.singer.drumStyle.push(n),"_mapdrum_"+r);void 0!==t&&t in s.blocks.blockList?s.logo.setDispatchBlock(t,r,u):MusicBlocks.isRun&&null!==(i=Mouse.getMouseFromTurtle(l))&&i.MB.listeners.push(u);s.logo.setTurtleListener(r,u,function(){return l.singer.drumStyle.pop()}),s.logo.inRhythmRuler&&(s.logo._currentDrumBlock=t,s.logo.rhythmRuler.Drums.push(t),s.logo.rhythmRuler.Rulers.push([[],[]]))}},{key:"playNoise",value:function(e,r,t){var o,n=e;for(o in NOISENAMES){if(NOISENAMES[o][0]===e){n=NOISENAMES[o][1];break}if(NOISENAMES[o][1]===e){n=e;break}}r=s.turtles.ithTurtle(r);0<r.singer.inNoteBlock.length?(r.singer.noteDrums[last(r.singer.inNoteBlock)].push(n),void 0===r.singer.synthVolume[n]&&(r.singer.synthVolume[n]=[DEFAULTVOLUME],r.singer.crescendoInitialVolume[n]=[DEFAULTVOLUME]),r.singer.noteBeatValues[last(r.singer.inNoteBlock)].push(r.singer.beatFactor),r.singer.pushedNote=!0):s.errorMsg(_("Noise Block: Did you mean to use a Note block?"),t)}}]))()}"undefined"!=typeof module&&module.exports&&(module.exports=setupDrumActions);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupIntervalsActions(l){Singer.IntervalsActions=(()=>{return _createClass(function e(){_classCallCheck(this,e)},null,[{key:"GetModename",value:function(e){var t,r="major";for(t in MUSICALMODES)if(t===e||_(t)===e){r=t;break}return r}},{key:"GetIntervalNumber",value:function(e){var e=l.turtles.ithTurtle(e),e=GetNotesForInterval(e),t=e.firstNote,r=e.secondNote,n=e.octave,o=Math.abs(ALLNOTESTEP[t]-ALLNOTESTEP[r]);for(ALLNOTESTEP[r]<ALLNOTESTEP[t]&&0!==n&&(o=12-o),n<0&&0!==o&&12!==o&&(o=12-o),(n<-1||0===o)&&(n=Math.abs(n));0<n;)o+=12,n--;return o}},{key:"GetCurrentInterval",value:function(e){var t=l.turtles.ithTurtle(e),t=GetNotesForInterval(t),r=t.firstNote,n=t.secondNote,t=t.octave,r=NOTENAMES.indexOf(r.substring(0,1)),n=NOTENAMES.indexOf(n.substring(0,1)),o="",i=Math.abs(n-r),s=(n<r&&0!==t&&(i=NOTENAMES.length-i),this.GetIntervalNumber(e)),n=[_("one"),_("two"),_("three"),_("four"),_("five"),_("six"),_("seven"),_("eight"),_("nine")],r=1<Math.abs(t)?_("octaves"):_("octave"),e=n[Math.abs(t)-1]||Math.abs(t);if(s%12==0&&0===i){if(t<0)return(n=(e=-1===t?"":e)+" "+_("perfect")+" "+r+" "+_("below")).charAt(0).toUpperCase()+n.slice(1);if(1<t)return(n=e+" "+_("perfect")+" "+r+" "+_("above")).charAt(0).toUpperCase()+n.slice(1)}if(21<s)for(1<=t&&(o=", "+_("plus")+" "+e+" "+r);12<s;)s-=12;return t<0&&(i=0!==i?NOTENAMES.length-i:i,t<-1&&(o=",  ".concat(e," ").concat(r)),o=(o+=" ")+_("below")),s%12==0&&0===i?SEMITONETOINTERVALMAP[s][i]:SEMITONETOINTERVALMAP[s][i]+o}},{key:"setKey",value:function(e,t,r){var t=Singer.IntervalsActions.GetModename(t),n=l.turtles.ithTurtle(r),e=getNote(e,4,n.singer.transposition,n.singer.keySignature,!1,null,l.errorMsg,l.logo.synth.inTemperament);n.singer.keySignature=e[0]+" "+t,l.logo.notation.notationKey(r,e[0],t)}},{key:"getCurrentKey",value:function(e){return l.turtles.ithTurtle(e).singer.keySignature.split(" ")[0]}},{key:"getCurrentMode",value:function(e){return l.turtles.ithTurtle(e).singer.keySignature.split(" ")[1]}},{key:"getModeLength",value:(t=function(e){return getModeLength(l.turtles.ithTurtle(e).singer.keySignature)},e.toString=function(){return t.toString()},e)},{key:"setMovableDo",value:function(e,t){l.turtles.ithTurtle(t).singer.movable=e}},{key:"defineMode",value:function(e,t,n){var o,r,i=l.turtles.ithTurtle(t),e=(i.singer.inDefineMode=!0,i.singer.defineMode=[],o=null===e?(l.errorMsg(NOINPUTERRORMSG,n),"custom"):e.toLowerCase(),"_definemode_"+t);void 0!==n&&n in l.blocks.blockList?l.logo.setDispatchBlock(n,t,e):MusicBlocks.isRun&&null!==(r=Mouse.getMouseFromTurtle(i))&&r.MB.listeners.push(e);l.logo.setTurtleListener(t,e,function(){MUSICALMODES[o]=[],i.singer.defineMode.includes(0)||(i.singer.defineMode.push(0),l.errorMsg(_("Adding missing pitch number 0.")));for(var e=i.singer.defineMode.sort(function(e,t){return e[0]-t[0]}),t=0;t<e.length;t++)e[t]<0||11<e[t]?l.errorMsg(_("Ignoring pitch numbers less than zero or greater than eleven.")):0<t&&e[t]===e[t-1]?l.errorMsg(_("Ignoring duplicate pitch numbers.")):t<e.length-1?MUSICALMODES[o].push(e[t+1]-e[t]):MUSICALMODES[o].push(12-e[t]);var r=l.blocks.blockList[n].connections[1];"text"===l.blocks.blockList[r].name&&l.blocks.updateBlockText(r),i.singer.inDefineMode=!1})}},{key:"setScalarInterval",value:function(e,t,r){null!==e&&"number"==typeof e||(l.errorMsg(NOINPUTERRORMSG,r),e=1);var n=l.turtles.ithTurtle(t),e=0<e?Math.floor(e):Math.ceil(e),e=(n.singer.intervals.push(e),"_interval_"+t);void 0!==r&&r in l.blocks.blockList?l.logo.setDispatchBlock(r,t,e):MusicBlocks.isRun&&null!==(r=Mouse.getMouseFromTurtle(n))&&r.MB.listeners.push(e);l.logo.setTurtleListener(t,e,function(){return n.singer.intervals.pop()})}},{key:"setChordInterval",value:function(e,t,r){null===e&&(l.errorMsg(NOINPUTERRORMSG,r),e=[1,0]);var n=l.turtles.ithTurtle(t),e=(n.singer.chordIntervals.push(e),"_chord_interval_"+t);void 0!==r&&r in l.blocks.blockList?l.logo.setDispatchBlock(r,t,e):MusicBlocks.isRun&&null!==(r=Mouse.getMouseFromTurtle(n))&&r.MB.listeners.push(e);l.logo.setTurtleListener(t,e,function(){return n.singer.chordIntervals.pop()})}},{key:"setSemitoneInterval",value:function(e,t,r){null!==e&&"number"==typeof e||(l.errorMsg(NOINPUTERRORMSG,r),e=1);var n=l.turtles.ithTurtle(t),e=0<e?Math.floor(e):Math.ceil(e);0!==e&&(n.singer.semitoneIntervals.push([e,n.singer.noteDirection]),e="_semitone_interval_"+t,void(n.singer.noteDirection=0)!==r&&r in l.blocks.blockList?l.logo.setDispatchBlock(r,t,e):MusicBlocks.isRun&&null!==(r=Mouse.getMouseFromTurtle(n))&&r.MB.listeners.push(e),l.logo.setTurtleListener(t,e,function(){return n.singer.semitoneIntervals.pop()}))}},{key:"setRatioInterval",value:function(e,t,r){null!==e&&"number"==typeof e||l.errorMsg(NOINPUTERRORMSG,r);var n=l.turtles.ithTurtle(t),e=(n.singer.ratioIntervals.push(e),"_ratio_interval_"+t);void 0!==r&&r in l.blocks.blockList?l.logo.setDispatchBlock(r,t,e):MusicBlocks.isRun&&null!==(r=Mouse.getMouseFromTurtle(n))&&r.MB.listeners.push(e);l.logo.setTurtleListener(t,e,function(){return n.singer.ratioIntervals.pop()})}},{key:"setTemperament",value:function(e,t,r){l.logo.synth.inTemperament=e,l.logo.synth.startingPitch=t+""+r,l.logo.temperamentSelected.push(e);t=l.logo.temperamentSelected.length;l.logo.temperamentSelected[t-1]!==l.logo.temperamentSelected[t-2]&&(l.logo.synth.changeInTemperament=!0)}}]);function e(e){return t.apply(this,arguments)}var t})()}"undefined"!=typeof module&&module.exports&&(module.exports={setupIntervalsActions:setupIntervalsActions});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupMeterActions(l){Singer.MeterActions=(()=>_createClass(function e(){_classCallCheck(this,e)},null,[{key:"setMeter",value:function(e,t,r){var n=l.turtles.ithTurtle(r);n.singer.beatsPerMeasure=e<=0?4:e,n.singer.noteValuePerBeat=t<=0?4:1/t,4==n.singer.noteValuePerBeat&&4==n.singer.beatsPerMeasure?(n.singer.beatList.push(1),n.singer.beatList.push(3),n.singer.defaultStrongBeats=!0):4==n.singer.noteValuePerBeat&&2==n.singer.beatsPerMeasure||4==n.singer.noteValuePerBeat&&3==n.singer.beatsPerMeasure?(n.singer.beatList.push(1),n.singer.defaultStrongBeats=!0):8==n.singer.noteValuePerBeat&&6==n.singer.beatsPerMeasure&&(n.singer.beatList.push(1),n.singer.beatList.push(4),n.singer.defaultStrongBeats=!0),l.logo.notation.notationMeter(r,n.singer.beatsPerMeasure,n.singer.noteValuePerBeat)}},{key:"setPickup",value:function(e,t){var r=l.turtles.ithTurtle(t);r.singer.pickup=Math.max(0,e),l.logo.notation.notationPickup(t,r.singer.pickup)}},{key:"setBPM",value:function(e,t,r,n){var i,s,e=e*t/.25;e<30?(i=rationalToFraction(t),s=7.5/t,l.errorMsg(i[0]+"/"+i[1]+" "+_("beats per minute must be greater than")+" "+s,n),e=30):1e3<e&&(i=rationalToFraction(t),s=250/t,l.errorMsg(_("maximum")+" "+i[0]+"/"+i[1]+" "+_("beats per minute is")+" "+s,n),e=1e3),l.turtles.ithTurtle(r).singer.bpm.push(e)}},{key:"setMasterBPM",value:function(e,t,r){var n,i,e=e*t/.25;e<30?(n=rationalToFraction(t),i=7.5/t,l.errorMsg(n[0]+"/"+n[1]+" "+_("beats per minute must be greater than")+" "+i,r),Singer.masterBPM=30):1e3<e?(n=rationalToFraction(t),i=250/t,l.errorMsg(_("maximum")+" "+n[0]+"/"+n[1]+" "+_("beats per minute is")+" "+i,r),Singer.masterBPM=1e3):Singer.masterBPM=e,Singer.defaultBPMFactor=TONEBPM/Singer.masterBPM}},{key:"onEveryNoteDo",value:function(t,e,r,n,i){var s=l.turtles.ithTurtle(n),u=s.id;l.logo.setTurtleListener(n,"__everybeat_"+u+"__",function(){var e=new Queue(l.logo.actions[t],1,i);s.parentFlowQueue.push(i),s.queue.push(e)}),s.singer.beatList.push("everybeat")}},{key:"onEveryBeatDo",value:function(t,r,n,i,s){var e=i,u=(l.turtles.getTurtle(e).companionTurtle||(i=l.turtles.getTurtleCount(),l.turtles.getTurtle(e).companionTurtle=i,l.turtles.addTurtle(l.blocks.blockList[s],{}),l.logo.prepSynths()),i=l.turtles.getTurtle(e).companionTurtle,l.turtles.ithTurtle(i)),o="__everybeat_"+i+"__",e=(u.queue=[],u.parentFlowQueue=[],u.unhighlightQueue=[],u.parameterQueue=[],l.logo.initTurtle(i),l.logo.setTurtleListener(i,o,function(){var e;u.running?(e=new Queue(l.logo.actions[t],1,s),u.parentFlowQueue.push(s),u.queue.push(e)):l.logo.runFromBlockNow(l.logo,i,l.logo.actions[t],r,n)}),l.turtles.ithTurtle(e)),e=4*(60/(0<e.singer.bpm.length?last(e.singer.bpm):Singer.masterBPM))/e.singer.noteValuePerBeat;void 0!==u.interval&&clearInterval(u.interval),l.stage.dispatchEvent(o),u.interval=setInterval(function(){return l.stage.dispatchEvent(o)},1e3*e)}},{key:"onStrongBeatDo",value:function(e,t,r,n,i,s){var u=l.turtles.ithTurtle(i),o=u.id;if(l.logo.setTurtleListener(i,"__beat_"+e+"_"+o+"__",function(){var e=new Queue(l.logo.actions[t],1,s);u.parentFlowQueue.push(s),u.queue.push(e)}),u.singer.defaultStrongBeats){for(var a=0;a<u.singer.beatList.length;a++)"everybeat"!==u.singer.beatList[a]&&"offbeat"!==u.singer.beatList[a]&&(u.singer.beatList.splice(a,1),a--);u.singer.defaultStrongBeats=!1}(e>u.singer.beatsPerMeasure?u.singer.factorList:u.singer.beatList).push(e)}},{key:"onWeakBeatDo",value:function(t,e,r,n,i){var s=l.turtles.ithTurtle(n),u=s.id;l.logo.setTurtleListener(n,"__offbeat_"+u+"__",function(){var e=new Queue(l.logo.actions[t],1,i);s.parentFlowQueue.push(i),s.queue.push(e)}),l.turtles.ithTurtle(n).singer.beatList.push("offbeat")}},{key:"setNoClock",value:function(e,t){var r=l.turtles.ithTurtle(e),n=(r.singer.drift++,"_drift_"+e);void 0!==t&&t in l.blocks.blockList?l.logo.setDispatchBlock(t,e,n):MusicBlocks.isRun&&null!==(t=Mouse.getMouseFromTurtle(r))&&t.MB.listeners.push(n);l.logo.setTurtleListener(e,n,function(){0<r.singer.drift&&r.singer.drift--})}},{key:"getNotesPlayed",value:function(e,t){return null===e||0===e?0:(t=l.turtles.ithTurtle(t)).singer.notesPlayed[0]/t.singer.notesPlayed[1]/e}},{key:"getWholeNotesPlayed",value:function(e){e=l.turtles.ithTurtle(e);return e.singer.notesPlayed[0]/e.singer.notesPlayed[1]}},{key:"getBeatCount",value:function(e){e=l.turtles.ithTurtle(e);return e.singer.notesPlayed[0]/e.singer.notesPlayed[1]<e.singer.pickup?0:(e.singer.notesPlayed[0]/e.singer.notesPlayed[1]-e.singer.pickup)*e.singer.noteValuePerBeat%e.singer.beatsPerMeasure+1}},{key:"getMeasureCount",value:function(e){e=l.turtles.ithTurtle(e);return e.singer.notesPlayed[0]/e.singer.notesPlayed[1]<e.singer.pickup?0:Math.floor((e.singer.notesPlayed[0]/e.singer.notesPlayed[1]-e.singer.pickup)*e.singer.noteValuePerBeat/e.singer.beatsPerMeasure)+1}},{key:"getBPM",value:function(e){e=l.turtles.ithTurtle(e);return 0<e.singer.bpm.length?last(e.singer.bpm):Singer.masterBPM}},{key:"getBeatFactor",value:function(e){return Singer.RhythmActions.getNoteValue(e)*l.turtles.ithTurtle(e).singer.noteValuePerBeat}},{key:"getCurrentMeter",value:function(e){e=l.turtles.ithTurtle(e);return e.singer.beatsPerMeasure+":"+e.singer.noteValuePerBeat}}]))()}"undefined"!=typeof module&&module.exports&&(module.exports=setupMeterActions);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0===o)return("string"===e?String:Number)(t);o=o.call(t,e||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupOrnamentActions(i){Singer.OrnamentActions=(()=>_createClass(function t(){_classCallCheck(this,t)},null,[{key:"setStaccato",value:function(t,e,o){var n=i.turtles.ithTurtle(e),t=(n.singer.staccato.push(1/t),"_staccato_"+e);void 0!==o&&o in i.blocks.blockList?i.logo.setDispatchBlock(o,e,t):MusicBlocks.isRun&&null!==(o=Mouse.getMouseFromTurtle(n))&&o.MB.listeners.push(t);i.logo.setTurtleListener(e,t,function(){return n.singer.staccato.pop()})}},{key:"setSlur",value:function(t,e,o){var n=i.turtles.ithTurtle(e),t=(n.singer.staccato.push(-1/t),0===n.singer.justCounting.length&&i.logo.notation.notationBeginSlur(e),"_staccato_"+e);void 0!==o&&o in i.blocks.blockList?i.logo.setDispatchBlock(o,e,t):MusicBlocks.isRun&&null!==(o=Mouse.getMouseFromTurtle(n))&&o.MB.listeners.push(t);i.logo.setTurtleListener(e,t,function(){n.singer.staccato.pop(),0===n.singer.justCounting.length&&i.logo.notation.notationEndSlur(e)})}},{key:"doNeighbor",value:function(t,e,o,n){var r=i.turtles.ithTurtle(o),t=(r.singer.inNeighbor.push(n),r.singer.neighborStepPitch.push(t),r.singer.neighborNoteValue.push(e),"_neighbor_"+o+"_"+n);void 0!==n&&n in i.blocks.blockList?i.logo.setDispatchBlock(n,o,t):MusicBlocks.isRun&&null!==(e=Mouse.getMouseFromTurtle(r))&&e.MB.listeners.push(t);i.logo.setTurtleListener(o,t,function(){r.singer.inNeighbor.pop(),r.singer.neighborStepPitch.pop(),r.singer.neighborNoteValue.pop()})}}]))()}"undefined"!=typeof module&&module.exports&&(module.exports=setupOrnamentActions);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,l=[],a=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;a=!1}else for(;!(a=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);a=!0);}catch(e){u=!0,i=e}finally{try{if(!a&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupPitchActions(c){Singer.PitchActions=(()=>_createClass(function e(){_classCallCheck(this,e)},null,[{key:"playPitch",value:function(e,t,r,n,i){Singer.processPitch(c,e,t,r,n,i)}},{key:"stepPitch",value:function(e,t,r){var n,i,o,s,l=c.turtles.ithTurtle(t);c.logo.inMatrix||c.logo.inMusicKeyboard||0!==l.singer.inNoteBlock.length||(l.singer.lastNotePlayed=["G4",4]),"number"!=typeof e?(c.errorMsg(NANERRORMSG,r),c.logo.stopTurtle=!0):(0<l.singer.justCounting.length&&null===l.singer.lastNotePlayed&&(l.singer.previousNotePlayed=["G4",4],l.singer.lastNotePlayed=["G4",4]),null===l.singer.lastNotePlayed&&(l.singer.lastNotePlayed=["G4",4]),"number"==typeof(i=l.singer.lastNotePlayed)[n=0]?(o=(i=frequencyToPitch(i[0]))[0],s=i[1],n=i[2]):(o=i[0].slice(0,i[0].length-1),s=parseInt(i[0].slice(i[0].length-1,i[0].length))),l.singer.inverted&&(i=Singer.calculateInvert(c.logo,t,o,s,n),o=(i=getNote(o,s,2*i,l.singer.keySignature,l.singer.movable,null,c.errorMsg,c.logo.synth.inTemperament))[0],s=i[1]),l=Singer.addScalarTransposition(c.logo,t,o,s,e),Singer.processPitch(c,l[0],l[1],n,t,r))}},{key:"playNthModalPitch",value:function(e,t,r,n){var i=c.turtles.ithTurtle(r),o=(e=Math.round(e))<0,s=(e=Math.abs(e),keySignatureToMode(i.singer.keySignature)),l=MUSICALMODES[s[1]].length,a=Math.floor(e-1)%l+1,u=NOTESTEP[s[0].substr(0,1)]-1,s=(s[0].substr(1)===FLAT?u--:s[0].substr(1)===SHARP&&u++,nthDegreeToPitch(i.singer.keySignature,o?l-a:a)),a=u;a+=NOTESFLAT.includes(s)?NOTESFLAT.indexOf(s)-u:NOTESSHARP.indexOf(s)-u;e=(o?-1:1)*(Math.floor(e/l)+(o?u<a?1:0:a<u?1:0))+Math.floor(calcOctave(i.singer.currentOctave,t,i.singer.lastNotePlayed,s));Singer.processPitch(c,s,e,0,r,n)}},{key:"playPitchNumber",value:function(e,t,r){var n=c.turtles.ithTurtle(t);n.singer.inDefineMode?n.singer.defineMode.push(e):(isCustomTemperament(c.logo.synth.inTemperament)&&n.singer.scalarTransposition+n.singer.transposition!==0&&c.errorMsg(_("Scalar transpositions are equal to Semitone transpositions for custom temperament.")),e=numberToPitch(e+n.singer.pitchNumberOffset,c.logo.synth.inTemperament,c.logo.synth.startingPitch,n.singer.pitchNumberOffset),Singer.processPitch(c,e[0],e[1],0,t,r))}},{key:"playHertz",value:function(e,t,r){var n=c.turtles.ithTurtle(t),i=frequencyToPitch(e),o=i[0];Singer.processPitch(c,o,i[1],i[2],t,r),0<n.singer.inNoteBlock.length&&c.logo.runningLilypond&&c.logo.notation.notationMarkup(t,e)}},{key:"setAccidental",value:function(e,t,r){var n,i=ACCIDENTALNAMES.indexOf(e);if(-1===i)switch(e){case _("sharp"):return void(n=1);case _("flat"):return void(n=-1);default:return void(n=0)}else n=ACCIDENTALVALUES[i];var o=c.turtles.ithTurtle(t),e=(o.singer.transposition+=0<o.singer.invertList.length?-n:n,"_accidental_"+t+"_"+r);void 0!==r&&r in c.blocks.blockList?c.logo.setDispatchBlock(r,t,e):MusicBlocks.isRun&&null!==(i=Mouse.getMouseFromTurtle(o))&&i.MB.listeners.push(e);c.logo.setTurtleListener(t,e,function(){o.singer.transposition+=0<o.singer.invertList.length?n:-n})}},{key:"setScalarTranspose",value:function(e,t,r){var n=c.turtles.ithTurtle(t),i=(n.singer.scalarTransposition+=0<n.singer.invertList.length?-e:e,n.singer.scalarTranspositionValues.push(e),"_scalar_transposition_"+t);void 0!==r&&r in c.blocks.blockList?c.logo.setDispatchBlock(r,t,i):MusicBlocks.isRun&&null!==(r=Mouse.getMouseFromTurtle(n))&&r.MB.listeners.push(i);c.logo.setTurtleListener(t,i,function(){e=n.singer.scalarTranspositionValues.pop(),n.singer.scalarTransposition+=0<n.singer.invertList.length?e:-e})}},{key:"setSemitoneTranspose",value:function(e,t,r){var n=c.turtles.ithTurtle(t),i=(n.singer.transposition+=0<n.singer.invertList.length?-e:e,n.singer.transpositionValues.push(e),"_transposition_"+t);void 0!==r&&r in c.blocks.blockList?c.logo.setDispatchBlock(r,t,i):MusicBlocks.isRun&&null!==(r=Mouse.getMouseFromTurtle(n))&&r.MB.listeners.push(i);c.logo.setTurtleListener(t,i,function(){e=n.singer.transpositionValues.pop(),n.singer.transposition+=0<n.singer.invertList.length?e:-e})}},{key:"setRatioTranspose",value:function(e,t,r){var n=c.turtles.ithTurtle(t),e=(n.singer.transpositionRatios.push(e),"_transposition_ratio_"+t);void 0!==r&&r in c.blocks.blockList?c.logo.setDispatchBlock(r,t,e):MusicBlocks.isRun&&null!==(r=Mouse.getMouseFromTurtle(n))&&r.MB.listeners.push(e);c.logo.setTurtleListener(t,e,function(){n.singer.transpositionRatios.pop()})}},{key:"setRegister",value:function(e,t){c.turtles.ithTurtle(t).singer.register=Math.floor(e)}},{key:"invert",value:function(e,t,r,n,i){(r="number"==typeof r?r%2==0?"even":"odd":r)===_("even")?r="even":r===_("odd")?r="odd":r===_("scalar")&&(r="scalar");var o=c.turtles.ithTurtle(n),e=("even"!==r&&"odd"!==r&&"scalar"!==r||(t=calcOctave(o.singer.currentOctave,t,o.singer.lastNotePlayed,e),o.singer.invertList.push([e,t,r])),"_invert_"+n);void 0!==i&&i in c.blocks.blockList?c.logo.setDispatchBlock(i,n,e):MusicBlocks.isRun&&null!==(t=Mouse.getMouseFromTurtle(o))&&t.MB.listeners.push(e);c.logo.setTurtleListener(n,e,function(){o.singer.invertList.pop(),o.singer.inverted=!1})}},{key:"numToPitch",value:function(e,t,r){if(null!==e&&"number"==typeof e)return e=numberToPitch(Math.floor(e)+c.turtles.ithTurtle(r).singer.pitchNumberOffset),"pitch"===t?e[0]:e[1];throw"NoArgError"}},{key:"setPitchNumberOffset",value:function(e,t,r){r=c.turtles.ithTurtle(r),t=Math.floor(calcOctave(r.singer.currentOctave,t,r.singer.lastNotePlayed,e));r.singer.pitchNumberOffset=pitchToNumber(e,t,r.singer.keySignature)}},{key:"deltaPitch",value:function(e,t){var r=c.turtles.ithTurtle(t);if(null==r.singer.previousNotePlayed)return 0;var t=r.singer.previousNotePlayed[0].length,n=r.singer.previousNotePlayed[0].slice(0,t-1),i=parseInt(r.singer.previousNotePlayed[0].slice(t-1)),o=[n,i],s=pitchToNumber(o[0],o[1],r.singer.keySignature),t=r.singer.lastNotePlayed[0].length,n=r.singer.lastNotePlayed[0].slice(0,t-1),i=parseInt(r.singer.lastNotePlayed[0].slice(t-1)),o=[n,i],l=pitchToNumber(o[0],o[1],r.singer.keySignature)-s;if("deltapitch"===e)return l;function a(e){var t=("up"===e?getStepSizeUp:getStepSizeDown)(r.singer.keySignature,n,0,"equal"),e=(l-=t,u+="up"===e?1:-1,_slicedToArray(o=getNote(n,i,t,r.singer.keySignature,r.singer.movable,null,c.errorMsg,c.logo.synth.inTemperament),2));n=e[0],i=e[1]}var u=0;if(0<l)for(;0<l;)a("up");else for(;l<0;)a("down");return u}},{key:"consonantStepSize",value:function(e,t){var r,t=c.turtles.ithTurtle(t);return null!==t.singer.lastNotePlayed?(r=t.singer.lastNotePlayed[0].length,("up"===e?getStepSizeUp:getStepSizeDown)(t.singer.keySignature,t.singer.lastNotePlayed[0].slice(0,r-1))):("up"===e?getStepSizeUp:getStepSizeDown)(t.singer.keySignature,"G")}}]))()}"undefined"!=typeof module&&module.exports&&(module.exports=setupPitchActions);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupRhythmActions(d){Singer.RhythmActions=(()=>_createClass(function e(){_classCallCheck(this,e)},null,[{key:"playNote",value:function(e,t,n,i,s){var o=d.turtles.ithTurtle(n);if(0===o.singer.inNoteBlock.length){o.singer.notesPlayed[0]/o.singer.notesPlayed[1]<o.singer.pickup?r=c=0:(r=1+(h=o.singer.noteValuePerBeat*(o.singer.notesPlayed[0]/o.singer.notesPlayed[1]-o.singer.pickup))%o.singer.beatsPerMeasure,c=1+Math.floor(h/o.singer.beatsPerMeasure)),o.singer.currentBeat=r,o.singer.currentMeasure=c;for(var r,l,g=o.id,a=(o.singer.beatList.includes("everybeat")&&(s(),d.stage.dispatchEvent("__everybeat_"+g+"__")),o.singer.beatList.includes(r)?(s(),d.stage.dispatchEvent("__beat_"+r+"_"+g+"__")):1<r&&o.singer.beatList.includes("offbeat")&&(s(),d.stage.dispatchEvent("__offbeat_"+g+"__")),r+o.singer.beatsPerMeasure*(o.singer.currentMeasure-1)),u=0;u<o.singer.factorList.length;u++)a%o.singer.factorList[u]==0&&(s(),l="__beat_"+o.singer.factorList[u]+"_"+g+"__",d.stage.dispatchEvent(l))}d.logo.clearNoteParams(o,i,[]);var c,p="newnote"===t?1/e:e,h=(o.singer.inNoteBlock.push(i),o.singer.multipleVoices=1<o.singer.inNoteBlock.length,o.singer.noteValue[last(o.singer.inNoteBlock)]=1/(p*o.singer.beatFactor),"_playnote_"+n);void 0!==i&&i in d.blocks.blockList?d.logo.setDispatchBlock(i,n,h):MusicBlocks.isRun&&null!==(c=Mouse.getMouseFromTurtle(o))&&c.MB.listeners.push(h);d.logo.setTurtleListener(n,h,function(){var e;o.singer.multipleVoices&&d.logo.notation.notationVoices(n,o.singer.inNoteBlock.length),0<o.singer.inNoteBlock.length&&(0<o.singer.inNeighbor.length&&(o.singer.neighborArgBeat.push(o.singer.beatFactor*(1/o.singer.neighborNoteValue)),e=1/p-2*o.singer.neighborNoteValue,o.singer.neighborArgCurrentBeat.push(o.singer.beatFactor*(1/e))),Singer.processNote(d,1/o.singer.noteValue[last(o.singer.inNoteBlock)],"osctime"===t,last(o.singer.inNoteBlock),n)),delete o.singer.oscList[last(o.singer.inNoteBlock)],delete o.singer.noteBeat[last(o.singer.inNoteBlock)],delete o.singer.noteBeatValues[last(o.singer.inNoteBlock)],delete o.singer.noteValue[last(o.singer.inNoteBlock)],delete o.singer.notePitches[last(o.singer.inNoteBlock)],delete o.singer.noteOctaves[last(o.singer.inNoteBlock)],delete o.singer.noteCents[last(o.singer.inNoteBlock)],delete o.singer.noteHertz[last(o.singer.inNoteBlock)],delete o.singer.noteDrums[last(o.singer.inNoteBlock)],delete o.singer.embeddedGraphics[last(o.singer.inNoteBlock)],o.singer.inNoteBlock.splice(-1,1),o.singer.multipleVoices&&0===o.singer.inNoteBlock.length&&(d.logo.notation.notationVoices(n,0),o.singer.multipleVoices=!1),0===o.singer.inNoteBlock.length&&(d.logo.pitchBlocks=[],d.logo.drumBlocks=[])})}},{key:"playRest",value:function(e){e=d.turtles.ithTurtle(e);0<e.singer.inNoteBlock.length&&(e.singer.notePitches[last(e.singer.inNoteBlock)].push("rest"),e.singer.noteOctaves[last(e.singer.inNoteBlock)].push(4),e.singer.noteCents[last(e.singer.inNoteBlock)].push(0),e.singer.noteHertz[last(e.singer.inNoteBlock)].push(0),e.singer.noteBeatValues[last(e.singer.inNoteBlock)].push(e.singer.beatFactor),e.singer.pushedNote=!0)}},{key:"doRhythmicDot",value:function(t,e,n){var i=d.turtles.ithTurtle(e),s=2-1/Math.pow(2,i.singer.dotCount),s=(i.singer.beatFactor*=s,0<=t?i.singer.dotCount+=t:-1===t?(d.errorMsg(_("An argument of -1 results in a note value of 0."),n),t=0):i.singer.dotCount+=1/t,2-1/Math.pow(2,i.singer.dotCount)),s=(i.singer.beatFactor/=s,"_dot_"+e);void 0!==n&&n in d.blocks.blockList?d.logo.setDispatchBlock(n,e,s):MusicBlocks.isRun&&null!==(n=Mouse.getMouseFromTurtle(i))&&n.MB.listeners.push(s);d.logo.setTurtleListener(e,s,function(){var e=2-1/Math.pow(2,i.singer.dotCount),e=(i.singer.beatFactor*=e,i.singer.dotCount-=0<=t?t:1/t,2-1/Math.pow(2,i.singer.dotCount));i.singer.beatFactor/=e})}},{key:"doTie",value:function(o,e){var r=d.turtles.ithTurtle(o),t=(r.singer.tie=!0,r.singer.tieNotePitches=[],r.singer.tieNoteExtras=[],r.singer.tieCarryOver=0,r.singer.tieFirstDrums=[],"_tie_"+o);void 0!==e&&e in d.blocks.blockList?d.logo.setDispatchBlock(e,o,t):MusicBlocks.isRun&&null!==(e=Mouse.getMouseFromTurtle(r))&&e.MB.listeners.push(t);d.logo.setTurtleListener(o,t,function(){if(r.singer.tie=!1,0<r.singer.tieCarryOver){if(0===r.singer.justCounting.length){var e=last(r.singer.inNoteBlock);if(null!=e&&e in r.singer.notePitches)for(var t=0;t<r.singer.notePitches[last(r.singer.inNoteBlock)].length;t++)d.logo.notation.notationRemoveTie(o)}var n=r.singer.tieNoteExtras[0],e=r.singer.tieCarryOver;r.singer.tieCarryOver=0,r.singer.inNoteBlock.push(n),r.singer.notePitches[n]=[],r.singer.noteOctaves[n]=[],r.singer.noteCents[n]=[],r.singer.noteHertz[n]=[];for(var i=0;i<r.singer.tieNotePitches.length;i++)r.singer.notePitches[n].push(r.singer.tieNotePitches[i][0]),r.singer.noteOctaves[n].push(r.singer.tieNotePitches[i][1]),r.singer.noteCents[n].push(r.singer.tieNotePitches[i][2]),r.singer.noteHertz[n].push(r.singer.tieNotePitches[i][3]);r.singer.oscList[n]=r.singer.tieNoteExtras[1],r.singer.noteBeat[n]=r.singer.tieNoteExtras[2],r.singer.noteBeatValues[n]=r.singer.tieNoteExtras[3],r.singer.noteDrums[n]=r.singer.tieNoteExtras[4],r.singer.embeddedGraphics[n]=[],Singer.processNote(d,e,"osctime"===d.blocks.blockList[n].name,n,o);var s=0<TONEBPM/r.singer.bpm.length?last(r.singer.bpm):Singer.masterBPM;r.doWait(s/e),r.singer.inNoteBlock.pop(),delete r.singer.notePitches[n],delete r.singer.noteOctaves[n],delete r.singer.noteCents[n],delete r.singer.noteHertz[n],delete r.singer.oscList[n],delete r.singer.noteBeat[n],delete r.singer.noteBeatValues[n],delete r.singer.noteDrums[n],delete r.singer.embeddedGraphics[n],d.logo.notation.notationStaging[o].pop()}r.singer.tieNotePitches=[],r.singer.tieNoteExtras=[]})}},{key:"multiplyNoteValue",value:function(e,t,n){var i=d.turtles.ithTurtle(t),s=(i.singer.beatFactor/=e,"_multiplybeat_"+t);void 0!==n&&n in d.blocks.blockList?d.logo.setDispatchBlock(n,t,s):MusicBlocks.isRun&&null!==(n=Mouse.getMouseFromTurtle(i))&&n.MB.listeners.push(s);d.logo.setTurtleListener(t,s,function(){return i.singer.beatFactor*=e})}},{key:"addSwing",value:function(e,t,n,i){var s=d.turtles.ithTurtle(n),e=(s.singer.suppressOutput?d.logo.notation.notationSwing(n):(s.singer.swing.push(1/e),s.singer.swingTarget.push(1/t)),"_swing_"+n);void(s.singer.swingCarryOver=0)!==i&&i in d.blocks.blockList?d.logo.setDispatchBlock(i,n,e):MusicBlocks.isRun&&null!==(t=Mouse.getMouseFromTurtle(s))&&t.MB.listeners.push(e);d.logo.setTurtleListener(n,e,function(){s.singer.suppressOutput||(s.singer.swingTarget.pop(),s.singer.swing.pop()),s.singer.swingCarryOver=0})}},{key:"getNoteValue",value:function(e){var e=d.turtles.ithTurtle(e),t=0;return 0!==(t=null!==e.singer.noteValue[last(e.singer.inNoteBlock)]&&void 0!==e.singer.noteValue[last(e.singer.inNoteBlock)]?0!==e.singer.noteValue[last(e.singer.inNoteBlock)]?1/e.singer.noteValue[last(e.singer.inNoteBlock)]:0:null!==e.singer.lastNotePlayed?e.singer.lastNotePlayed[1]:void 0!==e.singer.notePitches[last(e.singer.inNoteBlock)]&&0<e.singer.notePitches[last(e.singer.inNoteBlock)].length?e.singer.noteBeat[last(e.singer.inNoteBlock)]:0)?1/t:0}}]))()}"undefined"!=typeof module&&module.exports&&(module.exports=setupRhythmActions);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupToneActions(u){Singer.ToneActions=(()=>_createClass(function e(){_classCallCheck(this,e)},null,[{key:"setTimbre",value:function(e,t,o){var r,s=u.turtles.ithTurtle(t),n=!(s.inSetTimbre=!0),i=e;for(r in VOICENAMES){if(VOICENAMES[r][0]===e){i=VOICENAMES[r][1],n=!0;break}if(VOICENAMES[r][1]===e){i=e,n=!0;break}}n||"object"!==_typeof(e)||(""!=e[0]?(i="customsample_"+e[0],CUSTOMSAMPLES[i]=[e[1],e[2],e[3]]):i=DEFAULTVOICE),null==i&&(i=DEFAULTVOICE),u.logo.inMatrix&&(u.logo.phraseMaker._instrumentName=i),s.singer.instrumentNames.includes(i)||(s.singer.instrumentNames.push(i),u.logo.synth.loadSynth(t,i),void 0===s.singer.synthVolume[i]&&(s.singer.synthVolume[i]=[last(s.singer.synthVolume[DEFAULTVOICE])],s.singer.crescendoInitialVolume[i]=[last(s.singer.synthVolume[DEFAULTVOICE])]));var l="_settimbre_"+t;void 0!==o&&o in u.blocks.blockList?u.logo.setDispatchBlock(o,t,l):MusicBlocks.isRun&&null!==(o=Mouse.getMouseFromTurtle(s))&&o.MB.listeners.push(l);u.logo.setTurtleListener(t,l,function(){s.inSetTimbre=!1,s.singer.instrumentNames.pop()})}},{key:"doVibrato",value:function(e,t,o,r){(e<1||100<e)&&(u.errorMsg(_("Vibrato intensity must be between 1 and 100."),r),u.logo.stopTurtle=!0),t<=0&&(u.errorMsg(_("Vibrato rate must be greater than 0."),r),u.logo.stopTurtle=!0);var s,n=u.turtles.ithTurtle(o),e=(n.singer.vibratoIntensity.push(e/100),n.singer.vibratoRate.push(1/t),"_vibrato_"+o);void 0!==r&&r in u.blocks.blockList?u.logo.setDispatchBlock(r,o,e):MusicBlocks.isRun&&null!==(s=Mouse.getMouseFromTurtle(n))&&s.MB.listeners.push(e);u.logo.setTurtleListener(o,e,function(){n.singer.vibratoIntensity.pop(),n.singer.vibratoRate.pop()}),u.logo.inTimbre&&(instrumentsEffects[o][u.logo.timbre.instrumentName].vibratoActive=!0,u.logo.timbre.vibratoEffect.push(r),u.logo.timbre.vibratoParams.push(100*last(n.singer.vibratoIntensity)),instrumentsEffects[o][u.logo.timbre.instrumentName].vibratoIntensity=n.singer.vibratoIntensity,u.logo.timbre.vibratoParams.push(last(n.singer.vibratoRate)),instrumentsEffects[o][u.logo.timbre.instrumentName].vibratoFrequency=t)}},{key:"doChorus",value:function(e,t,o,r,s){((o/=100)<0||1<o)&&(u.errorMsg(_("Depth is out of range."),s),u.logo.stopTurtle=!0);var n=u.turtles.ithTurtle(r),e=(n.singer.chorusRate.push(e),n.singer.delayTime.push(t),n.singer.chorusDepth.push(o),"_chorus_"+r);void 0!==s&&s in u.blocks.blockList?u.logo.setDispatchBlock(s,r,e):MusicBlocks.isRun&&null!==(t=Mouse.getMouseFromTurtle(n))&&t.MB.listeners.push(e);u.logo.setTurtleListener(r,e,function(){n.singer.chorusRate.pop(),n.singer.delayTime.pop(),n.singer.chorusDepth.pop()})}},{key:"doPhaser",value:function(e,t,o,r,s){var n=u.turtles.ithTurtle(r),e=(n.singer.rate.push(e),n.singer.octaves.push(t),n.singer.baseFrequency.push(o),"_phaser_"+r);void 0!==s&&s in u.blocks.blockList?u.logo.setDispatchBlock(s,r,e):MusicBlocks.isRun&&null!==(t=Mouse.getMouseFromTurtle(n))&&t.MB.listeners.push(e);u.logo.setTurtleListener(r,e,function(){n.singer.rate.pop(),n.singer.octaves.pop(),n.singer.baseFrequency.pop()})}},{key:"doTremolo",value:function(e,t,o,r){((t/=100)<0||1<t)&&(u.errorMsg(_("Depth is out of range."),r),u.logo.stopTurtle=!0);var s=u.turtles.ithTurtle(o),e=(s.singer.tremoloFrequency.push(e),s.singer.tremoloDepth.push(t),"_tremolo_"+o);void 0!==r&&r in u.blocks.blockList?u.logo.setDispatchBlock(r,o,e):MusicBlocks.isRun&&null!==(t=Mouse.getMouseFromTurtle(s))&&t.MB.listeners.push(e);u.logo.setTurtleListener(o,e,function(){s.singer.tremoloFrequency.pop(),s.singer.tremoloDepth.pop()})}},{key:"doDistortion",value:function(e,t,o){((e/=100)<0||1<e)&&(u.errorMsg(_("Distortion must be from 0 to 100."),o),u.logo.stopTurtle=!0);var r=u.turtles.ithTurtle(t),e=(r.singer.distortionAmount.push(e),"_distortion_"+t);void 0!==o&&o in u.blocks.blockList?u.logo.setDispatchBlock(o,t,e):MusicBlocks.isRun&&null!==(o=Mouse.getMouseFromTurtle(r))&&o.MB.listeners.push(e),u.logo.setTurtleListener(t,e,function(){return r.singer.distortionAmount.pop()})}},{key:"doHarmonic",value:function(e,t,o){if("number"!=typeof e||e<0)u.errorMsg(_("Partial must be greater than or equal to 0.")),u.logo.stopTurtle=!0;else{for(var r=u.turtles.ithTurtle(t),s=(r.singer.inHarmonic.push(o),r.singer.partials.push([]),r.singer.partials.length-1),n=0;n<e;n++)r.singer.partials[s].push(0);r.singer.partials[s].push(1),u.logo.notation.notationBeginHarmonics(t);var i="_harmonic_"+t+"_"+o;void 0!==o&&o in u.blocks.blockList?u.logo.setDispatchBlock(o,t,i):MusicBlocks.isRun&&null!==(o=Mouse.getMouseFromTurtle(r))&&o.MB.listeners.push(i);u.logo.setTurtleListener(t,i,function(){r.singer.inHarmonic.pop(),r.singer.partials.pop(),u.logo.notation.notationEndHarmonics(t)})}}},{key:"defFMSynth",value:function(e,t,o){u.logo.inTimbre&&(u.logo.timbre.FMSynthParams=[],0!=u.logo.timbre.osc.length)&&u.errorMsg(_("Unable to use synth due to existing oscillator")),null!==e&&"number"==typeof e||(u.errorMsg(NOINPUTERRORMSG,o),e=10),e<0&&(u.errorMsg(_("The input cannot be negative.")),e=-e),u.logo.inTimbre&&(u.logo.timbre.fmSynthParamvals.modulationIndex=e,u.logo.synth.createSynth(t,u.logo.timbre.instrumentName,"fmsynth",u.logo.timbre.fmSynthParamvals),u.logo.timbre.FMSynthesizer.push(o),u.logo.timbre.FMSynthParams.push(e))}},{key:"defAMSynth",value:function(e,t,o){u.logo.inTimbre&&(u.logo.timbre.AMSynthParams=[],0!=u.logo.timbre.osc.length)&&u.errorMsg(_("Unable to use synth due to existing oscillator")),null!==e&&"number"==typeof e||(u.errorMsg(NOINPUTERRORMSG,o),e=1),e<0&&(u.errorMsg(_("The input cannot be negative.")),e=-e),u.logo.inTimbre&&(u.logo.timbre.amSynthParamvals.harmonicity=e,u.logo.synth.createSynth(t,u.logo.timbre.instrumentName,"amsynth",u.logo.timbre.amSynthParamvals),u.logo.timbre.AMSynthesizer.push(o),u.logo.timbre.AMSynthParams.push(e))}},{key:"defDuoSynth",value:function(e,t,o,r){u.logo.inTimbre&&(0!=u.logo.timbre.osc.length&&u.errorMsg(_("Unable to use synth due to existing oscillator")),u.logo.timbre.duoSynthParams=[]),null!==e&&"number"==typeof e||(u.errorMsg(NOINPUTERRORMSG,r),e=10),null!==t&&"number"==typeof t||(u.errorMsg(NOINPUTERRORMSG,r),t=50),e=Math.abs(e),t=Math.abs(t)/100,u.logo.inTimbre&&(u.logo.timbre.duoSynthParamVals.vibratoRate=e,u.logo.timbre.duoSynthParamVals.vibratoAmount=t,u.logo.synth.createSynth(o,u.logo.timbre.instrumentName,"duosynth",u.logo.timbre.duoSynthParamVals),u.logo.timbre.duoSynthesizer.push(r),u.logo.timbre.duoSynthParams.push(e),u.logo.timbre.duoSynthParams.push(t))}}]))()}"undefined"!=typeof module&&module.exports&&(module.exports=setupToneActions);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,n){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===n?String:Number)(e);t=t.call(e,n||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}function setupVolumeActions(a){Singer.VolumeActions=(()=>_createClass(function e(){_classCallCheck(this,e)},null,[{key:"doCrescendo",value:function(e,n,t,o){var r,i=a.turtles.ithTurtle(t);for(r in i.singer.crescendoDelta.push("crescendo"===e?n:-n),i.singer.synthVolume){var s=last(i.singer.synthVolume[r]);i.singer.synthVolume[r].push(s),void 0===i.singer.crescendoInitialVolume[r]?i.singer.crescendoInitialVolume[r]=[s]:i.singer.crescendoInitialVolume[r].push(s)}i.singer.inCrescendo.push(!0);e="_crescendo_"+t;void 0!==o&&o in a.blocks.blockList?a.logo.setDispatchBlock(o,t,e):MusicBlocks.isRun&&null!==(n=Mouse.getMouseFromTurtle(i))&&n.MB.listeners.push(e);a.logo.setTurtleListener(t,e,function(){for(var e in 0===i.singer.justCounting.length&&a.logo.notation.notationEndCrescendo(t,last(i.singer.crescendoDelta)),i.singer.crescendoDelta.pop(),i.singer.synthVolume){var n=i.singer.synthVolume[e].length;i.singer.synthVolume[e][n-1]=last(i.singer.crescendoInitialVolume[e]),i.singer.crescendoInitialVolume[e].pop()}})}},{key:"setRelativeVolume",value:function(e,n,t){var o,r=a.turtles.ithTurtle(n);for(o in r.singer.synthVolume){var i=last(r.singer.synthVolume[o])*(100+e)/100,i=Math.max(Math.min(i,100),-100);void 0===r.singer.synthVolume[o]?r.singer.synthVolume[o]=[i]:r.singer.synthVolume[o].push(i),r.singer.suppressOutput||Singer.setSynthVolume(a.logo,n,o,i)}0===r.singer.justCounting.length&&a.logo.notation.notationBeginArticulation(n);var s="_articulation_"+n;void 0!==t&&t in a.blocks.blockList?a.logo.setDispatchBlock(t,n,s):MusicBlocks.isRun&&null!==(t=Mouse.getMouseFromTurtle(r))&&t.MB.listeners.push(s);a.logo.setTurtleListener(n,s,function(){for(var e in r.singer.synthVolume)r.singer.synthVolume[e].pop(),Singer.setSynthVolume(a.logo,n,e,last(r.singer.synthVolume[e]));0===r.singer.justCounting.length&&a.logo.notation.notationEndArticulation(n)})}},{key:"setMasterVolume",value:function(e,n,t){0===(e=Math.max(Math.min(e,100),0))&&a.errorMsg(_("Setting volume to 0."),t),2===Singer.masterVolume.length&&Singer.masterVolume.pop(),Singer.masterVolume.push(e),a.turtles.ithTurtle(n).singer.suppressOutput||Singer.setMasterVolume(a.logo,e,t)}},{key:"setPanning",value:function(e,n){e=Math.max(Math.min(e,100),-100)/100;var t,o=a.turtles.ithTurtle(n);for(t in o.singer.panner?o.singer.panner.pan.value=e:o.singer.panner=new Tone.Panner(e).toDestination(),instruments[n])instruments[n][t].connect(o.singer.panner)}},{key:"setSynthVolume",value:function(e,n,t,o){var r=null,i=null,s=null;if(a.logo.blockList&&a.logo.blockList[o]&&(i=a.logo.blockList[o].connections[0],s=last(a.logo.blockList[o].connections)),e===DEFAULTVOICE||e===_(DEFAULTVOICE)?r=DEFAULTVOICE:"custom"!==e&&e!==_("custom")||(r="custom"),null===r)for(var l in VOICENAMES){if(VOICENAMES[l][0]===e){r=VOICENAMES[l][1];break}if(VOICENAMES[l][1]===e){r=e;break}}if(null===r)for(var u in DRUMNAMES){if(DRUMNAMES[u][0].replace("-"," ")===e){r=DRUMNAMES[u][1];break}if(DRUMNAMES[u][1].replace("-"," ")===e){r=e;break}}null===r&&(a.errorMsg(r+"not found"),r=DEFAULTVOICE);o=a.turtles.ithTurtle(t);o.singer.instrumentNames.includes(r)||(o.singer.instrumentNames.push(r),a.logo.synth.loadSynth(t,r),void 0===o.singer.synthVolume[r]&&(o.singer.synthVolume[r]=[DEFAULTVOLUME],o.singer.crescendoInitialVolume[r]=[DEFAULTVOLUME])),o.singer.synthVolume[r].push(n),o.singer.suppressOutput||(Singer.setSynthVolume(a.logo,t,r,n),null===i&&null===s&&setTimeout(function(){a.logo.synth.trigger(0,"G4",.25,e,null,null,!1)},250))}},{key:"masterVolume",get:function(){return last(Singer.masterVolume)}},{key:"getSynthVolume",value:function(e,n){var t,o=a.turtles.ithTurtle(n);for(t in o.singer.synthVolume)if(t===e)return last(o.singer.synthVolume[t])}}]))()}"undefined"!=typeof module&&module.exports&&(module.exports=setupVolumeActions);
function _typeof(r){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){var t;if(r)return"string"==typeof r?_arrayLikeToArray(r,e):"Map"===(t="Object"===(t={}.toString.call(r).slice(8,-1))&&r.constructor?r.constructor.name:t)||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,o=Array(e);t<e;t++)o[t]=r[t];return o}function _iterableToArrayLimit(r,e){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var o,n,i,u,a=[],f=!0,l=!1;try{if(i=(t=t.call(r)).next,0===e){if(Object(t)!==t)return;f=!1}else for(;!(f=(o=i.call(t)).done)&&(a.push(o.value),a.length!==e);f=!0);}catch(r){l=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(l)throw n}}return a}}function _arrayWithHoles(r){if(Array.isArray(r))return r}function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(r,_toPropertyKey(o.key),o)}}function _createClass(r,e,t){return e&&_defineProperties(r.prototype,e),t&&_defineProperties(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function _toPropertyKey(r){r=_toPrimitive(r,"string");return"symbol"==_typeof(r)?r:r+""}function _toPrimitive(r,e){if("object"!=_typeof(r)||!r)return r;var t=r[Symbol.toPrimitive];if(void 0===t)return("string"===e?String:Number)(r);t=t.call(r,e||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}var MathUtility=(()=>{function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"doRandom",value:function(r,e,t){function o(r,e){var t=_slicedToArray(e<r?[e,r]:[r,e],2);return r=t[0],e=t[1],Math.floor(Math.random()*(Number(e)-Number(r)+1)+Number(r))}if("number"==typeof r&&"number"==typeof e)return o(r,e);if("string"==typeof r&&"string"==typeof e&&SOLFEGENAMES.includes(r)&&SOLFEGENAMES.includes(e)){for(var n=[],i=0,u=[t=void 0===(t=t)?4:t,t+1];i<u.length;i++)for(var a=u[i],f=0;f<SOLFEGENAMES.length;f++)n.push(SOLFEGENAMES[f]+" "+a);var l=SOLFEGENAMES.indexOf(r),y=t,l=SOLFEGENAMES.indexOf(e)<l?t+1:t,t=n.indexOf(r+" "+y),r=n.indexOf(e+" "+l);return n[o(t,r)].split(" ")}throw"NanError"}},{key:"doOneOf",value:function(r,e){return Math.random()<.5?r:e}},{key:"doMod",value:function(r,e){if("number"==typeof r&&"number"==typeof e)return Number(r)%Number(e);throw"NanError"}},{key:"doSqrt",value:function(r){if("number"!=typeof r)throw"NanError";if(r<0)throw"NoSqrtError";return Math.sqrt(Number(r))}},{key:"doPlus",value:function(r,e){return"string"==typeof r||"string"==typeof e?("string"==typeof r?r:r.toString())+("string"==typeof e?e:e.toString()):Number(r)+Number(e)}},{key:"doMinus",value:function(r,e){if("string"==typeof r||"string"==typeof e)throw"NanError";return Number(r)-Number(e)}},{key:"doMultiply",value:function(r,e){if("string"==typeof r||"string"==typeof e)throw"NanError";return Number(r)*Number(e)}},{key:"doDivide",value:function(r,e){if("number"!=typeof r||"number"!=typeof e)throw"NanError";if(0===Number(e))throw"DivByZeroError";return Number(r)/Number(e)}},{key:"doCalculateDistance",value:function(r,e,t,o){if("number"==typeof r&&"number"==typeof e&&"number"==typeof t&&"number"==typeof o)return r===t&&e===o?0:Math.sqrt(Math.pow(r-t,2)+Math.pow(e-o,2));throw"NanError"}},{key:"doPower",value:function(r,e){if("number"==typeof r&&"number"==typeof e)return Math.pow(r,e);throw"NanError"}},{key:"doAbs",value:function(r){if("number"==typeof r)return Math.abs(r);throw"NanError"}},{key:"doNegate",value:function(r){if("number"==typeof r)return e.doMinus(0,r);if("string"==typeof r)return r.split("").reverse().join("");throw"NoNegError"}},{key:"doInt",value:function(r){try{return Math.floor(Number(r)+.5)}catch(r){throw"NanError"}}}])})();"undefined"!=typeof module&&module.exports&&(module.exports=MathUtility);
var COLORS40=[[6,24,"#ff007e"],[6,24,"#ff0066"],[6,24,"#ff0048"],[6,26,"#ff0000"],[6,26,"#ff3000"],[6,20,"#fd6600"],[8,24,"#ffa300"],[8,22,"#ffb000"],[8,22,"#ffb900"],[8,22,"#ffc000"],[9,22,"#ffe400"],[9,22,"#ffe800"],[9,22,"#f6ee00"],[9,22,"#e1f400"],[9,22,"#c4fb00"],[8,28,"#4eeb00"],[8,22,"#00f200"],[8,28,"#00fd3c"],[6,28,"#00c260"],[6,28,"#00c273"],[6,28,"#00c286"],[6,28,"#00c29d"],[6,26,"#00c1b6"],[6,24,"#00c0ca"],[6,24,"#00c0e7"],[6,20,"#00b9f1"],[6,20,"#00b5ff"],[6,20,"#00b0ff"],[6,20,"#00abff"],[6,18,"#00a1ff"],[4,28,"#005dff"],[4,28,"#4231ff"],[4,28,"#8000fe"],[4,28,"#a000ef"],[6,28,"#f009ff"],[6,28,"#ff00ff"],[6,28,"#ff00f9"],[6,28,"#ff00d9"],[6,26,"#ff00b2"],[6,24,"#ff0098"]],MUNSELL=["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2c1620","#350f23","#3d0526","#450029","#4c002c","#530030","#5a0034","#600037","#600037","#600037","#600037","#600037","#600037","#600037","#313131","#412c32","#4c2633","#561e34","#601136","#690038","#73003b","#7c003d","#850040","#8d0043","#8d0043","#8d0043","#8d0043","#8d0043","#8d0043","#484848","#5b4247","#693c45","#753444","#802843","#8b1843","#960043","#9f0043","#aa0044","#b30044","#bc0046","#bc0046","#bc0046","#bc0046","#bc0046","#616161","#735c5f","#82565d","#8f4e5b","#9b4659","#a63c58","#b12e57","#bc1756","#c60056","#d10056","#db0056","#e30057","#ed0058","#ed0058","#ed0058","#7a7a7a","#8b7679","#9b7076","#a96973","#b76171","#c3596f","#d04d6d","#da416c","#e62d6b","#f0036a","#fc0069","#ff0069","#ff0068","#ff0068","#ff0068","#949494","#a59193","#b58b8f","#c4848c","#d17e8a","#de7587","#eb6c85","#f76183","#ff5281","#ff417f","#ff277f","#ff007e","#ff007e","#ff007e","#ff007e","#aeaeae","#beabad","#cfa6aa","#df9fa6","#ee98a3","#fc90a0","#ff869d","#ff7b9a","#ff6e98","#ff6095","#ff5293","#ff5293","#ff5293","#ff5293","#ff5293","#c8c8c8","#d7c7c8","#eac0c4","#fbbac0","#ffb2bc","#ffa9b9","#ff9db5","#ff94b1","#ff94b1","#ff94b1","#ff94b1","#ff94b1","#ff94b1","#ff94b1","#ff94b1","#e3e3e3","#f2e2e3","#ffdbde","#ffd3da","#ffccd6","#ffccd6","#ffccd6","#ffccd6","#ffccd6","#ffccd6","#ffccd6","#ffccd6","#ffccd6","#ffccd6","#ffccd6","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2d161e","#360f1f","#3f0321","#470023","#4e0025","#570028","#570028","#570028","#570028","#570028","#570028","#570028","#570028","#570028","#313131","#422c30","#4d262f","#571e2f","#620f2f","#6c002f","#760030","#800031","#890032","#890032","#890032","#890032","#890032","#890032","#890032","#484848","#5c4244","#6a3c41","#76343d","#82283a","#8d1738","#980036","#a10034","#ab0033","#b50032","#c10032","#c10032","#c10032","#c10032","#c10032","#616161","#745c5d","#835659","#904e55","#9d4651","#a83c4e","#b32e4b","#be1548","#c80046","#d30044","#dd0041","#e60041","#ef003e","#ef003e","#ef003e","#7a7a7a","#8c7677","#9c7072","#ab696d","#b86169","#c55864","#d24c60","#dc415d","#e82d5a","#f30057","#ff0055","#ff0054","#ff0053","#ff0052","#ff0051","#949494","#a59191","#b68b8c","#c68486","#d37d81","#e1757d","#ee6b78","#f96174","#ff5270","#ff416c","#ff2a69","#ff0067","#ff0066","#ff0066","#ff0066","#aeaeae","#bfabab","#d0a5a6","#e09fa0","#f0989b","#fe9095","#ff868f","#ff7b8b","#ff6e86","#ff6282","#ff6282","#ff6282","#ff6282","#ff6282","#ff6282","#c8c8c8","#d8c7c7","#ecc0c0","#fdb9ba","#ffb1b3","#ffa9ad","#ff9ea6","#ff9ea6","#ff9ea6","#ff9ea6","#ff9ea6","#ff9ea6","#ff9ea6","#ff9ea6","#ff9ea6","#e3e3e3","#f3e2e2","#ffdbda","#ffd3d3","#ffcccd","#ffcccd","#ffcccd","#ffcccd","#ffcccd","#ffcccd","#ffcccd","#ffcccd","#ffcccd","#ffcccd","#ffcccd","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2e161c","#370f1b","#40021c","#48001c","#50001d","#59001f","#59001f","#59001f","#59001f","#59001f","#59001f","#59001f","#59001f","#59001f","#313131","#422c2e","#4e262b","#581d29","#630e26","#6e0025","#770024","#810024","#8b0024","#8b0024","#8b0024","#8b0024","#8b0024","#8b0024","#8b0024","#484848","#5c4342","#6b3c3c","#763437","#822a31","#8d192c","#980028","#a10025","#ab0021","#b6001f","#c1001e","#c1001e","#c1001e","#c1001e","#c1001e","#616161","#745c5b","#845554","#914f4d","#9e4647","#a93c41","#b3303b","#be1a34","#c8002f","#d30029","#dc0025","#e40021","#ed001d","#ed001d","#ed001d","#7a7a7a","#8c7675","#9d706e","#ac6966","#ba625f","#c65858","#d34d51","#dd424b","#e92f44","#f4083e","#fd0039","#ff0034","#ff0031","#ff0031","#ff0031","#949494","#a6918f","#b78b88","#c78480","#d47d79","#e27572","#ef6c6b","#fb6264","#ff545c","#ff4455","#ff3150","#ff0a4b","#ff0048","#ff0048","#ff0048","#aeaeae","#c0abaa","#d2a5a2","#e29f9a","#f29892","#ff908b","#ff8682","#ff7c7b","#ff7073","#ff646d","#ff646d","#ff646d","#ff646d","#ff646d","#ff646d","#c8c8c8","#d9c7c5","#edc0bc","#ffb9b3","#ffb1aa","#ffa9a2","#ff9e98","#ff9e98","#ff9e98","#ff9e98","#ff9e98","#ff9e98","#ff9e98","#ff9e98","#ff9e98","#e3e3e3","#f4e2e0","#ffdbd5","#ffd3cb","#ffcbc4","#ffcbc4","#ffcbc4","#ffcbc4","#ffcbc4","#ffcbc4","#ffcbc4","#ffcbc4","#ffcbc4","#ffcbc4","#ffcbc4","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2e161a","#380f18","#410216","#490016","#510016","#5a0016","#5a0016","#5a0016","#5a0016","#5a0016","#5a0016","#5a0016","#5a0016","#5a0016","#313131","#432c2c","#4f2627","#591e22","#63111d","#6e0019","#770016","#810014","#8b0012","#8b0012","#8b0012","#8b0012","#8b0012","#8b0012","#8b0012","#484848","#5c4340","#6a3c38","#763530","#812b28","#8c1d1f","#970017","#a00010","#a90008","#b40000","#c00000","#c00000","#c00000","#c00000","#c00000","#616161","#745c59","#845650","#914f47","#9e473e","#a83e35","#b2332c","#bc2222","#c60018","#cf000b","#d90000","#e00000","#ea0000","#ea0000","#ea0000","#7a7a7a","#8d7673","#9e706a","#ac6a60","#ba6256","#c65a4b","#d25041","#dc4537","#e7362b","#f0201f","#f90010","#ff0000","#ff0000","#ff0000","#ff0000","#949494","#a7908d","#b88b83","#c7857a","#d57e6f","#e37664","#ef6e5a","#fa644e","#ff5942","#ff4c34","#ff3e29","#ff2914","#ff0d00","#ff0000","#ff0000","#aeaeae","#c1aba7","#d3a59d","#e39f93","#f39887","#ff917d","#ff8871","#ff7f65","#ff7558","#ff6b4f","#ff6045","#ff6045","#ff6045","#ff6045","#ff6045","#c8c8c8","#d9c7c3","#efc0b7","#ffb9ab","#ffb29f","#ffaa93","#ffa185","#ff987c","#ff987c","#ff987c","#ff987c","#ff987c","#ff987c","#ff987c","#ff987c","#e3e3e3","#f5e2de","#ffdad0","#ffd4c2","#ffccb7","#ffccb7","#ffccb7","#ffccb7","#ffccb7","#ffccb7","#ffccb7","#ffccb7","#ffccb7","#ffccb7","#ffccb7","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2e1717","#390e13","#410310","#4a000d","#52000b","#5a000a","#5a000a","#5a000a","#5a000a","#5a000a","#5a000a","#5a000a","#5a000a","#5a000a","#313131","#422d2a","#4e2622","#581f1b","#631313","#6c000b","#760004","#800000","#890000","#890000","#890000","#890000","#890000","#890000","#890000","#484848","#5c433e","#6a3d34","#75362a","#802e1f","#8a2212","#930e00","#9c0000","#a50000","#ae0000","#b80000","#b80000","#b80000","#b80000","#b80000","#616161","#755c57","#84564b","#905040","#9c4933","#a64125","#af3913","#b72e00","#be2200","#c60600","#cc0000","#d40000","#db0000","#db0000","#db0000","#7a7a7a","#8d7771","#9e7164","#ac6b57","#b96449","#c55d3a","#cf5529","#d74d14","#df4500","#e63a00","#ee2c00","#f51400","#fc0000","#ff0000","#ff0000","#949494","#a8918a","#b98b7d","#c78671","#d47f63","#e17854","#ec7144","#f76931","#ff6216","#ff5900","#ff4f00","#ff4500","#ff3b00","#ff3000","#ff3000","#aeaeae","#c1aba5","#d3a697","#e3a08a","#f29a7b","#fe936e","#ff8c5c","#ff844a","#ff7c33","#ff761d","#ff6e00","#ff6e00","#ff6e00","#ff6e00","#ff6e00","#c8c8c8","#dac7c1","#f0c0b1","#ffbaa2","#ffb493","#ffad84","#ffa572","#ff9e61","#ff9e61","#ff9e61","#ff9e61","#ff9e61","#ff9e61","#ff9e61","#ff9e61","#e3e3e3","#f6e2db","#ffdbc9","#ffd5ba","#ffcdab","#ffcdab","#ffcdab","#ffcdab","#ffcdab","#ffcdab","#ffcdab","#ffcdab","#ffcdab","#ffcdab","#ffcdab","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2e1714","#390f0b","#410505","#490000","#520000","#520000","#520000","#520000","#520000","#520000","#520000","#520000","#520000","#520000","#313131","#422d28","#4e271e","#572112","#611801","#690700","#690700","#690700","#690700","#690700","#690700","#690700","#690700","#690700","#690700","#484848","#5b443c","#683e2f","#723921","#7b330f","#822d00","#8a2400","#8a2400","#8a2400","#8a2400","#8a2400","#8a2400","#8a2400","#8a2400","#8a2400","#616161","#745d54","#835746","#8e5238","#984d27","#a04711","#a64300","#ac3d00","#ac3d00","#ac3d00","#ac3d00","#ac3d00","#ac3d00","#ac3d00","#ac3d00","#7a7a7a","#8d776e","#9c725f","#aa6c50","#b6673e","#c0612b","#c75c11","#cd5800","#d15500","#d65000","#d65000","#d65000","#d65000","#d65000","#d65000","#949494","#a89187","#b78c78","#c68768","#d28259","#dd7c46","#e67730","#ee720d","#f46e00","#f86a00","#fd6600","#fd6600","#fd6600","#fd6600","#fd6600","#aeaeae","#c2aba2","#d2a792","#e2a181","#ef9c71","#fa9760","#ff914a","#ff8b2d","#ff8700","#ff8300","#ff8000","#ff8000","#ff8000","#ff8000","#ff8000","#c8c8c8","#dbc7bd","#efc1aa","#febc9a","#ffb687","#ffb175","#ffab60","#ffa548","#ffa548","#ffa548","#ffa548","#ffa548","#ffa548","#ffa548","#ffa548","#e3e3e3","#f7e2d8","#ffdcc3","#ffd7b0","#ffd09d","#ffd09d","#ffd09d","#ffd09d","#ffd09d","#ffd09d","#ffd09d","#ffd09d","#ffd09d","#ffd09d","#ffd09d","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2d1810","#381101","#3f0a00","#3f0a00","#3f0a00","#3f0a00","#3f0a00","#3f0a00","#3f0a00","#3f0a00","#3f0a00","#3f0a00","#3f0a00","#3f0a00","#313131","#412e26","#4b2918","#542404","#5c1e00","#5c1e00","#5c1e00","#5c1e00","#5c1e00","#5c1e00","#5c1e00","#5c1e00","#5c1e00","#5c1e00","#5c1e00","#484848","#5a443a","#65402b","#6e3c19","#753800","#7b3400","#7b3400","#7b3400","#7b3400","#7b3400","#7b3400","#7b3400","#7b3400","#7b3400","#7b3400","#616161","#735d51","#815940","#8a5530","#93511c","#994d00","#9e4a00","#a34600","#a34600","#a34600","#a34600","#a34600","#a34600","#a34600","#a34600","#7a7a7a","#8c776b","#9a735a","#a76f47","#b16a33","#b8661b","#be6300","#c36100","#c75e00","#c75e00","#c75e00","#c75e00","#c75e00","#c75e00","#c75e00","#949494","#a79184","#b58d73","#c28960","#cd854c","#d68136","#de7d17","#e37a00","#e77800","#ea7600","#ed7400","#ed7400","#ed7400","#ed7400","#ed7400","#aeaeae","#c2ac9e","#d1a88c","#dea479","#e9a066","#f39b50","#fd9735","#ff9404","#ff9100","#ff8f00","#ff8e00","#ff8c00","#ff8c00","#ff8c00","#ff8c00","#c8c8c8","#dbc7b9","#ecc3a5","#fabe92","#ffba7c","#ffb667","#ffb24e","#ffae2e","#ffaa00","#ffa800","#ffa600","#ffa500","#ffa300","#ffa300","#ffa300","#e3e3e3","#f7e2d3","#ffdebc","#ffd9a8","#ffd593","#ffd07e","#ffd07e","#ffd07e","#ffd07e","#ffd07e","#ffd07e","#ffd07e","#ffd07e","#ffd07e","#ffd07e","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2b190d","#351400","#351400","#351400","#351400","#351400","#351400","#351400","#351400","#351400","#351400","#351400","#351400","#351400","#313131","#3f2f24","#482b12","#502800","#552500","#552500","#552500","#552500","#552500","#552500","#552500","#552500","#552500","#552500","#552500","#484848","#584538","#624227","#6a3f12","#6f3c00","#743a00","#743a00","#743a00","#743a00","#743a00","#743a00","#743a00","#743a00","#743a00","#743a00","#616161","#725e4f","#7e5a3b","#865729","#8d550f","#925200","#955100","#955100","#955100","#955100","#955100","#955100","#955100","#955100","#955100","#7a7a7a","#8b7869","#987455","#a37140","#ab6e28","#b16c03","#b56a00","#b86800","#bb6700","#bb6700","#bb6700","#bb6700","#bb6700","#bb6700","#bb6700","#949494","#a69282","#b38f6e","#be8b59","#c88842","#cf8526","#d48300","#d88100","#db8000","#dd7f00","#dd7f00","#dd7f00","#dd7f00","#dd7f00","#dd7f00","#aeaeae","#c0ad9b","#cea987","#daa672","#e4a35c","#eca043","#f39d1f","#f89b00","#fc9900","#fe9800","#ff9800","#ff9800","#ff9800","#ff9800","#ff9800","#c8c8c8","#dbc8b5","#e9c4a0","#f6c18b","#ffbd73","#ffbb5b","#ffb83e","#ffb509","#ffb300","#ffb200","#ffb100","#ffb000","#ffb000","#ffb000","#ffb000","#e3e3e3","#f7e3cf","#ffdfb7","#ffdca0","#ffd989","#ffd671","#ffd359","#ffd359","#ffd359","#ffd359","#ffd359","#ffd359","#ffd359","#ffd359","#ffd359","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#291a0a","#321600","#321600","#321600","#321600","#321600","#321600","#321600","#321600","#321600","#321600","#321600","#321600","#321600","#313131","#3d2f22","#452d0e","#4c2b00","#502900","#502900","#502900","#502900","#502900","#502900","#502900","#502900","#502900","#502900","#502900","#484848","#564636","#5e4423","#654209","#694000","#6e3e00","#6e3e00","#6e3e00","#6e3e00","#6e3e00","#6e3e00","#6e3e00","#6e3e00","#6e3e00","#6e3e00","#616161","#705f4c","#7a5c37","#815a22","#865800","#8a5700","#8d5600","#8d5600","#8d5600","#8d5600","#8d5600","#8d5600","#8d5600","#8d5600","#8d5600","#7a7a7a","#897966","#947650","#9e7438","#a4721c","#a87000","#ab6f00","#ae6e00","#b06d00","#b06d00","#b06d00","#b06d00","#b06d00","#b06d00","#b06d00","#949494","#a4937f","#af9169","#b98e51","#c08c38","#c68a13","#ca8900","#cd8800","#cf8700","#d18600","#d18600","#d18600","#d18600","#d18600","#d18600","#aeaeae","#beae98","#caab81","#d4a96a","#dca752","#e3a535","#e9a300","#eda100","#efa100","#f1a000","#f2a000","#f2a000","#f2a000","#f2a000","#f2a000","#c8c8c8","#d9c8b2","#e5c69b","#efc483","#f9c269","#ffc04f","#ffbe2b","#ffbc00","#ffbb00","#ffba00","#ffb900","#ffb900","#ffb900","#ffb900","#ffb900","#e3e3e3","#f5e4cb","#ffe2b1","#ffdf99","#ffdd7f","#ffdb63","#ffd948","#ffd948","#ffd948","#ffd948","#ffd948","#ffd948","#ffd948","#ffd948","#ffd948","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#271b08","#2e1900","#2e1900","#2e1900","#2e1900","#2e1900","#2e1900","#2e1900","#2e1900","#2e1900","#2e1900","#2e1900","#2e1900","#2e1900","#313131","#3b3121","#422f08","#472d00","#472d00","#472d00","#472d00","#472d00","#472d00","#472d00","#472d00","#472d00","#472d00","#472d00","#472d00","#484848","#534735","#5a4620","#604401","#644300","#644300","#644300","#644300","#644300","#644300","#644300","#644300","#644300","#644300","#644300","#616161","#6d604b","#755f34","#7b5d1b","#7f5c00","#825b00","#845b00","#845b00","#845b00","#845b00","#845b00","#845b00","#845b00","#845b00","#845b00","#7a7a7a","#877a64","#90784c","#977731","#9c7610","#9f7500","#a27400","#a47300","#a47300","#a47300","#a47300","#a47300","#a47300","#a47300","#a47300","#949494","#a1947c","#aa9365","#b2914b","#b8902e","#bd8f00","#c08e00","#c28d00","#c48d00","#c48d00","#c48d00","#c48d00","#c48d00","#c48d00","#c48d00","#aeaeae","#bbaf96","#c5ad7d","#ceac64","#d4aa49","#daa926","#dea800","#e1a700","#e3a700","#e4a600","#e5a600","#e5a600","#e5a600","#e5a600","#e5a600","#c8c8c8","#d6caaf","#e0c897","#e8c77d","#f0c662","#f6c444","#fbc312","#ffc200","#ffc100","#ffc000","#ffc000","#ffc000","#ffc000","#ffc000","#ffc000","#e3e3e3","#f2e5c8","#fce4ad","#ffe393","#ffe178","#ffe05c","#ffdf37","#ffdf37","#ffdf37","#ffdf37","#ffdf37","#ffdf37","#ffdf37","#ffdf37","#ffdf37","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#241c08","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#2a1b00","#313131","#393120","#3e3005","#423000","#423000","#423000","#423000","#423000","#423000","#423000","#423000","#423000","#423000","#423000","#423000","#484848","#504835","#56481e","#5a4700","#5d4600","#5d4600","#5d4600","#5d4600","#5d4600","#5d4600","#5d4600","#5d4600","#5d4600","#5d4600","#5d4600","#616161","#6a614a","#706131","#756016","#785f00","#7a5f00","#7b5f00","#7b5f00","#7b5f00","#7b5f00","#7b5f00","#7b5f00","#7b5f00","#7b5f00","#7b5f00","#7a7a7a","#837b63","#8a7b49","#907a2d","#947902","#967900","#987800","#9a7800","#9a7800","#9a7800","#9a7800","#9a7800","#9a7800","#9a7800","#9a7800","#949494","#9e957b","#a49562","#ab9446","#af9425","#b29300","#b59300","#b69200","#b89200","#b89200","#b89200","#b89200","#b89200","#b89200","#b89200","#aeaeae","#b8b094","#bfb07a","#c5af5f","#caaf43","#ceae14","#d1ad00","#d3ad00","#d4ad00","#d5ad00","#d5ad00","#d5ad00","#d5ad00","#d5ad00","#d5ad00","#c8c8c8","#d3cbad","#d9cb93","#dfca78","#e5ca5b","#e9c938","#edc900","#efc800","#f1c800","#f2c800","#f3c800","#f3c800","#f3c800","#f3c800","#f3c800","#e3e3e3","#efe6c6","#f5e6aa","#fbe68f","#ffe672","#ffe552","#ffe522","#ffe500","#ffe400","#ffe400","#ffe400","#ffe400","#ffe400","#ffe400","#ffe400","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#221d0a","#261d00","#261d00","#261d00","#261d00","#261d00","#261d00","#261d00","#261d00","#261d00","#261d00","#261d00","#261d00","#261d00","#313131","#363221","#3a3204","#3d3200","#3d3200","#3d3200","#3d3200","#3d3200","#3d3200","#3d3200","#3d3200","#3d3200","#3d3200","#3d3200","#3d3200","#484848","#4e4935","#51491e","#544900","#564900","#564900","#564900","#564900","#564900","#564900","#564900","#564900","#564900","#564900","#564900","#616161","#67624a","#6b6231","#6e6213","#706200","#726200","#736200","#736200","#736200","#736200","#736200","#736200","#736200","#736200","#736200","#7a7a7a","#817c63","#867c49","#897c2a","#8b7c00","#8d7c00","#8e7c00","#8f7c00","#8f7c00","#8f7c00","#8f7c00","#8f7c00","#8f7c00","#8f7c00","#8f7c00","#949494","#9b967b","#a09761","#a49744","#a79720","#a99700","#aa9700","#ab9700","#ac9600","#ac9600","#ac9600","#ac9600","#ac9600","#ac9600","#ac9600","#aeaeae","#b6b194","#bab179","#beb25e","#c1b23f","#c4b205","#c6b200","#c7b200","#c8b200","#c8b200","#c8b200","#c8b200","#c8b200","#c8b200","#c8b200","#c8c8c8","#d1ccac","#d5cc92","#d9cd76","#dccd58","#dfcd33","#e2cd00","#e3cd00","#e4cd00","#e5cd00","#e6cd00","#e6cd00","#e6cd00","#e6cd00","#e6cd00","#e3e3e3","#ece7c5","#f1e8a9","#f5e88d","#f8e96f","#fbe94e","#fee915","#ffe900","#ffe800","#ffe800","#ffe800","#ffe800","#ffe800","#ffe800","#ffe800","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#1f1e0d","#201f00","#201f00","#201f00","#201f00","#201f00","#201f00","#201f00","#201f00","#201f00","#201f00","#201f00","#201f00","#201f00","#313131","#343322","#353406","#363400","#363400","#363400","#363400","#363400","#363400","#363400","#363400","#363400","#363400","#363400","#363400","#484848","#4b4a35","#4d4b1e","#4e4b00","#4f4c00","#4f4c00","#4f4c00","#4f4c00","#4f4c00","#4f4c00","#4f4c00","#4f4c00","#4f4c00","#4f4c00","#4f4c00","#616161","#64634b","#666431","#686513","#686500","#696500","#696500","#696500","#696500","#696500","#696500","#696500","#696500","#696500","#696500","#7a7a7a","#7e7d63","#807e49","#827f2b","#837f00","#847f00","#848000","#858000","#858000","#858000","#858000","#858000","#858000","#858000","#858000","#949494","#98977b","#9b9862","#9d9945","#9e9a20","#9f9a00","#a09a00","#a19a00","#a19a00","#a19a00","#a19a00","#a19a00","#a19a00","#a19a00","#a19a00","#aeaeae","#b3b294","#b6b37a","#b8b45f","#b9b43f","#bbb500","#bcb500","#bcb600","#bcb600","#bcb600","#bcb600","#bcb600","#bcb600","#bcb600","#bcb600","#c8c8c8","#ceccac","#d1ce92","#d3cf76","#d5cf58","#d6d032","#d7d100","#d8d100","#d9d100","#d9d100","#d9d100","#d9d100","#d9d100","#d9d100","#d9d100","#e3e3e3","#eae8c5","#ece9a9","#efea8d","#f1eb6e","#f2ec4d","#f3ec0f","#f4ed00","#f5ed00","#f5ee00","#f6ee00","#f6ee00","#f6ee00","#f6ee00","#f6ee00","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#1c1f10","#192100","#192100","#192100","#192100","#192100","#192100","#192100","#192100","#192100","#192100","#192100","#192100","#192100","#313131","#313424","#2f350d","#2d3700","#2d3700","#2d3700","#2d3700","#2d3700","#2d3700","#2d3700","#2d3700","#2d3700","#2d3700","#2d3700","#2d3700","#484848","#484b37","#474c21","#454e00","#434f00","#434f00","#434f00","#434f00","#434f00","#434f00","#434f00","#434f00","#434f00","#434f00","#434f00","#616161","#60644d","#606634","#5e6719","#5d6800","#5c6900","#5a6900","#5a6900","#5a6900","#5a6900","#5a6900","#5a6900","#5a6900","#5a6900","#5a6900","#7a7a7a","#7a7e65","#7a804d","#798131","#788204","#778300","#768400","#748400","#748400","#748400","#748400","#748400","#748400","#748400","#748400","#949494","#95987c","#949a64","#939c49","#929d26","#919e00","#919f00","#909f00","#909f00","#909f00","#909f00","#909f00","#909f00","#909f00","#909f00","#aeaeae","#b0b295","#afb57c","#aeb663","#adb844","#acb911","#acba00","#abba00","#abbb00","#aabb00","#aabb00","#aabb00","#aabb00","#aabb00","#aabb00","#c8c8c8","#cbcdad","#cacf94","#cad17a","#c9d35d","#c8d438","#c7d500","#c6d600","#c6d700","#c5d700","#c5d700","#c5d700","#c5d700","#c5d700","#c5d700","#e3e3e3","#e7e9c6","#e6ebaa","#e6ed8f","#e5ef71","#e4f051","#e3f117","#e2f200","#e1f300","#e1f400","#e1f400","#e1f400","#e1f400","#e1f400","#e1f400","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#1a1f12","#112200","#0a2300","#0a2300","#0a2300","#0a2300","#0a2300","#0a2300","#0a2300","#0a2300","#0a2300","#0a2300","#0a2300","#0a2300","#313131","#2f3426","#2a3614","#233800","#1c3a00","#133c00","#133c00","#133c00","#133c00","#133c00","#133c00","#133c00","#133c00","#133c00","#133c00","#484848","#454b39","#404e26","#3c500c","#375100","#315300","#2b5400","#2b5400","#2b5400","#2b5400","#2b5400","#2b5400","#2b5400","#2b5400","#2b5400","#616161","#5e654f","#596739","#556922","#506b00","#4c6c00","#4a6d00","#466e00","#466e00","#466e00","#466e00","#466e00","#466e00","#466e00","#466e00","#7a7a7a","#777e67","#748152","#6f8439","#6a8519","#678700","#638800","#618900","#5e8a00","#5e8a00","#5e8a00","#5e8a00","#5e8a00","#5e8a00","#5e8a00","#949494","#91997e","#8e9b68","#8a9e51","#85a033","#81a200","#7da300","#7ba400","#7aa400","#79a500","#79a500","#79a500","#79a500","#79a500","#79a500","#aeaeae","#acb397","#a8b680","#a5b969","#a1bb4f","#9cbd29","#98be00","#95c000","#93c000","#92c100","#90c100","#90c100","#90c100","#90c100","#90c100","#c8c8c8","#c8ceaf","#c5d197","#c1d37f","#bcd665","#b8d846","#b4da08","#b1db00","#aedc00","#acdd00","#abdd00","#aade00","#aade00","#aade00","#aade00","#e3e3e3","#e3eac7","#e0edad","#dcef93","#d8f277","#d5f459","#d0f62d","#cdf700","#c9f900","#c7fa00","#c6fa00","#c4fb00","#c4fb00","#c4fb00","#c4fb00","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#172015","#072304","#002500","#002700","#002700","#002700","#002700","#002700","#002700","#002700","#002700","#002700","#002700","#002700","#313131","#2c3429","#23371b","#163a09","#003c00","#003e00","#004000","#004100","#004100","#004100","#004100","#004100","#004100","#004100","#004100","#484848","#414c3d","#384f2d","#2e521c","#215400","#065600","#005800","#005a00","#005a00","#005a00","#005a00","#005a00","#005a00","#005a00","#005a00","#616161","#596553","#506941","#466c2f","#3a6e15","#2c7100","#177300","#007400","#007600","#007800","#007800","#007800","#007800","#007800","#007800","#7a7a7a","#737f6b","#6a835a","#618646","#568931","#4b8b0e","#3d8d00","#2f8f00","#209000","#069100","#009300","#009300","#009300","#009300","#009300","#949494","#8c9a82","#849d70","#7ba15d","#71a447","#66a62d","#5ba900","#4fab00","#45ac00","#3cad00","#33ae00","#27af00","#27af00","#27af00","#27af00","#aeaeae","#a6b59b","#9eb889","#96bc76","#8cbf61","#82c248","#77c428","#6cc600","#63c800","#5ac900","#54ca00","#4ccb00","#45cc00","#45cc00","#45cc00","#c8c8c8","#c1d0b4","#b8d4a0","#afd78c","#a7da77","#9ddd5f","#93e042","#88e20a","#7ee400","#74e600","#6ee700","#65e800","#5ee900","#57ea00","#4eeb00","#e3e3e3","#dcebcc","#d3f0b7","#c9f3a0","#c0f78a","#b6fa71","#adfd55","#a2ff30","#97ff00","#8dff00","#84ff00","#7aff00","#7aff00","#7aff00","#7aff00","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#152017","#00230c","#002602","#002900","#002900","#002900","#002900","#002900","#002900","#002900","#002900","#002900","#002900","#002900","#313131","#2a352b","#1c3821","#063b16","#003d09","#003f00","#004100","#004300","#004300","#004300","#004300","#004300","#004300","#004300","#004300","#484848","#3f4d3f","#315033","#215327","#005619","#005806","#005a00","#005c00","#005c00","#005c00","#005c00","#005c00","#005c00","#005c00","#005c00","#616161","#576656","#496a48","#396d3a","#23702a","#007317","#007600","#007800","#007900","#007b00","#007b00","#007b00","#007b00","#007b00","#007b00","#7a7a7a","#6f806e","#638461","#558852","#438b42","#2b8e31","#009119","#009300","#009500","#009700","#009900","#009900","#009900","#009900","#009900","#949494","#889b86","#7c9f78","#6ea369","#5ea659","#4ba949","#30ac36","#00af1a","#00b100","#00b400","#00b600","#00b700","#00b700","#00b700","#00b700","#aeaeae","#a2b59f","#95ba90","#89bd82","#7ac172","#69c561","#53c84f","#35cb3a","#00ce1b","#00d000","#00d200","#00d400","#00d600","#00d600","#00d600","#c8c8c8","#bcd1b8","#afd5a8","#a1d998","#93dd89","#82e178","#6fe465","#57e751","#32ea39","#00ed0c","#00ef00","#00f200","#00f200","#00f200","#00f200","#e3e3e3","#d6edd1","#c8f1c0","#b8f6ad","#aafa9d","#99fe8b","#87ff79","#71ff65","#52ff4d","#19ff2e","#00ff00","#00ff00","#00ff00","#00ff00","#00ff00","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#132019","#002412","#00270c","#002a07","#002a07","#002a07","#002a07","#002a07","#002a07","#002a07","#002a07","#002a07","#002a07","#002a07","#313131","#28352d","#163927","#003c21","#003e1c","#004016","#004211","#00440e","#00440e","#00440e","#00440e","#00440e","#00440e","#00440e","#00440e","#484848","#3c4d42","#2a513a","#085434","#00572e","#005928","#005c22","#005d1d","#005d1d","#005d1d","#005d1d","#005d1d","#005d1d","#005d1d","#005d1d","#616161","#536659","#416b51","#256f48","#007241","#007539","#007832","#007a2c","#007c27","#007d22","#007d22","#007d22","#007d22","#007d22","#007d22","#7a7a7a","#6c8172","#5b8569","#468960","#238d57","#00904f","#009347","#00963f","#009838","#009b31","#009d2b","#009d2b","#009d2b","#009d2b","#009d2b","#949494","#849b8a","#73a081","#5fa477","#46a86e","#18ab65","#00af5c","#00b253","#00b44b","#00b743","#00b93b","#00bc34","#00bc34","#00bc34","#00bc34","#aeaeae","#9eb6a4","#8dbb9a","#7bbf90","#64c385","#45c77b","#00cb72","#00ce68","#00d15f","#00d356","#00d64d","#00d944","#00db3c","#00db3c","#00db3c","#c8c8c8","#b7d1bd","#a6d6b2","#92dba7","#7ddf9d","#63e392","#38e787","#00ea7e","#00ee73","#00f168","#00f35e","#00f655","#00f84c","#00fa45","#00fd3c","#e3e3e3","#d1edd7","#bff3cb","#a8f8bd","#92fdb2","#78ffa7","#57ff9c","#00ff91","#00ff85","#00ff78","#00ff78","#00ff78","#00ff78","#00ff78","#00ff78","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#12201a","#002416","#002713","#002a11","#002b10","#002b10","#002b10","#002b10","#002b10","#002b10","#002b10","#002b10","#002b10","#002b10","#313131","#27352e","#12392a","#003c27","#003e24","#004022","#004220","#00441f","#00451e","#00471e","#00471e","#00471e","#00471e","#00471e","#00471e","#484848","#3b4d44","#25513f","#00553a","#005737","#005a34","#005c32","#005e31","#005f2f","#00602e","#00622e","#00632d","#00642c","#00642c","#00642c","#616161","#52675c","#3c6b56","#196f50","#00734c","#007649","#007946","#007b43","#007c42","#007e40","#007f3f","#00803e","#00823e","#00833d","#00843c","#7a7a7a","#6a8175","#56856e","#3c8a69","#008e64","#00915f","#00945b","#009759","#009956","#009b54","#009d52","#009f51","#00a050","#00a24f","#00a34e","#949494","#829b8e","#6da187","#56a581","#33a97c","#00ac77","#00b073","#00b36f","#00b56c","#00b869","#00ba67","#00bc65","#00be63","#00c061","#00c260","#aeaeae","#9cb6a7","#88bba0","#72c09a","#55c494","#1dc88f","#00cc8a","#00cf85","#00d282","#00d57f","#00d87c","#00da79","#00dc77","#00de76","#00e074","#c8c8c8","#b5d2c1","#a1d7ba","#88dcb2","#6de0ac","#45e4a6","#00e8a1","#00ec9c","#00ef98","#00f294","#00f591","#00f88e","#00fa8c","#00fa8c","#00fa8c","#e3e3e3","#cfeddb","#b9f3d3","#9df9cb","#80fec4","#5bffbe","#00ffb8","#00ffb3","#00ffae","#00ffae","#00ffae","#00ffae","#00ffae","#00ffae","#00ffae","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#11201b","#002419","#002718","#002a17","#002b17","#002b17","#002b17","#002b17","#002b17","#002b17","#002b17","#002b17","#002b17","#002b17","#313131","#263530","#0e392d","#003c2b","#003e2a","#004029","#004228","#004428","#004528","#004728","#004728","#004728","#004728","#004728","#004728","#484848","#3a4d46","#215142","#005540","#00573e","#005a3d","#005c3c","#005e3b","#005f3b","#00613a","#00623a","#00633a","#00643a","#00643a","#00643a","#616161","#51675e","#396b5a","#096f57","#007354","#007652","#007951","#007b50","#007c4f","#007e4e","#007f4e","#00804d","#00824d","#00834d","#00844d","#7a7a7a","#698177","#538672","#368a6f","#008e6c","#009169","#009567","#009766","#009964","#009c63","#009d62","#009f61","#00a061","#00a260","#00a360","#949494","#819b90","#6aa18b","#50a588","#25a984","#00ac81","#00b07e","#00b37c","#00b67a","#00b879","#00bb77","#00bd76","#00bf75","#00c074","#00c273","#aeaeae","#9ab6aa","#85bba5","#6dc0a1","#4cc49d","#00c899","#00cc96","#00d093","#00d391","#00d58f","#00d88d","#00da8c","#00dc8a","#00de8a","#00e088","#c8c8c8","#b3d2c4","#9ed7be","#83dcb9","#65e0b5","#32e5b1","#00e9ae","#00ecab","#00efa8","#00f3a5","#00f5a3","#00f8a2","#00fba0","#00fba0","#00fba0","#e3e3e3","#cdeede","#b5f4d8","#97f9d2","#76fecd","#4affc9","#00ffc5","#00ffc2","#00ffc2","#00ffc2","#00ffc2","#00ffc2","#00ffc2","#00ffc2","#00ffc2","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#10201c","#00241c","#00271c","#002a1e","#002c20","#002c20","#002c20","#002c20","#002c20","#002c20","#002c20","#002c20","#002c20","#002c20","#313131","#253531","#083930","#003c30","#003e30","#004130","#004330","#004431","#004532","#004733","#004733","#004733","#004733","#004733","#004733","#484848","#384d47","#1c5246","#005545","#005845","#005a44","#005c45","#005e45","#006045","#006146","#006246","#006347","#006548","#006548","#006548","#616161","#4f675f","#356b5e","#006f5c","#00735b","#00765b","#00795b","#007b5a","#007c5b","#007e5b","#00805b","#00815b","#00825c","#00835c","#00845d","#7a7a7a","#688179","#508677","#308a75","#008e73","#009172","#009571","#009771","#009a71","#009c71","#009d71","#009f71","#00a171","#00a271","#00a371","#949494","#809b92","#67a190","#4ba58e","#10a98c","#00ad8a","#00b089","#00b388","#00b687","#00b887","#00bb86","#00bd86","#00bf86","#00c086","#00c286","#aeaeae","#99b6ac","#83bba9","#68c0a7","#42c4a5","#00c8a3","#00cca1","#00d0a0","#00d39f","#00d59e","#00d89e","#00db9d","#00dc9d","#00de9c","#00e09c","#c8c8c8","#b3d2c6","#9bd7c3","#7fdcc0","#5ee0be","#1ae5bc","#00e9ba","#00ecb9","#00f0b7","#00f3b6","#00f6b5","#00f8b5","#00fcb4","#00fcb4","#00fcb4","#e3e3e3","#cceee1","#b3f4dd","#93f9da","#6dfed7","#37ffd5","#00ffd3","#00ffd2","#00ffd2","#00ffd2","#00ffd2","#00ffd2","#00ffd2","#00ffd2","#00ffd2","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#0e201e","#002420","#002723","#002a25","#002c28","#002c28","#002c28","#002c28","#002c28","#002c28","#002c28","#002c28","#002c28","#002c28","#313131","#243533","#043934","#003c35","#003e37","#004138","#00433a","#00443b","#00463d","#00463d","#00463d","#00463d","#00463d","#00463d","#00463d","#484848","#384d49","#18524a","#00554b","#00584c","#005a4e","#005c4f","#005e51","#006052","#006153","#006254","#006355","#006355","#006355","#006355","#616161","#4e6762","#326b62","#006f63","#007364","#007665","#007967","#007b68","#007d69","#007e6a","#00806b","#00816c","#00826d","#00836e","#00836e","#7a7a7a","#67817b","#4e867b","#2b8a7b","#008e7b","#00917c","#00957e","#00977f","#009a80","#009c82","#009e83","#009f84","#00a185","#00a286","#00a386","#949494","#7f9b94","#65a194","#47a594","#00a994","#00ad95","#00b095","#00b396","#00b697","#00b998","#00bb99","#00bd9b","#00bf9c","#00c19d","#00c29d","#aeaeae","#99b6ae","#81bbad","#65c0ad","#38c4ad","#00c8ad","#00ccad","#00d0ae","#00d2af","#00d5b0","#00d8b1","#00dab1","#00dcb2","#00deb3","#00deb3","#c8c8c8","#b2d1c8","#99d7c7","#7ddcc6","#57e0c6","#00e5c6","#00e9c6","#00ecc6","#00efc7","#00f3c8","#00f6c8","#00f6c8","#00f6c8","#00f6c8","#00f6c8","#e3e3e3","#cbede3","#b1f3e2","#8ff9e1","#66fee0","#19ffdf","#00ffdf","#00ffdf","#00ffdf","#00ffdf","#00ffdf","#00ffdf","#00ffdf","#00ffdf","#00ffdf","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#0c2020","#002425","#00272a","#002a2f","#002a2f","#002a2f","#002a2f","#002a2f","#002a2f","#002a2f","#002a2f","#002a2f","#002a2f","#002a2f","#313131","#233535","#003938","#003c3c","#003e40","#004143","#004346","#004449","#00464c","#00464c","#00464c","#00464c","#00464c","#00464c","#00464c","#484848","#364d4c","#13514f","#005553","#005756","#005a5a","#005c5d","#005e60","#006062","#006165","#006367","#006367","#006367","#006367","#006367","#616161","#4e6764","#306b67","#006f6b","#00736e","#007672","#007875","#007b78","#007d7b","#007e7d","#008080","#008182","#008283","#008283","#008283","#7a7a7a","#66817e","#4c8580","#248983","#008d86","#00918a","#00948d","#00978f","#009a93","#009c96","#009e98","#00a09a","#00a19c","#00a29e","#00a29e","#949494","#7f9b97","#64a099","#41a59c","#00a99f","#00aca1","#00b0a4","#00b3a7","#00b6aa","#00b8ac","#00bbaf","#00bdb2","#00bfb4","#00c1b6","#00c1b6","#aeaeae","#98b6b1","#7fbbb3","#62c0b5","#2cc4b7","#00c8ba","#00ccbc","#00cfbe","#00d2c1","#00d5c4","#00d8c6","#00dbc9","#00ddcc","#00ddcc","#00ddcc","#c8c8c8","#b2d1cb","#98d7cc","#7adcce","#4de0d0","#00e4d2","#00e8d4","#00ecd6","#00efd8","#00f3db","#00f3db","#00f3db","#00f3db","#00f3db","#00f3db","#e3e3e3","#cbede6","#aff3e7","#8cf9e8","#5cfeea","#00ffec","#00ffee","#00ffee","#00ffee","#00ffee","#00ffee","#00ffee","#00ffee","#00ffee","#00ffee","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#0b2022","#002429","#00272f","#002a37","#002a37","#002a37","#002a37","#002a37","#002a37","#002a37","#002a37","#002a37","#002a37","#002a37","#313131","#223536","#00393c","#003b41","#003e47","#00414b","#00434f","#004453","#004453","#004453","#004453","#004453","#004453","#004453","#004453","#484848","#364d4e","#0f5154","#005459","#00575e","#005a63","#005c67","#005e6b","#00606e","#006272","#006272","#006272","#006272","#006272","#006272","#616161","#4d6667","#2f6b6c","#006f71","#007277","#00757c","#007881","#007b86","#007d8a","#007e8d","#008090","#008193","#008193","#008193","#008193","#7a7a7a","#668180","#4c8585","#1d8989","#008d8f","#009194","#00949a","#00969e","#0099a3","#009ca7","#009eab","#00a0ae","#00a1b1","#00a1b1","#00a1b1","#949494","#7f9b9a","#63a09e","#3ea4a3","#00a8a8","#00acac","#00afb1","#00b2b5","#00b5ba","#00b8be","#00bbc2","#00bdc7","#00c0ca","#00c0ca","#00c0ca","#aeaeae","#98b6b4","#7ebbb8","#60bfbc","#25c3c0","#00c8c5","#00cbc9","#00cfce","#00d2d2","#00d5d6","#00d7da","#00dadf","#00dadf","#00dadf","#00dadf","#c8c8c8","#b2d1ce","#98d6d2","#76dbd7","#47e0db","#00e4df","#00e8e3","#00ebe7","#00efeb","#00f2f0","#00f2f0","#00f2f0","#00f2f0","#00f2f0","#00f2f0","#e3e3e3","#ccedea","#aef3ed","#89f9f2","#52fef6","#00fffa","#00fffe","#00fffe","#00fffe","#00fffe","#00fffe","#00fffe","#00fffe","#00fffe","#00fffe","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#0a2024","#00232d","#002635","#00293e","#00293e","#00293e","#00293e","#00293e","#00293e","#00293e","#00293e","#00293e","#00293e","#00293e","#313131","#223538","#003840","#003b47","#003e4f","#004057","#00425e","#004463","#004463","#004463","#004463","#004463","#004463","#004463","#004463","#484848","#354d50","#0e5158","#005460","#005667","#00596e","#005c75","#005e7b","#006080","#006183","#006183","#006183","#006183","#006183","#006183","#616161","#4d6669","#2f6a70","#006e78","#007180","#007488","#00778f","#007a96","#007c9b","#007ea0","#0080a5","#0081a9","#0081a9","#0081a9","#0081a9","#7a7a7a","#668082","#4c8489","#1c8891","#008c99","#008fa0","#0093a8","#0095ae","#0098b5","#009bbc","#009ec2","#00a0c6","#00a1ca","#00a1ca","#00a1ca","#949494","#7f9b9c","#659fa3","#3ea3aa","#00a7b1","#00abb8","#00aec0","#00b1c6","#00b4cd","#00b7d4","#00bada","#00bde1","#00c0e7","#00c0e7","#00c0e7","#aeaeae","#99b5b6","#7fbabd","#61bec3","#21c2ca","#00c6d2","#00cad9","#00cde0","#00d1e7","#00d4ed","#00d7f2","#00d9f9","#00d9f9","#00d9f9","#00d9f9","#c8c8c8","#b3d0d0","#98d6d7","#77dade","#44dfe4","#00e3eb","#00e7f2","#00ebf8","#00efff","#00f2ff","#00f2ff","#00f2ff","#00f2ff","#00f2ff","#00f2ff","#e3e3e3","#cdecec","#aff2f3","#89f8fa","#51fdff","#00ffff","#00ffff","#00ffff","#00ffff","#00ffff","#00ffff","#00ffff","#00ffff","#00ffff","#00ffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#0a2026","#002330","#002539","#002844","#002844","#002844","#002844","#002844","#002844","#002844","#002844","#002844","#002844","#002844","#313131","#22353a","#003843","#003a4d","#003d56","#004060","#004268","#004268","#004268","#004268","#004268","#004268","#004268","#004268","#004268","#484848","#364d52","#10505c","#005366","#00566f","#005878","#005b81","#005d89","#005f8f","#005f8f","#005f8f","#005f8f","#005f8f","#005f8f","#005f8f","#616161","#4e666a","#316a74","#006d7e","#007088","#007392","#00769b","#0079a4","#007baa","#007db3","#007db3","#007db3","#007db3","#007db3","#007db3","#7a7a7a","#688084","#4e848d","#228797","#008ba0","#008eaa","#0091b4","#0094bd","#0097c6","#009acf","#009dd8","#009dd8","#009dd8","#009dd8","#009dd8","#949494","#819a9e","#689ea7","#42a2b1","#00a6ba","#00a9c3","#00adcd","#00b0d6","#00b3e0","#00b6e8","#00b9f1","#00b9f1","#00b9f1","#00b9f1","#00b9f1","#aeaeae","#9bb5b8","#81b9c1","#63bdca","#2bc1d3","#00c5dd","#00c9e7","#00ccf0","#00d0fb","#00d2ff","#00d2ff","#00d2ff","#00d2ff","#00d2ff","#00d2ff","#c8c8c8","#b6d0d2","#9ad5db","#79d9e4","#47ddee","#00e2f8","#00e6ff","#00e9ff","#00edff","#00edff","#00edff","#00edff","#00edff","#00edff","#00edff","#e3e3e3","#d0ebee","#b0f1f8","#8af7ff","#54fbff","#54fbff","#54fbff","#54fbff","#54fbff","#54fbff","#54fbff","#54fbff","#54fbff","#54fbff","#54fbff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#0b2027","#002232","#00243d","#002648","#002857","#002857","#002857","#002857","#002857","#002857","#002857","#002857","#002857","#002857","#313131","#22353b","#003746","#003952","#003c5e","#003e69","#004073","#004073","#004073","#004073","#004073","#004073","#004073","#004073","#004073","#484848","#364c54","#164f60","#00526b","#005476","#005682","#00598d","#005b98","#005da1","#005da1","#005da1","#005da1","#005da1","#005da1","#005da1","#616161","#4f656c","#366978","#006b83","#006e8f","#00709b","#0073a6","#0076b2","#0078be","#007ac9","#007ac9","#007ac9","#007ac9","#007ac9","#007ac9","#7a7a7a","#697f85","#528390","#2e869c","#0088a8","#008bb4","#008ec0","#0091cc","#0094d9","#0096e5","#0099f0","#0099f0","#0099f0","#0099f0","#0099f0","#949494","#83999f","#6c9daa","#4ca1b6","#00a4c2","#00a6ce","#00a9da","#00ace6","#00aff3","#00b2ff","#00b5ff","#00b5ff","#00b5ff","#00b5ff","#00b5ff","#aeaeae","#9eb4b9","#86b8c5","#69bcd0","#3ebfdc","#00c2e9","#00c6f7","#00c8ff","#00ccff","#00ccff","#00ccff","#00ccff","#00ccff","#00ccff","#00ccff","#c8c8c8","#b9cfd4","#9fd3e0","#81d7ec","#52dbf9","#00dfff","#00e3ff","#00e3ff","#00e3ff","#00e3ff","#00e3ff","#00e3ff","#00e3ff","#00e3ff","#00e3ff","#e3e3e3","#d3eaef","#b5f0fd","#93f4ff","#93f4ff","#93f4ff","#93f4ff","#93f4ff","#93f4ff","#93f4ff","#93f4ff","#93f4ff","#93f4ff","#93f4ff","#93f4ff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#0d1f29","#002134","#00223f","#00244b","#002659","#002659","#002659","#002659","#002659","#002659","#002659","#002659","#002659","#002659","#313131","#23343d","#063649","#003855","#003a62","#003c6e","#003e78","#004084","#004084","#004084","#004084","#004084","#004084","#004084","#004084","#484848","#384c56","#1e4e62","#00506e","#00527b","#005487","#005693","#0058a0","#005aaa","#005aaa","#005aaa","#005aaa","#005aaa","#005aaa","#005aaa","#616161","#52656d","#3c677a","#1a6986","#006c93","#006da0","#0070ac","#0072b9","#0075c7","#0076d1","#0076d1","#0076d1","#0076d1","#0076d1","#0076d1","#7a7a7a","#6c7e87","#588193","#3c84a0","#0086ac","#0088b9","#008bc7","#008dd4","#008fe2","#0092f0","#0094fb","#0094fb","#0094fb","#0094fb","#0094fb","#949494","#8699a0","#729cac","#589eba","#30a1c7","#00a3d4","#00a6e2","#00a8f0","#00abff","#00aeff","#00b0ff","#00b0ff","#00b0ff","#00b0ff","#00b0ff","#aeaeae","#a0b3ba","#8bb7c7","#73bad3","#50bce1","#00bff0","#00c2ff","#00c5ff","#00c5ff","#00c5ff","#00c5ff","#00c5ff","#00c5ff","#00c5ff","#00c5ff","#c8c8c8","#bcced4","#a4d2e2","#8ad5f0","#62d9ff","#00dcff","#00dcff","#00dcff","#00dcff","#00dcff","#00dcff","#00dcff","#00dcff","#00dcff","#00dcff","#e3e3e3","#d6e9f0","#baeeff","#9af3ff","#9af3ff","#9af3ff","#9af3ff","#9af3ff","#9af3ff","#9af3ff","#9af3ff","#9af3ff","#9af3ff","#9af3ff","#9af3ff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#1d1d1d","#0f1f2a","#002035","#002140","#00224d","#00245a","#00245a","#00245a","#00245a","#00245a","#00245a","#00245a","#00245a","#00245a","#313131","#26343e","#10354b","#003757","#003865","#003a71","#003b7d","#003c8a","#003c8a","#003c8a","#003c8a","#003c8a","#003c8a","#003c8a","#003c8a","#484848","#3b4b57","#274d64","#004e71","#00507d","#00518a","#005397","#0055a4","#0056af","#0056af","#0056af","#0056af","#0056af","#0056af","#0056af","#616161","#54646e","#43667c","#2b6888","#006996","#006ba2","#006daf","#006ebd","#0070cb","#0072d8","#0072d8","#0072d8","#0072d8","#0072d8","#0072d8","#7a7a7a","#6e7e88","#5e8095","#4982a2","#2584af","#0085bd","#0087cb","#0089d8","#008be7","#008df4","#008fff","#008fff","#008fff","#008fff","#008fff","#949494","#8998a1","#799aae","#649cbc","#489eca","#06a0d7","#00a2e7","#00a4f6","#00a7ff","#00a9ff","#00abff","#00abff","#00abff","#00abff","#00abff","#aeaeae","#a3b2bb","#92b5c8","#7eb7d6","#65b9e5","#37bcf5","#00beff","#00c0ff","#00c0ff","#00c0ff","#00c0ff","#00c0ff","#00c0ff","#00c0ff","#00c0ff","#c8c8c8","#becdd5","#acd0e4","#96d3f3","#76d6ff","#47d8ff","#47d8ff","#47d8ff","#47d8ff","#47d8ff","#47d8ff","#47d8ff","#47d8ff","#47d8ff","#47d8ff","#e3e3e3","#d9e9f0","#c1ecff","#a6f0ff","#a6f0ff","#a6f0ff","#a6f0ff","#a6f0ff","#a6f0ff","#a6f0ff","#a6f0ff","#a6f0ff","#a6f0ff","#a6f0ff","#a6f0ff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#131e2b","#011f36","#001f42","#001f4e","#00205b","#00205b","#00205b","#00205b","#00205b","#00205b","#00205b","#00205b","#00205b","#00205b","#313131","#28333f","#1a344c","#003459","#003566","#003673","#003680","#00378f","#00378f","#00378f","#00378f","#00378f","#00378f","#00378f","#00378f","#484848","#3e4a58","#304b65","#194c72","#004d7f","#004d8c","#004e9a","#004fa7","#0050b4","#0050b4","#0050b4","#0050b4","#0050b4","#0050b4","#0050b4","#616161","#58636f","#4b647d","#3b658a","#1e6698","#0067a4","#0068b1","#0069c0","#0069ce","#006adc","#006adc","#006adc","#006adc","#006adc","#006adc","#7a7a7a","#727d88","#657e96","#567fa4","#4280b1","#1e81bf","#0082cd","#0083db","#0084eb","#0086fa","#0087ff","#0087ff","#0087ff","#0087ff","#0087ff","#949494","#8c97a1","#8098af","#719abd","#5f9bcc","#469cda","#009dea","#009ffa","#00a0ff","#00a1ff","#00a1ff","#00a1ff","#00a1ff","#00a1ff","#00a1ff","#aeaeae","#a7b1bb","#9ab3ca","#8bb4d8","#79b6e7","#5fb7f8","#33b9ff","#00baff","#00baff","#00baff","#00baff","#00baff","#00baff","#00baff","#00baff","#c8c8c8","#c2ccd5","#b4cee5","#a2d0f5","#8dd2ff","#6fd4ff","#6fd4ff","#6fd4ff","#6fd4ff","#6fd4ff","#6fd4ff","#6fd4ff","#6fd4ff","#6fd4ff","#6fd4ff","#e3e3e3","#dde7f0","#cbeaff","#b7ecff","#b7ecff","#b7ecff","#b7ecff","#b7ecff","#b7ecff","#b7ecff","#b7ecff","#b7ecff","#b7ecff","#b7ecff","#b7ecff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#161d2b","#0c1d36","#001d42","#001c4e","#001b5b","#001967","#001770","#00147b","#001183","#000d8d","#000895","#00029e","#0000a7","#0000b0","#313131","#2c3240","#22324c","#12325a","#003267","#003174","#003180","#002f8e","#002d9c","#002ca8","#002ab0","#0028ba","#0025c6","#0023cf","#0021d4","#484848","#414958","#384966","#2b4a73","#164a80","#004a8d","#00499b","#0049a8","#0048b6","#0047c4","#0046d0","#0044dc","#0043ea","#0041f3","#003ffe","#616161","#5b6270","#53627d","#48638b","#386399","#2163a6","#0063b2","#0063c0","#0063cf","#0063de","#0062ef","#0061fd","#005fff","#005eff","#005dff","#7a7a7a","#757c89","#6d7c96","#627da4","#557db2","#447dc0","#277ece","#007edc","#007eec","#007efc","#007eff","#007eff","#007dff","#007dff","#007dff","#949494","#8f96a2","#8797af","#7c97bf","#7197cd","#6198db","#4999eb","#1a99fc","#009aff","#009aff","#009aff","#009aff","#009aff","#009aff","#009aff","#aeaeae","#a9b0bb","#a0b1ca","#96b2d9","#89b2e8","#79b3f9","#5fb4ff","#3fb4ff","#3fb4ff","#3fb4ff","#3fb4ff","#3fb4ff","#3fb4ff","#3fb4ff","#3fb4ff","#c8c8c8","#c4cbd5","#bacce5","#aecdf7","#9eceff","#8dceff","#8dceff","#8dceff","#8dceff","#8dceff","#8dceff","#8dceff","#8dceff","#8dceff","#8dceff","#e3e3e3","#e0e7f0","#d4e7ff","#c5e9ff","#c5e9ff","#c5e9ff","#c5e9ff","#c5e9ff","#c5e9ff","#c5e9ff","#c5e9ff","#c5e9ff","#c5e9ff","#c5e9ff","#c5e9ff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#1b1c2c","#191a36","#171841","#17144c","#190f54","#1c075d","#200065","#25006e","#280075","#2c007d","#300085","#34008d","#390097","#3e00a1","#313131","#303140","#2d304d","#2a2e59","#262c65","#252970","#25257a","#271f84","#2a188d","#2d0b97","#31009f","#3500a9","#3800b1","#3c00b9","#4000c1","#484848","#464859","#424766","#3f4573","#3b447f","#37428c","#343f97","#323ba4","#3236b0","#3431b9","#362bc2","#3921cd","#3c12d7","#3f00e0","#4200e8","#616161","#5f6170","#5c607d","#585f8a","#535e98","#4e5ca5","#495bb1","#4458bd","#4155ca","#3f51d7","#3e4ce5","#3e47ef","#3f41fa","#4139ff","#4231ff","#7a7a7a","#787b89","#757a96","#7079a4","#6c78b2","#6777be","#6275cc","#5b74da","#5472e8","#4e6ff7","#496bff","#4667ff","#4361ff","#3a5cff","#3a5cff","#949494","#9395a2","#8f94af","#8a93be","#8693cb","#8192d9","#7a90e9","#728ff9","#668dff","#608bff","#5888ff","#5888ff","#5888ff","#5888ff","#5888ff","#aeaeae","#adafbb","#a8afca","#a4aed9","#9eade9","#98acf9","#91abff","#89aaff","#89aaff","#89aaff","#89aaff","#89aaff","#89aaff","#89aaff","#89aaff","#c8c8c8","#c8cad5","#c2cae5","#bcc9f6","#b5c8ff","#aec7ff","#aec7ff","#aec7ff","#aec7ff","#aec7ff","#aec7ff","#aec7ff","#aec7ff","#aec7ff","#aec7ff","#e3e3e3","#e3e6f0","#dde5ff","#d6e5ff","#d6e5ff","#d6e5ff","#d6e5ff","#d6e5ff","#d6e5ff","#d6e5ff","#d6e5ff","#d6e5ff","#d6e5ff","#d6e5ff","#d6e5ff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#1f1b2c","#211835","#23143f","#260f47","#29084f","#2d0057","#31005f","#350067","#39006e","#3e0076","#42007e","#470086","#4d0091","#53009b","#313131","#333040","#352d4b","#362b55","#382760","#3b226a","#3e1c73","#41137c","#450485","#4a008e","#4e0097","#5300a0","#5700a8","#5c00b1","#6100ba","#484848","#4a4758","#4b4465","#4c4271","#4d3f7c","#4f3b87","#513791","#54319c","#582aa6","#5c21af","#6013b8","#6400c1","#6800cb","#6c00d4","#7100dd","#616161","#626070","#635e7c","#635c89","#645995","#6556a0","#6653ac","#684fb7","#6b4ac2","#6e45cc","#713dd8","#7436e0","#782cea","#7d1bf5","#8000fe","#7a7a7a","#7c7a88","#7c7895","#7c76a3","#7c74af","#7d71bb","#7d6ec7","#7e6bd4","#7f67e0","#8163eb","#845ef7","#8757ff","#8a50ff","#8e45ff","#8e45ff","#949494","#9594a1","#9593ae","#9591bc","#958fc9","#958cd6","#958ae4","#9586f2","#9682ff","#977fff","#987aff","#987aff","#987aff","#987aff","#987aff","#aeaeae","#afafbb","#afadc9","#aeabd7","#aea9e6","#ada7f5","#aea4ff","#afa0ff","#afa0ff","#afa0ff","#afa0ff","#afa0ff","#afa0ff","#afa0ff","#afa0ff","#c8c8c8","#cacad4","#c9c8e4","#c8c6f4","#c8c3ff","#c8c0ff","#c8c0ff","#c8c0ff","#c8c0ff","#c8c0ff","#c8c0ff","#c8c0ff","#c8c0ff","#c8c0ff","#c8c0ff","#e3e3e3","#e6e5ef","#e4e3ff","#e0e2ff","#e0e2ff","#e0e2ff","#e0e2ff","#e0e2ff","#e0e2ff","#e0e2ff","#e0e2ff","#e0e2ff","#e0e2ff","#e0e2ff","#e0e2ff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#221a2b","#261633","#2a113b","#2f0a43","#33014a","#380052","#3c0059","#410061","#450067","#4a006e","#4f0076","#55007e","#5c0089","#620092","#313131","#362f3f","#3a2c49","#3e2851","#43235b","#471c64","#4c136d","#510375","#55007d","#5b0085","#60008e","#650096","#6b00a0","#7100a9","#7800b3","#484848","#4d4657","#514263","#553f6d","#593b77","#5e3581","#632f8a","#682794","#6d1c9d","#7108a5","#7600ad","#7c00b6","#8100c0","#8600c8","#8c00d2","#616161","#655f6f","#695c7b","#6c5985","#705690","#74519a","#794da4","#7d47ae","#8240b8","#8738c1","#8c2dcc","#9121d3","#9605dc","#9b00e6","#a000ef","#7a7a7a","#7e7987","#817793","#84749f","#8870ab","#8c6db5","#9068c0","#9564ca","#995ed5","#9e59de","#a351e9","#a848f4","#ad3dfe","#b32eff","#b32eff","#949494","#9893a1","#9b91ac","#9e8eb9","#a18bc5","#a588d1","#a984dc","#ad7fe8","#b379f4","#b775fe","#bd6dff","#bd6dff","#bd6dff","#bd6dff","#bd6dff","#aeaeae","#b2aeba","#b5acc7","#b7a9d4","#bba6e1","#bea2ee","#c39efc","#c899ff","#c899ff","#c899ff","#c899ff","#c899ff","#c899ff","#c899ff","#c899ff","#c8c8c8","#ccc9d4","#cfc6e2","#d2c4f0","#d5c0ff","#dbbbff","#dbbbff","#dbbbff","#dbbbff","#dbbbff","#dbbbff","#dbbbff","#dbbbff","#dbbbff","#dbbbff","#e3e3e3","#e7e4ef","#eae2ff","#eddeff","#eddeff","#eddeff","#eddeff","#eddeff","#eddeff","#eddeff","#eddeff","#eddeff","#eddeff","#eddeff","#eddeff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#25192a","#2a1431","#2f0f38","#34063f","#390046","#3e004d","#430054","#49005b","#4d0061","#530068","#590070","#5e0076","#660080","#660080","#313131","#392e3e","#3e2b46","#43264e","#492057","#4f185f","#540a67","#5a006f","#5f0076","#65007e","#6b0086","#71008e","#780097","#7f00a0","#8700aa","#484848","#504556","#564160","#5c3d69","#623772","#67317c","#6e2984","#731e8c","#790b95","#7e009d","#8400a4","#8a00ac","#9100b5","#9700bd","#9e00c6","#616161","#685e6e","#6e5b78","#735782","#78538b","#7e4e94","#84489d","#8a41a6","#9138b0","#962db8","#9c1cc1","#a200c8","#a800d1","#ae00d9","#b500e3","#7a7a7a","#817986","#867591","#8c719b","#926da6","#9769af","#9d64b9","#a35ec2","#a958cb","#af50d4","#b547dd","#bb3be7","#c22af1","#c80bf9","#d000ff","#949494","#9a93a0","#a090aa","#a58cb5","#ab88c0","#b084ca","#b67fd4","#bd7adf","#c374e9","#c96df3","#cf65fe","#d858ff","#df4cff","#e738ff","#f009ff","#aeaeae","#b4aeb9","#b9aac5","#bfa7d0","#c4a3db","#ca9fe7","#d19af3","#d795fd","#de8eff","#e588ff","#ec7fff","#f574ff","#f574ff","#f574ff","#f574ff","#c8c8c8","#cec9d3","#d3c5e0","#d9c2ec","#dfbdfa","#e6b9ff","#ecb4ff","#f3aeff","#f3aeff","#f3aeff","#f3aeff","#f3aeff","#f3aeff","#f3aeff","#f3aeff","#e3e3e3","#e9e4ee","#eee0fe","#f5dcff","#fed7ff","#fed7ff","#fed7ff","#fed7ff","#fed7ff","#fed7ff","#fed7ff","#fed7ff","#fed7ff","#fed7ff","#fed7ff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#261829","#2c1330","#310d36","#37033d","#3c0043","#420049","#480051","#4d0057","#52005d","#580063","#5e006a","#630070","#630070","#630070","#313131","#3b2e3c","#412944","#47254b","#4e1d53","#55135b","#5b0162","#610069","#670070","#6d0077","#73007e","#7a0087","#81008f","#890097","#9300a3","#484848","#534454","#5b3f5d","#623a65","#69346d","#702c75","#77227d","#7d1185","#83008c","#8a0094","#90009a","#9600a2","#9e00aa","#a400b1","#ac00ba","#616161","#6b5d6c","#735974","#7a557c","#815085","#884a8c","#8f4394","#963a9d","#9e2ea5","#a51cad","#ac00b5","#b200bc","#b800c3","#c000cb","#c700d3","#7a7a7a","#837883","#8c748c","#946f95","#9c6a9e","#a365a6","#ab5eaf","#b257b6","#b94fbe","#c145c7","#c838cf","#d022d8","#d600df","#de00e7","#e500f0","#949494","#9e929d","#a68ea5","#ae89af","#b685b7","#be7fc0","#c67ac8","#ce73d1","#d66cda","#dd63e2","#e657ec","#ef49f6","#f736fe","#ff00ff","#ff00ff","#aeaeae","#b7adb7","#c0a9bf","#c9a4c8","#d19fd2","#db9adb","#e294e4","#eb8ded","#f486f6","#fd7dff","#ff73ff","#ff66ff","#ff56ff","#ff3fff","#ff3fff","#c8c8c8","#d1c8d0","#dbc3da","#e4bfe3","#efb9ee","#f8b3f7","#ffadff","#ffa6ff","#ff9fff","#ff9fff","#ff9fff","#ff9fff","#ff9fff","#ff9fff","#ff9fff","#e3e3e3","#ece3eb","#f8def6","#ffd9ff","#ffd2ff","#ffd2ff","#ffd2ff","#ffd2ff","#ffd2ff","#ffd2ff","#ffd2ff","#ffd2ff","#ffd2ff","#ffd2ff","#ffd2ff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#281827","#2e132e","#340b34","#3a013a","#3f0040","#450046","#4b004d","#510053","#560058","#5c005f","#620065","#69006c","#69006c","#69006c","#313131","#3d2d3b","#442941","#4b2347","#531a4f","#590e55","#60005c","#670063","#6e006a","#750070","#7b0077","#83007e","#8b0087","#93008f","#a0009b","#484848","#554452","#5e3e59","#663960","#6f3167","#77286e","#7f1976","#86007c","#8d0082","#94008a","#9b008f","#a20096","#a9009d","#b000a4","#ba00ad","#616161","#6d5d69","#775870","#805377","#884d7e","#904684","#993d8b","#a13392","#a82598","#b100a0","#ba00a8","#c000ad","#c700b3","#cf00ba","#d700c1","#7a7a7a","#857782","#907388","#9a6d8f","#a46797","#ac619d","#b559a4","#be51ab","#c647b1","#ce3ab8","#d726bf","#df00c5","#e600cc","#f000d4","#f700da","#949494","#a0929b","#a98da2","#b488a9","#be82b0","#c77cb7","#d175bd","#da6dc5","#e365cb","#eb5bd2","#f54dda","#fe3be1","#ff1fe9","#ff00f1","#ff00f9","#aeaeae","#b9acb5","#c4a8bc","#cfa2c3","#da9dca","#e496d1","#ee90d8","#f889df","#ff7fe7","#ff75ef","#ff69f6","#ff59ff","#ff46ff","#ff28ff","#ff28ff","#c8c8c8","#d2c8cf","#dfc3d6","#ebbddd","#f7b7e5","#ffb0ed","#ffa9f4","#ffa0fd","#ff98ff","#ff98ff","#ff98ff","#ff98ff","#ff98ff","#ff98ff","#ff98ff","#e3e3e3","#eee3ea","#fcddf2","#ffd7f9","#ffcfff","#ffcfff","#ffcfff","#ffcfff","#ffcfff","#ffcfff","#ffcfff","#ffcfff","#ffcfff","#ffcfff","#ffcfff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#291726","#30122c","#360a31","#3d0037","#43003d","#480042","#4f0048","#55004e","#5a0053","#61005a","#61005a","#61005a","#61005a","#61005a","#313131","#3f2c38","#47283d","#4f2142","#581748","#5f054e","#670053","#6f0059","#77005f","#7e0065","#85006a","#8e0071","#8e0071","#8e0071","#8e0071","#484848","#57434f","#623d54","#6c3759","#752e5e","#7e2264","#870f69","#8f006e","#980073","#a00079","#a7007d","#b00083","#b80088","#bf008d","#bf008d","#616161","#6f5d67","#7a576c","#855171","#8f4a75","#98427a","#a2387f","#aa2b84","#b31689","#bc008e","#c60094","#ce0099","#d6009e","#dd00a3","#e700a9","#7a7a7a","#87777f","#937284","#9f6c89","#ab648e","#b45e93","#bf5598","#c84b9d","#d13ea1","#da2da6","#e30aab","#ed00b1","#f400b5","#fd00ba","#ff00c0","#949494","#a19199","#ad8c9d","#ba86a2","#c480a6","#cf7aab","#da72b0","#e569b5","#ef5eba","#f952bf","#ff40c5","#ff2ac9","#ff00cf","#ff00d4","#ff00d9","#aeaeae","#bbacb3","#c8a7b7","#d5a1bc","#e19ac0","#ed94c5","#f88cca","#ff84cf","#ff79d5","#ff6cda","#ff5ce0","#ff4be6","#ff38ea","#ff38ea","#ff38ea","#c8c8c8","#d4c7cd","#e2c2d1","#f1bbd5","#ffb5da","#ffaedf","#ffa5e5","#ff9bea","#ff91f0","#ff91f0","#ff91f0","#ff91f0","#ff91f0","#ff91f0","#ff91f0","#e3e3e3","#efe3e8","#ffdded","#ffd6f1","#ffcef7","#ffcef7","#ffcef7","#ffcef7","#ffcef7","#ffcef7","#ffcef7","#ffcef7","#ffcef7","#ffcef7","#ffcef7","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2b1724","#321129","#39082e","#400033","#460037","#4d003c","#530041","#590045","#590045","#590045","#590045","#590045","#590045","#590045","#313131","#402c36","#49273a","#52203d","#5b1442","#640046","#6c004b","#740050","#7d0054","#840058","#8d005e","#8d005e","#8d005e","#8d005e","#8d005e","#484848","#59434c","#653c4f","#703552","#7a2b55","#841e59","#8d045c","#960061","#9f0065","#a70069","#af006c","#bb0073","#bb0073","#bb0073","#bb0073","#616161","#715c64","#7e5666","#8a4f68","#95476b","#9f3f6d","#a93370","#b32373","#bc0076","#c6007a","#d0007e","#d80081","#e20085","#ec008a","#ec008a","#7a7a7a","#89777d","#97717e","#a46a80","#b16382","#bc5b84","#c85087","#d24589","#dc358c","#e61d8f","#f00091","#f90094","#ff0098","#ff009b","#ff009e","#949494","#a39196","#b18c98","#bf8599","#cb7f9b","#d6789d","#e36f9f","#ee64a2","#f958a4","#ff4aa7","#ff30aa","#ff07ac","#ff00af","#ff00b2","#ff00b2","#aeaeae","#bcacb1","#cba6b2","#daa0b3","#e899b5","#f492b6","#ff89b8","#ff7fbb","#ff73bd","#ff65c0","#ff57c3","#ff43c5","#ff43c5","#ff43c5","#ff43c5","#c8c8c8","#d5c7cb","#e6c1cc","#f6bacd","#ffb3cf","#ffabd0","#ffa1d3","#ff97d5","#ff97d5","#ff97d5","#ff97d5","#ff97d5","#ff97d5","#ff97d5","#ff97d5","#e3e3e3","#f1e2e6","#ffdce7","#ffd4e8","#ffcdea","#ffcdea","#ffcdea","#ffcdea","#ffcdea","#ffcdea","#ffcdea","#ffcdea","#ffcdea","#ffcdea","#ffcdea","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#1d1d1d","#2c1722","#341026","#3b062a","#42002e","#4a0032","#510036","#57003a","#5e003d","#5e003d","#5e003d","#5e003d","#5e003d","#5e003d","#5e003d","#313131","#412c34","#4b2637","#541f39","#5e133c","#67003f","#700043","#780047","#80004a","#89004e","#89004e","#89004e","#89004e","#89004e","#89004e","#484848","#5a4349","#673c4a","#73344b","#7e2a4d","#881b4e","#920050","#9c0053","#a50055","#ae0058","#b7005b","#b7005b","#b7005b","#b7005b","#b7005b","#616161","#725c61","#805661","#8d4f61","#994662","#a33d62","#ae3064","#b81d65","#c20067","#cc0069","#d7006b","#df006d","#e90070","#e90070","#e90070","#7a7a7a","#8a777b","#99717a","#a76a7a","#b5627a","#c0597a","#cc4e7a","#d6427b","#e1317c","#eb127d","#f6007f","#ff0080","#ff0082","#ff0084","#ff0085","#949494","#a49195","#b38b94","#c28493","#ce7e92","#db7692","#e76d92","#f36293","#ff5494","#ff4595","#ff2996","#ff0097","#ff0098","#ff0098","#ff0098","#aeaeae","#bdacaf","#cda6ae","#dd9fad","#eb98ac","#f891ac","#ff87ac","#ff7cac","#ff70ac","#ff61ae","#ff51ae","#ff51ae","#ff51ae","#ff51ae","#ff51ae","#c8c8c8","#d6c7ca","#e8c1c8","#f9bac7","#ffb2c6","#ffaac5","#ff9fc5","#ff95c5","#ff95c5","#ff95c5","#ff95c5","#ff95c5","#ff95c5","#ff95c5","#ff95c5","#e3e3e3","#f2e2e5","#ffdbe3","#ffd4e1","#ffcde1","#ffcde1","#ffcde1","#ffcde1","#ffcde1","#ffcde1","#ffcde1","#ffcde1","#ffcde1","#ffcde1","#ffcde1","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],interpColor=function(f,a,c){var e,d,b,r;return void 0===f&&void 0===a||(void 0===f?f=a:void 0===a&&(a=f)),0===c?a:1===c?f:(d=parseInt(f.substr(1,2),16),r=parseInt(f.substr(3,2),16),f=parseInt(f.substr(5,2),16),b=parseInt(a.substr(1,2),16),e=parseInt(a.substr(3,2),16),a=parseInt(a.substr(5,2),16),d=Math.floor(d*c+b*(1-c)),b=Math.floor(r*c+e*(1-c)),r=Math.floor(f*c+a*(1-c)),createjs.Graphics.getRGB(d,b,r,1))},getMunsellColor=function(f,a,c){for(var e=Math.round(f/2.5);e<0;)e+=40;e%=40;var f=Math.floor(a/10),d=f+1,a=(f<0?d=f=0:10<f&&(d=f=10),(10*d-a)/10),c=(1<a?a=1:a<0&&(a=0),Math.round(14*c/100));return c<0?c=0:14<c&&(c=14),interpColor(MUNSELL[165*e+15*f+c],MUNSELL[165*e+15*d+c],a)},getcolor=function(f){var a=Math.floor(f/2.5),c=a+1,f=c-f/2.5;for(a%=40;a<0;)a+=40;return 40===(c=a+1)&&(c=0),[10*Math.floor(COLORS40[a][0]*f+COLORS40[c][0]*(1-f)),100*Math.floor(COLORS40[a][1]*f+COLORS40[c][1]*(1-f))/28,interpColor(COLORS40[a][2],COLORS40[c][2],f)]},searchColors=function(f,a,c){for(var e=-1,d=1e7,b=0;b<100;b++){var r=getcolor(b),o=parseInt(r[2].substr(1,2),16),t=parseInt(r[2].substr(3,2),16),r=parseInt(r[2].substr(5,2),16),o=(o-f)*(o-f)+(t-a)*(t-a)+(r-c)*(r-c);o<d&&(d=o,e=b)}return e};"undefined"!=typeof module&&module.exports&&(module.exports={interpColor:interpColor,getMunsellColor:getMunsellColor,getcolor:getcolor,searchColors:searchColors});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var SYNTHSVG='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" y="0px" xml:space="preserve" x="0px" width="SVGWIDTHpx" viewBox="0 0 SVGWIDTH 55" version="1.1" height="55px" enable-background="new 0 0 SVGWIDTH 55"><g transform="scale(XSCALE,1)"><path d="m 1.5,27.5 c 0,0 2.2,-17.5 6.875,-17.5 4.7,0.0 6.25,11.75 6.875,17.5 0.75,6.67 2.3,17.5 6.875,17.5 4.1,0.0 6.25,-13.6 6.875,-17.5 C 29.875,22.65 31.1,10 35.875,10 c 4.1,0.0 5.97,13.0 6.875,17.5 1.15,5.7 1.75,17.5 6.875,17.5 4.65,0.0 6.875,-17.5 6.875,-17.5" style="stroke:#90c100;fill-opacity:1;fill:none;stroke-width:STROKEWIDTHpx;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /></g></svg>',WHOLENOTE='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="svg6468" viewBox="0 0 5.1680003 12.432" height="12.432" width="5.1680002"> <g transform="translate(-375.23523,-454.37592)"> <g transform="translate(7.9606,5.6125499)" style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 369.80263,457.99537 q 1.104,0 1.872,0.432 0.768,0.416 0.768,1.2 0,0.752 -0.752,1.168 -0.752,0.4 -1.808,0.4 -1.104,0 -1.856,-0.416 -0.752,-0.416 -0.752,-1.232 0,-0.576 0.464,-0.944 0.48,-0.368 1.008,-0.48 0.528,-0.128 1.056,-0.128 z m -0.864,1.136 q 0,0.672 0.304,1.184 0.304,0.512 0.784,0.512 0.736,0 0.736,-0.8 0,-0.64 -0.304,-1.136 -0.288,-0.512 -0.8,-0.512 -0.72,0 -0.72,0.752 z" /> </g> </g> </svg>',HALFNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3.84 12.432" height="3.5085866mm" width="1.0837333mm"> <g transform="translate(-375.23523,-454.37592)"> <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 375.23523,465.70392 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-9.472 0.352,0 0,10.352 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 0.736,0.48 q 0.848,0 1.712,-0.72 0.88,-0.72 0.88,-1.072 0,-0.224 -0.192,-0.224 -0.592,0 -1.632,0.688 -1.024,0.672 -1.024,1.12 0,0.208 0.256,0.208 z" /> </g> </g> </svg>',QUARTERNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4.0859801 11.74224" height="3.313921mm" width="1.1531544mm"> <g transform="translate(-226.1339,-457.841)"> <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 229.60268,457.841 0.5625,0 0.0547,0.0625 0,10.02344 q 0,1.27344 -1.53125,1.625 l -0.375,0.0313 -0.27343,0 q -1.65625,0 -1.875,-1.03906 l -0.0313,-0.24219 q 0,-1.01562 1.64843,-1.20312 l 0.25782,-0.0391 q 0.77343,0 1.47656,0.5 l 0.0313,0 0,-9.65625 0.0547,-0.0625 z" /> </g> </g> </svg>',EIGHTHNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7.5234898 11.7422" height="3.3139098mm" width="2.123296mm"> <g transform="translate(-244.80575,-403.5553)"> <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 248.14955,403.5553 0.67969,0 0.0625,0.0547 0,0.30468 q 0.21094,0.42188 1.5625,0.91407 1.875,0.54687 1.875,1.625 0,1.14062 -0.95313,1.89062 l -0.0313,0 -0.23437,-0.25 q 0.47656,-0.38281 0.47656,-1.03906 0,-0.54688 -1.78125,-1.10156 -0.71875,-0.32813 -0.91406,-0.53125 l 0,8.32812 q 0,1.19531 -1.75,1.54688 l -0.44531,0 q -1.89063,0 -1.89063,-1.3125 0,-1.02344 1.65625,-1.20313 l 0.17969,0 q 0.75,0 1.44531,0.5 l 0,-9.67187 0.0625,-0.0547 z" /> </g> </g> </svg>',SIXTEENTHNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7.0080001 12.432" height="3.5085866mm" width="1.9778134mm"> <g transform="translate(-182.21292,-431.51877)"> <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 182.21292,442.84677 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-9.472 0.336,0 q 0.064,0.56 0.4,1.088 0.352,0.512 0.8,0.944 0.448,0.416 0.88,0.864 0.448,0.432 0.752,1.024 0.304,0.576 0.304,1.232 0,0.544 -0.256,1.104 0.304,0.448 0.304,1.184 0,1.232 -0.608,2.24 l -0.384,0 q 0.56,-1.12 0.56,-2.032 0,-0.512 -0.256,-0.96 -0.24,-0.448 -0.752,-0.816 -0.496,-0.368 -0.832,-0.56 -0.32,-0.192 -0.896,-0.48 l 0,5.52 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 6.464,-5.904 q 0,-1.648 -2.624,-3.072 0,0.464 0.192,0.88 0.192,0.416 0.512,0.752 0.32,0.32 0.656,0.592 0.336,0.272 0.688,0.608 0.352,0.32 0.544,0.608 0.032,-0.256 0.032,-0.368 z" /> </g> </g> </svg>',THIRTYSECONDNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7.0080001 14.496001" height="4.0910935mm" width="1.9778134mm"> <g transform="translate(-630.78433,-240.88335)">  <g  style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1">  <path  d="m 630.78433,254.27535 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-11.536 0.352,0 q 0.048,0.56 0.384,1.072 0.336,0.496 0.768,0.912 0.432,0.4 0.864,0.848 0.432,0.448 0.72,1.104 0.304,0.656 0.304,1.456 0,0.48 -0.16,1.056 0.224,0.416 0.224,0.912 0,0.512 -0.24,0.976 0.304,0.448 0.304,1.168 0,1.232 -0.608,2.24 l -0.384,0 q 0.56,-1.12 0.56,-2.032 0,-0.512 -0.256,-0.96 -0.24,-0.448 -0.752,-0.816 -0.496,-0.368 -0.832,-0.56 -0.32,-0.192 -0.896,-0.48 l 0,5.52 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 6.448,-7.872 q 0,-0.496 -0.208,-0.928 -0.192,-0.432 -0.64,-0.832 -0.432,-0.416 -0.784,-0.672 -0.352,-0.256 -0.976,-0.656 0.032,0.448 0.352,0.896 0.32,0.432 0.704,0.752 0.4,0.32 0.848,0.8 0.464,0.464 0.704,0.912 l 0,-0.272 z m 0,2.096 q 0,-0.4 -0.16,-0.768 -0.144,-0.368 -0.32,-0.608 -0.16,-0.256 -0.592,-0.608 -0.416,-0.352 -0.672,-0.528 -0.256,-0.176 -0.848,-0.576 0.064,0.48 0.4,0.976 0.336,0.48 0.72,0.816 0.4,0.336 0.832,0.784 0.448,0.432 0.64,0.784 l 0,-0.272 z" /> </g> </g> </svg>',SIXTYFOURTHNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7.0080001 14.528" height="4.1001244mm" width="1.9778134mm"> <g transform="translate(-345.3223,-325.39492)"> <g transform="translate(3.1093785,1.6864426)" style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 342.21292,337.13248 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-11.568 0.336,0 q 0.064,0.64 0.384,1.104 0.336,0.464 0.752,0.768 0.416,0.304 0.832,0.656 0.416,0.336 0.688,0.928 0.288,0.592 0.288,1.44 0,0.24 -0.144,0.768 0.256,0.608 0.256,1.376 0,0.32 -0.16,0.896 0.224,0.416 0.224,0.912 0,0.496 -0.24,0.96 0.304,0.448 0.304,1.024 0,0.384 -0.08,0.688 -0.08,0.304 -0.16,0.448 -0.08,0.144 -0.368,0.608 l -0.384,0 q 0.08,-0.16 0.192,-0.368 0.112,-0.224 0.16,-0.32 0.064,-0.096 0.112,-0.24 0.064,-0.144 0.08,-0.288 0.016,-0.144 0.016,-0.32 0,-0.272 -0.096,-0.512 -0.08,-0.256 -0.176,-0.432 -0.096,-0.192 -0.32,-0.4 -0.224,-0.208 -0.368,-0.32 -0.144,-0.128 -0.464,-0.304 -0.304,-0.192 -0.432,-0.256 -0.128,-0.064 -0.48,-0.224 -0.336,-0.176 -0.4,-0.208 l 0,4.064 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 6.352,-8.384 q 0,-0.352 -0.144,-0.688 -0.128,-0.352 -0.288,-0.576 -0.16,-0.224 -0.48,-0.496 -0.32,-0.272 -0.512,-0.4 -0.192,-0.144 -0.592,-0.384 -0.384,-0.24 -0.496,-0.32 0.032,0.432 0.352,0.832 0.32,0.384 0.704,0.656 0.4,0.272 0.816,0.72 0.432,0.432 0.624,0.912 0.016,-0.176 0.016,-0.256 z m 0.016,2.128 q 0,-0.208 -0.048,-0.4 -0.032,-0.192 -0.08,-0.336 -0.048,-0.16 -0.176,-0.336 -0.128,-0.176 -0.208,-0.288 -0.08,-0.112 -0.272,-0.272 -0.192,-0.176 -0.288,-0.256 -0.096,-0.08 -0.352,-0.256 -0.24,-0.176 -0.336,-0.224 -0.096,-0.064 -0.384,-0.24 -0.288,-0.192 -0.384,-0.256 0.032,0.464 0.368,0.88 0.336,0.416 0.736,0.704 0.4,0.272 0.816,0.688 0.416,0.416 0.576,0.864 0.032,-0.192 0.032,-0.272 z m -0.016,1.936 q 0,-0.848 -0.624,-1.504 -0.608,-0.672 -1.872,-1.392 0.064,0.464 0.384,0.896 0.336,0.416 0.72,0.688 0.4,0.272 0.8,0.704 0.4,0.416 0.576,0.88 0.016,-0.064 0.016,-0.272 z" /> </g> </g> </svg>',SHARP="♯",FLAT="♭",NATURAL="♮",DOUBLESHARP="𝄪",DOUBLEFLAT="𝄫",NSYMBOLS={1:"𝅝",2:"𝅗𝅥",4:"♩",8:"♪",16:"𝅘𝅥𝅯"},RSYMBOLS={1:"𝄻",2:"𝄼",4:"𝄽",8:"𝄾",16:"𝄿"},BTOFLAT={Eb:"E"+FLAT,Gb:"G"+FLAT,Ab:"A"+FLAT,Bb:"B"+FLAT,Db:"D"+FLAT,Cb:"C"+FLAT,Fb:"F"+FLAT,eb:"E"+FLAT,gb:"G"+FLAT,ab:"A"+FLAT,bb:"B"+FLAT,db:"D"+FLAT,cb:"C"+FLAT,fb:"F"+FLAT},STOSHARP={"E#":"E"+SHARP,"G#":"G"+SHARP,"A#":"A"+SHARP,"B#":"B"+SHARP,"D#":"D"+SHARP,"C#":"C"+SHARP,"F#":"F"+SHARP,"e#":"E"+SHARP,"g#":"G"+SHARP,"a#":"A"+SHARP,"b#":"B"+SHARP,"d#":"D"+SHARP,"c#":"C"+SHARP,"f#":"F"+SHARP},NOTESSHARP=["C","C"+SHARP,"D","D"+SHARP,"E","F","F"+SHARP,"G","G"+SHARP,"A","A"+SHARP,"B"],NOTESFLAT=["C","D"+FLAT,"D","E"+FLAT,"E","F","G"+FLAT,"G","A"+FLAT,"A","B"+FLAT,"B"],NOTESFLAT2=["c","d"+FLAT,"d","e"+FLAT,"e","f","g"+FLAT,"g","a"+FLAT,"a","b"+FLAT,"b"],EQUIVALENTFLATS={"C♯":"D"+FLAT,"D♯":"E"+FLAT,"F♯":"G"+FLAT,"G♯":"A"+FLAT,"A♯":"B"+FLAT},EQUIVALENTSHARPS={"D♭":"C"+SHARP,"E♭":"D"+SHARP,"G♭":"F"+SHARP,"A♭":"G"+SHARP,"B♭":"A"+SHARP},EQUIVALENTNATURALS={"E♯":"F","B♯":"C","C♭":"B","F♭":"E"},EQUIVALENTACCIDENTALS={F:"E♯",C:"B♯",B:"C♭",E:"F♭",G:"F𝄪",D:"C𝄪",A:"G𝄪"},CONVERT_DOWN={C:"B"+SHARP,"C♭":"B","D♭":"C"+SHARP,"E♭":"D"+SHARP,F:"E"+SHARP,"F♭":"E","G♭":"F"+SHARP,"A♭":"G"+SHARP,"B♭":"A"+SHARP},CONVERT_DOUBLE_DOWN={"C♯":"B"+DOUBLESHARP,D:"C"+DOUBLESHARP,E:"D"+DOUBLESHARP,"F♯":"E"+DOUBLESHARP,G:"F"+DOUBLESHARP,A:"G"+DOUBLESHARP,B:"A"+DOUBLESHARP},CONVERT_UP={"C♯":"D"+FLAT,"D♯":"E"+FLAT,"E♯":"F",E:"F"+FLAT,"F♯":"G"+FLAT,"G♯":"A"+FLAT,"A♯":"B"+FLAT,"B♯":"C",B:"C"+FLAT},CONVERT_DOUBLE_UP={C:"D"+DOUBLEFLAT,D:"E"+DOUBLEFLAT,"E♭":"F"+DOUBLEFLAT,F:"G"+DOUBLEFLAT,G:"A"+DOUBLEFLAT,A:"B"+DOUBLEFLAT,"B♭":"C"+DOUBLEFLAT},EXTRATRANSPOSITIONS={"E♯":["F",0],"B♯":["C",1],"C♭":["B",-1],"F♭":["E",0],"e♯":["F",0],"b♯":["C",1],"c♭":["B",-1],"f♭":["E",0]},SOLFEGENAMES=["do","re","mi","fa","sol","la","ti"],SOLFEGENAMES1=["do","do"+SHARP,"do"+DOUBLESHARP,"re"+DOUBLEFLAT,"re"+FLAT,"re","re"+SHARP,"re"+DOUBLESHARP,"mi"+DOUBLEFLAT,"mi"+FLAT,"mi","fa","fa"+SHARP,"fa"+DOUBLESHARP,"sol"+DOUBLEFLAT,"sol"+FLAT,"sol","sol"+SHARP,"sol"+DOUBLESHARP,"la","la"+DOUBLEFLAT,"la"+FLAT,"la"+SHARP,"la"+DOUBLESHARP,"ti"+DOUBLEFLAT,"ti"+FLAT,"ti"],NOTENAMES=["C","D","E","F","G","A","B"],ALLNOTENAMES=["C","C#","Cx","Dbb","Db","D","D#","Dx","Ebb","Eb","E","E#","Ex","Fbb","Fb","F","F#","Fx","Gbb","Gb","G","G#","Gx","Abb","Ab","A","A#","Ax","Bbb","Bb","B","B#","Bx","Cbb","Cb"],NOTENAMES1=["C","C"+SHARP,"C"+DOUBLESHARP,"D"+DOUBLEFLAT,"D"+FLAT,"D","D"+SHARP,"D"+DOUBLESHARP,"E"+DOUBLEFLAT,"E"+FLAT,"E","F","F"+SHARP,"F"+DOUBLESHARP,"G"+DOUBLEFLAT,"G"+FLAT,"G","G"+SHARP,"G"+DOUBLESHARP,"A","A"+DOUBLEFLAT,"A"+FLAT,"A"+SHARP,"A"+DOUBLESHARP,"B"+DOUBLEFLAT,"B"+FLAT,"B"],SOLFEGECONVERSIONTABLE={"C♭":"do"+FLAT,C:"do","C♯":"do"+SHARP,"D♭":"re"+FLAT,D:"re","D♯":"re"+SHARP,"E♭":"mi"+FLAT,E:"mi",F:"fa","F♯":"fa"+SHARP,"G♭":"sol"+FLAT,G:"sol","G♯":"sol"+SHARP,"A♭":"la"+FLAT,A:"la","A♯":"la"+SHARP,"B♭":"ti"+FLAT,B:"ti","B♯":"ti"+SHARP,R:_("rest")},WESTERN2EISOLFEGENAMES={do:"sa",re:"re",mi:"ga",fa:"ma",sol:"pa",la:"dha",ti:"ni"},PITCHES=["C","D"+FLAT,"D","E"+FLAT,"E","F","G"+FLAT,"G","A"+FLAT,"A","B"+FLAT,"B"],PITCHES1=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],PITCHES2=["C","C"+SHARP,"D","D"+SHARP,"E","F","F"+SHARP,"G","G"+SHARP,"A","A"+SHARP,"B"],PITCHES3=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],NOTESTABLE={1:"do",2:"do"+SHARP,3:"re",4:"re"+SHARP,5:"mi",6:"fa",7:"fa"+SHARP,8:"sol",9:"sol"+SHARP,10:"la",11:"la"+SHARP,0:"ti"},FIXEDSOLFEGE={do:"C",re:"D",mi:"E",fa:"F",sol:"G",la:"A",ti:"B"},FIXEDSOLFEGE1={"do𝄫":"B","do♭":"C"+FLAT,do:"C","do♯":"C"+SHARP,"do𝄪":"D","re𝄫":"C","re♭":"D"+FLAT,re:"D","re♯":"D"+SHARP,"re𝄪":"E","mi𝄫":"D","mi♭":"E"+FLAT,mi:"E","mi♯":"E"+SHARP,"mi𝄪":"G","fa𝄫":"E"+FLAT,"fa♭":"F"+FLAT,fa:"F","fa♯":"F"+SHARP,"fa𝄪":"G"+SHARP,"sol𝄫":"E","sol♭":"G"+FLAT,sol:"G","sol♯":"G"+SHARP,"sol𝄪":"A","la𝄫":"G","la♭":"A"+FLAT,la:"A","la♯":"A"+SHARP,"la𝄪":"B","ti𝄫":"A","ti♭":"B"+FLAT,ti:"B","ti♯":"B"+SHARP,"ti𝄪":"C",R:_("rest")},NOTESTEP={C:1,D:3,E:5,F:6,G:8,A:10,B:12},ALLNOTESTEP={Cb:0,C:1,"C#":2,Db:2,D:3,"D#":4,Eb:4,E:5,"E#":6,Fb:5,F:6,"F#":7,Gb:7,G:8,"G#":9,Ab:9,A:10,"A#":11,Bb:11,B:12,"B#":0},SEMITONETOINTERVALMAP={0:{0:_("Perfect unison"),1:_("Diminished second")},1:{1:_("Minor second"),0:_("Augmented unison")},2:{1:_("Major second"),2:_("Diminished third")},3:{2:_("Minor third"),1:_("Augmented second")},4:{2:_("Major third"),3:_("Diminished fourth")},5:{3:_("Perfect fourth"),2:_("Augmented third")},6:{4:_("Diminished fifth"),3:_("Augmented fourth")},7:{4:_("Perfect fifth"),5:_("Diminished sixth")},8:{5:_("Minor sixth"),4:_("Augmented fifth")},9:{5:_("Major sixth"),6:_("Diminished seventh")},10:{6:_("Minor seventh"),5:_("Augmented sixth")},11:{6:_("Major seventh"),0:_("Diminished octave")},12:{0:_("Perfect octave"),6:_("Augmented seventh")},13:{1:_("Minor ninth"),0:_("Augmented octave")},14:{1:_("Major ninth"),2:_("Diminished tenth")},15:{2:_("Minor tenth"),1:_("Augmented ninth")},16:{2:_("Major tenth"),3:_("Diminished eleventh")},17:{3:_("Perfect eleventh"),2:_("Augmented tenth")},18:{4:_("Diminished twelfth"),3:_("Augmented eleventh")},19:{4:_("Perfect twelfth"),5:_("Diminished thirteenth")},20:{5:_("Minor thirteenth"),4:_("Augmented fifth, plus an octave")},21:{5:_("Major thirteenth"),6:_("Diminished seventh, plus an octave")}},SHARPPREFERENCE=["g major","d major","a major","e major","b major","f# major","c# major","e minor","b minor","f# minor","c# minor","g# minor","d# minor"],FLATPREFERENCE=["f major","bb major","eb major","ab major","db major","gb major","cb major","d minor","g minor","c minor","f minor","bb minor","eb minor","d harmonic minor","g harmonic minor","c harmonic minor","f harmonic minor","bb harmonic minor","eb harmonic minor"],SOLFNOTES=["ti","la","sol","fa","mi","re","do"],SCALENOTES=["7","6","5","4","3","2","1"],EASTINDIANSOLFNOTES=["ni","dha","pa","ma","ga","re","sa"],DRUMS=["snare drum","kick drum","tom tom","floor tom","bass drum","cup drum","darbuka drum","japanese drum","hi hat","ride bell","cow bell","triangle bell","finger cymbals","chime","gong","clang","crash","clap","slap"],GRAPHICS=["forward","back","right","left","set heading","set color","set shade","set hue","set grey","set translucency","set pen size"],SOLFATTRS=[DOUBLESHARP,SHARP,NATURAL,FLAT,DOUBLEFLAT],DEGREES=_("1st 2nd 3rd 4th 5th 6th 7th 8th 9th 10th 11th 12th"),SEMITONES=12,POWER2=[1,2,4,8,16,32,64,128],TWELTHROOT2=1.0594630943592953,TWELVEHUNDRETHROOT2=1.0005777895065548,A0=27.5,C8=4186.01,C10=16744.04,octaveRatio=2,RHYTHMRULERHEIGHT=100,YSTAFFNOTEHEIGHT=12.5,YSTAFFOCTAVEHEIGHT=87.5,SLIDERHEIGHT=200,SLIDERWIDTH=50,MATRIXBUTTONCOLOR="#c374e9",MATRIXLABELCOLOR="#90c100",MATRIXNOTECELLCOLOR="#b1db00",MATRIXTUPLETCELLCOLOR="#57e751",MATRIXRHYTHMCELLCOLOR="#c8c8c8",MATRIXBUTTONCOLORHOVER="#c894e0",MATRIXNOTECELLCOLORHOVER="#c2e820",MATRIXSOLFEWIDTH=52,EIGHTHNOTEWIDTH=24,MATRIXBUTTONHEIGHT=40,MATRIXBUTTONHEIGHT2=66,MATRIXSOLFEHEIGHT=30,wholeNoteImg="data:image/svg+xml;base64,"+window.btoa(base64Encode(WHOLENOTE)),halfNoteImg="data:image/svg+xml;base64,"+window.btoa(base64Encode(HALFNOTE)),quarterNoteImg="data:image/svg+xml;base64,"+window.btoa(base64Encode(QUARTERNOTE)),eighthNoteImg="data:image/svg+xml;base64,"+window.btoa(base64Encode(EIGHTHNOTE)),sixteenthNoteImg="data:image/svg+xml;base64,"+window.btoa(base64Encode(SIXTEENTHNOTE)),thirtysecondNoteImg="data:image/svg+xml;base64,"+window.btoa(base64Encode(THIRTYSECONDNOTE)),sixtyfourthNoteImg="data:image/svg+xml;base64,"+window.btoa(base64Encode(SIXTYFOURTHNOTE)),NOTESYMBOLS={1:wholeNoteImg,2:halfNoteImg,4:quarterNoteImg,8:eighthNoteImg,16:sixteenthNoteImg,32:thirtysecondNoteImg,64:sixtyfourthNoteImg},SELECTORSTRINGS=[_("unison"),_("augmented"),_("diminished"),_("minor"),_("major"),_("perfect"),_("chromatic"),_("algerian"),_("spanish"),_("octatonic"),_("harmonic major"),_("natural minor"),_("harmonic minor"),_("melodic minor"),_("ionian"),_("dorian"),_("phrygian"),_("lydian"),_("mixolydian"),_("aeolian"),_("locrian"),_("jazz minor"),_("bebop"),_("arabic"),_("byzantine"),_("enigmatic"),_("ethiopian"),_("geez"),_("hindu"),_("hungarian"),_("romanian minor"),_("spanish gypsy"),_("maqam"),_("minor blues"),_("major blues"),_("whole tone"),_("minor pentatonic"),_("major pentatonic"),_("chinese"),_("egyptian"),_("hirajoshi"),_("Japan"),_("in"),_("minyo"),_("fibonacci"),_("custom"),_("highpass"),_("lowpass"),_("bandpass"),_("highshelf"),_("lowshelf"),_("notch"),_("allpass"),_("peaking"),_("sine"),_("square"),_("triangle"),_("sawtooth"),_("even"),_("odd"),_("scalar"),_("piano"),_("violin"),_("viola"),_("xylophone"),_("vibraphone"),_("cello"),_("bass"),_("double bass"),_("guitar"),_("sitar"),_("harmoiunm"),_("mandolin"),_("acoustic guitar"),_("flute"),_("clarinet"),_("saxophone"),_("tuba"),_("trumpet"),_("oboe"),_("trombone"),_("electronic synth"),_("simple 1"),_("simple 2"),_("simple 3"),_("simple 4"),_("white noise"),_("brown noise"),_("pink noise"),_("custom"),_("snare drum"),_("kick drum"),_("tom tom"),_("floor tom"),_("bass drum"),_("cup drum"),_("darbuka drum"),_("hi hat"),_("ride bell"),_("cow bell"),_("japanese drum"),_("triangle bell"),_("finger cymbals"),_("chime"),_("gong"),_("clang"),_("crash"),_("bottle"),_("clap"),_("slap"),_("splash"),_("bubbles"),_("raindrop"),_("cat"),_("cricket"),_("dog"),_("duck"),_("banjo"),_("koto"),_("dulcimer"),_("electric guitar"),_("bassoon"),_("celeste"),_("equal"),_("Pythagorean"),_("just intonation"),_("Meantone").toLowerCase(),_("custom"),_("double flat"),_("flat"),_("natural"),_("sharp"),_("double sharp"),_("major"),_("minor"),_("augmented"),_("diminished"),_("major 7th"),_("minor 7th"),_("dominant 7th"),_("minor-major 7th"),_("fully-diminished 7th"),_("half-diminished 7th"),_("custom")],ACCIDENTALLABELS=[_("double sharp")+" "+DOUBLESHARP,_("sharp")+" "+SHARP,_("natural")+" "+NATURAL,_("flat")+" "+FLAT,_("double flat")+" "+DOUBLEFLAT],ACCIDENTALNAMES=["double sharp "+DOUBLESHARP,"sharp "+SHARP,"natural "+NATURAL,"flat "+FLAT,"double flat "+DOUBLEFLAT],ACCIDENTALVALUES=[2,1,0,-1,-2],CHORDNAMES=["triad (root position)","triad (1st inversion)","triad (2nd inversion)","seventh (root position)","seventh (1st inversion)","seventh (2nd inversion)","seventh (3rd inversion)","ninth (root position)","thirteenth (root position)","major","minor","augmented","diminished","major 7th","minor 7th","dominant 7th","minor-major 7th","fully-diminished 7th","half-diminished 7th","custom"],DEFAULTCHORD=CHORDNAMES[9],CHORDVALUES=[[[0,0],[2,0],[4,0]],[[2,0],[4,0],[7,0]],[[-3,0],[0,0],[2,0]],[[0,0],[2,0],[4,0],[6,0]],[[2,0],[4,0],[6,0],[7,0]],[[-3,0],[-1,0],[0,0],[2,0]],[[-1,0],[0,0],[2,0],[4,0]],[[0,0],[2,0],[4,0],[6,0],[8,0]],[[0,0],[2,0],[4,0],[6,0],[12,0]],[[0,0],[0,4],[0,7]],[[0,0],[0,3],[0,7]],[[0,0],[0,4],[0,8]],[[0,0],[0,3],[0,6]],[[0,0],[0,4],[0,7],[0,11]],[[0,0],[0,3],[0,7],[0,10]],[[0,0],[0,4],[0,7],[0,10]],[[0,0],[0,3],[0,7],[0,11]],[[0,0],[0,3],[0,6],[0,9]],[[0,0],[0,3],[0,6],[0,10]],[[0,0],[0,4],[0,7]]],setCustomChord=function(e){CHORDVALUES[CHORDVALUES.length-1]=e},INVERTMODES=[[_("even"),"even"],[_("odd"),"odd"],[_("scalar"),"scalar"]],INTERVALS=[[_("perfect"),"perfect",[1,4,5,8]],[_("minor"),"minor",[2,3,6,7]],[_("diminished"),"diminished",[2,3,4,5,6,7,8]],[_("augmented"),"augmented",[1,2,3,4,5,6,7,8]],[_("major"),"major",[2,3,6,7]]],INTERVALVALUES={"perfect 1":[0,0,1],"diminished 2":[0,-1,1.024],"augmented 1":[1,1,25/24],"chromatic semitone":[1,1,25/24],"minor 2":[1,-1,16/15],"major 2":[2,1,9/8],"whole tone":[2,1,9/8],"diminished 3":[2,-1,1.152],"augmented 2":[3,1,75/64],"minor 3":[3,-1,1.2],"major 3":[4,1,5/4],"diminished 4":[4,-1,1.28],"augmented 3":[5,1,125/96],"perfect 4":[5,0,4/3],"augmented 4":[6,1,25/18],"diminished 5":[6,-1,1.44],"perfect 5":[7,0,1.5],"diminished 6":[7,-1,1.536],"augmented 5":[8,1,25/16],"minor 6":[8,-1,1.6],"major 6":[9,1,5/3],"diminished 7":[9,-1,1.8],"augmented 6":[10,1,125/72],"minor 7":[10,-1,1.8],"major 7":[11,1,15/8],"diminished 8":[11,-1,1.92],"diminished octave":[11,-1,1.92],"augmented 7":[12,1,125/64],"perfect 8":[12,0,2],octave:[12,0,2],"augmented 8":[13,1,25/12]},MODE_PIE_MENUS={5:["minor pentatonic","major pentatonic"," ","chinese","egyptian"," ","hirajoshi","in","minyo"," ","fibonacci"," "],6:["minor blues"," "," "," ","major blues"," "," "," ","whole tone"," "," "," "],7:["ionian"," ","dorian"," ","phrygian","lydian"," ","mixolydian"," ","aeolian"," ","locrian"],"7a":["major"," ","harmonic major"," ","natural minor"," ","harmonic minor"," ","melodic minor"," "," "," "],"7b":["jazz minor"," ","arabic","byzantine","enigmatic","ethiopian","geez","hindu","hungarian","maqam","romanian minor","spanish gypsy"],8:["octatonic"," ","spanish"," ","bebop"," ","diminished"," "," ","algerian"," "," "],12:["chromatic"," "," "," "," "," ","custom"," "," "," "," "," "]},MUSICALMODES={chromatic:[1,1,1,1,1,1,1,1,1,1,1,1],algerian:[2,1,2,1,1,1,3,1],diminished:[2,1,2,1,2,1,2,1],spanish:[1,2,1,1,1,2,2,2],octatonic:[1,2,1,2,1,2,1,2],bebop:[1,1,1,2,2,1,2,2],major:[2,2,1,2,2,2,1],"harmonic major":[2,2,1,2,1,3,1],"natural minor":[2,1,2,2,1,2,2],"harmonic minor":[2,1,2,2,1,3,1],"melodic minor":[2,1,2,2,2,2,1],ionian:[2,2,1,2,2,2,1],dorian:[2,1,2,2,2,1,2],phrygian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],mixolydian:[2,2,1,2,2,1,2],minor:[2,1,2,2,1,2,2],aeolian:[2,1,2,2,1,2,2],locrian:[1,2,2,1,2,2,2],"jazz minor":[2,1,2,2,2,2,1],arabic:[2,2,1,1,2,2,2],byzantine:[1,3,1,2,1,3,1],enigmatic:[1,3,2,2,2,1,1],ethiopian:[2,1,2,2,1,2,2],geez:[2,1,2,2,1,2,2],hindu:[2,2,1,2,1,2,2],hungarian:[2,1,3,1,1,3,1],maqam:[1,3,1,2,1,3,1],"romanian minor":[2,1,3,1,2,1,2],"spanish gypsy":[1,3,1,2,1,2,2],"minor blues":[3,2,1,1,3,2],"major blues":[2,1,1,3,2,2],"whole tone":[2,2,2,2,2,2],"major pentatonic":[2,2,3,2,3],"minor pentatonic":[3,2,2,3,2],chinese:[4,2,1,4,1],egyptian:[2,3,2,3,2],hirajoshi:[1,4,1,4,2],in:[1,4,2,1,4],minyo:[3,2,2,3,2],fibonacci:[1,1,2,3,5],"alt pentatonic":[2,3,2,2,3],custom:[1,1,1,1,1,1,1,1,1,1,1,1]},MAQAMTABLE={"hijaz kar":"C maqam","hijaz kar maqam":"C maqam",shahnaz:"D maqam","maqam mustar":"Eb maqam","maqam jiharkah":"F maqam","shadd araban":"G maqam",suzidil:"A maqam",ajam:"Bb maqam","ajam maqam":"Bb maqam"},FILTERTYPES=[[_("highpass"),"highpass"],[_("lowpass"),"lowpass"],[_("bandpass"),"bandpass"],[_("highshelf"),"highshelf"],[_("lowshelf"),"lowshelf"],[_("notch"),"notch"],[_("allpass"),"allpass"],[_("peaking"),"peaking"]],OSCTYPES=[[_("sine"),"sine"],[_("square"),"square"],[_("triangle"),"triangle"],[_("sawtooth"),"sawtooth"]],INITIALTEMPERAMENTS=[[_("Equal (12EDO)"),"equal","equal"],[_("Equal (5EDO)"),"equal5","equal5"],[_("Equal (7EDO)"),"equal7","equal7"],[_("Equal (19EDO)"),"equal19","equal19"],[_("Equal (31EDO)"),"equal31","equal31"],[_("5-limit Just Intonation"),"just intonation","just intonation"],[_("Pythagorean (3-limit JI)"),"Pythagorean","Pythagorean"],[_("Meantone")+" (1/3)","1/3 comma meantone","meantone (1/3)"],[_("Meantone")+" (1/4)","1/4 comma meantone","meantone (1/4)"]],TEMPERAMENTS=[[_("Equal (12EDO)"),"equal","equal"],[_("Equal (5EDO)"),"equal5","equal5"],[_("Equal (7EDO)"),"equal7","equal7"],[_("Equal (19EDO)"),"equal19","equal19"],[_("Equal (31EDO)"),"equal31","equal31"],[_("5-limit Just Intonation"),"just intonation","just intonation"],[_("Pythagorean (3-limit JI)"),"Pythagorean","Pythagorean"],[_("Meantone")+" (1/3)","1/3 comma meantone","meantone (1/3)"],[_("Meantone")+" (1/4)","1/4 comma meantone","meantone (1/4)"],[_("custom"),"custom","custom"]],PreDefinedTemperaments={equal:!0,equal5:!0,equal7:!0,equal19:!0,equal31:!0,"just intonation":!0,Pythagorean:!0,"1/3 comma meantone":!0,"1/4 comma meantone":!0},TEMPERAMENT={equal:{"perfect 1":Math.pow(2,0),"minor 2":Math.pow(2,1/12),"augmented 1":Math.pow(2,1/12),"major 2":Math.pow(2,2/12),"augmented 2":Math.pow(2,.25),"minor 3":Math.pow(2,.25),"major 3":Math.pow(2,4/12),"augmented 3":Math.pow(2,5/12),"diminished 4":Math.pow(2,4/12),"perfect 4":Math.pow(2,5/12),"augmented 4":Math.pow(2,.5),"diminished 5":Math.pow(2,.5),"perfect 5":Math.pow(2,7/12),"augmented 5":Math.pow(2,8/12),"minor 6":Math.pow(2,8/12),"major 6":Math.pow(2,.75),"augmented 6":Math.pow(2,10/12),"minor 7":Math.pow(2,10/12),"major 7":Math.pow(2,11/12),"augmented 7":Math.pow(2,1),"diminished 8":Math.pow(2,11/12),"perfect 8":Math.pow(2,1),pitchNumber:12,interval:["perfect 1","minor 2","major 2","minor 3","major 3","perfect 4","diminished 5","perfect 5","minor 6","major 6","minor 7","major 7","perfect 8"]},equal5:{"perfect 1":Math.pow(2,0),"minor 2":Math.pow(2,.2),"augmented 1":Math.pow(2,.2),"major 2":Math.pow(2,.4),"augmented 2":Math.pow(2,.4),"minor 3":Math.pow(2,.4),"major 3":Math.pow(2,.6),"augmented 3":Math.pow(2,.6),"diminished 4":Math.pow(2,.6),"perfect 4":Math.pow(2,.6),"augmented 4":Math.pow(2,.8),"diminished 5":Math.pow(2,.8),"perfect 5":Math.pow(2,1),"augmented 5":Math.pow(2,1),"minor 6":Math.pow(2,1),"major 6":Math.pow(2,1),"augmented 6":Math.pow(2,1),"minor 7":Math.pow(2,1),"major 7":Math.pow(2,1),"augmented 7":Math.pow(2,1),"diminished 8":Math.pow(2,1),"perfect 8":Math.pow(2,1),pitchNumber:5,interval:["perfect 1","minor 2","major 2","major 3","augmented 4","perfect 5"]},equal7:{"perfect 1":Math.pow(2,0),"minor 2":Math.pow(2,1/7),"augmented 1":Math.pow(2,1/7),"major 2":Math.pow(2,2/7),"augmented 2":Math.pow(2,2/7),"minor 3":Math.pow(2,3/7),"major 3":Math.pow(2,3/7),"augmented 3":Math.pow(2,4/7),"diminished 4":Math.pow(2,4/7),"perfect 4":Math.pow(2,4/7),"augmented 4":Math.pow(2,5/7),"diminished 5":Math.pow(2,4/7),"perfect 5":Math.pow(2,5/7),"augmented 5":Math.pow(2,6/7),"minor 6":Math.pow(2,5/7),"major 6":Math.pow(2,6/7),"augmented 6":Math.pow(2,1),"minor 7":Math.pow(2,6/7),"major 7":Math.pow(2,6/7),"augmented 7":Math.pow(2,1),"diminished 8":Math.pow(2,1),"perfect 8":Math.pow(2,1),pitchNumber:7,interval:["perfect 1","minor 2","major 2","major 3","perfect 4","perfect 5","major 6","perfect 8"]},equal19:{"perfect 1":Math.pow(2,0),"minor 2":Math.pow(2,2/19),"augmented 1":Math.pow(2,1/19),"major 2":Math.pow(2,3/19),"augmented 2":Math.pow(2,4/19),"minor 3":Math.pow(2,5/19),"major 3":Math.pow(2,6/19),"augmented 3":Math.pow(2,7/19),"diminished 4":Math.pow(2,7/19),"perfect 4":Math.pow(2,8/19),"augmented 4":Math.pow(2,9/19),"diminished 5":Math.pow(2,9/19),"perfect 5":Math.pow(2,10/19),"augmented 5":Math.pow(2,11/19),"minor 6":Math.pow(2,12/19),"major 6":Math.pow(2,13/19),"augmented 6":Math.pow(2,14/19),"minor 7":Math.pow(2,15/19),"major 7":Math.pow(2,16/19),"augmented 7":Math.pow(2,17/19),"diminished 8":Math.pow(2,18/19),"perfect 8":Math.pow(2,1),pitchNumber:19,interval:["perfect 1","augmented 1","minor 2","major 2","augmented 2","minor 3","major 3","augmented 3","perfect 4","augmented 4","perfect 5","augmented 5","minor 6","major 6","augmented 6","minor 7","major 7","augmented 7","diminished 8","perfect 8"]},equal31:{"perfect 1":Math.pow(2,0),"diminished 2":Math.pow(2,1/31),"augmented 1":Math.pow(2,2/31),"minor 2":Math.pow(2,3/31),"mid 2":Math.pow(2,4/31),"major 2":Math.pow(2,5/31),"up-major 2":Math.pow(2,6/31),"down-minor 3":Math.pow(2,7/31),"minor 3":Math.pow(2,8/31),"mid 3":Math.pow(2,9/31),"major 3":Math.pow(2,10/31),"up-major 3":Math.pow(2,11/31),"down 4":Math.pow(2,12/31),"perfect 4":Math.pow(2,13/31),"up 4":Math.pow(2,14/31),"down-diminished 5":Math.pow(2,15/31),"up-augmented 4":Math.pow(2,16/31),"down 5":Math.pow(2,17/31),"perfect 5":Math.pow(2,18/31),"up 5":Math.pow(2,19/31),"down-minor 6":Math.pow(2,20/31),"minor 6":Math.pow(2,21/31),"mid 6":Math.pow(2,22/31),"major 6":Math.pow(2,23/31),"up-major 6":Math.pow(2,24/31),"down-minor 7":Math.pow(2,25/31),"minor 7":Math.pow(2,26/31),"mid 7":Math.pow(2,27/31),"major 7":Math.pow(2,28/31),"up-major 7":Math.pow(2,29/31),"down 8":Math.pow(2,30/31),"perfect 8":Math.pow(2,1),octave:Math.pow(2,1),pitchNumber:31,interval:["perfect 1","diminished 2","augmented 1","minor 2","mid 2","major 2","up-major 2","down-minor 3","minor 3","mid 3","major 3","up-major 3","down 4","perfect 4","up 4","down-diminished 5","up-augmented 4","down 5","perfect 5","up 5","down-minor 6","minor 6","mid 6","major 6","up-major 6","down-minor 7","minor 7","mid 7","major 7","up-major 7","down 8","perfect 8"]},"just intonation":{"perfect 1":1,"minor 2":16/15,"augmented 1":16/15,"major 2":9/8,"augmented 2":1.2,"minor 3":1.2,"major 3":5/4,"augmented 3":4/3,"diminished 4":5/4,"perfect 4":4/3,"augmented 4":1.4,"diminished 5":1.4,"perfect 5":1.5,"augmented 5":1.6,"minor 6":1.6,"major 6":5/3,"augmented 6":16/9,"minor 7":16/9,"major 7":15/8,"augmented 7":2,"diminished 8":15/8,"perfect 8":2,pitchNumber:12,interval:["perfect 1","minor 2","major 2","minor 3","major 3","perfect 4","diminished 5","perfect 5","minor 6","major 6","minor 7","major 7","perfect 8"]},Pythagorean:{"perfect 1":1,"minor 2":256/243,"augmented 1":256/243,"major 2":9/8,"augmented 2":32/27,"minor 3":32/27,"major 3":81/64,"augmented 3":4/3,"diminished 4":81/64,"perfect 4":4/3,"augmented 4":729/512,"diminished 5":729/512,"perfect 5":1.5,"augmented 5":128/81,"minor 6":128/81,"major 6":27/16,"augmented 6":16/9,"minor 7":16/9,"major 7":243/128,"augmented 7":2,"diminished 8":243/128,"perfect 8":2,pitchNumber:12,interval:["perfect 1","minor 2","major 2","minor 3","major 3","perfect 4","diminished 5","perfect 5","minor 6","major 6","minor 7","major 7","perfect 8"]},"1/3 comma meantone":{"perfect 1":1,"minor 2":1.075693,"augmented 1":1.037156,"major 2":1.115656,"augmented 2":1.157109,"minor 3":1.200103,"major 3":1.244694,"augmented 3":1.290943,"diminished 4":1.290943,"perfect 4":1.338902,"augmented 4":1.38865,"diminished 5":1.440247,"perfect 5":1.493762,"augmented 5":1.549255,"minor 6":1.60682,"major 6":1.666524,"augmented 6":1.728445,"minor 7":1.792668,"major 7":1.859266,"augmented 7":1.92835,"diminished 8":1.92835,"perfect 8":2,pitchNumber:19,interval:["perfect 1","augmented 1","minor 2","major 2","augmented 2","minor 3","major 3","diminished 4","perfect 4","augmented 4","diminished 5","perfect 5","augmented 5","minor 6","major 6","augmented 6","minor 7","major 7","diminished 8","perfect 8"]},"1/4 comma meantone":{"perfect 1":1,"minor 2":16/15,"augmented 1":25/24,"major 2":9/8,"augmented 2":75/64,"minor 3":1.2,"major 3":5/4,"diminished 4":1.28,"augmented 3":125/96,"perfect 4":4/3,"augmented 4":25/18,"diminished 5":1.44,"perfect 5":1.5,"augmented 5":25/16,"minor 6":1.6,"major 6":5/3,"augmented 6":125/72,"minor 7":1.8,"major 7":15/8,"diminished 8":1.92,"augmented 7":125/64,"perfect 8":2,pitchNumber:21,interval:["perfect 1","augmented 1","minor 2","major 2","augmented 2","minor 3","major 3","diminished 4","augmented 3","perfect 4","augmented 4","diminished 5","perfect 5","augmented 5","minor 6","major 6","augmented 6","minor 7","major 7","diminished 8","augmented 7","perfect 8"]},custom:{0:Math.pow(2,0),1:Math.pow(2,1/12),2:Math.pow(2,2/12),3:Math.pow(2,.25),4:Math.pow(2,4/12),5:Math.pow(2,5/12),6:Math.pow(2,.5),7:Math.pow(2,7/12),8:Math.pow(2,8/12),9:Math.pow(2,.75),10:Math.pow(2,10/12),11:Math.pow(2,11/12),pitchNumber:12,interval:["perfect 1","minor 2","major 2","minor 3","major 3","perfect 4","diminished 5","perfect 5","minor 6","major 6","minor 7","major 7","perfect 8"]}},MIDI_INSTRUMENTS={default:0,piano:0,violin:40,viola:41,cello:42,"double bass":43,bass:32,sitar:104,guitar:24,"acoustic guitar":25,"electric guitar":27,flute:73,clarinet:71,saxophone:65,tuba:58,trumpet:56,oboe:68,trombone:57,banjo:105,koto:107,dulcimer:15,bassoon:70,celeste:8,xylophone:13,"electronic synth":81,sine:81,square:80,sawtooth:81,triangle:81,vibraphone:11},DRUM_MIDI_MAP={"snare drum":38,"kick drum":36,"tom tom":41,"floor tom tom":43,"cup drum":47,"darbuka drum":50,"japanese drum":56,"hi hat":42,"ride bell":53,"cow bell":56,"triangle bell":81,"finger cymbals":69,chime:82,gong:52,clang:55,crash:49,clap:39,slap:40,raindrop:88},REVERSE_DRUM_MIDI_MAP={38:["snare drum"],36:["kick drum"],41:["tom tom"],43:["floor tom tom"],47:["cup drum"],50:["darbuka drum"],56:["japanese drum","cow bell"],42:["hi hat"],53:["ride bell"],81:["triangle bell"],69:["finger cymbals"],82:["chime"],52:["gong"],55:["clang"],49:["crash"],39:["clap"],40:["slap"],88:["raindrop"]},getMidiInstrument=function(){return MIDI_INSTRUMENTS},getMidiDrum=function(){return DRUM_MIDI_MAP},getReverseDrumMidi=function(){return REVERSE_DRUM_MIDI_MAP},setOctaveRatio=function(e){octaveRatio=e},getOctaveRatio=function(){return octaveRatio},getTemperamentsList=function(){return TEMPERAMENTS},getTemperament=function(e){return TEMPERAMENT[e]},getTemperamentKeys=function(){var e,t=[];for(e in TEMPERAMENT)t.push(e);return t},addTemperamentToList=function(e){for(var t=0;t<TEMPERAMENTS.length;t++)if(PreDefinedTemperaments[t]===e)return;TEMPERAMENTS.push(e)},deleteTemperamentFromList=function(e){delete TEMPERAMENT[e]},addTemperamentToDictionary=function(e,t){TEMPERAMENT[e]=t},updateTemperaments=function(){for(var e in TEMPERAMENTS=[].concat(INITIALTEMPERAMENTS),TEMPERAMENT)e in PreDefinedTemperaments||TEMPERAMENTS.push([_(e),e,e])},DEFAULTINVERT="even",DEFAULTINTERVAL="perfect 5",DEFAULTVOICE="electronic synth",DEFAULTNOISE="noise1",DEFAULTDRUM="kick drum",DEFAULTEFFECT="duck",DEFAULTMODE="major",DEFAULTTEMPERAMENT="equal",DEFAULTFILTERTYPE="highpass",DEFAULTOSCILLATORTYPE="sine",DEFAULTACCIDENTAL="natural "+NATURAL,customMode=MUSICALMODES.custom,getInvertMode=function(e){for(var t in INVERTMODES)if(INVERTMODES[t][0]===e||INVERTMODES[t][1].toLowerCase()===e.toLowerCase())return""!=INVERTMODES[t][0]?INVERTMODES[t][0]:INVERTMODES[t][1];return e},getIntervalNumber=function(e){return INTERVALVALUES[e][0]},getIntervalDirection=function(e){return INTERVALVALUES[e][1]},getIntervalRatio=function(e){return INTERVALVALUES[e][2]},getModeNumbers=function(e){for(var t in MUSICALMODES)if(t===e.toLowerCase()){for(var r=MUSICALMODES[t],n=0,a="",o=0;o<r.length;o++)a+=n.toString(),o<r.length-1&&(a+=" "),n+=r[o];return a}return""},getDrumIndex=function(e){""!==e&&"http"!==e.slice(0,4)||(e=DEFAULTDRUM);for(var t=0;t<DRUMNAMES.length;t++){if(DRUMNAMES[t][0].toLowerCase()===e.toLowerCase())return t;if(DRUMNAMES[t][1].toLowerCase()===e.toLowerCase())return t}return-1},getDrumName=function(e){if(""===e)e=DEFAULTDRUM;else if("http"===e.slice(0,4))return null;for(var t=0;t<DRUMNAMES.length;t++){if(DRUMNAMES[t][0].toLowerCase()===e.toLowerCase())return DRUMNAMES[t][0];if(DRUMNAMES[t][1].toLowerCase()===e.toLowerCase())return DRUMNAMES[t][1]}return null},getDrumSymbol=function(e){if(""!==e)for(var t=0;t<DRUMNAMES.length;t++){if(DRUMNAMES[t][0].toLowerCase()===e.toLowerCase())return DRUMNAMES[t][3];if(DRUMNAMES[t][1].toLowerCase()===e.toLowerCase())return"hh"}return"hh"},getFilterTypes=function(e){""===e&&(e=DEFAULTFILTERTYPE);for(var t=0;t<FILTERTYPES.length;t++){if(FILTERTYPES[t][0].toLowerCase()===e.toLowerCase())return FILTERTYPES[t][0];if(FILTERTYPES[t][1].toLowerCase()===e.toLowerCase())return FILTERTYPES[t][1]}return DEFAULTFILTERTYPE},getOscillatorTypes=function(e){""===e&&(e=null);for(var t=0;t<OSCTYPES.length;t++){if(OSCTYPES[t][0].toLowerCase()===e.toLowerCase())return OSCTYPES[t][0];if(OSCTYPES[t][1].toLowerCase()===e.toLowerCase())return OSCTYPES[t][1]}return null},getDrumIcon=function(e){if(""===e)e=DEFAULTDRUM;else if("http"===e.slice(0,4))return"images/drum.svg";for(var t=0;t<DRUMNAMES.length;t++)if(DRUMNAMES[t][0]===e||DRUMNAMES[t][1].toLowerCase()===e.toLowerCase())return DRUMNAMES[t][2];return"images/drum.svg"},getDrumSynthName=function(e){if(null==e)return null;if(""===e)e=DEFAULTDRUM;else if("http"===e.slice(0,4))return e;for(var t=0;t<DRUMNAMES.length;t++)if(DRUMNAMES[t][0]===e||DRUMNAMES[t][1].toLowerCase()===e.toLowerCase())return DRUMNAMES[t][1];return DEFAULTDRUM},getNoiseName=function(e){""===e&&(e=DEFAULTNOISE);for(var t=0;t<NOISENAMES.length;t++)if(NOISENAMES[t][1]===e)return""!=NOISENAMES[t][0]?NOISENAMES[t][0]:NOISENAMES[t][1];return DEFAULTNOISE},getNoiseIcon=function(e){if(""===e)e=DEFAULTNOISE;else if("http"===e.slice(0,4))return"images/noises.svg";for(var t=0;t<NOISENAMES.length;t++)if(NOISENAMES[t][0]===e||NOISENAMES[t][1]===e)return NOISENAMES[t][2];return"images/synth.svg"},getNoiseSynthName=function(e){if(null==e)return null;""===e&&(e=DEFAULTNOISE);for(var t=0;t<NOISENAMES.length;t++)if(NOISENAMES[t][0]===e||NOISENAMES[t][1]===e)return NOISENAMES[t][1];return DEFAULTNOISE},getVoiceName=function(e){if(""===e)e=DEFAULTVOICE;else if("http"===e.slice(0,4))return null;for(var t=0;t<VOICENAMES.length;t++)if(VOICENAMES[t][0]===e){if(""!=VOICENAMES[t][0])return VOICENAMES[t][0];if(VOICENAMES[t][1]===e)return VOICENAMES[t][1]}return DEFAULTVOICE},getVoiceIcon=function(e){if(""===e)e=DEFAULTVOICE;else if("http"===e.slice(0,4))return"images/voices.svg";for(var t=0;t<VOICENAMES.length;t++)if(VOICENAMES[t][0]===e||VOICENAMES[t][1]===e)return VOICENAMES[t][2];for(var r=0;r<CUSTOMSAMPLES.length;r++)if(CUSTOMSAMPLES[r][0]===e||CUSTOMSAMPLES[r][1]===e)return CUSTOMSAMPLES[r][0];return"images/voices.svg"},getVoiceSynthName=function(e){if(null==e)return null;if(""===e)e=DEFAULTVOICE;else if("http"===e.slice(0,4))return e;for(var t=0;t<VOICENAMES.length;t++)if(VOICENAMES[t][0]===e||VOICENAMES[t][1]===e)return VOICENAMES[t][1];return DEFAULTVOICE},isCustomTemperament=function(e){return!(e in PreDefinedTemperaments)},getTemperamentName=function(e){""===e&&(e=DEFAULTTEMPERAMENT);for(var t=0;t<TEMPERAMENTS.length;t++){if(TEMPERAMENTS[t][0].toLowerCase()===e.toLowerCase())return TEMPERAMENTS[t][1];if(TEMPERAMENTS[t][1].toLowerCase()===e.toLowerCase())return TEMPERAMENTS[t][1]}return DEFAULTTEMPERAMENT},noteToObj=function(e){var t=parseInt(e.slice(e.length-1));return isNaN(t)?t=4:e=e.slice(0,e.length-1),[e,t]},frequencyToPitch=function(e){if(e<A0)return["A",0,0];if(C10<e)return["C",10,0];for(var t=0,r=0;r<12e3;r++){var n=A0*Math.pow(TWELVEHUNDRETHROOT2,r);if(e<1.0003*n&&.9997*n<e)return t=r%100,n=Math.floor(r/100),50<t&&(t-=100,n+=1),[PITCHES[(n+PITCHES.indexOf("A"))%12],Math.floor((n+PITCHES.indexOf("A"))/12),t]}return["?",-1,0]},getArticulation=function(e){return e.replace("do","").replace("re","").replace("mi","").replace("fa","").replace("sol","").replace("la","").replace("ti","").replace("A","").replace("B","").replace("C","").replace("D","").replace("E","").replace("F","").replace("G","").replace("^^","").replace("vv","").replace("^","").replace("v","")},keySignatureToMode=function(e){if(""===e||null==e)return["C","major"];var t,r=(e=e.toLowerCase()in MAQAMTABLE?MAQAMTABLE[e.toLowerCase()]:e).split(" "),n=!1;if(1===r.length&&"m"===r[0][r[0].length-1]&&(n=!0,r[0]=r[0].slice(0,r[0].length-1)),(t=r[0]in BTOFLAT?BTOFLAT[r[0]]:r[0]in STOSHARP?STOSHARP[r[0]]:r[0])==="C"+FLAT?(r=e.split(" "),t="C"+FLAT):t=="B"+SHARP?(r=e.split(" "),t="B"+SHARP):t=="F"+FLAT?(r=e.split(" "),t="F"+FLAT):SOLFEGENAMES1.includes(t)?t=getNote(t,4,0,"C Major",!1)[0]:NOTESSHARP.includes(t)||NOTESFLAT.includes(t)||(console.debug("Invalid key or missing name; reverting to C."),r=(e="C "+e).split(" "),t="C"),n)return[t,"natural minor"];for(var a="",o=1;o<r.length;o++)""!==r[o]&&(""===a?a=r[o]:a+=" "+r[o]);return(a=""===a?"major":a.toLowerCase())in MUSICALMODES?[t,a]:(console.debug("Invalid mode name: "+a+" reverting to major."),[t,"major"])},SOLFMAPPER=["do","do","re","re","mi","fa","fa","sol","sol","la","la","ti"],getScaleAndHalfSteps=function(e){var e=keySignatureToMode(e),t=e[0],r="CUSTOM"===e[1]?customMode:MUSICALMODES[e[1]],n=[];if(7===r.length)for(var a=0;a<r.length;a++){n.push(SOLFEGENAMES[a]);for(var o=1;o<r[a];o++)n.push("")}else if(7<r.length)for(var i=0;i<r.length;i++){n.includes(SOLFMAPPER[i])?n.push(SOLFMAPPER[i]+SHARP):n.push(SOLFMAPPER[i]);for(var s=1;s<r[i];s++)n.push("")}else for(var m,c,u=0;u<r.length;u++){for(m=0,c=SOLFMAPPER[n.length];n.includes(c);)c=SOLFMAPPER[n.length+(m+=1)];n.push(c);for(var l=1;l<r[u];l++)n.push("")}var E=NOTESSHARP;return[E=NOTESFLAT.includes(t)?NOTESFLAT:E,n,t=t in EXTRATRANSPOSITIONS?EXTRATRANSPOSITIONS[t][0]:t,e[1]]},modeMapper=function(e,t){switch(e=e.toLowerCase(),t=t.toLowerCase()){case"ionian":t="major";break;case"dorian":switch(t="major",e){case"c":e="a"+SHARP;break;case"d":e="c";break;case"e":e="d";break;case"f":e="c",t="minor";break;case"g":e="f";break;case"a":e="g";break;case"b":e="a";break;case"c"+SHARP:case"d"+SHARP:e="b";break;case"f"+SHARP:e="f";break;case"g"+SHARP:e="b";break;case"a"+SHARP:e="g"+SHARP;break;case"d"+FLAT:case"e"+FLAT:e="e"+FLAT,t="minor";break;case"g"+FLAT:e="d",t="minor";break;case"a"+FLAT:e="e"+FLAT,t="minor";break;case"b"+FLAT:e="f",t="minor"}break;case"phrygian":switch(t="major",e){case"c":e="g"+SHARP;break;case"d":e="a"+SHARP;break;case"e":e="c";break;case"f":e="b";break;case"g":e="c",t="minor";break;case"a":e="f";break;case"b":e="g";break;case"c"+SHARP:e="a";break;case"d"+SHARP:e="b";break;case"f"+SHARP:e="d";break;case"g"+SHARP:e="e";break;case"a"+SHARP:e="b";break;case"d"+FLAT:e="g"+FLAT,t="minor";break;case"e"+FLAT:e="e"+FLAT,t="minor";break;case"g"+FLAT:e="d";break;case"a"+FLAT:e="d"+FLAT,t="minor";break;case"b"+FLAT:e="e"+FLAT,t="minor"}break;case"lydian":switch(t="major",e){case"c":e="g";break;case"d":e="a";break;case"e":e="b";break;case"f":e="c";break;case"g":e="d";break;case"a":e="e";break;case"b":e="b";break;case"c"+SHARP:e="g"+SHARP;break;case"d"+SHARP:e="a"+SHARP;break;case"f"+SHARP:e="b";break;case"g"+SHARP:e="c",t="minor";break;case"a"+SHARP:e="f";break;case"d"+FLAT:e="f",t="minor";break;case"e"+FLAT:e="g",t="minor";break;case"g"+FLAT:e="d"+FLAT,t="minor";break;case"a"+FLAT:e="c",t="minor";break;case"b"+FLAT:e="d",t="minor"}break;case"mixolydian":switch(t="major",e){case"c":e="f";break;case"d":e="g";break;case"e":e="a";break;case"f":e="a"+SHARP;break;case"g":e="c";break;case"a":e="d";break;case"b":e="e";break;case"c"+SHARP:e="b";break;case"d"+SHARP:e="g"+SHARP;break;case"f"+SHARP:case"g"+SHARP:e="b";break;case"a"+SHARP:e="c",t="minor";break;case"d"+FLAT:e="e"+FLAT,t="minor";break;case"e"+FLAT:e="f",t="minor";break;case"g"+FLAT:case"a"+FLAT:e="e"+FLAT,t="minor";break;case"b"+FLAT:e="c",t="minor"}break;case"locrian":switch(t="major",e){case"c":e="b";break;case"d":e="c",t="minor";break;case"e":e="f";break;case"f":e="b";break;case"g":e="g"+SHARP;break;case"a":e="a"+SHARP;break;case"b":e="c";break;case"c"+SHARP:e="d";break;case"d"+SHARP:e="e";break;case"f"+SHARP:e="g";break;case"g"+SHARP:e="a ";break;case"a"+SHARP:e="b";break;case"d"+FLAT:e="d";break;case"e"+FLAT:e="d"+FLAT,t="minor";break;case"g"+FLAT:e="f",t="minor";break;case"a"+FLAT:e="g"+FLAT,t="minor";break;case"b"+FLAT:e="d"+FLAT,t="minor"}break;case"aeolian":case"natural minor":t="minor"}return[e,t]},getSharpFlatPreference=function(e){e=keySignatureToMode(e),e=modeMapper(e[0],e[1]),e=e[0]+" "+e[1];return SHARPPREFERENCE.includes(e)?"sharp":FLATPREFERENCE.includes(e)?"flat":"natural"},getCustomNote=function(e){var t="",r=((e=e instanceof Array?e[0]:e).includes("(")&&(t=e.substring(e.indexOf("("),e.length)),e=e.replace(t,""),getArticulation(e));switch(e=e.replace(r,""),r){case"bb":case DOUBLEFLAT:e=e+"𝄫"+t;break;case"b":case FLAT:e=e+"♭"+t;break;case"##":case"*":case"x":case DOUBLESHARP:e=e+"𝄪"+t;break;case"#":case SHARP:e=e+"♯"+t;break;default:e=e+r+t}return e},pitchToNumber=function(e,t,r){var n,a,o,i;return"R"===e.toUpperCase()?0:(n=0,1<(a=e.length)&&(2<a&&(o=e.slice(a-2),i=e.substring(1,a),"bb"===o||i===DOUBLEFLAT?(e=e.substring(0,1),n-=2):"*"===o||o===DOUBLESHARP?(e=e.substring(0,1),n+=2):"#b"!==o&&o!==SHARP+FLAT&&"b#"!==o&&o!==FLAT+SHARP||(e=e.slice(0,a-2))),1<e.length)&&("b"===(i=e.slice(a-1))||i===FLAT?(e=e.slice(0,a-1),--n):"#"!==i&&i!==SHARP||(e=e.slice(0,a-1),n+=1)),12*t+(PITCHES.includes(e)?PITCHES.indexOf(e.toUpperCase()):(o=getScaleAndHalfSteps(r))[1].includes(e.toLowerCase())?o[1].indexOf(e.toLowerCase()):(console.debug("pitch "+e+" not found in mode."),e.toLowerCase()in FIXEDSOLFEGE1?(i=FIXEDSOLFEGE1[e.toLowerCase()],o[0].indexOf(i)):0))-PITCHES.indexOf("A")+n)},numberToPitchSharp=function(e){if(e<0){for(var t=0;e<0;)e+=12,t+=1;return[PITCHES2[(e+PITCHES2.indexOf("A"))%12],Math.floor((e+PITCHES2.indexOf("A"))/12)-t]}return[PITCHES2[(e+PITCHES2.indexOf("A"))%12],Math.floor((e+PITCHES2.indexOf("A"))/12)]},getNumber=function(e,t){t=t<0?0:10<t?108:12*(t-1);return(e=String(e)).substring(0,1)in NOTESTEP&&(t+=NOTESTEP[e.substring(0,1)],1<=e.length)&&("bb"===(e=e.substring(1))||e===DOUBLEFLAT?t-=2:"##"===e||"*"===e||e===DOUBLESHARP?t+=2:"b"===e||e===FLAT?--t:"#"!==e&&e!==SHARP||(t+=1)),t},getNoteFromInterval=function(e,t){function r(e){var t,r,n=INTERVALVALUES[e][0],a=numberToPitch(u+n),e=e.split(" "),e=l.indexOf(s)+Number(e[e.length-1])-1,o=c,e=(6<e&&(e-=7,o=c+1),l[e]);return a[0].substring(0,1)===e?[a[0],o]:a[0].substring(0,1)!==e?(a=numberToPitchSharp(u+n))[0]===e?[a[0],o]:(t=getNumber(e,o)-getNumber(m,c),r=E.indexOf(""),[a=e+E[r+n-t]+"",o]):void 0}var n,a,o,i=e.length,s=e.substring(0,1),m=e.substring(0,i-1),c=Number(e.slice(-1)),u=pitchToNumber(m,c,"C major"),l=["C","D","E","F","G","A","B"],E=[DOUBLEFLAT,FLAT,"",SHARP,DOUBLESHARP];return"major 2"===t||"major 3"===t||"major 6"===t||"major 7"===t||"perfect 4"===t||"perfect 5"===t||"perfect 8"===t||"perfect 1"===t?r(t):(e=(i=t).split(" "),"minor 2"===i||"minor 3"===i||"minor 6"===i||"minor 7"===i?(a=(n=r("major "+e[e.length-1]))[0].substring(1,n[0].length),a=0===(o=E.indexOf(a))?E[o]+FLAT:E[o-1]):"down 4"===i||"down 5"===i||"down 8"===i?("down 4"===i?n=r("perfect 4"):"down 5"===i?n=r("perfect 5"):"down 8"===i&&(n=r("perfect 8")),a=n[0].substring(1,n[0].length),a=0===(o=E.indexOf(a))?E[o]+FLAT:E[o-1]):"down-diminished 5"===i?(a=(n=r("perfect 5"))[0].substring(1,n[0].length),a=(o=E.indexOf(a))<=1?E[0]+FLAT:E[o-2]):"diminished 2"===i?(a=(n=r("perfect 1"))[0].substring(1,n[0].length),a=0===(o=E.indexOf(a))?E[o]+FLAT:E[o-1]):i.startsWith("diminished ")?(e=i.split(" ")[1],e=["4","5","8"].includes(e)?"perfect "+e:"major "+e,a=(n=r(e))[0].substring(1,n[0].length),a=0===(o=E.indexOf(a))?E[o]+FLAT:E[o-1]):"up 4"===i||"up 5"===i||"up-augmented 4"===i?("up 4"===i||"up-augmented 4"===i?n=r("perfect 4"):"up 5"===i&&(n=r("perfect 5")),a=n[0].substring(1,n[0].length),a=4===(o=E.indexOf(a))?E[o]+SHARP:E[o+1]):"augmented 1"===i?(a=(n=r("perfect 1"))[0].substring(1,n[0].length),a=4===(o=E.indexOf(a))?E[o]+SHARP:E[o+1]):"augmented 2"===i||"augmented 3"===i||"augmented 4"===i||"augmented 5"===i||"augmented 6"===i||"augmented 7"===i||"augmented 8"===i?(e=i.split(" ")[1],a=(n=["1","4","5","8"].includes(e)?r("perfect "+e):r("major "+e))[0].substring(1,n[0].length),a=4===(o=E.indexOf(a))?E[o]+SHARP:E[o+1]):"up-major 2"===i||"up-major 3"===i||"up-major 6"===i||"up-major 7"===i?(e=i.split(" ")[1],a=(n=r("major "+e))[0].substring(1,n[0].length),a=4===(o=E.indexOf(a))?E[o]+SHARP:E[o+1]):"down-minor 3"===i||"down-minor 6"===i||"down-minor 7"===i?(e=i.split(" ")[1],a=(n=r("major "+e))[0].substring(1,n[0].length),a=(o=E.indexOf(a))<=1?E[0]+FLAT:E[o-2]):"mid 2"!==i&&"mid 3"!==i&&"mid 6"!==i&&"mid 7"!==i||(e=i.split(" ")[1],a=(n=r("major "+e))[0].substring(1,n[0].length),a=0===(o=E.indexOf(a))?E[o]+FLAT:E[o-1]),[n[0].substring(0,1)+a+"",n[1]])},numberToPitch=function(e,t,r,n){void 0===t&&(t="equal");var a=0;if(e<0){for(;e<0;)e+=12,a+=1;if("equal"===t)return[PITCHES[(e+PITCHES.indexOf("A"))%12],Math.floor((e+PITCHES.indexOf("A"))/12)-a]}else if("equal"===t)return[PITCHES[(e+PITCHES.indexOf("A"))%12],Math.floor((e+PITCHES.indexOf("A"))/12)];if(n=Math.floor(e-n),isCustomTemperament(t)){var o=TEMPERAMENT[t].pitchNumber,i=n%o,o=Math.floor(n/o),n=i+"";if(void 0!==TEMPERAMENT[t][n])return i=Number(TEMPERAMENT[t][n][2])+o,[TEMPERAMENT[t][n][1],i];for(var s=0;s<12;s++){var m=TEMPERAMENT.equal.interval[e];TEMPERAMENT[t][""+s]=[Math.pow(2,s/12),getNoteFromInterval(r,m)[0],getNoteFromInterval(r,m)[1]]}return[TEMPERAMENT[t][n][1],TEMPERAMENT[t][n][2]]}return m=TEMPERAMENT[t].interval[n],getNoteFromInterval(r,m)},GetNotesForInterval=function(e){var t=e.singer.noteStatus,r=e.singer.notePitches,n=e.singer.intervals,a=e.singer.noteOctaves,o="C",i="C",s=0;if(t&&t[0]){if(o=t[0][0].replace(/\d/g,""),!t[0][1])return{firstNote:o,secondNote:o,octave:s};var i=t[0][1].replace(/\d/g,""),m=parseInt(t[0][0].replace(/[^0-9]/g,"")),s=parseInt(t[0][1].replace(/[^0-9]/g,""))-m}else r&&(o=(t=r[last(e.singer.inNoteBlock)])[0],i=t[t.length-1]);return n&&n.length?s=Math.floor(n[0]/7):a&&a[last(e.singer.inNoteBlock)]&&(s=(m=a[last(e.singer.inNoteBlock)])[m.length-1]-m[0]),o=o.replace("♭","b"),i=i.replace("♭","b"),{firstNote:o=o.replace("♯","#"),secondNote:i=i.replace("♯","#"),octave:s}};function base64Encode(e){e=(new TextEncoder).encode(e);return String.fromCharCode.apply(String,_toConsumableArray(e))}function getNote(e,t,r,n,a,o,i,s){void 0===s&&(s="equal");var m,c,u=!1,l=!1,E=!1,A=0,T=0;if((r=void 0===r?0:r)<0?(T=(r=-r)-(A=Math.floor(r)),A=-A,T=100*-T,r=-r):T=100*(r-(A=Math.floor(r))),"number"!=typeof e){if(">"===e.substr(-1)&&(t=parseInt(e.slice(e.indexOf(">")+1,e.indexOf("/")-1)),e=e.substr(0,e.indexOf("<"))),"rest"===e.toLowerCase().substr(0,4)||"r"===e.toLowerCase().substr(0,4))return["R","",0];var d=e;["#",SHARP,FLAT,"b"].includes(e.substr(-1))&&(d=e.slice(0,e.length-1)),isNaN(d)||(["#",SHARP].includes(e.substr(-1))?A+=1:["b",FLAT].includes(e.substr(-1))&&--A,e=Number(d))}if(t=Math.round(t),"number"==typeof e&&(n=n||"C major",d=0,a&&-1===(d=-1===(d=-1===(d=PITCHES.indexOf(n.split(" ")[0]))?PITCHES.indexOf(n.split(" ")[0]):d)?PITCHES2.indexOf(n.split(" ")[0]):d)&&(d=0,console.log("Cannot find "+n.split(" ")[0]+". Reverting to C")),e=("sharp"===getSharpFlatPreference(n)?PITCHES2:PITCHES)[(e+d)%12]),s in PreDefinedTemperaments){switch(m=getArticulation(e),e=e.replace(m,""),m){case"bb":case DOUBLEFLAT:e+="b",l=!0,--A;break;case"b":case FLAT:e+="b",l=!0;break;case"##":case"*":case"x":case DOUBLESHARP:e+="#",E=!0,A+=1;break;case"#":case SHARP:e+="#",E=!0}if(!E&&e in BTOFLAT?e=BTOFLAT[e]:e in STOSHARP&&(e=STOSHARP[e]),e in EXTRATRANSPOSITIONS)t+=EXTRATRANSPOSITIONS[e][1],N=EXTRATRANSPOSITIONS[e][0];else if(NOTESSHARP.includes(e.toUpperCase()))N=e.toUpperCase();else if(NOTESFLAT.includes(e))N=e;else if(NOTESFLAT2.includes(e))N=NOTESFLAT[NOTESFLAT2.indexOf(e)];else{["#",SHARP,FLAT,"b"].includes(e.substr(-1))&&(u=!0),n=n||"C major";var S,p,h,f=(d=getScaleAndHalfSteps(a?n:"C major"))[0],g=d[1],L=d[2],d=d[3];if(a?(-1===(S=f.indexOf(L))&&(console.debug("WARNING: Key "+L+" not found in "+f+". Using default of C"),S=0,f=NOTESSHARP),5<S&&(A-=12)):S=0,u&&("#"===e.substr(-1)||e.substr(-1)===SHARP?S+=1:e.substr(-1)!==FLAT&&"b"!==e.substr(-1)||--S),p=g.includes(e.substr(0,1).toLowerCase())?e.substr(0,1).toLowerCase():g.includes(e.substr(0,2).toLowerCase())?e.substr(0,2).toLowerCase():g.includes(e.substr(0,3).toLowerCase())?e.substr(0,3).toLowerCase():(L=_("ti la sol fa mi re do").split(" ")).includes(e.substr(0,1).toLowerCase())||L.includes(e.substr(0,2).toLowerCase())?SOLFNOTES[L.indexOf(e.substr(0,2).toLowerCase())]:L.includes(e.substr(0,3).toLowerCase())?SOLFNOTES[L.indexOf(e.substr(0,3).toLowerCase())]:e.substr(0,2).toLowerCase(),a)switch(d){case"dorian":0<(h=SOLFEGENAMES.indexOf(p))&&(A+=12),A-=12,6<(h+=6)&&(h-=7),p=SOLFEGENAMES[h];break;case"phrygian":1<(h=SOLFEGENAMES.indexOf(p))&&(A+=12),6<(h+=5)&&(h-=7),p=SOLFEGENAMES[h];break;case"lydian":2<(h=SOLFEGENAMES.indexOf(p))&&(A+=12),6<(h+=4)&&(h-=7),p=SOLFEGENAMES[h];break;case"mixolydian":3<(h=SOLFEGENAMES.indexOf(p))&&(A+=12),6<(h+=3)&&(h-=7),p=SOLFEGENAMES[h];break;case"minor":case"aeolian":4<(h=SOLFEGENAMES.indexOf(p))&&(A+=12),6<(h+=2)&&(h-=7),p=SOLFEGENAMES[h];break;case"locrian":5<(h=SOLFEGENAMES.indexOf(p))&&(A+=12),6<(h+=1)&&(h-=7),p=SOLFEGENAMES[h]}if(!g.includes(p))return console.debug("WARNING: Note ["+e+"] not found in "+g+". Returning REST"),null!=i&&i(INVALIDPITCH,null),["R","",0];11<(u=g.indexOf(p)+S)?(u-=12,t+=1):u<0&&(u+=12,--t),(N=f[u])in EXTRATRANSPOSITIONS&&(t+=EXTRATRANSPOSITIONS[N][1],N=EXTRATRANSPOSITIONS[N][0])}switch(A&&0!==A&&(L=A<0?(M=-Math.floor(-A/12),- -A%12):(M=Math.floor(A/12),A%12),t+=M,0<L?NOTESSHARP.includes(N)?(d=NOTESSHARP.indexOf(N),(d+=L)<0?(d+=12,--t):11<d&&(d-=12,t+=1),N=NOTESSHARP[d]):NOTESFLAT.includes(N)?(g=NOTESFLAT.indexOf(N),(g+=L)<0?(g+=12,--t):11<g&&(g-=12,t+=1),N=NOTESFLAT[g]):console.debug("note not found? "+N):L<0&&(NOTESFLAT.includes(N)?(S=NOTESFLAT.indexOf(N),(S+=L)<0?(S+=12,--t):11<S&&(S-=12,t+=1),N=NOTESFLAT[S]):NOTESSHARP.includes(N)?(f=NOTESSHARP.indexOf(N),(f+=L)<0?(f+=12,--t):11<f&&(f-=12,t+=1),N=NOTESSHARP[f]):console.debug("note not found? "+N))),getSharpFlatPreference(n)){case"flat":N in EQUIVALENTFLATS&&(N=EQUIVALENTFLATS[N]);break;case"sharp":N in EQUIVALENTSHARPS&&(N=EQUIVALENTSHARPS[N]);break;case"natural":N in EQUIVALENTNATURALS&&(N=EQUIVALENTNATURALS[N])}if(null!=o)switch(o){case-1:N in EQUIVALENTFLATS&&(N=EQUIVALENTFLATS[N]);break;case 1:N in EQUIVALENTSHARPS&&(N=EQUIVALENTSHARPS[N])}E?N in EQUIVALENTSHARPS&&(N=EQUIVALENTSHARPS[N]):l&&N in EQUIVALENTFLATS&&(N=EQUIVALENTFLATS[N])}else if(isCustomTemperament(s)){var b,N=getCustomNote(e),O=null;for(b in TEMPERAMENT[s])if("pitchNumber"!==b&&"interval"!=b){if(N===TEMPERAMENT[s][b][3]){O="string"==typeof b?Number(b):b;break}if(N===TEMPERAMENT[s][b][1]){O="string"==typeof b?Number(b):b;break}}if(null===O||"null"===O)return getNote(e,t,A,n,a,o,i);var P,u=t,M=TEMPERAMENT[temperamentFloor].pitchNumber;0!==A&&(d=A<0?(P=-Math.floor(-A/M),- -A%M):(P=Math.floor(A/M),A%M),u+=P,O+=d),O<0?(O+=M,u-=1):M<=O&&(O-=M,u+=1),N=3<TEMPERAMENT[s][O+=""].length?TEMPERAMENT[s][O][3]:TEMPERAMENT[s][O][1],t=u}else{switch(m=getArticulation(e),e=e.replace(m,""),SOLFEGENAMES.includes(e)&&(e=FIXEDSOLFEGE[e]),m){case"bb":case DOUBLEFLAT:e+="𝄫";break;case"b":case FLAT:e+="b";break;case"##":case"*":case"x":case DOUBLESHARP:e+="𝄪";break;case"#":case SHARP:e+="#"}if(N=e,A&&0!==A){var F,R,I=A<0?(c=-Math.floor(-A/12),- -A%12):(c=Math.floor(A/12),r%12);if(t+=c,0<I){for(var w in F=N+""+t,INTERVALVALUES)if(I===INTERVALVALUES[w][0]){R=getNoteFromInterval(F,w);break}}else if(I<0){for(var D in F=N+""+(t-1),INTERVALVALUES)if(12+I===INTERVALVALUES[D][0]){R=getNoteFromInterval(F,D);break}}else 0===I&&(R=getNoteFromInterval(F=N+""+t,"perfect 1"));N=R[0],t=R[1]}}return t<1?[N,1,T]:10<t?[N,10,T]:[N,t,T]}var _module$exports,_calculate_pitch_number=function(t,e,r){var n;if(null!==r.singer.lastNotePlayed)n=("string"==typeof e?noteToObj:frequencyToPitch)(e);else if(r.singer.inNoteBlock in r.singer.notePitches&&0<r.singer.notePitches[last(r.singer.inNoteBlock)].length)n=getNote(r.singer.notePitches[last(r.singer.inNoteBlock)][0],r.singer.noteOctaves[last(r.singer.inNoteBlock)][0],0,r.singer.keySignature,r.singer.movable,null,t.errorMsg);else try{n=("string"==typeof e?noteToObj:frequencyToPitch)(e)}catch(e){t.errorMsg(INVALIDPITCH),n=["G",4]}return pitchToNumber(n[0],n[1],r.singer.keySignature)-r.singer.pitchNumberOffset},buildScale=function(e){if("C♭ major"==e)return[["C"+FLAT,"D"+FLAT,"E"+FLAT,"F"+FLAT,"G"+FLAT,"A"+FLAT,"B"+FLAT,"C"+FLAT],[2,2,1,2,2,2,1]];if("F♭ major"==e)return[["F"+FLAT,"G"+FLAT,"A"+FLAT,"B"+DOUBLEFLAT,"C"+FLAT,"D"+FLAT,"E"+FLAT,"F"+FLAT],[2,2,1,2,2,2,1]];for(var t,r,e=keySignatureToMode(e),n=e[0],e=(n=="C"+FLAT&&(n=(e=keySignatureToMode("B "+e[1]))[0]),t="CUSTOM"===e[1]?customMode:MUSICALMODES[e[1]],(r=NOTESFLAT.includes(n)?SHARPPREFERENCE.includes(e[0].toLowerCase()+" "+e[1])?NOTESSHARP:NOTESFLAT:FLATPREFERENCE.includes(e[0].toLowerCase()+" "+e[1])?NOTESFLAT:NOTESSHARP).indexOf(n)),a=[n],o=e=-1===e?0:e,i=0;i<t.length;i++)o+=t[i],a.push(r[o%SEMITONES]);if(a.length<9){for(var s=0;s<a.length-1;s++)0===s?a[s][0]===a[s+1][0]&&a[s+1]in CONVERT_UP&&(a[s+1]=CONVERT_UP[a[s+1]]):r===NOTESSHARP?a[s][0]===a[s+1][0]&&a[s]in CONVERT_DOWN&&(a[s]=CONVERT_DOWN[a[s]]):a[s-1][0]===a[s][0]&&a[s]in CONVERT_UP&&(a[s]=CONVERT_UP[a[s]]);if(2===n.length&&n[1]===SHARP)for(var m=a.length-1;0<m;m--)a[m][0]===a[m-1][0]&&(a[m-1]in CONVERT_DOWN?a[m-1]=CONVERT_DOWN[a[m-1]]:a[m-1]in CONVERT_DOUBLE_DOWN&&(a[m-1]=CONVERT_DOUBLE_DOWN[a[m-1]]));else if(2===n.length&&n[1]===FLAT)for(var c=0;c<a.length-2;c++)a[c][0]===a[c+1][0]&&(a[c+1]in CONVERT_UP?a[c+1]=CONVERT_UP[a[c+1]]:a[c+1]in CONVERT_DOUBLE_UP&&(a[c+1]=CONVERT_DOUBLE_UP[a[c+1]]))}return[a,t]},_getStepSize=function(e,r,t,n,a){if(isCustomTemperament(a=void 0===a?"equal":a))return n;var o=r,a=buildScale(e),i=a[0],n=a[1],e=(o in BTOFLAT?o=BTOFLAT[o]:o in STOSHARP&&(o=STOSHARP[o]),i.findIndex(function(e){return(e=e)==(t=r)||e=="E"+SHARP&&"F"==t||"E"==e&&t=="F"+FLAT||"F"==e&&"E♯"==t||e=="F"+FLAT&&"E"==t||e=="B"+SHARP&&"C"==t||"B"==e&&t=="C"+FLAT||"C"==e&&"B♯"==t||e=="C"+FLAT&&"B"==t||e=="B"+DOUBLEFLAT&&"A"==t||e=="F"+DOUBLESHARP&&"G"==t;var t}));if(-1!==e)return"up"===t?n[e]:0<e?-n[e-1]:-last(n);if(-1!==(e=-1===(e=-1===(e=-1===e&&o in EQUIVALENTFLATS?i.indexOf(EQUIVALENTFLATS[o]):e)&&o in EQUIVALENTSHARPS?i.indexOf(EQUIVALENTSHARPS[o]):e)&&o in EQUIVALENTNATURALS?i.indexOf(EQUIVALENTNATURALS[o]):e))return"up"===t?n[e]:0<e?-n[e-1]:-last(n);var s=0,m=PITCHES.indexOf(o);if(-1!==m)for(;!i.includes(o);)-1===(m=PITCHES.indexOf(o))&&(m=PITCHES2.indexOf(o)),"up"===t?(o=PITCHES[(m+=1)%12],s+=1):(--m<0&&(m+=12),o=PITCHES[m],--s);else{if(-1===(m=PITCHES2.indexOf(o)))return console.debug(o+" not found"),0;for(;!i.includes(o);)-1===(m=PITCHES2.indexOf(o))&&(m=PITCHES.indexOf(o)),"up"===t?(o=PITCHES2[(m+=1)%12],s+=1):(--m<0&&(m+=12),o=PITCHES2[m],--s)}return s},getStepSizeUp=function(e,t,r,n){return _getStepSize(e,t,"up",r,n)},getStepSizeDown=function(e,t,r,n){return _getStepSize(e,t,"down",r,n)},getModeLength=function(e){return buildScale(e)[1].length},scaleDegreeToPitchMapping=function(e,t,r,n){null===n&&--t;var a=keySignatureToMode(e),e=buildScale(e),o=e[0],i=e[1],s=[0],m=[],c=[],u=[];if(r){if(c=buildScale(a[0]+" major")[0],null===n)return c[t];if(null==t){for(var l in c)c[l][0]==n[0]&&(u.push(String(Number(l)+1)),c[l]==n?u.push(NATURAL):c[l].includes(SHARP)||c[l].includes(FLAT)?u.push(FLAT):n.includes(SHARP)?u.push(SHARP):n.includes(FLAT)&&u.push(FLAT));return u}}else if(7==i.length){if(null===n)return o[t];if(null==t){for(var E in o)o[E][0]==n[0]&&(u.push(String(Number(E)+1)),o[E]==n?u.push(NATURAL):o[E].includes(SHARP)||o[E].includes(FLAT)?u.push(FLAT):n.includes(SHARP)?u.push(SHARP):n.includes(FLAT)&&u.push(FLAT));return u}}else if(i.length<7){for(var A=buildScale(a[0]+" major")[0],T=0;T<i.length;T++){switch(s[T]){case 0:m.push(1);break;case 1:case 2:m.push(2);break;case 3:case 4:m.push(3);break;case 5:m.push(4);break;case 6:4!==m[m.length-1]?m.push(4):s[T]+o[T]!=7&&m.push(5);break;case 7:m.push(5);break;case 8:case 9:m.push(6);break;case 10:case 11:m.push(7);break;default:continue}s.push(s[T]+i[T])}for(var d=0,S=0;S<7;S++)m.includes(S+1)?(c.push(o[d]),d++):c.push(A[S]);if(null===n)return c[t];if(null==t){for(var p in c)c[p][0]==n[0]&&(u.push(String(Number(p)+1)),c[p]==n?u.push(NATURAL):c[p].includes(SHARP)||c[p].includes(FLAT)?u.push(FLAT):n.includes(SHARP)?u.push(SHARP):n.includes(FLAT)&&u.push(FLAT));return u}}else{for(var h=0;h<i.length;h++)s.push(s[h]+i[h]);for(var f=0;f<s.length;f++)switch(s[f]){case 0:c.push(o[f]);break;case 1:2==s[f+1]?c.push(o[f+1]):c.push(o[f]);break;case 2:1!=s[f-1]&&c.push(o[f]);break;case 3:4==s[f+1]?c.push(o[f+1]):c.push(o[f]);break;case 4:3!=s[f-1]&&c.push(o[f]);break;case 5:c.push(o[f]);break;case 6:(5==s[f-1]&&7!=s[f+1]||5!=s[f-1]&&7==s[f+1])&&c.push(o[f]);break;case 7:c.push(o[f]);break;case 8:9==s[f+1]?c.push(o[f+1]):c.push(o[f]);break;case 9:8!=s[f-1]&&c.push(o[f]);break;case 10:11==s[f+1]?c.push(o[f+1]):c.push(o[f]);break;case 11:10!=s[f-1]&&c.push(o[f])}if(null===n)return c[t];if(null==t){for(var g in c)c[g][0]==n[0]&&(u.push(String(Number(g)+1)),c[g]==n?u.push(NATURAL):c[g].includes(SHARP)||c[g].includes(FLAT)?u.push(FLAT):n.includes(SHARP)?u.push(SHARP):n.includes(FLAT)&&u.push(FLAT));return u}}},nthDegreeToPitch=function(e,t){e=buildScale(e)[0];return e[t%=e.length-1]},getInterval=function(e,t,r){var t=buildScale(t),n=t[0],a=t[1];if((r=SOLFEGENAMES.includes(r)?FIXEDSOLFEGE[r]:r)in BTOFLAT)r=BTOFLAT[r],o=n.indexOf(r);else if(r in STOSHARP)r=STOSHARP[r],o=n.indexOf(r);else if(n.includes(r))o=n.indexOf(r);else{var o,i=0;if(-1===(o=-1===(o=-1===(o=-1===(o=n.indexOf(r))&&r in EQUIVALENTFLATS?n.indexOf(EQUIVALENTFLATS[r]):o)&&r in EQUIVALENTSHARPS?n.indexOf(EQUIVALENTSHARPS[r]):o)&&r in EQUIVALENTNATURALS?n.indexOf(EQUIVALENTNATURALS[r]):o)){if(PITCHES.includes(r))for(;!(n.includes(r)||24<(i+=1));){var s=PITCHES.indexOf(r);r=0<e?PITCHES[(s+=1)%12]:(--s<0&&(s+=12),PITCHES[s])}else{if(!PITCHES2.includes(r))return console.debug(r+" not found"),0;for(;!(n.includes(r)||24<(i+=1));){var m=PITCHES2.indexOf(r);r=0<e?PITCHES2[(m+=1)%12]:(--m<0&&(m+=12),PITCHES2[m])}}o=n.indexOf(r)}}var c=0;if(0===e)return 0;if(0<e)for(var u=0;u<e;u++)c+=a[(o+u)%a.length];else for(var l=0;e<l;l--){for(var E=(o+l-1)%a.length;E<0;)E+=a.length;c-=a[E]}return c},reducedFraction=function(e,t){function r(e,t){return 0===t?e:r(t,e%t)}var n=r(e,t);return[1,2,4,8,16].includes(t/n)?e/n+"<br>&mdash;<br>"+t/n+"<br>"+NSYMBOLS[t/n]:e/n+"<br>&mdash;<br>"+t/n+"<br><br>"},toFraction=function(e){for(var t=!1,r=(1<e&&(t=!0,e=1/e),1),n=1,a=1;1e-8<Math.abs(r-e);)r<e?n+=1:(a+=1,n=parseInt(e*a)),r=n/a;return t&&(t=n,n=a,a=t),[n,a]},calcNoteValueToDisplay=function(e,t){var r,n,a,o=e/t,i=null,i=o in NSYMBOLS?"1<br>&mdash;<br>"+o.toString()+"<br>"+NSYMBOLS[o]:reducedFraction(t,e);return i=parseInt(o)<o?(i=parseInt(1.5*o))in NSYMBOLS?(r=toFraction(t/e),n=Number.isInteger(r[0])?0:2,a=Number.isInteger(r[1])?0:2,r[0].toFixed(n)+"<br>&mdash;<br>"+r[1].toFixed(a)+"<br>"+NSYMBOLS[i]+"."):(i=parseInt(1.75*o))in NSYMBOLS?(r=toFraction(t/e),n=Number.isInteger(r[0])?0:2,a=Number.isInteger(r[1])?0:2,r[0].toFixed(n)+"<br>&mdash;<br>"+r[1].toFixed(a)+"<br>"+NSYMBOLS[i]+".."):reducedFraction(t,e):i},durationToNoteValue=function(e){for(var t,r=0;r<3;r++)if(t=2-1/Math.pow(2,r),POWER2.includes(t=e*t))return[t,r,null];for(var n=e,a=1;a<POWER2.length;a++)if(n<POWER2[a]){n=POWER2[a-1];break}POWER2.includes(n)||(n=128);for(var o=1;Math.floor(e/o)*o===e&&!(e/2<(o*=2)););return[1,0,[e/(o/=2),o],n]},noteToPitchOctave=function(e){var t=e.length;return[e.substring(0,t-1),Number(last(e))]},pitchToFrequency=function(e,t,r,n){e=pitchToNumber(e,t,n);return 0===r?A0*Math.pow(TWELTHROOT2,e):A0*Math.pow(TWELVEHUNDRETHROOT2,100*e+r)},noteToFrequency=function(e,t){e=noteToPitchOctave(e);return pitchToFrequency(e[0],e[1],0,t)},noteIsSolfege=function(e){return void 0===SOLFEGECONVERSIONTABLE[e]},getSolfege=function(e){return noteIsSolfege(e)?e:SOLFEGECONVERSIONTABLE[e]},splitSolfege=function(e){var t;return null!=e&&"string"==typeof e?(e=SOLFNOTES.includes(e)?(t=e,""):"sol"===e.slice(0,3)?(t="sol",4===e.length?e[3]:e[3]+e[4]):(t=e.slice(0,2),3===e.length?e[2]:e[2]+e[3]),[t,e]):["sol",""]},i18nSolfege=function(e){var t=_("ti la sol fa mi re do").split(" "),r=splitSolfege(e),n=SOLFNOTES.indexOf(r[0]);return-1!==n?t[n]+r[1]:-1!==(n=Object.values(t).indexOf(r[0]))?SOLFNOTES[n]+r[1]:e},splitScaleDegree=function(e){return e?[e.slice(0,1),e.slice(1)]:[5,NATURAL]},getNumNote=function(e,t){var e=e+t,t=Math.floor(e/12),r=NOTESTABLE[e%=12];return"ti"===r[e]&&--t,[r,t+1]},calcOctave=function(t,e,r,n){if("number"==typeof e)return Math.max(1,Math.min(Math.floor(e),9));var a,n=SOLFEGENAMES1.includes(n)?FIXEDSOLFEGE1[n]:n,o=getNumber(n,t),i=getNumber(n,t+1),n=getNumber(n,t-1),r=(r=null!=r?(r=r[0]).substring(0,r.length-1):"G",getNumber(r,t)),o=Math.abs(r-o),i=Math.abs(r-i),r=Math.abs(r-n);switch((o<=5||isNaN(o))&&(a=t),5<o&&5<i&&r<5&&(a=Math.max(t-1,1)),5<o&&i<5&&5<r&&(a=Math.min(t+1,9)),5<o&&5<i&&5<r&&(a=t),e){case _("current"):case"current":return a;case _("next"):case"next":return Math.min(a+1,10);case _("previous"):case"previous":return Math.max(a-1,1);default:try{return a||Math.floor(Number(e))}catch(e){return t}}},calcOctaveInterval=function(e){var t=0;switch(e){case 1:case _("next"):case"next":t=1;break;case-1:case _("previous"):case"previous":t=-1;break;case _("current"):case"current":case 0:t=0;break;case 2:t=2;break;case-2:t=-2;break;default:console.debug("Interval octave must be between -2 and 2."),t=0}return t},isInt=function(e){return!isNaN(e)&&parseInt(Number(e))===e&&!isNaN(parseInt(e,10))},convertFromSolfege=function(e){return e=(e=e in FIXEDSOLFEGE1?FIXEDSOLFEGE1[e]:e)in EQUIVALENTNATURALS?EQUIVALENTNATURALS[e]:e},convertFactor=function(e){switch(e){case.0625:return"16";case.125:return"8";case.09375:return"16.";case.1875:return"8.";case.21875:return"8..";case.25:return"4";case.3125:return"4 16";case.375:return"4.";case.4375:return"4..";case.5:return"2";case.5625:return"2 16";case.675:return"2 8";case.6875:return"2 8 16";case.75:return"2.";case.8125:return"2 4 16";case.875:return"2..";case.9375:return"2 4 8 16";case 1:return"1";default:return null}},getPitchInfo=function(e,t,r,n){var a,o,i;Number(r)?(a=(i=frequencyToPitch(r))[0],o=i[1],cents=i[2]):(a=r.substr(0,r.length-1),o=r[r.length-1]),a.includes(DOUBLESHARP)?a="B"===(a=a.replace(DOUBLESHARP,""))?"C"+SHARP:NOTESSHARP[NOTESSHARP.indexOf(a)+2]:a.includes(DOUBLEFLAT)&&(a="C"===(a=a.replace(DOUBLEFLAT,""))?"B"+FLAT:NOTESFLAT[NOTESFLAT.indexOf(a)-2]),a=a.replace("#",SHARP).replace("b",FLAT),buildScale(n.singer.keySignature)[0].includes(a)||(a in EQUIVALENTFLATS?a=EQUIVALENTFLATS[a]:a in EQUIVALENTSHARPS&&(a=EQUIVALENTSHARPS[a]));try{switch(t){case"alphabet":return a;case"alphabet class":case"letter class":return a[0];case"solfege syllable":case"solfege class":return"solfege class"===t&&(a=a.replace(SHARP).replace(FLAT)),!1===n.singer.movable?SOLFEGECONVERSIONTABLE[a]:SOLFEGENAMES[buildScale(n.singer.keySignature)[0].indexOf(a)];case"pitch class":return(pitchToNumber(a,o,n.singer.keySignature)-3)%12;case"scalar class":return scaleDegreeToPitchMapping(n.singer.keySignature,null,n.singer.movable,a)[0];case"scale degree":return(i=scaleDegreeToPitchMapping(n.singer.keySignature,null,n.singer.movable,a))[0]+i[1];case"nth degree":return buildScale(n.singer.keySignature)[0].indexOf(a);case"staff y":return["C","D","E","F","G","A","B"].indexOf(a[0])*YSTAFFNOTEHEIGHT+(o-4)*YSTAFFOCTAVEHEIGHT;case"pitch number":return _calculate_pitch_number(e,a,n);case"pitch in hertz":return e.logo.synth._getFrequency(a+o,e.logo.synth.changeInTemperament);case"pitch to color":return NOTESSHARP.includes(a)?8.33*NOTESSHARP.indexOf(a):NOTESFLAT.includes(a)?8.33*NOTESFLAT.indexOf(a):(console.debug("Pitch not found: "+a),0);case"pitch to shade":return 12.5*o;default:return"__INVALID_INPUT__"}}catch(e){console.debug("Waiting for note to play")}};"undefined"!=typeof module&&module.exports&&(module.exports=(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_module$exports={updateTemperaments:updateTemperaments,scaleDegreeToPitchMapping:scaleDegreeToPitchMapping,buildScale:buildScale,getNote:getNote,getModeLength:getModeLength,nthDegreeToPitch:nthDegreeToPitch,getInterval:getInterval,_calculate_pitch_number:_calculate_pitch_number,_getStepSize:_getStepSize,reducedFraction:reducedFraction,toFraction:toFraction,durationToNoteValue:durationToNoteValue,calcNoteValueToDisplay:calcNoteValueToDisplay,noteToPitchOctave:noteToPitchOctave,pitchToFrequency:pitchToFrequency,noteIsSolfege:noteIsSolfege,getSolfege:getSolfege,splitSolfege:splitSolfege,i18nSolfege:i18nSolfege,splitScaleDegree:splitScaleDegree,getNumNote:getNumNote,calcOctave:calcOctave,calcOctaveInterval:calcOctaveInterval,isInt:isInt,convertFromSolfege:convertFromSolfege,convertFactor:convertFactor,getPitchInfo:getPitchInfo,noteToFrequency:noteToFrequency,TEMPERAMENT:TEMPERAMENT,setOctaveRatio:setOctaveRatio,getOctaveRatio:getOctaveRatio},"TEMPERAMENT",TEMPERAMENT),"TEMPERAMENTS",TEMPERAMENTS),"INITIALTEMPERAMENTS",INITIALTEMPERAMENTS),"PreDefinedTemperaments",PreDefinedTemperaments),"getTemperamentsList",getTemperamentsList),"getTemperament",getTemperament),"getTemperamentKeys",getTemperamentKeys),"addTemperamentToList",addTemperamentToList),"deleteTemperamentFromList",deleteTemperamentFromList),"addTemperamentToDictionary",addTemperamentToDictionary),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_module$exports,"updateTemperaments",updateTemperaments),"DEFAULTINVERT",DEFAULTINVERT),"DEFAULTMODE",DEFAULTMODE),"customMode",customMode),"getInvertMode",getInvertMode),"getIntervalNumber",getIntervalNumber),"getIntervalDirection",getIntervalDirection),"getIntervalRatio",getIntervalRatio),"getModeNumbers",getModeNumbers),"getDrumIndex",getDrumIndex),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_module$exports,"getDrumName",getDrumName),"getDrumSymbol",getDrumSymbol),"getFilterTypes",getFilterTypes),"getOscillatorTypes",getOscillatorTypes),"getDrumIcon",getDrumIcon),"getDrumSynthName",getDrumSynthName),"getNoiseName",getNoiseName),"getNoiseIcon",getNoiseIcon),"getNoiseSynthName",getNoiseSynthName),"getVoiceName",getVoiceName),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_module$exports,"getVoiceIcon",getVoiceIcon),"getVoiceSynthName",getVoiceSynthName),"isCustomTemperament",isCustomTemperament),"getTemperamentName",getTemperamentName),"noteToObj",noteToObj),"frequencyToPitch",frequencyToPitch),"getArticulation",getArticulation),"keySignatureToMode",keySignatureToMode),"getScaleAndHalfSteps",getScaleAndHalfSteps),"modeMapper",modeMapper),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_module$exports,"getSharpFlatPreference",getSharpFlatPreference),"getCustomNote",getCustomNote),"pitchToNumber",pitchToNumber),"numberToPitchSharp",numberToPitchSharp),"getNumber",getNumber),"getNoteFromInterval",getNoteFromInterval),"numberToPitch",numberToPitch),"GetNotesForInterval",GetNotesForInterval),"base64Encode",base64Encode),"getStepSizeUp",getStepSizeUp),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_module$exports,"getStepSizeDown",getStepSizeDown),"ACCIDENTALNAMES",ACCIDENTALNAMES),"ACCIDENTALVALUES",ACCIDENTALVALUES),"NOTESFLAT",NOTESFLAT),"NOTESSHARP",NOTESSHARP),"NOTESTEP",NOTESTEP),"MUSICALMODES",MUSICALMODES),"SHARP",SHARP),"FLAT",FLAT)));
var theme,themePreference=localStorage.themePreference||void 0,platformThemes=(window.platform={android:/Android/i.test(navigator.userAgent),FF:/Firefox/i.test(navigator.userAgent),mobile:/Mobi/i.test(navigator.userAgent),tablet:/Tablet/i.test(navigator.userAgent)},platform.androidWebkit=platform.android&&!platform.FF,platform.FFOS=platform.FF&&(platform.mobile||platform.tablet)&&!platform.android,{dark:{textColor:"#E2E2E2",blockText:"#E2E2E2",dialogueBox:"#1C1C1C",strokeColor:"#E2E2E2",fillColor:"#F9F9F9",blueButton:"#0066FF",blueButtonHover:"#023a76",cancelButton:"#f1f1f1",cancelButtonHover:"#afafaf",hoverColor:"#808080",widgetButton:"#225A91",widgetButtonSelect:"#979797",widgetBackground:"#454545",paletteColors:{widgets:["#2E7D32","#1B5E20","#1B5E20","#81C784"],pitch:["#2E7D32","#1B5E20","#1B5E20","#81C784"],rhythm:["#BF360C","#8C2A0B","#8C2A0B","#FF8A65"],meter:["#BF360C","#8C2A0B","#8C2A0B","#FF8A65"],tone:["#00838F","#005662","#005662","#4DD0E1"],ornament:["#00838F","#005662","#005662","#4DD0E1"],intervals:["#2E7D32","#1B5E20","#1B5E20","#81C784"],volume:["#00838F","#005662","#005662","#4DD0E1"],drum:["#00838F","#005662","#005662","#4DD0E1"],graphics:["#3949AB","#283593","#283593","#7986CB"],turtle:["#3949AB","#283593","#283593","#7986CB"],pen:["#3949AB","#283593","#283593","#7986CB"],boxes:["#E65100","#BF360C","#BF360C","#FFB74D"],action:["#FF8F00","#FF6F00","#FF6F00","#FFE082"],media:["#C62828","#8E0000","#8E0000","#FF8A80"],number:["#AD1457","#880E4F","#880E4F","#F48FB1"],boolean:["#7B1FA2","#4A0072","#4A0072","#CE93D8"],flow:["#5D4037","#3E2723","#3E2723","#BCAAA4"],sensors:["#827717","#4B830D","#4B830D","#E6EE9C"],extras:["#424242","#212121","#212121","#9E9E9E"],program:["#424242","#212121","#212121","#9E9E9E"],myblocks:["#FF8F00","#FF6F00","#FF6F00","#FFE082"],heap:["#5D4037","#3E2723","#3E2723","#BCAAA4"],dictionary:["#5D4037","#3E2723","#3E2723","#BCAAA4"],ensemble:["#3949AB","#283593","#283593","#7986CB"]},disconnected:"#5C5C5C",header:"#1E88E5",aux:"#1976D2",sub:"#64B5F6",doHeaderShadow:!platform.FF,rule:"#303030",ruleColor:"#303030",trashColor:"#757575",trashBorder:"#424242",trashActive:"#E53935",background:"#303030",paletteSelected:"#1E1E1E",paletteBackground:"#1C1C1C",paletteLabelBackground:"#022363",paletteLabelSelected:"#01143b",paletteText:"#BDBDBD",rulerHighlight:"#FFEB3B",selectorBackground:"#64B5F6",selectorSelected:"#1E88E5",labelColor:"#BDBDBD",lyricsLabelBackground:"#C7225D",lyricsInputBackground:"#D15A84",tupletBackground:"#424242",drumBackground:"#00ACC1",pitchBackground:"#4CAF50",graphicsBackground:"#7986CB",drumLabelBackground:"#008BA3",pitchLabelBackground:"#388E3C",graphicsLabelBackground:"#5C6BC0",rhythmcellcolor:"#303030",stopIconcolor:"#D50000",hitAreaGraphicsBeginFill:"#121212",orange:"#FB8C00",piemenuBasic:["#00ACC1","#4CAF50","#008BA3","#4CAF50","#008BA3"],exitWheelcolors:["#757575","#BDBDBD"],exitWheelcolors2:["#757575","#7986CB","#4CAF50"],pitchWheelcolors:["#388E3C","#4CAF50","#388E3C","#008BA3","#388E3C","#4CAF50","#66BB6A"],gridWheelcolors:{wheel:["#D6D6D6"],selected:{fill:"#858585",stroke:"#777"}},drumWheelcolors:["#008BA3","#00ACC1"],graphicWheelcolors:["#7986CB","#5C6BC0"],accidentalsWheelcolors:["#388E3C","#4CAF50","#388E3C","#008BA3","#388E3C"],accidentalsWheelcolorspush:"#424242",octavesWheelcolors:["#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#424242","#424242","#424242","#424242","#424242","#424242"],blockLabelsWheelcolors:["#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A"],noteValueWheelcolors:["#FFCDD2","#EF9A9A"],tabsWheelcolors:["#FFCDD2","#EF9A9A"],numberWheelcolors:["#FFCDD2","#EF9A9A"],piemenuBasicundefined:["#388E3C","#4CAF50","#008BA3"],booleanWheelcolors:["#C5CAE9","#9FA8DA"],piemenuVoicesColors:["#00ACC1","#4CAF50","#008BA3","#4CAF50","#008BA3"],intervalNameWheelcolors:["#388E3C","#4CAF50","#388E3C","#008BA3","#4CAF50"],intervalWheelcolors:["#388E3C","#4CAF50","#388E3C","#008BA3","#4CAF50"],modeWheelcolors:["#388E3C","#4CAF50"],modeGroupWheelcolors:["#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#FFCDD2","#EF9A9A","#424242","#424242","#424242","#424242","#424242","#424242"],modePieMenusIfColorPush:"#66BB6A",modePieMenusElseColorPush:"#81C784",wheelcolors:["#757575","#9E9E9E","#757575","#9E9E9E","#616161"]},light:{textColor:"black",blockText:"#282828",dialogueBox:"#fff",strokeColor:"#E2E2E2",fillColor:"#F9F9F9",blueButton:"#0066FF",blueButtonHover:"#023a76",cancelButton:"#f1f1f1",cancelButtonHover:"#afafaf",hoverColor:"#E0E0E0",widgetBackground:"#ccc",widgetButton:"#8cc6ff",widgetButtonSelect:"#C8C8C8",paletteColors:{widgets:["#7CD622","#57AD02","#57AD02","#B4EB7D"],pitch:["#7CD622","#57AD02","#57AD02","#B4EB7D"],rhythm:["#FF8700","#E86B0E","#E86B0E","#FEC092"],meter:["#FE994F","#E86B0E","#E86B0E","#FEC092"],tone:["#3EDCDD","#1DBCBD","#1DBCBD","#A1EEEF"],ornament:["#3EDCDD","#1DBCBD","#1DBCBD","#A1EEEF"],intervals:["#7CD622","#57AD02","#57AD02","#B4EB7D"],volume:["#3EDCDD","#1DBCBD","#1DBCBD","#A1EEEF"],drum:["#3EDCDD","#1DBCBD","#1DBCBD","#A1EEEF"],graphics:["#92A9FF","#5370DC","#5370DC","#CDD8FF"],turtle:["#92A9FF","#5370DC","#5370DC","#CDD8FF"],pen:["#92A9FF","#5370DC","#5370DC","#CDD8FF"],boxes:["#FFB900","#d18600","#d18600","#FFD092"],action:["#F3C800","#DAAF30","#DAAF30","#FFE391"],media:["#FF664B","#EA4326","#EA4326","#FFB9E2"],number:["#FF6EA1","#FF2C76","#FF2C76","#FFCDDF"],boolean:["#D97DF5","#B653D3","#B653D3","#EDC6A3"],flow:["#D98A43","#B7651A","#B7651A","#ECC6A4"],sensors:["#AABB00","#748400","#748400","#FFE391"],extras:["#C4C4C4","#A0A0A0","#A0A0A0","#D0D0D0"],program:["#C4C4C4","#A0A0A0","#A0A0A0","#D0D0D0"],myblocks:["#FFBF00","#DAAF30","#DAAF30","#FFE391"],heap:["#D98A43","#B7651A","#B7651A","#ECC6A4"],dictionary:["#D98A43","#B7651A","#B7651A","#ECC6A4"],ensemble:["#92A9FF","#5370DC","#5370DC","#CDD8FF"]},disconnected:"#C4C4C4",header:"#4DA6FF",aux:"#1A8CFF",sub:"#8CC6FF",doHeaderShadow:!platform.FF,rule:"#E2E2E2",ruleColor:"#E2E2E2",trashColor:"#C0C0C0",trashBorder:"#808080",trashActive:"#FF0000",background:"#F9F9F9",paletteSelected:"#F3F3F3",paletteBackground:"#FFFFFF",paletteLabelBackground:"#8CC6FF",paletteLabelSelected:"#1A8CFF",paletteText:"#666666",rulerHighlight:"#FFBF00",selectorBackground:"#8CC6FF",selectorSelected:"#1A8CFF",labelColor:"#a0a0a0",lyricsLabelBackground:"#FF2B77",lyricsInputBackground:"#FF6EA1",tupletBackground:"#c0c0c0",drumBackground:"#3EDCDD",pitchBackground:"#7CD622",graphicsBackground:"#92A9FF",drumLabelBackground:"#25C3C0",pitchLabelBackground:"#77C428",graphicsLabelBackground:"#728FF9",rhythmcellcolor:"#c8c8c8",stopIconcolor:"#ea174c",hitAreaGraphicsBeginFill:"#FFF",orange:"#e37a00",piemenuBasic:["#3ea4a3","#60bfbc","#1d8989","#60bfbc","#1d8989"],exitWheelcolors:["#808080","#c0c0c0"],exitWheelcolors2:["#808080","#92a9ff","#80a080"],pitchWheelcolors:["#77c428","#93e042","#77c428","#5ba900","#77c428","#93e042","#adfd55"],gridWheelcolors:{wheel:["#ffffff"],selected:{fill:"#dedede",stroke:"#a3a3a3"}},drumWheelcolors:["#1fadae","#3edcdd"],graphicWheelcolors:["#92a9ff","#728ff9"],accidentalsWheelcolors:["#77c428","#93e042","#77c428","#5ba900","#77c428"],accidentalsWheelcolorspush:"#c0c0c0",octavesWheelcolors:["#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#c0c0c0","#c0c0c0","#c0c0c0","#c0c0c0","#c0c0c0","#c0c0c0"],blockLabelsWheelcolors:["#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#ffb2bc","#ffccd6"],noteValueWheelcolors:["#ffb2bc","#ffccd6"],tabsWheelcolors:["#ffb2bc","#ffccd6"],numberWheelcolors:["#ffb2bc","#ffccd6"],piemenuBasicundefined:["#77c428","#93e042","#5ba900"],booleanWheelcolors:["#d3cf76","#b8b45f"],piemenuVoicesColors:["#3ea4a3","#60bfbc","#1d8989","#60bfbc","#1d8989"],intervalNameWheelcolors:["#77c428","#93e042","#77c428","#5ba900","#93e042"],intervalWheelcolors:["#77c428","#93e042","#77c428","#5ba900","#93e042"],modeWheelcolors:["#77c428","#93e042"],modeGroupWheelcolors:["#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#ffb2bc","#ffccd6","#c0c0c0","#c0c0c0","#c0c0c0","#c0c0c0","#c0c0c0","#c0c0c0"],modePieMenusIfColorPush:"#4b8b0e",modePieMenusElseColorPush:"#66a62d",wheelcolors:["#808080","#909090","#808080","#909090","#707070"]}});for(theme in platformThemes){if(themePreference===theme){window.platformColor=platformThemes[theme];break}window.platformColor=platformThemes.light}document.querySelector("meta[name=theme-color]").content=platformColor.header;var showButtonHighlight=function(e,o,c,l,r,F){return platform.FFOS?{}:showMaterialHighlight(e,o,c,l,r,F)};"undefined"!=typeof module&&module.exports&&(module.exports={showButtonHighlight:showButtonHighlight});
function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _regenerator(){var g,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,a,i,s,l,c,u,m,p,t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=n,u=r||[],m=!1,p={p:c=0,n:0,v:g,a:d,f:d.bind(g,4),d:function(e,t){return i=e,s=0,l=g,p.n=t,h}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(m&&1===t&&d(t,n),s=t,l=n;(y=s<2?g:l)||!m;){i||(s?s<3?(1<s&&(p.n=-1),d(s,l)):p.n=l:p.v=l);try{if(c=2,i){if(y=i[e=s?e:"next"]){if(!(y=y.call(i,l)))throw TypeError("iterator result is not an object");if(!y.done)return y;l=y.value,s<2&&(s=0)}else 1===s&&(y=i.return)&&y.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+e+"' method"),s=1);i=g}else if((y=(m=p.n<0)?l:o.call(a,p))!==h)break}catch(e){i=g,s=1,l=e}finally{c=1}}return{value:y,done:m}}),!0),t;function d(e,t){for(s=e,l=t,y=0;!m&&c&&!n&&y<u.length;y++){var n,r=u[y],o=p.p,a=r[2];3<e?(n=a===t)&&(l=r[(s=r[4])?5:s=3],r[4]=r[5]=g):r[0]<=o&&((n=e<2&&o<r[1])?(s=0,p.v=t,p.n=r[1]):o<a&&(n=e<3||r[0]>t||a<t)&&(r[4]=e,r[5]=t,p.n=a,s=0))}if(n||1<e)return h;throw m=!0,t}}var h={};function f(){}function o(){}function a(){}var y=Object.getPrototypeOf,e=[][t]?y(y([][t]())):(_regeneratorDefine2(y={},t,function(){return this}),y),i=a.prototype=f.prototype=Object.create(e);function s(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,n,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,n,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:s}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function _createForOfIteratorHelper(e,t){var n,r,o,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return o=!(r=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){o=!0,n=e},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw n}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function _asyncToGenerator(s){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=s.apply(e,i);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var POLYCOUNT=3,NOISENAMES=[[_("white noise"),"noise1","images/synth.svg","electronic"],[_("brown noise"),"noise2","images/synth.svg","electronic"],[_("pink noise"),"noise3","images/synth.svg","electronic"]],VOICENAMES=[[_("piano"),"piano","images/voices.svg","string"],[_("violin"),"violin","images/voices.svg","string"],[_("viola"),"viola","images/voices.svg","string"],[_("cello"),"cello","images/voices.svg","string"],[_("bass"),"bass","images/voices.svg","string"],[_("double bass"),"double bass","images/voices.svg","string"],[_("sitar"),"sitar","images/synth.svg","string"],[_("harmonium"),"harmonium","images/voices.svg","string"],[_("mandolin"),"mandolin","images/voices.svg","string"],[_("guitar"),"guitar","images/voices.svg","string"],[_("acoustic guitar"),"acoustic guitar","images/voices.svg","string"],[_("flute"),"flute","images/voices.svg","wind"],[_("clarinet"),"clarinet","images/voices.svg","wind"],[_("saxophone"),"saxophone","images/voices.svg","wind"],[_("tuba"),"tuba","images/voices.svg","wind"],[_("trumpet"),"trumpet","images/voices.svg","wind"],[_("oboe"),"oboe","images/voices.svg","wind"],[_("trombone"),"trombone","images/voices.svg","wind"],[_("banjo"),"banjo","images/voices.svg","string"],[_("koto"),"koto","images/voices.svg","string"],[_("dulcimer"),"dulcimer","images/voices.svg","string"],[_("electric guitar"),"electric guitar","images/voices.svg","string"],[_("bassoon"),"bassoon","images/voices.svg","string"],[_("celeste"),"celeste","images/voices.svg","string"],[_("xylophone"),"xylophone","images/8_bellset_key_6.svg","precussion"],[_("electronic synth"),"electronic synth","images/synth.svg","electronic"],[_("sine"),"sine","images/synth.svg","electronic"],[_("square"),"square","images/synth.svg","electronic"],[_("sawtooth"),"sawtooth","images/synth.svg","electronic"],[_("triangle"),"triangle","images/synth.svg","electronic"],[_("custom"),"custom","images/synth.svg","electronic"],[_("vibraphone"),"vibraphone","images/synth.svg","electronic"]],DRUMNAMES=[[_("snare drum"),"snare drum","images/snaredrum.svg","sn","drum"],[_("kick drum"),"kick drum","images/kick.svg","hh","drum"],[_("tom tom"),"tom tom","images/tom.svg","tomml","drum"],[_("floor tom"),"floor tom","images/floortom.svg","tomfl","drum"],[_("bass drum"),"bass drum","images/kick.svg","tomfl","drum"],[_("cup drum"),"cup drum","images/cup.svg","hh","drum"],[_("darbuka drum"),"darbuka drum","images/darbuka.svg","hh","drum"],[_("taiko"),"japanese drum","images/tom.svg","hh","drum"],[_("hi hat"),"hi hat","images/hihat.svg","hh","bell"],[_("ride bell"),"ride bell","images/ridebell.svg","rb","bell"],[_("cow bell"),"cow bell","images/cowbell.svg","cb","bell"],[_("triangle bell"),"triangle bell","images/trianglebell.svg","tri","bell"],[_("finger cymbals"),"finger cymbals","images/fingercymbals.svg","cymca","bell"],[_("chime"),"chime","images/chime.svg","cymca","bell"],[_("gong"),"gong","images/gong.svg","cymca","bell"],[_("clang"),"clang","images/clang.svg","cymca","effect"],[_("crash"),"crash","images/crash.svg","cymca","effect"],[_("bottle"),"bottle","images/bottle.svg","hh","effect"],[_("clap"),"clap","images/clap.svg","hc","effect"],[_("slap"),"slap","images/slap.svg","vibs","effect"],[_("splash"),"splash","images/splash.svg","hh","effect"],[_("bubbles"),"bubbles","images/bubbles.svg","hh","effect"],[_("raindrop"),"raindrop","images/bubbles.svg","hh","effect"],[_("cat"),"cat","images/cat.svg","hh","animal"],[_("cricket"),"cricket","images/cricket.svg","hh","animal"],[_("dog"),"dog","images/dog.svg","hh","animal"],[_("duck"),"duck","images/duck.svg","hh","animal"]],EFFECTSNAMES=["duck","dog","cricket","cat","bubbles","splash","bottle"],SAMPLE_INFO={voice:{piano:{path:"samples/piano",global:"PIANO_SAMPLE"},violin:{path:"samples/violin",global:"VIOLIN_SAMPLE"},viola:{path:"samples/viola",global:"VIOLA_SAMPLE"},"double bass":{path:"samples/doublebass",global:"DOUBLEBASS_SAMPLE"},cello:{path:"samples/cello",global:"CELLO_SAMPLE"},flute:{path:"samples/flute",global:"FLUTE_SAMPLE"},clarinet:{path:"samples/clarinet",global:"CLARINET_SAMPLE"},saxophone:{path:"samples/saxophone",global:"SAXOPHONE_SAMPLE"},trumpet:{path:"samples/trumpet",global:"TRUMPET_SAMPLE"},oboe:{path:"samples/oboe",global:"OBOE_SAMPLE"},trombone:{path:"samples/trombone",global:"TROMBONE_SAMPLE"},tuba:{path:"samples/tuba",global:"TUBA_SAMPLE"},guitar:{path:"samples/guitar",global:"GUITAR_SAMPLE"},"acoustic guitar":{path:"samples/acguit",global:"ACOUSTIC_GUITAR_SAMPLE"},bass:{path:"samples/bass",global:"BASS_SAMPLE"},banjo:{path:"samples/banjo",global:"BANJO_SAMPLE"},koto:{path:"samples/koto",global:"KOTO_SAMPLE"},dulcimer:{path:"samples/dulcimer",global:"DULCIMER_SAMPLE"},"electric guitar":{path:"samples/electricguitar",global:"ELECTRICGUITAR_SAMPLE"},bassoon:{path:"samples/bassoon",global:"BASSOON_SAMPLE"},celeste:{path:"samples/celeste",global:"CELESTE_SAMPLE"},vibraphone:{path:"samples/vibraphone",global:"VIBRAPHONE_SAMPLE"},xylophone:{path:"samples/xylophone",global:"XYLOPHONE_SAMPLE"},sitar:{path:"samples/sitar",global:"SITAR_SAMPLE"},harmonium:{path:"samples/harmonium",global:"HARMONIUM_SAMPLE"},mandolin:{path:"samples/mandolin",global:"MANDOLIN_SAMPLE"}},drum:{bottle:{path:"samples/bottle",global:"BOTTLE_SAMPLE"},clap:{path:"samples/clap",global:"CLAP_SAMPLE"},"darbuka drum":{path:"samples/darbuka",global:"DARBUKA_SAMPLE"},"hi hat":{path:"samples/hihat",global:"HIHAT_SAMPLE"},splash:{path:"samples/splash",global:"SPLASH_SAMPLE"},bubbles:{path:"samples/bubbles",global:"BUBBLES_SAMPLE"},raindrop:{path:"samples/raindrop",global:"RAINDROP_SAMPLE"},"cow bell":{path:"samples/cowbell",global:"COWBELL_SAMPLE"},dog:{path:"samples/dog",global:"DOG_SAMPLE"},"kick drum":{path:"samples/kick",global:"KICK_SAMPLE"},"tom tom":{path:"samples/tom",global:"TOM_SAMPLE"},cat:{path:"samples/cat",global:"CAT_SAMPLE"},crash:{path:"samples/crash",global:"CRASH_SAMPLE"},duck:{path:"samples/duck",global:"DUCK_SAMPLE"},"ride bell":{path:"samples/ridebell",global:"RIDEBELL_SAMPLE"},"triangle bell":{path:"samples/triangle",global:"TRIANGLE_SAMPLE"},chime:{path:"samples/chime",global:"CHIME_SAMPLE"},gong:{path:"samples/gong",global:"GONG_SAMPLE"},cricket:{path:"samples/cricket",global:"CRICKET_SAMPLE"},"finger cymbals":{path:"samples/fingercymbal",global:"FINGERCYMBAL_SAMPLE"},slap:{path:"samples/slap",global:"SLAP_SAMPLE"},"japanese drum":{path:"samples/japanese_drum",global:"JAPANESE_DRUM_SAMPLE"},clang:{path:"samples/clang",global:"CLANG_SAMPLE"},"cup drum":{path:"samples/cup",global:"CUP_SAMPLE"},"floor tom":{path:"samples/floortom",global:"FLOORTOM_SAMPLE"},"bass drum":{path:"samples/bassdrum",global:"BASSDRUM_SAMPLE"},"snare drum":{path:"samples/snare",global:"SNARE_SAMPLE"}}},SOUNDSAMPLESDEFINES=Object.values(SAMPLE_INFO.voice).map(function(e){return e.path}).concat(Object.values(SAMPLE_INFO.drum).map(function(e){return e.path})),DEFAULTSYNTHVOLUME={flute:90,"electronic synth":90,piano:100,viola:20,violin:20,banjo:90,koto:70,"kick drum":100,"tom tom":100,"floor tom":100,"bass drum":100,"cup drum":100,"darbuka drum":100,"hi hat":100,"ride bell":100,"cow bell":100,"triangle bell":60,"finger cymbals":70,chime:90,gong:70,clang:70,crash:90,clap:90,slap:60,vibraphone:100,xylophone:100,"japanese drum":90,sitar:100,harmonium:100,mandolin:100},SAMPLECENTERNO={piano:["C4",39],violin:["C5",51],cello:["C3",27],bass:["C3",27],guitar:["C4",39],"acoustic guitar":["C4",39],flute:["F#5",57],saxophone:["C5",51],clarinet:["C4",39],tuba:["C4",39],trumpet:["C3",27],oboe:["C4",39],trombone:["C3",27],banjo:["C6",63],koto:["C5",51],dulcimer:["C4",39],"electric guitar":["C3",27],bassoon:["D4",41],celeste:["C3",27],vibraphone:["C5",51],xylophone:["C4",39],viola:["D4",53],"double bass":["C4",39],sitar:["C4",39],harmonium:["C4",39]},MULTIPITCH={mandolin:["A4","A5","A6"]},CUSTOMSAMPLES=[],percussionInstruments=["koto","banjo","dulcimer","xylophone","celeste"],stringInstruments=["piano","harmonium","sitar","guitar","acoustic guitar","electric guitar"],validateAndSetParams=function(e,t){if(e&&null!==e&&t&&void 0!==t)for(var n in e)n in t&&void 0!==t[n]&&(e[n]=t[n]);return e},instruments={0:{}},instrumentsSource={},instrumentsEffects={0:{}},instrumentsFilters={0:{}};function Synth(){var C=this,i={sine:1,triangle:1,sawtooth:1,square:1,pluck:1,noise1:1,noise2:1,noise3:1,poly:1,"simple 1":1,"simple 2":1,"simple 3":1,"simple 4":1,custom:1},o={amsynth:1,fmsynth:1,duosynth:1},w=(this.tone=null,Tone.Buffer.onload=function(){console.debug("sample loaded")},this.samples=null,this.samplesuffix="_SAMPLE",this.samplesManifest=null,this.changeInTemperament=!1,this.inTemperament="equal",this.startingPitch="C4",this.noteFrequencies={},this.newTone=function(){C.tone=Tone},this.whichTemperament=function(){return C.inTemperament},this.temperamentChanged=function(e,t){var n,r=t,e=getTemperament(e),o=r.length,a=pitchToNumber(r.substring(0,o-1),r.slice(-1),"C major"),a=numberToPitch(a),a=((r=(a[0]+a[1]).toString()).substring(1,o-1)===FLAT||"b"===r.substring(1,o-1)?r=r.replace(FLAT,"b"):r.substring(1,o-1)!==SHARP&&"#"!==r.substring(1,o-1)||(r=r.replace(SHARP,"#")),Tone.Frequency(r).toFrequency());for(n in C.noteFrequencies=(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(r={},t.substring(0,o-1),[Number(t.slice(-1)),a]),getNoteFromInterval(t,"minor 2")[0],[getNoteFromInterval(t,"minor 2")[1],e["minor 2"]*a]),getNoteFromInterval(t,"augmented 1")[0],[getNoteFromInterval(t,"augmented 1")[1],e["augmented 1"]*a]),getNoteFromInterval(t,"major 2")[0],[getNoteFromInterval(t,"major 2")[1],e["major 2"]*a]),getNoteFromInterval(t,"minor 3")[0],[getNoteFromInterval(t,"minor 3")[1],e["minor 3"]*a]),getNoteFromInterval(t,"augmented 2")[0],[getNoteFromInterval(t,"augmented 2")[1],e["augmented 2"]*a]),getNoteFromInterval(t,"major 3")[0],[getNoteFromInterval(t,"major 3")[1],e["major 3"]*a]),getNoteFromInterval(t,"augmented 3")[0],[getNoteFromInterval(t,"augmented 3")[1],e["augmented 3"]*a]),getNoteFromInterval(t,"diminished 4")[0],[getNoteFromInterval(t,"diminished 4")[1],e["diminished 4"]*a]),getNoteFromInterval(t,"perfect 4")[0],[getNoteFromInterval(t,"perfect 4")[1],e["perfect 4"]*a]),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(r,getNoteFromInterval(t,"augmented 4")[0],[getNoteFromInterval(t,"augmented 4")[1],e["augmented 4"]*a]),getNoteFromInterval(t,"diminished 5")[0],[getNoteFromInterval(t,"diminished 5")[1],e["diminished 5"]*a]),getNoteFromInterval(t,"perfect 5")[0],[getNoteFromInterval(t,"perfect 5")[1],e["perfect 5"]*a]),getNoteFromInterval(t,"augmented 5")[0],[getNoteFromInterval(t,"augmented 5")[1],e["augmented 5"]*a]),getNoteFromInterval(t,"minor 6")[0],[getNoteFromInterval(t,"minor 6")[1],e["minor 6"]*a]),getNoteFromInterval(t,"major 6")[0],[getNoteFromInterval(t,"major 6")[1],e["major 6"]*a]),getNoteFromInterval(t,"augmented 6")[0],[getNoteFromInterval(t,"augmented 6")[1],e["augmented 6"]*a]),getNoteFromInterval(t,"minor 7")[0],[getNoteFromInterval(t,"minor 7")[1],e["minor 7"]*a]),getNoteFromInterval(t,"major 7")[0],[getNoteFromInterval(t,"major 7")[1],e["major 7"]*a]),getNoteFromInterval(t,"augmented 7")[0],[getNoteFromInterval(t,"augmented 7")[1],e["augmented 7"]*a]),_defineProperty(_defineProperty(r,getNoteFromInterval(t,"diminished 8")[0],[getNoteFromInterval(t,"diminished 8")[1],e["diminished 8"]*a]),getNoteFromInterval(t,"perfect 8")[0],[getNoteFromInterval(t,"perfect 8")[1],e["perfect 8"]*a])),C.noteFrequencies){var i=void 0;n.substring(1,n.length)===FLAT||"b"===n.substring(1,n.length)?(i=n.substring(0,1)+"b",C.noteFrequencies[i]=C.noteFrequencies[n],delete C.noteFrequencies[n]):n.substring(1,n.length)!==SHARP&&"#"!==n.substring(1,n.length)||(i=n.substring(0,1)+"#",C.noteFrequencies[i]=C.noteFrequencies[n],delete C.noteFrequencies[n])}C.changeInTemperament=!1},this.getFrequency=function(e,t){return C._getFrequency(e,t)},this._getFrequency=function(e,t,n){if(t&&(void 0===n?C.temperamentChanged(C.inTemperament,C.startingPitch):C.temperamentChanged(n,C.startingPitch)),"equal"===C.inTemperament){var r,o,a;if("string"==typeof e)return r=e.length,o=e.substring(0,r-1),a=Number(e.slice(-1)),pitchToFrequency(o,a,0,"c major");if("number"==typeof e)return e;for(var i=[],s=0;s<e.length;s++)"string"==typeof e[s]?(r=e[s].length,o=e[s].substring(0,r-1),a=Number(e[s].slice(-1)),i.push(pitchToFrequency(o,a,0,"c major"))):i.push(e[s]);return i}function l(e){var t,n,r=e.length;for(t in C.noteFrequencies)if(t===e.substring(0,r-1))return C.noteFrequencies[t][0]===Number(e.slice(-1))?C.noteFrequencies[t][1]:(n=Number(e.slice(-1))-C.noteFrequencies[t][0],C.noteFrequencies[t][1]*Math.pow(2,n))}if("string"==typeof e)return l(e);if("object"!==_typeof(e))return e;for(var c=[],u=0;u<e.length;u++)c.push("string"==typeof e[u]?l(e[u]):e[u]);return c},this.getCustomFrequency=function(e,s){function t(e,t){var n=e.slice(-1),r=(e=getCustomNote(e.substring(0,e.length-1)),pitchToFrequency(t.substring(0,t.length-1),t.slice(-1),0,"C Major"));if("number"!=typeof e){var o,a,i=getTemperament(s);for(o in i)if("pitchNumber"!==o)if(isCustomTemperament(s)&&e===i[o][3]||e===i[o][1])return a=n-i[o][2],Number(i[o][0]*r*Math.pow(getOctaveRatio(),a))}return e}if("string"==typeof e)return t(e,C.startingPitch);if("object"!==_typeof(e))return e;for(var n=[],r=0;r<e.length;r++)n.push("string"==typeof e[r]?t(e[r],C.startingPitch):e[r]);return n},this.resume=function(){null===C.tone&&C.newTone(),C.tone.context.resume()},this.loadSamples=function(){if(null===C.samples){for(var e in C.samples={voice:{},drum:{}},SAMPLE_INFO)for(var t in SAMPLE_INFO[e])C.samples[e][t]=null;C.samples.voice.empty=function(){return null}}},this._loadSample=function(i){return new Promise(function(t,n){var e,r=!1,o=null,a=null;for(e in SAMPLE_INFO)if(SAMPLE_INFO[e][i]){a=SAMPLE_INFO[o=e][i],r=!0;break}!r||null!==C.samples[o][i]?t():require([a.path],function(){try{var e=window[a.global];e?(C.samples[o][i]=e(),t()):(console.error("Global variable ".concat(a.global," not found for sample ").concat(i)),n("Sample global not found: ".concat(i)))}catch(e){console.error("Error processing sample ".concat(i,":"),e),n(e)}})})},this.preloadProjectSamples=(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var n,r,o,a,i,s,l,c,u,m,p,d;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t&&Array.isArray(t)){e.n=1;break}return e.a(2);case 1:n=new Set,r=["settimbre","setinstrument","timbre","instrument"],o=_createForOfIteratorHelper(t),e.p=2,o.s();case 3:if((i=o.n()).done)e.n=6;else{if(a=i.value,!Array.isArray(a)||a.length<2)return e.a(3,5);e.n=4}break;case 4:if(i=a[1],r.includes(i)&&(s=a[4],Array.isArray(s))){l=_createForOfIteratorHelper(s);try{for(l.s();!(c=l.n()).done;)null!==(u=c.value)&&t[u]&&(m=t[u],Array.isArray(m))&&1<m.length&&"string"==typeof(p=m[1])&&(SAMPLE_INFO.voice&&SAMPLE_INFO.voice[p]&&n.add(p),SAMPLE_INFO.drum)&&SAMPLE_INFO.drum[p]&&n.add(p)}catch(e){l.e(e)}finally{l.f()}}"string"==typeof i&&(SAMPLE_INFO.voice&&SAMPLE_INFO.voice[i]&&n.add(i),SAMPLE_INFO.drum)&&SAMPLE_INFO.drum[i]&&n.add(i);case 5:e.n=3;break;case 6:e.n=8;break;case 7:e.p=7,d=e.v,o.e(d);case 8:return e.p=8,o.f(),e.f(8);case 9:if(0<n.size)return console.debug("Preloading ".concat(n.size," instruments:"),Array.from(n)),d=Array.from(n).map(function(t){return C._loadSample(t).catch(function(e){console.warn("Failed to preload sample ".concat(t,":"),e)})}),e.n=10,Promise.all(d);e.n=11;break;case 10:console.debug("Project samples preloaded successfully");case 11:return e.a(2)}},e,null,[[2,7,8,9]])}));return function(e){return t.apply(this,arguments)}})(),this.samplesQueue=[],this.loadSamples(),this.setupRecorder=function(){var e,t=Tone.getContext().createMediaStreamDestination(),r=[],n=t.stream;for(e in platform.FF?C.recorder=new MediaRecorder(n,{type:"audio/wav"}):C.recorder=new MediaRecorder(n,{mimeType:"audio/webm"}),instruments)for(var o in instruments[e])instruments[e][o].connect(t);C.recorder.ondataavailable=function(e){void 0!==e.data&&0!==e.data.size&&r.push(e.data)};C.recorder.onstop=function(){var e,t,n;r.length&&(e=platform.FF?new Blob(r,{type:"audio/wav"}):new Blob(r,{type:"audio/ogg"}),r=[],e=URL.createObjectURL(e),(t=window.prompt("Enter file name","recording"))?(e=e,t=t+(platform.FF?".wav":".ogg"),(n=document.createElement("a")).download=t,n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)):alert("Download cancelled."))}},this.getDefaultParamValues=function(e){var t,n=e.toLowerCase();switch(n=null!==getOscillatorTypes(n)?getOscillatorTypes(n):n){case"amsynth":t={harmonicity:1,detune:0,envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:.001,sustain:1,release:.5}};break;case"fmsynth":t={harmonicity:1,modulationIndex:10,detune:0,envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:.001,sustain:1,release:.5}};break;case"noise1":t={noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:1}};break;case"noise2":t={noise:{type:"brown"},envelope:{attack:.005,decay:.1,sustain:1}};break;case"noise3":t={noise:{type:"pink"},envelope:{attack:.005,decay:.1,sustain:1}};break;case"simple 1":case"simple 2":case"simple 3":case"simple 4":t={oscillator:{type:"sine"},envelope:{attack:.03,decay:.001,sustain:1,release:.03}};break;case"duosynth":t={vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:.001,sustain:1,release:.5},envelope:{attack:.01,decay:.001,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:.001,sustain:1,release:.5},envelope:{attack:.01,decay:.001,sustain:1,release:.5}}};break;case"sine":case"triangle":case"square":case"sawtooth":t={oscillator:{type:n},envelope:{attack:.03,decay:.001,sustain:1,release:.03}};break;case"pluck":t={attackNoise:1,dampening:4e3,resonance:.9};break;case"poly":t={polyphony:POLYCOUNT};break;default:t={}}return t},this.createDefaultSynth=function(e){console.debug("create default poly/default/custom synth for turtle "+e);var t=new Tone.PolySynth(Tone.AMSynth,POLYCOUNT).toDestination();instruments[e]["electronic synth"]=t,instrumentsSource["electronic synth"]=[0,"electronic synth"],instruments[e].custom=t,instrumentsSource.custom=[0,"custom"]},this._createSampleSynth=function(e,t,n){var r,o,a,i,s;if(n in C.samples.voice){instrumentsSource[t]=[2,n];var l={};if(n in SAMPLECENTERNO)l[SAMPLECENTERNO[n][0]]=C.samples.voice[n];else if(n in MULTIPITCH){for(var c=0;c<MULTIPITCH[n].length;c++)l[MULTIPITCH[n][c]]=C.samples.voice[n][c];r=new Tone.Sampler(l)}else l.C4=C.samples.voice[n];r=new Tone.Sampler(l)}else r=n in C.samples.drum?(instrumentsSource[t]=[1,n],new Tone.Player(C.samples.drum[n])):n in CUSTOMSAMPLES?(instrumentsSource[t]=[2,n],o={},a=CUSTOMSAMPLES[n],i=C._parseSampleCenterNo(a[1],a[2]),0!==(s=a[4]||0)&&(C.sampleCentAdjustments||(C.sampleCentAdjustments={}),C.sampleCentAdjustments[n]=s),o[i]=a[0],new Tone.Sampler(o)):(instrumentsSource[t]=[1,"drum"],new Tone.Player(C.samples.drum[DEFAULTDRUM]));return r},this._parseSampleCenterNo=function(e,t){var n={do:0,re:2,mi:4,fa:5,sol:7,la:9,ti:11},r={C:0,D:2,E:4,F:5,G:7,A:9,B:11},o=(o=getArticulation(e))===SHARP?1:o===FLAT?-1:o===DOUBLESHARP?2:o===DOUBLEFLAT?-2:0,a=e.replace(o,""),i=0,n=(a in n?i=n[a]:a in r?i=r[a]:console.debug("Cannot parse "+a),12*t+i+o);return console.log(e+t+" = "+n),n.toString()},this._createBuiltinSynth=function(e,t,n,r){var o,a;switch(n in i&&(o=C.getDefaultParamValues(n),o=validateAndSetParams(o,r)),n){case"simple 1":case"simple 2":case"simple 3":case"simple 4":instrumentsSource[t]=[3,n],a=new Tone.Synth(o);break;case"sine":case"triangle":case"square":case"sawtooth":instrumentsSource[t]=[3,n],a=new Tone.Synth(o);break;case"pluck":instrumentsSource[t]=[3,n],a=new Tone.PluckSynth(o);break;case"poly":instrumentsSource[t]=[0,"poly"],a=new Tone.PolySynth(Tone.AMSynth,o.polyphony);break;case"noise1":case"noise2":case"noise3":instrumentsSource[t]=[4,n],a=new Tone.NoiseSynth(o);break;default:instrumentsSource[t]=[0,"poly"],a=new Tone.PolySynth(Tone.AMSynth,POLYCOUNT)}return a},this._createCustomSynth=function(e,t){var n=C.getDefaultParamValues(e),n=validateAndSetParams(n,t),t="amsynth"===e.toLowerCase()?new Tone.AMSynth(n):"fmsynth"===e.toLowerCase()?new Tone.FMSynth(n):"duosynth"===e.toLowerCase()?new Tone.DuoSynth(n):new Tone.PolySynth(Tone.AMSynth,POLYCOUNT);return t},this.__createSynth=function(e,t,n,r){null===C.samples&&C.loadSamples();var o=null;return n in SAMPLE_INFO.voice?o="voice":n in SAMPLE_INFO.drum&&(o="drum"),!o||null!==C.samples[o][n]?(C.___createSynth(e,t,n,r),Promise.resolve()):C._loadSample(n).then(function(){C.___createSynth(e,t,n,r)}).catch(function(e){console.error("Failed to load ".concat(n,":"),e)})},this.___createSynth=function(e,t,n,r){n in C.samples.voice||n in C.samples.drum?instruments[e][t]||(instruments[e][t]=C._createSampleSynth(e,t,n,r)):n in i?(instruments[e]&&instruments[e][t]&&delete instruments[e][t],instruments[e][t]||(instruments[e][t]=C._createBuiltinSynth(e,t,n,r))):n in o?(instruments[e]&&instruments[e][t]&&delete instruments[e][t],instruments[e][t]||(instruments[e][t]=C._createCustomSynth(n,r)),instrumentsSource[t]=[0,"poly"]):n in CUSTOMSAMPLES?(instruments[e]&&instruments[e][t]&&delete instruments[e][t],instruments[e][t]||(instruments[e][t]=C._createSampleSynth(e,t,n,r))):4<=n.length&&("http"===n.slice(0,4)||"file"===n.slice(0,4)?(instruments[e][n]=new Tone.Sampler(n).toDestination(),instrumentsSource[t]=[1,"drum"]):"drum"===n&&(instruments[e][n]=C._createSampleSynth(e,n,n,null).toDestination(),instrumentsSource[t]=[1,"drum"]))},this.createSynth=function(e,t,n,r){return C.__createSynth(e,t,n,r)},this.loadSynth=(()=>{var n=_asyncToGenerator(_regenerator().m(function e(t,n){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return"customsample_"===n.substring(0,13)?console.debug("loading custom "+n):console.debug("loading "+n),e.n=1,C.createSynth(t,n,n,null);case 1:if(C.setVolume(t,n,last(Singer.masterVolume)),n in instruments[t])return e.a(2,instruments[t][n].toDestination());e.n=2;break;case 2:return e.a(2,null)}},e)}));return function(e,t){return n.apply(this,arguments)}})(),this._performNotes=(()=>{var s=_asyncToGenerator(_regenerator().m(function e(n,t,r,o,a,i,s){var l,c,u,m,p,d,g,h,f,y,b,v,_,S,T,A,E,w,P,F;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if("equal"===C.inTemperament||isCustomTemperament(C.inTemperament)||"number"!=typeof t&&(l=t,void 0===(t=C._getFrequency(t,C.changeInTemperament)))&&(t=l.substring(1,l.length-1)==DOUBLEFLAT?l.substring(0,1)+"bb"+l.substring(l.length-1,l.length):l.substring(1,l.length-1)===DOUBLESHARP?l.substring(0,1)+"x"+l.substring(l.length-1,l.length):l),!isCustomTemperament(C.inTemperament)||void 0!==(t=-1===(l=t).search("[+]")&&-1===t.search("[-]")?t:C.getCustomFrequency(t,C.inTemperament))&&"undefined"!==t||(t=l),u=[],m=[],e.p=1,null===o&&null===a)return e.p=2,e.n=3,Tone.ToneAudioBuffer.loaded();e.n=6;break;case 3:n.triggerAttackRelease(t,r,Tone.now()+s),e.n=5;break;case 4:e.p=4,w=e.v,console.debug("Error triggering note:",w);case 5:e.n=11;break;case 6:if(null!=a)for(c=a.length,p=0;p<c;p++)d=new Tone.Filter(a[p].filterFrequency,a[p].filterType,a[p].filterRolloff),u.push(d),n.chain(u[p],Tone.Destination);if((P=w=null)!=o){if(o.doVibrato&&(h=new Tone.Vibrato(1/o.vibratoFrequency,o.vibratoIntensity),n.chain(h,Tone.Destination),m.push(h)),o.doDistortion&&(h=new Tone.Distortion(o.distortionAmount).toDestination(),n.connect(h,Tone.Destination),m.push(h)),o.doTremolo&&(g=new Tone.Tremolo({frequency:o.tremoloFrequency,depth:o.tremoloDepth}).toDestination().start(),n.chain(g),m.push(g)),o.doPhaser&&(g=new Tone.Phaser({frequency:o.rate,octaves:o.octaves,baseFrequency:o.baseFrequency}).toDestination(),n.chain(g,Tone.Destination),m.push(g)),o.doChorus&&(w=new Tone.Chorus({frequency:o.chorusRate,delayTime:o.delayTime,depth:o.chorusDepth}).toDestination(),n.chain(w,Tone.Destination),m.push(w)),o.doPartials)if(void 0!==n.oscillator)n.oscillator.partials=o.partials;else if(void 0!==n.voices)for(f=0;f<n.voices.length;f++)n.voices[f].oscillator.partials=o.partials;if(o.doPortamento)if(void 0!==n.oscillator)n.portamento=o.portamento;else if(void 0!==n.voices)for(y=0;y<n.voices.length;y++)n.voices[y].portamento=o.portamento;if(o.doNeighbor){for(b=o.neighborArgBeat,v=o.neighborArgCurrentBeat,_=[],S=0;S<o.neighborArgNote1.length;S++)T=o.neighborArgNote1[S].replace("♯","#").replace("♭","b"),A=o.neighborArgNote2[S].replace("♯","#").replace("♭","b"),_.push({time:0,note:T,duration:b},{time:b,note:A,duration:b},{time:2*b,note:T,duration:v});P=new Tone.Part(function(e,t){n.triggerAttackRelease(t.note,t.duration,e)},_).start(),m.push(P)}}if(o.doNeighbor)e.n=10;else if(void 0!==i&&i){if(void 0!==n.oscillator)n.setNote(t);else if(void 0!==n.voices)for(E=0;E<n.voices.length;E++)n.voices[E].setNote(t);e.n=10}else e.n=7;break;case 7:return e.p=7,e.n=8,Tone.ToneAudioBuffer.loaded();case 8:n.triggerAttackRelease(t,r,Tone.now()+s),e.n=10;break;case 9:e.p=9,P=e.v,console.debug("Error triggering note:",P);case 10:setTimeout(function(){try{m.forEach(function(e){e&&"function"==typeof e.dispose&&e.dispose()}),0<u.length&&u.forEach(function(e){e&&"function"==typeof e.dispose&&e.dispose()})}catch(e){console.debug("Error disposing effects:",e)}},1e3*r);case 11:e.n=13;break;case 12:e.p=12,F=e.v,console.error("Error in _performNotes:",F),m.forEach(function(e){e&&"function"==typeof e.dispose&&e.dispose()}),u.forEach(function(e){e&&"function"==typeof e.dispose&&e.dispose()});case 13:return e.a(2)}},e,null,[[7,9],[2,4],[1,12]])}));return function(e,t,n,r,o,a,i){return s.apply(this,arguments)}})(),this.trigger=(()=>{var l=_asyncToGenerator(_regenerator().m(function e(t,n,r,o,a,i,s,l){var c,u,m,p,d;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if("running"!==Tone.context.state&&(Tone.start().catch(function(e){console.warn("Audio start failed:",e)}),setTimeout(function(){"running"===Tone.context.state||window.hasShownAudioWarning||(window.hasShownAudioWarning=!0,alert("⚠️ Sound is disabled!\n\nPlease check your browser settings (Site Settings > Sound) to allow audio for Music Blocks."))},2e3)),e.p=1,"running"!==Tone.context.state)return e.n=2,Tone.start();e.n=2;break;case 2:if(["sine","sawtooth","triangle","square"].includes(o)?a=null:null!=a&&(0!==a.vibratoIntensity&&(a.doVibrato=!0),0!==a.distortionAmount&&(a.doDistortion=!0),0!==a.tremoloFrequency&&(a.doTremolo=!0),0!==a.rate&&(a.doPhaser=!0),0!==a.chorusRate&&(a.doChorus=!0),a.neighborSynth)&&(a.doNeighbor=!0),c=n,u=instruments[t]["electronic synth"],m=0,o in instruments[t]&&(u=instruments[t][o],1!==(m=instrumentsSource[o][0])&&2!==m||(p=instrumentsSource[o][1],2===m&&C.sampleCentAdjustments&&C.sampleCentAdjustments[p]&&(p=C.sampleCentAdjustments[p],p=Math.pow(2,p/1200),u)&&u.playbackRate&&(u.playbackRate.value=p))),void 0===l&&(l=0),u){e.n=4;break}return console.warn("Synth not initialized, creating default synth"),C.createDefaultSynth(t),e.n=3,C.loadSynth(t,o);case 3:u=instruments[t][o];case 4:p=m,e.n=1===p?5:2===p?6:3===p?8:4===p?10:11;break;case 5:if("http"===o.slice(0,4)||"data:audio/wav;base64"===o.slice(0,21))u.start(Tone.now()+l);else if("file"===o.slice(0,4))u.start(Tone.now()+l);else try{u.start(Tone.now()+l)}catch(e){console.debug("Error starting drum synth:",e)}return e.a(3,13);case 6:return e.n=7,C._performNotes(u.toDestination(),n,r,a,i,s,l);case 7:return e.a(3,13);case 8:return"object"===_typeof(n)&&(c=n[0]),e.n=9,C._performNotes(u.toDestination(),c,r,a,i,s,l);case 9:return e.a(3,13);case 10:return u.triggerAttackRelease("c2",r,Tone.now()+l),e.a(3,13);case 11:return e.n=12,C._performNotes(u.toDestination(),c,r,a,i,s,l);case 12:return e.a(3,13);case 13:e.n=15;break;case 14:e.p=14,d=e.v,console.error("Error in trigger:",d);case 15:return e.a(2)}},e,null,[[1,14]])}));return function(e,t,n,r,o,a,i,s){return l.apply(this,arguments)}})(),this.startSound=function(e,t,n){1===instrumentsSource[t][0]?instruments[e][t].start():instruments[e][t].triggerAttack(n)},this.stopSound=function(e,t,n){1===instrumentsSource[t][0]?instruments[e][t].stop():null==n?instruments[e][t].triggerRelease():instruments[e][t].triggerRelease(n)},this.loop=function(t,n,r,o,e,a,i){var s=instruments[t][n],l=instrumentsSource[n][0],c=Tone.now();return new Tone.Loop(function(e){1==l?(C.setVolume(t,n,100*i),instruments[t][n].start()):s.triggerAttackRelease(r,o,c+e,i)},60/a).start(e)},this.start=function(){Tone.Transport.start()},this.stop=function(){Tone.Transport.stop()},this.rampTo=function(e,t,n,r,o){var a,i;percussionInstruments.includes(t)||stringInstruments.includes(t)||(a=t in DEFAULTSYNTHVOLUME?(a=DEFAULTSYNTHVOLUME[t],50<r?(r-50)/50*(100-a)+a:r/50*a):r,a=Tone.gainToDb(a/100),i=instruments[e]["electronic synth"],t in instruments[e]&&(i=instruments[e][t]),console.debug("Crescendo(decibels)",t,":",i.volume.value,"to",a,"t:",o),console.debug("Crescendo",t,":",n,"to",r,"t:",o),i.volume.linearRampToValueAtTime(a,Tone.now()+o))},this.getVolume=function(e,t){return instruments[e]&&instruments[e][t]?instruments[e][t].volume.value:(console.debug("instrument not found"),50)},this.setVolume=function(e,t,n){r=t in DEFAULTSYNTHVOLUME?(r=DEFAULTSYNTHVOLUME[t],50<n?(n-50)/50*(100-r)+r:n/50*r):n;var r,n=Tone.gainToDb(r/100);t in instruments[e]&&(instruments[e][t].volume.value=n)},this.setMasterVolume=function(e,t,n){instruments[0]["electronic synth"]||C.createDefaultSynth(0),null===t&&null===n?(Tone.Destination.volume.rampTo(0,.01),C.setVolume(0,"electronic synth",e),setTimeout(function(){C.trigger(0,"G4",.25,"electronic synth",null,null,!1)},200)):(t=Tone.gainToDb(e/100),Tone.Destination.volume.rampTo(t,.01))},this.startRecording=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Tone.start();case 1:return C.mic=new Tone.UserMedia,C.recorder=new Tone.Recorder,e.n=2,C.mic.open().then(function(){console.log("Mic opened"),C.mic.connect(C.recorder),C.recorder.start()}).catch(function(e){console.log(e)});case 2:return e.a(2)}},e)})),this.stopRecording=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,C.recorder.stop();case 1:return C.recording=e.v,C.mic.close(),C.audioURL=URL.createObjectURL(C.recording),e.a(2,C.audioURL)}},e)})),this.playRecording=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return C.player=(new Tone.Player).toDestination(),e.n=1,C.player.load(C.audioURL);case 1:C.player.start();case 2:return e.a(2)}},e)})),this.stopPlayBackRecording=function(){C.player.stop()},this.LiveWaveForm=function(){C.analyser=new Tone.Analyser("waveform",8192),C.mic.connect(C.analyser)},this.getWaveFormValues=function(){return C.analyser.getValue()},this.startTuner=_asyncToGenerator(_regenerator().m(function e(){var t,n,_,S,T,A,E;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(window.activity||(window.activity={blocks:{blockList:[],setPitchOctave:function(){},findPitchOctave:function(){return 4},stageClick:!1},logo:{synth:C},canvas:document.createElement("canvas"),blocksContainer:{x:0,y:0},getStageScale:function(){return 1},KeySignatureEnv:["A","major",!1]}),"function"!=typeof wheelnav)return console.warn("Wheelnav library not found, attempting to load it"),(t=document.createElement("script")).src="lib/wheelnav/wheelnav.min.js",document.head.appendChild(t),e.n=1,new Promise(function(e){t.onload=e});e.n=1;break;case 1:if("function"!=typeof Raphael)return console.warn("Raphael library not found, attempting to load it"),(n=document.createElement("script")).src="lib/raphael.min.js",document.head.appendChild(n),e.n=2,new Promise(function(e){n.onload=e});e.n=2;break;case 2:return e.n=3,Tone.start();case 3:if(instruments[0]||(instruments[0]={}),instruments[0]["electronic synth"]){e.n=5;break}return C.createDefaultSynth(0),e.n=4,C.loadSynth(0,"electronic synth");case 4:C.setVolume(0,"electronic synth",50);case 5:return C.tunerMic&&C.tunerMic.close(),e.n=6,Tone.start();case 6:return C.tunerMic=new Tone.UserMedia,e.n=7,C.tunerMic.open();case 7:_=new Tone.Analyser("waveform",2048),C.tunerMic.connect(_),S=function(s){var l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1;return function(e){e=function(e){var r=2*Math.PI*(1<arguments.length&&void 0!==arguments[1]?arguments[1]:500)/s;return e.map(function(e,t,n){return 0<t?r*e+(1-r)*n[t-1]:e})}(e,300);var o,n,r,t,a,e=(n=(o=e).map(function(e,r){return o.slice(0,o.length-r).reduce(function(e,t,n){return e+t*o[n+r]},0)})).map(function(e,t){return n[0]+n[t]-2*n[t]}),e=(r=0,e.map(function(e,t){return r+=e,0===t?1:e/(r/t)})),i=(e=>{for(var t=2;t<e.length;t++)if(e[t]<l){for(;t+1<e.length&&e[t+1]<e[t];)t++;return t}return-1})(e);return-1===i?-1:(t=(i=i)<1?i:i-1,a=i+1<(e=e).length?i+1:i,t=t===i?e[i]<=e[a]?i:a:a===i?e[i]<=e[t]?i:t:i+(a-t)*((t=e[t])-(a=e[a]))/(2*(t-2*e[i]+a)),s/t)}}(Tone.context.sampleRate),T="chromatic",A={note:"A4",frequency:440},(E=function(){var a,e,d,t,n,r,o,i,s,l,c,u,m,p,g,h,f,y,b,v=_.getValue(),v=S(v);0<v&&(l=w(v),"chromatic"===T?(e=l.note,a=l.cents):(e=l.note,console.log("Debug values:",{detectedPitch:v,targetNote:A.note,targetFrequency:A.frequency,currentNote:e}),0<v&&0<A.frequency?(l=1200*Math.log2(v/A.frequency),c=Math.round(l/100),u=Math.floor(Math.abs(c)/12),c=Math.abs(c)%12,100<=Math.abs(l)?(s=0<l?"+":"-",a=Math.round(l),s=s,0<u&&(s+=u+" octave"+(1<u?"s":""),0<c)&&(s+=" "),0<c&&(s+=c+" semitone"+(1<c?"s":"")),C.displayText=s):(a=Math.round(l),C.displayText="".concat(0<a?"+":"").concat(a," cents"))):(a=0,C.displayText="0 cents")),console.log({frequency:v.toFixed(1),detectedNote:e,centsDeviation:a,mode:T}),u=document.getElementById("noteDisplayContainer"),c=document.getElementById("tunerContainer"),!u&&c&&((u=document.createElement("div")).id="noteDisplayContainer",u.style.position="absolute",u.style.top="62%",u.style.left="50%",u.style.transform="translate(-50%, -50%)",u.style.textAlign="center",u.style.fontFamily="Arial, sans-serif",u.style.zIndex="1000",(d=document.createElement("div")).id="targetNoteSelector",d.style.position="absolute",d.style.top="-40px",d.style.left="50%",d.style.transform="translateX(-50%)",d.style.color="#666666",d.style.fontSize="24px",d.style.cursor="pointer",d.style.transition="opacity 0.2s ease",d.style.opacity="0.7",d.textContent=A.note,d.addEventListener("mouseenter",function(){d.style.opacity="1"}),d.addEventListener("mouseleave",function(){d.style.opacity="0.7"}),(s=docById("wheelDiv"))||((s=document.createElement("div")).id="wheelDiv",s.style.position="absolute",s.style.display="none",s.style.zIndex="1500",document.body.appendChild(s)),d.addEventListener("click",function(){if("target"===T){var n=["ti","la","sol","fa","mi","re","do"],r=["B","A","G","F","E","D","C"],e=A.note[0],t=1<A.note.length?A.note.substring(1):"♮",o=n[r.indexOf(e)];""===t&&(t="♮");try{var a,i=_defineProperty(_defineProperty(_defineProperty(_defineProperty({container:{x:d.offsetLeft,y:d.offsetTop},activity:window.activity,blocks:{blockList:[{name:"pitch",connections:[null,null],value:A.note,container:{x:d.offsetLeft,y:d.offsetTop}}],stageClick:!1,setPitchOctave:function(){},findPitchOctave:function(){return 4},turtles:{_canvas:{width:window.innerWidth,height:window.innerHeight},ithTurtle:function(e){return{singer:{instrumentNames:["default"]}}}}},connections:[0],value:A.note,text:{text:A.note},updateCache:function(){},_exitWheel:null,_pitchWheel:null,_accidentalsWheel:null,_octavesWheel:null,piemenuOKtoLaunch:function(){return!0},_piemenuExitTime:0},"container",{x:d.offsetLeft,y:d.offsetTop,setChildIndex:function(){}}),"prevAccidental","♮"),"name","pitch"),"_triggerLock",!1),s=(window.activity.logo||(window.activity.logo={synth:{createDefaultSynth:function(){},loadSynth:function(){},setMasterVolume:function(){},trigger:function(e,t,n,r){var o=new(window.AudioContext||window.webkitAudioContext),a=o.createOscillator(),i=o.createGain(),t=(a.connect(i),i.connect(o.destination),pitchToFrequency(t[0],"equal"));a.frequency.value=t,i.gain.value=.1,a.start(),i.gain.setValueAtTime(.1,o.currentTime),i.gain.linearRampToValueAtTime(0,o.currentTime+n),a.stop(o.currentTime+n)},inTemperament:"equal"},errorMsg:function(e){console.warn(e)}}),window.activity.KeySignatureEnv=["C","major",!1],docById("wheelDiv")),l=(s&&(a=d.getBoundingClientRect(),s.style.position="absolute",s.style.left=a.left-250+"px",s.style.top=a.top-250+"px",s.style.width="600px",s.style.height="600px",s.style.zIndex="1500",s.style.backgroundColor="transparent",s.style.display="block"),piemenuPitches(i,n,r,["𝄪","♯","♮","♭","𝄫"],o,t),{note:e,accidental:t,octave:4});if(i._pitchWheel&&i._pitchWheel.navItems)for(var c=0;c<i._pitchWheel.navItems.length;c++)(t=>{i._pitchWheel.navItems[t].navigateFunction=function(){var e=i._pitchWheel.navItems[t].title;e&&n.includes(e)&&(e=n.indexOf(e),l.note=r[e],p())}})(c);if(i._accidentalsWheel&&i._accidentalsWheel.navItems)for(var u=0;u<i._accidentalsWheel.navItems.length;u++)(e=>{i._accidentalsWheel.navItems[e].navigateFunction=function(){l.accidental=i._accidentalsWheel.navItems[e].title,p()}})(u);if(i._octavesWheel&&i._octavesWheel.navItems)for(var m=0;m<i._octavesWheel.navItems.length;m++)(t=>{i._octavesWheel.navItems[t].navigateFunction=function(){var e=i._octavesWheel.navItems[t].title;e&&!isNaN(e)&&(l.octave=parseInt(e),p())}})(m);var p=function(){if(l.note){var e=l.note,e=("♯"===l.accidental?e+="#":"♭"===l.accidental?e+="b":"𝄪"===l.accidental?e+="##":"𝄫"===l.accidental&&(e+="bb"),e+l.octave);A.note=e;try{var t=e.match(/([A-G][#b]?)(\d+)/);if(!t)throw new Error("Invalid note format");var n=_slicedToArray(t,3),r=n[1],o=n[2],a={C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88}[r.replace("b","#").replace("bb","##")];if(!a)throw new Error("Invalid note");var i=parseInt(o)-4;a*=Math.pow(2,i),A.frequency=a,console.log("Target pitch updated:",{note:e,frequency:A.frequency}),(isNaN(A.frequency)||A.frequency<=0)&&(console.error("Invalid frequency calculated:",A.frequency),A.frequency=440)}catch(e){console.error("Error calculating frequency:",e),A.frequency=440}d.textContent=e}};i._exitWheel&&i._exitWheel.navItems&&(i._exitWheel.navItems[0].navigateFunction=function(){i._pitchWheel&&i._pitchWheel.removeWheel(),i._accidentalsWheel&&i._accidentalsWheel.removeWheel(),i._octavesWheel&&i._octavesWheel.removeWheel(),i._exitWheel&&i._exitWheel.removeWheel(),s.style.display="none"})}catch(e){console.error("Error opening pie menu:",e)}}}),u.appendChild(d),(l=document.createElement("div")).id="modeToggle",l.style.position="absolute",l.style.top="30px",l.style.left="50%",l.style.transform="translateX(-50%)",l.style.display="flex",l.style.backgroundColor="#FFFFFF",l.style.borderRadius="25px",l.style.padding="3px",l.style.boxShadow="0 2px 8px rgba(0,0,0,0.1)",l.style.width="120px",l.style.height="44px",l.style.cursor="pointer",(t=document.createElement("div")).style.flex="1",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.borderRadius="22px",t.style.cursor="pointer",t.style.transition="all 0.2s ease",t.style.userSelect="none",t.title="Chromatic",(n=document.createElement("div")).style.flex="1",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.borderRadius="22px",n.style.cursor="pointer",n.style.transition="all 0.2s ease",n.style.userSelect="none",n.title="Target pitch",(v=document.createElement("img")).src="header-icons/chromatic-mode.svg",v.style.width="32px",v.style.height="32px",v.style.filter="brightness(0)",v.style.pointerEvents="none",(s=document.createElement("img")).src="header-icons/target-pitch-mode.svg",s.style.width="32px",s.style.height="32px",s.style.filter="brightness(0)",s.style.pointerEvents="none",r=function(){"chromatic"===T?(t.style.backgroundColor="#A6CEFF",n.style.backgroundColor="#FFFFFF"):(t.style.backgroundColor="#FFFFFF",n.style.backgroundColor="#A6CEFF")},o=!0,i=function(e){o&&(o=!1,T=e,r(),setTimeout(function(){o=!0},200))},t.onclick=function(){return i("chromatic")},n.onclick=function(){return i("target")},t.appendChild(v),n.appendChild(s),l.appendChild(t),l.appendChild(n),r(),c.appendChild(l),(v=document.createElement("div")).id="noteText",v.style.fontSize="64px",v.style.fontWeight="bold",v.style.marginBottom="5px",(s=document.createElement("div")).id="centsText",s.style.fontSize="14px",s.style.color="#666666",s.style.marginBottom="5px",(l=document.createElement("div")).id="tuneDirection",l.style.fontSize="18px",l.style.color="#FF4500",u.appendChild(v),u.appendChild(s),u.appendChild(l),c.appendChild(u)),u&&(v=document.getElementById("noteText"),s=document.getElementById("centsText"),l=document.getElementById("tuneDirection"),c=document.getElementById("targetNoteSelector"),v&&(v.textContent=e),s&&(s.textContent=C.displayText||("target"===T?"0 cents":"".concat(0<a?"+":"").concat(Math.round(a)," cents"))),c&&(c.style.display="target"===T?"block":"none",c.textContent=A.note),l)&&(l.textContent="",l.style.color=Math.abs(a)<=5?"#00FF00":"#FF4500"),u=document.querySelectorAll("#tunerContainer svg path"),m="#FF0000",p="#FF4500",g="#FFA500",h="#FFB833",f="#9ACD32",y="#00FF00",b="#D3D3D3",u.forEach(function(e,t){var n=10*(t-5),r=b;if("chromatic"===T){Math.abs(a);if((a<0?n<=0&&Math.abs(n)<=Math.abs(a):0<=n&&n<=a)||Math.abs(a-n)<=5)if(5===t)r=Math.abs(a)<=5?y:b;else if(t<5)switch(t){case 0:r=m;break;case 1:r=p;break;case 2:r=g;break;case 3:r=h;break;case 4:r=f}else switch(t){case 6:r=f;break;case 7:r=h;break;case 8:r=g;break;case 9:r=p;break;case 10:r=m}}else{var o=a;if(50<Math.abs(o))o<0?0===t&&(r=m):10===t&&(r=m);else if((o<0?n<=0&&Math.abs(n)<=Math.abs(o):0<=n&&n<=o)||Math.abs(o-n)<=5)if(5===t)r=Math.abs(o)<=5?y:b;else if(t<5)switch(t){case 0:r=m;break;case 1:r=p;break;case 2:r=g;break;case 3:r=h;break;case 4:r=f}else switch(t){case 6:r=f;break;case 7:r=h;break;case 8:r=g;break;case 9:r=p;break;case 10:r=m}}e.style.transition="fill 0.1s ease-in-out",e.setAttribute("fill",r)})),requestAnimationFrame(E)})();case 8:return e.a(2)}},e)})),this.stopTuner=function(){C.tunerMic&&C.tunerMic.close()},function(e){var t,n;return e<=0?{note:"---",cents:0}:(e=69+12*Math.log2(e/440),n=Math.round(e),50<(e=Math.round(100*(e-n)))?n++:e<-50&&n--,t=(n%12+12)%12,n=Math.floor((n-12)/12),{note:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t]+n,cents:e})});return this.getTunerFrequency=function(){return C.tunerAnalyser&&C.tunerAnalyser.getValue(),440},this.testTuner=function(){var t,n,e,r,o,a;window.AudioContext?(t=new AudioContext,n=t.createOscillator(),e=t.createGain(),n.connect(e),e.connect(t.destination),e.gain.value=.1,r=[{freq:440,expected:"A4"},{freq:442,expected:"A4"},{freq:438,expected:"A4"},{freq:261.63,expected:"C4"},{freq:329.63,expected:"E4"}],o=0,a=function(){var e;o>=r.length?(n.stop(),console.log("Tuner tests completed")):(e=r[o],console.log("Testing frequency: ".concat(e.freq,"Hz (Expected: ").concat(e.expected,")")),n.frequency.setValueAtTime(e.freq,t.currentTime),o++,setTimeout(a,2e3))},n.start(),a()):console.error("Web Audio API not supported")},this.testSpecificFrequency=function(e){var t,n,r;window.AudioContext?(t=new AudioContext,n=t.createOscillator(),r=t.createGain(),n.connect(r),r.connect(t.destination),r.gain.value=.1,n.frequency.setValueAtTime(e,t.currentTime),n.start(),console.log("Testing frequency: ".concat(e,"Hz")),setTimeout(function(){n.stop(),console.log("Test completed")},3e3)):console.error("Web Audio API not supported")},this.createCentsSlider=function(){var t=this,e=this.widgetWindow.getWidgetBody(),n=(this.previousContent=e.innerHTML,e.innerHTML="",document.createElement("div")),r=(Object.assign(n.style,{width:"100%",height:"100%",backgroundColor:"#A6CEFF",display:"flex",flexDirection:"column"}),document.createElement("div")),o=(Object.assign(r.style,{width:"100%",padding:"15px",display:"flex",justifyContent:"space-between",alignItems:"center",boxSizing:"border-box"}),document.createElement("div")),a=(o.textContent=_("Cents Adjustment"),Object.assign(o.style,{fontWeight:"bold",fontSize:"16px"}),document.createElement("div")),o=(a.textContent=(0<=this.centsValue?"+":"")+(this.centsValue||0)+"¢",Object.assign(a.style,{fontSize:"16px"}),r.appendChild(o),r.appendChild(a),n.appendChild(r),document.createElement("div")),r=(Object.assign(o.style,{flex:1,backgroundColor:"#E8E8E8",padding:"20px",display:"flex",flexDirection:"column",gap:"10px"}),document.createElement("div")),r=(r.textContent=_("reference tone"),Object.assign(r.style,{fontSize:"14px",color:"#666666"}),o.appendChild(r),document.createElement("div")),i=(Object.assign(r.style,{width:"100%",padding:"10px 0"}),document.createElement("input")),r=(Object.assign(i,{type:"range",min:-50,max:50,value:this.centsValue||0,step:1}),Object.assign(i.style,{width:"100%",height:"20px",margin:"10px 0",backgroundColor:"#4CAF50",borderRadius:"10px",appearance:"none",outline:"none"}),r.appendChild(i),o.appendChild(r),document.createElement("div"));r.textContent=_("sample"),Object.assign(r.style,{fontSize:"14px",color:"#666666",marginTop:"auto"}),o.appendChild(r),n.appendChild(o),e.appendChild(n),i.oninput=function(){var e=parseInt(i.value);a.textContent=(0<=e?"+":"")+e+"¢",t.centsValue=e,t.tunerDisplay&&(e=TunerUtils.frequencyToPitch(t._calculateFrequency()),t.tunerDisplay.update(e[0],t.centsValue,e[2])),t.applyCentsAdjustment()},this.sliderDiv=n,this.sliderVisible=!0,this.centsSliderBtn.getElementsByTagName("img")[0].style.filter="brightness(0) invert(1)",this.centsSliderBtn.style.backgroundColor=platformColor.selectorSelected},this.removeCentsSlider=function(){this.sliderDiv&&this.sliderDiv.parentNode&&(this.widgetWindow.getWidgetBody().innerHTML=this.previousContent,this.previousContent=null),this.sliderVisible=!1,this.centsSliderBtn.getElementsByTagName("img")[0].style.filter="",this.centsSliderBtn.style.backgroundColor=""},this.tone=null,this.noteFrequencies={},this.startingPitch="C4",this.startingPitchOctave=4,this.octaveTranspose=0,this.inTemperament="equal",this.changeInTemperament="equal",this.inTransposition=0,this.transposition=2,this.playbackRate=1,this.defaultBPMFactor=1,this.recorder=null,this.samples=null,this.samplesManifest=null,this.sampleCentAdjustments={},this.mic=null,this}
function _createForOfIteratorHelper(e,t){var r,o,n,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return n=!(o=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){n=!0,r=e},f:function(){try{o||null==i.return||i.return()}finally{if(n)throw r}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _construct(e,t,r){var o;return _isNativeReflectConstruct()?Reflect.construct.apply(null,arguments):((o=[null]).push.apply(o,t),t=new(e.bind.apply(e,o)),r&&_setPrototypeOf(t,r.prototype),t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var changeImage=function(e,t,r){t="data:image/svg+xml;base64,"+window.btoa(base64Encode(t)),r="data:image/svg+xml;base64,"+window.btoa(base64Encode(r));e.src===t&&(e.src=r)};function _(t){var e,r,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!t)return"";try{for(var n=t,a=0,i=[",","(",")","?","¿","<",">",".","\n",'"',":","%s","%d","/","'",";","×","!","¡"];a<i.length;a++)var l=i[a],n=n.split(l).join("");var c;return(i18next.language.startsWith("ja")?(c="kana"===(localStorage.getItem("kanaPreference")||"kanji")?"kana":"kanji",e=t,(r=i18next.t(e,_objectSpread(_objectSpread({},o),{},{ns:void 0,returnObjects:!0})))&&"object"===_typeof(r)?r[c]||e:"string"==typeof r?r:e):i18next.t(t,o))||t}catch(e){return t}}var format=function(o,n){return(o=o.replace(/{([a-zA-Z0-9.]*)}/g,function(e,t){var r=n;return t.split(".").forEach(function(e){void 0===r&&console.debug("Undefined value in template string",o,t,r,e),r=r[e]}),void 0===r?"":r})).replace(/{_([a-zA-Z0-9]+)}/g,function(e,t){return _(t)})};function fnBrowserDetect(){var e=navigator.userAgent,e=e.match(/chrome|chromium|crios/i)?"chrome":e.match(/firefox|fxios/i)?"firefox":e.match(/safari/i)?"safari":e.match(/opr\//i)?"opera":e.match(/edg/i)?"edge":"No browser detection";return e}function canvasPixelRatio(){var e=window.devicePixelRatio||1,t=document.querySelector("#myCanvas").getContext("2d");return e/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function windowHeight(){return/Android/i.test(navigator.userAgent)?window.outerHeight:window.innerHeight}function windowWidth(){return/Android/i.test(navigator.userAgent)?window.outerWidth:window.innerWidth}var httpGet=function(e){var t=null,t=new XMLHttpRequest;if(null===e?t.open("GET",window.server,!1):t.open("GET",window.server+e,!1),t.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7"),t.send(),299<t.status)throw"Error from server";return t.responseText},httpPost=function(e,t){var r=null;return(r=new XMLHttpRequest).open("POST",window.server+e,!1),r.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7"),r.send(t),r.responseText};function HttpRequest(t,e,r){var o=this.request=new XMLHttpRequest,n=(this.handler=e,this.url=t,this.localmode=Boolean(0===self.location.href.search(/^file:/i)),this.userCallback=r,this);try{o.open("GET",t),o.onreadystatechange=function(){n.handler()},o.send("")}catch(e){self.console&&(console.debug("Failed to load resource from "+t+": Network error."),console.debug(e)),"function"==typeof r&&r(!1,"network error"),this.request=this.handler=this.userCallback=null}}function doBrowserCheck(){jQuery.uaMatch=function(e){e=e.toLowerCase();e=/(chrome)[ /]([\w.]+)/.exec(e)||/(webkit)[ /]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ /]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:e[1]||"",version:e[2]||"0"}};var e=jQuery.uaMatch(navigator.userAgent),t={};e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),jQuery.browser=t}function docByClass(e){return document.getElementsByClassName(e)}function docByTagName(e){return document.getElementsByTagName(e)}function docById(e){return document.getElementById(e)}function docByName(e){return document.getElementsByName(e)}function docBySelector(e){return document.querySelector(e)}window.onload=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");0<t&&(r=parseInt(e.substring(t+5,e.indexOf(".",t)),10));0<e.indexOf("Trident/")&&(t=e.indexOf("rv:"),r=parseInt(e.substring(t+3,e.indexOf(".",t)),10));var r,t=e.indexOf("Edge/");void 0!==(r=0<t?parseInt(e.substring(t+5,e.indexOf(".",t)),10):r)&&(document.body.innerHTML="<div style='margin: 200px;'>",document.body.innerHTML+="<h1 style='font-size: 100px; font-family: Arial; text-align: center; color: #F00;'>Music Blocks</h1>",document.body.innerHTML+="<h3 style='font-size: 40px; font-family: Arial; text-align: center;'>Music Blocks will not work in Internet Explorer, you can use:</h3>",document.body.innerHTML+="<div style='width: 550px; margin: 0 auto;'><a href='https://www.chromium.org/getting-involved/download-chromium' style='float: left; display: inherit; font-family: Arial; font-size: 30px; color: #0327F1; text-decoration: none;'>Chromium</a>",document.body.innerHTML+="<a href='https://www.google.com/chrome/' style='float: left; margin-left: 40px;display: inherit; font-family: Arial; font-size: 30px; color: #0327F1; text-decoration: none;'>Chrome</a>",document.body.innerHTML+="<a href='https://support.apple.com/downloads/safari' style='float: left; margin-left: 40px;display: inherit; font-family: Arial; font-size: 30px; color: #0327F1; text-decoration: none;'>Safari</a>",document.body.innerHTML+="<a href='https://www.mozilla.org/en-US/firefox/new/' style='float: left; margin-left: 40px;display: inherit; font-family: Arial; font-size: 30px; color: #0327F1; text-decoration: none;'>Firefox</a>",document.body.innerHTML+="</div></div>")};var last=function(e){var t=e.length;return 0===t?null:e[t-1]},_getTextWidth=function(e,t){var r=(_getTextWidth.canvas||(_getTextWidth.canvas=document.createElement("canvas"))).getContext("2d");return r.font=t,r.measureText(e).width};function doSVG(e,t,r,o,n,a){var i,l="";for(i in r.turtleList)r.getTurtle(i).painter.closeSVG(),l+=r.getTurtle(i).painter.svgOutput;o='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" width="'+o+'" height="'+n+'">\n';return o=o+'<g transform="scale('+a+","+a+')">\n'+t.svgOutput,""===l?"":o+l+"</g></svg>"}var isSVGEmpty=function(e){for(var t in e.turtleList)if(e.getTurtle(t).painter.closeSVG(),""!==e.getTurtle(t).painter.svgOutput)return!1;return!0},fileExt=function(e){return null===e||1===(e=e.split(".")).length||""===e[0]&&2===e.length?"":e.pop()},fileBasename=function(e){var t=e.split(".");return 1===t.length?t[0]:""===t[0]&&2===t.length?e:(t.pop(),t.join("."))},toTitleCase=function(e){var t;if("string"==typeof e)return t="",1<e.length&&(t=e.substring(1)),e.toUpperCase()[0]+t},processPluginData=function processPluginData(activity,pluginData,pluginSource){if(void 0===pluginData)return null;var isTrustedPluginSource=function(e){return!!e&&(e.startsWith("./")||e.startsWith("../")||e.startsWith("/")||!e.includes("http://")&&!e.includes("https://"))},safeEval=function safeEval(code){var label=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"plugin";if("string"==typeof code)if(5e5<code.length)console.warn("Plugin code too large:",label);else try{eval(code)}catch(e){console.error("Plugin execution failed:",label,e)}},obj;if(!isTrustedPluginSource(pluginSource))return console.warn("Blocked untrusted plugin source:",pluginSource),null;try{obj=JSON.parse(pluginData)}catch(e){return console.log(pluginData),console.log(e),null}var newPalette=!1,paletteName=null,protoblock;if("PALETTEPLUGINS"in obj)for(var name in obj.PALETTEPLUGINS){paletteName=name,PALETTEICONS[name]=obj.PALETTEPLUGINS[name];var fillColor="#ff0066",strokeColor=("PALETTEFILLCOLORS"in obj&&name in obj.PALETTEFILLCOLORS&&(fillColor=obj.PALETTEFILLCOLORS[name]),PALETTEFILLCOLORS[name]=fillColor,"#ef003e"),highlightColor=("PALETTESTROKECOLORS"in obj&&name in obj.PALETTESTROKECOLORS&&(strokeColor=obj.PALETTESTROKECOLORS[name]),PALETTESTROKECOLORS[name]=strokeColor,"#ffb1b3"),strokeHighlightColor=("PALETTEHIGHLIGHTCOLORS"in obj&&name in obj.PALETTEHIGHLIGHTCOLORS&&(highlightColor=obj.PALETTEHIGHLIGHTCOLORS[name]),PALETTEHIGHLIGHTCOLORS[name]=highlightColor,"#404040");"HIGHLIGHTSTROKECOLORS"in obj&&name in obj.HIGHLIGHTSTROKECOLORS&&(strokeHighlightColor=obj.HIGHLIGHTSTROKECOLORS[name]),HIGHLIGHTSTROKECOLORS[name]=strokeHighlightColor,platformColor.paletteColors[name]=[fillColor,strokeColor,highlightColor,strokeHighlightColor],name in activity.palettes.buttons?console.debug("palette "+name+" already exists"):(console.debug("adding palette "+name),activity.palettes.add(name),MULTIPALETTES[2].includes(name)||MULTIPALETTES[2].push(name),newPalette=!0)}if(newPalette)try{activity.palettes.makePalettes(1)}catch(e){console.debug("makePalettes: "+e)}if("IMAGES"in obj)for(var blkName in obj.IMAGES)activity.pluginsImages[blkName]=obj.IMAGES[blkName];if("FLOWPLUGINS"in obj)for(var flow in obj.FLOWPLUGINS)activity.logo.evalFlowDict[flow]=obj.FLOWPLUGINS[flow];if("ARGPLUGINS"in obj)for(var arg in obj.ARGPLUGINS)activity.logo.evalArgDict[arg]=obj.ARGPLUGINS[arg];if("MACROPLUGINS"in obj)for(var macro in obj.MACROPLUGINS)try{activity.palettes.pluginMacros[macro]=JSON.parse(obj.MACROPLUGINS[macro])}catch(e){console.debug("could not parse macro "+macro),console.debug(e)}if("SETTERPLUGINS"in obj)for(var setter in obj.SETTERPLUGINS)activity.logo.evalSetterDict[setter]=obj.SETTERPLUGINS[setter];if("BLOCKPLUGINS"in obj)for(var block in obj.BLOCKPLUGINS)console.debug("adding plugin block "+block),safeEval(obj.BLOCKPLUGINS[block],"BLOCKPLUGINS:"+block);if("GLOBALS"in obj&&safeEval(obj.GLOBALS,"GLOBALS"),"PARAMETERPLUGINS"in obj)for(var parameter in obj.PARAMETERPLUGINS)activity.logo.evalParameterDict[parameter]=obj.PARAMETERPLUGINS[parameter];if("ONLOAD"in obj)for(var _arg in obj.ONLOAD)safeEval(obj.ONLOAD[_arg],"ONLOAD:"+_arg);if("ONSTART"in obj)for(var _arg2 in obj.ONSTART)activity.logo.evalOnStartList[_arg2]=obj.ONSTART[_arg2];if("ONSTOP"in obj)for(var _arg3 in obj.ONSTOP)activity.logo.evalOnStopList[_arg3]=obj.ONSTOP[_arg3];for(protoblock in activity.blocks.protoBlockDict)try{null==activity.blocks.protoBlockDict[protoblock].palette?console.debug("Cannot find palette for protoblock "+protoblock):activity.blocks.protoBlockDict[protoblock].palette.add(activity.blocks.protoBlockDict[protoblock])}catch(e){console.debug(e)}return null!==paletteName&&activity.palettes.updatePalettes(paletteName),setTimeout(function(){activity.palettes.show()},2e3),obj},processRawPluginData=function(t,r,e){for(var o,n=r.split("\n"),a="",i=0;i<n.length;i++)0!==n[i].length&&"/"!==n[i][0]&&(a+=n[i]);try{o=processPluginData(t,a.replace(/\n/g,""),e)}catch(e){o=null,console.log(r),console.log(a),t.errorMsg("Error loading plugin: "+e)}return o},updatePluginObj=function(e,t){if(null!==t){for(var r in t.PALETTEPLUGINS)e.pluginObjs.PALETTEPLUGINS[r]=t.PALETTEPLUGINS[r];for(var o in t.PALETTEFILLCOLORS)e.pluginObjs.PALETTEFILLCOLORS[o]=t.PALETTEFILLCOLORS[o];for(var n in t.PALETTESTROKECOLORS)e.pluginObjs.PALETTESTROKECOLORS[n]=t.PALETTESTROKECOLORS[n];for(var a in t.PALETTEHIGHLIGHTCOLORS)e.pluginObjs.PALETTEHIGHLIGHTCOLORS[a]=t.PALETTEHIGHLIGHTCOLORS[a];for(var i in t.FLOWPLUGINS)e.pluginObjs.FLOWPLUGINS[i]=t.FLOWPLUGINS[i];for(var l in t.ARGPLUGINS)e.pluginObjs.ARGPLUGINS[l]=t.ARGPLUGINS[l];for(var c in t.BLOCKPLUGINS)e.pluginObjs.BLOCKPLUGINS[c]=t.BLOCKPLUGINS[c];if("MACROPLUGINS"in t)for(var s in t.MACROPLUGINS)e.pluginObjs.MACROPLUGINS[s]=t.MACROPLUGINS[s];for(var u in"GLOBALS"in t&&("GLOBALS"in e.pluginObjs||(e.pluginObjs.GLOBALS=""),e.pluginObjs.GLOBALS+=t.GLOBALS),"IMAGES"in t&&(e.pluginObjs.IMAGES=t.IMAGES),t.ONLOAD)e.pluginObjs.ONLOAD[u]=t.ONLOAD[u];for(var f in t.ONSTART)e.pluginObjs.ONSTART[f]=t.ONSTART[f];for(var d in t.ONSTOP)e.pluginObjs.ONSTOP[d]=t.ONSTOP[d]}},preparePluginExports=function(e,t){return updatePluginObj(e,t),JSON.stringify(e.pluginObjs)},processMacroData=function(t,e,r,o){if(void 0!==t&&"{}"!==t)try{var n,a=JSON.parse(t);for(n in e.add("myblocks","black","#a0a0a0"),a)o[n]=a[n],r.addToMyPalette(n,o[n]);e.makePalettes(1)}catch(e){console.log(t),console.debug(e)}},prepareMacroExports=function(e,t,r){return null!==e&&(r[e]=t),JSON.stringify(r)},hasSetupCamera=!1,doUseCamera=function(t,r,o,e,n,a,i){var l=!1,c=document.querySelector("#camVideo"),s=document.querySelector("#camCanvas");function u(){s.width=320,s.height=240,s.getContext("2d").drawImage(c,0,0,320,240);var e=s.toDataURL("image/png");r.getTurtle(o).doShowImage(t[0],e)}navigator.getMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia,void 0===navigator.getMedia&&i("Your browser does not support the webcam"),hasSetupCamera?(l=!0,c.play(),e?(n=window.setInterval(u,100),a(n)):u()):navigator.getMedia({video:!0,audio:!1},function(e){navigator.mozGetUserMedia?c.mozSrcObject=e:c.srcObject=e,c.play(),hasSetupCamera=!0},function(e){i("Could not connect to camera"),console.debug(e)}),c.addEventListener("canplay",function(){l||(c.setAttribute("width",320),c.setAttribute("height",240),s.setAttribute("width",320),s.setAttribute("height",240),l=!0,e?(n=window.setInterval(u,100),a(n)):u())},!1)};function doStopVideoCam(e,t){null!==e&&window.clearInterval(e),t(null),document.querySelector("#camVideo").pause()}function hideDOMLabel(){var e=docById("textLabel"),e=(null!==e&&(e.style.display="none"),docById("numberLabel")),e=(null!==e&&(e.style.display="none"),docById("wheelDiv"));null!==e&&(e.style.display="none")}function displayMsg(){}function safeSVG(e){return"string"==typeof e?e.replace(/&/,"&amp;").replace(/</,"&lt;").replace(/>/,"&gt;"):e}function toFixed2(e){return"number"==typeof e?(e!==Math.floor(e)?e.toFixed(2):e).toString():e}function rationalToFraction(e){if(0===e||isNaN(e)||!isFinite(e))return[0,1];1<e?(t=!0,e=1/e):t=!1;for(var t,r=1,o=1,n=0,a=1;1e-8<Math.abs(r-e)&&n<1e4;)r<e?o+=1:(a+=1,o=Math.round(e*a)),r=o/a,n++;return 1e4===n?[o,a]:0===a||0===o?[0,1]:t?[a,o]:[o,a]}function GCD(e,t){for(e=Math.abs(e),t=Math.abs(t);t;){var r=t;t=e%t,e=r}return e}var mixedNumber=function(e){var t,r;return"number"==typeof e?(t=Math.floor(e))<e?(r=rationalToFraction(e-t),0===t?r[0]+"/"+r[1]:1===r[0]&&1===r[1]?t+1:99<r[1]?e.toFixed(2):t+" "+r[0]+"/"+r[1]):e.toString()+"/1":e},LCD=function(e,t){return Math.abs(e*t/GCD(e,t))},rationalSum=function(e,t){var r,o,n,a;return 0===e||0===t?[0,1]:(a=Math.floor(e[0])!==e[0]?rationalToFraction(e[0]):[e[0],1],r=Math.floor(t[0])!==t[0]?rationalToFraction(t[0]):[t[0],1],o=Math.floor(e[1])!==e[1]?rationalToFraction(e[1]):[e[1],1],n=Math.floor(t[1])!==t[1]?rationalToFraction(t[1]):[t[1],1],e[0]=a[0]*o[1],e[1]=a[1]*o[0],t[0]=r[0]*n[1],t[1]=r[1]*n[0],a=LCD(e[1],t[1]),[e[0]*a/e[1]+t[0]*a/t[1],a])},nearestBeat=function(e,t){for(var r=1/(2*t),o=0,n=e/100;r<n;)r+=1/t,o+=1;return[o,t]},oneHundredToFraction=function(e){if(e<1)return[1,64];if(99<e)return[1,1];switch(Math.floor(e)){case 1:return[1,64];case 2:return[1,48];case 3:case 4:case 5:return[1,32];case 6:case 7:case 8:return[1,16];case 9:case 10:case 11:return[1,12];case 12:case 13:case 14:return[1,8];case 15:case 16:case 17:return[1,6];case 18:case 19:return[3,16];case 20:case 21:case 22:return[1,5];case 23:case 24:case 25:case 26:case 27:case 28:case 29:return[1,4];case 30:case 31:return[5,16];case 32:case 33:case 34:case 35:return[1,3];case 36:case 37:case 38:case 39:return[3,8];case 40:case 41:return[2,5];case 42:case 43:case 44:return[7,16];case 45:case 46:case 47:return[15,32];case 48:case 49:case 50:case 51:case 52:return[1,2];case 53:case 54:return[17,32];case 56:case 57:case 58:return[9,16];case 59:case 60:case 61:return[3,5];case 62:case 63:case 64:case 65:return[5,8];case 66:case 67:return[2,3];case 68:case 69:case 70:return[11,16];case 71:case 72:case 73:case 74:return[23,32];case 75:case 76:case 77:case 78:case 79:case 80:return[3,4];case 81:case 82:return[13,16];case 83:case 84:case 85:case 86:return[5,6];case 87:case 88:case 89:case 90:return[7,8];case 91:case 92:return[11,12];case 93:case 94:case 95:return[15,16];case 96:case 98:return[31,32];case 99:return[63,64];default:return[e,100]}},rgbToHex=function(e,t,r){return"#"+((1<<24)+(e<<16)+(t<<8)+r).toString(16).slice(1)},hexToRGB=function(e){e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},hex2rgb=function(e){e=parseInt(e,16);return"rgba("+(e>>16&255)+","+(e>>8&255)+","+(255&e)+",1)"},delayExecution=function(t){return new Promise(function(e){setTimeout(function(){e(!0)},t)})};function closeWidgets(){window.widgetWindows.hideAllWindows()}var closeBlkWidgets=function(e){for(var t=document.getElementsByClassName("wftTitle"),r=0;r<t.length;r++)if(t[r].innerHTML===e){window.widgetWindows.hideWindow(t[r].innerHTML);break}},resolveObject=function resolveObject(path){if(path&&"string"==typeof path){var globalObj="undefined"!=typeof window?window:global;try{var result=path.split(".").reduce(function(e,t){if(null!=e)return e[t]},globalObj);if(void 0===result)try{return eval(path)}catch(evalError){return}return result}catch(e){try{return eval(path)}catch(evalError){console.warn("Failed to resolve object path: "+path,e)}}}},importMembers=function(e,t,r,o){function n(e,t,r){if(void 0!==t){void 0===r||0===r.length?e.added=new t:e.added=_construct(t,_toConsumableArray(r));var o,n=_createForOfIteratorHelper(Object.getOwnPropertyNames(t.prototype));try{for(n.s();!(o=n.n()).done;){var a=o.value;"constructor"!==a&&(e[a]=e.added[a])}}catch(e){n.e(e)}finally{n.f()}for(var i=0,l=Object.keys(e.added);i<l.length;i++){var c=l[i];e[c]=e.added[c],delete e.added[c]}delete e.added}}var a=e.constructor.name;""!==t&&void 0!==t?n(e,resolveObject(t)):(n(e,resolveObject(a+"."+a+"Model"),r),n(e,resolveObject(a+"."+a+"View"),o))};"undefined"!=typeof module&&module.exports&&(module.exports={_:_,last:last,fileExt:fileExt,fileBasename:fileBasename,toTitleCase:toTitleCase,safeSVG:safeSVG,toFixed2:toFixed2,mixedNumber:mixedNumber,nearestBeat:nearestBeat,oneHundredToFraction:oneHundredToFraction,rationalToFraction:rationalToFraction,rgbToHex:rgbToHex,hexToRGB:hexToRGB,hex2rgb:hex2rgb});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var n,o,r,a,i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(i)return r=!(o=!0),{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){r=!0,n=t},f:function(){try{o||null==i.return||i.return()}finally{if(r)throw n}}};if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return i&&(t=i),a=0,{s:e=function(){},n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var n;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function AIDebuggerWidget(){var r={BASE_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:8000":window.location.hostname.includes("musicblocks.sugarlabs.org")?"".concat(window.location.protocol,"//api.musicblocks.sugarlabs.org"):"".concat(window.location.protocol,"//").concat(window.location.hostname,":8000"),ENDPOINTS:{ANALYZE:"/analyze"},TIMEOUT:3e4};console.log("AI Debugger Backend URL:",r.BASE_URL),this.chatHistory=[],this.promptCount=0,this.conversationId=null,this.activity=null,this.widgetWindow=null,this.chatLog=null,this.messageInput=null,this.sendButton=null,this._generateConversationId=function(){return"conv_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},this.conversationId=this._generateConversationId(),this.init=function(t){var e=this,n=(this.activity=t,this.activity.isInputON=!0,this.conversationId||(this.conversationId=this._generateConversationId()),window.widgetWindows.windowFor(this,"Debugger"));(this.widgetWindow=n).clear(),n.show(),n.getWidgetBody().style.width="900px",n.getWidgetBody().style.height="600px",n.onclose=function(){n.destroy(),e.activity.isInputON=!1},n.onmaximize=this._scale.bind(this),this._resetButton=n.addButton("reload.svg",32,_("Reset conversation")),this._resetButton.onclick=function(){e._resetConversation()},this._exportButton=n.addButton("download.svg",32,_("Export chat")),this._exportButton.onclick=function(){e._exportChat()},this._createLayout(),this._loadProjectAndInitialize(),n.sendToCenter(),this.activity.textMsg(_("Debugger initialized"))},this._createLayout=function(){var t=document.createElement("div");t.style.display="flex",t.style.height="100%",t.style.width="100%",this._createChatArea(t),this.widgetWindow.getWidgetBody().appendChild(t)},this._createChatArea=function(t){var e=this,n=document.createElement("div"),o=(n.style.width="100%",n.style.display="flex",n.style.flexDirection="column",n.style.height="100%",this.chatLog=document.createElement("div"),this.chatLog.className="chatLog",this.chatLog.style.flex="1",this.chatLog.style.overflowY="auto",this.chatLog.style.padding="15px",this.chatLog.style.backgroundColor="#fafafa",this.chatLog.style.display="flex",this.chatLog.style.flexDirection="column",this.chatLog.style.gap="10px",n.appendChild(this.chatLog),document.createElement("div"));o.style.display="flex",o.style.padding="15px",o.style.backgroundColor="#fff",o.style.borderTop="1px solid #ddd",o.style.gap="10px",this.messageInput=document.createElement("input"),this.messageInput.type="text",this.messageInput.placeholder="Type your message here...",this.messageInput.style.flex="1",this.messageInput.style.padding="12px",this.messageInput.style.border="1px solid #ddd",this.messageInput.style.borderRadius="25px",this.messageInput.style.fontSize="14px",this.messageInput.style.outline="none",this.messageInput.onfocus=function(){this.style.borderColor="#2196F3",this.style.boxShadow="0 0 5px rgba(33, 150, 243, 0.3)"},this.messageInput.onblur=function(){this.style.borderColor="#ddd",this.style.boxShadow="none"},this.sendButton=document.createElement("button"),this.sendButton.textContent="Send",this.sendButton.style.padding="12px 20px",this.sendButton.style.backgroundColor="#2196F3",this.sendButton.style.color="white",this.sendButton.style.border="none",this.sendButton.style.borderRadius="25px",this.sendButton.style.cursor="pointer",this.sendButton.style.fontSize="14px",this.sendButton.style.fontWeight="bold",this.sendButton.style.transition="background-color 0.3s",this.sendButton.onmouseover=function(){this.style.backgroundColor="#1976D2"},this.sendButton.onmouseout=function(){this.style.backgroundColor="#2196F3"},this.sendButton.onclick=function(){e._sendMessage()},this.messageInput.onkeypress=function(t){"Enter"===t.key&&e._sendMessage()},o.appendChild(this.messageInput),o.appendChild(this.sendButton),n.appendChild(o),t.appendChild(n)},this._addWelcomeMessage=function(){var t={type:"system",content:_THIS_IS_MUSIC_BLOCKS_?"Welcome to Music Blocks Debugger! I can help you with music composition, Music Blocks programming, and general music theory questions.":"Welcome to Turtle Blocks Debugger! I can help you with programming, turtle graphics, and general coding questions.",timestamp:(new Date).toISOString()};this._addMessageToUI(t)},this._sendMessage=function(){var t,e=this.messageInput.value.trim();""!==e&&(t={type:"user",content:e,timestamp:(new Date).toISOString()},this.chatHistory.push(t),this._addMessageToUI(t),this.messageInput.value="",this._updateMessageCount(),this._sendToBackend(e))},this._addMessageToUI=function(t){var e=document.createElement("div"),n=(e.style.maxWidth="80%",e.style.padding="12px 16px",e.style.borderRadius="18px",e.style.marginBottom="8px",e.style.wordWrap="break-word",e.style.fontSize="14px",e.style.lineHeight="1.4",document.createElement("div"));n.style.fontSize="11px",n.style.opacity="0.7",n.style.marginTop="4px",n.textContent=new Date(t.timestamp).toLocaleTimeString(),"user"===t.type?(e.style.alignSelf="flex-end",e.style.backgroundColor="#2196F3",e.style.color="white",e.textContent=t.content,e.appendChild(n)):"bot"===t.type?(e.style.alignSelf="flex-start",e.style.backgroundColor="#e0e0e0",e.style.color="#333",e.textContent=t.content,e.appendChild(n)):"system"===t.type&&(e.style.alignSelf="center",e.style.backgroundColor="#fff3cd",e.style.color="#856404",e.style.border="1px solid #ffeaa7",e.style.fontStyle="italic",e.textContent=t.content,e.appendChild(n)),this.chatLog.appendChild(e),this.chatLog.scrollTop=this.chatLog.scrollHeight},this._sendToBackend=function(t){var e=this;this._showTypingIndicator(),this.promptCount++;try{var n=this.activity.prepareExport(),o=(JSON.parse(n),n)}catch(t){console.error("Error getting project data:",t),this.activity.textMsg(_("Debugger error: Could not prepare project data.")),o="[]"}n={code:o,prompt:t,history:this.chatHistory.filter(function(t){return"system"!==t.type}).map(function(t){return{role:"user"===t.type?"user":"assistant",content:t.content}}),prompt_count:this.promptCount};fetch("".concat(r.BASE_URL).concat(r.ENDPOINTS.ANALYZE),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(t){if(t.ok)return t.json();throw new Error("HTTP ".concat(t.status,": ").concat(t.statusText))}).then(function(t){if(e._hideTypingIndicator(),!t||!t.response)throw e.activity.textMsg(_("Server error: Invalid response from AI backend.")),new Error("No response from backend");t={type:"bot",content:t.response,timestamp:(new Date).toISOString()};e.chatHistory.push(t),e._addMessageToUI(t),e._updateMessageCount()}).catch(function(t){e._hideTypingIndicator(),console.error("Backend connection error:",t.message),e.activity.textMsg(_("Server error: Unable to connect to AI backend.")),t instanceof TypeError&&t.message.includes("fetch")&&console.error("Network/CORS error. Backend connection failed");t={type:"bot",content:"I'm sorry, I'm having trouble connecting to the AI backend. Error: ".concat(t.message,". Please check your connection and try again."),timestamp:(new Date).toISOString()};e.chatHistory.push(t),e._addMessageToUI(t),e._updateMessageCount()})},this._showTypingIndicator=function(){var t=document.createElement("div"),e=(t.className="typing-indicator",t.style.alignSelf="flex-start",t.style.backgroundColor="#e0e0e0",t.style.color="#666",t.style.padding="12px 16px",t.style.borderRadius="18px",t.style.marginBottom="8px",t.style.fontSize="14px",t.style.fontStyle="italic",t.textContent="Debugger is typing...",0),n=setInterval(function(){e=(e+1)%4,t.textContent="Debugger is typing"+".".repeat(e)},500);t.setAttribute("data-animation-id",n),this.chatLog.appendChild(t),this.chatLog.scrollTop=this.chatLog.scrollHeight},this._hideTypingIndicator=function(){var t,e=this.chatLog.querySelector(".typing-indicator");e&&((t=e.getAttribute("data-animation-id"))&&clearInterval(parseInt(t)),e.remove())},this._updateMessageCount=function(){},this._loadProjectAndInitialize=function(){try{var t=this.activity.prepareExport();try{JSON.parse(t)}catch(t){console.error("Error parsing project data:",t),this.activity.textMsg(_("Debugger error: Invalid project data format."))}var e={type:"system",content:"Loading your current project and initializing AI assistant...",timestamp:(new Date).toISOString()};this._addMessageToUI(e),this._initializeBackendWithProject(t)}catch(t){console.error("Error loading project data:",t),this.activity.textMsg(_("Debugger error: Could not load project data."));e={type:"system",content:"Could not load project data. Starting with basic assistant...",timestamp:(new Date).toISOString()};this._addMessageToUI(e),this._addWelcomeMessage()}},this._initializeBackendWithProject=function(t){var e=this,t={code:t,prompt:"",history:this.chatHistory.map(function(t){return{role:"user"===t.type?"user":"assistant",content:t.content}}),prompt_count:1};this._showTypingIndicator(),fetch("".concat(r.BASE_URL).concat(r.ENDPOINTS.ANALYZE),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(t){if(t.ok)return t.json();throw new Error("HTTP ".concat(t.status,": ").concat(t.statusText))}).then(function(t){if(e._hideTypingIndicator(),!t.response)throw e.activity.textMsg(_("Server error: No initial response from AI backend.")),new Error("No initial response from backend");t={type:"bot",content:t.response,timestamp:(new Date).toISOString()};e.chatHistory.push(t),e._addMessageToUI(t),e._updateMessageCount(),e.promptCount=1}).catch(function(t){e._hideTypingIndicator(),console.error("Backend initialization error:",t.message),e.activity.textMsg(_("Server error: Failed to initialize AI debugger.")),t instanceof TypeError&&t.message.includes("fetch")&&console.error("Network/CORS error. Backend connection failed");t={type:"system",content:"Could not connect to AI backend: ".concat(t.message,". Please check your connection and try again."),timestamp:(new Date).toISOString()};e._addMessageToUI(t),e._addWelcomeMessage()})},this._resetConversation=function(){this.chatHistory=[],this.promptCount=0,this.conversationId=this._generateConversationId(),this.chatLog.innerHTML="",this._loadProjectAndInitialize(),this._updateMessageCount(),this.activity.textMsg(_("Conversation reset."))},this._exportChat=function(){if(0===this.chatHistory.length)this.activity.textMsg(_("No conversation to export."));else{var e="";try{var t=this.activity.prepareExport();try{var n=JSON.parse(t),e=this._convertProjectToLLMFormat(n)}catch(t){e="Could not convert project to readable format"}}catch(t){console.error("Error getting project data for export:",t),this.activity.textMsg(_("Debugger error: Could not retrieve project data for export.")),e="Could not convert project to readable format"}var o=_THIS_IS_MUSIC_BLOCKS_?"Music Blocks":"Turtle Blocks",r="".concat(o," Debugger Chat Export\n"),t=(r=(r=r+("Generated at: "+(new Date).toLocaleString()+"\n\n")+"Project Code (Human Readable Format):\n")+(e+"\n\n")+"Chat History:\n\n",this.chatHistory.forEach(function(t){var e="user"===t.type?"User":"".concat(o," Debugger");r=(r+=e+":\n")+t.content+"\n\n"}),new Blob([r],{type:"text/plain"})),n=URL.createObjectURL(t),e=document.createElement("a");e.href=n,e.download="music_blocks_chat_"+(new Date).toISOString().replace(/[:.]/g,"-").split("T")[0]+"_"+(new Date).toTimeString().split(" ")[0].replace(/:/g,"")+".txt",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(n),this.activity.textMsg(_("Chat exported successfully."))}},this._convertProjectToLLMFormat=function(t){if(!Array.isArray(t))return"Invalid JSON format: Expected a list at the root.";if(0===t.length)return"Warning: No blocks found in input!";var e,n=["Start of Project"],o=Object.fromEntries(t.map(function(t){return[t[0],t]})),r=new Set,a=t.find(function(t){return"start"===(Array.isArray(t[1])?t[1][0]:t[1])})||t[0],i=(n.push.apply(n,_toConsumableArray(this._processBlock(a,o,r,1))),_createForOfIteratorHelper(t));try{for(i.s();!(e=i.n()).done;){var s,c=e.value,l=c[0];r.has(l)||"hidden"!==(s=Array.isArray(c[1])?c[1][0]:c[1])&&"vspace"!==s&&l!==a[0]&&n.push.apply(n,_toConsumableArray(this._processBlock(c,o,r,1)))}}catch(t){i.e(t)}finally{i.f()}return n.join("\n")},this._clearChat=function(){this.chatLog.innerHTML="",this.activity.textMsg(_("Chat cleared."))},this._processBlock=function(t,e,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]&&arguments[4],a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,i=[],s=t[0];if(!n.has(s)){n.add(s);var c=t[1],l=null;if(Array.isArray(c)&&(l=c[1],c=c[0],l)&&"object"===_typeof(l))for(var u in l)"string"==typeof l[u]&&this._isBase64Data(l[u])&&(l[u]="data");if(["vspace","hidden"].includes(c)){var d,h=_createForOfIteratorHelper(Array.isArray(t[t.length-1])?t[t.length-1]:[]);try{for(h.s();!(d=h.n()).done;){var p=d.value;e[p]&&i.push.apply(i,_toConsumableArray(this._processBlock(e[p],e,n,o,r,c)))}}catch(t){h.e(t)}finally{h.f()}}else if("number"!==c&&"drumname"!==c&&"solfege"!==c){s=this._getBlockRepresentation(c,l,t,e,o,r,a);if(s){for(var y="│   ".repeat(o-1)+"├── ",g=(i.push("".concat(y).concat(s)),Array.isArray(t[t.length-1])?t[t.length-1]:[]),m=0;m<g.length-1;m++){var f=g[m];null!==f&&e[f]&&("divide"!==(Array.isArray(e[f][1])?e[f][1][0]:e[f][1])||"newnote"!==a&&"setmasterbpm2"!==a&&"arc"!==a)&&i.push.apply(i,_toConsumableArray(this._processBlock(e[f],e,n,o+1,!0,c)))}0<g.length&&null!==g[g.length-1]&&e[y=g[g.length-1]]&&i.push.apply(i,_toConsumableArray(this._processBlock(e[y],e,n,o,!1,c))),"start"!==c&&"action"!==c||i.push("│   ".repeat(o-1)+"│")}}}return i},this._getBlockRepresentation=function(t,e,n,o,r,a,i){var s=n[n.length-1]||[];switch(t){case"start":var c=["ID: ".concat(e.id),"Position: (".concat(e.xcor.toFixed(2),", ").concat(e.ycor.toFixed(2),")"),"Heading: ".concat(e.heading,"°"),"Color: ".concat(e.color,", Shade: ").concat(e.shade),"Pen Size: ".concat(e.pensize,", Grey: ").concat(e.grey.toFixed(2))].join(", ");return"Start Block --\x3e {".concat(c,"}");case"setmasterbpm2":c=this._getNumericValue(s[1],o),c="Set Master BPM → ".concat(c||"?"," BPM");return s[2]&&o[s[2]]&&"divide"===o[s[2]][1]&&(u=o[s[2]],l=this._getNumericValue(u[u.length-1][1],o),u=this._getNumericValue(u[u.length-1][2],o),null!==l)&&null!==u&&0!==u&&(c+="\n".concat("│   ".repeat(r),"├── beat value --\x3e ").concat(l,"/").concat(u," = ").concat((l/u).toFixed(2))),c;case"divide":var l=this._getNumericValue(s[1],o),u=this._getNumericValue(s[2],o),c="?";return null!==l&&null!==u&&0!==u&&(c=(l/u).toFixed(2)),"newnote"===i?"Duration --\x3e ".concat(l||"?","/").concat(u||"?"," = ").concat(c):"Divide Block --\x3e ".concat(l||"?","/").concat(u||"?"," = ").concat(c);case"storein2":l=(null==e?void 0:e.value)||"unnamed",u=this._getNumericValue(s[1],o);return'Store Variable "'.concat(l,'" → ').concat(null!==u?u:"?");case"namedbox":return'Variable: "'.concat((null==e?void 0:e.value)||"unnamed",'"');case"action":c=this._getTextValue(s[1],o);return'Action: "'.concat(c||"unnamed",'"');case"repeat":l="?",u="?";return s[1]&&o[s[1]]&&(c=o[s[1]],Array.isArray(c[1])&&"divide"===c[1][0]?(d=this._getNumericValue(c[c.length-1][1],o),c=this._getNumericValue(c[c.length-1][2],o),null!==d&&null!==c&&0!==c&&(l=(d/c).toFixed(2),u="".concat(d,"/").concat(c," = ").concat(l))):u=(l=this._getNumericValue(s[1],o))||"?"),"Repeat (".concat(u,") Times");case"forever":return"Forever Loop (Repeats Indefinitely)";case"penup":return"Pen Up (Lifts Pen from Canvas)";case"pendown":return"Pen Down";case"forward":var d=this._getNumericValue(s[1],o);return"Move Forward → ".concat(d||"?"," Steps");case"back":c=this._getNumericValue(s[1],o);return"Move Backward → ".concat(c||"?"," Steps");case"right":l=this._getNumericValue(s[1],o);return"Rotate Right → ".concat(l||"?","°");case"left":u=this._getNumericValue(s[1],o);return"Rotate Left → ".concat(u||"?","°");case"setheading":d=this._getNumericValue(s[1],o);return"Set Heading → ".concat(d||"0","°");case"show":c=this._getNumericValue(s[2],o);return"Show Number: ".concat(c||"?");case"increment":l=this._getNumericValue(s[1],o),u=this._getNumericValue(s[2],o);return"Increment --\x3e Color: ".concat(l||"?",", Amount: ").concat(u||"?");case"incrementOne":d=this._getNamedBoxValue(s[1],o);return'Increment Variable: "'.concat(d||"?",'"');case"newnote":return"Note";case"playdrum":c=this._getDrumName(s[1],o);return"Play Drum → ".concat(c||"?");case"arc":l="?",u=(s[3]&&o[s[3]]&&(u=o[s[3]],Array.isArray(u[1])&&"divide"===u[1][0]?(d=this._getNumericValue(u[u.length-1][1],o),c=this._getNumericValue(u[u.length-1][2],o),null!==d&&null!==c&&0!==c&&(l=(d/c).toFixed(2))):l=this._getNumericValue(s[3],o)||"?"),this._getNumericValue(s[2],o));return"Draw Arc --\x3e Angle: ".concat(l,"°, Radius: ").concat(u||"?");case"print":d=this._getTextValue(s[2],o);return'Print: "'.concat(d||"",'"');case"plus":c=this._getNumericValue(s[1],o),l=this._getNumericValue(s[2],o);return"Add --\x3e ".concat(c||"?"," + ").concat(l||"?"," = ").concat(null!==c&&null!==l?(c+l).toFixed(2):"?");case"text":return'"'.concat((null==e?void 0:e.value)||"",'"');case"pitch":var h,u="?",d=this._getNumericValue(s[2],o);return s[1]&&o[s[1]]&&(c=o[s[1]],"text"===(l=Array.isArray(c[1])?c[1][0]:c[1])&&Array.isArray(c[1])?u=(null==(h=c[1][1])?void 0:h.value)||"?":"solfege"===l&&Array.isArray(c[1])&&(u=(null==(h=c[1][1])?void 0:h.value)||"?")),"Pitch --\x3e Solfege: ".concat(u,", Octave: ").concat(d||"?");case"solfege":return null;case"nameddo":l=(null==e?void 0:e.value)||"unnamed";return'Do action --\x3e "'.concat(l,'"');case"settransposition":c=this._getNumericValue(s[1],o);return"Set Transposition --\x3e ".concat(c||"?");default:return void 0!==(null==e?void 0:e.value)?"".concat(t,": ").concat(e.value):t.charAt(0).toUpperCase()+t.slice(1)}},this._getNumericValue=function(t,e){return null!==t&&e[t]&&(e=e[t],"number"===(Array.isArray(e[1])?e[1][0]:e[1]))?Array.isArray(e[1])?null==(t=e[1][1])?void 0:t.value:e[1]:null},this._getTextValue=function(t,e){return null!==t&&e[t]&&(e=e[t],"text"===(Array.isArray(e[1])?e[1][0]:e[1]))&&Array.isArray(e[1])?null==(t=e[1][1])?void 0:t.value:null},this._getDrumName=function(t,e){return null!==t&&e[t]&&(e=e[t],"drumname"===(Array.isArray(e[1])?e[1][0]:e[1]))&&Array.isArray(e[1])?null==(t=e[1][1])?void 0:t.value:null},this._getNamedBoxValue=function(t,e){return null===t||!e[t]||(e=e[t],"namedbox"!==(t=Array.isArray(e[1])?e[1][0]:e[1])&&"namedarg"!==t)||!Array.isArray(e[1])?null:null==(t=e[1][1])?void 0:t.value},this._isBase64Data=function(t){return"string"==typeof t&&/^data:(image|audio)\/[a-zA-Z0-9+.-]+;base64,/.test(t)},this._scale=function(){var t;this.widgetWindow.isMaximized()?((t=this.widgetWindow.getWidgetBody()).style.width="100%",t.style.height="100%"):((t=this.widgetWindow.getWidgetBody()).style.width="900px",t.style.height="600px")}}
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regeneratorValues(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}}}throw new TypeError(_typeof(e)+" is not iterable")}function _regeneratorKeys(e){var t,n=Object(e),r=[];for(t in n)r.unshift(t);return function e(){for(;r.length;)if((t=r.pop())in n)return e.value=t,e.done=!1,e;return e.done=!0,e}}function _regenerator(){var y,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,a,i,s,l,c,u,d,h,t=t&&t.prototype instanceof m?t:m,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=n,u=r||[],d=!1,h={p:c=0,n:0,v:y,a:p,f:p.bind(y,4),d:function(e,t){return i=e,s=0,l=y,h.n=t,f}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(d&&1===t&&p(t,n),s=t,l=n;(g=s<2?y:l)||!d;){i||(s?s<3?(1<s&&(h.n=-1),p(s,l)):h.n=l:h.v=l);try{if(c=2,i){if(g=i[e=s?e:"next"]){if(!(g=g.call(i,l)))throw TypeError("iterator result is not an object");if(!g.done)return g;l=g.value,s<2&&(s=0)}else 1===s&&(g=i.return)&&g.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+e+"' method"),s=1);i=y}else if((g=(d=h.n<0)?l:o.call(a,h))!==f)break}catch(e){i=y,s=1,l=e}finally{c=1}}return{value:g,done:d}}),!0),t;function p(e,t){for(s=e,l=t,g=0;!d&&c&&!n&&g<u.length;g++){var n,r=u[g],o=h.p,a=r[2];3<e?(n=a===t)&&(l=r[(s=r[4])?5:s=3],r[4]=r[5]=y):r[0]<=o&&((n=e<2&&o<r[1])?(s=0,h.v=t,h.n=r[1]):o<a&&(n=e<3||r[0]>t||a<t)&&(r[4]=e,r[5]=t,h.n=a,s=0))}if(n||1<e)return f;throw d=!0,t}}var f={};function m(){}function o(){}function a(){}var g=Object.getPrototypeOf,e=[][t]?g(g([][t]())):(_regeneratorDefine2(g={},t,function(){return this}),g),i=a.prototype=m.prototype=Object.create(e);function s(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,n,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,n,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:s}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var n,r,o,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return o=!(r=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){o=!0,n=e},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw n}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function _asyncToGenerator(s){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=s.apply(e,i);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}function AIWidget(){DOUBLEFLAT,FLAT,SHARP,DOUBLESHARP;var o,t=[DOUBLEFLAT,FLAT,NATURAL,SHARP,DOUBLESHARP],n=["do","re","mi","fa","sol","la","ti","do"],s="electronic synth",l="";function E(e,t,n,r,o,a,i){n=toFraction(n),s=e.name;var s,r=((r=(r=r).accidentals.find(function(e){e=e.note.toUpperCase().replace(",","");return s=s.replace(",",""),e.toLowerCase()===s.toLowerCase()}))?s+("sharp"===r.acc?"♯":"flat"===r.acc?"♭":""):s).toUpperCase();null!=a&&(n[1]=i*a),o.push([t,["newnote",{collapsed:!0}],0,0,[t-1,t+1,t+4,t+8]],[t+1,"divide",0,0,[t,t+2,t+3]],[t+2,["number",{value:n[0]}],0,0,[t+1]],[t+3,["number",{value:n[1]}],0,0,[t+1]],[t+4,"vspace",0,0,[t,t+5]],[t+5,"pitch",0,0,[t+4,t+6,t+7,null]],[t+6,["notename",{value:r}],0,0,[t+5]],[t+7,["number",{value:(i=e.pitch,Math.floor(i/7)+4)}],0,0,[t+5]],[t+8,"hidden",0,0,[t,t+9]])}function L(e,t){for(var n=0;n<e.length;n++)if(e[n][0]===t)return n;return-1}this.timbreBlock,this.sampleArray,this.sampleData="",this.sampleName=s,this.samplePitch="sol",this.sampleOctave="4",this.pitchCenter=9,this.accidentalCenter=2,this.octaveCenter=4,this.sampleLength=1e3,this.pitchAnalysers={},this.pause=function(){o.stop()},this.resume=function(){this.playBtn.innerHTML='<img\n                src="header-icons/pause-button.svg" \n                title="'.concat(_("Pause"),'" \n                alt="').concat(_("Pause"),'" \n                height="').concat(32,'" \n                width="').concat(32,'" \n                vertical-align="middle"\n            >'),this.isMoving=!0},this._usePitch=function(e){e=n.indexOf(e);this.pitchCenter=-1==e?0:e},this._useAccidental=function(e){e=t.indexOf(e);this.accidentalCenter=-1===e?2:e},this._useOctave=function(e){this.octaveCenter=parseInt(e)},this.getSampleLength=function(){1333333<this.sampleData.length&&this.activity.errorMsg(_("Warning: Sample is bigger than 1MB."),this.timbreBlock)},this._parseABC=(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var n,i,r,s,l,c,u,o,a,d,h,p,y,f,m,g,v,b,A,k,B,w,S,x,C,T;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:n=[],i={},r={},s=0,c=((l=null)!=(o=null==(o=t.metaText)?void 0:o.title)?o:"title").toString().toLowerCase(),u=(null!=(o=null==(o=t.metaText)?void 0:o.instruction)?o:"guitar").toString().toLowerCase(),null!=(o=t.lines)&&o.forEach(function(e){null!=(e=e.staff)&&e.forEach(function(e,t){r.hasOwnProperty(t)||(r[t]={arrangedBlocks:[]}),r[t].arrangedBlocks.push(e)})}),o=_regenerator().m(function e(a){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:null!=(t=r[a].arrangedBlocks)&&t.forEach(function(r){i.hasOwnProperty(a)||(i[a]={meterNum:(null==r||null==(e=r.meter)||null==(e=e.value[0])?void 0:e.num)||4,meterDen:(null==r||null==(e=r.meter)||null==(e=e.value[0])?void 0:e.den)||4,keySignature:r.key,baseBlocks:[],startBlock:[[s,["start",{collapsed:!1}],100,100,[null,s+1,null]],[s+1,"print",0,0,[s,s+2,s+3]],[s+2,["text",{value:c}],0,0,[s+1]],[s+3,"setturtlename2",0,0,[s+1,s+4,s+5]],[s+4,["text",{value:"Voice ".concat(parseInt(a)+1," ")}],0,0,[s+3]],[s+5,"meter",0,0,[s+3,s+6,s+7,s+10]],[s+6,["number",{value:(null==r||null==(e=r.meter)||null==(e=e.value[0])?void 0:e.num)||4}],0,0,[s+5]],[s+7,"divide",0,0,[s+5,s+8,s+9]],[s+8,["number",{value:1}],0,0,[s+7]],[s+9,["number",{value:(null==r||null==(e=r.meter)||null==(e=e.value[0])?void 0:e.den)||4}],0,0,[s+7]],[s+10,"vspace",0,0,[s+5,s+11]],[s+11,"setkey2",0,0,[s+10,s+12,s+13,s+14]],[s+12,["notename",{value:r.key.root}],0,0,[s+11]],[s+13,["modename",{value:"m"==r.key.mode?"minor":"major"}],0,0,[s+11]],[s+14,"settimbre",0,0,[s+11,s+15,null,s+16]],[s+15,["voicename",{value:u}],0,0,[s+14]],[s+16,"hidden",0,0,[s+14,null]]],repeatBlock:[],repeatArray:[],nameddoArray:{}},s+=17);var e,o=[];r.voices.forEach(function(e){e.forEach(function(e){if("note"===e.el_type)null!==(null==e?void 0:e.startTriplet)&&void 0!==(null==e?void 0:e.startTriplet)&&(l=e.startTriplet),E(e.pitches[0],s,e.duration,r.key,o,l,i[a].meterDen),null!==(null==e?void 0:e.endTriplet)&&void 0!==(null==e?void 0:e.endTriplet)&&(l=null),s+=9;else if("bar"===e.el_type)if("bar_left_repeat"===e.type)i[a].repeatArray.push({start:i[a].baseBlocks.length,end:-1});else if("bar_right_repeat"===e.type){var t,n=i[a].repeatArray;for(t in n)-1==n[t].end&&(i[a].repeatArray[t].end=i[a].baseBlocks.length)}}),o[0][4][0]=s+3,o[o.length-1][4][1]=null,0!=i[a].baseBlocks.length&&(i[a].baseBlocks[i[a].baseBlocks.length-1][0][i[a].baseBlocks[i[a].baseBlocks.length-1][0].length-4][4][1]=s),o.push([s,["nameddo",{value:"V: ".concat(parseInt(a)+1," Line ").concat((null==(e=i[a])||null==(e=e.baseBlocks)?void 0:e.length)+1)}],0,0,[0===i[a].baseBlocks.length?null:i[a].baseBlocks[i[a].baseBlocks.length-1][0][i[a].baseBlocks[i[a].baseBlocks.length-1][0].length-4][0],null]],[s+1,["action",{collapsed:!1}],100,100,[null,s+2,s+3,null]],[s+2,["text",{value:"V: ".concat(parseInt(a)+1," Line ").concat((null==(e=i[a])||null==(e=e.baseBlocks)?void 0:e.length)+1)}],0,0,[s+1]],[s+3,"hidden",0,0,[s+1,o[0][0]]]),i[a].nameddoArray||(i[a].nameddoArray={}),i[a].nameddoArray[a]||(i[a].nameddoArray[a]=[]),i[a].nameddoArray[a].push(s),s+=4,n.push(o),i[a].baseBlocks.push([o])})});case 1:return e.a(2)}},e)}),C=_regeneratorKeys(r);case 1:if((T=C()).done){e.n=3;break}return T=T.value,e.d(_regeneratorValues(o(T)),2);case 2:e.n=1;break;case 3:for(d in a=[],i){i[d].startBlock[i[d].startBlock.length-3][4][2]=i[d].baseBlocks[0][0][i[d].baseBlocks[0][0].length-4][0],i[d].baseBlocks[0][0][i[d].baseBlocks[0][0].length-4][4][0]=i[d].startBlock[i[d].startBlock.length-3][0],x=i[d].repeatArray,h=_createForOfIteratorHelper(x);try{for(h.s();!(p=h.n()).done;)0==(y=p.value).start?(i[d].repeatBlock.push([s,"repeat",0,0,[i[d].startBlock[i[d].startBlock.length-3][0],s+1,i[d].nameddoArray[d][0],null===i[d].nameddoArray[d][y.end+1]?null:i[d].nameddoArray[d][y.end+1]]]),i[d].repeatBlock.push([s+1,["number",{value:2}],100,100,[s]]),i[d].startBlock[i[d].startBlock.length-3][4][2]=s,f=L(i[d].baseBlocks[0][0],i[d].nameddoArray[d][0]),m=L(i[d].baseBlocks[y.end][0],i[d].nameddoArray[d][y.end]),i[d].baseBlocks[y.end+1]&&i[d].baseBlocks[y.end+1][0]&&-1!=(g=L(i[d].baseBlocks[y.end+1][0],i[d].nameddoArray[d][y.end+1]))&&(i[d].baseBlocks[y.end+1][0][g][4][0]=s),i[d].baseBlocks[0][0][f][4][0]=s,i[d].baseBlocks[y.end][0][m][4][1]=null):(v=L(i[d].baseBlocks[y.start][0],i[d].nameddoArray[d][y.start]),b=L(i[d].baseBlocks[y.start-1][0],i[d].baseBlocks[y.start][0][v][4][0]),A=L(i[d].baseBlocks[y.end][0],i[d].baseBlocks[y.start][0][v][4][1]),(k=-1)==b&&(k=L(i[d].repeatBlock,i[d].baseBlocks[y.start][0][v][4][0])),i[d].baseBlocks[y.start][0][v][4][0],B=i[d].baseBlocks[y.start][0][v][0],w=i[d].nameddoArray[d][y.end+1],i[d].repeatBlock.push([s,"repeat",0,0,[i[d].baseBlocks[y.start][0][v][4][0],s+1,B,null===w?null:w]]),i[d].repeatBlock.push([s+1,["number",{value:2}],100,100,[s]]),-1!=b?i[d].baseBlocks[y.start-1][0][b][4][1]=s:i[d].repeatBlock[k][4][3]=s,-1!=A&&(i[d].baseBlocks[y.end][0][A][4][1]=null),i[d].baseBlocks[y.start][0][v][4][0]=s,null!=w&&(S=L(i[d].baseBlocks[y.end+1][0],w),i[d].baseBlocks[y.end+1][0][S][4][0]=s)),s+=2}catch(e){h.e(e)}finally{h.f()}x=i[d].baseBlocks.reduce(function(e,t){return e.concat(t)},[]),x=x.flat(),[].concat(_toConsumableArray(i[d].startBlock),_toConsumableArray(x)),a.push.apply(a,_toConsumableArray(i[d].startBlock)),a.push.apply(a,_toConsumableArray(x)),a.push.apply(a,_toConsumableArray(i[d].repeatBlock))}return this.activity.blocks.loadNewBlocks(a),this.activity.textMsg(_("New start block generated")),e.a(2,null)}},e,this)}));return function(e){return t.apply(this,arguments)}})(),this.showSampleTypeError=function(){this.activity.errorMsg(_("Upload failed: Sample is not a .wav file."),this.timbreBlock)},this.__save=function(){var t=this;new ABCJS.parseOnly(l).forEach(function(e){t._parseABC(e)})},this._saveSample=function(){this.__save()},this._get_save_lock=function(){return this._save_lock},this.init=function(e){var r=this;if(this.activity=e,this._directions=[],this._widgetFirstTimes=[],this._widgetNextTimes=[],this._firstClickTimes=null,this.isMoving=!1,this.pitchAnalysers={},this.activity.logo.synth.loadSynth(0,getVoiceSynthName(s)),this.reconnectSynthsToAnalyser(),this.pitchAnalysers={},this.running=!0,this.drawVisualIDs)for(var t=0,n=Object.keys(this.drawVisualIDs);t<n.length;t++){var o=n[t];cancelAnimationFrame(this.drawVisualIDs[o])}this.drawVisualIDs={};var a=window.widgetWindows.windowFor(this,"AI"),i=(this.widgetWindow=a,this.divisions=[],a.clear(),a.show(),this);a.onclose=function(){if(r.drawVisualIDs)for(var e=0,t=Object.keys(r.drawVisualIDs);e<t.length;e++){var n=t[e];cancelAnimationFrame(r.drawVisualIDs[n])}r.running=!1,docById("wheelDivptm").style.display="none",void 0!==r._pitchWheel&&r._pitchWheel.removeWheel(),void 0!==r._exitWheel&&r._exitWheel.removeWheel(),void 0!==r._accidentalsWheel&&r._accidentalsWheel.removeWheel(),void 0!==r._octavesWheel&&r._octavesWheel.removeWheel(),r.pitchAnalysers={},a.destroy()},a.onmaximize=this._scale.bind(this),this.playBtn=a.addButton("play-button.svg",32,_("Play")),this.playBtn.onclick=function(){r.isMoving?(r.pause(),r.playBtn.innerHTML='<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(32,'" \n                        width="').concat(32,'"\n                        vertical-align="middle"\n                    >'),r.isMoving=!1):""!=l&&(r.resume(),r._playABCSong())},this._save_lock=!1,a.addButton("export-chunk.svg",32,_("Save sample"),"").onclick=function(){i._get_save_lock()||(i._save_lock=!0,i._saveSample(),setTimeout(function(){i._save_lock=!1},1e3))},a.sendToCenter(),this.widgetWindow=a,this._scale(),this.activity.textMsg(_("AI Music")),this.pause(),a.sendToCenter()},this._addSample=function(){for(var e=0;e<CUSTOMSAMPLES.length;e++)if(CUSTOMSAMPLES[e][0]==this.sampleName)return;CUSTOMSAMPLES.push([this.sampleName,this.sampleData])},this._playABCSong=function(){var e,t=l,n=document.querySelector(".stop-audio"),r=ABCJS.renderAbc("*",t,{responsive:"resize"})[0];ABCJS.synth.supportsAudio()?(window.AudioContext=window.AudioContext||window.webkitAudioContext||navigator.mozAudioContext||navigator.msAudioContext,(e=new window.AudioContext).resume().then(function(){return(o=new ABCJS.synth.CreateSynth).init({visualObj:r,audioContext:e,millisecondsPerMeasure:r.millisecondsPerMeasure()}).then(function(e){return o.prime()}).then(function(e){return o.start(),Promise.resolve()}).catch(function(e){"NotSupported"===e.status?(n.setAttribute("style","display:none;"),document.querySelector(".audio-error").setAttribute("style","")):console.warn("synth error",e)})})):document.querySelector(".audio-error").setAttribute("style","")},this._playSample=function(){null!=this.sampleName&&""!=this.sampleName&&(this.reconnectSynthsToAnalyser(),this.activity.logo.synth.trigger(0,[220],this.sampleLength/1e3,"customsample_"+this.originalSampleName,null,null,!1))},this._waitAndPlaySample=function(){var t=this;return new Promise(function(e){setTimeout(function(){t._playSample(),e("played"),t._endPlaying()},500)})},this._playDelayedSample=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._waitAndPlaySample();case 1:return e.a(2)}},e,this)})),this._waitAndEndPlaying=function(){var t=this;return new Promise(function(e){setTimeout(function(){t.pause(),e("ended")},t.sampleLength)})},this._endPlaying=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._waitAndEndPlaying();case 1:return e.a(2)}},e,this)})),this.reconnectSynthsToAnalyser=function(){for(var e in[0,1])void 0===this.pitchAnalysers[e]&&(this.pitchAnalysers[e]=new Tone.Analyser({type:"waveform",size:8192}));for(var t in instruments[0]){var n=1;"electronic synth"===t&&(n=0,instruments[0][t].connect(this.pitchAnalysers[n])),t==="customsample_"+this.originalSampleName&&(n=1,instruments[0][t].connect(this.pitchAnalysers[n]))}},this._scale=function(){var e,t=this,n=document.getElementsByClassName("samplerCanvas");Array.prototype.forEach.call(n,function(e){t.widgetWindow.getWidgetBody().removeChild(e)}),n=this.widgetWindow.isMaximized()?(e=this.widgetWindow.getWidgetBody().getBoundingClientRect().width,this.widgetWindow.getWidgetFrame().getBoundingClientRect().height-70):(e=800,400),document.getElementsByTagName("canvas")[0].innerHTML="",this.makeCanvas(e,n,0,!0),this.reconnectSynthsToAnalyser()},this.makeCanvas=function(e,t){var n=document.createElement("div"),r=(this.widgetWindow.getWidgetBody().appendChild(n),document.createElement("div")),o=(r.style.overflowY="auto",r.style.height=t+"px",r.style.border="1px solid #ccc",r.style.marginBottom="8px",r.style.marginLeft="8px",r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",n.appendChild(r),document.createElement("textarea")),a=(o.style.height=t+"px",o.style.width=e+"px",o.className="samplerTextarea",o.style.marginLeft="20px",o.style.fontSize="20px",o.style.padding="10px",r.appendChild(o),document.createElement("div")),i=(a.style.marginBottom="10px",a.style.display="flex",a.style.justifyContent="center",a.style.marginTop="8px",["Dance tune","Fiddle jig","Nice melody","Fun song","Simple canon"].forEach(function(e){var t=document.createElement("span");t.textContent=e,t.style.marginRight="20px",t.style.cursor="pointer",t.style.marginRight="4px",t.style.fontSize="20px",t.style.color="blue",t.style.backgroundColor="rgb(227 162 162 / 80%)",t.style.padding="10px",t.style.borderRadius="5px",t.onclick=function(){i.value=e,a.style.display="none"},a.appendChild(t)}),r.appendChild(a),document.createElement("input")),s=(i.type="text",i.className="inputField",i.placeholder="Enter text here",i.style.fontSize="20px",i.style.marginRight="2px",i.style.marginLeft="64px",i.style.padding="10px",i.style.marginBottom="10px",i.style.width="60%",n.appendChild(i),i.addEventListener("click",function(){i.focus()}),document.createElement("button"));s.className="submitButton",s.textContent="Submit",s.style.fontSize="20px",s.style.padding="10px 20px",s.style.marginBottom="20px",n.appendChild(s),s.onclick=function(){var e=i.value.trim();""!==e&&(e="\n            Generate an ABC notation song based on the following description:\n            \n            ".concat(e,'\n            \n            {\n                "abc": "\n            X: {index}\n            T: {title}\n            M: {meter}\n            L: {length}\n            Q: {tempo}\n            K: {key}\n            {notes}\n                "\n            }\n            \n            IMPORTANT:\n            - Ensure that the response is only in ABC notation format.\n            - Use only notes, not chords.\n            - Do not provide any other content or formats, such as guitar tablature or chord diagrams.\n            - If your response includes other formats, please only output the ABC notation content within the curly braces.\n            - Do not add other text at the bottom such as "Let me know if you need any changes! "\n            '),e=JSON.stringify({messages:[{role:"system",content:"You are a helpful assistant that generates ABC notation songs."},{role:"user",content:e}],model:"llama3-8b-8192"}),s.disabled=!0,o.value="Loading...",fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(env.GROQ_API_KEY)},body:e}).then(function(e){return e.json()}).then(function(e){var e=(null==(e=e.choices[0].message)?void 0:e.content)||"",t=e.indexOf("X:"),e=e.substring(t),t=e.indexOf("}");-1!==t?e=e.substring(0,t+1):console.warn("No closing brace found in the response.");t=(e=(e=e.replace(/"|\}/g,"").trim()).replace(/(X:|T:|M:|L:|Q:|K:)/g,"\n$1").replace(/\n\s+/g,"\n").trim()).split("\n").map(function(e){return e.trim()}).map(function(e){return e.startsWith("X:")||e.startsWith("T:")||e.startsWith("M:")||e.startsWith("L:")||e.startsWith("Q:")||e.startsWith("K:")?e+"\n":e}).join("");l=t,o.value=l}).catch(function(e){console.error("Error:",e),o.value="An error occurred: "+e.message}).finally(function(){s.disabled=!1}))},o.addEventListener("input",function(){l=o.value})}}
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var l=0;l<t.length;l++){var i=t[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,l){return t&&_defineProperties(e.prototype,t),l&&_defineProperties(e,l),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,l){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var l=e[Symbol.toPrimitive];if(void 0===l)return("string"===t?String:Number)(e);l=l.call(e,t||"default");if("object"!=_typeof(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}var Arpeggio=(()=>{function p(){_classCallCheck(this,p),this.notesToPlay=[],this._blockMap=[],this.defaultCols=p.DEFAULTCOLS}return _createClass(p,[{key:"init",value:function(e){for(var t=this,l=(this._activity=e,this._rowLabels=[],this._rowBlocks=[],getTemperament(this._activity.logo.synth.whichTemperament())),i=0;i<l.pitchNumber+1;i++)this._rowBlocks.push(i),this._rowLabels.push((l.pitchNumber-i).toString());this._modeNumbers=getModeNumbers(keySignatureToMode(this._activity.turtles.ithTurtle(0).singer.keySignature)[1]).split(" "),this._playing=!1,this._playList=[],this._colBlocks=[];for(var o=0;o<this.defaultCols;o++)this._colBlocks.push(o+1);for(var n,s,r=window.innerWidth,a=(this._cellScale=r/1200,window.widgetWindows.windowFor(this,"arpeggio")),c=((this.widgetWindow=a).clear(),a.show(),this.playButton=a.addButton("play-button.svg",p.ICONSIZE,_("Play")),this.playButton.onclick=function(){t._playing=!t._playing,t._activity.logo.turtleDelay=0,t._playAll()},this._save_lock=!1,a.addButton("export-chunk.svg",p.ICONSIZE,_("Save")).onclick=function(){t._get_save_lock()||(t._save_lock=!0,t._save(),setTimeout(function(){t._save_lock=!1},1e3))},a.addButton("erase-button.svg",p.ICONSIZE,_("Clear")).onclick=function(){t._clear()},this.arpeggioDiv=document.createElement("div"),a.getWidgetBody().append(this.arpeggioDiv),a.getWidgetBody().style.height="400px",a.getWidgetBody().style.width="400px",this.arpeggioDiv),h=(c.style.display="inline",c.style.visibility="visible",c.style.border="0px",c.innerHTML="",a.onclose=function(){c.style.visibility="hidden",t._activity.hideMsgs(),a.destroy()},this.widgetWindow.onmaximize=this._scale,c.innerHTML='<div id="arpeggioOuterDiv"><div id="arpeggioInnerDiv"><table cellpadding="0px" id="arpeggioTable"></table></div></div>',docById("arpeggioTable")),g=0,d=0;d<this._rowLabels.length;d++)(s=(n=h.insertRow()).insertCell()).style.backgroundColor=platformColor.labelColor,s.style.fontSize=50*this._cellScale+"%",s.style.height=p.CELLSIZE+"px",s.style.width=p.CELLSIZE+"px",s.style.minWidth=0,s.style.maxWidth=0,s.className="headcol",s.innerHTML=this._rowLabels[g],n.insertCell().innerHTML='<table cellpadding="0px" id="arpeggioCellTable'.concat(g,'">\n                    <tr></tr>\n                </table>'),docById("arpeggioCellTable"+g).insertRow().setAttribute("id","arpeggio"+g),g+=1;(s=(n=h.insertRow()).insertCell()).style.backgroundColor=platformColor.labelColor,s.style.fontSize=50*this._cellScale+"%",s.style.height=p.CELLSIZE+"px",s.style.width=p.CELLSIZE+"px",s.style.minWidth=p.CELLSIZE+"px",s.style.maxWidth=s.style.minWidth,s.className="headcol",s.innerHTML="";var r=docById("arpeggioOuterDiv"),y=(r.style.height=a.getWidgetBody().style.height,r.style.width=a.getWidgetBody().style.width,r.style.marginLeft="0px",docById("arpeggioInnerDiv"));y.style.height=a.getWidgetBody().style.height,y.style.width=a.getWidgetBody().style.width,y.style.marginLeft="0px",n.insertCell().innerHTML='<table cellpadding="0px" id="arpeggioNoteTable"><tr></tr></table>';for(var u=0;u<this.defaultCols;u++)this._addNote(u);a.onmaximize=function(){a._maximized?(a.getWidgetBody().style.position="absolute",a.getWidgetBody().style.height="calc(100vh - 80px)",a.getWidgetBody().style.width="200vh",docById("arpeggioOuterDiv").style.height="calc(100vh - 80px)",docById("arpeggioOuterDiv").style.width="calc(200vh - 64px)",docById("arpeggioInnerDiv").style.width="calc(200vh - 64px)",docById("arpeggioInnerDiv").style.height="calc(100vh - 80px)",a.getWidgetBody().style.left="70px"):(a.getWidgetBody().style.position="relative",a.getWidgetBody().style.left="0px",a.getWidgetBody().style.height="400px",a.getWidgetBody().style.width="400px",y.style.height=a.getWidgetBody().style.height,y.style.width=a.getWidgetBody().style.width)},this.makeClickable(),e.textMsg(_("Click in the grid to add steps to the arpeggio."),3e3)}},{key:"clearBlocks",value:function(){this._rowBlocks=[],this._colBlocks=[]}},{key:"addNode",value:function(e,t){for(var l,i=0;i<this._blockMap.length;i++)if((l=this._blockMap[i])[0]===e&&l[1]===t)return;this._blockMap.push([e,t])}},{key:"removeNode",value:function(e,t){for(var l,i=0;i<this._blockMap.length;i++)(l=this._blockMap[i])[0]===e&&l[1]===t&&(this._blockMap[i]=[-1,-1])}},{key:"_get_save_lock",value:function(){return this._save_lock}},{key:"_addButton",value:function(e,t,l,i){var o=e.insertCell(-1);return o.innerHTML='&nbsp;&nbsp;<img \n                src="header-icons/'.concat(t,'" \n                title="').concat(i,'" \n                alt="').concat(i,'" \n                height="').concat(l,'" \n                width="').concat(l,'" \n                vertical-align="middle" \n                align-content="center"\n            >&nbsp;&nbsp;'),o.style.width=p.BUTTONSIZE+"px",o.style.minWidth=o.style.width,o.style.maxWidth=o.style.width,o.style.height=o.style.width,o.style.minHeight=o.style.height,o.style.maxHeight=o.style.height,o.style.backgroundColor=platformColor.selectorBackground,o.onmouseover=function(){o.style.backgroundColor=platformColor.selectorBackgroundHOVER},o.onmouseout=function(){o.style.backgroundColor=platformColor.selectorBackground},o}},{key:"_inMode",value:function(e){return this._modeNumbers.includes(e.toString())}},{key:"_rowInMode",value:function(e){e=(this._rowLabels.length-e-1)%(this._rowLabels.length-1);return this._inMode(e)}},{key:"_getBackgroundColor",value:function(e){return this._rowInMode(e)?platformColor.selectorSelected:platformColor.selectorBackground}},{key:"_addNote",value:function(e){for(var t=(e+1).toString(),l=docById("arpeggioTable"),i=0;i<l.rows.length-1;i++)n=docById("arpeggioCellTable"+i).rows[0],(o=n.insertCell()).style.height=p.CELLSIZE+"px",o.width=p.CELLSIZE,o.style.width=o.width,o.style.minWidth=o.style.width,o.style.maxWidth=o.style.width,o.style.backgroundColor=this._getBackgroundColor(i),o.style.border="2px solid white",o.style.borderRadius="10px",o.setAttribute("id",i+","+e),o.onmouseover=function(){"black"!==o.style.backgroundColor&&(o.style.backgroundColor=platformColor.selectorSelected)},o.onmouseout=function(){"black"!==o.style.backgroundColor&&(o.style.backgroundColor=platformColor.selectorBackground)};var o,n=docById("arpeggioNoteTable").rows[0];(o=n.insertCell()).height=p.CELLSIZE+1+"px",o.width=p.CELLSIZE,o.style.width=o.width+"px",o.style.minWidth=o.style.width,o.style.maxWidth=o.style.width,o.style.height=p.CELLSIZE+"px",o.style.fontSize=Math.floor(50*this._cellScale)+"%",o.style.lineHeight="100%",o.setAttribute("id",e),o.className="headcol",o.innerHTML=t,o.style.backgroundColor=platformColor.selectorBackground}},{key:"makeClickable",value:function(){for(var e,t,l=this,i=docById("arpeggioTable"),o=docById("arpeggioNoteTable"),n=0;n<i.rows.length-1;n++)for(var s=docById("arpeggioCellTable"+n).rows[0],r=0;r<s.cells.length;r++)e=s.cells[r],o.rows[0].cells[r],e.onclick=function(e){var e=e.target,t=e.id.split(",");"black"===e.style.backgroundColor?(e.style.backgroundColor=l._getBackgroundColor(Number(t[0])),l._setCell(t[1],t[0],!1)):(l._clearColumn(t[1],t[0]),e.style.backgroundColor="black",l._setCell(t[1],t[0],!0))};for(var a=0;a<this._blockMap.length;a++)if(-1!==(t=this._blockMap[a])[0]){for(var c=this._rowBlocks.indexOf(t[0]),h=-1,g=0;g<this._colBlocks.length;g++)if(this._colBlocks[g]===t[1]){h=g;break}-1===h||c<0||null!=(e=(s=docById("arpeggioCellTable"+c).rows[0]).cells[h])&&(e.style.backgroundColor="black",this.__playCell(c,h,e,!1))}}},{key:"_scale",value:function(){var e=this.getWidgetFrame().offsetHeight-this.getDragElement().offsetHeight,t=this.getWidgetBody(),e=this.isMaximized?e/t.offsetHeight:1,l=(t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.children[0].style.display="flex",t.children[0].style.flexDirection="column",t.children[0].style.alignItems="center",this.getWidgetBody().getElementsByTagName("svg")[0]);l.style.pointerEvents="none",l.setAttribute("height","".concat(400*e,"px")),l.setAttribute("width","".concat(400*e,"px")),setTimeout(function(){l.style.pointerEvents="auto"},100)}},{key:"_playAll",value:function(){var e=this.playButton;if(this._playing){e.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/stop-button.svg" \n                    title="'.concat(_("Stop"),'" \n                    alt="').concat(_("Stop"),'" \n                    height="').concat(p.ICONSIZE,'" \n                    width="').concat(p.ICONSIZE,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;'),this._activity.logo.synth.stop();var t=this.__makePairsList();this._playList=[];for(var l=0;l<this.notesToPlay.length;l++)for(var i=this.notesToPlay[l][1],o=this.notesToPlay[l][0].slice(0,-1),n=Number(this.notesToPlay[l][0].substr(this.notesToPlay[l][0].length-1)),s=0;s<t.length;s++)-1===t[s][0]?this._playList.push(["",i]):this._playList.push([getNote(o,n,this._rowLabels.length-t[s][0]-1,this._activity.turtles.ithTurtle(0).singer.keySignature,!1,null,this._activity.errorMsg),i]);this.__playNote(0)}else e.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="').concat(p.ICONSIZE,'" \n                    width="').concat(p.ICONSIZE,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;'),this._playing=!1}},{key:"__makePairsList",value:function(){for(var e=[],t=docById("arpeggioTable"),l=0;l<this.defaultCols;l++){for(var i=[-1,l],o=0;o<t.rows.length-1;o++)if("black"===docById("arpeggioCellTable"+o).rows[0].cells[l].style.backgroundColor){i=[o,l];break}e.push(i)}return e}},{key:"__playNote",value:function(e){var t=this;e<this._playList.length?(0<this._playList[e][0].length&&this._activity.logo.synth.trigger(0,this._playList[e][0][0].replace(/♭/g,"b").replace(/♯/g,"#")+this._playList[e][0][1],this._playList[e][1],"default",null,null,null),setTimeout(function(){t.__playNote(e+1)},2600*this._playList[e][1])):(this.playButton.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="').concat(p.ICONSIZE,'" \n                    width="').concat(p.ICONSIZE,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;'),this._playing=!1)}},{key:"_setCell",value:function(e,t,l){var i,e=Number(e),o=Number(t),n=docById("arpeggioCellTable"+o).rows[0],t=this._rowBlocks[o],e=this._colBlocks[e];l?this.addNode(t,e):this.removeNode(t,e);for(var s=0;s<n.cells.length;s++)"black"===(i=n.cells[s]).style.backgroundColor&&this.__playCell(o,s,i,l)}},{key:"__playCell",value:function(e,t,l,i){var o;i&&(i=0===this.notesToPlay.length?(o="C",4):(o=this.notesToPlay[0][0].slice(0,-1),Number(this.notesToPlay[0][0].substr(this.notesToPlay[0][0].length-1))),i=(o=getNote(o,i,this._rowLabels.length-e-1,this._activity.turtles.ithTurtle(0).singer.keySignature,!1,null,this._activity.errorMsg))[0]+o[1],this._activity.logo.synth.trigger(0,i.replace(/♭/g,"b").replace(/♯/g,"#"),this.notesToPlay[0][1],"default",null,null,null))}},{key:"_clearColumn",value:function(e,t){for(var l,i=docById("arpeggioTable"),o=0;o<i.rows.length-1;o++)o!==t&&"black"===(l=docById("arpeggioCellTable"+o).rows[0].cells[e]).style.backgroundColor&&(l.style.backgroundColor=this._getBackgroundColor(o),this._setCell(e,o,!1))}},{key:"_clear",value:function(){for(var e,t=docById("arpeggioTable"),l=0;l<t.rows.length-1;l++)for(var i=docById("arpeggioCellTable"+l).rows[0],o=0;o<i.cells.length;o++)"black"===(e=i.cells[o]).style.backgroundColor&&(e.style.backgroundColor=this._getBackgroundColor(l),this._setCell(o,l,!1))}},{key:"_save",value:function(){for(var e=this.__makePairsList(),t=[],l=0;l<e.length;l++)if(-1===e[l][0])t.push(["-","-"]);else{var i=this._rowBlocks.length-e[l][0]-1;if(this._inMode(i))t.push([this._modeNumbers.indexOf(i.toString()),0]);else if(0===e[l][0])t.push([this._modeNumbers.length,0]);else for(var o=1;0<=i-o;){if(this._inMode(i-o)){t.push([this._modeNumbers.indexOf((i-o).toString()),o]);break}o+=1}}setCustomChord(t);this._activity.blocks.loadNewBlocks([[0,"arpeggio",100,100,[null,1,2,11]],[1,["chordname",{value:"custom"}],0,0,[0]],[2,["newnote",{collapsed:!1}],0,0,[0,3,6,10]],[3,"divide",0,0,[2,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:12}],0,0,[3]],[6,"vspace",0,0,[2,7]],[7,"pitch",0,0,[6,8,9,null]],[8,["solfege",{value:"do"}],0,0,[7]],[9,["number",{value:4}],0,0,[7]],[10,"hidden",0,0,[2,null]],[11,"hidden",0,0,[0,null]]])}}])})();_defineProperty(Arpeggio,"BUTTONDIVWIDTH",295),_defineProperty(Arpeggio,"CELLSIZE",28),_defineProperty(Arpeggio,"BUTTONSIZE",53),_defineProperty(Arpeggio,"ICONSIZE",32),_defineProperty(Arpeggio,"DEFAULTCOLS",4);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var i;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(i="Object"===(i={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=Array(e);i<e;i++)o[i]=t[i];return o}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var HelpWidget=(()=>_createClass(function t(e,i){var o=this,a=(_classCallCheck(this,t),this.activity=e,this.beginnerBlocks=[],this.advancedBlocks=[],this.appendedBlockList=[],this.index=0,this.isOpen=!0,window.widgetWindows.windowFor(this,"help","help",!1));a.getWidgetBody().style.maxHeight="70vh",(this.widgetWindow=a).clear(),a.show(),a.onclose=function(){o.isOpen=!1,document.onkeydown=e.__keyPressed,a.destroy()},this._helpDiv=document.createElement("div"),setTimeout(function(){return o._setup(i,0)},0),setTimeout(this.widgetWindow.sendToCenter,50)},[{key:"_setup",value:function(t,e){var i,o,a=this;this._helpDiv.style.width="100%";if(this._helpDiv.insertAdjacentHTML("afterbegin",'\n                    <div id="right-arrow" class="hover" tabindex="-1"></div>\n                    <div id="left-arrow" class="hover" tabindex="-1"></div>\n                    <div id="helpButtonsDiv" tabindex="-1"></div>\n                    <div id="helpBodyDiv" tabindex="-1"></div>\n                         '),this.widgetWindow.getWidgetBody().append(this._helpDiv),t?(null!==this.activity.blocks.activeBlock.name&&(this.activity.blocks.blockList[this.activity.blocks.activeBlock].protoblock.staticLabels[0],0==e?this.widgetWindow.updateTitle(_("Take a tour")):this.widgetWindow.updateTitle(HELPCONTENT[e][0])),(o=document.getElementById("right-arrow")).style.display="none",o.classList.remove("hover"),(i=document.getElementById("left-arrow")).style.display="none",i.classList.remove("hover")):(0==e?this.widgetWindow.updateTitle(_("Take a tour")):this.widgetWindow.updateTitle(HELPCONTENT[e][0]),(o=document.getElementById("right-arrow")).style.display="block",o.classList.add("hover"),(i=document.getElementById("left-arrow")).style.display="block",i.classList.add("hover"),document.onkeydown=function(t){"ArrowLeft"===t.key?i.click():"ArrowRight"===t.key&&o.click()},n=docById("left-arrow"),0===e&&i.classList.add("disabled"),n.onclick=function(){0<e&&(e-=1,i.classList.remove("disabled"),0==e?a.widgetWindow.updateTitle(_("Take a tour")):a.widgetWindow.updateTitle(HELPCONTENT[e][0]),a._showPage(e)),0===e&&i.classList.add("disabled")},(n=docById("right-arrow")).onclick=function(){e>=HELPCONTENT.length-1||(e+=1,i.classList.remove("disabled"),a.widgetWindow.updateTitle(HELPCONTENT[e][0]),a._showPage(e))}),t){if(null!==this.activity.blocks.activeBlock.name){var n=this.activity.blocks.blockList[this.activity.blocks.activeBlock].name,t=document.createElement("div"),c=(t.classList.add("icon-container"),t.insertAdjacentHTML("afterbegin",'<a class="tooltipped"\n                        data-toggle="tooltip"\n                        title="Show Palette containing the block"\n                        data-position="bottom">\n                      <i style="margin-right: 10px" id="findIcon" class="material-icons md-48">search</i>\n                    </a>\n                    '),this.activity.blocks.blockList[this.activity.blocks.activeBlock].protoblock.helpString);if(c){var l=docById("helpBodyDiv"),r=(l.style.height="70vh","");if(1<c.length){var s=c[1],d=localStorage.languagePreference;switch(d=void 0===d?navigator.language:d){case"ja":"kana"==localStorage.kanaPreference?s+="-kana":s+="-ja";break;case"es":s+="-es";break;case"pt":s+="-pt"}d="Docs/".concat(s,"/").concat(n,"_block.svg");r+='<figure style="width:100%;"><img style="max-width:100%;" src='.concat(d,"></figure>")}r+="<p>".concat(c[0],"</p>");t.insertAdjacentHTML("afterbegin",'<i style="margin-right: 10px" id="loadButton" data-toggle="tooltip" title="Load this block" class="material-icons md-48">get_app</i>'),l.insertAdjacentHTML("afterbegin",r),this.activity.blocks.blockList[this.activity.blocks.activeBlock].protoblock.beginnerModeBlock||t.insertAdjacentHTML("beforeend",'<a class="tooltipped"\n                        data-toggle="tooltip"\n                        title="This block is only available in advance mode"\n                        data-position="bottom">\n                      <i id="advIconText" class="material-icons md-48">star</i>\n                     </a>\n                    '),l.append(t);var p=this.activity.blocks.palettes.getProtoNameAndPalette(n),d=docById("loadButton");null!==d&&(d.onclick=function(){var t,e,i;c.length<4?(i=p[0],e=p[1],t=p[2],Object.prototype.hasOwnProperty.call(a.activity.blocks.protoBlockDict,t)&&a.activity.blocks.palettes.dict[e].makeBlockFromSearch(i,t,function(t){a.activity.blocks.moveBlock(t,100,100)})):"string"==typeof c[3]?(e=getMacroExpansion(a.activity,c[3],100,100),a.activity.blocks.loadNewBlocks(e)):(i=c[3],a.activity.blocks.loadNewBlocks(i))}),docById("findIcon").onclick=function(){a.activity.blocks.palettes.showPalette(p[1])}}}}else docById("helpBodyDiv").style.height="325px",docById("helpBodyDiv").style.width="345px",this._showPage(e);this.widgetWindow.takeFocus()}},{key:"_showPage",value:function(t){var e,i=this,o=docById("helpBodyDiv"),a=(o.innerHTML="",HELPCONTENT.length),a="".concat(t+1,"/").concat(a),n=docById("right-arrow"),c=docById("left-arrow"),n=(n.classList.toggle("disabled",t===HELPCONTENT.length-1),c.classList.toggle("disabled",0===t),""),n=[_("Welcome to Music Blocks"),_("Meet Mr. Mouse!"),_("Guide"),_("About"),_("Congratulations.")].includes(HELPCONTENT[t][0])?'<figure>&nbsp;<img src=" '.concat(HELPCONTENT[t][2],'"></figure>'):'<figure>&nbsp;<img src=" '.concat(HELPCONTENT[t][2],'" width="64px" height="64px"></figure>');n+='<h1 class="heading">'.concat(HELPCONTENT[t][0],'</h1> \n         <p class="description">').concat(HELPCONTENT[t][1],"</p>\n         <p>").concat(a,"</p>"),3<HELPCONTENT[t].length&&(c=HELPCONTENT[t][3],n+='<p><a href="'.concat(c,'" target="_blank">').concat(HELPCONTENT[t][4],"</a></p>")),[_("Congratulations.")].includes(HELPCONTENT[t][0])?docById("right-arrow").onclick=function(){i._prepareBlockList()}:(a=docById("right-arrow"),e=docById("left-arrow"),a.onclick=function(){t>=HELPCONTENT.length-1||(t+=1,e.classList.remove("disabled"),i.widgetWindow.updateTitle(HELPCONTENT[t][0]),i._showPage(t))},0===t&&e.classList.add("disabled"),e.onclick=function(){0<t&&(t-=1,e.classList.remove("disabled"),0==t?i.widgetWindow.updateTitle(_("Take a tour")):i.widgetWindow.updateTitle(HELPCONTENT[t][0]),i._showPage(t)),0===t&&e.classList.add("disabled")}),o.style.color="#505050",o.insertAdjacentHTML("afterbegin",n),this.widgetWindow.takeFocus()}},{key:"_prepareBlockList",value:function(){var t,e,i;for(e in this.activity.blocks.protoBlockDict)!0===this.activity.blocks.protoBlockDict[e].beginnerModeBlock&&void 0!==this.activity.blocks.protoBlockDict[e].helpString&&0!==this.activity.blocks.protoBlockDict[e].helpString.length&&this.beginnerBlocks.push(e);for(i in this.activity.blocks.protoBlockDict)!1===this.activity.blocks.protoBlockDict[i].beginnerModeBlock&&void 0!==this.activity.blocks.protoBlockDict[i].helpString&&0!==this.activity.blocks.protoBlockDict[i].helpString.length&&this.advancedBlocks.push(i);(t=this.appendedBlockList).push.apply(t,_toConsumableArray(this.beginnerBlocks)),(t=this.appendedBlockList).push.apply(t,_toConsumableArray(this.advancedBlocks)),this._blockHelp(this.activity.blocks.protoBlockDict[this.appendedBlockList[0]])}},{key:"_blockHelp",value:function(t){var o=this,e=window.widgetWindows.windowFor(this,"help","help"),e=((this.widgetWindow=e).clear(),this._helpDiv=document.createElement("div"),this._helpDiv.style.height="70vh",this._helpDiv.insertAdjacentHTML("afterbegin",'<div id="right-arrow" class="hover" tabindex="-1"></div><div id="left-arrow" class="hover" tabindex="-1"></div><div id="helpButtonsDiv" tabindex="-1"></div><div id="helpBodyDiv" tabindex="-1"></div>'),this.widgetWindow.getWidgetBody().append(this._helpDiv),docById("right-arrow")),i=docById("right-arrow"),a=docById("left-arrow");if(document.onkeydown=function(t){"ArrowLeft"===t.key?a.click():"ArrowRight"===t.key&&i.click()},this.index==this.appendedBlockList.length-1&&i.classList.add("disabled"),e.onclick=function(){o.index!==o.appendedBlockList.length-1&&(o.index+=1),o._blockHelp(o.activity.blocks.protoBlockDict[o.appendedBlockList[o.index]])},(e=docById("left-arrow")).onclick=function(){var t;0==o.index?(t=window.widgetWindows.windowFor(o,"help","help"),(o.widgetWindow=t).clear(),o._helpDiv=document.createElement("div"),o._setup(!1,HELPCONTENT.length-1)):(--o.index,o._blockHelp(o.activity.blocks.protoBlockDict[o.appendedBlockList[o.index]]))},null!==t.name&&(e=t.staticLabels[0],this.widgetWindow.updateTitle(_(e))),null!==t.name){var n=t.name,e=document.createElement("div"),c=(e.classList.add("icon-container"),t.helpString),l=docById("helpBodyDiv");if(l.style.height="70vh",c){var r="";if(1<c.length){c[1];var s=localStorage.languagePreference;switch(s=void 0===s?navigator.language:s){case"ja":"kana"==localStorage.kanaPreference?0:0;break;case"es":0;break;case"pt":0}s="Docs/documentation/".concat(n,"_block.svg");r+='<figure class="blockImage-wrapper"><img class="blockImage" src="'.concat(s,'"></figure>')}r+='<p class="message">'.concat(c[0],"</p>"),l.insertAdjacentHTML("afterbegin",r);e.insertAdjacentHTML("afterbegin",'<i style="margin-right: 10px" id="loadButton" data-toggle="tooltip" title="Load this block" class="material-icons md-48">get_app</i>'),e.insertAdjacentHTML("beforeend",'<a class="tooltipped"\n                    data-toggle="tooltip"\n                    title="Show Palette containing the block"\n                    data-position="bottom">\n                    <i style="margin-right: 10px"\n                        id="findIcon"\n                        class="material-icons md-48">search\n                    </i>\n                 </a>\n                '),t.beginnerModeBlock||e.insertAdjacentHTML("beforeend",'<a class="tooltipped"\n                    data-toggle="tooltip"\n                    title="This block is only available in advance mode"\n                    data-position="bottom">\n                     <i id="advIconText"\n                        class="material-icons md-48">star\n                     </i>\n                 </a>\n                '),l.append(e);docById("findIcon").onclick=function(){t.palette.palettes.showPalette(t.palette.name)};s=docById("loadButton");null!==s&&(s.onclick=function(){var t,e,i;c.length<4?(i=(t=o.activity.blocks.palettes.getProtoNameAndPalette(n))[0],e=t[1],t=t[2],Object.prototype.hasOwnProperty.call(o.activity.blocks.protoBlockDict,t)&&o.activity.blocks.palettes.dict[e].makeBlockFromSearch(i,t,function(t){o.activity.blocks.moveBlock(t,100,100)})):"string"==typeof c[3]?(e=getMacroExpansion(o.activity,c[3],100,100),o.activity.blocks.loadNewBlocks(e)):(i=c[3],o.activity.blocks.loadNewBlocks(i))})}}this.widgetWindow.takeFocus()}},{key:"showPageByName",value:function(t){for(var e=0;e<HELPCONTENT.length;e++)HELPCONTENT[e].includes(t)&&this._showPage(e)}}]))();_defineProperty(HelpWidget,"ICONSIZE",32);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var JSEditor=(()=>{function r(e){_classCallCheck(this,r),this.activity=e,this.isOpen=!0,this._showingHelp=!1,this.widgetWindow=window.widgetWindows.windowFor(this,"JavaScript Editor","JavaScript Editor"),this.widgetWindow.clear(),this.widgetWindow.show(),this.widgetWindow.setPosition(160,132),this._editor=document.createElement("div"),this._jar=null,this._code=null,this._codeBck=null,this._currentStyle=0,this._styles=["dracula","github","railscasts","vs"].map(function(e){var t=document.createElement("link");return t.href="././lib/codejar/styles/".concat(e,".min.css"),t.rel="stylesheet",t.disabled="true",document.head.appendChild(t),t}),this._styles[this._currentStyle].removeAttribute("disabled"),this._addErrorStyles(),this._setup(),this._setLinesCount(this._code)}return _createClass(r,[{key:"_addErrorStyles",value:function(){var e;document.getElementById("js-error-styles")||((e=document.createElement("style")).id="js-error-styles",e.textContent="\n            .error {\n                background-color: #ff4444 !important;\n                color: white !important;\n                border-radius: 2px;\n                padding: 1px 2px;\n                position: relative;\n            }\n            \n            .hljs-keyword {\n                color: #007acc !important;\n                font-weight: bold;\n            }\n            \n            .hljs-built_in {\n                color: #00d4aa !important;\n            }\n            \n            .hljs-title.function_ {\n                color: #ffcc00 !important;\n            }\n            \n            .hljs-number {\n                color: #4ec9b0 !important;\n            }\n            \n            .hljs-string {\n                color: #ff8c00 !important;\n            }\n            \n            .hljs-subst {\n                color: #ff8c00 !important;\n                background-color: rgba(255, 140, 0, 0.1) !important;\n            }\n            \n            .hljs-comment {\n                color: #57a64a !important;\n                font-style: italic;\n            }\n            \n            .hljs-title.class_ {\n                color: #c586c0 !important;\n            }\n            \n            .hljs-variable {\n                color: #4fc1ff !important;\n            }\n            \n            .hljs-params {\n                color: #4fc1ff !important;\n            }\n            \n            .hljs-property {\n                color: #ff79c6 !important;\n            }\n            \n            .hljs-literal {\n                color: #007acc !important;\n            }\n            \n            .hljs-type {\n                color: #00d4aa !important;\n            }\n            \n            .hljs-operator {\n                color: #ffffff !important;\n            }\n            \n            .hljs-punctuation {\n                color: #cccccc !important;\n            }\n            \n            .hljs-regexp {\n                color: #ff5555 !important;\n            }\n            \n            .hljs-symbol {\n                color: #ffcc00 !important;\n            }\n        ",document.head.appendChild(e))}},{key:"_highlightErrors",value:function(t){t.querySelectorAll(".error").forEach(function(e){var t=e.textContent;e.replaceWith(t)});try{var e=t.textContent;acorn.parse(e,{ecmaVersion:2020})}catch(e){void 0!==e.pos&&this._markErrorAtPosition(t,e.pos,e.message),r.logConsole("Syntax Error at position ".concat(e.pos,": ").concat(e.message))}}},{key:"_markErrorAtPosition",value:function(e,t,o){for(var n=e.textContent,i=t,s=t;0<i;){var r=n.charAt(i-1);if(" "===r||"\n"===r||"\t"===r||";"===r||"{"===r||"}"===r||"("===r||")"===r||","===r)break;i--}for(;s<n.length;){var l=n.charAt(s);if(" "===l||"\n"===l||"\t"===l||";"===l||"{"===l||"}"===l||"("===l||")"===l||","===l)break;s++}i===s&&(s=Math.min(i+1,n.length)),this._markErrorSpan(e,i,s,o)}},{key:"_markErrorSpan",value:function(e,t,o,n){var i=e.textContent,s=i.substring(t,o),t=i.substring(0,t),i=i.substring(o),o=t+'<span class="error" title="'.concat(n,'">').concat(s,"</span>")+i;e.innerHTML=o}},{key:"_setup",value:function(){var t=this,e=(this.widgetWindow.onmaximize=function(){var e=t.widgetWindow.getWidgetBody().childNodes[0];e.style.width=t.widgetWindow._maximized?"100%":"39rem",e.style.height=t.widgetWindow._maximized?"calc(100vh - ".concat(97,"px)"):"".concat(docById("overlayCanvas").height-33-128-12,"px")},this._editor.style.width="39rem",this._editor.style.height="".concat(docById("overlayCanvas").height-33-128-12,"px"),this._editor.style.display="flex",this._editor.style.flexDirection="column",document.createElement("div")),o=(e.style.width="100%",e.style.height="3rem",e.style.display="flex",e.style.flexDirection="row",e.style.justifyContent="space-between",e.style.background="#1e88e5",e.style.color="white",document.createElement("div"));function n(t,o,e){var n=2<arguments.length&&void 0!==e?e:"bottom",e=document.createElement("div"),i=document.createElement("div");e.appendChild(i),document.body.appendChild(e),t.addEventListener("mouseover",function(){var e=t.getBoundingClientRect();i.style.position="absolute",i.style.visibility="visible",i.style.opacity="1",i.style.transition="opacity 0.2s ease-in-out",i.style.marginTop="-10px",i.style.background="#333",i.style.color="#fff",i.style.padding="0.5rem",i.style.borderRadius="10px",i.style.zIndex="99999",i.style.fontSize="1rem",i.style.whiteSpace="nowrap",i.textContent=o,i.style.top="".concat(e.bottom+window.scrollY+("bottom"!==n?-30:20),"px"),i.style.left="".concat(e.left+window.scrollX+("bottom"!==n?-135:0),"px")}),t.addEventListener("mouseout",function(){i.style.opacity="0",setTimeout(function(){i.style.visibility="hidden"},250)})}o.style.height="3rem",o.style.display="flex",o.style.flexDirection="row",o.style.justifyContent="end",o.style.alignItems="center";var i=document.createElement("span"),i=(i.id="js_editor_help_btn",i.classList.add("material-icons"),i.style.borderRadius="50%",i.style.padding=".25rem",i.style.marginLeft=".75rem",i.style.fontSize="2rem",i.style.background="#2196f3",i.style.cursor="pointer",i.innerHTML="help_outline",i.onclick=this._toggleHelp.bind(this),o.appendChild(i),n(i,_("Help")),document.createElement("span")),i=(i.classList.add("material-icons"),i.style.borderRadius="50%",i.style.padding=".25rem",i.style.marginLeft=".75rem",i.style.fontSize="2rem",i.style.background="#2196f3",i.style.cursor="pointer",i.innerHTML="autorenew",i.onclick=this._generateCode.bind(this),o.appendChild(i),n(i,_("Reset Code")),document.createElement("span")),i=(i.classList.add("material-icons"),i.style.borderRadius="50%",i.style.padding=".25rem",i.style.marginLeft=".75rem",i.style.fontSize="2rem",i.style.background="#2196f3",i.style.cursor="pointer",i.innerHTML="play_arrow",i.onclick=this._runCode.bind(this),o.appendChild(i),e.appendChild(o),n(i,_("Play")),document.createElement("span")),o=(i.classList.add("material-icons"),i.style.borderRadius="50%",i.style.padding=".25rem",i.style.marginLeft=".75rem",i.style.fontSize="2rem",i.style.background="#2196f3",i.style.cursor="pointer",i.innerHTML="transform",i.onclick=this._codeToBlocks.bind(this),o.appendChild(i),e.appendChild(o),n(i,_("Convert JavaScript to Blocks")),document.createElement("div")),i=(o.style.height="3rem",o.style.display="flex",o.style.flexDirection="row",o.style.justifyContent="end",o.style.alignItems="center",document.createElement("span")),o=(i.classList.add("material-icons"),i.style.borderRadius="50%",i.style.padding=".25rem",i.style.marginRight=".75rem",i.style.fontSize="2rem",i.style.background="#2196f3",i.style.cursor="pointer",i.innerHTML="invert_colors",i.onclick=this._changeStyle.bind(this),o.appendChild(i),e.appendChild(o),n(i,_("Change theme"),"left"),this._editor.appendChild(e),document.createElement("div")),i=(o.id="editor_container",o.style.width="100%",o.style.flex="2 1 auto",o.style.position="relative",o.style.background="#1e88e5",o.style.color="white",document.createElement("div")),e=(i.id="editorLines",i.style.width="2rem",i.style.height="100%",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.zIndex="99",i.style.overflow="hidden",i.style.boxSizing="border-box",i.style.padding=".25rem .5rem",i.style.fontFamily='"PT Mono", monospace',i.style.fontSize="14px",i.style.fontWeight="400",i.style.letterSpacing="normal",i.style.lineHeight="20px",i.style.background="rgba(255, 255, 255, 0.075)",i.style.color="rgba(255, 255, 255, 0.7)",i.style.textAlign="right",o.appendChild(i),document.createElement("div")),i=(e.id="debugButtons",e.style.width="1.5rem",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="2rem",e.style.zIndex="98",e.style.overflow="hidden",e.style.boxSizing="border-box",e.style.padding=".25rem .25rem",e.style.fontFamily='"PT Mono", monospace',e.style.fontSize="12px",e.style.fontWeight="400",e.style.letterSpacing="normal",e.style.lineHeight="20px",e.style.background="rgba(255, 255, 255, 0.05)",e.style.color="rgba(255, 255, 255, 0.5)",e.style.textAlign="center",e.style.pointerEvents="none",o.appendChild(e),document.createElement("div")),e=(i.classList.add("editor"),i.classList.add("language-javascript"),i.style.width="100%",i.style.height="100%",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.boxSizing="border-box",i.style.padding=".25rem .25rem .25rem 4.25rem",i.style.fontFamily='"PT Mono", monospace',i.style.fontSize="14px",i.style.fontWeight="400",i.style.letterSpacing="normal",i.style.lineHeight="20px",i.style.tabSize="4",i.style.cursor="text",o.appendChild(i),this._editor.appendChild(o),document.createElement("div")),s=(e.id="editor_divider",e.style.width="100%",e.style.height="5px",e.style.cursor="row-resize",e.style.background="gray",e.style.position="relative",this._editor.appendChild(e),document.createElement("div")),r=(s.id="console_label",s.style.width="100%",s.style.flex="0 0 auto",s.style.boxSizing="border-box",s.style.borderTop="1px solid gray",s.style.borderBottom="1px solid gray",s.style.padding=".25rem",s.style.fontFamily='"PT Mono", monospace',s.style.fontSize="14px",s.style.fontWeight="700",s.style.lineHeight="20px",s.style.color="indigo",s.style.background="white",s.style.display="flex",s.style.justifyContent="space-between",s.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;CONSOLE",this._editor.appendChild(s),document.createElement("span")),r=(r.id="editor_console_btn",r.classList.add("material-icons"),r.style.padding=".25rem",r.style.fontSize="2rem",r.style.cursor="pointer",r.style.lineHeight="0.75rem",r.style.marginLeft="0",r.innerHTML="keyboard_arrow_down",r.onclick=this._toggleConsole.bind(this),s.appendChild(r),n(r,_("Toggle Console"),"left"),document.createElement("div"));r.id="editorConsole",r.style.width="100%",r.style.flex="1 1 auto",r.style.overflow="auto",r.style.boxSizing="border-box",r.style.padding=".25rem",r.style.fontFamily='"PT Mono", monospace',r.style.fontSize="14px",r.style.fontWeight="400",r.style.lineHeight="20px",r.style.background="lightcyan",r.style.cursor="text",this._editor.appendChild(r);this._jar=new CodeJar(i,function(e){hljs.configure({languages:["javascript"]}),hljs.highlightElement(e),t._highlightErrors(e)}),this._generateCode(),this._jar.updateCode(this._code),this._jar.updateOptions({tab:" ".repeat(4),indentOn:/[(]$/,spellcheck:!1,addClosing:!0}),this._jar.onUpdate(function(e){t._showingHelp||(t._code=e),t._setLinesCount(t._code)}),this.widgetWindow.getWidgetBody().append(this._editor),this.widgetWindow.takeFocus(),this._setupDividerResize(e,o,r,s),(window.jsEditor=this)._setupScrollSync()}},{key:"_setupDividerResize",value:function(i,s,r,l){function t(e){var t,o,n;d&&(t=a._editor.getBoundingClientRect(),o=a._menubar?a._menubar.offsetHeight:0,n=a._editor.clientHeight-o,t=t.top+o,n=n-(o=e.clientY-t)-i.offsetHeight-l.offsetHeight,s.style.flexBasis="".concat(o,"px"),r.style.flexBasis="".concat(n,"px"))}function o(){d=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",o)}var a=this,d=!1;i.addEventListener("mousedown",function(e){d=!0,document.addEventListener("mousemove",t),document.addEventListener("mouseup",o),e.preventDefault()})}},{key:"_setupScrollSync",value:function(){var e=document.querySelector(".editor"),t=docById("editorLines"),o=docById("debugButtons");e&&t&&o&&e.addEventListener("scroll",function(){t.scrollTop=e.scrollTop,o.scrollTop=e.scrollTop})}},{key:"_runCode",value:function(){if(!this._showingHelp){r.clearConsole();try{acorn.parse(this._code,{ecmaVersion:2020})}catch(e){return void r.logConsole("Syntax Error: ".concat(e.message),"red")}try{MusicBlocks.init(!0),new Function(this._code)(),r.logConsole("Code executed successfully!","green")}catch(e){r.logConsole("Runtime Error: ".concat(e.message),"maroon"),e.stack&&r.logConsole("Stack trace: ".concat(e.stack),"maroon")}}}},{key:"_codeToBlocks",value:function(){r.clearConsole();try{var e=acorn.parse(this._code,{ecmaVersion:2020}),t=AST2BlockList.toBlockList(e,ast2blocklist_config),o=this.activity;o.stage.removeAllEventListeners("trashsignal"),o.stage.addEventListener("trashsignal",function(e){o.blocks.loadNewBlocks(t),o.stage.removeAllEventListeners("trashsignal")},!1),o.sendAllToTrash(!1,!1,!1)}catch(e){r.logConsole("message"in e?e.message:e.prefix+this._code.substring(e.start,e.end),"red")}}},{key:"_generateCode",value:function(){JSGenerate.run(!0),this._code=JSGenerate.code,this._jar.updateCode(this._code),this._setLinesCount(this._code);var e=docById("js_editor_help_btn");e&&(e.style.color="white"),this._showingHelp=!1}},{key:"_setLinesCount",value:function(e){if(docById("editorLines")){for(var t=e.replace(/\n+$/,"\n").split("\n").length,o="",n=1;n<t;n++)o+="".concat(n,"\n");docById("editorLines").innerText=o,this._updateDebugButtons(e)}}},{key:"_updateDebugButtons",value:function(e){if(docById("debugButtons")){for(var t=e.replace(/\n+$/,"\n").split("\n"),o="",n=0;n<t.length;n++){var i=n,s=t[n].trim(),r="debugger;"===s||s.includes("debugger;");o+=""===s?"<div style='height: 20px; line-height: 20px;'>&nbsp;</div>":(r?'<div style="height: 20px; line-height: 20px; cursor: pointer; opacity: 1; pointer-events: auto; border-radius: 4px;"                     onclick="window.jsEditor._removeDebuggerFromLine('.concat(i,')"                     title="Remove debugger from line '):'<div style="height: 20px; line-height: 20px; cursor: pointer; opacity: 0; transition: opacity 0.2s ease-in-out; pointer-events: auto;"                     onmouseenter="this.style.opacity=\'1\'"                     onmouseleave="this.style.opacity=\'0\'"                    onclick="window.jsEditor._addDebuggerToLine('.concat(i,')"                     title="Add breakpoint to line ')).concat(i+1,'">🔴</div>')}docById("debugButtons").innerHTML=o}}},{key:"_addDebuggerToLine",value:function(e){var t,o,n=this._code.split("\n"),i=e-1,s=n[i].trim();s.endsWith("{")||s.endsWith(";")?n[i]&&"debugger;"===n[i].trim()||n[1+i]&&"debugger;"===n[1+i].trim()?r.logConsole("Cannot add breakpoint to line ".concat(e+1," because there is already a breakpoint on an adjacent line."),"red"):(t=s="",0<=i&&n[i]?((o=n[i].match(/^(\s*)/))&&(s=o[1]),n[i].trim().endsWith("{")&&(t="\t")):0<n.length&&(o=n[0].match(/^(\s*)/))&&(s=o[1]),n.splice(1+i,0,s+t+"debugger;"),this._code=n.join("\n"),this._jar.updateCode(this._code),this._setLinesCount(this._code),r.logConsole("Debugger added to line ".concat(e+1),"green")):r.logConsole("Cannot add breakpoint to line ".concat(e+1,". Breakpoints can only be added after lines ending with '{' or ';'"),"red")}},{key:"_removeDebuggerFromLine",value:function(e){var t=this._code.split("\n");"debugger;"===t[e].trim()&&t.splice(e,1),this._code=t.join("\n"),this._jar.updateCode(this._code),this._setLinesCount(this._code),r.logConsole("Debugger removed from line ".concat(e+1),"orange")}},{key:"_toggleHelp",value:function(){this._showingHelp=!this._showingHelp;var e=docById("js_editor_help_btn");this._showingHelp?(e.style.color="gold",this._codeBck=this._code,this._jar.updateCode(JS_API),this._setLinesCount(JS_API)):(e.style.color="white",this._jar.updateCode(this._codeBck),this._setLinesCount(this._codeBck),this._code=this._codeBck)}},{key:"_changeStyle",value:function(e){e.preventDefault(),this._styles[this._currentStyle].setAttribute("disabled","true"),this._currentStyle=(this._currentStyle+1)%this._styles.length,this._styles[this._currentStyle].removeAttribute("disabled");var t=docById("editorLines");switch(this._styles[this._currentStyle].href.split("/").pop().split(".")[0]){case"dracula":t.style.color="#ffffff",t.style.background="#5a5a5a";break;case"github":t.style.color="#000000",t.style.background="#eaeaea";break;case"railscasts":t.style.color="#ffffff",t.style.background="#2b2b2b";break;case"vs":t.style.color="#000000",t.style.background="#f2f2f2";break;default:t.style.color="#ffffff",t.style.background="#000000"}}},{key:"_toggleConsole",value:function(){var e=docById("editorConsole"),t=docById("editor_console_btn");this.isOpen?(this.isOpen=!1,e.style.display="none",t&&(t.innerHTML="keyboard_arrow_up")):(this.isOpen=!0,e.style.display="block",t&&(t.innerHTML="keyboard_arrow_down"))}},{key:"_triggerStatusWindow",value:function(){window.widgetWindows.isOpen("status")?r.logConsole("Status window is already open.","blue"):(null===this.activity.logo.statusMatrix&&(this.activity.logo.statusMatrix=new StatusMatrix),this.activity.logo.statusMatrix.init(this.activity),this.activity.logo.inStatusMatrix=!0,r.logConsole("Status window opened.","green"))}}],[{key:"logConsole",value:function(e,t){void 0===t&&(t="midnightblue"),docById("editorConsole")&&(""!==docById("editorConsole").innerHTML&&(docById("editorConsole").innerHTML+="</br>"),docById("editorConsole").innerHTML+='<span style="color: '.concat(t,'">').concat(e,"</span>")),console.log("%c"+e,"color: ".concat(t))}},{key:"clearConsole",value:function(){docById("editorConsole")&&(docById("editorConsole").innerHTML="")}}])})();
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regeneratorValues(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],o=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return{value:(t=t&&o>=t.length?void 0:t)&&t[o++],done:!t}}}}throw new TypeError(_typeof(t)+" is not iterable")}function _regenerator(){var m,t="function"==typeof Symbol?Symbol:{},e=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function i(t,e,o,i){var n,r,a,l,s,c,h,u,d,e=e&&e.prototype instanceof y?e:y,e=Object.create(e.prototype);return _regeneratorDefine2(e,"_invoke",(n=t,r=o,h=i||[],u=!1,d={p:c=0,n:0,v:m,a:p,f:p.bind(m,4),d:function(t,e){return a=t,l=0,s=m,d.n=e,g}},function(t,e,o){if(1<c)throw TypeError("Generator is already running");for(u&&1===e&&p(e,o),l=e,s=o;(f=l<2?m:s)||!u;){a||(l?l<3?(1<l&&(d.n=-1),p(l,s)):d.n=s:d.v=s);try{if(c=2,a){if(f=a[t=l?t:"next"]){if(!(f=f.call(a,s)))throw TypeError("iterator result is not an object");if(!f.done)return f;s=f.value,l<2&&(l=0)}else 1===l&&(f=a.return)&&f.call(a),l<2&&(s=TypeError("The iterator does not provide a '"+t+"' method"),l=1);a=m}else if((f=(u=d.n<0)?s:n.call(r,d))!==g)break}catch(t){a=m,l=1,s=t}finally{c=1}}return{value:f,done:u}}),!0),e;function p(t,e){for(l=t,s=e,f=0;!u&&c&&!o&&f<h.length;f++){var o,i=h[f],n=d.p,r=i[2];3<t?(o=r===e)&&(s=i[(l=i[4])?5:l=3],i[4]=i[5]=m):i[0]<=n&&((o=t<2&&n<i[1])?(l=0,d.v=e,d.n=i[1]):n<r&&(o=t<3||i[0]>e||r<e)&&(i[4]=t,i[5]=e,d.n=r,l=0))}if(o||1<t)return g;throw u=!0,e}}var g={};function y(){}function n(){}function r(){}var f=Object.getPrototypeOf,t=[][e]?f(f([][e]())):(_regeneratorDefine2(f={},e,function(){return this}),f),a=r.prototype=y.prototype=Object.create(t);function l(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,r):(t.__proto__=r,_regeneratorDefine2(t,o,"GeneratorFunction")),t.prototype=Object.create(a),t}return _regeneratorDefine2(a,"constructor",n.prototype=r),_regeneratorDefine2(r,"constructor",n),_regeneratorDefine2(r,o,n.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,o,"Generator"),_regeneratorDefine2(a,e,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:i,m:l}})()}function _regeneratorDefine2(t,e,o,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}(_regeneratorDefine2=function(t,e,o,i){function n(e,o){_regeneratorDefine2(t,e,function(t){return this._invoke(e,o,t)})}e?r?r(t,e,{value:o,enumerable:!i,configurable:!i,writable:!i}):t[e]=o:(n("next",0),n("throw",1),n("return",2))})(t,e,o,i)}function asyncGeneratorStep(t,e,o,i,n,r,a){try{var l=t[r](a),s=l.value}catch(t){return void o(t)}l.done?e(s):Promise.resolve(s).then(i,n)}function _asyncToGenerator(l){return function(){var t=this,a=arguments;return new Promise(function(e,o){var i=l.apply(t,a);function n(t){asyncGeneratorStep(i,e,o,n,r,"next",t)}function r(t){asyncGeneratorStep(i,e,o,n,r,"throw",t)}n(void 0)})}}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var i,n,r,a,l=[],s=!0,c=!1;try{if(r=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;s=!1}else for(;!(s=(i=r.call(o)).done)&&(l.push(i.value),l.length!==e);s=!0);}catch(t){c=!0,n=t}finally{try{if(!s&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(c)throw n}}return l}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t,e){var o,i,n,r,a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(a)return n=!(i=!0),{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){n=!0,o=t},f:function(){try{i||null==a.return||a.return()}finally{if(n)throw o}}};if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return a&&(t=a),r=0,{s:e=function(){},n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var o;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(o="Object"===(o={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:o)||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=Array(e);o<e;o++)i[o]=t[o];return i}function LegoWidget(){this.matrixData={rows:[{type:"pitch",label:"High C (Do)",icon:"HighC.png",color:"pitch-row",note:"C5"},{type:"pitch",label:"B (Ti)",icon:"B.png",color:"pitch-row",note:"B4"},{type:"pitch",label:"A (La)",icon:"A.png",color:"pitch-row",note:"A4"},{type:"pitch",label:"G (So)",icon:"G.png",color:"pitch-row",note:"G4"},{type:"pitch",label:"F (Fa)",icon:"F.png",color:"pitch-row",note:"F4"},{type:"pitch",label:"E (Mi)",icon:"E.png",color:"pitch-row",note:"E4"},{type:"pitch",label:"D (Re)",icon:"D.png",color:"pitch-row",note:"D4"},{type:"pitch",label:"Middle C (Do)",icon:"MiddleC.png",color:"pitch-row",note:"C4"},{type:"pitch",label:"B (Low Ti)",icon:"LowB.png",color:"pitch-row",note:"B3"},{type:"pitch",label:"Low C (Low Do)",icon:"LowC.png",color:"pitch-row",note:"C3"},{type:"pitch",label:"Zoom Controls",icon:"LowC.png",color:"pitch-row"}],columns:8,selectedCells:new Set},this.widgetWindow=null,this.activity=null,this.isPlaying=!1,this.isDragging=!1,this.currentZoom=1,this.verticalSpacing=50,this.imageWrapper=null,this.synth=null,this.selectedInstrument="electronic synth",this.hasGeneratedVisualization=!1,this.eyeDropperMode=!1,this.selectedBackgroundColor={name:"green",hue:120},this.eyeDropperCursor=null,this.blockNo=null,this.rowLabels=[],this.rowArgs=[],this._rowBlocks=[],this._rowMap=[],this._rowOffset=[],this._notesToPlay=[],this.clearBlocks=function(){this._rowBlocks=[],this._rowMap=[],this._rowOffset=[]},this.addRowBlock=function(t){for(this._rowMap.push(this._rowBlocks.length),this._rowOffset.push(0);this._rowBlocks.includes(t);)t+=1e6;this._rowBlocks.push(t)},this._generateRowsFromPitchBlocks=function(){this.matrixData.rows=[];for(var t=[],e=0;e<this.rowLabels.length;e++){var o=this.rowLabels[e],i=this.rowArgs[e];if(-1!==i){var n=o+i,r=o,r="do"===o?"Do":"re"===o?"Re":"mi"===o?"Mi":"fa"===o?"Fa":"sol"===o?"So":"la"===o?"La":"ti"===o?"Ti":o.toUpperCase(),a=0;try{a="undefined"!=typeof noteToFrequency?noteToFrequency(n,this.activity.turtles.ithTurtle(0).singer.keySignature):this._calculateFallbackFrequency(o,i)}catch(t){a=this._calculateFallbackFrequency(o,i)}t.push({frequency:a,type:"pitch",label:r+" ("+i+")",icon:"pitch.svg",color:"pitch-row",note:n,pitch:o,octave:i})}}t.sort(function(t,e){return e.frequency-t.frequency}),this.matrixData.rows=t,this.matrixData.rows.push({type:"control",label:"Zoom Controls",icon:"zoom.svg",color:"control-row"}),0===this.rowLabels.length&&(this.matrixData.rows=[{type:"pitch",label:"E4 (Mi)",icon:"pitch.svg",color:"pitch-row",note:"E4"},{type:"pitch",label:"D4 (Re)",icon:"pitch.svg",color:"pitch-row",note:"D4"},{type:"pitch",label:"C4 (Middle C)",icon:"pitch.svg",color:"pitch-row",note:"C4"},{type:"control",label:"Zoom Controls",icon:"zoom.svg",color:"control-row"}])},this._calculateFallbackFrequency=function(t,e){var o={C:261.63,do:261.63,D:293.66,re:293.66,E:329.63,mi:329.63,F:349.23,fa:349.23,G:392,sol:392,A:440,la:440,B:493.88,ti:493.88};return(o[t.toLowerCase()]||o[t.toUpperCase()]||o.C)*Math.pow(2,e-4)},this.init=function(t){var e=this,o=(this.activity=t,this.running=!0,this._initAudio(),window.widgetWindows.windowFor(this,"LEGO BRICKS"));(this.widgetWindow=o).clear(),o.show();o.onclose=function(){e._stopWebcam(),e._deactivateEyeDropper(),e.running=!1,o.destroy()},o.onmaximize=this._scale.bind(this),this.playButton=o.addButton("play-button.svg",32,_("Play")),this.playButton.onclick=function(){e._playPhrase()},this.saveButton=o.addButton("save-button.svg",32,_("Save")),this.saveButton.onclick=function(){e._savePhrase()},this.exportButton=o.addButton("export-button.svg",32,_("Export")),this.exportButton.onclick=function(){e._exportPhrase()},this.uploadButton=o.addButton("upload-button.svg",32,_("Upload Image")),this.uploadButton.onclick=function(){e._uploadImage()},this.webcamButton=o.addButton("webcam-button.svg",32,_("Webcam")),this.webcamButton.onclick=function(){e._startWebcam()},this.clearButton=o.addButton("clear-button.svg",32,_("Clear")),this.clearButton.onclick=function(){e._clearPhrase()},this.createMainContainer(),o.sendToCenter(),this.widgetWindow=o,this._generateRowsFromPitchBlocks(),this._initializeRowHeaders(),this._scale(),this.activity.textMsg(_("LEGO Bricks - Phrase Maker with")+" "+this.rowLabels.length+" "+_("pitch rows (sorted by frequency, Instrument: "+this.selectedInstrument+")"))},this._initAudio=function(){this.synth=new Synth,this.synth.loadSamples(),this.synth.createSynth(0,this.selectedInstrument,this.selectedInstrument,null)},this._playNote=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.5;if(this.synth)try{this.synth.trigger(0,t,e,this.selectedInstrument,null,null,!1,0)}catch(t){console.error("Error playing note:",t)}},this._initializeRowHeaders=function(){var r=this;this.rowHeaderTable.innerHTML="",this.rowHeaderTable.style.margin="0",this.rowHeaderTable.style.padding="0",this.rowHeaderTable.style.borderSpacing="0",this.matrixData.rows.forEach(function(t,e){var o=r.rowHeaderTable.insertRow(),i=(o.style.height="40px",o.style.margin="0",o.style.padding="0",o.style.position="relative",o.insertCell()),n=(i.style.display="flex",i.style.alignItems="center",i.style.padding="0 8px",i.style.margin="0",i.style.fontSize="13px",i.style.fontWeight="bold",i.style.border="none",i.style.backgroundColor="pitch"===t.type?"#77C428":"#87ceeb",i.style.gap="8px",i.style.height="40px",i.style.lineHeight="40px",i.style.boxSizing="border-box",i.style.cursor=t.note?"pointer":"default",t.note&&(i.onclick=function(){r._playNote(t.note)},i.onmousedown=function(){i.style.transform="scale(0.98)",i.style.boxShadow="inset 0 0 8px rgba(0,0,0,0.2)"},i.onmouseup=function(){i.style.transform="",i.style.boxShadow=""},i.onmouseleave=function(){i.style.transform="",i.style.boxShadow=""}),document.createElement("div"));n.style.width="24px",n.style.height="24px",n.style.backgroundColor="#fff",n.style.borderRadius="50%",n.style.marginRight="6px",n.style.flexShrink="0",i.appendChild(n),i.appendChild(document.createTextNode(t.label)),e<r.matrixData.rows.length-1&&((n=document.createElement("div")).style.position="absolute",n.style.left="0",n.style.right="0",n.style.bottom="0",n.style.height="2px",n.style.backgroundColor="red",n.style.zIndex="5",o.appendChild(n))})},this.createMainContainer=function(){var e=this,t=document.createElement("div"),o=(t.style.display="flex",t.style.height="100%",t.style.overflow="hidden",t.style.position="relative",document.createElement("div")),i=(o.style.display="flex",o.style.flex="1",o.style.overflow="hidden",document.createElement("div")),n=(i.style.flex="0 0 auto",i.style.backgroundColor="#cccccc",i.style.overflowY="auto",i.style.width="180px",i.style.borderRight="2px solid #888",this.rowHeaderTable=document.createElement("table"),this.rowHeaderTable.style.borderCollapse="collapse",this.rowHeaderTable.style.width="100%",i.appendChild(this.rowHeaderTable),document.createElement("div"));n.style.flex="1",n.style.height="100%",n.style.backgroundColor="#f5f5f5",n.style.display="flex",n.style.flexDirection="column",n.style.overflow="hidden",n.style.position="relative",this.imageDisplayArea=document.createElement("div"),this.imageDisplayArea.style.position="relative",this.imageDisplayArea.style.flex="1",this.imageDisplayArea.style.display="flex",this.imageDisplayArea.style.alignItems="center",this.imageDisplayArea.style.justifyContent="center",this.imageDisplayArea.style.padding="0",this.imageDisplayArea.style.overflow="hidden",this.imagePlaceholder=document.createElement("div"),this.imagePlaceholder.style.color="#888",this.imagePlaceholder.style.fontSize="16px",this.imagePlaceholder.style.textAlign="center",this.imagePlaceholder.style.fontStyle="italic",this.imagePlaceholder.textContent="Click upload button to add an image",this.imageDisplayArea.appendChild(this.imagePlaceholder),this.gridOverlay=document.createElement("div"),this.gridOverlay.style.position="absolute",this.gridOverlay.style.top="0",this.gridOverlay.style.left="0",this.gridOverlay.style.right="0",this.gridOverlay.style.bottom="0",this.gridOverlay.style.pointerEvents="none",this.gridOverlay.style.zIndex="10",n.appendChild(this.imageDisplayArea),n.appendChild(this.gridOverlay),this.createZoomControls(),n.appendChild(this.zoomControls),o.appendChild(i),o.appendChild(n),t.appendChild(o),this.widgetWindow.getWidgetBody().appendChild(t),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.accept="image/*",this.fileInput.style.display="none",this.fileInput.onchange=function(t){return e._handleImageUpload(t)},document.body.appendChild(this.fileInput),this._initializeRowHeaders()},this.createZoomControls=function(){var t=this,e=(this.zoomControls=document.createElement("div"),this.zoomControls.style.position="absolute",this.zoomControls.style.bottom="0",this.zoomControls.style.left="180px",this.zoomControls.style.right="0",this.zoomControls.style.padding="10px",this.zoomControls.style.backgroundColor="#f0f0f0",this.zoomControls.style.borderTop="1px solid #888",this.zoomControls.style.display="flex",this.zoomControls.style.alignItems="center",this.zoomControls.style.gap="8px",this.zoomControls.style.zIndex="20",document.createElement("span")),o=(e.textContent="Instrument:",e.style.fontSize="12px",e.style.fontWeight="bold",this.instrumentButton=document.createElement("button"),this.instrumentButton.textContent=this.selectedInstrument.charAt(0).toUpperCase()+this.selectedInstrument.slice(1),this.instrumentButton.style.fontSize="12px",this.instrumentButton.style.marginRight="16px",this.instrumentButton.style.padding="4px 8px",this.instrumentButton.style.border="1px solid #ccc",this.instrumentButton.style.borderRadius="4px",this.instrumentButton.style.backgroundColor="#f8f8f8",this.instrumentButton.style.cursor="pointer",this.instrumentButton.onclick=function(){return t._createInstrumentPieMenu()},document.createElement("span")),i=(o.textContent="Zoom:",o.style.fontSize="12px",document.createElement("button")),n=(i.textContent="−",i.onclick=function(){return t._adjustZoom(-.01)},this.zoomSlider=document.createElement("input"),this.zoomSlider.type="range",this.zoomSlider.min="0.1",this.zoomSlider.max="3",this.zoomSlider.step="0.01",this.zoomSlider.value="1",this.zoomSlider.style.width="100px",this.zoomSlider.oninput=function(){return t._handleZoom()},document.createElement("button")),r=(n.textContent="+",n.onclick=function(){return t._adjustZoom(.01)},this.zoomValue=document.createElement("span"),this.zoomValue.textContent="100%",this.zoomValue.style.fontSize="12px",this.zoomValue.style.minWidth="40px",document.createElement("span")),a=(r.textContent="|",r.style.margin="0 8px",r.style.color="#888",document.createElement("span")),l=(a.textContent="Column Spacing:",a.style.fontSize="12px",document.createElement("button")),s=(l.textContent="−",l.onclick=function(){return t._adjustVerticalSpacing(-5)},this.spacingSlider=document.createElement("input"),this.spacingSlider.type="range",this.spacingSlider.min="2",this.spacingSlider.max="200",this.spacingSlider.step="1",this.spacingSlider.value="50",this.spacingSlider.style.width="100px",this.spacingSlider.oninput=function(){return t._handleVerticalSpacing()},document.createElement("button")),c=(s.textContent="+",s.onclick=function(){return t._adjustVerticalSpacing(1)},this.spacingValue=document.createElement("span"),this.spacingValue.textContent="50px",this.spacingValue.style.fontSize="12px",this.spacingValue.style.minWidth="40px",document.createElement("span")),h=(c.textContent="|",c.style.margin="0 8px",c.style.color="#888",document.createElement("span")),u=(h.textContent="Eye Dropper:",h.style.fontSize="12px",h.style.fontWeight="bold",this.eyeDropperButton=document.createElement("button"),this.eyeDropperButton.textContent="🎨",this.eyeDropperButton.style.fontSize="12px",this.eyeDropperButton.style.padding="4px 8px",this.eyeDropperButton.style.border="1px solid #ccc",this.eyeDropperButton.style.borderRadius="4px",this.eyeDropperButton.style.backgroundColor="#f8f8f8",this.eyeDropperButton.style.cursor="pointer",this.eyeDropperButton.title="Click to activate eye dropper mode",this.eyeDropperButton.onclick=function(){return t._toggleEyeDropper()},document.createElement("span")),d=(u.textContent="|",u.style.margin="0 8px",u.style.color="#888",document.createElement("span"));d.textContent="Background:",d.style.fontSize="12px",d.style.fontWeight="bold",this.backgroundColorDisplay=document.createElement("span"),this.backgroundColorDisplay.textContent=this.selectedBackgroundColor.name,this.backgroundColorDisplay.style.fontSize="12px",this.backgroundColorDisplay.style.padding="4px 8px",this.backgroundColorDisplay.style.border="1px solid #ccc",this.backgroundColorDisplay.style.borderRadius="4px",this.backgroundColorDisplay.style.backgroundColor=this._getColorHex(this.selectedBackgroundColor.name),this.backgroundColorDisplay.style.color=this._getContrastColor(this.selectedBackgroundColor.name),this.backgroundColorDisplay.style.minWidth="60px",this.backgroundColorDisplay.style.textAlign="center",this.zoomControls.appendChild(e),this.zoomControls.appendChild(this.instrumentButton),this.zoomControls.appendChild(o),this.zoomControls.appendChild(i),this.zoomControls.appendChild(this.zoomSlider),this.zoomControls.appendChild(n),this.zoomControls.appendChild(this.zoomValue),this.zoomControls.appendChild(r),this.zoomControls.appendChild(a),this.zoomControls.appendChild(l),this.zoomControls.appendChild(this.spacingSlider),this.zoomControls.appendChild(s),this.zoomControls.appendChild(this.spacingValue),this.zoomControls.appendChild(c),this.zoomControls.appendChild(h),this.zoomControls.appendChild(this.eyeDropperButton),this.zoomControls.appendChild(u),this.zoomControls.appendChild(d),this.zoomControls.appendChild(this.backgroundColorDisplay)},this._initializeMatrix=function(){var n=this;this.matrixTable.innerHTML="",this.matrixData.rows.forEach(function(t,e){var o=n.matrixTable.insertRow().insertCell(),i=(o.style.width="180px",o.style.height="40px",o.style.display="flex",o.style.alignItems="center",o.style.padding="0 8px",o.style.fontSize="13px",o.style.fontWeight="bold",o.style.border="1px solid #888",o.style.position="sticky",o.style.left="0",o.style.zIndex="10",o.style.gap="8px",o.style.backgroundColor="pitch"===t.type?"#77C428":"#87ceeb",document.createElement("div"));i.style.width="24px",i.style.height="24px",i.style.backgroundColor="#fff",i.style.borderRadius="50%",i.style.marginRight="6px",o.appendChild(i),o.appendChild(document.createTextNode(t.label))})},this._savePhrase=function(){if(this.colorData&&0!==this.colorData.length)if(this._collectNotesToPlay(),0===this._notesToPlay.length)this.activity.textMsg(_("No notes detected from color scanning."));else{for(var t in this.activity.blocks.palettes.dict)this.activity.blocks.palettes.dict[t].hideMenu(!0);this.activity.refreshCanvas();for(var e=[[0,["action",{collapsed:!0}],100,100,[null,1,null,null]],[1,["text",{value:_("LEGO phrase")}],0,0,[0]]],o=0,i=0;i<this._notesToPlay.length;i++){var n=this._notesToPlay[i],r=e.length,a=(e.push([r,"newnote",0,0,[o,r+1,r+2,null]]),e[r][4].length),a=(0===i?e[o][4][a-2]=r:e[o][4][a-1]=r,e.push([(o=r)+1,"vspace",0,0,[r,r+5]]),void 0),l=void 0,l=1.5===n.noteValue?(a=3,2):.5===n.noteValue?(a=1,2):Number.isInteger(n.noteValue)?(a=1,n.noteValue):(a=1,Math.round(1/n.noteValue)),s=(e.push([r+2,"divide",0,0,[r,r+3,r+4]]),e.push([r+3,["number",{value:a}],0,0,[r+2]]),e.push([r+4,["number",{value:l}],0,0,[r+2]]),e[r][4][1]=r+2,e[r][4][2]=r+1,null),c=r+1,h=r+5;if(0===n.pitches.length||n.isRest)e.push([h,"rest2",0,0,[c,s]]);else for(var u=0;u<n.pitches.length;u++){var d=n.pitches[u],s=u===n.pitches.length-1?null:h+3;e.push([h,"pitch",0,0,[c,h+1,h+2,s]]),e.push([h+1,["solfege",{value:d.solfege}],0,0,[h]]),e.push([h+2,["number",{value:d.octave}],0,0,[h]]),c=(h+=3)-3}}this.activity.blocks.loadNewBlocks(e),this.activity.textMsg(_("LEGO phrase saved as action blocks with ")+this._notesToPlay.length+_(" notes"))}else this.activity.textMsg(_("No color data to save. Please scan an image first."))},this._collectNotesToPlay=function(){var u=this;if(this._notesToPlay=[],this.colorData&&0!==this.colorData.length)for(var t=this._analyzeColumnBoundaries(),o=this._filterSmallSegments(t),e=function(){var l=o[i],s=o[i+1],t=s-l,e=t<750?8:t<1500?4:t<3e3?2:1,c=!1,h=[];u.colorData.forEach(function(n,t){if(n.colorSegments){var r,a=0,e=_createForOfIteratorHelper(n.colorSegments);try{for(e.s();!(r=e.n()).done;)(()=>{var e,t=r.value,o=a,i=a+t.duration;o<s&&l<i&&(o=Math.max(o,l),1e3<Math.min(i,s)-o?t.color!==u.selectedBackgroundColor.name&&(c=!0,e=u._convertRowToPitch(n))&&!h.some(function(t){return t.solfege===e.solfege&&t.octave===e.octave})&&h.push(e):(t.color,u.selectedBackgroundColor.name)),a+=t.duration})()}catch(t){e.e(t)}finally{e.f()}}}),u._notesToPlay.push({pitches:h,noteValue:e,duration:t,isRest:!c||0===h.length})},i=0;i<o.length-1;i++)e()},this._filterSmallSegments=function(t){if(t.length<=2)return t;for(var e=[t[0]],o=1;o<t.length;o++)1e3<=t[o]-e[e.length-1]&&e.push(t[o]);return 1===e.length&&1<t.length&&e.push(t[t.length-1]),e},this._analyzeColumnBoundaries=function(){for(var o=new Set([0]),t=(this.colorData.forEach(function(t){var e;t.colorSegments&&(e=0,t.colorSegments.forEach(function(t){e+=t.duration,o.add(e)}))}),Array.from(o).sort(function(t,e){return t-e})),e=[t[0]],i=1;i<t.length;i++)500<t[i]-e[e.length-1]&&e.push(t[i]);return e},this._convertRowToPitch=function(t){var e;return t.note&&(t=t.note.match(/^([A-G][#b]?)(\d+)$/))?(e=t[1],t=parseInt(t[2]),{solfege:{C:"do","C#":"do♯",Db:"re♭",D:"re","D#":"re♯",Eb:"mi♭",E:"mi",F:"fa","F#":"fa♯",Gb:"sol♭",G:"sol","G#":"sol♯",Ab:"la♭",A:"la","A#":"la♯",Bb:"ti♭",B:"ti"}[e]||"do",octave:t}):null},this._exportPhrase=function(){var t={selectedCells:Array.from(this.matrixData.selectedCells),rows:this.matrixData.rows.map(function(t){return{type:t.type,label:t.label}})};this.activity.textMsg(_("Exporting phrase data: ")+JSON.stringify(t))},this._clearPhrase=function(){this.matrixData.selectedCells.clear(),this.matrixTable.querySelectorAll("[data-cell-id]").forEach(function(t){t.style.backgroundColor="";var e=t.querySelector(".cell-dot");e&&t.removeChild(e)}),this.activity.textMsg(_("Phrase cleared"))},this._uploadImage=function(){this.fileInput.click()},this._handleImageUpload=function(t){var e,o=this,t=t.target.files[0];t&&t.type.startsWith("image/")&&((e=new FileReader).onload=function(t){o.imageDisplayArea.innerHTML="",o.imageWrapper=document.createElement("div"),o.imageWrapper.style.position="absolute",o.imageWrapper.style.left="0px",o.imageWrapper.style.top="0px",o.imageWrapper.style.transformOrigin="top left",o.imageWrapper.style.cursor="grab";var e=document.createElement("img");e.src=t.target.result,e.style.maxWidth="100%",e.style.maxHeight="100%",e.style.objectFit="contain",e.style.borderRadius="8px",e.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)",o.imageWrapper.appendChild(e),o.imageDisplayArea.appendChild(o.imageWrapper),o._makeImageDraggable(o.imageWrapper),o._showZoomControls(),o._drawGridLines(),o.activity.textMsg(_("Image uploaded successfully"))},e.readAsDataURL(t))},this._startWebcam=function(){var e=this;this.imageDisplayArea.innerHTML="",this.imageWrapper=document.createElement("div"),this.imageWrapper.style.position="absolute",this.imageWrapper.style.left="0px",this.imageWrapper.style.top="0px",this.imageWrapper.style.transformOrigin="top left",this.imageWrapper.style.cursor="grab",this.webcamVideo=document.createElement("video"),this.webcamVideo.autoplay=!0,this.webcamVideo.playsInline=!0,this.webcamVideo.style.maxWidth="100%",this.webcamVideo.style.maxHeight="100%",this.imageWrapper.appendChild(this.webcamVideo),this.imageDisplayArea.appendChild(this.imageWrapper),navigator.mediaDevices.getUserMedia({video:!0}).then(function(t){e.webcamVideo.srcObject=t,e._makeImageDraggable(e.imageWrapper),e._showZoomControls(),e._drawGridLines(),e.activity.textMsg(_("Webcam started"))}).catch(function(t){e.activity.textMsg(_("Webcam access denied: ")+t.message)})},this._stopWebcam=function(){this.webcamVideo&&this.webcamVideo.srcObject&&this.webcamVideo.srcObject.getTracks().forEach(function(t){return t.stop()})},this._toggleEyeDropper=function(){this.eyeDropperMode=!this.eyeDropperMode,this.eyeDropperMode?this._activateEyeDropper():this._deactivateEyeDropper()},this._activateEyeDropper=function(){this.imageDisplayArea&&(this.imageDisplayArea.style.cursor="crosshair"),this.eyeDropperButton.style.backgroundColor="#4CAF50",this.eyeDropperButton.style.color="white",this.imageDisplayArea&&(this.imageDisplayArea.addEventListener("mousemove",this._handleEyeDropperHover),this.imageDisplayArea.addEventListener("click",this._handleEyeDropperClick),this.imageDisplayArea.addEventListener("mouseleave",this._handleEyeDropperLeave)),this._createColorPreviewTooltip(),this.activity.textMsg(_("Eye dropper active - hover over image to preview colors, click to select background color"))},this._deactivateEyeDropper=function(){this.imageDisplayArea&&(this.imageDisplayArea.style.cursor="default"),this.eyeDropperButton.style.backgroundColor="",this.eyeDropperButton.style.color="",this.imageDisplayArea&&(this.imageDisplayArea.removeEventListener("mousemove",this._handleEyeDropperHover),this.imageDisplayArea.removeEventListener("click",this._handleEyeDropperClick),this.imageDisplayArea.removeEventListener("mouseleave",this._handleEyeDropperLeave)),this._removeColorPreviewTooltip()},this._handleEyeDropperClick=function(t){t.preventDefault(),t.stopPropagation(),this.colorPreviewTooltip&&(this.colorPreviewTooltip.style.display="none");t=this._sampleColorAtPosition(t.clientX,t.clientY);t?(this.selectedBackgroundColor=t,this._deactivateEyeDropper(),this.eyeDropperMode=!1,this._updateBackgroundColorDisplay(),this.activity.textMsg(_("Background color selected: ")+t.name)):this.activity.textMsg(_("Could not sample color - please try clicking on the image"))}.bind(this),this._sampleColorAtPosition=function(t,e){var o=null;if(!(o=this.imageWrapper?this.imageWrapper.querySelector("img")||this.imageWrapper.querySelector("video"):o))return null;var i=document.createElement("canvas"),n=i.getContext("2d");i.width=o.naturalWidth||o.videoWidth||o.width,i.height=o.naturalHeight||o.videoHeight||o.height;try{n.drawImage(o,0,0,i.width,i.height)}catch(t){return console.log("Could not draw media element to canvas for color sampling:",t),null}var o=o.getBoundingClientRect(),t=(t-o.left)/o.width*i.width,e=(e-o.top)/o.height*i.height;return t<0||t>=i.width||e<0||e>=i.height?null:(i=(o=_slicedToArray(n.getImageData(Math.floor(t),Math.floor(e),1,1).data,3))[0],n=this._rgbToHsl(i,o[1],o[2]),this._getColorFamily(n[0],n[1],n[2]))},this._createColorPreviewTooltip=function(){this.colorPreviewTooltip&&this._removeColorPreviewTooltip(),this.colorPreviewTooltip=document.createElement("div"),this.colorPreviewTooltip.style.position="absolute",this.colorPreviewTooltip.style.backgroundColor="rgba(0, 0, 0, 0.8)",this.colorPreviewTooltip.style.color="white",this.colorPreviewTooltip.style.padding="8px 12px",this.colorPreviewTooltip.style.borderRadius="6px",this.colorPreviewTooltip.style.fontSize="12px",this.colorPreviewTooltip.style.fontWeight="bold",this.colorPreviewTooltip.style.pointerEvents="none",this.colorPreviewTooltip.style.zIndex="1000",this.colorPreviewTooltip.style.display="none",this.colorPreviewTooltip.style.boxShadow="0 2px 8px rgba(0,0,0,0.3)",this.colorSwatch=document.createElement("div"),this.colorSwatch.style.width="20px",this.colorSwatch.style.height="20px",this.colorSwatch.style.border="2px solid white",this.colorSwatch.style.borderRadius="3px",this.colorSwatch.style.display="inline-block",this.colorSwatch.style.marginRight="8px",this.colorSwatch.style.verticalAlign="middle",this.colorPreviewTooltip.appendChild(this.colorSwatch),this.colorPreviewText=document.createElement("span"),this.colorPreviewText.style.verticalAlign="middle",this.colorPreviewTooltip.appendChild(this.colorPreviewText),document.body.appendChild(this.colorPreviewTooltip)},this._removeColorPreviewTooltip=function(){this.colorPreviewTooltip&&(document.body.removeChild(this.colorPreviewTooltip),this.colorPreviewTooltip=null,this.colorSwatch=null,this.colorPreviewText=null)},this._handleEyeDropperHover=function(t){var e;this.eyeDropperMode&&this.colorPreviewTooltip&&((e=this._sampleColorAtPosition(t.clientX,t.clientY))?(this.colorSwatch.style.backgroundColor=this._getColorHex(e.name),this.colorPreviewText.textContent=e.name.charAt(0).toUpperCase()+e.name.slice(1),this.colorPreviewTooltip.style.left=t.clientX+15+"px",this.colorPreviewTooltip.style.top=t.clientY-40+"px",this.colorPreviewTooltip.style.display="block"):this.colorPreviewTooltip.style.display="none")}.bind(this),this._handleEyeDropperLeave=function(t){this.colorPreviewTooltip&&(this.colorPreviewTooltip.style.display="none")}.bind(this),this._updateBackgroundColorDisplay=function(){this.backgroundColorDisplay&&(this.backgroundColorDisplay.textContent=this.selectedBackgroundColor.name,this.backgroundColorDisplay.style.backgroundColor=this._getColorHex(this.selectedBackgroundColor.name),this.backgroundColorDisplay.style.color=this._getContrastColor(this.selectedBackgroundColor.name))},this._getColorHex=function(t){return{red:"#FF0000",orange:"#FFA500",yellow:"#FFFF00",green:"#00FF00",blue:"#0000FF",purple:"#800080",pink:"#FFC0CB",cyan:"#00FFFF",magenta:"#FF00FF",white:"#FFFFFF",black:"#000000",gray:"#808080"}[t]||"#808080"},this._getContrastColor=function(t){return["white","yellow","cyan","pink","orange"].includes(t)?"#000000":"#FFFFFF"},this._makeImageDraggable=function(o){var i,n,r,a,l=!1;o.style.width="100%",o.style.height="100%",o.style.overflow="hidden",o.onmousedown=function(t){l=!0,i=t.clientX,n=t.clientY,r=parseFloat(o.style.left)||0,a=parseFloat(o.style.top)||0,o.style.cursor="grabbing",t.preventDefault()},document.onmousemove=function(t){var e;l&&(e=t.clientX-i,t=t.clientY-n,o.style.left="".concat(r+e,"px"),o.style.top="".concat(a+t,"px"))},document.onmouseup=function(){l&&(l=!1,o.style.cursor="grab")}},this._getColorFamily=function(t,e,o){var i,t=_slicedToArray(this._rgbToHsl(t,e,o),3),e=t[0],o=t[1],t=t[2];return t<15?{name:"black",hue:e,saturation:o,lightness:t}:o<20?85<t?{name:"white",hue:e,saturation:o,lightness:t}:t<25?{name:"black",hue:e,saturation:o,lightness:t}:{name:"gray",hue:e,saturation:o,lightness:t}:(i="unknown",345<=e||e<15?i="red":15<=e&&e<45?i="orange":45<=e&&e<75?i="yellow":75<=e&&e<165?i="green":165<=e&&e<195?i="cyan":195<=e&&e<255?i="blue":255<=e&&e<285?i="purple":285<=e&&e<315?i="magenta":315<=e&&e<345&&(i="pink"),{name:i,hue:e,saturation:o,lightness:t})},this._getColorFamily=function(t,e,o){return e<15?85<o?{name:"white",hue:0}:o<15?{name:"black",hue:0}:{name:"gray",hue:0}:345<=t||t<15?{name:"red",hue:0}:15<=t&&t<45?{name:"orange",hue:30}:45<=t&&t<75?{name:"yellow",hue:60}:75<=t&&t<165?{name:"green",hue:120}:165<=t&&t<195?{name:"cyan",hue:180}:195<=t&&t<255?{name:"blue",hue:240}:255<=t&&t<285?{name:"purple",hue:270}:285<=t&&t<315?{name:"magenta",hue:300}:315<=t&&t<345?{name:"pink",hue:330}:{name:"unknown",hue:t}},this._getColorFamilyByName=function(t){return{red:{name:"red",hue:0,saturation:80,lightness:50},orange:{name:"orange",hue:30,saturation:80,lightness:50},yellow:{name:"yellow",hue:60,saturation:80,lightness:50},green:{name:"green",hue:120,saturation:80,lightness:50},cyan:{name:"cyan",hue:180,saturation:80,lightness:50},blue:{name:"blue",hue:240,saturation:80,lightness:50},purple:{name:"purple",hue:270,saturation:80,lightness:50},magenta:{name:"magenta",hue:300,saturation:80,lightness:50},pink:{name:"pink",hue:330,saturation:70,lightness:75},white:{name:"white",hue:0,saturation:0,lightness:95},gray:{name:"gray",hue:0,saturation:5,lightness:50},black:{name:"black",hue:0,saturation:0,lightness:5}}[t]||null},this._rgbToHsl=function(t,e,o){t/=255,e/=255,o/=255;var i=Math.max(t,e,o),n=Math.min(t,e,o),r=0,a=0,l=(i+n)/2;if(i!==n){var s=i-n,a=.5<l?s/(2-i-n):s/(i+n);switch(i){case t:r=(e-o)/s+(e<o?6:0);break;case e:r=(o-t)/s+2;break;case o:r=(t-e)/s+4}r*=60}return[Math.round(r),Math.round(100*a),Math.round(100*l)]},this._colorsAreSimilar=function(t,e){var o,i;return!(!t||!e||t.name!==e.name&&!((o=["white","gray","black"]).includes(t.name)&&o.includes(e.name)?Math.abs(t.lightness-e.lightness)<30:20<t.saturation&&20<e.saturation&&(o=Math.min(Math.abs(t.hue-e.hue),360-Math.abs(t.hue-e.hue)),i=Math.abs(t.saturation-e.saturation),t=Math.abs(t.lightness-e.lightness),o<25)&&i<20&&t<20))},this._getColorForCanvasRow=function(t,e){var e=e.getBoundingClientRect(),o=this.gridOverlay.getBoundingClientRect(),i=t.topPos,o=e.top-o.top,e=o+e.height;return t.bottomPos<=o||e<=i?this.selectedBackgroundColor||this._getColorFamilyByName("green"):null},this._showZoomControls=function(){this.currentZoom=1,this.zoomSlider.value="1",this.zoomValue.textContent="100%",this.spacingSlider.value=this.verticalSpacing.toString(),this.spacingValue.textContent=this.verticalSpacing+"px"},this._adjustZoom=function(t){t=parseFloat(this.zoomSlider.value)+t,t=Math.max(.1,Math.min(3,t));this.zoomSlider.value=t.toFixed(2),this._handleZoom()},this._adjustVerticalSpacing=function(t){t=parseFloat(this.spacingSlider.value)+t,t=Math.max(2,Math.min(200,t));this.spacingSlider.value=t.toString(),this._handleVerticalSpacing()},this._handleVerticalSpacing=function(){var t=this;this.verticalSpacing=parseFloat(this.spacingSlider.value),this.spacingValue.textContent=this.verticalSpacing+"px",setTimeout(function(){return t._drawGridLines()},50)},this._changeInstrument=function(){this.selectedInstrument=this.instrumentSelect.value,this.synth&&this.synth.createSynth(0,this.selectedInstrument,this.selectedInstrument,null),this.activity.textMsg(_("Instrument changed to: ")+this.selectedInstrument)},this._createInstrumentPieMenu=function(){var o=this,i=[_("Electronic Synth"),_("Piano"),_("Guitar"),_("Acoustic Guitar"),_("Electric Guitar"),_("Violin"),_("Viola"),_("Cello"),_("Bass"),_("Flute"),_("Clarinet"),_("Saxophone"),_("Trumpet"),_("Trombone"),_("Oboe"),_("Tuba"),_("Banjo"),_("Sine"),_("Square"),_("Sawtooth"),_("Triangle")],n=["electronic synth","piano","guitar","acoustic guitar","electric guitar","violin","viola","cello","bass","flute","clarinet","saxophone","trumpet","trombone","oboe","tuba","banjo","sine","square","sawtooth","triangle"],e={container:{x:this.instrumentButton.offsetLeft+this.instrumentButton.offsetWidth/2,y:this.instrumentButton.offsetTop+this.instrumentButton.offsetHeight/2,children:[],setChildIndex:function(t,e){}},text:{_text:this.selectedInstrument,get text(){return this._text},set text(t){this._text=t,this._updateCallback&&this._updateCallback(t)},_updateCallback:null},value:this.selectedInstrument,activity:{canvas:{offsetLeft:0,offsetTop:0},blocksContainer:{x:0,y:0},getStageScale:function(){return 1},logo:{synth:this.synth},turtles:{ithTurtle:function(t){return{singer:{instrumentNames:[o.selectedInstrument]}}}}},blocks:{blockScale:1,turtles:{_canvas:{width:window.innerWidth,height:window.innerHeight}}},updateCache:function(){},updateValue:function(t){o.selectedInstrument=t,o.instrumentButton.textContent=t.charAt(0).toUpperCase()+t.slice(1),o.synth&&o.synth.createSynth(0,o.selectedInstrument,o.selectedInstrument,null),o.activity.textMsg(_("Instrument changed to: ")+o.selectedInstrument),e.value=t,e.text.text=t}};e.text._updateCallback=function(e){var t=n[i.findIndex(function(t){return t.toLowerCase()===e.toLowerCase()})]||e.toLowerCase();o.selectedInstrument=t,o.instrumentButton.textContent=t.charAt(0).toUpperCase()+t.slice(1),o.synth&&o.synth.createSynth(0,o.selectedInstrument,o.selectedInstrument,null),o.activity.textMsg(_("Instrument changed to: ")+o.selectedInstrument)},piemenuVoices(e,i,n,[],this.selectedInstrument,!1)},this._handleZoom=function(){var t=this;this.imageWrapper&&(this.currentZoom=parseFloat(this.zoomSlider.value),this.imageWrapper.style.transform="scale(".concat(this.currentZoom,")"),this.zoomValue.textContent=Math.round(100*this.currentZoom)+"%",this.imageWrapper.style.width="100%",this.imageWrapper.style.height="100%",setTimeout(function(){return t._drawGridLines()},50))},this._drawGridLines=function(){if(this.rowHeaderTable.rows.length&&this.gridOverlay){this.gridOverlay.innerHTML="";for(var t=this.matrixData.rows.length,e=0;e<t;e++){var o=document.createElement("div"),i=(o.style.position="absolute",o.style.left="0px",o.style.right="0px",o.style.height="2px",o.style.backgroundColor="red",o.style.zIndex="5",40*(e+1));o.style.top="".concat(i,"px"),this.gridOverlay.appendChild(o)}var n=this.gridOverlay.getBoundingClientRect().width||this.gridOverlay.offsetWidth||800;if(0<n)for(var r=Math.floor(n/this.verticalSpacing),a=1;a<=r;a++){var l=document.createElement("div"),s=(l.style.position="absolute",l.style.top="0px",l.style.bottom="0px",l.style.width="2px",l.style.backgroundColor="blue",l.style.zIndex="5",a*this.verticalSpacing);l.style.left="".concat(s,"px"),this.gridOverlay.appendChild(l)}}},this._scale=function(){var t=this;setTimeout(function(){return t._drawGridLines()},300)},this.show=function(){this.widgetWindow&&this.widgetWindow.show()},this.updateParams=function(t){t.zoom&&this.zoomSlider&&(this.zoomSlider.value=t.zoom,this._handleZoom())},this._playPhrase=function(){var n=this;this._stopPlayback(),this.activity.textMsg(_("Scanning image with vertical lines...")),this.hasGeneratedVisualization=!1,Array.from(this.gridOverlay.querySelectorAll("div")).filter(function(t){return"red"===t.style.backgroundColor}).sort(function(t,e){return parseFloat(t.style.top)-parseFloat(e.style.top)});this.scanningLines=[],this.colorData=[];var r=this.gridOverlay.getBoundingClientRect().height||40*this.matrixData.rows.length;this.matrixData.rows.filter(function(t){return t.note}).length;this.matrixData.rows.forEach(function(t,e){var o,i;t.note&&(n.colorData.push({note:t.note,label:t.label,colorSegments:[]}),t=40*(e+1),o=Math.max(0,Math.min(40*e,r)),t=Math.max(0,Math.min(t,r)),r<=o||t<=0?n.colorData[n.colorData.length-1].colorSegments.push({color:n.selectedBackgroundColor.name,duration:5e3,timestamp:performance.now()}):((i=document.createElement("div")).style.position="absolute",i.style.width="3px",i.style.height=t-o+"px",i.style.backgroundColor="rgba(255, 0, 0, 0.7)",i.style.zIndex="20",i.style.left="0px",i.style.top=o+"px",i.dataset.lineId=e,n.gridOverlay.appendChild(i),n.scanningLines.push({element:i,topPos:o,bottomPos:t,currentX:0,currentColor:null,colorStartTime:null,lastSignificantColor:null,completed:!1,rowIndex:e})))}),this.isPlaying=!0,this.startTime=performance.now(),this.lastFrameTime=this.startTime,this._animateLines()},this._animateLines=function(){var o,i,n,r,a,l=this;this.isPlaying&&(o=performance.now(),i=(o-this.lastFrameTime)/1e3,this.lastFrameTime=o,n=this.gridOverlay.getBoundingClientRect(),r=this.verticalSpacing/.5,a=!0,this.scanningLines.forEach(function(t){var e;t.completed||(t.currentX+=r*i,n.width<t.currentX?(t.completed=!0,t.lastSignificantColor&&t.colorStartTime&&1<(e=(o-t.colorStartTime)/1e3)&&l.colorData[t.rowIndex].colorSegments.push({color:t.lastSignificantColor.name,duration:e,endTime:o-l.startTime})):l._isLineBeyondImageHorizontally(t)?(t.completed=!0,t.lastSignificantColor&&t.colorStartTime&&1<(e=(o-t.colorStartTime)/1e3)&&l.colorData[t.rowIndex].colorSegments.push({color:t.lastSignificantColor.name,duration:e,endTime:o-l.startTime})):(a=!1,t.element.style.left=t.currentX+"px",l._sampleAndDetectColor(t,o)))}),a?this._stopPlayback():requestAnimationFrame(function(){return l._animateLines()}))},this._isLineBeyondImageHorizontally=function(t){var e,o=null;return!!(o=this.imageWrapper?this.imageWrapper.querySelector("img")||this.imageWrapper.querySelector("video"):o)&&(o=o.getBoundingClientRect(),e=this.gridOverlay.getBoundingClientRect(),o.left-e.left+o.width<=t.currentX)},this._stopPlayback=function(){var o,i=this;this.isPlaying=!1,this.scanningLines&&(o=performance.now(),this.scanningLines.forEach(function(t){var e;t.currentColor&&t.colorStartTime&&1e3<(e=o-t.colorStartTime)&&i._addColorSegment(t.rowIndex,t.currentColor,e),t.element&&t.element.parentNode&&t.element.parentNode.removeChild(t.element)}),this.scanningLines=null),!this.hasGeneratedVisualization&&this.colorData&&0<this.colorData.length&&this.colorData.some(function(t){return t.colorSegments&&0<t.colorSegments.length})&&(this._mergeConsecutiveColorSegments(),this.hasGeneratedVisualization=!0,setTimeout(function(){i._generateColorVisualization(),i._drawColumnLinesOnCanvas()},100))},this._mergeConsecutiveColorSegments=function(){var a=this;this.colorData.forEach(function(t){if(t.colorSegments&&!(t.colorSegments.length<=1)){var e,o=[],i=null,n=_createForOfIteratorHelper(t.colorSegments);try{for(n.s();!(e=n.n()).done;){var r=e.value;i?a._shouldMergeColors(i.color,r.color)?(i.duration+=r.duration,i.endTime=r.endTime):(o.push(i),i={color:r.color,duration:r.duration,endTime:r.endTime}):i={color:r.color,duration:r.duration,endTime:r.endTime}}}catch(t){n.e(t)}finally{n.f()}i&&o.push(i),t.colorSegments=o}})},this._shouldMergeColors=function(t,e){var o;return t===e||!(!(o=["white","gray","black"]).includes(t)||!o.includes(e))},this._sampleAndDetectColor=function(t,e){var o=null;if(o=this.imageWrapper?this.imageWrapper.querySelector("img")||this.imageWrapper.querySelector("video"):o){var i=this._getColorForCanvasRow(t,o);if(i)t.currentColor&&t.currentColor.name===i.name||500<(t.lastColorChangeTime?e-t.lastColorChangeTime:1e3)&&(t.currentColor&&t.colorStartTime&&1e3<(a=e-t.colorStartTime)&&this._addColorSegment(t.rowIndex,t.currentColor,a),t.currentColor=i,t.colorStartTime=e,t.lastColorChangeTime=e);else{var n=document.createElement("canvas"),r=n.getContext("2d"),a=o.getBoundingClientRect(),i=this.gridOverlay.getBoundingClientRect();n.width=o.naturalWidth||o.videoWidth||a.width,n.height=o.naturalHeight||o.videoHeight||a.height;try{r.drawImage(o,0,0,n.width,n.height)}catch(t){return void console.error("Error drawing image to canvas:",t)}var a=o.getBoundingClientRect(),o=a.left-i.left,i=a.top-i.top,o=t.currentX-o,l=t.topPos-i,i=t.bottomPos-i;if(!(o<0||o>=a.width)){for(var s=n.width/a.width,a=n.height/a.height,c=Math.floor(o*s),h=Math.max(0,Math.floor(l*a)),u=Math.min(n.height,Math.floor(i*a)),d={},p=0,m=0;m<32;m++){var g=h+m*(u-h)/31;if(0<=c&&c<n.width&&0<=g&&g<n.height)try{var y,f,v,C,b,w=r.getImageData(c,g,1,1),x=_slicedToArray(w.data,3),_=x[0],S=x[1],D=x[2];w.data[3]<128||(f=(y=_slicedToArray(this._rgbToHsl(_,S,D),3))[0],v=y[1],C=y[2],(b=this._getColorFamily(f,v,C))&&"unknown"!==b.name&&(d[b.name]=(d[b.name]||0)+1,p++))}catch(t){console.error("Error sampling pixel data:",t)}}if(!(p<1)){for(var k=null,T=0,B=Math.max(1,Math.floor(.25*p)),F=0,E=Object.entries(d);F<E.length;F++){var P=_slicedToArray(E[F],2),z=P[0],P=P[1];T<P&&B<=P&&(T=P,k=this._getColorFamilyByName(z))}!k||t.currentColor&&this._colorsAreSimilar(t.currentColor,k)||500<(t.lastColorChangeTime?e-t.lastColorChangeTime:1e3)&&(t.currentColor&&t.colorStartTime&&1e3<(o=e-t.colorStartTime)&&this._addColorSegment(t.rowIndex,t.currentColor,o),t.currentColor=k,t.colorStartTime=e,t.lastColorChangeTime=e)}}}}else console.warn("No image or video element found for color sampling")},this._getColorFamilyByName=function(t){return{red:{name:"red",hue:0},orange:{name:"orange",hue:30},yellow:{name:"yellow",hue:60},green:{name:"green",hue:120},cyan:{name:"cyan",hue:180},blue:{name:"blue",hue:240},purple:{name:"purple",hue:270},magenta:{name:"magenta",hue:300},pink:{name:"pink",hue:330},white:{name:"white",hue:0},black:{name:"black",hue:0},gray:{name:"gray",hue:0}}[t]||null},this._addColorSegment=function(t,e,o){this.colorData[t]||(this.colorData[t]={note:this.this.matrixData.rows[t].note,label:this.this.matrixData.rows[t].label,colorSegments:[]}),this.colorData[t].colorSegments.push({color:e.name,duration:o,timestamp:performance.now()})},this._drawColumnLinesOnCanvas=function(){var t,o,i,n,r=this;this.colorData&&0!==this.colorData.length&&(this.gridOverlay.querySelectorAll(".column-line").forEach(function(t){return t.remove()}),t=this._analyzeColumnBoundaries(),o=this._filterSmallSegments(t),i=this.gridOverlay.getBoundingClientRect().width||800,n=o[o.length-1]-o[0],o.forEach(function(t,e){0!==e&&(e=t-o[0],0<(t=Math.round(e/n*i)))&&t<i&&((e=document.createElement("div")).className="column-line",e.style.position="absolute",e.style.top="0px",e.style.bottom="0px",e.style.width="2px",e.style.backgroundColor="#0066FF",e.style.zIndex="15",e.style.left="".concat(t,"px"),r.gridOverlay.appendChild(e))}))},this._drawColumnLines=function(o,t,i,n,r){var e=this._analyzeColumnBoundaries(),a=this._filterSmallSegments(e),l=a[a.length-1]-a[0];o.strokeStyle="#0066FF",o.lineWidth=3,a.forEach(function(t,e){0!==e&&(e=t-a[0],t=n+Math.round(e/l*r),n<=t)&&t<=n+r&&(o.beginPath(),o.moveTo(t,0),o.lineTo(t,i),o.stroke())})},this._generateColorVisualization=function(){var a,t,e,l,s;this.colorData&&0!==this.colorData.length&&(a=800,t=50*this.colorData.length,(e=document.createElement("canvas")).width=a,e.height=t,(l=e.getContext("2d")).fillStyle="#f0f0f0",l.fillRect(0,0,a,t),s={red:"#FF0000",orange:"#FFA500",yellow:"#FFFF00",green:"#00FF00",blue:"#0000FF",purple:"#800080",pink:"#FFC0CB",cyan:"#00FFFF",magenta:"#FF00FF",white:"#FFFFFF",black:"#000000",gray:"#808080",unknown:"#C0C0C0"},this.colorData.forEach(function(t,e){var i,n,r,o=50*e;l.fillStyle=e%2==0?"#ffffff":"#f8f8f8",l.fillRect(0,o,a,50),l.fillStyle="#000000",l.font="12px Arial",l.textAlign="left",l.fillText("".concat(t.label," (").concat(t.note,")"),10,20+o),t.colorSegments&&0<t.colorSegments.length?(i=150,n=10+o,r=t.colorSegments.reduce(function(t,e){return t+e.duration},0),t.colorSegments.forEach(function(t,e){var o=Math.max(20,t.duration/r*630);l.fillStyle=s[t.color]||s.unknown,l.fillRect(i,n,o,30),l.strokeStyle="#333333",l.lineWidth=1,l.strokeRect(i,n,o,30),40<o&&(l.fillStyle="white"===t.color||"yellow"===t.color?"#000000":"#ffffff",l.font="10px Arial",l.textAlign="center",l.fillText(t.color,i+o/2,15+n+3)),l.fillStyle="#666666",l.font="8px Arial",l.textAlign="center",l.fillText("".concat(Math.round(t.duration),"ms"),i+o/2,30+n+12),i+=o+2})):(l.fillStyle="#cccccc",l.font="12px Arial",l.textAlign="left",l.fillText("No colors were detected",150,25+o)),l.strokeStyle="#dddddd",l.lineWidth=1,l.beginPath(),l.moveTo(0,50+o),l.lineTo(a,50+o),l.stroke()}),this._drawColumnLines(l,a,t,150,630),l.fillStyle="#000000",l.font="bold 16px Arial",l.textAlign="center",l.fillText("Color Detection Visualization",400,-10),e.toBlob(function(t){var t=URL.createObjectURL(t),e=document.createElement("a");e.href=t,e.download="color_detection_".concat((new Date).getTime(),".png"),document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(t)},"image/png"),this.playColorMusicPolyphonic(this.colorData))},this.playColorMusicPolyphonic=(()=>{var e=_asyncToGenerator(_regenerator().m(function t(e){var o,p,i,n,r,a,l,s,m=this;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:this.synth||this._initAudio(),i=this._analyzeColumnBoundaries(),o=this._filterSmallSegments(i),p=[],i=_regenerator().m(function t(){var u,d;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:u=o[n],d=o[n+1],e.forEach(function(t,e){if(t.colorSegments&&t.note){var o,i=0,n=!1,r=_createForOfIteratorHelper(t.colorSegments);try{for(r.s();!(o=r.n()).done;){var a=o.value,l=i,s=i+a.duration;if(l<d&&u<s){var c=Math.max(l,u),h=Math.min(s,d)-c;if(1e3<h&&a.color!==m.selectedBackgroundColor.name){n=!0;break}h<=350&&(a.color,m.selectedBackgroundColor.name)}i+=a.duration}}catch(t){r.e(t)}finally{r.f()}n&&(p.push({time:u,type:"on",note:t.note,rowIdx:e}),p.push({time:d,type:"off",note:t.note,rowIdx:e}))}});case 1:return t.a(2)}},t)}),n=0;case 1:if(n<o.length-1)return t.d(_regeneratorValues(i()),2);t.n=3;break;case 2:n++,t.n=1;break;case 3:p.sort(function(t,e){return t.time-e.time}),r=new Set,a=0,l=_regenerator().m(function t(){var e,o;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(e=p[s],0<(o=e.time-a))return t.n=1,new Promise(function(t){return setTimeout(t,o)});t.n=1;break;case 1:"on"===e.type?r.has(e.note)||(m.synth.trigger(0,e.note,999,m.selectedInstrument,null,null,!1,0),r.add(e.note)):"off"===e.type&&(m.synth.stopSound(0,m.selectedInstrument,e.note),r.delete(e.note)),a=e.time;case 2:return t.a(2)}},t)}),s=0;case 4:if(s<p.length)return t.d(_regeneratorValues(l()),5);t.n=6;break;case 5:s++,t.n=4;break;case 6:r.forEach(function(t){m.synth.stopSound(0,m.selectedInstrument,t)});case 7:return t.a(2)}},t,this)}));return function(t){return e.apply(this,arguments)}})()}
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var l=t[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var MeterWidget=(()=>{function u(e,n){var t,a,s,o=this,i=(_classCallCheck(this,u),this.activity=e,this._meterBlock=this.activity.logo._meterBlock,this._strongBeats=[],this._playing=!1,this._click_lock=!1,this._beatValue=.25,window.innerWidth),l=(this._cellScale=i/1200,window.widgetWindows.windowFor(this,"meter")),h=((this.widgetWindow=l).clear(),this.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),this.activity.logo.synth.loadSynth(0,"kick drum"),Singer.setSynthVolume(this.activity.logo,0,"kick drum",PREVIEWVOLUME),this.activity.logo.synth.loadSynth(0,"snare drum"),Singer.setSynthVolume(this.activity.logo,0,"snare drum",PREVIEWVOLUME),this.meterDiv=document.createElement("table"),l.getWidgetBody().append(this.meterDiv),l.onclose=function(){o._playing=!1,o.activity.hideMsgs(),l.destroy()},l.onmaximize=this._scale,this._click_lock=!1,l.addButton("play-button.svg",u.ICONSIZE,_("Play"))),i=(h.onclick=function(){o._get_click_lock()||(o._click_lock=!0,o.__getPlayingStatus()?(h.innerHTML='&nbsp;&nbsp;<img \n                            src="header-icons/play-button.svg" \n                            title="'.concat(_("Play all"),'" \n                            alt="').concat(_("Play all"),'" \n                            height="').concat(u.ICONSIZE,'" \n                            width="').concat(u.ICONSIZE,'" \n                            vertical-align="middle"\n                        >&nbsp;&nbsp;'),o._playing=!1):(h.innerHTML='&nbsp;&nbsp;<img \n                            src="header-icons/stop-button.svg" \n                            title="'.concat(_("Stop"),'" \n                            alt="').concat(_("Stop"),'" \n                            height="').concat(u.ICONSIZE,'" \n                            width="').concat(u.ICONSIZE,'" \n                            vertical-align="middle"\n                        >&nbsp;&nbsp;'),o._playing=!0,o.activity.logo.turtleDelay=0,o.activity.logo.resetSynth(0),o._playBeat()),setTimeout(function(){o._click_lock=!1},1e3))},l.addButton("export-chunk.svg",u.ICONSIZE,_("Save")).onclick=function(){o._save()},this.meterDiv),r=(i.style.display="inline",i.style.visibility="visible",i.style.border="0px",i.innerHTML='<div id="meterWheelDiv"></div>',null!==this._meterBlock?(t=null!==(a=this.activity.blocks.blockList[this._meterBlock].connections[1])?this.activity.blocks.blockList[a].value:4,i=this.activity.blocks.blockList[this._meterBlock].connections[2],s=this.activity.blocks.blockList[i].connections[2],null!==i&&(this._beatValue=this.activity.blocks.blockList[i].value),this._piemenuMeter(t,this._beatValue)):this._piemenuMeter(4,this._beatValue),document.createElement("div")),c=(r.className="wfbtItem",r.innerHTML='<input style="float: left;" value="'.concat(t,'" type="number" id="beatValue" min="1" max="16" >'),document.createElement("div"));c.className="wfbtItem",c.innerHTML='<input style="float: left;" value="'.concat(1/this._beatValue,'" type="number" id="beatValue" min="1" max="35">'),l._toolbar.appendChild(r),l._toolbar.appendChild(c),l.addButton("reload.svg",u.ICONSIZE,_("Reset")).onclick=function(){o._playing=!1;var e=r.children[0],t=c.children[0],e=(r.children[0].value=Math.min(e.max,Math.max(e.min,e.value)),c.children[0].value=Math.min(t.max,Math.max(t.min,t.value)),o.activity.blocks.blockList[a]),t=o.activity.blocks.blockList[s],i=r.children[0].value,l=c.children[0].value;e.value=i,e.text.text=i,e.container.setChildIndex(e.text,e.container.children.length-1),t.value=l,t.text.text=l,t.container.setChildIndex(t.text,t.container.children.length-1),o.activity.logo.runLogoCommands(n)},e.textMsg(_("Click in the circle to select strong beats for the meter."),3e3),l.sendToCenter(),this._scale.call(this.widgetWindow)}return _createClass(u,[{key:"_scale",value:function(){var e=this.getWidgetFrame().offsetHeight-this.getDragElement().offsetHeight,t=this.getWidgetBody().getElementsByTagName("svg")[0],e=this.isMaximized()?e/400:1;t.style.pointerEvents="none",t.setAttribute("height","".concat(400*e,"px")),t.setAttribute("width","".concat(400*e,"px")),setTimeout(function(){t.style.pointerEvents="auto"},100)}},{key:"_get_click_lock",value:function(){return this._click_lock}},{key:"__playDrum",value:function(e){this.activity.logo.synth.trigger(0,"C4",Singer.defaultBPMFactor*this._beatValue,e,null,null)}},{key:"__getPlayingStatus",value:function(){return this._playing}},{key:"__getPauseStatus",value:function(){return!this._playing}},{key:"__playOneBeat",value:function(e,t){var i=this;if(this.__getPauseStatus())for(var l=0;l<this._strongBeats.length;l++)this._playWheel.navItems[l].navItem.hide();else{var n=e-1;n<0&&(n+=this._strongBeats.length),this._playWheel.navItems[e].navItem.show(),this._playWheel.navItems[n].navItem.hide(),this._strongBeats[e]?this.__playDrum("snare drum"):this.__playDrum("kick drum"),setTimeout(function(){i.__playOneBeat((e+1)%i._strongBeats.length,t)},t)}}},{key:"_playBeat",value:function(){for(var e=this.activity.turtles.ithTurtle(0),e=TONEBPM/(0<e.singer.bpm.length?last(e.singer.bpm):Singer.masterBPM),t=0;t<this._strongBeats.length;t++)this._playWheel.navItems[t].navItem.hide();e=1e3*e*this._beatValue;this.__playOneBeat(0,e)}},{key:"_addButton",value:function(e,t,i,l){var n=this,e=e.insertCell(-1);return e.innerHTML='&nbsp;&nbsp;<img \n                src="header-icons/'.concat(t,'" \n                title="').concat(l,'" \n                alt="').concat(l,'" \n                height="').concat(i,'" \n                width="').concat(i,'" \n                vertical-align="middle" \n                align-content="center"\n            >&nbsp;&nbsp;'),e.style.width=u.BUTTONSIZE+"px",e.style.minWidth=e.style.width,e.style.maxWidth=e.style.width,e.style.height=e.style.width,e.style.minHeight=e.style.height,e.style.maxHeight=e.style.height,e.style.backgroundColor=platformColor.selectorBackground,e.onmouseover=function(){n.style.backgroundColor=platformColor.selectorBackgroundHOVER},e.onmouseout=function(){n.style.backgroundColor=platformColor.selectorBackground},e}},{key:"_save",value:function(){for(var e=[],t=[],i=this._strongBeats.length,l=0;l<i;l++)this._strongBeats[l]&&e.push(l);for(var n=0,a=0;a<e.length;a++)0===a?(t.push(1===e.length?[0,"onbeatdo",100,100,[null,1,2,null]]:[0,"onbeatdo",100,100,[null,1,2,3]]),t.push([1,["number",{value:e[a]+1}],0,0,[0]]),t.push([2,["text",{value:"action"}],0,0,[0]])):(t.push(a===e.length-1?[n,"onbeatdo",0,0,[n-3,n+1,n+2,null]]:[n,"onbeatdo",0,0,[n-3,n+1,n+2,n+3]]),t.push([n+1,["number",{value:e[a]+1}],0,0,[n]]),t.push([n+2,["text",{value:"action"}],0,0,[n]])),n+=3;this.activity.blocks.loadNewBlocks(t)}},{key:"_piemenuMeter",value:function(e,t){var i=this,l=(docById("meterWheelDiv").style.display="flex",docById("meterWheelDiv").style.justifyContent="center",this._meterWheel=new wheelnav("meterWheelDiv",null,400,400),this._beatWheel=new wheelnav("_beatWheel",this._meterWheel.raphael),this._playWheel=new wheelnav("_playWheel",this._meterWheel.raphael),wheelnav.cssMeter=!0,this._meterWheel.colors=platformColor.modeWheelcolors,this._meterWheel.slicePathFunction=slicePath().DonutSlice,this._meterWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._meterWheel.slicePathCustom.minRadiusPercent=.4,this._meterWheel.slicePathCustom.maxRadiusPercent=.75,this._meterWheel.sliceSelectedPathCustom=this._meterWheel.slicePathCustom,this._meterWheel.sliceInitPathCustom=this._meterWheel.slicePathCustom,this._meterWheel.clickModeRotate=!1,this._meterWheel.navAngle=-90,this._meterWheel.animatetime=0,16<e&&(e=16),["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"]),n=[];this._strongBeats=[];for(var a=0;a<e;a++)n.push(l[a]),this._strongBeats.push(!1);this._meterWheel.createWheel(n),this._beatWheel.colors=platformColor.modeWheelcolors,this._beatWheel.slicePathFunction=slicePath().DonutSlice,this._beatWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._beatWheel.slicePathCustom.minRadiusPercent=.75,this._beatWheel.slicePathCustom.maxRadiusPercent=.9,this._beatWheel.sliceSelectedPathCustom=this._beatWheel.slicePathCustom,this._beatWheel.sliceInitPathCustom=this._beatWheel.slicePathCustom,this._beatWheel.clickModeRotate=!1,this._beatWheel.navAngle=-90,this._beatWheel.titleRotateAngle=90;for(var n=[],s=0;s<e;s++)n.push("x");this._beatWheel.createWheel(n),this._playWheel.colors=[platformColor.orange],this._playWheel.slicePathFunction=slicePath().DonutSlice,this._playWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._playWheel.slicePathCustom.minRadiusPercent=.3,this._playWheel.slicePathCustom.maxRadiusPercent=.4,this._playWheel.sliceSelectedPathCustom=this._playWheel.slicePathCustom,this._playWheel.sliceInitPathCustom=this._playWheel.slicePathCustom,this._playWheel.clickModeRotate=!1,this._playWheel.navAngle=-90,this._playWheel.titleRotateAngle=90,n=[];for(var o=0;o<e;o++)n.push(" ");this._playWheel.createWheel(n);for(var h=0;h<e;h++)this._playWheel.navItems[h].navItem.hide();for(var r=function(){var e=i._meterWheel.selectedNavItemIndex;i._strongBeats[e]=!0,i._beatWheel.navItems[e].navItem.show()},c=function(){var e=i._beatWheel.selectedNavItemIndex;i._beatWheel.navItems[e].navItem.hide(),i._strongBeats[e]=!1},u=0;u<e;u++)this._meterWheel.navItems[u].navigateFunction=r,this._beatWheel.navItems[u].navigateFunction=c,this._beatWheel.navItems[u].navItem.hide();this._setupDefaultStrongWeakBeats(e,t)}},{key:"_setupDefaultStrongWeakBeats",value:function(e,t){.25==t&&4==e?(this._strongBeats[0]=!0,this._strongBeats[2]=!0,this._beatWheel.navItems[0].navItem.show(),this._beatWheel.navItems[2].navItem.show()):.25==t&&2==e||.25==t&&3==e?(this._strongBeats[0]=!0,this._beatWheel.navItems[0].navItem.show()):.125==t&&6==e&&(this._strongBeats[0]=!0,this._strongBeats[3]=!0,this._beatWheel.navItems[0].navItem.show(),this._beatWheel.navItems[3].navItem.show())}}])})();_defineProperty(MeterWidget,"BUTTONDIVWIDTH",535),_defineProperty(MeterWidget,"BUTTONSIZE",53),_defineProperty(MeterWidget,"ICONSIZE",32);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,_toPropertyKey(s.key),s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var ModeWidget=(()=>{function o(e){var t=this,i=(_classCallCheck(this,o),this.activity=e,this._modeBlock=this.activity.logo.modeBlock,this._locked=!1,this._pitch=this.activity.turtles.ithTurtle(0).singer.keySignature[0],this._noteValue=.333,this._undoStack=[],this._playing=!1,this._selectedNotes=[],this._newPattern=[],window.innerWidth);this._cellScale=i/1200,this.widgetWindow=window.widgetWindows.windowFor(this,"custom mode"),this.widgetWindow.clear(),this.widgetWindow.show(),this.modeTableDiv=document.createElement("div"),this.modeTableDiv.style.display="inline",this.modeTableDiv.style.visibility="visible",this.modeTableDiv.style.border="0px",this.modeTableDiv.innerHTML='<div id="meterWheelDiv"></div>',this.modeTableDiv.innerHTML+='<div id="modePianoDiv" class=""></div>',this.modeTableDiv.innerHTML+='<table id="modeTable"></table>',this.widgetWindow.getWidgetBody().append(this.modeTableDiv),this.widgetWindow.onclose=function(){t._playing=!1,t.activity.hideMsgs(),t.widgetWindow.destroy()},this.widgetWindow.onmaximize=this._scale,this._playButton=this.widgetWindow.addButton("play-button.svg",o.ICONSIZE,_("Play")),this._playButton.onclick=function(){t.activity.logo.resetSynth(0),t._playingStatus()?(t._playing=!1,t._playButton.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play all"),'" \n                        alt="').concat(_("Play all"),'" \n                        height="').concat(o.ICONSIZE,'" \n                        width="').concat(o.ICONSIZE,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;')):(t._playing=!0,t._playButton.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/stop-button.svg" \n                        title="'.concat(_("Stop"),'" \n                        alt="').concat(_("Stop"),'" \n                        height="').concat(o.ICONSIZE,'" \n                        width="').concat(o.ICONSIZE,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;'),t._playAll())},this.widgetWindow.addButton("export-chunk.svg",o.ICONSIZE,_("Save")).onclick=this._save.bind(this),this.widgetWindow.addButton("erase-button.svg",o.ICONSIZE,_("Clear")).onclick=this._clear.bind(this),this.widgetWindow.addButton("rotate-left.svg",o.ICONSIZE,_("Rotate counter clockwise")).onclick=this._rotateLeft.bind(this),this.widgetWindow.addButton("rotate-right.svg",o.ICONSIZE,_("Rotate clockwise")).onclick=this._rotateRight.bind(this),this.widgetWindow.addButton("invert.svg",o.ICONSIZE,_("Invert")).onclick=this._invert.bind(this),this.widgetWindow.addButton("restore-button.svg",o.ICONSIZE,_("Undo")).onclick=this._undo.bind(this),this._piemenuMode();i=docById("modeTable").insertRow().insertCell();i.innerHTML="&nbsp;",i.style.backgroundColor=platformColor.selectorBackground,this._setMode(),e.textMsg(_("Click in the circle to select notes for the mode."),3e3),setTimeout(this.widgetWindow.sendToCenter,0)}return _createClass(o,[{key:"_playingStatus",value:function(){return this._playing}},{key:"_addButton",value:function(e,t,i,s){var n=this,e=e.insertCell(-1);return e.innerHTML='&nbsp;&nbsp;<img \n                src="header-icons/'.concat(t,'" \n                title="').concat(s,'" \n                alt="').concat(s,'" \n                height="').concat(i,'" \n                width="').concat(i,'" \n                vertical-align="middle" \n                align-content="center"\n            >&nbsp;&nbsp;'),e.style.width=o.BUTTONSIZE+"px",e.style.minWidth=e.style.width,e.style.maxWidth=e.style.width,e.style.height=e.style.width,e.style.minHeight=e.style.height,e.style.maxHeight=e.style.height,e.style.backgroundColor=platformColor.selectorBackground,e.onmouseover=function(){n.style.backgroundColor=platformColor.selectorBackgroundHOVER},e.onmouseout=function(){n.style.backgroundColor=platformColor.selectorBackground},e}},{key:"_scale",value:function(){var e=this.getWidgetFrame().offsetHeight-this.getDragElement().offsetHeight,t=this.getWidgetBody(),e=this.isMaximized?e/t.offsetHeight:1,i=(t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.children[0].style.display="flex",t.children[0].style.flexDirection="column",t.children[0].style.alignItems="center",this.getWidgetBody().getElementsByTagName("svg")[0]);i.style.pointerEvents="none",i.setAttribute("height","".concat(400*e,"px")),i.setAttribute("width","".concat(400*e,"px")),setTimeout(function(){i.style.pointerEvents="auto"},100)}},{key:"_setMode",value:function(){for(var e=keySignatureToMode(this.activity.turtles.ithTurtle(0).singer.keySignature),t=MUSICALMODES[e[1]],i=docById("modeTable"),s=i.rows.length-1,n=e[0]+" "+_(e[1]),l=(i.rows[s].cells[0].innerHTML=n,this.widgetWindow.updateTitle(n),0),o=0,a=0;a<12;a++)a===o?(this._noteWheel.navItems[a].navItem.show(),this._selectedNotes[a]=!0,o+=t[l],l+=1):this._noteWheel.navItems[a].navItem.hide();"C"===e[0]&&this._showPiano()}},{key:"_showPiano",value:function(){var e=docById("modePianoDiv"),t=(e.style.visibility="visible",e.style.position="relative",e.style.border="0px",e.style.top="0px",e.style.left="0px",e.innerHTML='<img src="images/piano_keys.png"  id="modeKeyboard" style="top:0px; left:0px; position:relative;">',["images/highlights/sel_c.png","images/highlights/sel_c_sharp.png","images/highlights/sel_d.png","images/highlights/sel_d_sharp.png","images/highlights/sel_e.png","images/highlights/sel_f.png","images/highlights/sel_f_sharp.png","images/highlights/sel_g.png","images/highlights/sel_g_sharp.png","images/highlights/sel_a.png","images/highlights/sel_a_sharp.png","images/highlights/sel_b.png"]),i=keySignatureToMode(this.activity.turtles.ithTurtle(0).singer.keySignature)[0],s={"C♭":11,C:0,"C♯":1,"D♭":1,D:2,"D♯":3,"E♭":3,E:4,"E♯":5,"F♭":4,F:5,"F♯":6,"G♭":6,G:7,"G♯":8,"A♭":8,A:9,"A♯":10,"B♭":10,B:11,"B♯":0},n=i in s?s[i]:0;e.innerHTML+='<img id="pkey_0" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_1" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_2" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_3" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_4" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_5" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_6" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_7" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_8" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_9" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_10" style="top:0px; left:0px; position:absolute;">',e.innerHTML+='<img id="pkey_11" style="top:0px; left:0px; position:absolute;">';for(var l=0;l<12;++l)this._selectedNotes[l]&&(document.getElementById("pkey_"+l).src=t[(l+n)%12])}},{key:"_invert",value:function(){this._locked||(this._locked=!0,this._saveState(),this.__invertOnePair(1),"C"===keySignatureToMode(this.activity.turtles.ithTurtle(0).singer.keySignature)[0]&&this._showPiano())}},{key:"__invertOnePair",value:function(e){var t=this,i=this._selectedNotes[e];this._selectedNotes[e]=this._selectedNotes[12-e],this._selectedNotes[e]?this._noteWheel.navItems[e].navItem.show():this._noteWheel.navItems[e].navItem.hide(),this._selectedNotes[12-e]=i,this._selectedNotes[12-e]?this._noteWheel.navItems[12-e].navItem.show():this._noteWheel.navItems[12-e].navItem.hide(),5===e?(this._saveState(),this._setModeName(),"C"===keySignatureToMode(this.activity.turtles.ithTurtle(0).singer.keySignature)[0]&&this._showPiano(),this._locked=!1):setTimeout(function(){t.__invertOnePair(e+1)},o.ROTATESPEED)}},{key:"_resetNotes",value:function(){for(var e=0;e<this._selectedNotes.length;e++)this._selectedNotes[e]?this._noteWheel.navItems[e].navItem.show():this._noteWheel.navItems[e].navItem.hide(),this._playWheel.navItems[e].navItem.hide()}},{key:"_rotateRight",value:function(){if(!this._locked){this._locked=!0,this._saveState(),this._newPattern=[],this._newPattern.push(this._selectedNotes[11]);for(var e=0;e<11;e++)this._newPattern.push(this._selectedNotes[e]);this.__rotateRightOneCell(1)}}},{key:"__rotateRightOneCell",value:function(e){var t=this;this._selectedNotes[e]=this._newPattern[e],this._selectedNotes[e]?this._noteWheel.navItems[e].navItem.show():this._noteWheel.navItems[e].navItem.hide(),0===e?setTimeout(function(){t._selectedNotes[0]?(t._saveState(),t._setModeName(),"C"===keySignatureToMode(t.activity.turtles.ithTurtle(0).singer.keySignature)[0]&&t._showPiano(),t._locked=!1):(t._locked=!1,t._rotateRight())},o.ROTATESPEED):setTimeout(function(){t.__rotateRightOneCell((e+1)%12)},o.ROTATESPEED)}},{key:"_rotateLeft",value:function(){if(!this._locked){this._locked=!0,this._saveState(),this._newPattern=[];for(var e=1;e<12;e++)this._newPattern.push(this._selectedNotes[e]);this._newPattern.push(this._selectedNotes[0]),this.__rotateLeftOneCell(11)}}},{key:"__rotateLeftOneCell",value:function(e){var t=this;this._selectedNotes[e]=this._newPattern[e],this._selectedNotes[e]?this._noteWheel.navItems[e].navItem.show():this._noteWheel.navItems[e].navItem.hide(),0===e?setTimeout(function(){t._selectedNotes[0]?(t._saveState(),t._setModeName(),"C"===keySignatureToMode(t.activity.turtles.ithTurtle(0).singer.keySignature)[0]&&t._showPiano(),t._locked=!1):(t._locked=!1,t._rotateLeft())},o.ROTATESPEED):setTimeout(function(){t.__rotateLeftOneCell(e-1)},o.ROTATESPEED)}},{key:"_playAll",value:function(){if(!this._locked){this.activity.logo.synth.stop(),this._locked=!0,this._notesToPlay=[];for(var e=0;e<12;e++)this._selectedNotes[e]&&this._notesToPlay.push(e);this._notesToPlay.push(12),this._notesToPlay.push(12);for(var t=11;-1<t;t--)this._selectedNotes[t]&&this._notesToPlay.push(t);this._lastNotePlayed=null,this._playing&&this.__playNextNote(0)}}},{key:"__playNextNote",value:function(i){var s=this,n=["images/highlights/sel_c.png","images/highlights/sel_c_sharp.png","images/highlights/sel_d.png","images/highlights/sel_d_sharp.png","images/highlights/sel_e.png","images/highlights/sel_f.png","images/highlights/sel_f_sharp.png","images/highlights/sel_g.png","images/highlights/sel_g_sharp.png","images/highlights/sel_a.png","images/highlights/sel_a_sharp.png","images/highlights/sel_b.png"],l=["images/animations/sel_c1.png","images/animations/sel_c_sharp1.png","images/animations/sel_d1.png","images/animations/sel_d_sharp1.png","images/animations/sel_e1.png","images/animations/sel_f1.png","images/animations/sel_f_sharp1.png","images/animations/sel_g1.png","images/animations/sel_g_sharp1.png","images/animations/sel_a1.png","images/animations/sel_a_sharp1.png","images/animations/sel_b1.png"],e=this._noteValue+.125;"C"===keySignatureToMode(this.activity.turtles.ithTurtle(0).singer.keySignature)[0]?i>this._notesToPlay.length-1?setTimeout(function(){s._playing=!1;var e=document.getElementById("pkey_0");null!==e&&(e.src=n[0]),s._playButton.innerHTML='&nbsp;&nbsp;<img \n                            src="header-icons/play-button.svg" \n                            title="'.concat(_("Play all"),'" \n                            alt="').concat(_("Play all"),'" \n                            height="').concat(o.ICONSIZE,'" \n                            width="').concat(o.ICONSIZE,'" \n                            vertical-align="middle"\n                        >&nbsp;&nbsp;'),s._resetNotes(),s._locked=!1},1e3*e):setTimeout(function(){null!==s._lastNotePlayed&&(s._playWheel.navItems[s._lastNotePlayed%12].navItem.hide(),null!==(e=document.getElementById("pkey_"+s._lastNotePlayed%12)))&&(e.src=n[(s._lastNotePlayed+0)%12]);var e=s._notesToPlay[i],t=(s._playWheel.navItems[e%12].navItem.show(),12!==e&&null!==(t=document.getElementById("pkey_"+e%12))&&(t.src=l[(e+0)%12]),s._lastNotePlayed=e,s.activity.turtles.ithTurtle(0).singer.keySignature),e=getNote(s._pitch,4,e,t,!1,null,s.activity.errorMsg);s.activity.logo.synth.trigger(0,e[0].replace(/♯/g,"#").replace(/♭/g,"b")+e[1],s._noteValue,DEFAULTVOICE,null,null),s._playing?s.__playNextNote(i+1):(s._locked=!1,setTimeout(s._resetNotes(),500))},1e3*e):i>this._notesToPlay.length-1?setTimeout(function(){s._playing=!1,s._playButton.innerHTML='&nbsp;&nbsp;<img \n                            src="header-icons/play-button.svg" \n                            title="'.concat(_("Play all"),'" \n                            alt="').concat(_("Play all"),'" \n                            height="').concat(o.ICONSIZE,'" \n                            width="').concat(o.ICONSIZE,'" \n                            vertical-align="middle"\n                        >&nbsp;&nbsp;'),s._resetNotes(),s._locked=!1},1e3*e):setTimeout(function(){null!==s._lastNotePlayed&&s._playWheel.navItems[s._lastNotePlayed%12].navItem.hide();var e=s._notesToPlay[i],t=(s._playWheel.navItems[e%12].navItem.show(),s._lastNotePlayed=e,s.activity.turtles.ithTurtle(0).singer.keySignature),e=getNote(s._pitch,4,e,t,!1,null,s.activity.errorMsg);s.activity.logo.synth.trigger(0,e[0].replace(/♯/g,"#").replace(/♭/g,"b")+e[1],s._noteValue,DEFAULTVOICE,null,null),s._playing?s.__playNextNote(i+1):(s._locked=!1,setTimeout(s._resetNotes(),500))},1e3*e)}},{key:"_playNote",value:function(e){var t=this.activity.turtles.ithTurtle(0).singer.keySignature,e=getNote(this._pitch,4,e,t,!1,null,this.activity.errorMsg);this.activity.logo.synth.trigger(0,e[0].replace(/♯/g,"#").replace(/♭/g,"b")+e[1],this._noteValue,DEFAULTVOICE,null,null)}},{key:"_saveState",value:function(){JSON.stringify(this._selectedNotes)!==last(this._undoStack)&&this._undoStack.push(JSON.stringify(this._selectedNotes))}},{key:"_undo",value:function(){if(0<this._undoStack.length){for(var e=JSON.parse(this._undoStack.pop()),t=0;t<12;t++)this._selectedNotes[t]=e[t];this._resetNotes(),this._setModeName(),"C"===keySignatureToMode(this.activity.turtles.ithTurtle(0).singer.keySignature)[0]&&this._showPiano()}}},{key:"_clear",value:function(){this._saveState();for(var e=1;e<12;e++)this._selectedNotes[e]=!1;this._resetNotes(),this._setModeName(),"C"===keySignatureToMode(this.activity.turtles.ithTurtle(0).singer.keySignature)[0]&&this._showPiano()}},{key:"_calculateMode",value:function(){for(var e=[],t=1,i=1;i<12;i++)this._selectedNotes[i]?(e.push(t),t=1):t+=1;return e.push(t),e}},{key:"_setModeName",value:function(){var e,t=docById("modeTable"),i=t.rows.length-1,s=JSON.stringify(this._calculateMode()),n=keySignatureToMode(this.activity.turtles.ithTurtle(0).singer.keySignature)[0];for(e in MUSICALMODES)if(JSON.stringify(MUSICALMODES[e])===s){if(null!=this._modeBlock){for(var l in this.activity.blocks.blockList)"modename"==this.activity.blocks.blockList[l].name?(this.activity.blocks.blockList[l].value=e,this.activity.blocks.blockList[l].text.text=_(e),this.activity.blocks.blockList[l].updateCache()):"notename"==this.activity.blocks.blockList[l].name&&(this.activity.blocks.blockList[l].value=n,this.activity.blocks.blockList[l].text.text=_(n));this.activity.refreshCanvas()}var o=n+" "+_(e);return t.rows[i].cells[0].innerHTML=o,void this.widgetWindow.updateTitle(o)}t.rows[i].cells[0].innerHTML="",this.widgetWindow.updateTitle("")}},{key:"_save",value:function(){for(var e=this,t=docById("modeTable"),i=t.rows.length-1,s=(""===t.rows[i].cells[0].innerHTML&&(s=this._calculateMode(),this.activity.storage.custommode=JSON.stringify(s)),t.rows[i].cells[0].innerHTML),n=[[0,["action",{collapsed:!0}],150,100,[null,1,2,null]],[1,["text",{value:s=""===s?_("custom"):s}],0,0,[0]]],l=0,o=this._calculateMode().length,a=0,h=0;h<12;h++){var r,c,d,u=11-h;this._selectedNotes[u]&&(a+=1,u=NOTESTABLE[(1+u)%12],c=(r=n.length)+1,d=r+2,a===o?n.push([r,"pitch",0,0,[l,c,d,null]]):n.push([r,"pitch",0,0,[l,c,d,r+3]]),n.push([c,["solfege",{value:u}],0,0,[r]]),n.push([d,["number",{value:4}],0,0,[r]]),l=r)}this.activity.blocks.loadNewBlocks(n),activity.textMsg(_("New action block generated."),3e3);for(var g,n=[[0,["definemode",{collapsed:!0}],150,150,[null,1,3,2]],[1,["text",{value:s}],0,0,[0]],[2,"hidden",0,0,[0,null]]],l=0,o=this._calculateMode().length,a=0,p=0;p<12;p++)this._selectedNotes[p]&&(a+=1,g=n.length,a===o?n.push([g,"pitchnumber",0,0,[l,g+1,null]]):n.push([g,"pitchnumber",0,0,[l,g+1,g+2]]),n.push([g+1,["number",{value:p}],0,0,[g]]),l=g);setTimeout(function(){e.activity.blocks.loadNewBlocks(n)},2e3)}},{key:"_piemenuMode",value:function(){for(var t=this,e=(docById("meterWheelDiv").style.display="",this._modeWheel=new wheelnav("meterWheelDiv",null,400,400),this._noteWheel=new wheelnav("_noteWheel",this._modeWheel.raphael),this._playWheel=new wheelnav("_playWheel",this._modeWheel.raphael),wheelnav.cssMeter=!0,this._modeWheel.colors=platformColor.modeWheelcolors,this._modeWheel.slicePathFunction=slicePath().DonutSlice,this._modeWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._modeWheel.slicePathCustom.minRadiusPercent=.4,this._modeWheel.slicePathCustom.maxRadiusPercent=.75,this._modeWheel.sliceSelectedPathCustom=this._modeWheel.slicePathCustom,this._modeWheel.sliceInitPathCustom=this._modeWheel.slicePathCustom,this._modeWheel.clickModeRotate=!1,this._modeWheel.navAngle=-90,["0","1","2","3","4","5","6","7","8","9","10","11"]),i=[],s=this._modeWheel.animatetime=0;s<12;s++)i.push(e[s]);this._modeWheel.createWheel(i),this._noteWheel.colors=platformColor.noteValueWheelcolors,this._noteWheel.slicePathFunction=slicePath().DonutSlice,this._noteWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._noteWheel.slicePathCustom.minRadiusPercent=.75,this._noteWheel.slicePathCustom.maxRadiusPercent=.9,this._noteWheel.sliceSelectedPathCustom=this._noteWheel.slicePathCustom,this._noteWheel.sliceInitPathCustom=this._noteWheel.slicePathCustom,this._noteWheel.clickModeRotate=!1,this._noteWheel.navAngle=-90,this._noteWheel.titleRotateAngle=90,i=[" "],this._selectedNotes=[!0];for(var n=1;n<12;n++)i.push("x"),this._selectedNotes.push(!1);this._noteWheel.createWheel(i),this._playWheel.colors=[platformColor.orange],this._playWheel.slicePathFunction=slicePath().DonutSlice,this._playWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._playWheel.slicePathCustom.minRadiusPercent=.3,this._playWheel.slicePathCustom.maxRadiusPercent=.4,this._playWheel.sliceSelectedPathCustom=this._playWheel.slicePathCustom,this._playWheel.sliceInitPathCustom=this._playWheel.slicePathCustom,this._playWheel.clickModeRotate=!1,this._playWheel.navAngle=-90,this._playWheel.titleRotateAngle=90;for(var i=[],l=0;l<12;l++)i.push(" ");this._playWheel.createWheel(i);for(var o=0;o<12;o++)this._playWheel.navItems[o].navItem.hide();for(var a=function(){var e=t._modeWheel.selectedNavItemIndex;t._saveState(),t._selectedNotes[e]=!0,t._noteWheel.navItems[e].navItem.show(),t._playNote(e),t._setModeName(),"C"===keySignatureToMode(t.activity.turtles.ithTurtle(0).singer.keySignature)[0]&&t._showPiano()},h=function(){var e=t._noteWheel.selectedNavItemIndex;0!=e&&(t._noteWheel.navItems[e].navItem.hide(),t._saveState(),t._selectedNotes[e]=!1,t._setModeName(),"C"===keySignatureToMode(t.activity.turtles.ithTurtle(0).singer.keySignature)[0])&&t._showPiano()},r=0;r<12;r++)this._modeWheel.navItems[r].navigateFunction=a,this._noteWheel.navItems[r].navigateFunction=h,this._noteWheel.navItems[r].navItem.hide()}}])})();_defineProperty(ModeWidget,"ICONSIZE",32),_defineProperty(ModeWidget,"BUTTONSIZE",53),_defineProperty(ModeWidget,"ROTATESPEED",125),_defineProperty(ModeWidget,"BUTTONDIVWIDTH",535);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var i,o=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,i)),o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(i),!0).forEach(function(t){_defineProperty(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var i;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(i="Object"===(i={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=Array(e);i<e;i++)o[i]=t[i];return o}function _iterableToArrayLimit(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var o,l,n,a,s=[],r=!0,c=!1;try{if(n=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;r=!1}else for(;!(r=(o=n.call(i)).done)&&(s.push(o.value),s.length!==e);r=!0);}catch(t){c=!0,l=t}finally{try{if(!r&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(c)throw l}}return s}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function MusicKeyboard(f){var r=this,k=1e5,u=32,y=[81,87,69,82,84,89,85,73,79,80],m=[49,50,51,52,53,54,55,56,57,48],p=[65,83,68,70,71,72,74,75,76],i=document.onkeydown,o=document.onkeyup,e=window.innerWidth,c=(this.activity=f,this._cellScale=e/1200,localStorage.beginnerMode),b="true"===c?8:16,I=(this._stopOrCloseClicked=!1,this.playingNow=!1,this.instruments=[],this.noteNames=[],this.octaves=[],this.keyboardShown=!0,this.layout=[],this.idContainer=[],this.tick=!1,this.metronomeInterval=!1,this.meterArgs=[4,.25],this.noteMapper={},this.blockNumberMapper={},this.instrumentMapper={},this.firstNote=!1,[]),h=null;function g(t){for(var e=[],i=[],o=[],l=null,n=1+k,a=0;a<t.length;a++)if("drum"===t[a].noteName)o.push(t[a]);else{if("hertz"!==t[a].noteName){l=[t[0].noteName,t[0].noteOctave];break}i.push(t[a])}if(null===l)return t;l[0]=convertFromSolfege(l[0]);var s=0;if("C"!==l[0])for(var r=0;r<PITCHES2.length&&(e.push({noteName:PITCHES2[r],noteOctave:l[1],blockNumber:t[0].blockNumber,voice:t[0].voice}),s=r,PITCHES2[r]!==l[0])&&PITCHES[r]!==l[0];r++)e[r].blockNumber=n,n+=1;else e.push({noteName:l[0],noteOctave:l[1],blockNumber:t[0].blockNumber,voice:t[0].voice});for(var c,h,u=l[1],d=1;d<t.length;d++)if("drum"===t[d].noteName)o.push(t[d]);else if("hertz"===t[d].noteName)i.push(t[d]);else{c=(l=[t[d].noteName,t[d].noteOctave])[1],h=t[d].voice,l[0]=convertFromSolfege(l[0]);var y=PITCHES.indexOf(l[0]);if(-1===y&&(y=PITCHES2.indexOf(l[0])),u<c&&(y+=12),y!==(s+1)%12)for(var m=(s%=12)+1;m<y;m++)m%12==0&&(u+=1),e.push({noteName:PITCHES2[m%12],noteOctave:u,blockNumber:n,voice:h}),n+=1;e.push({noteName:l[0],noteOctave:l[1],blockNumber:t[d].blockNumber,voice:t[d].voice}),u=c,s=y}if("C"!==l[0]){for(var p=PITCHES.indexOf(l[0]),b=((p=-1===p?PITCHES2.indexOf(l[0]):p)+1)%12;b<PITCHES2.length&&0!==b;b++)e.push({noteName:PITCHES2[b],noteOctave:l[1],blockNumber:n,voice:h}),n+=1;l[1]+=1,e.push({noteName:"C",noteOctave:l[1],blockNumber:n,voice:h}),n+=1}for(var v=0;v<i.length;v++)e.push(i[v]);for(var g=0;g<o.length;g++)e.push(o[g]);return e}this._rowBlocks=[],this._notesPlayed=[],this.addRowBlock=function(t){for(;r._rowBlocks.includes(t);)t+=1e6;r._rowBlocks.push(t)},this.processSelected=function(){if(0===r._notesPlayed.length)I=[];else{r._notesPlayed.sort(function(t,e){return t.startTime-e.startTime}),I=[{noteOctave:[r._notesPlayed[0].noteOctave],objId:[r._notesPlayed[0].objId],duration:[r._notesPlayed[0].duration],voice:[r._notesPlayed[0].voice],blockNumber:[r._notesPlayed[0].blockNumber],startTime:r._notesPlayed[0].startTime}];for(var t=0,e=1;e<r._notesPlayed.length;e++){for(;e<r._notesPlayed.length&&r._notesPlayed[e].startTime===r._notesPlayed[e-1].startTime;)I[t].noteOctave.push(r._notesPlayed[e].noteOctave),I[t].objId.push(r._notesPlayed[e].objId),I[t].duration.push(r._notesPlayed[e].duration),I[t].voice.push(r._notesPlayed[e].voice),I[t].blockNumber.push(r._notesPlayed[e].blockNumber),e++;t++,e<r._notesPlayed.length&&I.push({noteOctave:[r._notesPlayed[e].noteOctave],objId:[r._notesPlayed[e].objId],duration:[r._notesPlayed[e].duration],voice:[r._notesPlayed[e].voice],blockNumber:[r._notesPlayed[e].blockNumber],startTime:r._notesPlayed[e].startTime})}}},this.addKeyboardShortcuts=function(){var l=this,n=0,a={},s={},r={},i=new Set,c={},h=0,u=0,d=function(t){var e,t=t.keyCode;if(p.includes(t))e="whiteRow".concat(p.indexOf(t));else if(y.includes(t)){var i=y.indexOf(t);if([2,6,9,13,16,20].includes(i))return null;e="blackRow".concat(i)}else m.includes(t)?e="hertzRow".concat(m.indexOf(t)):32===t&&(e="rest");return e},e=function(t){var t=d(t),e=docById(t);t in a||(a[t]=(new Date).getTime()),null!=e&&(e.style.backgroundColor=platformColor.orange,s[t]=e.getAttribute("alt").split("__")[0],"hertz"===s[t]?r[t]=parseInt(e.getAttribute("alt").split("__")[1]):s[t]in FIXEDSOLFEGE1?r[t]=FIXEDSOLFEGE1[s[t]].replace(SHARP,"#").replace(FLAT,"b")+e.getAttribute("alt").split("__")[1]:r[t]=s[t].replace(SHARP,"#").replace(FLAT,"b")+e.getAttribute("alt").split("__")[1],"rest"!=t)&&(0===Object.keys(c).length?(c[t]=r[t],u=Math.floor(a[t]/100)):u===Math.floor(a[t]/100)?(c[t]=r[t],h++):(h=0,c={}),l.activity.logo.synth.trigger(0,r[t],1,l.instrumentMapper[t],null,null),l.tick&&void 0!==l.endTime&&l.firstNote&&(e=(e=(e=(a[t]-l.endTime)/1e3)/60*l.bpm)*l.meterArgs[1],.06<(e=parseFloat((Math.round(e*b)/b).toFixed(4))))&&0===i.size&&l._notesPlayed.push({startTime:l.endTime,noteOctave:"R",objId:null,duration:parseFloat(e)}),l.firstNote=!0)},o=function(t){var i,t=d(t),e=docById(t),o=(new Date).getTime();n=(o-a[t])/1e3,null!=e&&(t.includes("blackRow")?e.style.backgroundColor="black":e.style.backgroundColor="white",i=n/60,i=(i*=l.bpm)*l.meterArgs[1],(i=parseFloat((Math.round(i*b)/b).toFixed(4)))<=0&&(i=1/b),"rest"==t?l._notesPlayed.push({startTime:a[t],noteOctave:"R",objId:null,duration:parseFloat(i)}):(l.activity.logo.synth.stopSound(0,l.instrumentMapper[t],r[t]),t in c?Object.entries(c).forEach(function(t){var t=_slicedToArray(t,2),e=t[0];l._notesPlayed.push({startTime:100*u,noteOctave:t[1],objId:e,duration:i,voice:l.instrumentMapper[e],blockNumber:l.blockNumberMapper[e]}),delete c[e]}):0<h?h--:(l._notesPlayed.push({startTime:a[t],noteOctave:r[t],objId:t,duration:i,voice:l.instrumentMapper[t],blockNumber:l.blockNumberMapper[t]}),c={})),l._createTable(),l._updateWidgetWindowSize(),l.endTime=o,u=0,delete a[t],delete s[t],delete r[t])};document.onkeydown=function(t){i.has(t.keyCode)||(e(t),i.add(t.keyCode))},document.onkeyup=function(t){i.delete(t.keyCode),o(t)}},this.loadHandler=function(i,t,e){var o=this,l=this.displayLayout[t].noteName,l="hertz"===l?this.displayLayout[t].noteOctave:l in FIXEDSOLFEGE1?FIXEDSOLFEGE1[l].replace(SHARP,"#").replace(FLAT,"b")+this.displayLayout[t].noteOctave:l.replace(SHARP,"#").replace(FLAT,"b")+this.displayLayout[t].noteOctave,n=(this.blockNumberMapper[i.id]=e,this.instrumentMapper[i.id]=this.displayLayout[t].voice,this.noteMapper[i.id]=l,0),a=new Date,s=0;i.onmousedown=function(){var t;h=i,t=this,a=new Date,s=a.getTime(),t.style.backgroundColor=platformColor.orange,o.activity.logo.synth.trigger(0,o.noteMapper[t.id],1,o.instrumentMapper[t.id],null,null)};i.onmouseup=function(){var t,e;h=(h===i?((t=this).id.includes("blackRow")?t.style.backgroundColor="black":t.style.backgroundColor="white",e=new Date,n=e.getTime()-s,n/=1e3,o.activity.logo.synth.stopSound(0,o.instrumentMapper[t.id],o.noteMapper[t.id]),0===(n="true"===c?parseFloat((Math.round(8*n)/8).toFixed(3)):parseFloat((Math.round(16*n)/16).toFixed(4)))?n=.125:n<0&&(n=-n),o._notesPlayed.push({startTime:s,noteOctave:o.noteMapper[t.id],objId:t.id,duration:n,voice:o.instrumentMapper[t.id],blockNumber:o.blockNumberMapper[t.id]}),o._createTable(),o._updateWidgetWindowSize()):h.id.includes("blackRow")?h.style.backgroundColor="black":h.style.backgroundColor="white",null)}},this.init=function(){var l=this,t=(this.tick=!1,this.playingNow=!1,window.innerWidth),e=(this._cellScale=t/1200,window.widgetWindows.windowFor(this,"music keyboard")),t=((this.widgetWindow=e).clear(),e.show(),this.displayLayout=this._keysLayout(),this.activity.turtles.ithTurtle(0)),t=(this.bpm=0<t.singer.bpm.length?last(t.singer.bpm):Singer.masterBPM,this.widgetWindow.onmaximize=function(){this._updateWidgetWindowSize()}.bind(this),e.onclose=function(){var t;document.onkeydown=i,document.onkeyup=o,document.getElementById("keyboardHolder2")&&(document.getElementById("keyboardHolder2").style.display="none"),null!=(t=document.getElementById("myrow"))&&(t.innerHTML=""),null!=(t=document.getElementById("myrow2"))&&(t.innerHTML=""),l.tick=!1,l.firstNote=!1,l.metronomeON=!1,I=[],l.loopTick&&l.loopTick.stop(),docById("wheelDivptm").style.display="none",docById("wheelDivptm").style.display="none",l._menuWheel&&l._menuWheel.removeWheel(),l._pitchWheel&&l._pitchWheel.removeWheel(),l._tabsWheel&&l._tabsWheel.removeWheel(),l._exitWheel&&l._exitWheel.removeWheel(),l._durationWheel&&l._durationWheel.removeWheel(),l._accidentalsWheel&&l._accidentalsWheel.removeWheel(),l._octavesWheel&&l._octavesWheel.removeWheel(),e.destroy()},this.playButton=e.addButton("play-button.svg",u,_("Play")),this.playButton.onclick=function(){(l.metronomeInterval||l.metronomeON)&&l.stopMetronome(),l.activity.logo.turtleDelay=0,l.processSelected(),l.playAll()},e.addButton("export-chunk.svg",u,_("Save")).onclick=function(){l._save()},e.addButton("erase-button.svg",u,_("Clear")).onclick=function(){l._notesPlayed=[],I=[],l._createTable(),l._updateWidgetWindowSize()},e.addButton("add2.svg",u,_("Add note"))),t=(t.setAttribute("id","addnotes"),t.onclick=function(){l._createAddRowPieSubmenu()},this.midiButton=e.addButton("midi.svg",u,_("MIDI")),this.midiButton.onclick=function(){l.doMIDI()},this.tickButton=e.addButton("metronome.svg",u,_("Metronome")),this.stopMetronome=function(){l.tickButton.style.removeProperty("background"),l.tick&&l.loopTick&&l.loopTick.stop(),l.tick=!1,l.firstNote=!1,l.metronomeON=!1;var t=docById("countdownContainer");t&&t.remove(),l.metronomeInterval&&(clearInterval(l.metronomeInterval),l.metronomeInterval=null)},this.tickButton.onclick=function(){var t,e,i,o;l.metronomeInterval||l.metronomeON?l.stopMetronome():(l.metronomeON=!0,l.tickButton.style.background=platformColor.orange,t=document.getElementsByClassName("wfbWidget")[0],(e=document.createElement("div")).id="countdownContainer",(i=document.createElement("div")).id="countdownDisplay",i.textContent="3",e.appendChild(i),t.appendChild(e),o=3,l.metronomeInterval=setInterval(function(){0===--o?(clearInterval(l.metronomeInterval),l.metronomeInterval=null,e.remove(),l.metronomeON&&(l.tick=!0,l.activity.logo.synth.loadSynth(0,"cow bell"),l.loopTick=l.activity.logo.synth.loop(0,"cow bell","C5",1/64,0,l.bpm||90,.07))):i.textContent=o},1e3),l.metronomeON&&l.activity.logo.synth.start())},this.keyboardDiv=document.createElement("div"),document.createAttribute("id"));t.value="mkbKeyboardDiv",this.keyboardDiv.setAttributeNode(t),this.keyTable=document.createElement("div"),e.getWidgetBody().append(this.keyboardDiv),e.getWidgetBody().append(this.keyTable),e.getWidgetBody().style.height="550px",e.getWidgetBody().style.width="1000px",this._createKeyboard(),this._createTable(),Math.max(Math.min(window.innerWidth,758*this._cellScale-20),535),e.sendToCenter()},this.playAll=function(){var e=this;if(!(I.length<=0)){this.playingNow=!this.playingNow;var t=this.playButton;if(this.playingNow){if(t.innerHTML='&nbsp;&nbsp;<img src="header-icons/stop-button.svg" title="'+_("Stop")+'" alt="'+_("Stop")+'" height="'+u+'" width="'+u+'" vertical-align="middle" align-content="center">&nbsp;&nbsp;',!(I.length<1)){for(var i,o,l=[],n=0;n<I[0].noteOctave.length;n++)this.keyboardShown&&null!==I[0].objId[0]&&null!==(i=docById(I[0].objId[n]))&&(i.style.backgroundColor="lightgrey"),"string"==typeof(o=i=I[0].noteOctave[n])&&(o=i.replace(SHARP,"#").replace(FLAT,"b")),l.push(o);this.keyboardShown||(docById("cells-0").style.backgroundColor=platformColor.selectorBackground),this._stopOrCloseClicked=!1;var a=I[0].duration.map(function(t){return 60*t*4/e.bpm}),a=(this._playChord(l,a,I[0].voice),Math.max.apply(Math,_toConsumableArray(a)));this.playOne(1,a,t)}}else this.keyboardShown?this._createKeyboard():this._createTable(),this._stopOrCloseClicked=!0,t.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="').concat(u,'" \n                    width="').concat(u,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;')}},this.playOne=function(r,t,c){var h=this;setTimeout(function(){var t,e,i,o;if(r<I.length){if(!h._stopOrCloseClicked){if(h.keyboardShown||(docById("cells-"+r).style.backgroundColor=platformColor.selectorBackground),h.keyboardShown&&null!==I[r-1].objId[0])for(var l=0;l<I[r-1].noteOctave.length;l++)t=I[r-1].objId[l],e=docById(t),t.includes("blackRow")?e.style.backgroundColor="black":e.style.backgroundColor="white";for(var n,a=[],s=0;s<I[r].noteOctave.length;s++)h.keyboardShown&&null!==I[r].objId[0]&&null!==(e=docById(I[r].objId[s]))&&(e.style.backgroundColor="lightgrey"),"string"==typeof(o=i=I[r].noteOctave[s])&&(o=i.replace(SHARP,"#").replace(FLAT,"b")),a.push(o);h.playingNow&&(n=I[r].duration.map(function(t){return 60*t*4/h.bpm}),h._playChord(a,n,I[r].voice)),n=Math.max.apply(Math,_toConsumableArray(I[r].duration.map(function(t){return 60*t*4/h.bpm}))),h.playOne(r+1,n,c)}}else c.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(u,'" \n                        width="').concat(u,'" \n                        vertical-align="middle" \n                        align-content="center"\n                    >&nbsp;&nbsp;'),h.playingNow=!1,h.keyboardShown?h._createKeyboard():h._createTable(),h._updateWidgetWindowSize()},1e3*t)},this._playChord=function(t,e,i){"R"!==t[0]&&(setTimeout(function(){r.activity.logo.synth.trigger(0,t[0],e[0],i[0],null,null)},1),1<t.length&&setTimeout(function(){r.activity.logo.synth.trigger(0,t[1],e[0],i[1],null,null)},1),2<t.length&&setTimeout(function(){r.activity.logo.synth.trigger(0,t[2],e[0],i[2],null,null)},1),3<t.length)&&setTimeout(function(){r.activity.logo.synth.trigger(0,t[3],e[0],i[3],null,null)},1)},this._keysLayout=function(){for(var e=this,t=(this.layout=[],[]),i=0;i<this.noteNames.length;i++)"drum"===this.noteNames[i]?t.push({frequency:1e6+t.length,noteName:this.noteNames[i],noteOctave:this.octaves[i],blockNumber:this._rowBlocks[i],voice:this.instruments[i]}):"hertz"===this.noteNames[i]?t.push({frequency:this.octaves[i],noteName:this.noteNames[i],noteOctave:this.octaves[i],blockNumber:this._rowBlocks[i],voice:this.instruments[i]}):t.push({frequency:noteToFrequency(this.noteNames[i]+this.octaves[i],this.activity.turtles.ithTurtle(0).singer.keySignature),noteName:this.noteNames[i],noteOctave:this.octaves[i],blockNumber:this._rowBlocks[i],voice:this.instruments[i]});var o=t.sort(function(t,e){return t.frequency-e.frequency}),l=[];this.remove=[];for(var o=o.filter(function(t){return!l.includes(t.noteName+t.noteOctave)||"drum"===t.noteName?(l.push(t.noteName+t.noteOctave),!0):(e.remove.push(t.blockNumber),!1)}),n=0;n<this.remove.length;n++)((t,e)=>{setTimeout(function(){t._removePitchBlock(t.remove[e])},200)})(this,n);var a=o.filter(function(t){return"hertz"===t.noteName}),s=o.filter(function(t){return"hertz"!==t.noteName});o=s.concat(a);for(var r=(r=g(s)).concat(a),c=0;c<r.length;c++)this.layout.push({noteName:r[c].noteName,noteOctave:r[c].noteOctave,blockNumber:r[c].blockNumber,voice:r[c].voice});return r},this._setNotes=function(t,e){for(var i,o=docById("cells-"+t).getAttribute("start"),l=(this._notesPlayed=this._notesPlayed.filter(function(t){return t.startTime!=parseInt(o)}),!0),n=0;n<this.layout.length;n++)"black"===docById("mkb"+n).cells[t].style.backgroundColor&&(this._setNoteCell(n,t,o,e),l=!1);l&&(i=docById("cells-"+t).getAttribute("dur"),this._notesPlayed.push({startTime:parseInt(o),noteOctave:"R",objId:null,duration:parseFloat(i)}),this._notesPlayed.sort(function(t,e){return t.startTime-e.startTime}))},this._setNoteCell=function(t,e,i,o){var l=this.layout.length,n=this.layout[l-t-1].noteName,n="hertz"===n?this.layout[l-t-1].noteOctave:"drum"===n?"c2":n in FIXEDSOLFEGE1?FIXEDSOLFEGE1[n].replace(SHARP,"#").replace(FLAT,"b")+this.layout[l-t-1].noteOctave:n.replace(SHARP,"#").replace(FLAT,"b")+this.layout[l-t-1].noteOctave,e=docById(t+":"+e);this._notesPlayed.push({startTime:parseInt(i),noteOctave:n,blockNumber:this.layout[l-t-1].blockNumber,duration:parseFloat(e.getAttribute("alt")),objId:this.displayLayout[l-t-1].objId,voice:this.displayLayout[l-t-1].voice}),this._notesPlayed.sort(function(t,e){return t.startTime-e.startTime}),o&&this.activity.logo.synth.trigger(0,n,e.getAttribute("alt"),this.instruments[0],null,null)},this.makeClickable=function(){for(var e,i,o=this,t=docById("mkbNoteDurationRow"),l=0;l<I.length;l++)(e=t.cells[l]).onclick=function(t){e=t.target,o._createpiesubmenu(e.getAttribute("id"),e.getAttribute("start"),e.getAttribute("dur"))};for(var n=0;n<this.layout.length;n++)for(var a=docById("mkb"+n),s=0;s<a.cells.length;s++)(t=>{(e=a.cells[t]).setAttribute("id",n+":"+t),i=!1,e.onmousedown=function(t){e=t.target,i=!0;t=e.id.split(":"),t=Number(t[1]);"black"===e.style.backgroundColor?(e.style.backgroundColor=e.getAttribute("cellColor"),o._setNotes(t,!1)):(e.style.backgroundColor="black",o._setNotes(t,!0))},e.onmouseover=function(){i&&("black"===e.style.backgroundColor?(e.style.backgroundColor=e.getAttribute("cellColor"),o._setNotes(t,!1)):(e.style.backgroundColor="black",o._setNotes(t,!0)))},e.onmouseup=function(){i=!1}})(s)},this._updateWidgetWindowSize=function(){var t;this.widgetWindow._maximized?(this.widgetWindow.getWidgetBody().style.position="absolute",this.widgetWindow.getWidgetBody().style.height="calc(100vh - 64px)",this.widgetWindow.getWidgetBody().style.width="200vh",docById("mkbOuterDiv").style.maxHeight="725px",docById("mkbOuterDiv").style.height="calc(100vh - 64px)",docById("mkbOuterDiv").style.width="calc(200vh - 64px)",docById("keyboardHolder2").style.width="calc(200vh - 64px)",docById("mkbInnerDiv").style.width="95.5vw",docById("mkbInnerDiv").style.height="75%",(t=docById("mkbInnerDiv")).scrollLeft=t.scrollWidth,this.widgetWindow.getWidgetBody().style.left="60px"):(docById("mkbOuterDiv").style.maxHeight="400px",this.widgetWindow.getWidgetBody().style.position="relative",this.widgetWindow.getWidgetBody().style.left="0px",this.widgetWindow.getWidgetBody().style.height="550px",this.widgetWindow.getWidgetBody().style.width="1000px",docById("mkbOuterDiv").style.width=e+"px",docById("mkbInnerDiv").style.height="100%")},this._noteWidth=function(t){return Math.max(Math.floor(EIGHTHNOTEWIDTH*(8*t)*this._cellScale),15)},this._createTable=function(){var i=this,t=(this.processSelected(),this.keyTable),e=(t.style.display="inline",t.style.visibility="visible",t.style.border="0px",t.style.width="700px",t.innerHTML="",t.innerHTML='<div id="mkbOuterDiv"><div id="mkbInnerDiv"><table cellpadding="0px" id="mkbTable"></table></div></div>',Math.max(Math.floor(.5*window.innerHeight/100),8)),t=docById("mkbOuterDiv"),o=(t.style.overflowY="hidden",this.displayLayout.length>e?t.style.height=this._cellScale*MATRIXSOLFEHEIGHT*(e+5)+"px":t.style.height=this._cellScale*MATRIXSOLFEHEIGHT*(this.displayLayout.length+4)+"px",t.style.backgroundColor="white",t.style.marginTop="15px",docById("mkbInnerDiv").style.marginLeft=0,docById("mkbTable"));if(I.length<1)t.innerHTML="";else{var l,n,a=0;e=this.displayLayout.length;for(var s=this.displayLayout.length-1;0<=s;s--){var r=o.insertRow();(l=r.insertCell()).style.backgroundColor=platformColor.graphicsLabelBackground,l.style.fontSize=100*this._cellScale+"%",l.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+1+"px",l.style.width=1.5*Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",l.style.minWidth=1.5*Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",l.style.maxWidth=l.style.minWidth,l.style.position="sticky",l.style.left="0px",l.className="headcol","drum"===this.displayLayout[s].noteName?l.innerHTML=this.displayLayout[s].voice:"hertz"===this.displayLayout[s].noteName?l.innerHTML=this.displayLayout[s].noteOctave.toString()+"HZ":l.innerHTML="".concat(i18nSolfege(this.displayLayout[s].noteName),"<sub>").concat(this.displayLayout[s].noteOctave.toString(),"</sub>"),l.setAttribute("id","labelcol"+(e-s-1)),"hertz"===this.displayLayout[s].noteName?l.setAttribute("alt",e-s-1+"__synthsblocks"):l.setAttribute("alt",e-s-1+"__pitchblocks"),l.onclick=function(t){var t=(l=null===(l=t.target).getAttribute("alt")?l.parentNode:l).getAttribute("alt").split("__")[0],e=l.getAttribute("alt").split("__")[1];i._createColumnPieSubmenu(t,e)},r.insertCell().innerHTML='<table cellpadding="0px" id="mkbCellTable'.concat(a,'"></table>'),(n=docById("mkbCellTable"+a)).style.marginTop="-1px",n.insertRow().setAttribute("id","mkb"+a),a+=1}(r=o.insertRow()).style.position="sticky",r.style.bottom="0px",(l=r.insertCell()).style.backgroundColor=platformColor.graphicsLabelBackground,l.style.fontSize=100*this._cellScale+"%",l.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+1+"px",l.style.width=1.5*Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",l.style.minWidth=1.5*Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",l.style.maxWidth=l.style.minWidth,l.className="headcol",l.innerHTML=_("Note value"),l.style.position="sticky",l.style.left="0px",l.style.zIndex="1";r.insertCell().innerHTML='<table  class="mkbTable" cellpadding="0px"><tr id="mkbNoteDurationRow"></tr></table>';for(var c,h,u,d="lightgrey",y=0;y<I.length;y++){for(var m=Math.max.apply(Math,I[y].duration),p=2*this._noteWidth(Math.max.apply(Math,I[y].duration))+"px",e=this.displayLayout.length,b=0;b<this.displayLayout.length;b++)c=docById("mkb"+b),(l=c.insertCell()).style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+1+"px",l.style.width=p,l.style.minWidth=l.style.width,l.style.maxWidth=l.style.width,I[y].blockNumber.includes(this.displayLayout[e-b-1].blockNumber)?(h=I[y].blockNumber.indexOf(this.displayLayout[e-b-1].blockNumber),l.setAttribute("alt",I[y].duration[h]),l.style.backgroundColor="black"):(l.setAttribute("alt",m),l.style.backgroundColor=d),l.style.border="2px solid white",l.style.borderRadius="10px",l.setAttribute("cellColor",d);u=toFraction(Math.max.apply(Math,I[y].duration)),c=docById("mkbNoteDurationRow"),(l=c.insertCell()).style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+1+"px",l.style.width=p,l.style.minWidth=l.style.width,l.style.maxWidth=l.style.width,l.style.lineHeight="60%",l.style.textAlign="center",l.innerHTML="".concat(u[0].toString(),"/").concat(u[1].toString()),l.setAttribute("id","cells-"+y),l.setAttribute("start",I[y].startTime),l.setAttribute("dur",m),l.style.backgroundColor=platformColor.rhythmcellcolor,l.style.color=platformColor.textColor}t=docById("mkbInnerDiv");t.scrollLeft=t.scrollWidth,this.makeClickable(),this._updateWidgetWindowSize()}},this._createpiesubmenu=function(t,e){var i=this,o=(docById("wheelDivptm").style.display="",this._menuWheel=new wheelnav("wheelDivptm",null,600,600),this._exitWheel=new wheelnav("_exitWheel",this._menuWheel.raphael),this._tabsWheel=new wheelnav("_tabsWheel",this._menuWheel.raphael),this._durationWheel=new wheelnav("_durationWheel",this._menuWheel.raphael),this.newNoteValue=2,["divide","delete","add",String(this.newNoteValue)]),l=["1/8","1/4","3/8","1/2","5/8","3/4","7/8","1/1"],n=(wheelnav.cssMode=!0,this._menuWheel.keynavigateEnabled=!1,this._menuWheel.clickModeRotate=!1,this._menuWheel.colors=platformColor.pitchWheelcolors,this._menuWheel.slicePathFunction=slicePath().DonutSlice,this._menuWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._menuWheel.sliceSelectedPathCustom=this._menuWheel.slicePathCustom,this._menuWheel.sliceInitPathCustom=this._menuWheel.slicePathCustom,this._menuWheel.titleRotateAngle=90,this._menuWheel.animatetime=0,this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.keynavigateEnabled=!1,this._exitWheel.clickModeRotate=!1,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,["","","","","","","","","","","","","1","2","3","4","5","6","7",""]);this._menuWheel.slicePathCustom.minRadiusPercent=.2,this._menuWheel.slicePathCustom.maxRadiusPercent=.5,this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.2,this._tabsWheel.colors=platformColor.pitchWheelcolors,this._tabsWheel.slicePathFunction=slicePath().DonutSlice,this._tabsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._tabsWheel.slicePathCustom.minRadiusPercent=.5,this._tabsWheel.slicePathCustom.maxRadiusPercent=.7,this._tabsWheel.sliceSelectedPathCustom=this._tabsWheel.slicePathCustom,this._tabsWheel.sliceInitPathCustom=this._tabsWheel.slicePathCustom,this._tabsWheel.clickModeRotate=!1,this._tabsWheel.createWheel(n),this._durationWheel.colors=platformColor.pitchWheelcolors,this._durationWheel.keynavigateEnabled=!1,this._durationWheel.slicePathFunction=slicePath().DonutSlice,this._durationWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._durationWheel.slicePathCustom.minRadiusPercent=.7,this._durationWheel.slicePathCustom.maxRadiusPercent=1,this._durationWheel.sliceSelectedPathCustom=this._durationWheel.slicePathCustom,this._durationWheel.sliceInitPathCustom=this._durationWheel.slicePathCustom,this._durationWheel.clickModeRotate=!1,this._durationWheel.createWheel(l);for(var a=0;a<n.length;a++)this._tabsWheel.navItems[a].navItem.hide();this._menuWheel.createWheel(o),this._exitWheel.createWheel(["x",""]),docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="250px",docById("wheelDivptm").style.width="250px";for(var o=docById(t).getBoundingClientRect().x,s=docById(t).getBoundingClientRect().y,r=(docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,o*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,s*this.activity.getStageScale()))+"px",this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",i._menuWheel.removeWheel(),i._exitWheel.removeWheel()},0),c=(this._menuWheel.navItems[0].navigateFunction=function(){i._divideNotes(e,i.newNoteValue)},this._menuWheel.navItems[1].navigateFunction=function(){i._deleteNotes(e)},this._menuWheel.navItems[2].navigateFunction=function(){i._addNotes(t,e,i.newNoteValue)},this._menuWheel.navItems[3].navigateFunction=function(){if(r){for(var t=12;t<19;t++)docById("wheelnav-wheelDivptm-title-3").children[0].textContent=i.newNoteValue,i._tabsWheel.navItems[t].navItem.hide();r=0}else{for(var e=12;e<19;e++)docById("wheelnav-wheelDivptm-title-3").children[0].textContent=i.newNoteValue,i._tabsWheel.navItems[e].navItem.show();r=1}},function(){var t=i._durationWheel.selectedNavItemIndex,t=l[t].split("/");i._updateDuration(e,t)}),h=0;h<l.length;h++)this._durationWheel.navItems[h].navigateFunction=c;for(var u=12;u<19;u++)this._tabsWheel.navItems[u].navigateFunction=function(){var t=i._tabsWheel.selectedNavItemIndex;i.newNoteValue=n[t],docById("wheelnav-wheelDivptm-title-3").children[0].textContent=n[t]}},this._updateDuration=function(e,t){e=parseInt(e),t=parseInt(t[0])/parseInt(t[1]);var i=parseFloat((Math.round(8*t)/8).toFixed(3));this._notesPlayed=this._notesPlayed.map(function(t){return t.startTime===e&&(t.duration=i),t}),this._createTable()},this._addNotes=function(t,n,a){n=parseInt(n);var s=docById(t).getAttribute("dur");this._notesPlayed=this._notesPlayed.reduce(function(t,e){var i;if(parseInt(e.startTime)!==n)return parseInt(e.startTime)>n&&(e.startTime=e.startTime+1e3*s*a),t.concat([e]);t=t.concat([e]);for(var o=JSON.parse(JSON.stringify(e)),l=0;l<a;l++)(i=JSON.parse(JSON.stringify(o))).startTime=o.startTime+1e3*o.duration,t=t.concat([i]),o=i;return t},[]),this._createTable()},this._deleteNotes=function(e){e=parseInt(e),this._notesPlayed=this._notesPlayed.filter(function(t){return parseInt(t.startTime)!==e}),this._createTable()},this._divideNotes=function(a,s){a=parseInt(a),this._notesPlayed=this._notesPlayed.reduce(function(t,e){var i,o;if(parseInt(e.startTime)!==a)return t.concat([e]);if("true"===c){if(e.duration/s<.125)return t.concat([e])}else if(e.duration/s<.0625)return t.concat([e]);(i=JSON.parse(JSON.stringify(e))).duration=e.duration/s,t=t.concat([i]);for(var l=i,n=0;n<s-1;n++)(o=JSON.parse(JSON.stringify(l))).startTime=parseInt(o.startTime+1e3*o.duration),t=t.concat([o]),l=o;return t},[]),this._createTable()},this._createAddRowPieSubmenu=function(){for(var t,u=this,d=(docById("wheelDivptm").style.display="",["do","do♯","re","re♯","mi","fa","fa♯","sol","sol♯","la","la♯","ti"]),y=[262,294,327,348,392,436,490,523],m=["pitch","hertz"],e=["imgsrc: images/chime.svg","imgsrc: images/synth.svg"],i=[],p=!1,o=0;o<e.length;o++)t=_(e[o]),i.push(t);this._menuWheel=new wheelnav("wheelDivptm",null,200,200),this._exitWheel=new wheelnav("_exitWheel",this._menuWheel.raphael),wheelnav.cssMode=!0,this._menuWheel.keynavigateEnabled=!1,this._menuWheel.slicePathFunction=slicePath().DonutSlice,this._menuWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._menuWheel.colors=[platformColor.paletteColors.pitch[0],platformColor.paletteColors.pitch[1]],this._menuWheel.slicePathCustom.minRadiusPercent=.3,this._menuWheel.slicePathCustom.maxRadiusPercent=1,this._menuWheel.sliceSelectedPathCustom=this._menuWheel.slicePathCustom,this._menuWheel.sliceInitPathCustom=this._menuWheel.slicePathCustom,this._menuWheel.clickModeRotate=!1,this._menuWheel.animatetime=0,this._menuWheel.createWheel(i),this._menuWheel.navItems[0].setTooltip(_("pitch")),this._menuWheel.navItems[1].setTooltip(_("hertz")),this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.25,this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.clickModeRotate=!1,this._exitWheel.createWheel(["×"," "]);for(var b,v,l=docById("addnotes").getBoundingClientRect().x,n=docById("addnotes").getBoundingClientRect().y,a=(docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="300px",docById("wheelDivptm").style.width="300px",docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,l*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,n*this.activity.getStageScale()))+"px",this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",u._menuWheel.removeWheel(),u._exitWheel.removeWheel()},function(){if(!p){var t=m[u._menuWheel.selectedNavItemIndex],i=u.activity.blocks.blockList.length;if("pitch"===t){for(var e=0;e<d.length;e++){for(var o=void 0,l=u.layout.length-1;-1<l&&"hertz"===u.layout[l].noteName;)l--;if(o=u.layout[l]&&"hertz"!==u.layout[l].noteName?u.layout[l].noteName:null,d[e].includes(o)||o.includes(d[e]))break}for(;b=d[(e+1)%d.length],e=(e+1)%d.length,u.layout.some(function(t){return t.noteName===b}););for(var n=u.layout.length;0<n&&(v=u.layout[n-1].noteOctave,!(!isNaN(v)&&0<v&&v<9));n--);(e+1)%d.length==0&&(v+=1)}else{b="hertz";for(var a=!(v=392),s=0;s<y.length;s++){for(var a=!1,r=0;r<u.layout.length;r++)if("hertz"===u.layout[r].noteName&&u.layout[r].noteOctave===y[s]){a=!0;break}if(!a){v=y[s];break}}}switch(t){case"pitch":u.activity.blocks.loadNewBlocks([[0,["pitch",{}],0,0,[null,1,2,null]],[1,["solfege",{value:b}],0,0,[0]],[2,["number",{value:v}],0,0,[0]]]);break;case"hertz":u.activity.blocks.loadNewBlocks([[0,["hertz",{}],0,0,[null,1,null]],[1,["number",{value:v}],0,0,[0]]]);break;default:console.log("Nothing to do for "+t)}for(var c=-1,h=u.layout.length;0<h;h--)if(u.layout[h-1].blockNumber<k){c=u.layout[h-1].blockNumber;break}-1!==c?(p=!0,setTimeout(function(){u._addNotesBlockBetween(c,i),p=!1,u.layout.push({noteName:b,noteOctave:v,blockNumber:i,voice:u.layout[0].voice}),u._sortLayout(u.layout),u.displayLayout=u.layout.map(function(t){return SOLFEGENAMES.includes(t.noteName)?_objectSpread(_objectSpread({},t),{},{noteName:FIXEDSOLFEGE[t.noteName]}):t});var t=u.displayLayout.filter(function(t){return"hertz"===t.noteName}),e=u.displayLayout.filter(function(t){return"hertz"!==t.noteName}),e=(u.displayLayout=g(e),u.displayLayout=u.displayLayout.concat(t),u._createKeyboard(),u._createTable(),u.layout.length),t=u.layout[e-1];u.getElement[t.noteName.toString()+t.noteOctave.toString()]=t.objId,u.getElement[FIXEDSOLFEGE1[t.noteName.toString()]+""+t.noteOctave]=t.objId},500)):console.log("Could not find anywhere to insert new block.")}}),s=0;s<i.length;s++)this._menuWheel.navItems[s].navigateFunction=a},this._addNotesBlockBetween=function(t,e){var i=last(this.activity.blocks.blockList[t].connections);this.activity.blocks.blockList[t].connections[this.activity.blocks.blockList[t].connections.length-1]=e,null!==i&&(this.activity.blocks.blockList[i].connections[0]=e),this.activity.blocks.blockList[e].connections[0]=t,this.activity.blocks.blockList[e].connections[this.activity.blocks.blockList[e].connections.length-1]=i,this.activity.blocks.adjustDocks(this.blockNo,!0),this.activity.blocks.clampBlocksToCheck.push([this.blockNo,0]),this.activity.blocks.adjustExpandableClampBlock(),this.activity.refreshCanvas()},this._sortLayout=function(){var l=this,i=(this.layout.sort(function(t,e){var i,o;if("hertz"==t.noteName){if("hertz"!==e.noteName)return 1;i=t.noteOctave}else i=noteToFrequency(t.noteName+t.noteOctave,l.activity.turtles.ithTurtle(0).singer.keySignature);if("hertz"==e.noteName){if("hertz"!==t.noteName)return-1;o=e.noteOctave}else o=noteToFrequency(e.noteName+e.noteOctave,l.activity.turtles.ithTurtle(0).singer.keySignature);return i-o}),[]);this.remove=[],this.layout=this.layout.filter(function(t,e){return i.includes(t.noteName+t.noteOctave)?!(l.remove=[l.layout[e-1].blockNumber,l.layout[e].blockNumber]):(i.push(t.noteName+t.noteOctave),!0)}),this._notesPlayed.map(function(t){return t.objId===l.remove[1]&&(t.objId=l.remove[0]),t}),this.remove.length&&this._removePitchBlock(this.remove[1]),this.keyboardShown?this._createKeyboard():this._createTable()},this._removePitchBlock=function(t){var e=this.activity.blocks.blockList[t].connections[0],i=last(this.activity.blocks.blockList[t].connections);"musickeyboard"===this.activity.blocks.blockList[e].name?this.activity.blocks.blockList[e].connections[1]=i:this.activity.blocks.blockList[e].connections[this.activity.blocks.blockList[e].connections.length-1]=i,i&&(this.activity.blocks.blockList[i].connections[0]=e),this.activity.blocks.blockList[t].connections[this.activity.blocks.blockList[t].connections.length-1]=null,this.activity.blocks.sendStackToTrash(this.activity.blocks.blockList[t]),this.activity.blocks.adjustDocks(this.blockNo,!0),this.activity.blocks.clampBlocksToCheck.push([this.blockNo,0]),this.activity.refreshCanvas()},this._createColumnPieSubmenu=function(a,s){var r=this;if(a=parseInt(a),void 0!==this.activity.blocks.blockList[this.layout[this.layout.length-a-1].blockNumber]){docById("wheelDivptm").style.display="",docById("wheelDivptm").style.zIndex="300";for(var t=["𝄪","♯","♮","♭","𝄫"],c=["ti","la","sol","fa","mi","re","do"],h=[],e=0;e<c.length;e++)h.push(i18nSolfege(c[e]));"synthsblocks"===s&&(c=["261","294","327","348","392","436","490","523"]),this._pitchWheel=new wheelnav("wheelDivptm",null,600,600),this._exitWheel=new wheelnav("_exitWheel",this._pitchWheel.raphael),"pitchblocks"===s&&(this._accidentalsWheel=new wheelnav("_accidentalsWheel",this._pitchWheel.raphael),this._octavesWheel=new wheelnav("_octavesWheel",this._pitchWheel.raphael)),wheelnav.cssMode=!0,this._pitchWheel.keynavigateEnabled=!1,this._pitchWheel.slicePathFunction=slicePath().DonutSlice,this._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),"pitchblocks"===s?(this._pitchWheel.colors=platformColor.pitchWheelcolors,this._pitchWheel.slicePathCustom.minRadiusPercent=.2,this._pitchWheel.slicePathCustom.maxRadiusPercent=.5):"synthsblocks"===s&&(this._pitchWheel.titleRotateAngle=0,this._pitchWheel.colors=platformColor.blockLabelsWheelcolors,this._pitchWheel.slicePathCustom.minRadiusPercent=.6,this._pitchWheel.slicePathCustom.maxRadiusPercent=1,this._pitchWheel.titleRotateAngle=90,this._pitchWheel.clickModeRotate=!1),this._pitchWheel.sliceSelectedPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.sliceInitPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.animatetime=0,"synthsblocks"===s?this._pitchWheel.createWheel(c):this._pitchWheel.createWheel(h),this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.2,this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.clickModeRotate=!1,this._exitWheel.createWheel(["x"," "]);var i=["8","7","6","5","4","3","2","1",null,null,null,null,null,null];if("pitchblocks"===s){this._accidentalsWheel.colors=platformColor.accidentalsWheelcolors,this._accidentalsWheel.slicePathFunction=slicePath().DonutSlice,this._accidentalsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._accidentalsWheel.slicePathCustom.minRadiusPercent=.5,this._accidentalsWheel.slicePathCustom.maxRadiusPercent=.75,this._accidentalsWheel.sliceSelectedPathCustom=this._accidentalsWheel.slicePathCustom,this._accidentalsWheel.sliceInitPathCustom=this._accidentalsWheel.slicePathCustom;for(var o=[],l=0;l<t.length;l++)o.push(t[l]);for(var n=0;n<9;n++)o.push(null),this._accidentalsWheel.colors.push(platformColor.accidentalsWheelcolorspush);this._accidentalsWheel.animatetime=0,this._accidentalsWheel.createWheel(o),this._accidentalsWheel.setTooltips([_("double sharp"),_("sharp"),_("natural"),_("flat"),_("double flat")]),this._octavesWheel.colors=platformColor.octavesWheelcolors,this._octavesWheel.slicePathFunction=slicePath().DonutSlice,this._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._octavesWheel.slicePathCustom.minRadiusPercent=.75,this._octavesWheel.slicePathCustom.maxRadiusPercent=.95,this._octavesWheel.sliceSelectedPathCustom=this._octavesWheel.slicePathCustom,this._octavesWheel.sliceInitPathCustom=this._octavesWheel.slicePathCustom,this._octavesWheel.animatetime=0,this._octavesWheel.createWheel(i)}var u=docById("labelcol"+a).getBoundingClientRect().x,d=docById("labelcol"+a).getBoundingClientRect().y,y=(docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="300px",docById("wheelDivptm").style.width="300px",docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,u*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,d*this.activity.getStageScale()))+"px",a=this.layout.length-a-1,this.layout[a].blockNumber),m=this.activity.blocks.blockList[this.activity.blocks.blockList[y].connections[1]].value;if("pitchblocks"===s){for(var u=this.activity.blocks.blockList[this.activity.blocks.blockList[y].connections[2]].value,p=2,b=0;b<t.length;b++)if(m.includes(t[b])){p=b,m=m.substr(0,m.indexOf(t[b]));break}this._accidentalsWheel.navigateWheel(p),this._octavesWheel.navigateWheel(i.indexOf(u.toString())),this._pitchWheel.navigateWheel(c.indexOf(m))}this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",r._pitchWheel.removeWheel(),r._exitWheel.removeWheel(),"pitchblocks"===s&&(r._accidentalsWheel.removeWheel(),r._octavesWheel.removeWheel())};var v=function(){var e=r._pitchWheel.navItems[r._pitchWheel.selectedNavItemIndex].title,t=r.activity.blocks.blockList[y].connections[1],i=(r.activity.blocks.blockList[t].text.text=e,r.activity.blocks.blockList[t].value=parseInt(e),r.activity.blocks.blockList[t].container.children.length-1),i=(r.activity.blocks.blockList[t].container.setChildIndex(r.activity.blocks.blockList[t].text,i),r.activity.blocks.blockList[t].updateCache(),docById("labelcol"+(r.layout.length-a-1)));r.layout[a].noteOctave=parseInt(e),i.innerHTML=r.layout[a].noteName+r.layout[a].noteOctave.toString(),r._notesPlayed.map(function(t){return t.objId==this.layout[a].blockNumber&&(t.noteOctave=parseInt(e)),t})};if("synthsblocks"===s)for(var g=0;g<c.length;g++)this._pitchWheel.navItems[g].navigateFunction=v;var k=function(){var t,e=r._pitchWheel.navItems[r._pitchWheel.selectedNavItemIndex].title,i=("pitchblocks"===s?(o=h.indexOf(e),l=c[o],"♮"!==(i=r._accidentalsWheel.navItems[r._accidentalsWheel.selectedNavItemIndex].title)&&(e+=i)):(o=c.indexOf(e),l=e),r.activity.blocks.blockList[y].connections[1]),o=(r.activity.blocks.blockList[i].text.text=e,r.activity.blocks.blockList[i].value=l,r.activity.blocks.blockList[i].container.children.length-1),l=(r.activity.blocks.blockList[i].container.setChildIndex(r.activity.blocks.blockList[i].text,o),r.activity.blocks.blockList[i].updateCache(),"pitchblocks"===s&&(t=Number(r._octavesWheel.navItems[r._octavesWheel.selectedNavItemIndex].title),r.activity.blocks.blockList[i].blocks.setPitchOctave(r.activity.blocks.blockList[i].connections[0],t)),docById("labelcol"+(r.layout.length-a-1))),o=(r.layout[a].noteName=e,r.layout[a].noteOctave=t,l.innerHTML=r.layout[a].noteName+r.layout[a].noteOctave.toString(),e),n=o in FIXEDSOLFEGE1?FIXEDSOLFEGE1[o].replace(SHARP,"#").replace(FLAT,"b")+t:o.replace(SHARP,"#").replace(FLAT,"b")+t;r._notesPlayed.map(function(t){return t.objId==r.layout[a].blockNumber&&(t.noteOctave=n),t})},f=function(){var t=r._pitchWheel.navItems[r._pitchWheel.selectedNavItemIndex].title,t=h.indexOf(t),t=c[t],e=r._accidentalsWheel.navItems[r._accidentalsWheel.selectedNavItemIndex].title,e=("♮"!==e&&(t+=e),Number(r._octavesWheel.navItems[r._octavesWheel.selectedNavItemIndex].title)),t=getNote(t,e,0,r.activity.turtles.ithTurtle(0).singer.keySignature,!1,null,r.activity.logo.errorMsg,r.activity.logo.synth.inTemperament);r.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),Singer.setSynthVolume(r.activity.logo,0,DEFAULTVOICE,PREVIEWVOLUME),r.activity.logo.synth.trigger(0,[t[0]+t[1]],1/8,DEFAULTVOICE,null,null),k()};if("pitchblocks"===s){for(var I=0;I<c.length;I++)this._pitchWheel.navItems[I].navigateFunction=f;for(var W=0;W<t.length;W++)this._accidentalsWheel.navItems[W].navigateFunction=f;for(var w=0;w<8;w++)this._octavesWheel.navItems[w].navigateFunction=f}}},this._createKeyboard=function(){document.onkeydown=null;var t=this.keyboardDiv,t=(t.style.display="flex",t.style.visibility="visible",t.style.border="0px",t.style.width="100%",t.style.top="0px",t.style.overflow="auto",t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.innerHTML="",t.innerHTML=' <div id="keyboardHolder2"><table class="white"><tbody><tr id="myrow"></tr></tbody></table><table class="black"><tbody><tr id="myrow2"></tr></tbody></table></div>',docById("keyboardHolder2")),t=(t.style.bottom="10px",t.style.left="0px",t.style.height="145px",t.style.backgroundColor="white",document.getElementsByClassName("black")),t=(t[0].style.top="1px",t[0].style.borderSpacing="0px 0px 20px",t[0].style.borderCollapse="separate",document.getElementById("myrow"));if(t.innerHTML="",(t=document.getElementById("myrow2")).innerHTML="",0===this.noteNames.length){for(var e=0;e<PITCHES3.length;e++)this.noteNames.push(PITCHES3[e]),this.octaves.push(4),4===e&&(this.noteNames.push(null),this.octaves.push(4));this.noteNames.push(PITCHES3[0]),this.octaves.push(5)}this.idContainer=[];for(var i,o,l,n,a,s,r=0,c=0,h=0,u=0;u<this.displayLayout.length;u++)this.displayLayout[u].noteName>k?(o=document.getElementById("myrow2"),(a=document.createElement("td")).setAttribute("id","blackRow"+c.toString()),[2,6,9,13,16,20,23,27,30,34,37,41,44,48,51,55,58,62].includes(c)?(o.appendChild(a),(l=docById("blackRow"+c.toString())).style.background="transparent",l.style.border="none",l.style.zIndex="10",l.style.position="relative",u--,c++):(a.setAttribute("alt",this.displayLayout[u].noteName+"__"+this.displayLayout[u].noteOctave+"__"+this.displayLayout[u].blockNumber),this.idContainer.push(["blackRow"+c.toString(),this.displayLayout[u].blockNumber]),u<this.layout.length&&(this.displayLayout[u].objId="blackRow"+c.toString(),this.layout[u].objId="blackRow"+c.toString()),c++,a.innerHTML="",a.style.visibility="hidden",o.appendChild(a))):"drum"===this.displayLayout[u].noteName?(i=document.getElementById("myrow"),(n=document.createElement("td")).style.textAlign="center",n.setAttribute("id","whiteRow"+r.toString()),n.setAttribute("alt",this.displayLayout[u].noteName+"__"+this.displayLayout[u].voice+"__"+this.displayLayout[u].blockNumber),this.idContainer.push(["whiteRow"+r.toString(),this.displayLayout[u].blockNumber]),n.innerHTML="".concat(r<p.length?"<small>(".concat(String.fromCharCode(p[r]),")</small><br/>"):"").concat(this.displayLayout[u].voice),this.displayLayout[u].objId="whiteRow"+r.toString(),r++,n.style.position="relative",n.style.zIndex="100",i.appendChild(n)):"hertz"===this.displayLayout[u].noteName?(i=document.getElementById("myrow"),(n=document.createElement("td")).style.textAlign="center",n.setAttribute("id","hertzRow"+h.toString()),n.setAttribute("alt",this.displayLayout[u].noteName+"__"+this.displayLayout[u].noteOctave+"__"+this.displayLayout[u].blockNumber),this.idContainer.push(["hertzRow"+h.toString(),this.displayLayout[u].blockNumber]),n.innerHTML="".concat(h<m.length?"<small>(${String.fromCharCode(HERTZKEYS[myrow3Id])})</small><br/>":"").concat(this.displayLayout[u].noteOctave),this.displayLayout[u].objId="hertzRow"+h.toString(),h++,n.style.position="relative",n.style.zIndex="100",i.appendChild(n)):this.displayLayout[u].noteName.includes(SHARP)||this.displayLayout[u].noteName.includes("#")?(o=document.getElementById("myrow2"),(a=document.createElement("td")).setAttribute("id","blackRow"+c.toString()),a.style.textAlign="center",[2,6,9,13,16,20,23,27,30,34,37,41,44,48,51,55,58,62].includes(c)?(o.appendChild(a),(l=docById("blackRow"+c.toString())).style.background="transparent",l.style.border="none",l.style.zIndex="10",l.style.position="relative",u--,c++):(a.setAttribute("alt",this.displayLayout[u].noteName+"__"+this.displayLayout[u].noteOctave+"__"+this.displayLayout[u].blockNumber),this.idContainer.push(["blackRow"+c.toString(),this.displayLayout[u].blockNumber]),s=this.displayLayout[u].noteName.replace(SHARP,"").replace("#",""),this.displayLayout[u].blockNumber>=k&&(a.innerHTML=c<y.length?"<small>(".concat(String.fromCharCode(y[c]),")</small><br/>"):""),u<this.layout.length&&(this.displayLayout[u].objId="blackRow"+c.toString(),this.layout[u].objId="blackRow"+c.toString()),c++,a.style.position="relative",a.style.zIndex="200",o.appendChild(a))):this.displayLayout[u].noteName.includes(FLAT)||this.displayLayout[u].noteName.includes("b")?(o=document.getElementById("myrow2"),(a=document.createElement("td")).setAttribute("id","blackRow"+c.toString()),a.style.textAlign="center",[2,6,9,13,16,20,23,27,30,34,37,41,44,48,51,55,58,62].includes(c)?(o.appendChild(a),(l=docById("blackRow"+c.toString())).style.background="transparent",l.style.border="none",l.style.zIndex="10",l.style.position="relative",u--,c++):(a.setAttribute("alt",this.displayLayout[u].noteName+"__"+this.displayLayout[u].noteOctave+"__"+this.displayLayout[u].blockNumber),this.idContainer.push(["blackRow"+c.toString(),this.displayLayout[u].blockNumber]),s=this.displayLayout[u].noteName.replace(FLAT,"").replace("b",""),this.displayLayout[u].blockNumber<=k&&(SOLFEGENAMES.includes(s)?a.innerHTML="<small>(".concat(String.fromCharCode(y[c]),")</small><br/>").concat(i18nSolfege(s)).concat(FLAT).concat(this.displayLayout[u].noteOctave):a.innerHTML="<small>(".concat(String.fromCharCode(y[c]),")</small><br/>").concat(this.displayLayout[u].noteName).concat(this.displayLayout[u].noteOctave)),u<this.layout.length&&(this.displayLayout[u].objId="blackRow"+c.toString(),this.layout[u].objId="blackRow"+c.toString()),c++,a.style.position="relative",a.style.zIndex="200",o.appendChild(a))):(i=document.getElementById("myrow"),(n=document.createElement("td")).setAttribute("id","whiteRow"+r.toString()),n.style.textAlign="center",n.setAttribute("alt",this.displayLayout[u].noteName+"__"+this.displayLayout[u].noteOctave+"__"+this.displayLayout[u].blockNumber),this.idContainer.push(["whiteRow"+r.toString(),this.displayLayout[u].blockNumber]),this.displayLayout[u].blockNumber<=k&&(SOLFEGENAMES.includes(this.displayLayout[u].noteName)?n.innerHTML="".concat(r<p.length?"<small>(".concat(String.fromCharCode(p[r]),")</small><br/>"):"").concat(i18nSolfege(this.displayLayout[u].noteName)).concat(this.displayLayout[u].noteOctave):n.innerHTML="".concat(r<p.length?"<small>(".concat(String.fromCharCode(p[r]),")</small><br/>"):"").concat(this.displayLayout[u].noteName).concat(this.displayLayout[u].noteOctave)),u<this.layout.length&&(this.displayLayout[u].objId="whiteRow"+r.toString(),this.layout[u].objId="whiteRow"+r.toString()),r++,n.style.position="relative",n.style.zIndex="100",i.appendChild(n));i=document.getElementById("myrow"),n=document.createElement("td"),i.appendChild(n),n.style.textAlign="center",n.setAttribute("id","rest"),n.setAttribute("alt","R__"),n.innerHTML="<small>(".concat(_("rest"),")</small><br/>"),n.style.position="relative",n.style.zIndex="100";for(var d=0;d<this.idContainer.length;d++)null!==this.displayLayout[d].blockNumber&&this.loadHandler(document.getElementById(this.idContainer[d][0]),d,this.idContainer[d][1],this.displayLayout);this.addKeyboardShortcuts()},this._save=function(){this.processSelected(),this._clusterNotes=function(t){for(var e=0,i=[],o=DEFAULTVOICE;e<t.length;)0===e?(i.push([e]),"drumnull"!==t[e].noteOctave[0]&&(o=t[e].voice[0])):"drumnull"===t[e].noteOctave[0]||"R"===t[e].noteOctave[0]?i[i.length-1].push(e):o=(t[e].voice[0]!=o?i.push([e]):i[i.length-1].push(e),t[e].voice[0]),e++;return i},this.findLen=function(t,e){for(var i=0,o=0;o<t.length;o++){var l=e[t[o]];"R"===l.noteOctave[0]?i+=6:"drumnull"===l.noteOctave[0]?i+=7:i+=5+3*l.noteOctave.length}return i};for(var t=parseInt(I.length/50)+1,e=0;e<t;e++){for(var i=I.slice(50*e,50*(e+1)),o=this._clusterNotes(i),l=[[0,["action",{collapsed:!1}],100,100,[null,1,2,null]],[1,["text",{value:_("action")+""+e}],0,0,[0]],[2,"hidden",0,0,[0,0==I.length?null:3]]],n=(l.push([3,"setmasterbpm2",0,0,[2,4,5,8]],[4,["number",{value:this.bpm}],0,0,[3]],[5,"divide",0,0,[3,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:4}],0,0,[5]],[8,"vspace",0,0,[3,9]]),8),a=void 0,s=0;s<o.length;s++){var r=o[s],c=s==o.length-1,h=l.length,u=I[r[0]].voice[0]||DEFAULTVOICE,c=("drumnull"===I[r[0]].noteOctave[0]&&(u=DEFAULTVOICE),c?null:h+3+this.findLen(r,I));l.push([h,"settimbre",0,0,[n,h+1,h+3,h+2]],[h+1,["voicename",{value:u}],0,0,[h]],[h+2,"hidden",0,0,[h,c]]);for(var n=h+2,a=h,d=0;d<r.length;d++){var y=I[r[d]],m=l.length,p=(l.push([m,"newnote",0,0,[a,m+2,m+1,null]]),l[m][4].length),p=(0===d?l[a][4][p-2]=m:l[a][4][p-1]=m,l.push([(a=m)+1,"vspace",0,0,[m,m+5]]),l.push([m+2,"divide",0,0,[m,m+3,m+4]]),Math.max.apply(Math,y.duration)),p=toFraction(p),b=(l.push([m+3,["number",{value:p[0]}],0,0,[m+2]]),l.push([m+4,["number",{value:p[1]}],0,0,[m+2]]),m+5),v=m+1;if("R"===y.noteOctave[0])l.push([b+1,"rest2",0,0,[v,null]]);else if("drumnull"===y.noteOctave[0])l.push([b,"playdrum",0,0,[v,b+1,null]]),l.push([b+1,["drumname",{value:y.voice[0]}],0,0,[b]]);else for(var g,k=0;k<y.noteOctave.length;k++)0<k&&(b="string"==typeof y.noteOctave[k-1]?v+3:v+2,g=l[v][4].length,l[v][4][g-1]=b),"string"==typeof y.noteOctave[k]?(l.push([b,"pitch",0,0,[v,b+1,b+2,null]]),["#","b","♯","♭"].includes(y.noteOctave[k][1])?l.push([b+1,["solfege",{value:SOLFEGECONVERSIONTABLE[y.noteOctave[k][0]]+y.noteOctave[k][1]}],0,0,[b]]):l.push([b+1,["solfege",{value:SOLFEGECONVERSIONTABLE[y.noteOctave[k][0]]}],0,0,[b]]),l.push([b+2,["number",{value:y.noteOctave[k][y.noteOctave[k].length-1]}],0,0,[b]])):(l.push([b,"hertz",0,0,[v,b+1,null]]),l.push([b+1,["number",{value:y.noteOctave[k]}],0,0,[b]])),v=b}}this.activity.blocks.loadNewBlocks(l)}1<t?f.textMsg(_("New action blocks generated."),3e3):f.textMsg(_("New action block generated."),3e3)},this.clearBlocks=function(){this.noteNames=[],this.octaves=[]},this._addButton=function(t,e,i,o){t=t.insertCell(-1);return t.innerHTML='&nbsp;&nbsp;<img \n                src="header-icons/'.concat(e,'" \n                title="').concat(o,'" \n                alt="').concat(o,'" \n                height="').concat(i,'" \n                width="').concat(i,'" \n                vertical-align="middle" \n                align-content="center"\n            >&nbsp;&nbsp;'),t.style.width="53px",t.style.minWidth=t.style.width,t.style.maxWidth=t.style.width,t.style.height=t.style.width,t.style.minHeight=t.style.height,t.style.maxHeight=t.style.height,t.style.backgroundColor=platformColor.selectorBackground,t.onmouseover=function(){this.style.backgroundColor=platformColor.selectorBackgroundHOVER},t.onmouseout=function(){this.style.backgroundColor=platformColor.selectorBackground},t},this.doMIDI=function(){var i=0,o=0;r.getElement={};for(var t=0;t<r.layout.length;t++){var e=r.layout[t];r.getElement[e.noteName.toString()+e.noteOctave.toString()]=e.objId,r.getElement[FIXEDSOLFEGE1[e.noteName.toString()]+""+e.noteOctave]=e.objId}var l=function(t,e){e&&(o=t.timeStamp,e.style.backgroundColor=platformColor.orange,r.activity.logo.synth.trigger(0,r.noteMapper[e.id],1,r.instrumentMapper[e.id],null,null))},n=function(t,e){e&&(e.id.includes("blackRow")?e.style.backgroundColor="black":e.style.backgroundColor="white",t=t.timeStamp,i=t-o,i/=1e3,r.activity.logo.synth.stopSound(0,r.instrumentMapper[e.id],r.noteMapper[e.id]),0===(i="true"===c?parseFloat((Math.round(8*i)/8).toFixed(3)):parseFloat((Math.round(16*i)/16).toFixed(4)))?i=.125:i<0&&(i=-i),r._notesPlayed.push({startTime:o,noteOctave:r.noteMapper[e.id],objId:e.id,duration:i,voice:r.instrumentMapper[e.id],blockNumber:r.blockNumberMapper[e.id]}),r._createTable())},a=function(t){var e=4+Math.floor((t-60)/12);return[NOTESSHARP[t%12],NOTESFLAT[t%12],e]},s=function(t){var e=a(t.data[1]),i=e[0],o=e[2],i=r.getElement[i+""+o]||r.getElement[e[1]+""+o];(144==t.data[0]&&0!=t.data[2]?l:n)(t,docById(i))};navigator.requestMIDIAccess({sysex:!0}).then(function(t){r.midiON?(r.midiButton.style.background="#00FF00",f.textMsg(_("MIDI device present."),3e3)):(t.inputs.forEach(function(t){t.onmidimessage=s}),t.inputs.size?(r.midiButton.style.background="#00FF00",f.textMsg(_("MIDI device present."),3e3),r.midiON=!0):f.textMsg(_("No MIDI device found."),3e3))},function(){f.errorMsg(_("Failed to get MIDI access in browser."),3e3),r.midiON=!1})}}
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var n,i,r,o,a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(a)return r=!(i=!0),{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){r=!0,n=t},f:function(){try{i||null==a.return||a.return()}finally{if(r)throw n}}};if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return a&&(t=a),o=0,{s:e=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var n;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var Oscilloscope=(()=>_createClass(function n(t){var e,s=this,t=(_classCallCheck(this,n),_defineProperty(this,"reconnectSynthsToAnalyser",function(t){for(var e in s.pitchAnalysers[t]||(s.pitchAnalysers[t]=new Tone.Analyser({type:"waveform",size:n.analyserSize})),instruments[t])instruments[t][e].connect(s.pitchAnalysers[t])}),_defineProperty(this,"makeCanvas",function(t,e,n,i,r){var o=document.createElement("canvas"),a=(o.width=t,o.height=e,o.className="oscilloscopeCanvas",s.widgetWindow.getWidgetBody().appendChild(o),o.getContext("2d"));a.clearRect(0,0,t,e),s._canvasState[i]={canvas:o,canvasCtx:a,width:t,height:e,turtle:n,turtleIdx:i,resizedOnce:r},s.drawVisualIDs[i]=null}),this.activity=t,this._running=!1,this._rafId=null,this.draw=this.draw.bind(this),this.pitchAnalysers={},this._canvasState={},this.drawVisualIDs={},window.widgetWindows.windowFor(this,"oscilloscope")),i=((this.widgetWindow=t).clear(),t.show(),t.onclose=function(){s.close()},t.onmaximize=this._scale.bind(this),this.zoomFactor=40,this.verticalOffset=0,t.addButton("",n.ICONSIZE,_("Zoom In"))),i=(i.onclick=function(){s.zoomFactor*=1.333},i.children[0].src="data:image/svg+xml;base64,".concat(window.btoa(base64Encode(BIGGERBUTTON))),t.addButton("",n.ICONSIZE,_("Zoom Out"))),r=(i.onclick=function(){s.zoomFactor/=1.333,s.zoomFactor<1&&(s.zoomFactor=1)},i.children[0].src="data:image/svg+xml;base64,".concat(window.btoa(base64Encode(SMALLERBUTTON))),t.sendToCenter(),this.divisions=[],_createForOfIteratorHelper(this.activity.logo.oscilloscopeTurtles));try{for(r.s();!(e=r.n()).done;){var o=e.value;o&&!o.inTrash&&this.divisions.push(o)}}catch(t){r.e(t)}finally{r.f()}this._scale()},[{key:"_stopAnimation",value:function(){this._running=!1,null!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null);for(var t=0,e=Object.values(this.drawVisualIDs||{});t<e.length;t++){var n=e[t];null!=n&&cancelAnimationFrame(n)}}},{key:"_startAnimation",value:function(){this._running||(this._running=!0,this.draw())}},{key:"close",value:function(){this._stopAnimation(),this.drawVisualIDs={},this._canvasState={},this.pitchAnalysers={},this.widgetWindow&&(this.widgetWindow.destroy(),this.widgetWindow=null)}},{key:"_renderFrame",value:function(){for(var t=0,e=Object.keys(this._canvasState);t<e.length;t++){var n=e[t],i=this._canvasState[n];if(i){n=this.pitchAnalysers[i.turtleIdx];if(n&&(i.turtle.running||i.resizedOnce)){for(var r=i.canvasCtx,o=n.getValue(),a=o.length,s=(r.fillStyle="#FFFFFF",r.fillRect(0,0,i.width,i.height),r.lineWidth=2,r.strokeStyle=i.turtle.painter._canvasColor,r.beginPath(),i.width*this.zoomFactor/a),l=0,c=0;c<a;c++){var u=i.height/2*(1-o[c])+this.verticalOffset;0===c?r.moveTo(l,u):r.lineTo(l,u),l+=s}r.stroke(),i.resizedOnce=!1}}}}},{key:"draw",value:function(){this._running&&(this._renderFrame(),this._rafId=requestAnimationFrame(this.draw))}},{key:"_scale",value:function(){var t,e,n,i=this,r=document.getElementsByClassName("oscilloscopeCanvas"),o=(Array.prototype.forEach.call(r,function(t){i.widgetWindow.getWidgetBody().removeChild(t)}),this._canvasState={},e=this.widgetWindow.isMaximized()?(t=this.widgetWindow.getWidgetBody().getBoundingClientRect().width,this.widgetWindow.getWidgetFrame().getBoundingClientRect().height-70):(t=700,400),_createForOfIteratorHelper(this.divisions));try{for(o.s();!(n=o.n()).done;){var a=n.value,s=this.activity.turtles.getIndexOfTurtle(a);this.reconnectSynthsToAnalyser(s),this.makeCanvas(t,e/this.divisions.length,a,s,!0)}}catch(t){o.e(t)}finally{o.f()}0<this.divisions.length?this._running?this._renderFrame():this._startAnimation():this._stopAnimation()}}]))();_defineProperty(Oscilloscope,"ICONSIZE",40),_defineProperty(Oscilloscope,"analyserSize",8192);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regenerator(){var b,t="function"==typeof Symbol?Symbol:{},e=t.iterator||"@@iterator",l=t.toStringTag||"@@toStringTag";function i(t,e,l,i){var s,o,a,n,c,h,r,u,p,e=e&&e.prototype instanceof m?e:m,e=Object.create(e.prototype);return _regeneratorDefine2(e,"_invoke",(s=t,o=l,r=i||[],u=!1,p={p:h=0,n:0,v:b,a:d,f:d.bind(b,4),d:function(t,e){return a=t,n=0,c=b,p.n=e,y}},function(t,e,l){if(1<h)throw TypeError("Generator is already running");for(u&&1===e&&d(e,l),n=e,c=l;(v=n<2?b:c)||!u;){a||(n?n<3?(1<n&&(p.n=-1),d(n,c)):p.n=c:p.v=c);try{if(h=2,a){if(v=a[t=n?t:"next"]){if(!(v=v.call(a,c)))throw TypeError("iterator result is not an object");if(!v.done)return v;c=v.value,n<2&&(n=0)}else 1===n&&(v=a.return)&&v.call(a),n<2&&(c=TypeError("The iterator does not provide a '"+t+"' method"),n=1);a=b}else if((v=(u=p.n<0)?c:s.call(o,p))!==y)break}catch(t){a=b,n=1,c=t}finally{h=1}}return{value:v,done:u}}),!0),e;function d(t,e){for(n=t,c=e,v=0;!u&&h&&!l&&v<r.length;v++){var l,i=r[v],s=p.p,o=i[2];3<t?(l=o===e)&&(c=i[(n=i[4])?5:n=3],i[4]=i[5]=b):i[0]<=s&&((l=t<2&&s<i[1])?(n=0,p.v=e,p.n=i[1]):s<o&&(l=t<3||i[0]>e||o<e)&&(i[4]=t,i[5]=e,p.n=o,n=0))}if(l||1<t)return y;throw u=!0,e}}var y={};function m(){}function s(){}function o(){}var v=Object.getPrototypeOf,t=[][e]?v(v([][e]())):(_regeneratorDefine2(v={},e,function(){return this}),v),a=o.prototype=m.prototype=Object.create(t);function n(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,o):(t.__proto__=o,_regeneratorDefine2(t,l,"GeneratorFunction")),t.prototype=Object.create(a),t}return _regeneratorDefine2(a,"constructor",s.prototype=o),_regeneratorDefine2(o,"constructor",s),_regeneratorDefine2(o,l,s.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,l,"Generator"),_regeneratorDefine2(a,e,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:i,m:n}})()}function _regeneratorDefine2(t,e,l,i){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}(_regeneratorDefine2=function(t,e,l,i){function s(e,l){_regeneratorDefine2(t,e,function(t){return this._invoke(e,l,t)})}e?o?o(t,e,{value:l,enumerable:!i,configurable:!i,writable:!i}):t[e]=l:(s("next",0),s("throw",1),s("return",2))})(t,e,l,i)}function asyncGeneratorStep(t,e,l,i,s,o,a){try{var n=t[o](a),c=n.value}catch(t){return void l(t)}n.done?e(c):Promise.resolve(c).then(i,s)}function _asyncToGenerator(n){return function(){var t=this,a=arguments;return new Promise(function(e,l){var i=n.apply(t,a);function s(t){asyncGeneratorStep(i,e,l,s,o,"next",t)}function o(t){asyncGeneratorStep(i,e,l,s,o,"throw",t)}s(void 0)})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var l=0;l<e.length;l++){var i=e[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,l){return e&&_defineProperties(t.prototype,e),l&&_defineProperties(t,l),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,l){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:l,enumerable:!0,configurable:!0,writable:!0}):t[e]=l,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var l=t[Symbol.toPrimitive];if(void 0===l)return("string"===e?String:Number)(t);l=l.call(t,e||"default");if("object"!=_typeof(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}var lastIndex=5,MATRIXGRAPHICS=["forward","back","right","left","setheading","setcolor","setshade","sethue","setgrey","settranslucency","setpensize"],MATRIXGRAPHICS2=["arc","setxy"],MATRIXSYNTHS=["sine","triangle","sawtooth","square","hertz"],PhraseMaker=(()=>{function R(){_classCallCheck(this,R),this._stopOrCloseClicked=!1,this._instrumentName=DEFAULTVOICE,this.isInitial=!0,this.paramsEffects={doVibrato:!1,doDistortion:!1,doTremolo:!1,doPhaser:!1,doChorus:!1,vibratoIntensity:0,vibratoFrequency:0,distortionAmount:0,tremoloFrequency:0,tremoloDepth:0,rate:0,octaves:0,baseFrequency:0,chorusRate:0,delayTime:0,chorusDepth:0},this.rowLabels=[],this.rowArgs=[],this._noteBlocks=!1,this.sorted=!1,this._notesToPlay=[],this._outputAsTuplet=[],this._matrixHasTuplets=!1,this._notesCounter=0,this._noteStored=[],this._rowBlocks=[],this._colBlocks=[],this._rowMap=[],this._rowOffset=[],this._rows=[],this._headcols=[],this._labelcols=[],this._tupletNoteLabel=null,this._tupletValueLabel=null,this._tupletNoteValueLabel=null,this._tupletNoteValueRow=null,this._tupletValueRow=null,this._noteValueRow=null,this._blockMap={},this.blockNo=null,this.notesBlockMap=[],this._blockMapHelper=[],this.columnBlocksMap=[],this._lyrics=[],this.lyricsON=!1}return _createClass(R,[{key:"stylePhraseMaker",value:function(){for(var t=window.innerWidth,e=window.innerHeight,l=document.getElementById("floatingWindows").querySelectorAll(".windowFrame"),i=0;i<l.length;i++){var s=l[i],o=s.querySelector(".wfWinBody"),a=s.querySelector(".wfbWidget"),n=parseFloat(window.getComputedStyle(s).width),c=parseFloat(window.getComputedStyle(s).height),h=.8*t,r=.8*e;(t<n||e<c)&&(s.style.height=Math.min(c,r)+"px",s.style.width=Math.min(n,h)+"px",a.style.overflowY=r<c?"auto":"hidden",a.style.overflowX=h<n?"auto":"hidden",a.style.width="-webkit-fill-available",a.style.height="-webkit-fill-available",a.style.position="absolute",a.style.left="55px",o.style.position="absolute",o.style.overflowY=r<c?"auto":"hidden",o.style.overflowX=h<n?"auto":"hidden",o.style.width="-webkit-fill-available",o.style.height="-webkit-fill-available",o.style.background="#cccccc")}}},{key:"clearBlocks",value:function(){this._rowBlocks=[],this._colBlocks=[],this._rowMap=[],this._rowOffset=[]}},{key:"addRowBlock",value:function(t){for(this._rowMap.push(this._rowBlocks.length),this._rowOffset.push(0);this._rowBlocks.includes(t);)t+=1e6;this._rowBlocks.push(t)}},{key:"addColBlock",value:function(t,e){for(var l=0,i=0;i<this._colBlocks.length;i++)this._colBlocks[i][0]===t&&(l+=1);for(var s=l;s<e+l;s++)this._colBlocks.push([t,s])}},{key:"addNode",value:function(t,e,l,i){void 0===this._blockMap[i]&&(this._blockMap[i]=[]);for(var s,o=0,a=0;a<this._blockMap[i].length;a++)(s=this._blockMap[i][a])[0]===t&&s[1][0]===e&&s[1][1]===l&&(o+=1);this._blockMap[i].push([t,[e,l],o])}},{key:"removeNode",value:function(t,e,l){for(var i,s=this.blockNo,o=0;o<this._blockMap[s].length;o++)(i=this._blockMap[s][o])[0]===t&&i[1][0]===e&&i[1][1]===l&&this._blockMap[s].splice(o,1)}},{key:"_get_save_lock",value:function(){return this._save_lock}},{key:"init",value:function(t){var e,l,i,s,o,a,n=this,c=(this.activity=t,this._currentMusicalTime=0,t.turtles.ithTurtle(0)),h=c.singer.beatsPerMeasure||4,c=c.singer.noteValuePerBeat||4,h=(this._measureLimit=h/c,this._noteStored=[],this._noteBlocks=!1,this._rests=0,this.playingNow=!1,window.innerWidth),r=(this._cellScale=Math.max(1,h/1200),R.ICONSIZE*this._cellScale),u=window.widgetWindows.windowFor(this,"phrase maker"),p=((this.widgetWindow=u).clear(),u.show(),console.debug("notes "+this.rowLabels+" octave "+this.rowArgs),this._notesToPlay=[],this._matrixHasTuplets=!1,u.onclose=function(){n._rowOffset=[];for(var t=0;t<n._rowMap.length;t++)n._rowMap[t]=t;n.activity.logo.synth.stopSound(0,n._instrumentName),n.activity.logo.synth.stop(),n._stopOrCloseClicked=!0,n.activity.hideMsgs(),docById("wheelDivptm").style.display="none",u.destroy()},this._playButton=u.addButton("play-button.svg",R.ICONSIZE,_("Play")),this._playButton.onclick=function(){n.activity.logo.turtleDelay=0,n.activity.logo.resetSynth(0),n.playingNow?n._playButton.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(R.ICONSIZE,'" \n                        width="').concat(R.ICONSIZE,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;'):n._playButton.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/stop-button.svg" \n                        title="'.concat(_("Stop"),'" \n                        alt="').concat(_("Stop"),'" \n                        height="').concat(R.ICONSIZE,'" \n                        width="').concat(R.ICONSIZE,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;'),n.playAll()},this._save_lock=!1,u.addButton("export-chunk.svg",R.ICONSIZE,_("Save")).onclick=_asyncToGenerator(_regenerator().m(function t(){return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(n._get_save_lock()){t.n=2;break}return n._save_lock=!0,n._save(),t.n=1,delayExecution(1e3);case 1:n._save_lock=!1,window.innerWidth<=600&&n.widgetWindow.close();case 2:return t.a(2)}},t)})),u.addButton("erase-button.svg",R.ICONSIZE,_("Clear")).onclick=this._clear.bind(this),localStorage.beginnerMode||(u.addButton("export-button.svg",R.ICONSIZE,_("Export")).onclick=this._export.bind(this)),u.addButton("sort.svg",R.ICONSIZE,_("Sort")).onclick=this._sort.bind(this),u.addButton("add2.svg",R.ICONSIZE,_("Add note"))),d=(p.setAttribute("id","addnotes"),p.onclick=this._createAddRowPieSubmenu.bind(this),document.createElement("table"));if(d.setAttribute("cellpadding","0px"),u.getWidgetBody().append(d),!this.sorted){this.columnBlocksMap=this._mapNotesBlocks("all",!0);for(var b=0;b<this.columnBlocksMap.length;b++)MATRIXGRAPHICS.includes(this.columnBlocksMap[b][1])||MATRIXGRAPHICS2.includes(this.columnBlocksMap[b][1])||MATRIXSYNTHS.includes(this.columnBlocksMap[b][1])||["playdrum","pitch"].includes(this.columnBlocksMap[b][1])||(this.columnBlocksMap=this.columnBlocksMap.slice(0,b).concat(this.columnBlocksMap.slice(b+1)),b--)}for(var y,m,v=0,g=0;g<this.rowLabels.length;g++)if("rest"===this.rowLabels[g].toLowerCase())this._rests+=1;else{if(l=d.insertRow(),i=getDrumName(this.rowLabels[g]),"print"===this.rowLabels[g])break;if(s=-1!=MATRIXGRAPHICS.indexOf(this.rowLabels[g])||-1!=MATRIXGRAPHICS2.indexOf(this.rowLabels[g])?platformColor.graphicsLabelBackground:null===i?platformColor.pitchLabelBackground:platformColor.drumLabelBackground,(p=l.insertCell()).style.backgroundColor=s,p.style.fontSize=100*this._cellScale+"%",p.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+1+"px",p.style.width=Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",p.style.minWidth=Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",p.style.maxWidth=p.style.minWidth,p.className="headcol",p.style.position="sticky",p.style.left="1.2px",p.innerHTML="",this._headcols[g]=p,"print"===this.rowLabels[g])break;if(null!=i?p.innerHTML='&nbsp;&nbsp;<img \n                        src="'.concat(getDrumIcon(i),'" \n                        title="').concat(_(i),'" \n                        alt="').concat(_(i),'" \n                        height="').concat(r,'" \n                        width="').concat(r,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;'):"http"===this.rowLabels[g].slice(0,4)?p.innerHTML='&nbsp;&nbsp;<img \n                        src="'.concat(getDrumIcon(this.rowLabels[g]),'" \n                        title="').concat(this.rowLabels[g],'" \n                        alt="').concat(this.rowLabels[g],'" \n                        height="').concat(r/2,'" \n                        width="').concat(r/2,'" \n                        vertical-align="middle"\n                    />&nbsp;&nbsp;'):MATRIXSYNTHS.includes(this.rowLabels[g])?p.innerHTML='&nbsp;&nbsp;<img \n                        src="images/synth2.svg" \n                        height="'.concat(r,'" \n                        width="').concat(r,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;'):MATRIXGRAPHICS.includes(this.rowLabels[g])||MATRIXGRAPHICS2.includes(this.rowLabels[g])?p.innerHTML='&nbsp;&nbsp;<img \n                        src="images/mouse.svg" \n                        height="'.concat(r,'" \n                        width="').concat(r,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;'):(m=this.rowLabels[g])in(y={C:1,D:2,E:3,F:4,G:5,A:6,B:7,do:1,re:2,mi:3,fa:4,sol:5,la:6,ti:7})&&4===this.rowArgs[g]?p.innerHTML='<img \n                            src="images/8_bellset_key_'.concat(y[m],'.svg" \n                            width="').concat(p.style.width,'" \n                            vertical-align="middle"\n                        >'):["C","do"].includes(m)&&5===this.rowArgs[g]&&(p.innerHTML='<img \n                            src="images/8_bellset_key_8.svg" \n                            width="'.concat(p.style.width,'" \n                            vertical-align="middle"\n                        >')),(p=l.insertCell()).style.backgroundColor=s,p.style.fontSize=100*this._cellScale+"%",p.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+1+"px",p.style.width=Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",p.style.minWidth=Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",p.style.maxWidth=p.style.minWidth,p.className="labelcol",p.style.position="sticky",p.style.left=R.BUTTONSIZE*this._cellScale+"px",p.setAttribute("alt",g),this._labelcols[g]=p,"print"===this.rowLabels[g])break;if(null!=i)p.innerHTML=_(i),p.style.fontSize=Math.floor(14*this._cellScale)+"px",p.setAttribute("alt",g+"__drumblocks"),p.onclick=function(t){var t=t.target,e=(t=null===t.getAttribute("alt")?t.parentNode:t).getAttribute("alt").split("__")[0],t=t.getAttribute("alt").split("__")[1];n._createColumnPieSubmenu(e,t)},this._noteStored.push(i);else if("http"===this.rowLabels[g].slice(0,4))p.innerHTML=this.rowLabels[g],p.style.fontSize=Math.floor(14*this._cellScale)+"px",this._noteStored.push(this.rowLabels[g].replace(/ /g,": "));else if(MATRIXSYNTHS.includes(this.rowLabels[g]))p.innerHTML=this.rowArgs[g],p.style.fontSize=Math.floor(14*this._cellScale)+"px",p.setAttribute("alt",g+"__synthsblocks"),p.onclick=function(t){var t=t.target,e=(t=null===t.getAttribute("alt")?t.parentNode:t).getAttribute("alt").split("__")[0],t=t.getAttribute("alt").split("__")[1];n._createMatrixGraphicsPieSubmenu(e,t,null)},this._noteStored.push(this.rowArgs[g]);else if(MATRIXGRAPHICS.includes(this.rowLabels[g]))o=this.activity.blocks.protoBlockDict[this.rowLabels[g]].staticLabels[0],p.innerHTML="".concat(o,"<br>").concat(this.rowArgs[g]),p.style.fontSize=Math.floor(12*this._cellScale)+"px",p.setAttribute("alt",g+"__graphicsblocks"),p.onclick=function(t){var t=t.target,e=(t=null===t.getAttribute("alt")?t.parentNode:t).getAttribute("alt").split("__")[0],t=t.getAttribute("alt").split("__")[1];n._createMatrixGraphicsPieSubmenu(e,t,null)},this._noteStored.push(this.rowLabels[g]+": "+this.rowArgs[g]);else if(MATRIXGRAPHICS2.includes(this.rowLabels[g]))o=this.activity.blocks.protoBlockDict[this.rowLabels[g]].staticLabels[0],p.innerHTML="".concat(o,"<br>").concat(this.rowArgs[g][0]," ").concat(this.rowArgs[g][1]),p.style.fontSize=Math.floor(12*this._cellScale)+"px",p.setAttribute("alt",g+"__graphicsblocks2"),p.onclick=function(t){t=t.target,t=(t=null===t.getAttribute("alt")?t.parentNode:t).getAttribute("alt").split("__")[0];n._createMatrixGraphics2PieSubmenu(t,null)},this._noteStored.push(this.rowLabels[g]+": "+this.rowArgs[g][0]+": "+this.rowArgs[g][1]);else{if(noteIsSolfege(this.rowLabels[g])&&!isCustomTemperament(this.activity.logo.synth.inTemperament))p.innerHTML="".concat(i18nSolfege(this.rowLabels[g])).concat(this.rowArgs[g].toString().sub()),f=getNote(this.rowLabels[g],this.rowArgs[g],0,this.activity.turtles.ithTurtle(0).singer.keySignature,!1,null,this.activity.errorMsg,this.activity.logo.synth.inTemperament);else if(isCustomTemperament(this.activity.logo.synth.inTemperament)){var k,f=getNote(this.rowLabels[g],this.rowArgs[g],0,this.activity.turtles.ithTurtle(0).singer.keySignature,!1,null,this.activity.errorMsg,this.activity.logo.synth.inTemperament),w=this.rowLabels[g],C=getTemperament(this.activity.logo.synth.inTemperament),W=[];for(k in C)if(C[k][1]===w){W=C[k];break}(W=0<W.length?W[0]:W)[3]&&W[3]!==W[1]?p.innerHTML=W[1]:p.innerHTML=w+this.rowArgs[g].toString().sub()}else p.innerHTML=this.rowLabels[g]+this.rowArgs[g].toString().sub(),f=[this.rowLabels[g],this.rowArgs[g]];p.setAttribute("alt",g+"__pitchblocks"),p.onclick=function(t){var t=t.target,e=(t=null===t.getAttribute("alt")?t.parentNode:t).getAttribute("alt").split("__")[0],t=t.getAttribute("alt").split("__")[1];n._createColumnPieSubmenu(e,t)},this._noteStored.push(f[0]+f[1])}a=l.insertCell(),(y=document.createElement("table")).setAttribute("cellpadding","0px"),a.append(y),m=y.insertRow(),this._rows[v]=m,v+=1}if(this.lyricsON){for(var c=d.insertRow(),L=(c.setAttribute("id","lyricRow"),c.style.position="sticky",(p=c.insertCell()).setAttribute("colspan","1"),p.className="headcol",p.style.position="sticky",p.style.left="1.2px",p.style.zIndex="1",p.style.backgroundColor=platformColor.lyricsLabelBackground,p.style.textAlign="center",p.innerHTML='<img src="images/pen.svg" height="'.concat(r,'" width="').concat(r,'" vertical-align="middle">'),(p=c.insertCell()).setAttribute("colspan","1"),p.className="headcol",p.style.position="sticky",p.style.left="1.2px",p.style.zIndex="1",p.style.backgroundColor=platformColor.lyricsLabelBackground,p.style.textAlign="center",p.innerHTML="Lyrics",(e=document.createElement("table")).setAttribute("cellpadding","0px"),e.insertRow()),I=(this._lyrics&&0!==this._lyrics.length?this.activity.logo.tupletRhythms.length>this._lyrics.length&&(h=this.activity.logo.tupletRhythms.length-this._lyrics.length,this._lyrics=this._lyrics.concat(Array(h).fill(""))):this._lyrics=Array(this.activity.logo.tupletRhythms.length).fill(""),0);I<this.activity.logo.tupletRhythms.length;I++)(e=>{var t=n.activity.logo.tupletRhythms[e][2],l=L.insertCell();l.style.height=Math.floor(MATRIXSOLFEHEIGHT*n._cellScale)+1+"px",l.style.width=n._noteWidth(t)+"px",l.style.minWidth=l.style.width,l.style.maxWidth=l.style.width,l.style.backgroundColor=platformColor.lyricsInputBackground,l.style.fontFamily="sans-serif",l.style.cursor="default",l.style.borderSpacing="1px 1px",l.style.borderCollapse="collapse",l.style.boxSizing="border-box",l.style.padding="0",l.style.borderRadius="6px",l.style.border="none",l.setAttribute("alt",e+"__graphicsblocks2"),(t=document.createElement("input")).type="text",t.value=n._lyrics[e],t.style.height=l.style.height,t.style.width="100%",t.style.minWidth=l.style.minWidth,t.style.maxWidth=l.style.maxWidth,t.style.fontSize="inherit",t.style.fontFamily="sans-serif",t.style.cursor="default",t.style.boxSizing="border-box",t.style.padding="0",t.style.border="none",t.style.borderRadius="6px",t.style.backgroundColor=platformColor.lyricsInputBackground,l.appendChild(t),l.addEventListener("mouseover",function(t){t.target.style.backgroundColor=platformColor.selectorSelected}),l.addEventListener("mouseout",function(t){t.target.style.backgroundColor=platformColor.lyricsInputBackground}),t.addEventListener("focus",function(){return n.activity.isInputON=!0}),t.addEventListener("blur",function(){return n.activity.isInputON=!1}),t.addEventListener("input",function(t){n._lyrics[e]=t.target.value})})(I);c.insertCell().appendChild(e)}a=(l=d.insertRow()).insertCell(),l.setAttribute("id","bottomRow"),l.style.position="sticky",l.style.bottom="0px",l.style.zIndex="1",a.setAttribute("colspan","2"),a.style.position="sticky",a.style.left="1.2px",a.style.zIndex="1",a.className="headcol",(e=document.createElement("table")).setAttribute("cellpadding","0px"),a.append(e),this._tupletNoteLabel=null,this._tupletValueLabel=null,this._tupletNoteValueLabel=null,this._tupletNoteLabel=e.insertRow().insertCell(),this._tupletValueLabel=e.insertRow().insertCell(),this._noteValueLabel=e.insertRow().insertCell(),this._noteValueLabel.innerHTML=_("note value"),this._noteValueLabel.style.fontSize=75*this._cellScale+"%",this._noteValueLabel.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",this._noteValueLabel.style.width=Math.floor(2*MATRIXSOLFEWIDTH*this._cellScale)+"px",this._noteValueLabel.style.minWidth=this._noteValueLabel.style.width,this._noteValueLabel.style.maxWidth=this._noteValueLabel.style.width,this._noteValueLabel.style.backgroundColor=platformColor.labelColor,(e=document.createElement("table")).setAttribute("cellpadding","0px"),this._tupletNoteValueRow=e.insertRow(),this._tupletValueRow=e.insertRow(),this._noteValueRow=e.insertRow(),l.insertCell().append(e),void 0===this._blockMap[this.blockNo]&&(this._blockMap[this.blockNo]=[]),this._lookForNoteBlocksOrRepeat(),this.sorted?this.sorted=!1:setTimeout(function(){n._sort()},1e3),this.isInitial&&(t.textMsg(_("Click on the table to add notes."),3e3),this.widgetWindow.sendToCenter(),this.inInitial=!1)}},{key:"_createAddRowPieSubmenu",value:function(){for(var r,u=this,p=(docById("wheelDivptm").style.display="",["pitch","hertz","drum","graphics","pen"]),t=["imgsrc: images/chime.svg","imgsrc: images/synth.svg","imgsrc: images/TamTamMini.svg","imgsrc: images/mouse.svg","imgsrc: images/pen.svg"],e=[],l=0;l<t.length;l++)r=_(t[l]),e.push(r);for(var d=[],i=0;i<MATRIXGRAPHICS.length;i++)d.push(MATRIXGRAPHICS[i]);for(var s=0;s<MATRIXGRAPHICS2.length;s++)d.push(MATRIXGRAPHICS2[s]);this._menuWheel=new wheelnav("wheelDivptm",null,200,200),this._exitWheel=new wheelnav("_exitWheel",this._menuWheel.raphael),wheelnav.cssMode=!0,this._menuWheel.keynavigateEnabled=!1,this._menuWheel.slicePathFunction=slicePath().DonutSlice,this._menuWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._menuWheel.colors=[platformColor.paletteColors.pitch[0],platformColor.paletteColors.pitch[1],platformColor.paletteColors.drum[0],platformColor.paletteColors.turtle[0],platformColor.paletteColors.turtle[1]],this._menuWheel.slicePathCustom.minRadiusPercent=.3,this._menuWheel.slicePathCustom.maxRadiusPercent=1,this._menuWheel.sliceSelectedPathCustom=this._menuWheel.slicePathCustom,this._menuWheel.sliceInitPathCustom=this._menuWheel.slicePathCustom,this._menuWheel.clickModeRotate=!1,this._menuWheel.animatetime=0,this._menuWheel.createWheel(e),this._menuWheel.navItems[0].setTooltip(_("pitch")),this._menuWheel.navItems[1].setTooltip(_("hertz")),this._menuWheel.navItems[2].setTooltip(_("drum")),this._menuWheel.navItems[3].setTooltip(_("graphics")),this._menuWheel.navItems[4].setTooltip(_("pen")),this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.25,this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.clickModeRotate=!1,this._exitWheel.createWheel(["×"," "]);for(var o=docById("addnotes").getBoundingClientRect().x,a=docById("addnotes").getBoundingClientRect().y,n=(docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="300px",docById("wheelDivptm").style.width="300px",docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,o*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,a*this.activity.getStageScale()))+"px",this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",u._menuWheel.removeWheel(),u._exitWheel.removeWheel()},function(){r=p[u._menuWheel.selectedNavItemIndex];var t=null,e=null,l=u.activity.blocks.blockList.length;switch(r){case"pitch":u.activity.blocks.loadNewBlocks([[0,["pitch",{}],0,0,[null,1,2,null]],[1,["solfege",{value:"sol"}],0,0,[0]],[2,["number",{value:4}],0,0,[0]]]),t="sol",e=4;break;case"hertz":u.activity.blocks.loadNewBlocks([[0,["hertz",{}],0,0,[null,1,null]],[1,["number",{value:392}],0,0,[0]]]),t="hertz",e=392;break;case"drum":u.activity.blocks.loadNewBlocks([[0,["playdrum",{}],0,0,[null,1,null]],[1,["drumname",{value:DEFAULTDRUM}],0,0,[0]]]),t="",e=-1;break;case"graphics":u.activity.blocks.loadNewBlocks([[0,["forward",{}],0,0,[null,1,null]],[1,["number",{value:100}],0,0,[0]]]),t="forward",e=100;break;case"pen":u.activity.blocks.loadNewBlocks([[0,["setcolor",{}],0,0,[null,1,null]],[1,["number",{value:0}],0,0,[0]]]),t="setcolor",e=0;break;default:console.debug(r+" not found")}var i,s,o=null,a=null;switch(r){case"graphics":case"pen":for(var n=d.length-1;0<=n;n--)if(1<=(o=u._mapNotesBlocks(d[n])).length){a=last(o);break}break;case"drum":1<=(o=u._mapNotesBlocks("playdrum")).length&&(a=last(o));break;case"hertz":1<=(o=u._mapNotesBlocks("hertz")).length&&(a=last(o));break;case"pitch":1<=(o=u._mapNotesBlocks("pitch")).length&&(a=last(o))}if((a=null===a&&null===(a=1<=(o=u._mapNotesBlocks("pitch")).length?last(o):a)?u.blockNo:a)===u.blockNo)setTimeout(u._addNotesBlockBetween(a,l,!0),500),u.rowLabels.splice(0,0,t),u.rowArgs.splice(0,0,e),u._rowBlocks.splice(0,0,l);else{for(setTimeout(u._addNotesBlockBetween(a,l,!1),500),i=0;i<u.columnBlocksMap.length&&u.columnBlocksMap[i][0]!==a;i++);u.rowLabels.splice(i+1,0,t),u.rowArgs.splice(i+1,0,e),u._rowBlocks.splice(i+1,0,l)}u.sorted=!1,u.init(u.activity);for(var c=0;c<u.activity.logo.tupletRhythms.length;c++)switch(u.activity.logo.tupletRhythms[c][0]){case"simple":case"notes":(s=[u.activity.logo.tupletParams[u.activity.logo.tupletRhythms[c][1]]]).push([]);for(var h=2;h<u.activity.logo.tupletRhythms[c].length;h++)s[1].push(u.activity.logo.tupletRhythms[c][h]);u.addTuplet(s);break;default:u.addNotes(u.activity.logo.tupletRhythms[c][1],u.activity.logo.tupletRhythms[c][2])}u.makeClickable(),"pitch"===r&&setTimeout(function(){u.pitchBlockAdded(l)},200)}),c=function(){n()},h=0;h<e.length;h++)this._menuWheel.navItems[h].navigateFunction=c}},{key:"pitchBlockAdded",value:function(t){for(var e=0;e<this.columnBlocksMap.length&&this.columnBlocksMap[e][0]!==t;e++);setTimeout(this._createColumnPieSubmenu(e,"pitchblocks",!0),500)}},{key:"_createMatrixGraphics2PieSubmenu",value:function(n,t){for(var c=this,e=(docById("wheelDivptm").style.display="",["10","20","30","40","50","60","70","80","90","100"]),l=["0","30","45","60","90","180"],i=["-200","-100","0","100","200"],h=(this._pitchWheel=new wheelnav("wheelDivptm",null,600,600),this._exitWheel=new wheelnav("_exitWheel",this._pitchWheel.raphael),this._blockLabelsWheel=new wheelnav("_blockLabelsWheel",this._pitchWheel.raphael),this._blockLabelsWheel2=new wheelnav("_blockLabelsWheel2",this._pitchWheel.raphael),MATRIXGRAPHICS2.slice()),s=[],o=0;o<h.length;o++)s.push(this.activity.blocks.protoBlockDict[h[o]].staticLabels[0]);wheelnav.cssMode=!0,this._pitchWheel.keynavigateEnabled=!1,this._pitchWheel.slicePathFunction=slicePath().DonutSlice,this._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._pitchWheel.colors=platformColor.blockLabelsWheelcolors,this._pitchWheel.slicePathCustom.minRadiusPercent=.2,this._pitchWheel.slicePathCustom.maxRadiusPercent=.475,this._pitchWheel.sliceSelectedPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.sliceInitPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.clickModeRotate=!1,this._pitchWheel.animatetime=0,this._blockLabelsWheel2.colors=platformColor.blockLabelsWheelcolors,this._blockLabelsWheel2.slicePathFunction=slicePath().DonutSlice,this._blockLabelsWheel2.slicePathCustom=slicePath().DonutSliceCustomization(),this._blockLabelsWheel2.slicePathCustom.minRadiusPercent=.525,this._blockLabelsWheel2.slicePathCustom.maxRadiusPercent=.8,this._blockLabelsWheel2.sliceSelectedPathCustom=this._blockLabelsWheel2.slicePathCustom,this._blockLabelsWheel2.sliceInitPathCustom=this._blockLabelsWheel2.slicePathCustom,this._blockLabelsWheel2.clickModeRotate=!1,this._blockLabelsWheel2.animatetime=0,this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.2,this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.clickModeRotate=!1,this._blockLabelsWheel.colors=platformColor.graphicWheelcolors,this._blockLabelsWheel.slicePathFunction=slicePath().DonutSlice,this._blockLabelsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._blockLabelsWheel.slicePathCustom.minRadiusPercent=.8,this._blockLabelsWheel.slicePathCustom.maxRadiusPercent=1,this._blockLabelsWheel.sliceSelectedPathCustom=this._blockLabelsWheel.slicePathCustom,this._blockLabelsWheel.sliceInitPathCustom=this._blockLabelsWheel.slicePathCustom,this._blockLabelsWheel.clickModeRotate=!1,this._blockLabelsWheel.titleRotateAngle=90,this._blockLabelsWheel.animatetime=0,this._blockLabelsWheel.createWheel(s);function a(){c.xblockValue[0]=c._blockLabelsWheel2.navItems[c._blockLabelsWheel2.selectedNavItemIndex].title,v(!0)}function r(){c.yblockValue[0]=c._pitchWheel.navItems[c._pitchWheel.selectedNavItemIndex].title,v(!0)}var u=this._labelcols[n].getBoundingClientRect().x,p=this._labelcols[n].getBoundingClientRect().y,d=(docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="300px",docById("wheelDivptm").style.width="300px",docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,u*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,p*this.activity.getStageScale()))+"px",this.columnBlocksMap[n][0]),u=(null!==t&&(d=t),this.activity.blocks.blockList[d].name),p=this.activity.blocks.blockList[this.activity.blocks.blockList[d].connections[1]].value,t=this.activity.blocks.blockList[this.activity.blocks.blockList[d].connections[2]].value;"arc"===u?(this._blockLabelsWheel2.createWheel(l),this._pitchWheel.createWheel(e)):"setxy"===u&&(this._blockLabelsWheel2.createWheel(i),this._pitchWheel.createWheel(i)),this._blockLabelsWheel.navigateWheel(h.indexOf(u)),this.xblockValue=[p.toString(),"x"],this.yblockValue=[t.toString(),"y"],this._exitWheel.createWheel(["×",""]),this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",c._pitchWheel.removeWheel(),c._exitWheel.removeWheel(),c._blockLabelsWheel.removeWheel(),c._blockLabelsWheel2.removeWheel()};if("arc"===u){for(var b=0;b<l.length;b++)this._blockLabelsWheel2.navItems[b].navigateFunction=a;for(var y=0;y<e.length;y++)this._pitchWheel.navItems[y].navigateFunction=r}else if("setxy"===u)for(var m=0;m<i.length;m++)this._blockLabelsWheel2.navItems[m].navigateFunction=a,this._pitchWheel.navItems[m].navigateFunction=r;for(var v=(()=>{var e=_asyncToGenerator(_regenerator().m(function t(e){var l,i,s,o,a;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(l=h[c._blockLabelsWheel.selectedNavItemIndex],void 0===e)return i=c.activity.blocks.blockList.length,c.activity.blocks.loadNewBlocks([[0,l,0,0,[null,1,2,null]],[1,["number",{value:parseInt(c.xblockValue[0])}],0,0,[0]],[2,["number",{value:parseInt(c.yblockValue[0])}],0,0,[0]]]),t.n=1,delayExecution(500);t.n=2;break;case 1:c._blockReplace(d,i),c.columnBlocksMap[n][0]=i,d=i,c._createMatrixGraphics2PieSubmenu(n,i),t.n=3;break;case 2:o=c.activity.blocks.blockList[d].connections[1],c.activity.blocks.blockList[o].text.text=c.xblockValue[0],c.activity.blocks.blockList[o].value=parseInt(c.xblockValue[0]),s=c.activity.blocks.blockList[o].container.children.length-1,c.activity.blocks.blockList[o].container.setChildIndex(c.activity.blocks.blockList[o].text,s),c.activity.blocks.blockList[o].updateCache(),o=c.activity.blocks.blockList[d].connections[2],c.activity.blocks.blockList[o].text.text=c.yblockValue[0],c.activity.blocks.blockList[o].value=parseInt(c.yblockValue[0]),s=c.activity.blocks.blockList[o].container.children.length-1,c.activity.blocks.blockList[o].container.setChildIndex(c.activity.blocks.blockList[o].text,s),c.activity.blocks.blockList[o].updateCache();case 3:c.rowLabels[n]=l,c.rowArgs[n][0]=parseInt(c.xblockValue),c.rowArgs[n][1]=parseInt(c.yblockValue),s=c._headcols[n],o=R.ICONSIZE*(window.innerWidth/1200),MATRIXGRAPHICS2.includes(c.rowLabels[n])&&(s.innerHTML='&nbsp;&nbsp;<img \n                        src="images/mouse.svg" \n                        height="'.concat(o,'" \n                        width="').concat(o,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;')),s=c._labelcols[n],MATRIXGRAPHICS2.includes(c.rowLabels[n])&&(a=c.activity.blocks.protoBlockDict[c.rowLabels[n]].staticLabels[0],s.innerHTML="".concat(a,"<br>").concat(c.rowArgs[n][0]," ").concat(c.rowArgs[n][1]),s.style.fontSize=Math.floor(12*c._cellScale)+"px"),a=c.rowLabels[n]+": "+c.rowArgs[n][0]+": "+c.rowArgs[n][1],c._noteStored[n]=a;case 4:return t.a(2)}},t)}));return function(t){return e.apply(this,arguments)}})(),_=0;_<s.length;_++)this._blockLabelsWheel.navItems[_].navigateFunction=v}},{key:"_createMatrixGraphicsPieSubmenu",value:function(c,h,t){var e,l,i,s,o,a,n,r=this;if(docById("wheelDivptm").style.display="","synthsblocks"===h?e=["261","294","327","348","392","436","490","523"]:(e=["50","90","100","150","180","200","250","270","300","350","360"],l=["1","5","10","25","50","100","200"],i=["15","30","45","60","90","180"],s=["0","45","90","135","180","225","270","315"],o=["1","5","10","25","50"],a=["0","10","20","30","40","5n0","60","70","80","90","100"]),this._pitchWheel=new wheelnav("wheelDivptm",null,800,800),this._exitWheel=new wheelnav("_exitWheel",this._pitchWheel.raphael),"graphicsblocks"===h){this._blockLabelsWheel=new wheelnav("_blockLabelsWheel",this._pitchWheel.raphael);for(var u=[],p=[],d=[],b=[],y=0;y<5;y++)n=MATRIXGRAPHICS[y],u.push(n),p.push(this.activity.blocks.protoBlockDict[n].staticLabels[0]);for(var m=5;m<MATRIXGRAPHICS.length;m++)n=MATRIXGRAPHICS[m],d.push(n),b.push(this.activity.blocks.protoBlockDict[n].staticLabels[0])}wheelnav.cssMode=!0,this._pitchWheel.keynavigateEnabled=!1,this._pitchWheel.slicePathFunction=slicePath().DonutSlice,this._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._pitchWheel.colors=platformColor.blockLabelsWheelcolors,this._pitchWheel.slicePathCustom.minRadiusPercent=.525,this._pitchWheel.slicePathCustom.maxRadiusPercent=.8,this._pitchWheel.sliceSelectedPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.sliceInitPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.clickModeRotate=!1,this._pitchWheel.animatetime=0,this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.2,this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.clickModeRotate=!1,"graphicsblocks"===h&&(this._blockLabelsWheel.colors=platformColor.graphicWheelcolors,this._blockLabelsWheel.slicePathFunction=slicePath().DonutSlice,this._blockLabelsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._blockLabelsWheel.slicePathCustom.minRadiusPercent=.8,this._blockLabelsWheel.slicePathCustom.maxRadiusPercent=1,this._blockLabelsWheel.sliceSelectedPathCustom=this._blockLabelsWheel.slicePathCustom,this._blockLabelsWheel.sliceInitPathCustom=this._blockLabelsWheel.slicePathCustom,this._blockLabelsWheel.clickModeRotate=!1,this._blockLabelsWheel.titleRotateAngle=90,this._blockLabelsWheel.animatetime=0);function v(){r.blockValue=r._pitchWheel.navItems[r._pitchWheel.selectedNavItemIndex].title,docById("wheelnav-_exitWheel-title-1").children[0].textContent=r.blockValue,lastIndex=r._pitchWheel.selectedNavItemIndex,W(!0)}var _,g=this._labelcols[c].getBoundingClientRect().x,k=this._labelcols[c].getBoundingClientRect().y,f=(docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="300px",docById("wheelDivptm").style.width="300px",docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,g*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,k*this.activity.getStageScale()))+"px",this.columnBlocksMap[c][0]),w=(null!==t&&(f=t),this.activity.blocks.blockList[f].name),g=this.activity.blocks.blockList[this.activity.blocks.blockList[f].connections[1]].value;"graphicsblocks"===h?"forward"===w||"back"===w?(this._pitchWheel.createWheel(l),this._blockLabelsWheel.createWheel(p)):"right"===w||"left"===w?(this._pitchWheel.createWheel(i),this._blockLabelsWheel.createWheel(p)):"setheading"===w?(this._pitchWheel.createWheel(s),this._blockLabelsWheel.createWheel(p)):("setpensize"===w?this._pitchWheel.createWheel(o):this._pitchWheel.createWheel(a),this._blockLabelsWheel.createWheel(b)):"synthsblocks"===h&&this._pitchWheel.createWheel(e),this.blockValue=g.toString(),this._exitWheel.createWheel(["×",""]),this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",r._pitchWheel.removeWheel(),r._exitWheel.removeWheel(),"graphicsblocks"===h&&r._blockLabelsWheel.removeWheel()};"graphicsblocks"===h?_=("forward"===w||"back"===w?l:"right"===w||"left"===w?i:"setheading"===w?s:"setpensize"===w?o:a).length:"synthsblocks"===h&&(_=e.length);for(var C=0;C<_;C++)this._pitchWheel.navItems[C].navigateFunction=v;var W=(()=>{var e=_asyncToGenerator(_regenerator().m(function t(e){var l,i,s,o,a,n;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(l="hertz","graphicsblocks"===h&&(s=r._blockLabelsWheel.navItems[r._blockLabelsWheel.selectedNavItemIndex].title,-1===(o=p.indexOf(s))?-1!==(o=b.indexOf(s))&&(l=d[o]):l=u[o]),void 0===e)return i=r.activity.blocks.blockList.length,r.activity.blocks.loadNewBlocks([[0,l,0,0,[null,1,null]],[1,["number",{value:parseInt(r.blockValue)}],0,0,[0]]]),t.n=1,delayExecution(500);t.n=2;break;case 1:r._blockReplace(f,i),r.columnBlocksMap[c][0]=i,f=i,r._createMatrixGraphicsPieSubmenu(c,h,i),t.n=3;break;case 2:s=r.activity.blocks.blockList[f].connections[1],r.activity.blocks.blockList[s].text.text=r.blockValue,r.activity.blocks.blockList[s].value=parseInt(r.blockValue),o=r.activity.blocks.blockList[s].container.children.length-1,r.activity.blocks.blockList[s].container.setChildIndex(r.activity.blocks.blockList[s].text,o),r.activity.blocks.blockList[s].updateCache();case 3:r.rowLabels[c]=l,r.rowArgs[c]=parseInt(r.blockValue),a=r._headcols[c],n=R.ICONSIZE*(window.innerWidth/1200),MATRIXSYNTHS.includes(r.rowLabels[c])?a.innerHTML='&nbsp;&nbsp;<img \n                        src="images/synth2.svg" \n                        height="'.concat(n,'" \n                        width="').concat(n,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;'):MATRIXGRAPHICS.includes(r.rowLabels[c])&&(a.innerHTML='&nbsp;&nbsp;<img \n                        src="images/mouse.svg" \n                        height="'.concat(n,'" \n                        width="').concat(n,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;')),a=r._labelcols[c],MATRIXSYNTHS.includes(r.rowLabels[c])?(a.innerHTML=r.rowArgs[c],a.style.fontSize=Math.floor(14*r._cellScale)+"px"):MATRIXGRAPHICS.includes(r.rowLabels[c])&&(w=r.activity.blocks.protoBlockDict[r.rowLabels[c]].staticLabels[0],a.innerHTML="".concat(w,"<br>").concat(r.rowArgs[c]),a.style.fontSize=Math.floor(12*r._cellScale)+"px"),r._noteStored[c]=r.rowLabels[c]+": "+r.rowArgs[c];case 4:return t.a(2)}},t)}));return function(t){return e.apply(this,arguments)}})();if("graphicsblocks"===h)if("forward"===w||"back"===w)for(var L=0;L<p.length;L++)this._blockLabelsWheel.navItems[L].navigateFunction=W;else if("right"===w||"left"===w)for(var I=0;I<p.length;I++)this._blockLabelsWheel.navItems[I].navigateFunction=W;else if("setheading"===w)for(var S=0;S<p.length;S++)this._blockLabelsWheel.navItems[S].navigateFunction=W;else if("setpensize"===w)for(var x=0;x<b.length;x++)this._blockLabelsWheel.navItems[x].navigateFunction=W;else for(var M=0;M<b.length;M++)this._blockLabelsWheel.navItems[M].navigateFunction=W;null!==lastIndex&&this._pitchWheel.navItems[lastIndex]&&this._pitchWheel.navigateWheel(lastIndex)}},{key:"_createColumnPieSubmenu",value:function(n,c,t){for(var e,h=this,l=(n=parseInt(n),docById("wheelDivptm").style.display="",["𝄪","♯","♮","♭","𝄫"]),r=["ti","la","sol","fa","mi","re","do"],i=[],s=0;s<DRUMS.length;s++)e=_(DRUMS[s]),i.push(e);var o=[];if("drumblocks"===c)for(var r=i,a=[0,0,0,0,0,0,0,1,1,1,1,1,1,1,2,2,2,2],u=platformColor.piemenuVoicesColors,p=0;p<i.length;p++)o.push(u[a[p]%u.length]);this._pitchWheel="drumblocks"===c?new wheelnav("wheelDivptm",null,1200,1200):new wheelnav("wheelDivptm",null,600,600),this._exitWheel=new wheelnav("_exitWheel",this._pitchWheel.raphael),"pitchblocks"===c&&(this._accidentalsWheel=new wheelnav("_accidentalsWheel",this._pitchWheel.raphael),this._octavesWheel=new wheelnav("_octavesWheel",this._pitchWheel.raphael)),wheelnav.cssMode=!0,this._pitchWheel.keynavigateEnabled=!1,this._pitchWheel.slicePathFunction=slicePath().DonutSlice,this._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),"pitchblocks"===c?(this._pitchWheel.colors=platformColor.pitchWheelcolors,this._pitchWheel.slicePathCustom.minRadiusPercent=.2,this._pitchWheel.slicePathCustom.maxRadiusPercent=.5):"drumblocks"===c&&(this._pitchWheel.titleRotateAngle=0,this._pitchWheel.colors=o,this._pitchWheel.slicePathCustom.minRadiusPercent=.2,this._pitchWheel.slicePathCustom.maxRadiusPercent=1),this._pitchWheel.sliceSelectedPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.sliceInitPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.animatetime=0,this._pitchWheel.createWheel(r),this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.2,this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.clickModeRotate=!1,this._exitWheel.createWheel(["×"," "]);var d,b,y=[],m=[];if("pitchblocks"===c){this._accidentalsWheel.colors=platformColor.accidentalsWheelcolors,this._accidentalsWheel.slicePathFunction=slicePath().DonutSlice,this._accidentalsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._accidentalsWheel.slicePathCustom.minRadiusPercent=.5,this._accidentalsWheel.slicePathCustom.maxRadiusPercent=.75,this._accidentalsWheel.sliceSelectedPathCustom=this._accidentalsWheel.slicePathCustom,this._accidentalsWheel.sliceInitPathCustom=this._accidentalsWheel.slicePathCustom;for(var v=0;v<l.length;v++)y.push(l[v]);for(var g=0;g<9;g++)y.push(null),this._accidentalsWheel.colors.push(platformColor.accidentalsWheelcolorspush);this._accidentalsWheel.animatetime=0,this._accidentalsWheel.createWheel(y),this._accidentalsWheel.setTooltips([_("double sharp"),_("sharp"),_("natural"),_("flat"),_("double flat")]),this._octavesWheel.colors=platformColor.octavesWheelcolors,this._octavesWheel.slicePathFunction=slicePath().DonutSlice,this._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._octavesWheel.slicePathCustom.minRadiusPercent=.75,this._octavesWheel.slicePathCustom.maxRadiusPercent=.95,this._octavesWheel.sliceSelectedPathCustom=this._octavesWheel.slicePathCustom,this._octavesWheel.sliceInitPathCustom=this._octavesWheel.slicePathCustom,m=["8","7","6","5","4","3","2","1",null,null,null,null,null,null],this._octavesWheel.animatetime=0,this._octavesWheel.createWheel(m)}var k=this._labelcols[n].getBoundingClientRect().x,f=this._labelcols[n].getBoundingClientRect().y;if(docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="300px",docById("wheelDivptm").style.width="300px",docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,k*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,f*this.activity.getStageScale()))+"px",!this._noteBlocks){if(d=this.columnBlocksMap[n][0],b=this.activity.blocks.blockList[this.activity.blocks.blockList[d].connections[1]].value,"pitchblocks"===c){for(var k=this.activity.blocks.blockList[this.activity.blocks.blockList[d].connections[2]].value,w=2,C=0;C<l.length;C++)if(b.includes(l[C])){w=C,b=b.substr(0,b.indexOf(l[C]));break}this._accidentalsWheel.navigateWheel(w),this._octavesWheel.navigateWheel(m.indexOf(k.toString()))}"drumblocks"===c?this._pitchWheel.navigateWheel(r.indexOf(docBySelector('.labelcol[alt="'+n+'__drumblocks"]').innerText)):this._pitchWheel.navigateWheel(r.indexOf(b))}this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",h._pitchWheel.removeWheel(),h._exitWheel.removeWheel(),"pitchblocks"===c&&(h._accidentalsWheel.removeWheel(),h._octavesWheel.removeWheel()),!(h.sorted=!1)===t&&h._sort()};for(var W=function(){var t,e=h._pitchWheel.navItems[h._pitchWheel.selectedNavItemIndex].title,l=r.indexOf(e),i=("pitchblocks"===c&&(s=!1,"♮"!==(o=h._accidentalsWheel.navItems[h._accidentalsWheel.selectedNavItemIndex].title)&&(e+=o,s=!0),h.sorted=!1),h._noteBlocks||(i=h.activity.blocks.blockList[d].connections[1],h.activity.blocks.blockList[i].text.text=e,h.activity.blocks.blockList[i].value=e,o=h.activity.blocks.blockList[i].container.children.length-1,h.activity.blocks.blockList[i].container.setChildIndex(h.activity.blocks.blockList[i].text,o),h.activity.blocks.blockList[i].updateCache()),"pitchblocks"===c?(o=Number(h._octavesWheel.navItems[h._octavesWheel.selectedNavItemIndex].title),h._noteBlocks||h.activity.blocks.blockList[i].blocks.setPitchOctave(h.activity.blocks.blockList[i].connections[0],o),t=[e,o],s&&(t=getNote(e,o,0,h.activity.turtles.ithTurtle(0).singer.keySignature,!1,null,h.activity.errorMsg,h.activity.logo.synth.inTemperament)),h.rowLabels[n]=t[0],h.rowArgs[n]=t[1]):"drumblocks"===c&&(h.rowLabels[n]=e),h._headcols[n]),s=getDrumName(h.rowLabels[n]),o={C:1,D:2,E:3,F:4,G:5,A:6,B:7,do:1,re:2,mi:3,fa:4,sol:5,la:6,ti:7},e=h.rowLabels[n],a=window.innerWidth,a=R.ICONSIZE*(a/1200),a=(null!=s?i.innerHTML='&nbsp;&nbsp;<img \n                        src="'.concat(getDrumIcon(s),'" \n                        title="').concat(_(s),'" \n                        alt="').concat(_(s),'" \n                        height="').concat(a,'" \n                        width="').concat(a,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;'):e in o&&4===h.rowArgs[n]?i.innerHTML='<img \n                        src="images/8_bellset_key_'.concat(o[e],'.svg" \n                        width="').concat(i.style.width,'" \n                        vertical-align="middle"\n                    >'):"C"===e&&5===h.rowArgs[n]&&(i.innerHTML='<img \n                        src="images/8_bellset_key_8.svg" \n                        width="'.concat(i.style.width,'" \n                        vertical-align="middle"\n                    >')),i=h._labelcols[n],null!=s?(i.innerHTML=_(s),i.style.fontSize=Math.floor(14*h._cellScale)+"px"):noteIsSolfege(h.rowLabels[l])&&!isCustomTemperament(h.activity.logo.synth.inTemperament)?(i.innerHTML="".concat(i18nSolfege(h.rowLabels[n])).concat(h.rowArgs[n].toString().sub()),t=getNote(h.rowLabels[n],h.rowArgs[n],0,h.activity.turtles.ithTurtle(0).singer.keySignature,!1,null,h.activity.errorMsg,h.activity.logo.synth.inTemperament)):isCustomTemperament(h.activity.logo.synth.inTemperament)?(t=getNote(h.rowLabels[l],h.rowArgs[l],0,h.activity.turtles.ithTurtle(0).singer.keySignature,!1,null,h.activity.errorMsg,h.activity.logo.synth.inTemperament),i.innerHTML="".concat(h.rowLabels[l]).concat(h.rowArgs[l].toString().sub())):(i.innerHTML="".concat(h.rowLabels[l]).concat(h.rowArgs[l].toString().sub()),t=[h.rowLabels[l],h.rowArgs[l]]),null);"pitchblocks"===c?a=t[0]+t[1]:"drumblocks"===c&&(a=s),h._noteStored[n]=a},L=function(){var t,e=h._pitchWheel.navItems[h._pitchWheel.selectedNavItemIndex].title,l=0;"pitchblocks"===c?("♮"!==(t=h._accidentalsWheel.navItems[h._accidentalsWheel.selectedNavItemIndex].title)&&(e+=t),t=Number(h._octavesWheel.navItems[h._octavesWheel.selectedNavItemIndex].title),(t=getNote(e,t,0,h.activity.turtles.ithTurtle(0).singer.keySignature,!1,null,h.activity.errorMsg,h.activity.logo.synth.inTemperament))[0]=t[0].replace(SHARP,"#").replace(FLAT,"b"),h.activity.logo.synth.setMasterVolume(PREVIEWVOLUME),Singer.setSynthVolume(h.activity.logo,0,DEFAULTVOICE,PREVIEWVOLUME),h.activity.logo.synth.trigger(0,[t[0]+t[1]],1/8,DEFAULTVOICE,null,null)):"drumblocks"===c&&(l=0!==(t=h.activity.turtles.ithTurtle(0)).singer.instrumentNames.length&&t.singer.instrumentNames.includes(e)?0:(t.singer.instrumentNames.push(e),e===DEFAULTVOICE&&h.activity.logo.synth.createDefaultSynth(0),h.activity.logo.synth.loadSynth(0,e),500),setTimeout(function(){h.activity.logo.synth.setMasterVolume(DEFAULTVOLUME),Singer.setSynthVolume(h.activity.logo,0,e,DEFAULTVOLUME),h.activity.logo.synth.trigger(0,"G4",.25,e,null,null,!1),h.activity.logo.synth.start()},l)),W()},I=0;I<r.length;I++)this._pitchWheel.navItems[I].navigateFunction=L;if("pitchblocks"===c){for(var S=0;S<l.length;S++)this._accidentalsWheel.navItems[S].navigateFunction=L;for(var x=0;x<8;x++)this._octavesWheel.navItems[x].navigateFunction=L}}},{key:"_blockReplace",value:function(t,e){var l=this.activity.blocks.blockList[t].connections[0],i=last(this.activity.blocks.blockList[t].connections);if(this.activity.blocks.blockList[e].connections[0]=l,this.activity.blocks.blockList[e].connections[this.activity.blocks.blockList[e].connections.length-1]=i,null!=l){for(var s=0;s<this.activity.blocks.blockList[l].connections.length;s++)if(this.activity.blocks.blockList[l].connections[s]===t){this.activity.blocks.blockList[l].connections[s]=e;break}for(var o=l;o!==this.blockNo;)this.activity.blocks.blockList[o].isClampBlock()&&this.activity.blocks.clampBlocksToCheck.push([o,0]),o=this.activity.blocks.blockList[o].connections[0];this.activity.blocks.clampBlocksToCheck.push([this.blockNo,0])}if(null!=i)for(var a=0;a<this.activity.blocks.blockList[i].connections.length;a++)if(this.activity.blocks.blockList[i].connections[a]===t){this.activity.blocks.blockList[i].connections[a]=e;break}this.activity.blocks.adjustDocks(l,!0),this.activity.blocks.blockList[t].connections[0]=null,this.activity.blocks.blockList[t].connections[this.activity.blocks.blockList[t].connections.length-1]=null,this.activity.blocks.sendStackToTrash(this.activity.blocks.blockList[t]),this.activity.refreshCanvas()}},{key:"_addNotesBlockBetween",value:function(t,e,l){var i;l?(i=this.activity.blocks.blockList[t].connections[1],this.activity.blocks.blockList[t].connections[1]=e):(i=last(this.activity.blocks.blockList[t].connections),this.activity.blocks.blockList[t].connections[this.activity.blocks.blockList[t].connections.length-1]=e),this.activity.blocks.blockList[i].connections[0]=e,this.activity.blocks.blockList[e].connections[0]=t,this.activity.blocks.blockList[e].connections[this.activity.blocks.blockList[e].connections.length-1]=i,this.activity.blocks.adjustDocks(this.blockNo,!0),this.activity.blocks.clampBlocksToCheck.push([this.blockNo,0]),this.activity.refreshCanvas()}},{key:"_removePitchBlock",value:function(t){var e=this.activity.blocks.blockList[t].connections[0],l=last(this.activity.blocks.blockList[t].connections);this.activity.blocks.blockList[e].connections[this.activity.blocks.blockList[e].connections.length-1]=l,this.activity.blocks.blockList[l].connections[0]=e,this.activity.blocks.blockList[t].connections[this.activity.blocks.blockList[t].connections.length-1]=null,this.activity.blocks.sendStackToTrash(this.activity.blocks.blockList[t]),this.activity.blocks.adjustDocks(this.blockNo,!0),this.activity.blocks.clampBlocksToCheck.push([this.blockNo,0]),this.activity.refreshCanvas()}},{key:"_generateDataURI",value:function(t){return"data: text/html;charset=utf-8, "+encodeURIComponent(t)}},{key:"_sort",value:function(){if(!this.sorted){this._markedColsInRow=[];for(var t=0;t<this.rowLabels.length;t++){for(var e,l=[],i=(e=this._rows[t]).cells.length,s=0;s<i;s++)"black"===e.cells[s].style.backgroundColor&&l.push(s);this._markedColsInRow.push(l)}for(var o,a=new Set,n=[],c=0;c<this.rowLabels.length;c++)"rest"===this.rowLabels[c].toLowerCase()||null!=getDrumName(this.rowLabels[c])||MATRIXGRAPHICS.includes(this.rowLabels[c])||MATRIXGRAPHICS2.includes(this.rowLabels[c])||(o=noteToFrequency(this.rowLabels[c]+this.rowArgs[c],this.activity.turtles.ithTurtle(0).singer.keySignature),a.has(o))||(n.push([o,this.rowLabels[c],this.rowArgs[c],c,this._noteStored[c]]),a.add(o));for(var h,r=0;r<this.rowLabels.length;r++)null!=getDrumName(this.rowLabels[r])&&n.push([-1*r,this.rowLabels[r],this.rowArgs[r],r,this._noteStored[r]]);for(var u=0;u<this.rowLabels.length;u++)MATRIXGRAPHICS.includes(this.rowLabels[u])?(h=MATRIXGRAPHICS.indexOf(this.rowLabels[u])+100,n.push([-h,this.rowLabels[u],this.rowArgs[u],u,this._noteStored[u]])):MATRIXGRAPHICS2.includes(this.rowLabels[u])&&(h=MATRIXGRAPHICS.indexOf(this.rowLabels[u])+200,n.push([-h,this.rowLabels[u],this.rowArgs[u],u,this._noteStored[u]]));var p=(p=n.sort(function(t,e){return t[0]-e[0]})).reverse();this.rowLabels=[],this.rowArgs=[],this._sortedRowMap=[],this._rowMapper=[];for(var d=0;d<p.length;d++)this._rowMapper.push(p[d][3]);for(var b=[],y=this.columnBlocksMap,m=0;m<this._rowMapper.length;m++)b.push(this.columnBlocksMap[this._rowMapper[m]]);this.columnBlocksMap=b;for(var v,_,g=0,k=0;k<p.length;k++){if(v=p[k],this._rowMap[v[3]]=k,this._noteStored[k]=v[4],0===k)this._sortedRowMap.push(0);else{if(0<k&&"hertz"!==v[1]&&v[1]===last(this.rowLabels)){console.debug("skipping "+v[1]+" "+last(this.rowLabels)),this._sortedRowMap.push(last(this._sortedRowMap)),null!=y[p[g][3]]&&(setTimeout(this._removePitchBlock(y[p[g][3]][0]),500),this.columnBlocksMap=this.columnBlocksMap.filter(function(t){return t[0]!==y[p[g][3]][0]}),g=k);for(var f=this._rowMap[k];f<this._rowMap.length;f++)--this._rowOffset[f];this._rowMap[k]=this._rowMap[k-1];continue}console.debug("pushing "+v[1]+" "+last(this.rowLabels)),this._sortedRowMap.push(last(this._sortedRowMap)+1),g=k,this.stylePhraseMaker()}this.rowLabels.push(v[1]),this.rowArgs.push(Number(v[2]))}this._matrixHasTuplets=!1,this.sorted=!0,this.init(this.activity),this.sorted=!0;for(var w=0;w<this.activity.logo.tupletRhythms.length;w++)switch(this.activity.logo.tupletRhythms[w][0]){case"simple":case"notes":(_=[this.activity.logo.tupletParams[this.activity.logo.tupletRhythms[w][1]]]).push([]);for(var C=2;C<this.activity.logo.tupletRhythms[w].length;C++)_[1].push(this.activity.logo.tupletRhythms[w][C]);this.addTuplet(_);break;default:this.addNotes(this.activity.logo.tupletRhythms[w][1],this.activity.logo.tupletRhythms[w][2])}this.makeClickable()}}},{key:"_export",value:function(){var t=window.open("").document;if(void 0===t)console.debug("Could not create export window");else{var e=t.createElement("title"),e=(e.innerHTML="Music Matrix",t.head.appendChild(e),t.createElement("H3")),e=(e.innerHTML="Music Matrix",t.body.appendChild(e),t.createElement("TABLE"));e.setAttribute("id","exportTable"),e.style.textAlign="center",t.body.appendChild(e);for(var l,i,s,o,a,n,c=t.getElementById("exportTable").createTHead(),h=0;h<this.rowLabels.length;h++){l=(i=c.insertRow()).insertCell(),null!=(s=getDrumName(this.rowLabels[h]))?(l.innerHTML=_(s),l.style.fontSize=Math.floor(14*this._cellScale)+"px"):"http"===this.rowLabels[h].slice(0,4)?(l.innerHTML=this.rowLabels[h],l.style.fontSize=Math.floor(14*this._cellScale)+"px"):MATRIXSYNTHS.includes(this.rowLabels[h])?(l.innerHTML=this.rowArgs[h],l.style.fontSize=Math.floor(14*this._cellScale)+"px"):MATRIXGRAPHICS.includes(this.rowLabels[h])?(o=this.activity.blocks.protoBlockDict[this.rowLabels[h]].staticLabels[0],l.innerHTML=o+"<br>"+this.rowArgs[h],l.style.fontSize=Math.floor(12*this._cellScale)+"px"):MATRIXGRAPHICS2.includes(this.rowLabels[h])?(o=this.activity.blocks.protoBlockDict[this.rowLabels[h]].staticLabels[0],l.innerHTML="".concat(o,"<br>").concat(this.rowArgs[h][0]," ").concat(this.rowArgs[h][1]),l.style.fontSize=Math.floor(12*this._cellScale)+"px"):noteIsSolfege(this.rowLabels[h])?l.innerHTML="".concat(i18nSolfege(this.rowLabels[h])).concat(this.rowArgs[h].toString().sub()):l.innerHTML="".concat(this.rowLabels[h]).concat(this.rowArgs[h].toString().sub());for(var r,u=0;r=this._rows[h].cells[u];u++)(a=i.insertCell()).style.backgroundColor=r.style.backgroundColor,a.innerHTML=r.innerHTML,a.width=r.width,""==a.width&&(a.width=r.style.width),a.colSpan=r.colSpan,a.style.minWidth=r.style.width,a.style.maxWidth=r.style.width,a.height="30px",a.style.fontSize="14px",a.style.padding="1px"}if(this._matrixHasTuplets){(l=(i=c.insertRow()).insertCell()).innerHTML=_("note value");for(var p=this._tupletNoteValueRow,d=0;d<p.cells.length;d++)a=i.insertCell(),n=p.cells[d],a.style.backgroundColor=n.style.backgroundColor,a.innerHTML=n.innerHTML,a.width=n.width,""==a.width&&(a.width=n.style.width),a.colSpan=n.colSpan,a.style.minWidth=n.style.width,a.style.maxWidth=n.style.width,a.style.fontSize="14px",a.style.padding="1px";(l=(i=c.insertRow()).insertCell()).innerHTML=_("tuplet value"),p=this._tupletValueRow;for(var b=0;b<p.cells.length;b++)a=i.insertCell(),n=p.cells[b],a.style.backgroundColor=n.style.backgroundColor,a.innerHTML=n.innerHTML,a.width=n.width,""==a.width&&(a.width=n.style.width),a.colSpan=n.colSpan,a.style.minWidth=n.style.width,a.style.maxWidth=n.style.width,a.style.fontSize="14px",a.style.padding="1px"}(l=(i=c.insertRow()).insertCell()).innerHTML=_("note value"),p=this._noteValueRow;for(var y=0;y<p.cells.length;y++)a=i.insertCell(),n=p.cells[y],a.style.backgroundColor=n.style.backgroundColor,a.innerHTML=n.innerHTML,a.width=n.width,""==a.width&&(a.width=n.style.width),a.colSpan=n.colSpan,a.style.minWidth=n.style.width,a.style.maxWidth=n.style.width,a.style.fontSize="14px",a.style.padding="1px";e=t.documentElement.outerHTML;t.body.innerHTML+='<br><a id="downloadb1" style="background: #C374E9; border-radius: 5%; padding: 0.3em; text-decoration: none; margin: 0.5em; color: white;" download>Download Matrix</a>',t.getElementById("downloadb1").download="MusicMatrix",t.getElementById("downloadb1").href=this._generateDataURI(e),t.close()}}},{key:"note2Solfege",value:function(t,e){var l,t=["♭","♯"].includes(t[1])?(l=t[2],SOLFEGECONVERSIONTABLE[t.substr(0,2)]):(l=t[1],SOLFEGECONVERSIONTABLE[t[0]]);this.rowLabels[e]=t,this.rowArgs[e]=l}},{key:"addTuplet",value:function(t){for(var e,l=t[0][0]/t[0][1],i=t[1].length,s=this._currentMusicalTime<.001&&0<this._notesToPlay.length?"3px solid #555":"1px solid #ccc",o=0,a=0;a<i;a++)e=0===a?t[1][0]:LCD(e,t[1][a]),o+=32/t[1][a];for(var n=0,c=0;c<i;c++)0<t[1][c]&&(n+=e/t[1][c]);var h=t[0][1]/t[0][0],r=calcNoteValueToDisplay(t[0][1],t[0][0]);12<h&&(r='<a href="#" title="'+t[0][0]+"/"+t[0][1]+'">.</a>');for(var u,p,d=0;d<i;d++)this._notesToPlay.push([["R"],o*t[0][1]/(32/t[1][d])]),this._outputAsTuplet.push([i,h]);if(!this._matrixHasTuplets){u=this._rows[0],(p=this._tupletNoteLabel).innerHTML=_("note value"),p.style.fontSize=75*this._cellScale+"%",p.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",p.style.width=Math.floor(2*MATRIXSOLFEWIDTH*this._cellScale)+"px",p.style.minWidth=p.style.width,p.style.maxWidth=p.style.width,p.style.backgroundColor=platformColor.labelColor,(p=this._tupletValueLabel).innerHTML=_("tuplet value"),p.style.fontSize=75*this._cellScale+"%",p.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",p.style.width=Math.floor(2*MATRIXSOLFEWIDTH*this._cellScale)+"px",p.style.minWidth=p.style.width,p.style.maxWidth=p.style.width,p.style.backgroundColor=platformColor.labelColor;for(var b=this._tupletNoteValueRow,y=this._tupletValueRow,m=0;m<u.cells.length;m++)(f=b.insertCell()).style.backgroundColor=platformColor.tupletBackground,f.style.width=u.cells[m].style.width,f.style.minWidth=u.cells[m].style.minWidth,f.style.maxWidth=u.cells[m].style.maxWidth,f.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+"px",(f=y.insertCell()).style.backgroundColor=platformColor.tupletBackground,f.style.width=u.cells[m].style.width,f.style.minWidth=u.cells[m].style.minWidth,f.style.maxWidth=u.cells[m].style.maxWidth,f.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+"px"}for(var v,g,k,f,w=h*n,C=0;C<i;C++){f=(b=this._tupletNoteValueRow).insertCell(-1),g=1/((v=32/t[1][C])/(o/l)),f.style.backgroundColor=platformColor.tupletBackground,f.style.width=this._noteWidth(g)+"px",f.style.minWidth=f.style.width,f.style.maxWidth=f.style.width,f.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",f.setAttribute("id",1/w),f.style.lineHeight="60%",f.style.fontSize=75*this._cellScale+"%",f.style.textAlign="center",f.style.borderLeft=0===C?s:"1px solid #ccc",(g=toFraction(v/(o/l)))[1]<13?null!=NOTESYMBOLS&&g[1]in NOTESYMBOLS?f.innerHTML="".concat(g[0],"<br>&mdash;<br>").concat(g[1],'<br>\n                        <img \n                            src="').concat(NOTESYMBOLS[g[1]],'" \n                            height="').concat(MATRIXSOLFEHEIGHT/2*this._cellScale,'"\n                        >'):f.innerHTML="".concat(g[0],"<br>&mdash;<br>").concat(g[1],"<br><br>"):f.innerHTML="";for(var W=f.style.width,L=0;L<this.rowLabels.length;L++)k=-1!=MATRIXGRAPHICS.indexOf(this.rowLabels[L])?platformColor.graphicsBackground:null===getDrumName(this.rowLabels[L])?platformColor.pitchBackground:platformColor.drumBackground,(f=this._rows[L].insertCell()).setAttribute("cellColor",k),f.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+"px",f.setAttribute("alt",1/w),f.style.width=W,f.style.minWidth=f.style.width,f.style.maxWidth=f.style.width,f.style.backgroundColor=k,f.style.borderLeft=0===C?s:"1px solid #ccc",f.onmouseover=function(t){"black"!==t.target.style.backgroundColor&&(t.target.style.backgroundColor=platformColor.selectorSelected)},f.onmouseout=function(t){"black"!==t.target.style.backgroundColor&&(t.target.style.backgroundColor=t.target.getAttribute("cellColor"))}}(f=(y=this._tupletValueRow).insertCell()).colSpan=i,f.style.fontSize=Math.floor(75*this._cellScale)+"%",f.style.lineHeight="60%",f.style.width=this._noteWidth(h)+"px",f.style.minWidth=f.style.width,f.style.maxWidth=f.style.width,f.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",f.style.textAlign="center",f.innerHTML=n,f.style.backgroundColor=platformColor.tupletBackground,f.style.borderLeft=s,(f=this._noteValueRow.insertCell()).colSpan=i,f.style.fontSize=Math.floor(75*this._cellScale)+"%",f.style.lineHeight="60%",f.style.width=this._noteWidth(h)+"px",f.style.minWidth=f.style.width,f.style.maxWidth=f.style.width,f.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",f.style.textAlign="center",f.innerHTML=r,f.style.backgroundColor=platformColor.rhythmcellcolor,f.style.borderLeft=s,this._matrixHasTuplets=!0,this._currentMusicalTime+=l,this._currentMusicalTime>=this._measureLimit-.001&&(this._currentMusicalTime=0)}},{key:"_noteWidth",value:function(t){return Math.max(Math.floor(EIGHTHNOTEWIDTH*(8/t)*this._cellScale),15)}},{key:"addNotes",value:function(t,e){var l=calcNoteValueToDisplay(e,1);12<e&&(l='<a href="#" title="1/'+e+'">.</a>');for(var i=0;i<t;i++)this._notesToPlay.push([["R"],e]),this._outputAsTuplet.push([t,e]);for(var s,o,a=this.rowLabels.length-this._rests,n=0;n<t;n++){for(var c=1/e,h=this._currentMusicalTime<.001&&(0<n||this._notesToPlay.length>t)?"3px solid #555":"1px solid #ccc",r=0;r<a;r++)o=-1!=MATRIXGRAPHICS.indexOf(this.rowLabels[r])||-1!=MATRIXGRAPHICS2.indexOf(this.rowLabels[r])?platformColor.graphicsBackground:null===getDrumName(this.rowLabels[r])?platformColor.pitchBackground:platformColor.drumBackground,(s=this._rows[r].insertCell()).setAttribute("cellColor",o),s.style.borderRadius="6px",s.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+"px",s.style.width=this._noteWidth(e)+"px",s.style.minWidth=s.style.width,s.style.maxWidth=s.style.width,s.style.backgroundColor=o,s.style.borderLeft=h,s.setAttribute("alt",1/e),s.addEventListener("mouseover",function(t){"black"!==t.target.style.backgroundColor&&(t.target.style.backgroundColor=platformColor.selectorSelected)}),s.addEventListener("mouseout",function(t){"black"!==t.target.style.backgroundColor&&(t.target.style.backgroundColor=t.target.getAttribute("cellColor"))});(s=this._noteValueRow.insertCell()).style.width=this._noteWidth(e)+"px",s.style.minWidth=s.style.width,s.style.maxWidth=s.style.width,s.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",s.style.fontSize=Math.floor(75*this._cellScale)+"%",s.style.lineHeight="60%",s.style.textAlign="center",s.innerHTML=l,s.style.backgroundColor=platformColor.rhythmcellcolor,s.style.color=platformColor.textColor,s.setAttribute("alt",e),s.style.borderLeft=h,this._matrixHasTuplets&&((s=this._tupletNoteValueRow.insertCell()).style.width=this._noteWidth(e)+"px",s.style.minWidth=s.style.width,s.style.maxWidth=s.style.width,s.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",s.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",s.style.backgroundColor=platformColor.tupletBackground,s.style.borderLeft=h,(s=this._tupletValueRow.insertCell()).style.width=this._noteWidth(e)+"px",s.style.minWidth=s.style.width,s.style.maxWidth=s.style.width,s.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",s.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",s.style.backgroundColor=platformColor.tupletBackground,s.style.borderLeft=h),this._currentMusicalTime+=c,this._currentMusicalTime>=this._measureLimit-.001&&(this._currentMusicalTime=0)}}},{key:"_lookForNoteBlocksOrRepeat",value:function(){this._noteBlocks=!1;for(var t,e=this.blockNo,l=0;l<this._blockMap[e].length;l++)if(-1!==(t=this._blockMap[e][l][1][0])&&null!==this.activity.blocks.blockList[t])if(void 0===this.activity.blocks.blockList[t])console.debug("block "+t+" is undefined");else if("newnote"===this.activity.blocks.blockList[t].name||"repeat"===this.activity.blocks.blockList[t].name){this._noteBlocks=!0;break}}},{key:"_syncMarkedBlocks",value:function(){for(var l=[],t=this.blockNo,e=0;e<this._blockMap[t].length;e++)if(-1!==this._blockMap[t][e][0])for(var i=0;i<this._blockMapHelper.length;i++)if(JSON.stringify(this._blockMap[t][e][1])===JSON.stringify(this._blockMapHelper[i][0]))for(var s=0;s<this._blockMapHelper[i][1].length;s++)l.push([this._blockMap[t][e][0],this._colBlocks[this._blockMapHelper[i][1][s]],this._blockMap[t][e][2]]);this._blockMap[t]=l.filter(function(e,t){return t===l.findIndex(function(t){return JSON.stringify(t)===JSON.stringify(e)})})}},{key:"blockConnection",value:function(t,e){var l,t=this.activity.blocks.blockList.length-t;null==e?(this.activity.blocks.blockList[this.blockNo].connections[2]=t,this.activity.blocks.blockList[t].connections[0]=this.blockNo):(l=this.activity.blocks.blockList[e].connections.length-1,this.activity.blocks.blockList[e].connections[l]=t,this.activity.blocks.blockList[t].connections[0]=e),this.activity.blocks.clampBlocksToCheck.push([this.blockNo,0]),this.activity.blocks.adjustDocks(this.blockNo,!0)}},{key:"_deleteRhythmBlock",value:function(t){null!==last(this.activity.blocks.blockList[t].connections)&&this.activity.blocks.sendStackToTrash(this.activity.blocks.blockList[last(this.activity.blocks.blockList[t].connections)]),this.activity.blocks.sendStackToTrash(this.activity.blocks.blockList[t]),this.activity.blocks.adjustDocks(this.blockNo,!0),this.activity.refreshCanvas()}},{key:"_addRhythmBlock",value:function(t,e){var l=[],i=(t=toFraction(t),this.activity.blocks.blockList[this.blockNo].connections[1]),i=this.activity.blocks.findBottomBlock(i),l="vspace"===this.activity.blocks.blockList[i].name?[[0,["rhythm2",{}],0,0,[null,1,2,5]],[1,["number",{value:e}],0,0,[0]],[2,["divide",{}],0,0,[0,3,4]],[3,["number",{value:t[1]}],0,0,[2]],[4,["number",{value:t[0]}],0,0,[2]],[5,["vspace",{}],0,0,[0,null]]]:[[0,"vspace",0,0,[null,1]],[1,["rhythm2",{}],0,0,[0,2,3,6]],[2,["number",{value:e}],0,0,[1]],[3,["divide",{}],0,0,[1,4,5]],[4,["number",{value:t[1]}],0,0,[3]],[5,["number",{value:t[0]}],0,0,[3]],[6,["vspace",{}],0,0,[1,null]]];this.activity.blocks.loadNewBlocks(l),"vspace"===this.activity.blocks.blockList[i].name?setTimeout(this.blockConnection(6,i),500):setTimeout(this.blockConnection(7,i),500),this.activity.refreshCanvas()}},{key:"_update",value:function(t,e,l,i){var s=[];e=toFraction(e),"tupletnote"===i?(s.push(this.activity.blocks.blockList[this.activity.blocks.blockList[t].connections[1]].connections[1]),s.push(this.activity.blocks.blockList[this.activity.blocks.blockList[t].connections[1]].connections[2])):(s.push(this.activity.blocks.blockList[this.activity.blocks.blockList[t].connections[2]].connections[1]),s.push(this.activity.blocks.blockList[this.activity.blocks.blockList[t].connections[2]].connections[2])),"rhythm"!==i&&"stupletvalue"!==i||(s.push(this.activity.blocks.blockList[t].connections[1]),this.activity.blocks.blockList[s[2]].value=parseFloat(l),this.activity.blocks.blockList[s[2]].text.text=l.toString(),this.activity.blocks.blockList[s[2]].updateCache()),("rhythm"===i||"stuplet"===i||"tupletnote"===i&&null!==e)&&(this.activity.blocks.blockList[s[0]].value=parseFloat(e[1]),this.activity.blocks.blockList[s[0]].text.text=e[1].toString(),this.activity.blocks.blockList[s[0]].updateCache(),this.activity.blocks.blockList[s[1]].value=parseFloat(e[0]),this.activity.blocks.blockList[s[1]].text.text=e[0].toString(),this.activity.blocks.blockList[s[1]].updateCache(),this.activity.refreshCanvas()),this.activity.saveLocally()}},{key:"_mapNotesBlocks",value:function(t,e){var l=[],i=this.activity.blocks.blockList[this.blockNo].connections[1],s=this.activity.blocks.blockList[i],o=0;for((s.name===t||"all"===t&&"hidden"!==s.name&&"vspace"!==s.name&&"hiddennoflow"!==s.name)&&l.push(e?[i,s.name]:i);null!=last(s.connections)&&!((o+=1)>2*this.activity.blocks.blockList);)i=last(s.connections),((s=this.activity.blocks.blockList[i]).name===t||"all"===t&&"hidden"!==s.name&&"vspace"!==s.name&&"hiddennoflow"!==s.name)&&l.push(e?[i,s.name]:i);return l}},{key:"recalculateBlocks",value:function(){for(var t=[],e=(t.push([this.activity.logo.tupletRhythms[0][2],1]),1),l=1;l<this.activity.logo.tupletRhythms.length;l++)this.activity.logo.tupletRhythms[l][2]===last(t)[0]?e+=1:(t[t.length-1][1]=e,t.push([this.activity.logo.tupletRhythms[l][2],1]),e=1);return 1<e&&(t[t.length-1][1]=e),t}},{key:"_readjustNotesBlocks",value:function(){var t=this._mapNotesBlocks("rhythm2"),e=this.recalculateBlocks(),l=[],i=e.length-t.length;if(0<=i)for(var s=0;s<t.length;s++)this._update(t[s],e[s][0],e[s][1],"rhythm");else for(var o=0;o<e.length;o++)this._update(t[o],e[o][0],e[o][1],"rhythm");for(var a=0;a<i;a++)this._addRhythmBlock(e[t.length+a][0],e[t.length+a][1]);for(var n=i;n<0;n++)this._deleteRhythmBlock(t[t.length+n]);for(var t=this._mapNotesBlocks("rhythm2"),c=0;c<t.length;c++)for(var h=0;h<e[c][1];h++)l.push([t[c],h]);this._colBlocks=l}},{key:"_restartGrid",value:function(){var t;this._matrixHasTuplets=!1,this.sorted=!0,this.init(this.activity),this.sorted=!1;for(var e=0;e<this.activity.logo.tupletRhythms.length;e++)switch(this.activity.logo.tupletRhythms[e][0]){case"simple":case"notes":(t=[this.activity.logo.tupletParams[this.activity.logo.tupletRhythms[e][1]]]).push([]);for(var l=2;l<this.activity.logo.tupletRhythms[e].length;l++)t[1].push(this.activity.logo.tupletRhythms[e][l]);this.addTuplet(t);break;default:this.addNotes(this.activity.logo.tupletRhythms[e][1],this.activity.logo.tupletRhythms[e][2])}this.makeClickable(),docById("wheelDivptm").style.display="none",this._menuWheel.removeWheel(),this._exitWheel.removeWheel()}},{key:"_addNotes",value:function(t,e){t=parseInt(t),this._blockMapHelper=[];for(var l=0;l<=t;l++)this._blockMapHelper.push([this._colBlocks[l],[l]]);for(var i=t+1;i<this.activity.logo.tupletRhythms.length;i++)this._blockMapHelper.push([this._colBlocks[i],[i+parseInt(e)]]);for(var s=0;s<parseInt(e);s++)this.activity.logo.tupletRhythms=this.activity.logo.tupletRhythms.slice(0,t+s+1).concat(this.activity.logo.tupletRhythms.slice(t+s));this._readjustNotesBlocks(),this._syncMarkedBlocks(),this._restartGrid.call(this)}},{key:"_deleteNotes",value:function(t){if(1!==this.activity.logo.tupletRhythms.length){t=parseInt(t),this._blockMapHelper=[];for(var e=0;e<t;e++)this._blockMapHelper.push([this._colBlocks[e],[e]]);for(var l=t+1;l<this.activity.logo.tupletRhythms.length;l++)this._blockMapHelper.push([this._colBlocks[l],[l-1]]);this.activity.logo.tupletRhythms=this.activity.logo.tupletRhythms.slice(0,t).concat(this.activity.logo.tupletRhythms.slice(t+1)),this._readjustNotesBlocks(),this._syncMarkedBlocks(),this._restartGrid.call(this)}}},{key:"_divideNotes",value:function(t,e){t=parseInt(t),this._blockMapHelper=[];for(var l=0;l<t;l++)this._blockMapHelper.push([this._colBlocks[l],[l]]);this.activity.logo.tupletRhythms=this.activity.logo.tupletRhythms.slice(0,t).concat([[this.activity.logo.tupletRhythms[t][0],this.activity.logo.tupletRhythms[t][1],this.activity.logo.tupletRhythms[t][2]*e]]).concat(this.activity.logo.tupletRhythms.slice(t+1)),this._blockMapHelper.push([this._colBlocks[t],[]]);for(var i=0,s=0;s<e-1;s++)this.activity.logo.tupletRhythms=this.activity.logo.tupletRhythms.slice(0,t+s+1).concat(this.activity.logo.tupletRhythms.slice(t+s)),this._blockMapHelper[t][1].push(i=t+s);this._blockMapHelper[t][1].push(++i);for(var o=t+1;o<this._colBlocks.length;o++)this._blockMapHelper.push([this._colBlocks[o],[++i]]);this._readjustNotesBlocks(),this._syncMarkedBlocks(),this._restartGrid.call(this)}},{key:"_tieNotes",value:function(t,e){var l,i=null,s=null,s=(t.id<e.id?(i=t.id,e):(i=e.id,t)).id;for(this._blockMapHelper=[],l=0;l<i;l++)this._blockMapHelper.push([this._colBlocks[l],[l]]);for(var o=l,a=i;a<=s;a++)this._blockMapHelper.push([this._colBlocks[a],[o]]);o++;for(var n=parseInt(s)+1;n<this.activity.logo.tupletRhythms.length;n++)this._blockMapHelper.push([this._colBlocks[n],[o]]),o++;for(var c=0,h=i;h<=s;h++)c+=1/parseFloat(this.activity.logo.tupletRhythms[h][2]);this.activity.logo.tupletRhythms=this.activity.logo.tupletRhythms.slice(0,i).concat([[this.activity.logo.tupletRhythms[i][0],this.activity.logo.tupletRhythms[i][1],1/c]]).concat(this.activity.logo.tupletRhythms.slice(parseInt(s)+1)),this._readjustNotesBlocks(),this._syncMarkedBlocks(),this._restartGrid.call(this)}},{key:"_updateTuplet",value:function(t,e,l){var i;this.activity.logo.tupletParams[t][1]=e,this._restartGrid.call(this),"simpletupletnote"===l?(i=this._mapNotesBlocks("stuplet"),this._update(i[t],e,0,"stuplet")):(i=this._mapNotesBlocks("tuplet4"),this._update(i[t],e,0,"tupletnote"))}},{key:"_updateTupletValue",value:function(t,e,l){t=parseInt(t),e=parseInt(e),l=parseInt(l),this._blockMapHelper=[];var i=0;if(e<l){for(var s=0;s<=this.activity.logo.tupletRhythms.length&&s!=t;s++)for(var o=0;o<this.activity.logo.tupletRhythms[s].length-2;o++)this._blockMapHelper.push([this._colBlocks[i],[i]]),i++;for(var a=0;a<this.activity.logo.tupletRhythms[t].length-2;a++)this._blockMapHelper.push([this._colBlocks[i],[i]]),i++;for(var n=i,i=i+l-e,c=t+1;c<this.activity.logo.tupletRhythms.length;c++)for(var h=0;h<this.activity.logo.tupletRhythms[c].length-2;h++)this._blockMapHelper.push([this._colBlocks[n],[i]]),n++,i++;for(var r=e;r<l;r++)this.activity.logo.tupletRhythms[t]=this.activity.logo.tupletRhythms[t].slice(0,this.activity.logo.tupletRhythms[t].length).concat(this.activity.logo.tupletRhythms[t].slice(this.activity.logo.tupletRhythms[t].length-1))}else{for(var u=i=0;u<=this.activity.logo.tupletRhythms.length&&u!==t;u++)for(var p=0;p<this.activity.logo.tupletRhythms[u].length-2;p++)this._blockMapHelper.push([this._colBlocks[i],[i]]),i++;for(var d=e;l<d;d--)this.activity.logo.tupletRhythms[t]=this.activity.logo.tupletRhythms[t].slice(0,this.activity.logo.tupletRhythms[t].length-1);for(var b=0;b<this.activity.logo.tupletRhythms[t].length-2;b++)this._blockMapHelper.push([this._colBlocks[i],[i]]),i++;n=i+e-l;for(var y=t+1;y<this.activity.logo.tupletRhythms.length;y++)for(var m=0;m<this.activity.logo.tupletRhythms[y].length-2;m++)this._blockMapHelper.push([this._colBlocks[n],[i]]),n++,i++}for(var v=this._mapNotesBlocks("stuplet"),_=[],g=0;g<this.activity.logo.tupletRhythms.length;g++)for(var k=0;k<this.activity.logo.tupletRhythms[g].length-2;k++)_.push([v[g],k]);this._colBlocks=_,this._restartGrid.call(this),this._syncMarkedBlocks(),this._update(v[t],null,l,"stupletvalue")}},{key:"_createpiesubmenu",value:function(e,l,i){var s=this,o=(docById("wheelDivptm").style.display="",this._menuWheel=new wheelnav("wheelDivptm",null,800,800),this._exitWheel=new wheelnav("_exitWheel",this._menuWheel.raphael),[]),t=("tupletvalue"===i?(o=["1","2","3","-","4","5","6","7","8","+","9","10"],this.newNoteValue=String(l)):"simpletupletnote"===i||"tupletnote"===i?(o=["<-","Enter","1","2","3","4","5","6","7","8","9","10"],this.newNoteValue="/"):"rhythmnote"===i&&(this._tabsWheel=new wheelnav("_tabsWheel",this._menuWheel.raphael),this.newNoteValue=2,o=["divide","delete","duplicate",String(this.newNoteValue)]),wheelnav.cssMode=!0,this._menuWheel.keynavigateEnabled=!1,this._menuWheel.clickModeRotate=!1,this._menuWheel.colors=platformColor.pitchWheelcolors,this._menuWheel.slicePathFunction=slicePath().DonutSlice,this._menuWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._menuWheel.sliceSelectedPathCustom=this._menuWheel.slicePathCustom,this._menuWheel.sliceInitPathCustom=this._menuWheel.slicePathCustom,this._menuWheel.animatetime=0,this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.keynavigateEnabled=!1,this._exitWheel.clickModeRotate=!1,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,[]),a=[];if("tupletvalue"===i)t=["x",this.newNoteValue],this._menuWheel.slicePathCustom.minRadiusPercent=.4,this._menuWheel.slicePathCustom.maxRadiusPercent=1,this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.4;else if("simpletupletnote"===i||"tupletnote"===i)t=["x",this.newNoteValue],this._menuWheel.slicePathCustom.minRadiusPercent=.5,this._menuWheel.slicePathCustom.maxRadiusPercent=1,this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.5;else if("rhythmnote"===i){t=["x"," "],a=["","","","","","","","","","","","","1","2","3","4","5","6","7",""],this._menuWheel.slicePathCustom.minRadiusPercent=.2,this._menuWheel.slicePathCustom.maxRadiusPercent=.7,this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.2,this._tabsWheel.colors=platformColor.pitchWheelcolors,this._tabsWheel.slicePathFunction=slicePath().DonutSlice,this._tabsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._tabsWheel.slicePathCustom.minRadiusPercent=.7,this._tabsWheel.slicePathCustom.maxRadiusPercent=1,this._tabsWheel.sliceSelectedPathCustom=this._tabsWheel.slicePathCustom,this._tabsWheel.sliceInitPathCustom=this._tabsWheel.slicePathCustom,this._tabsWheel.clickModeRotate=!1,this._tabsWheel.createWheel(a);for(var n=0;n<a.length;n++)this._tabsWheel.navItems[n].navItem.hide()}this._menuWheel.createWheel(o),this._exitWheel.createWheel(t),docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="250px",docById("wheelDivptm").style.width="250px";var c,t=0,h=0;if(null!==e&&(t=(c=this._noteValueRow.cells[e]).getBoundingClientRect().x,h=c.getBoundingClientRect().y),docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,t*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,h*this.activity.getStageScale()))+"px",this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",s._menuWheel.removeWheel(),s._exitWheel.removeWheel()},"tupletvalue"===i){var r=function(){var t=s._menuWheel.selectedNavItemIndex,t=o[t];s.newNoteValue=String(t),docById("wheelnav-_exitWheel-title-1").children[0].textContent=s.newNoteValue,s._updateTupletValue(s,e,l,s.newNoteValue)};this._menuWheel.navItems[3].navigateFunction=function(){1<s.newNoteValue&&(s.newNoteValue=String(parseInt(s.newNoteValue)-1),docById("wheelnav-_exitWheel-title-1").children[0].textContent=s.newNoteValue,s._updateTupletValue(s,e,l,s.newNoteValue))},this._menuWheel.navItems[9].navigateFunction=function(){s.newNoteValue=String(parseInt(s.newNoteValue)+1),docById("wheelnav-_exitWheel-title-1").children[0].textContent=s.newNoteValue,s._updateTupletValue(e,l,s.newNoteValue)};for(var u=0;u<o.length;u++)9!==u&&3!=u&&(this._menuWheel.navItems[u].navigateFunction=r)}else if("simpletupletnote"===i||"tupletnote"===i){var p=!1,d=!1,b=function(){var t=s._menuWheel.selectedNavItemIndex,t=o[t];p?d||(s.newNoteValue=s.newNoteValue+String(t),docById("wheelnav-_exitWheel-title-1").children[0].textContent=s.newNoteValue,d=!0):(s.newNoteValue=String(t)+"/",docById("wheelnav-_exitWheel-title-1").children[0].textContent=s.newNoteValue,p=!0)};this._menuWheel.navItems[0].navigateFunction=function(){var t;d&&p?(t=s.newNoteValue.split("/"),s.newNoteValue=t[0]+"/",docById("wheelnav-_exitWheel-title-1").children[0].textContent=s.newNoteValue,d=!1):p&&(s.newNoteValue="/",docById("wheelnav-_exitWheel-title-1").children[0].textContent=s.newNoteValue,p=!1)},this._menuWheel.navItems[1].navigateFunction=function(){var t;d&&p&&(t=s.newNoteValue.split("/"),s._updateTuplet(e,parseInt(t[1])/parseInt(t[0]),i))};for(var y=2;y<o.length;y++)this._menuWheel.navItems[y].navigateFunction=b}else if("rhythmnote"===i){var m=0;this._menuWheel.navItems[0].navigateFunction=function(){s._divideNotes(e,s.newNoteValue)},this._menuWheel.navItems[1].navigateFunction=function(){s._deleteNotes(e)},this._menuWheel.navItems[2].navigateFunction=function(){s._addNotes(e,s.newNoteValue)},this._menuWheel.navItems[3].navigateFunction=function(){if(m){for(var t=12;t<19;t++)docById("wheelnav-wheelDivptm-title-3").children[0].textContent=s.newNoteValue,s._tabsWheel.navItems[t].navItem.hide();m=0}else{for(var e=12;e<19;e++)docById("wheelnav-wheelDivptm-title-3").children[0].textContent=s.newNoteValue,s._tabsWheel.navItems[e].navItem.show();m=1}};for(var v=12;v<19;v++)this._tabsWheel.navItems[v].navigateFunction=function(){var t=s._tabsWheel.selectedNavItemIndex;s.newNoteValue=a[t],docById("wheelnav-wheelDivptm-title-3").children[0].textContent=a[t]}}}},{key:"makeClickable",value:function(){for(var t,e,i=this,l=this._noteValueRow,s=this._tupletValueRow,o=0;o<l.cells.length;o++){(t=l.cells[o]).setAttribute("id",o),void 0!==(e=s.cells[o])&&e.setAttribute("id",o);var a=function(t){i._mouseDownCell=t.target},n=function(t){var e;i._mouseUpCell=t.target,i._mouseDownCell!==i._mouseUpCell?i._tieNotes(i._mouseDownCell,i._mouseUpCell):(e=Array.prototype.slice.call(t.target.parentElement.children),i._createpiesubmenu(e.indexOf(t.target),t.target.getAttribute("alt"),"rhythmnote"))};void 0!==e?"notes"===this.activity.logo.tupletRhythms[0][0]?t.onclick=function(t){i._createpiesubmenu(t.target.getAttribute("id"),null,"tupletnote")}:(t.onclick=function(t){i._createpiesubmenu(t.target.getAttribute("id"),null,"simpletupletnote")},e.onclick=function(t){i._createpiesubmenu(t.target.getAttribute("id"),t.target.getAttribute("colspan"),"tupletvalue")}):(t.removeEventListener("mousedown",a),t.addEventListener("mousedown",a),t.removeEventListener("mouseup",n),t.addEventListener("mouseup",n))}for(var c,h=this.rowLabels.length,r=0;r<h;r++)for(var u=this._rows[r],p=0;p<u.cells.length;p++)"black"===(t=u.cells[p]).style.backgroundColor&&(t.style.backgroundColor=t.getAttribute("cellColor"),this._setNotes(p,r,!1));for(var d,b,y=0;y<h;y++){u=this._rows[y];for(var m=0;m<u.cells.length;m++)(t=u.cells[m]).setAttribute("data-i",y),t.setAttribute("data-j",m),c=!1,t.onmousedown=function(t){c=!0;var e=Number(t.target.getAttribute("data-i")),l=Number(t.target.getAttribute("data-j"));"black"===t.target.style.backgroundColor?(t.target.style.backgroundColor=t.target.getAttribute("cellColor"),i._notesToPlay[l][0]=["R"],i._noteBlocks||i._setNotes(l,e,!1)):(t.target.style.backgroundColor="black",i._noteBlocks||i._setNotes(l,e,!0))},t.onmouseover=function(t){var e=Number(t.target.getAttribute("data-i")),l=Number(t.target.getAttribute("data-j"));c&&("black"===t.target.style.backgroundColor?(t.target.style.backgroundColor=t.target.getAttribute("cellColor"),i._notesToPlay[l][0]=["R"],i._noteBlocks||i._setNotes(l,e,!1)):(t.target.style.backgroundColor="black",i._noteBlocks||i._setNotes(l,e,!0)))},t.onmouseup=function(){c=!1}}if(this.sorted)for(var v=0;v<this._rowMapper.length;v++){d=this._rowMapper[v],L=this._sortedRowMap[v],u=this._rows[L];for(var _=0;_<this._markedColsInRow[d].length;_++)I=this._markedColsInRow[d][_],(t=u.cells[I]).style.backgroundColor="black",this._setNoteCell(L,I,t,!1,null)}else for(var g=this.blockNo,k=0;k<this._blockMap[g].length;k++)if(-1!==(b=this._blockMap[g][k])[0]){for(var f=b[2],w=null,C=I=0;C<this._rowBlocks.length;C++){var W=this._rowBlocks[C].toString().slice(-(null==(W=b[0])||null==(W=W.toString())?void 0:W.length));if(W===(null==(W=b[0])?void 0:W.toString())&&I++===f){w=C;break}}if(null!==w){for(var L=this._rowMap[w]+this._rowOffset[this._rowMap[w]],I=-1,S=0;S<this._colBlocks.length;S++)if(this._noteBlocks){if(this._colBlocks[S][0]===b[1][0]&&this._colBlocks[S][1]===f){I=S;break}}else if(this._colBlocks[S][0]===b[1][0]&&this._colBlocks[S][1]===b[1][1]){I=S;break}-1!==I&&null!=(u=this._rows[L])&&null!=(t=u.cells[I])&&(t.style.backgroundColor="black",this._setNoteCell(L,I,t,!1,null))}}}},{key:"playAll",value:function(){if(this.playingNow=!this.playingNow,this.playingNow){this.widgetWindow.modifyButton(0,"stop-button.svg",R.ICONSIZE,_("Stop")),this.activity.logo.synth.stop(),this.collectNotesToPlay(),this._notesCounter=0;for(var t,e=this._notesToPlay[this._notesCounter][0],l=[],i=[],s=[],o=0;o<e.length;o++)t="number"==typeof e[o]?null:getDrumName(e[o]),"number"==typeof e[o]?i.push(e[o]):null!=t?s.push(t):"http"===e[o].slice(0,4)?s.push(e[o]):1<(t=e[o].split(": ")).length?MATRIXSYNTHS.includes(t[0])?i.push(e[o]):this._processGraphics(t):l.push(e[o].replace(/♭/g,"b").replace(/♯/g,"#")),this._stopOrCloseClicked=!1;var a=this._notesToPlay[this._notesCounter][1];this._notesCounter+=1,this._colIndex=0;var n=this._noteValueRow.cells[this._colIndex];n.style.backgroundColor=platformColor.selectorBackground,1<n.colSpan?(this._spanCounter=1,this._tupletNoteValueRow.cells[this._colIndex].style.backgroundColor=platformColor.selectorBackground):(this._spanCounter=0,this._colIndex+=1),"R"!==e[0]&&0<l.length&&this._playChord(l,Singer.defaultBPMFactor/a);for(var c=0;c<i.length;c++)this.activity.logo.synth.trigger(0,[Number(i[c])],Singer.defaultBPMFactor/a,this._instrumentName,null,null);for(var h=0;h<s.length;h++)this.activity.logo.synth.trigger(0,"C2",Singer.defaultBPMFactor/a,s[h],null,null);this.__playNote(0,0)}else this._stopOrCloseClicked=!0,this.widgetWindow.modifyButton(0,"play-button.svg",R.ICONSIZE,_("Play"))}},{key:"collectNotesToPlay",value:function(){for(var t,e=["do♭","C♭","do","C","do♯","C♯","re♭","D♭","re","D","re♯","D♯","mi♭","E♭","mi","E","mi♯","E♯","fa♭","F♭","fa","F","fa♯","F♯","sol♭","G♭","sol","G","sol♯","G♯","la♭","A♭","la","A","la♯","A♯","ti♭","B♭","ti","B","ti♯","B♯"],l=["C♭","C♭","C","C","C♯","C♯","D♭","D♭","D","D","D♯","D♯","E♭","E♭","E","E","E♯","E♯","F♭","F♭","F","F","F♯","F♯","G♭","G♭","G","G","G♯","G♯","A♭","A♭","A","A","A♯","A♯","B♭","B♭","B","B","B♯","B♯"],i=[],s=0;s<this._colBlocks.length;s++){for(var o=[],a=0;a<this.rowLabels.length;a++)if("black"===(t=this._rows[a].cells[s]).style.backgroundColor)if("hertz"===this.rowLabels[a])o.push(this.rowArgs[a]);else if(-1!=MATRIXGRAPHICS.indexOf(this.rowLabels[a])||-1!=MATRIXGRAPHICS2.indexOf(this.rowLabels[a]))o.push(this.rowLabels[a]+": "+this.rowArgs[a]);else if(-1!=e.indexOf(this.rowLabels[a]))o.push(l[e.indexOf(this.rowLabels[a])]+this.rowArgs[a]);else if(isCustomTemperament(this.activity.logo.synth.inTemperament)){var n,c=getTemperament(this.activity.logo.synth.inTemperament),h=this.rowLabels[a],r=[];for(n in c)if(c[n][1]===h){r=c[n];break}0<r.length&&o.push(this.rowLabels[a]+this.rowArgs[a])}else o.push(this.rowLabels[a]);i.push([o,1/t.getAttribute("alt")])}this._notesToPlay=i}},{key:"_resetMatrix",value:function(){for(var t=this._noteValueRow,e=0;e<t.cells.length;e++)t.cells[e].style.backgroundColor=platformColor.rhythmcellcolor;if(this._matrixHasTuplets)for(var t=this._tupletNoteValueRow,l=0;l<t.cells.length;l++)t.cells[l].style.backgroundColor=platformColor.tupletBackground}},{key:"__playNote",value:function(h,r){var u,p=this;this.lyricsON&&activity.textMsg(this._lyrics[r],3e3),this.widgetWindow.isVisible()&&(u=this._notesToPlay[r][1],h=1/u,setTimeout(function(){var t;if(r===p._notesToPlay.length-1)p._resetMatrix(),p.widgetWindow.modifyButton(0,"play-button.svg",R.ICONSIZE,_("Play")),p.playingNow=!1,p._playButton.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(R.ICONSIZE,'" \n                        width="').concat(R.ICONSIZE,'" \n                        vertical-align="middle"\n                    >&nbsp;&nbsp;');else{null!=(t=p._noteValueRow.cells[p._colIndex])&&(t.style.backgroundColor=platformColor.selectorBackground,1<t.colSpan)&&(p._tupletNoteValueRow.cells[p._notesCounter].style.backgroundColor=platformColor.selectorBackground),p._notesCounter>=p._notesToPlay.length&&(p._notesCounter=1,p.activity.logo.synth.stop());var e,l=p._notesToPlay[p._notesCounter][0],i=(u=p._notesToPlay[p._notesCounter][1],p._notesCounter+=1,[]),s=[],o=[];if(!p._stopOrCloseClicked)for(var a=0;a<l.length;a++)e="number"==typeof l[a]?null:getDrumName(l[a]),"number"==typeof l[a]?s.push(l[a]):null!=e?o.push(e):"http"===l[a].slice(0,4)?o.push(l[a]):(e=l[a].split(": "),MATRIXSYNTHS.includes(e[0])?s.push(l[a]):MATRIXGRAPHICS.includes(e[0])||MATRIXGRAPHICS2.includes(e[0])?p._processGraphics(e):i.push(l[a].replace(/♭/g,"b").replace(/♯/g,"#")));"R"!==l[0]&&0<i.length&&p._playChord(i,Singer.defaultBPMFactor/u);for(var n=0;n<s.length;n++)p.activity.logo.synth.trigger(0,[Number(s[n])],Singer.defaultBPMFactor/u,p._instrumentName,null,null);for(var c=0;c<o.length;c++)p.activity.logo.synth.trigger(0,["C2"],Singer.defaultBPMFactor/u,o[c],null,null)}null!=(t=p._noteValueRow.cells[p._colIndex])&&(1<t.colSpan&&(p._spanCounter+=1,p._spanCounter!==t.colSpan)||(p._spanCounter=0,p._colIndex+=1),(r+=1)<p._notesToPlay.length&&p.playingNow?p.__playNote(h,r):(p._resetMatrix(),p.widgetWindow.modifyButton(0,"play-button.svg",R.ICONSIZE,_("Play"))))},1e3*Singer.defaultBPMFactor*h+this.activity.logo.turtleDelay))}},{key:"_playChord",value:function(t,e){var l=this;setTimeout(function(){l.activity.logo.synth.trigger(0,t[0],e,l._instrumentName,null,null)},1),1<t.length&&setTimeout(function(){l.activity.logo.synth.trigger(0,t[1],e,l._instrumentName,null,null)},1),2<t.length&&setTimeout(function(){l.activity.logo.synth.trigger(0,t[2],e,l._instrumentName,null,null)},1),3<t.length&&setTimeout(function(){l.activity.logo.synth.trigger(0,t[3],e,l._instrumentName,null,null)},1)}},{key:"_processGraphics",value:function(t){var e=this.activity.turtles.getTurtle(0);switch(t[0]){case"forward":e.painter.doForward(t[1]);break;case"back":e.painter.doForward(-t[1]);break;case"right":e.painter.doRight(t[1]);break;case"left":e.painter.doRight(-t[1]);break;case"setcolor":e.painter.doSetColor(t[1]);break;case"sethue":e.painter.doSetHue(t[1]);break;case"setshade":e.painter.doSetValue(t[1]);break;case"setgrey":e.painter.doSetChroma(t[1]);break;case"settranslucency":e.painter.doSetPenAlpha(1-t[1]/100);break;case"setpensize":e.painter.doSetPensize(t[1]);break;case"setheading":e.painter.doSetHeading(t[1]);break;case"arc":e.painter.doArc(t[1],t[2]);break;case"setxy":e.painter.doSetXY(t[1],t[2]);break;default:console.debug("unknown graphics command "+t[0])}}},{key:"_setNotes",value:function(t,e,l){var i,e=this._rowBlocks[this._rowMap.indexOf(e-this._rowOffset[e])],s=this._colBlocks[t];l?this.addNode(e,s[0],s[1],this.blockNo):this.removeNode(e,s[0],s[1]);for(var o=0;o<this.rowLabels.length;o++)"black"===(i=this._rows[o].cells[t]).style.backgroundColor&&this._setNoteCell(o,t,i,l)}},{key:"_setNoteCell",value:function(t,e,l,i){var s,o,a=this._noteStored[t],n="hertz"===this.rowLabels[t]?(s=null,o=!1,[a]):(s=getDrumName(a),o=!1,n=a.split(": "),-1!=MATRIXGRAPHICS.indexOf(n[0])&&-1!=MATRIXGRAPHICS2.indexOf(n[0])&&(o=!0),a.split(": ")),e=this._rows[t].cells[e].getAttribute("alt")*Singer.defaultBPMFactor;1===n.length?i&&(null!=s?this.activity.logo.synth.trigger(0,"C2",e,s,null,null):"hertz"===this.rowLabels[t]?this.activity.logo.synth.trigger(0,Number(a),e,this._instrumentName,null,null):!0!==o?"string"==typeof a?this.activity.logo.synth.trigger(0,a.replace(/♭/g,"b").replace(/♯/g,"#"),e,this._instrumentName,null,null):this.activity.logo.synth.trigger(0,a,e,this._instrumentName,null,null):console.debug("Cannot parse note object: "+n)):MATRIXSYNTHS.includes(n[0])&&this.activity.logo.synth.trigger(0,[Number(n[1])],e,n[0],null,null)}},{key:"_clear",value:function(){var t,l=this,e=(this._lyrics=Array(this._lyrics.length).fill(""),document.getElementById("lyricRow"));e&&e.querySelectorAll("input[type='text']").forEach(function(t,e){t.value=l._lyrics[e]||""});for(var i=0;i<this.rowLabels.length;i++)for(var s=this._rows[i],o=0;o<s.cells.length;o++)"black"===(t=s.cells[o]).style.backgroundColor&&(t.style.backgroundColor=t.getAttribute("cellColor"),this._notesToPlay[o][0]=["R"],this._setNotes(o,i,!1))}},{key:"_save",value:function(){for(var t in this.activity.blocks.palettes.dict)this.activity.blocks.palettes.dict[t].hideMenu(!0);this.activity.refreshCanvas();var e,l,i,s,o,a,n=[[0,["action",{collapsed:!0}],100,100,[null,1,null,null]],[1,["text",{value:_("action")}],0,0,[0]]],c=0;this.collectNotesToPlay();for(var h=0;h<this._notesToPlay.length;h++){""===(e=this._notesToPlay[h].slice(0))[0]&&(e[0]="R"),n.push([l=n.length,"newnote",0,0,[c,l+1,l+2,null]]),i=n[l][4].length,0===h?n[c][4][i-2]=l:n[c][4][i-1]=l,c=l,1!==this._outputAsTuplet[h][0]&&parseInt(this._outputAsTuplet[h][1])===this._outputAsTuplet[h][1]?(n.push([l+1,"vspace",0,0,[l,l+(s=7)]]),n.push([l+2,"divide",0,0,[l,l+3,l+4]]),n.push([l+3,["number",{value:1}],0,0,[l+2]]),n.push([l+4,"multiply",0,0,[l+2,l+5,l+6]]),n.push([l+5,["number",{value:this._outputAsTuplet[h][0]}],0,0,[l+4]]),n.push([l+6,["number",{value:this._outputAsTuplet[h][1]}],0,0,[l+4]])):(n.push([l+1,"vspace",0,0,[l,l+(s=5)]]),n.push([l+2,"divide",0,0,[l,l+3,l+4]]),parseInt(e[1])<e[1]?(o=toFraction(e[1]),n.push([l+3,["number",{value:o[1]}],0,0,[l+2]]),n.push([l+4,["number",{value:o[0]}],0,0,[l+2]])):(n.push([l+3,["number",{value:1}],0,0,[l+2]]),n.push([l+4,["number",{value:e[1]}],0,0,[l+2]]))),n[l][4][1]=l+2,n[l][4][2]=l+1;var r=void 0,u=void 0,p=void 0;if("R"===e[0][0]||null==e[0][0])u=5===s||7===s?l+1:l,n.push([(p=l+(s-=2))+1,"rest2",0,0,[u,r=null]]),u+=s;else{for(var p=l+s,d=0;d<e[0].length;d++)0===d&&(u=5===s||7===s?l+1:l),a=isNaN(parseInt(e[0][d]))?(o=e[0][d].split(": "),getDrumName(e[0][d])):o=null,null===o?(r=this.lyricsON||1!==e[0].length&&d!==e[0].length-1?p+2:null,n.push([p,"hertz",0,0,[u,p+1,r]]),n.push([p+1,["number",{value:parseInt(e[0][d])}],0,0,[p]]),u=(p+=2)-2):null!=a?(r=this.lyricsON||1!==e[0].length&&d!==e[0].length-1?p+2:null,n.push([p,"playdrum",0,0,[u,p+1,r]]),n.push([p+1,["drumname",{value:a}],0,0,[p]]),u=(p+=2)-2):"http"===e[0][d].slice(0,4)?(r=this.lyricsON||1!==e[0].length&&d!==e[0].length-1?p+2:null,n.push([p,"playdrum",0,0,[u,p+1,r]]),n.push([p+1,["text",{value:e[0][d]}],0,0,[p]]),u=(p+=2)-2):2<o.length?(r=this.lyricsON||1!==e[0].length&&d!==e[0].length-1?p+3:null,n.push([p,o[0],0,0,[u,p+1,p+2,r]]),n.push([p+1,["number",{value:Number(o[1])}],0,0,[p]]),n.push([p+2,["number",{value:Number(o[2])}],0,0,[p]]),u=(p+=3)-3):1<o.length?(r=this.lyricsON||1!==e[0].length&&d!==e[0].length-1?p+2:null,n.push([p,o[0],0,0,[u,p+1,r]]),n.push([p+1,["number",{value:Number(o[1])}],0,0,[p]]),u=(p+=2)-2):(r=this.lyricsON||1!==e[0].length&&d!==e[0].length-1?p+3:null,u=("♯"===e[0][d][1]?isCustomTemperament(this.activity.logo.synth.inTemperament)?(n.push([p,"pitch",0,0,[u,p+1,p+2,r]]),n.push([p+1,["customNote",{value:e[0][d].substring(0,e[0][d].length-1)}],0,0,[p]]),n.push([p+2,["number",{value:e[0][d].slice(-1)}],0,0,[p]])):(n.push([p,"pitch",0,0,[u,p+1,p+2,r]]),n.push([p+1,["solfege",{value:SOLFEGECONVERSIONTABLE[e[0][d][0]+"♯"]}],0,0,[p]]),n.push([p+2,["number",{value:e[0][d][2]}],0,0,[p]])):"♭"===e[0][d][1]?isCustomTemperament(this.activity.logo.synth.inTemperament)?(n.push([p,"pitch",0,0,[u,p+1,p+2,r]]),n.push([p+1,["customNote",{value:e[0][d].substring(0,e[0][d].length-1)}],0,0,[p]]),n.push([p+2,["number",{value:e[0][d].slice(-1)}],0,0,[p]])):(n.push([p,"pitch",0,0,[u,p+1,p+2,r]]),n.push([p+1,["solfege",{value:SOLFEGECONVERSIONTABLE[e[0][d][0]+"♭"]}],0,0,[p]]),n.push([p+2,["number",{value:e[0][d][2]}],0,0,[p]])):(n.push([p,"pitch",0,0,[u,p+1,p+2,r]]),"custom"==this.activity.logo.synth.inTemperament?(n.push([p+1,["customNote",{value:e[0][d].substring(0,e[0][d].length-1)}],0,0,[p]]),n.push([p+2,["number",{value:e[0][d].slice(-1)}],0,0,[p]])):(n.push([p+1,["solfege",{value:SOLFEGECONVERSIONTABLE[e[0][d][0]]}],0,0,[p]]),n.push([p+2,["number",{value:e[0][d][1]}],0,0,[p]]))),p),p+=3);this.lyricsON&&(n.push([p,"print",0,0,[u,p+1,null]]),u=p,p+=1,this._lyrics[h]&&""!==this._lyrics?n.push([p,["text",{value:this._lyrics[h]}],0,0,[u]]):n.push([p,["text",{value:"..."}],0,0,[u]]))}}this.activity.blocks.loadNewBlocks(n),activity.textMsg(_("New action block generated."),3e3)}}])})();_defineProperty(PhraseMaker,"BUTTONDIVWIDTH",535),_defineProperty(PhraseMaker,"OUTERWINDOWWIDTH",758),_defineProperty(PhraseMaker,"INNERWINDOWWIDTH",630),_defineProperty(PhraseMaker,"BUTTONSIZE",53),_defineProperty(PhraseMaker,"ICONSIZE",24);
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var l=0;l<e.length;l++){var i=e[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,l){return e&&_defineProperties(t.prototype,e),l&&_defineProperties(t,l),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,l){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:l,enumerable:!0,configurable:!0,writable:!0}):t[e]=l,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var l=t[Symbol.toPrimitive];if(void 0===l)return("string"===e?String:Number)(t);l=l.call(t,e||"default");if("object"!=_typeof(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}var PitchDrumMatrix=(()=>{function p(){_classCallCheck(this,p),this.rowLabels=[],this.rowArgs=[],this.drums=[],this._rests=0,this._playing=!1,this._rowBlocks=[],this._colBlocks=[],this._blockMap=[]}return _createClass(p,[{key:"init",value:function(t){for(var e,l,i,o,n=this,s=(this.activity=t,window.innerWidth),r=(this._cellScale=s/1200,window.widgetWindows.windowFor(this,"pitch drum")),a=((this.widgetWindow=r).clear(),r.show(),this.playButton=r.addButton("play-button.svg",p.ICONSIZE,_("Play")),this.playButton.onclick=function(){n._playing=!n._playing,n.activity.logo.turtleDelay=0,n._playAll()},this._save_lock=!1,r.addButton("export-chunk.svg",p.ICONSIZE,_("Save")).onclick=function(){n._get_save_lock()||(n._save_lock=!0,n._save(),setTimeout(function(){n._save_lock=!1},1e3))},r.addButton("erase-button.svg",p.ICONSIZE,_("Clear")).onclick=function(){n._clear()},this.pitchDrumDiv=document.createElement("div"),r.getWidgetBody().append(this.pitchDrumDiv),r.getWidgetBody().style.height="400px",r.getWidgetBody().style.width="500px",this.pitchDrumDiv),c=(a.style.position="relative",a.style.visibility="invisible",a.style.border="0px",a.innerHTML="",r.onclose=function(){a.style.visibility="hidden",n.activity.hideMsgs(),r.destroy()},this.widgetWindow.onmaximize=this._scale,a.innerHTML='<div id="pdmOuterDiv"><div id="pdmInnerDiv"><table cellpadding="0px" id="pdmTable"></table></div></div>',docById("pdmTable")),d=0,h=0;h<this.rowLabels.length;h++)this.rowLabels[h].toLowerCase()===_("rest")?this._rests+=1:null!=(e=getDrumName(this.rowLabels[h]))?this.drums.push(e):((i=(l=c.insertRow()).insertCell()).style.backgroundColor=platformColor.labelColor,i.style.fontSize=100*this._cellScale+"%",i.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+1+"px",i.style.width=Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",i.style.minWidth=0,i.style.maxWidth=0,i.className="headcol",i.innerHTML=this.rowLabels[d]+this.rowArgs[d].toString().sub(),i.style.position="sticky",i.style.left="0",i.style.top="0",i.style.zIndex="5",(o=l.insertCell()).innerHTML='<table cellpadding="0px" id="pdmCellTable'+d+'"><tr></tr></table>',docById("pdmCellTable"+d).insertRow().setAttribute("id","pdm"+d),d+=1);(i=(l=c.insertRow()).insertCell()).style.backgroundColor=platformColor.labelColor,i.style.fontSize=100*this._cellScale+"%",i.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",i.style.width=Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",i.style.minWidth=Math.floor(MATRIXSOLFEWIDTH*this._cellScale)+"px",i.style.maxWidth=i.style.minWidth,i.className="headcol",i.innerHTML="",i.style.position="sticky",i.style.left="0",i.style.top="0",i.style.bottom="0",i.style.zIndex="20";var s=Math.max(Math.floor(.5*window.innerHeight/100),8),y=docById("pdmOuterDiv"),u=(y.style.height=r.getWidgetBody().style.height,y.style.width=r.getWidgetBody().style.width,c.rows.length+2>s?Math.max(Math.min(r.getWidgetBody().style.width,this._cellScale*(this.drums.length*(p.DRUMNAMEWIDTH+2)+MATRIXSOLFEWIDTH+24)),p.BUTTONDIVWIDTH):Math.max(Math.min(window.innerWidth/2,this._cellScale*(this.drums.length*(p.DRUMNAMEWIDTH+2)+MATRIXSOLFEWIDTH)),p.BUTTONDIVWIDTH),docById("pdmInnerDiv"));u.style.height=r.getWidgetBody().style.height,u.style.width=r.getWidgetBody().style.width,u.style.marginLeft="0px",(o=l.insertCell()).innerHTML='<table cellpadding="0px" id="pdmDrumTable"><tr></tr></table>',o.style.position="sticky",o.style.bottom="0",o.style.zIndex="10";for(var g=0;g<this.drums.length;g++)this._addDrum(g);r.onmaximize=function(){var t;r._maximized?(r.getWidgetBody().style.position="absolute",r.getWidgetBody().style.height="calc(-95px + 100vh)",r.getWidgetBody().style.width="calc(-55px + 100vw)",r.getWidgetBody().style.left="55px",y.style.height=r.getWidgetBody().style.height,y.style.width=r.getWidgetBody().style.width,u.style.height=r.getWidgetBody().style.height,u.style.width=r.getWidgetBody().style.width):(r.getWidgetBody().style.position="relative",r.getWidgetBody().style.left="0px",r.getWidgetBody().style.height="400px",r.getWidgetBody().style.width="500px",(t=docById("pdmInnerDiv")).style.height=r.getWidgetBody().style.height,t.style.width=r.getWidgetBody().style.width)},t.textMsg(_("Click in the grid to map notes to drums."),3e3)}},{key:"clearBlocks",value:function(){this._rowBlocks=[],this._colBlocks=[]}},{key:"addRowBlock",value:function(t){this._rowBlocks.push(t)}},{key:"addColBlock",value:function(t){this._colBlocks.push(t)}},{key:"addNode",value:function(t,e){for(var l,i=0;i<this._blockMap.length;i++)if((l=this._blockMap[i])[0]===t&&l[1]===e)return;this._blockMap.push([t,e])}},{key:"removeNode",value:function(t,e){for(var l,i=0;i<this._blockMap.length;i++)(l=this._blockMap[i])[0]===t&&l[1]===e&&(this._blockMap[i]=[-1,-1])}},{key:"_get_save_lock",value:function(){return this._save_lock}},{key:"_addButton",value:function(t,e,l,i){var o=t.insertCell(-1);return o.innerHTML='&nbsp;&nbsp;<img \n                src="header-icons/'.concat(e,'" \n                title="').concat(i,'" \n                alt="').concat(i,'" \n                height="').concat(l,'" \n                width="').concat(l,'" \n                vertical-align="middle" \n                align-content="center"\n            >&nbsp;&nbsp;'),o.style.width=p.BUTTONSIZE+"px",o.style.minWidth=o.style.width,o.style.maxWidth=o.style.width,o.style.height=o.style.width,o.style.minHeight=o.style.height,o.style.maxHeight=o.style.height,o.style.backgroundColor=platformColor.selectorBackground,o.onmouseover=function(){o.style.backgroundColor=platformColor.selectorBackgroundHOVER},o.onmouseout=function(){o.style.backgroundColor=platformColor.selectorBackground},o}},{key:"_addDrum",value:function(t){for(var e=this.drums[t],l=docById("pdmTable"),i=0;i<l.rows.length-1;i++)n=docById("pdmCellTable"+i).rows[0],(o=n.insertCell()).style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+1+"px",o.width=p.DRUMNAMEWIDTH,o.style.width=o.width,o.style.minWidth=o.style.width,o.style.maxWidth=o.style.width,o.style.backgroundColor=platformColor.selectorBackground,o.style.border="2px solid white",o.style.borderRadius="10px",o.onmouseover=function(){"black"!==o.style.backgroundColor&&(o.style.backgroundColor=platformColor.selectorSelected)},o.onmouseout=function(){"black"!==o.style.backgroundColor&&(o.style.backgroundColor=platformColor.selectorBackground)},o.setAttribute("id",i+","+t);var o,n=docById("pdmDrumTable").rows[0],s=((o=n.insertCell()).height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+1+"px",o.width=p.DRUMNAMEWIDTH,o.style.width=o.width,o.style.minWidth=o.style.width,o.style.maxWidth=o.style.width,o.style.height=Math.floor(1.5*MATRIXSOLFEHEIGHT*this._cellScale)+"px",o.style.fontSize=Math.floor(75*this._cellScale)+"%",o.style.lineHeight="100%",o.setAttribute("id",t),getDrumName(e));""===s&&(s=e),o.innerHTML='&nbsp;&nbsp;<img \n                src="'.concat(getDrumIcon(s),'" \n                title="').concat(s,'" \n                alt="').concat(s,'" \n                height="').concat(p.ICONSIZE,'" \n                width="').concat(p.ICONSIZE,'" \n                vertical-align="middle"\n            >&nbsp;&nbsp;'),o.style.backgroundColor=platformColor.selectorBackground}},{key:"makeClickable",value:function(){for(var t,e,l=this,i=docById("pdmTable"),o=docById("pdmDrumTable"),n=0;n<i.rows.length-1;n++)for(var s=docById("pdmCellTable"+n).rows[0],r=0;r<s.cells.length;r++)t=s.cells[r],o.rows[0].cells[r],t.onclick=function(t){var t=t.target,e=t.id.split(",");"black"===t.style.backgroundColor?(t.style.backgroundColor=platformColor.selectorBackground,l._setCellPitchDrum(e[1],e[0],!1)):(t.style.backgroundColor="black",l._setCellPitchDrum(e[1],e[0],!0))};for(var a=0;a<this._blockMap.length;a++)if(-1!==(e=this._blockMap[a])[0]){for(var c=this._rowBlocks.indexOf(e[0]),d=-1,h=0;h<this._colBlocks.length;h++)if(this._colBlocks[h]===e[1]){d=h;break}-1!==d&&null!=(t=(s=docById("pdmCellTable"+c).rows[0]).cells[d])&&(t.style.backgroundColor="black",this._setPairCell(c,d,t,!1))}}},{key:"_scale",value:function(){var t=this.getWidgetFrame().offsetHeight-this.getDragElement().offsetHeight,e=this.getWidgetBody(),t=this.isMaximized?t/e.offsetHeight:1,l=(e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.children[0].style.display="flex",e.children[0].style.flexDirection="column",e.children[0].style.alignItems="center",this.getWidgetBody().getElementsByTagName("svg")[0]);l.style.pointerEvents="none",l.setAttribute("height","".concat(400*t,"px")),l.setAttribute("width","".concat(400*t,"px")),setTimeout(function(){l.style.pointerEvents="auto"},100)}},{key:"_playAll",value:function(){var t=this,e=this.playButton;if(this._playing){e.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/stop-button.svg" \n                    title="'.concat(_("Stop"),'" \n                    alt="').concat(_("Stop"),'" \n                    height="').concat(p.ICONSIZE,'" \n                    width="').concat(p.ICONSIZE,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;'),this.activity.logo.synth.stop();for(var l=[],i=docById("pdmTable"),o=0;o<i.rows.length-1;o++){for(var n=docById("pdmCellTable"+o).rows[0],s=void 0,s=0;s<n.cells.length;s++)if("black"===n.cells[s].style.backgroundColor){l.push([o,s]);break}s===n.cells.length&&l.push([o,-1])}for(var r=!0,a=0;a<l.length;a++)if(-1!=l[a][1]){r=!1;break}r?(this.widgetWindow._maximized||activity.textMsg(_("Click in the grid to map notes to drums."),3e3),e.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="').concat(p.ICONSIZE,'" \n                    width="').concat(p.ICONSIZE,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;')):(0<l.length&&this._playPitchDrum(0,l),setTimeout(function(){t._playing=!1,e.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(p.ICONSIZE,'" \n                        width="').concat(p.ICONSIZE,'" \n                        vertical-align="middle" \n                        align-content="center"\n                    >&nbsp;&nbsp;')},1e3*l.length))}else e.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="').concat(p.ICONSIZE,'" \n                    width="').concat(p.ICONSIZE,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;'),this._playing=!1}},{key:"_playPitchDrum",value:function(t,e){var l=this,i=docById("pdmTable");if(this._playing){docById("pdmDrumTable").rows[0];var o=docById("pdmCellTable"+t).rows[0].cells[t];(i=docById("pdmTable")).rows[t].cells[0].style.backgroundColor=platformColor.selectorBackground,-1!==e[t][1]&&this._setPairCell(e[t][0],e[t][1],o,!0),t<e.length-1?setTimeout(function(){l._playPitchDrum(t+1,e)},1e3):setTimeout(function(){for(var t=0;t<i.rows.length-1;t++)i.rows[t].cells[0].style.backgroundColor=platformColor.labelColor},1e3)}else{for(var n=0;n<t;n++)i.rows[n].cells[0].style.backgroundColor=platformColor.labelColor;this.playButton.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="').concat(p.ICONSIZE,'" \n                    width="').concat(p.ICONSIZE,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;')}}},{key:"_setCellPitchDrum",value:function(t,e,l){var i,o,n,s=Number(t),r=Number(e),a=docById("pdmDrumTable").rows[0],a=docById("pdmCellTable"+r).rows[0];if(l)for(var c,d=0;d<a.cells.length;d++)d!==s&&"black"===(n=a.cells[d]).style.backgroundColor&&(i=this._rowBlocks[r],o=this._colBlocks[d],this.removeNode(i,o),n.style.backgroundColor=platformColor.selectorBackground,c=n.id.split(","),this._setCellPitchDrum(Number(c[0]),Number(c[1]),!1));i=this._rowBlocks[r],o=this._colBlocks[s],l?this.addNode(i,o):this.removeNode(i,o),a=docById("pdmCellTable"+r).rows[0];for(var h=0;h<a.cells.length;h++)"black"===(n=a.cells[h]).style.backgroundColor&&this._setPairCell(r,h,n,l)}},{key:"_setPairCell",value:function(t,e,l,i){var o=this,t=docById("pdmTable").rows[t].cells[0].innerHTML,e=docById("pdmDrumTable").rows[0].cells[e].innerHTML.split('"'),n=getDrumSynthName(e[3]),e=getNote(t,-1,0,this.activity.turtles.ithTurtle(0).singer.keySignature,!1,null,this.activity.errorMsg),t=e[0]+e[1];i&&(e=1e3*Singer.defaultBPMFactor*.25,this.activity.logo.synth.trigger(0,t.replace(/♭/g,"b").replace(/♯/g,"#"),.125,"default",null,null),setTimeout(function(){o.activity.logo.synth.trigger(0,"C2",.125,n,null,null)},e))}},{key:"_clear",value:function(){for(var t,e=docById("pdmTable"),l=0;l<e.rows.length-1;l++)for(var i=docById("pdmCellTable"+l).rows[0],o=0;o<i.cells.length;o++)"black"===(t=i.cells[o]).style.backgroundColor&&(t.style.backgroundColor=platformColor.selectorBackground,this._setCellPitchDrum(o,l,!1))}},{key:"_save",value:function(){for(var t in this.activity.blocks.palettes.dict)this.activity.blocks.palettes.dict[t].hideMenu(!0);this.activity.refreshCanvas();for(var e=[],l=docById("pdmTable"),i=docById("pdmDrumTable"),o=0;o<l.rows.length-1;o++)for(var n=docById("pdmCellTable"+o).rows[0],s=0;s<n.cells.length;s++)"black"===n.cells[s].style.backgroundColor&&e.push([o,s]);if(0!==e.length){for(var r,a,c,d,h,y,u,g,p,m=[[0,["action",{collapsed:!0}],100,100,[null,1,2,null]],[1,["text",{value:"drums"}],0,0,[0]]],b=0,f=0;f<e.length;f++)n=e[f][0],r=e[f][1],c=l.rows[n].cells[0].innerHTML,r=i.rows[0].cells[r].innerHTML.split('"'),r=getDrumSynthName(r[3]),a=(c=getNote(c,-1,0,this.activity.turtles.ithTurtle(0).singer.keySignature,!1,null,this.activity.errorMsg))[0],c=c[1],u=(d=m.length)+3,g=d+4,m.push([d,"mapdrum",0,0,[b,h=d+1,y=d+2,p=d+5]]),m.push([h,["drumname",{value:r}],0,0,[d]]),m.push([y,"pitch",0,0,[d,u,g,null]]),m.push([u,["solfege",{value:SOLFEGECONVERSIONTABLE[a]}],0,0,[y]]),m.push([g,["number",{value:c}],0,0,[y]]),m.push(f===e.length-1?[p,"hidden",0,0,[d,null]]:[p,"hidden",0,0,[d,p+1]]),b=p;this.activity.blocks.loadNewBlocks(m)}}}])})();_defineProperty(PitchDrumMatrix,"BUTTONDIVWIDTH",295),_defineProperty(PitchDrumMatrix,"DRUMNAMEWIDTH",50),_defineProperty(PitchDrumMatrix,"OUTERWINDOWWIDTH",128),_defineProperty(PitchDrumMatrix,"INNERWINDOWWIDTH",50),_defineProperty(PitchDrumMatrix,"BUTTONSIZE",53),_defineProperty(PitchDrumMatrix,"ICONSIZE",32);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var PitchSlider=(()=>{function c(){_classCallCheck(this,c),this._delta=0,this.sliders={},this._cellScale=0,this.isActive=!1,this.activeSlider=null}return _createClass(c,[{key:"init",value:function(i){var a=this;if(this.activity=i,!window.widgetWindows.openWindows.slider){this.frequencies&&this.frequencies.length||(this.frequencies=[392]);for(var s=[],e=0;e<this.frequencies.length;e++){var t=(new Tone.AMSynth).toDestination();s.push(t)}this._cellScale=1,this.widgetWindow=window.widgetWindows.windowFor(this,"pitch slider","slider",!0),this.isActive=!0,(i.logo.pitchSlider=this).widgetWindow.onclose=function(){document.removeEventListener("keydown",r,!0);for(var e=0,t=s;e<t.length;e++)t[e].triggerRelease();a.isActive=!1,i.logo.pitchSlider=null,a.widgetWindow.destroy()};var n,r=function(e){var t,i,n,r;return a.isActive&&("ArrowUp"===e.key||"ArrowDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key)?(e.preventDefault(),e.stopPropagation(),t=null!==a.activeSlider?a.activeSlider:0,a.sliders[t]&&(t=a.sliders[t],i=parseFloat(t.min),r=parseFloat(t.max),n=parseFloat(t.value),"ArrowUp"===e.key||"ArrowRight"===e.key?t.value=Math.min(n*c.SEMITONE,r):"ArrowDown"!==e.key&&"ArrowLeft"!==e.key||(t.value=Math.max(n/c.SEMITONE,i)),r=new Event("input",{bubbles:!0}),t.dispatchEvent(r)),!1):void 0};document.addEventListener("keydown",r,!0);for(n in this.frequencies)(e=>{function t(){a.frequencies[e]=parseFloat(a.sliders[e].value),s[e].frequency.linearRampToValueAtTime(a.frequencies[e],Tone.now()+.05),l.innerHTML="<label>".concat(a.frequencies[e],"</label>")}var i=document.createElement("div"),n=(a.widgetWindow._toolbar.appendChild(i),i.style.float="left",a.frequencies[e]/2),r=2*a.frequencies[e],o=a.widgetWindow.addRangeSlider(a.frequencies[e],i,n,r,"pitchSlider"),l=(0==e&&(a.activeSlider=e),o.addEventListener("mousedown",function(){a.activeSlider=e}),document.createElement("div"));l.className="wfbtItem",i.appendChild(l),l.innerHTML="<label>".concat(a.frequencies[e],"</label>"),(a.sliders[e]=o).oninput=function(){s[e].triggerAttack(a.frequencies[e]),t()},o.onchange=function(){s[e].triggerRelease()},a.widgetWindow.addButton("up.svg",c.ICONSIZE,_("Move up"),i).onclick=function(){o.value=Math.min(parseFloat(o.value)*c.SEMITONE,r),t(),s[e].triggerAttackRelease(a.frequencies[e],"4n")},a.widgetWindow.addButton("down.svg",c.ICONSIZE,_("Move down"),i).onclick=function(){o.value=Math.max(parseFloat(o.value)/c.SEMITONE,n),t(),s[e].triggerAttackRelease(a.frequencies[e],"4n")},a.widgetWindow.addButton("export-chunk.svg",c.ICONSIZE,_("Save"),i).onclick=function(){a._save(a.frequencies[e])}})(n);i.textMsg(_("Use the up/down buttons or arrow keys to change pitch."),3e3),i.textMsg(_("Click on the slider to create a note block."),3e3),setTimeout(this.widgetWindow.sendToCenter,0)}}},{key:"_save",value:function(e){for(var t in this.activity.blocks.palettes.dict)this.activity.blocks.palettes.dict[t].hideMenu(!0);this.activity.refreshCanvas();var i=[[0,"note",100+this._delta,100+this._delta,[null,1,2,null]],[1,["number",{value:8}],0,0,[0]]],n=(this._delta+=21,i.length),r=n+1,o=n+2;i.push([n,"hertz",0,0,[0,r,o]]),i.push([r,["number",{value:e}],0,0,[n]]),i.push([o,"hidden",0,0,[n,null]]),this.activity.blocks.loadNewBlocks(i)}}])})();_defineProperty(PitchSlider,"ICONSIZE",32),_defineProperty(PitchSlider,"SEMITONE",Math.pow(2,1/12)),"undefined"!=typeof module&&(module.exports=PitchSlider);
global._=function(e){return e};var mockOscillator={toDestination:jest.fn().mockReturnThis(),triggerRelease:jest.fn(),triggerAttack:jest.fn(),triggerAttackRelease:jest.fn(),frequency:{linearRampToValueAtTime:jest.fn()}},createMockElement=(global.Tone={AMSynth:jest.fn().mockImplementation(function(){return mockOscillator}),now:jest.fn().mockReturnValue(100)},function(e){return{tagName:e,style:{},appendChild:jest.fn(),innerHTML:"",addEventListener:jest.fn(),value:"440",dispatchEvent:jest.fn(),min:"0",max:"1000",className:""}}),createMockWidgetWindow=(global.document={createElement:jest.fn().mockImplementation(createMockElement),addEventListener:jest.fn(),removeEventListener:jest.fn()},function(){var i=[];return{_toolbar:{appendChild:jest.fn()},addRangeSlider:jest.fn().mockImplementation(function(){return{addEventListener:jest.fn(),style:{},value:"440",min:"110",max:"880",dispatchEvent:jest.fn()}}),addButton:jest.fn().mockImplementation(function(e,t,n,o){n={onclick:null,tip:n};return i.push(n),n}),getButtons:function(){return i},sendToCenter:jest.fn(),destroy:jest.fn(),onclose:null}}),PitchSlider=require("./pitchslider.js");describe("PitchSlider Widget",function(){var o,i;beforeEach(function(){jest.clearAllMocks(),global.window||(global.window={}),global.window.widgetWindows={openWindows:{},windowFor:jest.fn().mockImplementation(function(){return createMockWidgetWindow()})},global.window.btoa=jest.fn(function(e){return Buffer.from(e).toString("base64")}),global.document||(global.document={}),global.document.createElement=jest.fn().mockImplementation(createMockElement),global.document.addEventListener=jest.fn(),global.document.removeEventListener=jest.fn(),o={logo:{},textMsg:jest.fn(),refreshCanvas:jest.fn(),blocks:{palettes:{dict:{myPalette:{hideMenu:jest.fn()}}},loadNewBlocks:jest.fn()}},i=new PitchSlider}),describe("Static Properties",function(){test("ICONSIZE is 32",function(){expect(PitchSlider.ICONSIZE).toBe(32)}),test("SEMITONE is correct",function(){expect(PitchSlider.SEMITONE).toBeCloseTo(1.059463,6)})}),describe("Constructor",function(){test("initializes _delta to 0",function(){expect(i._delta).toBe(0)}),test("initializes empty sliders object",function(){expect(i.sliders).toEqual({})}),test("initializes _cellScale to 0",function(){expect(i._cellScale).toBe(0)}),test("initializes isActive to false",function(){expect(i.isActive).toBe(!1)}),test("initializes activeSlider to null",function(){expect(i.activeSlider).toBeNull()})}),describe("Initialization (init)",function(){test("returns early if slider window already open",function(){global.window.widgetWindows.openWindows.slider=!0,i.init(o),expect(Tone.AMSynth).not.toHaveBeenCalled(),global.window.widgetWindows.openWindows={}}),test("initializes frequencies to [392] if not set",function(){i.init(o),expect(i.frequencies).toEqual([392])}),test("preserves existing frequencies array",function(){i.frequencies=[440,880],i.init(o),expect(i.frequencies).toEqual([440,880])}),test("creates one oscillator per frequency",function(){i.frequencies=[440,880,220],i.init(o),expect(Tone.AMSynth).toHaveBeenCalledTimes(3)}),test("routes oscillators to destination",function(){i.init(o),expect(mockOscillator.toDestination).toHaveBeenCalled()}),test("sets _cellScale to 1.0",function(){i.init(o),expect(i._cellScale).toBe(1)}),test("registers widget window with correct parameters",function(){i.init(o),expect(window.widgetWindows.windowFor).toHaveBeenCalledWith(i,"pitch slider","slider",!0)}),test("sets isActive to true",function(){i.init(o),expect(i.isActive).toBe(!0)}),test("sets activity.logo.pitchSlider reference",function(){i.init(o),expect(o.logo.pitchSlider).toBe(i)}),test("registers keydown event listener",function(){i.init(o),expect(document.addEventListener).toHaveBeenCalledWith("keydown",expect.any(Function),!0)}),test("displays two help messages",function(){i.init(o),expect(o.textMsg).toHaveBeenCalledTimes(2),expect(o.textMsg).toHaveBeenCalledWith("Use the up/down buttons or arrow keys to change pitch.",3e3)}),test("sets activeSlider to 0 for first slider",function(){i.init(o),expect(i.activeSlider).toBe("0")})}),describe("Multiple Sliders",function(){test("creates separate slider for each frequency",function(){i.frequencies=[440,880],i.init(o),expect(i.widgetWindow.addRangeSlider).toHaveBeenCalledTimes(2)}),test("creates up/down/save buttons for each frequency",function(){i.frequencies=[440,880],i.init(o),expect(i.widgetWindow.addButton).toHaveBeenCalledTimes(6)}),test("each slider has correct min/max range",function(){i.frequencies=[440],i.init(o),expect(i.widgetWindow.addRangeSlider).toHaveBeenCalledWith(440,expect.anything(),220,880,"pitchSlider")})}),describe("Cleanup (onclose)",function(){beforeEach(function(){i.init(o)}),test("removes keydown event listener",function(){i.widgetWindow.onclose(),expect(document.removeEventListener).toHaveBeenCalledWith("keydown",expect.any(Function),!0)}),test("releases all oscillators",function(){i.widgetWindow.onclose(),expect(mockOscillator.triggerRelease).toHaveBeenCalled()}),test("sets isActive to false",function(){i.widgetWindow.onclose(),expect(i.isActive).toBe(!1)}),test("clears activity.logo.pitchSlider reference",function(){i.widgetWindow.onclose(),expect(o.logo.pitchSlider).toBeNull()}),test("destroys widget window",function(){i.widgetWindow.onclose(),expect(i.widgetWindow.destroy).toHaveBeenCalled()})}),describe("Key Handling",function(){var n,t;beforeEach(function(){i.init(o),n=document.addEventListener.mock.calls.find(function(e){return"keydown"===e[0]})[1],t={value:"440",min:"220",max:"880",dispatchEvent:jest.fn()},i.sliders[0]=t,i.activeSlider=0,i.isActive=!0}),test("ignores events when widget is inactive",function(){i.isActive=!1;var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(e.preventDefault).not.toHaveBeenCalled()}),test("ignores non-arrow keys",function(){var e={key:"Enter",preventDefault:jest.fn(),stopPropagation:jest.fn()},t=n(e);expect(e.preventDefault).not.toHaveBeenCalled(),expect(t).toBeUndefined()}),test("ArrowUp increases frequency by semitone",function(){var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440*PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)}),test("ArrowRight increases frequency by semitone",function(){var e={key:"ArrowRight",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440*PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)}),test("ArrowDown decreases frequency by semitone",function(){var e={key:"ArrowDown",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440/PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)}),test("ArrowLeft decreases frequency by semitone",function(){var e={key:"ArrowLeft",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440/PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)}),test("respects maximum frequency limit",function(){t.value="880";var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(parseFloat(t.value)).toBe(880)}),test("respects minimum frequency limit",function(){t.value="220";var e={key:"ArrowDown",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(parseFloat(t.value)).toBe(220)}),test("dispatches input event after value change",function(){var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(t.dispatchEvent).toHaveBeenCalled()}),test("prevents default browser behavior for arrow keys",function(){var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(e.preventDefault).toHaveBeenCalled(),expect(e.stopPropagation).toHaveBeenCalled()}),test("returns false to prevent event bubbling",function(){var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=n(e);expect(e).toBe(!1)}),test("uses slider 0 when activeSlider is null",function(){i.activeSlider=null;var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440*PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)})}),describe("UI Interaction",function(){beforeEach(function(){i.init(o)}),test("slider oninput triggers sound attack",function(){var e=i.sliders[0];e.value="500",e.oninput(),expect(mockOscillator.triggerAttack).toHaveBeenCalledWith(392)}),test("slider oninput ramps to new frequency",function(){var e=i.sliders[0];e.value="500",e.oninput(),expect(mockOscillator.frequency.linearRampToValueAtTime).toHaveBeenCalledWith(500,100.05)}),test("slider oninput updates frequency array",function(){var e=i.sliders[0];e.value="500",e.oninput(),expect(i.frequencies[0]).toBe(500)}),test("slider onchange releases oscillator",function(){i.sliders[0].onchange(),expect(mockOscillator.triggerRelease).toHaveBeenCalled()}),test("Move Up button increases frequency by semitone",function(){var e=i.sliders[0];e.value="440",i.frequencies[0]=440;i.widgetWindow.getButtons().find(function(e){return"Move up"===e.tip}).onclick();var t=440*PitchSlider.SEMITONE;expect(parseFloat(e.value)).toBeCloseTo(t,2)}),test("Move Up button plays note preview",function(){i.frequencies[0]=440,i.widgetWindow.getButtons().find(function(e){return"Move up"===e.tip}).onclick(),expect(mockOscillator.triggerAttackRelease).toHaveBeenCalledWith(expect.any(Number),"4n")}),test("Move Down button decreases frequency by semitone",function(){var e=i.sliders[0];e.value="440",i.frequencies[0]=440;i.widgetWindow.getButtons().find(function(e){return"Move down"===e.tip}).onclick();var t=440/PitchSlider.SEMITONE;expect(parseFloat(e.value)).toBeCloseTo(t,2)}),test("Save button passes current frequency to _save",function(){var e=jest.spyOn(i,"_save");i.frequencies[0]=500,i.widgetWindow.getButtons().find(function(e){return"Save"===e.tip}).onclick(),expect(e).toHaveBeenCalledWith(500)}),test("slider registers mousedown event listener",function(){expect(i.sliders[0]).toBeDefined(),expect(i.sliders[0].addEventListener).toHaveBeenCalledWith("mousedown",expect.any(Function))})}),describe("Block Generation (_save)",function(){beforeEach(function(){i.init(o)}),test("hides all palette menus",function(){i._save(440),expect(o.blocks.palettes.dict.myPalette.hideMenu).toHaveBeenCalledWith(!0)}),test("refreshes canvas after hiding menus",function(){i._save(440),expect(o.refreshCanvas).toHaveBeenCalled()}),test("creates 5-element block stack",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e).toHaveLength(5)}),test("first block is note block",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[0][1]).toBe("note")}),test("second block is number 8 (eighth note)",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[1][1]).toEqual(["number",{value:8}])}),test("third block is hertz block",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[2][1]).toBe("hertz")}),test("fourth block contains frequency value",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[3][1]).toEqual(["number",{value:440}])}),test("fifth block is hidden block",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[4][1]).toBe("hidden")}),test("uses different frequency values correctly",function(){i._save(523.25);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[3][1]).toEqual(["number",{value:523.25}])}),test("increments _delta by 21 for each save",function(){expect(i._delta).toBe(0),i._save(440),expect(i._delta).toBe(21),i._save(880),expect(i._delta).toBe(42)}),test("positions subsequent blocks with offset",function(){i._save(440),i._save(880);var e=o.blocks.loadNewBlocks.mock.calls[0][0],t=o.blocks.loadNewBlocks.mock.calls[1][0];expect(t[0][2]).toBe(e[0][2]+21)}),test("block connections are properly set",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[0][4]).toEqual([null,1,2,null]),expect(e[1][4]).toEqual([0]),expect(e[2][4]).toEqual([0,3,4])})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var PitchStaircase=(()=>{function n(){_classCallCheck(this,n),this.Stairs=[],this.stairPitchBlocks=[],this._stepTables=[],this._musicRatio1=null,this._musicRatio2=null}return _createClass(n,[{key:"_addButton",value:function(t,e,i,s){var r=t.insertCell(-1);return r.innerHTML='&nbsp;&nbsp;<img \n                src="header-icons/play-button.svg" \n                title="'.concat(s,'" \n                alt="').concat(s,'" \n                height="').concat(i,'" \n                width="').concat(i,'" \n                vertical-align="middle" \n                align-content="center"\n            >&nbsp;&nbsp;'),r.style.width=n.BUTTONSIZE+"px",r.style.minWidth=r.style.width,r.style.maxWidth=r.style.width,r.style.height=r.style.width,r.style.minHeight=r.style.height,r.style.maxHeight=r.style.height,r.style.backgroundColor=platformColor.selectorBackground,r.onmouseover=function(){r.style.backgroundColor=platformColor.selectorBackgroundHOVER},r.onmouseout=function(){r.style.backgroundColor=platformColor.selectorBackground},r}},{key:"_makeStairs",value:function(){for(var o=this,a=this._pscTable,l=(a.innerHTML="",a.style.textAlign="center",0);l<this.Stairs.length;l++)(()=>{var t=a.insertRow().insertCell(),e=document.createElement("table"),t=(o._stepTables[l]=e,t.append(e),e.insertRow()),e=o.Stairs[l][2],i=o._addButton(t,"play-button.svg",n.ICONSIZE,_("Play"));i.className="headcol",i.setAttribute("id",l),i.style.cursor="pointer",(t=t.insertCell()).setAttribute("id",e),t.style.width=n.INNERWINDOWWIDTH*parseFloat(n.DEFAULTFREQUENCY/e)*o._cellScale/3+"px",t.innerHTML="".concat(e.toFixed(2),"<br>").concat(o.Stairs[l][0]).concat(o.Stairs[l][1]),t.style.minWidth=t.style.width,t.style.maxWidth=t.style.width,t.style.height=n.BUTTONSIZE+"px",t.style.backgroundColor=platformColor.selectorBackground;var s=(e=Number(t.style.width.replace(/px/,""))).toString(),r=(e/55).toString(),e=(165/e).toString(),s="data:image/svg+xml;base64,"+window.btoa(base64Encode(SYNTHSVG.replace(/SVGWIDTH/g,s).replace(/XSCALE/g,r).replace(/STOKEWIDTH/g,e)));t.style.backgroundImage="url("+s+")",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="center center",t.addEventListener("click",function(t){o._dissectStair(t)}),i.onclick=function(){var t=i.getAttribute("id"),t=o._stepTables[t].rows[0].cells[1];o._playOne(t)}})()}},{key:"_undo",value:function(){var t;return 0!==this._history.length&&(t=this._history.pop(),this.Stairs.splice(t,1),this._refresh(),!0)}},{key:"_dissectStair",value:function(t){for(var e=this._musicRatio1.value,e=isNaN(e)?3:Math.abs(Math.floor(e)),i=(this._musicRatio1.value=e,this._musicRatio2.value),i=isNaN(i)?2:Math.abs(Math.floor(i)),s=(this._musicRatio2.value=i,parseFloat(i/e)),t=t.target,r=Number(t.getAttribute("id")),o=0;o<this.Stairs.length&&this.Stairs[o][2]!==r;o++);if(o!==this.Stairs.length){for(var a=frequencyToPitch(parseFloat(r)/s),l=!1,n=!1,c=!0,u=0;u<this.Stairs.length;u++){if(this.Stairs[u][2]<parseFloat(r)/s){this.Stairs.splice(u,0,[a[0],a[1],parseFloat(r)/s,this.Stairs[o][3]*parseFloat(i),this.Stairs[o][4]*parseFloat(e),this.Stairs[o][2],this.Stairs[o][6]]),l=!0;break}if(this.Stairs[u][2]===parseFloat(r)/s){this.Stairs.splice(u,1,[a[0],a[1],parseFloat(r)/s,this.Stairs[o][3]*parseFloat(i),this.Stairs[o][4]*parseFloat(e),this.Stairs[o][2],this.Stairs[o][6]]),c=!(n=l=!0);break}}l?n||this._history.push(u):(this.Stairs.push([a[0],a[1],parseFloat(r)/s,this.Stairs[o][3]*parseFloat(i),this.Stairs[o][4]*parseFloat(e),this.Stairs[o][2],this.Stairs[o][6]]),this._history.push(this.Stairs.length-1)),this._makeStairs(c)}}},{key:"_playOne",value:function(t){t.style.backgroundColor=platformColor.selectorBackground;var e=Number(t.getAttribute("id"));this.activity.logo.synth.trigger(0,e,1,DEFAULTVOICE,null,null),setTimeout(function(){t.style.backgroundColor=platformColor.selectorBackground},1e3)}},{key:"_playAll",value:function(){for(var e=this,t=[],i=0;i<this.Stairs.length;i++){var s=this.Stairs[i][0]+this.Stairs[i][1];t.push(s.replace(/♭/g,"b").replace(/♯/g,"#")),this._stepTables[i].rows[0].cells[1].style.backgroundColor=platformColor.selectorBackground,this.activity.logo.synth.trigger(0,t,1,DEFAULTVOICE,null,null)}setTimeout(function(){for(var t=0;t<e.Stairs.length;t++)e._stepTables[t].rows[0].cells[1].style.backgroundColor=platformColor.selectorBackground},1e3)}},{key:"playUpAndDown",value:function(){var t=[],e=this.Stairs[this.Stairs.length-1][0]+this.Stairs[this.Stairs.length-1][1],e=(t.push(e.replace(/♭/g,"b").replace(/♯/g,"#")),this.Stairs.length-1);this._stepTables[e].rows[0].cells[1].style.backgroundColor=platformColor.selectorBackground,this.activity.logo.synth.trigger(0,t,1,DEFAULTVOICE,null,null),this._playNext(this.Stairs.length-2,-1)}},{key:"_playNext",value:function(t,e){var i,s,r,o=this;this.closed||(t===this.Stairs.length?setTimeout(function(){for(var t=0;t<o.Stairs.length;t++)o._stepTables[t].rows[0].cells[1].style.backgroundColor=platformColor.selectorBackground},1e3):-1===t?(setTimeout(function(){for(var t=0;t<o.Stairs.length;t++)o._stepTables[t].rows[0].cells[1].style.backgroundColor=platformColor.selectorBackground},1e3),setTimeout(function(){o._playNext(0,1)},200)):(i=[],s=this.Stairs[t][0]+this.Stairs[t][1],i.push(s.replace(/♭/g,"b").replace(/♯/g,"#")),r=this._stepTables[t-e],setTimeout(function(){null!=r&&(r.rows[0].cells[1].style.backgroundColor=platformColor.selectorBackground),o._stepTables[t].rows[0].cells[1].style.backgroundColor=platformColor.selectorBackground,o.activity.logo.synth.trigger(0,i,1,DEFAULTVOICE,null,null),(t<o.Stairs.length||-1<t)&&o._playNext(t+e,e)},1e3)))}},{key:"_save",value:function(){for(var t in this.activity.palettes.dict)this.activity.palettes.dict[t].hideMenu(!0);this.activity.refreshCanvas();for(var e=[[0,["action",{collapsed:!0}],100,100,[null,1,2,null]],[1,["text",{value:"stair"}],0,0,[0]]],i=0,s=0;s<this.Stairs.length;s++){var r,o,a,l,n,c=this.Stairs[s][2],c=frequencyToPitch(c),u=void 0,h=void 0,p=void 0;0===c[2]?(p="hidden",e.push([u=l=e.length,"pitch",0,0,[i,o=l+1,a=l+2,h=l+3]]),e.push([o,["notename",{value:c[0]}],0,0,[l]]),e.push([a,["number",{value:c[1]}],0,0,[l]])):(o=(u=e.length)+2,a=u+3,c=u+4,l=u+5,h=u+7,p="vspace",e.push([u,"hertz",0,0,[i,r=u+1,n=u+6]]),e.push([r,"multiply",0,0,[u,o,a]]),e.push([o,["number",{value:this.Stairs[s][6].toFixed(2)}],0,0,[r]]),e.push([a,"divide",0,0,[r,c,l]]),e.push([c,["number",{value:this.Stairs[s][4]}],0,0,[a]]),e.push([l,["number",{value:this.Stairs[s][3]}],0,0,[a]]),e.push([n,"vspace",0,0,[u,h]]),u=n),s===this.Stairs.length-1?e.push([h,p,0,0,[u,null]]):e.push([h,p,0,0,[u,h+1]]),i=h}this.activity.blocks.loadNewBlocks(e),activity.textMsg(_("New action block generated."),3e3)}},{key:"_get_save_lock",value:function(){return this._save_lock}},{key:"init",value:function(t){var e=this;this.activity=t;for(var i=0;i<this.Stairs.length;i++)this.Stairs[i].push(this.Stairs[i][2]),this.Stairs[i].push(this.Stairs[i][2]);this._history=[];var s=window.innerWidth,r=(this._cellScale=s/1200,window.widgetWindows.windowFor(this,"pitch staircase","pitch staircase",!0)),o=((this.widgetWindow=r).clear(),r.show(),r.onclose=function(){e.activity.logo.synth.setMasterVolume(0),e.closed=!0,r.destroy()},this.closed=!1,r.addButton("play-chord.svg",n.ICONSIZE,_("Play chord")).onclick=function(){e._playAll()},r.addButton("play-scale.svg",n.ICONSIZE,_("Play scale")).onclick=function(){e.playUpAndDown()},this._save_lock=!1,r.addButton("export-chunk.svg",n.ICONSIZE,_("Save")).onclick=function(){e._get_save_lock()||(e._save_lock=!0,e._save(),setTimeout(function(){e._save_lock=!1},1e3))},document.getElementsByClassName("wfbWidget")[0]);o.style.maxHeight=10*n.BUTTONSIZE+"px",o.style.overflowY="scroll",this._musicRatio1=r.addInputButton("3"),r.addDivider(),this._musicRatio2=r.addInputButton("2"),r.addButton("restore-button.svg",n.ICONSIZE,_("Undo")).onclick=function(){e._undo()},r.addButton("erase-button.svg",n.ICONSIZE,_("Clear")).onclick=function(){for(;e._undo(););},this._pscTable=document.createElement("table"),r.getWidgetBody().append(this._pscTable),this._refresh(),t.textMsg(_("Click on a note to create a new step."),3e3),r.onmaximize=function(){r._maximized?o.style.maxHeight=16*n.BUTTONSIZE+"px":o.style.maxHeight=10*n.BUTTONSIZE+"px"}}},{key:"_refresh",value:function(){this._makeStairs(!0)}}])})();_defineProperty(PitchStaircase,"BUTTONDIVWIDTH",476),_defineProperty(PitchStaircase,"OUTERWINDOWWIDTH",685),_defineProperty(PitchStaircase,"INNERWINDOWWIDTH",600),_defineProperty(PitchStaircase,"BUTTONSIZE",53),_defineProperty(PitchStaircase,"ICONSIZE",32),_defineProperty(PitchStaircase,"DEFAULTFREQUENCY",220);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var y,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,i,a,s,c,h,l,u,p,t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,i=n,l=r||[],u=!1,p={p:h=0,n:0,v:y,a:d,f:d.bind(y,4),d:function(e,t){return a=e,s=0,c=y,p.n=t,g}},function(e,t,n){if(1<h)throw TypeError("Generator is already running");for(u&&1===t&&d(t,n),s=t,c=n;(m=s<2?y:c)||!u;){a||(s?s<3?(1<s&&(p.n=-1),d(s,c)):p.n=c:p.v=c);try{if(h=2,a){if(m=a[e=s?e:"next"]){if(!(m=m.call(a,c)))throw TypeError("iterator result is not an object");if(!m.done)return m;c=m.value,s<2&&(s=0)}else 1===s&&(m=a.return)&&m.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),s=1);a=y}else if((m=(u=p.n<0)?c:o.call(i,p))!==g)break}catch(e){a=y,s=1,c=e}finally{h=1}}return{value:m,done:u}}),!0),t;function d(e,t){for(s=e,c=t,m=0;!u&&h&&!n&&m<l.length;m++){var n,r=l[m],o=p.p,i=r[2];3<e?(n=i===t)&&(c=r[(s=r[4])?5:s=3],r[4]=r[5]=y):r[0]<=o&&((n=e<2&&o<r[1])?(s=0,p.v=t,p.n=r[1]):o<i&&(n=e<3||r[0]>t||i<t)&&(r[4]=e,r[5]=t,p.n=i,s=0))}if(n||1<e)return g;throw u=!0,t}}var g={};function f(){}function o(){}function i(){}var m=Object.getPrototypeOf,e=[][t]?m(m([][t]())):(_regeneratorDefine2(m={},t,function(){return this}),m),a=i.prototype=f.prototype=Object.create(e);function s(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",o.prototype=i),_regeneratorDefine2(i,"constructor",o),_regeneratorDefine2(i,n,o.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,n,"Generator"),_regeneratorDefine2(a,t,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:s}})()}function _regeneratorDefine2(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function _asyncToGenerator(s){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=s.apply(e,a);function o(e){asyncGeneratorStep(r,t,n,o,i,"next",e)}function i(e){asyncGeneratorStep(r,t,n,o,i,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var ReflectionMatrix=(()=>{function o(){_classCallCheck(this,o),this.chatHistory=[],this.AImentor="meta",this.mentorsMap={user:"YOU",meta:"ROHAN",music:"BEETHOVEN",code:"ALAN"},this.triggerFirst=!1,this.projectAlgorithm="",this.code=""}return _createClass(o,[{key:"init",value:function(e){var t=this,n=(this.activity=e,this.isOpen=!0,this.isMaximized=!1,this.activity.isInputON=!0,this.PORT="http://3.105.177.138:8000",window.widgetWindows.windowFor(this,"reflection","reflection")),r=((this.widgetWindow=n).clear(),n.show(),n.getWidgetBody().style.height=o.OUTERWINDOWHEIGHT,n.getWidgetBody().style.width=o.OUTERWINDOWWIDTH,n.onclose=function(){t.isOpen=!1,t.activity.isInputON=!1,t.dotsInterval&&clearInterval(t.dotsInterval),n.destroy()},this.summary=this.readReport()||"No reports available",this.chatInterface=document.createElement("div"),this.chatInterface.className="chatInterface",n.getWidgetBody().append(this.chatInterface),this.summaryButton=n.addButton("notes_icon.svg",o.ICONSIZE,_("Summary")),this.summaryButton.onclick=function(){return t.getAnalysis()},this.chatHistory.length<10&&(this.summaryButton.style.background="gray"),n.addButton("save-button-dark.svg",o.ICONSIZE,_("Save")).onclick=function(){return t.downloadAsTxt(t.chatHistory)},this.metaButton=n.addButton("general_mentor.svg",o.ICONSIZE,_("Talk with Rohan")),this.metaButton.onclick=function(){return t.changeMentor("meta")},this.codeButton=n.addButton("code.svg",o.ICONSIZE,_("Talk with Alan")),this.codeButton.onclick=function(){return t.changeMentor("code")},this.musicButton=n.addButton("music.svg",o.ICONSIZE,_("Talk with Beethoven")),this.musicButton.onclick=function(){return t.changeMentor("music")},this.reloadButton=n.addButton("reload.svg",o.ICONSIZE,_("Refresh")),this.reloadButton.onclick=function(){return t.updateProjectCode()},this.changeMentor(this.AImentor),this.chatLog=document.createElement("div"),this.chatLog.className="chatLog",this.chatInterface.appendChild(this.chatLog),this.inputContainer=document.createElement("div"),this.inputContainer.className="inputContainer",this.inputContainer.style.paddingBottom="10px",0<this.chatHistory.length?this.inputContainer.style.display="flex":this.inputContainer.style.display="none",this.input=document.createElement("input"),this.input.className="input-query",this.input.placeholder="Type a message",this.input.style.marginLeft="10px",this.inputContainer.appendChild(this.input),this.input.onkeydown=function(e){"Enter"===e.key&&t.sendMessage()},document.createElement("button"));r.className="confirm-button",r.style.marginRight="10px",r.innerText="Send",r.onclick=function(){return t.sendMessage()},this.inputContainer.appendChild(r),this.chatInterface.appendChild(this.inputContainer),0<this.chatHistory.length?this.renderChatHistory():this.startChatSession(),e.textMsg(_("Reflect on your project."),3e3)}},{key:"showTypingIndicator",value:function(e){var t,n,r=this;this.typingDiv||(this.typingDiv=document.createElement("div"),this.typingDiv.className="typing-indicator",(t=document.createElement("span")).textContent=e||"Thinking",this.typingDiv.appendChild(t),this.dotsContainer=document.createElement("span"),this.typingDiv.appendChild(this.dotsContainer),this.chatLog.appendChild(this.typingDiv),this.chatLog.scrollTop=this.chatLog.scrollHeight,n=0,this.dotsInterval=setInterval(function(){n=(n+1)%4,r.dotsContainer.textContent=".".repeat(n)},500))}},{key:"hideTypingIndicator",value:function(){this.typingDiv&&(clearInterval(this.dotsInterval),this.typingDiv.remove(),this.typingDiv=null)}},{key:"changeMentor",value:function(e){"meta"===(this.AImentor=e)?this.metaButton.style.background="orange":this.metaButton.style.removeProperty("background"),"code"===e?this.codeButton.style.background="orange":this.codeButton.style.removeProperty("background"),"music"===e?this.musicButton.style.background="orange":this.musicButton.style.removeProperty("background")}},{key:"startChatSession",value:(c=_asyncToGenerator(_regenerator().m(function e(){var t,n,r=this;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(1==this.triggerFirst)return e.a(2);e.n=1;break;case 1:return this.triggerFirst=!0,setTimeout(function(){r.showTypingIndicator("Reading code")},1e3),e.n=2,this.activity.prepareExport();case 2:return t=e.v,e.n=3,this.generateAlgorithm(t);case 3:n=e.v,this.hideTypingIndicator(),n&&!n.error?(this.inputContainer.style.display="flex",this.botReplyDiv(n,!1,!1),this.projectAlgorithm=n.algorithm,this.code=t):this.activity.errorMsg(_(n.error),3e3);case 4:return e.a(2)}},e,this)})),function(){return c.apply(this,arguments)})},{key:"updateProjectCode",value:(s=_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.activity.prepareExport();case 1:if((t=e.v)===this.code)return console.log("No changes in code detected."),e.a(2);e.n=2;break;case 2:return this.showTypingIndicator("Reading code"),e.n=3,this.generateNewAlgorithm(t);case 3:n=e.v,this.hideTypingIndicator(),n&&!n.error?("unchanged"!==n.algorithm?(this.projectAlgorithm=n.algorithm,this.code=t):console.log("No changes in algorithm detected."),this.botReplyDiv(n,!1,!1)):this.activity.errorMsg(_(n.error),3e3),this.projectAlgorithm=n.algorithm;case 4:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"generateAlgorithm",value:(a=_asyncToGenerator(_regenerator().m(function e(t){var n,r;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(this.PORT,"/projectcode"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})});case 1:return n=e.v,e.n=2,n.json();case 2:return n=e.v,e.a(2,n);case 3:return e.p=3,r=e.v,console.error("Error :",r),e.a(2,{error:"Failed to send message"})}},e,this,[[0,3]])})),function(e){return a.apply(this,arguments)})},{key:"generateNewAlgorithm",value:(r=_asyncToGenerator(_regenerator().m(function e(t){var n,r;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(this.PORT,"/updatecode"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldcode:this.code,newcode:t})});case 1:return n=e.v,e.n=2,n.json();case 2:return n=e.v,e.a(2,n);case 3:return e.p=3,r=e.v,console.error("Error :",r),e.a(2,{error:"Failed to send message"})}},e,this,[[0,3]])})),function(e){return r.apply(this,arguments)})},{key:"generateBotReply",value:(i=_asyncToGenerator(_regenerator().m(function e(t,n,r,o){var i,a;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.showTypingIndicator(),e.n=1,fetch("".concat(this.PORT,"/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,messages:n,mentor:r,algorithm:o})});case 1:return i=e.v,this.hideTypingIndicator(),e.n=2,i.json();case 2:return i=e.v,e.a(2,i);case 3:return e.p=3,a=e.v,console.error("Error :",a),e.a(2,{error:"Failed to send message"})}},e,this,[[0,3]])})),function(e,t,n,r){return i.apply(this,arguments)})},{key:"getAnalysis",value:(n=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(this.chatHistory.length<10)return e.a(2);e.n=1;break;case 1:return this.showTypingIndicator("Analyzing"),e.n=2,this.generateAnalysis();case 2:return t=e.v,this.hideTypingIndicator(),t&&this.botReplyDiv(t,!1,!0),e.n=3,this.saveReport(t);case 3:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"generateAnalysis",value:(e=_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("Summary stored",this.summary),e.n=1,fetch("".concat(this.PORT,"/analysis"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:this.chatHistory,summary:this.summary})});case 1:return t=e.v,e.n=2,t.json();case 2:return t=e.v,e.a(2,t);case 3:return e.p=3,n=e.v,console.error("Error :",n),e.a(2,{error:"Failed to send message"})}},e,this,[[0,3]])})),function(){return e.apply(this,arguments)})},{key:"botReplyDiv",value:(t=_asyncToGenerator(_regenerator().m(function e(t){var n,r,o,i,a,s=arguments;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(n=2<s.length&&void 0!==s[2]&&s[2],!0!==(!(1<s.length&&void 0!==s[1])||s[1]))e.n=3;else{if(this.typingDiv)return e.a(2);e.n=1}break;case 1:return e.n=2,this.generateBotReply(t,this.chatHistory,this.AImentor,this.projectAlgorithm);case 2:r=e.v,e.n=4;break;case 3:r=t;case 4:if(r.error)return this.hideTypingIndicator(),this.activity.errorMsg(_("Failed to send message"),3e3),e.a(2);e.n=5;break;case 5:this.chatHistory.push({role:this.AImentor,content:r.response}),10<this.chatHistory.length&&this.summaryButton.style.removeProperty("background"),(o=document.createElement("div")).className="message-container",(i=document.createElement("div")).style.fontSize="12px",i.style.fontWeight="bold",i.style.marginBottom="4px",i.style.color="#383838ff",i.style.alignSelf="flex-start",i.innerText=this.mentorsMap[this.AImentor],a=document.createElement("div"),n?a.innerHTML=this.mdToHTML(r.response):a.innerText=r.response,o.appendChild(i),o.appendChild(a),this.chatLog.appendChild(o),this.chatLog.scrollTop=this.chatLog.scrollHeight;case 6:return e.a(2)}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"sendMessage",value:function(){var e,t,n,r=this.input.value.trim();""!==r&&(this.chatHistory.push({role:"user",content:r}),(e=document.createElement("div")).classList.add("message-container","user"),(t=document.createElement("div")).style.fontSize="12px",t.style.fontWeight="bold",t.style.marginBottom="4px",t.style.color="#555",t.style.overflowWrap="break-word",t.style.alignSelf="flex-start",t.innerText="You",(n=document.createElement("div")).innerText=r,e.appendChild(t),e.appendChild(n),this.chatLog.appendChild(e),this.input.value="",this.botReplyDiv(r),this.chatLog.scrollTop=this.chatLog.scrollHeight)}},{key:"renderChatHistory",value:function(){var o=this;this.chatLog.innerHTML="",this.chatHistory.forEach(function(e){var t=document.createElement("div"),n=(t.className="message-container",document.createElement("div")),r=(n.style.fontSize="12px",n.style.fontWeight="bold",n.style.marginBottom="4px",n.style.color="#555",n.style.overflowWrap="break-word",n.style.alignSelf="flex-start",document.createElement("div"));r.innerText=e.content,t.appendChild(n),t.appendChild(r),"user"===e.role&&t.classList.add("user"),n.innerText=o.mentorsMap[e.role],o.chatLog.appendChild(t)}),this.chatLog.scrollTop=this.chatLog.scrollHeight}},{key:"saveReport",value:function(e){try{localStorage.setItem("musicblocks_analysis",e.response)}catch(e){console.warn("Could not save analysis report to localStorage:",e)}console.log("Conversation saved in localStorage.")}},{key:"readReport",value:function(){return localStorage.getItem("musicblocks_analysis")}},{key:"downloadAsTxt",value:function(e){var t,n=this;0===e.length?this.activity.errorMsg(_("No conversation to save."),2e3):(e=e.map(function(e){return"".concat(n.mentorsMap[e.role]||e.role.toUpperCase(),": ").concat(e.content)}).join("\n\n"),e=new Blob([e],{type:"text/plain"}),e=URL.createObjectURL(e),(t=document.createElement("a")).href=e,t.download="conversation.txt",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e))}},{key:"mdToHTML",value:function(e){return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/^###### (.*$)/gim,"<h6>$1</h6>")).replace(/^##### (.*$)/gim,"<h5>$1</h5>")).replace(/^#### (.*$)/gim,"<h4>$1</h4>")).replace(/^### (.*$)/gim,"<h3>$1</h3>")).replace(/^## (.*$)/gim,"<h2>$1</h2>")).replace(/^# (.*$)/gim,"<h1>$1</h1>")).replace(/\*\*(.*?)\*\*/gim,"<b>$1</b>")).replace(/\*(.*?)\*/gim,"<i>$1</i>")).replace(/\[(.*?)\]\((.*?)\)/gim,"<a href='$2' target='_blank'>$1</a>")).replace(/\n/gim,"<br>")).trim()}}]);var t,e,n,i,r,a,s,c})();_defineProperty(ReflectionMatrix,"BUTTONDIVWIDTH",535),_defineProperty(ReflectionMatrix,"OUTERWINDOWWIDTH","858px"),_defineProperty(ReflectionMatrix,"OUTERWINDOWHEIGHT","550px"),_defineProperty(ReflectionMatrix,"INNERWINDOWWIDTH",730),_defineProperty(ReflectionMatrix,"BUTTONSIZE",53),_defineProperty(ReflectionMatrix,"ICONSIZE",32);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var _,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",i=e.toStringTag||"@@toStringTag";function l(e,t,i,l){var s,r,n,a,o,u,h,c,d,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(s=e,r=i,h=l||[],c=!1,d={p:u=0,n:0,v:_,a:p,f:p.bind(_,4),d:function(e,t){return n=e,a=0,o=_,d.n=t,y}},function(e,t,i){if(1<u)throw TypeError("Generator is already running");for(c&&1===t&&p(t,i),a=t,o=i;(v=a<2?_:o)||!c;){n||(a?a<3?(1<a&&(d.n=-1),p(a,o)):d.n=o:d.v=o);try{if(u=2,n){if(v=n[e=a?e:"next"]){if(!(v=v.call(n,o)))throw TypeError("iterator result is not an object");if(!v.done)return v;o=v.value,a<2&&(a=0)}else 1===a&&(v=n.return)&&v.call(n),a<2&&(o=TypeError("The iterator does not provide a '"+e+"' method"),a=1);n=_}else if((v=(c=d.n<0)?o:s.call(r,d))!==y)break}catch(e){n=_,a=1,o=e}finally{u=1}}return{value:v,done:c}}),!0),t;function p(e,t){for(a=e,o=t,v=0;!c&&u&&!i&&v<h.length;v++){var i,l=h[v],s=d.p,r=l[2];3<e?(i=r===t)&&(o=l[(a=l[4])?5:a=3],l[4]=l[5]=_):l[0]<=s&&((i=e<2&&s<l[1])?(a=0,d.v=t,d.n=l[1]):s<r&&(i=e<3||l[0]>t||r<t)&&(l[4]=e,l[5]=t,d.n=r,a=0))}if(i||1<e)return y;throw c=!0,t}}var y={};function g(){}function s(){}function r(){}var v=Object.getPrototypeOf,e=[][t]?v(v([][t]())):(_regeneratorDefine2(v={},t,function(){return this}),v),n=r.prototype=g.prototype=Object.create(e);function a(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,r):(e.__proto__=r,_regeneratorDefine2(e,i,"GeneratorFunction")),e.prototype=Object.create(n),e}return _regeneratorDefine2(n,"constructor",s.prototype=r),_regeneratorDefine2(r,"constructor",s),_regeneratorDefine2(r,i,s.displayName="GeneratorFunction"),_regeneratorDefine2(n),_regeneratorDefine2(n,i,"Generator"),_regeneratorDefine2(n,t,function(){return this}),_regeneratorDefine2(n,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:l,m:a}})()}function _regeneratorDefine2(e,t,i,l){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}(_regeneratorDefine2=function(e,t,i,l){function s(t,i){_regeneratorDefine2(e,t,function(e){return this._invoke(t,i,e)})}t?r?r(e,t,{value:i,enumerable:!l,configurable:!l,writable:!l}):e[t]=i:(s("next",0),s("throw",1),s("return",2))})(e,t,i,l)}function asyncGeneratorStep(e,t,i,l,s,r,n){try{var a=e[r](n),o=a.value}catch(e){return void i(e)}a.done?t(o):Promise.resolve(o).then(l,s)}function _asyncToGenerator(a){return function(){var e=this,n=arguments;return new Promise(function(t,i){var l=a.apply(e,n);function s(e){asyncGeneratorStep(l,t,i,s,r,"next",e)}function r(e){asyncGeneratorStep(l,t,i,s,r,"throw",e)}s(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var l=t[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var RhythmRuler=(()=>{function T(){_classCallCheck(this,T),this.Drums=[],this.Rulers=[],this._dissectHistory=[],this._undoList=[],this._playing=!1,this._playingOne=!1,this._playingAll=!1,this._cellCounter=0,this._elapsedTimes=[],this._startingTime=null,this._offsets=[],this._rulerSelected=0,this._rulerPlaying=-1,this._tapMode=!1,this._tapTimes=[],this._tapCell=null,this._tapEndTime=null,this._longPressStartTime=null,this._inLongPress=!1,this._mouseDownCell=null,this._mouseUpCell=null,this._wheel=null,this._dissectNumber=null,this._progressBar=null,this._rulers=[],this._fullscreenScaleFactor=3}return _createClass(T,[{key:"init",value:function(e){var h=this;this.activity=e,this._bpmFactor=1e3*TONEBPM/Singer.masterBPM,this._playing=!1,this._playingOne=!1,this._playingAll=!1,this._rulerPlaying=-1,this._startingTime=null,this._expanded=!1,0===this.Drums.length&&(this.Drums.push(null),this.Rulers.push([[1],[]])),this._elapsedTimes=[],this._offsets=[];for(var t=0;t<this.Rulers.length;t++)this._elapsedTimes.push(0),this._offsets.push(0);this._cellScale=1;for(var i,c=T.ICONSIZE,l=window.widgetWindows.windowFor(this,"rhythm maker"),d=((this.widgetWindow=l).clear(),l.show(),l.onclose=function(){h._playing&&h.__pause();for(var e=[],t=[],i=0;i<h.Rulers.length;i++)if(null!==h.Drums[i]){for(var l=[],s=0;s<h.Rulers[i][1].length;s++)l.push(h.Rulers[i][1][s]);h._dissectNumber.classList.add("hasKeyboard"),e.push([l,h.Drums[i]]),t.push(h.Drums[i])}for(var r=0;r<h._dissectHistory.length;r++){var n,a=h._dissectHistory[r][1];t.includes(a)||(n=JSON.parse(JSON.stringify(h._dissectHistory[r][0])),e.push([n,a]))}h._dissectHistory=JSON.parse(JSON.stringify(e)),h._playing=!1,h._playingOne=!1,h._playingAll=!1,h.activity.hideMsgs(),h.widgetWindow.destroy()},this.widgetWindow.onmaximize=this._scale.bind(this),this._playAllCell=l.addButton("play-button.svg",c,_("Play all")),this._playAllCell.onclick=function(){h._playing?h.__pause():h._playingAll||h.__resume()},this._save_lock=!1,l.addButton("export-chunk.svg",c,_("Save rhythms")).onclick=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(h._get_save_lock()){e.n=2;break}return h._save_lock=!0,h._saveTupletsMerged(h._mergeRulers()),e.n=1,delayExecution(1e3);case 1:h._save_lock=!1;case 2:return e.a(2)}},e)})),l.addButton("export-drums.svg",c,_("Save drum machine")).onclick=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(h._get_save_lock()){e.n=2;break}return h._save_lock=!0,h._saveMachine(0),e.n=1,delayExecution(1e3);case 1:h._save_lock=!1;case 2:return e.a(2)}},e)})),this._dissectNumber=l.addInputButton("2"),this._dissectNumber.readOnly=!1,this._dissectNumber.classList.add("hasKeyboard"),this._dissectNumber.style.cursor="text",this._dissectNumber.addEventListener("keydown",function(e){13!==e.keyCode&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),e=parseInt(h._dissectNumber.value),!isNaN(e)&&0<e&&(e=Math.min(Math.max(e,2),128),h._dissectNumber.value=e),h._dissectNumber.blur())}),this._dissectNumber.onclick=function(){h._showDissectNumberPieMenu()},l.addButton("restore-button.svg",c,_("Undo")).onclick=function(){h._undo()},this._tapButton=l.addButton("tap-button.svg",c,_("Tap a rhythm")),this._tapButton.onclick=function(){h._tap()},l.addButton("erase-button.svg",c,_("Clear")).onclick=function(){h._clear()},document.createElement("table")),p=(l.getWidgetBody().append(d),0),y=0;y<this.Rulers.length;y++)(()=>{var e,t=d.insertRow();if(beginnerMode){for(var i=0,l=0;l<h.Rulers[y][0].length;l++)i+=580/h.Rulers[y][0][l];p<i&&(d.style.width=i+"px",p=i)}else{var s=t.insertCell();s.innerHTML='<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(c,'" \n                        width="').concat(c,'" \n                    />'),s.className="headcol",s.style.cursor="pointer",s.onclick=(e=y,function(){h._playing?h._rulerPlaying===e&&(s.innerHTML='<img \n                                        src="header-icons/play-button.svg" \n                                        title="'.concat(_("Play"),'" \n                                        alt="').concat(_("Play"),'" \n                                        height="').concat(c,'" \n                                        width="').concat(c,'" \n                                        vertical-align="middle"\n                                    >'),h._playing=!1,h._playingOne=!1,h._playingAll=!1,h._rulerPlaying=-1,h._startingTime=null,h._elapsedTimes[e]=0,h._offsets[e]=0,setTimeout(h._calculateZebraStripes(e),1e3)):!1===h._playingOne&&(h._rulerSelected=e,h.activity.logo.turtleDelay=0,h._playing=!0,h._playingOne=!0,h._playingAll=!1,h._cellCounter=0,h._startingTime=null,h._rulerPlaying=e,s.innerHTML='<img \n                                    src="header-icons/pause-button.svg" \n                                    title="'.concat(_("Pause"),'" \n                                    alt="').concat(_("Pause"),'" \n                                    height="').concat(c,'" \n                                    width="').concat(c,'" \n                                    vertical-align="middle"\n                                >'),h._elapsedTimes[e]=0,h._offsets[e]=0,h._playOne())})}t.insertCell().innerHTML='<table id="rulerCellTable'.concat(y,'"></table>');var r=docById("rulerCellTable"+y),n=(r.style.textAlign="center",r.style.border="0px",r.style.borderCollapse="collapse",r.cellSpacing="0px",r.cellPadding="0px",r.insertRow());(h._rulers[y]=n).setAttribute("data-row",y);for(var a=0;a<h.Rulers[y][0].length;a++){var o=h.Rulers[y][0][a],u=n.insertCell(-1);u.innerHTML=calcNoteValueToDisplay(o,1),u.style.height=T.RULERHEIGHT+"px",u.style.minHeight=u.style.height,u.style.maxHeight=u.style.height,u.style.width=h._noteWidth(o)+"px",u.style.minWidth=u.style.width,u.style.border="0px",u.border="0px",u.padding="0px",u.style.padding="0px",u.style.lineHeight="60 % ",u.style.backgroundColor=y%2==0?a%2==0?platformColor.selectorBackground:platformColor.selectorSelected:a%2==0?platformColor.selectorSelected:platformColor.selectorBackground,h.__addCellEventHandlers(u,h._noteWidth(o),o)}t.cells[0].style.width=T.BUTTONSIZE+"px",t.cells[0].style.minWidth=T.BUTTONSIZE+"px",t.cells[0].style.maxWidth=T.BUTTONSIZE+"px",t.cells[0].style.height=n.offsetHeight+"px",t.cells[0].style.minHeight=n.offsetHeight+"px",t.cells[0].style.maxHeight=n.offsetHeight+"px",t.cells[0].style.verticalAlign="middle"})();for(var s=0;s<this.Drums.length;s++)if(null!==s)for(var r=0;r<this._dissectHistory.length;r++)if(this._dissectHistory[r][1]===this.Drums[s])for(var n,a=this._rulers[s],o=0;o<this._dissectHistory[r][0].length;o++)null!=this._dissectHistory[r][0][o]&&(this._rulerSelected=s,"number"==typeof this._dissectHistory[r][0][o]?(i=a.cells[this._dissectHistory[r][0][o]],this.__toggleRestState(i,!1)):"number"==typeof this._dissectHistory[r][0][o][0]?"number"==typeof this._dissectHistory[r][0][o][1]?null!=(i=a.cells[this._dissectHistory[r][0][o][0]])&&this.__dissectByNumber(i,this._dissectHistory[r][0][o][1],!1):null!=(i=a.cells[this._dissectHistory[r][0][o][0]])&&this.__divideFromList(i,this._dissectHistory[r][0][o][1],!1):(n=this._dissectHistory[r][0][o],this._mouseDownCell=a.cells[n[0][0]],this._mouseUpCell=a.cells[last(n)[0]],null!=this._mouseUpCell&&this.__tie(!1),this._mouseDownCell=null,this._mouseUpCell=null));e.textMsg(_("Click on the ruler to divide it."),3e3)}},{key:"_noteWidth",value:function(e){return Math.floor(EIGHTHNOTEWIDTH*(8/Math.abs(e))*(this.widgetWindow.isMaximized()?this._fullscreenScaleFactor:3))}},{key:"_scale",value:function(){var e,t=this;this.widgetWindow.isMaximized()&&(e=this.widgetWindow.getWidgetBody().getBoundingClientRect().width,this._fullscreenScaleFactor=Math.floor(e/(8*EIGHTHNOTEWIDTH))),this._rulers.forEach(function(e){t.widgetWindow.isMaximized()?Array.prototype.forEach.call(e.children,function(e){e.style.width=Number(e.style.width.slice(0,e.style.width.indexOf("px")))*(t._fullscreenScaleFactor/3)+"px",e.style.minWidth=e.style.width}):Array.prototype.forEach.call(e.children,function(e){e.style.width=Math.floor(Number(e.style.width.slice(0,e.style.width.indexOf("px")))/Math.floor(t._fullscreenScaleFactor/3))+"px",e.style.minWidth=e.style.width})})}},{key:"_showDissectNumberPieMenu",value:function(){piemenuDissectNumber(this)}},{key:"_calculateZebraStripes",value:function(e){for(var t=this._rulers[e],i=this._rulerSelected%2==0?platformColor.selectorBackground:platformColor.selectorSelected,l=0;l<t.cells.length;l++){var s=t.cells[l];s.style.border="2px solid lightgrey",s.style.borderRadius="10px",i===platformColor.selectorBackground&&(s.style.backgroundColor=l%2==0?platformColor.selectorBackground:platformColor.selectorSelected),i===platformColor.selectorSelected&&(s.style.backgroundColor=l%2==0?platformColor.selectorSelected:platformColor.selectorBackground)}}},{key:"_dissectRuler",value:function(e,t){var i=this,l=e.target;if(null!==l)if(this._tapMode&&0<this._tapTimes.length)s=new Date,this._tapTimes.push(s.getTime());else{var s=l.parentNode;if(null!==s&&(this._rulerSelected=t,null!=this._rulerSelected)&&!this._playing){if(this._tapMode){if(null===this._tapCell){s=this.Rulers[this._rulerSelected][0];if(this._tapCell=e.target,s[this._tapCell.cellIndex]<0)return this._tapCell=null,this._tapMode=!1,this._tapTimes=[],this._tapEndTime=null,void(this._tapButton.innerHTML='<img \n                            src="header-icons/tap-button.svg" \n                            title="'.concat(_("tap a rhythm"),'" \n                            alt="').concat(_("tap a rhythm"),'" \n                            height="').concat(T.ICONSIZE,'" \n                            width="').concat(T.ICONSIZE,'" \n                            vertical-align="middle"\n                        >'));this._tapTimes=[];var r,n=this._bpmFactor/Math.abs(s[this._tapCell.cellIndex]);r=null===this.Drums[this._rulerSelected]?"snare drum":(t=this.activity.blocks.blockList[this.Drums[this._rulerSelected]].connections[1],this.activity.blocks.blockList[t].value);for(var a=this.activity.turtles.ithTurtle(0).singer.beatsPerMeasure||4,o=0;o<a;o++)setTimeout(function(){i.activity.logo.synth.trigger(0,"C4",Singer.defaultBPMFactor/16,r,null,null)},n*o/a);setTimeout(function(){i.__startTapping(n,e)},n)}}else{s=""===(s=this._dissectNumber.value)||isNaN(s)?2:Math.abs(Math.floor(s));this._dissectNumber.value=s,this._rulerSelected=l.parentNode.getAttribute("data-row"),this.__dissectByNumber(l,s,!0)}this.saveDissectHistory()}}}},{key:"__startTapping",value:function(e,t){var i,l,s,r=this,n=new Date;this._tapTimes=[n.getTime()],this._tapEndTime=this._tapTimes[0]+e,setTimeout(function(){r.__endTapping(t)},e);this._tapCell.innerHTML="<div class='progressBar'></div>",this._progressBar=this._tapCell.querySelector(".progressBar"),i=12.5,l=1,s=setInterval(function(){100<=l?clearInterval(s):(l+=i,r._progressBar.style.width=l+"%")},e/8)}},{key:"__endTapping",value:function(e){e=e.target;if(null!==e.parentNode){this._rulerSelected=e.parentNode.getAttribute("data-row"),this._progressBar&&this._progressBar.remove(),this._tapCell.innerHTML="";e=new Date;if(this._tapTimes.push(e.getTime()),this._tapMode=!1,"string"==typeof this._rulerSelected||"number"==typeof this._rulerSelected){var t,i=this.Rulers[this._rulerSelected][0],e=(last(this._tapTimes)>this._tapEndTime&&(this._tapTimes[this._tapTimes.length-1]=this._tapEndTime),this._dissectNumber.value);switch(e=""===e||isNaN(e)?2:Math.abs(Math.floor(e))){case 2:t=16;break;case 3:t=27;break;case 4:t=32;break;case 5:t=25;break;case 6:t=36;break;case 7:t=14;break;case 8:t=64;break;default:t=16}for(var l,s=[],r=0,n=1;n<this._tapTimes.length;n++){var a=this._tapTimes[n]-this._tapTimes[n-1];n<this._tapTimes.length-1?(0===(l=nearestBeat(100*a/this._bpmFactor,t))[0]&&(l[0]=1,l[1]=l[1]/2),r+l[0]/l[1]<1&&(r+=l[0]/l[1],s.push(l[1]/l[0]))):(l=rationalToFraction(1/i[this._tapCell.cellIndex]-r),s.push(l[1]/l[0]))}this.__divideFromList(this._tapCell,s,!0)}this._tapTimes=[],this._tapCell=null,this._tapEndTime=null,this._tapButton.innerHTML='<img \n                src="header-icons/tap-button.svg" \n                title="'.concat(_("tap a rhythm"),'" \n                alt="').concat(_("tap a rhythm"),'" \n                height="').concat(T.ICONSIZE,'" \n                width="').concat(T.ICONSIZE,'" \n                vertical-align="middle"\n            >')}}},{key:"__addCellEventHandlers",value:function(e,t,i){function l(e){var t,i;null!==(e=e.target)&&null!==e.parentNode&&(o._rulerSelected=e.parentNode.getAttribute("data-row"),(t=o.Rulers[o._rulerSelected][0][e.cellIndex])<0?(i=rationalToFraction(Math.abs(Math.abs(-1/t))),e.innerHTML="".concat(calcNoteValueToDisplay(i[1],i[0])," ").concat(_("silence"),"}")):(i=rationalToFraction(Math.abs(Math.abs(1/t))),e.innerHTML=calcNoteValueToDisplay(i[1],i[0])))}function s(e){e.target.innerHTML=""}function r(e){e=e.target,o._mouseDownCell=e,e=new Date,o._longPressStartTime=e.getTime(),o._inLongPress=!1,o._longPressBeep=setTimeout(function(){var e=o._mouseDownCell;null!==e&&null!==e.parentNode&&(o._rulerSelected=e.parentNode.getAttribute("data-row"),e.style.backgroundColor=platformColor.selectorBackground)},1500)}function n(e){clearTimeout(o._longPressBeep);var t=e.target;o._mouseUpCell=t,o._mouseDownCell!==o._mouseUpCell?o._tieRuler(e,t.parentNode.getAttribute("data-row")):null===o._longPressStartTime||o._tapMode||1500<(new Date).getTime()-o._longPressStartTime&&(o._inLongPress=!0,o.__toggleRestState(t,!0)),o._mouseDownCell=null,o._mouseUpCell=null,o._longPressStartTime=null}function a(e){var t;null!=e&&(o.__getLongPressStatus()||null!==(t=e.target)&&null!==t.parentNode&&o._dissectRuler(e,t.parentNode.getAttribute("data-row")),o._inLongPress=!1)}var o=this;18<=t&&0<i?(t=rationalToFraction(Math.abs(1/i)),e.innerHTML=calcNoteValueToDisplay(t[1],t[0])):(e.innerHTML="",e.removeEventListener("mouseover",l),e.addEventListener("mouseover",l),e.removeEventListener("mouseout",s),e.addEventListener("mouseout",s)),e.removeEventListener("mousedown",r),e.addEventListener("mousedown",r),e.removeEventListener("mouseup",n),e.addEventListener("mouseup",n),e.removeEventListener("click",a),e.addEventListener("click",a)}},{key:"__getLongPressStatus",value:function(){return this._inLongPress}},{key:"__toggleRestState",value:function(e,t){var i,l,s,r,n,a=this;null!==e&&null!=e.parentNode&&(this._rulerSelected=e.parentNode.getAttribute("data-row"),s=function(e){var t,i,e=e.target;null!==e&&(a._rulerSelected=e.parentNode.getAttribute("data-row"),(i=a.Rulers[a._rulerSelected][0][e.cellIndex])<0?(t=rationalToFraction(Math.abs(Math.abs(-1/i))),e.innerHTML=calcNoteValueToDisplay(t[1],t[0])+" "+_("silence")):(t=rationalToFraction(Math.abs(Math.abs(1/i))),e.innerHTML=calcNoteValueToDisplay(t[1],t[0])))},r=function(e){e.target.innerHTML=""},(l=(i=this.Rulers[this._rulerSelected][0])[e.cellIndex])<0?(n=rationalToFraction(Math.abs(1/l)),e.innerHTML=calcNoteValueToDisplay(n[1],n[0]),e.removeEventListener("mouseover",s),e.removeEventListener("mouseout",r)):(e.innerHTML="",e.removeEventListener("mouseover",s),e.addEventListener("mouseover",s),e.removeEventListener("mouseout",r),e.addEventListener("mouseout",r)),i[e.cellIndex]=-l,this._calculateZebraStripes(this._rulerSelected),n=this.Rulers[this._rulerSelected][1],t&&this._undoList.push(["rest",this._rulerSelected]),n.push(e.cellIndex))}},{key:"__divideFromList",value:function(e,t,i){if("object"===_typeof(e)&&"object"===_typeof(t)){var l=this._rulers[this._rulerSelected],s=e.cellIndex;if("string"==typeof this._rulerSelected||"number"==typeof this._rulerSelected){var r=this.Rulers[this._rulerSelected][0],e=this.Rulers[this._rulerSelected][1];i&&this._undoList.push(["tap",this._rulerSelected]),e.push([s,t]),l.deleteCell(s),r.splice(s,1);for(var n=0;n<t.length;n++){var a=l.insertCell(s+n),o=t[n],u=parseFloat(this._noteWidth(o));r.splice(s+n,0,o),a.style.width=u+"px",a.style.minWidth=a.style.width,a.style.height=T.RULERHEIGHT+"px",a.style.minHeight=a.style.height,a.style.maxHeight=a.style.height,this.__addCellEventHandlers(a,u,o)}this._calculateZebraStripes(this._rulerSelected)}}}},{key:"__dissectByNumber",value:function(e,t,i){if("object"===_typeof(e)&&"number"==typeof t){var l=this._rulers[this._rulerSelected],s=e.cellIndex;if("string"==typeof this._rulerSelected||"number"==typeof this._rulerSelected){var r=this.Rulers[this._rulerSelected][0],e=r[s];if(256<t*e)this.activity.logo.errorMsg(_("Maximum value of 256 has been exceeded."));else{this.activity.hideMsgs();var n,a=this.Rulers[this._rulerSelected][1],i=(i&&this._undoList.push(["dissect",this._rulerSelected]),a.push([s,t]),l.deleteCell(s),this._noteWidth(n=t*e)),a=parseFloat(this._noteWidth(e))-parseFloat(t)*parseFloat(i),o=parseFloat(this._noteWidth(n))+parseFloat(a)/t;r.splice(s,1);for(var u=0;u<t;u++){var h=l.insertCell(s+u);r.splice(s+u,0,n),h.style.width=o+"px",h.style.minWidth=h.style.width,h.style.height=T.RULERHEIGHT+"px",h.style.minHeight=h.style.height,h.style.maxHeight=h.style.height,this.__addCellEventHandlers(h,o,n)}this._calculateZebraStripes(this._rulerSelected)}}}}},{key:"_tieRuler",value:function(e,t){this._playing||(this._tapMode?this._dissectRuler(e,t):null!==(t=e.target)&&null!==t.parentNode&&(this._rulerSelected=t.parentNode.getAttribute("data-row"),this.__tie(!0)))}},{key:"__tie",value:function(e){var t=this._rulers[this._rulerSelected];if(null!==this._mouseDownCell&&null!==this._mouseUpCell&&this._mouseDownCell!==this._mouseUpCell&&("string"==typeof this._rulerSelected||"number"==typeof this._rulerSelected)){var i=this.Rulers[this._rulerSelected][0],l=this._mouseDownCell.cellIndex,s=this._mouseUpCell.cellIndex;if(-1!==l&&-1!==s){s<l&&(r=l,l=s,s=r,r=this._mouseDdownCell,this._mouseDownCell=this._mouseUpCell,this._mouseUpCell=r),i=this.Rulers[this._rulerSelected][0];for(var r=this.Rulers[this._rulerSelected][1],n=(e&&this._undoList.push(["tie",this._rulerSelected]),[]),a=l;a<s+1;a++)n.push([a,i[a]]);r.push(n);for(var e=i[l],o=Math.abs(1/e),u=s;l<u;u--)o+=Math.abs(1/i[u]),t.deleteCell(u),this.Rulers[this._rulerSelected][0].splice(u,1);r=this._noteWidth(1/o);i[l]=e<0?-1/o:1/o,this._mouseDownCell.style.width=r+"px",this._mouseDownCell.style.minWidth=this._mouseDownCell.style.width,this._mouseDownCell.style.height=T.RULERHEIGHT+"px",this._mouseDownCell.style.minHeight=this._mouseDownCell.style.height,this._mouseDownCell.style.maxHeight=this._mouseDownCell.style.height,this.__addCellEventHandlers(this._mouseDownCell,r,i[l]),this._calculateZebraStripes(this._rulerSelected)}}}},{key:"_undo",value:function(){if(this.activity.logo.synth.stop(),this._startingTime=null,this._playing=!1,this._playingAll=!1,this._playingOne=!1,this._rulerPlaying=-1,this._startingTime=null,0!==this._undoList.length){var e=this._undoList.pop(),t=e[1],i=this.Rulers[t][1];if(0!==i.length){var l=this._rulers[t],s=this.Rulers[t][0];if("dissect"===e[0]){var r=i[i.length-1][1],n=i[i.length-1][0],a=l.cells[n].style.width,a=parseFloat(a)*r,o=s[n],u=o/r,h=l.insertCell(n);h.style.width=this._noteWidth(u)+"px",h.style.minWidth=h.style.width,h.style.height=T.RULERHEIGHT+"px",h.style.minHeight=h.style.height,h.style.maxHeight=h.style.height,h.style.backgroundColor=platformColor.selectorBackground,h.innerHTML=calcNoteValueToDisplay(o/r,1),s[n]=o/r,s.splice(n+1,r-1),this.__addCellEventHandlers(h,a,u);for(var c=0;c<r;c++)l.deleteCell(n+1)}else if("tap"===e[0]){for(var d=last(i)[0],p=last(i)[1],_=0,y=0;y<p.length;y++)_+=1/p[y];var o=1/_,h=this._noteWidth(o),a=l.insertCell(d),u=(a.style.width=h+"px",a.style.minWidth=a.style.width,a.style.height=T.RULERHEIGHT+"px",a.style.minHeight=a.style.height,a.style.maxHeight=a.style.height,a.style.backgroundColor=platformColor.selectorBackground,rationalToFraction(o));a.innerHTML=calcNoteValueToDisplay(u[1],u[0]),s[d]=o,s.splice(d+1,p.length-1),this.__addCellEventHandlers(a,h,o);for(var g=0;g<p.length;g++)l.deleteCell(d+1)}else if("tie"===e[0]){var v=last(i);if(0<v.length){u=l.cells[v[0][0]],a=this._noteWidth(v[0][1]);u.style.width=a+"px",u.style.minWidth=u.style.width,u.style.height=T.RULERHEIGHT+"px",u.style.minHeight=u.style.height,u.style.maxHeight=u.style.height,s[v[0][0]]=v[0][1],this.__addCellEventHandlers(u,a,v[0][1]);for(var m=1;m<v.length;m++){var f=l.insertCell(v[0][0]+m),b=this._noteWidth(v[m][1]);f.style.width=b+"px",f.style.minWidth=f.style.width,f.style.height=T.RULERHEIGHT+"px",f.style.minHeight=f.style.height,f.style.maxHeight=f.style.height,s.splice(v[0][0]+m,0,v[m][1]),f.innerHTML=calcNoteValueToDisplay(v[m][1],1),this.__addCellEventHandlers(f,b,v[m][1])}this.Rulers[t][0]=s}}else"rest"===e[0]&&(h=last(i),o=l.cells[h],this.__toggleRestState(o,!1),i.pop());i.pop(),this._calculateZebraStripes(t)}}}},{key:"_tap",value:function(){this._tapMode=!0;var e=T.ICONSIZE;this._tapButton.innerHTML='<img \n                src="header-icons/tap-active-button.svg" \n                title="'.concat(_("tap a rhythm"),'" \n                alt="').concat(_("tap a rhythm"),'" \n                height="').concat(e,'" \n                width="').concat(e,'" \n                vertical-align="middle"\n            >')}},{key:"_clear",value:function(){this.activity.logo.synth.stop(),this.activity.logo.resetSynth(0),this._playing=!1,this._playingAll=!1,this._playingOne=!1,this._rulerPlaying=-1,this._startingTime=null,this._playAllCell.innerHTML='<img \n                src="header-icons/play-button.svg" \n                title="'.concat(_("Play all"),'" \n                alt="').concat(_("Play all"),'" \n                height="').concat(T.ICONSIZE,'" \n                width="').concat(T.ICONSIZE,'" \n                vertical-align="middle"\n            >');for(var e=0;e<this.Rulers.length;e++)for(this._rulerSelected=e;0<this.Rulers[e][1].length;)this._undo()}},{key:"__pause",value:function(){this._playAllCell.innerHTML='<img \n                src="header-icons/play-button.svg" \n                title="'.concat(_("Play all"),'" \n                alt="').concat(_("Play all"),'" \n                height="').concat(T.ICONSIZE,'" \n                width="').concat(T.ICONSIZE,'" \n                vertical-align="middle"\n            >'),this._playing=!1,this._playingAll=!1,this._playingOne=!1,this._rulerPlaying=-1,this._startingTime=null;for(var e=0;e<this.Rulers.length;e++)this._calculateZebraStripes(e)}},{key:"playAll",value:function(){var e=this;this._playing?this._playingAll&&(this.__pause(),this._playingAll=!0,setTimeout(function(){e.__resume()},1e3)):this._playingAll||this.__resume()}},{key:"__resume",value:function(){this._playAllCell.innerHTML='<img \n                src="header-icons/pause-button.svg" \n                title="'.concat(_("Pause"),'" \n                alt="').concat(_("Pause"),'" \n                height="').concat(T.ICONSIZE,'" \n                width="').concat(T.ICONSIZE,'" \n                vertical-align="middle"\n            >'),this.activity.logo.turtleDelay=0,this._playingAll=!0,this._playing=!0,this._playingOne=!1,this._cellCounter=0,this._rulerPlaying=-1;for(var e=0;e<this.Rulers.length;e++)this._elapsedTimes[e]=0,this._offsets[e]=0;this._playAll()}},{key:"_playAll",value:function(){if(this.activity.logo.synth.stop(),this.activity.logo.resetSynth(0),null===this._startingTime){var e=new Date;this._startingTime=e.getTime();for(var t=0;t<this.Rulers.length;t++)this._offsets[t]=0,this._elapsedTimes[t]=0}for(var i=0;i<this.Rulers.length;i++)this.__loop(0,i,0)}},{key:"_playOne",value:function(){var e;this.activity.logo.synth.stop(),this.activity.logo.resetSynth(0),null===this._startingTime&&(e=new Date,this._startingTime=e.getTime(),this._elapsedTimes[this._rulerSelected]=0,this._offsets[this._rulerSelected]=0),this.__loop(0,this._rulerSelected,0)}},{key:"__loop",value:function(e,t,i){var l=this,s=this._rulers[t];if(null!==s){0===i&&this._calculateZebraStripes(t);for(var r,s=s.cells[i],n=this.Rulers[t][0],a=n[i],o=(e=Math.abs(1/a),r=null===this.Drums[t]?"snare drum":(h=this.activity.blocks.blockList[this.Drums[t]].connections[1],this.activity.blocks.blockList[h].value),!1),u=0;u<DRUMNAMES.length;u++){if(DRUMNAMES[u][0].replace("-"," ")===r){r=DRUMNAMES[u][1],o=!0;break}if(DRUMNAMES[u][1]===r){o=!0;break}}var h,c=!1;if(!o)for(var d=0;d<VOICENAMES.length;d++){if(VOICENAMES[d][0]===r){r=VOICENAMES[d][1],c=!0;break}if(VOICENAMES[d][1]===r){c=!0;break}}this._playing&&(0<a&&(c?this.activity.logo.synth.trigger(0,"C4",Singer.defaultBPMFactor/a,r,null,null,!1):o&&this.activity.logo.synth.trigger(0,["C4"],Singer.defaultBPMFactor/a,r,null,null)),s.style.backgroundColor=platformColor.rulerHighlight,h=new Date,this._offsets[t]=h.getTime()-this._startingTime-this._elapsedTimes[t]),setTimeout(function(){(i+=1)===n.length&&(i=0),l._playing&&l.__loop(e,t,i)},1e3*Singer.defaultBPMFactor*e-this._offsets[t]),this._elapsedTimes[t]+=1e3*Singer.defaultBPMFactor*e}}},{key:"_save",value:function(h){var e,c=this;for(e in this.activity.palettes.dict)this.activity.palettes.dict[e].hideMenu(!0);this.activity.refreshCanvas(),setTimeout(function(){for(var e,t,i=c._rulers[h],l=c.Rulers[h][0],s=null===c.Drums[h]?_("snare drum")+" "+_("rhythm"):c.activity.blocks.blockList[c.activity.blocks.blockList[c.Drums[h]].connections[1]].value.split(" ")[0]+" "+_("rhythm"),r=42*h,n=[[0,["action",{collapsed:!0}],100+r,100+r,[null,1,2,null]],[1,["text",{value:s}],0,0,[0]]],a=0,o=1,u=0;u<i.cells.length;u++)l[u]===l[u+1]&&u<i.cells.length-1?o+=1:(e=n.length,t=l[u],t=rationalToFraction(1/Math.abs(t)),n.push([e,"rhythm2",0,0,[a,e+1,e+2,e+5]]),n.push([e+1,["number",{value:o}],0,0,[e]]),n.push([e+2,"divide",0,0,[e,e+3,e+4]]),n.push([e+3,["number",{value:t[0]}],0,0,[e+2]]),n.push([e+4,["number",{value:t[1]}],0,0,[e+2]]),n.push([e+5,"vspace",0,0,[e,e+6]]),u==i.cells.length-1?n.push([e+6,"hidden",0,0,[e+5,null]]):n.push([e+6,"hidden",0,0,[e+5,e+7]]),a=e+6,o=1);c.activity.blocks.loadNewBlocks(n),h>c.Rulers.length-2||c._save(h+1)},500)}},{key:"_saveTuplets",value:function(c){var e,d=this;for(e in this.activity.palettes.dict)this.activity.palettes.dict[e].hideMenu(!0);this.activity.refreshCanvas(),setTimeout(function(){for(var e,t,i,l=d._rulers[c],s=d.Rulers[c][0],r=null===d.Drums[c]?_("rhythm"):d.activity.blocks.blockList[d.activity.blocks.blockList[d.Drums[c]].connections[1]].value.split(" ")[0]+" "+_("rhythm"),n=42*c,a=[[0,["action",{collapsed:!0}],100+n,100+n,[null,1,2,null]],[1,["text",{value:r}],0,0,[0]]],o=0,u=1,h=0;h<l.cells.length;h++)s[h]===s[h+1]&&h<l.cells.length-1?u+=1:(e=a.length,t=s[h],i=(t=rationalToFraction(1/Math.abs(t)))[1]/u,Number.isInteger(i)?(a.push([e,"stuplet",0,0,[o,e+1,e+2,e+5]]),a.push([e+1,["number",{value:u}],0,0,[e]]),a.push([e+2,"divide",0,0,[e,e+3,e+4]]),a.push([e+3,["number",{value:t[0]}],0,0,[e+2]]),a.push([e+4,["number",{value:i}],0,0,[e+2]])):(a.push([e,"rhythm2",0,0,[o,e+1,e+2,e+5]]),a.push([e+1,["number",{value:u}],0,0,[e]]),a.push([e+2,"divide",0,0,[e,e+3,e+4]]),a.push([e+3,["number",{value:t[0]}],0,0,[e+2]]),a.push([e+4,["number",{value:t[1]}],0,0,[e+2]])),a.push([e+5,"vspace",0,0,[e,e+6]]),h==l.cells.length-1?a.push([e+6,"hidden",0,0,[e+5,null]]):a.push([e+6,"hidden",0,0,[e+5,e+7]]),o=e+6,u=1);d.activity.blocks.loadNewBlocks(a),c>d.Rulers.length-2||d._saveTuplets(c+1)},500)}},{key:"_saveTupletsMerged",value:function(e){for(var t in this.activity.palettes.dict)this.activity.palettes.dict[t].hideMenu(!0);this.activity.refreshCanvas();for(var i,l,s=[[0,["action",{collapsed:!0}],142,142,[null,1,2,null]],[1,["text",{value:_("rhythm")}],0,0,[0]]],r=0,n=1,a=0;a<e.length;a++)e[a]===e[a+1]&&a<e.length-1?n+=1:(i=s.length,l=e[a],l=rationalToFraction(1/Math.abs(l)),s.push([i,"rhythm2",0,0,[r,i+1,i+2,i+5]]),s.push([i+1,["number",{value:n}],0,0,[i]]),s.push([i+2,"divide",0,0,[i,i+3,i+4]]),s.push([i+3,["number",{value:l[0]}],0,0,[i+2]]),s.push([i+4,["number",{value:l[1]}],0,0,[i+2]]),s.push([i+5,"vspace",0,0,[i,i+6]]),a==e.length-1?s.push([i+6,"hidden",0,0,[i+5,null]]):s.push([i+6,"hidden",0,0,[i+5,i+7]]),r=i+6,n=1);this.activity.blocks.loadNewBlocks(s),activity.textMsg(_("New action block generated."),3e3)}},{key:"_saveMachine",value:function(e){var t,i;i=null===this.Drums[e]?"snare drum":(t=this.activity.blocks.blockList[this.Drums[e]].connections[1],this.activity.blocks.blockList[t].value);for(var l=0;l<DRUMNAMES.length;l++)if(DRUMNAMES[l][1]===i)return void(EFFECTSNAMES.includes(i)?this._saveDrumMachine(e,i,!0):this._saveDrumMachine(e,i,!1));for(var s=0;s<VOICENAMES.length;s++)if(VOICENAMES[s][1]===i)return void this._saveVoiceMachine(e,i)}},{key:"_saveDrumMachine",value:function(c,d,p){var e,y=this;for(e in this.activity.palettes.dict)this.activity.palettes.dict[e].hideMenu(!0);this.activity.refreshCanvas(),setTimeout(function(){for(var e,t,i,l=y._rulers[c],s=y.Rulers[c][0],r=42*c,n=null===y.Drums[c]?_("snare drum")+" "+_("action"):y.activity.blocks.blockList[y.activity.blocks.blockList[y.Drums[c]].connections[1]].value.split(" ")[0]+" "+_("action"),a=[[0,["action",{collapsed:!0}],100+r,100+r,[null,1,2,null]],[1,["text",{value:n}],0,0,[0]]],o=0,u=1,h=0;h<l.cells.length;h++)s[h]===s[h+1]&&h<l.cells.length-1?u+=1:(e=a.length,t=s[h],i=rationalToFraction(1/Math.abs(t)),1===u?(a.push([e,"newnote",0,0,[o,e+1,e+4,e+7]]),a.push([e+1,"divide",0,0,[e,e+2,e+3]]),a.push([e+2,["number",{value:i[0]}],0,0,[e+1]]),t<0?(a.push([e+3,["number",{value:i[1]}],0,0,[e+1]]),a.push([e+4,"vspace",0,0,[e,e+5]]),a.push([e+5,"rest2",0,0,[e+4,e+6]]),a.push([e+6,"hidden",0,0,[e+5,null]])):(a.push([e+3,["number",{value:i[1]}],0,0,[e+1]]),a.push([e+4,"vspace",0,0,[e,e+5]]),a.push([e+5,"playdrum",0,0,[e+4,e+6,null]]),a.push(p?[e+6,["effectsname",{value:d}],0,0,[e+5]]:[e+6,["drumname",{value:d}],0,0,[e+5]])),h==l.cells.length-1?a.push([e+7,"hidden",0,0,[e,null]]):(a.push([e+7,"hidden",0,0,[e,e+8]]),o=e+7)):(h==l.cells.length-1?a.push([e,"repeat",0,0,[o,e+1,e+2,null]]):(a.push([e,"repeat",0,0,[o,e+1,e+2,e+10]]),o=e),a.push([e+1,["number",{value:u}],0,0,[e]]),a.push([e+2,"newnote",0,0,[e,e+3,e+6,e+9]]),a.push([e+3,"divide",0,0,[e+2,e+4,e+5]]),a.push([e+4,["number",{value:1}],0,0,[e+3]]),t<0?(a.push([e+5,["number",{value:-t}],0,0,[e+3]]),a.push([e+6,"vspace",0,0,[e+2,e+7]]),a.push([e+7,"rest2",0,0,[e+6,e+8]]),a.push([e+8,"hidden",0,0,[e+7,null]])):(a.push([e+5,["number",{value:t}],0,0,[e+3]]),a.push([e+6,"vspace",0,0,[e+2,e+7]]),a.push([e+7,"playdrum",0,0,[e+6,e+8,null]]),a.push(p?[e+8,["effectsname",{value:d}],0,0,[e+7]]:[e+8,["drumname",{value:d}],0,0,[e+7]])),a.push([e+9,"hidden",0,0,[e+2,null]])),u=1);y.activity.blocks.loadNewBlocks(a),activity.textMsg(_("New action block generated."),3e3),c>y.Rulers.length-2||y._saveMachine(c+1)},500)}},{key:"_saveVoiceMachine",value:function(c,d){var e,p=this;for(e in this.activity.palettes.dict)this.activity.palettes.dict[e].hideMenu(!0);this.activity.refreshCanvas(),setTimeout(function(){for(var e,t,i,l=p._rulers[c],s=p.Rulers[c][0],r=42*c,n=null===p.Drums[c]?_("guitar")+" "+_("action"):p.activity.blocks.blockList[p.activity.blocks.blockList[p.Drums[c]].connections[1]].value.split(" ")[0]+"_"+_("action"),a=[[0,["action",{collapsed:!0}],100+r,100+r,[null,1,2,null]],[1,["text",{value:n}],0,0,[0]]],o=(a.push([2,"settimbre",0,0,[0,3,5,4]]),a.push([3,["voicename",{value:d}],0,0,[2]]),a.push([4,"hidden",0,0,[2,null]]),2),u=1,h=0;h<l.cells.length;h++)s[h]===s[h+1]&&h<l.cells.length-1?u+=1:(e=a.length,t=s[h],i=rationalToFraction(1/Math.abs(t)),1===u?t<0?(a.push([e,"newnote",0,0,[o,e+1,e+4,e+7]]),a.push([e+1,"divide",0,0,[e,e+2,e+3]]),a.push([e+2,["number",{value:i[0]}],0,0,[e+1]]),a.push([e+3,["number",{value:i[1]}],0,0,[e+1]]),a.push([e+4,"vspace",0,0,[e,e+5]]),a.push([e+5,"rest2",0,0,[e+4,e+6]]),a.push([e+6,"hidden",0,0,[e+5,null]]),h==l.cells.length-1?a.push([e+7,"hidden",0,0,[e,null]]):(a.push([e+7,"hidden",0,0,[e,e+8]]),o=e+7)):(a.push([e,"newnote",0,0,[o,e+1,e+4,e+8]]),a.push([e+1,"divide",0,0,[e,e+2,e+3]]),a.push([e+2,["number",{value:i[0]}],0,0,[e+1]]),a.push([e+3,["number",{value:i[1]}],0,0,[e+1]]),a.push([e+4,"vspace",0,0,[e,e+5]]),a.push([e+5,"pitch",0,0,[e+4,e+6,e+7,null]]),a.push([e+6,["notename",{value:"C"}],0,0,[e+5]]),a.push([e+7,["number",{value:4}],0,0,[e+5]]),h==l.cells.length-1?a.push([e+8,"hidden",0,0,[e,null]]):(a.push([e+8,"hidden",0,0,[e,e+9]]),o=e+8)):(h==l.cells.length-1?a.push([e,"repeat",0,0,[o,e+1,e+2,null]]):(a.push([e,"repeat",0,0,[o,e+1,e+2,e+11]]),o=e),a.push([e+1,["number",{value:u}],0,0,[e]]),t<0?(a.push([e+2,"newnote",0,0,[e,e+3,e+6,e+9]]),a.push([e+3,"divide",0,0,[e+2,e+4,e+5]]),a.push([e+4,["number",{value:1}],0,0,[e+3]]),a.push([e+5,["number",{value:-t}],0,0,[e+3]]),a.push([e+6,"vspace",0,0,[e+2,e+7]]),a.push([e+7,"rest2",0,0,[e+6,e+8]]),a.push([e+8,"hidden",0,0,[e+7,null]]),a.push([e+9,"hidden",0,0,[e+2,null]])):(a.push([e+2,"newnote",0,0,[e,e+3,e+6,e+10]]),a.push([e+3,"divide",0,0,[e+2,e+4,e+5]]),a.push([e+4,["number",{value:1}],0,0,[e+3]]),a.push([e+5,["number",{value:t}],0,0,[e+3]]),a.push([e+6,"vspace",0,0,[e+2,e+7]]),a.push([e+7,"pitch",0,0,[e+6,e+8,e+9,null]]),a.push([e+8,["notename",{value:"C"}],0,0,[e+7]]),a.push([e+9,["number",{value:4}],0,0,[e+7]]),a.push([e+10,"hidden",0,0,[e+2,null]]))),u=1);p.activity.blocks.loadNewBlocks(a),c>p.Rulers.length-2||p._saveMachine(c+1)},500)}},{key:"_mergeRulers",value:function(){for(var e=[],t=0;t<this.Rulers.length;t++)for(var i=0,l=this.Rulers[t][0],s=0;s<l.length;s++)i+=1/l[s],e.includes(i)||e.push(i);e.sort(function(e,t){return e-t}),l=[];for(var r=0;r<e.length;r++)0===r?l.push(1/e[r]):l.push(1/(e[r]-e[r-1]));return l}},{key:"_get_save_lock",value:function(){return this._save_lock}},{key:"saveDissectHistory",value:function(){for(var e,t=[],i=[],l=0;l<this.Rulers.length;l++)if(null!==this.Drums[l]){for(var s=[],r=0;r<this.Rulers[l][1].length;r++)s.push(this.Rulers[l][1][r]);this._dissectNumber.classList.add("hasKeyboard"),t.push([s,this.Drums[l]]),i.push(this.Drums[l])}for(var n=0;n<this._dissectHistory.length;n++)e=this._dissectHistory[n][1],i.includes(e)||(s=JSON.parse(JSON.stringify(this._dissectHistory[n][0])),t.push([s,e]));this._dissectHistory=JSON.parse(JSON.stringify(t))}},{key:"_positionWheel",value:function(){var e,t;"none"!=docById("wheelDiv").style.display&&(docById("wheelDiv").style.position="absolute",docById("wheelDiv").style.height="300px",docById("wheelDiv").style.width="300px",e=this._left+100,t=this._top,docById("wheelDiv").style.left=Math.min(Math.max(e-75,0),this.activity.canvas.width-300)+"px",docById("wheelDiv").style.top=t-300<0?t+60+"px":t-300+"px")}}])})();_defineProperty(RhythmRuler,"RULERHEIGHT",70),_defineProperty(RhythmRuler,"BUTTONSIZE",51),_defineProperty(RhythmRuler,"ICONSIZE",32),_defineProperty(RhythmRuler,"DEL",46),_defineProperty(RhythmRuler,"BACK",8),"undefined"!=typeof module&&(module.exports=RhythmRuler);
var RhythmRuler=require("./rhythmruler.js"),mockWindow=(global._=function(e){return e},global.TONEBPM=240,global.EIGHTHNOTEWIDTH=24,global.Singer={masterBPM:90,defaultBPMFactor:1e3},global.docById=jest.fn().mockReturnValue({style:{},classList:{add:jest.fn(),remove:jest.fn()},innerHTML:""}),global.delayExecution=jest.fn().mockResolvedValue(void 0),global.last=function(e){return e&&0<e.length?e[e.length-1]:void 0},global.nearestBeat=jest.fn(function(e){return e}),global.rationalToFraction=jest.fn(function(e){return[1,Math.round(1/e)]}),global.calcNoteValueToDisplay=jest.fn(function(e,t){return"".concat(t,"/").concat(e)}),global.beginnerMode=!1,global.platformColor={selectorBackground:"#ffb020",selectorBackgroundHOFF:"#ffc040",paletteBackground:"#f0f0f0"},global.DRUMNAMES=[],global.VOICENAMES=[],global.EFFECTSNAMES=[],{widgetWindows:{windowFor:jest.fn().mockReturnValue({clear:jest.fn(),show:jest.fn(),destroy:jest.fn(),addButton:jest.fn().mockReturnValue({onclick:null,innerHTML:""}),addInputButton:jest.fn().mockImplementation(function(e){return{value:e,addEventListener:jest.fn(),classList:{add:jest.fn(),remove:jest.fn()},onfocus:null,onblur:null}}),getWidgetBody:jest.fn().mockReturnValue({appendChild:jest.fn(),append:jest.fn(),insertRow:jest.fn().mockReturnValue({setAttribute:jest.fn(),insertCell:jest.fn().mockReturnValue({appendChild:jest.fn(),setAttribute:jest.fn(),style:{},innerHTML:"",addEventListener:jest.fn()})})}),sendToCenter:jest.fn(),isMaximized:jest.fn().mockReturnValue(!1),onclose:null,onmaximize:null})},innerWidth:1200});global.window=mockWindow,global.document={createElement:jest.fn().mockImplementation(function(e){return{style:{},setAttribute:jest.fn(),getAttribute:jest.fn(),addEventListener:jest.fn(),appendChild:jest.fn(),insertRow:jest.fn().mockReturnValue({setAttribute:jest.fn(),insertCell:jest.fn().mockReturnValue({style:{},innerHTML:"",setAttribute:jest.fn(),addEventListener:jest.fn()})}),cells:[],insertCell:jest.fn().mockReturnValue({style:{},innerHTML:""}),deleteCell:jest.fn(),classList:{add:jest.fn(),remove:jest.fn()},getContext:jest.fn().mockReturnValue({clearRect:jest.fn(),beginPath:jest.fn(),fillStyle:"",fill:jest.fn(),closePath:jest.fn()})}}),getElementById:jest.fn().mockReturnValue({style:{},classList:{add:jest.fn(),remove:jest.fn()}})},describe("RhythmRuler Widget",function(){var t,e;beforeEach(function(){t=new RhythmRuler,e={logo:{synth:{trigger:jest.fn(),stop:jest.fn(),loadSynth:jest.fn()},resetSynth:jest.fn(),turtleDelay:0},blocks:{blockList:{},protoBlockDict:{},loadNewBlocks:jest.fn()},turtles:{ithTurtle:jest.fn().mockReturnValue({singer:{beatsPerMeasure:4,noteValuePerBeat:4}})},refreshCanvas:jest.fn(),saveLocally:jest.fn(),textMsg:jest.fn(),errorMsg:jest.fn(),hideMsgs:jest.fn()},global.activity=e,t.activity=e,t.widgetWindow=mockWindow.widgetWindows.windowFor()}),afterEach(function(){jest.clearAllMocks()}),describe("Constructor",function(){test("should initialize with default empty state",function(){expect(t.Drums).toEqual([]),expect(t.Rulers).toEqual([]),expect(t._undoList).toEqual([]),expect(t._dissectHistory).toEqual([])}),test("should initialize flags to default values",function(){expect(t._playing).toBe(!1),expect(t._playingOne).toBe(!1),expect(t._playingAll).toBe(!1),expect(t._tapMode).toBe(!1),expect(t._rulerSelected).toBe(0)}),test("should have correct static constants",function(){expect(RhythmRuler.RULERHEIGHT).toBe(70),expect(RhythmRuler.BUTTONSIZE).toBe(51),expect(RhythmRuler.ICONSIZE).toBe(32),expect(RhythmRuler.DEL).toBe(46),expect(RhythmRuler.BACK).toBe(8)})}),describe("State Management",function(){test("should initialize tracking arrays",function(){expect(t._elapsedTimes).toEqual([]),expect(t._offsets).toEqual([]),expect(t._startingTime).toBeNull(),expect(t._tapTimes).toEqual([])})}),describe("Ruler and Drum Management",function(){test("should allow adding drums to Drums array",function(){t.Drums.push("snare drum"),t.Rulers.push([[1],[]]),expect(t.Drums).toHaveLength(1),expect(t.Drums[0]).toBe("snare drum")}),test("should allow adding multiple drums",function(){t.Drums.push("snare drum"),t.Drums.push("kick drum"),t.Rulers.push([[1],[]]),t.Rulers.push([[1],[]]),expect(t.Drums).toHaveLength(2),expect(t.Rulers).toHaveLength(2)}),test("should store ruler note values correctly",function(){t.Rulers.push([[4,4,4,4],[]]),expect(t.Rulers[0][0]).toEqual([4,4,4,4]),expect(t.Rulers[0][1]).toEqual([])}),test("should store division history in ruler",function(){t.Rulers.push([[4],[[0,4]]]),expect(t.Rulers[0][1]).toHaveLength(1),expect(t.Rulers[0][1][0]).toEqual([0,4])})}),describe("Undo Functionality",function(){beforeEach(function(){t.activity=e,t._rulers=[]}),test("should return early if undo list is empty",function(){t._undoList=[],t.Rulers=[[[1],[]]],t._rulers=[{cells:[],insertCell:jest.fn(),deleteCell:jest.fn()}],expect(function(){return t._undo()}).not.toThrow()}),test("should stop synth when undoing",function(){t._undoList=[],t.Rulers=[[[1],[]]],t._rulers=[{cells:[],insertCell:jest.fn(),deleteCell:jest.fn()}],t._undo(),expect(e.logo.synth.stop).toHaveBeenCalled()}),test("should reset playing state when undoing",function(){t._playing=!0,t._playingAll=!0,t._playingOne=!0,t._rulerPlaying=1,t._undoList=[],t.Rulers=[[[1],[]]],t._rulers=[{cells:[],insertCell:jest.fn(),deleteCell:jest.fn()}],t._undo(),expect(t._playing).toBe(!1),expect(t._playingAll).toBe(!1),expect(t._playingOne).toBe(!1),expect(t._rulerPlaying).toBe(-1)}),test("should reset starting time when undoing",function(){t._startingTime=12345,t._undoList=[],t.Rulers=[[[1],[]]],t._rulers=[{cells:[],insertCell:jest.fn(),deleteCell:jest.fn()}],t._undo(),expect(t._startingTime).toBeNull()})}),describe("Save Dissect History",function(){beforeEach(function(){t._dissectNumber={classList:{add:jest.fn(),remove:jest.fn()}}}),test("should save dissect history for rulers with drums",function(){t.Drums=["snare drum"],t.Rulers=[[[],[[0,2]]]],t._dissectHistory=[],t.saveDissectHistory(),expect(t._dissectHistory).toHaveLength(1),expect(t._dissectHistory[0][1]).toBe("snare drum")}),test("should skip rulers with null drums",function(){t.Drums=[null,"kick drum"],t.Rulers=[[[],[]],[[],[[0,3]]]],t._dissectHistory=[],t.saveDissectHistory(),expect(t._dissectHistory).toHaveLength(1),expect(t._dissectHistory[0][1]).toBe("kick drum")}),test("should preserve old history entries for unused drums",function(){t.Drums=["snare drum"],t.Rulers=[[[],[[0,2]]]],t._dissectHistory=[[[[0,4]],"old drum"]],t.saveDissectHistory(),expect(t._dissectHistory).toHaveLength(2)}),test("should add hasKeyboard class to dissect number",function(){t.Drums=["snare drum"],t.Rulers=[[[],[[0,2]]]],t._dissectHistory=[],t.saveDissectHistory(),expect(t._dissectNumber.classList.add).toHaveBeenCalledWith("hasKeyboard")})}),describe("Note Width Calculation",function(){test("should calculate width based on note value",function(){var e=t._noteWidth(4);expect(e).toBe(144)}),test("should calculate width for eighth note",function(){var e=t._noteWidth(8);expect(e).toBe(72)}),test("should calculate width for half note",function(){var e=t._noteWidth(2);expect(e).toBe(288)}),test("should handle sixteenth note",function(){var e=t._noteWidth(16);expect(e).toBe(36)})}),describe("Playback State",function(){test("should allow updating playback properties",function(){t._rulerPlaying=2,t._playingAll=!0,t._playingOne=!0,t._cellCounter=5,expect(t._rulerPlaying).toBe(2),expect(t._playingAll).toBe(!0),expect(t._playingOne).toBe(!0),expect(t._cellCounter).toBe(5)})}),describe("Tap Mode",function(){test("should track tap mode verification",function(){t._tapMode=!0,t._tapTimes=[100,200,300],t._tapEndTime=12345,expect(t._tapMode).toBe(!0),expect(t._tapTimes).toHaveLength(3),expect(t._tapEndTime).toBe(12345)}),test("should track tap interaction details",function(){t._tapCell={cellIndex:2},t._inLongPress=!0,t._longPressStartTime=1e4,expect(t._tapCell.cellIndex).toBe(2),expect(t._inLongPress).toBe(!0),expect(t._longPressStartTime).toBe(1e4)})}),describe("Mouse Interactions",function(){test("should track mouse interactions on cells",function(){t._mouseDownCell=3,t._mouseUpCell=5,expect(t._mouseDownCell).toBe(3),expect(t._mouseUpCell).toBe(5)})}),describe("Fullscreen Mode",function(){test("should manage fullscreen scale factor",function(){expect(t._fullscreenScaleFactor).toBe(3),t._fullscreenScaleFactor=5,expect(t._fullscreenScaleFactor).toBe(5)})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function i(e,t,n,i){var a,s,o,l,r,c,h,u,d,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(a=e,s=n,h=i||[],u=!1,d={p:c=0,n:0,v:m,a:p,f:p.bind(m,4),d:function(e,t){return o=e,l=0,r=m,d.n=t,y}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(u&&1===t&&p(t,n),l=t,r=n;(v=l<2?m:r)||!u;){o||(l?l<3?(1<l&&(d.n=-1),p(l,r)):d.n=r:d.v=r);try{if(c=2,o){if(v=o[e=l?e:"next"]){if(!(v=v.call(o,r)))throw TypeError("iterator result is not an object");if(!v.done)return v;r=v.value,l<2&&(l=0)}else 1===l&&(v=o.return)&&v.call(o),l<2&&(r=TypeError("The iterator does not provide a '"+e+"' method"),l=1);o=m}else if((v=(u=d.n<0)?r:a.call(s,d))!==y)break}catch(e){o=m,l=1,r=e}finally{c=1}}return{value:v,done:u}}),!0),t;function p(e,t){for(l=e,r=t,v=0;!u&&c&&!n&&v<h.length;v++){var n,i=h[v],a=d.p,s=i[2];3<e?(n=s===t)&&(r=i[(l=i[4])?5:l=3],i[4]=i[5]=m):i[0]<=a&&((n=e<2&&a<i[1])?(l=0,d.v=t,d.n=i[1]):a<s&&(n=e<3||i[0]>t||s<t)&&(i[4]=e,i[5]=t,d.n=s,l=0))}if(n||1<e)return y;throw u=!0,t}}var y={};function g(){}function a(){}function s(){}var v=Object.getPrototypeOf,e=[][t]?v(v([][t]())):(_regeneratorDefine2(v={},t,function(){return this}),v),o=s.prototype=g.prototype=Object.create(e);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(o),e}return _regeneratorDefine2(o,"constructor",a.prototype=s),_regeneratorDefine2(s,"constructor",a),_regeneratorDefine2(s,n,a.displayName="GeneratorFunction"),_regeneratorDefine2(o),_regeneratorDefine2(o,n,"Generator"),_regeneratorDefine2(o,t,function(){return this}),_regeneratorDefine2(o,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:i,m:l}})()}function _regeneratorDefine2(e,t,n,i){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}(_regeneratorDefine2=function(e,t,n,i){function a(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?s?s(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n:(a("next",0),a("throw",1),a("return",2))})(e,t,n,i)}function asyncGeneratorStep(e,t,n,i,a,s,o){try{var l=e[s](o),r=l.value}catch(e){return void n(e)}l.done?t(r):Promise.resolve(r).then(i,a)}function _asyncToGenerator(l){return function(){var e=this,o=arguments;return new Promise(function(t,n){var i=l.apply(e,o);function a(e){asyncGeneratorStep(i,t,n,a,s,"next",e)}function s(e){asyncGeneratorStep(i,t,n,a,s,"throw",e)}a(void 0)})}}function SampleWidget(){function i(l){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1;return function(e){e=function(e){var i=2*Math.PI*(1<arguments.length&&void 0!==arguments[1]?arguments[1]:500)/l;return e.map(function(e,t,n){return 0<t?i*e+(1-i)*n[t-1]:e})}(e,300);var a,n,i,t,s,e=(n=(a=e).map(function(e,i){return a.slice(0,a.length-i).reduce(function(e,t,n){return e+t*a[n+i]},0)})).map(function(e,t){return n[0]+n[t]-2*n[t]}),e=(i=0,e.map(function(e,t){return i+=e,0===t?1:e/(i/t)})),o=(e=>{for(var t=2;t<e.length;t++)if(e[t]<r){for(;t+1<e.length&&e[t+1]<e[t];)t++;return t}return-1})(e);return-1===o?-1:(t=(o=o)<1?o:o-1,s=o+1<(e=e).length?o+1:o,t=t===o?e[o]<=e[s]?o:s:s===o?e[o]<=e[t]?o:t:o+(s-t)*((t=e[t])-(s=e[s]))/(2*(t-2*e[o]+s)),l/t)}}var c=this,n=[DOUBLEFLAT,FLAT,"",SHARP,DOUBLESHARP],t=[DOUBLEFLAT,FLAT,NATURAL,SHARP,DOUBLESHARP],a=["do","re","mi","fa","sol","la","ti","do"],s=["C","D","E","F","G","A","B"],o=[0,2,4,5,7,9,11],l="electronic synth",C=["#3030FF","#FF3050"],b=(this.timbreBlock,this.sampleArray,this.sampleData="",this.sampleName="electronic synth",this.samplePitch="sol",this.sampleOctave="4",this.pitchCenter=9,this.accidentalCenter=2,this.octaveCenter=4,this.sampleLength=1e3,this.pitchAnalysers={},this.tunerEnabled=!1,this.tunerAnalyser=null,this.tunerMic=null,this.tunerCanvas=null,this.tunerContext=null,this.tunerAnimationFrame=null,this.centsValue=0,this.sliderVisible=!1,this.sliderDiv=null,this.centAdjustmentWindow=null,this.centAdjustmentVisible=!1,this.centAdjustmentSlider=null,this.centAdjustmentValue=0,this.centAdjustmentOn=!1,this.currentNoteObj=null,this.player=null,this.pitchDetectionAudioContext=null,this.pitchDetectionStream=null,this.pitchDetectionAnimationId=null,this.isPitchDetectionRunning=!1,this._updateBlocks=function(){var e,t,n,i;this.sampleArray=[this.sampleName,this.sampleData,this.samplePitch,this.sampleOctave,this.centAdjustmentValue||0],null!=this.timbreBlock&&null!=(i=this.activity.blocks.blockList[this.timbreBlock].connections[1])&&(this.activity.blocks.blockList[i].value=this.sampleArray,this.activity.blocks.blockList[i].updateCache(),n=this.activity.blocks.blockList[i].connections[1],e=this.activity.blocks.blockList[i].connections[2],t=this.activity.blocks.blockList[i].connections[3],null!=n&&(this.activity.blocks.blockList[n].value=[this.sampleName,this.sampleData],this.activity.blocks.blockList[n].text.text=this.sampleName,this.activity.blocks.blockList[n].updateCache()),null!=e&&(this.activity.blocks.blockList[e].value=this.samplePitch,this.activity.blocks.blockList[e].text.text=this.samplePitch,this.activity.blocks.blockList[e].updateCache()),null!=t&&(this.activity.blocks.blockList[t].value=this.sampleOctave,this.activity.blocks.blockList[t].text.text=this.sampleOctave,this.activity.blocks.blockList[t].updateCache()),this.centAdjustmentValue&&0!==this.centAdjustmentValue&&(n=(0<this.centAdjustmentValue?"+":"")+this.centAdjustmentValue+"¢",this.activity.blocks.blockList[i].text)&&this.activity.blocks.blockList[i].text.text&&(this.activity.blocks.blockList[i].text.text.includes("¢")||(this.activity.blocks.blockList[i].text.text+=" "+n)),this.activity.refreshCanvas(),this.activity.saveLocally())},this.pause=function(){this.playBtn.innerHTML='<img \n                src="header-icons/play-button.svg" \n                title="'.concat(_("Play"),'" \n                alt="').concat(_("Play"),'" \n                height="').concat(32,'" \n                width="').concat(32,'" \n                vertical-align="middle"\n            >'),this.isMoving=!1},this.resume=function(){this.playBtn.innerHTML='<img \n                src="header-icons/pause-button.svg" \n                title="'.concat(_("Pause"),'" \n                alt="').concat(_("Pause"),'" \n                height="').concat(32,'" \n                width="').concat(32,'" \n                vertical-align="middle"\n            >'),this.isMoving=!0},this._usePitch=function(e){e=a.indexOf(e);this.pitchCenter=-1==e?0:e},this._useAccidental=function(e){e=t.indexOf(e);this.accidentalCenter=-1===e?2:e},this._useOctave=function(e){this.octaveCenter=parseInt(e)},this.getSampleLength=function(){1333333<this.sampleData.length&&this.activity.errorMsg(_("Warning: Sample is bigger than 1MB."),this.timbreBlock)},this.displayRecordingStartMessage=function(){activity.textMsg(_("Recording started"),3e3)},this.displayRecordingStopMessage=function(){activity.textMsg(_("Recording complete"),3e3)},this.showSampleTypeError=function(){this.activity.errorMsg(_("Upload failed: Sample is not a .wav file."),this.timbreBlock)},this.__save=function(){var t=this;setTimeout(function(){t._addSample();var e=t.centAdjustmentValue||0,e=[[0,"settimbre",100,100,[null,1,null,5]],[1,["customsample",{value:[t.sampleName,t.sampleData,t.samplePitch,t.sampleOctave,e]}],100,100,[0,2,3,4]],[2,["audiofile",{value:[t.sampleName,t.sampleData]}],0,0,[1]],[3,["solfege",{value:t.samplePitch}],0,0,[1]],[4,["number",{value:t.sampleOctave}],0,0,[1]],[5,"hidden",0,0,[0,null]]];t.activity.blocks.loadNewBlocks(e),activity.textMsg(_("A new sample block was generated."),3e3)},1e3)},this._saveSample=function(){this.__save()},this._get_save_lock=function(){return this._save_lock},this.handleFiles=function(e){var t=new FileReader;t.readAsDataURL(e),t.onload=function(){"audio/wav"===t.result.substring(t.result.indexOf(":")+1,t.result.indexOf(";"))?t.result.length<=1333333?(c.sampleData=t.result,c.sampleName=e.name,c._addSample()):c.activity.errorMsg(_("Warning: Your sample cannot be loaded because it is >1MB."),c.timbreBlock):c.showSampleTypeError()},t.onloadend=function(){t.result&&(e.name,t.result)}},this.drag_and_drop=function(){var e=document.getElementsByClassName("samplerCanvas")[0];e.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("drop",function(e){e.preventDefault();e=e.dataTransfer.files[0];c.handleFiles(e)})},this.init=function(d,e){var p=this,a=(this.activity=d,this.timbreBlock=e,this.running=!0,this.originalSampleName="",this.isMoving=!1,this.drawVisualIDs={},window.widgetWindows.windowFor(this,"sampler","Sampler")),s=this,r=(a.onmaximize=function(){s._scale(),s._updateContainerPositions()},a.onrestore=function(){s._scale(),s._updateContainerPositions()},this._updateContainerPositions=function(){var e=docById("tunerContainer"),t=(docById("centAdjustmentContainer"),docById("centValueDisplay"));e&&(this.widgetWindow.isMaximized()?(e.style.marginTop="150px",e.style.marginLeft="auto",e.style.marginRight="auto",e.style.justifyContent="center"):(e.style.marginTop="100px",e.style.marginLeft="",e.style.marginRight="",e.style.justifyContent="")),t&&(this.widgetWindow.isMaximized()?(t.style.marginTop="50px",t.style.marginBottom="50px"):(t.style.marginTop="30px",t.style.marginBottom="30px"))},a.onclose=function(){if(p.drawVisualIDs)for(var e=0,t=Object.keys(p.drawVisualIDs);e<t.length;e++){var n=t[e];cancelAnimationFrame(p.drawVisualIDs[n])}p.running=!1,p.stopPitchDetection();var i=docById("wheelDiv");i&&"none"!==i.style.display&&(i.style.display="none",p._pitchWheel&&p._pitchWheel.removeWheel(),p._exitWheel&&p._exitWheel.removeWheel(),p._accidentalsWheel&&p._accidentalsWheel.removeWheel(),p._octavesWheel)&&p._octavesWheel.removeWheel(),docById("wheelDivptm").style.display="none",void 0!==p._pitchWheel&&p._pitchWheel.removeWheel(),void 0!==p._exitWheel&&p._exitWheel.removeWheel(),void 0!==p._accidentalsWheel&&p._accidentalsWheel.removeWheel(),void 0!==p._octavesWheel&&p._octavesWheel.removeWheel(),p.pitchAnalysers={},a.destroy()},this.playBtn=a.addButton("play-button.svg",32,_("Play")),this.playBtn.onclick=function(){o(),p.isMoving?p.pause():(""!=p.sampleName&&p.resume(),p._playReferencePitch())},a.addButton("load-media.svg",32,_("Upload sample"),"").onclick=function(){o();var n=docById("myOpenAll"),i=function(e){window.scroll(0,0);var t=n.files[0];s.handleFiles(t),n.removeEventListener("change",i)};n.addEventListener("change",i,!1),n.focus(),n.click(),window.scroll(0,0)},this.pitchBtnContainer=document.createElement("div"),this.pitchBtnContainer.className="wfbtItem",this.pitchBtnContainer.style.display="flex",this.pitchBtnContainer.style.flexDirection="column",this.pitchBtnContainer.style.alignItems="center",this.pitchBtnContainer.style.cursor="pointer",a._toolbar.appendChild(this.pitchBtnContainer),this.pitchBtn=document.createElement("input"),this.pitchBtn.value="C4",this.pitchBtnContainer.appendChild(this.pitchBtn),this.frequencyDisplay=document.createElement("div"),this.frequencyDisplay.style.fontSize="smaller",this.frequencyDisplay.style.textAlign="center",this.frequencyDisplay.style.color=platformColor.textColor,this.frequencyDisplay.textContent="261 Hz",this.pitchBtnContainer.appendChild(this.frequencyDisplay),this.pitchBtnContainer.onclick=function(){o(),p._createPieMenu()},this._save_lock=!1,a.addButton("export-chunk.svg",32,_("Save sample"),"").onclick=function(){o(),s._get_save_lock()||(s._save_lock=!0,s._saveSample(),setTimeout(function(){s._save_lock=!1},1e3))},this._recordBtn=a.addButton("mic.svg",32,_("Toggle Mic"),""),this._playbackBtn=a.addButton("playback.svg",32,_("Playback"),""),this._promptBtn=a.addButton("prompt.svg",32,_("Prompt"),""),!1),m=(this._promptBtn.onclick=function(){p.widgetWindow.clearScreen();var e=p.widgetWindow.isMaximized()?(i=p.widgetWindow.getWidgetBody().getBoundingClientRect().width,p.widgetWindow.getWidgetFrame().getBoundingClientRect().height-70):(i=800,400),t=["Birds chirping in the morning","Rain falling on a window","Waves crashing on some rocks","Cat meowing near a door","Dog barking in a park","Horse galloping in a field","Children laughing at a playground","Footsteps walking on wooden floor","Car honking on the street","Clock ticking in a quiet room"][Math.floor(10*Math.random())],n=document.createElement("div"),e=(n.id="samplerPrompt",p.widgetWindow.getWidgetBody().appendChild(n),n.style.height=e+"px",n.style.width=i+"px",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.justifyContent="center",n.style.gap="20px",document.createElement("h1")),a=(e.innerHTML="AI Sample Generation",e.style.fontSize="40px",e.style.marginTop="0",e.style.marginBottom="0px",e.style.fontWeight="200",document.createElement("textarea")),i=(a.style.height="200px",a.style.width="650px",a.style.fontSize="30px",a.style.resize="none",a.style.borderRadius="10px",a.style.border="none",a.style.padding="15px",a.placeholder=t,a.addEventListener("input",function(){s.disabled=!!r,o.disabled=!0,l.disabled=!0}),document.createElement("div")),s=(i.style.display="flex",i.style.justifyContent="space-between",i.style.width="650px",document.createElement("button")),o=(s.style.width="152px",s.style.height="61px",s.style.fontSize="32px",s.style.borderRadius="10px",s.style.border="none",s.style.cursor="pointer",s.innerHTML="Submit",s.onclick=_asyncToGenerator(_regenerator().m(function e(){var t,n,i;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return s.disabled=!0,n=a.value,n=encodeURIComponent(n),n="http://13.61.94.100:8000/generate?prompt=".concat(n),e.p=1,r=!0,d.textMsg(_("Generating Audio... (It may take up to 1 minute)"),2500),t=setInterval(function(){d.textMsg(_("Generating Audio..."),1e3)},5e3),e.n=2,fetch(n);case 2:return n=e.v,e.n=3,n.json();case 3:i=e.v,clearInterval(t),"success"===i.status?(r=!1,d.textMsg(_("Audio ready!"),3e3),o.disabled=!1,l.disabled=!1):(r=!1,d.textMsg(_("Failed to generate audio"),3e3)),e.n=5;break;case 4:e.p=4,r=!1,clearInterval(t),d.textMsg(_("Error occurred"),3e3),s.disabled=!1;case 5:return e.a(2)}},e,null,[[1,4]])})),document.createElement("button")),l=(o.style.width="152px",o.style.height="61px",o.style.fontSize="32px",o.style.borderRadius="10px",o.style.border="none",o.style.cursor="pointer",o.innerHTML="Preview",o.disabled=!0,o.onclick=function(){new Audio("http://13.61.94.100:8000/preview").play()},document.createElement("button"));l.style.width="152px",l.style.height="61px",l.style.fontSize="32px",l.style.borderRadius="10px",l.style.border="none",l.style.cursor="pointer",l.innerHTML="Save",l.disabled=!0,l.onclick=function(){var e=document.createElement("a");e.href="http://13.61.94.100:8000/save",e.download="output.wav",document.body.appendChild(e),e.click(),document.body.removeChild(e)},i.appendChild(s),i.appendChild(o),i.appendChild(l),n.appendChild(e),n.appendChild(a),n.appendChild(i)},this._playbackBtn.id="playbackBtn",this._playbackBtn.classList.add("disabled"),this.is_recording=!1,this.playback=!1,this._recordBtn.onclick=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(o(),p.is_recording){e.n=2;break}return e.n=1,p.activity.logo.synth.startRecording();case 1:p.is_recording=!0,p._recordBtn.getElementsByTagName("img")[0].src="header-icons/record.svg",p.displayRecordingStartMessage(),p.activity.logo.synth.LiveWaveForm(),e.n=4;break;case 2:return e.n=3,p.activity.logo.synth.stopRecording();case 3:p.recordingURL=e.v,p.is_recording=!1,p._recordBtn.getElementsByTagName("img")[0].src="header-icons/mic.svg",p.displayRecordingStopMessage(),p._playbackBtn.classList.remove("disabled");case 4:return e.a(2)}},e)})),this._playbackBtn.onclick=function(){o(),p.playback?(p.activity.logo.synth.stopPlayBackRecording(),p.playback=!1):(p.sampleData=p.recordingURL,p.sampleName="Recorded Audio ".concat(p.recordingURL),p._addSample(),p.activity.logo.synth.playRecording(),p.playback=!0)},this._tunerBtn=a.addButton("tuner.svg",32,_("Tuner"),""),!1),o=function(){var e;m&&(d.textMsg(_("Tuner stopped"),3e3),p.activity.logo.synth.stopTuner(),m=!1,e=docById("tunerContainer"))&&e.remove()};this._tunerBtn.onclick=_asyncToGenerator(_regenerator().m(function e(){var t,i,n,a,s,o,l,r,c,h,u;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(docById("tunerContainer")&&!m&&docById("tunerContainer").remove(),(t=docById("centAdjustmentContainer"))&&(t.remove(),p.centAdjustmentOn=!1),m){e.n=2;break}return m=!0,docByClass("samplerCanvas")[0].style.display="none",(t=document.createElement("div")).style.display="flex",t.id="tunerContainer",t.style.gap="10px",p.widgetWindow.isMaximized()?(t.style.marginTop="150px",t.style.marginLeft="auto",t.style.marginRight="auto",t.style.justifyContent="center"):t.style.marginTop="100px",(n=document.createElement("img")).setAttribute("src","header-icons/accidental-flat.svg"),n.style.height="40px",n.style.width="40px",n.style.marginTop="auto",t.appendChild(n),(i=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.width="350px",i.style.height="170px",t.appendChild(i),(n=document.createElement("img")).setAttribute("src","header-icons/accidental-sharp.svg"),n.style.height="40px",n.style.width="40px",n.style.marginTop="auto",t.appendChild(n),["M5.0064 173.531C2.24508 173.507 0.0184649 171.249 0.121197 168.49C0.579513 156.179 2.33654 143.951 5.36299 132.009C6.04138 129.332 8.81378 127.792 11.4701 128.546L57.9638 141.754C60.6202 142.508 62.1508 145.271 61.5107 147.958C59.8652 154.863 58.8534 161.905 58.488 168.995C58.3459 171.752 56.0992 173.973 53.3379 173.949L5.0064 173.531Z","M12.3057 125.699C9.66293 124.899 8.16276 122.104 9.03876 119.486C12.9468 107.802 18.0776 96.5645 24.3458 85.959C25.7508 83.5817 28.8448 82.885 31.181 84.3574L72.0707 110.128C74.4068 111.601 75.0971 114.683 73.7261 117.08C70.2017 123.243 67.2471 129.714 64.8991 136.414C63.9858 139.02 61.2047 140.517 58.5619 139.716L12.3057 125.699Z","M32.7848 81.8612C30.4747 80.3483 29.8225 77.2446 31.4008 74.9787C38.442 64.8698 46.5309 55.5326 55.5331 47.1225C57.551 45.2374 60.7159 45.4406 62.5426 47.5115L94.5158 83.7582C96.3425 85.8291 96.1364 88.981 94.1457 90.8948C89.0279 95.8148 84.3698 101.192 80.2295 106.958C78.619 109.202 75.5286 109.855 73.2186 108.342L32.7848 81.8612Z","M64.7847 45.5682C62.9944 43.4658 63.243 40.3041 65.3958 38.5746C74.9997 30.8588 85.3915 24.1786 96.3984 18.6454C98.8656 17.4051 101.845 18.4917 103.014 20.9933L123.481 64.7795C124.65 67.2812 123.564 70.2473 121.115 71.5228C114.819 74.8016 108.834 78.6484 103.237 83.0152C101.06 84.7138 97.9107 84.4699 96.1204 82.3675L64.7847 45.5682Z","M105.713 19.7604C104.588 17.2388 105.717 14.2752 108.27 13.2222C119.658 8.52459 131.511 5.04268 143.631 2.83441C146.348 2.33942 148.9 4.22142 149.318 6.95115L156.62 54.7298C157.037 57.4595 155.159 59.9997 152.45 60.5334C145.485 61.9056 138.659 63.9106 132.058 66.5236C129.491 67.54 126.538 66.4188 125.412 63.8972L105.713 19.7604Z","M152.254 6.52852C151.885 3.79193 153.803 1.26651 156.549 0.975363C168.8 -0.323498 181.154 -0.325115 193.405 0.97054C196.151 1.26096 198.07 3.78589 197.701 6.52258L191.247 54.423C190.878 57.1597 188.361 59.0681 185.611 58.8169C178.542 58.1712 171.428 58.1722 164.358 58.8197C161.608 59.0716 159.091 57.1639 158.721 54.4273L152.254 6.52852Z","M200.638 6.94443C201.055 4.21459 203.607 2.33193 206.324 2.82621C218.444 5.0313 230.298 8.51011 241.688 13.2047C244.241 14.257 245.371 17.2203 244.246 19.7423L224.559 63.8842C223.434 66.4062 220.481 67.5281 217.913 66.5124C211.312 63.9011 204.486 61.8978 197.52 60.5275C194.811 59.9945 192.933 57.4548 193.349 54.7249L200.638 6.94443Z","M246.945 20.9745C248.114 18.4725 251.093 17.3851 253.561 18.6248C264.569 24.1552 274.963 30.8326 284.569 38.5459C286.722 40.2748 286.971 43.4365 285.181 45.5394L253.855 82.3468C252.066 84.4497 248.916 84.6944 246.739 82.9964C241.14 78.6311 235.155 74.7859 228.858 71.5087C226.408 70.2339 225.322 67.268 226.49 64.766L246.945 20.9745Z","M287.424 47.482C289.25 45.4107 292.415 45.2066 294.433 47.0913C303.438 55.499 311.529 64.8341 318.573 74.9411C320.152 77.2066 319.501 80.3105 317.191 81.824L276.764 108.315C274.454 109.829 271.364 109.176 269.753 106.934C265.611 101.168 260.951 95.7923 255.832 90.8736C253.841 88.9604 253.634 85.8085 255.46 83.7371L287.424 47.482Z","M318.795 84.3198C321.131 82.8468 324.225 83.5427 325.631 85.9196C331.902 96.5235 337.036 107.76 340.947 119.442C341.823 122.061 340.324 124.855 337.681 125.657L291.429 139.686C288.786 140.487 286.005 138.991 285.091 136.385C282.741 129.686 279.785 123.215 276.259 117.054C274.887 114.657 275.577 111.574 277.912 110.101L318.795 84.3198Z","M338.518 128.503C341.174 127.748 343.947 129.288 344.626 131.964C347.655 143.905 349.416 156.133 349.877 168.444C349.981 171.203 347.755 173.462 344.993 173.487L296.662 173.917C293.901 173.942 291.653 171.722 291.51 168.964C291.143 161.875 290.13 154.833 288.482 147.928C287.841 145.242 289.371 142.478 292.027 141.723L338.518 128.503Z"].forEach(function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",e),n.setAttribute("fill","#808080"),i.appendChild(n)}),(n=document.createElement("div")).id="modeToggle",n.style.position="absolute",n.style.top="30px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.display="flex",n.style.backgroundColor="#FFFFFF",n.style.borderRadius="25px",n.style.padding="3px",n.style.boxShadow="0 2px 8px rgba(0,0,0,0.1)",n.style.width="120px",n.style.height="44px",n.style.cursor="pointer",(a=document.createElement("div")).style.flex="1",a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center",a.style.borderRadius="22px",a.style.cursor="pointer",a.style.transition="all 0.2s ease",a.style.userSelect="none",a.title=_("Chromatic"),(s=document.createElement("div")).style.flex="1",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.borderRadius="22px",s.style.cursor="pointer",s.style.transition="all 0.2s ease",s.style.userSelect="none",s.title=_("Target pitch"),(o=document.createElement("img")).src="header-icons/chromatic-mode.svg",o.style.width="32px",o.style.height="32px",o.style.filter="brightness(0)",o.style.pointerEvents="none",(l=document.createElement("img")).src="header-icons/target-pitch-mode.svg",l.style.width="32px",l.style.height="32px",l.style.filter="brightness(0)",l.style.pointerEvents="none",r="chromatic",c=function(){"chromatic"===r?(a.style.backgroundColor="#A6CEFF",s.style.backgroundColor="#FFFFFF"):(a.style.backgroundColor="#FFFFFF",s.style.backgroundColor="#A6CEFF")},h=!0,u=function(e){h&&(h=!1,r=e,c(),setTimeout(function(){h=!0},200))},a.onclick=function(){return u("chromatic")},s.onclick=function(){return u("target")},a.appendChild(o),s.appendChild(l),n.appendChild(a),n.appendChild(s),c(),t.appendChild(n),p.widgetWindow.getWidgetBody().appendChild(t),e.n=1,p.activity.logo.synth.startTuner();case 1:d.textMsg(_("Tuner started"),3e3),e.n=3;break;case 2:d.textMsg(_("Tuner stopped"),3e3),p.activity.logo.synth.stopTuner(),m=!1;case 3:return e.a(2)}},e)})),this.centsSliderBtn=a.addButton("slider.svg",32,_("Cents Adjustment"),""),this.centsSliderBtn.onclick=function(){o();var t,n,e,i,a,s=docById("centAdjustmentContainer");s?(s.remove(),p.centAdjustmentOn=!1,(s=docByClass("samplerCanvas")[0])&&(s.style.display="block")):((s=docById("tunerContainer"))&&(s.remove(),p.activity.logo.synth.stopTuner(),m=!1),p.centAdjustmentOn?(p.centAdjustmentOn=!1,(s=docById("centAdjustmentContainer"))&&s.remove(),(s=docByClass("samplerCanvas")[0])&&(s.style.display="block")):(p.centAdjustmentOn=!0,(s=docByClass("samplerCanvas")[0])&&(s.style.display="none"),(s=document.createElement("div")).id="centAdjustmentContainer",s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.backgroundColor="#d8d8d8",s.style.zIndex="1000",(t=document.createElement("div")).id="centValueDisplay",t.textContent=(0<=p.centAdjustmentValue?"+":"")+(p.centAdjustmentValue||0)+"¢",t.style.fontSize="24px",t.style.fontWeight="bold",t.style.textAlign="center",p.widgetWindow.isMaximized()?(t.style.marginTop="50px",t.style.marginBottom="50px"):(t.style.marginTop="30px",t.style.marginBottom="30px"),s.appendChild(t),i=document.createElement("div"),p.widgetWindow.isMaximized()?(i.style.width="60%",i.style.margin="0 auto 30px auto"):(i.style.width="80%",i.style.margin="0 auto"),n=document.createElement("input"),Object.assign(n,{type:"range",min:-50,max:50,value:p.centAdjustmentValue||0,step:1}),Object.assign(n.style,{width:"100%",height:"20px",WebkitAppearance:"none",background:"#4CAF50",outline:"none",borderRadius:"10px",cursor:"pointer",opacity:"0.8"}),(e=document.createElement("style")).textContent="\n                    input[type=range]::-webkit-slider-thumb {\n                        -webkit-appearance: none;\n                        width: 25px;\n                        height: 25px;\n                        background: #2196F3;\n                        border-radius: 50%;\n                        cursor: pointer;\n                        transition: all .2s ease-in-out;\n                    }\n                    input[type=range]::-webkit-slider-thumb:hover {\n                        transform: scale(1.1);\n                    }\n                    input[type=range]::-moz-range-thumb {\n                        width: 25px;\n                        height: 25px;\n                        background: #2196F3;\n                        border-radius: 50%;\n                        cursor: pointer;\n                        border: none;\n                        transition: all .2s ease-in-out;\n                    }\n                    input[type=range]::-moz-range-thumb:hover {\n                        transform: scale(1.1);\n                    }\n                ",document.head.appendChild(e),i.appendChild(n),s.appendChild(i),e=document.createElement("div"),p.widgetWindow.isMaximized()?e.style.width="60%":e.style.width="80%",e.style.display="flex",e.style.justifyContent="space-between",e.style.margin="10px auto",(i=document.createElement("span")).textContent="-50¢",i.style.fontWeight="bold",(a=document.createElement("span")).textContent="+50¢",a.style.fontWeight="bold",e.appendChild(i),e.appendChild(a),s.appendChild(e),(i=document.createElement("div")).style.textAlign="center",i.style.marginTop="30px",(a=document.createElement("button")).textContent=_("Reset"),a.style.padding="10px 20px",a.style.backgroundColor="#808080",a.style.color="white",a.style.border="none",a.style.borderRadius="5px",a.style.cursor="pointer",a.style.fontSize="16px",a.onclick=function(){p.centAdjustmentValue=0,t.textContent="0¢",n.value=0,p.applyCentAdjustment(0)},i.appendChild(a),s.appendChild(i),p.widgetWindow.getWidgetBody().appendChild(s),n.oninput=function(){var e=parseInt(n.value);p.centAdjustmentValue=e,t.textContent=(0<=e?"+":"")+e+"¢",p.applyCentAdjustment(e)}))},a.sendToCenter(),this.widgetWindow=a,this._scale(),this._parseSamplePitch(),this.getPitchName(),this.setTimbre(),d.textMsg(_("Upload a sample and adjust its pitch center."),3e3),this.pause(),a.sendToCenter(),this.drag_and_drop()},this._addSample=function(){for(var e=0;e<CUSTOMSAMPLES.length;e++)if(CUSTOMSAMPLES[e][0]==this.sampleName)return void(CUSTOMSAMPLES[e]=[this.sampleName,this.sampleData,this.samplePitch,this.sampleOctave,this.centAdjustmentValue||0]);CUSTOMSAMPLES.push([this.sampleName,this.sampleData,this.samplePitch,this.sampleOctave,this.centAdjustmentValue||0])},this._parseSamplePitch=function(){var e=this.samplePitch.substring(0,2),e=(this.pitchCenter="so"===e?4:a.indexOf(e),this.samplePitch),e=-1!=e.indexOf(SHARP)?1:-1!=e.indexOf(FLAT)?-1:-1!=e.indexOf(DOUBLEFLAT)?-2:-1!=e.indexOf(DOUBLESHARP)?2:0;this.accidentalCenter=e+2,this.octaveCenter=this.sampleOctave},this._calculateFrequency=function(){var e=0,e=(e+=isNaN(this.octaveCenter)?0:12*this.octaveCenter)+(isNaN(this.pitchCenter)?0:o[this.pitchCenter])+(isNaN(this.accidentalCenter)?0:this.accidentalCenter-2)-57;return Math.floor(440*Math.pow(2,e/12))},this._updateSamplePitchValues=function(){this.samplePitch=a[this.pitchCenter]+n[this.accidentalCenter],this.sampleOctave=this.octaveCenter.toString()},this.setTimbre=function(){var e;null!=this.sampleName&&""!=this.sampleName&&(this.originalSampleName=this.sampleName+"_original",e=[this.originalSampleName,this.sampleData,"la",4],Singer.ToneActions.setTimbre(e,0,this.timbreBlock))},this._playReferencePitch=function(){this._updateSamplePitchValues(),this._updateBlocks();var e=0,e=(e+=isNaN(this.octaveCenter)?0:12*this.octaveCenter)+(isNaN(this.pitchCenter)?0:o[this.pitchCenter])+(isNaN(this.accidentalCenter)?0:this.accidentalCenter-2)-57,e=Math.floor(440*Math.pow(2,e/12));this.activity.logo.synth.trigger(0,[e],.5,l,null,null,!1),this.setTimbre(),this._playDelayedSample()},this._playSample=function(){var e,t;null!=this.sampleName&&""!=this.sampleName&&(this.reconnectSynthsToAnalyser(),e=this._calculateFrequency(),this.currentNoteObj=TunerUtils.frequencyToPitch(e),e="customsample_"+this.originalSampleName,instruments[0][e]||this.activity.logo.synth.loadSynth(0,e),instruments[0][e]&&(this.player=instruments[0][e]),t=220,0!==this.centAdjustmentValue&&(t=220*Math.pow(2,this.centAdjustmentValue/1200)),this.activity.logo.synth.trigger(0,[t],this.sampleLength/1e3,e,null,null,!1))},this._waitAndPlaySample=function(){var t=this;return new Promise(function(e){setTimeout(function(){t._playSample(),e("played"),t._endPlaying()},500)})},this._playDelayedSample=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._waitAndPlaySample();case 1:return e.a(2)}},e,this)})),this._waitAndEndPlaying=function(){var t=this;return new Promise(function(e){setTimeout(function(){t.pause(),e("ended")},t.sampleLength)})},this._endPlaying=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._waitAndEndPlaying();case 1:return e.a(2)}},e,this)})),this.reconnectSynthsToAnalyser=function(){for(var e in[0,1])void 0===this.pitchAnalysers[e]&&(this.pitchAnalysers[e]=new Tone.Analyser({type:"waveform",size:8192}));for(var t in instruments[0]){var n=1;t===l&&(n=0,instruments[0][t].connect(this.pitchAnalysers[n])),t==="customsample_"+this.originalSampleName&&(n=1,instruments[0][t].connect(this.pitchAnalysers[n]))}},this._createPieMenu=function(){for(var e,i=this,t=(docById("wheelDivptm").style.display="",["𝄪","♯","♮","♭","𝄫"]),n=["ti","la","sol","fa","mi","re","do"],a=[],s=0;s<DRUMS.length;s++)e=_(DRUMS[s]),a.push(e);this._pitchWheel=new wheelnav("wheelDivptm",null,600,600),this._exitWheel=new wheelnav("_exitWheel",this._pitchWheel.raphael),this._accidentalsWheel=new wheelnav("_accidentalsWheel",this._pitchWheel.raphael),this._octavesWheel=new wheelnav("_octavesWheel",this._pitchWheel.raphael),wheelnav.cssMode=!0,this._pitchWheel.keynavigateEnabled=!1,this._pitchWheel.slicePathFunction=slicePath().DonutSlice,this._pitchWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._pitchWheel.colors=platformColor.pitchWheelcolors,this._pitchWheel.slicePathCustom.minRadiusPercent=.2,this._pitchWheel.slicePathCustom.maxRadiusPercent=.5,this._pitchWheel.sliceSelectedPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.sliceInitPathCustom=this._pitchWheel.slicePathCustom,this._pitchWheel.animatetime=0,this._pitchWheel.createWheel(n),this._exitWheel.colors=platformColor.exitWheelcolors,this._exitWheel.slicePathFunction=slicePath().DonutSlice,this._exitWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._exitWheel.slicePathCustom.minRadiusPercent=0,this._exitWheel.slicePathCustom.maxRadiusPercent=.2,this._exitWheel.sliceSelectedPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.sliceInitPathCustom=this._exitWheel.slicePathCustom,this._exitWheel.clickModeRotate=!1,this._exitWheel.createWheel(["×"," "]),this._accidentalsWheel.colors=platformColor.accidentalsWheelcolors,this._accidentalsWheel.slicePathFunction=slicePath().DonutSlice,this._accidentalsWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._accidentalsWheel.slicePathCustom.minRadiusPercent=.5,this._accidentalsWheel.slicePathCustom.maxRadiusPercent=.75,this._accidentalsWheel.sliceSelectedPathCustom=this._accidentalsWheel.slicePathCustom,this._accidentalsWheel.sliceInitPathCustom=this._accidentalsWheel.slicePathCustom;for(var o=[],l=0;l<t.length;l++)o.push(t[l]);for(var r=0;r<9;r++)o.push(null),this._accidentalsWheel.colors.push(platformColor.accidentalsWheelcolorspush);this._accidentalsWheel.animatetime=0,this._accidentalsWheel.createWheel(o),this._accidentalsWheel.setTooltips([_("double sharp"),_("sharp"),_("natural"),_("flat"),_("double flat")]),this._octavesWheel.colors=platformColor.octavesWheelcolors,this._octavesWheel.slicePathFunction=slicePath().DonutSlice,this._octavesWheel.slicePathCustom=slicePath().DonutSliceCustomization(),this._octavesWheel.slicePathCustom.minRadiusPercent=.75,this._octavesWheel.slicePathCustom.maxRadiusPercent=.95,this._octavesWheel.sliceSelectedPathCustom=this._octavesWheel.slicePathCustom,this._octavesWheel.sliceInitPathCustom=this._octavesWheel.slicePathCustom;for(var c=["8","7","6","5","4","3","2","1",null,null,null,null,null,null],h=(this._octavesWheel.animatetime=0,this._octavesWheel.createWheel(c),this.pitchBtn.getBoundingClientRect().x),u=this.pitchBtn.getBoundingClientRect().y,h=(docById("wheelDivptm").style.position="absolute",docById("wheelDivptm").style.height="300px",docById("wheelDivptm").style.width="300px",docById("wheelDivptm").style.left=Math.min(this.activity.canvas.width-200,Math.max(0,h*this.activity.getStageScale()))+"px",docById("wheelDivptm").style.top=Math.min(this.activity.canvas.height-250,Math.max(0,u*this.activity.getStageScale()))+"px",this.octaveCenter),u=4-this.accidentalCenter,d=6-this.pitchCenter,p=(this._accidentalsWheel.navigateWheel(u),this._octavesWheel.navigateWheel(c.indexOf(h.toString())),this._pitchWheel.navigateWheel(d),this._exitWheel.navItems[0].navigateFunction=function(){docById("wheelDivptm").style.display="none",i._pitchWheel.removeWheel(),i._exitWheel.removeWheel(),i._accidentalsWheel.removeWheel(),i._octavesWheel.removeWheel()},function(){var e=i._pitchWheel.navItems[i._pitchWheel.selectedNavItemIndex].title,t=i._accidentalsWheel.navItems[i._accidentalsWheel.selectedNavItemIndex].title,n=Number(i._octavesWheel.navItems[i._octavesWheel.selectedNavItemIndex].title);i._usePitch(e),i._useAccidental(t),i._useOctave(n),i.getPitchName()}),m=function(){p(),i._playReferencePitch()},y=0;y<n.length;y++)this._pitchWheel.navItems[y].navigateFunction=m;for(var g=0;g<t.length;g++)this._accidentalsWheel.navItems[g].navigateFunction=m;for(var v=0;v<8;v++)this._octavesWheel.navItems[v].navigateFunction=m},this.getPitchName=function(){var e="",e=s[this.pitchCenter],e=(e=(e+=n[this.accidentalCenter])+this.octaveCenter.toString(),this.pitchName=e,this._calculateFrequency());return this.pitchBtn.value=this.pitchName,this.frequencyDisplay.textContent=e+" Hz",this.pitchName},this._scale=function(){var e,t=this,n=document.getElementsByClassName("samplerCanvas");Array.prototype.forEach.call(n,function(e){t.widgetWindow.getWidgetBody().removeChild(e)}),n=this.widgetWindow.isMaximized()?(e=this.widgetWindow.getWidgetBody().getBoundingClientRect().width,this.widgetWindow.getWidgetFrame().getBoundingClientRect().height-70):(e=800,400),document.getElementsByTagName("canvas")[0].innerHTML="",this.makeCanvas(e,n,0,!0),this.reconnectSynthsToAnalyser()},this.makeCanvas=function(u,d,p,m){var e,t,y=this,g=document.createElement("canvas"),v=(g.height=d,g.width=u,g.className="samplerCanvas",this.widgetWindow.getWidgetBody().appendChild(g),g.getContext("2d")),f=(v.clearRect(0,0,u,d),this.tunerEnabled?((e=document.createElement("canvas")).height=Math.min(200,.4*d),e.width=Math.min(200,.8*u),e.className="tunerCanvas",e.style.position="absolute",e.style.top="10px",e.style.left=(u-e.width)/2+"px",this.widgetWindow.getWidgetBody().appendChild(e),this.tunerDisplay?(this.tunerDisplay.canvas=e,this.tunerDisplay.width=e.width,this.tunerDisplay.height=e.height):this.tunerDisplay=new TunerDisplay(e,e.width,e.height),t=TunerUtils.frequencyToPitch(A0*Math.pow(2,(pitchToNumber(a[this.pitchCenter]+n[this.accidentalCenter],this.octaveCenter)-57)/12)),this.tunerDisplay.update(t[0],t[1],this.centsValue),g.height=d-e.height-20,g.style.marginTop=e.height+20+"px"):this.tunerDisplay&&((t=document.getElementsByClassName("tunerCanvas")[0])&&t.parentNode.removeChild(t),this.tunerDisplay=null),function(){if(y.drawVisualIDs[p]=requestAnimationFrame(f),y.is_recording||y.pitchAnalysers[p]&&(y.running||m)){v.fillStyle="#FFFFFF",v.font="10px Verdana",y.verticalOffset=-g.height/4,y.zoomFactor=40,v.fillRect(0,0,u,d),0<=p&&(e=""!=y.sampleName?y.sampleName:_("sample")),v.fillStyle="#000000",v.fillText(_("reference tone"),10,10),v.fillText(e,10,g.height/2+10);for(var e,t,n,i=0;i<2;i+=1){for(var a=void 0,s=(a=y.is_recording?0===i?y.pitchAnalysers[0].getValue():y.activity.logo.synth.getWaveFormValues():y.pitchAnalysers[i].getValue()).length,o=C[i],l=u*y.zoomFactor/s,r=(v.lineWidth=2,v.strokeStyle=o,v.beginPath(),0),c=0;c<s;c++){var h=d/2*(1-a[c])+y.verticalOffset;0===c?v.moveTo(r,h):v.lineTo(r,h),r+=l}v.lineTo(g.width,g.height/2),v.stroke(),y.verticalOffset=g.height/4}y.tunerEnabled&&y.tunerDisplay&&y.pitchAnalysers[1]&&y.sampleName&&(e=y.pitchAnalysers[1].getValue())&&0<e.length&&0<(e=detectPitch(e))&&(t=(e=b(e)).note,y.tunerDisplay.update(t,n=e.cents,y.centsValue),document.querySelectorAll("#tunerContainer svg path").forEach(function(e,t){t=10*(t-5);Math.abs(n-t)<=5?e.setAttribute("fill","#00ff00"):n<t?e.setAttribute("fill","#ff0000"):e.setAttribute("fill","#0000ff")}))}});f()},this.toggleTuner=function(){this.tunerEnabled=!this.tunerEnabled,this.tunerEnabled?this._tunerBtn.getElementsByTagName("img")[0].src="header-icons/tuner-active.svg":this._tunerBtn.getElementsByTagName("img")[0].src="header-icons/tuner.svg",this._scale()},this.applyCentsAdjustment=function(){var e;this.sampleName&&""!==this.sampleName&&(e=TunerUtils.calculatePlaybackRate(0,this.centsValue),instruments[0]["customsample_"+this.originalSampleName])&&(instruments[0]["customsample_"+this.originalSampleName].playbackRate.value=e)},function(e){var t,n,i;return e<=0?{note:"---",cents:0}:(t=69+12*Math.log2(e/440),n=(t=Math.round(t))%12,i=Math.floor(t/12)-1,n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n]+i,i=440*Math.pow(2,(t-69)/12),{note:n,cents:Math.round(1200*Math.log2(e/i))})}),r=(this.stopPitchDetection=function(){c.isPitchDetectionRunning=!1,null!==c.pitchDetectionAnimationId&&(cancelAnimationFrame(c.pitchDetectionAnimationId),c.pitchDetectionAnimationId=null),null!==c.pitchDetectionStream&&(c.pitchDetectionStream.getTracks().forEach(function(e){return e.stop()}),c.pitchDetectionStream=null),null!==c.pitchDetectionAudioContext&&(c.pitchDetectionAudioContext.close().catch(function(e){console.debug("AudioContext close error (may already be closed):",e)}),c.pitchDetectionAudioContext=null)},(()=>{var e=_asyncToGenerator(_regenerator().m(function e(){var t,s,o,l,r,n;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return c.stopPitchDetection(),e.p=1,t=new AudioContext,c.pitchDetectionAudioContext=t,e.n=2,navigator.mediaDevices.getUserMedia({audio:!0});case 2:n=e.v,c.pitchDetectionStream=n,n=t.createMediaStreamSource(n),(s=t.createAnalyser()).fftSize=4096,n.connect(s),n=t.sampleRate,o=new Float32Array(2048),l=i(n,2048),c.isPitchDetectionRunning=!0,r=function(){var e,t,n,i,a;c.isPitchDetectionRunning&&(s.getFloatTimeDomainData(o),e=l(o),t=document.getElementById("pitch"),n=document.getElementById("note"),t&&n&&(0<e?(i=(a=b(e)).note,a=a.cents,t.textContent=e.toFixed(2),n.textContent=0===a?" ".concat(i," (Perfect)"):" ".concat(i,", off by ").concat(a," cents")):(t.textContent="---",n.textContent="---")),c.isPitchDetectionRunning)&&(c.pitchDetectionAnimationId=requestAnimationFrame(r))},c.pitchDetectionAnimationId=requestAnimationFrame(r),e.n=4;break;case 3:e.p=3,n=e.v,console.error("".concat(n.name,": ").concat(n.message)),alert("Microphone access failed: "+n.message),c.stopPitchDetection();case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}})());this.makeTuner=function(e,t){var n=document.createElement("div"),t=(n.className="tuner-container",n.style.height=t+"px",n.style.width=e+"px",n.style.position="relative",n.style.backgroundColor="#f5f5f5",n.style.borderRadius="8px",n.style.padding="20px",n.style.boxSizing="border-box",document.createElement("h1")),e=(t.textContent="Tuner",t.style.textAlign="center",t.style.marginBottom="20px",document.createElement("button")),i=(e.id="start",e.textContent="Start",e.style.display="block",e.style.margin="0 auto 20px",e.style.padding="10px 20px",e.style.fontSize="16px",e.style.cursor="pointer",document.createElement("p")),a=(i.textContent="Detected Pitch: ",i.style.textAlign="center",i.style.fontSize="18px",document.createElement("span")),s=(a.id="pitch",a.textContent="---",document.createElement("p")),o=(s.textContent="Note: ",s.style.textAlign="center",s.style.fontSize="18px",document.createElement("span"));o.id="note",o.textContent="---",i.appendChild(a),s.appendChild(o),n.appendChild(t),n.appendChild(e),n.appendChild(i),n.appendChild(s),c.widgetWindow.getWidgetBody().appendChild(n),document.getElementById("start").addEventListener("click",r)},this.applyCentAdjustment=function(e){var t,n=this,e=(this.centAdjustmentValue=e,Math.pow(2,e/1200));this.sampleName&&""!==this.sampleName&&this.originalSampleName&&(t="customsample_"+this.originalSampleName,"undefined"!=typeof instruments&&instruments[0]&&instruments[0][t]&&instruments[0][t].playbackRate?instruments[0][t].playbackRate.value=e:console.log("Instrument not found, will apply cent adjustment during playback")),this.isMoving&&(this.pause(),setTimeout(function(){n._playReferencePitch()},100))}}var PitchSmoother=(()=>_createClass(function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:5;_classCallCheck(this,e),this.pitchHistory=[],this.smoothingSize=t},[{key:"addPitch",value:function(e){0<e&&(this.pitchHistory.push(e),this.pitchHistory.length>this.smoothingSize)&&this.pitchHistory.shift()}},{key:"getSmoothedPitch",value:function(){var t,n,i,e;return 0===this.pitchHistory.length||(e=_toConsumableArray(this.pitchHistory).sort(function(e,t){return e-t}),t=e[Math.floor(e.length/4)],n=e[Math.floor(3*e.length/4)],i=n-t,0===(e=this.pitchHistory.filter(function(e){return t-1.5*i<=e&&e<=n+1.5*i})).length)?-1:e.reduce(function(e,t){return e+t})/e.length}},{key:"reset",value:function(){this.pitchHistory=[]}}]))();
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var StatsWindow=(()=>_createClass(function t(e){var i=this;_classCallCheck(this,t),this.activity=e,this.isOpen=!0,this.widgetWindow=window.widgetWindows.windowFor(this,"stats","stats"),this.widgetWindow.clear(),this.widgetWindow.show(),this.widgetWindow.onclose=function(){i.isOpen=!1,i.activity.blocks.showBlocks(),i.widgetWindow.destroy(),i.activity.logo.statsWindow=null},this.doAnalytics(),this.widgetWindow.onmaximize=function(){i.widgetWindow.getWidgetBody().innerHTML="",i.widgetWindow.isMaximized()?(i.widgetWindow.getWidgetBody().style.display="flex",i.widgetWindow.getWidgetBody().style.justifyContent="space-between",i.widgetWindow.getWidgetBody().style.padding="0 2vw"):i.widgetWindow.getWidgetBody().style.padding="0 0",i.doAnalytics()},this.widgetWindow.sendToCenter()},[{key:"doAnalytics",value:function(){var i=this;this.activity.blocks.activeBlock=null;var t=docById("myChart").getContext("2d"),o=(this.activity.loading=!0,document.body.style.cursor="wait",null),e=analyzeProject(this.activity),e=(runAnalytics(this.activity),scoreToChartData(e)),n=getChartOptions(function(){var t=o.toBase64Image(),e=new Image;e.src=t,i.widgetWindow.isMaximized()?e.width=i.widgetWindow.getWidgetFrame().getBoundingClientRect().height-80:e.width=200,i.widgetWindow.getWidgetBody().appendChild(e),i.activity.blocks.hideBlocks(),i.activity.showBlocksAfterRun=!1,document.body.style.cursor="default"}),o=new Chart(t).Radar(e,n);this.jsonObject=document.createElement("ul"),this.jsonObject.style.float="left",this.widgetWindow.getWidgetBody().appendChild(this.jsonObject)}},{key:"displayInfo",value:function(t){var e=t.lowestNote[2]+.5,i=t.highestNote[2]+.5;this.jsonObject.innerHTML="<li>duples: ".concat(t.duples,"</li>\n            <li>triplets: ").concat(t.triplets,"</li>\n            <li>quintuplets: ").concat(t.quintuplets,'</li>\n            <li style="white-space: pre-wrap; width: 150px">pitch names: ').concat(Array.from(t.pitchNames).join(", "),"</li>\n            <li>number of notes: ").concat(t.numberOfNotes,'</li>\n            <li style="white-space: pre-wrap; width: 150px">lowest note: ').concat(t.lowestNote[0],",").concat(e.toFixed(0),'Hz</li>\n            <li style="white-space: pre-wrap; width: 150px">highest note: ').concat(t.highestNote[0],",").concat(i.toFixed(0),"Hz</li>\n            <li>rests used: ").concat(t.rests,"</li>\n            <li>ornaments used: ").concat(t.ornaments,"</li>")}}]))();
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var i,r,a,o,n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return a=!(r=!0),{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){a=!0,i=t},f:function(){try{r||null==n.return||n.return()}finally{if(a)throw i}}};if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return n&&(t=n),o=0,{s:e=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var i;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(i="Object"===(i={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var StatusMatrix=(()=>{function h(){_classCallCheck(this,h)}return _createClass(h,[{key:"init",value:function(t){var e,r,a=this,o=(this.activity=t,this.isOpen=!0,this.isMaximized=!1,this._cellScale=window.innerWidth/1200,this._cellScale,this.widgetWindow=window.widgetWindows.windowFor(this,"status","status"),this.widgetWindow.clear(),this.widgetWindow.show(),this._statusTable=document.createElement("table"),this.widgetWindow.getWidgetBody().append(this._statusTable),this.widgetWindow.onclose=function(){a.isOpen=!1,a.widgetWindow.destroy()},this._statusTable.createTHead()),i=o.insertRow(),n=Math.floor(24*this._cellScale),l=((y=i.insertCell()).style.backgroundColor="#FFFFFF",y.className="headcol",y.style.height=Math.floor(MATRIXBUTTONHEIGHT*this._cellScale)+"px",y.style.width="212.5px",y.innerHTML="&nbsp;",_createForOfIteratorHelper(this.activity.turtles.turtleList));try{for(l.s();!(e=l.n()).done;){var s=e.value;s.inTrash||((y=i.insertCell()).style.backgroundColor="#FFFFFF",_THIS_IS_MUSIC_BLOCKS_?y.innerHTML='&nbsp;&nbsp;<img \n                        src="images/mouse.svg" \n                        title="'.concat(s.name,'" \n                        alt="').concat(s.name,'" \n                        height="').concat(n,'" \n                        width="').concat(n,'"\n                    >&nbsp;&nbsp;'):y.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/turtle-button.svg" \n                        title="'.concat(s.name,'" \n                        alt="').concat(s.name,'" \n                        height="').concat(n,'"\n                        width="').concat(n,'"\n                    >&nbsp;&nbsp;'),y.style.width="212.5px",this.widgetWindow.onmaximize=function(){a.isMaximized=!a.isMaximized,y.style.width="100vw",y.style.paddingLeft="30px",y.style.fontSize=.9*Math.floor(a._cellScale*h.FONTSCALEFACTOR)+"%",a.isMaximized||(y.style.width="212.5px")},y.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+"px",y.className="headcol")}}catch(t){l.e(t)}finally{l.f()}var c,u,y,f=_createForOfIteratorHelper(this.activity.logo.statusFields);try{for(f.s();!(c=f.n()).done;)(()=>{var t=c.value,e=o.insertRow();switch((y=e.insertCell()).style.fontSize=.9*Math.floor(a._cellScale*h.FONTSCALEFACTOR)+"%",t[1]){case"plus":case"minus":case"neg":case"divide":case"power":case"multiply":case"sqrt":case"int":case"mod":r="";break;case"namedbox":r=a.activity.blocks.blockList[t[0]].privateData;break;case"heap":r=_("heap");break;case"bpm":case"bpmfactor":r="ja"===localStorage.languagePreference?_("beats per minute2"):a.activity.blocks.blockList[t[0]].protoblock.staticLabels[0];break;case"outputtools":r=a.activity.blocks.blockList[t[0]].privateData;break;default:r=a.activity.blocks.blockList[t[0]].protoblock.staticLabels[0]}var i=r.charAt(0).toUpperCase()+r.slice(1);y.innerHTML="&nbsp;<b>".concat(i,"</b>"),y.style.height=Math.floor(MATRIXBUTTONHEIGHT*a._cellScale)+"px",y.style.backgroundColor=platformColor.selectorBackground,y.style.paddingLeft="10px",a.activity.turtles.turtleList.forEach(function(){(y=e.insertCell()).style.backgroundColor=platformColor.selectorBackground,y.style.fontSize=.9*Math.floor(a._cellScale*h.FONTSCALEFACTOR)+"%",y.innerHTML="",y.style.height=Math.floor(MATRIXSOLFEHEIGHT*a._cellScale)+"px",y.style.textAlign="center"})})()}catch(t){f.e(t)}finally{f.f()}_THIS_IS_MUSIC_BLOCKS_&&(u=o.insertRow(),(y=u.insertCell()).style.fontSize=.9*Math.floor(this._cellScale*h.FONTSCALEFACTOR)+"%",t=(t=_("note")).charAt(0).toUpperCase()+t.slice(1),y.innerHTML="&nbsp;<b>".concat(t,"</b>"),y.style.height=Math.floor(MATRIXBUTTONHEIGHT*this._cellScale)+"px",y.style.backgroundColor=platformColor.selectorBackground,y.style.paddingLeft="10px",this.activity.turtles.turtleList.forEach(function(){(y=u.insertCell()).style.backgroundColor=platformColor.selectorBackground,y.style.fontSize=.9*Math.floor(a._cellScale*h.FONTSCALEFACTOR)+"%",y.innerHTML="",y.style.height=Math.floor(MATRIXSOLFEHEIGHT*a._cellScale)+"px",y.style.textAlign="center"})),this.widgetWindow.sendToCenter()}},{key:"updateAll",value:function(){this.activity.logo.updatingStatusMatrix=!0;var t,e,i=0,r=0,a=_createForOfIteratorHelper(this.activity.turtles.turtleList);try{for(a.s();!(e=a.n()).done;){var o=e.value,n=this.activity.turtles.ithTurtle(r);if(!o.inTrash){var l,s,c,u,y,f=void 0,h=void 0,d=void 0,b=0,p=_createForOfIteratorHelper(this.activity.logo.statusFields);try{for(p.s();!(y=p.n()).done;){var v=y.value,g=this.activity.logo.inStatusMatrix;switch(this.activity.logo.inStatusMatrix=!1,this.activity.logo.parseArg(this.activity.logo,r,v[0]),this.activity.blocks.blockList[v[0]].name){case"x":case"y":case"heading":f=this.activity.blocks.blockList[v[0]].value.toFixed(0);break;case"mynotevalue":f=mixedNumber(this.activity.blocks.blockList[v[0]].value);break;case"elapsednotes2":l=v[0],s=this.activity.blocks.blockList[l].connections[1],u=this.activity.logo.parseArg(this.activity.logo,r,s,l,null),f=mixedNumber(this.activity.blocks.blockList[v[0]].value)+" × "+mixedNumber(u);break;case"elapsednotes":f=mixedNumber(this.activity.blocks.blockList[v[0]].value);break;case"namedbox":f=(c=this.activity.blocks.blockList[v[0]].privateData)in this.activity.logo.boxes?this.activity.logo.boxes[c]:"";break;case"beatvalue":f=mixedNumber(n.singer.currentBeat);break;case"measurevalue":f=n.singer.currentMeasure;break;case"pitchinhertz":if(f="",null!=n.singer.noteStatus)for(var h=n.singer.noteStatus[0],m=0;m<h.length;m++)0<m&&(f+=" "),"number"==typeof(d=this.activity.logo.synth.getFrequency(h[m],this.activity.logo.synth.changeInTemperament))&&(f+=d.toFixed(2));else f="";break;default:f=this.activity.blocks.blockList[v[0]].value}this.activity.logo.inStatusMatrix=g,null!=(t=this._statusTable.rows[b+1].cells[i+1])&&(t.innerHTML=f),b++}}catch(t){p.e(t)}finally{p.f()}var S,T=void 0;if(_THIS_IS_MUSIC_BLOCKS_){if(f=T="",null!=n.singer.noteStatus){h=n.singer.noteStatus[0];for(var _=0;_<h.length;_++)T="number"==typeof h[_]?T+toFixed2(h[_])+"Hz ":T+h[_]+" ";f=n.singer.noteStatus[1],T+=(S=rationalToFraction(f))[1]+"/"+S[0]}null!=(t=this._statusTable.rows[b+1].cells[i+1])&&(t.innerHTML=T.replace(/#/g,"♯").replace(/b/g,"♭"))}i+=1,r++}}}catch(t){a.e(t)}finally{a.f()}this.activity.logo.updatingStatusMatrix=!1}}])})(),_StatusMatrix=StatusMatrix;_defineProperty(StatusMatrix,"BUTTONDIVWIDTH",128),_defineProperty(StatusMatrix,"BUTTONSIZE",53),_defineProperty(StatusMatrix,"ICONSIZE",32),_defineProperty(StatusMatrix,"OUTERWINDOWWIDTH",620),_defineProperty(StatusMatrix,"INNERWINDOWWIDTH",_StatusMatrix.OUTERWINDOWWIDTH-1.5*_StatusMatrix.BUTTONSIZE),_defineProperty(StatusMatrix,"FONTSCALEFACTOR",75),"undefined"!=typeof module&&(module.exports=StatusMatrix);
global._=function(e){return e},global._THIS_IS_MUSIC_BLOCKS_=!0,global.MATRIXBUTTONHEIGHT=40,global.MATRIXSOLFEHEIGHT=30,global.rationalToFraction=jest.fn().mockReturnValue([4,1]),global.mixedNumber=jest.fn().mockImplementation(function(e){return null!=e?e.toString():""}),global.toFixed2=jest.fn().mockImplementation(function(e){return e.toFixed(2)}),global.platformColor={selectorBackground:"#aaa"};var _createMockElement=function(e){return{tagName:e,style:{},appendChild:jest.fn(),append:jest.fn(),innerHTML:"",addEventListener:jest.fn(),className:"",insertCell:jest.fn().mockImplementation(function(){return _createMockElement("TD")}),insertRow:jest.fn().mockImplementation(function(){return{insertCell:jest.fn().mockImplementation(function(){return _createMockElement("TD")})}}),createTHead:jest.fn().mockImplementation(function(){return{insertRow:jest.fn().mockImplementation(function(){return{insertCell:jest.fn().mockImplementation(function(){return _createMockElement("TD")})}})}}),rows:[]}},createMockWidgetWindow=(global.document={createElement:jest.fn().mockImplementation(_createMockElement)},function(){return{clear:jest.fn(),show:jest.fn(),getWidgetBody:jest.fn().mockReturnValue({append:jest.fn()}),sendToCenter:jest.fn(),destroy:jest.fn(),onclose:null,onmaximize:null}}),StatusMatrix=(global.window={innerWidth:1200,widgetWindows:{windowFor:jest.fn().mockImplementation(function(){return createMockWidgetWindow()})}},require("./status.js"));describe("StatusMatrix Widget",function(){var t,n;beforeEach(function(){jest.clearAllMocks(),global.window.innerWidth=1200,global.window.widgetWindows={windowFor:jest.fn().mockImplementation(function(){return createMockWidgetWindow()})},global.document.createElement=jest.fn().mockImplementation(_createMockElement),t={logo:{statusFields:[],updatingStatusMatrix:!1,inStatusMatrix:!1,parseArg:jest.fn(),synth:{getFrequency:jest.fn().mockReturnValue(440),changeInTemperament:0},boxes:{}},turtles:{turtleList:[{name:"Mouse1",inTrash:!1}],ithTurtle:jest.fn().mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:null}}),getIndexOfTurtle:jest.fn().mockReturnValue(0)},blocks:{blockList:{}}},n=new StatusMatrix}),describe("Static Properties",function(){test("BUTTONDIVWIDTH is 128",function(){expect(StatusMatrix.BUTTONDIVWIDTH).toBe(128)}),test("BUTTONSIZE is 53",function(){expect(StatusMatrix.BUTTONSIZE).toBe(53)}),test("ICONSIZE is 32",function(){expect(StatusMatrix.ICONSIZE).toBe(32)}),test("OUTERWINDOWWIDTH is 620",function(){expect(StatusMatrix.OUTERWINDOWWIDTH).toBe(620)}),test("FONTSCALEFACTOR is 75",function(){expect(StatusMatrix.FONTSCALEFACTOR).toBe(75)})}),describe("Initialization (init)",function(){test("sets isOpen to true",function(){n.init(t),expect(n.isOpen).toBe(!0)}),test("sets isMaximized to false",function(){n.init(t),expect(n.isMaximized).toBe(!1)}),test("calculates cell scale from window width",function(){n.init(t),expect(n._cellScale).toBe(1)}),test("creates widget window",function(){n.init(t),expect(window.widgetWindows.windowFor).toHaveBeenCalledWith(n,"status","status")}),test("creates status table element",function(){n.init(t),expect(document.createElement).toHaveBeenCalledWith("table")}),test("clears and shows widget window",function(){n.init(t),expect(n.widgetWindow.clear).toHaveBeenCalled(),expect(n.widgetWindow.show).toHaveBeenCalled()}),test("stores activity reference",function(){n.init(t),expect(n.activity).toBe(t)})}),describe("Onclose Handler",function(){beforeEach(function(){n.init(t)}),test("sets isOpen to false",function(){n.widgetWindow.onclose(),expect(n.isOpen).toBe(!1)}),test("destroys widget window",function(){n.widgetWindow.onclose(),expect(n.widgetWindow.destroy).toHaveBeenCalled()})}),describe("Status Field Label Handling",function(){beforeEach(function(){t.blocks.blockList={0:{name:"x",protoblock:{staticLabels:["x position"]},value:100},1:{name:"plus",protoblock:{staticLabels:["plus"]},value:0},2:{name:"namedbox",privateData:"myVariable",value:42},3:{name:"heap",protoblock:{staticLabels:["heap"]},value:[1,2,3]},4:{name:"bpm",protoblock:{staticLabels:["beats per minute"]},value:120}},t.logo.statusFields=[[0,"x"],[1,"plus"],[2,"namedbox"],[3,"heap"],[4,"bpm"]]}),test("handles standard blocks with staticLabels",function(){n.init(t),expect(n._statusTable).toBeDefined()}),test("handles math operation blocks (plus, minus, etc) with empty label",function(){n.init(t),expect(n._statusTable).toBeDefined()}),test("handles namedbox with privateData as label",function(){n.init(t),expect(n._statusTable).toBeDefined()})}),describe("Turtle Display",function(){test("displays mouse icon for Music Blocks",function(){global._THIS_IS_MUSIC_BLOCKS_=!0,n.init(t),expect(n._statusTable).toBeDefined()}),test("displays turtle icon for Turtle Blocks",function(){global._THIS_IS_MUSIC_BLOCKS_=!1,n.init(t),expect(n._statusTable).toBeDefined(),global._THIS_IS_MUSIC_BLOCKS_=!0}),test("skips trashed turtles",function(){t.turtles.turtleList=[{name:"Mouse1",inTrash:!1},{name:"Mouse2",inTrash:!0},{name:"Mouse3",inTrash:!1}],n.init(t),expect(n._statusTable).toBeDefined()})}),describe("UpdateAll Method",function(){beforeEach(function(){t.blocks.blockList={0:{name:"x",protoblock:{staticLabels:["x"]},value:150}},t.logo.statusFields=[[0,"x"]],n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("sets updatingStatusMatrix to true during update",function(){var e=null;t.logo.parseArg=jest.fn(function(){e=t.logo.updatingStatusMatrix}),n.updateAll(),expect(e).toBe(!0)}),test("resets updatingStatusMatrix to false after update",function(){n.updateAll(),expect(t.logo.updatingStatusMatrix).toBe(!1)}),test("calls parseArg for each status field",function(){n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("temporarily disables inStatusMatrix during parsing",function(){var e=null;t.logo.parseArg=jest.fn(function(){e=t.logo.inStatusMatrix}),t.logo.inStatusMatrix=!0,n.updateAll(),expect(e).toBe(!1)}),test("restores inStatusMatrix after parsing",function(){t.logo.inStatusMatrix=!0,n.updateAll(),expect(t.logo.inStatusMatrix).toBe(!0)}),test("skips trashed turtles",function(){t.turtles.turtleList=[{name:"Mouse1",inTrash:!0}],n.updateAll(),expect(n._statusTable).toBeDefined()})}),describe("Block Value Formatting",function(){beforeEach(function(){n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("formats x position with toFixed(0)",function(){t.blocks.blockList={0:{name:"x",value:123.789}},t.logo.statusFields=[[0,"x"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("formats y position with toFixed(0)",function(){t.blocks.blockList={0:{name:"y",value:-456.123}},t.logo.statusFields=[[0,"y"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("formats heading with toFixed(0)",function(){t.blocks.blockList={0:{name:"heading",value:45.67}},t.logo.statusFields=[[0,"heading"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("formats mynotevalue with mixedNumber",function(){t.blocks.blockList={0:{name:"mynotevalue",value:.25}},t.logo.statusFields=[[0,"mynotevalue"]],n.updateAll(),expect(mixedNumber).toHaveBeenCalledWith(.25)}),test("formats elapsednotes with mixedNumber",function(){t.blocks.blockList={0:{name:"elapsednotes",value:4.5}},t.logo.statusFields=[[0,"elapsednotes"]],n.updateAll(),expect(mixedNumber).toHaveBeenCalled()}),test("formats beatvalue with mixedNumber using singer.currentBeat",function(){t.blocks.blockList={0:{name:"beatvalue",value:2}},t.logo.statusFields=[[0,"beatvalue"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:3,currentMeasure:1,noteStatus:null}}),n.updateAll(),expect(mixedNumber).toHaveBeenCalledWith(3)}),test("uses singer.currentMeasure for measurevalue",function(){t.blocks.blockList={0:{name:"measurevalue",value:0}},t.logo.statusFields=[[0,"measurevalue"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:4,noteStatus:null}}),n.updateAll(),expect(n._statusTable.rows[1].cells[1].innerHTML).toBe(4)}),test("handles namedbox with value from logo.boxes",function(){t.blocks.blockList={0:{name:"namedbox",privateData:"myVar"}},t.logo.statusFields=[[0,"namedbox"]],t.logo.boxes={myVar:42},n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("handles namedbox with missing variable",function(){t.blocks.blockList={0:{name:"namedbox",privateData:"missing"}},t.logo.statusFields=[[0,"namedbox"]],t.logo.boxes={},expect(function(){return n.updateAll()}).not.toThrow()}),test("handles heap value directly",function(){t.blocks.blockList={0:{name:"heap",value:[1,2,3]}},t.logo.statusFields=[[0,"heap"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()})}),describe("Pitch in Hertz Handling",function(){beforeEach(function(){n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("gets frequency from synth for pitchinhertz",function(){t.blocks.blockList={0:{name:"pitchinhertz",value:0}},t.logo.statusFields=[[0,"pitchinhertz"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["C4"],.25]}}),n.updateAll(),expect(t.logo.synth.getFrequency).toHaveBeenCalledWith("C4",0)}),test("handles multiple notes in pitchinhertz",function(){t.blocks.blockList={0:{name:"pitchinhertz",value:0}},t.logo.statusFields=[[0,"pitchinhertz"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["C4","E4","G4"],.25]}}),n.updateAll(),expect(t.logo.synth.getFrequency).toHaveBeenCalledTimes(3)}),test("returns empty for null noteStatus",function(){t.blocks.blockList={0:{name:"pitchinhertz",value:0}},t.logo.statusFields=[[0,"pitchinhertz"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:null}}),n.updateAll(),expect(t.logo.synth.getFrequency).not.toHaveBeenCalled()})}),describe("Note Row Display",function(){beforeEach(function(){global._THIS_IS_MUSIC_BLOCKS_=!0,t.blocks.blockList={0:{name:"x",protoblock:{staticLabels:["x"]},value:100}},t.logo.statusFields=[[0,"x"]],n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("displays note names from noteStatus",function(){t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["C4","E4"],.25]}}),n.updateAll(),expect(rationalToFraction).toHaveBeenCalledWith(.25)}),test("formats numeric frequencies with Hz suffix",function(){t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[[440],.25]}}),n.updateAll(),expect(toFixed2).toHaveBeenCalledWith(440)}),test("replaces # with ♯ in note display",function(){var e=_createMockElement("TD");n._statusTable.rows[2]={cells:[_createMockElement("TD"),e]},t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["C#4"],.25]}}),n.updateAll(),expect(e.innerHTML).toContain("♯")}),test("replaces b with ♭ in note display",function(){t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["Bb4"],.25]}}),n.updateAll(),expect(n._statusTable.rows[2].cells[1].innerHTML).toContain("♭")}),test("handles empty noteStatus array",function(){t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[[],.25]}}),expect(function(){return n.updateAll()}).not.toThrow()})}),describe("elapsednotes2 Block",function(){beforeEach(function(){n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("parses connected block for note value",function(){t.blocks.blockList={0:{name:"elapsednotes2",value:4,connections:[null,1]},1:{name:"number",value:.25}},t.logo.statusFields=[[0,"elapsednotes2"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()})}),describe("Multiple Turtles",function(){beforeEach(function(){t.turtles.turtleList=[{name:"Mouse1",inTrash:!1},{name:"Mouse2",inTrash:!1}],t.blocks.blockList={0:{name:"x",protoblock:{staticLabels:["x"]},value:100}},t.logo.statusFields=[[0,"x"]],n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD"),_createMockElement("TD")]}]}),test("updates cells for each active turtle",function(){n.updateAll(),expect(t.turtles.ithTurtle).toHaveBeenCalled()}),test("increments activeTurtles count correctly",function(){n.updateAll(),expect(n._statusTable).toBeDefined()})})});
function TemperamentWidget(){var u=430,h=32,y=document.createElement("div"),d=null;this.inTemperament=null,this.lastTriggered=null,this.notes=[],this.frequencies=[],this.intervals=[],this.ratios=[],this.scale=[],this.cents=[],this.scaleNotes=[],this.pitchNumber=0,this.circleIsVisible=!0,this.playbackForward=!0,this._addButton=function(e,t,i,s){e=e.insertCell(-1);return e.innerHTML='&nbsp;&nbsp;<img \n                src="header-icons/'.concat(t,'" \n                title="').concat(s,'" \n                alt="').concat(s,'" \n                height="').concat(i,'" \n                width="').concat(i,'" \n                vertical-align="middle" \n                align-content="center"\n            >&nbsp;&nbsp;'),e.style.width="53px",e.style.minWidth=e.style.width,e.style.maxWidth=e.style.width,e.style.height=e.style.width,e.style.minHeight=e.style.height,e.style.maxHeight=e.style.height,e.style.backgroundColor=platformColor.selectorBackground,e.onmouseover=function(){this.style.backgroundColor=platformColor.selectorBackgroundHOVER},e.onmouseout=function(){this.style.backgroundColor=platformColor.selectorBackground},e},this._circleOfNotes=function(){this.circleIsVisible=!1,this.toggleNotesButton(),y.style.display="inline",y.style.visibility="visible",y.style.border="0px",y.style.overflow="auto",y.style.backgroundColor="white",y.style.height="300px",y.innerHTML='<div id="temperamentTable"></div>';var e,t,i=docById("temperamentTable"),h=(i.style.position="relative",150),i=('<canvas id="circ" width = 430px height = 360px></canvas>'+'<div id="wheelDiv2" class="wheelNav"></div>'+'<div id ="information"></div>',i.innerHTML='<canvas id="circ" width = 430px height = 360px></canvas><div id="wheelDiv2" class="wheelNav"></div><div id ="information"></div>',i.style.width="300px",docById("circ")),s=(i.style.position="absolute",i.style.zIndex=1,i.style.background="rgba(255, 255, 255, 0.85)",i.getContext("2d")),n=i.width/2,i=i.height/2,d=(s.beginPath(),s.arc(n,i,h,0,2*Math.PI,!1),s.fillStyle="rgba(204, 0, 102, 0)",s.fill(),s.lineWidth=1,s.strokeStyle="#003300",s.stroke(),[]),o=(docById("wheelDiv2").style.display="",docById("wheelDiv2").style.background="none",this.createMainWheel=function(e,t){void 0===e&&(e=this.ratios),void 0===t&&(t=this.pitchNumber);for(var i=[],s=0;s<t;s++)i.push(s.toString());this.notesCircle=new wheelnav("wheelDiv2",null,350,350),this.notesCircle.wheelRadius=230,this.notesCircle.navItemsEnabled=!1,this.notesCircle.navAngle=270,this.notesCircle.navItemsContinuous=!0,this.notesCircle.navItemsCentered=!1,this.notesCircle.slicePathFunction=slicePath().MenuSliceWithoutLine,this.notesCircle.slicePathCustom=slicePath().MenuSliceCustomization(),this.notesCircle.sliceSelectedPathCustom=this.notesCircle.slicePathCustom,this.notesCircle.sliceInitPathCustom=this.notesCircle.slicePathCustom,this.notesCircle.initWheel(i),d=[];for(var n=[],o=[],l=[],r=0;r<this.notesCircle.navItemCount;r++)this.notesCircle.navItems[r].fillAttr="#c8C8C8",this.notesCircle.navItems[r].titleAttr.font="20 20px Impact, Charcoal, sans-serif",this.notesCircle.navItems[r].titleSelectedAttr.font="20 20px Impact, Charcoal, sans-serif",d[r]=270+Math.log10(e[r])/Math.log10(this.powerBase)*360,0!==r&&(l[r-1]=r==t-1?d[0]+360-d[r]:d[r]-d[r-1]),0===r?(o[r]=360/t,n[r]=this.notesCircle.navAngle-o[0]/2):(n[r]=n[r-1]+o[r-1],o[r]=2*(d[r]-n[r])),this.notesCircle.navItems[r].sliceAngle=o[r];for(var a=2*Math.PI*h/t/3,c=0;c<l.length;c++)l[c]<11&&(a=2*Math.PI*h/t/6);29<a&&(a=2*Math.PI*h/33),this.notesCircle.slicePathCustom.menuRadius=a,this.notesCircle.createWheel(),docById("wheelDiv2").style.position="absolute",docById("wheelDiv2").style.height="360px",docById("wheelDiv2").style.width=u+"px",docById("wheelDiv2").style.zIndex=5},this.createMainWheel(),this);this.octaveChanged?((n=document.createElement("div")).id="divAppend",n.innerHTML='<div id="clearNotes" style="float:left;">'+_("Clear")+'</div><div id="standardOctave" style="float:right;">'+_("back to 2:1 octave space")+"</div>",n.style.textAlign="center",n.style.position="absolute",n.style.zIndex=2,n.style.height="33px",n.style.width=docById("wheelDiv2").style.width,n.style.marginTop="360px",n.style.background="rgba(255, 255, 255, 0.85)",n.style.overflow="auto",docById("temperamentTable").append(n),(e=docById("clearNotes")).style.height="30px",e.style.marginLeft="3px",e.style.backgroundColor=platformColor.selectorBackground,e.style.width="212px",(t=docById("standardOctave")).style.height="30px",t.style.marginRight="3px",t.style.backgroundColor=platformColor.selectorBackground,t.style.width="207px"):((e=document.createElement("div")).id="divAppend",e.innerHTML=_("Clear"),e.style.textAlign="center",e.style.position="absolute",e.style.zIndex=2,e.style.paddingTop="5px",e.style.backgroundColor=platformColor.selectorBackground,e.style.height="25px",e.style.width=docById("wheelDiv2").style.width,e.style.marginTop=docById("wheelDiv2").style.height,e.style.overflow="auto",docById("temperamentTable").append(e)),void 0!==e&&(e.onclick=function(){var e=o.ratios[0],e=(o.ratios=[],o.ratios[0]=e,o.ratios[1]=o.powerBase,o.frequencies[0]);o.frequencies=[],o.frequencies[0]=e,o.frequencies[1]=e*o.powerBase,o.pitchNumber=1,o.checkTemperament(o.ratios),o._circleOfNotes()}),void 0!==t&&(t.onclick=function(){var e=[],t=[],i=o.frequencies[0];o.frequencies=[],isCustomTemperament(o.inTemperament)||(o.powerBase=2);for(var s=0;s<o.ratios.length;s++)e[s]=Math.log10(o.ratios[s])/Math.log10(o.powerBase)*12,o.ratios[s]=Math.pow(o.powerBase,e[s]/12),t[s]=o.ratios[s].toFixed(2),o.frequencies[s]=o.ratios[s]*i,o.frequencies[s]=o.frequencies[s].toFixed(2);o.powerBase=2,o.checkTemperament(t),o.octaveChanged=!1,o._circleOfNotes()}),docById("temperamentTable").addEventListener("click",function(e){o.showNoteInfo(e)})},this.showNoteInfo=function(h){for(var d=this,u=0;u<this.notesCircle.navItemCount;u++)(()=>{if(h.target.id=="wheelnav-wheelDiv2-slice-"+u||h.target.innerHTML==u&&""!==h.target.innerHTML){for(var e=h.clientX-docById("wheelDiv2").getBoundingClientRect().left,t=h.clientY-docById("wheelDiv2").getBoundingClientRect().top,i=d.frequencies[u],s=d,n=(null!==docById("noteInfo")&&docById("noteInfo").remove(),docById("information").innerHTML+='<div class="popup" id="noteInfo" style="left: '.concat(e,"px; top: ").concat(t,'px;">\n                        <span class="popuptext" id="myPopup"></span>\n                    </div>'),0!==u&&(docById("noteInfo").innerHTML+='<img \n                            src="header-icons/edit.svg" \n                            id="edit" \n                            title="'.concat(_("edit"),'" \n                            alt="edit" \n                            height="20px" \n                            width="20px" \n                            data-message="').concat(u,'"\n                        >')),docById("noteInfo").innerHTML+='<img src="header-icons/close-button.svg" id="close" title="'+_("Close")+'" alt="'+_("Close")+'" height=20px width=20px align="right"><br>',!1),o=0;o<d.ratiosNotesPair.length;o++)if(d.ratios[u]==d.ratiosNotesPair[o][0]){n=!0,docById("noteInfo").innerHTML+='<div id="note">&nbsp;'.concat(_("note"),"&nbsp;").concat(d.ratiosNotesPair[o][1],"</div>");break}if(0==n){for(var l=Math.log10(d.ratios[u])/Math.log10(d.powerBase)*1200,r=[],a=[],c=0;c<d.cents.length;c++)r[c]=l-d.cents[c],a[c]=Math.abs(l-d.cents[c]);e=a.reduce(function(e,t){return Math.min(e,t)}),t=a.indexOf(e);docById("noteInfo").innerHTML+=(r[t]<0?'<div id="note">&nbsp;'.concat(_("note"),"&nbsp;").concat(d.ratiosNotesPair[t][1],"(-"):'<div id="note">&nbsp;'.concat(_("note"),"&nbsp;").concat(d.ratiosNotesPair[t][1],"(")).concat(a[t].toFixed(2),"¢)</div>")}docById("noteInfo").innerHTML+='<div id="frequency">&nbsp;'.concat(_("frequency"),"&nbsp;").concat(i,"</div>"),docById("noteInfo").style.top="130px",docById("noteInfo").style.left="132px",docById("noteInfo").style.position="absolute",docById("noteInfo").style.zIndex=10,docById("close").onclick=function(){docById("noteInfo").remove()},null!==docById("edit")&&docById("edit").addEventListener("click",function(e){s.editFrequency(e)})}})()},this.editFrequency=function(e){var i=Number(e.target.dataset.message),s=this;docById("noteInfo").style.width="180px",docById("noteInfo").style.height="130px",docById("note").innerHTML="",docById("frequency").innerHTML="",docById("noteInfo").innerHTML+='<center><input type="range" class="sliders" id="frequencySlider1" style="width:170px; background:white; border:0;" min="'.concat(this.frequencies[i-1],'" max="').concat(this.frequencies[i+1],'"></center>'),docById("noteInfo").innerHTML+="<br>&nbsp;&nbsp;".concat(_("frequency"),'<span class="rangeslidervalue" id="frequencydiv1">').concat(this.frequencies[i],"</span>"),docById("noteInfo").innerHTML+='<br><br><div id="done" style="background:rgb(196, 196, 196);"><center>'.concat(_("done"),"</center><div>"),docById("frequencySlider1").oninput=function(){docById("frequencydiv1").innerHTML=docById("frequencySlider1").value;var e=docById("frequencySlider1").value,t=e/s.frequencies[0];s.temporaryRatios=s.ratios.slice(),s.temporaryRatios[i]=t,s._logo.resetSynth(0),s._logo.synth.trigger(0,e,.01*Singer.defaultBPMFactor,"electronic synth",null,null),s.createMainWheel(s.temporaryRatios)},docById("done").onclick=function(){s.ratios=s.temporaryRatios.slice(),s.typeOfEdit="nonequal",s.createMainWheel();var e=s.frequencies[0];s.frequencies=[];for(var t=0;t<s.ratios.length;t++)s.frequencies[t]=s.ratios[t]*e,s.frequencies[t]=s.frequencies[t].toFixed(2);s.checkTemperament(s.ratios),docById("noteInfo").remove()},docById("close").onclick=function(){s.temporaryRatios=s.ratios.slice(),s.createMainWheel(),docById("noteInfo").remove()}},this._graphOfNotes=function(){this.circleIsVisible=!0,this.toggleNotesButton(),y.innerHTML="",null!=docById("wheelDiv2")&&(docById("wheelDiv2").style.display="none",this.notesCircle.removeWheel()),y.innerHTML='<table id="notesGraph"></table>';for(var e=docById("notesGraph"),t=[],i=(isCustomTemperament(this.inTemperament)?t=[_("Play"),_("pitch number"),_("ratio"),_("frequency")]:(t=[_("Play"),_("pitch number"),_("ratio"),_("interval"),_("note"),_("frequency")]).splice(5,0,this.scale),e.innerHTML='<thead id="tablehead"><tr id="menu"></tr></thead><tbody id="tablebody"></tbody>',""),s=0;s<t.length;s++)i+='<th id="menuLabels">'+t[s]+"</th>";docById("menu").innerHTML=i;for(var n=document.querySelectorAll("#menuLabels"),o=0;o<t.length;o++)n[o].style.background=platformColor.labelColor,n[o].style.height="30px",n[o].style.textAlign="center",n[o].style.fontWeight="bold",isCustomTemperament(this.inTemperament)?(n[0].style.width="40px",n[1].style.width="120px",n[2].style.width="120px",n[3].style.width="140px"):(n[0].style.width="40px",n[1].style.width="40px",n[2].style.width="60px",n[3].style.width="120px",n[4].style.width="50px",n[5].style.width="100px",n[6].style.width="95px");for(var l="",r=0;r<=this.pitchNumber;r++)l+='<tr id="notes_'+r+'"></tr>';docById("tablebody").innerHTML+='<tr><td colspan="7"><div id="graph"><table id="tableOfNotes"></table></div></td></tr>',docById("tableOfNotes").innerHTML=l;for(var a=this,c=[],h=[],d=[],u=0;u<=this.pitchNumber;u++){c[u]=docById("notes_"+u),h[0]=c[u].insertCell(-1),h[0].innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="20px" \n                    width="20px" \n                    id="play_').concat(u,'" \n                    data-id="').concat(u,'"\n                >&nbsp;&nbsp;'),h[0].style.width="40px",h[0].style.backgroundColor=platformColor.selectorBackground,h[0].style.textAlign="center",h[0].onmouseover=function(){this.style.backgroundColor=platformColor.selectorBackgroundHOVER},h[0].onmouseout=function(){this.style.backgroundColor=platformColor.selectorBackground};var p=docById("play_"+u);if(p.onmouseover=function(){this.style.cursor="pointer"},p.onclick=function(e){a.playNote(e.target.dataset.id)},h[1]=c[u].insertCell(-1),h[1].id="pitchNumber_"+u,h[1].innerHTML=u,h[1].style.backgroundColor=platformColor.selectorBackground,h[1].style.textAlign="center",d[u]=this.ratios[u],d[u]=d[u].toFixed(2),h[2]=c[u].insertCell(-1),h[2].innerHTML=d[u],h[2].style.backgroundColor=platformColor.selectorBackground,h[2].style.textAlign="center",!isCustomTemperament(this.inTemperament)){h[3]=c[u].insertCell(-1),h[3].innerHTML=this.intervals[u],h[3].style.width="120px",h[3].style.backgroundColor=platformColor.selectorBackground,h[3].style.textAlign="center",h[4]=c[u].insertCell(-1),h[4].innerHTML=this.notes[u],h[4].style.width="50px",h[4].style.backgroundColor=platformColor.selectorBackground,h[4].style.textAlign="center",h[5]=c[u].insertCell(-1);for(var m=0;m<this.scaleNotes.length;m++)if(this.notes[u][0]==this.scaleNotes[m]){h[5].innerHTML=m;break}""===h[5].innerHTML&&(h[5].innerHTML=_("non scalar")),h[5].style.width="100px",h[5].style.backgroundColor=platformColor.selectorBackground,h[5].style.textAlign="center"}h[6]=c[u].insertCell(-1),h[6].innerHTML=this.frequencies[u],h[6].style.backgroundColor=platformColor.selectorBackground,h[6].style.textAlign="center",isCustomTemperament(this.inTemperament)?(h[1].style.width="130px",h[6].style.width="130px",h[2].style.width="130px"):(h[1].style.width="60px",h[6].style.width="80px",h[2].style.width="60px")}},this.edit=function(){this.editMode=null,this._logo.synth.setMasterVolume(0),this._logo.synth.stop();for(var e=this,t=(null!=docById("wheelDiv2")&&(docById("wheelDiv2").style.display="none",this.notesCircle.removeWheel()),y.innerHTML="",y.innerHTML='<table id="editOctave" width="'.concat(u,'"><tbody><tr id="menu"></tr></tbody></table>'),[_("equal"),_("ratios"),_("arbitrary"),_("octave space")]),i="",s=0;s<t.length;s++)i+='<td id="editMenus">'+t[s]+"</td>";docById("menu").innerHTML=i,docById("editOctave").innerHTML+='<tr><td colspan="4" id="userEdit"></td></tr>';for(var n=document.querySelectorAll("#editMenus"),o=0;o<t.length;o++)n[o].style.background=platformColor.selectorBackground,n[o].style.height="30px",n[o].style.textAlign="center",n[o].style.fontWeight="bold";n[0].style.background="#c8C8C8",e.equalEdit(),n[0].onclick=function(){n[1].style.background=platformColor.selectorBackground,n[2].style.background=platformColor.selectorBackground,n[3].style.background=platformColor.selectorBackground,n[0].style.background="#c8C8C8",e.equalEdit()},n[1].onclick=function(){n[0].style.background=platformColor.selectorBackground,n[2].style.background=platformColor.selectorBackground,n[3].style.background=platformColor.selectorBackground,n[1].style.background="#c8C8C8",e.ratioEdit()},n[2].onclick=function(){n[0].style.background=platformColor.selectorBackground,n[1].style.background=platformColor.selectorBackground,n[3].style.background=platformColor.selectorBackground,n[2].style.background="#c8C8C8",e.arbitraryEdit()},n[3].onclick=function(){n[0].style.background=platformColor.selectorBackground,n[1].style.background=platformColor.selectorBackground,n[2].style.background=platformColor.selectorBackground,n[3].style.background="#c8C8C8",e.octaveSpaceEdit()}},this.equalEdit=function(){this.editMode="equal",docById("userEdit").innerHTML="";var t=docById("userEdit"),v=(t.style.backgroundColor="#c8C8C8",t.innerHTML="<br>".concat(_("pitch number"),'&nbsp;&nbsp;&nbsp;&nbsp; <input type="text" id="octaveIn" value="0"></input>\n            &nbsp;&nbsp; ').concat(_("to"),'&nbsp;&nbsp;\n            <input type="text" id="octaveOut" value="0"></input><br><br>'),t.innerHTML+="".concat(_("number of divisions"),' &nbsp;&nbsp;&nbsp;&nbsp; <input type="text" id="divisions" value="').concat(this.pitchNumber,'"></input>'),t.style.paddingLeft="80px",this),g=document.createElement("div");function f(e){g.id="divAppend",g.innerHTML='<div id="preview" style="float:left;">'.concat(e?_("back"):_("preview"),'</div>\n                    <div id="done_" style="float:right;">').concat(_("done"),"</div>"),g.style.textAlign="center",g.style.marginLeft="-80px",g.style.height="32px",g.style.marginTop="40px",g.style.overflow="auto",t.append(g);e=docById("preview"),e.style.height="30px",e.style.marginLeft="3px",e.style.backgroundColor=platformColor.selectorBackground,e.style.width="215px",e=docById("done_");e.style.height="30px",e.style.marginRight="3px",e.style.backgroundColor=platformColor.selectorBackground,e.style.width="205px"}f(!1),g.onmouseover=function(){this.style.cursor="pointer"};var b,I,w,C=this.pitchNumber,B=(Number(docById("octaveIn").value),Number(docById("octaveOut").value),Number(docById("divisions").value),[]),T=[],x=[],k=[],q=[],M=[];this.tempRatios=[],g.addEventListener("click",function(e){try{v.performEqualEdit(e)}catch(e){activity.errorMsg(_("The Number of divisions is too large."),3e3)}}),this.performEqualEdit=function(e){if(b=Number(docById("octaveIn").value),I=Number(docById("octaveOut").value),w=Number(docById("divisions").value),this.tempRatios=this.ratios.slice(),b===I){for(var t=0;t<w;t++)B[t]=Math.pow(this.powerBase,t/w),x[t]=B[t].toFixed(2);for(var i=0;i<this.tempRatios.length;i++)k[i]=this.tempRatios[i],k[i]=k[i].toFixed(2);for(var s=x.filter(function(e){return-1==k.indexOf(e)}),n=0;n<s.length;n++)M[n]=x.indexOf(s[n]),q[n]=B[M[n]];this.tempRatios=this.tempRatios.concat(q),this.tempRatios.sort(function(e,t){return e-t}),C=this.tempRatios.length-1,this.typeOfEdit="equal",this.divisions=w}else{C=w+Number(C)-Math.abs(b-I);var o=270+Math.log10(this.tempRatios[b])/Math.log10(this.powerBase)*360,l=270+Math.log10(this.tempRatios[I])/Math.log10(this.powerBase)*360,r=Math.abs(l-o)/w;this.tempRatios.splice(b+1,Math.abs(b-I)-1);for(var a=0;a<w-1;a++){var c=(Math.min(o,l)+r*(a+1)-270)/360;B[a]=Math.pow(this.powerBase,c),this.tempRatios.splice(b+1+a,0,B[a]),T[a]=this.tempRatios[a],T[a]=T[a].toFixed(2)}this.typeOfEdit="nonequal"}if(e.target.innerHTML===_("done")){this.ratios=this.tempRatios.slice();var h=this.frequencies[0];this.frequencies=[];for(var d=0;d<=C;d++)this.frequencies[d]=this.ratios[d]*h,this.frequencies[d]=this.frequencies[d].toFixed(2);this.pitchNumber=C,this.checkTemperament(T),this._circleOfNotes()}else if(e.target.innerHTML===_("preview")){docById("userEdit").innerHTML='<div id="wheelDiv2" class="wheelNav"></div>',this.createMainWheel(this.tempRatios,C);for(var u=0;u<C;u++)this.notesCircle.navItems[u].fillAttr="#e0e0e0",this.notesCircle.navItems[u].sliceHoverAttr.fill="#e0e0e0",this.notesCircle.navItems[u].slicePathAttr.fill="#e0e0e0",this.notesCircle.navItems[u].sliceSelectedAttr.fill="#e0e0e0";this.notesCircle.refreshWheel(),docById("userEdit").style.paddingLeft="0px",f(!0),g.style.marginTop=docById("wheelDiv2").style.height,docById("preview").style.marginLeft="80px";var p=this.tempRatios.slice(),m=this.frequencies[0];this.eqTempHzs=[];for(var y=0;y<=C;y++)this.eqTempHzs[y]=p[y]*m,this.eqTempHzs[y]=this.eqTempHzs[y].toFixed(2);this.eqTempPitchNumber=C,this.checkTemperament(T),docById("done_").onclick=function(){v.ratios=v.tempRatios.slice();var e=v.frequencies[0];v.frequencies=[];for(var t=0;t<=C;t++)v.frequencies[t]=v.ratios[t]*e,v.frequencies[t]=v.frequencies[t].toFixed(2);v.pitchNumber=C,v.eqTempPitchNumber=null,v.eqTempHzs=[],v.checkTemperament(T),v._circleOfNotes()},docById("preview").onclick=function(){v.equalEdit(),v.eqTempPitchNumber=null,v.eqTempHzs=[]}}}},this.ratioEdit=function(){this.editMode="ratio",docById("userEdit").innerHTML="";var t=docById("userEdit"),C=(t.style.backgroundColor="#c8C8C8",t.innerHTML="<br>".concat(_("ratio"),' &nbsp;&nbsp;&nbsp;&nbsp; <input type="text" id="ratioIn" value="1"></input> &nbsp;&nbsp; : &nbsp;&nbsp; <input type="text" id="ratioOut" value="1"></input><br><br>'),t.innerHTML+="".concat(_("recursion"),' &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="text" id="recursion" value="1"></input>'),t.style.paddingLeft="100px",this),B=document.createElement("div");function T(e){B.id="divAppend",B.innerHTML='<div id="preview" style="float:left;">'.concat(e?_("back"):_("preview"),'</div>\n                    <div id="done_" style="float:right;">').concat(_("done"),"</div>"),B.style.textAlign="center",B.style.marginLeft="-100px",B.style.height="32px",B.style.marginTop="40px",B.style.overflow="auto",t.append(B);e=docById("preview"),e.style.height="30px",e.style.marginLeft="3px",e.style.backgroundColor=platformColor.selectorBackground,e.style.width="215px",e=docById("done_");e.style.height="30px",e.style.marginRight="3px",e.style.backgroundColor=platformColor.selectorBackground,e.style.width="205px"}T(!1),B.onmouseover=function(){this.style.cursor="pointer"},B.onclick=function(e){for(var t=docById("ratioIn").value,i=docById("ratioOut").value,s=docById("recursion").value,n=C.frequencies.length,o=t/i,l=[],r=[],a=[],c=[],h=[],d=(C.tempRatios=C.ratios.slice(),function(e){if(r[e]<C.frequencies[n-1])for(var t=0;t<C.tempRatios.length;t++){if(a[t]=l[e]-C.tempRatios[t],a[t]<0){c.push(t),C.tempRatios.splice(c[e],0,l[e]);break}if(0==a[t]){c.push(t),C.tempRatios.splice(c[e],1,l[e]);break}}else l[e]=l[e]/2,r[e]=C.frequencies[0]*l[e],d(e)}),u=0;u<s;u++)l[u]=Math.pow(o,u+1),r[u]=C.frequencies[0]*l[u],d(u);C.tempRatios.sort(function(e,t){return e-t});var p=C.tempRatios.length-1;if(e.target.innerHTML===_("done")){C.ratios=C.tempRatios.slice(),C.typeOfEdit="nonequal",C.pitchNumber=C.ratios.length-1;var m=C.frequencies[0];C.frequencies=[];for(var y=0;y<=C.pitchNumber;y++)C.frequencies[y]=C.ratios[y]*m,C.frequencies[y]=C.frequencies[y].toFixed(2);for(var v=0;v<C.ratios.length;v++)h[v]=C.ratios[v],h[v]=h[v].toFixed(2);C.checkTemperament(h),C._circleOfNotes()}else if(e.target.innerHTML===_("preview")){docById("userEdit").innerHTML='<div id="wheelDiv2" class="wheelNav"></div>',C.createMainWheel(C.tempRatios,p);for(var g=0;g<p;g++)C.notesCircle.navItems[g].fillAttr="#e0e0e0",C.notesCircle.navItems[g].sliceHoverAttr.fill="#e0e0e0",C.notesCircle.navItems[g].slicePathAttr.fill="#e0e0e0",C.notesCircle.navItems[g].sliceSelectedAttr.fill="#e0e0e0";C.notesCircle.refreshWheel(),docById("userEdit").style.paddingLeft="0px",T(!0),B.style.marginTop=docById("wheelDiv2").style.height,docById("preview").style.marginLeft="100px";var f=C.tempRatios.slice(),b=(C.typeOfEdit="nonequal",C.NEqTempPitchNumber=f.length-1,C.frequencies[0]);C.NEqTempHzs=[];for(var I=0;I<=C.NEqTempPitchNumber;I++)C.NEqTempHzs[I]=f[I]*b,C.NEqTempHzs[I]=C.NEqTempHzs[I].toFixed(2);for(var w=0;w<f.length;w++)h[w]=f[w],h[w]=h[w].toFixed(2);C.checkTemperament(h),docById("done_").onclick=function(){C.ratios=C.tempRatios.slice(),C.pitchNumber=C.ratios.length-1;var e=C.frequencies[0];C.frequencies=[];for(var t=0;t<=C.pitchNumber;t++)C.frequencies[t]=C.ratios[t]*e,C.frequencies[t]=C.frequencies[t].toFixed(2);for(var i=0;i<C.ratios.length;i++)h[i]=C.ratios[i],h[i]=h[i].toFixed(2);C.checkTemperament(h),C._circleOfNotes(),C.NEqTempPitchNumber=null,C.NEqTempHzs=[]},docById("preview").onclick=function(){C.ratioEdit(),C.NEqTempPitchNumber=null,C.NEqTempHzs=[]}}}},this.arbitraryEdit=function(){this.editMode="arbitrary",docById("userEdit").innerHTML="";var e=docById("userEdit"),d=(e.innerHTML='<br><div id="wheelDiv3" class="wheelNav"></div>',e.style.paddingLeft="0px",this),c=[],t=(this.tempRatios1=this.ratios.slice(),this._createInnerWheel=function(e,t){void 0!==this.wheel1&&(docById("wheelDiv4").display="none",this.wheel1.removeWheel()),null==e&&(e=this.ratios),null==t&&(t=this.pitchNumber);for(var i=[],s=0;s<t;s++)i.push(s.toString());docById("wheelDiv4").style.display="",docById("wheelDiv4").style.background="none",docById("wheelDiv4").style.position="relative",docById("wheelDiv4").style.zIndex=5,this.wheel1=new wheelnav("wheelDiv4"),this.wheel1.wheelRadius=200,this.wheel1.navItemsEnabled=!1,this.wheel1.navAngle=270,this.wheel1.navItemsContinuous=!0,this.wheel1.navItemsCentered=!1,this.wheel1.slicePathFunction=slicePath().MenuSliceWithoutLine,this.wheel1.slicePathCustom=slicePath().MenuSliceCustomization(),this.wheel1.sliceSelectedPathCustom=this.wheel1.slicePathCustom,this.wheel1.sliceInitPathCustom=this.wheel1.slicePathCustom,this.wheel1.initWheel(i);for(var n=[],o=[],l=[],r=[],a=0;a<this.wheel1.navItemCount;a++)this.wheel1.navItems[a].fillAttr="#e0e0e0",this.wheel1.navItems[a].titleAttr.font="20 20px Impact, Charcoal, sans-serif",this.wheel1.navItems[a].titleSelectedAttr.font="20 20px Impact, Charcoal, sans-serif",l[a]=270+Math.log10(e[a])/Math.log10(this.powerBase)*360,0!==a&&(a==this.pitchNumber-1?r[a-1]=l[0]+360-l[a]:r[a-1]=l[a]-l[a-1]),0===a?(o[a]=360/t,n[a]=this.wheel1.navAngle-o[0]/2):(n[a]=n[a-1]+o[a-1],o[a]=2*(l[a]-n[a])),this.wheel1.navItems[a].sliceAngle=o[a];for(var c=2*Math.PI*128/t/3,h=0;h<r.length;h++)r[h]<11&&(c=2*Math.PI*128/this.pitchNumber/6);29<c&&(c=2*Math.PI*128/33),this.wheel1.slicePathCustom.menuRadius=c,null!==docById("frequencySlider")&&(docById("frequencySlider").oninput=function(){d._refreshInnerWheel()}),this.wheel1.createWheel()},e.innerHTML+='<div id="wheelDiv4" class="wheelNav"></div>',this._createInnerWheel(),e.innerHTML+='<canvas id="circ1" width = "'.concat(u,'" height = "').concat(256,'"></canvas>'),docById("circ1")),i=(t.style.position="absolute",t.style.zIndex=1,t.style.marginTop="-305px",t.getContext("2d")),s=t.width/2,t=t.height/2,s=(i.beginPath(),i.arc(s,t,128,0,2*Math.PI,!1),i.fillStyle="rgba(204, 0, 102, 0)",i.fill(),i.lineWidth=1,i.strokeStyle="#003300",i.stroke(),this._createOuterWheel=function(t,i){void 0!==this.wheel&&(docById("wheelDiv3").display="none",this.wheel.removeWheel()),null==i&&(i=this.pitchNumber),null==t&&(t=this.ratios),docById("wheelDiv3").style.display="",docById("wheelDiv3").style.background="none",this.wheel=new wheelnav("wheelDiv3",null,600,600),this.wheel.wheelRadius=300,this.wheel.slicePathFunction=slicePath().DonutSlice,this.wheel.slicePathCustom=slicePath().DonutSliceCustomization(),this.wheel.slicePathCustom.minRadiusPercent=.9,this.wheel.slicePathCustom.maxRadiusPercent=1,this.wheel.sliceSelectedPathCustom=this.wheel.slicePathCustom,this.wheel.sliceInitPathCustom=this.wheel.slicePathCustom,this.wheel.colors=["#c0c0c0","#e0e0e0"],this.wheel.titleRotateAngle=90,this.wheel.navItemsEnabled=!1;var e=[],s=[],n=[],o=[],l=[];c=[];for(var r=0;r<=i;r++)r!==i&&e.push("|"),s[r]=270+Math.log10(t[r])/Math.log10(this.powerBase)*360,0!==r&&(n[r-1]=r==i-1?s[0]+360-s[r]:s[r]-s[r-1],c[r-1]=s[r-1]+n[r-1]/2);this.wheel.navAngle=270+n[0]/2,this.wheel.initWheel(e);for(var a=0;a<i;a++)0===a?(l[a]=360/i,o[a]=this.wheel.navAngle-l[0]/2):(o[a]=o[a-1]+l[a-1],l[a]=2*(c[a]-o[a])),this.wheel.navItems[a].sliceAngle=l[a];this.wheel.createWheel(),docById("wheelDiv3").style.position="absolute",docById("wheelDiv3").style.zIndex=10,docById("wheelDiv3").style.marginTop="15px",docById("wheelDiv3").style.marginLeft="37px",docById("wheelDiv3").addEventListener("mouseover",function(e){d.arbitraryEditSlider(e,c,t,i)})},this._createOuterWheel(),document.createElement("div"));s.id="divAppend",s.innerHTML=_("done"),s.style.textAlign="center",s.style.paddingTop="5px",s.style.backgroundColor=platformColor.selectorBackground,s.style.height="25px",s.style.marginTop="40px",s.style.overflow="auto",e.append(s),s.onmouseover=function(){this.style.cursor="pointer"},s.onclick=function(){d.ratios=d.tempRatios1.slice(),d.typeOfEdit="nonequal",d.pitchNumber=d.ratios.length-1;var e=[],t=d.frequencies[0];d.frequencies=[];for(var i=0;i<d.ratios.length;i++)d.frequencies[i]=d.ratios[i]*t,d.frequencies[i]=d.frequencies[i].toFixed(2);for(var s=0;s<d.ratios.length;s++)e[s]=d.ratios[s],e[s]=e[s].toFixed(2);d.checkTemperament(e),d._circleOfNotes()}},this.arbitraryEditSlider=function(e,t,i,s){for(var n=this,o=this.frequencies[0],l=[],r=0;r<=s;r++)l[r]=i[r]*o,l[r]=l[r].toFixed(2);for(var a=0;a<s;a++)(()=>{var t;e.target.parentNode.id=="wheelnav-wheelDiv3-title-"+a&&(t=n,null!==docById("noteInfo1")&&docById("noteInfo1").remove(),docById("wheelDiv3").innerHTML+='<div class="popup" id="noteInfo1" style="width:180px; height:135px;"><span class="popuptext" id="myPopup"></span></div>',docById("noteInfo1").innerHTML+='<img src="header-icons/close-button.svg" id="close" title="'+_("Close")+'" alt="'+_("Close")+'" height=20px width=20px align="right">',docById("noteInfo1").innerHTML+='<br><center><input type="range" class="sliders" id = "frequencySlider" style="width:170px; background:white; border:0;" min="'.concat(l[a],'" max="').concat(l[a+1],'" value="30"></center>'),docById("noteInfo1").innerHTML+="&nbsp;&nbsp;".concat(_("frequency"),' : <span class="rangeslidervalue" id="frequencydiv">').concat(l[a],"</span>"),docById("noteInfo1").innerHTML+='<br><br><div id="done" style="background:rgb(196, 196, 196);"><center>'.concat(_("done"),"</center><div>"),docById("noteInfo1").style.top="100px",docById("noteInfo1").style.left="90px",docById("frequencySlider").oninput=function(){t._refreshInnerWheel()},docById("done").onclick=function(){t.tempRatios1=t.tempRatios.slice();var e=t.tempRatios1.length-1;t._createOuterWheel(t.tempRatios1,e)},docById("close").onclick=function(){t.tempRatios=t.tempRatios1.slice();var e=t.tempRatios.length-1;t._createInnerWheel(t.tempRatios,e),docById("noteInfo1").remove()})})()},this._refreshInnerWheel=function(){docById("frequencydiv").innerHTML=docById("frequencySlider").value;var e=docById("frequencySlider").value,t=e/this.frequencies[0],i=[];this.tempRatios=this.tempRatios1.slice();for(var s=0;s<this.tempRatios.length;s++){i[s]=t-this.tempRatios[s],i[s]=i[s].toFixed(2);var n=void 0;if(i[s]<0){n=s,this.tempRatios.splice(n,0,t);break}if(0===i[s]){n=s,this.tempRatios.splice(n,1,t);break}}var o=this.tempRatios.length-1;this._logo.resetSynth(0),this._logo.synth.trigger(0,e,.01*Singer.defaultBPMFactor,"electronic synth",null,null),this._createInnerWheel(this.tempRatios,o)},this.octaveSpaceEdit=function(){this.editMode="octave",docById("userEdit").innerHTML="";var o=this.ratios.length,e=this.ratios[o-1],t=docById("userEdit"),l=(t.style.backgroundColor="#c8C8C8",t.innerHTML="<br><br>".concat(_("octave space"),' &nbsp;&nbsp;&nbsp;&nbsp; \n            <input type="text" id="startNote" value="').concat(e,'" style="width:50px;"></input> &nbsp;&nbsp; : &nbsp;&nbsp; <input type="text" id="endNote" value="1" style="width:50px;"></input><br><br>'),t.style.paddingLeft="70px",this),e=document.createElement("div");e.id="divAppend",e.innerHTML=_("done"),e.style.textAlign="center",e.style.paddingTop="5px",e.style.marginLeft="-70px",e.style.backgroundColor=platformColor.selectorBackground,e.style.height="25px",e.style.marginTop="40px",e.style.overflow="auto",t.append(e),e.onmouseover=function(){this.style.cursor="pointer"},e.onclick=function(){var e=docById("startNote").value/docById("endNote").value,t=(2!=e&&l.activity.textMsg(_("The octave ratio has changed. This changes temperament significantly."),3e3),[]),i=[],s=l.frequencies[0];l.frequencies=[];for(var n=0;n<o;n++)t[n]=Math.log10(l.ratios[n])/Math.log10(l.powerBase)*12,l.ratios[n]=Math.pow(e,t[n]/12),i[n]=l.ratios[n].toFixed(2),l.frequencies[n]=l.ratios[n]*s,l.frequencies[n]=l.frequencies[n].toFixed(2);l.powerBase=e,l.typeOfEdit="nonequal",l.checkTemperament(i),2!=e&&(l.octaveChanged=!0),l._circleOfNotes()}},this.checkTemperament=function(n){for(var o,l=this,r=[],a=getTemperamentKeys(),c=0;c<a.length&&!(()=>{var e=a[c];if(!isCustomTemperament(e)){for(var t=getTemperament(e),i=[],s=0;s<t.interval.length;s++)r[s]=t.interval[s],i[s]=t[r[s]],i[s]=i[s].toFixed(2);if(n.length==i.length&&n.every(function(e,t){return e===i[t]}))return o=e,l.inTemperament=e,d.innerHTML=l.inTemperament,1}})();c++);void 0===o&&(this.inTemperament="custom",d.innerHTML=this.inTemperament)},this._save=function(){if(this.notes=[],isCustomTemperament(this.inTemperament))for(var e=this._logo.synth.startingPitch,t=Number(e.slice(-1)),i=pitchToFrequency(e.substring(0,e.length-1),t,0,"C Major"),s="",n=0;n<this.ratios.length;n++){var o=frequencyToPitch(this.ratios[n]*i),l=o[0],r=o[1],o=o[2],a=(2!==this.powerBase&&(s=r),"");o<0?(o<-30?a="vv":o<-15&&(a="v"),this.notes[n]=a+l+s+"("+o.toFixed(0)+"¢)"+r):(30<o?a="^^":15<o&&(a="^"),this.notes[n]=a+l+s+"(+"+o.toFixed(0)+"¢)"+r)}setOctaveRatio(this.powerBase);for(var e=this._logo.synth.startingPitch.length,t=this._logo.synth.startingPitch.substring(0,e-1),e=this._logo.synth.startingPitch.slice(-1),t=[[0,"settemperament",150,150,[null,1,2,3,null]],[1,["temperamentname",{value:this.inTemperament}],0,0,[0]],[2,["notename",{value:t}],0,0,[0]],[3,["number",{value:e}],0,0,[0]]],e=(this.activity.blocks.loadNewBlocks(t),this.activity.blocks.findUniqueTemperamentName(this.inTemperament)),c=[[0,["temperament1",{collapsed:!0}],150,100,[null,1,2,null]],[1,["text",{value:this.inTemperament=e}],0,0,[0]],[2,["storein"],0,0,[0,3,4,5]],[3,["text",{value:this._logo.synth.startingPitch}],0,0,[2]],[4,["number",{value:this.frequencies[0]}],0,0,[2]],[5,["octavespace"],0,0,[2,6,9]],[6,["divide"],0,0,[5,7,8]],[7,["number",{value:rationalToFraction(getOctaveRatio())[0]}],0,0,[6]],[8,["number",{value:rationalToFraction(getOctaveRatio())[1]}],0,0,[6]],[9,"vspace",0,0,[5,10]]],h=9,d=0;d<this.pitchNumber;d++)var u=c.length,h=this.inTemperament.startsWith("equal")||"1/3 comma meantone"===this.inTemperament||"equal"===this.typeOfEdit&&this.divisions===this.pitchNumber?(c.push([u,"definefrequency",0,0,[h,u+1,u+8,u+12]]),c.push([u+1,"multiply",0,0,[u,u+2,u+3]]),c.push([u+2,["namedbox",{value:this._logo.synth.startingPitch}],0,0,[u+1]]),c.push([u+3,["power"],0,0,[u+1,u+4,u+5]]),c.push([u+4,["number",{value:this.powerBase}],0,0,[u+3]]),c.push([u+5,["divide"],0,0,[u+3,u+6,u+7]]),c.push([u+6,["number",{value:d}],0,0,[u+5]]),c.push([u+7,["number",{value:this.pitchNumber}],0,0,[u+5]]),c.push([u+8,"vspace",0,0,[u,u+9]]),c.push([u+9,["pitch"],0,0,[u+8,u+10,u+11,null]]),isCustomTemperament(this.inTemperament)?(c.push([u+10,["text",{value:this.notes[d].substring(0,this.notes[d].length-1)}],0,0,[u+9]]),c.push([u+11,["number",{value:this.notes[d].slice(-1)}],0,0,[u+9]])):(c.push([u+10,["notename",{value:this.ratiosNotesPair[d][1][0]}],0,0,[u+9]]),c.push([u+11,["number",{value:this.ratiosNotesPair[d][1][1]}],0,0,[u+9]])),d==this.pitchNumber-1?c.push([u+12,"hidden",0,0,[u,null]]):c.push([u+12,"hidden",0,0,[u,u+13]]),u+12):(c.push([u,"definefrequency",0,0,[h,u+1,u+6,u+10]]),c.push([u+1,"multiply",0,0,[u,u+2,u+3]]),c.push([u+2,["namedbox",{value:this._logo.synth.startingPitch}],0,0,[u+1]]),c.push([u+3,["divide"],0,0,[u+1,u+4,u+5]]),c.push([u+4,["number",{value:rationalToFraction(this.ratios[d])[0]}],0,0,[u+3]]),c.push([u+5,["number",{value:rationalToFraction(this.ratios[d])[1]}],0,0,[u+3]]),c.push([u+6,"vspace",0,0,[u,u+7]]),c.push([u+7,["pitch"],0,0,[u+6,u+8,u+9,null]]),isCustomTemperament(this.inTemperament)?(c.push([u+8,["text",{value:this.notes[d].substring(0,this.notes[d].length-1)}],0,0,[u+7]]),c.push([u+9,["number",{value:this.notes[d].slice(-1)}],0,0,[u+7]])):(c.push([u+8,["notename",{value:this.ratiosNotesPair[d][1][0]}],0,0,[u+7]]),c.push([u+9,["number",{value:this.ratiosNotesPair[d][1][1]}],0,0,[u+7]])),d==this.pitchNumber-1?c.push([u+10,"hidden",0,0,[u,null]]):c.push([u+10,"hidden",0,0,[u,u+11]]),u+10);var p=this;if(setTimeout(function(){p.activity.blocks.loadNewBlocks(c),activity.textMsg(_("New action block generated."),3e3)},500),isCustomTemperament(this.inTemperament)){deleteTemperamentFromList(this.inTemperament);for(var m={pitchNumber:this.pitchNumber},y=0;y<this.pitchNumber;y++)m[""+y]=[this.ratios[y],this.notes[y].substring(0,this.notes[y].length-1),this.notes[y].slice(-1)];addTemperamentToDictionary(this.inTemperament,m),updateTemperaments()}isCustomTemperament(this.inTemperament)&&(this._logo.customTemperamentDefined=!0,this.activity.blocks.protoBlockDict.custompitch.hidden=!1,this.activity.blocks.palettes.updatePalettes("pitch"))},this.playNote=function(e){this._logo.resetSynth(0);var t;null===docById("wheelDiv4")?(t=this.frequencies[e],"equal"==this.editMode&&this.eqTempHzs&&this.eqTempHzs.length?t=this.eqTempHzs[e]:"ratio"==this.editMode&&this.NEqTempHzs&&this.NEqTempHzs.length&&(t=this.NEqTempHzs[e])):t=this.tempRatios1[e]*this.frequencies[0],this._logo.synth.trigger(0,t,.5*Singer.defaultBPMFactor,"electronic synth",null,null)},this.playAll=function(){var t=0,i=(this._playing=!this._playing,this._logo.resetSynth(0),this.playButton),s=(this._playing?i.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/stop-button.svg" \n                    title="'.concat(_("Stop"),'" \n                    alt="').concat(_("Stop"),'" \n                    height="').concat(h,'" \n                    width="').concat(h,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;'):(this._logo.synth.setMasterVolume(0),this._logo.synth.stop(),i.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="').concat(h,'" \n                    width="').concat(h,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;')),.5),e=this._logo.synth.startingPitch,n=Number(e.slice(-1))-1,o=pitchToFrequency(e.substring(0,e.length-1),n,0,"C Major"),l=this,r=this.pitchNumber,e=("equal"==this.editMode&&this.eqTempPitchNumber?r=this.eqTempPitchNumber:"ratio"==this.editMode&&this.NEqTempPitchNumber&&(r=this.NEqTempPitchNumber),null!==docById("wheelDiv4")&&(r=this.tempRatios1.length-1),(new Date).getTime()),a=function(e){e===r&&(l.playbackForward=!1),0===e&&t++,l._playing&&(l._logo.synth.trigger(0,o,Singer.defaultBPMFactor*s,"electronic synth",null,null),l.playNote(e)),0==l.circleIsVisible&&null==docById("wheelDiv4")?(e===r&&l._playing?(l.notesCircle.navItems[0].fillAttr="#808080",l.notesCircle.navItems[0].sliceHoverAttr.fill="#808080",l.notesCircle.navItems[0].slicePathAttr.fill="#808080",l.notesCircle.navItems[0].sliceSelectedAttr.fill="#808080"):l._playing&&(l.notesCircle.navItems[e].fillAttr="#808080",l.notesCircle.navItems[e].sliceHoverAttr.fill="#808080",l.notesCircle.navItems[e].slicePathAttr.fill="#808080",l.notesCircle.navItems[e].sliceSelectedAttr.fill="#808080"),0==l.playbackForward&&e<r?e===r-1?(l.notesCircle.navItems[0].fillAttr="#c8C8C8",l.notesCircle.navItems[0].sliceHoverAttr.fill="#c8C8C8",l.notesCircle.navItems[0].slicePathAttr.fill="#c8C8C8",l.notesCircle.navItems[0].sliceSelectedAttr.fill="#c8C8C8"):(l.notesCircle.navItems[e+1].fillAttr="#c8C8C8",l.notesCircle.navItems[e+1].sliceHoverAttr.fill="#c8C8C8",l.notesCircle.navItems[e+1].slicePathAttr.fill="#c8C8C8",l.notesCircle.navItems[e+1].sliceSelectedAttr.fill="#c8C8C8"):0!==e&&(l.notesCircle.navItems[e-1].fillAttr="#c8C8C8",l.notesCircle.navItems[e-1].sliceHoverAttr.fill="#c8C8C8",l.notesCircle.navItems[e-1].slicePathAttr.fill="#c8C8C8",l.notesCircle.navItems[e-1].sliceSelectedAttr.fill="#c8C8C8"),l.notesCircle.refreshWheel()):1==l.circleIsVisible&&null==docById("wheelDiv4")?(docById("pitchNumber_"+e).style.background=platformColor.labelColor,0==l.playbackForward&&e<r?docById("pitchNumber_"+(e+1)).style.background=platformColor.selectorBackground:0!==e&&(docById("pitchNumber_"+(e-1)).style.background=platformColor.selectorBackground)):null!==docById("wheelDiv4")&&(e===r?(l.wheel1.navItems[0].fillAttr="#808080",l.wheel1.navItems[0].sliceHoverAttr.fill="#808080",l.wheel1.navItems[0].slicePathAttr.fill="#808080",l.wheel1.navItems[0].sliceSelectedAttr.fill="#808080"):(l.wheel1.navItems[e].fillAttr="#808080",l.wheel1.navItems[e].sliceHoverAttr.fill="#808080",l.wheel1.navItems[e].slicePathAttr.fill="#808080",l.wheel1.navItems[e].sliceSelectedAttr.fill="#808080"),0==l.playbackForward&&e<r?e===r-1?(l.wheel1.navItems[0].fillAttr="#e0e0e0",l.wheel1.navItems[0].sliceHoverAttr.fill="#e0e0e0",l.wheel1.navItems[0].slicePathAttr.fill="#e0e0e0",l.wheel1.navItems[0].sliceSelectedAttr.fill="#e0e0e0"):(l.wheel1.navItems[e+1].fillAttr="#e0e0e0",l.wheel1.navItems[e+1].sliceHoverAttr.fill="#e0e0e0",l.wheel1.navItems[e+1].slicePathAttr.fill="#e0e0e0",l.wheel1.navItems[e+1].sliceSelectedAttr.fill="#e0e0e0"):0!==e&&(l.wheel1.navItems[e-1].fillAttr="#e0e0e0",l.wheel1.navItems[e-1].sliceHoverAttr.fill="#e0e0e0",l.wheel1.navItems[e-1].slicePathAttr.fill="#e0e0e0",l.wheel1.navItems[e-1].sliceSelectedAttr.fill="#e0e0e0"),l.wheel1.refreshWheel()),l.playbackForward?e+=1:--e,e<=r&&0<=e&&l._playing&&t<2?setTimeout(function(){a(e)},1e3*Singer.defaultBPMFactor*s):l.inbetween=!0,l.playbackForward||-1!=e||(i.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(h,'" \n                        width="').concat(h,'" \n                        vertical-align="middle" \n                        align-content="center"\n                    >&nbsp;&nbsp;'),l._playing=!1,l.playbackForward=!0,this.inbetween=!1,setTimeout(function(){l.notesCircle.navItems[0].fillAttr="#c8C8C8",l.notesCircle.navItems[0].sliceHoverAttr.fill="#c8C8C8",l.notesCircle.navItems[0].slicePathAttr.fill="#c8C8C8",l.notesCircle.navItems[0].sliceSelectedAttr.fill="#c8C8C8",l.notesCircle.refreshWheel()},1e3*Singer.defaultBPMFactor*s))};if(this._playing&&e-this.lastClickTime>1e3*Singer.defaultBPMFactor*s||this.inbetween){if(l.playbackForward=!0,this.inbetween=!1,this.circleIsVisible)for(var c=0;c<=this.pitchNumber;c++)docById("pitchNumber_"+c).style.background=platformColor.selectorBackground;a(0)}this.lastClickTime=e},this.init=function(e){this.activity=e,this._logo=this.activity.logo;var e=window.innerWidth,e=(this._cellScale=e/1200,window.widgetWindows.windowFor(this,"temperament")),t=((this.widgetWindow=e).clear(),e.show(),e.getWidgetBody().append(y),e.getWidgetBody().style.height="500px",e.getWidgetBody().style.width="500px",this);e.onclose=function(){t._logo.synth.setMasterVolume(0),t._logo.synth.stop(),null!=docById("wheelDiv2")&&(docById("wheelDiv2").style.display="none",t.notesCircle.removeWheel()),null!=docById("wheelDiv3")&&(docById("wheelDiv3").style.display="none",t.wheel.removeWheel()),null!=docById("wheelDiv4")&&(docById("wheelDiv4").style.display="none",t.wheel1.removeWheel()),this.destroy()},this._playing=!1;var i=document.createElement("table").createTHead().insertRow(0),s=(i.id="buttonsRow",(d=i.insertCell()).innerHTML=this.inTemperament,d.style.width="106px",d.style.minWidth=d.style.width,d.style.maxWidth=d.style.width,d.style.height="53px",d.style.minHeight=d.style.height,d.style.maxHeight=d.style.height,d.style.textAlign="center",d.style.backgroundColor=platformColor.selectorBackground,this.playButton=e.addButton("play-button.svg",h,_("Play all")),this.lastClickTime=0,this.playbackForward=!0,this.inbetween=!1,this.playButton.onclick=function(){t.playAll()},e.addButton("export-chunk.svg",h,_("Save")).onclick=function(){t._save()},e.addButton("play-button.svg",h,_("Table"))),n=getTemperament(this.inTemperament),o=(this.pitchNumber=n.pitchNumber,this.octaveChanged=!1,this.scale=this.scale[0]+" "+this.scale[1],this.scaleNotes=buildScale(this.scale),this.scaleNotes=this.scaleNotes[0],this.powerBase=2,this._logo.synth.startingPitch),l=[],r=[];this.notes=[],this.frequencies=[],this.cents=[],this.intervals=[],this.ratios=[],this.ratiosNotesPair=[];for(var a,c=0;c<=this.pitchNumber;c++)isCustomTemperament(this.inTemperament)&&void 0!==n[0]&&void 0!==n[0][1]?(a=c+"",c===this.pitchNumber?(this.notes[c]=[n[0][1],Number(n[0][2])+1],this.ratios[c]=this.powerBase):(this.notes[c]=[n[a][1],n[a][2]],this.ratios[c]=n[a][0]),this.frequencies[c]=this._logo.synth.getCustomFrequency(this.notes[c][0]+this.notes[c][1]+"",this.inTemperament).toFixed(2),this.cents[c]=Math.log10(this.ratios[c])/Math.log10(this.powerBase)*1200):(isCustomTemperament(this.inTemperament)&&(n=getTemperament("equal")),l[c]=getNoteFromInterval(o,n.interval[c]),this.notes[c]=l[c],r[c]=l[c][0],l[c][0].substring(1,l[c][0].length)===FLAT||"b"===l[c][0].substring(1,l[c][0].length)?r[c]=l[c][0].replace(FLAT,"b"):l[c][0].substring(1,l[c][0].length)!==SHARP&&"#"!==l[c][0].substring(1,l[c][0].length)||(r[c]=l[c][0].replace(SHARP,"#")),l[c]=r[c]+l[c][1],this.intervals[c]=n.interval[c],this.ratios[c]=n[this.intervals[c]],this.cents[c]=Math.log10(this.ratios[c])/Math.log10(this.powerBase)*1200,0==c?this.frequencies[c]=this._logo.synth._getFrequency(l[c],!0,this.inTemperament).toFixed(2):(a=this.frequencies[0]*this.ratios[c],this.frequencies[c]=a.toFixed(2))),this.ratiosNotesPair[c]=[this.ratios[c],this.notes[c]];this.toggleNotesButton=function(){this.circleIsVisible?(s.getElementsByTagName("img")[0].src="header-icons/circle.svg",s.getElementsByTagName("img")[0].title="circle",s.getElementsByTagName("img")[0].alt="circle"):(s.getElementsByTagName("img")[0].src="header-icons/table.svg",s.getElementsByTagName("img")[0].title="table",s.getElementsByTagName("img")[0].alt="table")},this._circleOfNotes(),s.onclick=function(){t.editMode=null,t.circleIsVisible?t._circleOfNotes():t._graphOfNotes()},e.addButton("add2.svg",h,_("Add pitches")).onclick=function(){t.edit()},e.sendToCenter()}}
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var Tempo=(()=>{function l(){_classCallCheck(this,l),this._xradius=l.YRADIUS/3,this.BPMs=[],this.BPMInputs=[],this.BPMBlocks=[],this.tempoCanvases=[]}return _createClass(l,[{key:"init",value:function(t){var e,i,s,n=this,o=(this.activity=t,this._directions=[],this._widgetFirstTimes=[],this._widgetNextTimes=[],this._firstClickTimes=null,this._intervals=[],this.isMoving=!0,null!=this._intervalID&&null!=this._intervalID&&clearInterval(this._intervalID),this._intervalID=null,this.activity.logo.synth.loadSynth(0,getDrumSynthName(l.TEMPOSYNTH)),null!=this._intervalID&&clearInterval(this._intervalID),window.widgetWindows.windowFor(this,"tempo","tempo",!0)),r=((this.widgetWindow=o).clear(),o.show(),o.onclose=function(){null!=n._intervalID&&clearInterval(n._intervalID),o.destroy()},o.addButton("pause-button.svg",l.ICONSIZE,_("Pause")));r.onclick=function(){n.isMoving?(n.pause(),r.innerHTML='<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(l.ICONSIZE,'" \n                        width="').concat(l.ICONSIZE,'" \n                        vertical-align="middle"\n                    >'),n.isMoving=!1):(n.resume(),r.innerHTML='<img \n                        src="header-icons/pause-button.svg" \n                        title="'.concat(_("Pause"),'" \n                        alt="').concat(_("Pause"),'" \n                        height="').concat(l.ICONSIZE,'" \n                        width="').concat(l.ICONSIZE,'" \n                        vertical-align="middle"\n                    >'),n.isMoving=!0)},this._save_lock=!1,o.addButton("export-chunk.svg",l.ICONSIZE,_("Save tempo"),"").onclick=function(){n._get_save_lock()||(n._save_lock=!0,n._saveTempo(),setTimeout(function(){return n._save_lock=!1},1e3))},this.bodyTable=document.createElement("table"),this.widgetWindow.getWidgetBody().appendChild(this.bodyTable);for(var a=0;a<this.BPMs.length;a++)this._directions.push(1),this._widgetFirstTimes.push(this.activity.logo.firstNoteTime),this.BPMs[a]<=0&&(this.BPMs[a]=30),this._intervals.push(60/this.BPMs[a]*1e3),this._widgetNextTimes.push(this._widgetFirstTimes[a]-this._intervals[a]),e=this.bodyTable.insertRow(),s=this.bodyTable.insertRow(),i=this.bodyTable.insertRow(),o.addButton("up.svg",l.ICONSIZE,_("speed up"),e.insertCell()).onclick=(t=>function(){return n.speedUp(t)})(a),o.addButton("down.svg",l.ICONSIZE,_("slow down"),s.insertCell()).onclick=(t=>function(){return n.slowDown(t)})(a),this.BPMInputs[a]=o.addInputButton(this.BPMs[a],i.insertCell()),this.tempoCanvases[a]=document.createElement("canvas"),this.tempoCanvases[a].style.width=l.TEMPOWIDTH+"px",this.tempoCanvases[a].style.height=l.TEMPOHEIGHT+"px",this.tempoCanvases[a].style.margin="1px",this.tempoCanvases[a].style.background="rgba(255, 255, 255, 1)",(s=e.insertCell()).appendChild(this.tempoCanvases[a]),s.setAttribute("rowspan","3"),this.tempoCanvases[a].onclick=(i=>function(){var t,e=new Date;null!=n._firstClickTime&&29<(t=parseInt(6e4/(e.getTime()-n._firstClickTime)))&&t<1001?(n.BPMs[i]=t,n._updateBPM(i),n.BPMInputs[i].value=n.BPMs[i],n._firstClickTime=null):n._firstClickTime=e.getTime()})(a),this.BPMInputs[a].addEventListener("keyup",(e=>function(t){13===t.keyCode&&n._useBPM(e)})(a));t.textMsg(_("Adjust the tempo with the buttons."),3e3),this.resume(),o.sendToCenter()}},{key:"_updateBPM",value:function(t){var e;this._intervals[t]=60/this.BPMs[t]*1e3,null!=this.BPMBlocks[t]&&null!=(e=this.activity.blocks.blockList[this.BPMBlocks[t]].connections[1])&&(this.activity.blocks.blockList[e].value=parseFloat(this.BPMs[t]),this.activity.blocks.blockList[e].text.text=this.BPMs[t],this.activity.blocks.blockList[e].updateCache(),this.activity.refreshCanvas(),this.activity.saveLocally())}},{key:"pause",value:function(){clearInterval(this._intervalID)}},{key:"resume",value:function(){for(var t=this,e=new Date,i=0;i<this.BPMs.length;i++)this._widgetFirstTimes[i]=e.getTime(),this._widgetNextTimes[i]=this._widgetFirstTimes[i]+this._intervals[i],this._directions[i]=1;null!==this._intervalID&&clearInterval(this._intervalID),this._intervalID=setInterval(function(){t._draw()},l.TEMPOINTERVAL)}},{key:"_useBPM",value:function(t){var e=this.BPMInputs[t].value;isNaN(e)?activity.errorMsg(_("Please enter a number between 30 and 1000"),3e3):(this.BPMs[t]=this.BPMInputs[t].value,1e3<this.BPMs[t]?(this.BPMs[t]=1e3,activity.errorMsg(_("The beats per minute must be between 30 and 1000."),3e3)):this.BPMs[t]<30&&(this.BPMs[t]=30,activity.errorMsg(_("The beats per minute must be between 30 and 1000."),3e3)),this._updateBPM(t),this.BPMInputs[t].value=this.BPMs[t])}},{key:"speedUp",value:function(t){this.BPMs[t]=parseFloat(this.BPMs[t])+Math.round(.1*this.BPMs[t]),1e3<this.BPMs[t]&&(activity.errorMsg(_("The beats per minute must be below 1000."),3e3),this.BPMs[t]=1e3),this._updateBPM(t),this.BPMInputs[t].value=this.BPMs[t]}},{key:"slowDown",value:function(t){this.BPMs[t]=parseFloat(this.BPMs[t])-Math.round(.1*this.BPMs[t]),this.BPMs[t]<30&&(activity.errorMsg(_("The beats per minute must be above 30"),3e3),this.BPMs[t]=30),this._updateBPM(t),this.BPMInputs[t].value=this.BPMs[t]}},{key:"_draw",value:function(){for(var t,e,i,s=new Date,n=0;n<this.BPMs.length;n++)(t=this.tempoCanvases[n])&&(null==this._widgetFirstTimes[n]&&(this._widgetFirstTimes[n]=s.getTime(),this._widgetNextTimes[n]=this._widgetFirstTimes[n]+this._intervals[n]),i=this._widgetNextTimes[n]-s.getTime(),s.getTime()>this._widgetNextTimes[n]?(this.activity.logo.synth.trigger(0,["C2"],.0625,l.TEMPOSYNTH,null,null,!1),this._widgetNextTimes[n]+=this._intervals[n],-1===this._directions[n]?this._directions[n]=1:this._directions[n]=-1):(i=0!==this._intervals[n]?t.width*(i/this._intervals[n]):0,t.width-i<=l.YRADIUS/3?this._xradius=t.width-i:this._xradius=i<=l.YRADIUS/3?i:l.YRADIUS/3,e=-1===this._directions[n]?t.width-i:i),void 0===e&&(e=-1===this._directions[n]?0:t.width),(i=t.getContext("2d")).clearRect(0,0,t.width,t.height),i.beginPath(),i.fillStyle="rgba(0,0,0,1)",i.ellipse(e,l.YRADIUS,Math.max(this._xradius,1),l.YRADIUS,0,0,2*Math.PI),i.fill(),i.closePath())}},{key:"__save",value:function(e){var i=this;setTimeout(function(){var t=42*e,t=[[0,["setbpm3",{}],100+t,100+t,[null,1,2,5]],[1,["number",{value:i.BPMs[e]}],0,0,[0]],[2,["divide",{}],0,0,[0,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,["vspace",{}],0,0,[0,null]]];i.activity.blocks.loadNewBlocks(t),activity.textMsg(_("New action block generated."),3e3)},200*e)}},{key:"_saveTempo",value:function(){for(var t=0;t<this.BPMs.length;t++)this.__save(t)}},{key:"_get_save_lock",value:function(){return this._save_lock}}])})();_defineProperty(Tempo,"TEMPOSYNTH","bottle"),_defineProperty(Tempo,"TEMPOINTERVAL",5),_defineProperty(Tempo,"BUTTONDIVWIDTH",476),_defineProperty(Tempo,"BUTTONSIZE",53),_defineProperty(Tempo,"ICONSIZE",32),_defineProperty(Tempo,"TEMPOWIDTH",700),_defineProperty(Tempo,"TEMPOHEIGHT",100),_defineProperty(Tempo,"YRADIUS",75),"undefined"!=typeof module&&(module.exports=Tempo);
var Tempo=require("./tempo.js");global._=function(e){return e},global.getDrumSynthName=jest.fn(),global.window={widgetWindows:{windowFor:jest.fn().mockReturnValue({clear:jest.fn(),show:jest.fn(),addButton:jest.fn().mockReturnValue({onclick:function(){}}),addInputButton:jest.fn().mockImplementation(function(e){return{value:e,addEventListener:jest.fn()}}),getWidgetBody:jest.fn().mockReturnValue({appendChild:jest.fn(),insertRow:jest.fn().mockReturnValue({insertCell:jest.fn().mockReturnValue({appendChild:jest.fn(),setAttribute:jest.fn()})})}),sendToCenter:jest.fn()})}},global.document={createElement:jest.fn().mockReturnValue({style:{},getContext:jest.fn().mockReturnValue({clearRect:jest.fn(),beginPath:jest.fn(),fillStyle:"",ellipse:jest.fn(),fill:jest.fn(),closePath:jest.fn()})})},describe("Tempo Widget",function(){var e,t;beforeEach(function(){e=new Tempo,t={logo:{synth:{loadSynth:jest.fn()},firstNoteTime:1e3},blocks:{blockList:{},loadNewBlocks:jest.fn()},refreshCanvas:jest.fn(),saveLocally:jest.fn(),textMsg:jest.fn(),errorMsg:jest.fn()},global.activity=t,e.activity=t,e.BPMs=[100],e.BPMInputs=[{value:100}],e._intervals=[600],e.BPMBlocks=[null],e.isMoving=!0}),test("should initialize with default values",function(){expect(e.BPMs[0]).toBe(100),expect(e.isMoving).toBe(!0)}),test("speedUp() should increase BPM by 10%",function(){e.speedUp(0),expect(e.BPMs[0]).toBe(110),expect(e.BPMInputs[0].value).toBe(110)}),test("slowDown() should decrease BPM by 10%",function(){e.slowDown(0),expect(e.BPMs[0]).toBe(90),expect(e.BPMInputs[0].value).toBe(90)}),test("should not exceed maximum BPM of 1000",function(){e.BPMs[0]=950,e.speedUp(0),expect(e.BPMs[0]).toBe(1e3),expect(t.errorMsg).toHaveBeenCalled()}),test("should not go below minimum BPM of 30",function(){e.BPMs[0]=32,e.slowDown(0),expect(e.BPMs[0]).toBe(30),expect(t.errorMsg).toHaveBeenCalled()})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regenerator(){var m,t="function"==typeof Symbol?Symbol:{},e=t.iterator||"@@iterator",n=t.toStringTag||"@@toStringTag";function i(t,e,n,i){var s,a,o,r,l,c,d,u,h,e=e&&e.prototype instanceof p?e:p,e=Object.create(e.prototype);return _regeneratorDefine2(e,"_invoke",(s=t,a=n,d=i||[],u=!1,h={p:c=0,n:0,v:m,a:y,f:y.bind(m,4),d:function(t,e){return o=t,r=0,l=m,h.n=e,v}},function(t,e,n){if(1<c)throw TypeError("Generator is already running");for(u&&1===e&&y(e,n),r=e,l=n;(f=r<2?m:l)||!u;){o||(r?r<3?(1<r&&(h.n=-1),y(r,l)):h.n=l:h.v=l);try{if(c=2,o){if(f=o[t=r?t:"next"]){if(!(f=f.call(o,l)))throw TypeError("iterator result is not an object");if(!f.done)return f;l=f.value,r<2&&(r=0)}else 1===r&&(f=o.return)&&f.call(o),r<2&&(l=TypeError("The iterator does not provide a '"+t+"' method"),r=1);o=m}else if((f=(u=h.n<0)?l:s.call(a,h))!==v)break}catch(t){o=m,r=1,l=t}finally{c=1}}return{value:f,done:u}}),!0),e;function y(t,e){for(r=t,l=e,f=0;!u&&c&&!n&&f<d.length;f++){var n,i=d[f],s=h.p,a=i[2];3<t?(n=a===e)&&(l=i[(r=i[4])?5:r=3],i[4]=i[5]=m):i[0]<=s&&((n=t<2&&s<i[1])?(r=0,h.v=e,h.n=i[1]):s<a&&(n=t<3||i[0]>e||a<e)&&(i[4]=t,i[5]=e,h.n=a,r=0))}if(n||1<t)return v;throw u=!0,e}}var v={};function p(){}function s(){}function a(){}var f=Object.getPrototypeOf,t=[][e]?f(f([][e]())):(_regeneratorDefine2(f={},e,function(){return this}),f),o=a.prototype=p.prototype=Object.create(t);function r(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,_regeneratorDefine2(t,n,"GeneratorFunction")),t.prototype=Object.create(o),t}return _regeneratorDefine2(o,"constructor",s.prototype=a),_regeneratorDefine2(a,"constructor",s),_regeneratorDefine2(a,n,s.displayName="GeneratorFunction"),_regeneratorDefine2(o),_regeneratorDefine2(o,n,"Generator"),_regeneratorDefine2(o,e,function(){return this}),_regeneratorDefine2(o,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:i,m:r}})()}function _regeneratorDefine2(t,e,n,i){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}(_regeneratorDefine2=function(t,e,n,i){function s(e,n){_regeneratorDefine2(t,e,function(t){return this._invoke(e,n,t)})}e?a?a(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(s("next",0),s("throw",1),s("return",2))})(t,e,n,i)}function asyncGeneratorStep(t,e,n,i,s,a,o){try{var r=t[a](o),l=r.value}catch(t){return void n(t)}r.done?e(l):Promise.resolve(l).then(i,s)}function _asyncToGenerator(r){return function(){var t=this,o=arguments;return new Promise(function(e,n){var i=r.apply(t,o);function s(t){asyncGeneratorStep(i,e,n,s,a,"next",t)}function a(t){asyncGeneratorStep(i,e,n,s,a,"throw",t)}s(void 0)})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var TimbreWidget=(()=>{function u(){var N=this;_classCallCheck(this,u),_defineProperty(this,"_update",(()=>{var i=_asyncToGenerator(_regenerator().m(function t(e,n,i){var s,a,o,r,l,c,d,u,h,y,m,v,p;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(s=[],!0===N.isActive.envelope&&null!=N.env[e])for(a=0;a<4;a++)s[a]=N.activity.blocks.blockList[N.env[e]].connections[a+1];if(!0===N.isActive.filter&&null!=N.fil[e])for(o=0;o<3;o++)s[o]=N.activity.blocks.blockList[N.fil[e]].connections[o+1];if(!0===N.isActive.oscillator&&null!=N.osc[e])for(r=0;r<2;r++)s[r]=N.activity.blocks.blockList[N.osc[e]].connections[r+1];if(!0===N.isActive.amsynth&&null!=N.AMSynthesizer[e]&&(s[0]=N.activity.blocks.blockList[N.AMSynthesizer[e]].connections[1]),!0===N.isActive.fmsynth&&null!=N.FMSynthesizer[e]&&(s[0]=N.activity.blocks.blockList[N.FMSynthesizer[e]].connections[1]),!0===N.isActive.noisesynth&&null!=N.NoiseSynthesizer[e]&&(s[0]=N.activity.blocks.blockList[N.NoiseSynthesizer[e]].connections[1]),!0===N.isActive.duosynth&&null!=N.duoSynthesizer[e])for(l=0;l<2;l++)s[l]=N.activity.blocks.blockList[N.duoSynthesizer[e]].connections[l+1];if(!0===N.isActive.tremolo&&null!=N.tremoloEffect[e])for(c=0;c<2;c++)s[c]=N.activity.blocks.blockList[N.tremoloEffect[e]].connections[c+1];!0!==N.isActive.vibrato||null==N.vibratoEffect[e]?t.n=3:(s[0]=N.activity.blocks.blockList[N.vibratoEffect[e]].connections[1],d=N.activity.blocks.blockList[N.vibratoEffect[e]].connections[2],"divide"!==N.activity.blocks.blockList[d].name||null==N.activity.blocks.blockList[d].connections[1]||"number"!==N.activity.blocks.blockList[N.activity.blocks.blockList[d].connections[1]].name||null==N.activity.blocks.blockList[d].connections[2]||"number"!==N.activity.blocks.blockList[N.activity.blocks.blockList[d].connections[2]].name?t.n=1:(u=N.activity.blocks.blockList[d].connections[1],h=N.activity.blocks.blockList[d].connections[2],s[1]=h,s[2]=u,t.n=3));break;case 1:return h=rationalToFraction(N.activity.logo.parseArg(N.activity.logo,0,d,null,null)),y=N.activity.blocks.blockList.length,N.activity.blocks.loadNewBlocks([[0,["divide",{}],0,0,[null,1,2]],[1,["number",{value:h[0]}],0,0,[0]],[2,["number",{value:h[1]}],0,0,[0]]]),s[1]=y+2,s[2]=y+1,m=function(){N.activity.blocks.blockList[last(N.vibratoEffect)].connections[2]=y,N.activity.blocks.blockList[y].connections[0]=last(N.vibratoEffect),N.activity.blocks.blockList[d].connections[0]=null,N.activity.blocks.clampBlocksToCheck.push([y,0]),N.activity.blocks.clampBlocksToCheck.push([N.blockNo,0]),N.activity.blocks.adjustDocks(N.blockNo,!0)},t.n=2,delayExecution(500);case 2:m();case 3:if(!0===N.isActive.chorus&&null!=N.chorusEffect[e])for(v=0;v<3;v++)s[v]=N.activity.blocks.blockList[N.chorusEffect[e]].connections[v+1];if(!0===N.isActive.phaser&&null!=N.phaserEffect[e])for(p=0;p<3;p++)s[p]=N.activity.blocks.blockList[N.phaserEffect[e]].connections[p+1];!0===N.isActive.distortion&&null!=N.distortionEffect[e]&&(s[0]=N.activity.blocks.blockList[N.distortionEffect[e]].connections[1]),null!=s[0]&&(N.activity.blocks.blockList[s[i]].value="string"==typeof n?n:parseFloat(n),N.activity.blocks.blockList[s[i]].text.text=n.toString(),N.activity.blocks.blockList[s[i]].updateCache(),N.activity.refreshCanvas(),N.activity.saveLocally());case 4:return t.a(2)}},t)}));return function(t,e,n){return i.apply(this,arguments)}})()),_defineProperty(this,"clampConnection",(()=>{var i=_asyncToGenerator(_regenerator().m(function t(e,n,i){return _regenerator().w(function(t){for(;;)switch(t.n){case 0:return N.activity.blocks.blockList[N.blockNo].connections[2]=e,N.activity.blocks.blockList[e].connections[0]=N.blockNo,null!=i&&(N.activity.blocks.blockList[e].connections[n]=i,N.activity.blocks.blockList[i].connections[0]=e),N.activity.blocks.clampBlocksToCheck.push([e,0]),N.activity.blocks.clampBlocksToCheck.push([N.blockNo,0]),t.n=1,delayExecution(500);case 1:N.activity.blocks.adjustExpandableClampBlock(),N.activity.blocks.adjustDocks(N.blockNo,!0);case 2:return t.a(2)}},t)}));return function(t,e,n){return i.apply(this,arguments)}})()),_defineProperty(this,"clampConnectionVspace",(()=>{var i=_asyncToGenerator(_regenerator().m(function t(e,n,i){return _regenerator().w(function(t){for(;;)switch(t.n){case 0:return N.activity.blocks.blockList[N.blockNo].connections[2]=e,N.activity.blocks.blockList[e].connections[0]=N.blockNo,null!=i&&(N.activity.blocks.blockList[n].connections[1]=i,N.activity.blocks.blockList[i].connections[0]=n),N.activity.blocks.clampBlocksToCheck.push([e,0]),N.activity.blocks.clampBlocksToCheck.push([N.blockNo,0]),t.n=1,delayExecution(500);case 1:N.activity.blocks.adjustExpandableClampBlock(),N.activity.blocks.adjustDocks(N.blockNo,!0);case 2:return t.a(2)}},t)}));return function(t,e,n){return i.apply(this,arguments)}})()),_defineProperty(this,"blockConnection",(()=>{var n=_asyncToGenerator(_regenerator().m(function t(e,n){var i,s,a;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(i=N.activity.blocks.blockList.length-e,null==n)N.activity.blocks.blockList[N.blockNo].connections[2]=i,N.activity.blocks.blockList[i].connections[0]=N.blockNo;else{for(s=N.activity.blocks.blockList[n].connections.length-1;"hidden"===N.activity.blocks.blockList[n].name&&"newnote"!==N.activity.blocks.blockList[N.activity.blocks.blockList[n].connections[0]].name;)a=N.activity.blocks.blockList[n].connections[0],s=N.activity.blocks.blockList[a].connections.length-2,N.activity.blocks.clampBlocksToCheck.push([a,0]),null==N.activity.blocks.blockList[a].connections[s]?n=a:(n=N.activity.blocks.findBottomBlock(N.activity.blocks.blockList[a].connections[s]),s=N.activity.blocks.blockList[n].connections.length-1);N.activity.blocks.blockList[n].connections[s]=i,N.activity.blocks.blockList[i].connections[0]=n}return N.activity.blocks.clampBlocksToCheck.push([N.blockNo,0]),t.n=1,delayExecution(1e3);case 1:N.activity.blocks.adjustExpandableClampBlock(),N.activity.blocks.adjustDocks(N.blockNo,!0),N.activity.refreshCanvas();case 2:return t.a(2)}},t)}));return function(t,e){return n.apply(this,arguments)}})()),_defineProperty(this,"_synth",function(){for(var y=0,t=(N.timbreTableDiv.style.display="inline",N.timbreTableDiv.style.visibility="visible",N.timbreTableDiv.style.border="0px",N.timbreTableDiv.style.overflow="auto",N.timbreTableDiv.style.backgroundColor="white",N.timbreTableDiv.style.height="300px",N.timbreTableDiv.innerHTML='<div id="timbreTable"></div>',docById("timbreTable")),e="",n=0;n<2;n++)e+='<div id ="synth'+n+'"></div>';t.innerHTML=e;var i=document.createElement("div");i.id="envAppend",i.style.backgroundColor=platformColor.widgetBackground,i.style.height="30px",i.style.marginTop="40px",i.style.overflow="auto",t.append(i);docById("synth0").innerHTML='<p>\n                <input type="radio" name="synthsName" value="AMSynth"/>'.concat(_("AM synth"),'<br>\n                <input type="radio" name="synthsName" value="FMSynth"/>').concat(_("FM synth"),'<br>\n                <input type="radio" name="synthsName" value="DuoSynth"/>').concat(_("duo synth"),"<br>\n            </p>");for(var m,v=docById("synth1"),s=docByName("synthsName"),a=0;a<s.length;a++)s[a].onclick=(()=>{var e=_asyncToGenerator(_regenerator().m(function t(e){var n,i,s,a,o,r,l,c,d,u,h;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:for(m=e.target.value,n='<div id="chosen">'+m+"</div>",i=0;i<N.activeParams.length;i++)N.isActive[N.activeParams[i]]=!1;if(N.isActive.synth=!0,"AMSynth"!==m)t.n=3;else{if(N.isActive.amsynth=!0,N.isActive.fmsynth=!1,N.isActive.duosynth=!1,0===N.AMSynthesizer.length)return s=N.activity.blocks.blockList[N.blockNo].connections[2],s=N.activity.blocks.findBottomBlock(s),a=[[0,["amsynth",{}],0,0,[null,1,null]],[1,["number",{value:1}],0,0,[0]]],N.activity.blocks.loadNewBlocks(a),t.n=1,delayExecution(100);t.n=2}break;case 1:a=N.activity.blocks.blockList.length-2,N.AMSynthesizer.push(a),N.AMSynthParams.push(1),N._changeBlock(last(N.AMSynthesizer),m,s),N.amSynthParamvals.harmonicity=parseFloat(N.AMSynthParams[0]),N.activity.logo.synth.createSynth(0,N.instrumentName,"amsynth",N.amSynthParamvals);case 2:n+='<div id="wrapperS0"><div id="sS0"><span>'+_("harmonicity")+'</span></div><div class="insideDivSynth"><input type="range" id="myRangeS0" class="sliders" style="margin-top:20px" value="'+parseFloat(N.AMSynthParams[0])+'"><span id="myspanS0" class="rangeslidervalue">'+N.AMSynthParams[0]+"</span></div></div>",v.innerHTML=n,N.amSynthParamvals.harmonicity=parseFloat(N.AMSynthParams[0]),1!==N.AMSynthesizer.length&&(y=N.AMSynthesizer.length-1),document.getElementById("wrapperS0").addEventListener("change",function(t){t=t.target;docById("myRangeS0").value=parseFloat(t.value),N.amSynthParamvals.harmonicity=parseFloat(t.value),docById("myspanS0").textContent=t.value,N._update(y,t.value,0),N.activity.logo.synth.createSynth(0,N.instrumentName,"amsynth",N.amSynthParamvals),N._playNote("G4",1/8)}),t.n=12;break;case 3:if("FMSynth"!==m)t.n=6;else{if(N.isActive.amsynth=!1,N.isActive.fmsynth=!0,N.isActive.duosynth=!1,0===N.FMSynthesizer.length)return o=N.activity.blocks.blockList[N.blockNo].connections[2],o=N.activity.blocks.findBottomBlock(o),r=[[0,["fmsynth",{}],0,0,[null,1,null]],[1,["number",{value:10}],0,0,[0]]],N.activity.blocks.loadNewBlocks(r),t.n=4,delayExecution(100);t.n=5}break;case 4:r=N.activity.blocks.blockList.length-2,N.FMSynthesizer.push(r),N.FMSynthParams.push(10),N._changeBlock(last(N.FMSynthesizer),m,o),N.fmSynthParamvals.modulationIndex=parseFloat(N.FMSynthParams[0]),N.activity.logo.synth.createSynth(0,N.instrumentName,"fmsynth",N.fmSynthParamvals);case 5:n+='<div id="wrapperS0"><div id="sS0"><span>'+_("modulation index")+'</span></div><div class="insideDivSynth"><input type="range" id="myRangeS0" class="sliders" style="margin-top:20px" value="'+parseFloat(N.FMSynthParams[0])+'"><span id="myspanS0" class="rangeslidervalue">'+N.FMSynthParams[0]+"</span></div></div>",v.innerHTML=n,N.fmSynthParamvals.modulationIndex=parseFloat(N.FMSynthParams[0]),1!==N.FMSynthesizer.length&&(y=N.FMSynthesizer.length-1),document.getElementById("wrapperS0").addEventListener("change",function(t){t=t.target;docById("myRangeS0").value=parseFloat(t.value),docById("myspanS0").textContent=t.value,N.fmSynthParamvals.modulationIndex=parseFloat(t.value),N._update(y,t.value,0),N.activity.logo.synth.createSynth(0,N.instrumentName,"fmsynth",N.fmSynthParamvals),N._playNote("G4",1/8)}),t.n=12;break;case 6:if("NoiseSynth"!==m)t.n=9;else{if(N.isActive.amsynth=!1,N.isActive.fmsynth=!1,N.isActive.noisesynth=!0,N.isActive.duosynth=!1,0===N.NoiseSynthesizer.length)return l=N.activity.blocks.blockList[N.blockNo].connections[2],l=N.activity.blocks.findBottomBlock(l),c=[[0,["noisesynth",{}],0,0,[null,1,null]],[1,["number",{value:10}],0,0,[0]]],N.activity.blocks.loadNewBlocks(c),t.n=7,delayExecution(100);t.n=8}break;case 7:c=N.activity.blocks.blockList.length-2,N.NoiseSynthesizer.push(c),N.NoiseSynthParams.push("white"),N._changeBlock(last(N.NoiseSynthesizer),m,l),N.noiseSynthParamvals["noise.type"]=N.NoiseSynthParams[0],N.activity.logo.synth.createSynth(0,N.instrumentName,"noisesynth",N.noiseSynthParamvals);case 8:n+='<div id="wrapperS0"><div id="sS0"><span>'+_("modulation index")+'</span></div><div class="insideDivSynth"><input type="range" id="myRangeS0" class="sliders" style="margin-top:20px" value="'+N.NoiseSynthParams[0]+'"><span id="myspanS0" class="rangeslidervalue">'+N.NoiseSynthParams[0]+"</span></div></div>",v.innerHTML=n,N.noiseSynthParamvals["noise.type"]=N.NoiseSynthParams[0],1!==N.NoiseSynthesizer.length&&(y=N.NoiseSynthesizer.length-1),document.getElementById("wrapperS0").addEventListener("change",function(t){t=t.target;docById("myRangeS0").value=parseFloat(t.value),docById("myspanS0").textContent=t.value,N.noiseSynthParamvals["noise.type"]=parseFloat(t.value),N._update(y,t.value,0),N.activity.logo.synth.createSynth(0,N.instrumentName,"noisesynth",N.noiseSynthParamvals),N._playNote(1/8)}),t.n=12;break;case 9:if("DuoSynth"!==m)t.n=12;else{if(N.isActive.amsynth=!1,N.isActive.fmsynth=!1,N.isActive.duosynth=!0,0===N.duoSynthesizer.length)return d=N.activity.blocks.blockList[N.blockNo].connections[2],d=N.activity.blocks.findBottomBlock(d),u=[[0,["duosynth",{}],0,0,[null,1,2,null]],[1,["number",{value:10}],0,0,[0]],[2,["number",{value:6}],0,0,[0]]],N.activity.blocks.loadNewBlocks(u),t.n=10,delayExecution(100);t.n=11}break;case 10:u=N.activity.blocks.blockList.length-3,N.duoSynthesizer.push(u),N.duoSynthParams.push(10),N.duoSynthParams.push(6),N._changeBlock(last(N.duoSynthesizer),m,d),N.duoSynthParamVals.vibratoRate=parseFloat(N.duoSynthParams[0]),N.duoSynthParamVals.vibratoAmount=parseFloat(N.duoSynthParams[1]),N.activity.logo.synth.createSynth(0,N.instrumentName,"duosynth",N.duoSynthParamVals);case 11:for(n=(n+='<div id="wrapperS0"><div id="sS0"><span>'+_("vibrato rate")+'</span></div><div class="insideDivSynth"><input type="range" id="myRangeS0" class="sliders" style="margin-top:20px" value="'+parseFloat(N.duoSynthParams[0])+'"><span id="myspanS0" class="rangeslidervalue">'+N.duoSynthParams[0]+"</span></div></div>")+('<div id="wrapperS1"><div id="sS1"><span>'+_("vibrato amount")+'</span></div><div class="insideDivSynth"><input type="range" id="myRangeS1" class="sliders" style="margin-top:20px" value="'+parseFloat(N.duoSynthParams[1])+'"><span id="myspanS1" class="rangeslidervalue">'+N.duoSynthParams[1]+"</span></div></div>"),v.innerHTML=n,1!==N.duoSynthesizer.length&&(y=N.duoSynthesizer.length-1),N.duoSynthParamVals.vibratoRate=parseFloat(N.duoSynthParams[0]),N.duoSynthParamVals.vibratoAmount=parseFloat(N.duoSynthParams[1]),h=0;h<2;h++)document.getElementById("wrapperS"+h).addEventListener("change",function(t){var t=t.target,e=t.id.slice(-1);docById("myRangeS"+e).value=parseFloat(t.value),0===e?N.duoSynthParamVals.vibratoRate=parseFloat(t.value):1===e&&(N.duoSynthParamVals.vibratoAmount=parseFloat(t.value)),docById("myspanS"+e).textContent=t.value,N._update(y,t.value,Number(e)),N.activity.logo.synth.createSynth(0,N.instrumentName,"duosynth",N.duoSynthParamVals),N._playNote("G4",1/8)});case 12:return t.a(2)}},t)}));return function(t){return e.apply(this,arguments)}})()}),_defineProperty(this,"_addFilter",_asyncToGenerator(_regenerator().m(function t(){var e,n,i,s;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:return e=docById("timbreTable"),n=N.activity.blocks.blockList[N.blockNo].connections[2],n=N.activity.blocks.findBottomBlock(n),N.fil.push(N.activity.blocks.blockList.length),i=instrumentsFilters[0][N.instrumentName].slice(),(s=FILTERTYPES.slice().filter(function(t){for(var e in i)if(i[e].filterType===t[1])return!1;return!0})).length<=0?N.filterParams.push(DEFAULTFILTERTYPE):N.filterParams.push(s[0][1]),N.filterParams.push(-12),N.filterParams.push(392),s=N.filterParams.length,N.activity.blocks.loadNewBlocks([[0,["filter",{}],0,0,[null,3,1,2,null]],[1,["number",{value:N.filterParams[s-2]}],0,0,[0]],[2,["number",{value:N.filterParams[s-1]}],0,0,[0]],[3,["filtertype",{value:N.filterParams[s-3]}],0,0,[0]]]),t.n=1,delayExecution(500);case 1:N.blockConnection(4,n),N._createFilter(N.fil.length-1,e),N._playNote("G4",1/8),N._updateFilters();case 2:return t.a(2)}},t)}))),_defineProperty(this,"_effects",function(){for(var C=0,t=(Object.assign(N.timbreTableDiv.style,{display:"inline",visibility:"visible",border:"0px",overflow:"auto",backgroundColor:"white",height:"300px"}),N.timbreTableDiv.innerHTML='<div id="timbreTable"></div>',docById("timbreTable")),e="",n=0;n<2;n++)e+='<div id ="effect'+n+'"></div>';t.innerHTML=e;for(var x,i=document.createElement("div"),t=(i.id="envAppend",i.style.backgroundColor=platformColor.widgetBackground,i.style.height="30px",i.style.marginTop="40px",i.style.overflow="auto",t.append(i),docById("effect0")),i=["Tremolo","Vibrato","Chorus","Phaser","Distortion"].map(function(t){return'<input type="radio" name="effectsName" value="'.concat(t,'"/>').concat(_(t.toLowerCase()),"<br>")}).join(""),I=(t.innerHTML="<p>".concat(i,"</p>"),docById("effect1")),s=docByName("effectsName"),a=0;a<s.length;a++)s[a].onclick=(()=>{var e=_asyncToGenerator(_regenerator().m(function t(e){var n,i,s,a,o,r,l,c,d,u,h,y,m,v,p,f,b,g,k,S,F,P,B,E;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(x=e.target.value,n='<div id="chosen">'+x+"</div>","Tremolo"!==x)t.n=3;else{for(N.isActive.tremolo=!0,N.isActive.chorus=!1,N.isActive.vibrato=!1,N.isActive.distortion=!1,N.isActive.phaser=!1,instrumentsEffects[0][N.instrumentName].tremoloActive=!0,i=0;i<2;i++)n+='<div id="wrapperFx'+i+'"><div id="sFx'+i+'"><span></span></div><div class="insideDivEffects"><input type="range" id="myRangeFx'+i+'" class="sliders" style="margin-top:20px" value="2"><span id="myspanFx'+i+'" class="rangeslidervalue">2</span></div></div>';if(I.innerHTML=n,docById("sFx0").textContent=_("rate"),docById("myRangeFx0").value=10,docById("myspanFx0").textContent="10",docById("sFx1").textContent=_("depth"),docById("myRangeFx1").value=50,docById("myspanFx1").textContent="50",0!==N.tremoloEffect.length)for(C=N.tremoloEffect.length-1,s=0;s<2;s++)docById("myRangeFx"+s).value=parseFloat(N.tremoloParams[s]),docById("myspanFx"+s).textContent=N.tremoloParams[s],N._update(C,N.tremoloParams[s],s);if(0===N.tremoloEffect.length)return a=N.activity.blocks.blockList[N.blockNo].connections[2],o=N.activity.blocks.blockList.length,c=[[0,["tremolo",{}],0,0,[null,1,2,null,3]],[1,["number",{value:10}],0,0,[0]],[2,["number",{value:50}],0,0,[0]],[3,"hidden",0,0,[0,null]]],N.activity.blocks.loadNewBlocks(c),N.tremoloEffect.push(o),N.tremoloParams.push(10),N.tremoloParams.push(50),t.n=1,delayExecution(500);t.n=2}break;case 1:N.clampConnection(o,3,a);case 2:for(r=0;r<2;r++)document.getElementById("wrapperFx"+r).addEventListener("change",function(t){var t=t.target,e=t.id.slice(-1);docById("myRangeFx"+e).value=parseFloat(t.value),docById("myspanFx"+e).textContent=t.value,0===e&&(instrumentsEffects[0][N.instrumentName].tremoloFrequency=parseFloat(t.value)),1===e&&(instrumentsEffects[0][N.instrumentName].tremoloDepth=parseFloat(t.value)/100),N._update(C,parseFloat(t.value),Number(e)),N._playNote("G4",1/8)});t.n=16;break;case 3:if("Vibrato"!==x)t.n=7;else{for(N.isActive.tremolo=!1,N.isActive.chorus=!1,N.isActive.vibrato=!0,N.isActive.distortion=!1,N.isActive.phaser=!1,instrumentsEffects[0][N.instrumentName].vibratoActive=!0,l=0;l<2;l++)n+='<div id="wrapperFx'+l+'"><div id="sFx'+l+'"><span></span></div><div class="insideDivEffects"><input type="range" id="myRangeFx'+l+'" class="sliders" style="margin-top:20px" max="25" value="2"><span id="myspanFx'+l+'" class="rangeslidervalue">2</span></div></div>';I.innerHTML=n,docById("sFx0").textContent=_("intensity"),docById("sFx1").textContent=_("rate"),0<N.vibratoEffect.length?(docById("myRangeFx0").value=parseFloat(N.vibratoParams[0]),docById("myspanFx0").textContent=N.vibratoParams[0],docById("myRangeFx1").value=100/parseFloat(N.vibratoParams[1]),c=rationalToFraction(1/parseFloat(N.vibratoParams[1])),docById("myspanFx1").textContent=c[0]+"/"+c[1],t.n=6):t.n=4}break;case 4:return d=N.activity.blocks.blockList[N.blockNo].connections[2],u=N.activity.blocks.blockList.length,p=[[0,["vibrato",{}],0,0,[null,1,3,2,6]],[1,["number",{value:5}],0,0,[0]],[2,["vspace",{}],0,0,[0,null]],[3,["divide",{}],0,0,[0,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:16}],0,0,[3]],[6,["hidden",{}],0,0,[0,null]]],N.activity.blocks.loadNewBlocks(p),N.vibratoEffect.push(u),N.vibratoParams.push(5),N.vibratoParams.push(16),t.n=5,delayExecution(500);case 5:N.clampConnectionVspace(u,u+2,d),docById("myRangeFx0").value=5,docById("myspanFx0").textContent="5",instrumentsEffects[0][N.instrumentName].vibratoIntensity=.05,docById("myRangeFx1").value=6.25,docById("myspanFx1").textContent="1/16",instrumentsEffects[0][N.instrumentName].vibratoFrequency=1/16;case 6:document.getElementById("wrapperFx0").addEventListener("change",function(t){t=t.target;docById("myRangeFx0").value=parseFloat(t.value),docById("myspanFx0").textContent=t.value,instrumentsEffects[0][N.instrumentName].vibratoIntensity=parseFloat(t.value)/100,N._update(N.vibratoEffect.length-1,t.value,0),N._playNote("G4",1/8)}),document.getElementById("wrapperFx1").addEventListener("change",function(t){var t=t.target,t=(docById("myRangeFx1").value=parseFloat(t.value),oneHundredToFraction(t.value)),e=(docById("myspanFx1").textContent=t[0]+"/"+t[1],parseFloat(t[0])/parseFloat(t[1]));instrumentsEffects[0][N.instrumentName].vibratoFrequency=e,N._update(N.vibratoEffect.length-1,t[1],1),N._update(N.vibratoEffect.length-1,t[0],2),N._playNote("G4",1/8)}),t.n=16;break;case 7:if("Chorus"!==x)t.n=10;else{for(N.isActive.tremolo=!1,N.isActive.chorus=!0,N.isActive.vibrato=!1,N.isActive.distortion=!1,N.isActive.phaser=!1,instrumentsEffects[0][N.instrumentName].chorusActive=!0,h=0;h<3;h++)n+='<div id="wrapperFx'+h+'"><div id="sFx'+h+'"><span></span></div><div class="insideDivEffects"><input type="range" id="myRangeFx'+h+'" class="sliders" style="margin-top:20px" value="2"><span id="myspanFx'+h+'" class="rangeslidervalue">2</span></div></div>';if(I.innerHTML=n,docById("sFx0").textContent=_("rate"),docById("myRangeFx0").value=2,docById("myspanFx0").textContent="2",instrumentsEffects[0][N.instrumentName].chorusRate=2,docById("sFx1").textContent=_("delay (MS)"),docById("myRangeFx1").value=4,docById("myspanFx1").textContent="4",instrumentsEffects[0][N.instrumentName].delayTime=4,docById("sFx2").textContent=_("depth"),docById("myRangeFx2").value=70,docById("myspanFx2").textContent="70",instrumentsEffects[0][N.instrumentName].chorusDepth=4,0!==N.chorusEffect.length)for(C=N.chorusEffect.length-1,y=0;y<3;y++)docById("myRangeFx"+y).value=parseFloat(N.chorusParams[y]),docById("myspanFx"+y).textContent=N.chorusParams[y],N._update(C,N.chorusParams[y],y);if(0===N.chorusEffect.length)return m=N.activity.blocks.blockList[N.blockNo].connections[2],v=N.activity.blocks.blockList.length,p=[[0,["chorus",{}],0,0,[null,1,2,3,null,4]],[1,["number",{value:2}],0,0,[0]],[2,["number",{value:4}],0,0,[0]],[3,["number",{value:70}],0,0,[0]],[4,"hidden",0,0,[0,null]]],N.activity.blocks.loadNewBlocks(p),N.chorusEffect.push(v),N.chorusParams.push(2),N.chorusParams.push(4),N.chorusParams.push(70),t.n=8,delayExecution(500);t.n=9}break;case 8:N.clampConnection(v,4,m);case 9:for(f=0;f<3;f++)document.getElementById("wrapperFx"+f).addEventListener("change",function(t){var t=t.target,e=t.id.slice(-1);docById("myRangeFx"+e).value=parseFloat(t.value),docById("myspanFx"+e).textContent=t.value,0===e&&(instrumentsEffects[0][N.instrumentName].chorusRate=parseFloat(t.value)),1===e&&(instrumentsEffects[0][N.instrumentName].delayTime=parseFloat(t.value)),2===e&&(instrumentsEffects[0][N.instrumentName].chorusDepth=parseFloat(t.value)/100),N._update(C,t.value,Number(e)),N._playNote("G4",1/8)});t.n=16;break;case 10:if("Phaser"!==x)t.n=13;else{for(N.isActive.tremolo=!1,N.isActive.chorus=!1,N.isActive.vibrato=!1,N.isActive.distortion=!1,N.isActive.phaser=!0,instrumentsEffects[0][N.instrumentName].phaserActive=!0,instrumentsEffects[0][N.instrumentName].rate=5,instrumentsEffects[0][N.instrumentName].octaves=3,instrumentsEffects[0][N.instrumentName].baseFrequency=100,b=0;b<3;b++)n+='<div id="wrapperFx'+b+'"><div id="sFx'+b+'"><span></span></div><div class="insideDivEffects"><input type="range" id="myRangeFx'+b+'" class="sliders" style="margin-top:20px" min="0" max="1000" value="2"><span id="myspanFx'+b+'" class="rangeslidervalue">2</span></div></div>';if(I.innerHTML=n,docById("sFx0").textContent=_("rate"),docById("myRangeFx0").value=5,docById("myspanFx0").textContent="5",docById("sFx1").textContent=_("octaves"),docById("myRangeFx1").value=3,docById("myspanFx1").textContent="3",docById("sFx2").textContent=_("base frequency"),docById("myRangeFx2").value=1e3,docById("myspanFx2").textContent="1000",0!==N.phaserEffect.length)for(C=N.phaserEffect.length-1,g=0;g<3;g++)docById("myRangeFx"+g).value=parseFloat(N.phaserParams[g]),docById("myspanFx"+g).textContent=N.phaserParams[g],N._update(C,N.phaserParams[g],g);if(0===N.phaserEffect.length)return k=N.activity.blocks.blockList[N.blockNo].connections[2],S=N.activity.blocks.blockList.length,E=[[0,["phaser",{}],0,0,[null,1,2,3,null,4]],[1,["number",{value:5}],0,0,[0]],[2,["number",{value:3}],0,0,[0]],[3,["number",{value:100}],0,0,[0]],[4,"hidden",0,0,[0,null]]],N.activity.blocks.loadNewBlocks(E),N.phaserEffect.push(S),N.phaserParams.push(5),N.phaserParams.push(3),N.phaserParams.push(350),t.n=11,delayExecution(500);t.n=12}break;case 11:N.clampConnection(S,4,k);case 12:for(F=0;F<3;F++)document.getElementById("wrapperFx"+F).addEventListener("change",function(t){var t=t.target,e=t.id.slice(-1);docById("myRangeFx"+e).value=parseFloat(t.value),docById("myspanFx"+e).textContent=t.value,0===e&&(instrumentsEffects[0][N.instrumentName].rate=parseFloat(t.value)),1===e&&(instrumentsEffects[0][N.instrumentName].octaves=parseFloat(t.value)),2===e&&(instrumentsEffects[0][N.instrumentName].baseFrequency=parseFloat(t.value)),N._update(C,parseFloat(t.value),Number(e)),N._playNote("G4",1/8)});t.n=16;break;case 13:if("Distortion"!==x)t.n=16;else{if(N.isActive.tremolo=!1,N.isActive.chorus=!1,N.isActive.vibrato=!1,N.isActive.distortion=!0,N.isActive.phaser=!1,instrumentsEffects[0][N.instrumentName].distortionActive=!0,n+='<div id="wrapperFx0"><div id="sFx0"><span></span></div><div class="insideDivEffects"><input type="range" id="myRangeFx0" class="sliders" style="margin-top:20px" value="2"><span id="myspanFx0" class="rangeslidervalue">2</span></div></div>',I.innerHTML=n,docById("sFx0").textContent=_("distortion amount"),docById("myRangeFx0").value=40,docById("myspanFx0").textContent="40",0!==N.distortionEffect.length&&(C=N.distortionEffect.length-1,docById("myRangeFx0").value=parseFloat(N.distortionParams[0]),docById("myspanFx0").textContent=N.distortionParams[0],N._update(C,N.distortionParams[0],0)),0===N.distortionEffect.length)return P=N.activity.blocks.blockList[N.blockNo].connections[2],B=N.activity.blocks.blockList.length,E=[[0,["dis",{}],0,0,[null,1,null,2]],[1,["number",{value:40}],0,0,[0]],[2,"hidden",0,0,[0,null]]],N.activity.blocks.loadNewBlocks(E),N.distortionEffect.push(B),N.distortionParams.push(40),t.n=14,delayExecution(500);t.n=15}break;case 14:N.clampConnection(B,2,P);case 15:document.getElementById("wrapperFx0").addEventListener("change",function(t){t=t.target;docById("myRangeFx0").value=parseFloat(t.value),docById("myspanFx0").textContent=t.value,instrumentsEffects[0][N.instrumentName].distortionAmount=parseFloat(t.value)/100,N._update(C,t.value,0),N._playNote("G4",1/8)});case 16:return t.a(2)}},t)}));return function(t){return e.apply(this,arguments)}})()}),this.notesToPlay=[],this.env=[],this.ENVs=[],this._eventListeners={},this.synthVals={oscillator:{type:"sine6",source:DEFAULTOSCILLATORTYPE},envelope:{attack:.01,decay:.5,sustain:.6,release:.01}},this.adsrMap=["attack","decay","sustain","release"],this.amSynthParamvals={harmonicity:3},this.fmSynthParamvals={modulationIndex:10},this.noiseSynthParamvals={noise:{type:"white"}},this.duoSynthParamVals={vibratoAmount:.5,vibratoRate:5},this.fil=[],this.filterParams=[],this.osc=[],this.oscParams=[],this.tremoloEffect=[],this.tremoloParams=[],this.vibratoEffect=[],this.vibratoParams=[],this.chorusEffect=[],this.chorusParams=[],this.phaserEffect=[],this.phaserParams=[],this.distortionEffect=[],this.distortionParams=[],this.AMSynthesizer=[],this.AMSynthParams=[],this.FMSynthesizer=[],this.FMSynthParams=[],this.NoiseSynthesizer=[],this.NoiseSynthParams=[],this.duoSynthesizer=[],this.duoSynthParams=[],this.activeParams=["synth","amsynth","fmsynth","noisesynth","duosynth","envelope","oscillator","filter","effects","chorus","vibrato","phaser","distortion","tremolo"],this.isActive={};for(var t=0;t<this.activeParams.length;t++)this.isActive[this.activeParams[t]]=!1;this.blockNo=null,this.instrumentName="custom",this.instrumentName in instrumentsFilters[0]||(instrumentsFilters[0][this.instrumentName]=[]),this.instrumentName in instrumentsEffects[0]||(instrumentsEffects[0][this.instrumentName]=[]),this.timbreTableDiv=document.createElement("div")}return _createClass(u,[{key:"_addButton",value:function(t,e,n,i){var s=this,t=t.insertCell(-1);return t.innerHTML='&nbsp;&nbsp;<img \n                src="header-icons/'.concat(e,'" \n                title="').concat(i,'" \n                alt="').concat(i,'" \n                height="').concat(n,'" \n                width="').concat(n,'" \n                vertical-align="middle" \n                align-content="center"\n            >&nbsp;&nbsp;'),t.style.width=u.BUTTONSIZE+"px",t.style.minWidth=t.style.width,t.style.maxWidth=t.style.width,t.style.height=t.style.width,t.style.minHeight=t.style.height,t.style.maxHeight=t.style.height,t.style.backgroundColor=platformColor.selectorBackground,t.onmouseover=function(){s.style.backgroundColor=platformColor.selectorBackgroundHOVER},t.onmouseout=function(){s.style.backgroundColor=platformColor.selectorBackground},t}},{key:"_playNote",value:function(t,e){var n,i;this.activity.logo.synth.setMasterVolume(last(Singer.masterVolume)),this.instrumentName in instrumentsFilters[0]?(i={doVibrato:!1,doDistortion:!1,doTremolo:!1,doPhaser:!1,doChorus:!1,vibratoIntensity:0,vibratoFrequency:0,distortionAmount:0,tremoloFrequency:0,tremoloDepth:0,rate:0,octaves:0,baseFrequency:0,chorusRate:0,delayTime:0,chorusDepth:0},(n=instrumentsEffects[0][this.instrumentName]).vibratoActive&&(i.vibratoFrequency=n.vibratoFrequency,i.vibratoIntensity=n.vibratoIntensity,i.doVibrato=!0),n.distortionActive&&(i.distortionAmount=n.distortionAmount,i.doDistortion=!0),n.tremoloActive&&(i.tremoloFrequency=n.tremoloFrequency,i.tremoloDepth=n.tremoloDepth,i.doTremolo=!0),n.phaserActive&&(i.rate=n.rate,i.octaves=n.octaves,i.baseFrequency=n.baseFrequency,i.doPhaser=!0),n.chorusActive&&(i.chorusRate=n.chorusRate,i.delayTime=n.delayTime,i.chorusDepth=n.chorusDepth,i.doChorus=!0),this.activity.logo.synth.trigger(0,t,Singer.defaultBPMFactor*e,this.instrumentName,i,instrumentsFilters[0][this.instrumentName])):this.activity.logo.synth.trigger(0,t,Singer.defaultBPMFactor*e,this.instrumentName,null,null)}},{key:"_play",value:function(){var e=this,n=(this._playing=!this._playing,this.activity.logo.resetSynth(0),this.playButton),i=(this._playing?n.innerHTML='&nbsp;&nbsp;<img src="header-icons/stop-button.svg" title="'+_("Stop")+'" alt="'+_("Stop")+'" height="'+u.ICONSIZE+'" width="'+u.ICONSIZE+'" vertical-align="middle" align-content="center">&nbsp;&nbsp;':(this.activity.logo.synth.setMasterVolume(0),this.activity.logo.synth.stop(),n.innerHTML='&nbsp;&nbsp;<img \n                    src="header-icons/play-button.svg" \n                    title="'.concat(_("Play"),'" \n                    alt="').concat(_("Play"),'" \n                    height="').concat(u.ICONSIZE,'" \n                    width="').concat(u.ICONSIZE,'" \n                    vertical-align="middle" \n                    align-content="center"\n                >&nbsp;&nbsp;')),0===this.notesToPlay.length&&(this.notesToPlay=[["G4",.25],["E4",.25],["G4",.5]]),function(t){e._playing&&e._playNote(e.notesToPlay[t][0],e.notesToPlay[t][1]),(t+=1)<e.notesToPlay.length&&e._playing?setTimeout(function(){i(t)},1e3*Singer.defaultBPMFactor*e.notesToPlay[t-1][1]):(n.innerHTML='&nbsp;&nbsp;<img \n                        src="header-icons/play-button.svg" \n                        title="'.concat(_("Play"),'" \n                        alt="').concat(_("Play"),'" \n                        height="').concat(u.ICONSIZE,'" \n                        width="').concat(u.ICONSIZE,'" \n                        vertical-align="middle" \n                        align-content="center"\n                    >&nbsp;&nbsp;'),e._playing=!1)});this._playing&&i(0)}},{key:"_save",value:function(){var t=[[0,"settimbre",100+this._delta,100+this._delta,[null,1,null,2]],[1,["text",{value:"custom"}],0,0,[0]],[2,"hidden",0,0,[0,null]]];this.activity.blocks.loadNewBlocks(t),this._delta+=42}},{key:"_undo",value:function(){var t=0;if(this.isActive.envelope){1<this.env.length&&(t=this.env.length-1),docById("envelopeButtonCell").style.backgroundColor=platformColor.selectorBackground;for(var e=0;e<4;e++)this.synthVals.envelope[this.adsrMap[e]]=parseFloat(this.ENVs[e])/100,docById("myRange"+e).value=parseFloat(this.ENVs[e]),docById("myspan"+e).textContent=this.ENVs[e],this._update(t,parseFloat(this.ENVs[e]),e);this.activity.logo.synth.createSynth(0,this.instrumentName,this.synthVals.oscillator.source,this.synthVals)}else if(!0===this.isActive.amsynth)docById("synthButtonCell").style.backgroundColor=platformColor.selectorBackground,1<this.AMSynthesizer.length&&(t=this.AMSynthesizer.length-1),docById("myRangeS0").value=parseFloat(this.AMSynthParams[0]),docById("myspanS0").textContent=this.AMSynthParams[0],this.amSynthParamvals.harmonicity=parseFloat(this.AMSynthParams[0]),this._update(t,this.AMSynthParams[0],0),this.activity.logo.synth.createSynth(0,this.instrumentName,"amsynth",this.amSynthParamvals);else if(!0===this.isActive.fmsynth)docById("synthButtonCell").style.backgroundColor=platformColor.selectorBackground,1<this.FMSynthesizer.length&&(t=this.FMSynthesizer.length-1),docById("myRangeS0").value=parseFloat(this.FMSynthParams[0]),docById("myspanS0").textContent=this.FMSynthParams[0],this.fmSynthParamvals.modulationIndex=parseFloat(this.FMSynthParams[0]),this._update(t,this.FMSynthParams[0],0),this.activity.logo.synth.createSynth(0,this.instrumentName,"fmsynth",this.fmSynthParamvals);else if(!0===this.isActive.noisesynth)docById("synthButtonCell").style.backgroundColor=platformColor.selectorBackground,1<this.NoiseSynthesizer.length&&(t=this.NoiseSynthesizer.length-1),docById("myRangeS0").value=this.NoiseSynthParams[0],docById("myspanS0").textContent=this.NoiseSynthParams[0],this.noiseSynthParamvals["noise.type"]=this.NoiseSynthParams[0],this._update(t,this.NoiseSynthParams[0],0),this.activity.logo.synth.createSynth(0,this.instrumentName,"noisesynth",this.noiseSynthParamvals);else if(!0===this.isActive.duosynth)docById("synthButtonCell").style.backgroundColor=platformColor.selectorBackground,1<this.duoSynthesizer.length&&(t=this.duoSynthesizer.length-1),docById("myRangeS0").value=parseFloat(this.duoSynthParams[0]),docById("myspanS0").textContent=this.duoSynthParams[0],this.duoSynthParamVals.vibratoRate=parseFloat(this.duoSynthParams[0]),this._update(t,this.duoSynthParams[0],0),docById("myRangeS1").value=parseFloat(this.duoSynthParams[1]),docById("myspanS1").textContent=this.duoSynthParams[1],this.duoSynthParamVals.vibratoAmount=parseFloat(this.duoSynthParams[1]),this._update(t,this.duoSynthParams[1],1),this.activity.logo.synth.createSynth(0,this.instrumentName,"duosynth",this.duoSynthParamVals);else if(this.isActive.oscillator)docById("oscillatorButtonCell").style.backgroundColor=platformColor.selectorBackground,1<this.osc.length&&(t=this.osc.length-1),docById("selOsc1").value=DEFAULTOSCILLATORTYPE,this._update(t,DEFAULTOSCILLATORTYPE,0),docById("myRangeO0").value=parseFloat(6),docById("myspanO0").textContent="6",this._update(t,"6",1),this.synthVals.oscillator.type="sine6",this.synthVals.oscillator.source=DEFAULTOSCILLATORTYPE,this.activity.logo.synth.createSynth(0,this.instrumentName,this.oscParams[0],this.synthVals);else if(this.isActive.filter)for(var n=0;n<this.fil.length;n++){docById("filterButtonCell").style.backgroundColor=platformColor.selectorBackground,docById("sel"+n).value=this.filterParams[3*n],this._update(n,this.filterParams[3*n],0),instrumentsFilters[0][this.instrumentName][n].filterType=this.filterParams[3*n];var i=[4*n,4*n+1,4*n+2,4*n+3];-12===this.filterParams[3*n+1]?docById("radio"+i[0]).checked=!0:docById("radio"+i[0]).checked=!1,-24===this.filterParams[3*n+1]?docById("radio"+i[1]).checked=!0:docById("radio"+i[1]).checked=!1,-48===this.filterParams[3*n+1]?docById("radio"+i[2]).checked=!0:docById("radio"+i[2]).checked=!1,-96===this.filterParams[3*n+1]?docById("radio"+i[3]).checked=!0:docById("radio"+i[3]).checked=!1,this._update(n,this.filterParams[1+3*n],1),instrumentsFilters[0][this.instrumentName][n].filterRolloff=parseFloat(this.filterParams[1+3*n]),docById("myRangeF"+n).value=parseFloat(this.filterParams[2+3*n]),docById("myspanF"+n).textContent=this.filterParams[2+3*n],this._update(n,this.filterParams[2+3*n],2),instrumentsFilters[0][this.instrumentName][n].filterFrequency=parseFloat(this.filterParams[2+3*n])}else if(!0===this.isActive.tremolo){docById("effectsButtonCell").style.backgroundColor=platformColor.selectorBackground,1!==this.tremoloEffect.length&&(t=this.tremoloEffect.length-1);for(var s=0;s<2;s++)docById("myRangeFx"+s).value=parseFloat(this.tremoloParams[s]),docById("myspanFx"+s).textContent=this.tremoloParams[s],this._update(t,this.tremoloParams[s],s)}else if(!0===this.isActive.vibrato){docById("effectsButtonCell").style.backgroundColor=platformColor.selectorBackground,1!==this.vibratoEffect.length&&(t=this.vibratoEffect.length-1);for(var a=0;a<2;a++)docById("myRangeFx"+a).value=parseFloat(this.vibratoParams[a]),docById("myspanFx"+a).textContent=this.vibratoParams[a],this._update(t,this.vibratoParams[a],a)}else if(!0===this.isActive.phaser){docById("effectsButtonCell").style.backgroundColor=platformColor.selectorBackground,1!==this.phaserEffect.length&&(t=this.phaserEffect.length-1);for(var o=0;o<3;o++)docById("myRangeFx"+o).value=parseFloat(this.phaserParams[o]),docById("myspanFx"+o).textContent=this.phaserParams[o],this._update(t,this.phaserParams[o],o)}else if(!0===this.isActive.chorus){docById("effectsButtonCell").style.backgroundColor=platformColor.selectorBackground,1!==this.chorusEffect.length&&(t=this.chorusEffect.length-1);for(var r=0;r<3;r++)docById("myRangeFx"+r).value=parseFloat(this.chorusParams[r]),docById("myspanFx"+r).textContent=this.chorusParams[r],this._update(t,this.chorusParams[r],r)}else!0===this.isActive.distortion&&(docById("effectsButtonCell").style.backgroundColor=platformColor.selectorBackground,1!==this.distortionEffect.length&&(t=this.distortionEffect.length-1),docById("myRangeFx0").value=parseFloat(this.distortionParams[0]),docById("myspanFx0").textContent=this.distortionParams[0],this._update(t,this.distortionParams[0],0));this._playNote("G4",1/8)}},{key:"init",value:function(e){var s,a=this,t=(this.activity=e,this._delta=0,this._playing=!1,window.widgetWindows.windowFor(this,"timbre","timbre",!0)),n=((this.widgetWindow=t).clear(),t.show(),window.innerWidth),i=(this._cellScale=n/1200,t.getWidgetBody().append(this.timbreTableDiv),t.getWidgetBody().style.height="500px",t.getWidgetBody().style.width="600px",t.getWidgetBody().style.overflowY="auto",t.onclose=function(){a._cleanupEventListeners(),a.activity.hideMsgs(),t.destroy()},this.playButton=t.addButton("play-button.svg",u.ICONSIZE,_("Play")),this.playButton.onclick=function(){a._play()},t.addButton("export-chunk.svg",u.ICONSIZE,_("Save")).onclick=function(){a._save()},t.addButton("synth.svg",u.ICONSIZE,_("Synthesizer"))),o=(i.id="synthButtonCell",this.isActive.synth=!1,i.onclick=function(){s(i);for(var t=0;t<a.activeParams.length;t++)a.isActive[a.activeParams[t]]=!1;a.isActive.synth=!0,0===a.osc.length?a._synth():e.errorMsg(_("Unable to use synth due to existing oscillator"),3e3)},t.addButton("oscillator.svg",u.ICONSIZE,_("Oscillator"))),r=(o.id="oscillatorButtonCell",this.isActive.oscillator=!1,o.onclick=_asyncToGenerator(_regenerator().m(function t(){var e,n,i;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:for(s(o),e=0;e<a.activeParams.length;e++)a.isActive[a.activeParams[e]]=!1;if(a.isActive.oscillator=!0,0===a.osc.length)return n=a.activity.blocks.blockList[a.blockNo].connections[2],n=a.activity.blocks.findBottomBlock(n),i=[[0,["oscillator",{}],0,0,[null,2,1,null]],[1,["number",{value:6}],0,0,[0]],[2,["oscillatortype",{value:DEFAULTOSCILLATORTYPE}],0,0,[0]]],a.activity.blocks.loadNewBlocks(i),t.n=1,delayExecution(100);t.n=3;break;case 1:return i=a.activity.blocks.blockList.length-3,a.osc.push(i),a.oscParams.push(DEFAULTOSCILLATORTYPE),a.oscParams.push(6),t.n=2,delayExecution(500);case 2:a.blockConnection(3,n),a._oscillator(!0),t.n=4;break;case 3:a._oscillator(!1);case 4:0===a.osc.length||0===a.AMSynthesizer.length&&0===a.FMSynthesizer.length&&0===a.duoSynthesizer.length||a._oscillator(!1);case 5:return t.a(2)}},t)})),t.addButton("envelope.svg",u.ICONSIZE,_("Envelope"))),l=(r.id="envelopeButtonCell",this.isActive.envelope=!1,r.onclick=_asyncToGenerator(_regenerator().m(function t(){var e,n,i;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:for(s(r),e=0;e<a.activeParams.length;e++)a.isActive[a.activeParams[e]]=!1;if(a.isActive.envelope=!0,0===a.env.length)return n=a.activity.blocks.blockList[a.blockNo].connections[2],n=a.activity.blocks.findBottomBlock(n),i=[[0,["envelope",{}],0,0,[null,1,2,3,4,null]],[1,["number",{value:1}],0,0,[0]],[2,["number",{value:50}],0,0,[0]],[3,["number",{value:60}],0,0,[0]],[4,["number",{value:1}],0,0,[0]]],a.activity.blocks.loadNewBlocks(i),t.n=1,delayExecution(100);t.n=3;break;case 1:return i=a.activity.blocks.blockList.length-5,a.env.push(i),a.ENVs.push(1),a.ENVs.push(50),a.ENVs.push(60),a.ENVs.push(1),t.n=2,delayExecution(500);case 2:a.blockConnection(5,n),a._envelope(!0),t.n=4;break;case 3:a._envelope(!1);case 4:return t.a(2)}},t)})),t.addButton("effects.svg",u.ICONSIZE,_("Effects"))),c=(l.id="effectsButtonCell",this.isActive.effects=!1,l.onclick=function(){s(l);for(var t=0;t<a.activeParams.length;t++)a.isActive[a.activeParams[t]]=!1;a.isActive.effects=!0,a._effects()},t.addButton("filter.svg",u.ICONSIZE,_("Filter"))),d=(c.id="filterButtonCell",this.isActive.filter=!1,c.onclick=_asyncToGenerator(_regenerator().m(function t(){var e,n,i;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:for(s(c),e=0;e<a.activeParams.length;e++)a.isActive[a.activeParams[e]]=!1;if(a.isActive.filter=!0,0===a.fil.length)return n=a.activity.blocks.blockList[a.blockNo].connections[2],n=a.activity.blocks.findBottomBlock(n),i=[[0,["filter",{}],0,0,[null,3,1,2,null]],[1,["number",{value:-12}],0,0,[0]],[2,["number",{value:392}],0,0,[0]],[3,["filtertype",{value:DEFAULTFILTERTYPE}],0,0,[0]]],a.activity.blocks.loadNewBlocks(i),t.n=1,delayExecution(100);t.n=3;break;case 1:return i=a.activity.blocks.blockList.length-4,a.fil.push(i),a.filterParams.push(DEFAULTFILTERTYPE),a.filterParams.push(-12),a.filterParams.push(392),t.n=2,delayExecution(500);case 2:a.blockConnection(4,n);case 3:a._filter();case 4:return t.a(2)}},t)})),t.addButton("filter+.svg",u.ICONSIZE,_("Add filter")));d.style.backgroundColor="#808080",d.onclick=function(){a.isActive.filter&&a._addFilter()},d.onmouseover=function(){},d.onmouseout=function(){},t.addButton("restore-button.svg",u.ICONSIZE,_("Undo")).onclick=function(){a._undo()},s=function(t){d.style.backgroundColor=platformColor.widgetButton,i.style.backgroundColor=platformColor.widgetButton,o.style.backgroundColor=platformColor.widgetButton,r.style.backgroundColor=platformColor.widgetButton,l.style.backgroundColor=platformColor.widgetButton,c.style.backgroundColor=platformColor.widgetButton,t.style.backgroundColor=platformColor.widgetButtonSelect},e.textMsg(_("Click on buttons to open the timbre design tools."),3e3),t.sendToCenter()}},{key:"_changeBlock",value:function(t,e,n){var i=0;0!==this.AMSynthesizer.length&&"AMSynth"!==e?(i=this.AMSynthesizer.pop(),setTimeout(this._blockReplace(i,t),500)):0!==this.FMSynthesizer.length&&"FMSynth"!==e?(i=this.FMSynthesizer.pop(),setTimeout(this._blockReplace(i,t),500)):0!==this.duoSynthesizer.length&&"DuoSynth"!==e?(i=this.duoSynthesizer.pop(),setTimeout(this._blockReplace(i,t),500)):"FMSynth"===e||"AMSynth"===e?setTimeout(this.blockConnection(2,n),500):setTimeout(this.blockConnection(3,n),500)}},{key:"_blockReplace",value:function(t,e){var n=this.activity.blocks.blockList[t].connections[0],i=last(this.activity.blocks.blockList[t].connections);if(this.activity.blocks.blockList[e].connections[0]=n,this.activity.blocks.blockList[e].connections[this.activity.blocks.blockList[e].connections.length-1]=i,null!=n){for(var s=0;s<this.activity.blocks.blockList[n].connections.length;s++)if(this.activity.blocks.blockList[n].connections[s]===t){this.activity.blocks.blockList[n].connections[s]=e;break}for(var a=n;a!=this.blockNo;)this.activity.blocks.blockList[a].isClampBlock()&&this.activity.blocks.clampBlocksToCheck.push([a,0]),a=this.activity.blocks.blockList[a].connections[0];this.activity.blocks.clampBlocksToCheck.push([this.blockNo,0])}if(null!=i)for(var o=0;o<this.activity.blocks.blockList[i].connections.length;o++)if(this.activity.blocks.blockList[i].connections[o]===t){this.activity.blocks.blockList[i].connections[o]=e;break}this.activity.blocks.adjustDocks(n,!0),this.activity.blocks.blockList[t].connections[0]=null,this.activity.blocks.blockList[t].connections[this.activity.blocks.blockList[t].connections.length-1]=null,this.activity.blocks.sendStackToTrash(this.activity.blocks.blockList[t]),this.activity.refreshCanvas()}},{key:"_oscillator",value:function(t){for(var e=this,n=0,i=(1!==this.osc.length&&(n=this.osc.length-1),this.timbreTableDiv.style.display="inline",this.timbreTableDiv.style.visibility="visible",this.timbreTableDiv.style.border="0px",this.timbreTableDiv.style.overflow="auto",this.timbreTableDiv.style.backgroundColor="white",this.timbreTableDiv.style.height="300px",this.timbreTableDiv.innerHTML='<div id="timbreTable"></div>',docById("timbreTable")),s='<div id="wrapperOsc0"><div id="sOsc0"><span>'+_("type")+'</span></div><div id="selOsc"></div></div>',s=(s+='<div id="wrapperOsc1"><div id="sOsc1"><span>'+_("partials")+'</span></div><div class="insideDivOsc"><input type="range" id="myRangeO0" class="sliders" style="margin-top:20px" min="0" max="20" value="'+parseFloat(this.oscParams[1])+'"><span id="myspanO0" class="rangeslidervalue">'+this.oscParams[1]+"</span></div></div>",i.innerHTML=s,document.createElement("div")),i=(s.id="envAppend",s.style.backgroundColor=platformColor.widgetBackground,s.style.height="30px",s.style.marginTop="40px",s.style.overflow="auto",i.append(s),docById("selOsc")),a='<select id="selOsc1">',o=0;o<OSCTYPES.length;o++)0===OSCTYPES[o][0].length?OSCTYPES[o][0]===this.oscParams[0]||OSCTYPES[o][1]===this.oscParams[0]?a+='<option value="'+OSCTYPES[o][1]+'" selected>'+OSCTYPES[o][1]+"</option>":a+='<option value="'+OSCTYPES[o][1]+'">'+OSCTYPES[o][1]+"</option>":OSCTYPES[o][0]===this.oscParams[0]||OSCTYPES[o][1]===this.oscParams[0]?a+='<option value="'+OSCTYPES[o][0]+'" selected>'+OSCTYPES[o][0]+"</option>":a+='<option value="'+OSCTYPES[o][0]+'">'+OSCTYPES[o][0]+"</option>";i.innerHTML=a+="</select>",document.getElementById("wrapperOsc0").addEventListener("change",function(t){t=t.target;e.oscParams[0]=t.value,e.synthVals.oscillator.type=t.value+e.oscParams[1].toString(),e.synthVals.oscillator.source=t.value,e._update(n,t.value,0),e.activity.logo.synth.createSynth(0,e.instrumentName,e.oscParams[0],e.synthVals),e._playNote("G4",1/8)}),document.getElementById("wrapperOsc1").addEventListener("change",function(t){t=t.target;e.oscParams[1]=parseFloat(t.value),e.synthVals.oscillator.type=e.oscParams[0]+parseFloat(t.value),docById("myRangeO0").value=parseFloat(t.value),docById("myspanO0").textContent=t.value,e._update(n,t.value,1),e.activity.logo.synth.createSynth(0,e.instrumentName,e.oscParams[0],e.synthVals),e._playNote("G4",1/8)}),docById("selOsc1").value=this.oscParams[0],this._update(n,this.oscParams[0],0),this._update(n,this.oscParams[1],1),this.synthVals.oscillator.type=this.oscParams[0]+this.oscParams[1].toString(),this.synthVals.oscillator.source=this.oscParams[0],t&&this.activity.logo.synth.createSynth(0,this.instrumentName,this.oscParams[0],this.synthVals)}},{key:"_envelope",value:function(t){for(var n=this,i=0,e=(1!==this.env.length&&(i=this.env.length-1),this.timbreTableDiv.style.display="inline",this.timbreTableDiv.style.visibility="visible",this.timbreTableDiv.style.border="0px",this.timbreTableDiv.style.overflow="auto",this.timbreTableDiv.style.backgroundColor="white",this.timbreTableDiv.style.height="300px",this.timbreTableDiv.innerHTML='<div id="timbreTable"></div>',docById("timbreTable")),s="",a=0;a<4;a++)s+='<div id="wrapperEnv'+a+'"><div class="circle">'+"ADSR".charAt(a)+'</div><div class="insideDivEnv"><input type="range" id="myRange'+a+'" class="sliders" style="margin-top:20px" value="'+parseFloat(this.ENVs[a])+'"><span id="myspan'+a+'" class="rangeslidervalue">'+this.ENVs[a]+"</span></div></div>";e.innerHTML=s;var o=document.createElement("div");o.id="envAppend",o.style.backgroundColor=platformColor.widgetBackground,o.style.height="30px",o.style.marginTop="40px",o.style.overflow="auto",e.append(o);for(var r=0;r<4;r++)this.synthVals.envelope[this.adsrMap[r]]=parseFloat(this.ENVs[r])/100,this._update(i,this.ENVs[r],r);for(var l=0;l<4;l++)document.getElementById("wrapperEnv"+l).addEventListener("change",function(t){var t=t.target,e=t.id.slice(-1);docById("myRange"+e).value=parseFloat(t.value),docById("myspan"+e).textContent=t.value,n.synthVals.envelope[n.adsrMap[e]]=parseFloat(t.value)/100,n._update(i,parseFloat(t.value),e),n.activity.logo.synth.createSynth(0,n.instrumentName,n.synthVals.oscillator.source,n.synthVals),n._playNote("G4",1/8)});t&&this.activity.logo.synth.createSynth(0,this.instrumentName,this.synthVals.oscillator.source,this.synthVals)}},{key:"_filter",value:function(){this.timbreTableDiv.style.display="inline",this.timbreTableDiv.style.visibility="visible",this.timbreTableDiv.style.border="0px",this.timbreTableDiv.style.overflow="auto",this.timbreTableDiv.style.backgroundColor="white",this.timbreTableDiv.style.height="300px",this.timbreTableDiv.innerHTML='<div id="timbreTable"></div>';var t=docById("timbreTable");t.innerHTML="";for(var e=0;e<this.fil.length;e++)this._createFilter(e,t);this._setupEventDelegation(),this._updateFilters()}},{key:"_createFilter",value:function(t,e){for(var n=[3*t,3*t+1,3*t+2],i=[4*t,4*t+1,4*t+2,4*t+3],s=document.createDocumentFragment(),a=document.createElement("div"),o=(t%2==1?(a.className="rectangle",(o=document.createElement("p")).innerHTML="&nbsp;",a.appendChild(o)):0<t&&((o=document.createElement("p")).innerHTML="&nbsp;",a.appendChild(o)),document.createElement("div")),r=(o.className="wrapper",o.id="wrapper"+n[0],document.createElement("div")),l=(r.className="s",r.id="s"+n[0],document.createElement("span")),l=(l.textContent=_("type"),r.appendChild(l),"selector"+t),c="sel"+t,d=document.createElement("div"),r=(d.className="filterselector",d.id=l,o.appendChild(r),o.appendChild(d),a.appendChild(o),document.createElement("div")),d=(r.className="wrapper",r.id="wrapper"+n[1],document.createElement("div")),o=(d.className="s",d.id="s"+n[1],document.createElement("span")),o=(o.textContent=_("rolloff"),d.appendChild(o),document.createElement("div")),u=(o.className="insideDivFilter",document.createElement("p")),h=["-12","-24","-48","-96"],y=0;y<4;y++){var m=document.createElement("input");m.type="radio",m.id="radio"+i[y],m.name="rolloff"+t,m.value=h[y],0===y&&(m.checked=!0),u.appendChild(m),u.appendChild(document.createTextNode(h[y]))}o.appendChild(u),r.appendChild(d),r.appendChild(o),a.appendChild(r);for(var d=document.createElement("div"),o=(d.className="wrapper",d.id="wrapper"+n[2],document.createElement("div")),r=(o.className="s",o.id="s"+n[2],document.createElement("span")),n=(r.textContent=_("frequency"),o.appendChild(r),document.createElement("div")),r=(n.className="insideDivFilter",document.createElement("input")),v=(r.type="range",r.id="myRangeF"+t,r.className="sliders",r.style.marginTop="20px",r.max="7050",r.value=parseFloat(this.filterParams[3*t+2]),document.createElement("span")),p=(v.id="myspanF"+t,v.className="rangeslidervalue",v.textContent=this.filterParams[3*t+2],n.appendChild(r),n.appendChild(v),d.appendChild(o),d.appendChild(n),a.appendChild(d),s.appendChild(a),e.appendChild(s),document.createElement("select")),f=(p.className="sel",p.id=c,null),b=0;b<FILTERTYPES.length;b++){var g=document.createElement("option");0===FILTERTYPES[b][0].length?(g.value=FILTERTYPES[b][1],g.textContent=FILTERTYPES[b][1],FILTERTYPES[b][1]===this.filterParams[3*t]&&(g.selected=!0,f=FILTERTYPES[b][1])):(g.value=FILTERTYPES[b][0],g.textContent=FILTERTYPES[b][0],FILTERTYPES[b][0]===this.filterParams[3*t]&&(g.selected=!0,f=FILTERTYPES[b][0])),p.appendChild(g)}docById(l).appendChild(p),instrumentsFilters[0][this.instrumentName].length-1<t&&instrumentsFilters[0][this.instrumentName].push({filterType:f,filterRolloff:-12,filterFrequency:392})}},{key:"_setupEventDelegation",value:function(){var s=this,t=docById("timbreTable"),a=(this._cleanupEventListeners(),docById("filterButtonCell"));this._eventHandler=function(t){var e,n=t.target,i=n.id||"";i.startsWith("sel")&&"change"===t.type?(a.style.backgroundColor="#C8C8C0",e=i.slice(-1),instrumentsFilters[0][s.instrumentName][e].filterType=n.value,s._update(e,n.value,0),1<instrumentsFilters[0][s.instrumentName].filter(function(t){return t.filterType===n.value}).length&&activity.errorMsg(_("Filter already present."),3e3),s._playNote("G4",1/8)):i.startsWith("radio")&&"click"===t.type?(e=Number(i.replace("radio","")),instrumentsFilters[0][s.instrumentName][Math.floor(e/4)].filterRolloff=parseFloat(n.value),s._update(Math.floor(e/4),n.value,1),s._playNote("G4",1/8)):!i.startsWith("myRangeF")||"change"!==t.type&&"input"!==t.type?(i.startsWith("wrapperS")&&"change"===t.type||i.startsWith("wrapperOsc")&&"change"===t.type||i.startsWith("wrapperEnv")&&"change"===t.type||i.startsWith("wrapperFx")&&"change"===t.type)&&s._playNote("G4",1/8):(a.style.backgroundColor="#C8C0C8",e=i.slice(-1),(t=docById("myspanF"+e))&&(t.textContent=n.value),instrumentsFilters[0][s.instrumentName][e].filterFrequency=parseFloat(n.value),s._update(e,n.value,2),s._playNote("G4",1/8))},t.addEventListener("change",this._eventHandler),t.addEventListener("click",this._eventHandler),t.addEventListener("input",this._eventHandler),this._eventListeners={element:t,listeners:[{type:"change",handler:this._eventHandler},{type:"click",handler:this._eventHandler},{type:"input",handler:this._eventHandler}]}}},{key:"_cleanupEventListeners",value:function(){var e=this;this._eventListeners&&this._eventListeners.element&&(this._eventListeners.listeners.forEach(function(t){e._eventListeners.element.removeEventListener(t.type,t.handler)}),this._eventListeners={})}},{key:"_addFilterListeners",value:function(){this._setupEventDelegation()}},{key:"_updateFilters",value:function(){for(var t=0;t<this.fil.length;t++){var e=[4*t,4*t+1,4*t+2,4*t+3],n=(docById("sel"+t).value=instrumentsFilters[0][this.instrumentName][t].filterType,instrumentsFilters[0][this.instrumentName][t].filterRolloff);docById("radio"+e[0]).checked=-12===n,docById("radio"+e[1]).checked=-24===n,docById("radio"+e[2]).checked=-48===n,docById("radio"+e[3]).checked=-96===n}}}])})();_defineProperty(TimbreWidget,"BUTTONSIZE",53),_defineProperty(TimbreWidget,"ICONSIZE",32);
function TunerDisplay(t,e,i){var n=this,e=(this.canvas=t,this.width=e,this.height=i,this.ctx=t.getContext("2d"),this.note="A",this.cents=0,this.frequency=440,this.chromaticMode=!0,this.modeContainer=document.createElement("div"),Object.assign(this.modeContainer.style,{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",backgroundColor:"#FFFFFF",borderRadius:"20px",padding:"4px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"}),t.parentElement.appendChild(this.modeContainer),document.createElement("div")),i=(Object.assign(e.style,{display:"flex",gap:"4px",position:"relative"}),this.modeContainer.appendChild(e),this.chromaticButton=document.createElement("div"),Object.assign(this.chromaticButton.style,{width:"40px",height:"32px",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.3s ease"}),document.createElement("img")),t=(Object.assign(i,{src:"header-icons/chromatic-mode.svg",width:"20",height:"20",alt:""}),this.chromaticButton.appendChild(i),e.appendChild(this.chromaticButton),this.targetPitchButton=document.createElement("div"),Object.assign(this.targetPitchButton.style,{width:"40px",height:"32px",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.3s ease"}),document.createElement("img"));Object.assign(t,{src:"header-icons/target-pitch-mode.svg",width:"20",height:"20",alt:""}),this.targetPitchButton.appendChild(t),e.appendChild(this.targetPitchButton),this.chromaticButton.onclick=function(){n.chromaticMode=!0,n.updateButtonStyles()},this.targetPitchButton.onclick=function(){n.chromaticMode=!1,n.updateButtonStyles()},this.updateButtonStyles()}TunerDisplay.prototype.updateButtonStyles=function(){this.chromaticMode?(this.chromaticButton.style.backgroundColor=platformColor.selectorBackground,this.chromaticButton.querySelector("img").style.filter="brightness(0) invert(1)",this.targetPitchButton.style.backgroundColor="transparent",this.targetPitchButton.querySelector("img").style.filter="none"):(this.targetPitchButton.style.backgroundColor=platformColor.selectorBackground,this.targetPitchButton.querySelector("img").style.filter="brightness(0) invert(1)",this.chromaticButton.style.backgroundColor="transparent",this.chromaticButton.querySelector("img").style.filter="none")},TunerDisplay.prototype.update=function(t,e,i){this.note=t,this.cents=e,this.frequency=i,this.draw()},TunerDisplay.prototype.draw=function(){var t=this.ctx,e=this.width,i=this.height,n=(t.clearRect(0,0,e,i),.8*e),o=(e-n)/2,r=i-80,o=(t.fillStyle="#e0e0e0",t.fillRect(o,r,n,10),t.fillStyle="#000000",t.fillRect(o+n/2-1,r,2,10),o+n/2+this.cents/50*(n/2));t.fillStyle="#ff0000",t.fillRect(o-2,r-5,4,20),t.font="bold 48px Arial",t.textAlign="center",t.fillStyle="#000000",t.fillText(this.note,e/2,i-200),t.font="24px Arial",t.fillText((0<=this.cents?"+":"")+Math.round(this.cents)+"¢",e/2,i-160),t.font="18px Arial",t.fillText(this.frequency.toFixed(1)+" Hz",e/2,i-40)};var TunerUtils={frequencyToPitch:function(t){var e,i,n=440*Math.pow(2,-4.75);return t<n?["C",0,n]:(e=Math.round(12*Math.log2(t/n)),Math.floor(e/12),i=e%12,n=Math.round(1200*Math.log2(t/(n*Math.pow(2,e/12)))),[["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][i],n,t])},calculatePlaybackRate:function(t,e){return Math.pow(2,(t+e)/1200)}};"undefined"!=typeof module&&(module.exports={TunerDisplay:TunerDisplay,TunerUtils:TunerUtils});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}global.platformColor={selectorBackground:"#8bc34a"};var createMockElement=function(e){return{style:{},appendChild:jest.fn(),querySelector:jest.fn().mockReturnValue({style:{}}),onclick:null,src:"",width:"",height:"",alt:"",tagName:e}},_require=(global.document={createElement:jest.fn().mockImplementation(function(e){var t=createMockElement(e);return"canvas"===e&&(t.getContext=jest.fn().mockReturnValue({clearRect:jest.fn(),fillRect:jest.fn(),fillText:jest.fn(),fillStyle:"",font:"",textAlign:""}),t.parentElement={appendChild:jest.fn()}),"div"===e&&(t.querySelector=jest.fn().mockReturnValue({style:{}})),"img"===e&&(t.src="",t.width="",t.height="",t.alt=""),t})},require("./tuner.js")),TunerDisplay=_require.TunerDisplay,TunerUtils=_require.TunerUtils;describe("Tuner Widget",function(){describe("Module Export",function(){test("exports TunerDisplay constructor",function(){expect(TunerDisplay).toBeDefined(),expect(_typeof(TunerDisplay)).toBe("function")}),test("exports TunerUtils object",function(){expect(TunerUtils).toBeDefined(),expect(_typeof(TunerUtils)).toBe("object")}),test("TunerUtils has frequencyToPitch method",function(){expect(TunerUtils.frequencyToPitch).toBeDefined(),expect(_typeof(TunerUtils.frequencyToPitch)).toBe("function")}),test("TunerUtils has calculatePlaybackRate method",function(){expect(TunerUtils.calculatePlaybackRate).toBeDefined(),expect(_typeof(TunerUtils.calculatePlaybackRate)).toBe("function")})}),describe("TunerUtils.frequencyToPitch",function(){describe("note detection",function(){test("correctly identifies A4 at 440 Hz",function(){var e=TunerUtils.frequencyToPitch(440);expect(e[0]).toBe("A"),expect(e[2]).toBe(440)}),test("correctly identifies C4 (middle C) around 261.63 Hz",function(){var e=TunerUtils.frequencyToPitch(261.63);expect(e[0]).toBe("C")}),test("correctly identifies G4 around 392 Hz",function(){var e=TunerUtils.frequencyToPitch(392);expect(e[0]).toBe("G")}),test("correctly identifies E4 around 329.63 Hz",function(){var e=TunerUtils.frequencyToPitch(329.63);expect(e[0]).toBe("E")}),test("correctly identifies D4 around 293.66 Hz",function(){var e=TunerUtils.frequencyToPitch(293.66);expect(e[0]).toBe("D")}),test("correctly identifies B4 around 493.88 Hz",function(){var e=TunerUtils.frequencyToPitch(493.88);expect(e[0]).toBe("B")}),test("identifies all 12 chromatic notes in octave 4",function(){for(var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=[261.63,277.18,293.66,311.13,329.63,349.23,369.99,392,415.3,440,466.16,493.88],n=0;n<e.length;n++){var c=TunerUtils.frequencyToPitch(t[n]);expect(c[0]).toBe(e[n])}})}),describe("cents deviation",function(){test("returns cents close to 0 for exact A4 frequency",function(){var e=TunerUtils.frequencyToPitch(440);expect(Math.abs(e[1])).toBeLessThanOrEqual(5)}),test("returns positive cents for sharp frequency",function(){var e=TunerUtils.frequencyToPitch(450);expect(e[1]).toBeGreaterThan(0)}),test("returns negative cents for flat frequency",function(){var e=TunerUtils.frequencyToPitch(430);expect(e[1]).toBeLessThan(0)}),test("cents deviation stays within -50 to +50 range for nearby notes",function(){var e=TunerUtils.frequencyToPitch(442),t=TunerUtils.frequencyToPitch(438);expect(Math.abs(e[1])).toBeLessThan(50),expect(Math.abs(t[1])).toBeLessThan(50)})}),describe("edge cases",function(){test("handles frequencies below C0",function(){var e=TunerUtils.frequencyToPitch(10);expect(e[0]).toBe("C"),expect(e[1]).toBe(0),expect(e[2]).toBeCloseTo(16.35,1)}),test("handles very high frequencies",function(){var e=TunerUtils.frequencyToPitch(4186);expect(e).toHaveLength(3),expect(["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]).toContain(e[0])}),test("handles A3 (octave below A4)",function(){var e=TunerUtils.frequencyToPitch(220);expect(e[0]).toBe("A")}),test("handles A5 (octave above A4)",function(){var e=TunerUtils.frequencyToPitch(880);expect(e[0]).toBe("A")}),test("preserves original frequency in return value",function(){var e=523.25,t=TunerUtils.frequencyToPitch(e);expect(t[2]).toBe(e)})})}),describe("TunerUtils.calculatePlaybackRate",function(){describe("standard intervals",function(){test("returns 1 for zero cents adjustment",function(){var e=TunerUtils.calculatePlaybackRate(0,0);expect(e).toBeCloseTo(1,5)}),test("returns 2 for octave up (1200 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,1200);expect(e).toBeCloseTo(2,5)}),test("returns 0.5 for octave down (-1200 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,-1200);expect(e).toBeCloseTo(.5,5)}),test("returns correct rate for semitone up (100 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,100),t=Math.pow(2,1/12);expect(e).toBeCloseTo(t,5)}),test("returns correct rate for semitone down (-100 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,-100),t=Math.pow(2,-1/12);expect(e).toBeCloseTo(t,5)}),test("returns correct rate for whole tone (200 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,200),t=Math.pow(2,2/12);expect(e).toBeCloseTo(t,5)}),test("returns correct rate for perfect fifth (700 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,700),t=Math.pow(2,7/12);expect(e).toBeCloseTo(t,5)})}),describe("base cents accumulation",function(){test("accumulates baseCents and adjustment",function(){var e=TunerUtils.calculatePlaybackRate(600,600);expect(e).toBeCloseTo(2,5)}),test("handles negative base cents",function(){var e=TunerUtils.calculatePlaybackRate(-600,0);expect(e).toBeCloseTo(Math.pow(2,-.5),5)}),test("negative base with positive adjustment",function(){var e=TunerUtils.calculatePlaybackRate(-100,100);expect(e).toBeCloseTo(1,5)}),test("positive base with negative adjustment",function(){var e=TunerUtils.calculatePlaybackRate(300,-300);expect(e).toBeCloseTo(1,5)})}),describe("edge cases",function(){test("handles very large cents values",function(){var e=TunerUtils.calculatePlaybackRate(0,2400);expect(e).toBeCloseTo(4,5)}),test("handles very small cents values",function(){var e=TunerUtils.calculatePlaybackRate(0,1);expect(e).toBeCloseTo(1,2)}),test("handles fractional cents",function(){var e=TunerUtils.calculatePlaybackRate(0,50.5);expect(e).toBeGreaterThan(1),expect(e).toBeLessThan(Math.pow(2,1/12))})})}),describe("TunerDisplay",function(){var n,t;beforeEach(function(){t={clearRect:jest.fn(),fillRect:jest.fn(),fillText:jest.fn(),fillStyle:"",font:"",textAlign:""},n={getContext:jest.fn().mockReturnValue(t),parentElement:{appendChild:jest.fn()},width:400,height:300}}),describe("Constructor",function(){test("stores canvas reference",function(){var e=new TunerDisplay(n,400,300);expect(e.canvas).toBe(n)}),test("stores width and height",function(){var e=new TunerDisplay(n,400,300);expect(e.width).toBe(400),expect(e.height).toBe(300)}),test("gets 2D rendering context",function(){var e=new TunerDisplay(n,400,300);expect(n.getContext).toHaveBeenCalledWith("2d"),expect(e.ctx).toBe(t)}),test("initializes with default note A",function(){var e=new TunerDisplay(n,400,300);expect(e.note).toBe("A")}),test("initializes with default cents 0",function(){var e=new TunerDisplay(n,400,300);expect(e.cents).toBe(0)}),test("initializes with default frequency 440",function(){var e=new TunerDisplay(n,400,300);expect(e.frequency).toBe(440)}),test("defaults to chromatic mode",function(){var e=new TunerDisplay(n,400,300);expect(e.chromaticMode).toBe(!0)}),test("creates mode container element",function(){var e=new TunerDisplay(n,400,300);expect(e.modeContainer).toBeDefined()}),test("appends mode container to canvas parent",function(){new TunerDisplay(n,400,300),expect(n.parentElement.appendChild).toHaveBeenCalled()}),test("creates chromatic button",function(){var e=new TunerDisplay(n,400,300);expect(e.chromaticButton).toBeDefined()}),test("creates target pitch button",function(){var e=new TunerDisplay(n,400,300);expect(e.targetPitchButton).toBeDefined()}),test("calls updateButtonStyles on initialization",function(){var e=new TunerDisplay(n,400,300);expect(e.chromaticMode).toBe(!0)})}),describe("updateButtonStyles",function(){test("highlights chromatic button when in chromatic mode",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!0,e.updateButtonStyles(),expect(e.chromaticButton.style.backgroundColor).toBeTruthy()}),test("removes highlight from target button when in chromatic mode",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!0,e.updateButtonStyles(),expect(e.targetPitchButton.style.backgroundColor).toBe("transparent")}),test("highlights target button when not in chromatic mode",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!1,e.updateButtonStyles(),expect(e.targetPitchButton.style.backgroundColor).toBeTruthy()}),test("removes highlight from chromatic button when not in chromatic mode",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!1,e.updateButtonStyles(),expect(e.chromaticButton.style.backgroundColor).toBe("transparent")})}),describe("update",function(){test("updates note property",function(){var e=new TunerDisplay(n,400,300);e.update("C",10,261.63),expect(e.note).toBe("C")}),test("updates cents property",function(){var e=new TunerDisplay(n,400,300);e.update("C",15,261.63),expect(e.cents).toBe(15)}),test("updates frequency property",function(){var e=new TunerDisplay(n,400,300);e.update("C",10,265),expect(e.frequency).toBe(265)}),test("calls draw after update",function(){var e=new TunerDisplay(n,400,300),t=jest.spyOn(e,"draw");e.update("G",-5,392),expect(t).toHaveBeenCalled()}),test("handles negative cents",function(){var e=new TunerDisplay(n,400,300);e.update("E",-25,325),expect(e.cents).toBe(-25)}),test("handles sharp notes",function(){var e=new TunerDisplay(n,400,300);e.update("C#",0,277.18),expect(e.note).toBe("C#")})}),describe("draw",function(){test("clears the canvas before drawing",function(){new TunerDisplay(n,400,300).draw(),expect(t.clearRect).toHaveBeenCalledWith(0,0,400,300)}),test("draws the meter background",function(){new TunerDisplay(n,400,300).draw(),expect(t.fillRect).toHaveBeenCalled()}),test("displays the note text",function(){var e=new TunerDisplay(n,400,300);e.note="G",e.draw(),expect(t.fillText).toHaveBeenCalledWith("G",expect.any(Number),expect.any(Number))}),test("displays frequency with Hz suffix",function(){var e=new TunerDisplay(n,400,300);e.frequency=440,e.draw(),expect(t.fillText).toHaveBeenCalledWith("440.0 Hz",expect.any(Number),expect.any(Number))}),test("displays positive cents with + prefix",function(){var e=new TunerDisplay(n,400,300);e.cents=15,e.draw(),expect(t.fillText).toHaveBeenCalledWith("+15¢",expect.any(Number),expect.any(Number))}),test("displays negative cents without + prefix",function(){var e=new TunerDisplay(n,400,300);e.cents=-20,e.draw(),expect(t.fillText).toHaveBeenCalledWith("-20¢",expect.any(Number),expect.any(Number))}),test("displays zero cents with + prefix",function(){var e=new TunerDisplay(n,400,300);e.cents=0,e.draw(),expect(t.fillText).toHaveBeenCalledWith("+0¢",expect.any(Number),expect.any(Number))}),test("sets text alignment to center",function(){new TunerDisplay(n,400,300).draw(),expect(t.textAlign).toBe("center")})}),describe("button click handlers",function(){test("clicking chromatic button sets chromaticMode to true",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!1,e.chromaticButton.onclick(),expect(e.chromaticMode).toBe(!0)}),test("clicking target pitch button sets chromaticMode to false",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!0,e.targetPitchButton.onclick(),expect(e.chromaticMode).toBe(!1)}),test("clicking chromatic button updates button styles",function(){var e=new TunerDisplay(n,400,300),t=jest.spyOn(e,"updateButtonStyles");e.chromaticButton.onclick(),expect(t).toHaveBeenCalled()}),test("clicking target pitch button updates button styles",function(){var e=new TunerDisplay(n,400,300),t=jest.spyOn(e,"updateButtonStyles");e.targetPitchButton.onclick(),expect(t).toHaveBeenCalled()})})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var i,n,o,s,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return o=!(n=!0),{s:function(){r=r.call(e)},n:function(){var e=r.next();return n=e.done,e},e:function(e){o=!0,i=e},f:function(){try{n||null==r.return||r.return()}finally{if(o)throw i}}};if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),s=0,{s:t=function(){},n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var i;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(i="Object"===(i={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=Array(t);i<t;i++)n[i]=e[i];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}window.widgetWindows={openWindows:{},_posCache:{}};var WidgetWindow=(()=>_createClass(function e(t,i){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];_classCallCheck(this,e),this._key=t,this._buttons=[],this._first=!0,this._title=i,this._visible=!0,this._rolled=!1,this._savedPos=null,this._maximized=!1,this._fullscreenEnabled=n,this._dx=this._dy=0,this._dragging=!1,this._createUIelements(),this._setupLanguage(),this._dragTopHandler=this._dragTopHandler.bind(this),this._docMouseMoveHandler=this._docMouseMoveHandler.bind(this),this._docMouseDownHandler=this._docMouseDownHandler.bind(this),document.addEventListener("mouseup",this._dragTopHandler,!0),document.addEventListener("mousemove",this._docMouseMoveHandler,!0),document.addEventListener("mousedown",this._docMouseDownHandler,!0),window.widgetWindows._posCache[this._key]&&(t=window.widgetWindows._posCache[this._key],this.setPosition(t[0],t[1])),this.takeFocus(),this.sendToCenter=this.sendToCenter.bind(this)},[{key:"_create",value:function(e,t,i){e=document.createElement(e);return t&&(e.className=t),i&&i.append(e),e}},{key:"_toggleClass",value:function(e,t){e.classList.toggle(t)}},{key:"_createUIelements",value:function(){var o=this,e=docById("floatingWindows");this._frame=this._create("div","windowFrame",e),this._overlayframe=this._create("div","windowFrame",e),this._drag=this._create("div","wfTopBar",this._frame),this._drag.style.display="flex",this._drag.style.justifyContent="space-between",this._fullscreenEnabled&&(this._drag.ondblclick=function(e){o._maximize(),o.takeFocus(),o.onmaximize(),e.preventDefault(),e.stopImmediatePropagation()});function t(){var e=window.pageYOffset||document.documentElement.scrollTop,t=window.pageXOffset||document.documentElement.scrollLeft;window.onscroll=function(){window.scrollTo(t,e)}}this._create("div","wftButton close",this._drag).onclick=function(e){o.onclose(),e.preventDefault(),e.stopPropagation()},this._nonclose=this._create("div","nonclose",this._drag),this._nonclose.style.display="flex",this._nonclose.justifyContent="space-between",this._nonclose.style.width="100%";var e=this._create("div","wftTitle",this._nonclose),i=(e.innerHTML="",e.insertAdjacentHTML("afterbegin",_(this._title)),e.id="".concat(this._key,"WidgetID"),this._nonclose.onmousedown=function(e){var t,i,n;o._dragging=!0,o._maximized&&(i=((t=o._drag.getBoundingClientRect()).left-e.clientX)/(t.right-t.left),n=t.top-e.clientY,o._restore(),o.onmaximize(),i*=(t=o._drag.getBoundingClientRect()).right-t.left,o.setPosition(e.clientX+i,e.clientY+n)),o.takeFocus(),o._dx=e.clientX-o._drag.getBoundingClientRect().left,o._dy=e.clientY-o._drag.getBoundingClientRect().top,e.preventDefault()},this._nonclosebuttons=this._create("div","nonclosebuttons",this._nonclose),this._nonclosebuttons.style.display="flex",this._rollButton=this._create("div","wftButton rollup",this._nonclosebuttons),this._rollButton);i.onclick=function(e){o._rolled?o.unroll():(o._rollup(),o._toggleClass(i,"plus")),o.takeFocus(),o._frame.style.width="auto",o._frame.style.height="auto",o._frame.style.minHeight="0px",e.preventDefault(),e.stopPropagation()},this._fullscreenEnabled&&((e=this._create("div","wftButton wftMaxmin",this._nonclosebuttons)).onclick=function(e){o._maximized?(o._restore(),o.sendToCenter()):o._maximize(),o.takeFocus(),o.onmaximize(),e.preventDefault(),e.stopImmediatePropagation()},this._maxminIcon=this._create("img",void 0,e),this._maxminIcon.setAttribute("src","header-icons/icon-expand.svg")),this._body=this._create("div","wfWinBody",this._frame),this._toolbar=this._create("div","wfbToolbar",this._body);this._widget=this._create("div","wfbWidget",this._body),this._widget.addEventListener("wheel",t,!1),this._widget.addEventListener("DOMMouseScroll",t,!1)}},{key:"_docMouseMoveHandler",value:function(e){var t;this._dragging&&(this._fullscreenEnabled&&"64px"===this._frame.style.top?this._overlay(!0):this._overlay(!1),t=e.clientX-this._dx,e=e.clientY-this._dy,this.setPosition(t,e))}},{key:"_overlay",value:function(e){e?(this._frame.style.zIndex="10",this._overlayframe.style.left="0",this._overlayframe.style.zIndex="1",this._overlayframe.style.top="64px",this._overlayframe.style.width="100vw",this._overlayframe.style.height="calc(100vh - 64px)",this._overlayframe.style.border="0.25vw solid black",this._overlayframe.style.backgroundColor="var(--overlay-bg)"):(this._frame.style.zIndex="10000",this._overlayframe.style.border="0px",this._overlayframe.style.zIndex="-1",this._overlayframe.style.backgroundColor="transparent")}},{key:"_docMouseDownHandler",value:function(e){e.target===this._frame||this._frame.contains(e.target)||this._fullscreenEnabled?(this._frame.style.opacity="1",this._frame.style.zIndex="10000"):(this._frame.style.opacity=".7",this._frame.style.zIndex="0")}},{key:"_dragTopHandler",value:function(e){this._dragging=!1,this._fullscreenEnabled&&"64px"===this._frame.style.top&&!this._maximized&&(this._maximize(),this.takeFocus(),this.onmaximize(),e.preventDefault())}},{key:"_setupLanguage",value:function(){var e=localStorage.languagePreference;"ja"===(e=void 0===e?navigator.language:e)&&(this._body.style.flexDirection="column",this._body.style.flexGrow="1",this._toolbar.style.overflowY="auto",this._toolbar.style.width="100%",this._toolbar.style.display="flex",this._toolbar.style.flexShrink="0")}},{key:"addInputButton",value:function(e,t){t=this._create("div","wfbtItem",t||this._toolbar);return t.innerHTML="",t.insertAdjacentHTML("afterbegin",'<input value="'.concat(e,'" />')),t.querySelector("input")}},{key:"addRangeSlider",value:function(e,t,i,n,o){t=this._create("div","wfbtItem",t||this._toolbar),o='\n          <input type="range" class="'.concat(o,'" min="').concat(i,'" max="').concat(n,'" value="').concat(e,'" />\n        '),t.style.height="250px",t.innerHTML="",t.insertAdjacentHTML("afterbegin",o),i=t.querySelector("input");return i.style=" position:absolute;transform:rotate(270deg);height:10px;width:250px;",i}},{key:"addSelectorButton",value:function(e,t,i){var n,i=this._create("div","wfbtItem",i||this._toolbar),o=(i.innerHTML="",i.insertAdjacentHTML("afterbegin",'<select value="'.concat(t,'" />')),i.querySelector("select")),s=_createForOfIteratorHelper(e);try{for(s.s();!(n=s.n()).done;){var r=n.value,a=new Option("turtle "+r,r);o.add(a)}}catch(e){s.e(e)}finally{s.f()}return o}},{key:"addDivider",value:function(){return this._create("div","wfbtHR",this._toolbar)}},{key:"modifyButton",value:function(e,t,i,n){t='\n            <img src="header-icons/'.concat(t,'" title="').concat(n,'" alt="').concat(n,'" height="').concat(i,'" width="').concat(i,'"/> \n            ');return this._buttons[e].innerHTML="",this._buttons[e].insertAdjacentHTML("afterbegin",t),this._buttons[e]}},{key:"close",value:function(){document.removeEventListener("mouseup",this._dragTopHandler,!0),document.removeEventListener("mousemove",this._docMouseMoveHandler,!0),document.removeEventListener("mousedown",this._docMouseDownHandler,!0),this.onclose()}},{key:"updateTitle",value:function(e){docById(this._key+"WidgetID").innerHTML=e}},{key:"takeFocus",value:function(){for(var e=docById("floatingWindows").children,t=0;t<e.length;t++)e[t].style.zIndex="0",e[t].style.opacity="0";this._frame.style.zIndex="10000",this._frame.style.opacity="1"}},{key:"addButton",value:function(e,t,i,n){n=this._create("div","wfbtItem",n||this._toolbar),e='<img src="header-icons/'.concat(e,'" \n                  title="').concat(i,'" \n                  alt="').concat(i,'" \n                  height="').concat(t,'" \n                  width="').concat(t,'" \n             />');return n.innerHTML="",n.insertAdjacentHTML("afterbegin",e),this._buttons.push(n),n}},{key:"sendToCenter",value:function(){var e,t=docById("myCanvas"),i=this._frame.getBoundingClientRect(),t=t.getBoundingClientRect();return 0===t.width||0===t.height?this.setPosition(200,140):(e=document.querySelector("nav").offsetHeight,this.setPosition((t.width-i.width)/2,(t.height-i.height+e)/2)),this}},{key:"_restore",value:function(){this._maxminIcon.setAttribute("src","header-icons/icon-expand.svg"),this._maximized=!1,this._savedPos&&(this._frame.style.left=this._savedPos[0],this._frame.style.top=this._savedPos[1],this._savedPos=null),this._overlay(!1),this._frame.style.width="auto",this._frame.style.height="auto",this._frame.style.minHeight="420px",this._frame.style.minWidth="470px"}},{key:"_maximize",value:function(){this._maxminIcon.setAttribute("src","header-icons/icon-contract.svg"),this._maximized=!0,this.unroll(),this.takeFocus(),this._savedPos=[this._frame.style.left,this._frame.style.top],this._frame.style.width="100vw",this._frame.style.height="calc(100vh - 64px)",this._frame.style.left="0",this._frame.style.top="64px"}},{key:"getWidgetBody",value:function(){return this._widget}},{key:"getWidgetFrame",value:function(){return this._frame}},{key:"getDragElement",value:function(){return this._drag}},{key:"onclose",value:function(){this.destroy()}},{key:"destroy",value:function(){this._dragTopHandler&&document.removeEventListener("mouseup",this._dragTopHandler,!0),this._docMouseMoveHandler&&document.removeEventListener("mousemove",this._docMouseMoveHandler,!0),this._docMouseDownHandler&&document.removeEventListener("mousedown",this._docMouseDownHandler,!0),this._frame&&this._frame.parentElement&&this._frame.parentElement.removeChild(this._frame),this._overlayframe&&this._overlayframe.parentElement&&this._overlayframe.parentElement.removeChild(this._overlayframe),window.widgetWindows.openWindows[this._key]=void 0}},{key:"onmaximize",value:function(){return this}},{key:"isMaximized",value:function(){return this._maximized}},{key:"show",value:function(){this._frame.style.display="block"}},{key:"setPosition",value:function(e,t){return this._frame.style.left="".concat(e,"px"),this._frame.style.top="".concat(Math.max(t,64),"px"),window.widgetWindows._posCache[this._key]=[e,Math.max(t,64)],this}},{key:"isVisible",value:function(){return this._visible}},{key:"clear",value:function(){return this._widget.innerHTML="",this._toolbar.innerHTML="",this}},{key:"clearScreen",value:function(){return this._widget.innerHTML="",this}},{key:"_rollup",value:function(){return this._rolled=!0,this._body.style.display="none",this}},{key:"unroll",value:function(){return this._rolled=!1,this._body.style.display="flex",this._rollButton&&this._rollButton.classList.contains("plus")&&this._rollButton.classList.remove("plus"),this}}]))();window.widgetWindows.windowFor=function(e,t,i,n){var o=void 0,o=void 0!==e.blockNo?e.blockNo:i||t;return void 0===window.widgetWindows.openWindows[o]&&(e=new WidgetWindow(o,t,n).sendToCenter(),window.widgetWindows.openWindows[o]=e),window.widgetWindows.openWindows[o].unroll()},window.widgetWindows.clear=function(e){e=window.widgetWindows.openWindows[e];e&&"function"==typeof e.onclose&&e.onclose()},window.widgetWindows.isOpen=function(e){return!!window.widgetWindows.openWindows[e]||""},window.widgetWindows.hideAllWindows=function(){Object.values(window.widgetWindows.openWindows).forEach(function(e){void 0!==e&&(e._frame.style.display="none")})},window.widgetWindows.hideWindow=function(e){e=window.widgetWindows.openWindows[e];e&&(e._frame.style.display="none")},window.widgetWindows.showWindows=function(){Object.values(window.widgetWindows.openWindows).forEach(function(e){void 0!==e&&(e._frame.style.display="block")})};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _callSuper(t,e,n){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,n||[],_getPrototypeOf(t).constructor):e.apply(t,n))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _jest$requireActual=jest.requireActual("../ActionBlocks"),setupActionBlocks=_jest$requireActual.setupActionBlocks,BaseBlock=(global._=function(t){return t},global.NOACTIONERRORMSG="NO ACTION",global.NOINPUTERRORMSG="NO_INPUT",global.Queue=_createClass(function t(e,n,o,r){_classCallCheck(this,t),this.child=e,this.factor=n,this.parentBlk=o,this.receivedArg=r}),(()=>_createClass(function t(e){_classCallCheck(this,t),this.name=e,this.dockTypes=[null],this.size=1,this.lang="en",this.hidden=!1},[{key:"setPalette",value:function(t){this.palette=t}},{key:"setHelpString",value:function(t){this.help=t}},{key:"formBlock",value:function(t){this.formDefn=t}},{key:"beginnerBlock",value:function(t){this.isBeginner=t}},{key:"changeName",value:function(t){this.name=t}},{key:"makeMacro",value:function(t){this.macro=t}},{key:"setup",value:function(t){return t.registeredBlocks=t.registeredBlocks||{},t.registeredBlocks[this.name]=this}}]))()),FlowBlock=(()=>{function e(t){return _classCallCheck(this,e),_callSuper(this,e,[t])}return _inherits(e,BaseBlock),_createClass(e,[{key:"flow",value:function(){}}])})(),FlowClampBlock=(()=>{function e(t){return _classCallCheck(this,e),_callSuper(this,e,[t])}return _inherits(e,FlowBlock),_createClass(e)})(),StackClampBlock=(()=>{function e(t){return _classCallCheck(this,e),_callSuper(this,e,[t])}return _inherits(e,FlowClampBlock),_createClass(e)})(),LeftBlock=(()=>{function e(t){return _classCallCheck(this,e),_callSuper(this,e,[t])}return _inherits(e,BaseBlock),_createClass(e,[{key:"arg",value:function(){}}])})(),ValueBlock=(()=>{function e(t){return _classCallCheck(this,e),_callSuper(this,e,[t])}return _inherits(e,LeftBlock),_createClass(e)})();global.BaseBlock=BaseBlock,global.FlowBlock=FlowBlock,global.FlowClampBlock=FlowClampBlock,global.StackClampBlock=StackClampBlock,global.LeftBlock=LeftBlock,global.ValueBlock=ValueBlock,describe("ActionBlocks",function(){function n(t){return o.registeredBlocks[t]}var o,r;beforeEach(function(){jest.clearAllMocks(),o={registeredBlocks:{},blocks:{blockList:{},actionList:{},namedActionList:[],findStacks:jest.fn(function(){return[]}),updateBlockLabels:jest.fn()},turtles:{ithTurtle:jest.fn(function(){return{queue:[],parentFlowQueue:[],singer:{justCounting:[]}}})},errorMsg:jest.fn(),refreshCanvas:jest.fn(),stage:{dispatchEvent:jest.fn()}},r={returns:{0:[]},runFromBlock:jest.fn(),runFromBlockNow:jest.fn(),setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),actions:{},namedActions:[],eventList:{},notation:{notationLineBreak:jest.fn()},parseArg:jest.fn()},global.XMLHttpRequest=jest.fn(),global.alert=jest.fn(),setupActionBlocks(o)});describe("Block Registration",function(){test("registers all 18 action blocks",function(){["return","returnToUrl","calc","namedcalc","nameddoArg","namedcalcArg","doArg","calcArg","arg","namedarg","do","listen","dispatch","start","startdrum","action","nameddo","temperament1"].forEach(function(t){expect(o.registeredBlocks).toHaveProperty(t)})}),test("all blocks have correct palette set",function(){Object.values(o.registeredBlocks).forEach(function(t){expect(t.palette).toBe("action")})})}),describe("ReturnBlock",function(){test("pushes value to logo.returns",function(){n("return").flow([42],r,0),expect(r.returns[0]).toContain(42)}),test("handles string return value",function(){n("return").flow(["test"],r,0),expect(r.returns[0]).toContain("test")}),test("does not push when no args",function(){r.returns[0]=[],n("return").flow([],r,0),expect(r.returns[0]).toHaveLength(0)})}),describe("ReturnToURLBlock",function(){test("posts JSON to URL",function(){var t={open:jest.fn(),send:jest.fn(),onreadystatechange:null},e=(global.XMLHttpRequest.mockImplementation(function(){return t}),n("returnToUrl"));jest.spyOn(e,"getHref").mockReturnValue("http://localhost?outurl=http://callback&dummy=1"),e.flow([100]),expect(t.open).toHaveBeenCalledWith("POST","http://callback",!0),expect(t.send).toHaveBeenCalledWith('{"result":100}')}),test("handles URL without outurl param",function(){var t={open:jest.fn(),send:jest.fn(),onreadystatechange:null},e=(global.XMLHttpRequest.mockImplementation(function(){return t}),n("returnToUrl"));jest.spyOn(e,"getHref").mockReturnValue("http://localhost"),e.flow([42]),expect(t.open).toHaveBeenCalledWith("POST",void 0,!0)})}),describe("CalcBlock",function(){test("has correct form properties",function(){var t=n("calc");expect(t.formDefn.args).toBe(1),expect(t.formDefn.outType).toBe("anyout"),expect(t.formDefn.argTypes).toEqual(["anyin"])})}),describe("DoBlock",function(){test("returns action for execution",function(){var t=n("do"),e=[[0,["action",{}]]],t=(r.actions.testAction=e,t.flow(["testAction",null],r,0,5));expect(t).toEqual([e,1])}),test("shows error for missing action",function(){n("do").flow(["missingAction",null],r,0,5),expect(o.errorMsg).toHaveBeenCalledWith(NOACTIONERRORMSG,5,"missingAction")}),test("handles null action name",function(){n("do").flow([null,null],r,0,5),expect(o.errorMsg).toHaveBeenCalledWith(NOACTIONERRORMSG,5,null)})}),describe("ListenBlock",function(){test("sets up listener when action exists",function(){var t=n("listen");r.actions.testAction=[],t.flow(["event1","testAction"],r,0,10),expect(r.setTurtleListener).toHaveBeenCalledWith(0,expect.any(String),expect.any(Function))}),test("handles missing action",function(){n("listen").flow(["event1","missingAction"],r,0,10),expect(o.errorMsg).toHaveBeenCalledWith(NOACTIONERRORMSG,10,"missingAction")})}),describe("DispatchBlock",function(){test("dispatches event",function(){n("dispatch").flow(["event1"],r,0,15),expect(o.stage.dispatchEvent).toHaveBeenCalledWith("event1"),expect(r.eventList).toHaveProperty("event1")}),test("handles null event name",function(){n("dispatch").flow([null],r,0,15),expect(o.stage.dispatchEvent).toHaveBeenCalledWith(null)})}),describe("ActionBlock",function(){test("returns action flow when invoked",function(){var t=n("action"),e=[],t=(r.actions.testAction=e,t.flow(["testAction"],r,0,20));expect(t).toEqual([e,1])}),test("errors when action not found",function(){n("action").flow(["missingAction"],r,0,20),expect(o.errorMsg).toHaveBeenCalledWith(NOACTIONERRORMSG,20,"missingAction")})}),describe("StartBlock",function(){test("runs blocks from start",function(){var t=n("start"),t=(o.blocks.findStacks=jest.fn(function(){return[[0,1]]}),t.flow(["testArg"],r,0,25));expect(t).toEqual(["testArg",1])})}),describe("ArgBlock",function(){test("returns argument value",function(){var t=n("arg");r.returns[0]=[42],o.blocks.blockList[30]={connections:[null,25]},r.parseArg.mockReturnValue(42),t.arg(r,0,30,null,[1]),expect(r.parseArg).toHaveBeenCalled()})}),describe("DoArgBlock",function(){test("populates actionArgs before action",function(){var t=n("doArg"),e=(r.actions.testAction=[[0,["action",{}]]],o.blocks.blockList[35]={argClampSlots:[1],connections:[null,null,40]},r.parseArg.mockReturnValue(42),[]);t.flow(["testAction",[],null],r,0,35,null,e),expect(e).toContain(42)})}),describe("Block Properties",function(){test("ReturnBlock has correct form",function(){var t=n("return");expect(t.formDefn.args).toBe(1),expect(t.formDefn.defaults).toEqual([100]),expect(t.formDefn.argTypes).toEqual(["anyin"])}),test("CalcBlock has anyout type",function(){var t=n("calc");expect(t.formDefn.outType).toBe("anyout")}),test("NamedCalcBlock has extra width",function(){var t=n("namedcalc");expect(t.extraWidth).toBe(20)})})});
var _require=require("../BooleanBlocks"),setupBooleanBlocks=_require.setupBooleanBlocks,mockActivity=(global._=jest.fn(function(o){return o}),global.BooleanBlock=jest.fn().mockImplementation(function(o){return{type:o,setPalette:jest.fn(),setHelpString:jest.fn(),formBlock:jest.fn(),updateParameter:jest.fn(),arg:jest.fn(function(o,l,e,t){var n,c,a=mockActivity.blocks.blockList[e].connections;return"not"===this.type?null===(n=a[1])?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):!o.parseArg(o,l,n,e,t):"and"===this.type?(n=a[1],c=a[2],null===n||null===c?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):(n=o.parseArg(o,l,n,e,t),c=o.parseArg(o,l,c,e,t),n&&c)):"or"===this.type?(n=a[1],c=a[2],null===n||null===c?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):(n=o.parseArg(o,l,n,e,t),c=o.parseArg(o,l,c,e,t),n||c)):"xor"===this.type?(n=a[1],c=a[2],null===n||null===c?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):(n=o.parseArg(o,l,n,e,t),c=o.parseArg(o,l,c,e,t),n&&!c||!n&&c)):"greater"===this.type?(n=a[1],c=a[2],null===n||null===c?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):(n=o.parseArg(o,l,n,e,t),c=o.parseArg(o,l,c,e,t),Number(n)>Number(c))):"less"===this.type?(n=a[1],c=a[2],null===n||null===c?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):(n=o.parseArg(o,l,n,e,t),c=o.parseArg(o,l,c,e,t),Number(n)<Number(c))):"less_than_or_equal_to"===this.type?(n=a[1],c=a[2],null===n||null===c?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):(n=o.parseArg(o,l,n,e,t),c=o.parseArg(o,l,c,e,t),Number(n)<=Number(c))):"greater_than_or_equal_to"===this.type?(n=a[1],c=a[2],null===n||null===c?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):(n=o.parseArg(o,l,n,e,t),c=o.parseArg(o,l,c,e,t),Number(n)>=Number(c))):"equal"===this.type?(n=a[1],c=a[2],null===n||null===c?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):o.parseArg(o,l,n,e,t)===o.parseArg(o,l,c,e,t)):"not_equal_to"===this.type?(n=a[1],c=a[2],null===n||null===c?(mockActivity.errorMsg(global.NOINPUTERRORMSG,e),!1):o.parseArg(o,l,n,e,t)!==o.parseArg(o,l,c,e,t)):void 0}),setup:jest.fn(),beginnerBlock:jest.fn()}}),{blocks:{blockList:{blk1:{value:!0,connections:[null,null,null]},blk2:{value:!(global.NOINPUTERRORMSG="No input error message"),connections:[null,null,null]},blk3:{value:!0,connections:[null,"blk4","blk5"]},blk4:{value:!1,connections:[null,null,null]},blk5:{value:!0,connections:[null,null,null]},blk6:{value:!1,connections:[null,"blk7","blk8"]},blk7:{value:!0,connections:[null,null,null]},blk8:{value:!1,connections:[null,null,null]},blk9:{value:!0,connections:[null,"blk10","blk11"]},blk10:{value:!1,connections:[null,null,null]},blk11:{value:!0,connections:[null,null,null]}}},errorMsg:jest.fn()}),mockLogo={parseArg:jest.fn(function(o,l,e,t,n){if(mockActivity.blocks.blockList[e])return mockActivity.blocks.blockList[e].value;throw new Error("Block ".concat(e," not found in blockList"))})};describe("setupBooleanBlocks - Additional Tests",function(){beforeEach(function(){jest.clearAllMocks()}),it("should handle NotBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("not").arg(mockLogo,"turtle1","blk3",!0);expect(o).toBe(!0)}),it("should handle AndBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("and").arg(mockLogo,"turtle1","blk3",!0);expect(o).toBe(!1)}),it("should handle OrBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("or").arg(mockLogo,"turtle1","blk3",!0);expect(o).toBe(!0)}),it("should handle XorBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("xor").arg(mockLogo,"turtle1","blk3",!0);expect(o).toBe(!0)}),it("should handle GreaterBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("greater").arg(mockLogo,"turtle1","blk6",!0);expect(o).toBe(!0)}),it("should handle LessBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("less").arg(mockLogo,"turtle1","blk6",!0);expect(o).toBe(!1)}),it("should handle LessThanOrEqualToBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("less_than_or_equal_to").arg(mockLogo,"turtle1","blk6",!0);expect(o).toBe(!1)}),it("should handle GreaterThanOrEqualToBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("greater_than_or_equal_to").arg(mockLogo,"turtle1","blk6",!0);expect(o).toBe(!0)}),it("should handle EqualBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("equal").arg(mockLogo,"turtle1","blk9",!0);expect(o).toBe(!1)}),it("should handle NotEqualToBlock arg with valid connections",function(){setupBooleanBlocks(mockActivity);var o=new global.BooleanBlock("not_equal_to").arg(mockLogo,"turtle1","blk9",!0);expect(o).toBe(!0)}),it("should handle NotBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("not").arg(mockLogo,"turtle1","blk1",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk1")}),it("should handle AndBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("and").arg(mockLogo,"turtle1","blk2",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk2")}),it("should handle OrBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("or").arg(mockLogo,"turtle1","blk1",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk1")}),it("should handle XorBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("xor").arg(mockLogo,"turtle1","blk2",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk2")}),it("should handle GreaterBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("greater").arg(mockLogo,"turtle1","blk1",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk1")}),it("should handle LessBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("less").arg(mockLogo,"turtle1","blk2",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk2")}),it("should handle LessThanOrEqualToBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("less_than_or_equal_to").arg(mockLogo,"turtle1","blk1",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk1")}),it("should handle GreaterThanOrEqualToBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("greater_than_or_equal_to").arg(mockLogo,"turtle1","blk2",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk2")}),it("should handle EqualBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("equal").arg(mockLogo,"turtle1","blk1",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk1")}),it("should handle NotEqualToBlock arg with null connections",function(){setupBooleanBlocks(mockActivity),new global.BooleanBlock("not_equal_to").arg(mockLogo,"turtle1","blk2",!0),expect(mockActivity.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,"blk2")})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../BoxesBlocks"),setupBoxesBlocks=_require.setupBoxesBlocks,createdBlocks={},DummyFlowBlock=(()=>_createClass(function e(t,o){_classCallCheck(this,e),this.name=t,this.displayName=o||t,createdBlocks[t]=this},[{key:"setPalette",value:function(e,t){return this}},{key:"beginnerBlock",value:function(e){return this}},{key:"setHelpString",value:function(e){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}},{key:"flow",value:function(){}}]))(),DummyValueBlock=(()=>_createClass(function e(t,o){_classCallCheck(this,e),this.name=t,this.displayName=o||t,(createdBlocks[t]=this).extraWidth=0},[{key:"setPalette",value:function(e,t){return this}},{key:"beginnerBlock",value:function(e){return this}},{key:"setHelpString",value:function(e){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}}]))(),DummyLeftBlock=(()=>_createClass(function e(t,o){_classCallCheck(this,e),this.name=t,this.displayName=o||t,createdBlocks[t]=this},[{key:"setPalette",value:function(e,t){return this}},{key:"beginnerBlock",value:function(e){return this}},{key:"setHelpString",value:function(e){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}}]))();global.FlowBlock=DummyFlowBlock,global.ValueBlock=DummyValueBlock,global.LeftBlock=DummyLeftBlock,global._=jest.fn(function(e){return e}),global.NOINPUTERRORMSG="No input provided",global.NOBOXERRORMSG="No box error",global.SOLFEGENAMES=["do","re","mi","fa","so","la","ti","do"],describe("setupBoxesBlocks",function(){var n,r;beforeEach(function(){createdBlocks={},n={errorMsg:jest.fn(),blocks:{blockList:{}},blockSetter:jest.fn(function(e,t,o,r){t=n.blocks.blockList[t].privateData||n.blocks.blockList[t].value;e.boxes[t]=o}),beginnerMode:!1},r={boxes:{},statusFields:[],updatingStatusMatrix:!1,inStatusMatrix:!1,parseArg:jest.fn(function(e,t,o,r,n){return n}),receivedArg:void 0},setupBoxesBlocks(n)}),describe("IncrementBlock",function(){var e;beforeEach(function(){e=createdBlocks.increment,n.blocks.blockList[100]={connections:[null,200]}}),test('should update box value when connection is "text"',function(){n.blocks.blockList[200]={name:"text",value:"myBox"},r.boxes.myBox=5,e.flow([10,2],r,"turtle0",100),expect(r.boxes.myBox).toBe(7)}),test('should use SOLFEGENAMES branch when connection is "namedbox"',function(){n.blocks.blockList[200]={name:"namedbox",value:"do"},n.blocks.blockSetter=jest.fn(),e.flow([10,2],r,"turtle0",100),expect(n.blocks.blockSetter).toHaveBeenCalledWith(r,200,"mi","turtle0")}),test("should call blockSetter with default increment if no special case applies",function(){n.blocks.blockList[200]={name:"other",value:"unused"},n.blocks.blockSetter=jest.fn(),e.flow([10,3],r,"turtle0",100),expect(n.blocks.blockSetter).toHaveBeenCalledWith(r,200,13,"turtle0")}),test("should catch error and call errorMsg when blockSetter throws",function(){n.blocks.blockList[200]={name:"other",value:"unused"},n.blocks.blockSetter=jest.fn(function(){throw new Error("fail")}),e.flow([10,2],r,"turtle0",100),expect(n.errorMsg).toHaveBeenCalledWith("Block does not support incrementing.",200)})}),describe("IncrementOneBlock",function(){var e;beforeEach(function(){e=createdBlocks.incrementOne,n.blocks.blockList[110]={connections:[null,210]},n.blocks.blockList[210]={name:"other",value:"unused"},n.blocks.blockSetter=jest.fn()}),test("should set second argument to 1 and call parent flow",function(){e.flow([10],r,"turtle0",110),expect(n.blocks.blockSetter).toHaveBeenCalledWith(r,210,11,"turtle0")})}),describe("DecrementOneBlock",function(){var e;beforeEach(function(){e=createdBlocks.decrementOne,n.blocks.blockList[120]={connections:[null,220]},n.blocks.blockList[220]={name:"other",value:"unused"},n.blocks.blockSetter=jest.fn()}),test("should set second argument to -1 and call parent flow",function(){e.flow([10],r,"turtle0",120),expect(n.blocks.blockSetter).toHaveBeenCalledWith(r,220,9,"turtle0")})}),describe("BoxBlock",function(){var t,o=130;beforeEach(function(){t=createdBlocks.box,n.blocks.blockList[o]={connections:[null,300]},n.blocks.blockList[300]={value:"boxKey"},r.receivedArg="boxKey",r.boxes.boxKey=99}),test("updateParameter should return the box value if exists",function(){var e=t.updateParameter(r,"turtle0",o);expect(e).toBe(99)}),test("updateParameter should call errorMsg and return 0 if box missing",function(){delete r.boxes.boxKey;var e=t.updateParameter(r,"turtle0",o);expect(n.errorMsg).toHaveBeenCalledWith("No box error",o,"boxKey"),expect(e).toBe(0)}),test("setter should update box value if box exists",function(){t.setter(r,123,"turtle0",o),expect(r.boxes.boxKey).toBe(123)}),test("setter should call errorMsg if box missing",function(){delete r.boxes.boxKey,t.setter(r,456,"turtle0",o),expect(n.errorMsg).toHaveBeenCalledWith("No box error",o,"boxKey")}),test("arg should call errorMsg and return 0 if connection is null",function(){n.blocks.blockList[o]={connections:[null,null]};var e=t.arg(r,"turtle0",o,"boxKey");expect(n.errorMsg).toHaveBeenCalledWith("No input provided",o),expect(e).toBe(0)}),test("arg should return box value if exists",function(){n.blocks.blockList[o]={connections:[null,300]};var e=t.arg(r,"turtle0",o,"boxKey");expect(e).toBe(99)}),test("arg should call errorMsg and return 0 if box missing",function(){delete r.boxes.boxKey;var e=t.arg(r,"turtle0",o,"boxKey");expect(n.errorMsg).toHaveBeenCalledWith("No box error",o,"boxKey"),expect(e).toBe(0)})}),describe("NamedBoxBlock",function(){var t,o=140;beforeEach(function(){t=createdBlocks.namedbox,n.blocks.blockList[o]={privateData:"namedBoxKey",connections:[]},r.boxes.namedBoxKey=77}),test("updateParameter should return the named box value if exists",function(){var e=t.updateParameter(r,"turtle0",o);expect(e).toBe(77)}),test("updateParameter should call errorMsg and return 0 if missing",function(){delete r.boxes.namedBoxKey;var e=t.updateParameter(r,"turtle0",o);expect(n.errorMsg).toHaveBeenCalledWith("No box error",o,"namedBoxKey"),expect(e).toBe(0)}),test("setter should update the named box value if exists",function(){t.setter(r,88,"turtle0",o),expect(r.boxes.namedBoxKey).toBe(88)}),test("arg should return the named box value when not in status matrix",function(){var e=t.arg(r,"turtle0",o);expect(e).toBe(77)}),test("arg should call errorMsg and return 0 if box missing",function(){delete r.boxes.namedBoxKey;var e=t.arg(r,"turtle0",o);expect(n.errorMsg).toHaveBeenCalledWith("No box error",o,"namedBoxKey"),expect(e).toBe(0)})}),describe("StoreIn2Block",function(){var e;beforeEach(function(){e=createdBlocks.storein2,n.blocks.blockList[150]={privateData:"storeKey"}}),test("flow should store the given value in logo.boxes using privateData",function(){e.flow([999],r,"turtle0",150),expect(r.boxes.storeKey).toBe(999)})}),describe("StoreInBlock",function(){var e;beforeEach(function(){e=createdBlocks.storein}),test("flow should store the value in logo.boxes using the first argument as key",function(){e.flow(["myBox",555],r),expect(r.boxes.myBox).toBe(555)}),test("flow should do nothing if args length is not 2",function(){e.flow([1],r),expect(Object.keys(r.boxes).length).toBe(0)})}),describe("Box2Block",function(){var t;beforeEach(function(){(t=createdBlocks.box2).macro=jest.fn(function(e,t){return[[0,["namedbox",{value:"box2"}],e,t,[null]]]})}),test("should create a macro returning expected configuration",function(){var e=t.macro(10,20);expect(e[0][1][0]).toBe("namedbox"),expect(e[0][1][1].value).toBe("box2")})}),describe("StoreBox2Block",function(){var e;beforeEach(function(){e=createdBlocks.storebox2,n.blocks.blockList[170]={privateData:"box2Key"},e.flow=function(e,t,o,r){1===e.length&&(r=n.blocks.blockList[r].privateData,t.boxes[r]=e[0])}}),test("flow should store the value in logo.boxes for Box2",function(){e.flow([888],r,"turtle0",170),expect(r.boxes.box2Key).toBe(888)})}),describe("Box1Block",function(){var t;beforeEach(function(){(t=createdBlocks.box1).macro=jest.fn(function(e,t){return[[0,["namedbox",{value:"box1"}],e,t,[null]]]})}),test("should create a macro returning expected configuration",function(){var e=t.macro(5,15);expect(e[0][1][0]).toBe("namedbox"),expect(e[0][1][1].value).toBe("box1")})}),describe("StoreBox1Block",function(){var e;beforeEach(function(){e=createdBlocks.storebox1,n.blocks.blockList[190]={privateData:"box1Key"},e.flow=function(e,t,o,r){1===e.length&&(r=n.blocks.blockList[r].privateData,t.boxes[r]=e[0])}}),test("flow should store the value in logo.boxes for Box1",function(){e.flow([777],r,"turtle0",190),expect(r.boxes.box1Key).toBe(777)})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var o;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(o="Object"===(o={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:o)||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,e):void 0}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,c=Array(e);o<e;o++)c[o]=t[o];return c}function _callSuper(t,e,o){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,o||[],_getPrototypeOf(t).constructor):e.apply(t,o))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var c=e[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,_toPropertyKey(c.key),c)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0===o)return("string"===e?String:Number)(t);o=o.call(t,e||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../DictBlocks"),setupDictBlocks=_require.setupDictBlocks,DictBlock=(global._=jest.fn(function(t){return t}),global.FlowBlock=(()=>_createClass(function t(e){_classCallCheck(this,t),this.type=e},[{key:"setPalette",value:function(){}},{key:"beginnerBlock",value:function(){return!0}},{key:"setHelpString",value:function(){}},{key:"formBlock",value:function(){}},{key:"flow",value:function(){}},{key:"setup",value:function(){}}]))(),global.LeftBlock=(()=>_createClass(function t(e){_classCallCheck(this,t),this.type=e},[{key:"setPalette",value:function(){}},{key:"beginnerBlock",value:function(){return!0}},{key:"setHelpString",value:function(){}},{key:"formBlock",value:function(){}},{key:"arg",value:function(){}},{key:"setup",value:function(){}}]))(),global.NOINPUTERRORMSG="No input error message",global.Turtle={DictActions:{showDict:jest.fn(),getDict:jest.fn().mockReturnValue({key:"value"}),getValue:jest.fn().mockReturnValue("value"),setValue:jest.fn()}},(()=>{function e(t){var n;return _classCallCheck(this,e),(n=_callSuper(this,e,["dictionary"])).activity=t,n.setPalette=jest.fn(),n.beginnerBlock=jest.fn().mockReturnValue(!0),n.setHelpString=jest.fn(),n.formBlock=jest.fn(),n.arg=jest.fn(function(t,e,o,c){var l=n.activity.blocks.blockList[o].connections[1];return null===l?(n.activity.errorMsg(NOINPUTERRORMSG,o),0):(t=t.parseArg(t,e,l,o,c),Turtle.DictActions.getDict(t,e))}),n}return _inherits(e,global.LeftBlock),_createClass(e,[{key:"setup",value:function(){this.setPalette("dictionary",this.activity)}}])})()),ShowDictBlock=(()=>{function e(t){var l;return _classCallCheck(this,e),(l=_callSuper(this,e,["showDict"])).activity=t,l.setPalette=jest.fn(),l.beginnerBlock=jest.fn().mockReturnValue(!0),l.setHelpString=jest.fn(),l.formBlock=jest.fn(),l.flow=jest.fn(function(t,e,o,c){null===t[0]?l.activity.errorMsg(NOINPUTERRORMSG,c):Turtle.DictActions.showDict(t[0],o)}),l}return _inherits(e,global.FlowBlock),_createClass(e,[{key:"setup",value:function(){this.setPalette("dictionary",this.activity)}}])})(),GetDictBlock=(()=>{function e(t){var i;return _classCallCheck(this,e),(i=_callSuper(this,e,["getDict"])).activity=t,i.setPalette=jest.fn(),i.beginnerBlock=jest.fn().mockReturnValue(!0),i.setHelpString=jest.fn(),i.formBlock=jest.fn(),i.arg=jest.fn(function(t,e,o,c){var l=i.activity.blocks.blockList[o].connections[1],n=i.activity.blocks.blockList[o].connections[2];return null===l||null===n?(i.activity.errorMsg(NOINPUTERRORMSG,o),0):(l=t.parseArg(t,e,l,o,c),t=t.parseArg(t,e,n,o,c),Turtle.DictActions.getValue(l,t,e,o))}),i}return _inherits(e,global.LeftBlock),_createClass(e,[{key:"setup",value:function(){this.setPalette("dictionary",this.activity)}}])})(),SetDictBlock=(()=>{function e(t){var l;return _classCallCheck(this,e),(l=_callSuper(this,e,["setDict"])).activity=t,l.setPalette=jest.fn(),l.beginnerBlock=jest.fn().mockReturnValue(!0),l.setHelpString=jest.fn(),l.formBlock=jest.fn(),l.flow=jest.fn(function(t,e,o,c){null===t[0]||null===t[1]||null===t[2]?l.activity.errorMsg(NOINPUTERRORMSG,c):(c=Turtle.DictActions).setValue.apply(c,_toConsumableArray(t).concat([o]))}),l}return _inherits(e,global.FlowBlock),_createClass(e,[{key:"setup",value:function(){this.setPalette("dictionary",this.activity)}}])})(),GetDictBlock2=(()=>{function e(t){var i;return _classCallCheck(this,e),(i=_callSuper(this,e,["getDict2"])).activity=t,i.setPalette=jest.fn(),i.beginnerBlock=jest.fn().mockReturnValue(!0),i.setHelpString=jest.fn(),i.formBlock=jest.fn(),i.arg=jest.fn(function(t,e,o,c){var l,n=i.activity.blocks.blockList[o].connections[1];return null===n?(i.activity.errorMsg(NOINPUTERRORMSG,o),0):(l=i.activity.turtles.ithTurtle(e).name,t=t.parseArg(t,e,n,o,c),Turtle.DictActions.getValue(l,t,e,o))}),i}return _inherits(e,global.LeftBlock),_createClass(e,[{key:"setup",value:function(){this.setPalette("dictionary",this.activity)}}])})(),SetDictBlock2=(()=>{function e(t){var l;return _classCallCheck(this,e),(l=_callSuper(this,e,["setDict2"])).activity=t,l.setPalette=jest.fn(),l.beginnerBlock=jest.fn().mockReturnValue(!0),l.setHelpString=jest.fn(),l.formBlock=jest.fn(),l.flow=jest.fn(function(t,e,o,c){null===t[0]||null===t[1]?l.activity.errorMsg(NOINPUTERRORMSG,c):(c=Turtle.DictActions).setValue.apply(c,[l.activity.turtles.ithTurtle(o).name].concat(_toConsumableArray(t),[o]))}),l}return _inherits(e,global.FlowBlock),_createClass(e,[{key:"setup",value:function(){this.setPalette("dictionary",this.activity)}}])})();global.DictBlock=DictBlock,global.ShowDictBlock=ShowDictBlock,global.GetDictBlock=GetDictBlock,global.SetDictBlock=SetDictBlock,global.GetDictBlock2=GetDictBlock2,global.SetDictBlock2=SetDictBlock2,describe("setupDictBlocks",function(){var e,o,c,l;beforeEach(function(){e={errorMsg:jest.fn(),blocks:{blockList:{block1:{connections:[null,"block2","block3"]}}},turtles:{ithTurtle:jest.fn().mockReturnValue({name:"turtle1"})}},o={parseArg:jest.fn().mockImplementation(function(t,e,o,c,l){return"block2"===o?"My Dictionary":"block3"===o?"key":l})},c="turtle1",l="block1"}),test("should setup DictBlock correctly",function(){setupDictBlocks(e);var t=new DictBlock(e);t.setup(),expect(t).toBeDefined(),expect(t.beginnerBlock(!0)).toBe(!0),expect(t.setPalette).toHaveBeenCalledWith("dictionary",e)}),test("DictBlock arg should handle null connections",function(){setupDictBlocks(e);var t=new DictBlock(e),t=(t.setup(),e.blocks.blockList[l].connections[1]=null,t.arg(o,c,l,"receivedArg"));expect(e.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,l),expect(t).toBe(0)}),test("DictBlock arg should return dictionary",function(){setupDictBlocks(e);var t=new DictBlock(e),t=(t.setup(),t.arg(o,c,l,"receivedArg"));expect(Turtle.DictActions.getDict).toHaveBeenCalledWith("My Dictionary",c),expect(t).toEqual({key:"value"})}),test("should setup ShowDictBlock correctly",function(){setupDictBlocks(e);var t=new ShowDictBlock(e);t.setup(),expect(t).toBeDefined(),expect(t.beginnerBlock(!0)).toBe(!0),expect(t.setPalette).toHaveBeenCalledWith("dictionary",e)}),test("ShowDictBlock flow should handle null args",function(){setupDictBlocks(e);var t=new ShowDictBlock(e);t.setup(),t.flow([null],o,c,l),expect(e.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,l)}),test("ShowDictBlock flow should call showDict",function(){setupDictBlocks(e);var t=new ShowDictBlock(e);t.setup(),t.flow(["My Dictionary"],o,c,l),expect(Turtle.DictActions.showDict).toHaveBeenCalledWith("My Dictionary",c)}),test("should setup GetDictBlock correctly",function(){setupDictBlocks(e);var t=new GetDictBlock(e);t.setup(),expect(t).toBeDefined(),expect(t.beginnerBlock(!0)).toBe(!0),expect(t.setPalette).toHaveBeenCalledWith("dictionary",e)}),test("GetDictBlock arg should handle null connections",function(){setupDictBlocks(e);var t=new GetDictBlock(e),t=(t.setup(),e.blocks.blockList[l].connections[1]=null,e.blocks.blockList[l].connections[2]=null,t.arg(o,c,l,"receivedArg"));expect(e.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,l),expect(t).toBe(0)}),test("GetDictBlock arg should return value",function(){setupDictBlocks(e);var t=new GetDictBlock(e),t=(t.setup(),t.arg(o,c,l,"receivedArg"));expect(Turtle.DictActions.getValue).toHaveBeenCalledWith("My Dictionary","key",c,l),expect(t).toBe("value")}),test("should setup SetDictBlock correctly",function(){setupDictBlocks(e);var t=new SetDictBlock(e);t.setup(),expect(t).toBeDefined(),expect(t.beginnerBlock(!0)).toBe(!0),expect(t.setPalette).toHaveBeenCalledWith("dictionary",e)}),test("SetDictBlock flow should handle null args",function(){setupDictBlocks(e);var t=new SetDictBlock(e);t.setup(),t.flow([null,null,null],o,c,l),expect(e.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,l)}),test("SetDictBlock flow should call setValue",function(){setupDictBlocks(e);var t=new SetDictBlock(e);t.setup(),t.flow(["My Dictionary","key","value"],o,c,l),expect(Turtle.DictActions.setValue).toHaveBeenCalledWith("My Dictionary","key","value",c)}),test("should setup GetDictBlock2 correctly",function(){setupDictBlocks(e);var t=new GetDictBlock2(e);t.setup(),expect(t).toBeDefined(),expect(t.beginnerBlock(!0)).toBe(!0),expect(t.setPalette).toHaveBeenCalledWith("dictionary",e)}),test("GetDictBlock2 arg should handle null connections",function(){setupDictBlocks(e);var t=new GetDictBlock2(e),t=(t.setup(),e.blocks.blockList[l].connections[1]=null,t.arg(o,c,l,"receivedArg"));expect(e.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,l),expect(t).toBe(0)}),test("should setup SetDictBlock2 correctly",function(){setupDictBlocks(e);var t=new SetDictBlock2(e);t.setup(),expect(t).toBeDefined(),expect(t.beginnerBlock(!0)).toBe(!0),expect(t.setPalette).toHaveBeenCalledWith("dictionary",e)}),test("SetDictBlock2 flow should handle null args",function(){setupDictBlocks(e);var t=new SetDictBlock2(e);t.setup(),t.flow([null,null],o,c,l),expect(e.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,l)}),test("SetDictBlock2 flow should call setValue",function(){setupDictBlocks(e);var t=new SetDictBlock2(e);t.setup(),t.flow(["key","value"],o,c,l),expect(Turtle.DictActions.setValue).toHaveBeenCalledWith("turtle1","key","value",c)}),test("DictBlock arg should handle non-null connections",function(){setupDictBlocks(e);var t=new DictBlock(e),t=(t.setup(),t.arg(o,c,l,"receivedArg"));expect(Turtle.DictActions.getDict).toHaveBeenCalledWith("My Dictionary",c),expect(t).toEqual({key:"value"})}),test("ShowDictBlock flow should handle non-null args",function(){setupDictBlocks(e);var t=new ShowDictBlock(e);t.setup(),t.flow(["My Dictionary"],o,c,l),expect(Turtle.DictActions.showDict).toHaveBeenCalledWith("My Dictionary",c)}),test("GetDictBlock arg should handle non-null connections",function(){setupDictBlocks(e);var t=new GetDictBlock(e),t=(t.setup(),t.arg(o,c,l,"receivedArg"));expect(Turtle.DictActions.getValue).toHaveBeenCalledWith("My Dictionary","key",c,l),expect(t).toBe("value")}),test("SetDictBlock flow should handle non-null args",function(){setupDictBlocks(e);var t=new SetDictBlock(e);t.setup(),t.flow(["My Dictionary","key","value"],o,c,l),expect(Turtle.DictActions.setValue).toHaveBeenCalledWith("My Dictionary","key","value",c)}),test("SetDictBlock2 flow should handle non-null args",function(){setupDictBlocks(e);var t=new SetDictBlock2(e);t.setup(),t.flow(["key","value"],o,c,l),expect(Turtle.DictActions.setValue).toHaveBeenCalledWith("turtle1","key","value",c)})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ownKeys(t,e){var o,r=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../DrumBlocks"),setupDrumBlocks=_require.setupDrumBlocks,activity=(global._=jest.fn(function(e){return e}),global.last=jest.fn(function(e){return e[e.length-1]}),global.Singer={DrumActions:{playNoise:jest.fn(),mapPitchToDrum:jest.fn(),setDrum:jest.fn(),GetDrumname:jest.fn(function(e){return e}),playDrum:jest.fn()}},global.FlowBlock=jest.fn().mockImplementation(function(e,t){return{name:e,displayName:t,setPalette:jest.fn().mockReturnThis(),setHelpString:jest.fn().mockReturnThis(),formBlock:jest.fn().mockReturnThis(),makeMacro:jest.fn().mockReturnThis(),setup:jest.fn().mockReturnThis(),beginnerBlock:jest.fn().mockReturnThis(),flow:jest.fn()}}),global.ValueBlock=jest.fn().mockImplementation(function(e,t){return _objectSpread({},new global.FlowBlock(e,t))}),global.FlowClampBlock=jest.fn().mockImplementation(function(e){return _objectSpread({},new global.FlowBlock(e))}),global.DEFAULTDRUM="defaultDrum",global.DEFAULTEFFECT="defaultEffect",global.NOINPUTERRORMSG="No input error message",global.DEFAULTNOISE="defaultNoise",global.mock=jest.fn(function(){return{setupDrumBlocks:jest.fn(function(e){var t=new global.FlowBlock("playnoise","noise"),t=(t.setPalette("drum",e),t.setHelpString(),t.formBlock({args:1,defaults:["white noise"],argTypes:["anyin"]}),t.makeMacro(),new MapDrumBlock),t=(t.setPalette("drum",e),t.setHelpString(),t.formBlock({name:"map pitch to drum",args:1,argTypes:["anyin"]}),t.makeMacro(),new SetDrumBlock),t=(t.setPalette("drum",e),t.beginnerBlock(!0),t.setHelpString(),t.formBlock({name:"set drum",args:1,argTypes:["anyin"]}),t.makeMacro(),new PlayEffectBlock),t=(t.setPalette("drum",e),t.beginnerBlock(!0),t.formBlock({args:1,argTypes:["anyin"]}),t.makeMacro(),new PlayDrumBlock);t.setPalette("drum",e),t.beginnerBlock(!0),t.setHelpString(),t.formBlock({args:1,argTypes:["anyin"]}),t.makeMacro()})}}),{errorMsg:jest.fn(),turtles:{ithTurtle:jest.fn(function(){return{singer:{drumStyle:[],inNoteBlock:[1],noteBeatValues:{1:[]},beatFactor:1,pushedNote:!1}}})},blocks:{blockList:{}},beginnerMode:!1}),MapDrumBlock=_createClass(function e(){_classCallCheck(this,e),this.setPalette=jest.fn().mockReturnThis(),this.setHelpString=jest.fn().mockReturnThis(),this.formBlock=jest.fn().mockReturnThis(),this.makeMacro=jest.fn().mockReturnThis(),this.flow=jest.fn().mockImplementation(function(e,t,o,r){return Singer.DrumActions.mapPitchToDrum(e[0],o,r),[e[1],1]})}),SetDrumBlock=_createClass(function e(){_classCallCheck(this,e),this.setPalette=jest.fn().mockReturnThis(),this.beginnerBlock=jest.fn().mockReturnThis(),this.setHelpString=jest.fn().mockReturnThis(),this.formBlock=jest.fn().mockReturnThis(),this.makeMacro=jest.fn().mockReturnThis(),this.flow=jest.fn().mockImplementation(function(e,t,o,r){return Singer.DrumActions.setDrum(e[0],o,r),[e[1],1]})}),PlayEffectBlock=_createClass(function e(){_classCallCheck(this,e),this.setPalette=jest.fn().mockReturnThis(),this.beginnerBlock=jest.fn().mockReturnThis(),this.formBlock=jest.fn().mockReturnThis(),this.makeMacro=jest.fn().mockReturnThis()}),PlayDrumBlock=_createClass(function e(){_classCallCheck(this,e),this.setPalette=jest.fn().mockReturnThis(),this.beginnerBlock=jest.fn().mockReturnThis(),this.setHelpString=jest.fn().mockReturnThis(),this.formBlock=jest.fn().mockReturnThis(),this.makeMacro=jest.fn().mockReturnThis(),this.flow=jest.fn().mockImplementation(function(e,t,o,r){Singer.DrumActions.GetDrumname(e[0]),t.inPitchDrumMatrix?(t.pitchDrumMatrix.drums.push(e[0]),t.pitchDrumMatrix.addColBlock(r),t.drumBlocks.push(r)):t.inMatrix?(t.phraseMaker.rowLabels.push(e[0]),t.phraseMaker.rowArgs.push(-1),t.phraseMaker.addRowBlock(r),t.drumBlocks.push(r)):t.inMusicKeyboard?(t.musicKeyboard.instruments.push(e[0]),t.musicKeyboard.noteNames.push("drum"),t.musicKeyboard.octaves.push(null),t.musicKeyboard.addRowBlock(r)):(t=activity.turtles.ithTurtle(),Singer.DrumActions.playDrum(e[0],o,r),t.singer.noteBeatValues[1].push(1),t.singer.pushedNote=!0)})});global.MapDrumBlock=MapDrumBlock,global.SetDrumBlock=SetDrumBlock,global.PlayEffectBlock=PlayEffectBlock,global.PlayDrumBlock=PlayDrumBlock,describe("setupDrumBlocks",function(){var n;beforeEach(function(){n={errorMsg:jest.fn(),turtles:{ithTurtle:jest.fn(function(){return{singer:{drumStyle:[],inNoteBlock:[],noteBeatValues:[],beatFactor:1,pushedNote:!1}}})},beginnerMode:!1,blocks:{blockList:{0:{connections:[null]}}}},global.Singer={DrumActions:{playNoise:jest.fn(),mapPitchToDrum:jest.fn(),setDrum:jest.fn(),playDrum:jest.fn(),GetDrumname:jest.fn(function(e){return e})}},global._=jest.fn(function(e){return e}),global.last=jest.fn(function(e){return e[e.length-1]}),global.DEFAULTDRUM="kick",global.DEFAULTEFFECT="clap",global.NOINPUTERRORMSG="No input provided",global.DEFAULTNOISE="white noise",global.logo={inPitchDrumMatrix:!1,inMatrix:!1,inMusicKeyboard:!1,pitchDrumMatrix:{drums:[],addColBlock:jest.fn()},phraseMaker:{rowLabels:[],rowArgs:[],addRowBlock:jest.fn()},musicKeyboard:{instruments:[],noteNames:[],octaves:[],addRowBlock:jest.fn()},drumBlocks:[]}}),it("should setup drum blocks without errors",function(){expect(function(){return setupDrumBlocks(n)}).not.toThrow()}),it("should call errorMsg when flow args are invalid in PlayNoiseBlock",function(){setupDrumBlocks(n),(new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){var t=e[0];1===e.length&&null!=t&&"string"==typeof t||n.errorMsg(global.NOINPUTERRORMSG,0)}),e}return _inherits(l,global.FlowBlock),_createClass(l)})())).flow([],global.logo,0,0),expect(n.errorMsg).toHaveBeenCalledWith(global.NOINPUTERRORMSG,0)}),it("should call playNoise when flow args are valid in PlayNoiseBlock",function(){setupDrumBlocks(n),(new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){global.Singer.DrumActions.playNoise(e[0],0,0)}),e}return _inherits(l,global.FlowBlock),_createClass(l)})())).flow(["white noise"],global.logo,0,0),expect(global.Singer.DrumActions.playNoise).toHaveBeenCalledWith("white noise",0,0)}),it("should map pitch to drum in MapDrumBlock",function(){setupDrumBlocks(n);var e=(new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){return global.Singer.DrumActions.mapPitchToDrum(e[0],0,0),[void 0,1]}),e}return _inherits(l,global.FlowClampBlock),_createClass(l)})())).flow(["C4"],global.logo,0,0);expect(global.Singer.DrumActions.mapPitchToDrum).toHaveBeenCalledWith("C4",0,0),expect(e).toEqual([void 0,1])}),it("should set drum in SetDrumBlock",function(){setupDrumBlocks(n);var e=(new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){return global.Singer.DrumActions.setDrum(e[0],0,0),[void 0,1]}),e}return _inherits(l,global.FlowClampBlock),_createClass(l)})())).flow(["kick"],global.logo,0,0);expect(global.Singer.DrumActions.setDrum).toHaveBeenCalledWith("kick",0,0),expect(e).toEqual([void 0,1])}),it("should play drum in PlayDrumBlock",function(){setupDrumBlocks(n),(new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){global.Singer.DrumActions.playDrum(e[0],0,0)}),e}return _inherits(l,global.FlowBlock),_createClass(l)})())).flow(["snare"],global.logo,0,0),expect(global.Singer.DrumActions.playDrum).toHaveBeenCalledWith("snare",0,0)}),it("should handle context errors in PlayDrumBlock",function(){setupDrumBlocks(n);var e=new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){1===e.length&&null!=e[0]||console.debug("PLAY DRUM ERROR: missing context")}),e}return _inherits(l,global.FlowBlock),_createClass(l)})());console.debug=jest.fn(),e.flow([null],global.logo,0,0),expect(console.debug).toHaveBeenCalledWith("PLAY DRUM ERROR: missing context")}),it("should push drum to pitchDrumMatrix in PlayDrumBlock",function(){global.logo.inPitchDrumMatrix=!0,setupDrumBlocks(n),(new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){var t=e[0],e=(1===e.length&&null!=t&&"string"==typeof t||(n.errorMsg(global.NOINPUTERRORMSG,0),t=global.DEFAULTDRUM),global.Singer.DrumActions.GetDrumname(t)),t=n.turtles.ithTurtle(0);0<t.singer.drumStyle.length&&(e=global.last(t.singer.drumStyle)),global.logo.pitchDrumMatrix.drums.push(e),global.logo.pitchDrumMatrix.addColBlock(0)}),e}return _inherits(l,global.FlowBlock),_createClass(l)})())).flow(["snare"],global.logo,0,0),expect(global.logo.pitchDrumMatrix.drums).toContain("snare"),expect(global.logo.pitchDrumMatrix.addColBlock).toHaveBeenCalledWith(0)}),it("should push drum to phraseMaker in PlayDrumBlock",function(){global.logo.inMatrix=!0,setupDrumBlocks(n),(new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){var t=e[0],e=(1===e.length&&null!=t&&"string"==typeof t||(n.errorMsg(global.NOINPUTERRORMSG,0),t=global.DEFAULTDRUM),global.Singer.DrumActions.GetDrumname(t)),t=n.turtles.ithTurtle(0);0<t.singer.drumStyle.length&&(e=global.last(t.singer.drumStyle)),global.logo.phraseMaker.rowLabels.push(e),global.logo.phraseMaker.rowArgs.push(-1),global.logo.phraseMaker.addRowBlock(0)}),e}return _inherits(l,global.FlowBlock),_createClass(l)})())).flow(["snare"],global.logo,0,0),expect(global.logo.phraseMaker.rowLabels).toContain("snare"),expect(global.logo.phraseMaker.rowArgs).toContain(-1),expect(global.logo.phraseMaker.addRowBlock).toHaveBeenCalledWith(0)}),it("should push drum to musicKeyboard in PlayDrumBlock",function(){global.logo.inMusicKeyboard=!0,setupDrumBlocks(n),(new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){var t=e[0],e=(1===e.length&&null!=t&&"string"==typeof t||(n.errorMsg(global.NOINPUTERRORMSG,0),t=global.DEFAULTDRUM),global.Singer.DrumActions.GetDrumname(t)),t=n.turtles.ithTurtle(0);0<t.singer.drumStyle.length&&(e=global.last(t.singer.drumStyle)),global.logo.musicKeyboard.instruments.push(e),global.logo.musicKeyboard.noteNames.push("drum"),global.logo.musicKeyboard.octaves.push(null),global.logo.musicKeyboard.addRowBlock(0)}),e}return _inherits(l,global.FlowBlock),_createClass(l)})())).flow(["snare"],global.logo,0,0),expect(global.logo.musicKeyboard.instruments).toContain("snare"),expect(global.logo.musicKeyboard.noteNames).toContain("drum"),expect(global.logo.musicKeyboard.octaves).toContain(null),expect(global.logo.musicKeyboard.addRowBlock).toHaveBeenCalledWith(0)}),it("should play drum in setdrum clamp in PlayDrumBlock",function(){n.turtles.ithTurtle=jest.fn(function(){return{singer:{drumStyle:["snare"],inNoteBlock:[],noteBeatValues:[],beatFactor:1,pushedNote:!1}}}),setupDrumBlocks(n),(new((()=>{function l(){var e;_classCallCheck(this,l);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return _defineProperty(e=_callSuper(this,l,[].concat(o)),"flow",function(e){var t=e[0],e=(1===e.length&&null!=t&&"string"==typeof t||(n.errorMsg(global.NOINPUTERRORMSG,0),t=global.DEFAULTDRUM),global.Singer.DrumActions.GetDrumname(t)),t=n.turtles.ithTurtle(0);0<t.singer.drumStyle.length&&(e=global.last(t.singer.drumStyle)),global.Singer.DrumActions.playDrum(e,0,0)}),e}return _inherits(l,global.FlowBlock),_createClass(l)})())).flow(["snare"],global.logo,0,0),expect(global.Singer.DrumActions.playDrum).toHaveBeenCalledWith("snare",0,0)})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../EnsembleBlocks"),setupEnsembleBlocks=_require.setupEnsembleBlocks,getTargetTurtle=_require.getTargetTurtle;describe("setupEnsembleBlocks",function(){var n,r,l,o,e=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n,l[t]=this},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}}]))(),u=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n,l[t]=this},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}}]))(),i=(()=>_createClass(function e(t){_classCallCheck(this,e),this.name=t,l[t]=this},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}}]))(),a=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n,l[t]=this},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}}]))(),c=(()=>_createClass(function e(t){_classCallCheck(this,e),this.name=t,l[t]=this},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}}]))();beforeEach(function(){l={},jest.clearAllMocks(),global._=jest.fn(function(e){return e}),global._THIS_IS_MUSIC_BLOCKS_=!1,global.ValueBlock=e,global.FlowBlock=u,global.FlowClampBlock=i,global.LeftBlock=a,global.BooleanBlock=c,global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.INVALIDPITCH="Invalid pitch",global.last=jest.fn(function(e){return e[e.length-1]}),global.getNote=jest.fn(function(){return["C",4]}),global.pitchToNumber=jest.fn(function(){return 40}),global.getMunsellColor=jest.fn(function(e,t,n){return"#".concat(e).concat(t).concat(n)}),global.TURTLESVG="<svg>fill_color stroke_color</svg>",global.base64Encode=jest.fn(function(e){return e});var t=[0,1,2].map(function(e){return{name:0===e?"Yertle":1===e?"Turtle1":"Turtle2",inTrash:!1,running:!1,queue:[1,2,3],parentFlowQueue:[],unhighlightQueue:[],parameterQueue:[],startBlock:{name:"start"},painter:{color:"#FF0000",doSetXY:jest.fn(),doSetHeading:jest.fn()},container:{x:100,y:200},orientation:90,singer:{notesPlayed:[10,20],turtleTime:100,lastNotePlayed:["C4",.5],notePitches:[["C"]],noteOctaves:[[4]],noteValue:{0:4},noteBeat:[.25],inNoteBlock:[0],keySignature:"C",movable:!0,pitchNumberOffset:0},rename:jest.fn(),doTurtleShell:jest.fn()}});o={turtleList:[0,1,2],ithTurtle:jest.fn(function(e){return e&&"object"===_typeof(e)&&e.singer?e:(e="string"==typeof e?parseInt(e):e,t[e])}),getTurtle:jest.fn(function(e){return e&&"object"===_typeof(e)&&e.singer?e:(e="string"==typeof e?parseInt(e):e,t[e])}),getTurtleCount:jest.fn(function(){return 3}),companionTurtle:jest.fn(function(e){return e}),screenX2turtleX:jest.fn(function(e){return e}),screenY2turtleY:jest.fn(function(e){return e}),turtleX2screenX:jest.fn(function(e){return e}),turtleY2screenY:jest.fn(function(e){return e}),turtleCount:jest.fn(function(){return 3})},n={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}},turtles:o,stage:{dispatchEvent:jest.fn()},logo:null},r={turtleHeaps:{},parseArg:jest.fn(function(e,t,n,r,l){return void 0!==l?l:"Yertle"}),runFromBlock:jest.fn(),doBreak:jest.fn(),initTurtle:jest.fn(),synth:{inTemperament:"equal"}},n.logo=r,n.blocks.blockList={10:{connections:[null,20,null],name:"test"},20:{name:"text",value:"Yertle"},30:{connections:[null,40,null],name:"test2"},40:{name:"number",value:1}},global.document={addEventListener:jest.fn(),attachEvent:jest.fn(),removeEventListener:jest.fn()},global.window={btoa:jest.fn(function(e){return Buffer.from(e).toString("base64")})},setupEnsembleBlocks(n)}),describe("getTargetTurtle",function(){it("should find turtle by string name",function(){var e=getTargetTurtle(o,"Yertle");expect(e).toBe("0")}),it("should find turtle by number converted to string",function(){o.ithTurtle.mockImplementation(function(e){return{name:e.toString(),inTrash:!1}});var e=getTargetTurtle(o,1);expect(e).toBe("1")}),it("should return null if turtle not found",function(){var e=getTargetTurtle(o,"NonExistent");expect(e).toBeNull()}),it("should skip turtles in trash",function(){o.ithTurtle.mockImplementation(function(e){return{name:0===e?"Yertle":"Other",inTrash:0===e}});var e=getTargetTurtle(o,"Yertle");expect(e).toBeNull()})}),describe("TurtleHeapBlock",function(){var t;beforeEach(function(){t=l.turtleheap,n.blocks.blockList[50]={connections:[null,100,200]},n.blocks.blockList[100]={name:"text",value:"Yertle"},n.blocks.blockList[200]={name:"number",value:1},r.turtleHeaps[0]=[10,20,30]}),it("should return error if turtle name connection is null",function(){n.blocks.blockList[50].connections[1]=null;var e=t.arg(r,0,50,null);expect(n.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,50),expect(e).toBe(-1)}),it("should return error if target turtle not found",function(){r.parseArg.mockReturnValue("NonExistent");var e=t.arg(r,0,50,null);expect(e).toBeUndefined()}),it("should return error if index connection is null",function(){n.blocks.blockList[50].connections[2]=null,r.parseArg.mockReturnValueOnce("Yertle").mockReturnValueOnce(null);t.arg(r,0,50,null);expect(n.errorMsg).toHaveBeenCalledWith(NANERRORMSG,50)}),it("should return value at valid index",function(){r.parseArg.mockReturnValueOnce("Yertle").mockReturnValueOnce(2);var e=t.arg(r,0,50,null);expect(e).toBe(20)}),it("should adjust index < 1 to 1",function(){r.parseArg.mockReturnValueOnce("Yertle").mockReturnValueOnce(0);var e=t.arg(r,0,50,null);expect(n.errorMsg).toHaveBeenCalledWith("Index must be > 0."),expect(e).toBe(10)}),it("should adjust index > 1000 to 1000",function(){r.parseArg.mockReturnValueOnce("Yertle").mockReturnValueOnce(1500);t.arg(r,0,50,null);expect(n.errorMsg).toHaveBeenCalledWith("Maximum heap size is 1000."),expect(r.turtleHeaps[0].length).toBe(1e3)}),it("should grow heap if index > heap length",function(){r.parseArg.mockReturnValueOnce("Yertle").mockReturnValueOnce(5);var e=t.arg(r,0,50,null);expect(r.turtleHeaps[0].length).toBe(5),expect(e).toBe(0)}),it("should create heap if it doesn't exist",function(){delete r.turtleHeaps[0],r.parseArg.mockReturnValueOnce("Yertle").mockReturnValueOnce(1),t.arg(r,0,50,null),expect(r.turtleHeaps[0]).toBeDefined()}),it("should return error if index is not a number",function(){r.parseArg.mockReturnValueOnce("Yertle").mockReturnValueOnce("not a number");t.arg(r,0,50,null);expect(n.errorMsg).toHaveBeenCalledWith(NANERRORMSG,50)})}),describe("StopTurtleBlock",function(){var t;beforeEach(function(){t=l.stopTurtle}),it("should return error if args[0] is null",function(){t.flow([null],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)}),it("should return error if turtle not found",function(){r.parseArg=jest.fn(function(){return"NonExistent"}),t.flow(["NonExistent"],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith("Cannot find turtle NonExistent",10)}),it("should stop turtle when found",function(){var e=o.ithTurtle(0);e.queue=[1,2,3],e.running=!0,t.flow(["Yertle"],r,0,10),expect(e.queue).toEqual([]),expect(e.parentFlowQueue).toEqual([]),expect(e.unhighlightQueue).toEqual([]),expect(e.parameterQueue).toEqual([]),expect(r.doBreak).toHaveBeenCalledWith(e)})}),describe("StartTurtleBlock",function(){var t;beforeEach(function(){t=l.startTurtle;var e=o.ithTurtle(0);e.startBlock=n.blocks.blockList[50],n.blocks.blockList[50]=e.startBlock}),it("should return error if args[0] is null",function(){t.flow([null],r,0,10,null,[],!1),expect(n.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)}),it("should return error if turtle not found",function(){t.flow(["NonExistent"],r,0,10,null,[],!1),expect(n.errorMsg).toHaveBeenCalledWith("Cannot find turtle NonExistent",10)}),it("should return error if turtle is already running",function(){o.ithTurtle(0).running=!0,t.flow(["Yertle"],r,0,10,null,[],!1),expect(n.errorMsg).toHaveBeenCalledWith("Turtle is already running.",10)}),it("should start turtle when found and not running",function(){var e=o.ithTurtle(0);e.running=!1,e.startBlock=n.blocks.blockList[50],n.blocks.blockList[50]=e.startBlock,t.flow(["Yertle"],r,0,50,null,[],!1),expect(e.running).toBe(!0),expect(e.queue).toEqual([])}),it("should return error if start block not found",function(){var e=o.ithTurtle(0);e.running=!1,t.flow(["Yertle"],r,0,10,null,[],!(e.startBlock={name:"other"})),expect(n.errorMsg).toHaveBeenCalledWith("Cannot find start block Yertle",10)})}),describe("TurtleColorBlock",function(){var t;beforeEach(function(){t=l.turtlecolor,n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"text",value:"Yertle"}}),it("should return color of target turtle",function(){r.parseArg.mockReturnValue("Yertle");var e=t.arg(r,0,50,null);expect(e).toBe("#FF0000")}),it("should return color of current turtle if target not found",function(){r.parseArg.mockReturnValue("NonExistent"),n.blocks.blockList[50].connections[1]=null;var e=t.arg(r,0,50,null);expect(e).toBe("#FF0000")})}),describe("TurtleHeadingBlock",function(){var t;beforeEach(function(){t=l.turtleheading,n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"text",value:"Yertle"}}),it("should return heading of target turtle",function(){r.parseArg.mockReturnValue("Yertle");var e=t.arg(r,0,50,null);expect(e).toBe(90)}),it("should return heading of current turtle if target not found",function(){r.parseArg.mockReturnValue("NonExistent"),n.blocks.blockList[50].connections[1]=null;var e=t.arg(r,0,50,null);expect(e).toBe(90)})}),describe("SetXYTurtleBlock",function(){var t;beforeEach(function(){t=l.setxyturtle}),it("should return error if turtle not found",function(){t.flow(["NonExistent",10,20],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith("Cannot find turtle NonExistent",10)}),it("should set XY position for valid turtle",function(){t.flow(["Yertle",10,20],r,0,10);var e=o.getTurtle(0);expect(e.painter.doSetXY).toHaveBeenCalledWith(10,20)}),it("should return error if x or y is string",function(){t.flow(["Yertle","10",20],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith(NANERRORMSG,10),expect(r.stopTurtle).toBe(!0)})}),describe("SetTurtleBlock",function(){var e;beforeEach(function(){e=l.setturtle}),it("should run from block for valid turtle",function(){e.flow(["Yertle",100],r,0,10,null,[],!1),expect(r.runFromBlock).toHaveBeenCalledWith(r,"0",100,!1,null)}),it("should return error if turtle not found",function(){e.flow(["NonExistent",100],r,0,10,null,[],!1),expect(n.errorMsg).toHaveBeenCalledWith("Cannot find turtle NonExistent",10)})}),describe("YTurtleBlock",function(){var t;beforeEach(function(){t=l.yturtle,n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"text",value:"Yertle"}}),it("should return Y position of target turtle",function(){r.parseArg.mockReturnValue("Yertle"),o.screenY2turtleY.mockReturnValue(200);var e=t.arg(r,0,50,null);expect(e).toBe(200)}),it("should return Y position of current turtle if target not found",function(){r.parseArg.mockReturnValue("NonExistent"),n.blocks.blockList[50].connections[1]=null,o.screenY2turtleY.mockReturnValue(200);var e=t.arg(r,0,50,null);expect(e).toBe(200)})}),describe("XTurtleBlock",function(){var t;beforeEach(function(){t=l.xturtle,n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"text",value:"Yertle"}}),it("should return X position of target turtle",function(){r.parseArg.mockReturnValue("Yertle"),o.screenX2turtleX.mockReturnValue(100);var e=t.arg(r,0,50,null);expect(e).toBe(100)}),it("should return X position of current turtle if target not found",function(){r.parseArg.mockReturnValue("NonExistent"),n.blocks.blockList[50].connections[1]=null,o.screenX2turtleX.mockReturnValue(100);var e=t.arg(r,0,50,null);expect(e).toBe(100)})}),describe("TurtleElapsedNotesBlock",function(){var t;beforeEach(function(){t=l.turtlelapsednotes,n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"text",value:"Yertle"}}),it("should return elapsed notes ratio for target turtle",function(){r.parseArg.mockReturnValue("Yertle");var e=t.arg(r,0,50,null);expect(e).toBe(.5)}),it("should return elapsed notes ratio for current turtle if target not found",function(){r.parseArg.mockReturnValue("NonExistent"),n.blocks.blockList[50].connections[1]=null;var e=t.arg(r,0,50,null);expect(e).toBe(.5)})}),describe("TurtlePitchBlock",function(){var t;beforeEach(function(){t=l.turtlepitch,n.blocks.blockList[50]={connections:[null,100],value:null},n.blocks.blockList[100]={name:"text",value:"Yertle"}}),it("should return pitch number from lastNotePlayed",function(){r.parseArg.mockReturnValue("Yertle");var e=t.arg(r,0,50,null);expect(e).toBeUndefined(),expect(n.blocks.blockList[50].value).toBeDefined()}),it("should return pitch number from notePitches if lastNotePlayed is null",function(){o.ithTurtle(0).singer.lastNotePlayed=null,r.parseArg.mockReturnValue("Yertle"),t.arg(r,0,50,null),expect(getNote).toHaveBeenCalled()}),it("should return default pitch if no notes available",function(){var e=o.ithTurtle(0);e.singer.lastNotePlayed=null,e.singer.notePitches=[],r.parseArg.mockReturnValue("Yertle"),t.arg(r,0,50,null),expect(n.errorMsg).toHaveBeenCalledWith(INVALIDPITCH,50)}),it("should return error if turtle not found and use current turtle",function(){r.parseArg.mockReturnValue("NonExistent"),t.arg(r,0,50,null),expect(n.errorMsg).toHaveBeenCalledWith("Cannot find turtle NonExistent",50)})}),describe("TurtleNoteBlock",function(){var t;beforeEach(function(){t=l.turtlenote,n.blocks.blockList[50]={connections:[null,100],name:"turtlenote",value:null},n.blocks.blockList[100]={name:"text",value:"Yertle"}}),it("should return note value from inNoteBlock",function(){r.parseArg.mockReturnValue("Yertle");var e=t.arg(r,0,50,null);expect(e).toBeUndefined(),expect(n.blocks.blockList[50].value).toBe(.25)}),it("should return note value from lastNotePlayed",function(){o.ithTurtle(0).singer.inNoteBlock=[],r.parseArg.mockReturnValue("Yertle"),t.arg(r,0,50,null),expect(n.blocks.blockList[50].value).toBe(.5)}),it("should return note value from noteBeat",function(){var e=o.ithTurtle(0),e=(e.singer.inNoteBlock=[0],e.singer.lastNotePlayed=null,r.parseArg.mockReturnValue("Yertle"),t.arg(r,0,50,null));expect(e).toBeUndefined(),expect(n.blocks.blockList[50].value).toBe(.25)}),it("should return -1 if no notes available",function(){var e=o.ithTurtle(0);e.singer.inNoteBlock=[],e.singer.lastNotePlayed=null,e.singer.notePitches=[],r.parseArg.mockReturnValue("Yertle"),t.arg(r,0,50,null),expect(n.blocks.blockList[50].value).toBe(-1)}),it("should return error if turtle not found",function(){r.parseArg.mockReturnValue("NonExistent"),t.arg(r,0,50,null),expect(n.errorMsg).toHaveBeenCalledWith("Cannot find turtle NonExistent",50),expect(n.blocks.blockList[50].value).toBe(-1)})}),describe("TurtleNote2Block",function(){it("should be created and have correct properties",function(){var e=l.turtlenote2;expect(e).toBeDefined(),expect(e.hidden).toBe(!0),expect(e.deprecated).toBe(!0)})}),describe("TurtleSyncBlock",function(){var t;beforeEach(function(){t=l.turtlesync}),it("should return error if args[0] is null",function(){t.flow([null],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)}),it("should return error if turtle not found",function(){t.flow(["NonExistent"],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith("Cannot find turtle NonExistent",10)}),it("should sync turtleTime when turtle found",function(){var e=o.ithTurtle(0);o.ithTurtle(1).singer.turtleTime=200,t.flow(["Turtle1"],r,0,10),expect(e.singer.turtleTime).toBe(200)})}),describe("FoundTurtleBlock",function(){var t;beforeEach(function(){t=l.foundturtle,n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"text",value:"Yertle"}}),it("should return true if turtle found",function(){r.parseArg.mockReturnValue("Yertle");var e=t.arg(r,0,50,null);expect(e).toBe(!0)}),it("should return false if turtle not found",function(){r.parseArg.mockReturnValue("NonExistent");var e=t.arg(r,0,50,null);expect(e).toBe(!1)})}),describe("NewTurtleBlock",function(){var e;beforeEach(function(){e=l.newturtle,n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"text",value:"NewTurtle"},n.blocks.loadNewBlocks=jest.fn(),o.turtleX2screenX.mockReturnValue(100),o.turtleY2screenY.mockReturnValue(200)}),it("should create new turtle if it doesn't exist",function(){r.parseArg.mockReturnValue("NewTurtle"),e.flow(["NewTurtle"],r,0,50,null),expect(n.blocks.loadNewBlocks).toHaveBeenCalled()}),it("should dispatch event if turtle already exists",function(){r.parseArg.mockReturnValue("Yertle"),e.flow(["Yertle"],r,0,50,null),expect(n.stage.dispatchEvent).toHaveBeenCalledWith("Yertle")})}),describe("SetTurtleColorBlock",function(){var t;beforeEach(function(){t=l.setturtlecolor}),it("should return error if args[0] is null",function(){t.flow([null],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)}),it("should set color for number input",function(){var e=o.ithTurtle(0);e.doTurtleShell=jest.fn(),t.flow([50],r,0,10),expect(getMunsellColor).toHaveBeenCalledWith(50,50,100),expect(e.doTurtleShell).toHaveBeenCalled()}),it("should set default color for non-number input",function(){var e=o.ithTurtle(0);e.doTurtleShell=jest.fn(),t.flow(["red"],r,0,10),expect(getMunsellColor).toHaveBeenCalledWith(0,50,100),expect(e.doTurtleShell).toHaveBeenCalled()})}),describe("TurtleNameBlock",function(){var t;beforeEach(function(){t=l.turtlename}),it("should return name of turtle",function(){var e=t.arg(r,0);expect(e).toBe("Yertle")})}),describe("NumberOfTurtlesBlock",function(){var t;beforeEach(function(){t=l.turtlecount}),it("should return turtle count",function(){var e=t.arg();expect(e).toBe(3)})}),describe("NthTurtleNameBlock",function(){var t;beforeEach(function(){t=l.nthturtle,n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"number",value:1}}),it("should return error if connection is null",function(){n.blocks.blockList[50].connections[1]=null;var e=t.arg(r,0,50,null);expect(n.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,50),expect(e).toBe(0)}),it("should return name of nth turtle",function(){r.parseArg.mockReturnValue(1);var e=t.arg(r,0,50,null);expect(e).toBe("Yertle")}),it("should return error if index is out of range",function(){r.parseArg.mockReturnValue(10);var e=t.arg(r,0,50,null);expect(n.errorMsg).toHaveBeenCalledWith("Cannot find turtle"),expect(e).toBe("")}),it("should return error if index is not a number",function(){r.parseArg.mockReturnValue("not a number");var e=t.arg(r,0,50,null);expect(n.errorMsg).toHaveBeenCalledWith("Index must be > 0."),expect(e).toBe("")})}),describe("SetTurtleNameBlock",function(){var t;beforeEach(function(){t=l.setturtlename}),it("should return error if args are null",function(){t.flow([null,"NewName"],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)}),it("should rename current turtle if args[0] is -1",function(){var e=o.getTurtle(0);t.flow([-1,"NewName"],r,0,10),expect(e.rename).toHaveBeenCalledWith("NewName")}),it("should rename turtle by index",function(){var e=o.getTurtle(1);t.flow([1,"NewName"],r,0,10),expect(e.rename).toHaveBeenCalledWith("NewName")}),it("should rename turtle by name",function(){var e=o.getTurtle(0);t.flow(["Yertle","NewName"],r,0,10),expect(e.rename).toHaveBeenCalledWith("NewName")}),it("should return error if turtle not found",function(){t.flow(["NonExistent","NewName"],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith("Cannot find turtle NonExistent",10)})}),describe("SetTurtleName2Block",function(){var t;beforeEach(function(){t=l.setturtlename2}),it("should return error if args[0] is null",function(){t.flow([null],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)}),it("should rename current turtle",function(){var e=o.getTurtle(0);t.flow(["NewName"],r,0,10),expect(e.rename).toHaveBeenCalledWith("NewName")})}),describe("Music Blocks mode",function(){beforeEach(function(){global._THIS_IS_MUSIC_BLOCKS_=!0,l={},n.blocks.blockList={10:{connections:[null,20,null],name:"test"},20:{name:"text",value:"Yertle"},50:{connections:[null,100,null],name:"test2"},100:{name:"number",value:1}},[10,50].forEach(function(e){n.blocks.blockList[e].connections=[null,20,40]}),n.blocks.blockList[40]={name:"number",value:1},setupEnsembleBlocks(n)}),it("should use mouse terminology in various blocks",function(){[{name:"stopTurtle",type:"flow",args:["NonExistent"]},{name:"startTurtle",type:"flow",args:["NonExistent"]},{name:"setxyturtle",type:"flow",args:["NonExistent",0,0]},{name:"setturtle",type:"flow",args:["NonExistent",100]},{name:"turtlesync",type:"flow",args:["NonExistent"]},{name:"setturtlename",type:"flow",args:["NonExistent","NewName"]}].forEach(function(e){l[e.name].flow(e.args,r,0,10),expect(n.errorMsg).toHaveBeenCalledWith(expect.stringContaining("mouse"),10)});[{name:"turtlepitch"},{name:"turtlenote"},{name:"turtleheap"}].forEach(function(e){e=l[e.name];r.parseArg.mockReturnValue("NonExistent"),e.arg(r,0,50,null),expect(n.errorMsg).toHaveBeenCalledWith(expect.stringContaining("mouse"),50)})}),it("should show error for already running mouse",function(){var e=l.startTurtle;o.ithTurtle(0).running=!0,e.flow(["Yertle"],r,0,10),expect(n.errorMsg).toHaveBeenCalledWith("Mouse is already running.",10)})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _callSuper(t,e,o){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,o||[],_getPrototypeOf(t).constructor):e.apply(t,o))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperty(t,e,o){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0===o)return("string"===e?String:Number)(t);o=o.call(t,e||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}global.LeftBlock=_createClass(function t(){_classCallCheck(this,t),_defineProperty(this,"setPalette",jest.fn()),_defineProperty(this,"setHelpString",jest.fn()),_defineProperty(this,"formBlock",jest.fn()),_defineProperty(this,"setup",jest.fn()),_defineProperty(this,"makeMacro",jest.fn()),_defineProperty(this,"beginnerBlock",jest.fn()),_defineProperty(this,"updateDockValue",jest.fn()),_defineProperty(this,"flow",jest.fn().mockImplementation(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length?arguments[2]:void 0;return t.includes("test.abc")&&this.activity.save.afterSaveAbc("test.abc"),t.includes("test.ly")&&this.activity.save.afterSaveLilypond("test.ly"),t.includes("test.svg")&&this.activity.save.saveSVG("test.svg"),this instanceof this.activity.blocks.NoBackgroundBlock&&(e.svgBackground=!1),this instanceof this.activity.blocks.WaitBlock&&this.activity.turtles.ithTurtle(o),this instanceof this.activity.blocks.DrumBlock?[1,1]:(this instanceof this.activity.blocks.ShowBlocksBlock&&this.activity.blocks.showBlocks(),this instanceof this.activity.blocks.HideBlocksBlock&&this.activity.blocks.hideBlocks(),this instanceof this.activity.blocks.CommentBlock&&this.activity.textMsg(t[0]),this instanceof this.activity.blocks.PrintBlock&&this.activity.textMsg(t[0]),this instanceof this.activity.blocks.DisplayGridBlock&&("Cartesian"===t[0]?this.activity.blocks.activity._showCartesian():"polar"===t[0]&&this.activity.blocks.activity._showPolar()),t)})),_defineProperty(this,"arg",jest.fn().mockImplementation(function(){return"parsedArg"}))}),global.FlowBlock=(()=>{function t(){return _classCallCheck(this,t),_callSuper(this,t,arguments)}return _inherits(t,global.LeftBlock),_createClass(t)})(),global.ValueBlock=(()=>{function t(){return _classCallCheck(this,t),_callSuper(this,t,arguments)}return _inherits(t,global.LeftBlock),_createClass(t)})(),global.StackClampBlock=(()=>{function t(){return _classCallCheck(this,t),_callSuper(this,t,arguments)}return _inherits(t,global.LeftBlock),_createClass(t)})(),global._=jest.fn(function(t){return t});var _require=require("../ExtrasBlocks"),setupExtrasBlocks=_require.setupExtrasBlocks;describe("ExtrasBlocks",function(){var i,e,s;beforeEach(function(){i={blocks:{blockList:{},showBlocks:jest.fn(),hideBlocks:jest.fn(),activity:{_showCartesian:jest.fn(),_showPolar:jest.fn(),_showTreble:jest.fn(),_showGrand:jest.fn(),_showSoprano:jest.fn(),_showAlto:jest.fn(),_showTenor:jest.fn(),_showBass:jest.fn()}},turtles:{ithTurtle:jest.fn(function(){return{singer:{suppressOutput:!1,bpm:[120],inNoteBlock:[],turtleTime:0,previousTurtleTime:0},doWait:jest.fn()}}),getTurtleCount:jest.fn(function(){return 1}),getTurtle:jest.fn(function(){return{inTrash:!1,name:"turtle1"}})},save:{afterSaveAbc:jest.fn(),afterSaveLilypond:jest.fn(),saveSVG:jest.fn()},errorMsg:jest.fn(),textMsg:jest.fn()},e={parseArg:jest.fn(function(t,e,o,i,s){return o?"parsedArg":null}),inOscilloscope:!1,inMatrix:!1,inStatusMatrix:!1,svgOutput:"",canvas:{height:500,width:500},svgBackground:!0,oscilloscopeTurtles:[],turtleDelay:0,runningLilypond:!1,notation:{notationMarkup:jest.fn()},phraseMaker:{lyricsON:!1}},s=0,setupExtrasBlocks(i);var o=(()=>{function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e)).activity=i,t}return _inherits(e,global.FlowBlock),_createClass(e)})();["FloatToStringBlock","SaveABCBlock","SaveLilypondBlock","SaveSVGBlock","NoBackgroundBlock","ShowBlocksBlock","HideBlocksBlock","VSpaceBlock","HSpaceBlock","WaitBlock","CommentBlock","PrintBlock","DrumBlock","GridBlock","NOPValueBlock","NOPOneArgMathBlock","NOPTwoArgMathBlock","NOPZeroArgBlock","NOPOneArgBlock","NOPTwoArgBlock","NOPThreeArgBlock","NOPFourArgBlock","DisplayGridBlock"].forEach(function(t){var e=new o;e.flow=jest.fn().mockImplementation(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length?arguments[2]:void 0;return t.includes("test.abc")&&this.activity.save.afterSaveAbc("test.abc"),t.includes("test.ly")&&this.activity.save.afterSaveLilypond("test.ly"),t.includes("test.svg")&&this.activity.save.saveSVG("test.svg"),this instanceof this.activity.blocks.NoBackgroundBlock&&(e.svgBackground=!1),this instanceof this.activity.blocks.WaitBlock&&this.activity.turtles.ithTurtle(o),this instanceof this.activity.blocks.ShowBlocksBlock&&this.activity.blocks.showBlocks(),this instanceof this.activity.blocks.HideBlocksBlock&&this.activity.blocks.hideBlocks(),this instanceof this.activity.blocks.CommentBlock&&this.activity.textMsg(t[0]),this instanceof this.activity.blocks.PrintBlock&&this.activity.textMsg(t[0]),this instanceof this.activity.blocks.DisplayGridBlock&&("Cartesian"===t[0]?this.activity.blocks.activity._showCartesian():"polar"===t[0]&&this.activity.blocks.activity._showPolar()),t}),e.arg=jest.fn().mockReturnValue("parsedArg"),i.blocks[t]=o,i.blocks.blockList[t]=e,Object.setPrototypeOf(e,o.prototype)})}),test("should setup all blocks",function(){expect(Object.keys(i.blocks.blockList).length).toBeGreaterThan(0)}),test("FloatToStringBlock: should convert float to fraction",function(){var t=new i.blocks.FloatToStringBlock;expect(t.arg(e,s,1,{value:.5})).toBe("parsedArg")}),test("SaveABCBlock: should trigger save function",function(){(new i.blocks.SaveABCBlock).flow(["test.abc"],e,s),expect(i.save.afterSaveAbc).toHaveBeenCalledWith("test.abc")}),test("SaveLilypondBlock: should trigger save function",function(){(new i.blocks.SaveLilypondBlock).flow(["test.ly"],e,s),expect(i.save.afterSaveLilypond).toHaveBeenCalledWith("test.ly")}),test("SaveSVGBlock: should save SVG with background",function(){(new i.blocks.SaveSVGBlock).flow(["test.svg"],e,s,1),expect(i.save.saveSVG).toHaveBeenCalledWith("test.svg")}),test("NoBackgroundBlock: should disable background",function(){(new i.blocks.NoBackgroundBlock).flow([],e),expect(e.svgBackground).toBe(!1)}),test("VSpaceBlock: should flow without logic",function(){var t=new i.blocks.VSpaceBlock;expect(function(){return t.flow([],e)}).not.toThrow()}),test("HSpaceBlock: should return parsed argument",function(){var t=new i.blocks.HSpaceBlock;expect(t.arg(e,s,1,{value:5})).toBe("parsedArg")}),test("WaitBlock: should wait and update time",function(){(new i.blocks.WaitBlock).flow([2],e,s),expect(i.turtles.ithTurtle).toHaveBeenCalledWith(s)}),test("DrumBlock: should flow with args",function(){var t=new i.blocks.DrumBlock;expect(t.flow([1],e)).toEqual([1,1])}),test("GridBlock: should initialize correctly",function(){var t=new i.blocks.GridBlock;expect(t).toBeInstanceOf(i.blocks.GridBlock)}),test("NOP blocks: should initialize without errors",function(){[new i.blocks.NOPValueBlock,new i.blocks.NOPOneArgMathBlock,new i.blocks.NOPTwoArgMathBlock,new i.blocks.NOPZeroArgBlock,new i.blocks.NOPOneArgBlock,new i.blocks.NOPTwoArgBlock,new i.blocks.NOPThreeArgBlock,new i.blocks.NOPFourArgBlock].forEach(function(t){expect(t).toBeDefined()})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _jest$requireActual=jest.requireActual("../FlowBlocks"),setupFlowBlocks=_jest$requireActual.setupFlowBlocks,BaseBlock=(global._=function(e){return e},global.last=function(e){return e&&e.length?e[e.length-1]:null},global.ZERODIVIDEERRORMSG="ZERO_DIVIDE",global.NOINPUTERRORMSG="NO_INPUT",global.POSNUMBER="POS_NUMBER",(()=>_createClass(function e(t){_classCallCheck(this,e),this.name=t,this.dockTypes=[null],this.size=1,this.lang="en",this.hidden=!1},[{key:"setPalette",value:function(e){this.palette=e}},{key:"setHelpString",value:function(e){this.help=e}},{key:"formBlock",value:function(e){this.formDefn=e}},{key:"setup",value:function(e){return e.registeredBlocks=e.registeredBlocks||{},e.registeredBlocks[this.name]=this}}]))()),FlowBlock=(()=>{function t(e){return _classCallCheck(this,t),_callSuper(this,t,[e])}return _inherits(t,BaseBlock),_createClass(t,[{key:"setArgLabels",value:function(){}},{key:"flow",value:function(){}}])})(),FlowClampBlock=(()=>{function t(e){return _classCallCheck(this,t),(e=_callSuper(this,t,[e])).dockTypes=[null,null,null],e}return _inherits(t,FlowBlock),_createClass(t,[{key:"beginnerBlock",value:function(e){this.isBeginner=e}},{key:"makeMacro",value:function(e){this.macro=e}},{key:"updateDockValue",value:function(e,t){this.dockTypes[e]=t}}])})(),ValueBlock=(()=>{function o(e,t){return _classCallCheck(this,o),(e=_callSuper(this,o,[e])).label=t,e}return _inherits(o,BaseBlock),_createClass(o,[{key:"arg",value:function(){}}])})();global.BaseBlock=BaseBlock,global.FlowBlock=FlowBlock,global.FlowClampBlock=FlowClampBlock,global.ValueBlock=ValueBlock,global.Queue=_createClass(function e(t,o,n,l){_classCallCheck(this,e),this.child=t,this.factor=o,this.parentBlk=n,this.receivedArg=l}),describe("FlowBlocks integration",function(){function o(e){return n.registeredBlocks[e]}var n,l,t;beforeEach(function(){n={beginnerMode:!(t={}),blocks:{blockList:{},findBottomBlock:jest.fn(function(e){return e})},turtles:{ithTurtle:jest.fn(function(e){return t[e]||(t[e]={singer:{backward:[],duplicateFactor:1,inDuplicate:!1,justCounting:[],suppressOutput:!1,runningFromEvent:!1,turtleTime:0,previousTurtleTime:0},parentFlowQueue:[],queue:[],endOfClampSignals:{},unhighlightQueue:[],doWait:jest.fn(),running:!0}),t[e]})},errorMsg:jest.fn()},l={setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),doBreak:jest.fn(),eventList:{},connectionStore:{0:{}},connectionStoreLock:!1,switchBlocks:{0:[]},switchCases:{0:{}},parseArg:jest.fn(function(e,t,o,n,l){return null!=l?l:"match"}),runFromBlockNow:jest.fn(),stopTurtle:!1,firstNoteTime:null,receivedArg:null},setupFlowBlocks(n)});test("macros generate expected starter stacks",function(){var e=o("backward").macro(10,20),e=(expect(e[0][1]).toBe("backward"),o("duplicatenotes").macro(5,6)),e=(expect(e[0][1]).toBe("duplicatenotes"),o("switch").macro(1,2));expect(e[0][1]).toBe("switch")}),test("registers all flow-related blocks on setup",function(){expect(Object.keys(n.registeredBlocks).sort()).toEqual(["backward","duplicatenotes","defaultcase","case","switch","clamp","break","waitFor","until","while","ifthenelse","if","forever","repeat","duplicatefactor","hiddennoflow","hidden"].sort())}),test("BackwardBlock flow handles next block present and absent",function(){n.blocks.blockList[10]={connections:[null,5,null,null]};var e=o("backward"),e=(n.blocks.blockList[10].connections[2]=null,e.flow([3],l,0,10),expect(n.turtles.ithTurtle(0).singer.backward).toHaveLength(0),n.blocks.blockList[10].connections[2]=11,n.turtles.ithTurtle(0).endOfClampSignals[11]=["prior"],e.flow([4],l,0,10),l.setTurtleListener.mock.calls.pop()[2]);expect(n.turtles.ithTurtle(0).endOfClampSignals[11]).toHaveLength(2),e(),expect(n.turtles.ithTurtle(0).singer.backward).toHaveLength(0)}),test("DuplicateBlock handles invalid, stopping, and normal flow paths",function(){var e=o("duplicatenotes"),t=(expect(e.flow([1],l,0,0)).toBeUndefined(),n.blocks.blockList[0]={connections:[null,1,null,2]},Math.floor),t=(Math.floor=jest.fn(function(){return 0}),e.flow([0,1],l,0,0),expect(n.errorMsg).toHaveBeenCalledWith(ZERODIVIDEERRORMSG,0),expect(l.stopTurtle).toBe(!0),Math.floor=t,n.blocks.blockList={0:{name:"duplicatenotes",connections:[null,1,null,2]},1:{name:"visibleA",connections:[0,2]},2:{name:"hidden",connections:[1,3]},3:{name:"visibleB",connections:[2,0]}},l.connectionStore[0][0]=[],l.connectionStoreLock=!1,e.flow([2,1],l,0,0,["arg"])),t=(expect(t).toBeUndefined(),n.turtles.ithTurtle(0));expect(t.singer.duplicateFactor).toBe(2),(0,l.setTurtleListener.mock.calls.pop()[2])(),expect(t.singer.duplicateFactor).toBe(1),l.connectionStore={0:_defineProperty({},0,[]),1:_defineProperty({},0,[[4,1,5],[5,0,null]])},n.blocks.blockList[4]={name:"hidden",connections:[6,null]},n.blocks.blockList[5]={name:"visibleC",connections:[null]},n.blocks.blockList[6]={name:"visibleD",connections:[null]},l.connectionStoreLock=!0,e.flow([3,4],l,0,0,["arg"]),expect(l.connectionStoreLock).toBe(!1),l.connectionStore={0:_defineProperty({},0,[])},e.flow([null,1],l,0,0),expect(n.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,0)}),test("DefaultCaseBlock validates switch context",function(){var e=o("defaultcase");l.switchBlocks[0]=[],e.flow([99],l,0,2),expect(l.stopTurtle).toBe(!0),l.stopTurtle=!1,l.switchBlocks[0]=[7],l.switchCases[0]={7:[[["existing",3]]]},e.flow([42],l,0,2),expect(l.switchCases[0][7][0]).toContainEqual(["__default__",42])}),test("CaseBlock validates switch context",function(){var e=o("case");l.switchBlocks[0]=[],e.flow([1,2],l,0,3),expect(l.stopTurtle).toBe(!0),l.stopTurtle=!1,l.switchBlocks[0]=[8],l.switchCases[0]={8:[[["existing",5]]]},e.flow(["x",123],l,0,3),expect(l.switchCases[0][8][0]).toContainEqual(["x",123])}),test("SwitchBlock queues matching and default cases",function(){var e=o("switch"),e=(n.blocks.blockList[4]={connections:[null,20]},l.switchBlocks[0]=[],l.switchCases[0]={},e.flow([null,9],l,0,4),l.setTurtleListener.mock.calls.pop()[2]);l.switchBlocks[0]=[4],l.switchCases[0][4]=[[["match",12],["__default__",14]]],l.parseArg.mockReturnValue("match"),e(),expect(n.turtles.ithTurtle(0).queue[0].child).toBe(12),l.switchBlocks[0]=[4],l.switchCases[0][4]=[[["other",99],["__default__",77]]],l.parseArg.mockReturnValue("unknown"),e(),expect(n.turtles.ithTurtle(0).queue.pop().child).toBe(77)}),test("ClampBlock simply forwards flow",function(){var e=o("clamp");expect(e.flow([15])).toEqual([15,1]),expect(e.flow([15,16])).toBeUndefined()}),test("BreakBlock calls logo.doBreak and unhighlights parent",function(){var e=o("break");n.blocks.blockList[5]={connections:[50]},n.blocks.blockList[50]={name:"parent"},e.flow([],l,0,5),expect(l.doBreak).toHaveBeenCalled(),expect(n.turtles.ithTurtle(0).unhighlightQueue).toContain(50)}),test("WaitForBlock requeues until condition then updates time",function(){var e=o("waitFor"),t=(n.blocks.blockList[6]={connections:[60]},e.flow([!1],l,0,6),n.turtles.ithTurtle(0)),e=(expect(t.queue[0].parentBlk).toBe(60),expect(t.doWait).toHaveBeenCalled(),t.queue.push(new Queue(6,1,6)),t.queue.push(new Queue(6,1,6)),l.firstNoteTime=null,e.flow([!0],l,0,6),expect(l.firstNoteTime).not.toBeNull(),t.queue.filter(function(e){return 6===e.parentBlk}));expect(e).toHaveLength(1)}),test("UntilBlock requeues when false and cleans when true",function(){var e=o("until"),t=(n.blocks.blockList[7]={connections:[70]},e.flow([!1,71],l,0,7),expect(n.turtles.ithTurtle(0).queue.pop().parentBlk).toBe(70),n.turtles.ithTurtle(0));t.queue.push(new Queue(99,1,7)),t.queue.push(new Queue(98,1,7)),e.flow([!0,72],l,0,7),expect(t.queue).toHaveLength(1)}),test("WhileBlock requeues when true and flushes when false",function(){var e=o("while"),t=(n.blocks.blockList[8]={connections:[80]},e.flow([!0,81],l,0,8)),t=(expect(t).toEqual([81,1]),n.turtles.ithTurtle(0));expect(t.queue.pop().parentBlk).toBe(80),t.queue.push(new Queue(99,1,8)),t.queue.push(new Queue(98,1,8)),e.flow([!1,82],l,0,8),expect(t.queue).toHaveLength(1)}),test("IfThenElseBlock chooses correct branch",function(){var e=o("ifthenelse");expect(e.flow([!0,1,2])).toEqual([1,1]),expect(e.flow([!1,1,2])).toEqual([2,1])}),test("IfBlock only flows when condition true",function(){var e=o("if");expect(e.flow([!0,10])).toEqual([10,1]),expect(e.flow([!1,10])).toBeUndefined()}),test("ForeverBlock returns continuous or limited flow",function(){var e=o("forever"),t=n.turtles.ithTurtle(0);t.singer.suppressOutput=!1,expect(e.flow([33],l,0)).toEqual([33,-1]),t.singer.suppressOutput=!0,expect(e.flow([34],l,0)).toEqual([34,20])}),test("RepeatBlock validates number and repeats child",function(){var e=o("repeat");expect(e.flow([0,90],l,0,9)).toEqual([null,0]),expect(e.flow([3,91],l,0,9)).toEqual([91,3]),e.flow([-1,92],l,0,9),expect(n.errorMsg).toHaveBeenCalledWith(POSNUMBER,9)}),test("DuplicateFactorBlock exposes singer value or status field",function(){var e=o("duplicatefactor");n.blocks.blockList[11]={connections:[12]},n.blocks.blockList[12]={name:"print"},l.inStatusMatrix=!0,l.statusFields=[],e.arg(l,0,11),expect(l.statusFields).toContainEqual([11,"duplicate"]),l.inStatusMatrix=!1,e.arg(l,0,11),expect(n.blocks.blockList[11].value).toBe(n.turtles.ithTurtle(0).singer.duplicateFactor)}),test("Hidden block variants simply no-op",function(){expect(function(){return o("hiddennoflow").flow()}).not.toThrow(),expect(function(){return o("hidden").flow()}).not.toThrow()}),test("WaitForBlock ignores malformed args and While/Until guard arg length",function(){var e=o("waitFor"),e=(expect(e.flow([],l,0,6)).toBeUndefined(),o("until")),e=(expect(e.flow([!0],l,0,7)).toBeUndefined(),o("while"));expect(e.flow([!0],l,0,8)).toBeUndefined()})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}global._=jest.fn(function(e){return e}),global.last=function(e){return e[e.length-1]},global.NANERRORMSG="NaN error",global.NOINPUTERRORMSG="No input error",global._THIS_IS_MUSIC_BLOCKS_=!1,global.toFixed2=jest.fn(function(e){return e}),global.ValueBlock=(()=>_createClass(function e(t){_classCallCheck(this,e),_defineProperty(this,"setPalette",jest.fn()),_defineProperty(this,"setHelpString",jest.fn()),_defineProperty(this,"formBlock",jest.fn()),_defineProperty(this,"beginnerBlock",jest.fn()),this.name=t},[{key:"setup",value:function(e){e.blocks[this.name]=this.constructor}}]))(),global.FlowBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,global.ValueBlock),_createClass(e)})(),global.FlowClampBlock=(()=>{function n(){var e;_classCallCheck(this,n);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return _defineProperty(e=_callSuper(this,n,[].concat(r)),"makeMacro",jest.fn()),e}return _inherits(n,global.FlowBlock),_createClass(n)})();var _require=require("../GraphicsBlocks"),setupGraphicsBlocks=_require.setupGraphicsBlocks;describe("GraphicsBlocks",function(){var t,r,o,e;beforeEach(function(){o=0,e={singer:{inNoteBlock:[],suppressOutput:!1,embeddedGraphics:[[]]},painter:{doSetHeading:jest.fn(),doSetXY:jest.fn(),doScrollXY:jest.fn(),doClear:jest.fn(),doBezier:jest.fn(),doArc:jest.fn(),doForward:jest.fn(),doRight:jest.fn(),penState:!0,wrap:!1},x:0,y:0,orientation:45,container:{x:10,y:20}},t={blocks:{},errorMsg:jest.fn(),turtles:{companionTurtle:jest.fn(function(){return 0}),ithTurtle:jest.fn(function(){return e}),getTurtle:jest.fn(function(){return e}),screenX2turtleX:jest.fn(function(e){return e}),screenY2turtleY:jest.fn(function(e){return e})}},r={inMatrix:!1,inStatusMatrix:!1,statusFields:[],phraseMaker:{addRowBlock:jest.fn(),rowLabels:[],rowArgs:[]},pitchBlocks:[],setDispatchBlock:jest.fn(),setTurtleListener:jest.fn()},setupGraphicsBlocks(t)}),test("setupGraphicsBlocks initializes without crashing",function(){expect(_typeof(setupGraphicsBlocks)).toBe("function"),expect(t.blocks).toBeDefined()}),test("HeadingBlock: arg returns turtle orientation",function(){var e=(new t.blocks.heading).arg(r,o,0);expect(e).toBe(45)}),test("XBlock: arg returns turtle X position",function(){var e=(new t.blocks.x).arg(r,o,0);expect(e).toBe(10)}),test("YBlock: arg returns turtle Y position",function(){var e=(new t.blocks.y).arg(r,o,0);expect(e).toBe(20)}),test("ForwardBlock: flow moves turtle forward",function(){(new t.blocks.forward).flow([100],r,o,1),expect(e.painter.doForward).toHaveBeenCalledWith(100)}),test("RightBlock: flow turns turtle right",function(){(new t.blocks.right).flow([90],r,o,1),expect(e.painter.doRight).toHaveBeenCalledWith(90)}),test("BackBlock: flow moves turtle backward",function(){(new t.blocks.back).flow([50],r,o,1),expect(e.painter.doForward).toHaveBeenCalledWith(-50)}),test("SetXYBlock: flow sets turtle position",function(){(new t.blocks.setxy).flow([30,40],r,o,1),expect(e.painter.doSetXY).toHaveBeenCalledWith(30,40)}),test("ScrollXYBlock: flow scrolls canvas",function(){(new t.blocks.scrollxy).flow([10,20],r,o,1),expect(e.painter.doScrollXY).toHaveBeenCalledWith(10,20)}),test("ClearBlock: flow clears turtle drawing",function(){(new t.blocks.clear).flow([],r,o,1),expect(e.painter.doClear).toHaveBeenCalled()}),test("ArcBlock: flow draws arc",function(){(new t.blocks.arc).flow([90,100],r,o,1),expect(e.painter.doArc).toHaveBeenCalledWith(90,100)})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../HeapBlocks"),setupHeapBlocks=_require.setupHeapBlocks;describe("setupHeapBlocks",function(){var n,r,o,e=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n,o[t]=this},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}}]))(),t=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n,o[t]=this},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"makeMacro",value:function(){return this}},{key:"setup",value:function(){return this}}]))(),a=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n,o[t]=this},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}}]))();function i(e,t){r.turtleHeaps[e]=t}beforeEach(function(){o={},global._=jest.fn(function(e){return e}),global.ValueBlock=e,global.FlowBlock=t,global.LeftBlock=a,global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",n={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}}},r={inStatusMatrix:!1,turtleHeaps:{},statusFields:[],parseArg:jest.fn(function(e,t,n,r,o){return o})},n.blocks.blockList={10:{connections:[20]},20:{name:"print"}},setupHeapBlocks(n)}),describe("HeapBlock",function(){it("should return JSON string of the turtle heap when not in status matrix",function(){i(0,[1,2,3]);var e=o.heap,e=(r.inStatusMatrix=!1,e.arg(r,0,99));expect(e).toEqual(JSON.stringify([1,2,3]))}),it("should push to statusFields when in status matrix and connected to print",function(){i(0,[4,5]);var e=o.heap,e=(r.inStatusMatrix=!0,e.arg(r,0,10));expect(e).toBeUndefined(),expect(r.statusFields).toContainEqual([10,"heap"])})}),describe("ShowHeapBlock",function(){it("should display the turtle heap as JSON string via activity.textMsg",function(){i(0,[7,8,9]),o.showHeap.flow([],r,0),expect(n.textMsg).toHaveBeenCalledWith(JSON.stringify([7,8,9]))}),it("should create an empty heap if turtle heap is undefined",function(){delete r.turtleHeaps[1],o.showHeap.flow([],r,1),expect(r.turtleHeaps[1]).toEqual([]),expect(n.textMsg).toHaveBeenCalledWith("[]")})}),describe("HeapLengthBlock",function(){it("should return the length of the turtle heap when not in status matrix",function(){i(0,[10,20,30,40]);var e=o.heapLength,e=(r.inStatusMatrix=!1,e.arg(r,0,99));expect(e).toEqual(4)}),it("should push to statusFields when in status matrix and connected to print",function(){i(0,[1]);var e=o.heapLength,e=(r.inStatusMatrix=!0,e.arg(r,0,10));expect(e).toBeUndefined(),expect(r.statusFields).toContainEqual([10,"heapLength"])})}),describe("HeapEmptyBlock",function(){it("should return true if the heap is empty",function(){i(0,[]);var e=o.heapEmpty.arg(r,0);expect(e).toBe(!0)}),it("should return false if the heap is not empty",function(){i(0,[5]);var e=o.heapEmpty.arg(r,0);expect(e).toBe(!1)}),it("should return true if turtle heap is undefined",function(){delete r.turtleHeaps[2];var e=o.heapEmpty.arg(r,2);expect(e).toBe(!0)})}),describe("EmptyHeapBlock",function(){it("should empty the turtle heap",function(){i(0,[1,2,3]),o.emptyHeap.flow([],r,0),expect(r.turtleHeaps[0]).toEqual([])})}),describe("ReverseHeapBlock",function(){it("should reverse the turtle heap",function(){i(0,[1,2,3,4]),o.reverseHeap.flow([],r,0),expect(r.turtleHeaps[0]).toEqual([4,3,2,1])})}),describe("IndexHeapBlock",function(){var t;beforeEach(function(){n.blocks.blockList[50]={connections:[null,100]},n.blocks.blockList[100]={name:"dummy"},t=o.indexHeap,i(0,[10,20,30])}),it("should call errorMsg if connections[1] is null",function(){n.blocks.blockList[50]={connections:[null,null]},t.arg(r,0,50,2),expect(n.errorMsg).toHaveBeenCalledWith("No input provided",50)}),it("should return the value at the given index when valid",function(){r.parseArg.mockReturnValue(2);var e=t.arg(r,0,50,2);expect(e).toEqual(20)}),it("should treat -1 as the top of the heap",function(){r.parseArg.mockReturnValue(-1);var e=t.arg(r,0,50,-1);expect(e).toEqual(30)}),it("should adjust index < 1 and call errorMsg",function(){r.parseArg.mockReturnValue(0);var e=t.arg(r,0,50,0);expect(n.errorMsg).toHaveBeenCalledWith("Index must be > 0."),expect(e).toEqual(10)}),it("should adjust index > 1000 and call errorMsg",function(){r.parseArg.mockReturnValue(1500),i(0,[]);var e=t.arg(r,0,50,1500);expect(n.errorMsg).toHaveBeenCalledWith("Maximum heap size is 1000."),expect(e).toEqual(0),expect(r.turtleHeaps[0].length).toEqual(1e3)}),it("should call errorMsg and return 0 if parseArg is not a number",function(){r.parseArg.mockReturnValue("not a number");var e=t.arg(r,0,50,"not a number");expect(n.errorMsg).toHaveBeenCalledWith("Not a number",50),expect(e).toEqual(0)})}),describe("SetHeapEntryBlock",function(){var e;beforeEach(function(){e=o.setHeapEntry,i(0,[1,2,3])}),it("should call errorMsg if any argument is null",function(){e.flow([null,99],r,0,60),expect(n.errorMsg).toHaveBeenCalledWith("No input provided",60)}),it("should call errorMsg if arguments are not numbers",function(){e.flow(["a",99],r,0,60),expect(n.errorMsg).toHaveBeenCalledWith("Not a number",60)}),it("should adjust index < 1 and set the value at index 1",function(){e.flow([0,55],r,0,60),expect(n.errorMsg).toHaveBeenCalledWith("Index must be > 0."),expect(r.turtleHeaps[0][0]).toEqual(55)}),it("should adjust index > 1000 and set the value at index 1000",function(){e.flow([1500,77],r,0,60),expect(n.errorMsg).toHaveBeenCalledWith("Maximum heap size is 1000."),expect(r.turtleHeaps[0].length).toEqual(1e3),expect(r.turtleHeaps[0][999]).toEqual(77)}),it("should set the heap entry for valid input",function(){e.flow([2,88],r,0,60),expect(r.turtleHeaps[0][1]).toEqual(88)})}),describe("PopBlock",function(){it("should pop and return the top value from the heap if nonempty",function(){i(0,[100,200,300]);var e=o.pop.arg(r,0);expect(e).toEqual(300),expect(r.turtleHeaps[0]).toEqual([100,200])}),it("should call errorMsg and return 0 if the heap is empty",function(){i(0,[]);var e=o.pop.arg(r,0);expect(n.errorMsg).toHaveBeenCalledWith("empty heap"),expect(e).toEqual(0)})}),describe("PushBlock",function(){it("should push a value onto the heap",function(){i(0,[5]),o.push.flow([42],r,0,70),expect(r.turtleHeaps[0]).toEqual([5,42])}),it("should call errorMsg if the value to push is null",function(){i(0,[5]),o.push.flow([null],r,0,70),expect(n.errorMsg).toHaveBeenCalledWith("No input provided",70)})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _callSuper(t,e,n){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,n||[],_getPrototypeOf(t).constructor):e.apply(t,n))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var fs=require("fs"),path=require("path"),code=fs.readFileSync(path.join(__dirname,"../IntervalsBlocks.js"),"utf8");eval(code),describe("setupIntervalsBlocks",function(){var t,e,n,r,o=(()=>_createClass(function t(e){_classCallCheck(this,t),this.name=e,n[e]=this},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"makeMacro",value:function(){return this}},{key:"setup",value:function(){return this}}]))(),i=(()=>{function t(){return _classCallCheck(this,t),_callSuper(this,t,arguments)}return _inherits(t,o),_createClass(t)})(),l=(()=>{function t(){return _classCallCheck(this,t),_callSuper(this,t,arguments)}return _inherits(t,o),_createClass(t)})(),s=(()=>{function t(){return _classCallCheck(this,t),_callSuper(this,t,arguments)}return _inherits(t,o),_createClass(t)})();beforeEach(function(){n={},global._=jest.fn(function(t){return t}),global.last=jest.fn(function(t){return t[t.length-1]}),global.ValueBlock=o,global.FlowBlock=i,global.FlowClampBlock=l,global.LeftBlock=s,global.NOINPUTERRORMSG="No input",global.DEFAULTCHORD="major",global.CHORDNAMES={major:["major","major"]},global.CHORDVALUES={major:[[0,4],[0,7]]},global.INTERVALVALUES={fifth:[0,0,1.5]},global.Singer={IntervalsActions:{setTemperament:jest.fn(),GetIntervalNumber:jest.fn(function(){return 5}),GetCurrentInterval:jest.fn(function(){return 7}),setSemitoneInterval:jest.fn(),setScalarInterval:jest.fn(),setChordInterval:jest.fn(),setRatioInterval:jest.fn(),defineMode:jest.fn(),setMovableDo:jest.fn(),getModeLength:jest.fn(function(){return 7}),getCurrentMode:jest.fn(function(){return"major"}),getCurrentKey:jest.fn(function(){return"C"}),setKey:jest.fn()},scalarDistance:jest.fn(function(){return 3})},t={errorMsg:jest.fn(),blocks:{blockList:{},findBottomBlock:jest.fn()},turtles:{ithTurtle:function(){return{singer:{suppressOutput:!1,justCounting:[],justMeasuring:[],firstPitch:[],lastPitch:[],notesPlayed:0,duplicateFactor:1,arpeggio:[]},painter:{doPenUp:jest.fn(),doSetXY:jest.fn(),doSetHeading:jest.fn()},endOfClampSignals:{},butNotThese:{},queue:[],parentFlowQueue:[]}}}},e={inStatusMatrix:!1,statusFields:[],parseArg:jest.fn(function(t,e,n,r,o){return o}),setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),notation:{notationKey:jest.fn()}},r=0,setupIntervalsBlocks(t)}),it("registers interval blocks",function(){expect(Object.keys(n).length).toBeGreaterThan(0)}),it("IntervalNumberBlock returns interval number",function(){t.blocks.blockList.blk1={connections:[null]},expect(n.intervalnumber.arg(e,r,"blk1")).toBe(5)}),it("CurrentIntervalBlock returns current interval",function(){t.blocks.blockList.blk2={connections:[null]},expect(n.currentinterval.arg(e,r,"blk2")).toBe(7)}),it("MovableBlock sets movable do",function(){n.movable.flow([!0],e,r,"blk3"),expect(Singer.IntervalsActions.setMovableDo).toHaveBeenCalledWith(!0,r)}),it("ModeLengthBlock returns mode length",function(){t.blocks.blockList.blk4={connections:[null]},expect(n.modelength.arg(e,r,"blk4")).toBe(7)}),it("KeyBlock returns current key",function(){t.blocks.blockList.blk5={connections:[null]},expect(n.key.arg(e,r,"blk5")).toBe("C")})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var o,l=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),l.push.apply(l,o)),l}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var l=t[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../MediaBlocks"),setupMediaBlocks=_require.setupMediaBlocks,createdBlocks={},DummyFlowBlock=(()=>_createClass(function e(t,o){_classCallCheck(this,e),this.name=t,this.displayName=o||t,createdBlocks[t]=this},[{key:"setPalette",value:function(e,t){return this}},{key:"beginnerBlock",value:function(e){return this}},{key:"setHelpString",value:function(e){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}},{key:"flow",value:function(){}}]))(),DummyValueBlock=(()=>_createClass(function e(t,o){_classCallCheck(this,e),this.name=t,this.displayName=o||t,(createdBlocks[t]=this).extraWidth=0},[{key:"setPalette",value:function(e,t){return this}},{key:"beginnerBlock",value:function(e){return this}},{key:"setHelpString",value:function(e){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}},{key:"arg",value:function(e,t,o){return global.activity.blocks.blockList[o].value}}]))(),DummyLeftBlock=(()=>_createClass(function e(t,o){_classCallCheck(this,e),this.name=t,this.displayName=o||t,createdBlocks[t]=this},[{key:"setPalette",value:function(e,t){return this}},{key:"beginnerBlock",value:function(e){return this}},{key:"setHelpString",value:function(e){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}},{key:"arg",value:function(e,t,o){return global.activity.blocks.blockList[o].value}}]))(),createDummyTurtle=(global.FlowBlock=DummyFlowBlock,global.ValueBlock=DummyValueBlock,global.LeftBlock=DummyLeftBlock,global._=jest.fn(function(e){return e}),global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.toFixed2=function(e){return Number(e).toFixed(2)},global.calcOctave=function(e,t,o,l){return e+parseInt(t)},global.pitchToFrequency=function(e,t,o,l){return 440},global.doStopVideoCam=jest.fn(),global.Howl=function(e){this.urls=e.urls,this.play=jest.fn(),this.stop=jest.fn()},global.last=function(e){return e[e.length-1]},global._THIS_IS_MUSIC_BLOCKS_=!0,function(){return{id:"T1",container:{x:50,y:100,visible:!0},painter:{doClearMedia:jest.fn()},singer:{inNoteBlock:[],embeddedGraphics:{}},doWait:jest.fn(),doTurtleShell:jest.fn()}}),dummyActivity={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}},turtles:{turtleObjs:{},getTurtle:function(e){return this.turtleObjs[e]||(this.turtleObjs[e]=createDummyTurtle()),this.turtleObjs[e]},ithTurtle:function(e){return this.getTurtle(e)},_canvas:{width:800,height:600},scale:1}},dummyLogo={sounds:[],boxes:{},statusFields:[],parseArg:jest.fn(function(e,t,o,l,n){return n}),processShow:jest.fn(),processSpeak:jest.fn(),meSpeak:{},setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),cameraID:null};describe("setupMediaBlocks",function(){var t,o,l;beforeEach(function(){createdBlocks={},DummyFlowBlock.createdBlocks={},DummyValueBlock.createdBlocks={},DummyLeftBlock.createdBlocks={},dummyActivity.errorMsg.mockClear(),dummyActivity.blocks.blockList={},dummyActivity.turtles.turtleObjs={},t=dummyActivity,global.activity=t,o=_objectSpread({},dummyLogo),l=0,setupMediaBlocks(t)}),describe("RightPosBlock",function(){it("should return right position based on canvas width",function(){var e=createdBlocks.rightpos;expect(e.updateParameter()).toEqual(toFixed2(400)),expect(e.arg()).toEqual(400)})}),describe("LeftPosBlock",function(){it("should return left position (negative)",function(){var e=createdBlocks.leftpos;expect(e.updateParameter()).toEqual(toFixed2(-400)),expect(e.arg()).toEqual(-400)})}),describe("TopPosBlock",function(){it("should return top position based on canvas height",function(){var e=createdBlocks.toppos;expect(e.updateParameter()).toEqual(toFixed2(300)),expect(e.arg()).toEqual(300)})}),describe("BottomPosBlock",function(){it("should return bottom position (negative)",function(){var e=createdBlocks.bottompos;expect(e.updateParameter()).toEqual(toFixed2(-300)),expect(e.arg()).toEqual(-300)})}),describe("WidthBlock",function(){it("should return canvas width",function(){var e=createdBlocks.width;expect(e.updateParameter()).toEqual(toFixed2(800)),expect(e.arg()).toEqual(800)})}),describe("HeightBlock",function(){it("should return canvas height",function(){var e=createdBlocks.height;expect(e.updateParameter()).toEqual(toFixed2(600)),expect(e.arg()).toEqual(600)})}),describe("StopPlaybackBlock",function(){it("should stop all sounds and clear logo.sounds",function(){var e={stop:jest.fn()},t={stop:jest.fn()};o.sounds=[e,t],createdBlocks.stopplayback.flow([],o),expect(e.stop).toHaveBeenCalled(),expect(t.stop).toHaveBeenCalled(),expect(o.sounds.length).toEqual(0)})}),describe("ClearMediaBlock",function(){it("should clear media by calling doClearMedia on turtle's painter",function(){var e=t.turtles.ithTurtle(l);e.painter.doClearMedia=jest.fn(),createdBlocks.erasemedia.flow([],o,l),expect(e.painter.doClearMedia).toHaveBeenCalled()})}),describe("PlaybackBlock",function(){it("should call errorMsg if input is null",function(){t.blocks.blockList[300]={connections:[null,null]},createdBlocks.playback.flow([null],o,l,300),expect(t.errorMsg).toHaveBeenCalledWith("No input provided",300)}),it("should create a Howl, push it to logo.sounds and play it",function(){t.blocks.blockList[300]={connections:[null,null],value:"audio.mp3"};var e=createdBlocks.playback;o.sounds=[],e.flow(["audio.mp3"],o,l,300),expect(o.sounds.length).toBeGreaterThan(0),expect(o.sounds[0].play).toHaveBeenCalled()})}),describe("SpeakBlock",function(){it("should call processSpeak if meSpeak is not null and no note block is active",function(){t.turtles.ithTurtle(l).singer.inNoteBlock=[],o.meSpeak={},o.processSpeak=jest.fn(),createdBlocks.speak.flow(["Hello world"],o,l,400),expect(o.processSpeak).toHaveBeenCalledWith("Hello world")})}),describe("CameraBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[410]={value:"cameraInput"};var e=createdBlocks.camera.arg(o,l,410);expect(e).toEqual("cameraInput")})}),describe("VideoBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[420]={value:"videoInput"};var e=createdBlocks.video.arg(o,l,420);expect(e).toEqual("videoInput")})}),describe("LoadFileBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[430]={value:"fileInput"};var e=createdBlocks.loadFile.arg(o,l,430);expect(e).toEqual("fileInput")})}),describe("StopVideoCamBlock",function(){it("should call doStopVideoCam if logo.cameraID is not null",function(){o.cameraID="cam1",o.setCameraID=jest.fn(),createdBlocks.stopvideocam.flow([],o),expect(doStopVideoCam).toHaveBeenCalledWith("cam1",o.setCameraID)})}),describe("ToneBlock",function(){it("should return undefined on flow",function(){var e=createdBlocks.tone.flow();expect(e).toBeUndefined()})}),describe("ToFrequencyBlock",function(){it("should return frequency given valid connections",function(){t.blocks.blockList[440]={connections:[null,"c1","c2"]},o.parseArg=jest.fn(function(e,t,o,l,n){return"c1"===o?"G":"c2"===o?4:void 0});var e=createdBlocks.tofrequency.arg(o,l,440,null);expect(e).toEqual(440)}),it("should call errorMsg if a connection is missing",function(){t.blocks.blockList[440]={connections:[null,null,"c2"]};createdBlocks.tofrequency.arg(o,l,440,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",440)})}),describe("TurtleShellBlock",function(){it("should call doTurtleShell on the turtle if args are valid",function(){var e=t.turtles.getTurtle(l);e.doTurtleShell=jest.fn(),t.blocks.blockList[500]={connections:[null,"c1","c2"]},createdBlocks.turtleshell.flow([30,"avatar.png"],o,l,500),expect(e.doTurtleShell).toHaveBeenCalledWith(30,"avatar.png")}),it("should call errorMsg if first argument is a string",function(){t.blocks.blockList[500]={connections:[null,"c1","c2"]},createdBlocks.turtleshell.flow(["bad","avatar.png"],o,l,500),expect(t.errorMsg).toHaveBeenCalledWith("Not a number",500)})}),describe("ShowBlock",function(){it("should push block id to embeddedGraphics if in note block",function(){var e=t.turtles.getTurtle(l);e.singer.inNoteBlock=[600],e.singer.embeddedGraphics[600]=[],t.blocks.blockList[600]={value:"dummy"},createdBlocks.show.flow([20,"text"],o,l,600),expect(e.singer.embeddedGraphics[600]).toContain(600)}),it("should call processShow if not in note block",function(){t.turtles.getTurtle(l).singer.inNoteBlock=[],o.processShow=jest.fn(),createdBlocks.show.flow([20,"text"],o,l,600),expect(o.processShow).toHaveBeenCalledWith(l,600,20,"text")})}),describe("MediaBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[610]={value:"mediaInput"};var e=createdBlocks.media.arg(o,l,610);expect(e).toEqual("mediaInput")})}),describe("TextBlock",function(){it("should return its value from blockList",function(){t.blocks.blockList[620]={value:"hello world"};var e=createdBlocks.text.arg(o,l,620);expect(e).toEqual("hello world")})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}describe("MeterBlocks setup",function(){function e(){n={},global._=function(e){return e},global.NOINPUTERRORMSG="NO_INPUT",global.NOACTIONERRORMSG="NO_ACTION",global.TONEBPM=600;var t=(()=>_createClass(function e(t,o){_classCallCheck(this,e),this.name=t,this.label=o,this.lang="en",n[this.name]=this},[{key:"setPalette",value:function(e,t){this.palette=e,this.activityRef=t}},{key:"setHelpString",value:function(e){this.help=e}},{key:"formBlock",value:function(e){this.schema=e}},{key:"makeMacro",value:function(e){this.macroFactory=e}},{key:"beginnerBlock",value:function(e){this.beginnerFlag=e}},{key:"setup",value:function(e){this.setupActivity=e}},{key:"extraWidth",get:function(){return this._extraWidth},set:function(e){this._extraWidth=e}}]))();global.ValueBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})(),global.LeftBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})(),global.FlowBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})(),global.FlowClampBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,global.FlowBlock),_createClass(e)})(),l={MeterActions:{getCurrentMeter:jest.fn(function(){return"current-meter"}),getBeatFactor:jest.fn(function(){return.5}),getBPM:jest.fn(function(){return 120}),getMeasureCount:jest.fn(function(){return 3}),getBeatCount:jest.fn(function(){return 2}),getWholeNotesPlayed:jest.fn(function(){return 4}),getNotesPlayed:jest.fn(function(){return 8}),setNoClock:jest.fn(),onWeakBeatDo:jest.fn(),onStrongBeatDo:jest.fn(),onEveryBeatDo:jest.fn(),onEveryNoteDo:jest.fn(),setMasterBPM:jest.fn(),setBPM:jest.fn(),setPickup:jest.fn(),setMeter:jest.fn()},noteCounter:jest.fn(function(){return 11}),numberOfNotes:jest.fn(function(){return 12}),masterBPM:0,defaultBPMFactor:0},global.Singer=l}function r(e){return n[e]}var a,i,n,l,t=["currentmeter","beatfactor","bpmfactor","measurevalue","beatvalue","notecounter","notecounter2","elapsednotes","elapsednotes2","drift","offbeatdo","onbeatdo","everybeatdonew","everybeatdo","setmasterbpm2","setmasterbpm","setbpm3","setbpm2","setbpm","pickup","meter"];beforeEach(function(){jest.resetModules(),e(),a={beginnerMode:!1,blocks:{blockList:{}},turtles:{ithTurtle:jest.fn(function(){return{singer:{beatFactor:0,bpm:[]}}})},errorMsg:jest.fn()},i={inStatusMatrix:!1,statusFields:[],actions:{},notation:{notationTempo:jest.fn()},tempo:{BPMBlocks:[],BPMs:[]},inTempo:!1,insideMeterWidget:!1,inMusicKeyboard:!1,musicKeyboard:{},setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),parseArg:jest.fn().mockReturnValue(.25)},require("../MeterBlocks")(a)}),it("registers every meter block prototype",function(){t.forEach(function(e){expect(r(e)).toBeDefined()})}),it("returns stored values via updateParameter for parameterized blocks",function(){["currentmeter","beatfactor","bpmfactor","measurevalue","beatvalue","notecounter","notecounter2","elapsednotes","elapsednotes2"].forEach(function(e,t){var o=r(e);a.blocks.blockList[e]={value:t},expect(o.updateParameter({},0,e)).toBe(t)})}),it("handles status reporting and meter retrieval",function(){var e=r("currentmeter"),e=(a.blocks.blockList.current={value:"4/4",connections:["printBlock"]},a.blocks.blockList.printBlock={name:"print"},i.inStatusMatrix=!0,e.arg(i,0,"current"),expect(i.statusFields).toContainEqual(["current","currentmeter"]),i.inStatusMatrix=!1,e.arg(i,7,"current"));expect(e).toBe("current-meter"),expect(l.MeterActions.getCurrentMeter).toHaveBeenCalledWith(7)}),it("reads and writes beat factor data",function(){var e=r("beatfactor"),t={singer:{beatFactor:0}};a.turtles.ithTurtle.mockReturnValue(t),e.setter(i,.75,2),expect(t.singer.beatFactor).toBe(.75),a.blocks.blockList.beatfactor={value:99,connections:["printBlock"]},i.inStatusMatrix=!1,expect(e.arg(i,2,"beatfactor")).toBe(.5),expect(l.MeterActions.getBeatFactor).toHaveBeenCalledWith(2),i.inStatusMatrix=!0,a.blocks.blockList.printBlock={name:"print"},e.arg(i,2,"beatfactor"),expect(i.statusFields).toContainEqual(["beatfactor","beatfactor"])}),it("manages BPM factor stack",function(){var e=r("bpmfactor"),t={singer:{bpm:[60]}};a.turtles.ithTurtle.mockReturnValue(t),e.setter(i,120,0),expect(t.singer.bpm).toEqual([120]),t.singer.bpm=[],e.setter(i,90,0),expect(t.singer.bpm).toEqual([90]),a.blocks.blockList.bpmfactor={value:1,connections:["printBlock"]},i.inStatusMatrix=!1,expect(e.arg(i,0,"bpmfactor")).toBe(120),expect(l.MeterActions.getBPM).toHaveBeenCalledWith(0)}),it("reports measure and beat values through status matrix",function(){var e=r("measurevalue"),t=r("beatvalue");a.blocks.blockList.measureBlk={value:1,connections:["printBlock"]},a.blocks.blockList.beatBlk={value:1,connections:["printBlock"]},a.blocks.blockList.printBlock={name:"print"},i.inStatusMatrix=!0,e.arg(i,1,"measureBlk"),t.arg(i,1,"beatBlk"),expect(i.statusFields).toEqual([["measureBlk","measurevalue"],["beatBlk","beatvalue"]]),i.inStatusMatrix=!1,expect(e.arg(i,1,"measureBlk")).toBe(3),expect(t.arg(i,1,"beatBlk")).toBe(2)}),it("counts notes and guards against missing inputs",function(){var e=r("notecounter"),t=r("notecounter2"),o=(a.blocks.blockList.nc={connections:[null,null],value:0},a.blocks.blockList.nc2={connections:[null,"child"],value:0},a.blocks.blockList.child={},e.arg(i,1,"nc"));expect(o).toBe(0),expect(a.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,"nc"),t.arg(i,1,"nc2"),expect(l.numberOfNotes).toHaveBeenCalledWith(i,1,"child"),e.arg(i,1,"nc2"),expect(l.noteCounter).toHaveBeenCalledWith(i,1,"child")}),it("reports elapsed notes and beats with optional parsing",function(){var e=r("elapsednotes"),t=r("elapsednotes2"),e=(a.blocks.blockList.elapsed={value:0,connections:["printBlock"]},a.blocks.blockList.elapsed2={value:0,connections:["printBlock","child"]},a.blocks.blockList.child={},a.blocks.blockList.printBlock={name:"print"},i.inStatusMatrix=!0,e.arg(i,0,"elapsed"),t.arg(i,0,"elapsed2"),expect(i.statusFields).toContainEqual(["elapsed","elapsednotes"]),expect(i.statusFields).toContainEqual(["elapsed2","elapsednotes2"]),i.inStatusMatrix=!1,i.parseArg.mockReturnValue(.5),t.arg(i,0,"elapsed2",.25));expect(e).toBe(8),expect(i.parseArg).toHaveBeenCalled(),expect(l.MeterActions.getNotesPlayed).toHaveBeenCalledWith(.5,0)}),it("handles drift and beat-trigger flow blocks",function(){var e=r("drift"),e=(e.flow([],i,0,"drift"),expect(l.MeterActions.setNoClock).not.toHaveBeenCalled(),e.flow(["next"],i,0,"drift")),e=(expect(l.MeterActions.setNoClock).toHaveBeenCalledWith(0,"drift"),expect(e).toEqual(["next",1]),r("offbeatdo")),t=r("onbeatdo"),o=r("everybeatdonew"),n=r("everybeatdo");i.actions={action:jest.fn(),clap:jest.fn()},e.flow(["missing"],i,0,"off"),expect(a.errorMsg).toHaveBeenCalledWith(NOACTIONERRORMSG,"off",void 0),e.flow(["action"],i,0,"off",null,null,!0),expect(l.MeterActions.onWeakBeatDo).toHaveBeenCalledWith("action",!0,null,0,"off"),t.flow([1,"clap"],i,0,"on",void 0,void 0,!1),expect(l.MeterActions.onStrongBeatDo).toHaveBeenCalledWith(1,"clap",!1,void 0,0,"on"),o.flow(["action"],i,0,"every",void 0,void 0,!0),expect(l.MeterActions.onEveryBeatDo).toHaveBeenCalledWith("action",!0,void 0,0,"every"),n.flow(["action"],i,0,"everyNote",void 0,void 0,!1),expect(l.MeterActions.onEveryNoteDo).toHaveBeenCalledWith("action",!1,void 0,0,"everyNote")}),it("configures master BPM with shared tempo metadata",function(){var e=r("setmasterbpm2");a.blocks.blockList.master={connections:[null,"bpmText"]},a.blocks.blockList.bpmText={text:{text:"90"}},i.inTempo=!0,e.flow([120,.5],i,0,"master"),expect(l.MeterActions.setMasterBPM).toHaveBeenCalledWith(120,.5,"master"),expect(i.notation.notationTempo).toHaveBeenCalledWith(0,120,.5),expect(i.tempo.BPMBlocks).toContain("master"),expect(i.tempo.BPMs).toContain("90")}),it("clamps legacy master BPM values and records tempo entries",function(){var e=r("setmasterbpm");a.blocks.blockList.legacy={connections:[null,"legacyText"]},a.blocks.blockList.legacyText={text:{text:"legacy"}},i.inTempo=!0,e.flow([20],i,0,"legacy"),expect(a.errorMsg).toHaveBeenCalledWith("Beats per minute must be > 30.","legacy"),expect(l.masterBPM).toBe(30),e.flow([1500],i,0,"legacy"),expect(a.errorMsg).toHaveBeenCalledWith("Maximum beats per minute is 1000.","legacy"),expect(l.masterBPM).toBe(1e3),e.flow([120],i,0,"legacy"),expect(l.masterBPM).toBe(120),expect(l.defaultBPMFactor).toBe(TONEBPM/120),expect(i.tempo.BPMBlocks).toContain("legacy"),expect(i.tempo.BPMs).toContain("legacy")}),it("sets per-turtle BPM values and tempo metadata",function(){var e=r("setbpm3");a.blocks.blockList.bpm3={connections:[null,"text"]},a.blocks.blockList.text={text:{text:"text"}},i.inTempo=!0,e.flow([100,.25],i,1,"bpm3"),expect(l.MeterActions.setBPM).toHaveBeenCalledWith(100,.25,1,"bpm3"),expect(i.notation.notationTempo).toHaveBeenCalledWith(1,100,.25),expect(i.tempo.BPMBlocks).toContain("bpm3"),expect(i.tempo.BPMs).toContain("text")}),it("clamps BPM ranges inside FlowClamp blocks and cleans up listeners",function(){var e=r("setbpm2"),t={singer:{bpm:[]}},n=(a.turtles.ithTurtle.mockReturnValue(t),[]),o=(i.setTurtleListener.mockImplementation(function(e,t,o){n.push(o)}),e.flow([20,.25,"next"],i,0,"flow"));expect(a.errorMsg).toHaveBeenCalledWith("Beats per minute must be > 30."),expect(t.singer.bpm).toEqual([30]),expect(o).toEqual(["next",1]),e.flow([2e3,.25,"next"],i,0,"flow"),expect(a.errorMsg).toHaveBeenCalledWith("Maximum beats per minute is 1000."),expect(t.singer.bpm[t.singer.bpm.length-1]).toBe(1e3),e.flow([120,.5,"next"],i,0,"flow"),expect(t.singer.bpm[t.singer.bpm.length-1]).toBe(240),expect(i.setDispatchBlock).toHaveBeenCalledWith("flow",0,"_bpm_0"),expect(n).toHaveLength(3),n.forEach(function(e){return e()}),expect(t.singer.bpm).toEqual([])}),it("pushes and pops BPM values with the older setbpm block",function(){var e=r("setbpm"),t={singer:{bpm:[]}},n=(a.turtles.ithTurtle.mockReturnValue(t),[]),e=(i.setTurtleListener.mockImplementation(function(e,t,o){return n.push(o)}),e.flow([20,"next"],i,0,"legacyBpm"),expect(a.errorMsg).toHaveBeenCalledWith("Beats per minute must be > 30.","legacyBpm"),expect(t.singer.bpm).toEqual([30]),e.flow([5e3,"next"],i,0,"legacyBpm"),expect(a.errorMsg).toHaveBeenCalledWith("Maximum beats per minute is 1000.","legacyBpm"),e.flow([180,"next"],i,0,"legacyBpm"));expect(e).toEqual(["next",1]),expect(i.setDispatchBlock).toHaveBeenCalledWith("legacyBpm",0,"_bpm_0"),n.forEach(function(e){return e()}),expect(t.singer.bpm).toEqual([])}),it("validates pickup values and sets meters",function(){var e=r("pickup");e.flow(["invalid"],i,0,"pickup"),expect(a.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,"pickup"),e.flow([2],i,0,"pickup"),expect(l.MeterActions.setPickup).toHaveBeenCalledWith(2,0,a)}),it("handles meter changes with defaults and widget state",function(){var e=r("meter");i.insideMeterWidget=!0,i.inMusicKeyboard=!0,e.flow([null,null],i,1,"meterBlk"),expect(a.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,"meterBlk"),expect(i._meterBlock).toBe("meterBlk"),expect(i.musicKeyboard.meterArgs).toEqual([null,null]),expect(l.MeterActions.setMeter).toHaveBeenCalledWith(4,.25,1),e.flow([6,.125],i,1,"meterBlk"),expect(l.MeterActions.setMeter).toHaveBeenCalledWith(6,.125,1)})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../NumberBlocks"),setupNumberBlocks=_require.setupNumberBlocks,createdBlocks={},DummyFlowBlock=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n||t,createdBlocks[t]=this},[{key:"setPalette",value:function(e,t){return this}},{key:"beginnerBlock",value:function(e){return this}},{key:"setHelpString",value:function(e){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}},{key:"flow",value:function(){}}]))(),DummyValueBlock=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n||t,(createdBlocks[t]=this).extraWidth=0},[{key:"setPalette",value:function(e,t){return this}},{key:"beginnerBlock",value:function(e){return this}},{key:"setHelpString",value:function(e){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}},{key:"arg",value:function(e,t,n){return global.activity.blocks.blockList[n].value}}]))(),DummyLeftBlock=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n||t,createdBlocks[t]=this},[{key:"setPalette",value:function(e,t){return this}},{key:"beginnerBlock",value:function(e){return this}},{key:"setHelpString",value:function(e){return this}},{key:"formBlock",value:function(e){return this.config=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}},{key:"arg",value:function(e,t,n){return global.activity.blocks.blockList[n].value}}]))(),createDummyTurtle=(global.FlowBlock=DummyFlowBlock,global.ValueBlock=DummyValueBlock,global.LeftBlock=DummyLeftBlock,global._=jest.fn(function(e){return e}),global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.NOSQRTERRORMSG="No square root",global.ZERODIVIDEERRORMSG="Division by zero",global.MathUtility={doInt:function(e){return Math.floor(Number(e))},doMod:function(e,t){return Number(e)%Number(t)},doPower:function(e,t){return Math.pow(Number(e),Number(t))},doSqrt:function(e){if(Number(e)<0)throw"NoSqrtError";return Math.sqrt(Number(e))},doAbs:function(e){return Math.abs(Number(e))},doCalculateDistance:function(e,t,n,o){return Math.hypot(n-e,o-t)},doDivide:function(e,t){if(0===Number(t))throw"DivByZeroError";return Number(e)/Number(t)},doMultiply:function(e,t){return Number(e)*Number(t)},doNegate:function(e){return-Number(e)},doPlus:function(e,t){return isNaN(e)||isNaN(t)?""+e+t:Number(e)+Number(t)},doOneOf:function(e,t){return e},doRandom:function(e,t,n){return e},doMinus:function(e,t){return Number(e)-Number(t)}},global.calcOctave=function(e,t,n,o){return e+parseInt(t)},global.toFixed2=function(e){return Number(e).toFixed(2)},function(){return{id:"T1",container:{x:50,y:100,visible:!0},singer:{currentOctave:4,lastNotePlayed:"C",drumStyle:[],inNoteBlock:[],notePitches:{},noteOctaves:{},noteCents:{}},doWait:jest.fn()}}),dummyActivity={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}},turtles:{turtleObjs:{},getTurtle:function(e){return this.turtleObjs[e]||(this.turtleObjs[e]=createDummyTurtle()),this.turtleObjs[e]},ithTurtle:function(e){return this.getTurtle(e)}}},dummyLogo={inStatusMatrix:!1,stopTurtle:!1,parseArg:jest.fn(function(e,t,n,o,r){return r}),statusFields:[]};describe("setupNumberBlocks",function(){var t,n,o;beforeEach(function(){createdBlocks={},DummyFlowBlock.createdBlocks={},DummyValueBlock.createdBlocks={},DummyLeftBlock.createdBlocks={},dummyActivity.errorMsg.mockClear(),dummyActivity.blocks.blockList={},dummyActivity.turtles.turtleObjs={},t=dummyActivity,global.activity=t,n=_objectSpread({},dummyLogo),o=0,setupNumberBlocks(t)}),describe("IntBlock",function(){it("should return integer using MathUtility.doInt",function(){t.blocks.blockList[100]={connections:[null,200],value:100},n.parseArg=jest.fn(function(){return 123.45});var e=createdBlocks.int.arg(n,o,100,123.45);expect(e).toEqual(Math.floor(123.45))}),it("should call errorMsg and return 0 if connection is null",function(){t.blocks.blockList[100]={connections:[null,null]};var e=createdBlocks.int.arg(n,o,100,0);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",100),expect(e).toEqual(0)})}),describe("ModBlock",function(){it("updateParameter should return value using toFixed2",function(){t.blocks.blockList[110]={value:123.456};var e=createdBlocks.mod.updateParameter(n,o,110);expect(e).toEqual(toFixed2(123.456))}),it("should return mod value when valid",function(){t.blocks.blockList[110]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?100:"c2"===n?12:void 0});var e=createdBlocks.mod.arg(n,o,110,null);expect(e).toEqual(4)})}),describe("PowerBlock",function(){it("should return power using MathUtility.doPower",function(){t.blocks.blockList[120]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?2:"c2"===n?3:void 0});var e=createdBlocks.power.arg(n,o,120,null);expect(e).toEqual(Math.pow(2,3))}),it("should call errorMsg if a connection is missing",function(){t.blocks.blockList[120]={connections:[null,"c1",null]};createdBlocks.power.arg(n,o,120,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",120)})}),describe("SqrtBlock",function(){it("should return square root for valid input",function(){t.blocks.blockList[130]={connections:[null,"c1"],value:64},n.parseArg=jest.fn(function(){return 64});var e=createdBlocks.sqrt.arg(n,o,130,null);expect(e).toEqual(Math.sqrt(64))}),it("should call errorMsg if input is missing",function(){t.blocks.blockList[130]={connections:[null,null]};var e=createdBlocks.sqrt.arg(n,o,130,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",130),expect(e).toEqual(0)})}),describe("AbsBlock",function(){it("should return absolute value",function(){t.blocks.blockList[140]={connections:[null,"c1"]},n.parseArg=jest.fn(function(){return-123});var e=createdBlocks.abs.arg(n,o,140,null);expect(e).toEqual(Math.abs(-123))})}),describe("DistanceBlock",function(){it("should calculate distance between two points",function(){t.blocks.blockList[150]={connections:[null,"c1","c2","c3","c4"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n||"c2"===n?0:"c3"===n?3:"c4"===n?4:void 0});var e=createdBlocks.distance.arg(n,o,150,null);expect(e).toEqual(5)}),it("should call errorMsg if any connection is missing",function(){t.blocks.blockList[150]={connections:[null,"c1",null,"c3","c4"]};var e=createdBlocks.distance.arg(n,o,150,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",150),expect(e).toEqual(0)})}),describe("DivideBlock",function(){it("should perform division",function(){t.blocks.blockList[160]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?100:"c2"===n?4:void 0});var e=createdBlocks.divide.arg(n,o,160,null);expect(e).toEqual(25)}),it("should call errorMsg on division by zero",function(){t.blocks.blockList[160]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?100:"c2"===n?0:void 0});var e=createdBlocks.divide.arg(n,o,160,null);expect(t.errorMsg).toHaveBeenCalledWith("Division by zero",160),expect(e).toEqual(0)})}),describe("MultiplyBlock",function(){it("should perform multiplication",function(){t.blocks.blockList[170]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?5:"c2"===n?6:void 0});var e=createdBlocks.multiply.arg(n,o,170,null);expect(e).toEqual(30)})}),describe("NegBlock",function(){it("should return the negated value",function(){t.blocks.blockList[180]={connections:[null,"c1"]},n.parseArg=jest.fn(function(){return 7});var e=createdBlocks.neg.arg(n,o,180,null);expect(e).toEqual(-7)}),it("should call errorMsg if connection is missing",function(){t.blocks.blockList[180]={connections:[null,null]};var e=createdBlocks.neg.arg(n,o,180,null);expect(t.errorMsg).toHaveBeenCalledWith("No input provided",180),expect(e).toEqual(0)})}),describe("MinusBlock",function(){it("should subtract second value from first",function(){t.blocks.blockList[190]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?10:"c2"===n?4:void 0});var e=createdBlocks.minus.arg(n,o,190,null);expect(e).toEqual(6)})}),describe("PlusBlock",function(){it("should add two numbers",function(){t.blocks.blockList[200]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?3:"c2"===n?7:void 0});var e=createdBlocks.plus.arg(n,o,200,null);expect(e).toEqual(10)}),it("should handle numeric strings by converting them",function(){t.blocks.blockList[200]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(){return"5"});var e=createdBlocks.plus.arg(n,o,200,null);expect(e).toEqual(10)}),it("should concatenate two strings",function(){t.blocks.blockList[200]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?"Hello ":"c2"===n?"world":void 0}),global.MathUtility.doPlus=function(e,t){return isNaN(e)||isNaN(t)?""+e+t:Number(e)+Number(t)};var e=createdBlocks.plus.arg(n,o,200,null);expect(e).toEqual("Hello world")}),it("should handle mixed string and number concatenation",function(){t.blocks.blockList[200]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?"Count: ":"c2"===n?5:void 0}),global.MathUtility.doPlus=function(e,t){return isNaN(e)||isNaN(t)?""+e+t:Number(e)+Number(t)};var e=createdBlocks.plus.arg(n,o,200,null);expect(e).toEqual("Count: 5")})}),describe("OneOfBlock",function(){it("should return one of the two values",function(){t.blocks.blockList[210]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?100:"c2"===n?200:void 0});var e=createdBlocks.oneOf.arg(n,o,210,null);expect([100,200]).toContain(e)})}),describe("RandomBlock",function(){it("should return a random number (deterministic stub)",function(){t.blocks.blockList[220]={connections:[null,"c1","c2"]},n.parseArg=jest.fn(function(e,t,n,o,r){return"c1"===n?0:"c2"===n?10:void 0});var e=createdBlocks.random.arg(n,o,220,null);expect(e).toEqual(0)})}),describe("NumberBlock",function(){it("should return the block's numeric value",function(){t.blocks.blockList[230]={value:"123.45"};var e=createdBlocks.number.arg(n,o,230,null);expect(Number(e)).toEqual(123.45)})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _callSuper(t,e,o){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,o||[],_getPrototypeOf(t).constructor):e.apply(t,o))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0===o)return("string"===e?String:Number)(t);o=o.call(t,e||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../OrnamentBlocks"),setupOrnamentBlocks=_require.setupOrnamentBlocks;describe("setupOrnamentBlocks",function(){var o,r,n,e=(()=>_createClass(function t(e,o){_classCallCheck(this,t),this.name=e,this.displayName=o,n[e]=this},[{key:"setPalette",value:function(t,e){return this.palette=t,this}},{key:"beginnerBlock",value:function(t){return this.isBeginner=t,this}},{key:"setHelpString",value:function(t){return this.help=t,this}},{key:"formBlock",value:function(t){return this.blockParams=t,this}},{key:"makeMacro",value:function(t){return this.macro=t,this}},{key:"setup",value:function(t){return this}}]))(),t=(()=>{function t(){return _classCallCheck(this,t),_callSuper(this,t,arguments)}return _inherits(t,e),_createClass(t)})();beforeEach(function(){n={},global._=jest.fn(function(t){return t}),global.ValueBlock=e,global.FlowClampBlock=t,global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.last=function(t){return t[t.length-1]},global.Singer={OrnamentActions:{doNeighbor:jest.fn(),setSlur:jest.fn(),setStaccato:jest.fn()},noteCounter:jest.fn(function(t,e,o){return o})},o={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}},turtles:{turtleObjs:{},ithTurtle:function(t){return this.turtleObjs[t]||(this.turtleObjs[t]={singer:{staccato:[],glide:[],justCounting:[]}}),this.turtleObjs[t]}}},r={inStatusMatrix:!1,statusFields:[],stopTurtle:!1,setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),notation:{notationBeginSlur:jest.fn(),notationEndSlur:jest.fn()}},setupOrnamentBlocks(o)}),describe("StaccatoFactorBlock",function(){it('should push "staccato" status when in status matrix',function(){var t="blkSF1";o.blocks.blockList[t]={connections:[10]},o.blocks.blockList[10]={name:"print"},r.inStatusMatrix=!0,n.staccatofactor.arg(r,0,t),expect(r.statusFields).toContainEqual([t,"staccato"])}),it("should return the last staccato factor if available",function(){r.inStatusMatrix=!1,o.turtles.ithTurtle(0).singer.staccato=[5,10,15];var t=n.staccatofactor.arg(r,0,"blkSF2");expect(t).toEqual(15)}),it("should return 0 if no staccato factors exist",function(){r.inStatusMatrix=!1,o.turtles.ithTurtle(0).singer.staccato=[];var t=n.staccatofactor.arg(r,0,"blkSF3");expect(t).toEqual(0)}),it("updateParameter should return the block value from activity",function(){o.blocks.blockList.blkSF4={value:42};var t=n.staccatofactor.updateParameter(r,0,"blkSF4");expect(t).toEqual(42)})}),describe("SlurFactorBlock",function(){it('should push "slur" status when in status matrix',function(){var t="blkSLF1";o.blocks.blockList[t]={connections:[20]},o.blocks.blockList[20]={name:"print"},r.inStatusMatrix=!0,n.slurfactor.arg(r,0,t),expect(r.statusFields).toContainEqual([t,"slur"])}),it("should return negative of the last staccato factor if available",function(){r.inStatusMatrix=!1,o.turtles.ithTurtle(0).singer.staccato=[3,6,9];var t=n.slurfactor.arg(r,0,"blkSLF2");expect(t).toEqual(-9)}),it("should return 0 if no staccato factors exist",function(){r.inStatusMatrix=!1,o.turtles.ithTurtle(0).singer.staccato=[];var t=n.slurfactor.arg(r,0,"blkSLF3");expect(t).toEqual(0)}),it("updateParameter should return the block value from activity",function(){var t="blkSLF4";o.blocks.blockList[t]={value:55};t=n.slurfactor.updateParameter(r,0,t);expect(t).toEqual(55)})}),describe("NeighborBlock",function(){it("should call doNeighbor and return expected array",function(){var t=n.neighbor.flow([2,.5,99],r,0,"blkNeighbor");expect(Singer.OrnamentActions.doNeighbor).toHaveBeenCalledWith(2,.5,0,"blkNeighbor"),expect(t).toEqual([99,1])}),it("should call errorMsg if arguments are not numbers",function(){n.neighbor.flow(["a",.5,99],r,0,"blkNeighbor"),expect(o.errorMsg).toHaveBeenCalledWith(NANERRORMSG,"blkNeighbor"),expect(r.stopTurtle).toBe(!0)})}),describe("Neighbor2Block",function(){it("should inherit flow behavior from NeighborBlock",function(){var t=n.neighbor2.flow([3,.25,88],r,0,"blkNeighbor2");expect(Singer.OrnamentActions.doNeighbor).toHaveBeenCalledWith(3,.25,0,"blkNeighbor2"),expect(t).toEqual([88,1])})}),describe("GlideBlock",function(){it("should return undefined if second argument is undefined",function(){var t=n.glide.flow([1/16],r,0,"blkGlide");expect(t).toBeUndefined()}),it("should process glide correctly with valid arguments",function(){var t=n.glide,e=o.turtles.ithTurtle(0),t=(e.singer.glide=[],t.flow([.1,8],r,0,"blkGlide"));expect(e.singer.glide).toContain(.1),expect(Singer.noteCounter).toHaveBeenCalledWith(r,0,8),expect(r.notation.notationBeginSlur).toHaveBeenCalledWith(0),expect(r.setDispatchBlock).toHaveBeenCalledWith("blkGlide",0,expect.stringMatching(/^_glide_/)),expect(r.setTurtleListener).toHaveBeenCalled(),expect(t).toEqual([8,1])}),it("should default glide argument and call errorMsg if first argument is invalid",function(){var t=n.glide.flow([null,8],r,0,"blkGlide");expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,"blkGlide"),expect(t).toEqual([8,1])})}),describe("SlurBlock",function(){it("should return undefined if second argument is undefined",function(){var t=n.slur.flow([1/16],r,0,"blkSlur");expect(t).toBeUndefined()}),it("should call setSlur with correct arguments",function(){n.slur.flow([.2,7],r,0,"blkSlur"),expect(Singer.OrnamentActions.setSlur).toHaveBeenCalledWith(.2,0,"blkSlur")}),it("should default slur argument and call errorMsg if first argument is invalid",function(){n.slur.flow([null,7],r,0,"blkSlur"),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,"blkSlur")})}),describe("StaccatoBlock",function(){it("should return undefined if second argument is undefined",function(){var t=n.staccato.flow([1/32],r,0,"blkStaccato");expect(t).toBeUndefined()}),it("should call setStaccato with correct arguments",function(){n.staccato.flow([.05,5],r,0,"blkStaccato"),expect(Singer.OrnamentActions.setStaccato).toHaveBeenCalledWith(.05,0,"blkStaccato")}),it("should default staccato argument and call errorMsg if first argument is invalid",function(){n.staccato.flow([null,5],r,0,"blkStaccato"),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,"blkStaccato")})}),describe("NewSlurBlock",function(){it("should not be hidden and behave like SlurBlock",function(){var t=n.newslur;expect(t.hidden).toBe(!1),t.flow([.15,10],r,0,"blkNewSlur"),expect(Singer.OrnamentActions.setSlur).toHaveBeenCalledWith(.15,0,"blkNewSlur")})}),describe("NewStaccatoBlock",function(){it("should not be hidden and behave like StaccatoBlock",function(){var t=n.newstaccato;expect(t.hidden).toBe(!1),t.flow([.08,12],r,0,"blkNewStaccato"),expect(Singer.OrnamentActions.setStaccato).toHaveBeenCalledWith(.08,0,"blkNewStaccato")})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../PenBlocks"),setupPenBlocks=_require.setupPenBlocks;describe("setupPenBlocks",function(){var l,s,e,r;beforeEach(function(){jest.resetModules(),global._=function(e){return e},global.NOINPUTERRORMSG="NOINPUT",global.NANERRORMSG="NAN",global.DEFAULTFONT="sans",global.last=function(e){return e[e.length-1]},global.toFixed2=function(e){return Number(e.toFixed(2))};var o={},t=(()=>_createClass(function e(t){_classCallCheck(this,e),this.name=t,o[t]=this},[{key:"setPalette",value:function(){}},{key:"setHelpString",value:function(){}},{key:"makeMacro",value:function(){}},{key:"beginnerBlock",value:function(){}},{key:"formBlock",value:function(){}},{key:"setup",value:function(){}}]))();global.FlowBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})(),global.FlowClampBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})(),global.ValueBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})(),r={doSetColor:jest.fn(),doSetHue:jest.fn(),doSetValue:jest.fn(),doSetChroma:jest.fn(),doSetPensize:jest.fn(),doSetPenAlpha:jest.fn(),doSetFont:jest.fn(),doPenUp:jest.fn(),doPenDown:jest.fn(),doStartFill:jest.fn(),doEndFill:jest.fn(),doStartHollowLine:jest.fn(),doEndHollowLine:jest.fn(),color:10,value:20,chroma:30,stroke:4,penState:!0},e={painter:r,singer:{inNoteBlock:[],embeddedGraphics:{},suppressOutput:!1}},l={blocks:{blockList:o},turtles:{companionTurtle:function(e){return e},ithTurtle:function(){return e},getTurtle:function(){return e},setBackgroundColor:jest.fn()},errorMsg:jest.fn()},s={inStatusMatrix:!1,inMatrix:!1,statusFields:[],phraseMaker:{addRowBlock:jest.fn(),rowLabels:[],rowArgs:[]},pitchBlocks:[],setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),svgOutput:""},setupPenBlocks(l)}),test("registers pen blocks",function(){expect(Object.keys(l.blocks.blockList).length).toBeGreaterThan(25)}),test("value blocks return parameters",function(){expect(l.blocks.blockList.color.updateParameter(s,0)).toBe(10),expect(l.blocks.blockList.shade.updateParameter(s,0)).toBe(20),expect(l.blocks.blockList.grey.updateParameter(s,0)).toBe(30),expect(l.blocks.blockList.pensize.updateParameter(s,0)).toBe(4)}),test("value setters call painter",function(){l.blocks.blockList.color.setter(s,5,0),l.blocks.blockList.shade.setter(s,6,0),l.blocks.blockList.grey.setter(s,7,0),l.blocks.blockList.pensize.setter(s,8,0),expect(r.doSetColor).toHaveBeenCalled(),expect(r.doSetValue).toHaveBeenCalled(),expect(r.doSetChroma).toHaveBeenCalled(),expect(r.doSetPensize).toHaveBeenCalled()}),test("value blocks push status matrix entries",function(){s.inStatusMatrix=!0,l.blocks.blockList.print={name:"print"},["color","shade","grey","pensize"].forEach(function(e){l.blocks.blockList[e].connections=["print"],l.blocks.blockList[e].arg(s,0,e)}),expect(s.statusFields.length).toBe(4)}),test("pen up / pen down outside note block",function(){l.blocks.blockList.penup.flow([],s,0),l.blocks.blockList.pendown.flow([],s,0),expect(r.doPenUp).toHaveBeenCalled(),expect(r.doPenDown).toHaveBeenCalled()}),test("setfont accepts string",function(){l.blocks.blockList.setfont.flow(["Arial"],s,0,"setfont"),expect(r.doSetFont).toHaveBeenCalledWith("Arial")}),test("setfont errors on null",function(){l.blocks.blockList.setfont.flow([null],s,0,"setfont"),expect(l.errorMsg).toHaveBeenCalledWith("NOINPUT","setfont")}),test("numeric setters route through matrix",function(){s.inMatrix=!0,["sethue","setshade","setgrey","setpensize","settranslucency"].forEach(function(e){l.blocks.blockList[e].flow([10],s,0,e)}),expect(s.phraseMaker.addRowBlock).toHaveBeenCalled(),expect(s.phraseMaker.rowArgs.length).toBeGreaterThan(0)}),test("all setters embed into note block",function(){e.singer.inNoteBlock.push("n1"),e.singer.embeddedGraphics.n1=[],["setcolor","sethue","setshade","setgrey","setpensize","settranslucency"].forEach(function(e){l.blocks.blockList[e].flow([20],s,0,e)}),expect(e.singer.embeddedGraphics.n1.length).toBe(6)}),test("penup / pendown safely route inside note block",function(){e.singer.inNoteBlock.push("n2"),e.singer.embeddedGraphics.n2=[],l.blocks.blockList.penup.flow([],s,0),l.blocks.blockList.pendown.flow([],s,0),expect(e.singer.embeddedGraphics.n2.length).toBeGreaterThanOrEqual(0)}),test("fill start + end via listener",function(){s.setTurtleListener.mockImplementation(function(e,t,o){return n=o});var n,e=l.blocks.blockList.fill.flow([1],s,0,"fill");expect(e).toEqual([1,1]),n(),expect(r.doEndFill).toHaveBeenCalled()}),test("fill suppressOutput path",function(){e.singer.suppressOutput=!0,l.blocks.blockList.fill.flow([1],s,0,"fill"),expect(r.doStartFill).toHaveBeenCalled()}),test("fill early return when args missing",function(){l.blocks.blockList.fill.flow([],s,0),expect(!0).toBe(!0)}),test("hollowline start + end",function(){s.setTurtleListener.mockImplementation(function(e,t,o){return n=o});var n,e=l.blocks.blockList.hollowline.flow([1],s,0,"hollowline");expect(e).toEqual([1,1]),n(),expect(r.doEndHollowLine).toHaveBeenCalled()}),test("hollowline early return",function(){l.blocks.blockList.hollowline.flow([],s,0),expect(!0).toBe(!0)}),test("numeric setters error on null",function(){["sethue","setshade","setgrey","setpensize","settranslucency"].forEach(function(e){l.blocks.blockList[e].flow([null],s,0,e)}),expect(l.errorMsg).toHaveBeenCalled()}),test("numeric setters safely return on NaN",function(){["sethue","setshade","setgrey","setpensize","settranslucency"].forEach(function(e){l.blocks.blockList[e].flow([NaN],s,0,e)}),expect(!0).toBe(!0)}),test("setcolor runtime path",function(){l.blocks.blockList.setcolor.flow([42],s,0,"setcolor"),expect(r.doSetColor).toHaveBeenCalledWith(42)}),test("settranslucency runtime path",function(){l.blocks.blockList.settranslucency.flow([25],s,0,"settranslucency"),expect(r.doSetPenAlpha).toHaveBeenCalledWith(.75)}),test("fillscreen ignores wrong args and works with 3 args",function(){l.blocks.blockList.fillscreen.flow([1,2],s,0),l.blocks.blockList.fillscreen.flow([],s,0),expect(l.turtles.setBackgroundColor).not.toHaveBeenCalled(),l.blocks.blockList.fillscreen.flow([1,2,3],s,0),expect(l.turtles.setBackgroundColor).toHaveBeenCalled(),expect(s.svgOutput).toBe("")}),test("background clears svg output",function(){l.blocks.blockList.background.flow([],s,0),expect(s.svgOutput).toBe("")}),test("value block arg returns value when not in status matrix",function(){var e=l.blocks.blockList.color.arg(s,0,"color");expect(e).toBe(10)}),test("setfont safely ignores empty string",function(){l.blocks.blockList.setfont.flow([""],s,0,"setfont"),expect(l.errorMsg).not.toHaveBeenCalled()}),test("fill embeds block when inside note block with listener",function(){var n;e.singer.inNoteBlock.push("n_final"),e.singer.embeddedGraphics.n_final=[],s.setTurtleListener.mockImplementation(function(e,t,o){return n=o}),l.blocks.blockList.fill.flow([1],s,0,"fill"),n(),expect(e.singer.embeddedGraphics.n_final.length).toBeGreaterThan(0)}),test("settranslucency handles modulo > 100 branch",function(){l.blocks.blockList.settranslucency.flow([225],s,0,"settranslucency"),expect(r.doSetPenAlpha).toHaveBeenCalledWith(.77)}),test("shade arg returns value when not connected to print",function(){var e=l.blocks.blockList.shade.arg(s,0,"shade");expect(e).toBe(20)}),test("fillscreen restores painter state after background set",function(){l.blocks.blockList.fillscreen.flow([5,6,7],s,0),expect(r.doSetHue).toHaveBeenCalled(),expect(r.doSetValue).toHaveBeenCalled(),expect(r.doSetChroma).toHaveBeenCalled()}),test("setpensize runtime path sets painter size",function(){l.blocks.blockList.setpensize.flow([12],s,0,"setpensize"),expect(r.doSetPensize).toHaveBeenCalledWith(12)}),test("background can be called multiple times safely",function(){l.blocks.blockList.background.flow([],s,0),l.blocks.blockList.background.flow([],s,0),expect(s.svgOutput).toBe("")})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../PitchBlocks"),setupPitchBlocks=_require.setupPitchBlocks;describe("setupPitchBlocks",function(){var i,l,r,c,t=(()=>_createClass(function e(t,o){_classCallCheck(this,e),this.name=t,this.displayName=o,(r[t]=this).connections=[null,null,null,null,null],this.value=null},[{key:"setPalette",value:function(){return this}},{key:"beginnerBlock",value:function(){return this}},{key:"setHelpString",value:function(){return this}},{key:"formBlock",value:function(){return this}},{key:"setup",value:function(){return this}},{key:"makeMacro",value:function(){return this}},{key:"flow",value:function(){return this}}]))(),e=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e,[{key:"updateParameter",value:function(e,t,o){return i.blocks.blockList[o].value}},{key:"arg",value:function(){return null}},{key:"setter",value:function(){}}])})(),n=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e,[{key:"flow",value:function(){return this}}])})(),a=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e,[{key:"flow",value:function(){return this}}])})(),s=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})();beforeEach(function(){r={},jest.clearAllMocks(),global._=jest.fn(function(e){return e}),global.ValueBlock=e,global.FlowBlock=n,global.FlowClampBlock=a,global.LeftBlock=s,global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.INVALIDPITCH="Invalid pitch",global.last=jest.fn(function(e){return e[e.length-1]}),global.SHARP="#",global.FLAT="b",global.DOUBLEFLAT="bb",global.DOUBLESHARP="##",global.NATURAL="n",global.FIXEDSOLFEGE={do:"C",re:"D",mi:"E",fa:"F",sol:"G",la:"A",si:"B"},global.SOLFEGENAMES1=["do","re","mi","fa","sol","la","si","do#","dob","do##","dobb","do##","dobb"],global.NOTENAMES=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],global.NOTENAMES1=["C","D","E","F","G","A","B","C#","Db","D#","Eb","F#","Gb","G#","Ab","A#","Bb"],global.ALLNOTENAMES=["C","C#","Db","D","D#","Eb","E","F","F#","Gb","G","G#","Ab","A","A#","Bb","B"],global.MUSICALMODES={major:[2,2,1,2,2,2,1],minor:[2,1,2,2,1,2,2]},global.YSTAFFOCTAVEHEIGHT=70,global.YSTAFFNOTEHEIGHT=10,global.A0=27.5,global.C8=4186,global.NOTESSHARP=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],global.NOTESFLAT=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],global.NOTESTEP={C:1,D:3,E:5,F:6,G:8,A:10,B:12},global.SOLFEGECONVERSIONTABLE={C:"do",D:"re",E:"mi",F:"fa",G:"sol",A:"la",B:"si"},global.INTERVALVALUES={"major third":[0,0,1.25],"minor third":[0,0,1.2]},global.numberToPitch=jest.fn(function(e){return["C",Math.floor(e/12)]}),global.frequencyToPitch=jest.fn(function(e){return 0===e?["?",0,0]:["A",4,0]}),global.getNote=jest.fn(function(){return["C",4]}),global.pitchToNumber=jest.fn(function(e,t){return 60}),global.buildScale=jest.fn(function(){return[["C","D","E","F","G","A","B"],[]]}),global.getPitchInfo=jest.fn(function(e,t,o,n){return o}),global.keySignatureToMode=jest.fn(function(e){return"Cb"===e?["Cb","major"]:"C#"===e?["C#","major"]:"Ab"===e?["Ab","major"]:["C","major"]}),global.nthDegreeToPitch=jest.fn(function(){return"C4"}),global.calcOctave=jest.fn(function(){return 4}),global.scaleDegreeToPitchMapping=jest.fn(function(){return"C"}),global.Singer={playSynthBlock:jest.fn(),processPitch:jest.fn(),PitchActions:{consonantStepSize:jest.fn(function(){return 1}),deltaPitch:jest.fn(function(){return 0}),setPitchNumberOffset:jest.fn(),numToPitch:jest.fn(function(){return"C"}),playPitch:jest.fn(),playHertz:jest.fn(),playPitchNumber:jest.fn(),playNthModalPitch:jest.fn(),setScalarTranspose:jest.fn(),playMIDI:jest.fn(),setRegister:jest.fn(),setSemitoneTranspose:jest.fn(),setRatioTranspose:jest.fn(),stepPitch:jest.fn(),invert:jest.fn(),retrograde:jest.fn(),processPitch:jest.fn()}};var o=[0,1].map(function(e){return{name:0===e?"Yertle":"Turtle1",singer:{transposition:0,lastNotePlayed:["C4",.5],previousNotePlayed:null,pitchNumberOffset:0,keySignature:"C",movable:!0,notePitches:[["C"]],noteOctaves:[[4]],inNoteBlock:[0],currentOctave:4,instrumentNames:["piano"],invertList:[],retrogradeList:[]}}});c={ithTurtle:jest.fn(function(e){return o[e]||o[0]}),companionTurtle:jest.fn(function(e){return e}),getTurtleCount:jest.fn(function(){return 2}),getTurtle:jest.fn(function(t){return"number"==typeof t?o[t]||o[0]:o.find(function(e){return e.name===t.toString()})||o[0]})},i={errorMsg:jest.fn(),blocks:{blockList:{10:{name:"test",connections:[null,null,null,null,null],value:null,privateData:{}},20:{name:"test2",connections:[null,null,null,null,null],value:null},30:{name:"test3",connections:[null,null,null,null,null],value:null}}},turtles:c,beginnerMode:!1},l={parseArg:jest.fn(function(e,t,o,n,l){return void 0!==l?l:i.blocks.blockList[o]?i.blocks.blockList[o].value:void 0}),synth:{_getFrequency:jest.fn(function(){return 440}),changeInTemperament:0,inTemperament:"equal"},inStatusMatrix:!1,statusFields:[],stopTurtle:!1,doBreak:jest.fn(),setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),pitchBlocks:[],inMatrix:!1,inLegoWidget:!1,inPitchStaircase:!1,inPitchSlider:!1,phraseMaker:{addRowBlock:jest.fn(),rowLabels:[],rowArgs:[]},legoWidget:{addRowBlock:jest.fn(),rowLabels:[],rowArgs:[]},pitchStaircase:{Stairs:[],stairPitchBlocks:[]},pitchSlider:{frequencies:[]}},setupPitchBlocks(i),r.customNote||new e("customNote","customNote"),r.invert1||new a("invert1"),r.invert2||new a("invert2"),r.retrograde1||new t("retrograde1"),r.retrograde2||new t("retrograde2"),r.midi||new n("midi")}),it("setupPitchBlocks initializes blocks",function(){expect(r.rest).toBeDefined()}),describe("Synth Blocks",function(){["square","triangle","sine","sawtooth"].forEach(function(t){it("".concat(t," block flow calls Singer.playSynthBlock"),function(){var e=r[t];e&&(e.flow([440],l,0,10),expect(global.Singer.playSynthBlock).toHaveBeenCalled(),e.updateParameter)&&e.updateParameter(l,0,10)})})}),describe("RegisterBlock",function(){it("flow",function(){var e=r.register;e.flow([0],l,0,10),expect(global.Singer.PitchActions.setRegister).toHaveBeenCalled(),e.flow([null],l,0,10),expect(global.Singer.PitchActions.setRegister).toHaveBeenCalledTimes(1)})}),describe("CustomNoteBlock",function(){it("flow",function(){var e=r.customNote;e.flow(["C",4],l,0,10),e.flow([null,null],l,0,10)})}),describe("Invert Blocks",function(){it("Invert2Block listener coverage",function(){var n,e=r.invert2;e instanceof a||(l.setTurtleListener.mockImplementation(function(e,t,o){n=o}),c.ithTurtle(0).singer.invertList=[],i.blocks.blockList[10].name="invert",e.flow(["sol",4,15],l,0,10),expect(l.setTurtleListener).toHaveBeenCalled(),n&&(n(),expect(c.ithTurtle(0).singer.invertList).toHaveLength(0)))})}),describe("TranspositionFactorBlock",function(){it("arg and updateParameter",function(){var e=r.transpositionfactor;expect(e.arg(l,0,10)).toBe(0),i.blocks.blockList[10].value=5,expect(e.updateParameter(l,0,10)).toBe(5),l.inStatusMatrix=!0,i.blocks.blockList[10].connections[0]=20,i.blocks.blockList[20]={name:"print"},e.arg(l,0,10),expect(l.statusFields).toContainEqual([10,"transposition"])})}),describe("UpdateParameter Coverage",function(){it("ConsonantStepSize blocks",function(){var e=r.consonantstepsizedown,t=r.consonantstepsizeup;i.blocks.blockList[10].value=12,expect(e.updateParameter(l,0,10)).toBe(12),expect(t.updateParameter(l,0,10)).toBe(12),e.arg(l,0),t.arg(l,0),expect(global.Singer.PitchActions.consonantStepSize).toHaveBeenCalledTimes(2)}),it("DeltaPitchBlock updateParameter & arg",function(){var e=r.deltapitch;i.blocks.blockList[10].value=7,expect(e.updateParameter(l,0,10)).toBe(7),l.inStatusMatrix=!0,i.blocks.blockList[10].connections[0]=20,i.blocks.blockList[20]={name:"print",connections:[null]},e.arg(l,0,10),expect(l.statusFields).toContainEqual([10,"mypitch"])}),it("Generic check for all blocks updateParameter",function(){Object.values(r).forEach(function(e){if(e.updateParameter&&"function"==typeof e.updateParameter)try{e.updateParameter(l,0,10)}catch(e){}if(e.arg&&"function"==typeof e.arg)try{e.arg(l,0,10)}catch(e){}})})}),describe("Transposition Blocks",function(){it("SetRatioTranspositionBlock",function(){var e=r.setratio,t=jest.spyOn(console,"log").mockImplementation(function(){});i.blocks.blockList[10].connections[1]=20,i.blocks.blockList[20]={name:"intervalname",value:"invalid"},e.flow([0,0],l,0,10),expect(t).toHaveBeenCalled(),i.blocks.blockList[20].value="major third",e.flow([0,0],l,0,10),i.blocks.blockList[10].connections[1]=null,e.flow([0,0],l,0,10),expect(i.errorMsg).toHaveBeenCalled(),t.mockRestore()}),it("SetTranspositionBlock",function(){var e=r.settransposition;e.flow([12],l,0,10),expect(e).toBeDefined(),e.flow([null],l,0,10)}),it("SetScalarTranspositionBlock",function(){var e=r.setscalartransposition;e.flow([2],l,0,10),expect(e).toBeDefined(),e.flow([null],l,0,10)})}),describe("MIDI",function(){it("MidiBlock",function(){var e=r.midi;e&&e.flow&&(e.flow([60,100],l,0,10),e.flow([null,null],l,0,10))})}),describe("OneOfPitchBlock",function(){it("arg returns element",function(){var e=r.oneOfPitchBlock,e=(i.blocks.blockList[10].value=["C","D","E"],e.arg(l,0,10));expect(e).toBeDefined(),null!==e&&expect(["C","D","E"]).toContain(e)})}),describe("Value Blocks Success/Error",function(){it("MyPitchBlock arg / setter",function(){var e=r.mypitch;l.inStatusMatrix=!0,i.blocks.blockList[10].connections[0]=30,i.blocks.blockList[30]={name:"print",connections:[null]},e.arg(l,0,10),expect(l.statusFields).toContainEqual([10,"mypitch"]),l.inStatusMatrix=!1,c.ithTurtle(0).singer.lastNotePlayed=["C#4",.5],expect(e.arg(l,0,10)).toBeDefined(),c.ithTurtle(0).singer.lastNotePlayed=[440,.5],expect(e.arg(l,0,10)).toBeDefined(),c.ithTurtle(0).singer.lastNotePlayed=null,c.ithTurtle(0).singer.inNoteBlock=[0],c.ithTurtle(0).singer.notePitches=[[60]],c.ithTurtle(0).singer.noteOctaves=[[4]],expect(e.arg(l,0,10)).toBeDefined(),c.ithTurtle(0).singer.notePitches=[[]],expect(e.arg(l,0,10)).toBeDefined(),c.ithTurtle(0).singer.lastNotePlayed=["C4",.5],e.setter(l,60,0),expect(c.ithTurtle(0).singer.lastNotePlayed).toBeDefined()})}),describe("HertzBlock All Branches",function(){it("hertz block flow detailed",function(){var e=r.hertz;l.pitchBlocks=[],e.flow([-1],l,0,10),expect(i.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10),global.frequencyToPitch.mockReturnValue(["?",0]),e.flow([440],l,0,10),expect(i.errorMsg).toHaveBeenCalledWith(INVALIDPITCH,10),global.frequencyToPitch.mockReturnValue(["A",4]),l.stopTurtle=!1,l.inMatrix=!0,e.flow([440],l,0,10),expect(l.pitchBlocks).toContain(10),expect(l.phraseMaker.addRowBlock).toHaveBeenCalled(),l.inMatrix=!1,l.inLegoWidget=!0,e.flow([440],l,0,10),expect(l.legoWidget.addRowBlock).toHaveBeenCalled(),l.inLegoWidget=!1,l.inPitchStaircase=!0,e.flow([440],l,0,10),expect(l.pitchStaircase.Stairs).toHaveLength(1),l.inPitchStaircase=!1,l.inPitchSlider=!0,e.flow([440],l,0,10),expect(l.pitchSlider.frequencies).toContain(440),l.inPitchSlider=!1,e.flow([440],l,0,10),expect(global.Singer.PitchActions.playHertz).toHaveBeenCalled()})}),describe("SetPitchNumberOffsetBlock",function(){it("flow",function(){var e=r.setpitchnumberoffset;e.flow(["C",4],l,0,10),expect(global.Singer.PitchActions.setPitchNumberOffset).toHaveBeenCalled(),e.flow([null,null],l,0,10),expect(i.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)})}),describe("Number2PitchBlock & Octave",function(){it("arg coverage",function(){var e=r.number2pitch,t=(i.blocks.blockList[10].name="number2pitch",e.arg(l,0,10,55),expect(global.Singer.PitchActions.numToPitch).toHaveBeenCalledWith(55,"pitch",expect.anything()),e.arg(l,0,10,null),jest.spyOn(console,"error").mockImplementation(function(){})),e=(global.Singer.PitchActions.numToPitch.mockImplementation(function(){throw new Error("Generic")}),e.arg(l,0,10,55),expect(t).toHaveBeenCalled(),r.number2octave);i.blocks.blockList[20]={name:"number2octave",connections:[null,null,null,null,null]},e.arg(l,0,20,55),expect(t).toHaveBeenCalledTimes(2),t.mockRestore()})}),describe("OutputToolsBlocks Extensive",function(){it("arg all branches",function(){var t=r.outputtools;i.blocks.blockList[10].connections[1]=20,i.blocks.blockList[20]={name:"notename"},["C","C#","D"].forEach(function(e){l.parseArg.mockReturnValue(e),t.arg(l,0,10)}),i.blocks.blockList[20].name="solfege",l.parseArg.mockReturnValue("do##4"),t.arg(l,0,10),l.parseArg.mockReturnValue("dobb4"),t.arg(l,0,10),l.parseArg.mockReturnValue("re"),t.arg(l,0,10),l.parseArg.mockReturnValue("si#"),t.arg(l,0,10),l.parseArg.mockReturnValue("Db4"),t.arg(l,0,10),l.parseArg.mockReturnValue("C#4"),t.arg(l,0,10),l.parseArg.mockReturnValue("Unknown"),t.arg(l,0,10),i.blocks.blockList[20].name="pitchnumber",l.parseArg.mockReturnValue(60),t.arg(l,0,10),l.parseArg.mockReturnValue(20),t.arg(l,0,10)})}),describe("StaffYToPitch",function(){it("arg with all connection combinations",function(){var e=r.ytopitch;i.blocks.blockList[10].connections=[null,null],expect(e.arg(l,0,10)).toBe("G4"),i.blocks.blockList[20]={name:"pitch"},i.blocks.blockList[30]={value:"C"},i.blocks.blockList[10].connections=[20,null],expect(e.arg(l,0,10)).toEqual(["sol",4]),i.blocks.blockList[10].connections=[20,30],l.parseArg.mockReturnValue(0),e.arg(l,0,10),i.blocks.blockList[20].name="pitchnumber",i.blocks.blockList[10].connections=[20,null],expect(e.arg(l,0,10)).toBe(7),i.blocks.blockList[10].connections=[20,30],l.parseArg.mockReturnValue(-5e3),e.arg(l,0,10),i.blocks.blockList[20].name="print",i.blocks.blockList[10].connections=[20,null],expect(e.arg(l,0,10)).toBe("G4"),l.inStatusMatrix=!0,i.blocks.blockList[20].name="print",i.blocks.blockList[10].connections=[20,30],e.arg(l,0,10),expect(l.statusFields).toContainEqual([10,"ytopitch"])})}),describe("PitchBlock Complex Branches",function(){it("flow",function(){var t=r.pitch,e=(["1#","1b","-1","-1#","1##","1bb","2","3n"].forEach(function(e){i.blocks.blockList[10].connections[1]=20,i.blocks.blockList[20]={name:"scaledegree2",value:e},c.ithTurtle(0).singer.keySignature="C#",t.flow(["1",4],l,0,10)}),i.blocks.blockList[20].value="-15",c.ithTurtle(0).singer.keySignature="Ab",t.flow(["1",4],l,0,10),i.blocks.blockList[10].connections[1]=null,l.parseArg.mockReturnValue(5),t.flow([5,4],l,0,10),l.parseArg.mockReturnValue(.5),t.flow([.5,4],l,0,10),l.parseArg.mockReturnValue(440),t.flow([440,4],l,0,10),l.parseArg.mockReturnValue(20),t.flow([20,4],l,0,10),t.flow([["C",5],null],l,0,10),t.flow(["C#",4],l,0,10),t.flow(["C#",4],l,0,10),t.flow(["Do#",4],l,0,10),t.flow(["Reb",4],l,0,10),t.flow(["CustomPitch",4],l,0,10),t.flow([null,null],l,0,10),r.custompitch);e.flow([null,null],l,0,10),e.flow([440,1],l,0,10)})}),describe("Macro Execution",function(){it("calls makeMacro on all blocks that have it",function(){Object.values(r).forEach(function(e){e.makeMacro&&(e.makeMacro(100,100),e.makeMacro(null,null))}),expect(!0).toBe(!0)})}),describe("Existence",function(){var e=["rest","square","triangle","sine","sawtooth","transpositionfactor","consonantstepsizedown","consonantstepsizeup","deltapitch","deltapitch2","mypitch","pitchinhertz","currentpitch","setpitchnumberoffset","number2pitch","number2octave","outputtools","ytopitch","midi","register","setratio","50cents","settransposition","octave","downsixth","downthird","seventh","sixth","fifth","fourth","third","second","unison","setscalartransposition","accidentalname","accidental","flat","sharp","oneOfPitchBlock","scaledegree2","eastindiansolfege","notename","solfege","hertz","pitchnumber","scaledegree","nthmodalpitch","steppitch","custompitch","pitch2","pitch","customNote","invert1","invert2","invert","retrograde1","retrograde2","retrograde"];it("should create all expected blocks",function(){e.forEach(function(e){r[e]&&expect(r[e]).toBeDefined()})})}),describe("Comprehensive Block Coverage",function(){describe("Interval Blocks",function(){["downsixth","downthird","seventh","sixth","fifth","fourth","third","second","unison"].forEach(function(t){it("".concat(t," block flow"),function(){var e=r[t];e&&e.flow&&(e.flow([],l,0,10),expect(e).toBeDefined())})})}),describe("Accidental Blocks",function(){it("AccidentalBlock flow",function(){var e=r.accidental;e&&e.flow&&(e.flow(["#"],l,0,10),e.flow([null],l,0,10),expect(e).toBeDefined())}),it("FlatBlock flow",function(){var e=r.flat;e&&e.flow&&e.flow([],l,0,10)}),it("SharpBlock flow",function(){var e=r.sharp;e&&e.flow&&e.flow([],l,0,10)}),it("AccidentalNameBlock arg",function(){var e=r.accidentalname;e&&e.arg&&(e=e.arg(l,0,10),expect(e).toBeDefined())})}),describe("Scale and Modal Blocks",function(){it("ScaleDegreeBlock flow",function(){var e=r.scaledegree;e&&e.flow&&(e.flow([1,4],l,0,10),e.flow([null,null],l,0,10),expect(i.errorMsg).toHaveBeenCalled())}),it("ScaleDegree2Block arg",function(){var e=r.scaledegree2;e&&e.arg&&(i.blocks.blockList[10].value="1",e=e.arg(l,0,10),expect(e).toBeDefined())}),it("NthModalPitchBlock flow",function(){var e=r.nthmodalpitch;e&&e.flow&&(e.flow([1,4],l,0,10),e.flow([null,null],l,0,10),expect(i.errorMsg).toHaveBeenCalled())})}),describe("Solfege and Note Name Blocks",function(){it("SolfegeBlock arg",function(){var e=r.solfege;e&&e.arg&&(i.blocks.blockList[10].value="do",e.arg(l,0,10),expect(e).toBeDefined())}),it("EastIndianSolfegeBlock arg",function(){var e=r.eastindiansolfege;e&&e.arg&&(i.blocks.blockList[10].value="sa",e.arg(l,0,10),expect(e).toBeDefined())}),it("NoteNameBlock arg",function(){var e=r.notename;e&&e.arg&&(i.blocks.blockList[10].value="C",e.arg(l,0,10),expect(e).toBeDefined())})}),describe("Pitch Number and Conversion Blocks",function(){it("PitchNumberBlock flow",function(){var e=r.pitchnumber;e&&e.flow&&(e.flow([60],l,0,10),e.flow([null],l,0,10),expect(i.errorMsg).toHaveBeenCalled())}),it("Number2OctaveBlock arg",function(){var e=r.number2octave;e&&e.arg&&(e=e.arg(l,0,10,60),expect(e).toBeDefined())}),it("StaffYToPitch comprehensive",function(){var e,t=r.ytopitch;t&&t.arg&&(i.blocks.blockList[10].connections=[null,null],e=t.arg(l,0,10),expect(e).toBeDefined(),i.blocks.blockList[20]={name:"pitch"},i.blocks.blockList[10].connections=[20,null],e=t.arg(l,0,10),expect(e).toBeDefined(),i.blocks.blockList[20].name="pitchnumber",e=t.arg(l,0,10),expect(e).toBeDefined())})}),describe("Retrograde and Invert Blocks",function(){it("Retrograde1Block flow",function(){var e=r.retrograde1;e&&e.flow&&e.flow([],l,0,10)}),it("Retrograde2Block flow",function(){var e=r.retrograde2;e&&e.flow&&e.flow([],l,0,10)}),it("RetrogradeBlock flow",function(){var e=r.retrograde;e&&e.flow&&e.flow([],l,0,10)}),it("Invert1Block flow",function(){var e=r.invert1;e&&e.flow&&e.flow([],l,0,10)})}),describe("Special Pitch Blocks",function(){it("FiftyCentsBlock flow",function(){var e=r["50cents"];e&&e.flow&&e.flow([],l,0,10)}),it("OctaveBlock flow",function(){var e=r.octave;e&&e.flow&&(e.flow([1],l,0,10),e.flow([null],l,0,10),expect(e).toBeDefined())}),it("StepPitchBlock flow",function(){var e=r.steppitch;e&&e.flow&&(e.flow([1],l,0,10),e.flow([null],l,0,10),expect(e).toBeDefined())})}),describe("Current Pitch and Hertz Blocks",function(){it("PitchInHertzBlock comprehensive",function(){var e,t=r.pitchinhertz;t&&t.arg&&(l.inStatusMatrix=!0,i.blocks.blockList[10].connections[0]=20,i.blocks.blockList[20]={name:"print"},t.arg(l,0,10),expect(l.statusFields).toContainEqual([10,"pitchinhertz"]),l.inStatusMatrix=!1,c.ithTurtle(0).singer.lastNotePlayed=["C4",.5],e=t.arg(l,0,10),expect(e).toBeDefined(),c.ithTurtle(0).singer.lastNotePlayed=null,e=t.arg(l,0,10),expect(e).toBeUndefined())}),it("CurrentPitchBlock comprehensive",function(){var e,t=r.currentpitch;t&&t.arg&&(c.ithTurtle(0).singer.lastNotePlayed=["C4",.5],e=t.arg(l,0,10),expect(e).toBe("C4"),c.ithTurtle(0).singer.lastNotePlayed=null,e=t.arg(l,0,10),expect(e).toBe("G4"),l.inStatusMatrix=!0,i.blocks.blockList[10].connections[0]=20,i.blocks.blockList[20]={name:"outputtools"},c.ithTurtle(0).singer.lastNotePlayed=["A4",.5],e=t.arg(l,0,10),expect(e).toBe("A4"))})}),describe("OutputTools Comprehensive",function(){it("OutputToolsBlocks all branches",function(){var t=r.outputtools;t&&t.arg&&(i.blocks.blockList[10].connections[1]=20,i.blocks.blockList[20]={name:"notename"},["C","C#","D","Eb","F#","Gb"].forEach(function(e){l.parseArg.mockReturnValue(e),t.arg(l,0,10)}),i.blocks.blockList[20].name="solfege",["do","do#","dob","do##","dobb","re","mi","fa","sol","la","si"].forEach(function(e){l.parseArg.mockReturnValue(e),t.arg(l,0,10)}),i.blocks.blockList[20].name="eastindiansolfege",["sa","re","ga","ma","pa","dha","ni"].forEach(function(e){l.parseArg.mockReturnValue(e),t.arg(l,0,10)}),i.blocks.blockList[20].name="other",["C4","Db4","D#4","Eb4","F#4","Gb4","G#4","Ab4","A#4","Bb4"].forEach(function(e){l.parseArg.mockReturnValue(e),t.arg(l,0,10)}),["C#","Db","D#","Eb","F#","Gb","G#","Ab","A#","Bb"].forEach(function(e){l.parseArg.mockReturnValue(e),t.arg(l,0,10)}),l.parseArg.mockReturnValue(60),t.arg(l,0,10),l.parseArg.mockReturnValue(20),t.arg(l,0,10),l.inStatusMatrix=!0,i.blocks.blockList[10].connections[0]=30,i.blocks.blockList[30]={name:"print"},t.arg(l,0,10),expect(l.statusFields).toContainEqual([10,"outputtools"]))})}),describe("Error Handling and Edge Cases",function(){it("handles invalid inputs gracefully",function(){Object.values(r).forEach(function(e){if(e&&e.flow)try{e.flow([void 0],l,0,10),e.flow([NaN],l,0,10),e.flow([1/0],l,0,10),e.flow([-1/0],l,0,10),e.flow([""],l,0,10),e.flow([{}],l,0,10),e.flow([[]],l,0,10)}catch(e){}})}),it("handles missing connections",function(){Object.values(r).forEach(function(e){if(e&&e.arg)try{i.blocks.blockList[10].connections=[null,null,null,null,null],e.arg(l,0,10)}catch(e){}})})}),describe("Widget Integration",function(){it("handles matrix integration",function(){var e=r.pitch;e&&e.flow&&(l.inMatrix=!0,l.phraseMaker.addRowBlock=jest.fn(),e.flow(["C",4],l,0,10),expect(e).toBeDefined())}),it("handles lego widget integration",function(){var e=r.pitch;e&&e.flow&&(l.inMatrix=!1,l.inLegoWidget=!0,l.legoWidget.addRowBlock=jest.fn(),e.flow(["C",4],l,0,10),expect(e).toBeDefined())}),it("handles pitch staircase integration",function(){var e=r.pitch;e&&e.flow&&(l.inLegoWidget=!1,l.inPitchStaircase=!0,e.flow(["C",4],l,0,10))}),it("handles pitch slider integration",function(){var e=r.pitch;e&&e.flow&&(l.inPitchStaircase=!1,l.inPitchSlider=!0,e.flow(["C",4],l,0,10))})}),describe("Parameter Updates and Status",function(){it("updateParameter methods work correctly",function(){Object.values(r).forEach(function(e){e&&e.updateParameter&&(i.blocks.blockList[10].value=100*Math.random(),e=e.updateParameter(l,0,10),expect(e).toBeDefined())})}),it("status matrix integration",function(){["transpositionfactor","deltapitch","mypitch","pitchinhertz","currentpitch","outputtools","ytopitch"].forEach(function(e){e=r[e];e&&e.arg&&(l.inStatusMatrix=!0,i.blocks.blockList[10].connections[0]=20,i.blocks.blockList[20]={name:"print"},e.arg(l,0,10))})})}),describe("Setter Methods",function(){it("MyPitchBlock setter",function(){var e=r.mypitch;e&&e.setter&&(c.ithTurtle(0).singer.lastNotePlayed=["C4",.5],e.setter(l,60,0),expect(c.ithTurtle(0).singer.lastNotePlayed).toBeDefined(),expect(c.ithTurtle(0).singer.previousNotePlayed).toBeDefined())})}),describe("Complex Flow Scenarios",function(){it("nested block connections",function(){i.blocks.blockList[10].connections=[null,20,null,30],i.blocks.blockList[20]={name:"pitch",connections:[null,40],value:"C"},i.blocks.blockList[30]={name:"number",value:4},i.blocks.blockList[40]={name:"notename",value:"C"};var e=r.pitch;e&&e.flow&&e.flow(["C",4],l,0,10)}),it("multiple turtle scenarios",function(){[0,1].forEach(function(t){Object.values(r).forEach(function(e){if(e&&e.flow)try{e.flow(["C",4],l,t,10)}catch(e){}})})})})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var l=t[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _jest$requireActual=jest.requireActual("../ProgramBlocks"),setupProgramBlocks=_jest$requireActual.setupProgramBlocks,BaseBlock=(global._=function(e){return e},global.NOINPUTERRORMSG="NO_INPUT",global.XMLHttpRequest=jest.fn(),global.getTargetTurtle=jest.fn(),global.Turtle={DictActions:{setDictValue:jest.fn(),SerializeDict:jest.fn(function(){return"{}"})}},(()=>_createClass(function e(t){_classCallCheck(this,e),this.name=t,this.dockTypes=[null],this.size=1,this.lang="en",this.hidden=!1},[{key:"setPalette",value:function(e){this.palette=e}},{key:"setHelpString",value:function(e){this.help=e}},{key:"formBlock",value:function(e){this.formDefn=e}},{key:"setup",value:function(e){return e.registeredBlocks=e.registeredBlocks||{},e.registeredBlocks[this.name]=this}}]))()),FlowBlock=(()=>{function t(e){return _classCallCheck(this,t),_callSuper(this,t,[e])}return _inherits(t,BaseBlock),_createClass(t,[{key:"flow",value:function(){}}])})(),LeftBlock=(()=>{function t(e){return _classCallCheck(this,t),_callSuper(this,t,[e])}return _inherits(t,BaseBlock),_createClass(t,[{key:"arg",value:function(){}}])})();global.BaseBlock=BaseBlock,global.FlowBlock=FlowBlock,global.LeftBlock=LeftBlock,describe("ProgramBlocks",function(){function o(e){return l.registeredBlocks[e]}var l,n;beforeEach(function(){jest.clearAllMocks(),l={registeredBlocks:{},blocks:{blockList:[],palettes:{dict:{},hide:jest.fn(),show:jest.fn(),getProtoNameAndPalette:jest.fn()},moveBlock:jest.fn(),adjustDocks:jest.fn(),sendStackToTrash:jest.fn(),showBlocks:jest.fn(),loadNewBlocks:jest.fn(),protoBlockDict:{}},turtles:{turtleX2screenX:jest.fn(function(e){return e}),turtleY2screenY:jest.fn(function(e){return e}),ithTurtle:jest.fn(function(){return{doWait:jest.fn()}})},errorMsg:jest.fn(),save:{download:jest.fn()}},n={turtleHeaps:{},turtleDicts:{},runFromBlock:jest.fn(),initTurtle:jest.fn()},global.XMLHttpRequest=jest.fn().mockImplementation(function(){return{open:jest.fn(),send:jest.fn(),setRequestHeader:jest.fn(),readyState:4,status:200,responseText:'{"test": "data"}'}}),setupProgramBlocks(l)});describe("Block Registration",function(){test("registers all 15 program blocks",function(){["loadHeapFromApp","saveHeapToApp","loadHeap","setHeap","loadDict","setDictionary","saveHeap","saveDict","openpalette","deleteblock","moveblock","runblock","dockblock","makeblock","openProject"].forEach(function(e){expect(l.registeredBlocks).toHaveProperty(e)}),expect(Object.keys(l.registeredBlocks).length).toBe(15)}),test("all blocks have correct palette set",function(){Object.values(l.registeredBlocks).forEach(function(e){expect(e.palette).toBe("program")})})}),describe("LoadHeapFromAppBlock",function(){test("handles null arguments",function(){o("loadHeapFromApp").flow([null,"localhost"],n,0,1),expect(l.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,1)}),test("loads heap from successful HTTP request",function(){var e={open:jest.fn(),send:jest.fn(),readyState:4,status:200,responseText:'["item1", "item2"]'};global.XMLHttpRequest.mockImplementation(function(){return e}),o("loadHeapFromApp").flow(["testHeap","http://test.com"],n,0,1),expect(e.open).toHaveBeenCalledWith("GET","http://test.com",!1),expect(n.turtleHeaps.testHeap).toEqual(["item1","item2"])}),test("handles 404 error",function(){var e={open:jest.fn(),send:jest.fn(),readyState:4,status:404,responseText:""};global.XMLHttpRequest.mockImplementation(function(){return e}),o("loadHeapFromApp").flow(["testHeap","http://test.com"],n,0,1),expect(l.errorMsg).toHaveBeenCalledWith("404: Page not found")}),test("handles JSON parse error",function(){var e={open:jest.fn(),send:jest.fn(),readyState:4,status:200,responseText:"invalid json"};global.XMLHttpRequest.mockImplementation(function(){return e}),o("loadHeapFromApp").flow(["testHeap","http://test.com"],n,0,1),expect(l.errorMsg).toHaveBeenCalled()})}),describe("SaveHeapToAppBlock",function(){test("handles null arguments",function(){o("saveHeapToApp").flow([null,"localhost"],n,0,1),expect(l.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,1)}),test("saves heap to URL",function(){var e={open:jest.fn(),send:jest.fn(),setRequestHeader:jest.fn()};global.XMLHttpRequest.mockImplementation(function(){return e}),n.turtleHeaps.testHeap=["data1","data2"],o("saveHeapToApp").flow(["testHeap","http://test.com"],n,0,1),expect(e.open).toHaveBeenCalledWith("POST","http://test.com",!0),expect(e.setRequestHeader).toHaveBeenCalledWith("Content-Type","application/json;charset=UTF-8"),expect(e.send).toHaveBeenCalledWith('["data1","data2"]')}),test("handles missing heap",function(){o("saveHeapToApp").flow(["nonexistent","http://test.com"],n,0,1),expect(l.errorMsg).toHaveBeenCalledWith("Cannot find a valid heap for nonexistent")})}),describe("LoadHeapBlock",function(){test("loads heap from file",function(){l.blocks.blockList[10]={connections:[null,20]},l.blocks.blockList[20]={name:"loadFile",value:["filename",'["heap1", "heap2"]']},o("loadHeap").flow([[null,null]],n,0,10),expect(n.turtleHeaps[0]).toEqual(["heap1","heap2"])}),test("handles invalid JSON in file",function(){l.blocks.blockList[10]={connections:[null,20]},l.blocks.blockList[20]={name:"loadFile",value:["filename","not valid json"]},o("loadHeap").flow([[null,null]],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith("The file you selected does not contain a valid heap.")}),test("handles non-array heap data",function(){l.blocks.blockList[10]={connections:[null,20]},l.blocks.blockList[20]={name:"loadFile",value:["filename",'{"not": "array"}']},o("loadHeap").flow([[null,null]],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith("The file you selected does not contain a valid heap.")}),test("requires loadFile block",function(){l.blocks.blockList[10]={connections:[null,20]},l.blocks.blockList[20]={name:"otherBlock"},o("loadHeap").flow([[null,null]],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith("The loadHeap block needs a loadFile block.")})}),describe("SetHeapBlock",function(){test("sets heap from JSON",function(){l.blocks.blockList[10]={connections:[null,20]},l.blocks.blockList[20]={value:'["item1", "item2"]'},o("setHeap").flow([null],n,0,10),expect(n.turtleHeaps[0]).toEqual(["item1","item2"])}),test("handles invalid JSON",function(){l.blocks.blockList[10]={connections:[null,20]},l.blocks.blockList[20]={value:"invalid"},o("setHeap").flow([null],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith("The block you selected does not contain a valid heap.")}),test("requires connection",function(){l.blocks.blockList[10]={connections:[null,null]},o("setHeap").flow([null],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith("The Set heap block needs a heap.")})}),describe("SaveHeapBlock",function(){test("saves heap to file",function(){n.turtleHeaps[0]=["data1","data2"],o("saveHeap").flow(["test.json"],n,0),expect(l.save.download).toHaveBeenCalledWith("json",'data:text/json;charset-utf-8,["data1","data2"]',"test.json")}),test("handles null filename",function(){n.turtleHeaps[0]=["data"],o("saveHeap").flow([null],n,0),expect(l.save.download).not.toHaveBeenCalled()}),test("handles missing heap",function(){o("saveHeap").flow(["test.json"],n,0),expect(l.save.download).not.toHaveBeenCalled()})}),describe("LoadDictBlock",function(){test("loads dictionary from file",function(){n.turtleDicts[0]={},global.getTargetTurtle.mockReturnValue(null),l.blocks.blockList[10]={connections:[null,null,20]},l.blocks.blockList[20]={name:"loadFile",value:["filename",'{"key1": "value1"}']},o("loadDict").flow(["MyDict",[null,null]],n,0,10),expect(n.turtleDicts[0]).toHaveProperty("MyDict")}),test("handles null arguments",function(){o("loadDict").flow([null,null],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)}),test("requires loadFile block",function(){l.blocks.blockList[10]={connections:[null,null,20]},l.blocks.blockList[20]={name:"otherBlock"},o("loadDict").flow(["MyDict",[null,null]],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith("The load dictionary block needs a load file block.")}),test("handles invalid JSON",function(){n.turtleDicts[0]={},l.blocks.blockList[10]={connections:[null,null,20]},l.blocks.blockList[20]={name:"loadFile",value:["filename","invalid json"]},o("loadDict").flow(["MyDict",[null,null]],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith("The file you selected does not contain a valid dictionary.")})}),describe("SetDictBlock",function(){test("sets dictionary from JSON",function(){n.turtleDicts[0]={},global.getTargetTurtle.mockReturnValue(null),l.blocks.blockList[10]={connections:[null,null,20]},l.blocks.blockList[20]={value:'{"key1": "value1"}'},o("setDictionary").flow(["MyDict",{}],n,0,10),expect(n.turtleDicts[0]).toHaveProperty("MyDict")}),test("handles null arguments",function(){o("setDictionary").flow([null,null],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)}),test("handles invalid JSON",function(){n.turtleDicts[0]={},l.blocks.blockList[10]={connections:[null,null,20]},l.blocks.blockList[20]={value:"invalid"},o("setDictionary").flow(["MyDict",{}],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith("The block you selected does not contain a valid dictionary.")})}),describe("SaveDictBlock",function(){test("saves dictionary to file",function(){n.turtleDicts[0]={MyDict:{key:"value"}},global.getTargetTurtle.mockReturnValue(null),o("saveDict").flow(["MyDict","dict.json"],n,0,10),expect(l.save.download).toHaveBeenCalledWith("json",'data:text/json;charset-utf-8,{"key":"value"}',"dict.json")}),test("handles null arguments",function(){o("saveDict").flow([null,null],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)}),test("saves turtle dictionary",function(){n.turtleDicts[0]={},global.getTargetTurtle.mockReturnValue(5),global.Turtle.DictActions.SerializeDict.mockReturnValue('{"turtle":"dict"}'),o("saveDict").flow(["TurtleDict","dict.json"],n,0,10),expect(l.save.download).toHaveBeenCalledWith("json",'data:text/json;charset-utf-8,{"turtle":"dict"}',"dict.json")})}),describe("OpenPaletteBlock",function(){test("opens specified palette",function(){l.blocks.palettes.dict={rhythm:{name:"rhythm",show:jest.fn()}},o("openpalette").flow(["rhythm"],n,0,10),expect(l.blocks.palettes.hide).toHaveBeenCalled(),expect(l.blocks.palettes.dict.rhythm.show).toHaveBeenCalled(),expect(l.blocks.palettes.show).toHaveBeenCalled()}),test("handles missing arguments",function(){o("openpalette").flow([],n,0,10),expect(l.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)})}),describe("DeleteBlock",function(){test("deletes a block and sends to trash",function(){var e=o("deleteblock");l.blocks.blockList=[{connections:[10],trash:!1}],l.blocks.blockList[10]={connections:[0]},e.flow([0],n,0,5),expect(l.blocks.sendStackToTrash).toHaveBeenCalledWith(l.blocks.blockList[0]),expect(l.blocks.adjustDocks).toHaveBeenCalled()}),test("handles invalid block number",function(){var e=o("deleteblock");l.blocks.blockList=[],e.flow([0],n,0,5),expect(l.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,5)}),test("ignores if already in trash",function(){var e=o("deleteblock");l.blocks.blockList=[{trash:!0}],e.flow([0],n,0,5),expect(l.blocks.sendStackToTrash).not.toHaveBeenCalled()})}),describe("MoveBlock",function(){test("moves block to new coordinates",function(){var e=o("moveblock");l.blocks.blockList=[{}],e.flow([0,100,200],n,0,5),expect(l.turtles.turtleX2screenX).toHaveBeenCalledWith(100),expect(l.turtles.turtleY2screenY).toHaveBeenCalledWith(200),expect(l.blocks.moveBlock).toHaveBeenCalledWith(0,100,200)}),test("handles invalid args",function(){o("moveblock").flow([],n,0,5),expect(l.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,5)})}),describe("RunBlock",function(){test("runs block by ID",function(){var e=o("runblock");l.blocks.blockList=[{name:"start",value:0}],e.flow([0],n,0,5),expect(n.initTurtle).toHaveBeenCalledWith(0),expect(n.runFromBlock).toHaveBeenCalled()}),test("resolves block name to ID",function(){var e=o("runblock"),t=(l.blocks.blockList=[{name:"something",protoblock:{staticLabels:["myBlock"]}}],["myBlock"]);e.flow(t,n,0,5),expect(t[0]).toBe(0)})}),describe("DockBlock",function(){test("connects two blocks",function(){var e=o("dockblock");l.blocks.blockList=[{connections:[null,null]},{connections:[null]},{connections:[null]}],e.flow([0,1,2],n,0,5),expect(l.blocks.blockList[0].connections[1]).toBe(2),expect(l.blocks.blockList[2].connections[0]).toBe(0),expect(l.blocks.adjustDocks).toHaveBeenCalledWith(0,!0)}),test("handles connection to -1 (last)",function(){var e=o("dockblock");l.blocks.blockList=[{connections:[null,null,null]},{},{connections:[null]}],e.flow([0,-1,2],n,0,5),expect(l.blocks.blockList[0].connections[2]).toBe(2)}),test("errors on invalid input",function(){o("dockblock").flow([],n,0,5),expect(l.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,5)})}),describe("MakeBlock",function(){test("creates new note block",function(){var e=o("makeblock"),e=(l.blocks.blockList=[{connections:[null,10],argClampSlots:[]},{connections:[null]},{connections:[null]}],n.parseArg=jest.fn().mockReturnValueOnce("note").mockReturnValue("sol"),l.blocks.palettes.getProtoNameAndPalette.mockReturnValue([null,null,null]),e.arg(n,0,0,null));expect(l.blocks.loadNewBlocks).toHaveBeenCalled(),expect(e).toBe(l.blocks.blockList.length)})}),describe("OpenProjectBlock",function(){var e,t;beforeAll(function(){e=window.open,t=window.alert}),afterAll(function(){window.open=e,window.alert=t}),test("opens valid URL",function(){var e=o("openProject"),t={focus:jest.fn()};delete window.open,window.open=jest.fn(function(){return t}),e.flow(["http://example.com"],n,0,5),expect(window.open).toHaveBeenCalledWith("http://example.com","_blank"),expect(t.focus).toHaveBeenCalled()}),test("validates URL",function(){var e=o("openProject");delete window.open,window.open=jest.fn(),delete window.alert,window.alert=jest.fn(),e.flow(["invalid-url"],n,0,5),expect(window.open).not.toHaveBeenCalled(),expect(l.errorMsg).toHaveBeenCalled()})}),describe("Block Properties",function(){test("LoadHeapFromAppBlock has correct form",function(){var e=o("loadHeapFromApp");expect(e.formDefn.args).toBe(2),expect(e.formDefn.argTypes).toEqual(["textin","textin"]),expect(e.formDefn.defaults).toEqual(["appName","localhost"])}),test("SaveHeapBlock has correct form",function(){var e=o("saveHeap");expect(e.formDefn.args).toBe(1),expect(e.formDefn.argTypes).toEqual(["textin"]),expect(e.formDefn.defaults).toEqual(["heap.json"])}),test("LoadDictBlock has correct form with labels",function(){var e=o("loadDict");expect(e.formDefn.args).toBe(2),expect(e.formDefn.argLabels).toEqual(["name","file"])}),test("MakeBlock has correct form",function(){var e=o("makeblock");expect(e.formDefn.outType).toBe("numberout")})})});
function ownKeys(t,e){var o,r=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}global._=jest.fn(function(e){return e}),global._THIS_IS_TURTLE_BLOCKS_=!1,global.DEFAULTDRUM="drum";var _require=require("../RhythmBlockPaletteBlocks"),setupRhythmBlockPaletteBlocks=_require.setupRhythmBlockPaletteBlocks,DummyFlowBlock=(()=>{function o(e,t){_classCallCheck(this,o),this.name=e,this.displayName=t,o.createdBlocks[e]=this}return _createClass(o,[{key:"setPalette",value:function(e,t){return this.palette=e,this}},{key:"beginnerBlock",value:function(e){return this.isBeginner=e,this}},{key:"setHelpString",value:function(e){return this.help=e,this}},{key:"formBlock",value:function(e){return this.blockParams=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}}])})(),DummyFlowClampBlock=(DummyFlowBlock.createdBlocks={},(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,DummyFlowBlock),_createClass(e)})()),DummyLeftBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,DummyFlowBlock),_createClass(e)})();function createDummyTurtle(){return{id:"T1",container:{x:50,y:100,visible:!0},singer:{beatFactor:1,bpm:[100],drumStyle:[],inNoteBlock:[],notePitches:{},noteOctaves:{},noteCents:{}},doWait:jest.fn()}}global.FlowBlock=DummyFlowBlock,global.FlowClampBlock=DummyFlowClampBlock,global.LeftBlock=DummyLeftBlock,global.last=function(e){return e[e.length-1]},global.NOINPUTERRORMSG="No input provided",global.TONEBPM=120,global._THIS_IS_MUSIC_BLOCKS_=!0,global.rhythmBlockPalette="widgets",global.localStorage={languagePreference:"en"},global.Singer={processNote:jest.fn(function(e,t,o,r,l,n){n&&n()}),masterBPM:100,bpm:[100]},global.isAppleBrowser=jest.fn(function(){return!1});var dummyActivity={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}},refreshCanvas:jest.fn(),turtles:{turtleObjs:{},getTurtle:function(e){return this.turtleObjs[e]||(this.turtleObjs[e]=createDummyTurtle()),this.turtleObjs[e]},ithTurtle:function(e){return this.getTurtle(e)}}},dummyLogo={inMatrix:!1,tuplet:!1,tupletParams:[],tupletRhythms:[],phraseMaker:{addColBlock:jest.fn()},clearNoteParams:jest.fn(),clearTurtleRun:jest.fn(),setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),addingNotesToTuplet:!1,_currentDrumBlock:"dummyDrum"};describe("setupRhythmBlockPaletteBlocks",function(){var o,r,l;beforeEach(function(){DummyFlowBlock.createdBlocks={},dummyActivity.errorMsg.mockClear(),dummyActivity.textMsg.mockClear(),dummyActivity.blocks.blockList={},dummyActivity.turtles.turtleObjs={},o=dummyActivity,r=_objectSpread({},dummyLogo),l=0,setupRhythmBlockPaletteBlocks(o)}),describe("RhythmBlock",function(){it("should call errorMsg and use defaults if arguments are invalid",function(){var e=DummyFlowBlock.createdBlocks.rhythm;o.blocks.blockList.blkRhythm={name:"rhythm",connections:[]},e.flow([null,null],r,l,"blkRhythm"),expect(o.errorMsg).toHaveBeenCalledWith("No input provided","blkRhythm")}),it("should process rhythm in matrix mode",function(){var e=DummyFlowBlock.createdBlocks.rhythm;r.inMatrix=!0,o.blocks.blockList.blkRhythm={name:"rhythm",connections:[]},r.phraseMaker.addColBlock=jest.fn(),e.flow([4,.25],r,l,"blkRhythm"),expect(r.phraseMaker.addColBlock).toHaveBeenCalledWith("blkRhythm",4),expect(Singer.processNote).toHaveBeenCalledTimes(4)})}),describe("Rhythm2Block",function(){it("should have extraWidth of 10 and be hidden",function(){var e=DummyFlowBlock.createdBlocks.rhythm2;expect(e.extraWidth).toEqual(10),expect(e.hidden).toBe(!0)})}),describe("SixtyFourthNoteBlock",function(){it("should be defined and have displayName containing '1/64 note'",function(){var e=DummyFlowBlock.createdBlocks.sixtyfourthNote;expect(e).toBeDefined(),expect(e.displayName).toContain("1/64 note")})}),describe("ThirtySecondNoteBlock",function(){it("should be defined and have a macro function",function(){var e=DummyFlowBlock.createdBlocks.thirtysecondNote;expect(e).toBeDefined(),expect(_typeof(e.macro)).toEqual("function")})}),describe("SixteenthNoteBlock",function(){it("should be defined",function(){var e=DummyFlowBlock.createdBlocks.sixteenthNote;expect(e).toBeDefined()})}),describe("EighthNoteBlock",function(){it("should be defined",function(){var e=DummyFlowBlock.createdBlocks.eighthNote;expect(e).toBeDefined()})}),describe("QuarterNoteBlock",function(){it("should be defined",function(){var e=DummyFlowBlock.createdBlocks.quarterNote;expect(e).toBeDefined()})}),describe("HalfNoteBlock",function(){it("should be defined",function(){var e=DummyFlowBlock.createdBlocks.halfNote;expect(e).toBeDefined()})}),describe("WholeNoteBlock",function(){it("should be defined",function(){var e=DummyFlowBlock.createdBlocks.wholeNote;expect(e).toBeDefined()})}),describe("Tuplet2Block",function(){it("should push tuplet parameters and set dispatch in matrix mode",function(){r.inMatrix=!0;o.turtles.ithTurtle(l).singer.beatFactor=1,o.blocks.blockList.blkTuplet2={name:"tuplet2"};var e=DummyFlowBlock.createdBlocks.tuplet2,e=(r.tupletParams=[],e.flow([3,4,99],r,l,"blkTuplet2"));expect(r.tupletParams.length).toEqual(1),expect(e).toEqual([99,1]),expect(r.setDispatchBlock).toHaveBeenCalled(),expect(r.setTurtleListener).toHaveBeenCalled()})}),describe("Tuplet3Block",function(){it("should behave like Tuplet2Block and be hidden",function(){r.inMatrix=!0;o.turtles.ithTurtle(l).singer.beatFactor=1,o.blocks.blockList.blkTuplet3={name:"tuplet3"};var e=DummyFlowBlock.createdBlocks.tuplet3,t=(r.tupletParams=[],e.flow([2,8,77],r,l,"blkTuplet3"));expect(r.tupletParams.length).toEqual(1),expect(t).toEqual([77,1]),expect(e.hidden).toBe(!0)})}),describe("Tuplet4Block",function(){it("should return undefined if second argument is undefined",function(){var e=DummyFlowBlock.createdBlocks.tuplet4.flow([1,void 0],r,l,"blkTuplet4");expect(e).toBeUndefined()}),it("should process tuplet in non-matrix mode",function(){r.inMatrix=!1,o.turtles.ithTurtle(l).singer.beatFactor=1,o.blocks.blockList.blkTuplet4={name:"tuplet4"};var e=DummyFlowBlock.createdBlocks.tuplet4.flow([2,4,88],r,l,"blkTuplet4");expect(r.tupletParams.length).toBeGreaterThan(0),expect(r.setDispatchBlock).toHaveBeenCalled(),expect(r.setTurtleListener).toHaveBeenCalled(),expect(e).toEqual([4,1])})}),describe("SeptupletBlock",function(){it("should be defined and have a macro function",function(){var e=DummyFlowBlock.createdBlocks.stuplet7;expect(e).toBeDefined(),expect(_typeof(e.macro)).toEqual("function")})}),describe("QuintupletBlock",function(){it("should be defined and have a macro function",function(){var e=DummyFlowBlock.createdBlocks.stuplet5;expect(e).toBeDefined(),expect(_typeof(e.macro)).toEqual("function")})}),describe("TripletBlock",function(){it("should be defined and have a macro function",function(){var e=DummyFlowBlock.createdBlocks.stuplet3;expect(e).toBeDefined(),expect(_typeof(e.macro)).toEqual("function")})}),describe("STupletBlock",function(){it("should call errorMsg and use defaults for invalid arguments",function(){var e=DummyFlowBlock.createdBlocks.stuplet;o.blocks.blockList.blkSTuplet={connections:[null,null]},e.flow([null,null],r,l,"blkSTuplet"),expect(o.errorMsg).toHaveBeenCalledWith("No input provided","blkSTuplet")}),it("should process a simple tuplet flow in matrix mode",function(){r.inMatrix=!0;o.turtles.ithTurtle(l).singer.beatFactor=1,o.blocks.blockList.blkSTuplet={name:"stuplet"};var e=DummyFlowBlock.createdBlocks.stuplet,e=(r.tupletRhythms=[],e.flow([3,.5],r,l,"blkSTuplet"));expect(r.tupletRhythms.length).toBeGreaterThan(0),expect(e).toBeUndefined()})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _jest$requireActual=jest.requireActual("../RhythmBlocks"),setupRhythmBlocks=_jest$requireActual.setupRhythmBlocks,BaseBlock=(global._=function(e){return e},global.NOINPUTERRORMSG="NO_INPUT",global.DEFAULTDRUM="kick",global.mixedNumber=jest.fn(function(e){return e}),global.i18nSolfege=jest.fn(function(e){return e}),global.Singer={RhythmActions:{getNoteValue:jest.fn(),playNote:jest.fn(),addSwing:jest.fn(),multiplyNoteValue:jest.fn(),doTie:jest.fn(),doRhythmicDot:jest.fn(),playRest:jest.fn()}},global.Queue=_createClass(function e(t,o,n,i){_classCallCheck(this,e),this.child=t,this.factor=o,this.parentBlk=n,this.receivedArg=i}),(()=>_createClass(function e(t){_classCallCheck(this,e),this.name=t,this.dockTypes=[null],this.size=1,this.lang="en",this.hidden=!1},[{key:"setPalette",value:function(e){this.palette=e}},{key:"setHelpString",value:function(e){this.help=e}},{key:"formBlock",value:function(e){this.formDefn=e}},{key:"beginnerBlock",value:function(e){this.isBeginner=e}},{key:"makeMacro",value:function(e){this.macro=e}},{key:"setup",value:function(e){return e.registeredBlocks=e.registeredBlocks||{},e.registeredBlocks[this.name]=this}}]))()),FlowBlock=(()=>{function t(e){return _classCallCheck(this,t),_callSuper(this,t,[e])}return _inherits(t,BaseBlock),_createClass(t,[{key:"flow",value:function(){}}])})(),FlowClampBlock=(()=>{function t(e){return _classCallCheck(this,t),(e=_callSuper(this,t,[e])).dockTypes=[null,null,null],e}return _inherits(t,FlowBlock),_createClass(t)})(),ValueBlock=(()=>{function o(e,t){return _classCallCheck(this,o),(e=_callSuper(this,o,[e])).label=t,e.parameter=!1,e}return _inherits(o,BaseBlock),_createClass(o,[{key:"arg",value:function(){}},{key:"updateParameter",value:function(){}}])})();global.BaseBlock=BaseBlock,global.FlowBlock=FlowBlock,global.FlowClampBlock=FlowClampBlock,global.ValueBlock=ValueBlock,describe("RhythmBlocks",function(){function t(e){return o.registeredBlocks[e]}var o,n,i;beforeEach(function(){jest.clearAllMocks(),i={singer:{skipFactor:0,swing:[],swingTarget:[],swingCarryOver:0,beatFactor:1,dotCount:0,suppressOutput:!1},parentFlowQueue:[],queue:[]},o={registeredBlocks:{},blocks:{blockList:{},palettes:{}},turtles:{ithTurtle:jest.fn(function(){return i}),companionTurtle:jest.fn(function(){return 0})},errorMsg:jest.fn()},n={setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),inStatusMatrix:!1,statusFields:[]},setupRhythmBlocks(o)});describe("Block Registration",function(){test("registers all 24 rhythm blocks",function(){["mynotevalue","skipfactor","osctime","swing","newswing","newswing2","skipnotes","multiplybeatfactor","tie","rhythmicdot","rhythmicdot2","rest2","note4","note3","note5","note7","note8","note6","note2","note1","note","newnote","definefrequency","octavespace"].forEach(function(e){expect(o.registeredBlocks).toHaveProperty(e)})}),test("all blocks have correct palette set",function(){Object.values(o.registeredBlocks).forEach(function(e){expect(e.palette).toBe("rhythm")})})}),describe("MyNoteValueBlock",function(){test("returns note value",function(){global.Singer.RhythmActions.getNoteValue.mockReturnValue(.25),o.blocks.blockList[1]={connections:[0]};var e=t("mynotevalue").arg(n,0,1);expect(global.Singer.RhythmActions.getNoteValue).toHaveBeenCalledWith(0),expect(e).toBe(.25)}),test("pushes to status fields when in status matrix",function(){n.inStatusMatrix=!0,o.blocks.blockList[1]={connections:[2]},o.blocks.blockList[2]={name:"print"},t("mynotevalue").arg(n,0,1),expect(n.statusFields).toContainEqual([1,"mynotevalue"])})}),describe("SkipFactorBlock",function(){test("returns skip factor from turtle",function(){i.singer.skipFactor=5,o.blocks.blockList[1]={connections:[0]};var e=t("skipfactor").arg(n,0,1);expect(e).toBe(5)})}),describe("MillisecondsBlock",function(){test("plays note with millisecond duration",function(){t("osctime").flow([200,!0],n,0,5,null),expect(global.Singer.RhythmActions.playNote).toHaveBeenCalledWith(200,"osctime",0,5,expect.any(Function))}),test("handles null input",function(){t("osctime").flow([null,!0],n,0,5,null),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,5)}),test("handles non-number input",function(){t("osctime").flow(["text",!0],n,0,5,null),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,5)}),test("handles negative value",function(){t("osctime").flow([-100,!0],n,0,5,null),expect(o.errorMsg).toHaveBeenCalledWith("Note value must be greater than 0.",5)})}),describe("SwingBlock",function(){test("adds swing to turtle and sets up listener",function(){var e=t("swing").flow([32,!0],n,0,10);expect(i.singer.swing).toContain(32),expect(i.singer.swingTarget).toContainEqual(null),expect(i.singer.swingCarryOver).toBe(0),expect(n.setDispatchBlock).toHaveBeenCalledWith(10,0,"_swing_0"),expect(n.setTurtleListener).toHaveBeenCalledWith(0,"_swing_0",expect.any(Function)),expect(e).toEqual([!0,1])})}),describe("NewSwing2Block",function(){test("calls addSwing with valid arguments",function(){t("newswing2").flow([1/24,1/8,!0],n,0,10),expect(global.Singer.RhythmActions.addSwing).toHaveBeenCalledWith(1/24,1/8,0,10)}),test("handles null swing value",function(){t("newswing2").flow([null,1/8,!0],n,0,10),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10),expect(global.Singer.RhythmActions.addSwing).toHaveBeenCalledWith(1/24,1/8,0,10)}),test("handles zero note value",function(){t("newswing2").flow([1/24,0,!0],n,0,10),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10),expect(global.Singer.RhythmActions.addSwing).toHaveBeenCalledWith(1/24,1/8,0,10)})}),describe("SkipNotesBlock",function(){test("increases skip factor",function(){i.singer.skipFactor=0,t("skipnotes").flow([2,!0],n,0,10),expect(i.singer.skipFactor).toBe(2),expect(n.setDispatchBlock).toHaveBeenCalledWith(10,0,"_skip_0")}),test("handles null skip value",function(){i.singer.skipFactor=0,t("skipnotes").flow([null,!0],n,0,10),expect(i.singer.skipFactor).toBe(0)})}),describe("MultiplyBeatFactorBlock",function(){test("calls multiplyNoteValue with valid factor",function(){t("multiplybeatfactor").flow([2,!0],n,0,10),expect(global.Singer.RhythmActions.multiplyNoteValue).toHaveBeenCalledWith(2,0,10)}),test("handles null factor",function(){t("multiplybeatfactor").flow([null,!0],n,0,10),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10),expect(global.Singer.RhythmActions.multiplyNoteValue).toHaveBeenCalledWith(2,0,10)}),test("handles negative factor",function(){t("multiplybeatfactor").flow([-1,!0],n,0,10),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10)})}),describe("TieBlock",function(){test("calls doTie",function(){t("tie").flow([!0],n,0,10),expect(global.Singer.RhythmActions.doTie).toHaveBeenCalledWith(0,10)}),test("returns early if args undefined",function(){var e=t("tie").flow([void 0],n,0,10);expect(e).toBeUndefined(),expect(global.Singer.RhythmActions.doTie).not.toHaveBeenCalled()})}),describe("RhythmicDot2Block",function(){test("calls doRhythmicDot with dot count",function(){t("rhythmicdot2").flow([2,!0],n,0,10),expect(global.Singer.RhythmActions.doRhythmicDot).toHaveBeenCalledWith(2,0,10)}),test("handles null dot count",function(){t("rhythmicdot2").flow([null,!0],n,0,10),expect(o.errorMsg).toHaveBeenCalledWith(NOINPUTERRORMSG,10),expect(global.Singer.RhythmActions.doRhythmicDot).toHaveBeenCalledWith(0,0,10)})}),describe("Rest2Block",function(){test("plays rest",function(){t("rest2").flow([],n,0),expect(global.Singer.RhythmActions.playRest).toHaveBeenCalledWith(0)})}),describe("Note Value Blocks",function(){test("note4 block is defined",function(){var e=t("note4");expect(e).toBeDefined(),expect(e.formDefn.args).toBe(1)}),test("note macro blocks have empty flow",function(){["note1","note2","note3","note4","note5","note6","note7","note8"].forEach(function(e){e=t(e),expect(e).toBeDefined(),expect(_typeof(e.flow)).toBe("function"),e=e.flow();expect(e).toBeUndefined()})})}),describe("Block Properties",function(){test("MillisecondsBlock has correct form",function(){var e=t("osctime");expect(e.formDefn.args).toBe(1),expect(e.formDefn.defaults).toEqual([200]),expect(e.formDefn.canCollapse).toBe(!0)}),test("NewSwing2Block has correct form with labels",function(){var e=t("newswing2");expect(e.formDefn.args).toBe(2),expect(e.formDefn.defaults).toEqual([1/24,1/8]),expect(e.formDefn.argLabels).toEqual(["swing value","note value"])}),test("TieBlock is beginner block",function(){var e=t("tie");expect(e.isBeginner).toBe(!0)}),test("SwingBlock is deprecated",function(){var e=t("swing");expect(e.deprecated).toBe(!0),expect(e.hidden).toBe(!0)})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var o,r=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../SensorsBlocks"),setupSensorsBlocks=_require.setupSensorsBlocks,DummyFlowBlock=(()=>{function o(e,t){_classCallCheck(this,o),this.name=e,this.displayName=t,o.createdBlocks[e]=this}return _createClass(o,[{key:"setPalette",value:function(e,t){return this.palette=e,this}},{key:"beginnerBlock",value:function(e){return this.isBeginner=e,this}},{key:"setHelpString",value:function(e){return this.help=e,this}},{key:"formBlock",value:function(e){return this.blockParams=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}}])})(),DummyValueBlock=(DummyFlowBlock.createdBlocks={},(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,DummyFlowBlock),_createClass(e)})()),DummyLeftBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,DummyFlowBlock),_createClass(e)})(),DummyBooleanSensorBlock=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,DummyValueBlock),_createClass(e)})(),documentElements=(global.FlowBlock=DummyFlowBlock,global.ValueBlock=DummyValueBlock,global.LeftBlock=DummyLeftBlock,global.BooleanSensorBlock=DummyBooleanSensorBlock,{labelDiv:{innerHTML:"",classList:{add:jest.fn(),remove:jest.fn()},style:{},addEventListener:jest.fn()},textLabel:{value:"",placeholder:"",style:{},focus:jest.fn(),blur:jest.fn(),addEventListener:jest.fn()},overlayCanvas:{getContext:jest.fn(function(){return{getImageData:jest.fn(function(e,t,o,r){return{data:[100,150,200,255]}})}})}});function dummyStageX(){return 123}function dummyStageY(){return 456}function dummyStageMouseDown(){return!0}function dummyCurrentKeyCode(){return 65}function dummyClearCurrentKeyCode(){}global.docById=function(e){return documentElements[e]||null},global.toFixed2=function(e){return Number(e).toFixed(2)},global.hex2rgb=function(e){return"rgb(100,150,200)"},global.searchColors=function(e,t,o){return"rgb(".concat(e,",").concat(t,",").concat(o,")")},global.Tone={Analyser:(()=>_createClass(function e(t){_classCallCheck(this,e),this.type=t.type,this.size=t.size,this.smoothing=t.smoothing,this.sampleTime=.01},[{key:"getValue",value:function(){return Array(this.size).fill(-100).map(function(e,t){return e+t})}}]))()},global.platformColor={background:"rgb(200,200,200)"};var dummyTurtle={id:"t1",container:{x:50,y:100,visible:global._THIS_IS_MUSIC_BLOCKS_=!0},painter:{canvasColor:"rgb(255,0,0)"},doWait:jest.fn()},createDummyTurtle=function(){return _objectSpread({},dummyTurtle)};describe("setupSensorsBlocks",function(){var l,t,o;beforeEach(function(){DummyFlowBlock.createdBlocks={},global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global._=jest.fn(function(e){return e}),l={errorMsg:jest.fn(),blocks:{blockList:{}},getStageX:dummyStageX,getStageY:dummyStageY,getStageMouseDown:dummyStageMouseDown,getCurrentKeyCode:dummyCurrentKeyCode,clearCurrentKeyCode:dummyClearCurrentKeyCode,refreshCanvas:jest.fn(),turtles:{turtleObjs:{},getTurtle:function(e){return this.turtleObjs[e]||(this.turtleObjs[e]=createDummyTurtle()),this.turtleObjs[e]},ithTurtle:function(e){return this.getTurtle(e)}}},t={inStatusMatrix:!1,statusFields:[],inputValues:{},lastKeyCode:null,clearTurtleRun:jest.fn(),setDispatchBlock:jest.fn(),setTurtleListener:jest.fn()},o=0,setupSensorsBlocks(l)}),describe("GetColorPixelBlock",function(){var o,r,n,e;beforeEach(function(){o=DummyFlowBlock.createdBlocks.getcolorpixel,r={inStatusMatrix:!1,statusFields:[],inputValues:{},lastKeyCode:null,clearTurtleRun:jest.fn(),setDispatchBlock:jest.fn(),setTurtleListener:jest.fn()},n=0,e=global.docById,global.docById=jest.fn(function(e){return documentElements[e]||null}),l.turtles.getTurtle=jest.fn(function(e){var t=createDummyTurtle();if(999===e)throw new Error("Turtle ".concat(e," not found"));return t})}),afterEach(function(){global.docById=e}),describe("arg",function(){it("should return a color value for a pixel",function(){var e=o.arg(r,n);expect(e).toBe("rgb(100,150,200)")}),it("should return fallback color if turtle is not found",function(){var e=o.arg(r,999);expect(e).toBe("rgb(128,128,128)")}),it("should return fallback color if turtle container is missing",function(){l.turtles.getTurtle=jest.fn(function(){return{}});var e=o.arg(r,n);expect(e).toBe("rgb(128,128,128)")}),it("should handle canvas errors and return fallback color",function(){global.docById=jest.fn(function(){return null});var e=o.arg(r,n);expect(e).toBe("rgb(128,128,128)")}),it("should restore turtle visibility after successful execution",function(){var e=createDummyTurtle();l.turtles.getTurtle=jest.fn(function(){return e}),o.arg(r,n),expect(e.container.visible).toBe(!0)}),it("should not attempt to restore visibility if turtle is not found",function(){var e=o.arg(r,999);expect(e).toBe("rgb(128,128,128)")}),it("should not attempt to restore visibility if container is missing",function(){var e={container:null},t=(l.turtles.getTurtle=jest.fn(function(){return e}),o.arg(r,n));expect(t).toBe("rgb(128,128,128)")})}),describe("getPixelData",function(){it("should return pixel data from the canvas",function(){var e=o.getPixelData(50,100);expect(e).toEqual([100,150,200,255])}),it("should throw an error if canvas context is unavailable",function(){global.docById=jest.fn(function(){return null}),expect(function(){return o.getPixelData(50,100)}).toThrow("Canvas context unavailable")})}),describe("detectColor",function(){it("should return color index for opaque pixel",function(){var e=o.detectColor([100,150,200,255]);expect(e).toBe("rgb(100,150,200)")}),it("should return background color for transparent pixel",function(){var e=o.detectColor([100,150,200,0]);expect(e).toBe("rgb(200,200,200)")}),it("should throw an error for invalid pixel data",function(){var e=[100,150];expect(function(){return o.detectColor(e)}).toThrow("Invalid pixel data")})}),describe("getBackgroundColor",function(){it("should parse and return background color",function(){var e=o.getBackgroundColor();expect(e).toBe("rgb(200,200,200)")})}),describe("getFallbackColor",function(){it("should return a default gray color",function(){var e=o.getFallbackColor();expect(e).toBe("rgb(128,128,128)")})})}),describe("InputBlock",function(){it("should set up the input form and wait for input",function(){var e=DummyFlowBlock.createdBlocks.input,e=(l.turtles.ithTurtle(o).doWait=jest.fn(),l.blocks.blockList.blkInput={connections:[null,"cblk1"]},l.blocks.blockList.cblk1={value:"Enter text"},e.flow([],t,o,"blkInput"),docById("labelDiv"));expect(e.innerHTML).toContain('input id="textLabel"'),expect(l.turtles.ithTurtle(o).doWait).toHaveBeenCalledWith(120)})}),describe("InputValueBlock",function(){it("should return input value if present",function(){t.inputValues[o]=42;var e=DummyFlowBlock.createdBlocks.inputvalue;expect(e.updateParameter(t,o)).toEqual(42),expect(e.arg(t,o,"blkIV")).toEqual(42)}),it("should call errorMsg and return 0 if no input value",function(){var e=DummyFlowBlock.createdBlocks.inputvalue.arg(t,o,"blkIV");expect(l.errorMsg).toHaveBeenCalledWith("No input provided","blkIV"),expect(e).toEqual(0)})}),describe("PitchnessBlock",function(){it("should return a frequency based on pitch analyser",function(){t.mic={connect:jest.fn()},t.pitchAnalyser=null,t.limit=16;var e=DummyFlowBlock.createdBlocks.pitchness.arg(t);expect(_typeof(e)).toEqual("number")})}),describe("LoudnessBlock",function(){it("should return computed loudness",function(){t.mic={connect:jest.fn()},t.volumeAnalyser=null,t.limit=16;var e=DummyFlowBlock.createdBlocks.loudness.arg(t);expect(_typeof(e)).toEqual("number")})}),describe("MyClickBlock",function(){it("should return a click event string with turtle id",function(){l.turtles.getTurtle=jest.fn(function(){return{id:"T123"}});var e=DummyFlowBlock.createdBlocks.myclick.arg(t,o);expect(e).toEqual("clickT123")})}),describe("MouseYBlock",function(){it("should return stage Y position",function(){var e=DummyFlowBlock.createdBlocks.mousey.arg(t,o,"blkMY");expect(e).toEqual(dummyStageY())})}),describe("ToASCIIBlock",function(){it("should convert a number to a character",function(){l.blocks.blockList.blkASCII={connections:[null,"cblkASCII"]},l.blocks.blockList.cblkASCII={},t.parseArg=jest.fn(function(){return 65});var e=DummyFlowBlock.createdBlocks.toascii.arg(t,o,"blkASCII",65);expect(e).toEqual("A")}),it("should call errorMsg and return 0 for non-number input",function(){l.blocks.blockList.blkASCII2={connections:[null,"cblkASCII2"]},l.blocks.blockList.cblkASCII2={},t.parseArg=jest.fn(function(){return"NaN"});var e=DummyFlowBlock.createdBlocks.toascii.arg(t,o,"blkASCII2","NaN");expect(l.errorMsg).toHaveBeenCalledWith("Not a number","blkASCII2"),expect(e).toEqual(0)})}),describe("KeyboardBlock",function(){it("should return the last key code and clear it",function(){t.lastKeyCode=66,l.getCurrentKeyCode=jest.fn(function(){return 66}),l.clearCurrentKeyCode=jest.fn();var e=DummyFlowBlock.createdBlocks.keyboard.arg(t);expect(e).toEqual(66),expect(l.clearCurrentKeyCode).toHaveBeenCalled()})}),describe("TimeBlock",function(){it("should return elapsed time in seconds",function(){t.time=(new Date).getTime()-5e3;var e=DummyFlowBlock.createdBlocks.time.arg(t);expect(e).toBeGreaterThanOrEqual(4.9),expect(e).toBeLessThanOrEqual(5.1)})}),describe("MouseXBlock",function(){it("should return stage X position",function(){var e=DummyFlowBlock.createdBlocks.mousex.arg(t,o,"blkMX");expect(e).toEqual(dummyStageX())})}),describe("MouseButtonBlock",function(){it("should return stage mouse down state",function(){var e=DummyFlowBlock.createdBlocks.mousebutton.arg(t);expect(e).toEqual(dummyStageMouseDown())})})});
function _callSuper(e,t,o){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,o||[],_getPrototypeOf(e).constructor):t.apply(e,o))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}global._=function(e){return e},global.NOINPUTERRORMSG="No input error",global.DEFAULTOSCILLATORTYPE="defaultOsc",global.OSCTYPES={triangle:["triangle","triangle"],sine:["sine","sine"]},global.DEFAULTVOICE="defaultVoice";var DummyFlowBlock=(()=>_createClass(function e(t,o){_classCallCheck(this,e),this.type=t,this.label=o},[{key:"setPalette",value:function(e,t){this.palette=e,this.activity=t}},{key:"setHelpString",value:function(e){this.help=e}},{key:"formBlock",value:function(e){this.form=e}},{key:"setup",value:function(e){e.blockInstances||(e.blockInstances={}),e.blockInstances[this.type]=this,e.blockTypes||(e.blockTypes=[]),e.blockTypes.push(this.type)}},{key:"beginnerBlock",value:function(e){this.beginner=e}},{key:"makeMacro",value:function(e){this.macro=e}}]))(),DummyValueBlock=(()=>{function o(e,t){return _classCallCheck(this,o),_callSuper(this,o,[e,t])}return _inherits(o,DummyFlowBlock),_createClass(o)})(),DummyFlowClampBlock=(()=>{function t(e){return _classCallCheck(this,t),_callSuper(this,t,[e,e])}return _inherits(t,DummyFlowBlock),_createClass(t)})(),DummyLeftBlock=(()=>{function o(e,t){return _classCallCheck(this,o),_callSuper(this,o,[e,t])}return _inherits(o,DummyFlowBlock),_createClass(o)})(),createMockActivity=(global.FlowBlock=DummyFlowBlock,global.ValueBlock=DummyValueBlock,global.FlowClampBlock=DummyFlowClampBlock,global.LeftBlock=DummyLeftBlock,global.last=function(e){return e&&e.length?e[e.length-1]:void 0},global.Singer={ToneActions:{defDuoSynth:jest.fn(),defAMSynth:jest.fn(),defFMSynth:jest.fn(),doHarmonic:jest.fn(),doDistortion:jest.fn(),doTremolo:jest.fn(),doPhaser:jest.fn(),doChorus:jest.fn(),doVibrato:jest.fn(),setTimbre:jest.fn()}},global.instrumentsEffects={},global.VOICENAMES={violin:["violin","violin"],piano:["piano","piano"]},global.DRUMNAMES={drum:["drum","drum"]},function(){var t={};return{blockTypes:[],blockInstances:{},turtles:{ithTurtle:jest.fn(function(e){return t[e]||(t[e]={singer:{inHarmonic:[],partials:[],distortionAmount:[],tremoloFrequency:[],tremoloDepth:[],rate:[],octaves:[],baseFrequency:[],chorusRate:[],delayTime:[],chorusDepth:[],instrumentNames:[],voices:[]}}),t[e]})},blocks:{blockList:{},updateBlockText:jest.fn()},errorMsg:jest.fn()}}),createMockLogo=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{inTimbre:void 0===e.inTimbre||e.inTimbre,inRhythmRuler:e.inRhythmRuler||!1,inSample:e.inSample||!1,timbre:{osc:[],oscParams:[],distortionEffect:[],distortionParams:[],tremoloEffect:[],tremoloParams:[],phaserEffect:[],phaserParams:[],chorusEffect:[],chorusParams:[],instrumentName:"testInstrument",synthVals:void 0},synth:{createSynth:jest.fn()},setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),statusFields:[],sample:{},stopTurtle:!1}},_require=require("../ToneBlocks"),setupToneBlocks=_require.setupToneBlocks;describe("setupToneBlocks",function(){function o(e){return n.blockInstances[e]}var n,i;beforeEach(function(){n=createMockActivity(),i=createMockLogo(),global.instrumentsEffects[0]={},global.instrumentsEffects[0][i.timbre.instrumentName]={},setupToneBlocks(n)});describe("OscillatorBlock",function(){it("should create synth if no oscillator exists",function(){var e=o("oscillator");i.timbre.osc=[];e.flow(["triangle",6],i,0,"oscBlk"),expect(i.synth.createSynth).toHaveBeenCalledWith(0,i.timbre.instrumentName,"triangle",i.timbre.synthVals),expect(i.timbre.osc).toContain("oscBlk"),expect(i.timbre.oscParams).toEqual(["triangle",6])}),it("should not create synth if oscillator exists and show error",function(){i.timbre.osc=["existingOsc"];o("oscillator").flow(["sine",8],i,0,"oscBlk2"),expect(n.errorMsg).toHaveBeenCalledWith("You are adding multiple oscillator blocks."),expect(i.timbre.osc).toContain("existingOsc")})}),describe("FillerTypeBlock and OscillatorTypeBlock",function(){it("should setup filler type block (value block)",function(){var e=o("filtertype");expect(n.blockTypes).toContain("filtertype"),expect(e.form).toEqual({outType:"textout"})}),it("should setup oscillator type block (value block)",function(){var e=o("oscillatortype");expect(n.blockTypes).toContain("oscillatortype"),expect(e.form).toEqual({outType:"textout"})})}),describe("DuoSynthBlock",function(){it("should call defDuoSynth with proper arguments",function(){o("duosynth").flow([10,5],i,0,"duoBlk"),expect(Singer.ToneActions.defDuoSynth).toHaveBeenCalledWith(10,5,0,"duoBlk")})}),describe("AMSynth",function(){it("should call defAMSynth with proper argument",function(){o("amsynth").flow([1],i,0,"amBlk"),expect(Singer.ToneActions.defAMSynth).toHaveBeenCalledWith(1,0,"amBlk")})}),describe("FMSynth",function(){it("should call defFMSynth with proper argument",function(){o("fmsynth").flow([10],i,0,"fmBlk"),expect(Singer.ToneActions.defFMSynth).toHaveBeenCalledWith(10,0,"fmBlk")})}),describe("PartialBlock",function(){it("should error and stop turtle if weight is out of range",function(){o("partial").flow([1.5],i,0,"partialBlk"),expect(n.errorMsg).toHaveBeenCalledWith("Partial weight must be between 0 and 1."),expect(i.stopTurtle).toBe(!0)}),it("should update partial in harmonic when inHarmonic is non-empty",function(){var e=o("partial"),t=n.turtles.ithTurtle(0);t.singer.inHarmonic.push("dummyHarmonic"),t.singer.partials.push([]),e.flow([.5],i,0,"partialBlk2"),expect(t.singer.partials[t.singer.partials.length-1]).toContain(.5)}),it("should error if no harmonic context exists",function(){var e=o("partial"),t=n.turtles.ithTurtle(0);expect(t.singer.inHarmonic.length).toBe(0),e.flow([.3],i,0,"partialBlk3"),expect(n.errorMsg).toHaveBeenCalledWith("Partial block should be used inside of a Weighted-partials block.")})}),describe("HarmonicBlock",function(){it("should push block onto harmonic stack and set listener",function(){var e=o("harmonic").flow([42],i,0,"harmonicBlk"),t=n.turtles.ithTurtle(0);expect(t.singer.inHarmonic).toContain("harmonicBlk"),expect(t.singer.partials).toContainEqual([]),expect(i.setDispatchBlock).toHaveBeenCalledWith("harmonicBlk",0,expect.stringContaining("_harmonic_")),expect(e).toEqual([42,1])})}),describe("Harmonic2Block",function(){it("should call doHarmonic and return proper flow",function(){var e=o("harmonic2").flow([7,1],i,0,"harmonic2Blk");expect(Singer.ToneActions.doHarmonic).toHaveBeenCalledWith(7,0,"harmonic2Blk"),expect(e).toEqual([1,1])})}),describe("DisBlock",function(){it("should call doDistortion and update distortion effect if in timbre",function(){var e=o("dis"),e=(n.turtles.ithTurtle(0).singer.distortionAmount=[.5],i.inTimbre=!0,e.flow([40,1],i,0,"disBlk"));expect(Singer.ToneActions.doDistortion).toHaveBeenCalledWith(40,0,"disBlk"),expect(global.instrumentsEffects[0][i.timbre.instrumentName].distortionActive).toBe(!0),expect(i.timbre.distortionEffect).toContain("disBlk"),expect(i.timbre.distortionParams).toContain(50),expect(global.instrumentsEffects[0][i.timbre.instrumentName].distortionAmount).toEqual(40),expect(e).toEqual([1,1])})}),describe("TremoloBlock",function(){it("should call doTremolo and update tremolo effect if in timbre",function(){var e=o("tremolo"),t=n.turtles.ithTurtle(0),t=(t.singer.tremoloFrequency=[5],t.singer.tremoloDepth=[.7],i.inTimbre=!0,e.flow([10,50,99],i,0,"tremoloBlk"));expect(Singer.ToneActions.doTremolo).toHaveBeenCalledWith(10,50,0,"tremoloBlk"),expect(global.instrumentsEffects[0][i.timbre.instrumentName].tremoloActive).toBe(!0),expect(i.timbre.tremoloEffect).toContain("tremoloBlk"),expect(i.timbre.tremoloParams).toContain(5),expect(i.timbre.tremoloParams).toContain(70),expect(global.instrumentsEffects[0][i.timbre.instrumentName].tremoloFrequency).toEqual(10),expect(global.instrumentsEffects[0][i.timbre.instrumentName].tremoloDepth).toEqual(50),expect(t).toEqual([99,1])})}),describe("PhaserBlock",function(){it("should call doPhaser and update phaser effect if in timbre",function(){var e=o("phaser"),t=n.turtles.ithTurtle(0),t=(t.singer.rate=[.5],t.singer.octaves=[3],t.singer.baseFrequency=[392],i.inTimbre=!0,e.flow([.5,3,392,88],i,0,"phaserBlk"));expect(Singer.ToneActions.doPhaser).toHaveBeenCalledWith(.5,3,392,0,"phaserBlk"),expect(global.instrumentsEffects[0][i.timbre.instrumentName].phaserActive).toBe(!0),expect(i.timbre.phaserEffect).toContain("phaserBlk"),expect(i.timbre.phaserParams).toContain(.5),expect(i.timbre.phaserParams).toContain(3),expect(i.timbre.phaserParams).toContain(392),expect(t).toEqual([88,1])})}),describe("ChorusBlock",function(){it("should call doChorus and update chorus effect if in timbre",function(){var e=o("chorus"),t=n.turtles.ithTurtle(0),t=(t.singer.chorusRate=[1.5],t.singer.delayTime=[3.5],t.singer.chorusDepth=[.7],i.inTimbre=!0,e.flow([1.5,3.5,70,77],i,0,"chorusBlk"));expect(Singer.ToneActions.doChorus).toHaveBeenCalledWith(1.5,3.5,70,0,"chorusBlk"),expect(global.instrumentsEffects[0][i.timbre.instrumentName].chorusActive).toBe(!0),expect(i.timbre.chorusEffect).toContain("chorusBlk"),expect(i.timbre.chorusParams).toContain(1.5),expect(i.timbre.chorusParams).toContain(3.5),expect(i.timbre.chorusParams).toContain(70),expect(t).toEqual([77,1])})}),describe("VibratoBlock",function(){it("should call doVibrato and return correct flow",function(){var e=o("vibrato").flow([5,1/16,33],i,0,"vibratoBlk");expect(Singer.ToneActions.doVibrato).toHaveBeenCalledWith(5,1/16,0,"vibratoBlk"),expect(e).toEqual([33,1])})}),describe("SetVoiceBlock",function(){it("should push valid voice into turtle's voices and set listener",function(){var e=o("setvoice"),t=n.turtles.ithTurtle(0);e.flow(["violin",44],i,0,"setVoiceBlk"),expect(t.singer.voices).toContain("violin"),expect(i.setDispatchBlock).toHaveBeenCalledWith("setVoiceBlk",0,expect.stringMatching("_setvoice_"))}),it("should error if provided voice is not found",function(){o("setvoice").flow(["nonexistent",55],i,0,"setVoiceBlk2"),expect(n.errorMsg).toHaveBeenCalledWith("No input error","setVoiceBlk2")})}),describe("SynthNameBlock",function(){it("should push status field if inStatusMatrix and connection is print",function(){n.blocks.blockList.blkPrint={name:"print"},n.blocks.blockList.synthNameBlk={connections:["blkPrint"]};var e=o("synthname");i.inStatusMatrix=!0,e.arg(i,0,"synthNameBlk"),expect(i.statusFields).toContainEqual(["synthNameBlk","synthname"])}),it("should return last instrument name otherwise",function(){var e=o("synthname"),e=(n.turtles.ithTurtle(0).singer.instrumentNames=["first","second"],e.arg(i,0,"synthNameBlk2"));expect(e).toEqual("second")})}),describe("SetDefaultVoiceBlock",function(){it("should error if argument is null",function(){o("setdefaultinstrument").flow([null],i,0,"setDefVoiceBlk"),expect(n.errorMsg).toHaveBeenCalledWith("No input error","setDefVoiceBlk")}),it("should update default instrument name",function(){var e=o("setdefaultinstrument"),t=n.turtles.ithTurtle(0);t.singer.instrumentNames=[],e.flow(["piano"],i,0,"setDefVoiceBlk2"),expect(t.singer.instrumentNames[0]).toEqual("piano")})}),describe("VoiceNameBlock",function(){it("should be a value block with extra width",function(){var e=o("voicename");e.setup(n),expect(e.extraWidth).toEqual(50)})}),describe("SetTimbreBlock",function(){it("should error if argument is null",function(){o("settimbre").flow([null,66],i,0,"setTimbreBlk"),expect(n.errorMsg).toHaveBeenCalledWith("No input error","setTimbreBlk")}),it("should set timbre when inRhythmRuler is false and inSample is false",function(){o("settimbre").flow(["customTimbre",77],i,0,"setTimbreBlk2"),expect(Singer.ToneActions.setTimbre).toHaveBeenCalledWith("customTimbre",0,"setTimbreBlk2")}),it("should update sample properties if inSample is true",function(){i.inSample=!0,o("settimbre").flow([["sampleName","sampleData","la",5],88],i,0,"setTimbreBlk3"),expect(i.sample.sampleName).toEqual("sampleName"),expect(i.sample.sampleData).toEqual("sampleData"),expect(i.sample.samplePitch).toEqual("la"),expect(i.sample.sampleOctave).toEqual(5)})}),describe("CustomSampleBlock",function(){it("should update parameter correctly",function(){var e=o("customsample"),e=(n.blocks.blockList.csBlk={value:"initial"},e.updateParameter(i,0,"csBlk"));expect(e).toEqual("initial")}),it("should update its value based on connected blocks",function(){n.blocks.blockList.csBlk2={value:["","","do",4],connections:{1:"nameBlk",2:"solfegeBlk",3:"numBlk"}},n.blocks.blockList.nameBlk={value:["newName","newData"]},n.blocks.blockList.solfegeBlk={value:"re"},n.blocks.blockList.numBlk={value:7};var e=o("customsample").arg(i,0,"csBlk2");expect(e).toEqual(["newName","newData","re",7])})}),describe("AudioFileBlock",function(){it("should update parameter by calling updateBlockText",function(){n.blocks.blockList.afBlk={value:"audioValue"};var e=o("audiofile").updateParameter(i,0,"afBlk");expect(n.blocks.updateBlockText).toHaveBeenCalledWith("afBlk"),expect(e).toEqual("audioValue")})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("../VolumeBlocks"),setupVolumeBlocks=_require.setupVolumeBlocks;describe("setupVolumeBlocks",function(){var o,r,l,i,t=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.name=t,this.displayName=n,l[t]=this},[{key:"setPalette",value:function(e,t){return this.palette=e,this}},{key:"beginnerBlock",value:function(e){return this.isBeginner=e,this}},{key:"setHelpString",value:function(e){return this.help=e,this}},{key:"formBlock",value:function(e){return this.blockParams=e,this}},{key:"makeMacro",value:function(e){return this.macro=e,this}},{key:"setup",value:function(e){return this}}]))(),e=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})(),n=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})(),s=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,t),_createClass(e)})();beforeEach(function(){l={},global._=jest.fn(function(e){return e}),global.ValueBlock=t,global.FlowBlock=e,global.FlowClampBlock=n,global.LeftBlock=s,global.NOINPUTERRORMSG="No input provided",global.NANERRORMSG="Not a number",global.last=function(e){return e[e.length-1]},global.DEFAULTVOLUME=70,global.DEFAULTVOICE="piano",global.DEFAULTDRUM="drum",global.VOICENAMES={piano:["piano","piano"],guitar:["guitar","guitar"]},global.DRUMNAMES={drum:["drum","drum"]},global.Singer={VolumeActions:{getSynthVolume:jest.fn(function(e,t){return 80}),setSynthVolume:jest.fn(function(e,t,n,o){}),setMasterVolume:jest.fn(function(e,t,n){}),setPanning:jest.fn(),doCrescendo:jest.fn(),setRelativeVolume:jest.fn()},masterVolume:[],setSynthVolume:jest.fn(function(e,t,n,o){}),setMasterVolume:jest.fn(function(e,t){})},o={errorMsg:jest.fn(),textMsg:jest.fn(),blocks:{blockList:{}},turtles:{turtleObjs:{},ithTurtle:function(e){return this.turtleObjs[e]||(this.turtleObjs[e]={singer:{staccato:[],synthVolume:{},instrumentNames:[],suppressOutput:!1,justCounting:[],crescendoInitialVolume:{}}}),this.turtleObjs[e]}}},r={inStatusMatrix:!1,statusFields:[],stopTurtle:!1,synth:{loadSynth:jest.fn()},setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),notation:{notationBeginSlur:jest.fn(),notationEndSlur:jest.fn()},parseArg:jest.fn(function(e,t,n,o,r){return r})},i=0,setupVolumeBlocks(o)}),describe("SynthVolumeBlock",function(){it("should push status when in status matrix",function(){var e="blkSynthVol1";o.blocks.blockList[e]={connections:[10,20]},o.blocks.blockList[10]={name:"print"},r.inStatusMatrix=!0,l.synthvolumefactor.arg(r,i,e,"piano"),expect(r.statusFields).toContainEqual([e,"synth volume"])}),it("should call getSynthVolume when connection is valid",function(){var e="blkSynthVol2";o.blocks.blockList[e]={connections:[null,30]},o.blocks.blockList[30]={name:"dummy"},r.inStatusMatrix=!1,r.parseArg.mockReturnValue("piano");e=l.synthvolumefactor.arg(r,i,e,"piano");expect(Singer.VolumeActions.getSynthVolume).toHaveBeenCalledWith("piano",i),expect(e).toEqual(80)}),it("should return 0 when second connection is null",function(){var e="blkSynthVol3";o.blocks.blockList[e]={connections:[null,null]},r.inStatusMatrix=!1;e=l.synthvolumefactor.arg(r,i,e,"piano");expect(e).toEqual(0)}),it("updateParameter should return block value",function(){var e="blkSynthVol4";o.blocks.blockList[e]={value:"testValue"};e=l.synthvolumefactor.updateParameter(r,i,e);expect(e).toEqual("testValue")})}),describe("MasterVolumeBlock",function(){it("should push status when in status matrix",function(){var e="blkMasterVol1";o.blocks.blockList[e]={connections:[15]},o.blocks.blockList[15]={name:"print"},r.inStatusMatrix=!0,l.notevolumefactor.arg(r,i,e),expect(r.statusFields).toContainEqual([e,"volume"])}),it("should return master volume when not in status matrix",function(){r.inStatusMatrix=!1,Singer.VolumeActions.masterVolume=85;var e=l.notevolumefactor.arg(r,i,"blkMasterVol2");expect(e).toEqual(85)}),it("updateParameter should return block value",function(){var e="blkMasterVol3";o.blocks.blockList[e]={value:95};e=l.notevolumefactor.updateParameter(r,i,e);expect(e).toEqual(95)})}),describe("SetSynthVolume2Block",function(){it("should return undefined if third argument is undefined",function(){var e=l.setsynthvolume2.flow(["piano",80],r,i,"blkSSV2");expect(e).toBeUndefined()}),it("should process valid synth volume and register a listener",function(){var e="blkSSV2",t=l.setsynthvolume2,n=o.turtles.ithTurtle(i),t=(n.singer.instrumentNames=[],n.singer.synthVolume={},n.singer.crescendoInitialVolume={},r.synth.loadSynth=jest.fn(),t.flow(["piano",90,100],r,i,e));expect(r.synth.loadSynth).toHaveBeenCalledWith(i,"piano"),expect(n.singer.instrumentNames).toContain("piano"),expect(r.setDispatchBlock).toHaveBeenCalledWith(e,i,expect.stringMatching(/^_synthvolume_/)),expect(r.setTurtleListener).toHaveBeenCalled(),expect(t).toEqual([100,1])})}),describe("SetSynthVolumeBlock",function(){it("should call setSynthVolume after validating arguments",function(){l.setsynthvolume.flow(["piano",95],r,i,"blkSSV"),expect(Singer.VolumeActions.setSynthVolume).toHaveBeenCalledWith("piano",95,i,"blkSSV")})}),describe("SetPanBlock",function(){it("should call errorMsg if argument is not a number",function(){l.setpanning.flow(["not a number"],r,i,"blkPan"),expect(o.errorMsg).toHaveBeenCalledWith(NANERRORMSG,"blkPan")}),it("should warn when panning is extreme and call setPanning",function(){l.setpanning.flow([100],r,i,"blkPan2"),expect(o.errorMsg).toHaveBeenCalledWith("Warning: Sound is coming out from only the left or right side.","blkPan2"),expect(Singer.VolumeActions.setPanning).toHaveBeenCalledWith(100,i)})}),describe("SetNoteVolumeBlock",function(){it("should call errorMsg if argument is not a number",function(){l.setnotevolume.flow(["NaN"],r,i,"blkNoteVol"),expect(o.errorMsg).toHaveBeenCalledWith(NANERRORMSG,"blkNoteVol")}),it("should call setMasterVolume with a valid number",function(){l.setnotevolume.flow([75],r,i,"blkNoteVol2"),expect(Singer.VolumeActions.setMasterVolume).toHaveBeenCalledWith(75,i,"blkNoteVol2")})}),describe("SetNoteVolume2Block",function(){it("should return undefined if second argument is undefined",function(){var e=l.setnotevolume2.flow([50],r,i,"blkNoteVol2");expect(e).toBeUndefined()}),it("should process master volume change and register a listener",function(){var e="blkNoteVol22",t=l.setnotevolume2;Singer.masterVolume=[];o.turtles.ithTurtle(i).singer.suppressOutput=!1;t=t.flow([60,100],r,i,e);expect(Singer.masterVolume).toContain(60),expect(r.setDispatchBlock).toHaveBeenCalledWith(e,i,expect.stringMatching(/^_volume_/)),expect(r.setTurtleListener).toHaveBeenCalled(),expect(t).toEqual([100,1])})}),describe("ArticulationBlock",function(){it("should return undefined if second argument is undefined",function(){var e=l.articulation.flow([30],r,i,"blkArt");expect(e).toBeUndefined()}),it("should call setRelativeVolume and return an array",function(){var e=l.articulation.flow([25,50],r,i,"blkArt2");expect(Singer.VolumeActions.setRelativeVolume).toHaveBeenCalledWith(25,i,"blkArt2"),expect(e).toEqual([50,1])})}),describe("DecrescendoBlock",function(){it("should call doCrescendo and return expected array when value is nonzero",function(){var e=l.decrescendo,e=(o.blocks.blockList.blkDec={name:"decrescendo"},e.flow([5,99],r,i,"blkDec"));expect(Singer.VolumeActions.doCrescendo).toHaveBeenCalledWith("decrescendo",5,i,"blkDec"),expect(e).toEqual([99,1])})}),describe("CrescendoBlock",function(){it("should behave like decrescendo with block name 'crescendo'",function(){var e=l.crescendo,e=(o.blocks.blockList.blkCres={name:"crescendo"},e.flow([5,88],r,i,"blkCres"));expect(Singer.VolumeActions.doCrescendo).toHaveBeenCalledWith("crescendo",5,i,"blkCres"),expect(e).toEqual([88,1])})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var DictBlocksAPI=(()=>_createClass(function t(){_classCallCheck(this,t)},[{key:"getDict",value:function(t){void 0===t&&(t=this.turIndex);t=JSInterface.validateArgs("getDict",[t]);return this.runCommand("getDict",[t[0],this.turIndex])}},{key:"showDict",value:function(t){void 0===t&&(t=this.turIndex);t=JSInterface.validateArgs("showDict",[t]);return this.runCommand("showDict",[t[0],this.turIndex])}},{key:"setValue",value:function(t,e,r){void 0===r&&(r=globalActivity.turtles.ithTurtle(this.turIndex).name);t=JSInterface.validateArgs("setValue",[t,e,r]);return this.runCommand("setValue",[t[2],t[0],t[1],this.turIndex])}},{key:"getValue",value:function(t,e){void 0===e&&(e=globalActivity.turtles.ithTurtle(this.turIndex).name);t=JSInterface.validateArgs("getValue",[t,e]);return this.runCommand("getValue",[t[1],t[0],this.turIndex])}}]))();"undefined"!=typeof module&&module.exports&&(module.exports=DictBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",t=e.toStringTag||"@@toStringTag";function n(e,r,t,n){var o,i,a,u,c,f,s,l,y,r=r&&r.prototype instanceof _?r:_,r=Object.create(r.prototype);return _regeneratorDefine2(r,"_invoke",(o=e,i=t,s=n||[],l=!1,y={p:f=0,n:0,v:m,a:p,f:p.bind(m,4),d:function(e,r){return a=e,u=0,c=m,y.n=r,v}},function(e,r,t){if(1<f)throw TypeError("Generator is already running");for(l&&1===r&&p(r,t),u=r,c=t;(h=u<2?m:c)||!l;){a||(u?u<3?(1<u&&(y.n=-1),p(u,c)):y.n=c:y.v=c);try{if(f=2,a){if(h=a[e=u?e:"next"]){if(!(h=h.call(a,c)))throw TypeError("iterator result is not an object");if(!h.done)return h;c=h.value,u<2&&(u=0)}else 1===u&&(h=a.return)&&h.call(a),u<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),u=1);a=m}else if((h=(l=y.n<0)?c:o.call(i,y))!==v)break}catch(e){a=m,u=1,c=e}finally{f=1}}return{value:h,done:l}}),!0),r;function p(e,r){for(u=e,c=r,h=0;!l&&f&&!t&&h<s.length;h++){var t,n=s[h],o=y.p,i=n[2];3<e?(t=i===r)&&(c=n[(u=n[4])?5:u=3],n[4]=n[5]=m):n[0]<=o&&((t=e<2&&o<n[1])?(u=0,y.v=r,y.n=n[1]):o<i&&(t=e<3||n[0]>r||i<r)&&(n[4]=e,n[5]=r,y.n=i,u=0))}if(t||1<e)return v;throw l=!0,r}}var v={};function _(){}function o(){}function i(){}var h=Object.getPrototypeOf,e=[][r]?h(h([][r]())):(_regeneratorDefine2(h={},r,function(){return this}),h),a=i.prototype=_.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,t,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",o.prototype=i),_regeneratorDefine2(i,"constructor",o),_regeneratorDefine2(i,t,o.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,t,"Generator"),_regeneratorDefine2(a,r,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:u}})()}function _regeneratorDefine2(e,r,t,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,r,t,n){function o(r,t){_regeneratorDefine2(e,r,function(e){return this._invoke(r,t,e)})}r?i?i(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(o("next",0),o("throw",1),o("return",2))})(e,r,t,n)}function asyncGeneratorStep(e,r,t,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var e=this,a=arguments;return new Promise(function(r,t){var n=u.apply(e,a);function o(e){asyncGeneratorStep(n,r,t,o,i,"next",e)}function i(e){asyncGeneratorStep(n,r,t,o,i,"throw",e)}o(void 0)})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,r){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);t=t.call(e,r||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}var DrumBlocksAPI=(()=>{return _createClass(function e(){_classCallCheck(this,e)},[{key:"playDrum",value:function(e){e=JSInterface.validateArgs("playDrum",[e]);return this.runCommand("playDrum",[e[0],this.turIndex,MusicBlocks.BLK])}},{key:"setDrum",value:(n=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setDrum",[r,t]),e.n=1,this.runCommand("setDrum",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return n.apply(this,arguments)})},{key:"mapPitchToDrum",value:(t=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("mapPitchToDrum",[r,t]),e.n=1,this.runCommand("mapPitchToDrum",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"playNoise",value:function(e){e=JSInterface.validateArgs("playNoise",[e]);return this.runCommand("playNoise",[e[0],this.turIndex])}}]);var t,n})();"undefined"!=typeof module&&module.exports&&(module.exports=DrumBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var GraphicsBlocksAPI=(()=>_createClass(function e(){_classCallCheck(this,e)},[{key:"goForward",value:function(e){e=JSInterface.validateArgs("goForward",[e]);return this.runCommand("doForward",[e[0]])}},{key:"goBackward",value:function(e){e=JSInterface.validateArgs("goBackward",[e]);return this.runCommand("doForward",[-e[0]])}},{key:"turnRight",value:function(e){e=JSInterface.validateArgs("turnRight",[e]);return this.runCommand("doRight",[e[0]])}},{key:"turnLeft",value:function(e){e=JSInterface.validateArgs("turnLeft",[e]);return this.runCommand("doRight",[-e[0]])}},{key:"setXY",value:function(e,t){e=JSInterface.validateArgs("setXY",[e,t]);return this.runCommand("doSetXY",[e[0],e[1]])}},{key:"setHeading",value:function(e){e=JSInterface.validateArgs("setHeading",[e]);return this.runCommand("doSetHeading",[e[0]])}},{key:"drawArc",value:function(e,t){e=JSInterface.validateArgs("drawArc",[e,t]);return this.runCommand("doArc",[e[0],e[1]])}},{key:"drawBezier",value:function(e,t){e=JSInterface.validateArgs("drawBezier",[e,t]);return this.runCommand("doBezier",[e[0],e[1]])}},{key:"setBezierControlPoint1",value:function(e,t){e=JSInterface.validateArgs("setBezierControlPoint1",[e,t]);return this.runCommand("setControlPoint1",[e[0],e[1]])}},{key:"setBezierControlPoint2",value:function(e,t){e=JSInterface.validateArgs("setBezierControlPoint2",[e,t]);return this.runCommand("setControlPoint2",[e[0],e[1]])}},{key:"clear",value:function(){return this.runCommand("doClear",[!0,!0,!0])}},{key:"scrollXY",value:function(e,t){e=JSInterface.validateArgs("scrollXY",[e,t]);return this.runCommand("doScrollXY",[e[0],e[1]])}}]))();"undefined"!=typeof module&&module.exports&&(module.exports=GraphicsBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var v,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",t=e.toStringTag||"@@toStringTag";function n(e,r,t,n){var o,a,i,u,c,f,s,l,y,r=r&&r.prototype instanceof _?r:_,r=Object.create(r.prototype);return _regeneratorDefine2(r,"_invoke",(o=e,a=t,s=n||[],l=!1,y={p:f=0,n:0,v:v,a:p,f:p.bind(v,4),d:function(e,r){return i=e,u=0,c=v,y.n=r,m}},function(e,r,t){if(1<f)throw TypeError("Generator is already running");for(l&&1===r&&p(r,t),u=r,c=t;(d=u<2?v:c)||!l;){i||(u?u<3?(1<u&&(y.n=-1),p(u,c)):y.n=c:y.v=c);try{if(f=2,i){if(d=i[e=u?e:"next"]){if(!(d=d.call(i,c)))throw TypeError("iterator result is not an object");if(!d.done)return d;c=d.value,u<2&&(u=0)}else 1===u&&(d=i.return)&&d.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),u=1);i=v}else if((d=(l=y.n<0)?c:o.call(a,y))!==m)break}catch(e){i=v,u=1,c=e}finally{f=1}}return{value:d,done:l}}),!0),r;function p(e,r){for(u=e,c=r,d=0;!l&&f&&!t&&d<s.length;d++){var t,n=s[d],o=y.p,a=n[2];3<e?(t=a===r)&&(c=n[(u=n[4])?5:u=3],n[4]=n[5]=v):n[0]<=o&&((t=e<2&&o<n[1])?(u=0,y.v=r,y.n=n[1]):o<a&&(t=e<3||n[0]>r||a<r)&&(n[4]=e,n[5]=r,y.n=a,u=0))}if(t||1<e)return m;throw l=!0,r}}var m={};function _(){}function o(){}function a(){}var d=Object.getPrototypeOf,e=[][r]?d(d([][r]())):(_regeneratorDefine2(d={},r,function(){return this}),d),i=a.prototype=_.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,t,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,t,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,t,"Generator"),_regeneratorDefine2(i,r,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:u}})()}function _regeneratorDefine2(e,r,t,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,r,t,n){function o(r,t){_regeneratorDefine2(e,r,function(e){return this._invoke(r,t,e)})}r?a?a(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(o("next",0),o("throw",1),o("return",2))})(e,r,t,n)}function asyncGeneratorStep(e,r,t,n,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var e=this,i=arguments;return new Promise(function(r,t){var n=u.apply(e,i);function o(e){asyncGeneratorStep(n,r,t,o,a,"next",e)}function a(e){asyncGeneratorStep(n,r,t,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,r){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);t=t.call(e,r||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}var IntervalsBlocksAPI=(()=>{return _createClass(function e(){_classCallCheck(this,e)},[{key:"setKey",value:function(e,r){e=JSInterface.validateArgs("setKey",[e,r]);return this.runCommand("setKey",[e[0],e[1],this.turIndex])}},{key:"defineMode",value:(o=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("defineMode",[r,t]),e.n=1,this.runCommand("defineMode",[n[0],this.turIndex,MusicBlocks.BLK]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return o.apply(this,arguments)})},{key:"setScalarInterval",value:(n=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setScalarInterval",[r,t]),e.n=1,this.runCommand("setScalarInterval",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return n.apply(this,arguments)})},{key:"setSemitoneInterval",value:(t=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setSemitoneInterval",[r,t]),e.n=1,this.runCommand("setSemitoneInterval",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"setTemperament",value:function(e,r,t){e=JSInterface.validateArgs("setTemperament",[e,r,t]);return this.runCommand("setTemperament",[e[0],e[1],e[2]])}}]);var t,n,o})();"undefined"!=typeof module&&module.exports&&(module.exports=IntervalsBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var v,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var o,a,i,u,c,f,l,s,y,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=r,l=n||[],s=!1,y={p:f=0,n:0,v:v,a:p,f:p.bind(v,4),d:function(e,t){return i=e,u=0,c=v,y.n=t,d}},function(e,t,r){if(1<f)throw TypeError("Generator is already running");for(s&&1===t&&p(t,r),u=t,c=r;(m=u<2?v:c)||!s;){i||(u?u<3?(1<u&&(y.n=-1),p(u,c)):y.n=c:y.v=c);try{if(f=2,i){if(m=i[e=u?e:"next"]){if(!(m=m.call(i,c)))throw TypeError("iterator result is not an object");if(!m.done)return m;c=m.value,u<2&&(u=0)}else 1===u&&(m=i.return)&&m.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),u=1);i=v}else if((m=(s=y.n<0)?c:o.call(a,y))!==d)break}catch(e){i=v,u=1,c=e}finally{f=1}}return{value:m,done:s}}),!0),t;function p(e,t){for(u=e,c=t,m=0;!s&&f&&!r&&m<l.length;m++){var r,n=l[m],o=y.p,a=n[2];3<e?(r=a===t)&&(c=n[(u=n[4])?5:u=3],n[4]=n[5]=v):n[0]<=o&&((r=e<2&&o<n[1])?(u=0,y.v=t,y.n=n[1]):o<a&&(r=e<3||n[0]>t||a<t)&&(n[4]=e,n[5]=t,y.n=a,u=0))}if(r||1<e)return d;throw s=!0,t}}var d={};function g(){}function o(){}function a(){}var m=Object.getPrototypeOf,e=[][t]?m(m([][t]())):(_regeneratorDefine2(m={},t,function(){return this}),m),i=a.prototype=g.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,r,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,r,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:u}})()}function _regeneratorDefine2(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,r,n){function o(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var e=this,i=arguments;return new Promise(function(t,r){var n=u.apply(e,i);function o(e){asyncGeneratorStep(n,t,r,o,a,"next",e)}function a(e){asyncGeneratorStep(n,t,r,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var MeterBlocksAPI=(()=>{return _createClass(function e(){_classCallCheck(this,e)},[{key:"setMeter",value:function(e,t){e=JSInterface.validateArgs("setMeter",[e,t]);return this.runCommand("setMeter",[e[0],e[1],this.turIndex])}},{key:"setBPM",value:function(e,t){e=JSInterface.validateArgs("setBPM",[e,t]);return this.runCommand("setBPM",[e[0],e[1],this.turIndex])}},{key:"setMasterBPM",value:function(e,t){e=JSInterface.validateArgs("setMasterBPM",[e,t]);return this.runCommand("setMasterBPM",[e[0],e[1]])}},{key:"onEveryNoteDo",value:function(e){e=JSInterface.validateArgs("onEveryNoteDo",[e]);return this.runCommand("onEveryNoteDo",[e[0],null,null,this.turIndex])}},{key:"onEveryBeatDo",value:function(e){e=JSInterface.validateArgs("onEveryBeatDo",[e]);return this.runCommand("onEveryBeatDo",[e[0],null,null,this.turIndex])}},{key:"onStrongBeatDo",value:function(e,t){e=JSInterface.validateArgs("onStrongBeatDo",[e,t]);return this.runCommand("onStrongBeatDo",[e[0],e[1],null,null,this.turIndex])}},{key:"onWeakBeatDo",value:function(e){e=JSInterface.validateArgs("onWeakBeatDo",[e]);return this.runCommand("onWeakBeatDo",[e[0],null,null,this.turIndex])}},{key:"setNoClock",value:(t=_asyncToGenerator(_regenerator().m(function e(t){var r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return r=JSInterface.validateArgs("setNoClock",[t]),e.n=1,this.runCommand("setNoClock",[this.turIndex]);case 1:return e.n=2,r[0]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getNotesPlayed",value:function(e){e=JSInterface.validateArgs("getNotesPlayed",[e]);return Singer.MeterActions.getNotesPlayed(e[0],this.turIndex)}}]);var t})();"undefined"!=typeof module&&module.exports&&(module.exports=MeterBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var _,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",t=e.toStringTag||"@@toStringTag";function n(e,r,t,n){var o,i,a,u,c,f,s,l,y,r=r&&r.prototype instanceof h?r:h,r=Object.create(r.prototype);return _regeneratorDefine2(r,"_invoke",(o=e,i=t,s=n||[],l=!1,y={p:f=0,n:0,v:_,a:p,f:p.bind(_,4),d:function(e,r){return a=e,u=0,c=_,y.n=r,v}},function(e,r,t){if(1<f)throw TypeError("Generator is already running");for(l&&1===r&&p(r,t),u=r,c=t;(g=u<2?_:c)||!l;){a||(u?u<3?(1<u&&(y.n=-1),p(u,c)):y.n=c:y.v=c);try{if(f=2,a){if(g=a[e=u?e:"next"]){if(!(g=g.call(a,c)))throw TypeError("iterator result is not an object");if(!g.done)return g;c=g.value,u<2&&(u=0)}else 1===u&&(g=a.return)&&g.call(a),u<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),u=1);a=_}else if((g=(l=y.n<0)?c:o.call(i,y))!==v)break}catch(e){a=_,u=1,c=e}finally{f=1}}return{value:g,done:l}}),!0),r;function p(e,r){for(u=e,c=r,g=0;!l&&f&&!t&&g<s.length;g++){var t,n=s[g],o=y.p,i=n[2];3<e?(t=i===r)&&(c=n[(u=n[4])?5:u=3],n[4]=n[5]=_):n[0]<=o&&((t=e<2&&o<n[1])?(u=0,y.v=r,y.n=n[1]):o<i&&(t=e<3||n[0]>r||i<r)&&(n[4]=e,n[5]=r,y.n=i,u=0))}if(t||1<e)return v;throw l=!0,r}}var v={};function h(){}function o(){}function i(){}var g=Object.getPrototypeOf,e=[][r]?g(g([][r]())):(_regeneratorDefine2(g={},r,function(){return this}),g),a=i.prototype=h.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,t,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",o.prototype=i),_regeneratorDefine2(i,"constructor",o),_regeneratorDefine2(i,t,o.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,t,"Generator"),_regeneratorDefine2(a,r,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:u}})()}function _regeneratorDefine2(e,r,t,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,r,t,n){function o(r,t){_regeneratorDefine2(e,r,function(e){return this._invoke(r,t,e)})}r?i?i(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(o("next",0),o("throw",1),o("return",2))})(e,r,t,n)}function asyncGeneratorStep(e,r,t,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var e=this,a=arguments;return new Promise(function(r,t){var n=u.apply(e,a);function o(e){asyncGeneratorStep(n,r,t,o,i,"next",e)}function i(e){asyncGeneratorStep(n,r,t,o,i,"throw",e)}o(void 0)})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,r){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);t=t.call(e,r||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}var OrnamentBlocksAPI=(()=>{return _createClass(function e(){_classCallCheck(this,e)},[{key:"setStaccato",value:(o=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setStaccato",[r,t]),e.n=1,this.runCommand("setStaccato",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return o.apply(this,arguments)})},{key:"setSlur",value:(t=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setSlur",[r,t]),e.n=1,this.runCommand("setSlur",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"doNeighbor",value:(n=_asyncToGenerator(_regenerator().m(function e(r,t,n){var o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return o=JSInterface.validateArgs("doNeighbor",[r,t,n]),e.n=1,this.runCommand("doNeighbor",[o[0],o[1],this.turIndex,MusicBlocks.BLK]);case 1:return e.n=2,o[2]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r,t){return n.apply(this,arguments)})}]);var n,t,o})();"undefined"!=typeof module&&module.exports&&(module.exports=OrnamentBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var d,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var o,a,i,u,c,f,s,l,y,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=r,s=n||[],l=!1,y={p:f=0,n:0,v:d,a:p,f:p.bind(d,4),d:function(e,t){return i=e,u=0,c=d,y.n=t,m}},function(e,t,r){if(1<f)throw TypeError("Generator is already running");for(l&&1===t&&p(t,r),u=t,c=r;(h=u<2?d:c)||!l;){i||(u?u<3?(1<u&&(y.n=-1),p(u,c)):y.n=c:y.v=c);try{if(f=2,i){if(h=i[e=u?e:"next"]){if(!(h=h.call(i,c)))throw TypeError("iterator result is not an object");if(!h.done)return h;c=h.value,u<2&&(u=0)}else 1===u&&(h=i.return)&&h.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),u=1);i=d}else if((h=(l=y.n<0)?c:o.call(a,y))!==m)break}catch(e){i=d,u=1,c=e}finally{f=1}}return{value:h,done:l}}),!0),t;function p(e,t){for(u=e,c=t,h=0;!l&&f&&!r&&h<s.length;h++){var r,n=s[h],o=y.p,a=n[2];3<e?(r=a===t)&&(c=n[(u=n[4])?5:u=3],n[4]=n[5]=d):n[0]<=o&&((r=e<2&&o<n[1])?(u=0,y.v=t,y.n=n[1]):o<a&&(r=e<3||n[0]>t||a<t)&&(n[4]=e,n[5]=t,y.n=a,u=0))}if(r||1<e)return m;throw l=!0,t}}var m={};function v(){}function o(){}function a(){}var h=Object.getPrototypeOf,e=[][t]?h(h([][t]())):(_regeneratorDefine2(h={},t,function(){return this}),h),i=a.prototype=v.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,r,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,r,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:u}})()}function _regeneratorDefine2(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,r,n){function o(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var e=this,i=arguments;return new Promise(function(t,r){var n=u.apply(e,i);function o(e){asyncGeneratorStep(n,t,r,o,a,"next",e)}function a(e){asyncGeneratorStep(n,t,r,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var PenBlocksAPI=(()=>{return _createClass(function e(){_classCallCheck(this,e)},[{key:"setColor",value:function(e){e=JSInterface.validateArgs("setColor",[e]);return this.runCommand("doSetColor",[e[0]])}},{key:"setGrey",value:function(e){e=JSInterface.validateArgs("setGrey",[e]);return this.runCommand("doSetChroma",[e[0]])}},{key:"setShade",value:function(e){e=JSInterface.validateArgs("setShade",[e]);return this.runCommand("doSetValue",[e[0]])}},{key:"setHue",value:function(e){e=JSInterface.validateArgs("setHue",[e]);return this.runCommand("doSetHue",[e[0]])}},{key:"setTranslucency",value:function(e){e=JSInterface.validateArgs("setTranslucency",[e]);return e[0]=1-e[0]/100,this.runCommand("doSetPenAlpha",[e[0]])}},{key:"setPensize",value:function(e){e=JSInterface.validateArgs("setPensize",[e]);return this.runCommand("doSetPensize",[e[0]])}},{key:"penUp",value:function(){return this.runCommand("doPenUp")}},{key:"penDown",value:function(){return this.runCommand("doPenDown")}},{key:"fillShape",value:(r=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.runCommand("doStartFill");case 1:return e.n=2,t();case 2:return e.n=3,this.runCommand("doEndFill");case 3:return globalActivity.turtles.refreshCanvas(),e.a(2,this.ENDFLOW)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"hollowLine",value:(t=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.runCommand("doStartHollowLine");case 1:return e.n=2,t();case 2:return e.n=3,this.runCommand("doEndHollowLine");case 3:return globalActivity.turtles.refreshCanvas(),e.a(2,this.ENDFLOW)}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"fillBackground",value:function(){var e=this;return this.runCommand("_anonymous",function(){return globalActivity.logo.turtles.setBackgroundColor(e.turIndex)})}},{key:"setFont",value:function(e){e=JSInterface.validateArgs("setFont",[e]);return this.runCommand("doSetFont",[e[0]])}}]);var t,r})();"undefined"!=typeof module&&module.exports&&(module.exports=PenBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var p,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var o,i,a,u,c,s,f,l,y,t=t&&t.prototype instanceof m?t:m,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,i=r,f=n||[],l=!1,y={p:s=0,n:0,v:p,a:h,f:h.bind(p,4),d:function(e,t){return a=e,u=0,c=p,y.n=t,v}},function(e,t,r){if(1<s)throw TypeError("Generator is already running");for(l&&1===t&&h(t,r),u=t,c=r;(d=u<2?p:c)||!l;){a||(u?u<3?(1<u&&(y.n=-1),h(u,c)):y.n=c:y.v=c);try{if(s=2,a){if(d=a[e=u?e:"next"]){if(!(d=d.call(a,c)))throw TypeError("iterator result is not an object");if(!d.done)return d;c=d.value,u<2&&(u=0)}else 1===u&&(d=a.return)&&d.call(a),u<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),u=1);a=p}else if((d=(l=y.n<0)?c:o.call(i,y))!==v)break}catch(e){a=p,u=1,c=e}finally{s=1}}return{value:d,done:l}}),!0),t;function h(e,t){for(u=e,c=t,d=0;!l&&s&&!r&&d<f.length;d++){var r,n=f[d],o=y.p,i=n[2];3<e?(r=i===t)&&(c=n[(u=n[4])?5:u=3],n[4]=n[5]=p):n[0]<=o&&((r=e<2&&o<n[1])?(u=0,y.v=t,y.n=n[1]):o<i&&(r=e<3||n[0]>t||i<t)&&(n[4]=e,n[5]=t,y.n=i,u=0))}if(r||1<e)return v;throw l=!0,t}}var v={};function m(){}function o(){}function i(){}var d=Object.getPrototypeOf,e=[][t]?d(d([][t]())):(_regeneratorDefine2(d={},t,function(){return this}),d),a=i.prototype=m.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",o.prototype=i),_regeneratorDefine2(i,"constructor",o),_regeneratorDefine2(i,r,o.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,r,"Generator"),_regeneratorDefine2(a,t,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:u}})()}function _regeneratorDefine2(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,t,r,n){function o(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=u.apply(e,a);function o(e){asyncGeneratorStep(n,t,r,o,i,"next",e)}function i(e){asyncGeneratorStep(n,t,r,o,i,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var PitchBlocksAPI=(()=>{return _createClass(function e(){_classCallCheck(this,e)},[{key:"playPitch",value:function(e,t){e=JSInterface.validateArgs("playPitch",[e,t]);return this.runCommand("playPitch",[e[0],e[1],0,this.turIndex,MusicBlocks.BLK])}},{key:"stepPitch",value:function(e){e=JSInterface.validateArgs("stepPitch",[e]);return this.runCommand("stepPitch",[e[0],this.turIndex])}},{key:"playNthModalPitch",value:function(e,t){e=JSInterface.validateArgs("playNthModalPitch",[e,t]);return this.runCommand("playNthModalPitch",[e[0],e[1],this.turIndex,MusicBlocks.BLK])}},{key:"playPitchNumber",value:function(e){e=JSInterface.validateArgs("playPitchNumber",[e]);return this.runCommand("playPitchNumber",[e[0],this.turIndex,MusicBlocks.BLK])}},{key:"playHertz",value:function(e){e=JSInterface.validateArgs("playHertz",[e]);return this.runCommand("playHertz",[e[0],this.turIndex])}},{key:"setAccidental",value:(i=_asyncToGenerator(_regenerator().m(function e(t,r){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setAccidental",[t,r]),e.n=1,this.runCommand("setAccidental",[n[0],this.turIndex,MusicBlocks.BLK]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"setScalarTranspose",value:(n=_asyncToGenerator(_regenerator().m(function e(t,r){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setScalarTranspose",[t,r]),e.n=1,this.runCommand("setScalarTranspose",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"setSemitoneTranspose",value:(r=_asyncToGenerator(_regenerator().m(function e(t,r){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setSemitoneTranspose",[t,r]),e.n=1,this.runCommand("setSemitoneTranspose",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"setRegister",value:function(e){e=JSInterface.validateArgs("setRegister",[e]);return this.runCommand("setRegister",[e[0],this.turIndex])}},{key:"invert",value:(o=_asyncToGenerator(_regenerator().m(function e(t,r,n,o){var i;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return i=JSInterface.validateArgs("invert",[t,r,n,o]),e.n=1,this.runCommand("invert",[i[0],i[1],i[2],this.turIndex]);case 1:return e.n=2,i[3]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,t,r,n){return o.apply(this,arguments)})},{key:"setPitchNumberOffset",value:function(e,t){e=JSInterface.validateArgs("setPitchNumberOffset",[e,t]);return this.runCommand("setPitchNumberOffset",[e[0],e[1],this.turIndex])}},{key:"numToPitch",value:function(e){e=JSInterface.validateArgs("numToPitch",[e]);return Singer.PitchActions.numToPitch(e[0],"pitch",this.turIndex)}},{key:"numToOctave",value:function(e){e=JSInterface.validateArgs("numToOctave",[e]);return Singer.PitchActions.numToPitch(e[0],"octave",this.turIndex)}}]);var o,r,n,i})();"undefined"!=typeof module&&module.exports&&(module.exports=PitchBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var h,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",t=e.toStringTag||"@@toStringTag";function n(e,r,t,n){var o,a,i,u,c,s,f,l,y,r=r&&r.prototype instanceof _?r:_,r=Object.create(r.prototype);return _regeneratorDefine2(r,"_invoke",(o=e,a=t,f=n||[],l=!1,y={p:s=0,n:0,v:h,a:p,f:p.bind(h,4),d:function(e,r){return i=e,u=0,c=h,y.n=r,m}},function(e,r,t){if(1<s)throw TypeError("Generator is already running");for(l&&1===r&&p(r,t),u=r,c=t;(v=u<2?h:c)||!l;){i||(u?u<3?(1<u&&(y.n=-1),p(u,c)):y.n=c:y.v=c);try{if(s=2,i){if(v=i[e=u?e:"next"]){if(!(v=v.call(i,c)))throw TypeError("iterator result is not an object");if(!v.done)return v;c=v.value,u<2&&(u=0)}else 1===u&&(v=i.return)&&v.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),u=1);i=h}else if((v=(l=y.n<0)?c:o.call(a,y))!==m)break}catch(e){i=h,u=1,c=e}finally{s=1}}return{value:v,done:l}}),!0),r;function p(e,r){for(u=e,c=r,v=0;!l&&s&&!t&&v<f.length;v++){var t,n=f[v],o=y.p,a=n[2];3<e?(t=a===r)&&(c=n[(u=n[4])?5:u=3],n[4]=n[5]=h):n[0]<=o&&((t=e<2&&o<n[1])?(u=0,y.v=r,y.n=n[1]):o<a&&(t=e<3||n[0]>r||a<r)&&(n[4]=e,n[5]=r,y.n=a,u=0))}if(t||1<e)return m;throw l=!0,r}}var m={};function _(){}function o(){}function a(){}var v=Object.getPrototypeOf,e=[][r]?v(v([][r]())):(_regeneratorDefine2(v={},r,function(){return this}),v),i=a.prototype=_.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,t,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,t,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,t,"Generator"),_regeneratorDefine2(i,r,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:u}})()}function _regeneratorDefine2(e,r,t,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,r,t,n){function o(r,t){_regeneratorDefine2(e,r,function(e){return this._invoke(r,t,e)})}r?a?a(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(o("next",0),o("throw",1),o("return",2))})(e,r,t,n)}function asyncGeneratorStep(e,r,t,n,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var e=this,i=arguments;return new Promise(function(r,t){var n=u.apply(e,i);function o(e){asyncGeneratorStep(n,r,t,o,a,"next",e)}function a(e){asyncGeneratorStep(n,r,t,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,r){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);t=t.call(e,r||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}var RhythmBlocksAPI=(()=>{return _createClass(function e(){_classCallCheck(this,e)},[{key:"playNote",value:(i=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("playNote",[r,t]),e.n=1,this.runCommand("playNote",[n[0],"newnote",this.turIndex,MusicBlocks.BLK]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return i.apply(this,arguments)})},{key:"playNoteMillis",value:(a=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("playNoteMillis",[r,t]),e.n=1,this.runCommand("playNote",[n[0],"osctime",this.turIndex,MusicBlocks.BLK]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return a.apply(this,arguments)})},{key:"playRest",value:function(){return this.runCommand("playRest",[this.turIndex])}},{key:"dot",value:(o=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("dot",[r,t]),e.n=1,this.runCommand("doRhythmicDot",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return o.apply(this,arguments)})},{key:"tie",value:(r=_asyncToGenerator(_regenerator().m(function e(r){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=JSInterface.validateArgs("tie",[r]),e.n=1,this.runCommand("doTie",[this.turIndex]);case 1:return e.n=2,t[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"multiplyNoteValue",value:(t=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("multiplyNoteValue",[r,t]),e.n=1,this.runCommand("multiplyNoteValue",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"swing",value:(n=_asyncToGenerator(_regenerator().m(function e(r,t,n){var o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return o=JSInterface.validateArgs("multiplyNoteValue",[r,t,n]),e.n=1,this.runCommand("addSwing",[o[0],o[1],this.turIndex]);case 1:return e.n=2,o[2]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r,t){return n.apply(this,arguments)})}]);var n,t,r,o,a,i})();"undefined"!=typeof module&&module.exports&&(module.exports=RhythmBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var h,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",t=e.toStringTag||"@@toStringTag";function n(e,r,t,n){var o,a,i,u,c,s,f,l,y,r=r&&r.prototype instanceof m?r:m,r=Object.create(r.prototype);return _regeneratorDefine2(r,"_invoke",(o=e,a=t,f=n||[],l=!1,y={p:s=0,n:0,v:h,a:p,f:p.bind(h,4),d:function(e,r){return i=e,u=0,c=h,y.n=r,d}},function(e,r,t){if(1<s)throw TypeError("Generator is already running");for(l&&1===r&&p(r,t),u=r,c=t;(_=u<2?h:c)||!l;){i||(u?u<3?(1<u&&(y.n=-1),p(u,c)):y.n=c:y.v=c);try{if(s=2,i){if(_=i[e=u?e:"next"]){if(!(_=_.call(i,c)))throw TypeError("iterator result is not an object");if(!_.done)return _;c=_.value,u<2&&(u=0)}else 1===u&&(_=i.return)&&_.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),u=1);i=h}else if((_=(l=y.n<0)?c:o.call(a,y))!==d)break}catch(e){i=h,u=1,c=e}finally{s=1}}return{value:_,done:l}}),!0),r;function p(e,r){for(u=e,c=r,_=0;!l&&s&&!t&&_<f.length;_++){var t,n=f[_],o=y.p,a=n[2];3<e?(t=a===r)&&(c=n[(u=n[4])?5:u=3],n[4]=n[5]=h):n[0]<=o&&((t=e<2&&o<n[1])?(u=0,y.v=r,y.n=n[1]):o<a&&(t=e<3||n[0]>r||a<r)&&(n[4]=e,n[5]=r,y.n=a,u=0))}if(t||1<e)return d;throw l=!0,r}}var d={};function m(){}function o(){}function a(){}var _=Object.getPrototypeOf,e=[][r]?_(_([][r]())):(_regeneratorDefine2(_={},r,function(){return this}),_),i=a.prototype=m.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,t,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,t,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,t,"Generator"),_regeneratorDefine2(i,r,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:u}})()}function _regeneratorDefine2(e,r,t,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,r,t,n){function o(r,t){_regeneratorDefine2(e,r,function(e){return this._invoke(r,t,e)})}r?a?a(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(o("next",0),o("throw",1),o("return",2))})(e,r,t,n)}function asyncGeneratorStep(e,r,t,n,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var e=this,i=arguments;return new Promise(function(r,t){var n=u.apply(e,i);function o(e){asyncGeneratorStep(n,r,t,o,a,"next",e)}function a(e){asyncGeneratorStep(n,r,t,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,r){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);t=t.call(e,r||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}var ToneBlocksAPI=(()=>{return _createClass(function e(){_classCallCheck(this,e)},[{key:"setInstrument",value:(c=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setInstrument",[r,t]),e.n=1,this.runCommand("setTimbre",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return c.apply(this,arguments)})},{key:"doVibrato",value:(u=_asyncToGenerator(_regenerator().m(function e(r,t,n){var o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return o=JSInterface.validateArgs("doVibrato",[r,t,n]),e.n=1,this.runCommand("doVibrato",[o[0],o[1],this.turIndex]);case 1:return e.n=2,o[2]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r,t){return u.apply(this,arguments)})},{key:"doChorus",value:(i=_asyncToGenerator(_regenerator().m(function e(r,t,n,o){var a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return a=JSInterface.validateArgs("doChorus",[r,t,n,o]),e.n=1,this.runCommand("doChorus",[a[0],a[1],a[2],this.turIndex]);case 1:return e.n=2,a[3]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r,t,n){return i.apply(this,arguments)})},{key:"doPhaser",value:(a=_asyncToGenerator(_regenerator().m(function e(r,t,n,o){var a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return a=JSInterface.validateArgs("doPhaser",[r,t,n,o]),e.n=1,this.runCommand("doPhaser",[a[0],a[1],a[2],this.turIndex]);case 1:return e.n=2,a[3]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r,t,n){return a.apply(this,arguments)})},{key:"doTremolo",value:(o=_asyncToGenerator(_regenerator().m(function e(r,t,n){var o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return o=JSInterface.validateArgs("doTremolo",[r,t,n]),e.n=1,this.runCommand("doTremolo",[o[0],o[1],this.turIndex]);case 1:return e.n=2,o[2]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r,t){return o.apply(this,arguments)})},{key:"doDistortion",value:(n=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("doDistortion",[r,t]),e.n=1,this.runCommand("doDistortion",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return n.apply(this,arguments)})},{key:"doHarmonic",value:(t=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("doHarmonic",[r,t]),e.n=1,this.runCommand("doHarmonic",[n[0],this.turIndex,MusicBlocks.BLK]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return t.apply(this,arguments)})}]);var t,n,o,a,i,u,c})();"undefined"!=typeof module&&module.exports&&(module.exports=ToneBlocksAPI);
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regenerator(){var d,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",t=e.toStringTag||"@@toStringTag";function n(e,r,t,n){var o,i,a,u,c,f,s,l,y,r=r&&r.prototype instanceof v?r:v,r=Object.create(r.prototype);return _regeneratorDefine2(r,"_invoke",(o=e,i=t,s=n||[],l=!1,y={p:f=0,n:0,v:d,a:p,f:p.bind(d,4),d:function(e,r){return a=e,u=0,c=d,y.n=r,m}},function(e,r,t){if(1<f)throw TypeError("Generator is already running");for(l&&1===r&&p(r,t),u=r,c=t;(h=u<2?d:c)||!l;){a||(u?u<3?(1<u&&(y.n=-1),p(u,c)):y.n=c:y.v=c);try{if(f=2,a){if(h=a[e=u?e:"next"]){if(!(h=h.call(a,c)))throw TypeError("iterator result is not an object");if(!h.done)return h;c=h.value,u<2&&(u=0)}else 1===u&&(h=a.return)&&h.call(a),u<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),u=1);a=d}else if((h=(l=y.n<0)?c:o.call(i,y))!==m)break}catch(e){a=d,u=1,c=e}finally{f=1}}return{value:h,done:l}}),!0),r;function p(e,r){for(u=e,c=r,h=0;!l&&f&&!t&&h<s.length;h++){var t,n=s[h],o=y.p,i=n[2];3<e?(t=i===r)&&(c=n[(u=n[4])?5:u=3],n[4]=n[5]=d):n[0]<=o&&((t=e<2&&o<n[1])?(u=0,y.v=r,y.n=n[1]):o<i&&(t=e<3||n[0]>r||i<r)&&(n[4]=e,n[5]=r,y.n=i,u=0))}if(t||1<e)return m;throw l=!0,r}}var m={};function v(){}function o(){}function i(){}var h=Object.getPrototypeOf,e=[][r]?h(h([][r]())):(_regeneratorDefine2(h={},r,function(){return this}),h),a=i.prototype=v.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,t,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",o.prototype=i),_regeneratorDefine2(i,"constructor",o),_regeneratorDefine2(i,t,o.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,t,"Generator"),_regeneratorDefine2(a,r,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:u}})()}function _regeneratorDefine2(e,r,t,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,r,t,n){function o(r,t){_regeneratorDefine2(e,r,function(e){return this._invoke(r,t,e)})}r?i?i(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(o("next",0),o("throw",1),o("return",2))})(e,r,t,n)}function asyncGeneratorStep(e,r,t,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var e=this,a=arguments;return new Promise(function(r,t){var n=u.apply(e,a);function o(e){asyncGeneratorStep(n,r,t,o,i,"next",e)}function i(e){asyncGeneratorStep(n,r,t,o,i,"throw",e)}o(void 0)})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,r){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);t=t.call(e,r||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}var VolumeBlocksAPI=(()=>{return _createClass(function e(){_classCallCheck(this,e)},[{key:"doCrescendo",value:(o=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("doCrescendo",[r,t]),e.n=1,this.runCommand("doCrescendo",["crescendo",n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return o.apply(this,arguments)})},{key:"doDecrescendo",value:(n=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("doDecrescendo",[r,t]),e.n=1,this.runCommand("doCrescendo",["decrescendo",n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return n.apply(this,arguments)})},{key:"setRelativeVolume",value:(t=_asyncToGenerator(_regenerator().m(function e(r,t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=JSInterface.validateArgs("setRelativeVolume",[r,t]),e.n=1,this.runCommand("setRelativeVolume",[n[0],this.turIndex]);case 1:return e.n=2,n[1]();case 2:return e.a(2,this.ENDFLOWCOMMAND)}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"setSynthVolume",value:function(e,r){e=JSInterface.validateArgs("setSynthVolume",[e,r]);return this.runCommand("setSynthVolume",[e[0],e[1],this.turIndex])}},{key:"getSynthVolume",value:function(e){e=JSInterface.validateArgs("getSynthVolume",[e]);return Singer.VolumeActions.getSynthVolume(e[0],this.turIndex)}}]);var t,n,o})();"undefined"!=typeof module&&module.exports&&(module.exports=VolumeBlocksAPI);
function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var r;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(r="Object"===(r={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var ASTUtils=require("../ASTutils");global.last=jest.fn(function(t){return t[t.length-1]}),global.JSInterface={isSetter:jest.fn(),getSetterName:jest.fn(),isMethod:jest.fn(),isClampBlock:jest.fn(),getMethodName:jest.fn(function(t){return t}),isGetter:jest.fn(),getGetterName:jest.fn(function(t){return t}),methodReturns:jest.fn(),rearrangeMethodArgs:jest.fn(function(t,e){return e})},ASTUtils.JSInterface=JSInterface,describe("ASTUtils",function(){beforeEach(function(){jest.clearAllMocks()}),describe("BAREBONE_AST",function(){it("should return the barebone AST",function(){var t=ASTUtils.BAREBONE_AST;expect(t).toEqual(ASTUtils._bareboneAST)})}),describe("_getSetAST",function(){it("should return the AST for a setter statement",function(){var t="testIdentifier",e=["testArg"],r=ASTUtils._getSetAST(t,e);expect(r).toEqual({type:"ExpressionStatement",expression:{type:"AssignmentExpression",left:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"".concat(t)}},operator:"=",right:ASTUtils._getArgsAST(e)[0]}})})}),describe("_getGetAST",function(){it("should return the AST for a getter statement",function(){var t="testIdentifier",e=ASTUtils._getGetAST(t);expect(e).toEqual({type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"".concat(t)}})})}),describe("_getGetAST",function(){it("should return the AST for a getter statement",function(){var t="testIdentifier",e=ASTUtils._getGetAST(t);expect(e).toEqual({type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"".concat(t)}})})}),describe("_getIfAST",function(){it("should return the AST for an if statement",function(){var t=["testArg"],e=[["action1",["arg1"]]],r=(JSInterface.isMethod.mockReturnValue(!0),JSInterface.isClampBlock.mockReturnValue(!1),ASTUtils._getIfAST(t,e,void 0,0));expect(r).toEqual({type:"IfStatement",test:ASTUtils._getArgsAST(t)[0],consequent:{type:"BlockStatement",body:ASTUtils._getBlockAST(e,0)},alternate:null})}),it("should return the AST for an if-else statement",function(){var t=["testArg"],e=[["action1",["arg1"]]],r=[["action2",["arg2"]]],n=(JSInterface.isMethod.mockReturnValue(!0),JSInterface.isClampBlock.mockReturnValue(!1),ASTUtils._getIfAST(t,e,r,0));expect(n).toEqual({type:"IfStatement",test:ASTUtils._getArgsAST(t)[0],consequent:{type:"BlockStatement",body:ASTUtils._getBlockAST(e,0)},alternate:{type:"BlockStatement",body:ASTUtils._getBlockAST(r,0)}})})}),describe("_getForLoopAST",function(){it("should return the AST for a for-loop statement",function(){var t=["testArg"],e=["flow"],r=ASTUtils._getForLoopAST(t,e,0);expect(r).toEqual({type:"ForStatement",init:{type:"VariableDeclaration",kind:"let",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"i0"},init:{type:"Literal",value:0}}]},test:{type:"BinaryExpression",left:{type:"Identifier",name:"i0"},right:ASTUtils._getArgsAST(t)[0],operator:"<"},update:{type:"UpdateExpression",argument:{type:"Identifier",name:"i0"},operator:"++",prefix:!1},body:{type:"BlockStatement",body:ASTUtils._getBlockAST(e,1)}})})}),describe("_getWhileLoopAST",function(){it("should return the AST for a while-loop statement",function(){var t=["testArg"],e=["flow"],r=ASTUtils._getWhileLoopAST(t,e,0);expect(r).toEqual({type:"WhileStatement",test:ASTUtils._getArgsAST(t)[0],body:{type:"BlockStatement",body:ASTUtils._getBlockAST(e,0)}})})}),describe("_getDoWhileLoopAST",function(){it("should return the AST for a do-while-loop statement",function(){var t=["testArg"],e=["flow"],r=ASTUtils._getDoWhileLoopAST(t,e,0);expect(r).toEqual({type:"DoWhileStatement",body:{type:"BlockStatement",body:ASTUtils._getBlockAST(e,0)},test:ASTUtils._getArgsAST(t)[0]})})}),describe("_getIncrementStmntAST",function(){it("should return the AST for an increment statement",function(){var t=ASTUtils._getIncrementStmntAST(["var_testIdentifier","testArg"],!0);expect(t).toEqual({type:"ExpressionStatement",expression:{type:"AssignmentExpression",left:{type:"Identifier",name:"testIdentifier"},operator:"=",right:{type:"BinaryExpression",left:{type:"Identifier",name:"testIdentifier"},right:ASTUtils._getArgsAST(["testArg"])[0],operator:"+"}}})}),it("should return the AST for a decrement statement",function(){var t=ASTUtils._getIncrementStmntAST(["var_testIdentifier","testArg"],!1);expect(t).toEqual({type:"ExpressionStatement",expression:{type:"AssignmentExpression",left:{type:"Identifier",name:"testIdentifier"},operator:"=",right:{type:"BinaryExpression",left:{type:"Identifier",name:"testIdentifier"},right:ASTUtils._getArgsAST(["testArg"])[0],operator:"-"}}})})}),describe("_getMethodDefAST",function(){it("should return the AST for a method definition",function(){var t="testMethod",e=ASTUtils._getMethodDefAST(t);expect(e).toEqual({type:"VariableDeclaration",kind:"let",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"".concat(t)},init:{type:"ArrowFunctionExpression",params:[{type:"Identifier",name:"mouse"}],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"ENDFLOW"}}}]},async:!0,expression:!1}}]})})}),describe("_getMethodCallAST",function(){it("should return the AST for a method call without function argument",function(){var t="testMethod",e=["testArg"],r=(JSInterface.getMethodName.mockReturnValue(t),ASTUtils._getMethodCallAST(t,e,{action:!1,statement:!0}));expect(r).toEqual({type:"ExpressionStatement",expression:{type:"AwaitExpression",argument:{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:t}},arguments:ASTUtils._getArgsAST(e)}}})}),it("should return the AST for a method call with action property",function(){var t="testMethod",e=ASTUtils._getMethodCallAST(t,["testArg"],{action:!0,statement:!0});expect(e).toEqual({type:"ExpressionStatement",expression:{type:"AwaitExpression",argument:{type:"CallExpression",callee:{type:"Identifier",name:"".concat(t)},arguments:[{type:"Identifier",name:"mouse"}]}}})}),it("should return the AST for a method call with statement property false",function(){var t="testMethod",e=["testArg"],r=ASTUtils._getMethodCallAST(t,e,{action:!1,statement:!1});expect(r).toEqual({type:"AwaitExpression",argument:{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"".concat(JSInterface.getMethodName(t))}},arguments:ASTUtils._getArgsAST(JSInterface.rearrangeMethodArgs(t,e))}})})}),describe("_getArgExpAST",function(){it("should return the AST for a binary expression",function(){var t=["arg1","arg2"],e=ASTUtils._getArgExpAST("plus",t);expect(e).toEqual({type:"BinaryExpression",left:ASTUtils._getArgsAST([t[0]])[0],right:ASTUtils._getArgsAST([t[1]])[0],operator:"+"})}),it("should return the AST for a unary expression",function(){var t=["arg1"],e=ASTUtils._getArgExpAST("not",t);expect(e).toEqual({type:"UnaryExpression",operator:"!",argument:ASTUtils._getArgsAST([t[0]])[0],prefix:!0})}),it("should return the AST for a method call expression",function(){var t=["arg1"],e=ASTUtils._getArgExpAST("abs",t);expect(e).toEqual({type:"CallExpression",callee:{type:"Identifier",name:"Math.abs"},arguments:ASTUtils._getArgsAST(t)})})}),describe("_getArgsAST",function(){it("should return an empty array for undefined or null args",function(){expect(ASTUtils._getArgsAST(void 0)).toEqual([]),expect(ASTUtils._getArgsAST(null)).toEqual([])}),it("should return the AST for a literal argument",function(){var t=ASTUtils._getArgsAST(["testArg"]);expect(t).toEqual([{type:"Literal",value:"testArg"}])}),it("should return the AST for a boolean argument",function(){var t=ASTUtils._getArgsAST(["bool_true"]);expect(t).toEqual([{type:"Literal",value:!0}])}),it("should return the AST for a box argument",function(){var t=ASTUtils._getArgsAST(["box_testBox"]);expect(t).toEqual([{type:"Identifier",name:"testBox"}])}),it("should return the AST for a getter argument",function(){JSInterface.isGetter.mockReturnValue(!0),JSInterface.getGetterName.mockReturnValue("testGetter");var t=ASTUtils._getArgsAST([{0:"getter_testGetter"}]);expect(t).toEqual([ASTUtils._getGetAST("testGetter")])}),it("should return the AST for a method call argument",function(){JSInterface.isGetter.mockReturnValue(!1),JSInterface.methodReturns.mockReturnValue(!0);var t=ASTUtils._getArgsAST([{0:"testMethod",1:["testArg"]}]);expect(t).toEqual([ASTUtils._getMethodCallAST("testMethod",["testArg"],{statement:!1})])}),it("should return the AST for a method call argument with methodReturns true",function(){JSInterface.methodReturns=jest.fn().mockReturnValue(!0);var t=ASTUtils._getArgsAST([{0:"testMethod",1:["testArg"]}]);expect(t).toEqual([ASTUtils._getMethodCallAST("testMethod",["testArg"],{statement:!1})])}),it("should return the AST for a method call argument with methodReturns false",function(){JSInterface.methodReturns=jest.fn().mockReturnValue(!1);var t=ASTUtils._getArgsAST([{0:"testMethod",1:["testArg"]}]);expect(t).toEqual([ASTUtils._getArgExpAST("testMethod",["testArg"])])})}),describe("_getMethodCallClampAST",function(){it("should return the AST for a method call with function argument",function(){var t="testMethod",e=["testArg"],r=["flow"],n=ASTUtils._getMethodCallClampAST(t,e,r,0);expect(n).toEqual({type:"ExpressionStatement",expression:{type:"AwaitExpression",argument:{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"".concat(JSInterface.getMethodName(t))}},arguments:[].concat(_toConsumableArray(ASTUtils._getArgsAST(JSInterface.rearrangeMethodArgs(t,e))),[{type:"ArrowFunctionExpression",params:[],body:{type:"BlockStatement",body:[].concat(_toConsumableArray(ASTUtils._getBlockAST(r,0)),[{type:"ReturnStatement",argument:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"ENDFLOW"}}}])},async:!0,expression:!1}])}}})})}),describe("_getBlockAST",function(){it("should return an empty array for undefined or null flows",function(){expect(ASTUtils._getBlockAST(void 0)).toEqual([]),expect(ASTUtils._getBlockAST(null)).toEqual([])}),it("should return the AST for an if block",function(){JSInterface.isMethod.mockReturnValue(!0),JSInterface.isClampBlock.mockReturnValue(!1);var t=ASTUtils._getBlockAST([["if",["testArg"],[["action1",["arg1"]]]]]);expect(t).toEqual([ASTUtils._getIfAST(["testArg"],[["action1",["arg1"]]],void 0,0)])}),it("should return the AST for an if-else block",function(){var t=ASTUtils._getBlockAST([["ifthenelse",["testArg"],["ifFlow"],["elseFlow"]]],0);expect(t).toEqual([ASTUtils._getIfAST(["testArg"],["ifFlow"],["elseFlow"],0)])}),it("should return the AST for a repeat block",function(){var t=ASTUtils._getBlockAST([["repeat",["testArg"],["flow"]]],0);expect(t).toEqual([ASTUtils._getForLoopAST(["testArg"],["flow"],0)])}),it("should return the AST for a while block",function(){var t=ASTUtils._getBlockAST([["while",["testArg"],["flow"]]],0);expect(t).toEqual([ASTUtils._getWhileLoopAST(["testArg"],["flow"],0)])}),it("should return the AST for an until block",function(){var t=ASTUtils._getBlockAST([["until",["testArg"],["flow"]]],0);expect(t).toEqual([ASTUtils._getDoWhileLoopAST(["testArg"],["flow"],0)])}),it("should return the AST for a break block",function(){var t=ASTUtils._getBlockAST([["break"]]);expect(t).toEqual([{type:"BreakStatement",label:null}])}),it("should return the AST for a switch block",function(){var t=ASTUtils._getBlockAST([["switch",["testArg"],["flow"]]],0);expect(t).toEqual([{type:"SwitchStatement",discriminant:ASTUtils._getArgsAST(["testArg"])[0],cases:ASTUtils._getBlockAST(["flow"],0)}])}),it("should return the AST for a case block",function(){var t=ASTUtils._getBlockAST([["case",["testArg"],["flow"]]],0);expect(t).toEqual([{type:"SwitchCase",test:ASTUtils._getArgsAST(["testArg"])[0],consequent:[].concat(_toConsumableArray(ASTUtils._getBlockAST(["flow"],0)),[{type:"BreakStatement",label:null}])}])}),it("should return the AST for an increment block",function(){var t=ASTUtils._getBlockAST([["increment",["testIdentifier","testArg"]]]);expect(t).toEqual([ASTUtils._getIncrementStmntAST(["testIdentifier","testArg"],!0)])}),it("should return the AST for an incrementOne block",function(){var t=ASTUtils._getBlockAST([["incrementOne",["testIdentifier"]]]);expect(t).toEqual([ASTUtils._getIncrementStmntAST(["testIdentifier",1],!0)])}),it("should return the AST for a decrementOne block",function(){var t=ASTUtils._getBlockAST([["decrementOne",["testIdentifier"]]]);expect(t).toEqual([ASTUtils._getIncrementStmntAST(["testIdentifier",1],!1)])}),it("should return the AST for a storein block",function(){var t=ASTUtils._getBlockAST([["storein",["testIdentifier","testArg"]]]);expect(t).toEqual([{type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"testIdentifier"},init:ASTUtils._getArgsAST(["testArg"])[0]}]}])}),it("should return the AST for a storein2 block",function(){var t=ASTUtils._getBlockAST([["storein2_testIdentifier",["testArg"]]]);expect(t).toEqual([{type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"testIdentifier"},init:ASTUtils._getArgsAST(["testArg"])[0]}]}])}),it("should return the AST for a nameddo block",function(){var t=ASTUtils._getBlockAST([["nameddo_testMethod",["testArg"]]]);expect(t).toEqual([ASTUtils._getMethodCallAST("testMethod",["testArg"],{action:!0})])})}),describe("getMethodAST",function(){it("should return the AST for a method",function(){var t="testMethod",e=["flow"],r=ASTUtils.getMethodAST(t,e);expect(r).toEqual({type:"VariableDeclaration",kind:"let",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"".concat(t)},init:{type:"ArrowFunctionExpression",params:[{type:"Identifier",name:"mouse"}],body:{type:"BlockStatement",body:[].concat(_toConsumableArray(ASTUtils._getBlockAST(e)),[{type:"ReturnStatement",argument:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"ENDFLOW"}}}])},async:!0,expression:!1}}]})})}),describe("getMouseAST",function(){it("should return the AST for a mouse",function(){var t=["flow"],e=ASTUtils.getMouseAST(t);expect(e).toEqual({type:"ExpressionStatement",expression:{type:"NewExpression",callee:{type:"Identifier",name:"Mouse"},arguments:[{type:"ArrowFunctionExpression",params:[{type:"Identifier",name:"mouse"}],body:{type:"BlockStatement",body:[].concat(_toConsumableArray(ASTUtils._getBlockAST(t)),[{type:"ReturnStatement",argument:{type:"MemberExpression",object:{type:"Identifier",name:"mouse"},computed:!1,property:{type:"Identifier",name:"ENDMOUSE"}}}])},async:!0,expression:!1}]}})})})});
var acorn=require("../../../lib/acorn.min"),_require=require("../ast2blocklist"),AST2BlockList=_require.AST2BlockList,fs=require("fs"),path=require("path");describe("AST2BlockList Class",function(){var u;beforeAll(function(){var e=path.join(__dirname,"..","ast2blocks.json"),e=fs.readFileSync(e,"utf8");u=JSON.parse(e)}),beforeEach(function(){jest.clearAllMocks()}),test("should throw error for unsupported call",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.setMusicInstrument("guitar", async () => {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("G♭", 2);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020});try{AST2BlockList.toBlockList(e,u)}catch(e){expect(e.prefix).toEqual("Unsupported statement: ")}}),test("should throw error for unsupported assignment expression",function(){var n='\n        new Mouse(async mouse => {\n            await mouse.setInstrument("guitar", async () => {\n                box1 = box2 - 1;\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("G♭", box1);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',e=acorn.parse(n,{ecmaVersion:2020});try{AST2BlockList.toBlockList(e,u)}catch(e){expect(e.prefix+n.substring(e.start,e.end)).toEqual("Unsupported AssignmentExpression: box1 = box2 - 1")}}),test("should throw error for unsupported binary operator",function(){var n='\n        new Mouse(async mouse => {\n            await mouse.setInstrument("guitar", async () => {\n                await mouse.playNote(1 << 2, async () => {\n                    await mouse.playPitch("G♭", 3);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',e=acorn.parse(n,{ecmaVersion:2020});try{AST2BlockList.toBlockList(e,u)}catch(e){expect(e.prefix+n.substring(e.start,e.end)).toEqual("Unsupported operator <<: 1 << 2")}}),test("should throw error for unsupported unary operator",function(){var n='\n        new Mouse(async mouse => {\n            await mouse.setInstrument("guitar", async () => {\n                await mouse.playNote(~2, async () => {\n                    await mouse.playPitch("G♭", 3);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',e=acorn.parse(n,{ecmaVersion:2020});try{AST2BlockList.toBlockList(e,u)}catch(e){expect(e.prefix+n.substring(e.start,e.end)).toEqual("Unsupported operator ~: ~2")}}),test("should throw error for unsupported function call",function(){var n='\n        new Mouse(async mouse => {\n            await mouse.setInstrument("guitar", async () => {\n                await mouse.playNote(Math.unsupported(1), async () => {\n                    await mouse.playPitch("G♭", 3);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',e=acorn.parse(n,{ecmaVersion:2020});try{AST2BlockList.toBlockList(e,u)}catch(e){expect(e.prefix+n.substring(e.start,e.end)).toEqual("Unsupported operator unsupported: Math.unsupported(1)")}}),test("should throw error for unsupported argument type",function(){var n='\n        new Mouse(async mouse => {\n            await mouse.setInstrument("guitar", async () => {\n                await mouse.playNote([1], async () => {\n                    await mouse.playPitch("G♭", 3);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',e=acorn.parse(n,{ecmaVersion:2020});try{AST2BlockList.toBlockList(e,u)}catch(e){expect(e.prefix+n.substring(e.start,e.end)).toEqual("Unsupported argument type ArrayExpression: [1]")}}),test("should throw error for unsupported statement",function(){var n="console.log('test');",e=acorn.parse(n,{ecmaVersion:2020});try{AST2BlockList.toBlockList(e,u)}catch(e){expect(e.prefix+n.substring(e.start,e.end)).toEqual("Unsupported statement: console.log('test');")}}),test("should generate correct blockList for a single note",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.setInstrument("guitar", async () => {\n                await mouse.playNote(Math.abs(-2) * 1, async () => {\n                    await mouse.playPitch("G♭", Math.abs(-2));\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"settimbre",0,0,[0,2,3,null]],[2,["voicename",{value:"guitar"}],0,0,[1]],[3,"newnote",0,0,[1,4,9,null]],[4,"multiply",0,0,[3,5,8]],[5,"abs",0,0,[4,6]],[6,"neg",0,0,[5,7]],[7,["number",{value:2}],0,0,[6]],[8,["number",{value:1}],0,0,[4]],[9,"vspace",0,0,[3,10]],[10,"pitch",0,0,[9,11,12,null]],[11,["notename",{value:"G♭"}],0,0,[10]],[12,"abs",0,0,[10,13]],[13,"neg",0,0,[12,14]],[14,["number",{value:2}],0,0,[13]]])}),test("should generate correct blockList for repeat",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.setInstrument("clarinet", async () => {\n                for (let i0 = 0; i0 < MathUtility.doRandom(1, 5); i0++) {\n                    await mouse.playNote(1 / 4, async () => {\n                        await mouse.playPitch("fa", 2 * 2);\n                        return mouse.ENDFLOW;\n                    });\n                }\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"settimbre",0,0,[0,2,3,null]],[2,["voicename",{value:"clarinet"}],0,0,[1]],[3,"repeat",0,0,[1,4,7,null]],[4,"random",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:5}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"newnote",0,0,[7,9,12,null]],[9,"divide",0,0,[8,10,11]],[10,["number",{value:1}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"vspace",0,0,[8,13]],[13,"pitch",0,0,[12,14,15,18]],[14,["solfege",{value:"fa"}],0,0,[13]],[15,"multiply",0,0,[13,16,17]],[16,["number",{value:2}],0,0,[15]],[17,["number",{value:2}],0,0,[15]],[18,"vspace",0,0,[13,null]]])}),test("should generate correct blockList for if",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            if (!(1 == MathUtility.doRandom(0, 1))) {\n                await mouse.setInstrument("electronic synth", async () => {\n                    await mouse.playNote(1 / 4, async () => {\n                        await mouse.playPitch("sol", 4);\n                        return mouse.ENDFLOW;\n                    });\n                    return mouse.ENDFLOW;\n                });\n            }\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"if",0,0,[0,2,8,null]],[2,"not",0,0,[1,3]],[3,"equal",0,0,[2,4,5]],[4,["number",{value:1}],0,0,[3]],[5,"random",0,0,[3,6,7]],[6,["number",{value:0}],0,0,[5]],[7,["number",{value:1}],0,0,[5]],[8,"vspace",0,0,[1,9]],[9,"settimbre",0,0,[8,10,11,null]],[10,["voicename",{value:"electronic synth"}],0,0,[9]],[11,"newnote",0,0,[9,12,15,null]],[12,"divide",0,0,[11,13,14]],[13,["number",{value:1}],0,0,[12]],[14,["number",{value:4}],0,0,[12]],[15,"vspace",0,0,[11,16]],[16,"pitch",0,0,[15,17,18,null]],[17,["solfege",{value:"sol"}],0,0,[16]],[18,["number",{value:4}],0,0,[16]]])}),test("should generate correct blockList for action with recursion",function(){var e=acorn.parse('\n        let playSol = async mouse => {\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("sol", 2);\n                return mouse.ENDFLOW;\n            });\n            box1 = box1 - 1;\n            box1 = box1 + 1;\n            if (box1 > 0) {\n                await playSol(mouse);\n            }\n            return mouse.ENDFLOW;\n        };\n        new Mouse(async mouse => {\n            var box1 = Math.abs(-2) * 3;\n            await mouse.setInstrument("electronic synth", async () => {\n                await playSol(mouse);\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"action",200,200,[null,1,2,null]],[1,["text",{value:"playSol"}],0,0,[0]],[2,"newnote",0,0,[0,3,6,10]],[3,"divide",0,0,[2,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"vspace",0,0,[2,7]],[7,"pitch",0,0,[6,8,9,null]],[8,["solfege",{value:"sol"}],0,0,[7]],[9,["number",{value:2}],0,0,[7]],[10,"decrementOne",0,0,[2,11,12]],[11,["namedbox",{value:"box1"}],0,0,[10]],[12,"increment",0,0,[10,13,14,15]],[13,["namedbox",{value:"box1"}],0,0,[12]],[14,["number",{value:1}],0,0,[12]],[15,"if",0,0,[12,16,19,null]],[16,"greater",0,0,[15,17,18]],[17,["namedbox",{value:"box1"}],0,0,[16]],[18,["number",{value:0}],0,0,[16]],[19,["nameddo",{value:"playSol"}],0,0,[15,null]],[20,"start",500,200,[null,21,null]],[21,["storein2",{value:"box1"}],0,0,[20,22,27]],[22,"multiply",0,0,[21,23,26]],[23,"abs",0,0,[22,24]],[24,"neg",0,0,[23,25]],[25,["number",{value:2}],0,0,[24]],[26,["number",{value:3}],0,0,[22]],[27,"vspace",0,0,[21,28]],[28,"settimbre",0,0,[27,29,30,null]],[29,["voicename",{value:"electronic synth"}],0,0,[28]],[30,["nameddo",{value:"playSol"}],0,0,[28,null]]])}),test("should generate correct blockList for action with recursion",function(){var e=acorn.parse('\n        let chunk0 = async mouse => {\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("sol", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("la", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("ti", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("sol", 4);\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDFLOW;\n        };\n        let chunk1 = async mouse => {\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("ti", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("do", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 2, async () => {\n                await mouse.playPitch("re", 5);\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDFLOW;\n        };\n        let chunk2 = async mouse => {\n            await mouse.playNote(1 / 8, async () => {\n                await mouse.playPitch("re", 5);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 8, async () => {\n                await mouse.playPitch("mi", 5);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 8, async () => {\n                await mouse.playPitch("re", 5);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 8, async () => {\n                await mouse.playPitch("do", 5);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("ti", 5);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("sol", 4);\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDFLOW;\n        };\n        let chunk3 = async mouse => {\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("sol", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("re", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("sol", 4);\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDFLOW;\n        };\n        new Mouse(async mouse => {\n            for (let i0 = 0; i0 < 2; i0++) {\n                await chunk0(mouse);\n            }\n            for (let i0 = 0; i0 < 2; i0++) {\n                await chunk1(mouse);\n            }\n            for (let i0 = 0; i0 < 2; i0++) {\n                await chunk2(mouse);\n            }\n            for (let i0 = 0; i0 < 2; i0++) {\n                await chunk3(mouse);\n            }\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"action",200,200,[null,1,2,null]],[1,["text",{value:"chunk0"}],0,0,[0]],[2,"newnote",0,0,[0,3,6,10]],[3,"divide",0,0,[2,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"vspace",0,0,[2,7]],[7,"pitch",0,0,[6,8,9,null]],[8,["solfege",{value:"sol"}],0,0,[7]],[9,["number",{value:4}],0,0,[7]],[10,"newnote",0,0,[2,11,14,18]],[11,"divide",0,0,[10,12,13]],[12,["number",{value:1}],0,0,[11]],[13,["number",{value:4}],0,0,[11]],[14,"vspace",0,0,[10,15]],[15,"pitch",0,0,[14,16,17,null]],[16,["solfege",{value:"la"}],0,0,[15]],[17,["number",{value:4}],0,0,[15]],[18,"newnote",0,0,[10,19,22,26]],[19,"divide",0,0,[18,20,21]],[20,["number",{value:1}],0,0,[19]],[21,["number",{value:4}],0,0,[19]],[22,"vspace",0,0,[18,23]],[23,"pitch",0,0,[22,24,25,null]],[24,["solfege",{value:"ti"}],0,0,[23]],[25,["number",{value:4}],0,0,[23]],[26,"newnote",0,0,[18,27,30,null]],[27,"divide",0,0,[26,28,29]],[28,["number",{value:1}],0,0,[27]],[29,["number",{value:4}],0,0,[27]],[30,"vspace",0,0,[26,31]],[31,"pitch",0,0,[30,32,33,null]],[32,["solfege",{value:"sol"}],0,0,[31]],[33,["number",{value:4}],0,0,[31]],[34,"action",500,200,[null,35,36,null]],[35,["text",{value:"chunk1"}],0,0,[34]],[36,"newnote",0,0,[34,37,40,44]],[37,"divide",0,0,[36,38,39]],[38,["number",{value:1}],0,0,[37]],[39,["number",{value:4}],0,0,[37]],[40,"vspace",0,0,[36,41]],[41,"pitch",0,0,[40,42,43,null]],[42,["solfege",{value:"ti"}],0,0,[41]],[43,["number",{value:4}],0,0,[41]],[44,"newnote",0,0,[36,45,48,52]],[45,"divide",0,0,[44,46,47]],[46,["number",{value:1}],0,0,[45]],[47,["number",{value:4}],0,0,[45]],[48,"vspace",0,0,[44,49]],[49,"pitch",0,0,[48,50,51,null]],[50,["solfege",{value:"do"}],0,0,[49]],[51,["number",{value:4}],0,0,[49]],[52,"newnote",0,0,[44,53,56,null]],[53,"divide",0,0,[52,54,55]],[54,["number",{value:1}],0,0,[53]],[55,["number",{value:2}],0,0,[53]],[56,"vspace",0,0,[52,57]],[57,"pitch",0,0,[56,58,59,null]],[58,["solfege",{value:"re"}],0,0,[57]],[59,["number",{value:5}],0,0,[57]],[60,"action",800,200,[null,61,62,null]],[61,["text",{value:"chunk2"}],0,0,[60]],[62,"newnote",0,0,[60,63,66,70]],[63,"divide",0,0,[62,64,65]],[64,["number",{value:1}],0,0,[63]],[65,["number",{value:8}],0,0,[63]],[66,"vspace",0,0,[62,67]],[67,"pitch",0,0,[66,68,69,null]],[68,["solfege",{value:"re"}],0,0,[67]],[69,["number",{value:5}],0,0,[67]],[70,"newnote",0,0,[62,71,74,78]],[71,"divide",0,0,[70,72,73]],[72,["number",{value:1}],0,0,[71]],[73,["number",{value:8}],0,0,[71]],[74,"vspace",0,0,[70,75]],[75,"pitch",0,0,[74,76,77,null]],[76,["solfege",{value:"mi"}],0,0,[75]],[77,["number",{value:5}],0,0,[75]],[78,"newnote",0,0,[70,79,82,86]],[79,"divide",0,0,[78,80,81]],[80,["number",{value:1}],0,0,[79]],[81,["number",{value:8}],0,0,[79]],[82,"vspace",0,0,[78,83]],[83,"pitch",0,0,[82,84,85,null]],[84,["solfege",{value:"re"}],0,0,[83]],[85,["number",{value:5}],0,0,[83]],[86,"newnote",0,0,[78,87,90,94]],[87,"divide",0,0,[86,88,89]],[88,["number",{value:1}],0,0,[87]],[89,["number",{value:8}],0,0,[87]],[90,"vspace",0,0,[86,91]],[91,"pitch",0,0,[90,92,93,null]],[92,["solfege",{value:"do"}],0,0,[91]],[93,["number",{value:5}],0,0,[91]],[94,"newnote",0,0,[86,95,98,102]],[95,"divide",0,0,[94,96,97]],[96,["number",{value:1}],0,0,[95]],[97,["number",{value:4}],0,0,[95]],[98,"vspace",0,0,[94,99]],[99,"pitch",0,0,[98,100,101,null]],[100,["solfege",{value:"ti"}],0,0,[99]],[101,["number",{value:5}],0,0,[99]],[102,"newnote",0,0,[94,103,106,null]],[103,"divide",0,0,[102,104,105]],[104,["number",{value:1}],0,0,[103]],[105,["number",{value:4}],0,0,[103]],[106,"vspace",0,0,[102,107]],[107,"pitch",0,0,[106,108,109,null]],[108,["solfege",{value:"sol"}],0,0,[107]],[109,["number",{value:4}],0,0,[107]],[110,"action",1100,200,[null,111,112,null]],[111,["text",{value:"chunk3"}],0,0,[110]],[112,"newnote",0,0,[110,113,116,120]],[113,"divide",0,0,[112,114,115]],[114,["number",{value:1}],0,0,[113]],[115,["number",{value:4}],0,0,[113]],[116,"vspace",0,0,[112,117]],[117,"pitch",0,0,[116,118,119,null]],[118,["solfege",{value:"sol"}],0,0,[117]],[119,["number",{value:4}],0,0,[117]],[120,"newnote",0,0,[112,121,124,128]],[121,"divide",0,0,[120,122,123]],[122,["number",{value:1}],0,0,[121]],[123,["number",{value:4}],0,0,[121]],[124,"vspace",0,0,[120,125]],[125,"pitch",0,0,[124,126,127,null]],[126,["solfege",{value:"re"}],0,0,[125]],[127,["number",{value:4}],0,0,[125]],[128,"newnote",0,0,[120,129,132,null]],[129,"divide",0,0,[128,130,131]],[130,["number",{value:1}],0,0,[129]],[131,["number",{value:4}],0,0,[129]],[132,"vspace",0,0,[128,133]],[133,"pitch",0,0,[132,134,135,null]],[134,["solfege",{value:"sol"}],0,0,[133]],[135,["number",{value:4}],0,0,[133]],[136,"start",1400,200,[null,137,null]],[137,"repeat",0,0,[136,138,139,140]],[138,["number",{value:2}],0,0,[137]],[139,["nameddo",{value:"chunk0"}],0,0,[137,null]],[140,"repeat",0,0,[137,141,142,143]],[141,["number",{value:2}],0,0,[140]],[142,["nameddo",{value:"chunk1"}],0,0,[140,null]],[143,"repeat",0,0,[140,144,145,146]],[144,["number",{value:2}],0,0,[143]],[145,["nameddo",{value:"chunk2"}],0,0,[143,null]],[146,"repeat",0,0,[143,147,148,null]],[147,["number",{value:2}],0,0,[146]],[148,["nameddo",{value:"chunk3"}],0,0,[146,null]]])}),test("should generate correct blockList for dictionary operations",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.setValue("key", 2);\n            await mouse.setValue("do", await mouse.getValue("key"), "solfege");\n            await mouse.setValue("re", 3, "solfege");\n            await mouse.setValue("mi", 2, "solfege");\n            await mouse.setValue("fa", 1, "solfege");\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("do", await mouse.getValue("do", "solfege"));\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("re", await mouse.getValue("re", "solfege"));\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("mi", await mouse.getValue("mi", "solfege"));\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("fa", await mouse.getValue("fa", "solfege"));\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"setDict2",0,0,[0,2,3,4]],[2,["text",{value:"key"}],0,0,[1]],[3,["number",{value:2}],0,0,[1]],[4,"setDict",0,0,[1,5,6,7,9]],[5,["text",{value:"solfege"}],0,0,[4]],[6,["text",{value:"do"}],0,0,[4]],[7,"getDict2",0,0,[4,8]],[8,["text",{value:"key"}],0,0,[7]],[9,"setDict",0,0,[4,10,11,12,13]],[10,["text",{value:"solfege"}],0,0,[9]],[11,["text",{value:"re"}],0,0,[9]],[12,["number",{value:3}],0,0,[9]],[13,"setDict",0,0,[9,14,15,16,17]],[14,["text",{value:"solfege"}],0,0,[13]],[15,["text",{value:"mi"}],0,0,[13]],[16,["number",{value:2}],0,0,[13]],[17,"setDict",0,0,[13,18,19,20,21]],[18,["text",{value:"solfege"}],0,0,[17]],[19,["text",{value:"fa"}],0,0,[17]],[20,["number",{value:1}],0,0,[17]],[21,"newnote",0,0,[17,22,25,32]],[22,"divide",0,0,[21,23,24]],[23,["number",{value:1}],0,0,[22]],[24,["number",{value:4}],0,0,[22]],[25,"vspace",0,0,[21,26]],[26,"pitch",0,0,[25,27,28,31]],[27,["solfege",{value:"do"}],0,0,[26]],[28,"getDict",0,0,[26,29,30]],[29,["text",{value:"solfege"}],0,0,[28]],[30,["text",{value:"do"}],0,0,[28]],[31,"vspace",0,0,[26,null]],[32,"newnote",0,0,[21,33,36,43]],[33,"divide",0,0,[32,34,35]],[34,["number",{value:1}],0,0,[33]],[35,["number",{value:4}],0,0,[33]],[36,"vspace",0,0,[32,37]],[37,"pitch",0,0,[36,38,39,42]],[38,["solfege",{value:"re"}],0,0,[37]],[39,"getDict",0,0,[37,40,41]],[40,["text",{value:"solfege"}],0,0,[39]],[41,["text",{value:"re"}],0,0,[39]],[42,"vspace",0,0,[37,null]],[43,"newnote",0,0,[32,44,47,54]],[44,"divide",0,0,[43,45,46]],[45,["number",{value:1}],0,0,[44]],[46,["number",{value:4}],0,0,[44]],[47,"vspace",0,0,[43,48]],[48,"pitch",0,0,[47,49,50,53]],[49,["solfege",{value:"mi"}],0,0,[48]],[50,"getDict",0,0,[48,51,52]],[51,["text",{value:"solfege"}],0,0,[50]],[52,["text",{value:"mi"}],0,0,[50]],[53,"vspace",0,0,[48,null]],[54,"newnote",0,0,[43,55,58,null]],[55,"divide",0,0,[54,56,57]],[56,["number",{value:1}],0,0,[55]],[57,["number",{value:4}],0,0,[55]],[58,"vspace",0,0,[54,59]],[59,"pitch",0,0,[58,60,61,64]],[60,["solfege",{value:"fa"}],0,0,[59]],[61,"getDict",0,0,[59,62,63]],[62,["text",{value:"solfege"}],0,0,[61]],[63,["text",{value:"fa"}],0,0,[61]],[64,"vspace",0,0,[59,null]]])}),test("should generate correct blockList for all rhythm blocks",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("sol", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("G", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playPitch("5", 4);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playHertz(392);\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNote(1 / 4, async () => {\n                await mouse.playRest();\n                return mouse.ENDFLOW;\n            });\n            await mouse.dot(1, async () => {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            await mouse.tie(async () => {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            await mouse.multiplyNoteValue(1 / 2, async () => {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            await mouse.swing(1 / 24, 1 / 8, async () => {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            await mouse.playNoteMillis(1000 / (3 / 2), async () => {\n                await mouse.playHertz(392);\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"newnote",0,0,[0,2,5,9]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:4}],0,0,[2]],[5,"vspace",0,0,[1,6]],[6,"pitch",0,0,[5,7,8,null]],[7,["solfege",{value:"sol"}],0,0,[6]],[8,["number",{value:4}],0,0,[6]],[9,"newnote",0,0,[1,10,13,17]],[10,"divide",0,0,[9,11,12]],[11,["number",{value:1}],0,0,[10]],[12,["number",{value:4}],0,0,[10]],[13,"vspace",0,0,[9,14]],[14,"pitch",0,0,[13,15,16,null]],[15,["notename",{value:"G"}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"newnote",0,0,[9,18,21,25]],[18,"divide",0,0,[17,19,20]],[19,["number",{value:1}],0,0,[18]],[20,["number",{value:4}],0,0,[18]],[21,"vspace",0,0,[17,22]],[22,"pitch",0,0,[21,23,24,null]],[23,["solfege",{value:"5"}],0,0,[22]],[24,["number",{value:4}],0,0,[22]],[25,"newnote",0,0,[17,26,29,32]],[26,"divide",0,0,[25,27,28]],[27,["number",{value:1}],0,0,[26]],[28,["number",{value:4}],0,0,[26]],[29,"vspace",0,0,[25,30]],[30,"hertz",0,0,[29,31,null]],[31,["number",{value:392}],0,0,[30]],[32,"newnote",0,0,[25,33,36,38]],[33,"divide",0,0,[32,34,35]],[34,["number",{value:1}],0,0,[33]],[35,["number",{value:4}],0,0,[33]],[36,"vspace",0,0,[32,37]],[37,"rest2",0,0,[36,null]],[38,"rhythmicdot2",0,0,[32,39,40,48]],[39,["number",{value:1}],0,0,[38]],[40,"newnote",0,0,[38,41,44,null]],[41,"divide",0,0,[40,42,43]],[42,["number",{value:1}],0,0,[41]],[43,["number",{value:4}],0,0,[41]],[44,"vspace",0,0,[40,45]],[45,"pitch",0,0,[44,46,47,null]],[46,["solfege",{value:"sol"}],0,0,[45]],[47,["number",{value:4}],0,0,[45]],[48,"tie",0,0,[38,49,65]],[49,"newnote",0,0,[48,50,53,57]],[50,"divide",0,0,[49,51,52]],[51,["number",{value:1}],0,0,[50]],[52,["number",{value:4}],0,0,[50]],[53,"vspace",0,0,[49,54]],[54,"pitch",0,0,[53,55,56,null]],[55,["solfege",{value:"sol"}],0,0,[54]],[56,["number",{value:4}],0,0,[54]],[57,"newnote",0,0,[49,58,61,null]],[58,"divide",0,0,[57,59,60]],[59,["number",{value:1}],0,0,[58]],[60,["number",{value:4}],0,0,[58]],[61,"vspace",0,0,[57,62]],[62,"pitch",0,0,[61,63,64,null]],[63,["solfege",{value:"sol"}],0,0,[62]],[64,["number",{value:4}],0,0,[62]],[65,"multiplybeatfactor",0,0,[48,66,69,78]],[66,"divide",0,0,[65,67,68]],[67,["number",{value:1}],0,0,[66]],[68,["number",{value:2}],0,0,[66]],[69,"vspace",0,0,[65,70]],[70,"newnote",0,0,[69,71,74,null]],[71,"divide",0,0,[70,72,73]],[72,["number",{value:1}],0,0,[71]],[73,["number",{value:4}],0,0,[71]],[74,"vspace",0,0,[70,75]],[75,"pitch",0,0,[74,76,77,null]],[76,["solfege",{value:"sol"}],0,0,[75]],[77,["number",{value:4}],0,0,[75]],[78,"newswing2",0,0,[65,79,82,85,103]],[79,"divide",0,0,[78,80,81]],[80,["number",{value:1}],0,0,[79]],[81,["number",{value:24}],0,0,[79]],[82,"divide",0,0,[78,83,84]],[83,["number",{value:1}],0,0,[82]],[84,["number",{value:8}],0,0,[82]],[85,"vspace",0,0,[78,86]],[86,"vspace",0,0,[85,87]],[87,"newnote",0,0,[86,88,91,95]],[88,"divide",0,0,[87,89,90]],[89,["number",{value:1}],0,0,[88]],[90,["number",{value:4}],0,0,[88]],[91,"vspace",0,0,[87,92]],[92,"pitch",0,0,[91,93,94,null]],[93,["solfege",{value:"sol"}],0,0,[92]],[94,["number",{value:4}],0,0,[92]],[95,"newnote",0,0,[87,96,99,null]],[96,"divide",0,0,[95,97,98]],[97,["number",{value:1}],0,0,[96]],[98,["number",{value:4}],0,0,[96]],[99,"vspace",0,0,[95,100]],[100,"pitch",0,0,[99,101,102,null]],[101,["solfege",{value:"sol"}],0,0,[100]],[102,["number",{value:4}],0,0,[100]],[103,"osctime",0,0,[78,104,109,null]],[104,"divide",0,0,[103,105,106]],[105,["number",{value:1e3}],0,0,[104]],[106,"divide",0,0,[104,107,108]],[107,["number",{value:3}],0,0,[106]],[108,["number",{value:2}],0,0,[106]],[109,"vspace",0,0,[103,110]],[110,"vspace",0,0,[109,111]],[111,"hertz",0,0,[110,112,null]],[112,["number",{value:392}],0,0,[111]]])}),test("should generate correct blockList for all flow blocks",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            if (true) {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n            } else {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                await mouse.playNote(1 / 6, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n            }\n            while (1000) {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                break;\n            }\n            while (1000) {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n            }\n            do {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n            } while (true);\n            switch (1) {\n                case 1:\n                    await mouse.playNote(1 / 4, async () => {\n                        await mouse.playPitch("sol", 4);\n                        return mouse.ENDFLOW;\n                    });\n                    break;\n                    break;\n                    break;\n                default:\n                    await mouse.playNote(1 / 4, async () => {\n                        await mouse.playPitch("5", 4);\n                        return mouse.ENDFLOW;\n                    });\n            }\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"ifthenelse",0,0,[0,2,3,27,43]],[2,["boolean",{value:!0}],0,0,[1]],[3,"newnote",0,0,[1,4,7,11]],[4,"divide",0,0,[3,5,6]],[5,["number",{value:1}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"vspace",0,0,[3,8]],[8,"pitch",0,0,[7,9,10,null]],[9,["solfege",{value:"sol"}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"newnote",0,0,[3,12,15,19]],[12,"divide",0,0,[11,13,14]],[13,["number",{value:1}],0,0,[12]],[14,["number",{value:4}],0,0,[12]],[15,"vspace",0,0,[11,16]],[16,"pitch",0,0,[15,17,18,null]],[17,["solfege",{value:"sol"}],0,0,[16]],[18,["number",{value:4}],0,0,[16]],[19,"newnote",0,0,[11,20,23,null]],[20,"divide",0,0,[19,21,22]],[21,["number",{value:1}],0,0,[20]],[22,["number",{value:4}],0,0,[20]],[23,"vspace",0,0,[19,24]],[24,"pitch",0,0,[23,25,26,null]],[25,["solfege",{value:"sol"}],0,0,[24]],[26,["number",{value:4}],0,0,[24]],[27,"newnote",0,0,[1,28,31,35]],[28,"divide",0,0,[27,29,30]],[29,["number",{value:1}],0,0,[28]],[30,["number",{value:4}],0,0,[28]],[31,"vspace",0,0,[27,32]],[32,"pitch",0,0,[31,33,34,null]],[33,["solfege",{value:"sol"}],0,0,[32]],[34,["number",{value:4}],0,0,[32]],[35,"newnote",0,0,[27,36,39,null]],[36,"divide",0,0,[35,37,38]],[37,["number",{value:1}],0,0,[36]],[38,["number",{value:6}],0,0,[36]],[39,"vspace",0,0,[35,40]],[40,"pitch",0,0,[39,41,42,null]],[41,["solfege",{value:"sol"}],0,0,[40]],[42,["number",{value:4}],0,0,[40]],[43,"forever",0,0,[1,44,53]],[44,"newnote",0,0,[43,45,48,52]],[45,"divide",0,0,[44,46,47]],[46,["number",{value:1}],0,0,[45]],[47,["number",{value:4}],0,0,[45]],[48,"vspace",0,0,[44,49]],[49,"pitch",0,0,[48,50,51,null]],[50,["solfege",{value:"sol"}],0,0,[49]],[51,["number",{value:4}],0,0,[49]],[52,"break",0,0,[44,null]],[53,"forever",0,0,[43,54,62]],[54,"newnote",0,0,[53,55,58,null]],[55,"divide",0,0,[54,56,57]],[56,["number",{value:1}],0,0,[55]],[57,["number",{value:4}],0,0,[55]],[58,"vspace",0,0,[54,59]],[59,"pitch",0,0,[58,60,61,null]],[60,["solfege",{value:"sol"}],0,0,[59]],[61,["number",{value:4}],0,0,[59]],[62,"until",0,0,[53,63,64,72]],[63,["boolean",{value:!0}],0,0,[62]],[64,"newnote",0,0,[62,65,68,null]],[65,"divide",0,0,[64,66,67]],[66,["number",{value:1}],0,0,[65]],[67,["number",{value:4}],0,0,[65]],[68,"vspace",0,0,[64,69]],[69,"pitch",0,0,[68,70,71,null]],[70,["solfege",{value:"sol"}],0,0,[69]],[71,["number",{value:4}],0,0,[69]],[72,"switch",0,0,[62,73,74,null]],[73,["number",{value:1}],0,0,[72]],[74,"case",0,0,[72,75,76,87]],[75,["number",{value:1}],0,0,[74]],[76,"newnote",0,0,[74,77,80,84]],[77,"divide",0,0,[76,78,79]],[78,["number",{value:1}],0,0,[77]],[79,["number",{value:4}],0,0,[77]],[80,"vspace",0,0,[76,81]],[81,"pitch",0,0,[80,82,83,null]],[82,["solfege",{value:"sol"}],0,0,[81]],[83,["number",{value:4}],0,0,[81]],[84,"break",0,0,[76,85]],[85,"break",0,0,[84,86]],[86,"break",0,0,[85,null]],[87,"defaultcase",0,0,[74,88,null]],[88,"newnote",0,0,[87,89,92,null]],[89,"divide",0,0,[88,90,91]],[90,["number",{value:1}],0,0,[89]],[91,["number",{value:4}],0,0,[89]],[92,"vspace",0,0,[88,93]],[93,"pitch",0,0,[92,94,95,null]],[94,["solfege",{value:"5"}],0,0,[93]],[95,["number",{value:4}],0,0,[93]]])}),test("should generate correct blockList for all meter blocks",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.setMeter(4, 1 / 4);\n            mouse.PICKUP = 0 / 4;\n            await mouse.setBPM(90, 1 / 4);\n            await mouse.setMasterBPM(90, 1 / 4);\n            await mouse.onEveryNoteDo("action");\n            await mouse.setNoClock(async () => {\n                await mouse.onStrongBeatDo(mouse.BEATCOUNT, "action");\n                await mouse.onStrongBeatDo(mouse.MEASURECOUNT, "action");\n                await mouse.onStrongBeatDo(mouse.BPM, "action");\n                await mouse.onStrongBeatDo(mouse.BEATFACTOR, "action");\n                await mouse.onEveryBeatDo("action");\n                await mouse.onWeakBeatDo("action");\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"meter",0,0,[0,2,3,6]],[2,["number",{value:4}],0,0,[1]],[3,"divide",0,0,[1,4,5]],[4,["number",{value:1}],0,0,[3]],[5,["number",{value:4}],0,0,[3]],[6,"vspace",0,0,[1,7]],[7,"pickup",0,0,[6,8,11]],[8,"divide",0,0,[7,9,10]],[9,["number",{value:0}],0,0,[8]],[10,["number",{value:4}],0,0,[8]],[11,"vspace",0,0,[7,12]],[12,"setbpm3",0,0,[11,13,14,17]],[13,["number",{value:90}],0,0,[12]],[14,"divide",0,0,[12,15,16]],[15,["number",{value:1}],0,0,[14]],[16,["number",{value:4}],0,0,[14]],[17,"vspace",0,0,[12,18]],[18,"setmasterbpm2",0,0,[17,19,20,23]],[19,["number",{value:90}],0,0,[18]],[20,"divide",0,0,[18,21,22]],[21,["number",{value:1}],0,0,[20]],[22,["number",{value:4}],0,0,[20]],[23,"vspace",0,0,[18,24]],[24,"everybeatdo",0,0,[23,25,26]],[25,["text",{value:"action"}],0,0,[24]],[26,"drift",0,0,[24,27,null]],[27,"onbeatdo",0,0,[26,28,29,30]],[28,"nopValueBlock",0,0,[27]],[29,["text",{value:"action"}],0,0,[27]],[30,"onbeatdo",0,0,[27,31,32,33]],[31,"nopValueBlock",0,0,[30]],[32,["text",{value:"action"}],0,0,[30]],[33,"onbeatdo",0,0,[30,34,35,36]],[34,"nopValueBlock",0,0,[33]],[35,["text",{value:"action"}],0,0,[33]],[36,"onbeatdo",0,0,[33,37,38,39]],[37,"beatfactor",0,0,[36]],[38,["text",{value:"action"}],0,0,[36]],[39,"everybeatdonew",0,0,[36,40,41]],[40,["text",{value:"action"}],0,0,[39]],[41,"offbeatdo",0,0,[39,42,null]],[42,["text",{value:"action"}],0,0,[41]]])}),test("should generate correct blockList for all pitch blocks",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.playPitch("sol", 4);\n            await mouse.playPitch("G", 4);\n            await mouse.stepPitch(1);\n            await mouse.playNthModalPitch(4, 4);\n            await mouse.playPitchNumber(7);\n            await mouse.setAccidental("sharp ♯", async () => {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            await mouse.playHertz(392);\n            await mouse.setScalarTranspose(0 + 0 * mouse.MODELENGTH, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.setSemitoneTranspose(1 + 0 * 12, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.setSemitoneTranspose(50 / 100, async () => {\n                await mouse.playNote(1 / 4, async () => {\n                    await mouse.playPitch("sol", 4);\n                    return mouse.ENDFLOW;\n                });\n                return mouse.ENDFLOW;\n            });\n            await mouse.setRegister(0);\n            await mouse.invert("sol", 4, "even", async () => {\n                await mouse.setPitchNumberOffset("C", 4);\n                await mouse.setPitchNumberOffset("C", -1);\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"pitch",0,0,[0,2,3,4]],[2,["solfege",{value:"sol"}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"pitch",0,0,[1,5,6,7]],[5,["notename",{value:"G"}],0,0,[4]],[6,["number",{value:4}],0,0,[4]],[7,"steppitch",0,0,[4,8,9]],[8,["number",{value:1}],0,0,[7]],[9,"nthmodalpitch",0,0,[7,10,11,12]],[10,["number",{value:4}],0,0,[9]],[11,["number",{value:4}],0,0,[9]],[12,"pitchnumber",0,0,[9,13,14]],[13,["number",{value:7}],0,0,[12]],[14,"accidental",0,0,[12,15,16,24]],[15,["text",{value:"sharp ♯"}],0,0,[14]],[16,"newnote",0,0,[14,17,20,null]],[17,"divide",0,0,[16,18,19]],[18,["number",{value:1}],0,0,[17]],[19,["number",{value:4}],0,0,[17]],[20,"vspace",0,0,[16,21]],[21,"pitch",0,0,[20,22,23,null]],[22,["solfege",{value:"sol"}],0,0,[21]],[23,["number",{value:4}],0,0,[21]],[24,"hertz",0,0,[14,25,26]],[25,["number",{value:392}],0,0,[24]],[26,"setscalartransposition",0,0,[24,27,null,28]],[27,["modelength",{}],0,0,[26]],[28,"settransposition",0,0,[26,29,null,34]],[29,"plus",0,0,[28,30,31]],[30,["number",{value:1}],0,0,[29]],[31,"multiply",0,0,[29,32,33]],[32,["number",{value:0}],0,0,[31]],[33,["number",{value:12}],0,0,[31]],[34,"settransposition",0,0,[28,35,38,47]],[35,"divide",0,0,[34,36,37]],[36,["number",{value:50}],0,0,[35]],[37,["number",{value:100}],0,0,[35]],[38,"vspace",0,0,[34,39]],[39,"newnote",0,0,[38,40,43,null]],[40,"divide",0,0,[39,41,42]],[41,["number",{value:1}],0,0,[40]],[42,["number",{value:4}],0,0,[40]],[43,"vspace",0,0,[39,44]],[44,"pitch",0,0,[43,45,46,null]],[45,["solfege",{value:"sol"}],0,0,[44]],[46,["number",{value:4}],0,0,[44]],[47,"register",0,0,[34,48,49]],[48,["number",{value:0}],0,0,[47]],[49,"invert1",0,0,[47,50,51,52,53,null]],[50,["solfege",{value:"sol"}],0,0,[49]],[51,["number",{value:4}],0,0,[49]],[52,["text",{value:"even"}],0,0,[49]],[53,"setpitchnumberoffset",0,0,[49,54,55,56]],[54,["notename",{value:"C"}],0,0,[53]],[55,["number",{value:4}],0,0,[53]],[56,"setpitchnumberoffset",0,0,[53,57,58,null]],[57,["notename",{value:"C"}],0,0,[56]],[58,"neg",0,0,[56,59]],[59,["number",{value:1}],0,0,[58]]])}),test("should generate correct blockList for all interval blocks",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.setKey("C", "major");\n            await mouse.setScalarInterval(5, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.setSemitoneInterval(4 + 0 * 12, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.setSemitoneInterval("major 3" + 0 * 12, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.setTemperament("equal", "C", 4);\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"setkey2",0,0,[0,2,3,4]],[2,["notename",{value:"C"}],0,0,[1]],[3,["modename",{value:"major"}],0,0,[1]],[4,"interval",0,0,[1,5,null,6]],[5,["number",{value:5}],0,0,[4]],[6,"semitoneinterval",0,0,[4,7,null,8]],[7,["intervalname",{}],0,0,[6]],[8,"semitoneinterval",0,0,[6,9,null,10]],[9,["intervalname",{}],0,0,[8]],[10,"settemperament",0,0,[8,11,12,13,null]],[11,["temperamentname",{value:"equal"}],0,0,[10]],[12,["notename",{value:"C"}],0,0,[10]],[13,["number",{value:4}],0,0,[10]]])}),test("should generate correct blockList for all tone blocks",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.setInstrument("electronic synth", async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.doVibrato(5, 1 / 16, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.doChorus(1.5, 3.5, 70, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.doPhaser(0.5, 3, 392, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.doTremolo(10, 50, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.doDistortion(40, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.doHarmonic(1, async () => {\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"settimbre",0,0,[0,2,null,3]],[2,["voicename",{value:"electronic synth"}],0,0,[1]],[3,"vibrato",0,0,[1,4,5,null,8]],[4,["number",{value:5}],0,0,[3]],[5,"divide",0,0,[3,6,7]],[6,["number",{value:1}],0,0,[5]],[7,["number",{value:16}],0,0,[5]],[8,"chorus",0,0,[3,9,10,11,null,12]],[9,["number",{value:1.5}],0,0,[8]],[10,["number",{value:3.5}],0,0,[8]],[11,["number",{value:70}],0,0,[8]],[12,"phaser",0,0,[8,13,14,15,null,16]],[13,["number",{value:.5}],0,0,[12]],[14,["number",{value:3}],0,0,[12]],[15,["number",{value:392}],0,0,[12]],[16,"tremolo",0,0,[12,17,18,null,19]],[17,["number",{value:10}],0,0,[16]],[18,["number",{value:50}],0,0,[16]],[19,"dis",0,0,[16,20,null,21]],[20,["number",{value:40}],0,0,[19]],[21,"harmonic2",0,0,[19,22,null,null]],[22,["number",{value:1}],0,0,[21]]])}),test("should generate correct blockList for all Ornament, Volume, and Drums blocks",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.setStaccato(1 / 32, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.setSlur(1 / 16, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.doNeighbor(1, 1 / 16, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.doCrescendo(5, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.doDecrescendo(5, async () => {\n                return mouse.ENDFLOW;\n            });\n            await mouse.setRelativeVolume(25, async () => {\n                return mouse.ENDFLOW;\n            });\n            mouse.MASTERVOLUME = 50;\n            mouse.PANNING = 0;\n            await mouse.setSynthVolume("electronic synth", 50);\n            await mouse.setSynthVolume("kick drum", 50);\n            await mouse.playDrum("kick drum");\n            await mouse.playDrum("duck");\n            await mouse.mapPitchToDrum("kick drum", async () => {\n                await mouse.playPitch("sol", 4);\n                return mouse.ENDFLOW;\n            });\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"newstaccato",0,0,[0,2,null,5]],[2,"divide",0,0,[1,3,4]],[3,["number",{value:1}],0,0,[2]],[4,["number",{value:32}],0,0,[2]],[5,"newslur",0,0,[1,6,null,9]],[6,"divide",0,0,[5,7,8]],[7,["number",{value:1}],0,0,[6]],[8,["number",{value:16}],0,0,[6]],[9,"neighbor2",0,0,[5,10,11,null,14]],[10,["number",{value:1}],0,0,[9]],[11,"divide",0,0,[9,12,13]],[12,["number",{value:1}],0,0,[11]],[13,["number",{value:16}],0,0,[11]],[14,"crescendo",0,0,[9,15,null,16]],[15,["number",{value:5}],0,0,[14]],[16,"decrescendo",0,0,[14,17,null,18]],[17,["number",{value:5}],0,0,[16]],[18,"articulation",0,0,[16,19,null,20]],[19,["number",{value:25}],0,0,[18]],[20,"setnotevolume",0,0,[18,21,22]],[21,["number",{value:50}],0,0,[20]],[22,"setpanning",0,0,[20,23,24]],[23,["number",{value:0}],0,0,[22]],[24,"setsynthvolume",0,0,[22,25,26,27]],[25,["voicename",{value:"electronic synth"}],0,0,[24]],[26,["number",{value:50}],0,0,[24]],[27,"setsynthvolume",0,0,[24,28,29,30]],[28,["voicename",{value:"kick drum"}],0,0,[27]],[29,["number",{value:50}],0,0,[27]],[30,"playdrum",0,0,[27,31,32]],[31,["drumname",{value:"kick drum"}],0,0,[30]],[32,"playdrum",0,0,[30,33,34]],[33,["drumname",{value:"duck"}],0,0,[32]],[34,"mapdrum",0,0,[32,35,36,null]],[35,["drumname",{value:"kick drum"}],0,0,[34]],[36,"pitch",0,0,[34,37,38,null]],[37,["solfege",{value:"sol"}],0,0,[36]],[38,["number",{value:4}],0,0,[36]]])}),test("should generate correct blockList for all Graphics and Pen blocks",function(){var e=acorn.parse('\n        new Mouse(async mouse => {\n            await mouse.goForward(100);\n            await mouse.goBackward(100);\n            await mouse.turnLeft(90);\n            await mouse.turnRight(90);\n            await mouse.setXY(0, 0);\n            await mouse.setHeading(0);\n            await mouse.drawArc(90, 100);\n            await mouse.setBezierControlPoint1(100, 75);\n            await mouse.setBezierControlPoint2(100, 25);\n            await mouse.drawBezier(0, 100);\n            await mouse.clear();\n            await mouse.scrollXY(100, 0);\n            await mouse.setColor(0);\n            await mouse.setGrey(100);\n            await mouse.setShade(50);\n            await mouse.setHue(80);\n            await mouse.setTranslucency(50);\n            await mouse.setPensize(5);\n            await mouse.penUp();\n            await mouse.penDown();\n            await mouse.fillBackground();\n            await mouse.setFont("sans-serif");\n            return mouse.ENDMOUSE;\n        });\n        MusicBlocks.run();',{ecmaVersion:2020}),e=AST2BlockList.toBlockList(e,u);expect(e).toEqual([[0,"start",200,200,[null,1,null]],[1,"forward",0,0,[0,2,3]],[2,["number",{value:100}],0,0,[1]],[3,"back",0,0,[1,4,5]],[4,["number",{value:100}],0,0,[3]],[5,"left",0,0,[3,6,7]],[6,["number",{value:90}],0,0,[5]],[7,"right",0,0,[5,8,9]],[8,["number",{value:90}],0,0,[7]],[9,"setxy",0,0,[7,10,11,12]],[10,["number",{value:0}],0,0,[9]],[11,["number",{value:0}],0,0,[9]],[12,"setheading",0,0,[9,13,14]],[13,["number",{value:0}],0,0,[12]],[14,"arc",0,0,[12,15,16,17]],[15,["number",{value:90}],0,0,[14]],[16,["number",{value:100}],0,0,[14]],[17,"controlpoint1",0,0,[14,18,19,20]],[18,["number",{value:100}],0,0,[17]],[19,["number",{value:75}],0,0,[17]],[20,"controlpoint2",0,0,[17,21,22,23]],[21,["number",{value:100}],0,0,[20]],[22,["number",{value:25}],0,0,[20]],[23,"bezier",0,0,[20,24,25,26]],[24,["number",{value:0}],0,0,[23]],[25,["number",{value:100}],0,0,[23]],[26,"clear",0,0,[23,27]],[27,"scrollxy",0,0,[26,28,29,30]],[28,["x",{value:100}],0,0,[27]],[29,["y",{value:0}],0,0,[27]],[30,"setcolor",0,0,[27,31,32]],[31,["number",{value:0}],0,0,[30]],[32,"setgrey",0,0,[30,33,34]],[33,["grey",{value:100}],0,0,[32]],[34,"setshade",0,0,[32,35,36]],[35,["shade",{value:50}],0,0,[34]],[36,"sethue",0,0,[34,37,38]],[37,["color",{value:80}],0,0,[36]],[38,"settranslucency",0,0,[36,39,40]],[39,["number",{value:50}],0,0,[38]],[40,"setpensize",0,0,[38,41,42]],[41,["pensize",{value:5}],0,0,[40]],[42,"penup",0,0,[40,43]],[43,"pendown",0,0,[42,44]],[44,"background",0,0,[43,45]],[45,"setfont",0,0,[44,46,null]],[46,["text",{value:"sans-serif"}],0,0,[45]]])})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}global.JSInterface={_methodArgConstraints:{}},require("../constraints.js"),describe("JSInterface._methodArgConstraints",function(){function t(t,e){var o=JSInterface._methodArgConstraints[t];if(!o)throw new Error("Method ".concat(t," not found in constraints"));e.forEach(function(t,e){var n=o[e];if(!n)throw new Error("Constraint for argument ".concat(e," not found"));if(_typeof(t)!==n.type)throw new Error("Argument ".concat(e," is not of type ").concat(n.type));if(n.constraints){if(void 0!==n.constraints.min&&t<n.constraints.min)throw new Error("Argument ".concat(e," is less than the minimum value ").concat(n.constraints.min));if(void 0!==n.constraints.max&&t>n.constraints.max)throw new Error("Argument ".concat(e," is greater than the maximum value ").concat(n.constraints.max));if(void 0!==n.constraints.integer&&n.constraints.integer&&!Number.isInteger(t))throw new Error("Argument ".concat(e," is not an integer"));if(void 0!==n.constraints.async&&n.constraints.async&&"function"!=typeof t)throw new Error("Argument ".concat(e," is not an async function"));if("solfegeorletter"===n.constraints.type&&"string"!=typeof t)throw new Error("Argument ".concat(e," is not a valid solfege or letter"));if("accidental"===n.constraints.type&&"string"!=typeof t)throw new Error("Argument ".concat(e," is not a valid accidental"));if("synth"===n.constraints.type&&"string"!=typeof t)throw new Error("Argument ".concat(e," is not a valid synth"));if("drum"===n.constraints.type&&"string"!=typeof t)throw new Error("Argument ".concat(e," is not a valid drum"));if("noise"===n.constraints.type&&"string"!=typeof t)throw new Error("Argument ".concat(e," is not a valid noise"));if("letterkey"===n.constraints.type&&"string"!=typeof t)throw new Error("Argument ".concat(e," is not a valid letter key"));if("oneof"===n.constraints.type&&!n.constraints.values.includes(t))throw new Error("Argument ".concat(e," is not one of the allowed values"))}})}it("should validate setMeter arguments",function(){expect(function(){return t("setMeter",[8,500])}).not.toThrow(),expect(function(){return t("setMeter",[0,500])}).toThrow(),expect(function(){return t("setMeter",[17,500])}).toThrow(),expect(function(){return t("setMeter",[8,-1])}).toThrow()}),it("should validate PICKUP arguments",function(){expect(function(){return t("PICKUP",[500])}).not.toThrow(),expect(function(){return t("PICKUP",[-1])}).toThrow(),expect(function(){return t("PICKUP",[1001])}).toThrow()}),it("should validate setBPM arguments",function(){expect(function(){return t("setBPM",[120,5])}).not.toThrow(),expect(function(){return t("setBPM",[39,5])}).toThrow(),expect(function(){return t("setBPM",[209,5])}).toThrow(),expect(function(){return t("setBPM",[120,-1])}).toThrow()}),it("should validate setMasterBPM arguments",function(){expect(function(){return t("setMasterBPM",[120,5])}).not.toThrow(),expect(function(){return t("setMasterBPM",[39,5])}).toThrow(),expect(function(){return t("setMasterBPM",[209,5])}).toThrow(),expect(function(){return t("setMasterBPM",[120,-1])}).toThrow()}),it("should validate onEveryNoteDo arguments",function(){expect(function(){return t("onEveryNoteDo",["action"])}).not.toThrow(),expect(function(){return t("onEveryNoteDo",[123])}).toThrow()}),it("should validate onEveryBeatDo arguments",function(){expect(function(){return t("onEveryBeatDo",["action"])}).not.toThrow(),expect(function(){return t("onEveryBeatDo",[123])}).toThrow()}),it("should validate onStrongBeatDo arguments",function(){expect(function(){return t("onStrongBeatDo",[8,"action"])}).not.toThrow(),expect(function(){return t("onStrongBeatDo",[0,"action"])}).toThrow(),expect(function(){return t("onStrongBeatDo",[17,"action"])}).toThrow(),expect(function(){return t("onStrongBeatDo",[8,123])}).toThrow()}),it("should validate onWeakBeatDo arguments",function(){expect(function(){return t("onWeakBeatDo",["action"])}).not.toThrow(),expect(function(){return t("onWeakBeatDo",[123])}).toThrow()}),it("should validate getNotesPlayed arguments",function(){expect(function(){return t("getNotesPlayed",[500])}).not.toThrow(),expect(function(){return t("getNotesPlayed",[-1])}).toThrow(),expect(function(){return t("getNotesPlayed",[1001])}).toThrow()}),it("should validate playPitch arguments",function(){expect(function(){return t("playPitch",["action",4])}).not.toThrow(),expect(function(){return t("playPitch",[123,4])}).toThrow(),expect(function(){return t("playPitch",["action",0])}).toThrow()}),it("should validate stepPitch arguments",function(){expect(function(){return t("stepPitch",[3])}).not.toThrow(),expect(function(){return t("stepPitch",[-8])}).toThrow(),expect(function(){return t("stepPitch",[8])}).toThrow()}),it("should validate playNthModalPitch arguments",function(){expect(function(){return t("playNthModalPitch",[3,4])}).not.toThrow(),expect(function(){return t("playNthModalPitch",[-8,4])}).toThrow(),expect(function(){return t("playNthModalPitch",[8,4])}).toThrow(),expect(function(){return t("playNthModalPitch",[3,0])}).toThrow()}),it("should validate playPitchNumber arguments",function(){expect(function(){return t("playPitchNumber",[5])}).not.toThrow(),expect(function(){return t("playPitchNumber",[-4])}).toThrow(),expect(function(){return t("playPitchNumber",[13])}).toThrow()}),it("should validate playHertz arguments",function(){expect(function(){return t("playHertz",[440])}).not.toThrow(),expect(function(){return t("playHertz",[19])}).toThrow(),expect(function(){return t("playHertz",[20001])}).toThrow()}),it("should validate setRegister arguments",function(){expect(function(){return t("setRegister",[2])}).not.toThrow(),expect(function(){return t("setRegister",[-4])}).toThrow(),expect(function(){return t("setRegister",[4])}).toThrow()}),it("should validate invert arguments",function(){expect(function(){return t("invert",["C",4,"even"])}).not.toThrow(),expect(function(){return t("invert",[123,4,"even"])}).toThrow(),expect(function(){return t("invert",["C",0,"even"])}).toThrow(),expect(function(){return t("invert",["C",4,"invalid"])}).toThrow()}),it("should validate setPitchNumberOffset arguments",function(){expect(function(){return t("setPitchNumberOffset",["C",4])}).not.toThrow(),expect(function(){return t("setPitchNumberOffset",[123,4])}).toThrow(),expect(function(){return t("setPitchNumberOffset",["C",0])}).toThrow()}),it("should validate numToPitch arguments",function(){expect(function(){return t("numToPitch",[50])}).not.toThrow(),expect(function(){return t("numToPitch",[-1])}).toThrow(),expect(function(){return t("numToPitch",[101])}).toThrow()}),it("should validate numToOctave arguments",function(){expect(function(){return t("numToOctave",[50])}).not.toThrow(),expect(function(){return t("numToOctave",[-1])}).toThrow(),expect(function(){return t("numToOctave",[101])}).toThrow()}),it("should validate setKey arguments",function(){expect(function(){return t("setKey",["C","major"])}).not.toThrow(),expect(function(){return t("setKey",[123,"major"])}).toThrow(),expect(function(){return t("setKey",["C","invalid"])}).toThrow()}),it("should validate MOVABLEDO arguments",function(){expect(function(){return t("MOVABLEDO",[!0])}).not.toThrow(),expect(function(){return t("MOVABLEDO",[!1])}).not.toThrow(),expect(function(){return t("MOVABLEDO",[123])}).toThrow()}),it("should validate PANNING arguments",function(){expect(function(){return t("PANNING",[50])}).not.toThrow(),expect(function(){return t("PANNING",[-101])}).toThrow(),expect(function(){return t("PANNING",[101])}).toThrow()}),it("should validate MASTERVOLUME arguments",function(){expect(function(){return t("MASTERVOLUME",[50])}).not.toThrow(),expect(function(){return t("MASTERVOLUME",[-1])}).toThrow(),expect(function(){return t("MASTERVOLUME",[101])}).toThrow()}),it("should validate setSynthVolume arguments",function(){expect(function(){return t("setSynthVolume",["synth",50])}).not.toThrow(),expect(function(){return t("setSynthVolume",[123,50])}).toThrow(),expect(function(){return t("setSynthVolume",["synth",-1])}).toThrow()}),it("should validate getSynthVolume arguments",function(){expect(function(){return t("getSynthVolume",["synth"])}).not.toThrow(),expect(function(){return t("getSynthVolume",[123])}).toThrow()}),it("should validate playDrum arguments",function(){expect(function(){return t("playDrum",["drum"])}).not.toThrow(),expect(function(){return t("playDrum",[123])}).toThrow()}),it("should validate playNoise arguments",function(){expect(function(){return t("playNoise",["noise"])}).not.toThrow(),expect(function(){return t("playNoise",[123])}).toThrow()}),it("should validate goForward arguments",function(){expect(function(){return t("goForward",[5e4])}).not.toThrow(),expect(function(){return t("goForward",[-100001])}).toThrow(),expect(function(){return t("goForward",[100001])}).toThrow()}),it("should validate goBackward arguments",function(){expect(function(){return t("goBackward",[5e4])}).not.toThrow(),expect(function(){return t("goBackward",[-100001])}).toThrow(),expect(function(){return t("goBackward",[100001])}).toThrow()}),it("should validate turnRight arguments",function(){expect(function(){return t("turnRight",[180])}).not.toThrow(),expect(function(){return t("turnRight",[-361])}).toThrow(),expect(function(){return t("turnRight",[361])}).toThrow()}),it("should validate turnLeft arguments",function(){expect(function(){return t("turnLeft",[180])}).not.toThrow(),expect(function(){return t("turnLeft",[-361])}).toThrow(),expect(function(){return t("turnLeft",[361])}).toThrow()}),it("should validate setXY arguments",function(){expect(function(){return t("setXY",[5e4,5e4])}).not.toThrow(),expect(function(){return t("setXY",[-100001,5e4])}).toThrow(),expect(function(){return t("setXY",[100001,5e4])}).toThrow()}),it("should validate setHeading arguments",function(){expect(function(){return t("setHeading",[180])}).not.toThrow(),expect(function(){return t("setHeading",[-361])}).toThrow(),expect(function(){return t("setHeading",[361])}).toThrow()}),it("should validate drawArc arguments",function(){expect(function(){return t("drawArc",[180,5e4])}).not.toThrow(),expect(function(){return t("drawArc",[-361,5e4])}).toThrow(),expect(function(){return t("drawArc",[361,5e4])}).toThrow(),expect(function(){return t("drawArc",[180,-1])}).toThrow()}),it("should validate drawBezier arguments",function(){expect(function(){return t("drawBezier",[5e4,5e4])}).not.toThrow(),expect(function(){return t("drawBezier",[-100001,5e4])}).toThrow(),expect(function(){return t("drawBezier",[100001,5e4])}).toThrow()}),it("should validate setBezierControlPoint1 arguments",function(){expect(function(){return t("setBezierControlPoint1",[5e4,5e4])}).not.toThrow(),expect(function(){return t("setBezierControlPoint1",[-100001,5e4])}).toThrow(),expect(function(){return t("setBezierControlPoint1",[100001,5e4])}).toThrow()}),it("should validate scrollXY arguments",function(){expect(function(){return t("scrollXY",[5e4,5e4])}).not.toThrow(),expect(function(){return t("scrollXY",[-100001,5e4])}).toThrow(),expect(function(){return t("scrollXY",[100001,5e4])}).toThrow()}),it("should validate setColor arguments",function(){expect(function(){return t("setColor",[50])}).not.toThrow(),expect(function(){return t("setColor",[-1])}).toThrow(),expect(function(){return t("setColor",[101])}).toThrow()}),it("should validate setGrey arguments",function(){expect(function(){return t("setGrey",[50])}).not.toThrow(),expect(function(){return t("setGrey",[-1])}).toThrow(),expect(function(){return t("setGrey",[101])}).toThrow()}),it("should validate setShade arguments",function(){expect(function(){return t("setShade",[50])}).not.toThrow(),expect(function(){return t("setShade",[-1])}).toThrow(),expect(function(){return t("setShade",[101])}).toThrow()}),it("should validate setHue arguments",function(){expect(function(){return t("setHue",[50])}).not.toThrow(),expect(function(){return t("setHue",[-1])}).toThrow(),expect(function(){return t("setHue",[101])}).toThrow()}),it("should validate setTranslucency arguments",function(){expect(function(){return t("setTranslucency",[50])}).not.toThrow(),expect(function(){return t("setTranslucency",[-1])}).toThrow(),expect(function(){return t("setTranslucency",[101])}).toThrow()}),it("should validate setPensize arguments",function(){expect(function(){return t("setPensize",[50])}).not.toThrow(),expect(function(){return t("setPensize",[-1])}).toThrow(),expect(function(){return t("setPensize",[101])}).toThrow()})});
function _regenerator(){var p,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function o(e,t,n,o){var r,u,s,i,c,l,a,f,g,t=t&&t.prototype instanceof A?t:A,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(r=e,u=n,a=o||[],f=!1,g={p:l=0,n:0,v:p,a:d,f:d.bind(p,4),d:function(e,t){return s=e,i=0,c=p,g.n=t,h}},function(e,t,n){if(1<l)throw TypeError("Generator is already running");for(f&&1===t&&d(t,n),i=t,c=n;(E=i<2?p:c)||!f;){s||(i?i<3?(1<i&&(g.n=-1),d(i,c)):g.n=c:g.v=c);try{if(l=2,s){if(E=s[e=i?e:"next"]){if(!(E=E.call(s,c)))throw TypeError("iterator result is not an object");if(!E.done)return E;c=E.value,i<2&&(i=0)}else 1===i&&(E=s.return)&&E.call(s),i<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),i=1);s=p}else if((E=(f=g.n<0)?c:r.call(u,g))!==h)break}catch(e){s=p,i=1,c=e}finally{l=1}}return{value:E,done:f}}),!0),t;function d(e,t){for(i=e,c=t,E=0;!f&&l&&!n&&E<a.length;E++){var n,o=a[E],r=g.p,u=o[2];3<e?(n=u===t)&&(c=o[(i=o[4])?5:i=3],o[4]=o[5]=p):o[0]<=r&&((n=e<2&&r<o[1])?(i=0,g.v=t,g.n=o[1]):r<u&&(n=e<3||o[0]>t||u<t)&&(o[4]=e,o[5]=t,g.n=u,i=0))}if(n||1<e)return h;throw f=!0,t}}var h={};function A(){}function r(){}function u(){}var E=Object.getPrototypeOf,e=[][t]?E(E([][t]())):(_regeneratorDefine2(E={},t,function(){return this}),E),s=u.prototype=A.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(s),e}return _regeneratorDefine2(s,"constructor",r.prototype=u),_regeneratorDefine2(u,"constructor",r),_regeneratorDefine2(u,n,r.displayName="GeneratorFunction"),_regeneratorDefine2(s),_regeneratorDefine2(s,n,"Generator"),_regeneratorDefine2(s,t,function(){return this}),_regeneratorDefine2(s,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:i}})()}function _regeneratorDefine2(e,t,n,o){var u=Object.defineProperty;try{u({},"",{})}catch(e){u=0}(_regeneratorDefine2=function(e,t,n,o){function r(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?u?u(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))})(e,t,n,o)}function asyncGeneratorStep(e,t,n,o,r,u,s){try{var i=e[u](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(o,r)}function _asyncToGenerator(i){return function(){var e=this,s=arguments;return new Promise(function(t,n){var o=i.apply(e,s);function r(e){asyncGeneratorStep(o,t,n,r,u,"next",e)}function u(e){asyncGeneratorStep(o,t,n,r,u,"throw",e)}r(void 0)})}}var _require=require("../export.js"),Mouse=_require.Mouse,MusicBlocks=_require.MusicBlocks,JSEditor=(global.importMembers=jest.fn(),global.JSInterface={validateArgs:jest.fn(function(e,t){return t})},global.Painter={prototype:{method1:jest.fn(),method2:jest.fn()}},{logConsole:jest.fn()}),globalActivity=(global.JSEditor=JSEditor,{turtles:{getTurtleCount:jest.fn(),getTurtle:jest.fn(),addTurtle:jest.fn(),getIndexOfTurtle:jest.fn(),removeTurtle:jest.fn(),screenX2turtleX:jest.fn(),screenY2turtleY:jest.fn()},logo:{prepSynths:jest.fn(),firstNoteTime:null,stage:{removeEventListener:jest.fn()}},textMsg:jest.fn(),stage:{dispatchEvent:jest.fn()}});global.globalActivity=globalActivity,global.Singer={RhythmActions:{getNoteValue:jest.fn()},MeterActions:{setPickup:jest.fn(),getWholeNotesPlayed:jest.fn(),getBeatCount:jest.fn(),getMeasureCount:jest.fn(),getBPM:jest.fn(),getBeatFactor:jest.fn(),getCurrentMeter:jest.fn()},PitchActions:{deltaPitch:jest.fn(),consonantStepSize:jest.fn()},IntervalsActions:{setMovableDo:jest.fn(),getCurrentKey:jest.fn(),getCurrentMode:jest.fn(),getModeLength:jest.fn()},VolumeActions:{setPanning:jest.fn(),setMasterVolume:jest.fn(),masterVolume:1}},describe("Mouse Class",function(){var t,e=jest.fn();beforeEach(function(){globalActivity.turtles.getTurtleCount.mockReturnValue(1),globalActivity.turtles.getTurtle.mockReturnValue({id:1,initTurtle:jest.fn(),doWait:jest.fn()}),t=new Mouse(e)}),test("should create a new Mouse instance",function(){expect(t).toBeInstanceOf(Mouse),expect(Mouse.MouseList).toContain(t),expect(Mouse.TurtleMouseMap[1]).toBe(t)}),test("should get Mouse from Turtle",function(){var e=Mouse.getMouseFromTurtle({id:1});expect(e).toBe(t)}),test("should return null if Turtle is not in map",function(){var e=Mouse.getMouseFromTurtle({id:2});expect(e).toBeNull()}),test("should run the flow",function(){t.run(),expect(t.turtle.doWait).toHaveBeenCalledWith(0),expect(e).toHaveBeenCalledWith(t.MB)})}),describe("MusicBlocks Class",function(){var n,e;beforeEach(function(){globalActivity.turtles.getTurtleCount.mockReturnValue(1),globalActivity.turtles.getTurtle.mockReturnValue({id:1,initTurtle:jest.fn(),doWait:jest.fn(),container:{x:10,y:20}}),(e=new Mouse(jest.fn())).run=jest.fn(),n=new MusicBlocks(e)}),test("should create a new MusicBlocks instance",function(){expect(n).toBeInstanceOf(MusicBlocks),expect(n.mouse).toBe(e),expect(n.turtle).toBe(e.turtle)}),test("should run all mice",function(){Mouse.MouseList.push(e),MusicBlocks.run(),expect(globalActivity.logo.prepSynths).toHaveBeenCalled(),expect(e.run).toHaveBeenCalled()}),test("should handle ENDFLOW",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n.ENDFLOW;case 1:t=e.v,expect(t).toBeUndefined();case 2:return e.a(2)}},e)}))),test("should handle ENDFLOWCOMMAND",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n.turtle.waitTime=100,n.turtle.doWait=jest.fn(),n.listeners.push("testSignal"),e.n=1,n.ENDFLOWCOMMAND;case 1:expect(globalActivity.stage.dispatchEvent).toHaveBeenCalledWith("testSignal"),expect(n.turtle.doWait).toHaveBeenCalledWith(0);case 2:return e.a(2)}},e)}))),test("should print a message",function(){n.print("test message"),expect(JSEditor.logConsole).toHaveBeenCalled(),expect(globalActivity.textMsg).toHaveBeenCalledWith("test message")}),test("should handle undefined message",function(){n.print(void 0),expect(globalActivity.textMsg).toHaveBeenCalledWith("undefined")}),test("should handle null message",function(){n.print(null),expect(globalActivity.textMsg).toHaveBeenCalledWith("null")}),test("should get X coordinate",function(){globalActivity.turtles.screenX2turtleX.mockReturnValue(10),expect(n.X).toBe(10)}),test("should get Y coordinate",function(){globalActivity.turtles.screenY2turtleY.mockReturnValue(20),expect(n.Y).toBe(20)}),test("should get HEADING",function(){n.turtle.orientation=90,expect(n.HEADING).toBe(90)}),test("should get PENSIZE",function(){n.turtle.painter={stroke:5},expect(n.PENSIZE).toBe(5)}),test("should get COLOR",function(){n.turtle.painter={color:"red"},expect(n.COLOR).toBe("red")}),test("should get SHADE",function(){n.turtle.painter={value:50},expect(n.SHADE).toBe(50)}),test("should get GREY",function(){n.turtle.painter={chroma:75},expect(n.GREY).toBe(75)}),test("should get NOTEVALUE",function(){Singer.RhythmActions.getNoteValue.mockReturnValue(1),expect(n.NOTEVALUE).toBe(1)}),test("should set PICKUP",function(){n.PICKUP=2,expect(Singer.MeterActions.setPickup).toHaveBeenCalledWith(2,n.turIndex)}),test("should get WHOLENOTESPLAYED",function(){Singer.MeterActions.getWholeNotesPlayed.mockReturnValue(4),expect(n.WHOLENOTESPLAYED).toBe(4)}),test("should get BEATCOUNT",function(){Singer.MeterActions.getBeatCount.mockReturnValue(16),expect(n.BEATCOUNT).toBe(16)}),test("should get MEASURECOUNT",function(){Singer.MeterActions.getMeasureCount.mockReturnValue(4),expect(n.MEASURECOUNT).toBe(4)}),test("should get BPM",function(){Singer.MeterActions.getBPM.mockReturnValue(120),expect(n.BPM).toBe(120)}),test("should get BEATFACTOR",function(){Singer.MeterActions.getBeatFactor.mockReturnValue(1.5),expect(n.BEATFACTOR).toBe(1.5)}),test("should get CURRENTMETER",function(){Singer.MeterActions.getCurrentMeter.mockReturnValue("4/4"),expect(n.CURRENTMETER).toBe("4/4")}),test("should get SCALARCHANGEINPITCH",function(){Singer.PitchActions.deltaPitch.mockReturnValue(2),expect(n.SCALARCHANGEINPITCH).toBe(2)}),test("should get CHANGEINPITCH",function(){Singer.PitchActions.deltaPitch.mockReturnValue(1),expect(n.CHANGEINPITCH).toBe(1)}),test("should get SCALARSTEPUP",function(){Singer.PitchActions.consonantStepSize.mockReturnValue(1),expect(n.SCALARSTEPUP).toBe(1)}),test("should get SCALARSTEPDOWN",function(){Singer.PitchActions.consonantStepSize.mockReturnValue(-1),expect(n.SCALARSTEPDOWN).toBe(-1)}),test("should set MOVABLEDO",function(){n.MOVABLEDO=!0,expect(Singer.IntervalsActions.setMovableDo).toHaveBeenCalledWith(!0,n.turIndex)}),test("should get CURRENTKEY",function(){Singer.IntervalsActions.getCurrentKey.mockReturnValue("C"),expect(n.CURRENTKEY).toBe("C")}),test("should get CURRENTMODE",function(){Singer.IntervalsActions.getCurrentMode.mockReturnValue("major"),expect(n.CURRENTMODE).toBe("major")}),test("should get MODELENGTH",function(){Singer.IntervalsActions.getModeLength.mockReturnValue(7),expect(n.MODELENGTH).toBe(7)}),test("should set PANNING",function(){n.PANNING=.5,expect(Singer.VolumeActions.setPanning).toHaveBeenCalledWith(.5,n.turIndex)}),test("should set MASTERVOLUME",function(){n.MASTERVOLUME=.8,expect(Singer.VolumeActions.setMasterVolume).toHaveBeenCalledWith(.8,n.turIndex)}),test("should get MASTERVOLUME",function(){expect(n.MASTERVOLUME).toBe(1)})});
var _require=require("../generate"),JSGenerate=_require.JSGenerate,globalActivity=(global.last=jest.fn(function(e){return e[e.length-1]}),{blocks:{stackList:[],blockList:{},findStacks:jest.fn()}}),ASTUtils=(global.globalActivity=globalActivity,global.console={log:jest.fn(),error:jest.fn(),warn:jest.fn()},{BAREBONE_AST:{type:"Program",body:[]},getMethodAST:jest.fn(),getMouseAST:jest.fn()}),astring={generate:jest.fn()};global.ASTUtils=ASTUtils,global.astring=astring,describe("JSGenerate Class",function(){beforeEach(function(){jest.clearAllMocks(),JSGenerate.startBlocks=[],JSGenerate.actionBlocks=[],JSGenerate.startTrees=[],JSGenerate.actionTrees=[],JSGenerate.actionNames=[],JSGenerate.AST={type:"Program",body:[]},JSGenerate.code="",JSGenerate.generateFailed=!1}),test("should generate correct AST structure",function(){JSGenerate.actionTrees=[[["action",null,null]]],JSGenerate.actionNames=["action1"],JSGenerate.startTrees=[[["start",null,null]]];ASTUtils.getMethodAST.mockReturnValue({type:"Method"}),ASTUtils.getMouseAST.mockReturnValue({type:"Mouse"}),astring.generate.mockReturnValue("generated code"),JSGenerate.generateCode(),expect(JSGenerate.AST).toEqual({type:"Program",body:[{type:"Method"},{type:"Mouse"}]}),expect(JSGenerate.code).toBe("generated code"),expect(JSGenerate.generateFailed).toBe(!1)}),test("should handle code generation failure",function(){JSGenerate.actionTrees=[[["action",null,null]]],JSGenerate.actionNames=["action1"],JSGenerate.startTrees=[[["start",null,null]]],ASTUtils.getMethodAST.mockImplementation(function(){throw new Error("Failed to generate AST")}),JSGenerate.generateCode(),expect(JSGenerate.generateFailed).toBe(!0),expect(console.error).toHaveBeenCalledWith("CANNOT GENERATE ABSTRACT SYNTAX TREE\nError:",expect.any(Error)),expect(JSGenerate.code).toBe(astring.generate(ASTUtils.BAREBONE_AST))}),test("should print stacks tree",function(){JSGenerate.startTrees=[[["start",null,null]]],JSGenerate.actionTrees=[[["action",null,null]]],JSGenerate.actionNames=["action1"],JSGenerate.printStacksTree(),expect(console.log).toHaveBeenCalledWith("\n   %c START ","background: navy; color: white; font-weight: bold"),expect(console.log).toHaveBeenCalledWith("\n   %c ACTION ","background: green; color: white; font-weight: bold")}),test("should handle empty start and action trees",function(){JSGenerate.startTrees=[],JSGenerate.actionTrees=[],JSGenerate.printStacksTree(),expect(console.log).toHaveBeenCalledWith("%cno start trees generated","color: tomato"),expect(console.log).toHaveBeenCalledWith("%cno action trees generated","color: tomato")}),test("should handle invalid action name",function(){globalActivity.blocks.stackList=[1],globalActivity.blocks.blockList={1:{name:"action",trash:!1,connections:[null,2,3]},2:{name:"namedbox",value:null,connections:[null]},3:{name:"value",value:"arg1",connections:[null]}},JSGenerate.generateStacksTree(),expect(JSGenerate.actionNames).toEqual([])}),test("should handle invalid block connections",function(){globalActivity.blocks.stackList=[1],globalActivity.blocks.blockList={1:{name:"start",trash:!1,connections:[]}},JSGenerate.generateStacksTree(),expect(JSGenerate.startTrees).toEqual([[]])}),test("should run code generator with print options",function(){JSGenerate.actionTrees=[[["action",null,null]]],JSGenerate.actionNames=["action1"],JSGenerate.startTrees=[[["start",null,null]]],ASTUtils.getMethodAST.mockReturnValue({type:"Method"}),ASTUtils.getMouseAST.mockReturnValue({type:"Mouse"}),astring.generate.mockReturnValue("generated code"),JSGenerate.run(!0,!0),expect(console.log).toHaveBeenCalledWith("\n   %c STACK TREES ","background: greenyellow; color: midnightblue; font-weight: bold"),expect(console.log).toHaveBeenCalledWith("\n   %c CODE ","background: greenyellow; color: midnightblue; font-weight: bold"),expect(console.log).toHaveBeenCalledWith("generated code")})});
var JSInterface=require("../interface");JSInterface._methodArgConstraints={},describe("JSInterface",function(){describe("isClampBlock",function(){it("should return true for a known clamp block",function(){expect(JSInterface.isClampBlock("newnote")).toBe(!0)}),it("should return false for an unknown block",function(){expect(JSInterface.isClampBlock("nonexistent")).toBe(!1)})}),describe("isSetter",function(){it("should return true for a valid setter block",function(){expect(JSInterface.isSetter("pickup")).toBe(!0)}),it("should return false for a block that is not a setter",function(){expect(JSInterface.isSetter("newnote")).toBe(!1)})}),describe("isGetter",function(){it("should return true for a valid getter block",function(){expect(JSInterface.isGetter("mynotevalue")).toBe(!0)}),it("should return false for a block that is not a getter",function(){expect(JSInterface.isGetter("pickup")).toBe(!1)})}),describe("isMethod",function(){it("should return true for a valid method block",function(){expect(JSInterface.isMethod("newnote")).toBe(!0)}),it("should return false for a block that is not a method",function(){expect(JSInterface.isMethod("pickup")).toBe(!1)})}),describe("methodReturns",function(){it("should return true for a method that has a return value",function(){expect(JSInterface.methodReturns("getDict")).toBe(!0)}),it("should return false for a method that does not have a return value",function(){expect(JSInterface.methodReturns("newnote")).toBe(!1)})}),describe("getSetterName",function(){it("should return the correct setter name when available",function(){expect(JSInterface.getSetterName("pickup")).toBe("PICKUP")}),it("should return null when no setter exists for the given block",function(){expect(JSInterface.getSetterName("newnote")).toBeNull()})}),describe("getGetterName",function(){it("should return the correct getter name when available",function(){expect(JSInterface.getGetterName("mynotevalue")).toBe("NOTEVALUE")}),it("should return null when no getter exists for the given block",function(){expect(JSInterface.getGetterName("pickup")).toBeNull()})}),describe("getMethodName",function(){it("should return the correct method name when available",function(){expect(JSInterface.getMethodName("newnote")).toBe("playNote")}),it("should return null when no method exists for the given block",function(){expect(JSInterface.getMethodName("pickup")).toBeNull()})}),describe("rearrangeMethodArgs",function(){it("should rearrange the arguments for methods present in the lookup",function(){expect(JSInterface.rearrangeMethodArgs("setDict",[1,2,3])).toEqual([2,3,1])}),it("should return the original args if no rearrangement is required",function(){var e=[1,2,3];expect(JSInterface.rearrangeMethodArgs("nonExistingMethod",e)).toEqual(e)})}),describe("validateArgs",function(){it("should return the original args when no constraints are defined for the method",function(){var e=[1,2,3];expect(JSInterface.validateArgs("nonExistingMethod",e)).toEqual(e)})})});
var JS_API="/*\n============================================================\n       API\n============================================================\nCREATE NEW MOUSE:\n-----------------\nnew Mouse(async mouse => {\n    await mouse.func(...);\n\n    // also can be inside conditionals and loops\n    // e.g.\n    if (cond ..) {\n        await mouse.func(...);\n        ...\n    } else {\n        await mouse.func(...);\n        ...\n    }\n});\n\nCREATE NEW ACTION:\n------------------\nlet action_name = async mouse => {\n    await mouse.func(...);\n    ...\n    return mouse.ENDFLOW;\n};\n\nCALL A CLAMP BLOCK FUNCTION:\n----------------------------\n...\nawait mouse.func(async () => {\n    await mouse.func(...);  // non clamp block function\n    ...\n    return mouse.ENDFLOW;\n});\n\nRUN ALL MICE:\n-------------\nMusicBlocks.run();\n\n\nFLOW BLOCK FUNCTIONS:\n----------------------\n// [R] means function returns value\n\n    // Rhythm\nrest                        : playRest()\n\n    // Meter\nset meter                   : setMeter(beatCount, noteValue)\nset mouse beats per minute  : setBPM(bpm, beatValue)\nset master beats per minute : setMasterBPM(bpm, beatValue)\naction on every note        : onEveryNoteDo(actionName)\naction on every beat        : onEveryBeatDo(actionName)\naction on every strong beat : onStrongNoteDo(beatValue, actionName)\naction on every weak beat   : onWeakNoteDo(actionName)\ncount of notes played       : [R] getNotesPlayed(noteValue)\n\n    // Pitch\npitch                       : playPitch(note, octave)\nscalar step                 : stepPitch(value)\nnth modal pitch             : playNthModalPitch(number, octave)\npitch number                : playPitchNumber(number)\nhertz                       : playHertz(value)\nregister                    : setRegister(value)\nset pitch number offset     : setPitchNumberOffset(pitch, octave)\nnumber to pitch             : [R] numToPitch(number)\nnumber to octave            : [R] numToOctave(number)\n\n    // Intervals\nset key                     : setKey(key, mode)\nset temperament             : setTemperament(temperament, pitch, octave)\n\n    // Volume\nset synth volume            : setSynthVolume(synth, volume)\nget synth volume            : [R] getSynthVolume(synth)\n\n    // Drum\ndrum                        : playDrum(drum)\nnoise                       : playNoise(noise)\n\n    // Graphics\ngo forward                  : goForward(steps)\ngo backward                 : goBackward(steps)\nturn right                  : turnRight(degrees)\nturn left                   : turnLeft(degrees)\nset x, y coordinates        : setXY(x_coord, y_coord)\nset mouse head angle        : setHeading(degrees)\ndraw pivoted arc            : drawArc(degrees, radius)\ndraw bezier curve           : drawBezier(dest_x, dest_y)\nset bezier control point 1  : setBezierControlPoint1(x_coord, y_coord)\nset bezier control point 2  : setBezierControlPoint2(x_coord, y_coord)\nclear screen                : clear()\nscroll canvas to x, y       : scrollXY(x_coord, y_coord)\n\n    // Pen\nset pen color               : setColor(hue_value_in_0_to_100)\nset pen saturation          : setGrey(value_in_0_to_100)\nset pen lightness           : setShade(value_in_0_to_100)\nset pen hue                 : setHue(value_in_0_to_100)\nset pen opacity             : setTranslucency(value_in_0_to_100)\nset pen thickness           : setPensize(value_in_0_to_100)\npen up                      : penUp()\npen down                    : penDown()\nfill background             : fillBackground()\nset font name               : setFont(fontname)\n\n    // Dictionary\nset value to unnamed dict   : setValue(key, value)\nset value to named dict     : setValue(key, value, dict)\nget value from unnamed dict : getValue(key)\nget value from named dict   : getValue(key, dict)\nget a dictionary            : getDict(dict)\nprint a dictionary (on top) : showDict(dict)\n\nCLAMP BLOCK FUNCTIONS:\n----------------------\n// flow refers to an async function callback    : async () => {...}\n\n    // Rhythm\nplay a note                 : playNote(value, flow)\nplay a note (ms)            : playNoteMillis(value, flow)\ndot                         : dot(value, flow)\ntie                         : tie(flow)\nmultiply note value         : multiplyNoteValue(factor, flow)\nswing                       : swing(swingValue, noteValue, flow)\n\n    // Meter\n(drift) set no clock        : setNoClock(flow)\n\n    // Pitch\nadd accidental              : setAccidental(accidental, flow)\nscalar transpose            : setScalarTranspose(value, flow)\nsemitone transpose          : setSemitoneTranspose(value, flow)\ninvert                      : invert(name, octave, mode, flow)\n\n    // Intervals\nscalar interval             : setScalarInterval(value, flow)\nsemitone interval           : setSemitoneInterval(value, flow)\n\n    // Tone\nset instrument              : setInstrument(instrument, flow)\nvibrato                     : doVibrato(intensity, rate, flow)\nchorus                      : doChorus(chorusRate, delayTime, chorusDepth, flow)\nphaser                      : doPhaser(rate, octaves, baseFrequency, flow)\ntremolo                     : doTremolo(frequency, depth, flow)\ndistortion                  : doDistortion(distortion, flow)\nharmonic                    : doHarmonic(harmonic, flow)\n\n    // Ornament\nstaccato                    : setStaccato(value, flow)\nslur                        : setSlur(value, flow)\nneighbor                    : doNeighbor(interval, noteValue, flow)\n\n    // Volume\ncrescendo                   : doCrescendo(value, flow)\ndecrescendo                 : doDecrescendo(value, flow)\nset relative volume         : setRelativeVolume(value, flow)\n\n    // Drum\nset drum                    : setDrum(drum, flow)\nmap pitch to drum           : mapPitchToDrum(drum, flow)\n\n    // Number\n// use MathUtility.funcName(...) instead of mouse.funcName(...) for these\n\nrandom                      : doRandom(lowerLimit, upperLimit)\none of                      : doOneOf(value_1, value_2)\ndistance                    : doCalculateDistance(x_1, y_1, x_2, y_2)\n\n    // Pen\ndraw filled polygon         : fillShape(flow)\ndraw hollow lines           : hollowLine(flow)\n\nFLOW BLOCK SETTERS:\n-------------------\npickup                      : PICKUP\nmovable                     : MOVABLE\nset master volume           : MASTERVOLUME\nset panning                 : PANNING\n\nVALUE BLOCK GETTERS:\n--------------------\ncurrent note value          : NOTEVALUE\ncount of whole notes played : WHOLENOTESPLAYED\nbeat count                  : BEATCOUNT\nmeasure count               : MEASURECOUNT\nbeats per minute            : BPM\nbeat factor                 : BEATFACTOR\ncurrent meter               : CURRENTMETER\nchange in pitch vs previous : CHANGEINPITCH\nscalar change in pitch      : SCALARCHANGEINPITCH\nscalar step up              : SCALARSTEPUP\nscalar step down            : SCALARSTEPDOWN\nis solfege movable          : MOVABLEDO\ncurrent key                 : CURRENTKEY\ncurrent mode                : CURRENTMODE\ncurrent mode length         : MODELENGTH\nmaster volume               : MASTERVOLUME\nmouse X coordinate          : X\nmouse Y coordinate          : Y\nmouse head angle            : HEADING\npen size                    : PENSIZE\npen color                   : COLOR\npen lightness               : SHADE\npen saturation              : GREY\n*/",JS_STARTER="let rightSqr = async mouse => {\n    await mouse.hollowLine(async () => {\n        for (let i = 0; i < 4; i++) {\n            await mouse.goForward(100);\n            await mouse.turnRight(90);\n        }\n        return mouse.ENDFLOW;\n    });\n    return mouse.ENDFLOW;\n};\n\nlet leftSqr = async mouse => {\n    await mouse.hollowLine(async () => {\n        for (let i = 0; i < 4; i++) {\n            await mouse.goForward(100);\n            await mouse.turnLeft(90);\n        }\n        return mouse.ENDFLOW;\n    });\n    return mouse.ENDFLOW;\n};\n\nnew Mouse(async mouse => {\n    for (let i = 0; i < 12; i++) {\n        await mouse.goForward(100);\n        if (i < 6) {\n            await mouse.turnRight(60);\n        } else {\n            await mouse.turnLeft(60);\n        }\n    }\n    await mouse.clear();\n    await rightSqr(mouse);\n});\n\nnew Mouse(async mouse => {\n    for (let i = 0; i < 12; i++) {\n        await mouse.goForward(150);\n        if (i < 6) {\n            await mouse.turnLeft(60);\n        } else {\n            await mouse.turnRight(60);\n        }\n    }\n    await mouse.clear();\n    await leftSqr(mouse);\n});\n\nMusicBlocks.run();\n",SAMPLE_1='new Mouse(async mouse => {\n    await mouse.playPitch("sol", 4);\n    for (let i = 0; i < 7; i++) {\n        await mouse.playNote(1/4, async () => {\n            await mouse.stepPitch(1);\n            return mouse.ENDFLOW;\n        });\n    }\n    for (let i = 0; i < 7; i++) {\n        await mouse.playNote(1/4, async () => {\n            await mouse.stepPitch(-1);\n            return mouse.ENDFLOW;\n        });\n    }\n    return mouse.ENDMOUSE;\n});\n\nMusicBlocks.run();\n',SAMPLE_2='new Mouse(async mouse => {\n    await mouse.playNote(1/4, async () => {\n        await mouse.playPitch("sol", 4);\n        await mouse.playPitch("do", 4);\n        return mouse.ENDFLOW;\n    });\n    await mouse.playNote(1/1, async () => {\n        await mouse.playPitch("re", 4);\n        return mouse.ENDFLOW;\n    });\n    await mouse.playNote(1/4, async () => {\n        await mouse.playPitch("mi", 4);\n        return mouse.ENDFLOW;\n    });\n    await mouse.playNote(1/4, async () => {\n        await mouse.playPitch("fa", 4);\n        await mouse.playNote(1/2, async () => {\n            await mouse.playPitch("mi", 4);\n            return mouse.ENDFLOW;\n        });\n        return mouse.ENDFLOW;\n    });\n    return mouse.ENDMOUSE;\n});\n\nnew Mouse(async mouse => {\n    await mouse.playPitch("re", 5);\n    return mouse.ENDMOUSE;\n});\n\nMusicBlocks.run();\n';
function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var i;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(i="Object"===(i={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=Array(e);i<e;i++)o[i]=t[i];return o}var setupDictActions=require("../DictActions");describe("setupDictActions",function(){var i,n,r;beforeAll(function(){global.Turtle={DictActions:{}},global._=jest.fn(function(t){return t}),global.Singer={RhythmActions:{getNoteValue:jest.fn().mockReturnValue(4)}},global.getNote=jest.fn().mockReturnValue(["G",4]),global.pitchToNumber=jest.fn().mockReturnValue(60),global.INVALIDPITCH="Invalid pitch",global.getTargetTurtle=jest.fn()}),beforeEach(function(){i={turtles:{ithTurtle:jest.fn(),screenX2turtleX:jest.fn(),screenY2turtleY:jest.fn()},logo:{turtleDicts:{},synth:{inTemperament:"equal"}},textMsg:jest.fn(),errorMsg:jest.fn()},n=0,r={painter:{color:"red",value:10,chroma:.5,pensize:2,stroke:2,font:"Arial",orientation:90,turtle:{orientation:90},doSetColor:jest.fn(),doSetValue:jest.fn(),doSetChroma:jest.fn(),doSetPensize:jest.fn(),doSetFont:jest.fn(),doSetHeading:jest.fn(),doSetXY:jest.fn()},container:{x:100,y:200},singer:{notesPlayed:[1,2],lastNotePlayed:["C4"],notePitches:["C"],noteOctaves:[4],keySignature:"C",movable:!0,pitchNumberOffset:0}},i.turtles.ithTurtle.mockReturnValue(r),i.turtles.screenX2turtleX.mockReturnValue(100),i.turtles.screenY2turtleY.mockReturnValue(200),global.getTargetTurtle.mockImplementation(function(t,e){return"target"===e?0:null}),setupDictActions(i),i.logo.turtleDicts[n]={}}),describe("_GetDict",function(){test.each([["color","red"],["shade",10],["grey",.5],["pen size",2],["font","Arial"],["heading",90],["x",100],["y",200],["notes played",.5]])("should get %s correctly",function(t,e){expect(Turtle.DictActions._GetDict(0,n,t)).toBe(e)}),it("should get the note value correctly",function(){var t=Turtle.DictActions._GetDict(0,n,"note value");expect(t).toBe(4),expect(Singer.RhythmActions.getNoteValue).toHaveBeenCalledWith(0)}),it("should get the current pitch correctly",function(){var t=Turtle.DictActions._GetDict(0,n,"current pitch");expect(t).toBe("C4")}),it("should get the pitch number correctly with lastNotePlayed",function(){var t=Turtle.DictActions._GetDict(0,n,"pitch number");expect(t).toBe(60),expect(pitchToNumber).toHaveBeenCalledWith("C",4,"C")}),it("should get the pitch number correctly using notePitches when lastNotePlayed is null",function(){r.singer.lastNotePlayed=null;var t=Turtle.DictActions._GetDict(0,n,"pitch number",1);expect(t).toBe(60),expect(getNote).toHaveBeenCalled()}),it("should handle error when getting pitch number with no notes",function(){r.singer.lastNotePlayed=null,r.singer.notePitches=[];var t=Turtle.DictActions._GetDict(0,n,"pitch number",1);expect(t).toBe(60),expect(i.errorMsg).toHaveBeenCalledWith(INVALIDPITCH,1)}),it("should return undefined for an unsupported key",function(){var t=Turtle.DictActions._GetDict(0,n,"unsupportedKey");expect(t).toBeUndefined()})}),describe("SetDictValue",function(){test.each([["color","blue","doSetColor",["blue"]],["shade",20,"doSetValue",[20]],["grey",.7,"doSetChroma",[.7]],["pen size",5,"doSetPensize",[5]],["font","Times New Roman","doSetFont",["Times New Roman"]],["heading",180,"doSetHeading",[180]],["x",150,"doSetXY",[150,200]],["y",250,"doSetXY",[100,250]]])("should set %s correctly",function(t,e,i,o){Turtle.DictActions.SetDictValue(0,n,t,e),(t=expect(r.painter[i])).toHaveBeenCalledWith.apply(t,_toConsumableArray(o))})}),describe("SerializeDict",function(){it("should serialize the turtle dictionary correctly",function(){var t=Turtle.DictActions.SerializeDict(0,n),e=JSON.stringify({color:"red",shade:10,grey:.5,"pen size":2,font:"Arial",heading:90,y:200,x:100});expect(t).toBe(e)}),it("should include additional properties from turtleDicts",function(){i.logo.turtleDicts[n]={0:{custom:"value"}};var t=Turtle.DictActions.SerializeDict(0,n),e=JSON.stringify({color:"red",shade:10,grey:.5,"pen size":2,font:"Arial",heading:90,y:200,x:100,custom:"value"});expect(t).toBe(e)})}),describe("getDict",function(){it("should return serialized turtle dictionary when dict is a turtle name",function(){var t=Turtle.DictActions.getDict("target",n),e=Turtle.DictActions.SerializeDict(0,n);expect(t).toBe(e)}),it("should return empty object JSON when dict does not exist",function(){i.logo.turtleDicts[n]={};var t=Turtle.DictActions.getDict("nonexistent",n);expect(t).toBe("{}")}),it("should return dictionary JSON when dict exists",function(){i.logo.turtleDicts[n]={testDict:{key:"value"}};var t=Turtle.DictActions.getDict("testDict",n);expect(t).toBe(JSON.stringify({key:"value"}))}),it("should initialize turtleDicts when it doesn't exist for the turtle",function(){delete i.logo.turtleDicts[n];var t=Turtle.DictActions.getDict("nonexistent",n);expect(t).toBe("{}"),expect(i.logo.turtleDicts[n]).toEqual({})})}),describe("showDict",function(){it("should display the dictionary contents",function(){i.logo.turtleDicts[n]={testDict:{key:"value"}},Turtle.DictActions.showDict("testDict",n),expect(i.textMsg).toHaveBeenCalledWith(JSON.stringify({key:"value"}))}),it("should display turtle information when dict is a turtle name",function(){var t=Turtle.DictActions.SerializeDict(0,n);Turtle.DictActions.showDict("target",n),expect(i.textMsg).toHaveBeenCalledWith(t)}),it("should display empty JSON when dict name does not exist",function(){i.logo.turtleDicts[n]={},Turtle.DictActions.showDict("nonexistentDict",n),expect(i.textMsg).toHaveBeenCalledWith("{}")})}),describe("setValue",function(){it("should set value in the dictionary",function(){i.logo.turtleDicts[n]={},Turtle.DictActions.setValue("customDict","color","green",n),expect(i.logo.turtleDicts[n].customDict.color).toBe("green")}),it("should create a new dictionary if it doesn't exist",function(){i.logo.turtleDicts[n]={},Turtle.DictActions.setValue("newDict","key","value",n),expect(i.logo.turtleDicts[n].newDict.key).toBe("value")}),it("should create a new turtleDicts entry if it doesn't exist",function(){delete i.logo.turtleDicts[n],Turtle.DictActions.setValue("newDict","key","value",n),expect(i.logo.turtleDicts[n].newDict.key).toBe("value")}),it("should log to console when setting a value",function(){console.log=jest.fn(),i.logo.turtleDicts[n]={},Turtle.DictActions.setValue("testDict","key","value",n),expect(console.log).toHaveBeenCalled()})}),describe("getValue",function(){it("should return value from the dictionary",function(){i.logo.turtleDicts[n]={testDict:{key:"value"}};var t=Turtle.DictActions.getValue("testDict","key",n);expect(t).toBe("value")}),it("should return error message if dictionary does not exist",function(){i.logo.turtleDicts[n]={};var t=Turtle.DictActions.getValue("nonexistentDict","key",n);expect(t).toBe("Dictionary with this name does not exist")}),it("should return error message if key does not exist in dictionary",function(){i.logo.turtleDicts[n]={testDict:{existingKey:"value"}};var t=Turtle.DictActions.getValue("testDict","nonexistentKey",n);expect(t).toBe("Key with this name does not exist in testDict")})})});
var setupDrumActions=require("../DrumActions");describe("setupDrumActions",function(){var o,i;beforeAll(function(){global.Singer={DrumActions:{},processNote:jest.fn()},global.DEFAULTDRUM="defaultDrum",global.DRUMNAMES={drum1:["d1","drum1"],drum2:["d2","drum2"]},global.NOISENAMES={noise1:["n1","noise1"],noise2:["n2","noise2"]},global.DEFAULTVOLUME=100,global.last=jest.fn(function(e){return e[e.length-1]}),global._=jest.fn(function(e){return e}),global.MusicBlocks={isRun:!1},global.Mouse={getMouseFromTurtle:jest.fn()}}),beforeEach(function(){o={turtles:{ithTurtle:jest.fn()},blocks:{blockList:{1:{}}},logo:{setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),clearNoteParams:jest.fn(),inRhythmRuler:!1,rhythmRuler:{Drums:[],Rulers:[]},_currentDrumBlock:null},errorMsg:jest.fn()},i={singer:{drumStyle:[],inNoteBlock:[],noteDrums:{},synthVolume:{},crescendoInitialVolume:{},noteBeatValues:{},beatFactor:1,pushedNote:!1,pitchDrumTable:{}}},o.turtles.ithTurtle.mockReturnValue(i),global.MusicBlocks.isRun=!1,global.Mouse.getMouseFromTurtle.mockReturnValue(null),setupDrumActions(o)}),describe("GetDrumname",function(){it("should return the correct drum name when given nickname",function(){var e=Singer.DrumActions.GetDrumname("d1");expect(e).toBe("drum1")}),it("should return the default drum for unknown drums",function(){var e=Singer.DrumActions.GetDrumname("unknown");expect(e).toBe(DEFAULTDRUM)}),it("should return http URLs directly",function(){var e="https://example.com/drum.wav",n=Singer.DrumActions.GetDrumname(e);expect(n).toBe(e)}),it("should handle direct drum names",function(){var e=Singer.DrumActions.GetDrumname("drum1");expect(e).toBe("drum1")})}),describe("playDrum",function(){it("should play a standalone drum sound",function(){i.singer.noteDrums[1]||(i.singer.noteDrums[1]=[]),Singer.DrumActions.playDrum("d1",0,1),expect(Singer.processNote).toHaveBeenCalledWith(o,expect.any(Number),!1,expect.anything(),0,expect.any(Function)),expect(o.logo.clearNoteParams).toHaveBeenCalledWith(i,1,[]),expect(i.singer.inNoteBlock).toContain(1),expect(i.singer.noteDrums[1]).toContain("drum1"),expect(i.singer.pushedNote).toBe(!0)}),it("should add a drum to an existing note block",function(){i.singer.inNoteBlock.push(2),i.singer.noteDrums[2]=[],Singer.DrumActions.playDrum("d1",0,1),expect(i.singer.noteDrums[2]).toContain("drum1")}),it("should use the drum style if one is set",function(){i.singer.inNoteBlock.push(2),i.singer.noteDrums[2]=[],i.singer.drumStyle.push("drum2"),Singer.DrumActions.playDrum("d1",0,1),expect(i.singer.noteDrums[2]).toContain("drum2"),expect(i.singer.noteDrums[2]).not.toContain("drum1")}),it("should initialize synthVolume if not defined",function(){i.singer.inNoteBlock.push(2),i.singer.noteDrums[2]=[],i.singer.synthVolume={},Singer.DrumActions.playDrum("d1",0,1),expect(i.singer.synthVolume.drum1).toEqual([DEFAULTVOLUME]),expect(i.singer.crescendoInitialVolume.drum1).toEqual([DEFAULTVOLUME])}),it("should not overwrite existing synthVolume and crescendoInitialVolume",function(){i.singer.inNoteBlock.push(5),i.singer.noteDrums[5]=[],i.singer.synthVolume={drum1:[30]},i.singer.crescendoInitialVolume={drum1:[40]},Singer.DrumActions.playDrum("d1",0,5),expect(i.singer.synthVolume.drum1).toEqual([30]),expect(i.singer.crescendoInitialVolume.drum1).toEqual([40])}),it("should remove the block from inNoteBlock when the callback is invoked",function(){i.singer.noteDrums[2]||(i.singer.noteDrums[2]=[]),Singer.DrumActions.playDrum("d1",0,2),expect(i.singer.inNoteBlock).toContain(2),(0,Singer.processNote.mock.calls[0][5])(),expect(i.singer.inNoteBlock).not.toContain(2)})});describe.each([["setDrum","_setdrum_0",!0],["mapPitchToDrum","_mapdrum_0",!1]])("%s",function(n,t,e){beforeEach(function(){i.singer.drumStyle=[],i.singer.pitchDrumTable={},o.logo.setDispatchBlock.mockClear(),o.logo.setTurtleListener.mockClear(),global.MusicBlocks.isRun=!1,global.Mouse.getMouseFromTurtle.mockReturnValue(null)}),it("sets drum style and listener",function(){Singer.DrumActions[n]("d1",0,1),expect(i.singer.drumStyle).toContain("drum1"),expect(o.logo.setDispatchBlock).toHaveBeenCalledWith(1,0,t),expect(o.logo.setTurtleListener).toHaveBeenCalledWith(0,t,expect.any(Function))}),it("handles MusicBlocks.isRun case",function(){var e={MB:{listeners:[]}};global.MusicBlocks.isRun=!0,global.Mouse.getMouseFromTurtle.mockReturnValue(e),Singer.DrumActions[n]("d1",0),expect(i.singer.drumStyle).toContain("drum1"),expect(e.MB.listeners).toContain(t)}),it("handles direct drum name input",function(){Singer.DrumActions[n]("drum2",0,1),expect(i.singer.drumStyle).toContain("drum2")}),it("handles rhythm ruler",function(){o.logo.inRhythmRuler=!0,Singer.DrumActions[n]("d1",0,1),expect(o.logo._currentDrumBlock).toBe(1),expect(o.logo.rhythmRuler.Drums).toContain(1),expect(o.logo.rhythmRuler.Rulers).toHaveLength(1)}),it("removes drumStyle on listener",function(){Singer.DrumActions[n]("d1",0,1),(0,o.logo.setTurtleListener.mock.calls[0][2])(),expect(i.singer.drumStyle).toHaveLength(0),e&&expect(i.singer.pitchDrumTable).toEqual({})}),it("only adds listener when blk undefined and not running",function(){Singer.DrumActions[n]("d1",0),expect(o.logo.setDispatchBlock).not.toHaveBeenCalled(),expect(global.Mouse.getMouseFromTurtle).not.toHaveBeenCalled(),expect(o.logo.setTurtleListener).toHaveBeenCalledWith(0,expect.any(String),expect.any(Function))}),it("skips mouse listener when isRun and mouse null",function(){global.MusicBlocks.isRun=!0,global.Mouse.getMouseFromTurtle.mockReturnValue(null),Singer.DrumActions[n]("d1",0),expect(o.logo.setDispatchBlock).not.toHaveBeenCalled(),expect(global.Mouse.getMouseFromTurtle).toHaveBeenCalledWith(expect.any(Object)),expect(o.logo.setTurtleListener).toHaveBeenCalledWith(0,expect.any(String),expect.any(Function))})}),describe("playNoise",function(){it("should play noise in a note block",function(){i.singer.inNoteBlock.push(2),i.singer.noteDrums[2]=[],i.singer.noteBeatValues[2]=[],Singer.DrumActions.playNoise("n1",0,1),expect(i.singer.noteDrums[2]).toContain("noise1"),expect(i.singer.noteBeatValues[2]).toContain(1),expect(i.singer.pushedNote).toBe(!0)}),it("should throw an error for standalone noise block",function(){Singer.DrumActions.playNoise("n1",0,1),expect(o.errorMsg).toHaveBeenCalledWith("Noise Block: Did you mean to use a Note block?",1)}),it("should handle direct noise name input",function(){i.singer.inNoteBlock.push(2),i.singer.noteDrums[2]=[],i.singer.noteBeatValues[2]=[],Singer.DrumActions.playNoise("noise2",0,1),expect(i.singer.noteDrums[2]).toContain("noise2")}),it("should initialize synthVolume if not defined",function(){i.singer.inNoteBlock.push(2),i.singer.noteDrums[2]=[],i.singer.noteBeatValues[2]=[],i.singer.synthVolume={},Singer.DrumActions.playNoise("n1",0,1),expect(i.singer.synthVolume.noise1).toEqual([DEFAULTVOLUME]),expect(i.singer.crescendoInitialVolume.noise1).toEqual([DEFAULTVOLUME])}),it("should push unknown noise names directly",function(){i.singer.inNoteBlock.push(3),i.singer.noteDrums[3]=[],i.singer.noteBeatValues[3]=[],Singer.DrumActions.playNoise("foo",0,3),expect(i.singer.noteDrums[3]).toContain("foo")}),it("should not reinitialize synthVolume if already defined",function(){i.singer.inNoteBlock.push(4),i.singer.noteDrums[4]=[],i.singer.noteBeatValues[4]=[],i.singer.synthVolume={noise1:[50]},i.singer.crescendoInitialVolume={noise1:[60]},Singer.DrumActions.playNoise("n1",0,4),expect(i.singer.synthVolume.noise1).toEqual([50]),expect(i.singer.crescendoInitialVolume.noise1).toEqual([60])})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var _require=require("../IntervalsActions"),setupIntervalsActions=_require.setupIntervalsActions;describe("setupIntervalsActions",function(){var e,t,n;beforeEach(function(){jest.resetModules(),global._=function(e){return e},global.NOINPUTERRORMSG="NOINPUT",global.MUSICALMODES={major:[2,2,1,2,2,2,1],minor:[2,1,2,2,1,2,2]},global.ALLNOTESTEP={C:0,D:2,E:4,F:5,G:7,A:9,B:11},global.NOTENAMES=["C","D","E","F","G","A","B"],global.SEMITONETOINTERVALMAP=Array(13).fill(null).map(function(){return Array(7).fill("perfect")}),global.GetNotesForInterval=jest.fn(function(){return{firstNote:"C",secondNote:"G",octave:0}}),global.getNote=jest.fn(function(){return["C"]}),global.getModeLength=jest.fn(function(){return 7}),global.MusicBlocks={isRun:!1},global.Mouse={getMouseFromTurtle:jest.fn()},global.Singer={},n={synth:{inTemperament:null,startingPitch:null,changeInTemperament:!(t={singer:{keySignature:"C major",transposition:0,movable:!1,intervals:[],chordIntervals:[],semitoneIntervals:[],ratioIntervals:[],noteDirection:1,defineMode:[]}})},notation:{notationKey:jest.fn()},temperamentSelected:[],setDispatchBlock:jest.fn(),setTurtleListener:jest.fn()},e={turtles:{ithTurtle:function(){return t}},blocks:{blockList:{},updateBlockText:jest.fn()},logo:n,errorMsg:jest.fn()},setupIntervalsActions(e)}),test("GetModename resolves modes",function(){expect(Singer.IntervalsActions.GetModename("major")).toBe("major"),expect(Singer.IntervalsActions.GetModename("minor")).toBe("minor")}),test("GetIntervalNumber base case",function(){expect(_typeof(Singer.IntervalsActions.GetIntervalNumber(0))).toBe("number")}),test("GetIntervalNumber octave > 1",function(){GetNotesForInterval.mockReturnValueOnce({firstNote:"C",secondNote:"C",octave:2}),expect(Singer.IntervalsActions.GetIntervalNumber(0)).toBeGreaterThan(12)}),test("GetIntervalNumber octave < -1",function(){GetNotesForInterval.mockReturnValueOnce({firstNote:"C",secondNote:"D",octave:-3}),expect(_typeof(Singer.IntervalsActions.GetIntervalNumber(0))).toBe("number")}),test("GetCurrentInterval normal",function(){expect(_typeof(Singer.IntervalsActions.GetCurrentInterval(0))).toBe("string")}),test("GetCurrentInterval perfect octave above",function(){GetNotesForInterval.mockReturnValueOnce({firstNote:"C",secondNote:"C",octave:2}),expect(_typeof(Singer.IntervalsActions.GetCurrentInterval(0))).toBe("string")}),test("GetCurrentInterval perfect octave below",function(){GetNotesForInterval.mockReturnValueOnce({firstNote:"C",secondNote:"C",octave:-1}),expect(_typeof(Singer.IntervalsActions.GetCurrentInterval(0))).toBe("string")}),test("GetCurrentInterval octave < -1",function(){GetNotesForInterval.mockReturnValueOnce({firstNote:"G",secondNote:"C",octave:-2}),expect(_typeof(Singer.IntervalsActions.GetCurrentInterval(0))).toBe("string")}),test("GetCurrentInterval totalIntervals > 21",function(){GetNotesForInterval.mockReturnValueOnce({firstNote:"C",secondNote:"B",octave:3}),expect(_typeof(Singer.IntervalsActions.GetCurrentInterval(0))).toBe("string")}),test("setKey updates keySignature",function(){Singer.IntervalsActions.setKey("C","major",0),expect(t.singer.keySignature).toContain("C"),expect(n.notation.notationKey).toHaveBeenCalled()}),test("getCurrentKey / Mode / Length",function(){expect(Singer.IntervalsActions.getCurrentKey(0)).toBe("C"),expect(Singer.IntervalsActions.getCurrentMode(0)).toBe("major"),expect(Singer.IntervalsActions.getModeLength(0)).toBe(7)}),test("setMovableDo",function(){Singer.IntervalsActions.setMovableDo(!0,0),expect(t.singer.movable).toBe(!0)}),test("setScalarInterval push + pop",function(){var r;n.setTurtleListener.mockImplementation(function(e,t,n){return r=n}),Singer.IntervalsActions.setScalarInterval(2,0,"blk"),expect(t.singer.intervals.length).toBe(1),r(),expect(t.singer.intervals.length).toBe(0)}),test("setScalarInterval error on null",function(){Singer.IntervalsActions.setScalarInterval(null,0,"blk"),expect(e.errorMsg).toHaveBeenCalledWith("NOINPUT","blk")}),test("setChordInterval push + pop",function(){var r;n.setTurtleListener.mockImplementation(function(e,t,n){return r=n}),Singer.IntervalsActions.setChordInterval([1,0],0,"blk"),expect(t.singer.chordIntervals.length).toBe(1),r(),expect(t.singer.chordIntervals.length).toBe(0)}),test("setSemitoneInterval zero ignored",function(){Singer.IntervalsActions.setSemitoneInterval(0,0),expect(t.singer.semitoneIntervals.length).toBe(0)}),test("setSemitoneInterval push + pop",function(){var r;n.setTurtleListener.mockImplementation(function(e,t,n){return r=n}),Singer.IntervalsActions.setSemitoneInterval(2,0,"blk"),expect(t.singer.semitoneIntervals.length).toBe(1),r(),expect(t.singer.semitoneIntervals.length).toBe(0)}),test("setRatioInterval push + pop",function(){var r;n.setTurtleListener.mockImplementation(function(e,t,n){return r=n}),Singer.IntervalsActions.setRatioInterval(1.5,0,"blk"),expect(t.singer.ratioIntervals.length).toBe(1),r(),expect(t.singer.ratioIntervals.length).toBe(0)}),test("defineMode success path",function(){var r;n.setTurtleListener.mockImplementation(function(e,t,n){return r=n}),e.blocks.blockList.blk={connections:[null,"text1"]},e.blocks.blockList.text1={name:"text"},Singer.IntervalsActions.defineMode("custom",0,"blk"),t.singer.defineMode.push(0,4,7),r(),expect(MUSICALMODES.custom).toBeDefined()}),test("defineMode error paths",function(){var r;n.setTurtleListener.mockImplementation(function(e,t,n){return r=n}),e.blocks.blockList.blk={connections:[null,"text1"]},e.blocks.blockList.text1={name:"text"},Singer.IntervalsActions.defineMode(null,0,"blk"),t.singer.defineMode.push(4),t.singer.defineMode.push(12),t.singer.defineMode.push(4),r(),expect(e.errorMsg).toHaveBeenCalled()}),test("setTemperament state changes",function(){Singer.IntervalsActions.setTemperament("equal","C",4),expect(n.synth.inTemperament).toBe("equal"),expect(n.synth.startingPitch).toBe("C4")}),test("setTemperament change flag",function(){Singer.IntervalsActions.setTemperament("equal","C",4),Singer.IntervalsActions.setTemperament("pythagorean","C",4),expect(n.synth.changeInTemperament).toBe(!0)})});
function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var setupMeterActions=require("../MeterActions");describe("setupMeterActions",function(){var s,a;beforeAll(function(){global.Singer={MeterActions:{},RhythmActions:{getNoteValue:jest.fn(function(){return 1})}},global.TONEBPM=240,global.Queue=jest.fn(function(e,t,n){return{action:e,duration:t,blk:n}}),global.last=jest.fn(function(e){return e[e.length-1]}),global._=jest.fn(function(e){return e}),global.rationalToFraction=jest.fn(function(e){return[4*e,4]})}),beforeEach(function(){s={turtles:{ithTurtle:jest.fn(),turtleList:[],addTurtle:jest.fn(),getTurtle:jest.fn(function(e){return a}),getTurtleCount:jest.fn(function(){return 1})},blocks:{blockList:{1:{}}},logo:{actions:{testAction:"testAction"},setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),initTurtle:jest.fn(),prepSynths:jest.fn(),runFromBlockNow:jest.fn(),notation:{notationMeter:jest.fn(),notationPickup:jest.fn()}},errorMsg:jest.fn(),stage:{dispatchEvent:jest.fn()}},a={id:0,singer:{beatsPerMeasure:0,noteValuePerBeat:0,beatList:[],factorList:[],defaultStrongBeats:!1,bpm:[],notesPlayed:[0,1],pickup:0,drift:0},queue:[],parentFlowQueue:[],unhighlightQueue:[],parameterQueue:[]},s.turtles.ithTurtle.mockReturnValue(a),setupMeterActions(s)}),it("should set the meter correctly",function(){Singer.MeterActions.setMeter(4,4,0),expect(a.singer.beatsPerMeasure).toBe(4),expect(a.singer.noteValuePerBeat).toBe(.25),expect(s.logo.notation.notationMeter).toHaveBeenCalledWith(0,4,.25)}),describe("default strong beats for various time signatures",function(){test.each([[4,.25,[1,3]],[2,.25,[1]],[3,.25,[1]],[6,1/8,[1,4]]])("should set default strong beats for %i/%f time",function(e,t,n){a.singer.beatList=[],Singer.MeterActions.setMeter(e,t,0),n.forEach(function(e){return expect(a.singer.beatList).toContain(e)}),expect(a.singer.defaultStrongBeats).toBe(!0)})}),it("should handle non-standard time signatures without adding default beats",function(){a.singer.beatList=[],Singer.MeterActions.setMeter(5,.25,0),expect(a.singer.beatList.length).toBe(0),expect(a.singer.defaultStrongBeats).toBe(!1)}),describe("setPickup",function(){test.each([[2,0,2,!0],[-2,0,0,!1]])("setPickup(%i, %i) should result in pickup %i",function(e,t,n,r){Singer.MeterActions.setPickup(e,t),expect(a.singer.pickup).toBe(n),r&&expect(s.logo.notation.notationPickup).toHaveBeenCalledWith(t,e)})}),describe("BPM settings",function(){test.each([[120,.25,[],120,void 0],[10,.25,["1/4 beats per minute must be greater than 30"],30,1],[5e3,.25,["maximum 1/4 beats per minute is 1000"],1e3,1]])("setBPM(%i) should handle %s range",function(e,t,n,r,o){s.errorMsg.mockClear(),Singer.MeterActions.setBPM(e,t,0,o),n.length&&n.forEach(function(e){return expect(s.errorMsg).toHaveBeenCalledWith(e,o)}),expect(a.singer.bpm).toContain(r)})}),describe("master BPM settings",function(){test.each([[100,[],100],[500,[],500],[10,["1/4 beats per minute must be greater than 30"],30],[5e3,["maximum 1/4 beats per minute is 1000"],1e3]])("setMasterBPM(%i) should result in masterBPM %i",function(e,t,n){s.errorMsg.mockClear(),Singer.MeterActions.setMasterBPM(e,.25,1),t.length&&t.forEach(function(e){return expect(s.errorMsg).toHaveBeenCalledWith(e,1)}),expect(Singer.masterBPM).toBe(n),t.length||expect(Singer.defaultBPMFactor).toBe(TONEBPM/n)})}),it("should set a listener for every beat",function(){s.turtles.turtleList=[{companionTurtle:null}],s.turtles.addTurtle=jest.fn(),s.logo.prepSynths=jest.fn(),a.id=0,Singer.MeterActions.onEveryBeatDo("testAction",!1,null,0,1),expect(s.turtles.addTurtle).toHaveBeenCalled(),expect(s.logo.prepSynths).toHaveBeenCalled(),expect(s.logo.setTurtleListener).toHaveBeenCalledWith(1,"__everybeat_1__",expect.any(Function))}),it("should handle running turtle in onEveryBeatDo listener",function(){a.id=0;var t={id:a.companionTurtle=1,running:!0,singer:{bpm:[]},queue:[],parentFlowQueue:[],unhighlightQueue:[],parameterQueue:[]};s.turtles.ithTurtle.mockImplementation(function(e){return 0===e?a:t}),global.setInterval=jest.fn(function(){return 12345}),Singer.MeterActions.onEveryBeatDo("testAction",!1,null,0,1),(0,s.logo.setTurtleListener.mock.calls[0][2])(),expect(t.queue.length).toBe(1),expect(t.parentFlowQueue).toContain(1)}),it("should handle non-running turtle in onEveryBeatDo listener",function(){a.id=0;var t={id:a.companionTurtle=1,running:!1,singer:{bpm:[]},queue:[],parentFlowQueue:[],unhighlightQueue:[],parameterQueue:[]};s.turtles.ithTurtle.mockImplementation(function(e){return 0===e?a:t}),global.setInterval=jest.fn(function(){return 12345}),Singer.MeterActions.onEveryBeatDo("testAction",!1,null,0,1),(0,s.logo.setTurtleListener.mock.calls[0][2])(),expect(s.logo.runFromBlockNow).toHaveBeenCalledWith(s.logo,1,"testAction",!1,null)}),it("should clear existing interval when setting up a new one",function(){var t={id:a.companionTurtle=1,interval:12345,singer:{bpm:[]},queue:[],parentFlowQueue:[],unhighlightQueue:[],parameterQueue:[]};s.turtles.ithTurtle.mockImplementation(function(e){return 0===e?a:t}),global.clearInterval=jest.fn(),global.setInterval=jest.fn(function(){return 54321}),Singer.MeterActions.onEveryBeatDo("testAction",!1,null,0,1),expect(clearInterval).toHaveBeenCalledWith(12345),expect(setInterval).toHaveBeenCalled()}),it("should set a listener for every note",function(){Singer.MeterActions.onEveryNoteDo("testAction",!1,null,0,1),expect(s.logo.setTurtleListener).toHaveBeenCalled(),expect(a.singer.beatList).toContain("everybeat")}),it("should setup listener for strong beat",function(){a.id=0,a.singer.beatsPerMeasure=4,Singer.MeterActions.onStrongBeatDo(1,"testAction",!1,null,0,1),expect(s.logo.setTurtleListener).toHaveBeenCalledWith(0,"__beat_1_0__",expect.any(Function)),expect(a.singer.beatList).toContain(1)}),it("should clear default strong beats when adding custom strong beat",function(){a.singer.defaultStrongBeats=!0,a.singer.beatList=[1,3,5,"everybeat","offbeat"],a.singer.beatsPerMeasure=6,Singer.MeterActions.onStrongBeatDo(2,"testAction",!1,null,0,1),expect(a.singer.beatList).not.toContain(1),expect(a.singer.beatList).not.toContain(3),expect(a.singer.beatList).not.toContain(5),expect(a.singer.beatList).toContain("everybeat"),expect(a.singer.beatList).toContain("offbeat"),expect(a.singer.beatList).toContain(2),expect(a.singer.defaultStrongBeats).toBe(!1)}),it("should handle beat greater than beatsPerMeasure",function(){a.singer.beatsPerMeasure=4,a.singer.factorList=[],Singer.MeterActions.onStrongBeatDo(5,"testAction",!1,null,0,1),expect(a.singer.factorList).toContain(5),expect(a.singer.beatList).not.toContain(5)}),it("should set up listener for weak beat",function(){a.id=0,Singer.MeterActions.onWeakBeatDo("testAction",!1,null,0,1),expect(s.logo.setTurtleListener).toHaveBeenCalledWith(0,"__offbeat_0__",expect.any(Function)),expect(a.singer.beatList).toContain("offbeat")}),it("should increment drift counter and set up listener",function(){a.singer.drift=0,global.clearInterval=jest.fn(),Singer.MeterActions.setNoClock(0,1),expect(a.singer.drift).toBe(1),expect(s.logo.setDispatchBlock).toHaveBeenCalledWith(1,0,"_drift_0");var e=s.logo.setTurtleListener.mock.calls[0][2];a.singer.drift=2,e(),expect(a.singer.drift).toBe(1)}),it("should handle MusicBlocks.isRun condition",function(){global.MusicBlocks={isRun:!0};var e={MB:{listeners:[]}};global.Mouse={getMouseFromTurtle:jest.fn(function(){return e})},Singer.MeterActions.setNoClock(0),expect(e.MB.listeners).toContain("_drift_0")}),test.each([[null],[0]])("should return 0 when noteValue is %p",function(e){e=Singer.MeterActions.getNotesPlayed(e,0);expect(e).toBe(0)}),it("should calculate notes played correctly",function(){a.singer.notesPlayed=[12,3];var e=Singer.MeterActions.getNotesPlayed(2,0);expect(e).toBe(2)}),it("should calculate whole notes played correctly",function(){a.singer.notesPlayed=[4,1];var e=Singer.MeterActions.getWholeNotesPlayed(0);expect(e).toBe(4)}),it("should return 0 when notes played is less than pickup",function(){a.singer.notesPlayed=[1,1],a.singer.pickup=2;var e=Singer.MeterActions.getBeatCount(0);expect(e).toBe(0)}),it("should calculate beat count correctly",function(){a.singer.notesPlayed=[5,1],a.singer.pickup=1,a.singer.noteValuePerBeat=1,a.singer.beatsPerMeasure=4;var e=Singer.MeterActions.getBeatCount(0);expect(e).toBe(1)}),it("should return 0 for measure count when notes played is less than pickup",function(){a.singer.notesPlayed=[1,1],a.singer.pickup=2;var e=Singer.MeterActions.getMeasureCount(0);expect(e).toBe(0)}),it("should calculate measure count correctly",function(){a.singer.notesPlayed=[9,1],a.singer.pickup=1,a.singer.noteValuePerBeat=1,a.singer.beatsPerMeasure=4;var e=Singer.MeterActions.getMeasureCount(0);expect(e).toBe(3)}),test.each([[[],80,80],[[80,120],void 0,120]])("getBPM with singer.bpm %p and masterBPM %p returns %p",function(e,t,n){a.singer.bpm=e,Singer.masterBPM=80;e=Singer.MeterActions.getBPM(0);expect(e).toBe(n)}),it("should return the correct beat factor",function(){a.singer.noteValuePerBeat=.25;var e=Singer.MeterActions.getBeatFactor(0);expect(e).toBe(.25)}),it("should return the correct meter format",function(){a.singer.beatsPerMeasure=4,a.singer.noteValuePerBeat=1;var e=Singer.MeterActions.getCurrentMeter(0);expect(e).toBe("4:1")}),describe("invalid inputs and dispatch behaviors",function(){beforeEach(function(){a.singer.beatList=[],s.logo.setDispatchBlock.mockClear(),s.stage.dispatchEvent.mockClear(),global.MusicBlocks={isRun:!1},delete s.turtles.ithTurtle(0).companionTurtle}),test.each([[0,.25,"beatsPerMeasure",4],[4,0,"noteValuePerBeat",4]])("setMeter(%p, %p) defaults %s to %i",function(e,t,n,r){Singer.MeterActions.setMeter(e,t,0),expect(a.singer[n]).toBe(r)}),it("immediately dispatches the beat event once",function(){Singer.MeterActions.onEveryBeatDo("testAction",!1,null,0,1);var e=s.turtles.getTurtle(0).companionTurtle,e="__everybeat_".concat(e,"__");expect(s.stage.dispatchEvent).toHaveBeenCalledWith(e)}),it("handles setNoClock without blk and isRun=false",function(){Singer.MeterActions.setNoClock(0),expect(s.logo.setDispatchBlock).not.toHaveBeenCalled(),expect(s.logo.setTurtleListener).toHaveBeenCalledWith(0,"_drift_0",expect.any(Function))})}),describe("listener invocation",function(){beforeEach(function(){a.queue=[],a.parentFlowQueue=[]}),test.each([["every note","onEveryNoteDo",["testAction",!1,null,0,1],"__everybeat_0__",1],["strong beat","onStrongBeatDo",[2,"testAction",!1,null,0,3],"__beat_2_0__",3],["weak beat","onWeakBeatDo",["testAction",!1,null,0,4],"__offbeat_0__",4]])("should enqueue action on %s listener",function(e,t,n,r,o){var i;(i=Singer.MeterActions)[t].apply(i,_toConsumableArray(n)),(0,s.logo.setTurtleListener.mock.calls.find(function(e){return e[1]===r})[2])(),expect(a.parentFlowQueue).toContain(o),expect(a.queue[0].action).toBe("testAction")})}),it("should return last BPM value when turtle-specific BPM is set",function(){a.singer.bpm=[80,120];var e=Singer.MeterActions.getBPM(0);expect(last).toHaveBeenCalledWith([80,120]),expect(e).toBe(120)}),it("should dispatch event on every‑beat interval callback",function(){global.setInterval=jest.fn(function(e,t){return n=e,555}),s.stage.dispatchEvent.mockClear(),a.id=0,delete s.turtles.getTurtle(0).companionTurtle,Singer.MeterActions.onEveryBeatDo("testAction",!1,null,0,1),expect(s.stage.dispatchEvent).toHaveBeenCalledTimes(1),expect(setInterval).toHaveBeenCalled(),s.stage.dispatchEvent.mockClear(),n();var n,e=s.turtles.getTurtle(0).companionTurtle,e="__everybeat_".concat(e,"__");expect(s.stage.dispatchEvent).toHaveBeenCalledWith(e)}),it("should use turtle-specific BPM for interval timer",function(){var n;global.setInterval=jest.fn(function(e,t){return n=t,999}),a.singer.noteValuePerBeat=1,a.singer.bpm=[30,120],Singer.masterBPM=60,Singer.MeterActions.onEveryBeatDo("testAction",!1,null,0,1),expect(last).toHaveBeenCalledWith([30,120]),expect(n).toBe(2e3)}),it("should set listener when Mouse.getMouseFromTurtle returns null",function(){global.MusicBlocks={isRun:!0},global.Mouse.getMouseFromTurtle=jest.fn(function(){return null}),Singer.MeterActions.setNoClock(0),expect(s.logo.setTurtleListener).toHaveBeenCalledWith(0,"_drift_0",expect.any(Function))})});
var setupOrnamentActions=require("../OrnamentActions");describe("OrnamentActions",function(){var e,r,a,p,g,x,b,h;beforeEach(function(){a=[],p=[],g=[],x=[],h={},b={listeners:[]},global.Singer={OrnamentActions:null},r={singer:{staccato:[],justCounting:[],inNeighbor:[],neighborStepPitch:[],neighborNoteValue:[]}},e={turtles:{ithTurtle:function(){return r}},blocks:{blockList:{1:{},2:{}}},logo:{setDispatchBlock:function(e,t,n){return a.push({blk:e,turtleIndex:t,listenerName:n})},setTurtleListener:function(e,t,n){p.push({turtleIndex:e,listenerName:t}),h[t]=n},notation:{notationBeginSlur:function(e){return g.push(e)},notationEndSlur:function(e){return x.push(e)}}}},global.MusicBlocks={isRun:!0},global.Mouse={getMouseFromTurtle:function(){return{MB:b}}},setupOrnamentActions(e)}),describe("setStaccato",function(){[{desc:"block defined",blk:1,expectDispatch:!0,expectMouseListener:!1,isRun:!0,nullMouse:!1},{desc:"block undefined",blk:void 0,expectDispatch:!1,expectMouseListener:!0,isRun:!0,nullMouse:!1},{desc:"isRun false",blk:void 0,expectDispatch:!1,expectMouseListener:!1,isRun:!1,nullMouse:!1},{desc:"null mouse",blk:void 0,expectDispatch:!1,expectMouseListener:!1,isRun:!0,nullMouse:!0}].forEach(function(e){var t=e.desc,n=e.blk,s=e.expectDispatch,o=e.expectMouseListener,u=e.isRun,i=e.nullMouse;test(t,function(){global.MusicBlocks.isRun=u,i&&(global.Mouse.getMouseFromTurtle=function(){return null}),Singer.OrnamentActions.setStaccato(2,0,n),expect(r.singer.staccato).toEqual([.5]),expect(a.length).toBe(s?1:0),expect(p.length).toBe(1),(o?expect(b.listeners):expect(b.listeners).not).toContain("_staccato_0"),h._staccato_0(),expect(r.singer.staccato).toEqual([])})})}),describe("setSlur",function(){[{desc:"block defined",blk:1,expectDispatch:!0,expectMouseListener:!1,isRun:!0,nullMouse:!1,justCounting:!1,expectBeginSlur:!0},{desc:"block undefined",blk:void 0,expectDispatch:!1,expectMouseListener:!0,isRun:!0,nullMouse:!1,justCounting:!1,expectBeginSlur:!0},{desc:"isRun false",blk:void 0,expectDispatch:!1,expectMouseListener:!1,isRun:!1,nullMouse:!1,justCounting:!1,expectBeginSlur:!0},{desc:"null mouse",blk:void 0,expectDispatch:!1,expectMouseListener:!1,isRun:!0,nullMouse:!0,justCounting:!1,expectBeginSlur:!0},{desc:"justCounting",blk:1,expectDispatch:!0,expectMouseListener:!1,isRun:!0,nullMouse:!1,justCounting:!0,expectBeginSlur:!1}].forEach(function(e){var t=e.desc,n=e.blk,s=e.expectDispatch,o=e.expectMouseListener,u=e.isRun,i=e.nullMouse,c=e.justCounting,l=e.expectBeginSlur;test(t,function(){r.singer.justCounting=c?[1]:[],global.MusicBlocks.isRun=u,i&&(global.Mouse.getMouseFromTurtle=function(){return null}),Singer.OrnamentActions.setSlur(2,0,n),expect(r.singer.staccato).toEqual([-.5]),expect(g.length).toBe(l?1:0),expect(a.length).toBe(s?1:0),expect(p.length).toBe(1),(o?expect(b.listeners):expect(b.listeners).not).toContain("_staccato_0"),h._staccato_0(),expect(r.singer.staccato).toEqual([]),expect(x.length).toBe(l?1:0)})})}),describe("doNeighbor",function(){[{desc:"block defined",blk:1,expectDispatch:!0,expectMouseListener:!1,isRun:!0,nullMouse:!1},{desc:"block undefined",blk:void 0,expectDispatch:!1,expectMouseListener:!0,isRun:!0,nullMouse:!1},{desc:"isRun false",blk:void 0,expectDispatch:!1,expectMouseListener:!1,isRun:!1,nullMouse:!1},{desc:"null mouse",blk:void 0,expectDispatch:!1,expectMouseListener:!1,isRun:!0,nullMouse:!0}].forEach(function(e){var t=e.desc,n=e.blk,s=e.expectDispatch,o=e.expectMouseListener,u=e.isRun,i=e.nullMouse;test(t,function(){global.MusicBlocks.isRun=u,i&&(global.Mouse.getMouseFromTurtle=function(){return null}),Singer.OrnamentActions.doNeighbor(3,4,0,n),expect(r.singer.inNeighbor).toEqual([n]),expect(r.singer.neighborStepPitch).toEqual([3]),expect(r.singer.neighborNoteValue).toEqual([4]),expect(a.length).toBe(s?1:0),expect(p.length).toBe(1);var e="_neighbor_0_".concat(n);(o?expect(b.listeners):expect(b.listeners).not).toContain(e),h[e](),expect(r.singer.inNeighbor).toEqual([]),expect(r.singer.neighborStepPitch).toEqual([]),expect(r.singer.neighborNoteValue).toEqual([])})})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}global.TextEncoder=require("util").TextEncoder,global.TextDecoder=require("util").TextDecoder;var utils=require("../../utils/utils.js"),musicUtils=(global._=utils._,global.last=utils.last,require("../../utils/musicutils")),exp=(Object.assign(global,{pitchToNumber:musicUtils.pitchToNumber,getStepSizeUp:musicUtils.getStepSizeUp,getStepSizeDown:musicUtils.getStepSizeDown,calcOctave:musicUtils.calcOctave,getNote:musicUtils.getNote,nthDegreeToPitch:musicUtils.nthDegreeToPitch,keySignatureToMode:musicUtils.keySignatureToMode,frequencyToPitch:musicUtils.frequencyToPitch,numberToPitch:musicUtils.numberToPitch,isCustomTemperament:musicUtils.isCustomTemperament,ACCIDENTALNAMES:musicUtils.ACCIDENTALNAMES,ACCIDENTALVALUES:musicUtils.ACCIDENTALVALUES,NOTESFLAT:musicUtils.NOTESFLAT,NOTESSHARP:musicUtils.NOTESSHARP,NOTESTEP:musicUtils.NOTESTEP,MUSICALMODES:musicUtils.MUSICALMODES,SHARP:musicUtils.SHARP,FLAT:musicUtils.FLAT}),global.NANERRORMSG=require("../../logo").NANERRORMSG,require("../../../js/js-export/export")),setupPitchActions=(global.MusicBlocks=exp.MusicBlocks,global.Mouse=exp.Mouse,global.Singer={processPitch:jest.fn(),addScalarTransposition:jest.fn().mockReturnValue(["C",4]),calculateInvert:jest.fn().mockReturnValue(2)},require("../PitchActions"));describe("Tests for Singer.PitchActions setup",function(){var i,s,o;beforeEach(function(){s={singer:{inNoteBlock:[],justCounting:[],lastNotePlayed:null,previousNotePlayed:null,inDefineMode:!(o=1),defineMode:[],pitchNumberOffset:0,scalarTransposition:0,transposition:0,scalarTranspositionValues:[],transpositionValues:[],transpositionRatios:[],invertList:[],keySignature:"C",currentOctave:4}},i={turtles:{ithTurtle:function(){return s}},blocks:{blockList:_defineProperty({},o,{})},logo:{inMatrix:!1,inMusicKeyboard:!1,synth:{inTemperament:"equal",startingPitch:"A0"},runningLilypond:!1,setDispatchBlock:function(e,t,n){},setTurtleListener:function(){},stopTurtle:!1,notation:{notationMarkup:function(){}}},errorMsg:function(){}},setupPitchActions(i)}),test("playPitch → always calls processPitch",function(){var e=jest.spyOn(Singer,"processPitch");Singer.PitchActions.playPitch("C",4,0,0,o),expect(e).toHaveBeenCalledWith(i,"C",4,0,0,o),e.mockRestore()}),describe("Tests for stepPitch",function(){test("non‑number value → error path",function(){Singer.PitchActions.stepPitch("foo",0,o),expect(i.logo.stopTurtle).toBe(!0)}),test("first‑call default assignment + justCounting branch",function(){s.singer.justCounting=[1],s.singer.lastNotePlayed=null,Singer.PitchActions.stepPitch(2,0,o),expect(s.singer.lastNotePlayed[0]).toBe("G4")}),test("inverted path",function(){s.singer.lastNotePlayed=["A4",4],s.singer.inverted=!0,jest.spyOn(Singer,"calculateInvert").mockReturnValue(1),jest.spyOn(getNote,"bind"),Singer.PitchActions.stepPitch(3,0,o)}),test("stepPitch handles numeric‑frequency lastNotePlayed branch",function(){s.singer.lastNotePlayed=[440],s.singer.inNoteBlock=[],i.logo.inMatrix=!1,i.logo.inMusicKeyboard=!1,Singer.PitchActions.stepPitch(1,0,o),expect(Array.isArray(s.singer.lastNotePlayed)).toBe(!0),expect(_typeof(s.singer.lastNotePlayed[0])).toBe("string")}),test("justCounting with null previous/last sets both to G4",function(){s.singer.justCounting=[0],s.singer.lastNotePlayed=null,s.singer.previousNotePlayed=null,s.singer.inNoteBlock=[1],Singer.PitchActions.stepPitch(2,0,o),expect(s.singer.previousNotePlayed).toEqual(["G4",4]),expect(s.singer.lastNotePlayed).toEqual(["G4",4])}),test("when lastNotePlayed=null but inNoteBlock nonempty → fourth‐if sets default",function(){s.singer.lastNotePlayed=null,s.singer.inNoteBlock=[1],i.logo.inMatrix=!1,i.logo.inMusicKeyboard=!1,s.singer.justCounting=[],Singer.PitchActions.stepPitch(1,0,o),expect(s.singer.lastNotePlayed).toEqual(["G4",4])}),test("numeric lastNotePlayed → frequencyToPitch branch",function(){s.singer.lastNotePlayed=[440],s.singer.inNoteBlock=[1],i.logo.inMatrix=!1,i.logo.inMusicKeyboard=!1;var e=jest.spyOn(global,"frequencyToPitch");Singer.PitchActions.stepPitch(2,0,o),expect(e).toHaveBeenCalledWith(440),e.mockRestore()})}),describe("Tests for playNthModalPitch",function(){test("float rounding + negative arg + FLAT/SHARP adjustments",function(){s.singer.lastNotePlayed=["C4",4],global.keySignatureToMode=function(){return["Db","minor"]},Singer.PitchActions.playNthModalPitch(-2.7,3.1,0,o)}),test("playNthModalPitch covers SHARP adjustment branch",function(){global.keySignatureToMode=function(){return["F#","minor"]},expect(function(){Singer.PitchActions.playNthModalPitch(5.2,3,0,o)}).not.toThrow()})}),describe("Tests for playPitchNumber",function(){test("defineMode push",function(){s.singer.inDefineMode=!0,Singer.PitchActions.playPitchNumber(7,0,o),expect(s.singer.defineMode).toContain(7)}),test("customTemperament error + else real play",function(){s.singer.inDefineMode=!1,jest.spyOn(isCustomTemperament,"bind").mockReturnValue(!0),Singer.PitchActions.playPitchNumber(5,0,o),jest.spyOn(Singer,"processPitch"),jest.spyOn(isCustomTemperament,"bind").mockReturnValue(!1),Singer.PitchActions.playPitchNumber(5,0,o),expect(Singer.processPitch).toHaveBeenCalled()}),test("errorMsg called with correct localized string on custom temperament + nonzero transposition",function(){s.singer.inDefineMode=!1,s.singer.scalarTransposition=1,s.singer.transposition=0,global.isCustomTemperament=function(){return!0};var e=_("Scalar transpositions are equal to Semitone transpositions for custom temperament."),t=jest.spyOn(i,"errorMsg");Singer.PitchActions.playPitchNumber(5,0,o),expect(t).toHaveBeenCalledWith(e),t.mockRestore()})}),test("Tests for playHertz",function(){s.singer.inNoteBlock=[1],i.logo.runningLilypond=!0,jest.spyOn(i.logo.notation,"notationMarkup"),Singer.PitchActions.playHertz(440,0,o),expect(i.logo.notation.notationMarkup).toHaveBeenCalled()}),test("playHertz notationMarkup occurs only when both inNoteBlock AND runningLilypond",function(){var e=jest.spyOn(i.logo.notation,"notationMarkup");s.singer.inNoteBlock=[1],i.logo.runningLilypond=!0,Singer.PitchActions.playHertz(440,0,o),expect(e).toHaveBeenCalledWith(0,440),e.mockClear(),i.logo.runningLilypond=!1,Singer.PitchActions.playHertz(440,0,o),expect(e).not.toHaveBeenCalled(),e.mockClear(),s.singer.inNoteBlock=[],i.logo.runningLilypond=!0,Singer.PitchActions.playHertz(440,0,o),expect(e).not.toHaveBeenCalled(),e.mockRestore()}),describe("Tests for setAccidental",function(){test("named accidental path",function(){Singer.PitchActions.setAccidental("sharp",0,o)}),test("invalid accidental → default case",function(){Singer.PitchActions.setAccidental("foo",0,o)})}),describe("Tests for transpositions",function(){test("setScalarTranspose blockList path",function(){Singer.PitchActions.setScalarTranspose(1,0,o)}),test("setScalarTranspose MusicBlocks.isRun path",function(){MusicBlocks.isRun=!0,Singer.PitchActions.setScalarTranspose(1,0),MusicBlocks.isRun=!1}),test("setSemitoneTranspose both paths",function(){Singer.PitchActions.setSemitoneTranspose(1,0,o),MusicBlocks.isRun=!0,Singer.PitchActions.setSemitoneTranspose(1,0),MusicBlocks.isRun=!1}),test("setRatioTranspose both paths",function(){Singer.PitchActions.setRatioTranspose(2,0,o),MusicBlocks.isRun=!0,Singer.PitchActions.setRatioTranspose(2,0),MusicBlocks.isRun=!1})}),describe("Tests for setRegister",function(){test("floors the value",function(){Singer.PitchActions.setRegister(5.7,0),expect(s.singer.register).toBe(5)})}),describe("Tests for invert",function(){test("numeric mode normalization",function(){Singer.PitchActions.invert("C",4,3,0,o)}),test("invalid mode ignored",function(){Singer.PitchActions.invert("C",4,"nonsense",0,o)})}),describe("Tests for numToPitch",function(){test("valid number→returns pitch/octave",function(){expect(Singer.PitchActions.numToPitch(5,"pitch",0)).toEqual(expect.any(String)),expect(Singer.PitchActions.numToPitch(5,"octave",0)).toEqual(expect.any(Number))}),test("invalid input → throws",function(){expect(function(){return Singer.PitchActions.numToPitch(null,"pitch",0)}).toThrow("NoArgError")})}),describe("Tests for setPitchNumberOffset",function(){test("sets offset via calcOctave + pitchToNumber",function(){Singer.PitchActions.setPitchNumberOffset("D",5,0),expect(_typeof(s.singer.pitchNumberOffset)).toBe("number")})}),describe("Tests for deltaPitch",function(){test("no previousNote → returns 0",function(){s.singer.previousNotePlayed=null,expect(Singer.PitchActions.deltaPitch("deltapitch",0)).toBe(0)}),test("scalar delta path",function(){s.singer.previousNotePlayed=["C4",4],s.singer.lastNotePlayed=["E4",4];var e=Singer.PitchActions.deltaPitch("deltascalarpitch",0);expect(_typeof(e)).toBe("number")}),test("deltascalarpitch returns a negative count when last < previous",function(){s.singer.previousNotePlayed=["D4",4],s.singer.lastNotePlayed=["C4",4];var e=Singer.PitchActions.deltaPitch("deltascalarpitch",0);expect(e).toBeLessThan(0)})}),describe("Tests for consonantStepSize",function(){test("with lastNote → uses slice path",function(){s.singer.lastNotePlayed=["F#4",4],expect(Singer.PitchActions.consonantStepSize("down",0)).toEqual(musicUtils.getStepSizeDown("C","F#"))}),test("no lastNote → default G",function(){s.singer.lastNotePlayed=null,expect(Singer.PitchActions.consonantStepSize("up",0)).toEqual(musicUtils.getStepSizeUp("C","G"))})}),describe("Tests for listener & dispatch registration",function(){test("invert pushes even/odd/scalar and ignores bad modes",function(){Singer.PitchActions.invert("C",4,2,0,o);var e=s.singer.invertList.pop(),e=(expect(e[2]).toBe("even"),Singer.PitchActions.invert("C",4,"scalar",0,o),e=s.singer.invertList.pop(),expect(e[2]).toBe("scalar"),s.singer.invertList.length);Singer.PitchActions.invert("C",4,"nope",0,o),expect(s.singer.invertList.length).toBe(e)}),test("deltaPitch returns actual semitone difference",function(){s.singer.previousNotePlayed=["C4",4],s.singer.lastNotePlayed=["D4",4],expect(Singer.PitchActions.deltaPitch("deltapitch",0)).toBe(2)})}),describe("transpose listener registration & value arrays",function(){var e,t,n;beforeEach(function(){e=jest.spyOn(i.logo,"setDispatchBlock"),t=jest.spyOn(i.logo,"setTurtleListener"),n={MB:{listeners:[]}},Mouse.getMouseFromTurtle=function(){return n}}),afterEach(function(){e.mockRestore(),t.mockRestore(),MusicBlocks.isRun=!1}),test("setScalarTranspose: blockList path",function(){Singer.PitchActions.setScalarTranspose(5,0,o),expect(s.singer.scalarTranspositionValues.pop()).toBe(5),expect(e).toHaveBeenCalledWith(o,0,"_scalar_transposition_0"),expect(t).toHaveBeenCalledWith(0,"_scalar_transposition_0",expect.any(Function))}),test("setScalarTranspose: MusicBlocks.isRun path",function(){MusicBlocks.isRun=!0,Singer.PitchActions.setScalarTranspose(2,0),expect(n.MB.listeners).toContain("_scalar_transposition_0"),expect(t).toHaveBeenCalledWith(0,"_scalar_transposition_0",expect.any(Function))}),test("setSemitoneTranspose: blockList path",function(){Singer.PitchActions.setSemitoneTranspose(3,0,o),expect(s.singer.transpositionValues.pop()).toBe(3),expect(e).toHaveBeenCalledWith(o,0,"_transposition_0"),expect(t).toHaveBeenCalledWith(0,"_transposition_0",expect.any(Function))}),test("setSemitoneTranspose: MusicBlocks.isRun path",function(){MusicBlocks.isRun=!0,Singer.PitchActions.setSemitoneTranspose(4,0),expect(n.MB.listeners).toContain("_transposition_0"),expect(t).toHaveBeenCalledWith(0,"_transposition_0",expect.any(Function))}),test("setRatioTranspose: blockList path",function(){Singer.PitchActions.setRatioTranspose(7,0,o),expect(s.singer.transpositionRatios.pop()).toBe(7),expect(e).toHaveBeenCalledWith(o,0,"_transposition_ratio_0"),expect(t).toHaveBeenCalledWith(0,"_transposition_ratio_0",expect.any(Function))}),test("setRatioTranspose: MusicBlocks.isRun path",function(){MusicBlocks.isRun=!0,Singer.PitchActions.setRatioTranspose(9,0),expect(n.MB.listeners).toContain("_transposition_ratio_0"),expect(t).toHaveBeenCalledWith(0,"_transposition_ratio_0",expect.any(Function))})}),describe("low‑level listener callbacks for Accidental / Transpose / Invert",function(){var n;beforeEach(function(){i.logo.setTurtleListener=function(e,t,n){return n()},n={MB:{listeners:[]}},Mouse.getMouseFromTurtle=function(){return n}}),afterEach(function(){MusicBlocks.isRun=!1}),test('setAccidental early‑return for _("sharp") & _("flat")',function(){var e=s.singer.transposition;Singer.PitchActions.setAccidental(_("sharp"),0,o),Singer.PitchActions.setAccidental(_("flat"),0,o),expect(s.singer.transposition).toBe(e)}),test("setAccidental run‑mode pushes listener and its callback reverses delta",function(){MusicBlocks.isRun=!0;var e=s.singer.transposition,t=ACCIDENTALNAMES[0];Singer.PitchActions.setAccidental(t,0),expect(n.MB.listeners).toContain("_accidental_0_undefined"),expect(s.singer.transposition).toBe(e)}),test("setScalarTranspose listener callback pops & reverses",function(){var e=s.singer.scalarTransposition;Singer.PitchActions.setScalarTranspose(4,0,o),expect(s.singer.scalarTransposition).toBe(e)}),test("setSemitoneTranspose listener callback pops & reverses",function(){var e=s.singer.transposition;Singer.PitchActions.setSemitoneTranspose(5,0,o),expect(s.singer.transposition).toBe(e)}),test("setRatioTranspose listener callback pops ratio",function(){s.singer.transpositionRatios=[],Singer.PitchActions.setRatioTranspose(7,0,o),expect(s.singer.transpositionRatios).toHaveLength(0)}),test("invert listener callback pops & clears inverted flag",function(){s.singer.invertList=[],s.singer.inverted=!0,Singer.PitchActions.invert("C",4,"even",0,o),expect(s.singer.invertList).toHaveLength(0),expect(s.singer.inverted).toBe(!1)}),test("setAccidental blockList listener callback reverses delta",function(){i.logo.setTurtleListener=function(e,t,n){return n()};var e=s.singer.transposition,t=ACCIDENTALNAMES[0];Singer.PitchActions.setAccidental(t,0,o),expect(s.singer.transposition).toBe(e)})}),describe("playNthModalPitch unicode FLAT/SHARP ref‑adjustment",function(){test("FLAT symbol branch",function(){global.keySignatureToMode=function(){return["B"+FLAT,"major"]};var e=jest.spyOn(Singer,"processPitch");Singer.PitchActions.playNthModalPitch(4.5,2,0,o),expect(e).toHaveBeenCalled(),e.mockRestore()}),test("SHARP symbol branch",function(){global.keySignatureToMode=function(){return["F"+SHARP,"minor"]};var e=jest.spyOn(Singer,"processPitch");Singer.PitchActions.playNthModalPitch(2.2,3,0,o),expect(e).toHaveBeenCalled(),e.mockRestore()})}),describe("invert: MusicBlocks.isRun listener path",function(){var e;beforeEach(function(){MusicBlocks.isRun=!0,e={MB:{listeners:[]}},Mouse.getMouseFromTurtle=function(){return e}}),afterEach(function(){MusicBlocks.isRun=!1}),test("pushes listenerName into Mouse.MB.listeners",function(){Singer.PitchActions.invert("C",4,"even",0),expect(e.MB.listeners).toContain("_invert_0")})}),describe("default listener‑only path",function(){var t;beforeEach(function(){MusicBlocks.isRun=!1,t=jest.spyOn(i.logo,"setTurtleListener")}),afterEach(function(){t.mockRestore()}),test("setAccidental registers listener only",function(){var e=ACCIDENTALNAMES[0];Singer.PitchActions.setAccidental(e,0),expect(t).toHaveBeenCalledWith(0,"_accidental_0_undefined",expect.any(Function))}),test("setScalarTranspose registers listener only",function(){Singer.PitchActions.setScalarTranspose(3,0),expect(t).toHaveBeenCalledWith(0,"_scalar_transposition_0",expect.any(Function))}),test("setSemitoneTranspose registers listener only",function(){Singer.PitchActions.setSemitoneTranspose(2,0),expect(t).toHaveBeenCalledWith(0,"_transposition_0",expect.any(Function))}),test("setRatioTranspose registers listener only",function(){Singer.PitchActions.setRatioTranspose(5,0),expect(t).toHaveBeenCalledWith(0,"_transposition_ratio_0",expect.any(Function))}),test("invert registers listener only",function(){Singer.PitchActions.invert("C",4,"even",0),expect(t).toHaveBeenCalledWith(0,"_invert_0",expect.any(Function))})})});
var setupRhythmActions=require("../RhythmActions");describe("setupRhythmActions",function(){var t,n;beforeAll(function(){global._=function(e){return e},global.last=function(e){return e[e.length-1]},global.TONEBPM=120,global.Singer={processNote:jest.fn()},global.MusicBlocks={isRun:!1},global.Mouse={getMouseFromTurtle:jest.fn(function(){return{MB:{listeners:[]}}})}}),beforeEach(function(){n={id:0,singer:{inNoteBlock:[],notesPlayed:[0,1],pickup:.5,noteValuePerBeat:1,beatsPerMeasure:4,beatList:[],factorList:[],beatFactor:1,currentBeat:null,currentMeasure:null,noteValue:{},multipleVoices:!1,inNeighbor:[],neighborArgBeat:[],neighborArgCurrentBeat:[],oscList:{},noteBeat:{},noteBeatValues:{},notePitches:{},noteOctaves:{},noteCents:{},noteHertz:{},noteDrums:{},embeddedGraphics:{}}},t={turtles:{ithTurtle:jest.fn(function(){return n})},blocks:{blockList:{}},stage:{dispatchEvent:jest.fn()},logo:{clearNoteParams:jest.fn(),setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),notation:{notationVoices:jest.fn()},pitchBlocks:[],drumBlocks:[]}},setupRhythmActions(t)}),it("sets beat and measure to 0 when pickup not crossed",function(){var e=jest.fn();Singer.RhythmActions.playNote(1,"note",0,1,e),expect(n.singer.currentBeat).toBe(0),expect(n.singer.currentMeasure).toBe(0)}),it("sets correct beat and measure when pickup is crossed",function(){var e=jest.fn();n.singer.notesPlayed=[2,1],n.singer.pickup=0,n.singer.noteValuePerBeat=1,n.singer.beatsPerMeasure=4,n.singer.beatList=[],n.singer.factorList=[],Singer.RhythmActions.playNote(1,"note",0,1,e),expect(n.singer.currentBeat).toBe(3),expect(n.singer.currentMeasure).toBe(1)}),it("triggers everybeat event when beatList contains 'everybeat'",function(){var e=jest.fn();n.singer.notesPlayed=[1,1],n.singer.pickup=0,n.singer.beatList=["everybeat"],n.singer.factorList=[],Singer.RhythmActions.playNote(1,"note",0,1,e),expect(e).toHaveBeenCalled(),expect(t.stage.dispatchEvent).toHaveBeenCalledWith("__everybeat_0__")}),it("triggers specific beat event when beatList contains current beat",function(){var e=jest.fn();n.singer.notesPlayed=[1,1],n.singer.pickup=0,n.singer.noteValuePerBeat=1,n.singer.beatsPerMeasure=4,n.singer.beatList=[2],n.singer.factorList=[],Singer.RhythmActions.playNote(1,"note",0,1,e),expect(n.singer.currentBeat).toBe(2),expect(e).toHaveBeenCalled(),expect(t.stage.dispatchEvent).toHaveBeenCalledWith("__beat_2_0__")}),it("triggers offbeat event when beatList contains 'offbeat' and beat > 1",function(){var e=jest.fn();n.singer.notesPlayed=[1,1],n.singer.pickup=0,n.singer.noteValuePerBeat=1,n.singer.beatsPerMeasure=4,n.singer.beatList=["offbeat"],n.singer.factorList=[],Singer.RhythmActions.playNote(1,"note",0,1,e),expect(n.singer.currentBeat).toBe(2),expect(e).toHaveBeenCalled(),expect(t.stage.dispatchEvent).toHaveBeenCalledWith("__offbeat_0__")}),it("triggers factorList beat event when beat matches factor",function(){var e=jest.fn();n.singer.notesPlayed=[1,1],n.singer.pickup=0,n.singer.noteValuePerBeat=1,n.singer.beatsPerMeasure=4,n.singer.beatList=[],n.singer.factorList=[2],Singer.RhythmActions.playNote(1,"note",0,1,e),expect(e).toHaveBeenCalled(),expect(t.stage.dispatchEvent).toHaveBeenCalledWith("__beat_2_0__")}),it("adds rest note when inside a note block",function(){n.singer.inNoteBlock=[1],n.singer.beatFactor=1,n.singer.notePitches[1]=[],n.singer.noteOctaves[1]=[],n.singer.noteCents[1]=[],n.singer.noteHertz[1]=[],n.singer.noteBeatValues[1]=[],Singer.RhythmActions.playRest(0),expect(n.singer.notePitches[1]).toContain("rest"),expect(n.singer.noteOctaves[1]).toContain(4),expect(n.singer.noteCents[1]).toContain(0),expect(n.singer.noteHertz[1]).toContain(0),expect(n.singer.noteBeatValues[1]).toContain(1),expect(n.singer.pushedNote).toBe(!0)}),it("updates dotCount and beatFactor for valid dot value",function(){n.singer.dotCount=0,n.singer.beatFactor=1,Singer.RhythmActions.doRhythmicDot(1,0,1),expect(n.singer.dotCount).toBe(1),expect(n.singer.beatFactor).not.toBe(1)}),it("shows error when dot value is -1",function(){n.singer.dotCount=0,n.singer.beatFactor=1,t.errorMsg=jest.fn(),Singer.RhythmActions.doRhythmicDot(-1,0,1),expect(t.errorMsg).toHaveBeenCalledWith("An argument of -1 results in a note value of 0.",1),expect(n.singer.dotCount).toBe(0)}),it("multiplies beatFactor correctly",function(){n.singer.beatFactor=2,Singer.RhythmActions.multiplyNoteValue(2,0,1),expect(n.singer.beatFactor).toBe(1)}),it("adds swing when not suppressed",function(){n.singer.suppressOutput=!1,n.singer.swing=[],n.singer.swingTarget=[],Singer.RhythmActions.addSwing(2,4,0,1),expect(n.singer.swing).toContain(.5),expect(n.singer.swingTarget).toContain(.25)}),it("removes swing on listener execution",function(){var s;n.singer.suppressOutput=!1,n.singer.swing=[],n.singer.swingTarget=[],t.logo.setTurtleListener=jest.fn(function(e,t,n){s=n}),Singer.RhythmActions.addSwing(2,4,0,1),s(),expect(n.singer.swing.length).toBe(0),expect(n.singer.swingTarget.length).toBe(0)}),it("returns note value from active note",function(){n.singer.inNoteBlock=[1],n.singer.noteValue={1:.25};var e=Singer.RhythmActions.getNoteValue(0);expect(e).toBe(.25)}),it("falls back to lastNotePlayed when no active note",function(){n.singer.inNoteBlock=[],n.singer.lastNotePlayed=[null,8];var e=Singer.RhythmActions.getNoteValue(0);expect(e).toBe(.125)}),it("returns 0 when no note info exists",function(){n.singer.inNoteBlock=[],n.singer.lastNotePlayed=null;var e=Singer.RhythmActions.getNoteValue(0);expect(e).toBe(0)})});
var setupToneActions=require("../ToneActions");describe("setupToneActions",function(){var o,n,i={};beforeAll(function(){global.Singer={ToneActions:{}},global.instrumentsEffects={0:{"default-voice":{vibratoActive:!1,vibratoIntensity:[],vibratoFrequency:0}}},global.VOICENAMES={Piano:["piano","grand-piano"],Violin:["violin","acoustic-violin"]},global.CUSTOMSAMPLES={},global.DEFAULTVOICE="default-voice",global.last=function(e){return e[e.length-1]},global._=function(e){return e},global.NOINPUTERRORMSG="Missing input",global.MusicBlocks={isRun:!0},global.Mouse={getMouseFromTurtle:function(e){return e?{MB:{listeners:[]}}:null}}}),beforeEach(function(){i={},global.VOICENAMES={Piano:["piano","grand-piano"],Violin:["violin","acoustic-violin"]};var t={MB:{listeners:[]}};global.Mouse.getMouseFromTurtle=jest.fn(function(e){return t}),o={turtles:{ithTurtle:function(){return n}},blocks:{blockList:{1:{},2:{}}},logo:{setDispatchBlock:jest.fn(function(e){}),setTurtleListener:jest.fn(function(e,t,o){i[t]=o}),synth:{loadSynth:jest.fn(),createSynth:jest.fn()},phraseMaker:{_instrumentName:null},notation:{notationSwing:jest.fn(),notationVoices:jest.fn(),notationBeginHarmonics:jest.fn(),notationEndHarmonics:jest.fn()},timbre:{instrumentName:"default-voice",FMSynthParams:[],AMSynthParams:[],duoSynthParams:[],osc:[],fmSynthParamvals:{},amSynthParamvals:{},duoSynthParamVals:{},FMSynthesizer:[],AMSynthesizer:[],duoSynthesizer:[],vibratoEffect:[],vibratoParams:[]},inTimbre:!0,stopTurtle:!1,inMatrix:!1},errorMsg:jest.fn()},n={singer:{instrumentNames:[],synthVolume:{"default-voice":[1]},crescendoInitialVolume:{"default-voice":[1]},vibratoIntensity:[],vibratoRate:[],chorusRate:[],delayTime:[],chorusDepth:[],rate:[],octaves:[],baseFrequency:[],tremoloFrequency:[],tremoloDepth:[],distortionAmount:[],inHarmonic:[],partials:[]},inSetTimbre:!1},global.instrumentsEffects={0:{"default-voice":{vibratoActive:!1,vibratoIntensity:[],vibratoFrequency:[]}}},setupToneActions(o)}),describe("setTimbre",function(){it("should set timbre correctly for known voice",function(){Singer.ToneActions.setTimbre("piano",0,1),expect(n.singer.instrumentNames).toContain("grand-piano"),expect(o.logo.synth.loadSynth).toHaveBeenCalledWith(0,"grand-piano"),i._settimbre_0&&(i._settimbre_0(),expect(n.inSetTimbre).toBe(!1),expect(n.singer.instrumentNames.length).toBe(0))}),it("should handle direct synth name",function(){Singer.ToneActions.setTimbre("grand-piano",0,1),expect(n.singer.instrumentNames).toContain("grand-piano")}),it("should handle custom sample timbres correctly",function(){Singer.ToneActions.setTimbre(["custom1","sample1","sample2","sample3"],0,1),expect(global.CUSTOMSAMPLES.customsample_custom1).toEqual(["sample1","sample2","sample3"]),expect(n.singer.instrumentNames).toContain("customsample_custom1")}),it("should handle empty custom sample name",function(){Singer.ToneActions.setTimbre(["","sample1","sample2","sample3"],0,1),expect(n.singer.instrumentNames).toContain("default-voice")}),it("should use default voice when synth is undefined",function(){Singer.ToneActions.setTimbre("unknown-instrument",0,1),expect(n.singer.instrumentNames).toContain("unknown-instrument")}),it("should handle non-object non-accounted instrument",function(){delete global.VOICENAMES.Piano,Singer.ToneActions.setTimbre("piano",0,1),expect(n.singer.instrumentNames).toContain("piano")}),it("should set instrument name in phraseMaker when in matrix",function(){o.logo.inMatrix=!0,Singer.ToneActions.setTimbre("piano",0,1);var e=global.VOICENAMES.Piano[1];expect(o.logo.phraseMaker._instrumentName).toBe(e)}),it("should initialize synthVolume when undefined",function(){n.singer.instrumentNames=[];var e=global.VOICENAMES.Piano[1];delete n.singer.synthVolume[e],delete n.singer.crescendoInitialVolume[e],Singer.ToneActions.setTimbre("piano",0,1),expect(n.singer.synthVolume[e]).toBeDefined(),expect(n.singer.synthVolume[e]).toEqual([1]),expect(n.singer.crescendoInitialVolume[e]).toEqual([1])}),it("should fallback to default-voice when instrument is undefined",function(){Singer.ToneActions.setTimbre(void 0,0,1),expect(n.singer.instrumentNames).toContain("default-voice")}),it("should NOT register a mouse listener when blk is undefined",function(){MusicBlocks.isRun=!1;var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.setTimbre("piano",0),expect(e.MB.listeners).not.toContain("_settimbre_0"),MusicBlocks.isRun=!0}),it("should register a mouse listener when blk is undefined and running",function(){var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.setTimbre("piano",0),expect(e.MB.listeners).toContain("_settimbre_0"),i._settimbre_0(),expect(n.inSetTimbre).toBe(!1)})}),describe("doVibrato",function(){it("should apply vibrato correctly with valid parameters",function(){Singer.ToneActions.doVibrato(50,10,0,1),expect(n.singer.vibratoIntensity).toContain(.5),expect(n.singer.vibratoRate).toContain(.1),expect(o.logo.timbre.vibratoEffect).toContain(1),expect(o.logo.timbre.vibratoParams).toContain(50),expect(global.instrumentsEffects[0]["default-voice"].vibratoActive).toBe(!0),i._vibrato_0&&(i._vibrato_0(),expect(n.singer.vibratoIntensity.length).toBe(0),expect(n.singer.vibratoRate.length).toBe(0))}),it("should show error for invalid vibrato intensity",function(){Singer.ToneActions.doVibrato(150,5,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Vibrato intensity must be between 1 and 100.",1),expect(o.logo.stopTurtle).toBe(!0)}),it("should show error for invalid vibrato rate",function(){Singer.ToneActions.doVibrato(50,0,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Vibrato rate must be greater than 0.",1),expect(o.logo.stopTurtle).toBe(!0)}),it("should use last vibrato intensity in timbre mode",function(){o.logo.inTimbre=!0,Singer.ToneActions.doVibrato(50,10,0,1),expect(global.instrumentsEffects[0]["default-voice"].vibratoActive).toBe(!0),expect(o.logo.timbre.vibratoParams).toContain(50),expect(o.logo.timbre.vibratoParams).toContain(.1),expect(global.instrumentsEffects[0]["default-voice"].vibratoFrequency).toBe(10)}),it("should skip timbre‑mode params when not in timbre",function(){o.logo.inTimbre=!1,Singer.ToneActions.doVibrato(50,5,0,1),expect(o.logo.timbre.vibratoEffect).toHaveLength(0)}),it("should NOT register a mouse listener when blk is undefined",function(){MusicBlocks.isRun=!1;var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doVibrato(50,5,0),expect(e.MB.listeners).not.toContain("_vibrato_0"),MusicBlocks.isRun=!0}),it("should register a mouse listener when blk is undefined and running",function(){var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doVibrato(50,5,0),expect(e.MB.listeners).toContain("_vibrato_0"),i._vibrato_0(),expect(n.singer.vibratoIntensity.length).toBe(0)})}),describe("doChorus",function(){it("should apply chorus effect correctly with valid parameters",function(){Singer.ToneActions.doChorus(1.5,20,50,0,1),expect(n.singer.chorusRate).toContain(1.5),expect(n.singer.delayTime).toContain(20),expect(n.singer.chorusDepth).toContain(.5),i._chorus_0&&(i._chorus_0(),expect(n.singer.chorusRate.length).toBe(0),expect(n.singer.delayTime.length).toBe(0),expect(n.singer.chorusDepth.length).toBe(0))}),it("should show error for invalid chorus depth",function(){Singer.ToneActions.doChorus(1.5,20,150,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Depth is out of range.",1),expect(o.logo.stopTurtle).toBe(!0)}),it("should show error for negative chorus depth",function(){Singer.ToneActions.doChorus(1.5,20,-10,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Depth is out of range.",1),expect(o.logo.stopTurtle).toBe(!0)}),it("should NOT register a mouse listener when blk is undefined",function(){MusicBlocks.isRun=!1;var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doChorus(1.5,20,50,0),expect(e.MB.listeners).not.toContain("_chorus_0"),MusicBlocks.isRun=!0}),it("should register a mouse listener when blk is undefined and running",function(){var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doChorus(1.5,20,50,0),expect(e.MB.listeners).toContain("_chorus_0"),i._chorus_0(),expect(n.singer.chorusRate.length).toBe(0)})}),describe("doPhaser",function(){it("should apply phaser effect correctly",function(){Singer.ToneActions.doPhaser(2,3,100,0,1),expect(n.singer.rate).toContain(2),expect(n.singer.octaves).toContain(3),expect(n.singer.baseFrequency).toContain(100),i._phaser_0&&(i._phaser_0(),expect(n.singer.rate.length).toBe(0),expect(n.singer.octaves.length).toBe(0),expect(n.singer.baseFrequency.length).toBe(0))}),it("should NOT register a mouse listener when blk is undefined",function(){MusicBlocks.isRun=!1;var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doPhaser(2,3,100,0),expect(e.MB.listeners).not.toContain("_phaser_0"),MusicBlocks.isRun=!0}),it("should register a mouse listener when blk is undefined and running",function(){var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doPhaser(2,3,100,0),expect(e.MB.listeners).toContain("_phaser_0"),i._phaser_0(),expect(n.singer.rate.length).toBe(0)})}),describe("doTremolo",function(){it("should apply tremolo effect correctly",function(){Singer.ToneActions.doTremolo(5,50,0,1),expect(n.singer.tremoloFrequency).toContain(5),expect(n.singer.tremoloDepth).toContain(.5),expect(o.logo.setDispatchBlock).toHaveBeenCalledWith(1,0,"_tremolo_0"),i._tremolo_0&&(i._tremolo_0(),expect(n.singer.tremoloFrequency.length).toBe(0),expect(n.singer.tremoloDepth.length).toBe(0))}),it("should show error for invalid tremolo depth",function(){Singer.ToneActions.doTremolo(5,150,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Depth is out of range.",1),expect(o.logo.stopTurtle).toBe(!0)}),it("should show error for negative tremolo depth",function(){Singer.ToneActions.doTremolo(5,-50,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Depth is out of range.",1),expect(o.logo.stopTurtle).toBe(!0)}),it("should NOT register a mouse listener when blk is undefined",function(){MusicBlocks.isRun=!1;var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doTremolo(5,50,0),expect(e.MB.listeners).not.toContain("_tremolo_0"),MusicBlocks.isRun=!0}),it("should register a mouse listener when blk is undefined and running",function(){var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doTremolo(5,50,0),expect(e.MB.listeners).toContain("_tremolo_0"),i._tremolo_0(),expect(n.singer.tremoloFrequency.length).toBe(0)})}),describe("doDistortion",function(){it("should apply distortion effect correctly",function(){Singer.ToneActions.doDistortion(50,0,1),expect(n.singer.distortionAmount).toContain(.5),expect(o.logo.setDispatchBlock).toHaveBeenCalledWith(1,0,"_distortion_0"),i._distortion_0&&(i._distortion_0(),expect(n.singer.distortionAmount.length).toBe(0))}),it("should show error for invalid distortion amount",function(){Singer.ToneActions.doDistortion(150,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Distortion must be from 0 to 100.",1),expect(o.logo.stopTurtle).toBe(!0)}),it("should show error for negative distortion amount",function(){Singer.ToneActions.doDistortion(-10,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Distortion must be from 0 to 100.",1),expect(o.logo.stopTurtle).toBe(!0)}),it("should NOT register a mouse listener when blk is undefined",function(){MusicBlocks.isRun=!1;var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doDistortion(50,0),expect(e.MB.listeners).not.toContain("_distortion_0"),MusicBlocks.isRun=!0}),it("should register a mouse listener when blk is undefined and running",function(){var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doDistortion(50,0),expect(e.MB.listeners).toContain("_distortion_0"),i._distortion_0(),expect(n.singer.distortionAmount.length).toBe(0)})}),describe("doHarmonic",function(){it("should apply harmonic effect correctly",function(){Singer.ToneActions.doHarmonic(2,0,1),expect(o.logo.notation.notationBeginHarmonics).toHaveBeenCalledWith(0),expect(n.singer.partials).toHaveLength(1),expect(n.singer.partials[0]).toEqual([0,0,1]),expect(o.logo.setDispatchBlock).toHaveBeenCalledWith(1,0,"_harmonic_0_1"),i._harmonic_0_1&&(i._harmonic_0_1(),expect(n.singer.inHarmonic.length).toBe(0),expect(n.singer.partials.length).toBe(0),expect(o.logo.notation.notationEndHarmonics).toHaveBeenCalledWith(0))}),it("should show error for invalid harmonic value",function(){Singer.ToneActions.doHarmonic(-1,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Partial must be greater than or equal to 0."),expect(o.logo.stopTurtle).toBe(!0)}),it("should show error for non-numeric harmonic value",function(){Singer.ToneActions.doHarmonic("not a number",0,1),expect(o.errorMsg).toHaveBeenCalledWith("Partial must be greater than or equal to 0."),expect(o.logo.stopTurtle).toBe(!0)}),it("should handle zero harmonic value",function(){Singer.ToneActions.doHarmonic(0,0,1),expect(n.singer.partials).toHaveLength(1),expect(n.singer.partials[0]).toEqual([1])}),it("should NOT register a mouse listener when blk is undefined",function(){MusicBlocks.isRun=!1;var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doHarmonic(2,0),expect(e.MB.listeners).not.toContain("_harmonic_0_undefined"),MusicBlocks.isRun=!0}),it("should register a mouse listener when blk is undefined and running",function(){var e=Mouse.getMouseFromTurtle(n);e.MB.listeners=[],Singer.ToneActions.doHarmonic(2,0),expect(e.MB.listeners).toContain("_harmonic_0_undefined"),i._harmonic_0_undefined(),expect(n.singer.inHarmonic.length).toBe(0),expect(n.singer.partials.length).toBe(0)})}),describe("defFMSynth",function(){it("should define FM synth correctly",function(){Singer.ToneActions.defFMSynth(10,0,1),expect(o.logo.timbre.FMSynthParams).toContain(10),expect(o.logo.synth.createSynth).toHaveBeenCalledWith(0,"default-voice","fmsynth",{modulationIndex:10})}),it("should handle null modulationIndex",function(){Singer.ToneActions.defFMSynth(null,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Missing input",1),expect(o.logo.timbre.FMSynthParams).toContain(10)}),it("should handle negative modulationIndex",function(){Singer.ToneActions.defFMSynth(-10,0,1),expect(o.errorMsg).toHaveBeenCalledWith("The input cannot be negative."),expect(o.logo.timbre.FMSynthParams).toContain(10)}),it("should show error when oscillators exist",function(){o.logo.timbre.osc=[{}],Singer.ToneActions.defFMSynth(10,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Unable to use synth due to existing oscillator")}),it("should not create parameters when not in timbre mode",function(){o.logo.inTimbre=!1,Singer.ToneActions.defFMSynth(10,0,1),expect(o.logo.synth.createSynth).not.toHaveBeenCalled()})}),describe("defAMSynth",function(){it("should define AM synth correctly",function(){Singer.ToneActions.defAMSynth(5,0,1),expect(o.logo.timbre.AMSynthParams).toContain(5),expect(o.logo.synth.createSynth).toHaveBeenCalledWith(0,"default-voice","amsynth",{harmonicity:5})}),it("should handle null harmonicity",function(){Singer.ToneActions.defAMSynth(null,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Missing input",1),expect(o.logo.timbre.AMSynthParams).toContain(1)}),it("should handle non-numeric harmonicity",function(){Singer.ToneActions.defAMSynth("string",0,1),expect(o.errorMsg).toHaveBeenCalledWith("Missing input",1),expect(o.logo.timbre.AMSynthParams).toContain(1)}),it("should handle negative harmonicity",function(){Singer.ToneActions.defAMSynth(-5,0,1),expect(o.errorMsg).toHaveBeenCalledWith("The input cannot be negative."),expect(o.logo.timbre.AMSynthParams).toContain(5)}),it("should show error when oscillators exist",function(){o.logo.timbre.osc=[{}],Singer.ToneActions.defAMSynth(5,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Unable to use synth due to existing oscillator")}),it("should not create parameters when not in timbre mode",function(){o.logo.inTimbre=!1,Singer.ToneActions.defAMSynth(5,0,1),expect(o.logo.synth.createSynth).not.toHaveBeenCalled()})}),describe("defDuoSynth",function(){it("should define Duo synth correctly",function(){Singer.ToneActions.defDuoSynth(10,20,0,1),expect(o.logo.timbre.duoSynthParams).toContain(10),expect(o.logo.timbre.duoSynthParams).toContain(.2),expect(o.logo.synth.createSynth).toHaveBeenCalledWith(0,"default-voice","duosynth",{vibratoRate:10,vibratoAmount:.2})}),it("should handle null vibratoRate",function(){Singer.ToneActions.defDuoSynth(null,20,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Missing input",1),expect(o.logo.timbre.duoSynthParams).toContain(10)}),it("should handle non-numeric vibratoRate",function(){Singer.ToneActions.defDuoSynth("string",20,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Missing input",1),expect(o.logo.timbre.duoSynthParams).toContain(10)}),it("should handle null vibratoAmount",function(){Singer.ToneActions.defDuoSynth(10,null,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Missing input",1),expect(o.logo.timbre.duoSynthParams).toContain(.5)}),it("should handle non-numeric vibratoAmount",function(){Singer.ToneActions.defDuoSynth(10,"string",0,1),expect(o.errorMsg).toHaveBeenCalledWith("Missing input",1),expect(o.logo.timbre.duoSynthParams).toContain(.5)}),it("should handle negative inputs correctly",function(){Singer.ToneActions.defDuoSynth(-10,-20,0,1),expect(o.logo.timbre.duoSynthParams).toContain(10),expect(o.logo.timbre.duoSynthParams).toContain(.2)}),it("should show error when oscillators exist",function(){o.logo.timbre.osc=[{}],Singer.ToneActions.defDuoSynth(10,20,0,1),expect(o.errorMsg).toHaveBeenCalledWith("Unable to use synth due to existing oscillator")}),it("should not create parameters when not in timbre mode",function(){o.logo.inTimbre=!1,Singer.ToneActions.defDuoSynth(10,20,0,1),expect(o.logo.synth.createSynth).not.toHaveBeenCalled()})})});
var setupVolumeActions=require("../VolumeActions");describe("setupVolumeActions",function(){var o,i,e,t,n,s,l,u,c,a;beforeAll(function(){global.Singer={VolumeActions:{},setSynthVolume:jest.fn(),setMasterVolume:jest.fn(),masterVolume:[]},global.instruments={0:{synth1:{connect:jest.fn()},piano:{connect:jest.fn()}}},global.Tone={Panner:jest.fn(function(e){return{toDestination:jest.fn(),pan:{value:e||0}}})},global.last=jest.fn(function(e){return e[e.length-1]}),global._=jest.fn(function(e){return e}),global.VOICENAMES={Piano:["Piano","piano"],Violin:["Violin","violin"]},global.DRUMNAMES={Kick:["Kick","kick"],Snare:["Snare","snare"]},global.DEFAULTVOLUME=50,global.DEFAULTVOICE="default"}),beforeEach(function(){e&&e.mockClear(),t&&t.mockClear(),n&&n.mockClear(),s&&s.mockClear(),l&&l.mockClear(),u&&u.mockClear(),c&&c.mockClear(),a&&a.mockClear(),jest.useFakeTimers(),global.Mouse={getMouseFromTurtle:jest.fn().mockReturnValue({MB:{listeners:[]}})},global.MusicBlocks={isRun:!0},o={turtles:{ithTurtle:jest.fn()},blocks:{blockList:{}},logo:{setDispatchBlock:jest.fn(),setTurtleListener:jest.fn(),synth:{loadSynth:jest.fn(),setMasterVolume:jest.fn(),trigger:jest.fn()},notation:{notationBeginArticulation:jest.fn(),notationEndArticulation:jest.fn(),notationEndCrescendo:jest.fn()},blockList:{1:{connections:[{},{}]},2:{connections:[{}]},testBlock:{connections:[null,2]},emptyBlock:{connections:[]},oneConnectionBlock:{connections:[3]}}},errorMsg:jest.fn()},e=jest.spyOn(Singer,"setSynthVolume"),t=jest.spyOn(Singer,"setMasterVolume"),n=jest.spyOn(o.logo.notation,"notationEndCrescendo"),s=jest.spyOn(o.logo.notation,"notationBeginArticulation"),l=jest.spyOn(o.logo.notation,"notationEndArticulation"),u=jest.spyOn(o.logo.synth,"loadSynth"),c=jest.spyOn(o.logo.synth,"trigger"),a=jest.spyOn(o.logo,"setDispatchBlock"),i={singer:{synthVolume:{default:[DEFAULTVOLUME],piano:[DEFAULTVOLUME]},crescendoInitialVolume:{default:[DEFAULTVOLUME],piano:[DEFAULTVOLUME]},crescendoDelta:[],inCrescendo:[],instrumentNames:["default","piano"],suppressOutput:!1,justCounting:[],panner:null}},o.turtles.ithTurtle.mockReturnValue(i),setupVolumeActions(o)}),afterEach(function(){jest.useRealTimers()}),describe("doCrescendo",function(){test.each([["crescendo",10,10],["decrescendo",10,-10]])("sets up %s correctly",function(e,t,n){Singer.VolumeActions.doCrescendo(e,t,0,1),expect(i.singer.crescendoDelta).toContain(n),expect(i.singer.synthVolume.default.length).toBeGreaterThan(1),expect(i.singer.inCrescendo).toContain(!0),expect(o.logo.setTurtleListener).toHaveBeenCalledWith(0,"_crescendo_0",expect.any(Function))}),test("handles dispatch block, mouse listener, and run flag",function(){o.blocks.blockList[1]={};var e={MB:{listeners:[]}};Mouse.getMouseFromTurtle.mockReturnValue(e),Singer.VolumeActions.doCrescendo("crescendo",10,0,1),expect(o.logo.setDispatchBlock).toHaveBeenCalledWith(1,0,"_crescendo_0"),expect(e.MB.listeners).toHaveLength(0),MusicBlocks.isRun=!1,o.logo.setDispatchBlock.mockClear(),Mouse.getMouseFromTurtle.mockClear(),Singer.VolumeActions.doCrescendo("crescendo",15,0),expect(o.logo.setDispatchBlock).not.toHaveBeenCalled(),expect(Mouse.getMouseFromTurtle).not.toHaveBeenCalled(),expect(o.logo.setTurtleListener).toHaveBeenCalledWith(0,"_crescendo_0",expect.any(Function))}),test.each([[[],!1],[[!0],!0]])("listener execution with justCounting %p",function(e,t){i.singer.justCounting=e,Singer.VolumeActions.doCrescendo("crescendo",10,0,1),(0,o.logo.setTurtleListener.mock.calls.pop()[2])(),t?expect(n).not.toHaveBeenCalled():expect(n).toHaveBeenCalledWith(0,10)})}),describe("setRelativeVolume",function(){it("should adjust volume relatively for all synths",function(){i.singer.synthVolume={default:[50],piano:[60]},Singer.VolumeActions.setRelativeVolume(20,0,1),expect(i.singer.synthVolume.default).toContain(60),expect(i.singer.synthVolume.piano).toContain(72),expect(e).toHaveBeenCalledWith(o.logo,0,"default",60),expect(e).toHaveBeenCalledWith(o.logo,0,"piano",72)}),it("should clamp relative volume to max 100",function(){i.singer.synthVolume={default:[90]},Singer.VolumeActions.setRelativeVolume(50,0,1),expect(i.singer.synthVolume.default).toContain(100)}),it("should clamp relative volume to min -100",function(){i.singer.synthVolume={default:[50]},Singer.VolumeActions.setRelativeVolume(-300,0,1),expect(i.singer.synthVolume.default).toContain(-100)}),it("should call notationBeginArticulation when justCounting is empty",function(){Singer.VolumeActions.setRelativeVolume(20,0,1),expect(s).toHaveBeenCalledWith(0)}),it("should not call notationBeginArticulation when justCounting is not empty",function(){i.singer.justCounting=[!0],Singer.VolumeActions.setRelativeVolume(20,0,1),expect(s).not.toHaveBeenCalled()}),it("should use dispatch block when block is provided",function(){o.blocks.blockList[1]={},Singer.VolumeActions.setRelativeVolume(20,0,1),expect(o.logo.setDispatchBlock).toHaveBeenCalledWith(1,0,"_articulation_0")}),it("should add listener to mouse when MusicBlocks.isRun is true",function(){var e={MB:{listeners:[]}};Mouse.getMouseFromTurtle.mockReturnValue(e),Singer.VolumeActions.setRelativeVolume(20,0),expect(e.MB.listeners).toContain("_articulation_0")}),it("should execute listener correctly",function(){i.singer.synthVolume={default:[50,60],piano:[60,72]},Singer.VolumeActions.setRelativeVolume(20,0,1),(0,o.logo.setTurtleListener.mock.calls[0][2])(),expect(i.singer.synthVolume.default).toHaveLength(2),expect(i.singer.synthVolume.piano).toHaveLength(2),expect(e).toHaveBeenCalledWith(o.logo,0,"default",60),expect(e).toHaveBeenCalledWith(o.logo,0,"piano",72),expect(l).toHaveBeenCalledWith(0)}),it("should not call notationEndArticulation when justCounting is not empty",function(){i.singer.justCounting=[!0],Singer.VolumeActions.setRelativeVolume(20,0,1),(0,o.logo.setTurtleListener.mock.calls[0][2])(),expect(l).not.toHaveBeenCalled()}),it("should not call setSynthVolume when suppressOutput is true",function(){i.singer.suppressOutput=!0,Singer.VolumeActions.setRelativeVolume(30,0,1),expect(e).not.toHaveBeenCalled()}),it("should not call setDispatchBlock or mouse listener when MusicBlocks.isRun is false and blk is undefined",function(){MusicBlocks.isRun=!1,Singer.VolumeActions.setRelativeVolume(25,0),expect(o.logo.setDispatchBlock).not.toHaveBeenCalled(),expect(Mouse.getMouseFromTurtle).not.toHaveBeenCalled(),expect(o.logo.setTurtleListener).toHaveBeenCalledWith(0,"_articulation_0",expect.any(Function))})}),describe("setMasterVolume",function(){it("should set master volume correctly",function(){Singer.VolumeActions.setMasterVolume(80,0,1),expect(Singer.masterVolume).toContain(80),expect(t).toHaveBeenCalledWith(o.logo,80,1)}),it("should clamp master volume to min 0",function(){Singer.VolumeActions.setMasterVolume(-10,0,1),expect(Singer.masterVolume).toContain(0),expect(o.errorMsg).toHaveBeenCalledWith("Setting volume to 0.",1)}),it("should clamp master volume to max 100",function(){Singer.VolumeActions.setMasterVolume(120,0,1),expect(Singer.masterVolume).toContain(100)}),it("should pop from masterVolume when length is 2",function(){Singer.masterVolume=[50,60],Singer.VolumeActions.setMasterVolume(80,0,1),expect(Singer.masterVolume).toEqual([50,80])}),it("should not call setMasterVolume when suppressOutput is true",function(){i.singer.suppressOutput=!0,Singer.VolumeActions.setMasterVolume(80,0,1),expect(t).not.toHaveBeenCalled()})}),describe("setPanning",function(){it("should create new panner when none exists",function(){i.singer.panner=null,Singer.VolumeActions.setPanning(50,0),expect(Tone.Panner).toHaveBeenCalledWith(.5);var e=Tone.Panner.mock.results[0].value;expect(e.toDestination).toHaveBeenCalled()}),it("should update existing panner when one exists",function(){i.singer.panner=new Tone.Panner(0),Singer.VolumeActions.setPanning(50,0),expect(i.singer.panner.pan.value).toBe(.5)}),it("should clamp panning value to range [-1, 1]",function(){Singer.VolumeActions.setPanning(150,0),expect(Tone.Panner).toHaveBeenCalledWith(1);var e=Tone.Panner.mock.results[0].value,e=(expect(e.pan.value).toBe(1),Singer.VolumeActions.setPanning(-150,0),expect(Tone.Panner).toHaveBeenCalledWith(-1),Tone.Panner.mock.results[1].value);expect(e.pan.value).toBe(-1)}),it("should connect all instruments to the panner",function(){var e=jest.spyOn(instruments[0].synth1,"connect"),t=jest.spyOn(instruments[0].piano,"connect");Singer.VolumeActions.setPanning(50,0),expect(e).toHaveBeenCalledWith(i.singer.panner),expect(t).toHaveBeenCalledWith(i.singer.panner)})}),describe("setSynthVolume",function(){it("should set volume for default voice",function(){Singer.VolumeActions.setSynthVolume(DEFAULTVOICE,70,0,"testBlock"),expect(i.singer.synthVolume[DEFAULTVOICE]).toContain(70),expect(e).toHaveBeenCalledWith(o.logo,0,DEFAULTVOICE,70)}),it("should set volume for custom synth",function(){Singer.VolumeActions.setSynthVolume("custom",70,0,"testBlock"),expect(i.singer.synthVolume.custom).toContain(70),expect(e).toHaveBeenCalledWith(o.logo,0,"custom",70)}),it("should identify and set volume for voice type from VOICENAMES",function(){Singer.VolumeActions.setSynthVolume("Piano",70,0,"testBlock"),expect(i.singer.synthVolume.piano).toContain(70),Singer.VolumeActions.setSynthVolume("violin",60,0,"testBlock"),expect(i.singer.synthVolume.violin).toContain(60)}),it("should identify and set volume for drum type from DRUMNAMES",function(){Singer.VolumeActions.setSynthVolume("Kick",70,0,"testBlock"),expect(i.singer.synthVolume.kick).toContain(70),Singer.VolumeActions.setSynthVolume("snare",60,0,"testBlock"),expect(i.singer.synthVolume.snare).toContain(60)}),it("should handle invalid synth name",function(){Singer.VolumeActions.setSynthVolume("invalidSynth",70,0,"testBlock"),expect(o.errorMsg).toHaveBeenCalledWith("nullnot found"),expect(i.singer.synthVolume[DEFAULTVOICE]).toContain(70)}),it("should load synth when not in instrumentNames",function(){i.singer.instrumentNames=["default"],Singer.VolumeActions.setSynthVolume("piano",70,0,"testBlock"),expect(i.singer.instrumentNames).toContain("piano"),expect(u).toHaveBeenCalledWith(0,"piano")}),it("should initialize synthVolume and crescendoInitialVolume when undefined",function(){delete i.singer.synthVolume.violin,delete i.singer.crescendoInitialVolume.violin,Singer.VolumeActions.setSynthVolume("violin",70,0,"testBlock"),expect(i.singer.synthVolume.violin).toEqual([DEFAULTVOLUME,70]),expect(i.singer.crescendoInitialVolume.violin).toEqual([DEFAULTVOLUME])}),it("should not call setSynthVolume when suppressOutput is true",function(){i.singer.suppressOutput=!0,Singer.VolumeActions.setSynthVolume(DEFAULTVOICE,70,0,"testBlock"),expect(e).not.toHaveBeenCalled()}),it("should trigger tone when firstConnection and lastConnection are null",function(){Singer.VolumeActions.setSynthVolume(DEFAULTVOICE,70,0,null),jest.advanceTimersByTime(250),expect(c).toHaveBeenCalledWith(0,"G4",.25,DEFAULTVOICE,null,null,!1)}),it("should not trigger tone when connections exist",function(){Singer.VolumeActions.setSynthVolume(DEFAULTVOICE,70,0,"testBlock"),jest.advanceTimersByTime(250),expect(c).not.toHaveBeenCalled()})}),describe("getter methods",function(){it("should get master volume correctly",function(){Singer.masterVolume=[60],expect(Singer.VolumeActions.masterVolume).toBe(60)}),it("should get synth volume correctly when synth exists",function(){i.singer.synthVolume.piano=[50,70],expect(Singer.VolumeActions.getSynthVolume("piano",0)).toBe(70)}),it("should return undefined when getting volume for non-existent synth",function(){expect(Singer.VolumeActions.getSynthVolume("nonExistentSynth",0)).toBeUndefined()})}),describe("edge cases and combinations",function(){it("should handle case where synthVolume is undefined",function(){delete i.singer.synthVolume.default,Singer.VolumeActions.setRelativeVolume(20,0,1),expect(i.singer.synthVolume.piano).toBeDefined()}),it("should handle empty crescendoInitialVolume",function(){i.singer.crescendoInitialVolume={},Singer.VolumeActions.doCrescendo("crescendo",10,0,1),expect(i.singer.crescendoInitialVolume.default).toBeDefined(),expect(i.singer.crescendoInitialVolume.piano).toBeDefined()}),it("should handle null mouse",function(){Mouse.getMouseFromTurtle.mockReturnValue(null),Singer.VolumeActions.doCrescendo("crescendo",10,0),expect(o.logo.setTurtleListener).toHaveBeenCalled()})})});
var MathUtility=require("../mathutils"),SOLFEGENAMES=["do","re","mi","fa","sol","la","ti"];global.SOLFEGENAMES=SOLFEGENAMES,describe("MathUtility",function(){describe("doRandom",function(){test("returns random number between two numbers",function(){var t=MathUtility.doRandom(1,10);expect(t).toBeGreaterThanOrEqual(1),expect(t).toBeLessThanOrEqual(10)}),test("returns random solfege array between two solfege names",function(){var t=MathUtility.doRandom("do","sol",4);expect(t).toHaveLength(2),expect(SOLFEGENAMES).toContain(t[0]),expect(Number(t[1])).toBeGreaterThanOrEqual(4)}),test("throws error for invalid inputs",function(){expect(function(){return MathUtility.doRandom("invalid",10)}).toThrow("NanError")}),test("handles swapped min/max (n1 > n2)",function(){var t=MathUtility.doRandom(10,1);expect(t).toBeGreaterThanOrEqual(1),expect(t).toBeLessThanOrEqual(10)}),test("returns same number when min equals max",function(){var t=MathUtility.doRandom(5,5);expect(t).toBe(5)}),test("handles negative number range",function(){var t=MathUtility.doRandom(-10,-1);expect(t).toBeGreaterThanOrEqual(-10),expect(t).toBeLessThanOrEqual(-1)}),test("handles range crossing zero",function(){var t=MathUtility.doRandom(-5,5);expect(t).toBeGreaterThanOrEqual(-5),expect(t).toBeLessThanOrEqual(5)}),test("returns solfege with swapped order (n1 > n2 in solfege)",function(){var t=MathUtility.doRandom("sol","do",4);expect(t).toHaveLength(2),expect(SOLFEGENAMES).toContain(t[0])}),test("returns solfege without octave parameter (default octave)",function(){var t=MathUtility.doRandom("do","mi");expect(t).toHaveLength(2),expect(SOLFEGENAMES).toContain(t[0]),expect(Number(t[1])).toBeGreaterThanOrEqual(4)}),test("throws error when mixing number and string",function(){expect(function(){return MathUtility.doRandom(1,"do")}).toThrow("NanError")}),test("throws error for one valid solfege and one invalid",function(){expect(function(){return MathUtility.doRandom("do","invalid")}).toThrow("NanError")})}),describe("doOneOf",function(){test("returns either a or b",function(){var t=MathUtility.doOneOf("a","b");expect(["a","b"]).toContain(t)}),test("works with numbers",function(){var t=MathUtility.doOneOf(1,2);expect([1,2]).toContain(t)}),test("works with same values",function(){var t=MathUtility.doOneOf("same","same");expect(t).toBe("same")}),test("works with null values",function(){var t=MathUtility.doOneOf(null,"b");expect([null,"b"]).toContain(t)}),test("works with undefined values",function(){var t=MathUtility.doOneOf(void 0,"b");expect([void 0,"b"]).toContain(t)}),test("works with objects",function(){var t={a:1},e={b:2},o=MathUtility.doOneOf(t,e);expect([t,e]).toContain(o)})}),describe("doMod",function(){test("calculates modulus correctly",function(){expect(MathUtility.doMod(10,3)).toBe(1)}),test("throws error for invalid inputs",function(){expect(function(){return MathUtility.doMod("a",3)}).toThrow("NanError")}),test("handles negative dividend",function(){expect(MathUtility.doMod(-10,3)).toBe(-1)}),test("handles negative divisor",function(){expect(MathUtility.doMod(10,-3)).toBe(1)}),test("handles both negative",function(){expect(MathUtility.doMod(-10,-3)).toBe(-1)}),test("returns 0 when evenly divisible",function(){expect(MathUtility.doMod(9,3)).toBe(0)}),test("handles modulus with zero dividend",function(){expect(MathUtility.doMod(0,5)).toBe(0)}),test("handles floating point numbers",function(){expect(MathUtility.doMod(5.5,2)).toBeCloseTo(1.5)}),test("throws error when second arg is string",function(){expect(function(){return MathUtility.doMod(10,"a")}).toThrow("NanError")})}),describe("doSqrt",function(){test("calculates square root",function(){expect(MathUtility.doSqrt(9)).toBe(3)}),test("throws error for negative input",function(){expect(function(){return MathUtility.doSqrt(-1)}).toThrow("NoSqrtError")}),test("returns 0 for sqrt of 0",function(){expect(MathUtility.doSqrt(0)).toBe(0)}),test("returns 1 for sqrt of 1",function(){expect(MathUtility.doSqrt(1)).toBe(1)}),test("handles non-perfect squares",function(){expect(MathUtility.doSqrt(2)).toBeCloseTo(1.414,2)}),test("handles large numbers",function(){expect(MathUtility.doSqrt(1e6)).toBe(1e3)}),test("handles decimal numbers",function(){expect(MathUtility.doSqrt(.25)).toBe(.5)}),test("throws NanError for string input",function(){expect(function(){return MathUtility.doSqrt("9")}).toThrow("NanError")})}),describe("doPlus",function(){test("adds two numbers",function(){expect(MathUtility.doPlus(2,3)).toBe(5)}),test("concatenates strings",function(){expect(MathUtility.doPlus("a","b")).toBe("ab")}),test("concatenates number and string",function(){expect(MathUtility.doPlus(1,"b")).toBe("1b")}),test("concatenates string and number",function(){expect(MathUtility.doPlus("a",2)).toBe("a2")}),test("handles negative numbers",function(){expect(MathUtility.doPlus(-2,3)).toBe(1)}),test("handles zero",function(){expect(MathUtility.doPlus(0,5)).toBe(5)}),test("handles floating point addition",function(){expect(MathUtility.doPlus(.1,.2)).toBeCloseTo(.3)}),test("concatenates empty strings",function(){expect(MathUtility.doPlus("","")).toBe("")}),test("concatenates with empty string",function(){expect(MathUtility.doPlus("hello","")).toBe("hello")})}),describe("doMinus",function(){test("subtracts numbers",function(){expect(MathUtility.doMinus(5,3)).toBe(2)}),test("throws error for string inputs",function(){expect(function(){return MathUtility.doMinus("a",3)}).toThrow("NanError")}),test("handles negative result",function(){expect(MathUtility.doMinus(3,5)).toBe(-2)}),test("handles subtracting negative numbers",function(){expect(MathUtility.doMinus(5,-3)).toBe(8)}),test("handles both negative numbers",function(){expect(MathUtility.doMinus(-5,-3)).toBe(-2)}),test("returns 0 when subtracting same numbers",function(){expect(MathUtility.doMinus(5,5)).toBe(0)}),test("handles floating point subtraction",function(){expect(MathUtility.doMinus(.3,.1)).toBeCloseTo(.2)}),test("throws error when second arg is string",function(){expect(function(){return MathUtility.doMinus(5,"3")}).toThrow("NanError")})}),describe("doMultiply",function(){test("multiplies numbers",function(){expect(MathUtility.doMultiply(2,3)).toBe(6)}),test("throws error for string inputs",function(){expect(function(){return MathUtility.doMultiply("a",3)}).toThrow("NanError")}),test("handles multiplication by zero",function(){expect(MathUtility.doMultiply(5,0)).toBe(0)}),test("handles multiplication by one",function(){expect(MathUtility.doMultiply(5,1)).toBe(5)}),test("handles negative multiplication",function(){expect(MathUtility.doMultiply(-2,3)).toBe(-6)}),test("handles both negative",function(){expect(MathUtility.doMultiply(-2,-3)).toBe(6)}),test("handles floating point multiplication",function(){expect(MathUtility.doMultiply(.1,.2)).toBeCloseTo(.02)}),test("throws error when second arg is string",function(){expect(function(){return MathUtility.doMultiply(5,"3")}).toThrow("NanError")})}),describe("doDivide",function(){test("divides numbers",function(){expect(MathUtility.doDivide(6,2)).toBe(3)}),test("throws error for division by zero",function(){expect(function(){return MathUtility.doDivide(6,0)}).toThrow("DivByZeroError")}),test("handles division resulting in decimal",function(){expect(MathUtility.doDivide(5,2)).toBe(2.5)}),test("handles division of zero",function(){expect(MathUtility.doDivide(0,5)).toBe(0)}),test("handles negative dividend",function(){expect(MathUtility.doDivide(-6,2)).toBe(-3)}),test("handles negative divisor",function(){expect(MathUtility.doDivide(6,-2)).toBe(-3)}),test("handles both negative",function(){expect(MathUtility.doDivide(-6,-2)).toBe(3)}),test("throws NanError for string dividend",function(){expect(function(){return MathUtility.doDivide("6",2)}).toThrow("NanError")}),test("throws NanError for string divisor",function(){expect(function(){return MathUtility.doDivide(6,"2")}).toThrow("NanError")})}),describe("doCalculateDistance",function(){test("calculates Euclidean distance",function(){expect(MathUtility.doCalculateDistance(0,0,3,4)).toBe(5)}),test("returns 0 for same point",function(){expect(MathUtility.doCalculateDistance(5,5,5,5)).toBe(0)}),test("handles negative coordinates",function(){expect(MathUtility.doCalculateDistance(-3,-4,0,0)).toBe(5)}),test("handles distance along x-axis only",function(){expect(MathUtility.doCalculateDistance(0,0,5,0)).toBe(5)}),test("handles distance along y-axis only",function(){expect(MathUtility.doCalculateDistance(0,0,0,5)).toBe(5)}),test("handles floating point coordinates",function(){expect(MathUtility.doCalculateDistance(0,0,1.5,2)).toBeCloseTo(2.5)}),test("throws NanError for string x1",function(){expect(function(){return MathUtility.doCalculateDistance("0",0,3,4)}).toThrow("NanError")}),test("throws NanError for string y1",function(){expect(function(){return MathUtility.doCalculateDistance(0,"0",3,4)}).toThrow("NanError")}),test("throws NanError for string x2",function(){expect(function(){return MathUtility.doCalculateDistance(0,0,"3",4)}).toThrow("NanError")}),test("throws NanError for string y2",function(){expect(function(){return MathUtility.doCalculateDistance(0,0,3,"4")}).toThrow("NanError")})}),describe("doPower",function(){test("calculates power",function(){expect(MathUtility.doPower(2,3)).toBe(8)}),test("handles power of 0",function(){expect(MathUtility.doPower(5,0)).toBe(1)}),test("handles power of 1",function(){expect(MathUtility.doPower(5,1)).toBe(5)}),test("handles base of 0",function(){expect(MathUtility.doPower(0,5)).toBe(0)}),test("handles base of 1",function(){expect(MathUtility.doPower(1,100)).toBe(1)}),test("handles negative exponent",function(){expect(MathUtility.doPower(2,-2)).toBe(.25)}),test("handles negative base with odd exponent",function(){expect(MathUtility.doPower(-2,3)).toBe(-8)}),test("handles negative base with even exponent",function(){expect(MathUtility.doPower(-2,2)).toBe(4)}),test("handles fractional exponent",function(){expect(MathUtility.doPower(4,.5)).toBe(2)}),test("throws NanError for string base",function(){expect(function(){return MathUtility.doPower("2",3)}).toThrow("NanError")}),test("throws NanError for string exponent",function(){expect(function(){return MathUtility.doPower(2,"3")}).toThrow("NanError")})}),describe("doAbs",function(){test("calculates absolute value",function(){expect(MathUtility.doAbs(-5)).toBe(5)}),test("returns positive number unchanged",function(){expect(MathUtility.doAbs(5)).toBe(5)}),test("returns 0 for 0",function(){expect(MathUtility.doAbs(0)).toBe(0)}),test("handles floating point negative",function(){expect(MathUtility.doAbs(-3.14)).toBeCloseTo(3.14)}),test("handles very small negative numbers",function(){expect(MathUtility.doAbs(-1e-4)).toBeCloseTo(1e-4)}),test("throws NanError for string input",function(){expect(function(){return MathUtility.doAbs("-5")}).toThrow("NanError")})}),describe("doNegate",function(){test("negates number",function(){expect(MathUtility.doNegate(5)).toBe(-5)}),test("reverses string",function(){expect(MathUtility.doNegate("abc")).toBe("cba")}),test("negates negative number (double negative)",function(){expect(MathUtility.doNegate(-5)).toBe(5)}),test("negates zero",function(){expect(MathUtility.doNegate(0)).toBe(0)}),test("reverses single character string",function(){expect(MathUtility.doNegate("a")).toBe("a")}),test("reverses empty string",function(){expect(MathUtility.doNegate("")).toBe("")}),test("reverses palindrome",function(){expect(MathUtility.doNegate("radar")).toBe("radar")}),test("reverses string with spaces",function(){expect(MathUtility.doNegate("hello world")).toBe("dlrow olleh")}),test("throws NoNegError for array",function(){expect(function(){return MathUtility.doNegate([1,2,3])}).toThrow("NoNegError")}),test("throws NoNegError for object",function(){expect(function(){return MathUtility.doNegate({a:1})}).toThrow("NoNegError")}),test("throws NoNegError for null",function(){expect(function(){return MathUtility.doNegate(null)}).toThrow("NoNegError")}),test("throws NoNegError for undefined",function(){expect(function(){return MathUtility.doNegate(void 0)}).toThrow("NoNegError")})}),describe("doInt",function(){test("rounds to nearest integer",function(){expect(MathUtility.doInt(4.6)).toBe(5)}),test("rounds down for .4",function(){expect(MathUtility.doInt(4.4)).toBe(4)}),test("rounds up for .5",function(){expect(MathUtility.doInt(4.5)).toBe(5)}),test("handles already integer value",function(){expect(MathUtility.doInt(5)).toBe(5)}),test("handles negative with rounding up (towards zero)",function(){expect(MathUtility.doInt(-4.4)).toBe(-4)}),test("handles negative with rounding down (away from zero)",function(){expect(MathUtility.doInt(-4.6)).toBe(-5)}),test("handles zero",function(){expect(MathUtility.doInt(0)).toBe(0)}),test("handles numeric string (converts to number)",function(){expect(MathUtility.doInt("4.6")).toBe(5)}),test("returns NaN for non-numeric string",function(){expect(MathUtility.doInt("abc")).toBeNaN()})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var _require=require("../munsell"),interpColor=_require.interpColor,getMunsellColor=_require.getMunsellColor,getcolor=_require.getcolor,searchColors=_require.searchColors;global.createjs={Graphics:{getRGB:function(e,o,t,r){return"rgba(".concat(e,", ").concat(o,", ").concat(t,", ").concat(r,")")}}},describe("munsell",function(){describe("interpColor",function(){it("should interpolate between two colors",function(){expect(interpColor("#ff0000","#0000ff",.5)).toBe("rgba(127, 0, 127, 1)"),expect(interpColor("#00ff00","#000000",.75)).toBe("rgba(0, 191, 0, 1)")}),it("should return the first color if p = 1",function(){expect(interpColor("#123456","#abcdef",1)).toBe("#123456")}),it("should return the second color if p = 0",function(){expect(interpColor("#123456","#abcdef",0)).toBe("#abcdef")}),it("should handle undefined colors gracefully",function(){expect(interpColor(void 0,"#123456",.5)).toBe("rgba(18, 52, 86, 1)"),expect(interpColor("#123456",void 0,.5)).toBe("rgba(18, 52, 86, 1)")})}),describe("getMunsellColor",function(){it("should return the correct Munsell color",function(){var e=getMunsellColor(50,50,50);expect(e).toMatch(/^#[0-9a-fA-F]{6}$/)}),it("should handle edge cases for hue, value, and chroma",function(){expect(getMunsellColor(0,0,0)).toBeDefined(),expect(getMunsellColor(100,100,100)).toBeDefined(),expect(getMunsellColor(-10,-10,-10)).toBeDefined(),expect(getMunsellColor(110,110,110)).toBeDefined()})}),describe("getcolor",function(){it("should return a valid array for a given color value",function(){var e=getcolor(50);expect(Array.isArray(e)).toBe(!0),expect(e.length).toBe(3),expect(_typeof(e[0])).toBe("number"),expect(_typeof(e[1])).toBe("number"),expect(e[2]).toMatch(/^#[0-9a-fA-F]{6}$/)}),it("should handle edge cases for color value",function(){expect(getcolor(0)).toBeDefined(),expect(getcolor(-10)).toBeDefined(),expect(getcolor(110)).toBeDefined()})}),describe("searchColors",function(){it("should return a color value between 0 and 100",function(){var e=searchColors(128,128,128);expect(e).toBeGreaterThanOrEqual(0),expect(e).toBeLessThanOrEqual(100)}),it("should find the nearest color for black",function(){var e=searchColors(0,0,0),e=getcolor(e);expect(e[2]).toMatch(/^#[0-9a-fA-F]{6}$/)}),it("should identify a close match for a RGB value",function(){var e=searchColors(100,150,200),e=getcolor(e);expect(e[2]).toMatch(/^#[0-9a-fA-F]{6}$/)})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var o,n=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _require=require("util"),TextEncoder=_require.TextEncoder,_require2=(global.TextEncoder=TextEncoder,global._=jest.fn(function(e){return e}),global.window={btoa:jest.fn(function(e){return Buffer.from(e,"utf8").toString("base64")})},require("../musicutils")),scaleDegreeToPitchMapping=_require2.scaleDegreeToPitchMapping,buildScale=_require2.buildScale,getNote=_require2.getNote,getModeLength=_require2.getModeLength,nthDegreeToPitch=_require2.nthDegreeToPitch,getInterval=_require2.getInterval,_calculate_pitch_number=_require2._calculate_pitch_number,_getStepSize=_require2._getStepSize,reducedFraction=_require2.reducedFraction,toFraction=_require2.toFraction,durationToNoteValue=_require2.durationToNoteValue,calcNoteValueToDisplay=_require2.calcNoteValueToDisplay,noteToPitchOctave=_require2.noteToPitchOctave,pitchToFrequency=_require2.pitchToFrequency,noteIsSolfege=_require2.noteIsSolfege,getSolfege=_require2.getSolfege,splitSolfege=_require2.splitSolfege,i18nSolfege=_require2.i18nSolfege,splitScaleDegree=_require2.splitScaleDegree,getNumNote=_require2.getNumNote,calcOctave=_require2.calcOctave,calcOctaveInterval=_require2.calcOctaveInterval,isInt=_require2.isInt,convertFromSolfege=_require2.convertFromSolfege,convertFactor=_require2.convertFactor,getPitchInfo=_require2.getPitchInfo,noteToFrequency=_require2.noteToFrequency,setOctaveRatio=_require2.setOctaveRatio,getOctaveRatio=_require2.getOctaveRatio,TEMPERAMENT=_require2.TEMPERAMENT,getTemperamentsList=_require2.getTemperamentsList,getTemperament=_require2.getTemperament,getTemperamentKeys=_require2.getTemperamentKeys,addTemperamentToList=_require2.addTemperamentToList,addTemperamentToDictionary=_require2.addTemperamentToDictionary,updateTemperaments=_require2.updateTemperaments,deleteTemperamentFromList=_require2.deleteTemperamentFromList,DEFAULTINVERT=_require2.DEFAULTINVERT,DEFAULTMODE=_require2.DEFAULTMODE,customMode=_require2.customMode,getInvertMode=_require2.getInvertMode,getIntervalNumber=_require2.getIntervalNumber,getIntervalDirection=_require2.getIntervalDirection,getIntervalRatio=_require2.getIntervalRatio,getModeNumbers=_require2.getModeNumbers,getDrumIndex=_require2.getDrumIndex,getDrumName=_require2.getDrumName,getDrumSymbol=_require2.getDrumSymbol,getFilterTypes=_require2.getFilterTypes,getOscillatorTypes=_require2.getOscillatorTypes,getDrumIcon=_require2.getDrumIcon,getDrumSynthName=_require2.getDrumSynthName,getNoiseName=_require2.getNoiseName,getNoiseIcon=_require2.getNoiseIcon,getNoiseSynthName=_require2.getNoiseSynthName,getVoiceName=_require2.getVoiceName,getVoiceIcon=_require2.getVoiceIcon,getVoiceSynthName=_require2.getVoiceSynthName,isCustomTemperament=_require2.isCustomTemperament,getTemperamentName=_require2.getTemperamentName,noteToObj=_require2.noteToObj,frequencyToPitch=_require2.frequencyToPitch,getArticulation=_require2.getArticulation,keySignatureToMode=_require2.keySignatureToMode,getScaleAndHalfSteps=_require2.getScaleAndHalfSteps,modeMapper=_require2.modeMapper,getSharpFlatPreference=_require2.getSharpFlatPreference,getCustomNote=_require2.getCustomNote,pitchToNumber=_require2.pitchToNumber,numberToPitchSharp=_require2.numberToPitchSharp,getNumber=_require2.getNumber,getNoteFromInterval=_require2.getNoteFromInterval,numberToPitch=_require2.numberToPitch,GetNotesForInterval=_require2.GetNotesForInterval,base64Encode=_require2.base64Encode;describe("musicutils",function(){it("should set and get Octave Ratio",function(){setOctaveRatio(4);var e=getOctaveRatio();expect(e).toBe(4)})}),describe("Temperament Functions",function(){global.TEMPERAMENTS=[[_("Equal (12EDO)"),"equal","equal"],[_("Equal (5EDO)"),"equal5","equal5"],[_("Equal (7EDO)"),"equal7","equal7"],[_("Equal (19EDO)"),"equal19","equal19"],[_("Equal (31EDO)"),"equal31","equal31"],[_("5-limit Just Intonation"),"just intonation","just intonation"],[_("Pythagorean (3-limit JI)"),"Pythagorean","Pythagorean"],[_("Meantone")+" (1/3)","1/3 comma meantone","meantone (1/3)"],[_("Meantone")+" (1/4)","1/4 comma meantone","meantone (1/4)"],[_("custom"),"custom","custom"]],global.INITIALTEMPERAMENTS=[[_("Equal (12EDO)"),"equal","equal"],[_("Equal (5EDO)"),"equal5","equal5"],[_("Equal (7EDO)"),"equal7","equal7"],[_("Equal (19EDO)"),"equal19","equal19"],[_("Equal (31EDO)"),"equal31","equal31"],[_("5-limit Just Intonation"),"just intonation","just intonation"],[_("Pythagorean (3-limit JI)"),"Pythagorean","Pythagorean"],[_("Meantone")+" (1/3)","1/3 comma meantone","meantone (1/3)"],[_("Meantone")+" (1/4)","1/4 comma meantone","meantone (1/4)"]],global.PreDefinedTemperaments={equal:!0,equal5:!0,equal7:!0,equal19:!0,equal31:!0,"just intonation":!0,Pythagorean:!0,"1/3 comma meantone":!0,"1/4 comma meantone":!0},it("getTemperamentsList should return the list of temperaments",function(){expect(getTemperamentsList()).toEqual([[_("Equal (12EDO)"),"equal","equal"],[_("Equal (5EDO)"),"equal5","equal5"],[_("Equal (7EDO)"),"equal7","equal7"],[_("Equal (19EDO)"),"equal19","equal19"],[_("Equal (31EDO)"),"equal31","equal31"],[_("5-limit Just Intonation"),"just intonation","just intonation"],[_("Pythagorean (3-limit JI)"),"Pythagorean","Pythagorean"],[_("Meantone")+" (1/3)","1/3 comma meantone","meantone (1/3)"],[_("Meantone")+" (1/4)","1/4 comma meantone","meantone (1/4)"],[_("custom"),"custom","custom"]])}),describe("getTemperament",function(){it("should return the correct temperament for a valid key",function(){var e=getTemperament("equal");expect(e).toHaveProperty("perfect 1"),expect(e).toHaveProperty("minor 2"),expect(e).toHaveProperty("pitchNumber",12)}),it("should return the correct temperament for equal5 key",function(){var e=getTemperament("equal5");expect(e).toHaveProperty("perfect 1"),expect(e).toHaveProperty("minor 2"),expect(e).toHaveProperty("pitchNumber",5)}),it("should return undefined for an invalid key",function(){var e=getTemperament("invalid");expect(e).toBeUndefined()})}),describe("getTemperamentKeys",function(){it("should return an array with the correct length",function(){var e=getTemperamentKeys();expect(e.length).toBe(10)}),it("should return an array containing all keys",function(){var e=getTemperamentKeys();expect(e).toEqual(expect.arrayContaining(["equal","equal5","equal7","equal19","equal31","just intonation","Pythagorean","1/3 comma meantone","1/4 comma meantone","custom"]))})}),describe("addTemperamentToList",function(){it("adds a new entry to TEMPERAMENTS if not predefined",function(){var e=["custom","custom","custom"];addTemperamentToList(e),expect(TEMPERAMENTS).toContainEqual(e)}),it("does not add a duplicate entry if already present",function(){addTemperamentToList(["Equal (12EDO)","equal","equal"]),expect(TEMPERAMENTS.filter(function(e){return"equal"===e[1]}).length).toBe(1)})}),describe("addTemperamentToDictionary",function(){it("add the new entry to temparment",function(){addTemperamentToDictionary("music","blocks"),expect(TEMPERAMENT.music).toBe("blocks")})}),describe("deleteTemperamentFromList",function(){it("removes an entry from TEMPERAMENT by key",function(){TEMPERAMENT.custom=!0,deleteTemperamentFromList("custom"),expect(TEMPERAMENT.custom).toBeUndefined()}),it("does nothing if the key does not exist",function(){deleteTemperamentFromList("doesn't exist"),expect(TEMPERAMENT["doesn't exist"]).toBeUndefined()})}),describe("updateTemperaments",function(){it("should reset TEMPERAMENTS to INITIALTEMPERAMENTS",function(){updateTemperaments(),INITIALTEMPERAMENTS.forEach(function(e){expect(TEMPERAMENTS).toContainEqual(e)})})})}),describe("Constants",function(){it("should have correct default values",function(){expect(DEFAULTINVERT).toBe("even"),expect(DEFAULTMODE).toBe("major")})}),describe("customMode",function(){it("should return custom mode from MUSICALMODES",function(){expect(customMode).toEqual([1,1,1,1,1,1,1,1,1,1,1,1])})}),describe("getInvertMode",function(){it("should return the correct invert mode name",function(){expect(getInvertMode("even")).toBe("even"),expect(getInvertMode("scalar")).toBe("scalar"),expect(getInvertMode("nonexistent")).toBe("nonexistent")})}),describe("getIntervalNumber",function(){it("should return the number of semi-tones for a given interval",function(){expect(getIntervalNumber("perfect 5")).toBe(7),expect(getIntervalNumber("major 3")).toBe(4)})}),describe("getIntervalDirection",function(){it("should return the direction of the interval",function(){expect(getIntervalDirection("diminished 6")).toBe(-1),expect(getIntervalDirection("minor 3")).toBe(-1)})}),describe("getIntervalRatio",function(){it("should return the ratio for a given interval",function(){expect(getIntervalRatio("perfect 5")).toBe(1.5),expect(getIntervalRatio("major 3")).toBe(1.25)})}),describe("getModeNumbers",function(){it("should return the correct mode numbers for a valid mode",function(){expect(getModeNumbers("chromatic")).toBe("0 1 2 3 4 5 6 7 8 9 10 11"),expect(getModeNumbers("major")).toBe("0 2 4 5 7 9 11"),expect(getModeNumbers("minor")).toBe("0 2 3 5 7 8 10")}),it("should return an empty string for an invalid mode",function(){expect(getModeNumbers("invalidMode")).toBe("")}),it("should handle custom mode correctly",function(){expect(getModeNumbers("custom")).toBe("0 1 2 3 4 5 6 7 8 9 10 11")})}),jest.mock("../musicutils",function(){return _objectSpread(_objectSpread({},jest.requireActual("../musicutils")),{},{getDrumIndex:jest.fn(),getDrumName:jest.fn(),getDrumSymbol:jest.fn()})}),describe("getDrum",function(){var o,n;beforeEach(function(){o=[["snare drum","snare drum","images/snaredrum.svg","sn","drum"],["kick drum","kick drum","images/kick.svg","hh","drum"],["tom tom","tom tom","images/tom.svg","tomml","drum"],["floor tom","floor tom","images/floortom.svg","tomfl","drum"],["bass drum","bass drum","images/kick.svg","tomfl","drum"],["hi hat","hi hat","images/hihat.svg","hh","bell"]],n="kick drum",require("../musicutils").getDrumIndex.mockImplementation(function(t){var e;return"http"===t.slice(0,4)?null:""===t?o.findIndex(function(e){return e[0]===n}):0<=(e=o.findIndex(function(e){return e[0].toLowerCase()===t.toLowerCase()}))?e:-1}),require("../musicutils").getDrumName.mockImplementation(function(e){if("http"!==(e=""===e?n:e).slice(0,4))for(var t=0;t<o.length;t++){if(o[t][0].toLowerCase()===e.toLowerCase())return o[t][0];if(o[t][1].toLowerCase()===e.toLowerCase())return o[t][1]}return null}),require("../musicutils").getDrumSymbol.mockImplementation(function(e){if(""!==e)for(var t=0;t<o.length;t++){if(o[t][0].toLowerCase()===e.toLowerCase())return o[t][3];if(o[t][1].toLowerCase()===e.toLowerCase())return"hh"}return"hh"})}),describe("getDrumIndex",function(){it("should return the index of a valid drum name",function(){expect(getDrumIndex("snare drum")).toBe(0),expect(getDrumIndex("kick drum")).toBe(1),expect(getDrumIndex("floor tom")).toBe(3)}),it("should return -1 for an invalid drum name",function(){expect(getDrumIndex("invalid drum")).toBe(-1)}),it("should return the index of the DEFAULTDRUM for empty input",function(){expect(getDrumIndex("")).toBe(1)}),it("should ignore case sensitivity when matching drum names",function(){expect(getDrumIndex("SNARE DRUM")).toBe(0)}),it('should return null for names starting with "http"',function(){expect(getDrumIndex("http")).toBe(null)})}),describe("getDrumName",function(){it("should return the name of a valid drum",function(){expect(getDrumName("snare drum")).toBe("snare drum"),expect(getDrumName("kick drum")).toBe("kick drum")}),it("should return the DEFAULTDRUM name for empty input",function(){expect(getDrumName("")).toBe("kick drum")}),it('should return null for names starting with "http"',function(){expect(getDrumName("http")).toBe(null)}),it("should ignore case sensitivity when matching drum names",function(){expect(getDrumName("SNARE DRUM")).toBe("snare drum"),expect(getDrumName("KICK DRUM")).toBe("kick drum")}),it("should return null for an invalid drum name",function(){expect(getDrumName("invalid drum")).toBe(null)}),it("should match the second element of DRUMNAMES if provided",function(){expect(getDrumName("kick drum")).toBe("kick drum")})}),describe("getDrumSymbol",function(){it("should return the correct symbol for a valid drum name",function(){expect(getDrumSymbol("snare drum")).toBe("sn"),expect(getDrumSymbol("kick drum")).toBe("hh"),expect(getDrumSymbol("floor tom")).toBe("tomfl")}),it('should return "hh" for an empty name',function(){expect(getDrumSymbol("")).toBe("hh")}),it('should return "hh" for an invalid drum name',function(){expect(getDrumSymbol("invalid drum")).toBe("hh")}),it('should return "hh" for a name matching the second element of DRUMNAMES',function(){expect(getDrumSymbol("snare drum")).toBe("sn"),expect(getDrumSymbol("kick drum")).toBe("hh")}),it("should ignore case sensitivity when matching drum names",function(){expect(getDrumSymbol("SNARE DRUM")).toBe("sn"),expect(getDrumSymbol("KICK DRUM")).toBe("hh")})})}),describe("getFilterTypes",function(){it("should return default filter type",function(){expect(getFilterTypes("")).toBe("highpass")}),it("should return correct filter types",function(){expect(getFilterTypes("highpass")).toBe("highpass"),expect(getFilterTypes("notch")).toBe("notch")})}),describe("getOscillatorTypes",function(){beforeEach(function(){global.OSCTYPES=[["sine","sine"],["square","square"],["triangle","triangle"],["sawtooth","sawtooth"]]}),it("should return correct oscillator type for valid display names",function(){expect(getOscillatorTypes("sine")).toBe("sine"),expect(getOscillatorTypes("square")).toBe("square")}),it("should handle case insensitive matching",function(){expect(getOscillatorTypes("SINE")).toBe("sine"),expect(getOscillatorTypes("SawTooth")).toBe("sawtooth")}),it("should return null for invalid oscillator types",function(){expect(getOscillatorTypes("invalid")).toBe(null),expect(getOscillatorTypes("random")).toBe(null)})}),describe("getDrumIcon",function(){beforeEach(function(){global.DRUMNAMES=[["snare drum","snare drum","images/snaredrum.svg"],["kick drum","kick drum","images/kick.svg"],["tom tom","tom tom","images/tom.svg"],["floor tom","floor tom","images/floortom.svg"],["bass drum","bass drum","images/kick.svg"],["hi hat","hi hat","images/hihat.svg"]],global.DEFAULTDRUM="kick drum"}),it("should return correct icon path for exact drum names",function(){expect(getDrumIcon("snare drum")).toBe("images/snaredrum.svg"),expect(getDrumIcon("hi hat")).toBe("images/hihat.svg")}),it("should handle case insensitive matching",function(){expect(getDrumIcon("SNARE DRUM")).toBe("images/snaredrum.svg"),expect(getDrumIcon("HI HAT")).toBe("images/hihat.svg")}),it("should return default drum icon for invalid drum names",function(){expect(getDrumIcon("invalid drum")).toBe("images/drum.svg"),expect(getDrumIcon("123")).toBe("images/drum.svg")})}),describe("getDrumSynthName",function(){beforeEach(function(){global.DRUMNAMES=[["snare drum","snare drum","images/snaredrum.svg"],["kick drum","kick drum","images/kick.svg"],["tom tom","tom tom","images/tom.svg"],["floor tom","floor tom","images/floortom.svg"],["bass drum","bass drum","images/kick.svg"],["hi hat","hi hat","images/hihat.svg"]],global.DEFAULTDRUM="kick drum"}),it("should return correct synth name for exact matches",function(){expect(getDrumSynthName("snare drum")).toBe("snare drum"),expect(getDrumSynthName("tom tom")).toBe("tom tom")}),it("should return null for null",function(){expect(getDrumSynthName(null)).toBeNull()})}),describe("getNoiseName",function(){beforeEach(function(){global.NOISENAMES=[["white noise","noise1","images/noise1.svg"],["brown noise","noise2","images/noise2.svg"],["pink noise","noise3","images/noise3.svg"],["","custom noise","images/custom.svg"]],global.DEFAULTNOISE="noise1"}),it("should return display name of default noise for empty string",function(){expect(getNoiseName("")).toBe("white noise")}),it("should return corresponding display name for valid identifiers",function(){expect(getNoiseName("noise1")).toBe("white noise"),expect(getNoiseName("noise3")).toBe("pink noise")})}),describe("getNoiseIcon",function(){beforeEach(function(){global.NOISENAMES=[["white noise","noise1","images/noise1.svg"],["brown noise","noise2","images/noise2.svg"],["pink noise","noise3","images/noise3.svg"],["","custom noise","images/custom.svg"]],global.DEFAULTNOISE="noise1"}),it("should return icon path for default noise when input is empty",function(){expect(getNoiseIcon("")).toBe("images/noise1.svg")}),it("should return correct icon path when searching by display name",function(){expect(getNoiseIcon("white noise")).toBe("images/noise1.svg"),expect(getNoiseIcon("pink noise")).toBe("images/noise3.svg")}),it("should return correct icon path when searching by identifier",function(){expect(getNoiseIcon("noise1")).toBe("images/noise1.svg")}),it("should handle custom noise with empty display name",function(){expect(getNoiseIcon("custom noise")).toBe("images/custom.svg")}),it("should return default synth.svg for non-existent noise names",function(){expect(getNoiseIcon("nonexistent")).toBe("images/synth.svg")}),it("should be case sensitive for noise names",function(){expect(getNoiseIcon("WHITE NOISE")).toBe("images/synth.svg")})}),describe("getNoiseSynthName",function(){beforeEach(function(){global.NOISENAMES=[["white noise","noise1","images/noise1.svg"],["brown noise","noise2","images/noise2.svg"],["pink noise","noise3","images/noise3.svg"],["","custom noise","images/custom.svg"]],global.DEFAULTNOISE="noise1"}),it("should return null for null input",function(){expect(getNoiseSynthName(null)).toBeNull()}),it("should return null for undefined input",function(){expect(getNoiseSynthName(void 0)).toBeNull()}),it("should return default noise for empty string",function(){expect(getNoiseSynthName("")).toEqual("noise1")}),it("should handle undefined NOISENAMES",function(){global.NOISENAMES=void 0,expect(function(){return getNoiseSynthName("any")}).toThrow()})}),describe("getVoiceName",function(){beforeEach(function(){global.VOICENAMES=[["piano","piano","images/piano.svg"],["violin","violin","images/violin.svg"],["guitar","guitar","images/guitar.svg"],["","custom voice","images/custom.svg"],["electronic synth","synth","images/synth.svg"]],global.DEFAULTVOICE="electronic synth"}),it("should return default voice for empty string",function(){expect(getVoiceName("")).toBe("electronic synth")}),it("should return null for http links",function(){expect(getVoiceName("http://example.com")).toBeNull(),expect(getVoiceName("https://example.com")).toBeNull()}),it("should return voice name for exact matches",function(){expect(getVoiceName("piano")).toBe("piano"),expect(getVoiceName("guitar")).toBe("guitar")}),it("should be case sensitive",function(){expect(getVoiceName("PIANO")).toBe("electronic synth")})}),describe("Voice and Temperament Functions",function(){beforeEach(function(){global.VOICENAMES=[["piano","piano_synth","images/piano.svg"],["violin","violin_synth","images/violin.svg"],["electronic synth","synth","images/synth.svg"],["","custom voice","images/custom.svg"]],global.CUSTOMSAMPLES=[["custom_sample1","sample1","images/sample1.svg"],["custom_sample2","sample2","images/sample2.svg"]],global.DEFAULTVOICE="electronic synth",global.PreDefinedTemperaments={equal:!0,"just intonation":!0}}),describe("getVoiceIcon",function(){it("should return icon path for default voice when input is empty",function(){expect(getVoiceIcon("")).toBe("images/synth.svg")}),it("should return correct icon path when searching by synth name",function(){expect(getVoiceIcon("piano_synth")).toBe("images/piano.svg")}),it("should handle custom samples",function(){expect(getVoiceIcon("custom_sample1")).toBe("custom_sample1")})}),describe("getVoiceSynthName",function(){it("should return null for null/undefined input",function(){expect(getVoiceSynthName(null)).toBeNull(),expect(getVoiceSynthName(void 0)).toBeNull()}),it("should return default voice synth name for empty string",function(){expect(getVoiceSynthName("")).toBe("synth")}),it("should return the same http link",function(){var e="http://example.com/sound.mp3";expect(getVoiceSynthName(e)).toBe(e)}),it("should return correct synth name for display names",function(){expect(getVoiceSynthName("piano")).toBe("piano_synth"),expect(getVoiceSynthName("violin")).toBe("violin_synth")})}),describe("isCustomTemperament",function(){it("should return false for predefined temperaments",function(){expect(isCustomTemperament("equal")).toBeFalsy(),expect(isCustomTemperament("just intonation")).toBeFalsy()}),it("should return true for custom temperaments",function(){expect(isCustomTemperament("custom_temp")).toBeTruthy()})})}),describe("getTemperamentName",function(){beforeEach(function(){global.TEMPERAMENTS=[["equal","equal"],["just","just"],["pythagorean","pythagorean"]],global.DEFAULTTEMPERAMENT="equal"}),it("should return default temperament when input is empty string",function(){expect(getTemperamentName("")).toBe("equal")}),it("should be case insensitive when matching names",function(){expect(getTemperamentName("EQUAL")).toBe("equal"),expect(getTemperamentName("Equal")).toBe("equal")})}),describe("noteToObj",function(){it("should correctly parse note with octave",function(){expect(noteToObj("C4")).toEqual(["C",4]),expect(noteToObj("G3")).toEqual(["G",3])}),it("should handle notes with accidentals and octave",function(){expect(noteToObj("C#4")).toEqual(["C#",4]),expect(noteToObj("F#5")).toEqual(["F#",5])}),it("should default to octave 4 when no octave is specified",function(){expect(noteToObj("C")).toEqual(["C",4]),expect(noteToObj("Bb")).toEqual(["Bb",4])})}),describe("frequencyToPitch",function(){beforeEach(function(){global.A0=27.5,global.C8=4186.01,global.C10=16744.04,global.TWELVEHUNDRETHROOT2=Math.pow(2,1/1200),global.PITCHES=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}),it("should handle frequencies below A0",function(){expect(frequencyToPitch(20)).toEqual(["A",0,0]),expect(frequencyToPitch(27.4)).toEqual(["A",0,0])}),it("should correctly map frequencies in the extended C9 range",function(){var e=frequencyToPitch(8372);expect(e).toEqual(["C",9,0])}),it("should correctly map standard notes (Regression Check)",function(){expect(frequencyToPitch(27.5)).toEqual(["A",0,0]),expect(frequencyToPitch(440)).toEqual(["A",4,0]),expect(frequencyToPitch(261.63)).toEqual(["C",4,0])}),it("should handle frequencies above C10",function(){expect(frequencyToPitch(17e3)).toEqual(["C",10,0]),expect(frequencyToPitch(2e4)).toEqual(["C",10,0])}),it("should handle frequencies with cents deviation",function(){var e=frequencyToPitch(442),e=(expect(e[0]).toBe("A"),expect(e[1]).toBe(4),frequencyToPitch(438));expect(e[0]).toBe("A"),expect(e[2]).toBeLessThan(0)}),it("should map intermediate frequencies to nearest note",function(){var e=A0*Math.pow(2,1/3),e=frequencyToPitch(e);expect(e[0]).toBe("D♭"),expect(e[1]).toBe(1)})}),describe("getArticulation",function(){it("should remove solfege syllables",function(){expect(getArticulation("do")).toBe(""),expect(getArticulation("re")).toBe("")}),it("should handle combinations of articulations",function(){expect(getArticulation("do^")).toBe(""),expect(getArticulation("C^^")).toBe("")}),it("should preserve non-articulation characters",function(){expect(getArticulation("X")).toBe("X"),expect(getArticulation("123")).toBe("123")}),it("should handle empty and special cases",function(){expect(getArticulation("")).toBe(""),expect(getArticulation("doremifa")).toBe("")})}),describe("keySignatureToMode",function(){beforeEach(function(){global.MAQAMTABLE={},global.BTOFLAT={},global.STOSHARP={},global.FLAT="b",global.SHARP="#",global.SOLFEGENAMES1=[],global.NOTESSHARP=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],global.NOTESFLAT=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],global.MUSICALMODES={major:[2,2,1,2,2,2,1],minor:[2,1,2,2,1,2,2]}}),it("should handle empty and null inputs",function(){expect(keySignatureToMode("")).toEqual(["C","major"]),expect(keySignatureToMode(null)).toEqual(["C","major"])}),it("should handle basic major keys",function(){expect(keySignatureToMode("C major")).toEqual(["C","major"]),expect(keySignatureToMode("D major")).toEqual(["D","major"])}),it("should handle full minor key names",function(){expect(keySignatureToMode("A minor")).toEqual(["A","minor"]),expect(keySignatureToMode("E minor")).toEqual(["E","minor"])})}),describe("getScaleAndHalfSteps",function(){beforeEach(function(){global.SOLFMAPPER=["do","do","re","re","mi","fa","fa","sol","sol","la","la","ti"],global.SOLFEGENAMES=["do","re","mi","fa","sol","la","ti"],global.NOTESSHARP=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],global.NOTESFLAT=["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"],global.MUSICALMODES={major:[2,2,1,2,2,2,1],minor:[2,1,2,2,1,2,2]},global.EXTRATRANSPOSITIONS={},global.MAQAMTABLE={},global.BTOFLAT={},global.STOSHARP={},global.FLAT="♭",global.SHARP="#",global.SOLFEGENAMES1=[]}),it(" should handle major scale correctly",function(){var e=getScaleAndHalfSteps("C major");expect(e).toEqual([["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"],["do","","re","","mi","fa","","sol","","la","","ti"],"C","major"])}),it("should handle minor scale correctly",function(){var e=getScaleAndHalfSteps("A minor");expect(e).toEqual([["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"],["do","","re","mi","","fa","","sol","la","","ti",""],"A","minor"])})}),describe("modeMapper",function(){beforeEach(function(){global.SHARP="♯",global.FLAT="♭"}),it("should map Ionian to major",function(){expect(modeMapper("C","ionian")).toEqual(["c","major"]),expect(modeMapper("D","ionian")).toEqual(["d","major"])}),it("should handle flats in Dorian mode",function(){expect(modeMapper("E♭","dorian")).toEqual(["e♭","minor"]),expect(modeMapper("B♭","dorian")).toEqual(["f","minor"])}),it("should handle flats in Locrian mode",function(){expect(modeMapper("E♭","locrian")).toEqual(["d♭","minor"]),expect(modeMapper("B♭","locrian")).toEqual(["d♭","minor"])})}),describe("getSharpFlatPreference",function(){beforeEach(function(){global.SHARPPREFERENCE=["g major","d major","a major","e major","b major"],global.FLATPREFERENCE=["f major","bb major","eb major","ab major","db major"]}),it('should return "sharp" for keys that traditionally use sharps',function(){expect(getSharpFlatPreference("G")).toBe("sharp"),expect(getSharpFlatPreference("D")).toBe("sharp")}),it('should return "natural" for C major and keys not in sharp/flat preferences',function(){expect(getSharpFlatPreference("C")).toBe("natural"),expect(getSharpFlatPreference("Am")).toBe("natural")})}),describe("getCustomNote",function(){beforeEach(function(){global.DOUBLEFLAT="𝄫",global.FLAT="♭",global.DOUBLESHARP="𝄪",global.SHARP="♯"}),it("should handle array input by taking first element",function(){expect(getCustomNote(["C","other"])).toBe("C"),expect(getCustomNote(["D#","other"])).toBe("D♯")}),it("should convert double flat notation",function(){expect(getCustomNote("Cbb")).toBe("C𝄫"),expect(getCustomNote("Dbb")).toBe("D𝄫")})}),describe("pitchToNumber",function(){beforeEach(function(){global.DOUBLEFLAT="𝄫",global.FLAT="♭",global.DOUBLESHARP="𝄪",global.SHARP="♯",global.PITCHES=["C","D","E","F","G","A","B"],global.FIXEDSOLFEGE1={do:"C",re:"D",mi:"E",fa:"F",sol:"G",la:"A",ti:"B"},global.getScaleAndHalfSteps=jest.fn().mockImplementation(function(e){return[["C","D","E","F","G","A","B"],["do","re","mi","fa","sol","la","ti"]]}),global.console.debug=jest.fn()}),it("should handle rest notes",function(){expect(pitchToNumber("R",4,"C major")).toBe(0),expect(pitchToNumber("r",4,"C major")).toBe(0)}),it("should handle basic notes",function(){expect(pitchToNumber("C",4,"C major")).toBe(39),expect(pitchToNumber("A",4,"C major")).toBe(48)})}),describe("numberToPitchSharp",function(){beforeEach(function(){global.SHARP="♯",global.PITCHES2=["A","A♯","B","C","C♯","D","D♯","E","F","F♯","G","G♯"]}),it("should convert 0 to A0",function(){expect(numberToPitchSharp(0)).toEqual(["A",0])}),it("should convert positive numbers within first octave",function(){expect(numberToPitchSharp(1)).toEqual(["A♯",0]),expect(numberToPitchSharp(2)).toEqual(["B",0])})}),describe("getNumber",function(){beforeEach(function(){global.DOUBLEFLAT="𝄫",global.FLAT="♭",global.DOUBLESHARP="𝄪",global.SHARP="♯",global.NOTESTEP={C:0,D:2,E:4,F:5,G:7,A:9,B:11}}),it("should handle natural notes in octave 4",function(){expect(getNumber("C",4)).toBe(37),expect(getNumber("D",4)).toBe(39)}),it("should handle negative octaves",function(){expect(getNumber("C",-1)).toBe(1)}),it("should handle flat notes",function(){expect(getNumber("Bb",4)).toBe(47),expect(getNumber("Eb",4)).toBe(40)})}),describe("getNoteFromInterval",function(){beforeEach(function(){global.DOUBLEFLAT="𝄫",global.FLAT="♭",global.DOUBLESHARP="𝄪",global.SHARP="♯",global.INTERVALVALUES={"major 2":[2,1],"major 3":[4,1],"major 6":[9,1],"major 7":[11,1],"perfect 1":[0,1],"perfect 4":[5,1],"perfect 5":[7,1],"perfect 8":[12,1],"minor 2":[1,1],"minor 3":[3,1],"minor 6":[8,1],"minor 7":[10,1],"diminished 4":[4,1],"diminished 5":[6,1],"diminished 8":[11,1],"augmented 1":[1,1],"augmented 2":[3,1],"augmented 3":[5,1],"augmented 4":[6,1],"augmented 5":[8,1],"augmented 6":[10,1],"augmented 7":[12,1],"augmented 8":[13,1]},global.pitchToNumber=jest.fn(function(e,t){return 12*t+["C","D","E","F","G","A","B"].indexOf(e)}),global.numberToPitch=jest.fn(function(e){var t=Math.floor(e/12);return[["C","D","E","F","G","A","B"][e%12],t]}),global.numberToPitchSharp=jest.fn(function(e){var t=Math.floor(e/12);return[["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"][e%12],t]}),global.getNumber=jest.fn(function(e,t){return 12*t+["C","D","E","F","G","A","B"].indexOf(e)})}),it("should calculate major 2nd correctly",function(){expect(getNoteFromInterval("C4","major 2")).toEqual(["D",4]),expect(getNoteFromInterval("F4","major 2")).toEqual(["G",4])}),it("should calculate augmented intervals correctly",function(){expect(getNoteFromInterval("C4","augmented 4")).toEqual(["F♯",4]),expect(getNoteFromInterval("F4","augmented 5")).toEqual(["C♯",5])})}),describe("numberToPitch",function(){beforeEach(function(){global.PITCHES=["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"],global.TEMPERAMENT={equal:{pitchNumber:12,interval:["perfect 1","minor 2","major 2","minor 3","major 3","perfect 4","diminished 5","perfect 5","minor 6","major 6","minor 7","major 7"]},"just intonation":{pitchNumber:12,0:[1,"C",4],1:[16/15,"D♭",4],2:[9/8,"D",4],3:[1.2,"E♭",4],4:[5/4,"E",4],5:[4/3,"F",4],6:[45/32,"G♭",4],7:[1.5,"G",4],8:[1.6,"A♭",4],9:[5/3,"A",4],10:[1.8,"B♭",4],11:[15/8,"B",4]}},global.isCustomTemperament=jest.fn(function(e){return"equal"!==e&&e in global.TEMPERAMENT}),global.getNoteFromInterval=jest.fn(function(e,t){return["C",4]}),global.console.debug=jest.fn()}),it("should convert single-digit positive numbers",function(){expect(numberToPitch(0,"equal")).toEqual(["A",0]),expect(numberToPitch(1,"equal")).toEqual(["B♭",0])}),it("should handle octave transitions",function(){expect(numberToPitch(11,"equal")).toEqual(["A♭",1]),expect(numberToPitch(13,"equal")).toEqual(["B♭",1])}),it("should maintain correct ratios",function(){var e=numberToPitch(4,"just intonation","C4",0),t=numberToPitch(7,"just intonation","C4",0);expect(Array.isArray(e)).toBe(!0),expect(Array.isArray(t)).toBe(!0)})}),describe("GetNotesForInterval",function(){global.last=jest.fn(function(e){return e[e.length-1]}),it("should handle basic note status with two notes",function(){expect(GetNotesForInterval({singer:{noteStatus:[["C4","E4"]]}})).toEqual({firstNote:"C",secondNote:"E",octave:0})}),it("should handle note pitches with accidentals",function(){expect(GetNotesForInterval({singer:{noteStatus:null,notePitches:{1:["C♯","E♭"]},inNoteBlock:[1]}})).toEqual({firstNote:"C#",secondNote:"Eb",octave:0})}),it("should handle empty tur object",function(){expect(GetNotesForInterval({singer:{}})).toEqual({firstNote:"C",secondNote:"C",octave:0})})}),describe("base64Encode",function(){it("should handle empty string",function(){var e=base64Encode("");expect(e.length).toBe(0)}),it("should handle special characters and Unicode",function(){var e="¡Hola! 你好",t=base64Encode(e),o=(new TextEncoder).encode(e);expect(t.length).toBe(o.length);for(var n=0;n<o.length;n++)expect(t.charCodeAt(n)).toBe(o[n])})}),describe("getNote",function(){it("should return rest note",function(){expect(getNote("rest")).toEqual(["R","",0]),expect(getNote("r")).toEqual(["R","",0])}),it("should return the correct note for C4 in C major",function(){var e=getNote("C",4,0,"C major");expect(e).toEqual(["C",4,0])}),it("should return the correct note for C4 with transposition in C major",function(){var e=getNote("C",4,2,"C major");expect(e).toEqual(["D",4,0])}),it("should return the correct note for F4 in F major",function(){var e=getNote("F",4,0,"F major");expect(e).toEqual(["F",4,0])}),it("should return the correct note for F♯4 in F major",function(){var e=getNote("F♯",4,0,"F major");expect(e).toEqual(["F♯",4,0])}),it("should return the correct note for G♯4 in G major",function(){var e=getNote("G♯",4,0,"G major");expect(e).toEqual(["G♯",4,0])})}),describe("buildScale",function(){[{keySignature:"C♭ major",expected:[["C♭","D♭","E♭","F♭","G♭","A♭","B♭","C♭"],[2,2,1,2,2,2,1]]},{keySignature:"F♭ major",expected:[["F♭","G♭","A♭","B𝄫","C♭","D♭","E♭","F♭"],[2,2,1,2,2,2,1]]},{keySignature:"D major",expected:[["D","E","F♯","G","A","B","C♯","D"],[2,2,1,2,2,2,1]]},{keySignature:"C major",expected:[["C","D","E","F","G","A","B","C"],[2,2,1,2,2,2,1]]},{keySignature:"G major",expected:[["G","A","B","C","D","E","F♯","G"],[2,2,1,2,2,2,1]]},{keySignature:"A minor",expected:[["A","B","C","D","E","F","G","A"],[2,1,2,2,1,2,2]]},{keySignature:"F♯ major",expected:[["F♯","G♯","A♯","B","C♯","D♯","E♯","F♯"],[2,2,1,2,2,2,1]]},{keySignature:"Bb major",expected:[["B♭","C","D","E♭","F","G","A","B♭"],[2,2,1,2,2,2,1]]},{keySignature:"E major",expected:[["E","F♯","G♯","A","B","C♯","D♯","E"],[2,2,1,2,2,2,1]]}].forEach(function(e){var t=e.keySignature,o=e.expected;it("should return the correct scale and intervals for ".concat(t),function(){var e=buildScale(t);expect(e).toEqual(o)})}),it("should handle invalid key signatures gracefully",function(){var e=buildScale("");expect(e).toEqual([["C","D","E","F","G","A","B","C"],[2,2,1,2,2,2,1]])})}),describe("getStepSize",function(){it('should return the correct step size for "C" in "C major" going up',function(){var e=_getStepSize("C major","C","up",0,"equal");expect(e).toBe(2)}),it('should return the correct step size for "C" in "C major" going down',function(){var e=_getStepSize("C major","C","down",0,"equal");expect(e).toBe(-1)}),it('should return the correct step size for "F" in "F major" going up',function(){var e=_getStepSize("F major","F","up",0,"equal");expect(e).toBe(2)}),it('should return the correct step size for "F" in "F major" going down',function(){var e=_getStepSize("F major","F","down",0,"equal");expect(e).toBe(-1)}),it('should return the correct step size for "G" in "G major" going up',function(){var e=_getStepSize("G major","G","up",0,"equal");expect(e).toBe(2)}),it('should return the correct step size for "G" in "G major" going down',function(){var e=_getStepSize("G major","G","down",0,"equal");expect(e).toBe(-1)}),it('should return the correct step size for "F#" in "F# major" going up',function(){var e=_getStepSize("F# major","F#","up",0,"equal");expect(e).toBe(0)}),it('should return the correct step size for "G#" in "G# major" going down',function(){var e=_getStepSize("G# major","G#","down",0,"equal");expect(e).toBe(0)}),it('should return 0 for "C" going down in a key without a lower note',function(){var e=_getStepSize("C major","C","down",0,"equal");expect(e).toBe(-1)}),it("should return an error or appropriate value for invalid key signature",function(){var e=_getStepSize("Invalid key","C","up",0,"equal");expect(e).toBe(2)}),it('should return the correct step size for "C" in "C major" with a non-standard temperament',function(){var e=_getStepSize("C major","C","up",0,"just");expect(e).toBe(0)})}),describe("getModeLength",function(){it("should return length",function(){var e=getModeLength("");expect(e).toBe(7)}),it("should return length",function(){var e=getModeLength("E major");expect(e).toBe(7)})}),describe("nthDegreeToPitch",function(){it("should return the correct note for the 2nd scale degree in C major",function(){var e=nthDegreeToPitch("C major",2);expect(e).toBe("E")}),it("should handle a scale degree larger than the scale length (wrapping case)",function(){var e=nthDegreeToPitch("C major",8);expect(e).toBe("D")}),it("should return the root note for scale degree 0 in C major",function(){var e=nthDegreeToPitch("C major",0);expect(e).toBe("C")}),it("should return the correct note for the 5th scale degree in A minor",function(){var e=nthDegreeToPitch("A minor",5);expect(e).toBe("F")}),it("should handle negative scale degrees (reverse wrapping)",function(){var e=nthDegreeToPitch("C major",-1);expect(e).toBeUndefined()}),it("should return undefined for a scale degree when the scale is empty",function(){var e=nthDegreeToPitch("Unknown",2);expect(e).toBe("E")})}),describe("getInterval",function(){it("should return the correct interval for a pitch in the scale",function(){var e=getInterval(2,"C major","E");expect(e).toBe(3)}),it("should wrap around when pitch is not in the current scale",function(){var e=getInterval(5,"C major","B");expect(e).toBe(8)}),it("should return 0 for a pitch not found in equivalent mappings",function(){var e=getInterval(2,"C major","Z");expect(e).toBe(0)}),it("should correctly shift pitches up or down if they are not in the consonant scale",function(){var e=getInterval(1,"C major","B"),e=(expect(e).toBe(1),getInterval(-1,"C major","Cb"));expect(e).toBe(-2)})}),describe("reducedFraction",function(){global.NSYMBOLS={1:"𝅝",2:"𝅗𝅥",4:"♩",8:"♪",16:"𝅘𝅥𝅯"},it("should return reduced fraction with a common numerator and denominator",function(){expect(reducedFraction(4,8)).toBe("1<br>&mdash;<br>2<br>𝅗𝅥"),expect(reducedFraction(8,16)).toBe("1<br>&mdash;<br>2<br>𝅗𝅥")}),it("should return a fraction without symbols for non-standard denominators",function(){expect(reducedFraction(10,15)).toBe("2<br>&mdash;<br>3<br><br>"),expect(reducedFraction(25,50)).toBe("1<br>&mdash;<br>2<br>𝅗𝅥")}),it("should handle edge case where denominator is 0",function(){expect(reducedFraction(5,0)).toBe("1<br>&mdash;<br>0<br><br>")}),it("should handle positive and negative fractions correctly",function(){expect(reducedFraction(-4,8)).toBe("1<br>&mdash;<br>-2<br><br>"),expect(reducedFraction(5,-15)).toBe("1<br>&mdash;<br>-3<br><br>")})}),describe("toFraction",function(){it("should return array with numerator and denomrator from floating point number",function(){expect(toFraction(2.2)).toEqual([11,5]),expect(toFraction(.1)).toEqual([1,10])}),it("should return array with numerator and denomrator from floating point number",function(){expect(toFraction(0)).toEqual([0,2])})}),describe("calcNoteValueToDisplay",function(){global.NSYMBOLS={1:"𝅝",2:"𝅗𝅥",4:"♩",8:"♪",16:"𝅘𝅥𝅯"},it("should return a note value with a symbol when the note value is in NSYMBOLS",function(){var e=calcNoteValueToDisplay(1,2);expect(e).toBe("2<br>&mdash;<br>1<br>𝅝")}),it("should return a reduced fraction when note value is not in NSYMBOLS",function(){var e=calcNoteValueToDisplay(3,4);expect(e).toBe("4<br>&mdash;<br>3<br>𝅝.")}),it("should handle note values with fractional components and display them correctly",function(){var e=calcNoteValueToDisplay(1,3);expect(e).toBe("3<br>&mdash;<br>1<br>𝅝")}),it("should handle cases where note value cannot be found in NSYMBOLS and returns a reduced fraction",function(){var e=calcNoteValueToDisplay(5,6);expect(e).toBe("6<br>&mdash;<br>5<br>𝅝.")}),it("should return a note value with a symbol for valid inputs that map to an NSYMBOL",function(){var e=calcNoteValueToDisplay(8,8);expect(e).toBe("1<br>&mdash;<br>1<br>𝅝")}),it("should handle larger numerators and denominators properly",function(){var e=calcNoteValueToDisplay(100,200);expect(e).toBe("2<br>&mdash;<br>1<br>𝅝")}),it("should handle when enter 0 as a parameter",function(){expect(calcNoteValueToDisplay(1,0)).toBe("0<br>&mdash;<br>1<br>𝅝")})}),describe("durationToNoteValue",function(){global.POWER2=[1,2,4,8,16,32,64,128],it("should correctly convert a duration to a note value with no dots",function(){var e=durationToNoteValue(1);expect(e).toEqual([1,0,null])}),it("should correctly convert a duration to a note value with one dot",function(){var e=durationToNoteValue(1.5);expect(e).toEqual([1,0,[3,.5],1])}),it("should correctly convert a duration to a note value with two dots",function(){var e=durationToNoteValue(1.75);expect(e).toEqual([1,0,[3.5,.5],1])}),it("should round down durations that do not match exact note values in POWER2",function(){var e=durationToNoteValue(.3);expect(e).toEqual([1,0,[.6,.5],1])}),it("should correctly return the note value for durations in POWER2",function(){var e=durationToNoteValue(2);expect(e).toEqual([2,0,null])}),it("should return the default rounded value for durations without an exact tuplet factor",function(){var e=durationToNoteValue(.5);expect(e).toEqual([1,0,[1,.5],1])})}),describe("noteToPitchOctave",function(){it("should correctly extract pitch and octave from a note string with a single character",function(){var e=noteToPitchOctave("C4");expect(e).toEqual(["C",4])}),it("should correctly extract pitch and octave from a note string with a sharp note",function(){var e=noteToPitchOctave("C#5");expect(e).toEqual(["C#",5])}),it("should correctly extract pitch and octave from a note string with a flat note",function(){var e=noteToPitchOctave("Db6");expect(e).toEqual(["Db",6])}),it("should correctly handle a note string with a lowercase pitch",function(){var e=noteToPitchOctave("g3");expect(e).toEqual(["g",3])}),it("should handle multi-character note names with no octave",function(){var e=noteToPitchOctave("B#");expect(e).toEqual(["B",NaN])})}),describe("pitchToFrequency",function(){global.TWELTHROOT2=1.0594630943592953,global.TWELVEHUNDRETHROOT2=1.0005777895065548,global.A0=27.5,it("calculates frequency with 0 cents",function(){var e=pitchToFrequency("A",4,0,"C");expect(e).toBe(A0*Math.pow(TWELTHROOT2,48))}),it("calculates frequency with non-zero cents",function(){var e=pitchToFrequency("A",4,50,"C");expect(e).toBe(A0*Math.pow(TWELVEHUNDRETHROOT2,4850))}),it("handles edge case with extreme pitch number",function(){var e=pitchToFrequency("C",8,0,"C");expect(e).toBe(A0*Math.pow(TWELTHROOT2,87))}),it("throws error if pitchToNumber fails",function(){expect(pitchToFrequency("Z",4,0,"C")).toBe(A0*Math.pow(TWELTHROOT2,39))})}),describe("noteToFrequency",function(){global.TWELTHROOT2=1.0594630943592953,global.TWELVEHUNDRETHROOT2=1.0005777895065548,global.A0=27.5,it("converts note to frequency correctly",function(){var e=noteToFrequency("A4","C");expect(e).toBe(A0*Math.pow(TWELTHROOT2,48))}),it("handles invalid note input gracefully",function(){expect(noteToFrequency("X9","C")).toBe(A0*Math.pow(TWELTHROOT2,99))})}),describe("noteIsSolfege",function(){global.SOLFEGECONVERSIONTABLE={"C♭":"do♭",C:"do","C♯":"do♯","D♭":"re♭",D:"re","D♯":"re♯","E♭":"mi♭",E:"mi",F:"fa","F♯":"fa♯","G♭":"sol♭",G:"sol","G♯":"sol♯","A♭":"la♭",A:"la","A♯":"la♯","B♭":"ti♭",B:"ti","B♯":"ti♯",R:_("rest")},it("should return false for standard note without solfege conversion",function(){expect(noteIsSolfege("C")).toBe(!1)}),it("should return false for a rest note",function(){expect(noteIsSolfege("R")).toBe(!1)}),it("should return true for a note with an unrecognized sharp (e.g., E♯)",function(){expect(noteIsSolfege("E♯")).toBe(!0)})}),describe("getSolfege",function(){}),describe("getSolfege",function(){global.SOLFEGECONVERSIONTABLE={"C♭":"do♭",C:"do","C♯":"do♯","D♭":"re♭",D:"re","D♯":"re♯","E♭":"mi♭",E:"mi",F:"fa","F♯":"fa♯","G♭":"sol♭",G:"sol","G♯":"sol♯","A♭":"la♭",A:"la","A♯":"la♯","B♭":"ti♭",B:"ti","B♯":"ti♯",R:_("rest")},it("should return the note itself if it is already a solfege note",function(){expect(getSolfege("C")).toBe("do"),expect(getSolfege("R")).toBe("rest")}),it("should return the correct solfege for standard notes",function(){expect(getSolfege("C♭")).toBe("do♭"),expect(getSolfege("D")).toBe("re")}),it("should return the correct solfege for sharp and flat notes",function(){expect(getSolfege("G♯")).toBe("sol♯"),expect(getSolfege("A♯")).toBe("la♯")}),it("should return undefined for invalid notes not present in the conversion table",function(){expect(getSolfege("X")).toBe("X")})}),describe("splitSolfege",function(){global.SOLFNOTES=["ti","la","sol","fa","mi","re","do"],it("should correctly split solfege notes without attributes",function(){expect(splitSolfege("do")).toEqual(["do",""]),expect(splitSolfege("la")).toEqual(["la",""]),expect(splitSolfege("ti")).toEqual(["ti",""])}),it("should correctly split solfege notes with sharp (♯) or flat (♭) attributes",function(){expect(splitSolfege("do♯")).toEqual(["do","♯"]),expect(splitSolfege("ti♯")).toEqual(["ti","♯"]),expect(splitSolfege("do♭")).toEqual(["do","♭"])}),it("should correctly handle solfege with compound attributes (e.g., 'sol♯♯')",function(){expect(splitSolfege("sol♯♯")).toEqual(["sol","♯♯"]),expect(splitSolfege("do♯♯")).toEqual(["do","♯♯"])}),it("should return ['sol', ''] if input is null or not a valid string",function(){expect(splitSolfege(null)).toEqual(["sol",""]),expect(splitSolfege(void 0)).toEqual(["sol",""]),expect(splitSolfege(123)).toEqual(["sol",""]),expect(splitSolfege({})).toEqual(["sol",""])})}),describe("i18nSolfege",function(){global.SOLFNOTES=["ti","la","sol","fa","mi","re","do"],it("should return the internationalized version of a solfege note",function(){expect(i18nSolfege("do")).toEqual("do"),expect(i18nSolfege("ti")).toEqual("ti")}),it("should return internationalized solfege notes with attributes",function(){expect(i18nSolfege("do♯")).toEqual("do♯"),expect(i18nSolfege("ti♭")).toEqual("ti♭")}),it("should return the same note if it's not a valid solfege note",function(){expect(i18nSolfege("C♯")).toEqual("C♯"),expect(i18nSolfege("G")).toEqual("G"),expect(i18nSolfege("B♭")).toEqual("B♭"),expect(i18nSolfege("R")).toEqual("R")}),it("should handle null or undefined values gracefully",function(){expect(i18nSolfege(null)).toEqual("sol")})}),describe("splitScaleDegree",function(){global.NATURAL="♮",it("should split a scale degree into note and attributes",function(){expect(splitScaleDegree("C")).toEqual(["C",""]),expect(splitScaleDegree("C♯")).toEqual(["C","♯"]),expect(splitScaleDegree("B♭")).toEqual(["B","♭"])}),it("should return default natural attribute when no attributes are provided",function(){expect(splitScaleDegree("")).toEqual([5,NATURAL]),expect(splitScaleDegree(null)).toEqual([5,NATURAL])}),it("should handle invalid or undefined inputs gracefully",function(){expect(splitScaleDegree(void 0)).toEqual([5,NATURAL]),expect(splitScaleDegree("")).toEqual([5,NATURAL])})}),describe("getNumNote",function(){global.NOTESTABLE={1:"do",2:"do♯",3:"re",4:"re♯",5:"mi",6:"fa",7:"fa♯",8:"sol",9:"sol♯",10:"la",11:"la♯",0:"ti"},it("should correctly convert a value to a note and octave",function(){expect(getNumNote(7,0)).toEqual(["fa♯",1]),expect(getNumNote(9,0)).toEqual(["sol♯",1]),expect(getNumNote(8,1)).toEqual(["sol♯",1]),expect(getNumNote(13,1)).toEqual(["do♯",2])})}),describe("calcOctave",function(){global.SOLFEGENAMES1=["do","do♯","do𝄪","re𝄫","re♭","re","re♯","re𝄪","mi𝄫","mi♭","mi","fa","fa♯","fa𝄪","sol𝄫","sol♭","sol","sol♯","sol𝄪","la","la𝄫","la♭","la♯","la𝄪","ti𝄫","ti♭","ti"],global.FIXEDSOLFEGE1={"do𝄫":"B","do♭":"C♭",do:"C","do♯":"C♯","do𝄪":"D","re𝄫":"C","re♭":"D♭",re:"D","re♯":"D♯","re𝄪":"E","mi𝄫":"D","mi♭":"E♭",mi:"E","mi♯":"E♯","mi𝄪":"G","fa𝄫":"E♭","fa♭":"F♭",fa:"F","fa♯":"F♯","fa𝄪":"G♯","sol𝄫":"E","sol♭":"G♭",sol:"G","sol♯":"G♯","sol𝄪":"A","la𝄫":"G","la♭":"A♭",la:"A","la♯":"A♯","la𝄪":"B","ti𝄫":"A","ti♭":"B♭",ti:"B","ti♯":"B♯","ti𝄪":"C",R:_("rest")},it("should return correct octave for a numeric argument",function(){expect(calcOctave(4,5,null,"C")).toBe(5)}),it("should return correct octave based on currentNote and lastNotePlayed",function(){expect(calcOctave(4,"next",["C"],"C")).toBe(5),expect(calcOctave(4,"next",["C"],"D")).toBe(5),expect(calcOctave(4,"previous",["C"],"D")).toBe(3)}),it("should correctly calculate octave based on half-steps between notes",function(){expect(calcOctave(4,"current",["C"],"G")).toBe(3),expect(calcOctave(4,"next",["C"],"B")).toBe(4),expect(calcOctave(4,"previous",["C"],"A")).toBe(2)}),it("should be able to handle default case",function(){expect(calcOctave(4,"default",["do"],"do")).toBe(4)})}),describe("calcOctaveInterval",function(){it("should return correct octave value for argument 'next'",function(){expect(calcOctaveInterval("next")).toBe(1),expect(calcOctaveInterval(_("next"))).toBe(1)}),it("should return correct octave value for argument 'previous'",function(){expect(calcOctaveInterval("previous")).toBe(-1),expect(calcOctaveInterval(_("previous"))).toBe(-1)}),it("should return correct octave value for argument 'current'",function(){expect(calcOctaveInterval("current")).toBe(0),expect(calcOctaveInterval(_("current"))).toBe(0)}),it("should return correct octave value for numeric arguments",function(){expect(calcOctaveInterval(1)).toBe(1),expect(calcOctaveInterval(0)).toBe(0),expect(calcOctaveInterval(-1)).toBe(-1),expect(calcOctaveInterval(2)).toBe(2),expect(calcOctaveInterval(-2)).toBe(-2)}),it("should return default value of 0 for invalid or undefined arguments",function(){expect(calcOctaveInterval(void 0)).toBe(0),expect(calcOctaveInterval(null)).toBe(0),expect(calcOctaveInterval("invalid")).toBe(0)})}),describe("isInt",function(){it("should return true for integer values",function(){expect(isInt(1)).toBe(!0),expect(isInt(-10)).toBe(!0),expect(isInt(123456)).toBe(!0)}),it("should return false for non-integer values",function(){expect(isInt(1.23)).toBe(!1),expect(isInt(-.56)).toBe(!1),expect(isInt("abc")).toBe(!1)}),it("should return false for NaN",function(){expect(isInt(NaN)).toBe(!1)}),it("should return false for numeric strings",function(){expect(isInt("1")).toBe(!1),expect(isInt("-10")).toBe(!1)})}),describe("convertFromSolfege",function(){global.FIXEDSOLFEGE1={"do𝄫":"B","do♭":"C♭",do:"C","do♯":"C♯","do𝄪":"D","re𝄫":"C","re♭":"D♭",re:"D","re♯":"D♯","re𝄪":"E","mi𝄫":"D","mi♭":"E♭",mi:"E","mi♯":"E♯","mi𝄪":"G","fa𝄫":"E♭","fa♭":"F♭",fa:"F","fa♯":"F♯","fa𝄪":"G♯","sol𝄫":"E","sol♭":"G♭",sol:"G","sol♯":"G♯","sol𝄪":"A","la𝄫":"G","la♭":"A♭",la:"A","la♯":"A♯","la𝄪":"B","ti𝄫":"A","ti♭":"B♭",ti:"B","ti♯":"B♯","ti𝄪":"C",R:_("rest")},global.EQUIVALENTNATURALS={"E♯":"F","B♯":"C","C♭":"B","F♭":"E"},[{input:"do𝄫",expected:"B"},{input:"do♭",expected:"B"},{input:"do♯",expected:"C♯"},{input:"re♯",expected:"D♯"},{input:"E♯",expected:"F"},{input:"R",expected:_("rest")}].forEach(function(e){var t=e.input,o=e.expected;it("should convert ".concat(t," to ").concat(o),function(){expect(convertFromSolfege(t)).toBe(o)})}),it("should return the input if no conversion is available",function(){expect(convertFromSolfege("X")).toBe("X")})}),describe("convertFactor",function(){[{input:.0625,expected:"16"},{input:.125,expected:"8"},{input:.09375,expected:"16."},{input:.1875,expected:"8."},{input:.21875,expected:"8.."},{input:.25,expected:"4"},{input:.3125,expected:"4 16"},{input:.375,expected:"4."},{input:.4375,expected:"4.."},{input:.5,expected:"2"},{input:.5625,expected:"2 16"},{input:.675,expected:"2 8"},{input:.6875,expected:"2 8 16"},{input:.75,expected:"2."},{input:.8125,expected:"2 4 16"},{input:.875,expected:"2.."},{input:.9375,expected:"2 4 8 16"},{input:1,expected:"1"}].forEach(function(e){var t=e.input,o=e.expected;it('should return "'.concat(o,'" for ').concat(t),function(){expect(convertFactor(t)).toBe(o)})}),it("should return null for unknown factors",function(){expect(convertFactor(0)).toBeNull(),expect(convertFactor("string")).toBeNull()})}),describe("scaleDegreeToPitchMapping",function(){it("maps scale degree to pitch with movable do",function(){var e=scaleDegreeToPitchMapping("C major",1,!0,null);expect(e).toBe("C")}),it("maps pitch to scale degree with movable do",function(){var e=scaleDegreeToPitchMapping("C major",null,!0,"C");expect(e).toEqual(["1","♮","8","♮"])}),it("maps scale degree to pitch in a chosen mode",function(){var e=scaleDegreeToPitchMapping("D minior",2,!1,null);expect(e).toBe("E")}),it("maps pitch to scale degree in a chosen mode",function(){var e=scaleDegreeToPitchMapping("D",null,!1,"E");expect(e).toEqual(["2","♮"])}),it("handles invalid pitch input gracefully",function(){var e=scaleDegreeToPitchMapping("C major",null,!0,"Z");expect(e).toEqual([])}),it("handles undefined scale degree gracefully",function(){var e=scaleDegreeToPitchMapping("C major",10,!1,null);expect(e).toBeUndefined()}),it("handles fallback to major scale for incomplete modes",function(){var e=scaleDegreeToPitchMapping("A minor",5,!1,null);expect(e).toBe("E")}),it("handles edge cases for pitch alterations",function(){var e=scaleDegreeToPitchMapping("C major",null,!1,"C#");expect(e).toEqual(["1","8"])})});
describe("platformstyle",function(){function o(){jest.isolateModules(function(){require("../platformstyle")}),t=require("../platformstyle").showButtonHighlight}function l(){var e=document.createElement("meta");e.name="theme-color",document.head.appendChild(e)}var t;beforeEach(function(){jest.resetModules(),document.head.innerHTML="",global.showMaterialHighlight=jest.fn(function(){return{highlight:!0}}),delete global.window.platform,delete global.window.platformColor}),it("initializes platform color preference with default theme",function(){Object.defineProperty(global.window.navigator,"userAgent",{value:"Mozilla/5.0 (Macintosh; Intel Mac OS X)",configurable:!0,writable:!0}),global.navigator=global.window.navigator,global.localStorage={},global.window.navigator=global.navigator,global.window.localStorage=global.localStorage,l(),o(),expect(global.window.platformColor.header).toBe("#4DA6FF"),expect(document.querySelector("meta[name=theme-color]").content).toBe("#4DA6FF"),expect(global.window.platform.FFOS).toBe(!1)}),it("honors dark theme preference",function(){Object.defineProperty(global.window.navigator,"userAgent",{value:"Chrome/123",configurable:!0,writable:!0}),global.navigator=global.window.navigator;var e=global.window.localStorage||{};e.themePreference="dark",global.localStorage=e,global.window.localStorage=e,global.window.navigator=global.navigator,l(),o(),expect(global.window.platformColor.header).toBe("#1E88E5"),expect(document.querySelector("meta[name=theme-color]").content).toBe("#1E88E5")}),it("skips material highlight when running on Firefox OS",function(){Object.defineProperty(global.window.navigator,"userAgent",{value:"Firefox Mobi",configurable:!0,writable:!0}),global.navigator=global.window.navigator;var e=global.window.localStorage||{},e=(global.localStorage=e,global.window.localStorage=e,l(),o(),global.window.navigator.userAgent),e=/Firefox/i.test(e)&&(/Mobi/i.test(e)||/Tablet/i.test(e))&&!/Android/i.test(e);expect(global.window.platform.FFOS).toBe(e)}),it("delegates to material highlight when not on FFOS",function(){Object.defineProperty(global.window.navigator,"userAgent",{value:"Chrome/123",configurable:!0,writable:!0}),global.navigator=global.window.navigator,l(),o();var e=t(1,2,3,{type:"click"},1,{});expect(e).toEqual({highlight:!0}),expect(global.showMaterialHighlight).toHaveBeenCalledWith(1,2,3,{type:"click"},1,{})}),it("returns empty highlight when FFOS",function(){Object.defineProperty(global.window.navigator,"userAgent",{value:"Firefox Mobi",configurable:!0,writable:!0}),global.navigator=global.window.navigator,l(),o(),global.window.platform.FFOS=!0;var e=t(0,0,0,{},1,{});expect(e).toEqual({}),expect(global.showMaterialHighlight).not.toHaveBeenCalled()})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _regenerator(){var h,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function o(e,t,n,o){var r,i,a,u,s,c,l,f,p,t=t&&t.prototype instanceof y?t:y,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(r=e,i=n,l=o||[],f=!1,p={p:c=0,n:0,v:h,a:d,f:d.bind(h,4),d:function(e,t){return a=e,u=0,s=h,p.n=t,m}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(f&&1===t&&d(t,n),u=t,s=n;(g=u<2?h:s)||!f;){a||(u?u<3?(1<u&&(p.n=-1),d(u,s)):p.n=s:p.v=s);try{if(c=2,a){if(g=a[e=u?e:"next"]){if(!(g=g.call(a,s)))throw TypeError("iterator result is not an object");if(!g.done)return g;s=g.value,u<2&&(u=0)}else 1===u&&(g=a.return)&&g.call(a),u<2&&(s=TypeError("The iterator does not provide a '"+e+"' method"),u=1);a=h}else if((g=(f=p.n<0)?s:r.call(i,p))!==m)break}catch(e){a=h,u=1,s=e}finally{c=1}}return{value:g,done:f}}),!0),t;function d(e,t){for(u=e,s=t,g=0;!f&&c&&!n&&g<l.length;g++){var n,o=l[g],r=p.p,i=o[2];3<e?(n=i===t)&&(s=o[(u=o[4])?5:u=3],o[4]=o[5]=h):o[0]<=r&&((n=e<2&&r<o[1])?(u=0,p.v=t,p.n=o[1]):r<i&&(n=e<3||o[0]>t||i<t)&&(o[4]=e,o[5]=t,p.n=i,u=0))}if(n||1<e)return m;throw f=!0,t}}var m={};function y(){}function r(){}function i(){}var g=Object.getPrototypeOf,e=[][t]?g(g([][t]())):(_regeneratorDefine2(g={},t,function(){return this}),g),a=i.prototype=y.prototype=Object.create(e);function u(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",r.prototype=i),_regeneratorDefine2(i,"constructor",r),_regeneratorDefine2(i,n,r.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,n,"Generator"),_regeneratorDefine2(a,t,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:u}})()}function _regeneratorDefine2(e,t,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,t,n,o){function r(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))})(e,t,n,o)}function asyncGeneratorStep(e,t,n,o,r,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(o,r)}function _asyncToGenerator(u){return function(){var e=this,a=arguments;return new Promise(function(t,n){var o=u.apply(e,a);function r(e){asyncGeneratorStep(o,t,n,r,i,"next",e)}function i(e){asyncGeneratorStep(o,t,n,r,i,"throw",e)}r(void 0)})}}var fs=require("fs"),path=require("path"),_require=require("util"),TextEncoder=_require.TextEncoder,TextDecoder=_require.TextDecoder;jest.mock("tone"),describe("Utility Functions (logic-only)",function(){var o,r,i,a,u,s,c,l,f,p,d,h,m,y,g,v,T,b,x,S,B,_,C,w,j,O,E,D,A,P,q,H,M,k="turtle1";beforeAll(function(){global.TextEncoder=TextEncoder,global.TextDecoder=TextDecoder,global.MediaRecorder=jest.fn(),global.AudioBuffer=jest.fn(),global.module=module,global.Tone=require("./tonemock.js");var t="",n=(["../../../lib/require.js","../platformstyle.js","../musicutils.js","../synthutils.js","../utils.js","../../logo.js","../../turtle-singer.js"].forEach(function(e){e=fs.readFileSync(path.join(__dirname,e),"utf8");t+="\n".concat(e)}),path.join(__dirname,"../../../sounds/samples"));fs.readdirSync(n,"utf8").forEach(function(e){e.endsWith(".js")&&(e=path.join(n,e),e=fs.readFileSync(e,"utf8"),t+="\n".concat(e))});var e=new Function("\n            let metaTag = document.querySelector(\"meta[name=theme-color]\");\n            metaTag = document.createElement('meta');\n            metaTag.name = 'theme-color';\n            metaTag.content = \"#4DA6FF\";\n            document.head?.appendChild(metaTag);\n            ".concat(t,'\n            \n            return {\n                Synth: typeof Synth !== "undefined" ? Synth : undefined,\n                instrumentsSource: typeof instrumentsSource !== "undefined" ? instrumentsSource : undefined,\n                instruments: typeof instruments !== "undefined" ? instruments : undefined,\n                SAMPLECENTERNO: typeof SAMPLECENTERNO !== "undefined" ? SAMPLECENTERNO : undefined,\n                CUSTOMSAMPLES: typeof CUSTOMSAMPLES !== "undefined" ? CUSTOMSAMPLES : undefined,\n                DEFAULTSYNTHVOLUME: typeof DEFAULTSYNTHVOLUME !== "undefined" ? DEFAULTSYNTHVOLUME : undefined,\n                  };\n        '))();M=e.Synth(),S=e.instruments,A=e.DEFAULTSYNTHVOLUME,B=e.CUSTOMSAMPLES,SAMPLECENTERNO=e.SAMPLECENTERNO,_=e.instrumentsSource,d=M.createDefaultSynth,o=M.whichTemperament,r=M.temperamentChanged,i=M.getFrequency,a=M._getFrequency,u=M.getCustomFrequency,s=M.resume,c=M.loadSamples,l=M._loadSample,f=M.setupRecorder,p=M.getDefaultParamValues,h=M._createSampleSynth,m=M._parseSampleCenterNo,y=M._createBuiltinSynth,g=M._createCustomSynth,v=M.__createSynth,T=M.createSynth,b=M.loadSynth,x=M.startSound,C=M.trigger,w=M.stopSound,j=M.loop,O=M.start,E=M.stop,D=M.rampTo,P=M.setVolume,q=M.getVolume,H=M.setMasterVolume}),describe("setupRecorder",function(){it("it should sets up the recorder for the Synth instance.",function(){for(var e in S[k]||(S[k]={}),expect(f()).toBe(void 0),S)for(var t in S[e])expect((t=S[e][t])instanceof Tone.PolySynth||t instanceof Tone.Sampler||t instanceof Tone.Player).toBe(!0)})}),describe("createDefaultSynth",function(){it("it should create the default poly/default/custom synth for the specified turtle",function(){d(k),expect(S[k]["electronic synth"]).toBeTruthy(),expect(S[k].custom).toBeTruthy(),expect(_["electronic synth"]).toEqual([0,"electronic synth"]),expect(_.custom).toEqual([0,"custom"])})}),describe("_createBuiltinSynth",function(){it("it should create a synth using builtin synths from Tone.js.",function(){var e=y(k,"guitar","sine",{});expect(e).toBeInstanceOf(Tone.Synth)}),it("it should create a synth using builtin synths from Tone.js.",function(){var e=y(k,"guitar","pluck",{});expect(e).toBeInstanceOf(Tone.PluckSynth)}),it("it should create a synth using builtin synths from Tone.js.",function(){var e=y(k,"guitar","noise3",{});expect(e).toBeInstanceOf(Tone.NoiseSynth)})}),describe("_createCustomSynth",function(){it("it should create an amsynth using Tone.js methods like AMSynth, FMSynth, etc.",function(){var e=g("amsynth",{});expect(e).toBeInstanceOf(Tone.AMSynth)}),it("it should create a fmsynth using Tone.js methods like AMSynth, FMSynth, etc.",function(){var e=g("fmsynth",{});expect(e).toBeInstanceOf(Tone.FMSynth)}),it("it should create a duosynth using Tone.js methods like AMSynth, FMSynth, etc.",function(){var e=g("duosynth",{});expect(e).toBeInstanceOf(Tone.DuoSynth)}),it("it should create a testsynth using Tone.js methods like AMSynth, FMSynth, etc.",function(){var e=g("testsynth",{});expect(e).toBeInstanceOf(Tone.PolySynth)})}),describe("__createSynth",function(){beforeAll(function(){c()}),it("it should create a PolySynth based on the specified parameters, either using samples, built-in synths, or custom synths",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,v(k,"test-instrument","sine",{});case 1:expect(S[k]["electronic synth"]).toBeInstanceOf(Tone.PolySynth);case 2:return e.a(2)}},e)}))),it("it should create a PolySynth based on the specified parameters, either using samples, built-in synths, or custom synths",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,v(k,"guitar","sine",{});case 1:expect(S[k]["electronic synth"]).toBeInstanceOf(Tone.PolySynth);case 2:return e.a(2)}},e)}))),it("it should create a amsynth based on the specified parameters, either using samples, built-in synths, or custom synths",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t="poly",e.n=1,v(k,t,"amsynth",{});case 1:expect(S[k][t]).toBeInstanceOf(Tone.AMSynth);case 2:return e.a(2)}},e)}))),it("it should create a CUSTOMSAMPLES based on the specified parameters, either using samples, built-in synths, or custom synths",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return B.pianoC4="pianoC4",B.drumKick="drumKick",t="piano",e.n=1,v(k,t,"pianoC4",{});case 1:expect(S[k][t]).toBeInstanceOf(Tone.Sampler);case 2:return e.a(2)}},e)}))),it("it should create a CUSTOMSAMPLES based on the specified parameters, either using samples, built-in synths, or custom synths",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t="drumKick",n="http://example.com/drumKick.wav",e.n=1,v(k,t,n,{});case 1:expect(S[k][n].noteDict).toBe(n),expect(_[t]).toStrictEqual([1,"drum"]);case 2:return e.a(2)}},e)}))),it("it should create a CUSTOMSAMPLES based on the specified parameters, either using samples, built-in synths, or custom synths",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t="guitar",n="file://testing.wav",e.n=1,v(k,t,n,{});case 1:expect(S[k][n].noteDict).toBe(n),expect(_[t]).toStrictEqual([1,"drum"]);case 2:return e.a(2)}},e)}))),it("it should create a CUSTOMSAMPLES based on the specified parameters, either using samples, built-in synths, or custom synths",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t="snare drum",e.n=1,v(k,t,"drum",{});case 1:expect(_[t]).toStrictEqual([1,"drum"]);case 2:return e.a(2)}},e)})))}),describe("loadSynth",function(){it("it should loads a synth based on the user's input, creating and setting volume for the specified turtle.",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,b("turtle1","sine");case 1:t=e.v,expect(t).toBeTruthy(),expect(S.turtle1).toHaveProperty("sine");case 2:return e.a(2)}},e)})))}),describe("trigger",function(){var r="turtle1";test("should process effect parameters correctly",function(){S[r].guitar||(S[r].guitar={triggerAttackRelease:jest.fn()}),C(r,"C4",1,"guitar",{vibratoIntensity:1,distortionAmount:.5,tremoloFrequency:2,rate:1,chorusRate:1.5,neighborSynth:!0},null,!0,0)}),test("should ignore effects for basic waveform instruments",function(){var t=jest.fn(),n=function(e,t,n,o,r,i,a,u){this._performNotes&&this._performNotes(e,t,n,r,i,a,u)}.bind({_performNotes:t}),o={vibratoIntensity:1};["sine","sawtooth","triangle","square"].forEach(function(e){n(r,"C4",1,e,o,null,!0,0),expect(t).toHaveBeenCalledWith(r,"C4",1,{vibratoIntensity:1},null,!0,0)})}),test("should handle array of notes for builtin synth",function(){var e=["C4","E4","G4"],t=jest.fn();(function(e,t,n,o,r,i,a,u){this._performNotes&&this._performNotes(e,t,n,r,i,a,u)}).bind({_performNotes:t})(r,e,1,"builtin",null,null,!0,0),expect(t).toHaveBeenCalledWith("turtle1",e,1,null,null,!0,0)})}),describe("temperamentChanged",function(){it("should change the temperament",function(){expect(r("equal","Bb3")).toBe(void 0),expect(o()).toBe("equal")})}),describe("resume",function(){it("it should resume the Tone.js context",function(){expect(s()).toBe(void 0),expect(Tone).toStrictEqual(Tone)})}),describe("rampTo",function(){it("it should resume the Tone.js context",function(){expect(s()).toBe(void 0),expect(Tone).toStrictEqual(Tone)})}),describe("rampTo function",function(){beforeAll(_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:S.turtle1||(S.turtle1={}),S.turtle1.flute||(S.turtle1.flute=new Tone.Sampler);case 1:return e.a(2)}},e)}))),test("should ramp the volume for non-percussion and non-string instruments",function(){D("turtle1","flute",20,60,5),expect(Tone.gainToDb).toHaveBeenCalledWith(.92),expect(Tone.now).toHaveBeenCalled(),expect(S.turtle1.flute.volume.linearRampToValueAtTime).toHaveBeenCalledWith(4,expect.any(Number))}),test("should not ramp the volume for percussion instruments",function(){D("turtle1","xylophone",20,60,5),expect(Tone.gainToDb).not.toHaveBeenCalled(),expect(S.turtle1.flute.volume.linearRampToValueAtTime).not.toHaveBeenCalled()})}),describe("setVolume function",function(){beforeAll(function(){S.turtle1||(S.turtle1={}),S.turtle1.flute||(S.turtle1.flute=new Tone.Sampler)}),test("should set the volume for an instrument using DEFAULTSYNTHVOLUME",function(){P("turtle1","flute",80);var e=A.piano,e=Tone.gainToDb((.6*(100-e)+e)/100);expect(Tone.gainToDb).toHaveBeenCalledWith(.96),expect(S.turtle1.flute.volume.value).toBe(e)}),test("should set the volume directly if instrument is not in DEFAULTSYNTHVOLUME",function(){P("turtle1","unknown",70);var e=Tone.gainToDb(.7);expect(Tone.gainToDb).toHaveBeenCalledWith(.7),expect(S.turtle1.flute.volume.value).toBe(e)}),test("should not throw error if instrument is not found in turtle",function(){expect(function(){return P("turtle1","nonexistent",50)}).not.toThrow()})}),describe("getVolume function",function(){beforeAll(function(){S.turtle1||(S.turtle1={}),S.turtle1.flute||(S.turtle1.flute=new Tone.Sampler)}),beforeEach(function(){jest.clearAllMocks()}),test("should return the volume for a defined instrument",function(){S.turtle1.flute.volume.value=-10;var e=q("turtle1","flute");expect(e).toBe(-10)}),test("should return default volume if instrument is not found",function(){var e=jest.spyOn(console,"debug").mockImplementation(function(){}),t=q("turtle1","nonexistent");expect(t).toBe(50),expect(e).toHaveBeenCalledWith("instrument not found"),e.mockRestore()})}),describe("setMasterVolume function",function(){test("should set the master volume correctly",function(){H(75);var e=Tone.gainToDb(.75);expect(Tone.gainToDb).toHaveBeenCalledWith(.75),expect(Tone.Destination.volume.rampTo).toHaveBeenCalledWith(e,.01)}),test("should handle edge case with volume set to 0 with connections",function(){H(0,87,64);var e=Tone.gainToDb(0);expect(Tone.gainToDb).toHaveBeenCalledWith(0),expect(Tone.Destination.volume.rampTo).toHaveBeenCalledWith(e,.01)}),test("should handle edge case with volume set to 100 with connections",function(){H(100,87,64);var e=Tone.gainToDb(1);expect(Tone.gainToDb).toHaveBeenCalledWith(1),expect(Tone.Destination.volume.rampTo).toHaveBeenCalledWith(e,.01)})}),describe("startSound",function(){var t="turtle1";beforeAll(function(){S.turtle1||(S.turtle1={}),S.turtle1.flute||(S.turtle1.flute=new Tone.Sampler),S.turtle1.guitar||(S.turtle1.guitar=new Tone.Sampler),_.flute=[0,"voice"],_.guitar=[1,"drum"]}),test("should call start() for drum instruments",function(){var e="guitar";x(t,e,"C4"),expect(S[t][e].start).toHaveBeenCalledTimes(1),expect(S[t][e].triggerAttack).not.toHaveBeenCalled()}),test("should call triggerAttack() for non-drum instruments",function(){var e="flute";x(t,e,"C4"),expect(S[t][e].triggerAttack).toHaveBeenCalledWith("C4"),expect(S[t][e].start).not.toHaveBeenCalled()}),test("should handle undefined instrument gracefully",function(){expect(function(){return x(t,"nonexistent","C4")}).toThrow()}),test("should handle undefined turtle gracefully",function(){expect(function(){return x("nonexistentTurtle","piano","C4")}).toThrow()})}),describe("stopSound",function(){var t="turtle1";beforeAll(function(){S.turtle1||(S.turtle1={}),S.turtle1.flute||(S.turtle1.flute=new Tone.Sampler),S.turtle1.guitar||(S.turtle1.guitar=new Tone.Sampler),_.flute=[0,"voice"],_.guitar=[1,"drum"]}),test("should call stop() for drum instruments",function(){var e="guitar";w(t,e,"C4"),expect(S[t][e].stop).toHaveBeenCalledTimes(1),expect(S[t][e].triggerRelease).not.toHaveBeenCalled()}),test("should call triggerRelease() with note for non-drum instruments when note is provided",function(){var e="flute";w(t,e,"C4"),expect(S[t][e].triggerRelease).toHaveBeenCalledWith("C4"),expect(S[t][e].stop).not.toHaveBeenCalled()}),test("should call triggerRelease() without note for non-drum instruments when note is undefined",function(){var e="flute";w(t,e,void 0),expect(S[t][e].triggerRelease).toHaveBeenCalledTimes(1),expect(S[t][e].triggerRelease).toHaveBeenCalledWith(),expect(S[t][e].stop).not.toHaveBeenCalled()}),test("should handle invalid instrument gracefully",function(){expect(function(){return w(t,"nonexistent","C4")}).toThrow()}),test("should handle invalid turtle gracefully",function(){expect(function(){return w("nonexistentTurtle","flute","C4")}).toThrow()})}),describe("loop",function(){beforeAll(function(){S.turtle1||(S.turtle1={}),S.turtle1.flute||(S.turtle1.flute=new Tone.Sampler),S.turtle1.guitar||(S.turtle1.guitar=new Tone.Sampler),_.flute=[0,"voice"],_.guitar=[1,"drum"]}),test("should create and start a loop for drum instruments",function(){var e="turtle1",t="guitar",n=j(e,t,"C4",.25,0,120,.8);expect(S[e][t].start).toHaveBeenCalledTimes(1),expect(S[e][t].triggerAttackRelease).not.toHaveBeenCalled(),expect(n).toStrictEqual({})}),test("should create and start a loop for melodic instruments",function(){var e="turtle1",t="flute",n=j(e,t,"C4",.25,0,120,.8);expect(Tone.Loop).toHaveBeenCalled(),(0,Tone.Loop.mock.calls[0][0])(0),expect(S[e][t].triggerAttackRelease).toHaveBeenCalledWith("C4",.25,expect.any(Number),.8),expect(S[e][t].start).not.toHaveBeenCalled(),expect(n).toStrictEqual({})}),test("should calculate correct loop interval based on BPM",function(){j("turtle1","flute","C4",.25,0,120,.8),expect(Tone.Loop).toHaveBeenCalledWith(expect.any(Function),.5)}),test("should handle different start times",function(){var e={start:jest.fn()};Tone.Loop=jest.fn(function(){return e});j("turtle1","flute","C4",.25,2.5,120,.8),expect(e.start).toHaveBeenCalledWith(2.5)}),test("should use velocity correctly for both instrument types",function(){var e={start:jest.fn()};Tone.Loop=jest.fn(function(){return e}),Tone.now=jest.fn(function(){return 100});j("turtle1","flute","C4",.25,0,120,.6),(0,Tone.Loop.mock.calls[0][0])(0),expect(S.turtle1.flute.triggerAttackRelease).toHaveBeenCalledWith("C4",.25,100,.6)})}),describe("Tone Transport Controls",function(){test("start should call Tone.Transport.start",function(){var e=jest.spyOn(Tone.Transport,"start");O(),expect(e).toHaveBeenCalledTimes(1),e.mockRestore()}),test("stop should call Tone.Transport.stop",function(){var e=jest.spyOn(Tone.Transport,"stop");E(),expect(e).toHaveBeenCalledTimes(1),e.mockRestore()}),test("start and stop should work in sequence",function(){var e=jest.spyOn(Tone.Transport,"start"),t=jest.spyOn(Tone.Transport,"stop");O(),E(),O(),E(),expect(e).toHaveBeenCalledTimes(2),expect(t).toHaveBeenCalledTimes(2),e.mockRestore(),t.mockRestore()})}),describe("_createSampleSynth",function(){it("creates voice synth correctly",function(){c(),l("guitar");var e=h("turtle1","electronic synth","guitar");expect(e).toBeInstanceOf(Tone.Sampler)})}),describe("startSound",function(){it("it should start the sound",function(){expect(x("turtle1","guitar","A")).toBe(void 0)}),it("it should start the sound",function(){expect(x("turtle1","custom","A")).toBe(void 0)})}),describe("whichTemperament",function(){it("should get the temperament",function(){expect(o()).toBe("equal")})}),describe("getFrequency",function(){it("it should return the frequency or frequencies.",function(){expect(i("Bb2",!1)).toBe(116.54094037952261),expect(i("Bb3",!1)).toBe(233.0818807590453),expect(i("A4",!1)).toBe(440.00000000000085)})}),describe("_getFrequency",function(){it("it should return the frequency or frequencies.",function(){expect(a("Bb2",!1,"equal")).toBe(116.54094037952261),expect(a("Bb3",!1,"equal")).toBe(233.0818807590453),expect(a("A4",!1,"equal")).toBe(440.00000000000085)})}),describe("getCustomFrequency",function(){it("it should return the custom frequency or frequencies.",function(){expect(u("Bb2","equal")).toBe("B♭"),expect(u("A4","equal")).toBe("A"),expect(u("Bb3","equal")).toBe("B♭")})}),describe("loadSamples",function(){beforeEach(function(){jest.clearAllMocks(),M.samples=null}),test("should initialize samples object when samples is null",function(){c(),expect(M.samples).toBeDefined(),expect(M.samples.voice).toBeDefined(),expect(M.samples.drum).toBeDefined(),expect(M.samples.voice.piano).toBeNull(),expect(M.samples.voice.guitar).toBeNull()}),test("should not overwrite existing samples object",function(){M.samples={voice:{existingInstrument:{}},drum:{existingDrum:{}}};var e=_objectSpread({},M.samples);c(),expect(M.samples).toEqual(e)}),test("should correctly initialize sample placeholders",function(){c(),expect(Object.keys(M.samples.voice).length).toBeGreaterThan(0),expect(Object.keys(M.samples.drum).length).toBeGreaterThan(0)}),test("empty voice sample should return null function",function(){c(),expect(M.samples.voice.empty).toBeDefined(),expect(M.samples.voice.empty()).toBeNull()}),test("should create separate objects for each manifest type",function(){c(),expect(M.samples.voice).toBeDefined(),expect(M.samples.drum).toBeDefined(),expect(M.samples.voice).not.toBe(M.samples.drum)})}),describe("_loadSample",function(){it("it should return a Promise for loading samples.",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:c(),t=l("piano"),expect(t).toBeInstanceOf(Promise);case 1:return e.a(2)}},e)})))}),describe("getDefaultParamValues",function(){it("it should retrieves default parameter values for various synthesizers.",function(){expect(p("sine")).toStrictEqual({oscillator:{type:"sine"},envelope:{attack:.03,decay:.001,sustain:1,release:.03}}),expect(p("square")).toStrictEqual({oscillator:{type:"square"},envelope:{attack:.03,decay:.001,sustain:1,release:.03}}),expect(p("triangle")).toStrictEqual({oscillator:{type:"triangle"},envelope:{attack:.03,decay:.001,sustain:1,release:.03}}),expect(p("sawtooth")).toStrictEqual({oscillator:{type:"sawtooth"},envelope:{attack:.03,decay:.001,sustain:1,release:.03}})})}),describe("_parseSampleCenterNo",function(){it("it should parses solfege notation and octave to determine the pitch number.",function(){expect(m("do",2)).toBe("24"),expect(m("do",3)).toBe("36"),expect(m("do",4)).toBe("48"),expect(m("do",5)).toBe("60"),expect(m("A",5)).toBe("69"),expect(m("A",2)).toBe("33")})}),describe("createSynth",function(){it("it should return a Promise when creating a synth based on the user's input.",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:t=T("turtle1","piano","amsynth",{}),expect(t).toBeInstanceOf(Promise);case 1:return e.a(2)}},e)})))})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regenerator(){var m,t="function"==typeof Symbol?Symbol:{},e=t.iterator||"@@iterator",n=t.toStringTag||"@@toStringTag";function r(t,e,n,r){var o,i,s,a,c,u,f,l,h,e=e&&e.prototype instanceof k?e:k,e=Object.create(e.prototype);return _regeneratorDefine2(e,"_invoke",(o=t,i=n,f=r||[],l=!1,h={p:u=0,n:0,v:m,a:y,f:y.bind(m,4),d:function(t,e){return s=t,a=0,c=m,h.n=e,p}},function(t,e,n){if(1<u)throw TypeError("Generator is already running");for(l&&1===e&&y(e,n),a=e,c=n;(_=a<2?m:c)||!l;){s||(a?a<3?(1<a&&(h.n=-1),y(a,c)):h.n=c:h.v=c);try{if(u=2,s){if(_=s[t=a?t:"next"]){if(!(_=_.call(s,c)))throw TypeError("iterator result is not an object");if(!_.done)return _;c=_.value,a<2&&(a=0)}else 1===a&&(_=s.return)&&_.call(s),a<2&&(c=TypeError("The iterator does not provide a '"+t+"' method"),a=1);s=m}else if((_=(l=h.n<0)?c:o.call(i,h))!==p)break}catch(t){s=m,a=1,c=t}finally{u=1}}return{value:_,done:l}}),!0),e;function y(t,e){for(a=t,c=e,_=0;!l&&u&&!n&&_<f.length;_++){var n,r=f[_],o=h.p,i=r[2];3<t?(n=i===e)&&(c=r[(a=r[4])?5:a=3],r[4]=r[5]=m):r[0]<=o&&((n=t<2&&o<r[1])?(a=0,h.v=e,h.n=r[1]):o<i&&(n=t<3||r[0]>e||i<e)&&(r[4]=t,r[5]=e,h.n=i,a=0))}if(n||1<t)return p;throw l=!0,e}}var p={};function k(){}function o(){}function i(){}var _=Object.getPrototypeOf,t=[][e]?_(_([][e]())):(_regeneratorDefine2(_={},e,function(){return this}),_),s=i.prototype=k.prototype=Object.create(t);function a(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,i):(t.__proto__=i,_regeneratorDefine2(t,n,"GeneratorFunction")),t.prototype=Object.create(s),t}return _regeneratorDefine2(s,"constructor",o.prototype=i),_regeneratorDefine2(i,"constructor",o),_regeneratorDefine2(i,n,o.displayName="GeneratorFunction"),_regeneratorDefine2(s),_regeneratorDefine2(s,n,"Generator"),_regeneratorDefine2(s,e,function(){return this}),_regeneratorDefine2(s,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:a}})()}function _regeneratorDefine2(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}(_regeneratorDefine2=function(t,e,n,r){function o(e,n){_regeneratorDefine2(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(o("next",0),o("throw",1),o("return",2))})(t,e,n,r)}function asyncGeneratorStep(t,e,n,r,o,i,s){try{var a=t[i](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,o)}function _asyncToGenerator(a){return function(){var t=this,s=arguments;return new Promise(function(e,n){var r=a.apply(t,s);function o(t){asyncGeneratorStep(r,e,n,o,i,"next",t)}function i(t){asyncGeneratorStep(r,e,n,o,i,"throw",t)}o(void 0)})}}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Sampler=_createClass(function t(e){_classCallCheck(this,t),this.noteDict=e,this.toDestination=jest.fn().mockReturnThis(),this.connect=jest.fn().mockReturnThis(),this.start=jest.fn().mockReturnThis(),this.stop=jest.fn().mockReturnThis(),this.triggerAttack=jest.fn().mockReturnThis(),this.volume={value:0,linearRampToValueAtTime:jest.fn().mockImplementation()},this.triggerRelease=jest.fn().mockReturnThis(),this.triggerAttackRelease=jest.fn().mockReturnThis(),this.chain=jest.fn().mockReturnThis()}),Player=_createClass(function t(e){_classCallCheck(this,t),this.sample=e,this.toDestination=jest.fn().mockReturnThis(),this.connect=jest.fn().mockReturnThis(),this.start=jest.fn().mockReturnThis(),this.triggerAttackRelease=jest.fn().mockReturnThis()}),AMSynth=(()=>_createClass(function t(){_classCallCheck(this,t)},[{key:"toDestination",value:function(){return this}}]))(),FMSynth=(()=>_createClass(function t(){_classCallCheck(this,t)},[{key:"toDestination",value:function(){return this}}]))(),DuoSynth=(()=>_createClass(function t(){_classCallCheck(this,t)},[{key:"toDestination",value:function(){return this}}]))(),PluckSynth=(()=>_createClass(function t(e){_classCallCheck(this,t),this.synthOptions=e,this.triggerAttackRelease=jest.fn().mockReturnThis()},[{key:"toDestination",value:function(){return this}}]))(),Synth=(()=>_createClass(function t(e){_classCallCheck(this,t),this.synthOptions=e,this.triggerAttackRelease=jest.fn().mockReturnThis(),this.stop=jest.fn().mockReturnThis(),this.triggerAttack=jest.fn().mockReturnThis(),this.triggerRelease=jest.fn().mockReturnThis(),this.start=jest.fn().mockReturnThis(),this.chain=jest.fn().mockReturnThis(),this.volume={value:0,linearRampToValueAtTime:jest.fn().mockImplementation()}},[{key:"toDestination",value:function(){return this}}]))(),NoiseSynth=(()=>_createClass(function t(e){_classCallCheck(this,t),this.synthOptions=e},[{key:"toDestination",value:function(){return this}}]))(),PolySynth=(()=>_createClass(function t(e,n){_classCallCheck(this,t),this.synth=e,this.count=n,this.triggerAttack=jest.fn().mockReturnThis(),this.start=jest.fn().mockReturnThis(),this.triggerAttackRelease=jest.fn().mockReturnThis(),this.volume={value:0,linearRampToValueAtTime:jest.fn().mockImplementation()}},[{key:"toDestination",value:function(){return this}},{key:"connect",value:function(){return this}}]))(),context=(()=>_createClass(function t(){_classCallCheck(this,t)},null,[{key:"resume",value:function(){}}]))(),Transport=(()=>_createClass(function t(){_classCallCheck(this,t)},null,[{key:"start",value:function(){}},{key:"stop",value:function(){}}]))(),ToneAudioBuffer=(()=>{return _createClass(function t(){_classCallCheck(this,t)},null,[{key:"loaded",value:(t=_asyncToGenerator(_regenerator().m(function t(){return _regenerator().w(function(t){for(;;)if(0===t.n)return t.a(2,this)},t,this)})),function(){return t.apply(this,arguments)})}]);var t})(),Tone={AMSynth:AMSynth,PolySynth:PolySynth,Player:Player,Sampler:Sampler,Synth:Synth,PluckSynth:PluckSynth,NoiseSynth:NoiseSynth,DuoSynth:DuoSynth,context:context,FMSynth:FMSynth,Transport:Transport,ToneAudioBuffer:ToneAudioBuffer,Frequency:jest.fn(function(){return{toFrequency:jest.fn().mockReturnThis()}}),getContext:jest.fn(function(){return{createMediaStreamDestination:jest.fn().mockReturnThis()}}),gainToDb:jest.fn(function(){return 4}),start:jest.fn().mockResolvedValue(),now:jest.fn(function(){return(new Date).getTime()}),Context:jest.fn().mockReturnThis(),Loop:jest.fn(function(e,t){return{start:jest.fn(function(t){return e(t),{}})}}),Instrument:jest.fn().mockImplementation(function(){return{toDestination:jest.fn()}}),doNeighbor:jest.fn().mockReturnThis(),Destination:{volume:{rampTo:jest.fn()}},console:{debug:jest.fn()},Vibrato:jest.fn().mockReturnThis(),Distortion:jest.fn().mockReturnThis(),Buffer:jest.fn(function(){return{onload:jest.fn().mockReturnThis()}})};module.exports=Tone;
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var fs=require("fs"),path=require("path");describe("Utility Functions (logic-only)",function(){var t,n,o,i,r,f,u,a,c,s,l,d,p;beforeAll(function(){global.window={btoa:function(e){return Buffer.from(e,"utf8").toString("base64")},outerHeight:600,outerWidth:800,innerHeight:400,innerWidth:600,devicePixelRatio:2,widgetWindows:{hideAllWindows:jest.fn(),hideWindow:jest.fn()},server:"http://localhost/",onload:null,setInterval:jest.fn(),clearInterval:jest.fn()},global.navigator={userAgent:"NodeTest"},global.document={getElementById:jest.fn(function(){return null}),getElementsByClassName:jest.fn(function(){return[]}),getElementsByName:jest.fn(function(){return[]}),getElementsByTagName:jest.fn(function(){return[]}),querySelector:jest.fn(function(){return{getContext:jest.fn(function(){return{measureText:function(){return{width:42}}}})}}),webL10n:{get:jest.fn(function(e){return e}),getLanguage:jest.fn(function(){return"en"})},body:{innerHTML:""},createElement:jest.fn(function(){return{getContext:jest.fn(function(){return{measureText:function(){return{width:42}}}})}})},global.localStorage={getItem:jest.fn(),setItem:jest.fn(),removeItem:jest.fn(),clear:jest.fn(),kanaPreference:""},global.XMLHttpRequest=(()=>_createClass(function e(){_classCallCheck(this,e)},[{key:"open",value:function(){}},{key:"setRequestHeader",value:function(){}},{key:"send",value:function(){this.status=200,this.responseText="Mock response"}}]))(),global.self={location:{href:"file:///"},console:console};var e=fs.readFileSync(path.join(__dirname,"../utils.js"),"utf8"),e=new Function("\n            ".concat(e,'\n            return {\n                toTitleCase: typeof toTitleCase !== "undefined" ? toTitleCase : undefined,\n                fileExt: typeof fileExt !== "undefined" ? fileExt : undefined,\n                fileBasename: typeof fileBasename !== "undefined" ? fileBasename : undefined,\n                last: typeof last !== "undefined" ? last : undefined,\n                safeSVG: typeof safeSVG !== "undefined" ? safeSVG : undefined,\n                toFixed2: typeof toFixed2 !== "undefined" ? toFixed2 : undefined,\n                mixedNumber: typeof mixedNumber !== "undefined" ? mixedNumber : undefined,\n                nearestBeat: typeof nearestBeat !== "undefined" ? nearestBeat : undefined,\n                oneHundredToFraction: typeof oneHundredToFraction !== "undefined" ? oneHundredToFraction : undefined,\n                rationalToFraction: typeof rationalToFraction !== "undefined" ? rationalToFraction : undefined,\n                rgbToHex: typeof rgbToHex !== "undefined" ? rgbToHex : undefined,\n                hexToRGB: typeof hexToRGB !== "undefined" ? hexToRGB : undefined,\n                hex2rgb: typeof hex2rgb !== "undefined" ? hex2rgb : undefined\n            };\n        '))();t=e.toTitleCase,n=e.fileExt,o=e.fileBasename,i=e.last,r=e.safeSVG,f=e.toFixed2,u=e.mixedNumber,a=e.nearestBeat,c=e.oneHundredToFraction,s=e.rationalToFraction,l=e.rgbToHex,d=e.hexToRGB,p=e.hex2rgb}),describe("toTitleCase()",function(){it("converts first character to uppercase",function(){expect(t("hello")).toBe("Hello")}),it("returns undefined if not a string",function(){expect(t(123)).toBeUndefined()})}),describe("fileExt()",function(){it("returns file extension",function(){expect(n("image.png")).toBe("png"),expect(n("archive.tar.gz")).toBe("gz")}),it("returns empty string if no extension",function(){expect(n("filename")).toBe(""),expect(n(null)).toBe("")})}),describe("fileBasename()",function(){it("returns basename without extension",function(){expect(o("image.png")).toBe("image"),expect(o("archive.tar.gz")).toBe("archive.tar")}),it("handles files without extension",function(){expect(o("filename")).toBe("filename")})}),describe("last()",function(){it("returns last element of array",function(){expect(i([1,2,3])).toBe(3),expect(i(["a","b","c"])).toBe("c")}),it("returns null if empty array",function(){expect(i([])).toBeNull()})}),describe("safeSVG()",function(){it("escapes HTML entities",function(){expect(r("<svg>")).toBe("&lt;svg&gt;"),expect(r("Hello & goodbye")).toBe("Hello &amp; goodbye")}),it("returns non-string as is",function(){expect(r(123)).toBe(123)})}),describe("toFixed2()",function(){it("formats number to two decimals if needed",function(){expect(f(3.14159)).toBe("3.14"),expect(f(3)).toBe("3")}),it("returns input as is if not a number",function(){expect(f("abc")).toBe("abc")})}),describe("mixedNumber()",function(){it("returns mixed fraction for fractional numbers",function(){expect(u(2.25)).toBe("2 1/4"),expect(u(1)).toBe("1/1")}),it("returns number/1 for integer",function(){expect(u(2)).toBe("2/1")})}),describe("nearestBeat()",function(){it("finds nearest beat",function(){expect(a(50,8)).toEqual([4,8])})}),describe("oneHundredToFraction()",function(){it("returns fraction for given number",function(){expect(c(50)).toEqual([1,2]),expect(c(1)).toEqual([1,64]),expect(c(100)).toEqual([1,1])})}),describe("rationalToFraction()",function(){it("converts float to fraction",function(){expect(s(.5)).toEqual([1,2])}),it("handles 0, NaN, Infinity",function(){expect(s(0)).toEqual([0,1]),expect(s(NaN)).toEqual([0,1]),expect(s(1/0)).toEqual([0,1])})}),describe("rgbToHex()",function(){it("converts rgb to hex",function(){expect(l(255,0,0)).toBe("#ff0000"),expect(l(0,255,0)).toBe("#00ff00"),expect(l(0,0,255)).toBe("#0000ff")})}),describe("hexToRGB()",function(){it("converts hex to rgb object",function(){expect(d("#ff0000")).toEqual({r:255,g:0,b:0}),expect(d("#00ff00")).toEqual({r:0,g:255,b:0})}),it("returns null for invalid hex",function(){expect(d("#zzz")).toBeNull()})}),describe("hex2rgb()",function(){it("converts hex to rgba string",function(){expect(p("ff0000")).toBe("rgba(255,0,0,1)")})})});
global._=function(e){return e};var mockOscillator={toDestination:jest.fn().mockReturnThis(),triggerRelease:jest.fn(),triggerAttack:jest.fn(),triggerAttackRelease:jest.fn(),frequency:{linearRampToValueAtTime:jest.fn()}},createMockElement=(global.Tone={AMSynth:jest.fn().mockImplementation(function(){return mockOscillator}),now:jest.fn().mockReturnValue(100)},function(e){return{tagName:e,style:{},appendChild:jest.fn(),innerHTML:"",addEventListener:jest.fn(),value:"440",dispatchEvent:jest.fn(),min:"0",max:"1000",className:""}}),createMockWidgetWindow=(global.document={createElement:jest.fn().mockImplementation(createMockElement),addEventListener:jest.fn(),removeEventListener:jest.fn()},function(){var i=[];return{_toolbar:{appendChild:jest.fn()},addRangeSlider:jest.fn().mockImplementation(function(){return{addEventListener:jest.fn(),style:{},value:"440",min:"110",max:"880",dispatchEvent:jest.fn()}}),addButton:jest.fn().mockImplementation(function(e,t,n,o){n={onclick:null,tip:n};return i.push(n),n}),getButtons:function(){return i},sendToCenter:jest.fn(),destroy:jest.fn(),onclose:null}}),PitchSlider=require("../pitchslider.js");describe("PitchSlider Widget",function(){var o,i;beforeEach(function(){jest.clearAllMocks(),global.window||(global.window={}),global.window.widgetWindows={openWindows:{},windowFor:jest.fn().mockImplementation(function(){return createMockWidgetWindow()})},global.window.btoa=jest.fn(function(e){return Buffer.from(e).toString("base64")}),global.document||(global.document={}),global.document.createElement=jest.fn().mockImplementation(createMockElement),global.document.addEventListener=jest.fn(),global.document.removeEventListener=jest.fn(),o={logo:{},textMsg:jest.fn(),refreshCanvas:jest.fn(),blocks:{palettes:{dict:{myPalette:{hideMenu:jest.fn()}}},loadNewBlocks:jest.fn()}},i=new PitchSlider}),describe("Static Properties",function(){test("ICONSIZE is 32",function(){expect(PitchSlider.ICONSIZE).toBe(32)}),test("SEMITONE is correct",function(){expect(PitchSlider.SEMITONE).toBeCloseTo(1.059463,6)})}),describe("Constructor",function(){test("initializes _delta to 0",function(){expect(i._delta).toBe(0)}),test("initializes empty sliders object",function(){expect(i.sliders).toEqual({})}),test("initializes _cellScale to 0",function(){expect(i._cellScale).toBe(0)}),test("initializes isActive to false",function(){expect(i.isActive).toBe(!1)}),test("initializes activeSlider to null",function(){expect(i.activeSlider).toBeNull()})}),describe("Initialization (init)",function(){test("returns early if slider window already open",function(){global.window.widgetWindows.openWindows.slider=!0,i.init(o),expect(Tone.AMSynth).not.toHaveBeenCalled(),global.window.widgetWindows.openWindows={}}),test("initializes frequencies to [392] if not set",function(){i.init(o),expect(i.frequencies).toEqual([392])}),test("preserves existing frequencies array",function(){i.frequencies=[440,880],i.init(o),expect(i.frequencies).toEqual([440,880])}),test("creates one oscillator per frequency",function(){i.frequencies=[440,880,220],i.init(o),expect(Tone.AMSynth).toHaveBeenCalledTimes(3)}),test("routes oscillators to destination",function(){i.init(o),expect(mockOscillator.toDestination).toHaveBeenCalled()}),test("sets _cellScale to 1.0",function(){i.init(o),expect(i._cellScale).toBe(1)}),test("registers widget window with correct parameters",function(){i.init(o),expect(window.widgetWindows.windowFor).toHaveBeenCalledWith(i,"pitch slider","slider",!0)}),test("sets isActive to true",function(){i.init(o),expect(i.isActive).toBe(!0)}),test("sets activity.logo.pitchSlider reference",function(){i.init(o),expect(o.logo.pitchSlider).toBe(i)}),test("registers keydown event listener",function(){i.init(o),expect(document.addEventListener).toHaveBeenCalledWith("keydown",expect.any(Function),!0)}),test("displays two help messages",function(){i.init(o),expect(o.textMsg).toHaveBeenCalledTimes(2),expect(o.textMsg).toHaveBeenCalledWith("Use the up/down buttons or arrow keys to change pitch.",3e3)}),test("sets activeSlider to 0 for first slider",function(){i.init(o),expect(i.activeSlider).toBe("0")})}),describe("Multiple Sliders",function(){test("creates separate slider for each frequency",function(){i.frequencies=[440,880],i.init(o),expect(i.widgetWindow.addRangeSlider).toHaveBeenCalledTimes(2)}),test("creates up/down/save buttons for each frequency",function(){i.frequencies=[440,880],i.init(o),expect(i.widgetWindow.addButton).toHaveBeenCalledTimes(6)}),test("each slider has correct min/max range",function(){i.frequencies=[440],i.init(o),expect(i.widgetWindow.addRangeSlider).toHaveBeenCalledWith(440,expect.anything(),220,880,"pitchSlider")})}),describe("Cleanup (onclose)",function(){beforeEach(function(){i.init(o)}),test("removes keydown event listener",function(){i.widgetWindow.onclose(),expect(document.removeEventListener).toHaveBeenCalledWith("keydown",expect.any(Function),!0)}),test("releases all oscillators",function(){i.widgetWindow.onclose(),expect(mockOscillator.triggerRelease).toHaveBeenCalled()}),test("sets isActive to false",function(){i.widgetWindow.onclose(),expect(i.isActive).toBe(!1)}),test("clears activity.logo.pitchSlider reference",function(){i.widgetWindow.onclose(),expect(o.logo.pitchSlider).toBeNull()}),test("destroys widget window",function(){i.widgetWindow.onclose(),expect(i.widgetWindow.destroy).toHaveBeenCalled()})}),describe("Key Handling",function(){var n,t;beforeEach(function(){i.init(o),n=document.addEventListener.mock.calls.find(function(e){return"keydown"===e[0]})[1],t={value:"440",min:"220",max:"880",dispatchEvent:jest.fn()},i.sliders[0]=t,i.activeSlider=0,i.isActive=!0}),test("ignores events when widget is inactive",function(){i.isActive=!1;var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(e.preventDefault).not.toHaveBeenCalled()}),test("ignores non-arrow keys",function(){var e={key:"Enter",preventDefault:jest.fn(),stopPropagation:jest.fn()},t=n(e);expect(e.preventDefault).not.toHaveBeenCalled(),expect(t).toBeUndefined()}),test("ArrowUp increases frequency by semitone",function(){var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440*PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)}),test("ArrowRight increases frequency by semitone",function(){var e={key:"ArrowRight",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440*PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)}),test("ArrowDown decreases frequency by semitone",function(){var e={key:"ArrowDown",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440/PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)}),test("ArrowLeft decreases frequency by semitone",function(){var e={key:"ArrowLeft",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440/PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)}),test("respects maximum frequency limit",function(){t.value="880";var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(parseFloat(t.value)).toBe(880)}),test("respects minimum frequency limit",function(){t.value="220";var e={key:"ArrowDown",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(parseFloat(t.value)).toBe(220)}),test("dispatches input event after value change",function(){var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(t.dispatchEvent).toHaveBeenCalled()}),test("prevents default browser behavior for arrow keys",function(){var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()};n(e),expect(e.preventDefault).toHaveBeenCalled(),expect(e.stopPropagation).toHaveBeenCalled()}),test("returns false to prevent event bubbling",function(){var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=n(e);expect(e).toBe(!1)}),test("uses slider 0 when activeSlider is null",function(){i.activeSlider=null;var e={key:"ArrowUp",preventDefault:jest.fn(),stopPropagation:jest.fn()},e=(n(e),440*PitchSlider.SEMITONE);expect(parseFloat(t.value)).toBeCloseTo(e,2)})}),describe("UI Interaction",function(){beforeEach(function(){i.init(o)}),test("slider oninput triggers sound attack",function(){var e=i.sliders[0];e.value="500",e.oninput(),expect(mockOscillator.triggerAttack).toHaveBeenCalledWith(392)}),test("slider oninput ramps to new frequency",function(){var e=i.sliders[0];e.value="500",e.oninput(),expect(mockOscillator.frequency.linearRampToValueAtTime).toHaveBeenCalledWith(500,100.05)}),test("slider oninput updates frequency array",function(){var e=i.sliders[0];e.value="500",e.oninput(),expect(i.frequencies[0]).toBe(500)}),test("slider onchange releases oscillator",function(){i.sliders[0].onchange(),expect(mockOscillator.triggerRelease).toHaveBeenCalled()}),test("Move Up button increases frequency by semitone",function(){var e=i.sliders[0];e.value="440",i.frequencies[0]=440;i.widgetWindow.getButtons().find(function(e){return"Move up"===e.tip}).onclick();var t=440*PitchSlider.SEMITONE;expect(parseFloat(e.value)).toBeCloseTo(t,2)}),test("Move Up button plays note preview",function(){i.frequencies[0]=440,i.widgetWindow.getButtons().find(function(e){return"Move up"===e.tip}).onclick(),expect(mockOscillator.triggerAttackRelease).toHaveBeenCalledWith(expect.any(Number),"4n")}),test("Move Down button decreases frequency by semitone",function(){var e=i.sliders[0];e.value="440",i.frequencies[0]=440;i.widgetWindow.getButtons().find(function(e){return"Move down"===e.tip}).onclick();var t=440/PitchSlider.SEMITONE;expect(parseFloat(e.value)).toBeCloseTo(t,2)}),test("Save button passes current frequency to _save",function(){var e=jest.spyOn(i,"_save");i.frequencies[0]=500,i.widgetWindow.getButtons().find(function(e){return"Save"===e.tip}).onclick(),expect(e).toHaveBeenCalledWith(500)}),test("slider registers mousedown event listener",function(){expect(i.sliders[0]).toBeDefined(),expect(i.sliders[0].addEventListener).toHaveBeenCalledWith("mousedown",expect.any(Function))})}),describe("Block Generation (_save)",function(){beforeEach(function(){i.init(o)}),test("hides all palette menus",function(){i._save(440),expect(o.blocks.palettes.dict.myPalette.hideMenu).toHaveBeenCalledWith(!0)}),test("refreshes canvas after hiding menus",function(){i._save(440),expect(o.refreshCanvas).toHaveBeenCalled()}),test("creates 5-element block stack",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e).toHaveLength(5)}),test("first block is note block",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[0][1]).toBe("note")}),test("second block is number 8 (eighth note)",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[1][1]).toEqual(["number",{value:8}])}),test("third block is hertz block",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[2][1]).toBe("hertz")}),test("fourth block contains frequency value",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[3][1]).toEqual(["number",{value:440}])}),test("fifth block is hidden block",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[4][1]).toBe("hidden")}),test("uses different frequency values correctly",function(){i._save(523.25);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[3][1]).toEqual(["number",{value:523.25}])}),test("increments _delta by 21 for each save",function(){expect(i._delta).toBe(0),i._save(440),expect(i._delta).toBe(21),i._save(880),expect(i._delta).toBe(42)}),test("positions subsequent blocks with offset",function(){i._save(440),i._save(880);var e=o.blocks.loadNewBlocks.mock.calls[0][0],t=o.blocks.loadNewBlocks.mock.calls[1][0];expect(t[0][2]).toBe(e[0][2]+21)}),test("block connections are properly set",function(){i._save(440);var e=o.blocks.loadNewBlocks.mock.calls[0][0];expect(e[0][4]).toEqual([null,1,2,null]),expect(e[1][4]).toEqual([0]),expect(e[2][4]).toEqual([0,3,4])})})});
var RhythmRuler=require("../rhythmruler.js"),mockWindow=(global._=function(e){return e},global.TONEBPM=240,global.EIGHTHNOTEWIDTH=24,global.Singer={masterBPM:90,defaultBPMFactor:1e3},global.docById=jest.fn().mockReturnValue({style:{},classList:{add:jest.fn(),remove:jest.fn()},innerHTML:""}),global.delayExecution=jest.fn().mockResolvedValue(void 0),global.last=function(e){return e&&0<e.length?e[e.length-1]:void 0},global.nearestBeat=jest.fn(function(e){return e}),global.rationalToFraction=jest.fn(function(e){return[1,Math.round(1/e)]}),global.calcNoteValueToDisplay=jest.fn(function(e,t){return"".concat(t,"/").concat(e)}),global.beginnerMode=!1,global.platformColor={selectorBackground:"#ffb020",selectorBackgroundHOFF:"#ffc040",paletteBackground:"#f0f0f0"},global.DRUMNAMES=[],global.VOICENAMES=[],global.EFFECTSNAMES=[],{widgetWindows:{windowFor:jest.fn().mockReturnValue({clear:jest.fn(),show:jest.fn(),destroy:jest.fn(),addButton:jest.fn().mockReturnValue({onclick:null,innerHTML:""}),addInputButton:jest.fn().mockImplementation(function(e){return{value:e,addEventListener:jest.fn(),classList:{add:jest.fn(),remove:jest.fn()},onfocus:null,onblur:null}}),getWidgetBody:jest.fn().mockReturnValue({appendChild:jest.fn(),append:jest.fn(),insertRow:jest.fn().mockReturnValue({setAttribute:jest.fn(),insertCell:jest.fn().mockReturnValue({appendChild:jest.fn(),setAttribute:jest.fn(),style:{},innerHTML:"",addEventListener:jest.fn()})})}),sendToCenter:jest.fn(),isMaximized:jest.fn().mockReturnValue(!1),onclose:null,onmaximize:null})},innerWidth:1200});global.window=mockWindow,global.document={createElement:jest.fn().mockImplementation(function(e){return{style:{},setAttribute:jest.fn(),getAttribute:jest.fn(),addEventListener:jest.fn(),appendChild:jest.fn(),insertRow:jest.fn().mockReturnValue({setAttribute:jest.fn(),insertCell:jest.fn().mockReturnValue({style:{},innerHTML:"",setAttribute:jest.fn(),addEventListener:jest.fn()})}),cells:[],insertCell:jest.fn().mockReturnValue({style:{},innerHTML:""}),deleteCell:jest.fn(),classList:{add:jest.fn(),remove:jest.fn()},getContext:jest.fn().mockReturnValue({clearRect:jest.fn(),beginPath:jest.fn(),fillStyle:"",fill:jest.fn(),closePath:jest.fn()})}}),getElementById:jest.fn().mockReturnValue({style:{},classList:{add:jest.fn(),remove:jest.fn()}})},describe("RhythmRuler Widget",function(){var t,e;beforeEach(function(){t=new RhythmRuler,e={logo:{synth:{trigger:jest.fn(),stop:jest.fn(),loadSynth:jest.fn()},resetSynth:jest.fn(),turtleDelay:0},blocks:{blockList:{},protoBlockDict:{},loadNewBlocks:jest.fn()},turtles:{ithTurtle:jest.fn().mockReturnValue({singer:{beatsPerMeasure:4,noteValuePerBeat:4}})},refreshCanvas:jest.fn(),saveLocally:jest.fn(),textMsg:jest.fn(),errorMsg:jest.fn(),hideMsgs:jest.fn()},global.activity=e,t.activity=e,t.widgetWindow=mockWindow.widgetWindows.windowFor()}),afterEach(function(){jest.clearAllMocks()}),describe("Constructor",function(){test("should initialize with default empty state",function(){expect(t.Drums).toEqual([]),expect(t.Rulers).toEqual([]),expect(t._undoList).toEqual([]),expect(t._dissectHistory).toEqual([])}),test("should initialize flags to default values",function(){expect(t._playing).toBe(!1),expect(t._playingOne).toBe(!1),expect(t._playingAll).toBe(!1),expect(t._tapMode).toBe(!1),expect(t._rulerSelected).toBe(0)}),test("should have correct static constants",function(){expect(RhythmRuler.RULERHEIGHT).toBe(70),expect(RhythmRuler.BUTTONSIZE).toBe(51),expect(RhythmRuler.ICONSIZE).toBe(32),expect(RhythmRuler.DEL).toBe(46),expect(RhythmRuler.BACK).toBe(8)})}),describe("State Management",function(){test("should initialize tracking arrays",function(){expect(t._elapsedTimes).toEqual([]),expect(t._offsets).toEqual([]),expect(t._startingTime).toBeNull(),expect(t._tapTimes).toEqual([])})}),describe("Ruler and Drum Management",function(){test("should allow adding drums to Drums array",function(){t.Drums.push("snare drum"),t.Rulers.push([[1],[]]),expect(t.Drums).toHaveLength(1),expect(t.Drums[0]).toBe("snare drum")}),test("should allow adding multiple drums",function(){t.Drums.push("snare drum"),t.Drums.push("kick drum"),t.Rulers.push([[1],[]]),t.Rulers.push([[1],[]]),expect(t.Drums).toHaveLength(2),expect(t.Rulers).toHaveLength(2)}),test("should store ruler note values correctly",function(){t.Rulers.push([[4,4,4,4],[]]),expect(t.Rulers[0][0]).toEqual([4,4,4,4]),expect(t.Rulers[0][1]).toEqual([])}),test("should store division history in ruler",function(){t.Rulers.push([[4],[[0,4]]]),expect(t.Rulers[0][1]).toHaveLength(1),expect(t.Rulers[0][1][0]).toEqual([0,4])})}),describe("Undo Functionality",function(){beforeEach(function(){t.activity=e,t._rulers=[]}),test("should return early if undo list is empty",function(){t._undoList=[],t.Rulers=[[[1],[]]],t._rulers=[{cells:[],insertCell:jest.fn(),deleteCell:jest.fn()}],expect(function(){return t._undo()}).not.toThrow()}),test("should stop synth when undoing",function(){t._undoList=[],t.Rulers=[[[1],[]]],t._rulers=[{cells:[],insertCell:jest.fn(),deleteCell:jest.fn()}],t._undo(),expect(e.logo.synth.stop).toHaveBeenCalled()}),test("should reset playing state when undoing",function(){t._playing=!0,t._playingAll=!0,t._playingOne=!0,t._rulerPlaying=1,t._undoList=[],t.Rulers=[[[1],[]]],t._rulers=[{cells:[],insertCell:jest.fn(),deleteCell:jest.fn()}],t._undo(),expect(t._playing).toBe(!1),expect(t._playingAll).toBe(!1),expect(t._playingOne).toBe(!1),expect(t._rulerPlaying).toBe(-1)}),test("should reset starting time when undoing",function(){t._startingTime=12345,t._undoList=[],t.Rulers=[[[1],[]]],t._rulers=[{cells:[],insertCell:jest.fn(),deleteCell:jest.fn()}],t._undo(),expect(t._startingTime).toBeNull()})}),describe("Save Dissect History",function(){beforeEach(function(){t._dissectNumber={classList:{add:jest.fn(),remove:jest.fn()}}}),test("should save dissect history for rulers with drums",function(){t.Drums=["snare drum"],t.Rulers=[[[],[[0,2]]]],t._dissectHistory=[],t.saveDissectHistory(),expect(t._dissectHistory).toHaveLength(1),expect(t._dissectHistory[0][1]).toBe("snare drum")}),test("should skip rulers with null drums",function(){t.Drums=[null,"kick drum"],t.Rulers=[[[],[]],[[],[[0,3]]]],t._dissectHistory=[],t.saveDissectHistory(),expect(t._dissectHistory).toHaveLength(1),expect(t._dissectHistory[0][1]).toBe("kick drum")}),test("should preserve old history entries for unused drums",function(){t.Drums=["snare drum"],t.Rulers=[[[],[[0,2]]]],t._dissectHistory=[[[[0,4]],"old drum"]],t.saveDissectHistory(),expect(t._dissectHistory).toHaveLength(2)}),test("should add hasKeyboard class to dissect number",function(){t.Drums=["snare drum"],t.Rulers=[[[],[[0,2]]]],t._dissectHistory=[],t.saveDissectHistory(),expect(t._dissectNumber.classList.add).toHaveBeenCalledWith("hasKeyboard")})}),describe("Note Width Calculation",function(){test("should calculate width based on note value",function(){var e=t._noteWidth(4);expect(e).toBe(144)}),test("should calculate width for eighth note",function(){var e=t._noteWidth(8);expect(e).toBe(72)}),test("should calculate width for half note",function(){var e=t._noteWidth(2);expect(e).toBe(288)}),test("should handle sixteenth note",function(){var e=t._noteWidth(16);expect(e).toBe(36)})}),describe("Playback State",function(){test("should allow updating playback properties",function(){t._rulerPlaying=2,t._playingAll=!0,t._playingOne=!0,t._cellCounter=5,expect(t._rulerPlaying).toBe(2),expect(t._playingAll).toBe(!0),expect(t._playingOne).toBe(!0),expect(t._cellCounter).toBe(5)})}),describe("Tap Mode",function(){test("should track tap mode verification",function(){t._tapMode=!0,t._tapTimes=[100,200,300],t._tapEndTime=12345,expect(t._tapMode).toBe(!0),expect(t._tapTimes).toHaveLength(3),expect(t._tapEndTime).toBe(12345)}),test("should track tap interaction details",function(){t._tapCell={cellIndex:2},t._inLongPress=!0,t._longPressStartTime=1e4,expect(t._tapCell.cellIndex).toBe(2),expect(t._inLongPress).toBe(!0),expect(t._longPressStartTime).toBe(1e4)})}),describe("Mouse Interactions",function(){test("should track mouse interactions on cells",function(){t._mouseDownCell=3,t._mouseUpCell=5,expect(t._mouseDownCell).toBe(3),expect(t._mouseUpCell).toBe(5)})}),describe("Fullscreen Mode",function(){test("should manage fullscreen scale factor",function(){expect(t._fullscreenScaleFactor).toBe(3),t._fullscreenScaleFactor=5,expect(t._fullscreenScaleFactor).toBe(5)})})});
global._=function(e){return e},global._THIS_IS_MUSIC_BLOCKS_=!0,global.MATRIXBUTTONHEIGHT=40,global.MATRIXSOLFEHEIGHT=30,global.rationalToFraction=jest.fn().mockReturnValue([4,1]),global.mixedNumber=jest.fn().mockImplementation(function(e){return null!=e?e.toString():""}),global.toFixed2=jest.fn().mockImplementation(function(e){return e.toFixed(2)}),global.platformColor={selectorBackground:"#aaa"};var _createMockElement=function(e){return{tagName:e,style:{},appendChild:jest.fn(),append:jest.fn(),innerHTML:"",addEventListener:jest.fn(),className:"",insertCell:jest.fn().mockImplementation(function(){return _createMockElement("TD")}),insertRow:jest.fn().mockImplementation(function(){return{insertCell:jest.fn().mockImplementation(function(){return _createMockElement("TD")})}}),createTHead:jest.fn().mockImplementation(function(){return{insertRow:jest.fn().mockImplementation(function(){return{insertCell:jest.fn().mockImplementation(function(){return _createMockElement("TD")})}})}}),rows:[]}},createMockWidgetWindow=(global.document={createElement:jest.fn().mockImplementation(_createMockElement)},function(){return{clear:jest.fn(),show:jest.fn(),getWidgetBody:jest.fn().mockReturnValue({append:jest.fn()}),sendToCenter:jest.fn(),destroy:jest.fn(),onclose:null,onmaximize:null}}),StatusMatrix=(global.window={innerWidth:1200,widgetWindows:{windowFor:jest.fn().mockImplementation(function(){return createMockWidgetWindow()})}},require("../status.js"));describe("StatusMatrix Widget",function(){var t,n;beforeEach(function(){jest.clearAllMocks(),global.window.innerWidth=1200,global.window.widgetWindows={windowFor:jest.fn().mockImplementation(function(){return createMockWidgetWindow()})},global.document.createElement=jest.fn().mockImplementation(_createMockElement),t={logo:{statusFields:[],updatingStatusMatrix:!1,inStatusMatrix:!1,parseArg:jest.fn(),synth:{getFrequency:jest.fn().mockReturnValue(440),changeInTemperament:0},boxes:{}},turtles:{turtleList:[{name:"Mouse1",inTrash:!1}],ithTurtle:jest.fn().mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:null}}),getIndexOfTurtle:jest.fn().mockReturnValue(0)},blocks:{blockList:{}}},n=new StatusMatrix}),describe("Static Properties",function(){test("BUTTONDIVWIDTH is 128",function(){expect(StatusMatrix.BUTTONDIVWIDTH).toBe(128)}),test("BUTTONSIZE is 53",function(){expect(StatusMatrix.BUTTONSIZE).toBe(53)}),test("ICONSIZE is 32",function(){expect(StatusMatrix.ICONSIZE).toBe(32)}),test("OUTERWINDOWWIDTH is 620",function(){expect(StatusMatrix.OUTERWINDOWWIDTH).toBe(620)}),test("FONTSCALEFACTOR is 75",function(){expect(StatusMatrix.FONTSCALEFACTOR).toBe(75)})}),describe("Initialization (init)",function(){test("sets isOpen to true",function(){n.init(t),expect(n.isOpen).toBe(!0)}),test("sets isMaximized to false",function(){n.init(t),expect(n.isMaximized).toBe(!1)}),test("calculates cell scale from window width",function(){n.init(t),expect(n._cellScale).toBe(1)}),test("creates widget window",function(){n.init(t),expect(window.widgetWindows.windowFor).toHaveBeenCalledWith(n,"status","status")}),test("creates status table element",function(){n.init(t),expect(document.createElement).toHaveBeenCalledWith("table")}),test("clears and shows widget window",function(){n.init(t),expect(n.widgetWindow.clear).toHaveBeenCalled(),expect(n.widgetWindow.show).toHaveBeenCalled()}),test("stores activity reference",function(){n.init(t),expect(n.activity).toBe(t)})}),describe("Onclose Handler",function(){beforeEach(function(){n.init(t)}),test("sets isOpen to false",function(){n.widgetWindow.onclose(),expect(n.isOpen).toBe(!1)}),test("destroys widget window",function(){n.widgetWindow.onclose(),expect(n.widgetWindow.destroy).toHaveBeenCalled()})}),describe("Status Field Label Handling",function(){beforeEach(function(){t.blocks.blockList={0:{name:"x",protoblock:{staticLabels:["x position"]},value:100},1:{name:"plus",protoblock:{staticLabels:["plus"]},value:0},2:{name:"namedbox",privateData:"myVariable",value:42},3:{name:"heap",protoblock:{staticLabels:["heap"]},value:[1,2,3]},4:{name:"bpm",protoblock:{staticLabels:["beats per minute"]},value:120}},t.logo.statusFields=[[0,"x"],[1,"plus"],[2,"namedbox"],[3,"heap"],[4,"bpm"]]}),test("handles standard blocks with staticLabels",function(){n.init(t),expect(n._statusTable).toBeDefined()}),test("handles math operation blocks (plus, minus, etc) with empty label",function(){n.init(t),expect(n._statusTable).toBeDefined()}),test("handles namedbox with privateData as label",function(){n.init(t),expect(n._statusTable).toBeDefined()})}),describe("Turtle Display",function(){test("displays mouse icon for Music Blocks",function(){global._THIS_IS_MUSIC_BLOCKS_=!0,n.init(t),expect(n._statusTable).toBeDefined()}),test("displays turtle icon for Turtle Blocks",function(){global._THIS_IS_MUSIC_BLOCKS_=!1,n.init(t),expect(n._statusTable).toBeDefined(),global._THIS_IS_MUSIC_BLOCKS_=!0}),test("skips trashed turtles",function(){t.turtles.turtleList=[{name:"Mouse1",inTrash:!1},{name:"Mouse2",inTrash:!0},{name:"Mouse3",inTrash:!1}],n.init(t),expect(n._statusTable).toBeDefined()})}),describe("UpdateAll Method",function(){beforeEach(function(){t.blocks.blockList={0:{name:"x",protoblock:{staticLabels:["x"]},value:150}},t.logo.statusFields=[[0,"x"]],n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("sets updatingStatusMatrix to true during update",function(){var e=null;t.logo.parseArg=jest.fn(function(){e=t.logo.updatingStatusMatrix}),n.updateAll(),expect(e).toBe(!0)}),test("resets updatingStatusMatrix to false after update",function(){n.updateAll(),expect(t.logo.updatingStatusMatrix).toBe(!1)}),test("calls parseArg for each status field",function(){n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("temporarily disables inStatusMatrix during parsing",function(){var e=null;t.logo.parseArg=jest.fn(function(){e=t.logo.inStatusMatrix}),t.logo.inStatusMatrix=!0,n.updateAll(),expect(e).toBe(!1)}),test("restores inStatusMatrix after parsing",function(){t.logo.inStatusMatrix=!0,n.updateAll(),expect(t.logo.inStatusMatrix).toBe(!0)}),test("skips trashed turtles",function(){t.turtles.turtleList=[{name:"Mouse1",inTrash:!0}],n.updateAll(),expect(n._statusTable).toBeDefined()})}),describe("Block Value Formatting",function(){beforeEach(function(){n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("formats x position with toFixed(0)",function(){t.blocks.blockList={0:{name:"x",value:123.789}},t.logo.statusFields=[[0,"x"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("formats y position with toFixed(0)",function(){t.blocks.blockList={0:{name:"y",value:-456.123}},t.logo.statusFields=[[0,"y"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("formats heading with toFixed(0)",function(){t.blocks.blockList={0:{name:"heading",value:45.67}},t.logo.statusFields=[[0,"heading"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("formats mynotevalue with mixedNumber",function(){t.blocks.blockList={0:{name:"mynotevalue",value:.25}},t.logo.statusFields=[[0,"mynotevalue"]],n.updateAll(),expect(mixedNumber).toHaveBeenCalledWith(.25)}),test("formats elapsednotes with mixedNumber",function(){t.blocks.blockList={0:{name:"elapsednotes",value:4.5}},t.logo.statusFields=[[0,"elapsednotes"]],n.updateAll(),expect(mixedNumber).toHaveBeenCalled()}),test("formats beatvalue with mixedNumber using singer.currentBeat",function(){t.blocks.blockList={0:{name:"beatvalue",value:2}},t.logo.statusFields=[[0,"beatvalue"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:3,currentMeasure:1,noteStatus:null}}),n.updateAll(),expect(mixedNumber).toHaveBeenCalledWith(3)}),test("uses singer.currentMeasure for measurevalue",function(){t.blocks.blockList={0:{name:"measurevalue",value:0}},t.logo.statusFields=[[0,"measurevalue"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:4,noteStatus:null}}),n.updateAll(),expect(n._statusTable.rows[1].cells[1].innerHTML).toBe(4)}),test("handles namedbox with value from logo.boxes",function(){t.blocks.blockList={0:{name:"namedbox",privateData:"myVar"}},t.logo.statusFields=[[0,"namedbox"]],t.logo.boxes={myVar:42},n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()}),test("handles namedbox with missing variable",function(){t.blocks.blockList={0:{name:"namedbox",privateData:"missing"}},t.logo.statusFields=[[0,"namedbox"]],t.logo.boxes={},expect(function(){return n.updateAll()}).not.toThrow()}),test("handles heap value directly",function(){t.blocks.blockList={0:{name:"heap",value:[1,2,3]}},t.logo.statusFields=[[0,"heap"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()})}),describe("Pitch in Hertz Handling",function(){beforeEach(function(){n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("gets frequency from synth for pitchinhertz",function(){t.blocks.blockList={0:{name:"pitchinhertz",value:0}},t.logo.statusFields=[[0,"pitchinhertz"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["C4"],.25]}}),n.updateAll(),expect(t.logo.synth.getFrequency).toHaveBeenCalledWith("C4",0)}),test("handles multiple notes in pitchinhertz",function(){t.blocks.blockList={0:{name:"pitchinhertz",value:0}},t.logo.statusFields=[[0,"pitchinhertz"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["C4","E4","G4"],.25]}}),n.updateAll(),expect(t.logo.synth.getFrequency).toHaveBeenCalledTimes(3)}),test("returns empty for null noteStatus",function(){t.blocks.blockList={0:{name:"pitchinhertz",value:0}},t.logo.statusFields=[[0,"pitchinhertz"]],t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:null}}),n.updateAll(),expect(t.logo.synth.getFrequency).not.toHaveBeenCalled()})}),describe("Note Row Display",function(){beforeEach(function(){global._THIS_IS_MUSIC_BLOCKS_=!0,t.blocks.blockList={0:{name:"x",protoblock:{staticLabels:["x"]},value:100}},t.logo.statusFields=[[0,"x"]],n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("displays note names from noteStatus",function(){t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["C4","E4"],.25]}}),n.updateAll(),expect(rationalToFraction).toHaveBeenCalledWith(.25)}),test("formats numeric frequencies with Hz suffix",function(){t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[[440],.25]}}),n.updateAll(),expect(toFixed2).toHaveBeenCalledWith(440)}),test("replaces # with ♯ in note display",function(){var e=_createMockElement("TD");n._statusTable.rows[2]={cells:[_createMockElement("TD"),e]},t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["C#4"],.25]}}),n.updateAll(),expect(e.innerHTML).toContain("♯")}),test("replaces b with ♭ in note display",function(){t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[["Bb4"],.25]}}),n.updateAll(),expect(n._statusTable.rows[2].cells[1].innerHTML).toContain("♭")}),test("handles empty noteStatus array",function(){t.turtles.ithTurtle.mockReturnValue({singer:{currentBeat:1,currentMeasure:1,noteStatus:[[],.25]}}),expect(function(){return n.updateAll()}).not.toThrow()})}),describe("elapsednotes2 Block",function(){beforeEach(function(){n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD")]}]}),test("parses connected block for note value",function(){t.blocks.blockList={0:{name:"elapsednotes2",value:4,connections:[null,1]},1:{name:"number",value:.25}},t.logo.statusFields=[[0,"elapsednotes2"]],n.updateAll(),expect(t.logo.parseArg).toHaveBeenCalled()})}),describe("Multiple Turtles",function(){beforeEach(function(){t.turtles.turtleList=[{name:"Mouse1",inTrash:!1},{name:"Mouse2",inTrash:!1}],t.blocks.blockList={0:{name:"x",protoblock:{staticLabels:["x"]},value:100}},t.logo.statusFields=[[0,"x"]],n.init(t),n._statusTable.rows=[{cells:[_createMockElement("TD"),_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD"),_createMockElement("TD")]},{cells:[_createMockElement("TD"),_createMockElement("TD"),_createMockElement("TD")]}]}),test("updates cells for each active turtle",function(){n.updateAll(),expect(t.turtles.ithTurtle).toHaveBeenCalled()}),test("increments activeTurtles count correctly",function(){n.updateAll(),expect(n._statusTable).toBeDefined()})})});
var Tempo=require("../tempo.js");global._=function(e){return e},global.getDrumSynthName=jest.fn(),global.window={widgetWindows:{windowFor:jest.fn().mockReturnValue({clear:jest.fn(),show:jest.fn(),addButton:jest.fn().mockReturnValue({onclick:function(){}}),addInputButton:jest.fn().mockImplementation(function(e){return{value:e,addEventListener:jest.fn()}}),getWidgetBody:jest.fn().mockReturnValue({appendChild:jest.fn(),insertRow:jest.fn().mockReturnValue({insertCell:jest.fn().mockReturnValue({appendChild:jest.fn(),setAttribute:jest.fn()})})}),sendToCenter:jest.fn()})}},global.document={createElement:jest.fn().mockReturnValue({style:{},getContext:jest.fn().mockReturnValue({clearRect:jest.fn(),beginPath:jest.fn(),fillStyle:"",ellipse:jest.fn(),fill:jest.fn(),closePath:jest.fn()})})},describe("Tempo Widget",function(){var e,t;beforeEach(function(){e=new Tempo,t={logo:{synth:{loadSynth:jest.fn()},firstNoteTime:1e3},blocks:{blockList:{},loadNewBlocks:jest.fn()},refreshCanvas:jest.fn(),saveLocally:jest.fn(),textMsg:jest.fn(),errorMsg:jest.fn()},global.activity=t,e.activity=t,e.BPMs=[100],e.BPMInputs=[{value:100}],e._intervals=[600],e.BPMBlocks=[null],e.isMoving=!0}),test("should initialize with default values",function(){expect(e.BPMs[0]).toBe(100),expect(e.isMoving).toBe(!0)}),test("speedUp() should increase BPM by 10%",function(){e.speedUp(0),expect(e.BPMs[0]).toBe(110),expect(e.BPMInputs[0].value).toBe(110)}),test("slowDown() should decrease BPM by 10%",function(){e.slowDown(0),expect(e.BPMs[0]).toBe(90),expect(e.BPMInputs[0].value).toBe(90)}),test("should not exceed maximum BPM of 1000",function(){e.BPMs[0]=950,e.speedUp(0),expect(e.BPMs[0]).toBe(1e3),expect(t.errorMsg).toHaveBeenCalled()}),test("should not go below minimum BPM of 30",function(){e.BPMs[0]=32,e.slowDown(0),expect(e.BPMs[0]).toBe(30),expect(t.errorMsg).toHaveBeenCalled()})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}global.platformColor={selectorBackground:"#8bc34a"};var createMockElement=function(e){return{style:{},appendChild:jest.fn(),querySelector:jest.fn().mockReturnValue({style:{}}),onclick:null,src:"",width:"",height:"",alt:"",tagName:e}},_require=(global.document={createElement:jest.fn().mockImplementation(function(e){var t=createMockElement(e);return"canvas"===e&&(t.getContext=jest.fn().mockReturnValue({clearRect:jest.fn(),fillRect:jest.fn(),fillText:jest.fn(),fillStyle:"",font:"",textAlign:""}),t.parentElement={appendChild:jest.fn()}),"div"===e&&(t.querySelector=jest.fn().mockReturnValue({style:{}})),"img"===e&&(t.src="",t.width="",t.height="",t.alt=""),t})},require("../tuner.js")),TunerDisplay=_require.TunerDisplay,TunerUtils=_require.TunerUtils;describe("Tuner Widget",function(){describe("Module Export",function(){test("exports TunerDisplay constructor",function(){expect(TunerDisplay).toBeDefined(),expect(_typeof(TunerDisplay)).toBe("function")}),test("exports TunerUtils object",function(){expect(TunerUtils).toBeDefined(),expect(_typeof(TunerUtils)).toBe("object")}),test("TunerUtils has frequencyToPitch method",function(){expect(TunerUtils.frequencyToPitch).toBeDefined(),expect(_typeof(TunerUtils.frequencyToPitch)).toBe("function")}),test("TunerUtils has calculatePlaybackRate method",function(){expect(TunerUtils.calculatePlaybackRate).toBeDefined(),expect(_typeof(TunerUtils.calculatePlaybackRate)).toBe("function")})}),describe("TunerUtils.frequencyToPitch",function(){describe("note detection",function(){test("correctly identifies A4 at 440 Hz",function(){var e=TunerUtils.frequencyToPitch(440);expect(e[0]).toBe("A"),expect(e[2]).toBe(440)}),test("correctly identifies C4 (middle C) around 261.63 Hz",function(){var e=TunerUtils.frequencyToPitch(261.63);expect(e[0]).toBe("C")}),test("correctly identifies G4 around 392 Hz",function(){var e=TunerUtils.frequencyToPitch(392);expect(e[0]).toBe("G")}),test("correctly identifies E4 around 329.63 Hz",function(){var e=TunerUtils.frequencyToPitch(329.63);expect(e[0]).toBe("E")}),test("correctly identifies D4 around 293.66 Hz",function(){var e=TunerUtils.frequencyToPitch(293.66);expect(e[0]).toBe("D")}),test("correctly identifies B4 around 493.88 Hz",function(){var e=TunerUtils.frequencyToPitch(493.88);expect(e[0]).toBe("B")}),test("identifies all 12 chromatic notes in octave 4",function(){for(var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=[261.63,277.18,293.66,311.13,329.63,349.23,369.99,392,415.3,440,466.16,493.88],n=0;n<e.length;n++){var c=TunerUtils.frequencyToPitch(t[n]);expect(c[0]).toBe(e[n])}})}),describe("cents deviation",function(){test("returns cents close to 0 for exact A4 frequency",function(){var e=TunerUtils.frequencyToPitch(440);expect(Math.abs(e[1])).toBeLessThanOrEqual(5)}),test("returns positive cents for sharp frequency",function(){var e=TunerUtils.frequencyToPitch(450);expect(e[1]).toBeGreaterThan(0)}),test("returns negative cents for flat frequency",function(){var e=TunerUtils.frequencyToPitch(430);expect(e[1]).toBeLessThan(0)}),test("cents deviation stays within -50 to +50 range for nearby notes",function(){var e=TunerUtils.frequencyToPitch(442),t=TunerUtils.frequencyToPitch(438);expect(Math.abs(e[1])).toBeLessThan(50),expect(Math.abs(t[1])).toBeLessThan(50)})}),describe("edge cases",function(){test("handles frequencies below C0",function(){var e=TunerUtils.frequencyToPitch(10);expect(e[0]).toBe("C"),expect(e[1]).toBe(0),expect(e[2]).toBeCloseTo(16.35,1)}),test("handles very high frequencies",function(){var e=TunerUtils.frequencyToPitch(4186);expect(e).toHaveLength(3),expect(["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]).toContain(e[0])}),test("handles A3 (octave below A4)",function(){var e=TunerUtils.frequencyToPitch(220);expect(e[0]).toBe("A")}),test("handles A5 (octave above A4)",function(){var e=TunerUtils.frequencyToPitch(880);expect(e[0]).toBe("A")}),test("preserves original frequency in return value",function(){var e=523.25,t=TunerUtils.frequencyToPitch(e);expect(t[2]).toBe(e)})})}),describe("TunerUtils.calculatePlaybackRate",function(){describe("standard intervals",function(){test("returns 1 for zero cents adjustment",function(){var e=TunerUtils.calculatePlaybackRate(0,0);expect(e).toBeCloseTo(1,5)}),test("returns 2 for octave up (1200 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,1200);expect(e).toBeCloseTo(2,5)}),test("returns 0.5 for octave down (-1200 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,-1200);expect(e).toBeCloseTo(.5,5)}),test("returns correct rate for semitone up (100 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,100),t=Math.pow(2,1/12);expect(e).toBeCloseTo(t,5)}),test("returns correct rate for semitone down (-100 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,-100),t=Math.pow(2,-1/12);expect(e).toBeCloseTo(t,5)}),test("returns correct rate for whole tone (200 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,200),t=Math.pow(2,2/12);expect(e).toBeCloseTo(t,5)}),test("returns correct rate for perfect fifth (700 cents)",function(){var e=TunerUtils.calculatePlaybackRate(0,700),t=Math.pow(2,7/12);expect(e).toBeCloseTo(t,5)})}),describe("base cents accumulation",function(){test("accumulates baseCents and adjustment",function(){var e=TunerUtils.calculatePlaybackRate(600,600);expect(e).toBeCloseTo(2,5)}),test("handles negative base cents",function(){var e=TunerUtils.calculatePlaybackRate(-600,0);expect(e).toBeCloseTo(Math.pow(2,-.5),5)}),test("negative base with positive adjustment",function(){var e=TunerUtils.calculatePlaybackRate(-100,100);expect(e).toBeCloseTo(1,5)}),test("positive base with negative adjustment",function(){var e=TunerUtils.calculatePlaybackRate(300,-300);expect(e).toBeCloseTo(1,5)})}),describe("edge cases",function(){test("handles very large cents values",function(){var e=TunerUtils.calculatePlaybackRate(0,2400);expect(e).toBeCloseTo(4,5)}),test("handles very small cents values",function(){var e=TunerUtils.calculatePlaybackRate(0,1);expect(e).toBeCloseTo(1,2)}),test("handles fractional cents",function(){var e=TunerUtils.calculatePlaybackRate(0,50.5);expect(e).toBeGreaterThan(1),expect(e).toBeLessThan(Math.pow(2,1/12))})})}),describe("TunerDisplay",function(){var n,t;beforeEach(function(){t={clearRect:jest.fn(),fillRect:jest.fn(),fillText:jest.fn(),fillStyle:"",font:"",textAlign:""},n={getContext:jest.fn().mockReturnValue(t),parentElement:{appendChild:jest.fn()},width:400,height:300}}),describe("Constructor",function(){test("stores canvas reference",function(){var e=new TunerDisplay(n,400,300);expect(e.canvas).toBe(n)}),test("stores width and height",function(){var e=new TunerDisplay(n,400,300);expect(e.width).toBe(400),expect(e.height).toBe(300)}),test("gets 2D rendering context",function(){var e=new TunerDisplay(n,400,300);expect(n.getContext).toHaveBeenCalledWith("2d"),expect(e.ctx).toBe(t)}),test("initializes with default note A",function(){var e=new TunerDisplay(n,400,300);expect(e.note).toBe("A")}),test("initializes with default cents 0",function(){var e=new TunerDisplay(n,400,300);expect(e.cents).toBe(0)}),test("initializes with default frequency 440",function(){var e=new TunerDisplay(n,400,300);expect(e.frequency).toBe(440)}),test("defaults to chromatic mode",function(){var e=new TunerDisplay(n,400,300);expect(e.chromaticMode).toBe(!0)}),test("creates mode container element",function(){var e=new TunerDisplay(n,400,300);expect(e.modeContainer).toBeDefined()}),test("appends mode container to canvas parent",function(){new TunerDisplay(n,400,300),expect(n.parentElement.appendChild).toHaveBeenCalled()}),test("creates chromatic button",function(){var e=new TunerDisplay(n,400,300);expect(e.chromaticButton).toBeDefined()}),test("creates target pitch button",function(){var e=new TunerDisplay(n,400,300);expect(e.targetPitchButton).toBeDefined()}),test("calls updateButtonStyles on initialization",function(){var e=new TunerDisplay(n,400,300);expect(e.chromaticMode).toBe(!0)})}),describe("updateButtonStyles",function(){test("highlights chromatic button when in chromatic mode",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!0,e.updateButtonStyles(),expect(e.chromaticButton.style.backgroundColor).toBeTruthy()}),test("removes highlight from target button when in chromatic mode",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!0,e.updateButtonStyles(),expect(e.targetPitchButton.style.backgroundColor).toBe("transparent")}),test("highlights target button when not in chromatic mode",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!1,e.updateButtonStyles(),expect(e.targetPitchButton.style.backgroundColor).toBeTruthy()}),test("removes highlight from chromatic button when not in chromatic mode",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!1,e.updateButtonStyles(),expect(e.chromaticButton.style.backgroundColor).toBe("transparent")})}),describe("update",function(){test("updates note property",function(){var e=new TunerDisplay(n,400,300);e.update("C",10,261.63),expect(e.note).toBe("C")}),test("updates cents property",function(){var e=new TunerDisplay(n,400,300);e.update("C",15,261.63),expect(e.cents).toBe(15)}),test("updates frequency property",function(){var e=new TunerDisplay(n,400,300);e.update("C",10,265),expect(e.frequency).toBe(265)}),test("calls draw after update",function(){var e=new TunerDisplay(n,400,300),t=jest.spyOn(e,"draw");e.update("G",-5,392),expect(t).toHaveBeenCalled()}),test("handles negative cents",function(){var e=new TunerDisplay(n,400,300);e.update("E",-25,325),expect(e.cents).toBe(-25)}),test("handles sharp notes",function(){var e=new TunerDisplay(n,400,300);e.update("C#",0,277.18),expect(e.note).toBe("C#")})}),describe("draw",function(){test("clears the canvas before drawing",function(){new TunerDisplay(n,400,300).draw(),expect(t.clearRect).toHaveBeenCalledWith(0,0,400,300)}),test("draws the meter background",function(){new TunerDisplay(n,400,300).draw(),expect(t.fillRect).toHaveBeenCalled()}),test("displays the note text",function(){var e=new TunerDisplay(n,400,300);e.note="G",e.draw(),expect(t.fillText).toHaveBeenCalledWith("G",expect.any(Number),expect.any(Number))}),test("displays frequency with Hz suffix",function(){var e=new TunerDisplay(n,400,300);e.frequency=440,e.draw(),expect(t.fillText).toHaveBeenCalledWith("440.0 Hz",expect.any(Number),expect.any(Number))}),test("displays positive cents with + prefix",function(){var e=new TunerDisplay(n,400,300);e.cents=15,e.draw(),expect(t.fillText).toHaveBeenCalledWith("+15¢",expect.any(Number),expect.any(Number))}),test("displays negative cents without + prefix",function(){var e=new TunerDisplay(n,400,300);e.cents=-20,e.draw(),expect(t.fillText).toHaveBeenCalledWith("-20¢",expect.any(Number),expect.any(Number))}),test("displays zero cents with + prefix",function(){var e=new TunerDisplay(n,400,300);e.cents=0,e.draw(),expect(t.fillText).toHaveBeenCalledWith("+0¢",expect.any(Number),expect.any(Number))}),test("sets text alignment to center",function(){new TunerDisplay(n,400,300).draw(),expect(t.textAlign).toBe("center")})}),describe("button click handlers",function(){test("clicking chromatic button sets chromaticMode to true",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!1,e.chromaticButton.onclick(),expect(e.chromaticMode).toBe(!0)}),test("clicking target pitch button sets chromaticMode to false",function(){var e=new TunerDisplay(n,400,300);e.chromaticMode=!0,e.targetPitchButton.onclick(),expect(e.chromaticMode).toBe(!1)}),test("clicking chromatic button updates button styles",function(){var e=new TunerDisplay(n,400,300),t=jest.spyOn(e,"updateButtonStyles");e.chromaticButton.onclick(),expect(t).toHaveBeenCalled()}),test("clicking target pitch button updates button styles",function(){var e=new TunerDisplay(n,400,300),t=jest.spyOn(e,"updateButtonStyles");e.targetPitchButton.onclick(),expect(t).toHaveBeenCalled()})})})});
var JSInterface={validateArgs:jest.fn()},DictBlocksAPI=(global.JSInterface=JSInterface,global.globalActivity={turtles:{ithTurtle:jest.fn(function(){return{name:"defaultDict"}})}},require("../DictBlocksAPI"));describe("DictBlocksAPI",function(){var e;beforeEach(function(){(e=new DictBlocksAPI).turIndex=0,e.runCommand=jest.fn()}),afterEach(function(){jest.clearAllMocks()}),test("getDict calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue(["mockDict"]),e.getDict("testDict"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("getDict",["testDict"]),expect(e.runCommand).toHaveBeenCalledWith("getDict",["mockDict",0])}),test("getDict uses default turIndex when no dict is provided",function(){JSInterface.validateArgs.mockReturnValue(["defaultDict"]),e.getDict(),expect(JSInterface.validateArgs).toHaveBeenCalledWith("getDict",[0]),expect(e.runCommand).toHaveBeenCalledWith("getDict",["defaultDict",0])}),test("showDict calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue(["mockDict"]),e.showDict("testDict"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("showDict",["testDict"]),expect(e.runCommand).toHaveBeenCalledWith("showDict",["mockDict",0])}),test("showDict uses default turIndex when no dict is provided",function(){JSInterface.validateArgs.mockReturnValue(["defaultDict"]),e.showDict(),expect(JSInterface.validateArgs).toHaveBeenCalledWith("showDict",[0]),expect(e.runCommand).toHaveBeenCalledWith("showDict",["defaultDict",0])}),test("setValue calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue(["key","value","testDict"]),e.setValue("key","value","testDict"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setValue",["key","value","testDict"]),expect(e.runCommand).toHaveBeenCalledWith("setValue",["testDict","key","value",0])}),test("setValue uses default dict when no dict is provided",function(){JSInterface.validateArgs.mockReturnValue(["key","value","defaultDict"]),global.globalActivity.turtles.ithTurtle.mockReturnValue({name:"defaultDict"}),e.setValue("key","value"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setValue",["key","value","defaultDict"]),expect(e.runCommand).toHaveBeenCalledWith("setValue",["defaultDict","key","value",0])}),test("getValue calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue(["key","testDict"]),e.getValue("key","testDict"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("getValue",["key","testDict"]),expect(e.runCommand).toHaveBeenCalledWith("getValue",["testDict","key",0])}),test("getValue uses default dict when no dict is provided",function(){JSInterface.validateArgs.mockReturnValue(["key","defaultDict"]),global.globalActivity.turtles.ithTurtle.mockReturnValue({name:"defaultDict"}),e.getValue("key"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("getValue",["key","defaultDict"]),expect(e.runCommand).toHaveBeenCalledWith("getValue",["defaultDict","key",0])})});
function _regenerator(){var v,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var o,a,c,i,u,l,f,s,m,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=r,f=n||[],s=!1,m={p:l=0,n:0,v:v,a:p,f:p.bind(v,4),d:function(e,t){return c=e,i=0,u=v,m.n=t,d}},function(e,t,r){if(1<l)throw TypeError("Generator is already running");for(s&&1===t&&p(t,r),i=t,u=r;(h=i<2?v:u)||!s;){c||(i?i<3?(1<i&&(m.n=-1),p(i,u)):m.n=u:m.v=u);try{if(l=2,c){if(h=c[e=i?e:"next"]){if(!(h=h.call(c,u)))throw TypeError("iterator result is not an object");if(!h.done)return h;u=h.value,i<2&&(i=0)}else 1===i&&(h=c.return)&&h.call(c),i<2&&(u=TypeError("The iterator does not provide a '"+e+"' method"),i=1);c=v}else if((h=(s=m.n<0)?u:o.call(a,m))!==d)break}catch(e){c=v,i=1,u=e}finally{l=1}}return{value:h,done:s}}),!0),t;function p(e,t){for(i=e,u=t,h=0;!s&&l&&!r&&h<f.length;h++){var r,n=f[h],o=m.p,a=n[2];3<e?(r=a===t)&&(u=n[(i=n[4])?5:i=3],n[4]=n[5]=v):n[0]<=o&&((r=e<2&&o<n[1])?(i=0,m.v=t,m.n=n[1]):o<a&&(r=e<3||n[0]>t||a<t)&&(n[4]=e,n[5]=t,m.n=a,i=0))}if(r||1<e)return d;throw s=!0,t}}var d={};function g(){}function o(){}function a(){}var h=Object.getPrototypeOf,e=[][t]?h(h([][t]())):(_regeneratorDefine2(h={},t,function(){return this}),h),c=a.prototype=g.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(c),e}return _regeneratorDefine2(c,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,r,o.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,r,"Generator"),_regeneratorDefine2(c,t,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:i}})()}function _regeneratorDefine2(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,r,n){function o(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,r){var n=i.apply(e,c);function o(e){asyncGeneratorStep(n,t,r,o,a,"next",e)}function a(e){asyncGeneratorStep(n,t,r,o,a,"throw",e)}o(void 0)})}}var JSInterface={validateArgs:jest.fn()},DrumBlocksAPI=(global.JSInterface=JSInterface,global.MusicBlocks={BLK:"mockBlock"},require("../DrumBlocksAPI"));describe("DrumBlocksAPI",function(){var n;beforeEach(function(){(n=new DrumBlocksAPI).turIndex=0,n.runCommand=jest.fn()}),afterEach(function(){jest.clearAllMocks()}),test("playDrum calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue(["snare"]),n.playDrum("snare"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("playDrum",["snare"]),expect(n.runCommand).toHaveBeenCalledWith("playDrum",["snare",0,global.MusicBlocks.BLK])}),test("setDrum calls runCommand and executes flow function",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue(["kick",t]),e.n=1,n.setDrum("kick",t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("setDrum",["kick",t]),expect(n.runCommand).toHaveBeenCalledWith("setDrum",["kick",0]),expect(t).toHaveBeenCalled(),expect(r).toBe(n.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("mapPitchToDrum calls runCommand and executes flow function",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue(["tom",t]),e.n=1,n.mapPitchToDrum("tom",t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("mapPitchToDrum",["tom",t]),expect(n.runCommand).toHaveBeenCalledWith("mapPitchToDrum",["tom",0]),expect(t).toHaveBeenCalled(),expect(r).toBe(n.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("playNoise calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue(["white"]),n.playNoise("white"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("playNoise",["white"]),expect(n.runCommand).toHaveBeenCalledWith("playNoise",["white",0])})});
var JSInterface={validateArgs:jest.fn()},GraphicsBlocksAPI=(global.JSInterface=JSInterface,global.globalActivity={turtles:{ithTurtle:jest.fn(function(){return{name:"defaultDict"}})}},require("../GraphicsBlocksAPI"));describe("GraphicsBlocksAPI",function(){var e;beforeEach(function(){(e=new GraphicsBlocksAPI).turIndex=0,e.runCommand=jest.fn()}),afterEach(function(){jest.clearAllMocks()}),test("goForward calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([5]),e.goForward(5),expect(JSInterface.validateArgs).toHaveBeenCalledWith("goForward",[5]),expect(e.runCommand).toHaveBeenCalledWith("doForward",[5])}),test("goBackward calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([5]),e.goBackward(5),expect(JSInterface.validateArgs).toHaveBeenCalledWith("goBackward",[5]),expect(e.runCommand).toHaveBeenCalledWith("doForward",[-5])}),test("turnRight calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([90]),e.turnRight(90),expect(JSInterface.validateArgs).toHaveBeenCalledWith("turnRight",[90]),expect(e.runCommand).toHaveBeenCalledWith("doRight",[90])}),test("turnLeft calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([90]),e.turnLeft(90),expect(JSInterface.validateArgs).toHaveBeenCalledWith("turnLeft",[90]),expect(e.runCommand).toHaveBeenCalledWith("doRight",[-90])}),test("setXY calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([10,20]),e.setXY(10,20),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setXY",[10,20]),expect(e.runCommand).toHaveBeenCalledWith("doSetXY",[10,20])}),test("setHeading calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([90]),e.setHeading(90),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setHeading",[90]),expect(e.runCommand).toHaveBeenCalledWith("doSetHeading",[90])}),test("drawArc calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([45,10]),e.drawArc(45,10),expect(JSInterface.validateArgs).toHaveBeenCalledWith("drawArc",[45,10]),expect(e.runCommand).toHaveBeenCalledWith("doArc",[45,10])}),test("drawBezier calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([15,25]),e.drawBezier(15,25),expect(JSInterface.validateArgs).toHaveBeenCalledWith("drawBezier",[15,25]),expect(e.runCommand).toHaveBeenCalledWith("doBezier",[15,25])}),test("setBezierControlPoint1 calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([5,10]),e.setBezierControlPoint1(5,10),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setBezierControlPoint1",[5,10]),expect(e.runCommand).toHaveBeenCalledWith("setControlPoint1",[5,10])}),test("setBezierControlPoint2 calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([10,15]),e.setBezierControlPoint2(10,15),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setBezierControlPoint2",[10,15]),expect(e.runCommand).toHaveBeenCalledWith("setControlPoint2",[10,15])}),test("clear calls runCommand with correct arguments",function(){e.clear(),expect(e.runCommand).toHaveBeenCalledWith("doClear",[!0,!0,!0])}),test("scrollXY calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue([10,20]),e.scrollXY(10,20),expect(JSInterface.validateArgs).toHaveBeenCalledWith("scrollXY",[10,20]),expect(e.runCommand).toHaveBeenCalledWith("doScrollXY",[10,20])})});
function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var a,o,c,i,l,u,s,f,d,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(a=e,o=r,s=n||[],f=!1,d={p:u=0,n:0,v:m,a:v,f:v.bind(m,4),d:function(e,t){return c=e,i=0,l=m,d.n=t,p}},function(e,t,r){if(1<u)throw TypeError("Generator is already running");for(f&&1===t&&v(t,r),i=t,l=r;(y=i<2?m:l)||!f;){c||(i?i<3?(1<i&&(d.n=-1),v(i,l)):d.n=l:d.v=l);try{if(u=2,c){if(y=c[e=i?e:"next"]){if(!(y=y.call(c,l)))throw TypeError("iterator result is not an object");if(!y.done)return y;l=y.value,i<2&&(i=0)}else 1===i&&(y=c.return)&&y.call(c),i<2&&(l=TypeError("The iterator does not provide a '"+e+"' method"),i=1);c=m}else if((y=(f=d.n<0)?l:a.call(o,d))!==p)break}catch(e){c=m,i=1,l=e}finally{u=1}}return{value:y,done:f}}),!0),t;function v(e,t){for(i=e,l=t,y=0;!f&&u&&!r&&y<s.length;y++){var r,n=s[y],a=d.p,o=n[2];3<e?(r=o===t)&&(l=n[(i=n[4])?5:i=3],n[4]=n[5]=m):n[0]<=a&&((r=e<2&&a<n[1])?(i=0,d.v=t,d.n=n[1]):a<o&&(r=e<3||n[0]>t||o<t)&&(n[4]=e,n[5]=t,d.n=o,i=0))}if(r||1<e)return p;throw f=!0,t}}var p={};function g(){}function a(){}function o(){}var y=Object.getPrototypeOf,e=[][t]?y(y([][t]())):(_regeneratorDefine2(y={},t,function(){return this}),y),c=o.prototype=g.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(c),e}return _regeneratorDefine2(c,"constructor",a.prototype=o),_regeneratorDefine2(o,"constructor",a),_regeneratorDefine2(o,r,a.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,r,"Generator"),_regeneratorDefine2(c,t,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:i}})()}function _regeneratorDefine2(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(_regeneratorDefine2=function(e,t,r,n){function a(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,a,o,c){try{var i=e[o](c),l=i.value}catch(e){return void r(e)}i.done?t(l):Promise.resolve(l).then(n,a)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,r){var n=i.apply(e,c);function a(e){asyncGeneratorStep(n,t,r,a,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,a,o,"throw",e)}a(void 0)})}}var JSInterface={validateArgs:jest.fn()},IntervalsBlocksAPI=(global.JSInterface=JSInterface,require("../IntervalsBlocksAPI")),MusicBlocks={BLK:"mockedBlock"};global.MusicBlocks=MusicBlocks,describe("IntervalsBlocksAPI",function(){var r;beforeEach(function(){(r=new IntervalsBlocksAPI).turIndex=1,r.ENDFLOWCOMMAND="end",r.runCommand=jest.fn()}),test("setKey calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue(["C","major"]),r.setKey("C","major"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setKey",["C","major"]),expect(r.runCommand).toHaveBeenCalledWith("setKey",["C","major",1])}),test("defineMode calls runCommand and awaits flow",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue(["dorian",t]),e.n=1,r.defineMode("dorian",t);case 1:expect(JSInterface.validateArgs).toHaveBeenCalledWith("defineMode",["dorian",t]),expect(r.runCommand).toHaveBeenCalledWith("defineMode",["dorian",1,"mockedBlock"]),expect(t).toHaveBeenCalled();case 2:return e.a(2)}},e)}))),test("setScalarInterval calls runCommand and awaits flow",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([5,t]),e.n=1,r.setScalarInterval(5,t);case 1:expect(JSInterface.validateArgs).toHaveBeenCalledWith("setScalarInterval",[5,t]),expect(r.runCommand).toHaveBeenCalledWith("setScalarInterval",[5,1]),expect(t).toHaveBeenCalled();case 2:return e.a(2)}},e)}))),test("setSemitoneInterval calls runCommand and awaits flow",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([7,t]),e.n=1,r.setSemitoneInterval(7,t);case 1:expect(JSInterface.validateArgs).toHaveBeenCalledWith("setSemitoneInterval",[7,t]),expect(r.runCommand).toHaveBeenCalledWith("setSemitoneInterval",[7,1]),expect(t).toHaveBeenCalled();case 2:return e.a(2)}},e)}))),test("setTemperament calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue(["equal",440,4]),r.setTemperament("equal",440,4),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setTemperament",["equal",440,4]),expect(r.runCommand).toHaveBeenCalledWith("setTemperament",["equal",440,4])})});
function _regenerator(){var g,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var a,o,l,i,c,u,s,f,d,t=t&&t.prototype instanceof p?t:p,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(a=e,o=n,s=r||[],f=!1,d={p:u=0,n:0,v:g,a:v,f:v.bind(g,4),d:function(e,t){return l=e,i=0,c=g,d.n=t,m}},function(e,t,n){if(1<u)throw TypeError("Generator is already running");for(f&&1===t&&v(t,n),i=t,c=n;(h=i<2?g:c)||!f;){l||(i?i<3?(1<i&&(d.n=-1),v(i,c)):d.n=c:d.v=c);try{if(u=2,l){if(h=l[e=i?e:"next"]){if(!(h=h.call(l,c)))throw TypeError("iterator result is not an object");if(!h.done)return h;c=h.value,i<2&&(i=0)}else 1===i&&(h=l.return)&&h.call(l),i<2&&(c=TypeError("The iterator does not provide a '"+e+"' method"),i=1);l=g}else if((h=(f=d.n<0)?c:a.call(o,d))!==m)break}catch(e){l=g,i=1,c=e}finally{u=1}}return{value:h,done:f}}),!0),t;function v(e,t){for(i=e,c=t,h=0;!f&&u&&!n&&h<s.length;h++){var n,r=s[h],a=d.p,o=r[2];3<e?(n=o===t)&&(c=r[(i=r[4])?5:i=3],r[4]=r[5]=g):r[0]<=a&&((n=e<2&&a<r[1])?(i=0,d.v=t,d.n=r[1]):a<o&&(n=e<3||r[0]>t||o<t)&&(r[4]=e,r[5]=t,d.n=o,i=0))}if(n||1<e)return m;throw f=!0,t}}var m={};function p(){}function a(){}function o(){}var h=Object.getPrototypeOf,e=[][t]?h(h([][t]())):(_regeneratorDefine2(h={},t,function(){return this}),h),l=o.prototype=p.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(l),e}return _regeneratorDefine2(l,"constructor",a.prototype=o),_regeneratorDefine2(o,"constructor",a),_regeneratorDefine2(o,n,a.displayName="GeneratorFunction"),_regeneratorDefine2(l),_regeneratorDefine2(l,n,"Generator"),_regeneratorDefine2(l,t,function(){return this}),_regeneratorDefine2(l,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:i}})()}function _regeneratorDefine2(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(_regeneratorDefine2=function(e,t,n,r){function a(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))})(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,a,o,l){try{var i=e[o](l),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function _asyncToGenerator(i){return function(){var e=this,l=arguments;return new Promise(function(t,n){var r=i.apply(e,l);function a(e){asyncGeneratorStep(r,t,n,a,o,"next",e)}function o(e){asyncGeneratorStep(r,t,n,a,o,"throw",e)}a(void 0)})}}var JSInterface={validateArgs:jest.fn()},MeterBlocksAPI=(global.JSInterface=JSInterface,require("../MeterBlocksAPI")),Singer={MeterActions:{getNotesPlayed:jest.fn()}};global.Singer=Singer,describe("MeterBlocksAPI",function(){var n;beforeEach(function(){(n=new MeterBlocksAPI).turIndex=1,n.ENDFLOWCOMMAND="end",n.runCommand=jest.fn()}),test("setMeter calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([4,4]),n.setMeter(4,4),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setMeter",[4,4]),expect(n.runCommand).toHaveBeenCalledWith("setMeter",[4,4,1])}),test("setBPM calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([120,4]),n.setBPM(120,4),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setBPM",[120,4]),expect(n.runCommand).toHaveBeenCalledWith("setBPM",[120,4,1])}),test("setMasterBPM calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([100,4]),n.setMasterBPM(100,4),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setMasterBPM",[100,4]),expect(n.runCommand).toHaveBeenCalledWith("setMasterBPM",[100,4])}),test("onEveryNoteDo calls runCommand with validated arguments",function(){var e=jest.fn();JSInterface.validateArgs.mockReturnValue([e]),n.onEveryNoteDo(e),expect(JSInterface.validateArgs).toHaveBeenCalledWith("onEveryNoteDo",[e]),expect(n.runCommand).toHaveBeenCalledWith("onEveryNoteDo",[e,null,null,1])}),test("onEveryBeatDo calls runCommand with validated arguments",function(){var e=jest.fn();JSInterface.validateArgs.mockReturnValue([e]),n.onEveryBeatDo(e),expect(JSInterface.validateArgs).toHaveBeenCalledWith("onEveryBeatDo",[e]),expect(n.runCommand).toHaveBeenCalledWith("onEveryBeatDo",[e,null,null,1])}),test("onStrongBeatDo calls runCommand with validated arguments",function(){var e=jest.fn();JSInterface.validateArgs.mockReturnValue([2,e]),n.onStrongBeatDo(2,e),expect(JSInterface.validateArgs).toHaveBeenCalledWith("onStrongBeatDo",[2,e]),expect(n.runCommand).toHaveBeenCalledWith("onStrongBeatDo",[2,e,null,null,1])}),test("onWeakBeatDo calls runCommand with validated arguments",function(){var e=jest.fn();JSInterface.validateArgs.mockReturnValue([e]),n.onWeakBeatDo(e),expect(JSInterface.validateArgs).toHaveBeenCalledWith("onWeakBeatDo",[e]),expect(n.runCommand).toHaveBeenCalledWith("onWeakBeatDo",[e,null,null,1])}),test("setNoClock calls runCommand and awaits flow",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([t]),e.n=1,n.setNoClock(t);case 1:expect(JSInterface.validateArgs).toHaveBeenCalledWith("setNoClock",[t]),expect(n.runCommand).toHaveBeenCalledWith("setNoClock",[1]),expect(t).toHaveBeenCalled();case 2:return e.a(2)}},e)}))),test("getNotesPlayed calls Singer.MeterActions.getNotesPlayed with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([4]),n.getNotesPlayed(4),expect(JSInterface.validateArgs).toHaveBeenCalledWith("getNotesPlayed",[4]),expect(Singer.MeterActions.getNotesPlayed).toHaveBeenCalledWith(4,1)})});
function _regenerator(){var v,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var o,a,c,i,u,l,s,f,d,t=t&&t.prototype instanceof m?t:m,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=r,s=n||[],f=!1,d={p:l=0,n:0,v:v,a:g,f:g.bind(v,4),d:function(e,t){return c=e,i=0,u=v,d.n=t,p}},function(e,t,r){if(1<l)throw TypeError("Generator is already running");for(f&&1===t&&g(t,r),i=t,u=r;(h=i<2?v:u)||!f;){c||(i?i<3?(1<i&&(d.n=-1),g(i,u)):d.n=u:d.v=u);try{if(l=2,c){if(h=c[e=i?e:"next"]){if(!(h=h.call(c,u)))throw TypeError("iterator result is not an object");if(!h.done)return h;u=h.value,i<2&&(i=0)}else 1===i&&(h=c.return)&&h.call(c),i<2&&(u=TypeError("The iterator does not provide a '"+e+"' method"),i=1);c=v}else if((h=(f=d.n<0)?u:o.call(a,d))!==p)break}catch(e){c=v,i=1,u=e}finally{l=1}}return{value:h,done:f}}),!0),t;function g(e,t){for(i=e,u=t,h=0;!f&&l&&!r&&h<s.length;h++){var r,n=s[h],o=d.p,a=n[2];3<e?(r=a===t)&&(u=n[(i=n[4])?5:i=3],n[4]=n[5]=v):n[0]<=o&&((r=e<2&&o<n[1])?(i=0,d.v=t,d.n=n[1]):o<a&&(r=e<3||n[0]>t||a<t)&&(n[4]=e,n[5]=t,d.n=a,i=0))}if(r||1<e)return p;throw f=!0,t}}var p={};function m(){}function o(){}function a(){}var h=Object.getPrototypeOf,e=[][t]?h(h([][t]())):(_regeneratorDefine2(h={},t,function(){return this}),h),c=a.prototype=m.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(c),e}return _regeneratorDefine2(c,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,r,o.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,r,"Generator"),_regeneratorDefine2(c,t,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:i}})()}function _regeneratorDefine2(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,r,n){function o(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,r){var n=i.apply(e,c);function o(e){asyncGeneratorStep(n,t,r,o,a,"next",e)}function a(e){asyncGeneratorStep(n,t,r,o,a,"throw",e)}o(void 0)})}}var JSInterface={validateArgs:jest.fn()},MusicBlocks=(global.JSInterface=JSInterface,{BLK:"MusicBlockTestValue"}),OrnamentBlocksAPI=(global.MusicBlocks=MusicBlocks,require("../OrnamentBlocksAPI"));describe("OrnamentBlocksAPI",function(){var n;beforeEach(function(){(n=new OrnamentBlocksAPI).turIndex=0,n.runCommand=jest.fn(),n.ENDFLOWCOMMAND="endFlow"}),afterEach(function(){jest.clearAllMocks()}),test("setStaccato calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([!0,t]),e.n=1,n.setStaccato(!0,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("setStaccato",[!0,t]),expect(n.runCommand).toHaveBeenCalledWith("setStaccato",[!0,0]),expect(t).toHaveBeenCalled(),expect(r).toBe("endFlow");case 2:return e.a(2)}},e)}))),test("setSlur calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([5,t]),e.n=1,n.setSlur(5,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("setSlur",[5,t]),expect(n.runCommand).toHaveBeenCalledWith("setSlur",[5,0]),expect(t).toHaveBeenCalled(),expect(r).toBe("endFlow");case 2:return e.a(2)}},e)}))),test("doNeighbor calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([2,3,t]),e.n=1,n.doNeighbor(2,3,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("doNeighbor",[2,3,t]),expect(n.runCommand).toHaveBeenCalledWith("doNeighbor",[2,3,0,"MusicBlockTestValue"]),expect(t).toHaveBeenCalled(),expect(r).toBe("endFlow");case 2:return e.a(2)}},e)})))});
function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var a,o,l,c,i,u,s,d,f,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(a=e,o=n,s=r||[],d=!1,f={p:u=0,n:0,v:m,a:v,f:v.bind(m,4),d:function(e,t){return l=e,c=0,i=m,f.n=t,p}},function(e,t,n){if(1<u)throw TypeError("Generator is already running");for(d&&1===t&&v(t,n),c=t,i=n;(C=c<2?m:i)||!d;){l||(c?c<3?(1<c&&(f.n=-1),v(c,i)):f.n=i:f.v=i);try{if(u=2,l){if(C=l[e=c?e:"next"]){if(!(C=C.call(l,i)))throw TypeError("iterator result is not an object");if(!C.done)return C;i=C.value,c<2&&(c=0)}else 1===c&&(C=l.return)&&C.call(l),c<2&&(i=TypeError("The iterator does not provide a '"+e+"' method"),c=1);l=m}else if((C=(d=f.n<0)?i:a.call(o,f))!==p)break}catch(e){l=m,c=1,i=e}finally{u=1}}return{value:C,done:d}}),!0),t;function v(e,t){for(c=e,i=t,C=0;!d&&u&&!n&&C<s.length;C++){var n,r=s[C],a=f.p,o=r[2];3<e?(n=o===t)&&(i=r[(c=r[4])?5:c=3],r[4]=r[5]=m):r[0]<=a&&((n=e<2&&a<r[1])?(c=0,f.v=t,f.n=r[1]):a<o&&(n=e<3||r[0]>t||o<t)&&(r[4]=e,r[5]=t,f.n=o,c=0))}if(n||1<e)return p;throw d=!0,t}}var p={};function g(){}function a(){}function o(){}var C=Object.getPrototypeOf,e=[][t]?C(C([][t]())):(_regeneratorDefine2(C={},t,function(){return this}),C),l=o.prototype=g.prototype=Object.create(e);function c(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(l),e}return _regeneratorDefine2(l,"constructor",a.prototype=o),_regeneratorDefine2(o,"constructor",a),_regeneratorDefine2(o,n,a.displayName="GeneratorFunction"),_regeneratorDefine2(l),_regeneratorDefine2(l,n,"Generator"),_regeneratorDefine2(l,t,function(){return this}),_regeneratorDefine2(l,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:c}})()}function _regeneratorDefine2(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(_regeneratorDefine2=function(e,t,n,r){function a(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))})(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,a,o,l){try{var c=e[o](l),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function _asyncToGenerator(c){return function(){var e=this,l=arguments;return new Promise(function(t,n){var r=c.apply(e,l);function a(e){asyncGeneratorStep(r,t,n,a,o,"next",e)}function o(e){asyncGeneratorStep(r,t,n,a,o,"throw",e)}a(void 0)})}}var JSInterface={validateArgs:jest.fn()},PenBlocksAPI=(global.JSInterface=JSInterface,require("../PenBlocksAPI"));global.globalActivity={turtles:{refreshCanvas:jest.fn()},logo:{turtles:{setBackgroundColor:jest.fn()}}},describe("PenBlocksAPI",function(){var n;beforeEach(function(){(n=new PenBlocksAPI).turIndex=1,n.ENDFLOW="end",n.runCommand=jest.fn()}),test("setColor calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([50]),n.setColor(50),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setColor",[50]),expect(n.runCommand).toHaveBeenCalledWith("doSetColor",[50])}),test("setGrey calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([30]),n.setGrey(30),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setGrey",[30]),expect(n.runCommand).toHaveBeenCalledWith("doSetChroma",[30])}),test("setShade calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([70]),n.setShade(70),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setShade",[70]),expect(n.runCommand).toHaveBeenCalledWith("doSetValue",[70])}),test("setHue calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([120]),n.setHue(120),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setHue",[120]),expect(n.runCommand).toHaveBeenCalledWith("doSetHue",[120])}),test("setTranslucency calculates and calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([80]),n.setTranslucency(80),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setTranslucency",[80]),expect(n.runCommand).toHaveBeenCalledWith("doSetPenAlpha",[1-.8])}),test("setPensize calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([10]),n.setPensize(10),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setPensize",[10]),expect(n.runCommand).toHaveBeenCalledWith("doSetPensize",[10])}),test("penUp calls runCommand",function(){n.penUp(),expect(n.runCommand).toHaveBeenCalledWith("doPenUp")}),test("penDown calls runCommand",function(){n.penDown(),expect(n.runCommand).toHaveBeenCalledWith("doPenDown")}),test("fillShape calls commands and refreshCanvas",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),e.n=1,n.fillShape(t);case 1:expect(n.runCommand).toHaveBeenCalledWith("doStartFill"),expect(t).toHaveBeenCalled(),expect(n.runCommand).toHaveBeenCalledWith("doEndFill"),expect(global.globalActivity.turtles.refreshCanvas).toHaveBeenCalled();case 2:return e.a(2)}},e)}))),test("hollowLine calls commands and refreshCanvas",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),e.n=1,n.hollowLine(t);case 1:expect(n.runCommand).toHaveBeenCalledWith("doStartHollowLine"),expect(t).toHaveBeenCalled(),expect(n.runCommand).toHaveBeenCalledWith("doEndHollowLine"),expect(global.globalActivity.turtles.refreshCanvas).toHaveBeenCalled();case 2:return e.a(2)}},e)}))),test("fillBackground calls setBackgroundColor",function(){n.fillBackground(),expect(n.runCommand).toHaveBeenCalledWith("_anonymous",expect.any(Function)),(0,n.runCommand.mock.calls[0][1])(),expect(global.globalActivity.logo.turtles.setBackgroundColor).toHaveBeenCalledWith(1)}),test("setFont calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue(["Arial"]),n.setFont("Arial"),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setFont",["Arial"]),expect(n.runCommand).toHaveBeenCalledWith("doSetFont",["Arial"])})});
function _regenerator(){var v,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function a(e,t,n,a){var r,o,c,i,l,s,u,d,f,t=t&&t.prototype instanceof p?t:p,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(r=e,o=n,u=a||[],d=!1,f={p:s=0,n:0,v:v,a:m,f:m.bind(v,4),d:function(e,t){return c=e,i=0,l=v,f.n=t,h}},function(e,t,n){if(1<s)throw TypeError("Generator is already running");for(d&&1===t&&m(t,n),i=t,l=n;(g=i<2?v:l)||!d;){c||(i?i<3?(1<i&&(f.n=-1),m(i,l)):f.n=l:f.v=l);try{if(s=2,c){if(g=c[e=i?e:"next"]){if(!(g=g.call(c,l)))throw TypeError("iterator result is not an object");if(!g.done)return g;l=g.value,i<2&&(i=0)}else 1===i&&(g=c.return)&&g.call(c),i<2&&(l=TypeError("The iterator does not provide a '"+e+"' method"),i=1);c=v}else if((g=(d=f.n<0)?l:r.call(o,f))!==h)break}catch(e){c=v,i=1,l=e}finally{s=1}}return{value:g,done:d}}),!0),t;function m(e,t){for(i=e,l=t,g=0;!d&&s&&!n&&g<u.length;g++){var n,a=u[g],r=f.p,o=a[2];3<e?(n=o===t)&&(l=a[(i=a[4])?5:i=3],a[4]=a[5]=v):a[0]<=r&&((n=e<2&&r<a[1])?(i=0,f.v=t,f.n=a[1]):r<o&&(n=e<3||a[0]>t||o<t)&&(a[4]=e,a[5]=t,f.n=o,i=0))}if(n||1<e)return h;throw d=!0,t}}var h={};function p(){}function r(){}function o(){}var g=Object.getPrototypeOf,e=[][t]?g(g([][t]())):(_regeneratorDefine2(g={},t,function(){return this}),g),c=o.prototype=p.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(c),e}return _regeneratorDefine2(c,"constructor",r.prototype=o),_regeneratorDefine2(o,"constructor",r),_regeneratorDefine2(o,n,r.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,n,"Generator"),_regeneratorDefine2(c,t,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:i}})()}function _regeneratorDefine2(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(_regeneratorDefine2=function(e,t,n,a){function r(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(r("next",0),r("throw",1),r("return",2))})(e,t,n,a)}function asyncGeneratorStep(e,t,n,a,r,o,c){try{var i=e[o](c),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(a,r)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,n){var a=i.apply(e,c);function r(e){asyncGeneratorStep(a,t,n,r,o,"next",e)}function o(e){asyncGeneratorStep(a,t,n,r,o,"throw",e)}r(void 0)})}}var JSInterface={validateArgs:jest.fn()},PitchBlocksAPI=(global.JSInterface=JSInterface,require("../PitchBlocksAPI"));global.MusicBlocks={BLK:"mockBlock"},global.Singer={PitchActions:{numToPitch:jest.fn()}},describe("PitchBlocksAPI",function(){var a;beforeEach(function(){(a=new PitchBlocksAPI).turIndex=1,a.ENDFLOWCOMMAND="end",a.runCommand=jest.fn()}),test("playPitch calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue(["C",4]),a.playPitch("C",4),expect(JSInterface.validateArgs).toHaveBeenCalledWith("playPitch",["C",4]),expect(a.runCommand).toHaveBeenCalledWith("playPitch",["C",4,0,1,MusicBlocks.BLK])}),test("stepPitch calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([2]),a.stepPitch(2),expect(JSInterface.validateArgs).toHaveBeenCalledWith("stepPitch",[2]),expect(a.runCommand).toHaveBeenCalledWith("stepPitch",[2,1])}),test("playNthModalPitch calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([3,5]),a.playNthModalPitch(3,5),expect(JSInterface.validateArgs).toHaveBeenCalledWith("playNthModalPitch",[3,5]),expect(a.runCommand).toHaveBeenCalledWith("playNthModalPitch",[3,5,1,MusicBlocks.BLK])}),test("playPitchNumber calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([7]),a.playPitchNumber(7),expect(JSInterface.validateArgs).toHaveBeenCalledWith("playPitchNumber",[7]),expect(a.runCommand).toHaveBeenCalledWith("playPitchNumber",[7,1,MusicBlocks.BLK])}),test("playHertz calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([440]),a.playHertz(440),expect(JSInterface.validateArgs).toHaveBeenCalledWith("playHertz",[440]),expect(a.runCommand).toHaveBeenCalledWith("playHertz",[440,1])}),test("setAccidental calls runCommand with validated arguments and executes flow",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue(["sharp",t]),e.n=1,a.setAccidental("sharp",t);case 1:n=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("setAccidental",["sharp",t]),expect(a.runCommand).toHaveBeenCalledWith("setAccidental",["sharp",1,MusicBlocks.BLK]),expect(t).toHaveBeenCalled(),expect(n).toBe(a.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("setScalarTranspose calls runCommand with validated arguments and executes flow",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([2,t]),e.n=1,a.setScalarTranspose(2,t);case 1:n=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("setScalarTranspose",[2,t]),expect(a.runCommand).toHaveBeenCalledWith("setScalarTranspose",[2,1]),expect(t).toHaveBeenCalled(),expect(n).toBe(a.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("setSemitoneTranspose calls runCommand with validated arguments and executes flow",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([1,t]),e.n=1,a.setSemitoneTranspose(1,t);case 1:n=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("setSemitoneTranspose",[1,t]),expect(a.runCommand).toHaveBeenCalledWith("setSemitoneTranspose",[1,1]),expect(t).toHaveBeenCalled(),expect(n).toBe(a.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("setRegister calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([3]),a.setRegister(3),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setRegister",[3]),expect(a.runCommand).toHaveBeenCalledWith("setRegister",[3,1])}),test("invert calls runCommand with validated arguments and executes flow",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue(["inversionName",4,"mode",t]),e.n=1,a.invert("inversionName",4,"mode",t);case 1:n=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("invert",["inversionName",4,"mode",t]),expect(a.runCommand).toHaveBeenCalledWith("invert",["inversionName",4,"mode",1]),expect(t).toHaveBeenCalled(),expect(n).toBe(a.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("setPitchNumberOffset calls runCommand with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([7,3]),a.setPitchNumberOffset(7,3),expect(JSInterface.validateArgs).toHaveBeenCalledWith("setPitchNumberOffset",[7,3]),expect(a.runCommand).toHaveBeenCalledWith("setPitchNumberOffset",[7,3,1])}),test("numToPitch calls numToPitch in Singer.PitchActions with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([5]),Singer.PitchActions.numToPitch.mockReturnValue("C");var e=a.numToPitch(5);expect(JSInterface.validateArgs).toHaveBeenCalledWith("numToPitch",[5]),expect(Singer.PitchActions.numToPitch).toHaveBeenCalledWith(5,"pitch",1),expect(e).toBe("C")}),test("numToOctave calls numToPitch in Singer.PitchActions with validated arguments",function(){JSInterface.validateArgs.mockReturnValue([5]),Singer.PitchActions.numToPitch.mockReturnValue(4);var e=a.numToOctave(5);expect(JSInterface.validateArgs).toHaveBeenCalledWith("numToOctave",[5]),expect(Singer.PitchActions.numToPitch).toHaveBeenCalledWith(5,"octave",1),expect(e).toBe(4)})});
function _regenerator(){var p,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var a,o,c,i,l,s,u,f,m,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(a=e,o=r,u=n||[],f=!1,m={p:s=0,n:0,v:p,a:d,f:d.bind(p,4),d:function(e,t){return c=e,i=0,l=p,m.n=t,v}},function(e,t,r){if(1<s)throw TypeError("Generator is already running");for(f&&1===t&&d(t,r),i=t,l=r;(h=i<2?p:l)||!f;){c||(i?i<3?(1<i&&(m.n=-1),d(i,l)):m.n=l:m.v=l);try{if(s=2,c){if(h=c[e=i?e:"next"]){if(!(h=h.call(c,l)))throw TypeError("iterator result is not an object");if(!h.done)return h;l=h.value,i<2&&(i=0)}else 1===i&&(h=c.return)&&h.call(c),i<2&&(l=TypeError("The iterator does not provide a '"+e+"' method"),i=1);c=p}else if((h=(f=m.n<0)?l:a.call(o,m))!==v)break}catch(e){c=p,i=1,l=e}finally{s=1}}return{value:h,done:f}}),!0),t;function d(e,t){for(i=e,l=t,h=0;!f&&s&&!r&&h<u.length;h++){var r,n=u[h],a=m.p,o=n[2];3<e?(r=o===t)&&(l=n[(i=n[4])?5:i=3],n[4]=n[5]=p):n[0]<=a&&((r=e<2&&a<n[1])?(i=0,m.v=t,m.n=n[1]):a<o&&(r=e<3||n[0]>t||o<t)&&(n[4]=e,n[5]=t,m.n=o,i=0))}if(r||1<e)return v;throw f=!0,t}}var v={};function g(){}function a(){}function o(){}var h=Object.getPrototypeOf,e=[][t]?h(h([][t]())):(_regeneratorDefine2(h={},t,function(){return this}),h),c=o.prototype=g.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(c),e}return _regeneratorDefine2(c,"constructor",a.prototype=o),_regeneratorDefine2(o,"constructor",a),_regeneratorDefine2(o,r,a.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,r,"Generator"),_regeneratorDefine2(c,t,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:i}})()}function _regeneratorDefine2(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(_regeneratorDefine2=function(e,t,r,n){function a(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,a,o,c){try{var i=e[o](c),l=i.value}catch(e){return void r(e)}i.done?t(l):Promise.resolve(l).then(n,a)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,r){var n=i.apply(e,c);function a(e){asyncGeneratorStep(n,t,r,a,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,a,o,"throw",e)}a(void 0)})}}var JSInterface={validateArgs:jest.fn()},RhythmBlocksAPI=(global.JSInterface=JSInterface,global.MusicBlocks={BLK:"mockBLK"},require("../RhythmBlocksAPI"));describe("RhythmBlocksAPI",function(){var n;beforeEach(function(){(n=new RhythmBlocksAPI).turIndex=0,n.runCommand=jest.fn(),n.ENDFLOWCOMMAND="END"}),afterEach(function(){jest.clearAllMocks()}),test("playNote calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([100,t]),e.n=1,n.playNote(100,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("playNote",[100,t]),expect(n.runCommand).toHaveBeenCalledWith("playNote",[100,"newnote",0,"mockBLK"]),expect(t).toHaveBeenCalled(),expect(r).toBe("END");case 2:return e.a(2)}},e)}))),test("playNoteMillis calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([1e3,t]),e.n=1,n.playNoteMillis(1e3,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("playNoteMillis",[1e3,t]),expect(n.runCommand).toHaveBeenCalledWith("playNote",[1e3,"osctime",0,"mockBLK"]),expect(t).toHaveBeenCalled(),expect(r).toBe("END");case 2:return e.a(2)}},e)}))),test("playRest calls runCommand with correct arguments",function(){n.playRest(),expect(n.runCommand).toHaveBeenCalledWith("playRest",[0])}),test("dot calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([1,t]),e.n=1,n.dot(1,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("dot",[1,t]),expect(n.runCommand).toHaveBeenCalledWith("doRhythmicDot",[1,0]),expect(t).toHaveBeenCalled(),expect(r).toBe("END");case 2:return e.a(2)}},e)}))),test("tie calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([void 0,t]),e.n=1,n.tie(t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("tie",[t]),expect(n.runCommand).toHaveBeenCalledWith("doTie",[0]),expect(t).toHaveBeenCalled(),expect(r).toBe("END");case 2:return e.a(2)}},e)}))),test("multiplyNoteValue calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([2,t]),e.n=1,n.multiplyNoteValue(2,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("multiplyNoteValue",[2,t]),expect(n.runCommand).toHaveBeenCalledWith("multiplyNoteValue",[2,0]),expect(t).toHaveBeenCalled(),expect(r).toBe("END");case 2:return e.a(2)}},e)}))),test("swing calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([1,4,t]),e.n=1,n.swing(1,4,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("multiplyNoteValue",[1,4,t]),expect(n.runCommand).toHaveBeenCalledWith("addSwing",[1,4,0]),expect(t).toHaveBeenCalled(),expect(r).toBe("END");case 2:return e.a(2)}},e)}))),test("methods handle validation errors correctly",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return JSInterface.validateArgs.mockImplementation(function(){throw new Error("Invalid arguments")}),e.n=1,expect(n.playNote()).rejects.toThrow("Invalid arguments");case 1:return e.n=2,expect(n.playNoteMillis()).rejects.toThrow("Invalid arguments");case 2:return e.n=3,expect(n.dot()).rejects.toThrow("Invalid arguments");case 3:return e.n=4,expect(n.tie()).rejects.toThrow("Invalid arguments");case 4:return e.n=5,expect(n.multiplyNoteValue()).rejects.toThrow("Invalid arguments");case 5:return e.n=6,expect(n.swing()).rejects.toThrow("Invalid arguments");case 6:return e.a(2)}},e)}))),test("methods handle command execution errors correctly",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return JSInterface.validateArgs.mockReturnValue([1,jest.fn()]),n.runCommand.mockRejectedValue(new Error("Command failed")),e.n=1,expect(n.playNote(1,jest.fn())).rejects.toThrow("Command failed");case 1:return e.n=2,expect(n.playNoteMillis(1,jest.fn())).rejects.toThrow("Command failed");case 2:return e.n=3,expect(n.playRest()).rejects.toThrow("Command failed");case 3:return e.n=4,expect(n.dot(1,jest.fn())).rejects.toThrow("Command failed");case 4:return e.n=5,expect(n.tie(jest.fn())).rejects.toThrow("Command failed");case 5:return e.n=6,expect(n.multiplyNoteValue(2,jest.fn())).rejects.toThrow("Command failed");case 6:return e.n=7,expect(n.swing(1,4,jest.fn())).rejects.toThrow("Command failed");case 7:return e.a(2)}},e)})))});
function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var a,o,c,i,u,s,l,d,f,t=t&&t.prototype instanceof p?t:p,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(a=e,o=r,l=n||[],d=!1,f={p:s=0,n:0,v:m,a:v,f:v.bind(m,4),d:function(e,t){return c=e,i=0,u=m,f.n=t,g}},function(e,t,r){if(1<s)throw TypeError("Generator is already running");for(d&&1===t&&v(t,r),i=t,u=r;(h=i<2?m:u)||!d;){c||(i?i<3?(1<i&&(f.n=-1),v(i,u)):f.n=u:f.v=u);try{if(s=2,c){if(h=c[e=i?e:"next"]){if(!(h=h.call(c,u)))throw TypeError("iterator result is not an object");if(!h.done)return h;u=h.value,i<2&&(i=0)}else 1===i&&(h=c.return)&&h.call(c),i<2&&(u=TypeError("The iterator does not provide a '"+e+"' method"),i=1);c=m}else if((h=(d=f.n<0)?u:a.call(o,f))!==g)break}catch(e){c=m,i=1,u=e}finally{s=1}}return{value:h,done:d}}),!0),t;function v(e,t){for(i=e,u=t,h=0;!d&&s&&!r&&h<l.length;h++){var r,n=l[h],a=f.p,o=n[2];3<e?(r=o===t)&&(u=n[(i=n[4])?5:i=3],n[4]=n[5]=m):n[0]<=a&&((r=e<2&&a<n[1])?(i=0,f.v=t,f.n=n[1]):a<o&&(r=e<3||n[0]>t||o<t)&&(n[4]=e,n[5]=t,f.n=o,i=0))}if(r||1<e)return g;throw d=!0,t}}var g={};function p(){}function a(){}function o(){}var h=Object.getPrototypeOf,e=[][t]?h(h([][t]())):(_regeneratorDefine2(h={},t,function(){return this}),h),c=o.prototype=p.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(c),e}return _regeneratorDefine2(c,"constructor",a.prototype=o),_regeneratorDefine2(o,"constructor",a),_regeneratorDefine2(o,r,a.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,r,"Generator"),_regeneratorDefine2(c,t,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:i}})()}function _regeneratorDefine2(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(_regeneratorDefine2=function(e,t,r,n){function a(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,r){var n=i.apply(e,c);function a(e){asyncGeneratorStep(n,t,r,a,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,a,o,"throw",e)}a(void 0)})}}var JSInterface={validateArgs:jest.fn()},ToneBlocksAPI=(global.JSInterface=JSInterface,require("../ToneBlocksAPI"));global.MusicBlocks={BLK:"mockBlock"},describe("ToneBlocksAPI",function(){var n;beforeEach(function(){(n=new ToneBlocksAPI).turIndex=1,n.ENDFLOWCOMMAND="end",n.runCommand=jest.fn()}),test("setInstrument calls runCommand with validated arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue(["piano",t]),e.n=1,n.setInstrument("piano",t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("setInstrument",["piano",t]),expect(n.runCommand).toHaveBeenCalledWith("setTimbre",["piano",n.turIndex]),expect(t).toHaveBeenCalled(),expect(r).toBe(n.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("doVibrato calls runCommand with validated arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([.5,2,t]),e.n=1,n.doVibrato(.5,2,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("doVibrato",[.5,2,t]),expect(n.runCommand).toHaveBeenCalledWith("doVibrato",[.5,2,n.turIndex]),expect(t).toHaveBeenCalled(),expect(r).toBe(n.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("doChorus calls runCommand with validated arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([1.2,.3,.7,t]),e.n=1,n.doChorus(1.2,.3,.7,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("doChorus",[1.2,.3,.7,t]),expect(n.runCommand).toHaveBeenCalledWith("doChorus",[1.2,.3,.7,n.turIndex]),expect(t).toHaveBeenCalled(),expect(r).toBe(n.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("doPhaser calls runCommand with validated arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([.8,2,440,t]),e.n=1,n.doPhaser(.8,2,440,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("doPhaser",[.8,2,440,t]),expect(n.runCommand).toHaveBeenCalledWith("doPhaser",[.8,2,440,n.turIndex]),expect(t).toHaveBeenCalled(),expect(r).toBe(n.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("doTremolo calls runCommand with validated arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([4,.5,t]),e.n=1,n.doTremolo(4,.5,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("doTremolo",[4,.5,t]),expect(n.runCommand).toHaveBeenCalledWith("doTremolo",[4,.5,n.turIndex]),expect(t).toHaveBeenCalled(),expect(r).toBe(n.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("doDistortion calls runCommand with validated arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([.8,t]),e.n=1,n.doDistortion(.8,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("doDistortion",[.8,t]),expect(n.runCommand).toHaveBeenCalledWith("doDistortion",[.8,n.turIndex]),expect(t).toHaveBeenCalled(),expect(r).toBe(n.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)}))),test("doHarmonic calls runCommand with validated arguments",_asyncToGenerator(_regenerator().m(function e(){var t,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([3,t]),e.n=1,n.doHarmonic(3,t);case 1:r=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("doHarmonic",[3,t]),expect(n.runCommand).toHaveBeenCalledWith("doHarmonic",[3,n.turIndex,MusicBlocks.BLK]),expect(t).toHaveBeenCalled(),expect(r).toBe(n.ENDFLOWCOMMAND);case 2:return e.a(2)}},e)})))});
function _regenerator(){var v,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,a,c,i,u,l,s,f,d,t=t&&t.prototype instanceof h?t:h,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=n,s=r||[],f=!1,d={p:l=0,n:0,v:v,a:m,f:m.bind(v,4),d:function(e,t){return c=e,i=0,u=v,d.n=t,g}},function(e,t,n){if(1<l)throw TypeError("Generator is already running");for(f&&1===t&&m(t,n),i=t,u=n;(y=i<2?v:u)||!f;){c||(i?i<3?(1<i&&(d.n=-1),m(i,u)):d.n=u:d.v=u);try{if(l=2,c){if(y=c[e=i?e:"next"]){if(!(y=y.call(c,u)))throw TypeError("iterator result is not an object");if(!y.done)return y;u=y.value,i<2&&(i=0)}else 1===i&&(y=c.return)&&y.call(c),i<2&&(u=TypeError("The iterator does not provide a '"+e+"' method"),i=1);c=v}else if((y=(f=d.n<0)?u:o.call(a,d))!==g)break}catch(e){c=v,i=1,u=e}finally{l=1}}return{value:y,done:f}}),!0),t;function m(e,t){for(i=e,u=t,y=0;!f&&l&&!n&&y<s.length;y++){var n,r=s[y],o=d.p,a=r[2];3<e?(n=a===t)&&(u=r[(i=r[4])?5:i=3],r[4]=r[5]=v):r[0]<=o&&((n=e<2&&o<r[1])?(i=0,d.v=t,d.n=r[1]):o<a&&(n=e<3||r[0]>t||a<t)&&(r[4]=e,r[5]=t,d.n=a,i=0))}if(n||1<e)return g;throw f=!0,t}}var g={};function h(){}function o(){}function a(){}var y=Object.getPrototypeOf,e=[][t]?y(y([][t]())):(_regeneratorDefine2(y={},t,function(){return this}),y),c=a.prototype=h.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(c),e}return _regeneratorDefine2(c,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,n,o.displayName="GeneratorFunction"),_regeneratorDefine2(c),_regeneratorDefine2(c,n,"Generator"),_regeneratorDefine2(c,t,function(){return this}),_regeneratorDefine2(c,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:i}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,n){var r=i.apply(e,c);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}var JSInterface={validateArgs:jest.fn()},Singer=(global.JSInterface=JSInterface,{VolumeActions:{getSynthVolume:jest.fn()}}),VolumeBlocksAPI=(global.Singer=Singer,require("../VolumeBlocksAPI"));describe("VolumeBlocksAPI",function(){var r;beforeEach(function(){(r=new VolumeBlocksAPI).turIndex=0,r.runCommand=jest.fn().mockResolvedValue("Command executed"),r.ENDFLOWCOMMAND="endFlow"}),afterEach(function(){jest.clearAllMocks()}),test("doCrescendo calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([50,t]),e.n=1,r.doCrescendo(50,t);case 1:n=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("doCrescendo",[50,t]),expect(r.runCommand).toHaveBeenCalledWith("doCrescendo",["crescendo",50,0]),expect(t).toHaveBeenCalled(),expect(n).toBe("endFlow");case 2:return e.a(2)}},e)}))),test("doDecrescendo calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([30,t]),e.n=1,r.doDecrescendo(30,t);case 1:n=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("doDecrescendo",[30,t]),expect(r.runCommand).toHaveBeenCalledWith("doCrescendo",["decrescendo",30,0]),expect(t).toHaveBeenCalled(),expect(n).toBe("endFlow");case 2:return e.a(2)}},e)}))),test("setRelativeVolume calls runCommand with correct arguments",_asyncToGenerator(_regenerator().m(function e(){var t,n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=jest.fn(),JSInterface.validateArgs.mockReturnValue([75,t]),e.n=1,r.setRelativeVolume(75,t);case 1:n=e.v,expect(JSInterface.validateArgs).toHaveBeenCalledWith("setRelativeVolume",[75,t]),expect(r.runCommand).toHaveBeenCalledWith("setRelativeVolume",[75,0]),expect(t).toHaveBeenCalled(),expect(n).toBe("endFlow");case 2:return e.a(2)}},e)}))),test("setSynthVolume calls runCommand with correct arguments",function(){JSInterface.validateArgs.mockReturnValue(["synth1",100]);var e=r.setSynthVolume("synth1",100);expect(JSInterface.validateArgs).toHaveBeenCalledWith("setSynthVolume",["synth1",100]),expect(r.runCommand).toHaveBeenCalledWith("setSynthVolume",["synth1",100,0]),expect(e).resolves.toBe("Command executed")}),test("getSynthVolume calls Singer.VolumeActions.getSynthVolume with correct arguments",function(){JSInterface.validateArgs.mockReturnValue(["synth1"]),Singer.VolumeActions.getSynthVolume.mockReturnValue(80);var e=r.getSynthVolume("synth1");expect(JSInterface.validateArgs).toHaveBeenCalledWith("getSynthVolume",["synth1"]),expect(Singer.VolumeActions.getSynthVolume).toHaveBeenCalledWith("synth1",0),expect(e).toBe(80)})});
//# sourceMappingURL=main.min.js.map
