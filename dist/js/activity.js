"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var o=0,l=function(){};return{s:l,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){s=!0,n=e},f:function(){try{i||null==a.return||a.return()}finally{if(s)throw n}}}}function asyncGeneratorStep(e,t,a,o,l,n,i){try{var s=e[n](i),r=s.value}catch(e){return void a(e)}s.done?t(r):Promise.resolve(r).then(o,l)}function _asyncToGenerator(s){return function(){var e=this,i=arguments;return new Promise(function(t,a){var o=s.apply(e,i);function l(e){asyncGeneratorStep(o,t,a,l,n,"next",e)}function n(e){asyncGeneratorStep(o,t,a,l,n,"throw",e)}l(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,o=Array(t);a<t;a++)o[a]=e[a];return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0===a)return("string"===t?String:Number)(e);var o=a.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var MUSICBLOCKS_EXTRAS,globalActivity,LEADING=0,BLOCKSCALES=[1,1.5,2,3,4],_THIS_IS_MUSIC_BLOCKS_=!0,_THIS_IS_TURTLE_BLOCKS_=!_THIS_IS_MUSIC_BLOCKS_,_ERRORMSGTIMEOUT_=15e3,_MSGTIMEOUT_=6e4,MYDEFINES=["utils/platformstyle","easeljs.min","tweenjs.min","preloadjs.min","howler","p5.min","p5.sound.min","p5.dom.min","Chart","utils/utils","activity/artwork","widgets/status","widgets/help","utils/munsell","activity/toolbar","activity/trash","activity/boundary","activity/palette","activity/protoblocks","activity/blocks","activity/block","activity/turtledefs","activity/notation","activity/logo","activity/turtle","activity/turtles","activity/turtle-singer","activity/turtle-painter","activity/languagebox","activity/themebox","activity/basicblocks","activity/blockfactory","activity/piemenus","activity/planetInterface","activity/rubrics","activity/macros","activity/SaveInterface","utils/musicutils","utils/synthutils","utils/mathutils","activity/pastebox","prefixfree.min","Tone","activity/js-export/samples/sample","activity/js-export/export","activity/js-export/interface","activity/js-export/constraints","activity/js-export/ASTutils","activity/js-export/generate","activity/js-export/ast2blocklist","activity/js-export/API/GraphicsBlocksAPI","activity/js-export/API/PenBlocksAPI","activity/js-export/API/RhythmBlocksAPI","activity/js-export/API/MeterBlocksAPI","activity/js-export/API/PitchBlocksAPI","activity/js-export/API/IntervalsBlocksAPI","activity/js-export/API/ToneBlocksAPI","activity/js-export/API/OrnamentBlocksAPI","activity/js-export/API/VolumeBlocksAPI","activity/js-export/API/DrumBlocksAPI","activity/js-export/API/DictBlocksAPI","activity/turtleactions/RhythmActions","activity/turtleactions/MeterActions","activity/turtleactions/PitchActions","activity/turtleactions/IntervalsActions","activity/turtleactions/ToneActions","activity/turtleactions/OrnamentActions","activity/turtleactions/VolumeActions","activity/turtleactions/DrumActions","activity/turtleactions/DictActions","activity/blocks/RhythmBlocks","activity/blocks/MeterBlocks","activity/blocks/PitchBlocks","activity/blocks/IntervalsBlocks","activity/blocks/ToneBlocks","activity/blocks/OrnamentBlocks","activity/blocks/VolumeBlocks","activity/blocks/DrumBlocks","activity/blocks/WidgetBlocks","activity/blocks/RhythmBlockPaletteBlocks","activity/blocks/ActionBlocks","activity/blocks/FlowBlocks","activity/blocks/NumberBlocks","activity/blocks/BoxesBlocks","activity/blocks/BooleanBlocks","activity/blocks/HeapBlocks","activity/blocks/DictBlocks","activity/blocks/ExtrasBlocks","activity/blocks/ProgramBlocks","activity/blocks/GraphicsBlocks","activity/blocks/PenBlocks","activity/blocks/MediaBlocks","activity/blocks/SensorsBlocks","activity/blocks/EnsembleBlocks","widgets/widgetWindows","widgets/statistics","widgets/jseditor"];_THIS_IS_MUSIC_BLOCKS_&&(MUSICBLOCKS_EXTRAS=["widgets/modewidget","widgets/meterwidget","widgets/phrasemaker","widgets/arpeggio","widgets/aiwidget","widgets/aidebugger","widgets/pitchdrummatrix","widgets/rhythmruler","widgets/pitchstaircase","widgets/temperament","widgets/tempo","widgets/pitchslider","widgets/musickeyboard","widgets/timbre","widgets/oscilloscope","widgets/sampler","widgets/reflection","widgets/legobricks","activity/lilypond","activity/abc","activity/midi","activity/mxml"],MYDEFINES=MYDEFINES.concat(MUSICBLOCKS_EXTRAS));var doAnalyzeProject=function(){return analyzeProject(globalActivity)},Activity=function(){function J(){var z=this;_classCallCheck(this,J),(globalActivity=this).cellSize=55,this.searchSuggestions=[],this.homeButtonContainer,this.msgTimeoutID=null,this.msgText=null,this.errorMsgTimeoutID=null,this.errorMsgText=null,this.errorMsgArrow=null,this.errorArtwork={},this.cartesianBitmap=null,this.polarBitmap=null,this.trebleBitmap=null,this.trebleSharpBitmap=[null,null,null,null,null,null,null],this.trebleFlatBitmap=[null,null,null,null,null,null,null],this.grandBitmap=null,this.grandSharpBitmap=[null,null,null,null,null,null,null],this.grandFlatBitmap=[null,null,null,null,null,null,null],this.sopranoBitmap=null,this.sopranoSharpBitmap=[null,null,null,null,null,null,null],this.sopranoFlatBitmap=[null,null,null,null,null,null,null],this.altoBitmap=null,this.altoSharpBitmap=[null,null,null,null,null,null,null],this.altoFlatBitmap=[null,null,null,null,null,null,null],this.tenorBitmap=null,this.tenorSharpBitmap=[null,null,null,null,null,null,null],this.tenorFlatBitmap=[null,null,null,null,null,null,null],this.bassBitmap=null,this.bassSharpBitmap=[null,null,null,null,null,null,null],this.bassFlatBitmap=[null,null,null,null,null,null,null];var a=["emptybox","emptyheap","negroot","noinput","zerodivide","notanumber","nostack","notastring","nomicrophone"];this.saveLocally=null,this.scrollBlockContainer=!1,this.blockRefreshCanvas=!1,this.statsWindow=null,this.firstTimeUser=!1,this.beginnerMode=!1,this.runMode="normal",this.keyboardEnableFlag,this.inTempoWidget=!1,this.projectID=null,this.storage=localStorage,this.isDragging=!1,this.isSelecting=!1,this.selectionModeOn=!1,this.isHelpfulSearchWidgetOn=!1,this.isInputON=!1,this.themes=["light","dark"];try{for(var e=0;e<this.themes.length;e++)this.themes[e]===this.storage.themePreference?body.classList.add(this.themes[e]):body.classList.remove(this.themes[e])}catch(e){console.error("Error accessing themePreference storage:",e)}this.beginnerMode=!0;try{void 0===this.storage.beginnerMode?this.firstTimeUser=!0:null!==this.storage.beginnerMode&&(this.beginnerMode=this.storage.beginnerMode,"string"==typeof this.beginnerMode&&"false"===this.beginnerMode&&(this.beginnerMode=!1))}catch(e){console.error(e)}try{var t="en";void 0!==this.storage.languagePreference?(t=this.storage.languagePreference).startsWith("ja")&&(t="ja"):(t=navigator.language).includes("-")&&(t=t.slice(0,t.indexOf("-"))),i18next.changeLanguage(t)}catch(e){console.error(e)}this.KeySignatureEnv=["C","major",!1];try{void 0!==this.storage.KeySignatureEnv&&(console.log(this.storage.KeySignatureEnv),this.KeySignatureEnv=this.storage.KeySignatureEnv.split(","),this.KeySignatureEnv[2]="true"===this.KeySignatureEnv[2])}catch(e){console.error(e)}this.setupDependencies=function(){createDefaultStack(),createHelpContent(z),window.scroll(0,0),document.title=TITLESTRING,z.canvas=docById("myCanvas"),z.fileChooser=docById("myOpenFile"),z.pluginChooser=docById("myOpenPlugin"),z.allFilesChooser=docById("myOpenAll"),z.auxToolbar=docById("aux-toolbar"),z.errorText=docById("errorText"),z.errorTextContent=docById("errorTextContent"),z.errorText.addEventListener("click",z._hideArrows),z.printText=docById("printText"),z.printTextContent=docById("printTextContent"),z.server=!0,z.turtleBlocksScale=1,z.mousestage=null,z.stage=null,z.turtles=null,z.palettes=null,z.blocks=null,z.logo=null,z.pasteBox=null,z.languageBox=null,z.themeBox=null,z.planet=null,window.converter=null,z.buttonsVisible=!0,z.headerContainer=null,z.swiping=!1,z.menuButtonsVisible=!1,z.scrollBlockContainer=!1,z.currentKeyCode=0,z.merging=!1,z.loading=!1,z.smallerContainer=null,z.largerContainer=null,z.resizeDebounce=!1,z.hideBlocksContainer=null,z.collapseBlocksContainer=null,z.searchWidget=docById("search"),z.searchWidget.style.visibility="hidden",z.searchWidget.placeholder=_("Search for blocks"),z.helpfulSearchWidget=document.createElement("input"),z.helpfulSearchWidget.setAttribute("id","helpfulSearch"),z.helpfulSearchWidget.style.visibility="hidden",z.helpfulSearchWidget.placeholder=_("Search for blocks"),z.helpfulSearchWidget.classList.add("ui-autocomplete"),z.progressBar=docById("myProgress"),z.progressBar.style.visibility="hidden",new createjs.DOMElement(docById("paste")),z.paste=docById("paste"),z.paste.style.visibility="hidden",z.toolbarHeight=document.getElementById("toolbars").offsetHeight,z.helpfulWheelItems=[],z.setHelpfulSearchDiv()},this.setHelpfulSearchDiv=function(){docById("helpfulSearchDiv")&&docById("helpfulSearchDiv").parentNode.removeChild(docById("helpfulSearchDiv")),z.helpfulSearchDiv=document.createElement("div"),z.helpfulSearchDiv.setAttribute("id","helpfulSearchDiv"),document.body.appendChild(z.helpfulSearchDiv);var e=document.createElement("div");e.style.cssText="position: absolute;top: 10px;right: 10px;cursor: pointer;";var t=document.createElement("button");t.textContent="Ã—",t.id="crossButton",document.body.appendChild(t),e.appendChild(t),z.helpfulSearchDiv.appendChild(e);var a=docById("begIconText");t.addEventListener("click",z._hideHelpfulSearchWidget),a.addEventListener("click",z._hideHelpfulSearchWidget),z.helpfulSearchDiv.appendChild(z.helpfulSearchWidget)},this._displayHelpfulSearchDiv=function(){docById("helpfulSearchDiv")||z.setHelpfulSearchDiv(),z.helpfulSearchDiv.style.left=docById("helpfulWheelDiv").offsetLeft+80*z.getStageScale()+"px",z.helpfulSearchDiv.style.top=docById("helpfulWheelDiv").offsetTop+110*z.getStageScale()+"px";var e=window.innerWidth,t=window.innerHeight;z.helpfulSearchDiv.style.display="block";var a=z.helpfulSearchDiv.offsetWidth,o=z.helpfulSearchDiv.offsetHeight;z.helpfulSearchDiv.offsetLeft+a>e&&(z.helpfulSearchDiv.style.left=e-a+"px"),z.helpfulSearchDiv.offsetTop+o>t&&(z.helpfulSearchDiv.style.top=t-o+"px"),z.showHelpfulSearchWidget(),z.isHelpfulSearchWidgetOn=!0},this._hideHelpfulSearchWidget=function(e){"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none"),z.helpfulSearchDiv&&z.helpfulSearchDiv.parentNode&&z.helpfulSearchDiv.parentNode.removeChild(z.helpfulSearchDiv),N.__tick()},this.doContextMenus=function(){document.addEventListener("contextmenu",function(e){e.preventDefault(),e.stopPropagation(),z.beginnerMode||(z.isHelpfulSearchWidgetOn&&z._hideHelpfulSearchWidget(),z.blocks.isCoordinateOnBlock(e.clientX,e.clientY)||"myCanvas"!==e.target.id||z._displayHelpfulWheel(e))},!1)},this._displayHelpfulWheel=function(e){docById("helpfulWheelDiv").style.position="absolute";var t=e.clientX,a=e.clientY,o=z.canvas.offsetLeft+28*z.getStageScale(),l=z.canvas.offsetTop+6*z.getStageScale(),n=Math.max(Math.round(t*z.getStageScale()+o)-150,o),i=Math.max(Math.round(a*z.getStageScale()+l)-150,l);docById("helpfulWheelDiv").style.left=n+"px",docById("helpfulWheelDiv").style.top=i+"px";var s=window.innerWidth-20,r=window.innerHeight-20;s<n+350&&(docById("helpfulWheelDiv").style.left=s-350+"px"),r<i+350&&(docById("helpfulWheelDiv").style.top=r-350+"px"),docById("helpfulWheelDiv").style.display="";var c=new wheelnav("helpfulWheelDiv",null,300,300);c.colors=platformColor.wheelcolors,c.slicePathFunction=slicePath().DonutSlice,c.slicePathCustom=slicePath().DonutSliceCustomization(),c.slicePathCustom.minRadiusPercent=.45,c.slicePathCustom.maxRadiusPercent=1,c.sliceSelectedPathCustom=c.slicePathCustom,c.sliceInitPathCustom=c.slicePathCustom,c.clickModeRotate=!1;var u=z.helpfulWheelItems.filter(function(e){return e.display});c.initWheel(u.map(function(e){return e.icon})),c.createWheel(),c.navItems[0].selected=!1,u.forEach(function(e,t){c.navItems[t].setTooltip(_(e.label)),c.navItems[t].navigateFunction=function(){return e.fn(z)}});document.addEventListener("click",function e(t){helpfulWheelDiv.contains(t.target)||(helpfulWheelDiv.style.display="none",document.removeEventListener("click",e))})},this.doPluginsAndPaletteCols=function(){for(var e in platformColor.paletteColors)PALETTEFILLCOLORS[e]=platformColor.paletteColors[e][0],PALETTESTROKECOLORS[e]=platformColor.paletteColors[e][1],PALETTEHIGHLIGHTCOLORS[e]=platformColor.paletteColors[e][2],HIGHLIGHTSTROKECOLORS[e]=platformColor.paletteColors[e][1];z.pluginObjs={PALETTEPLUGINS:{},PALETTEFILLCOLORS:{},PALETTESTROKECOLORS:{},PALETTEHIGHLIGHTCOLORS:{},FLOWPLUGINS:{},ARGPLUGINS:{},BLOCKPLUGINS:{},MACROPLUGINS:{},ONLOAD:{},ONSTART:{},ONSTOP:{}},z.macroDict={},z.DEFAULTDELAY=500,z.TURTLESTEP=-1,z.blockscale=BLOCKSCALES.indexOf(DEFAULTBLOCKSCALE),-1===z.blockscale&&(z.blockscale=1),z.stageMouseDown=!1,z.stageX=0,z.stageY=0;var t=1200===screen.width&&900===screen.height||900===screen.width&&1200===screen.height;z.cellSize=55,t&&(z.cellSize=75),z.onscreenButtons=[],z.onscreenMenu=[],z.firstRun=!0,z.pluginsImages={}};function o(e){e._findBlocks(),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",e.__tick())}function M(u){var d=window.innerWidth,t=new Set,a=[];Object.values(u.blocks.blockList).forEach(function(e){t.has(e.id)||(u.blocks.findDragGroup(e.id),0<u.blocks.dragGroup.length&&(a.push(_toConsumableArray(u.blocks.dragGroup)),u.blocks.dragGroup.forEach(function(e){return t.add(e)})))}),a.forEach(function(e){var a,o,l,n,t=u.blocks.blockList[e[0]];t.initialPosition||(t.initialPosition={x:t.container.x,y:t.container.y}),d<768&&!t.beforeMobilePosition&&(t.beforeMobilePosition={x:t.container.x,y:t.container.y}),768<=d&&t.beforeMobilePosition&&(a=t.beforeMobilePosition.x-t.container.x,o=t.beforeMobilePosition.y-t.container.y,e.forEach(function(e){var t=u.blocks.blockList[e];t.container.x+=a,t.container.y+=o}),t.beforeMobilePosition=null),d<600&&!t.before600pxPosition&&(t.before600pxPosition={x:t.container.x,y:t.container.y}),600<=d&&t.before600pxPosition&&(l=t.before600pxPosition.x-t.container.x,n=t.before600pxPosition.y-t.container.y,e.forEach(function(e){var t=u.blocks.blockList[e];t.container.x+=l,t.container.y+=n}),t.before600pxPosition=null);var i,s=Math.max.apply(Math,_toConsumableArray(e.map(function(e){return u.blocks.blockList[e].container.x+u.blocks.blockList[e].width})));d<s&&(i=Math.max(10,d-s-10),e.forEach(function(e){u.blocks.blockList[e].container.x+=i}));var r,c=Math.min.apply(Math,_toConsumableArray(e.map(function(e){return u.blocks.blockList[e].container.x})));c<0&&(r=100-c,e.forEach(function(e){u.blocks.blockList[e].container.x+=r}))}),u._findBlocks()}window.addEventListener("resize",function(){return M(z)}),this._findBlocks=function(){z.blocks.visible||z._changeBlockVisibility(),z.blocks.activeBlock=null,hideDOMLabel(),z.blocks.showBlocks(),z.blocksContainer.x=0,z.blocksContainer.y=0;var e=window.innerWidth,i=e<600,t=i?1:Math.floor(e/400),a="block"===z.auxToolbar.style.display?90+z.toolbarHeight:90,s=i?Math.floor(e/2):Math.floor(z.canvas.width/4),r=Math.floor(a*z.turtleBlocksScale),c=Math.floor(40*z.turtleBlocksScale),o=e/t*1.2,u=Array.from({length:t},function(e,t){return Math.floor(t*o+o/2)}),d=Array(t).fill(r);for(var p in z.blocks.blockList)z.blocks.blockList[p].trash||function(){var e,t,a,o,l,n=z.blocks.blockList[p];n.originalPosition||(n.originalPosition={x:n.container.x,y:n.container.y}),null===n.connections[0]&&(i?(e=s-n.container.x,t=r-n.container.y,z.blocks.moveBlockRelative(p,e,t),r+=n.height+c):(a=d.indexOf(Math.min.apply(Math,_toConsumableArray(d))),o=u[a]-n.container.x,l=d[a]-n.container.y,z.blocks.moveBlockRelative(p,o,l),d[a]+=n.height+c)),0<n.connections.length&&n.connections.forEach(function(e){var t;null===e||(t=z.blocks.blockList[e])&&(t.container.x=n.container.x+t.relativeX,t.container.y=n.container.y+t.relativeY)})}();M(z),z.setHomeContainers(!1),z.boundary.hide();for(var l=0;l<z.turtles.turtleList.length;l++){var n=z.turtles.turtleList[l].painter.penState;z.turtles.turtleList[l].painter.penState=!1,z.turtles.turtleList[l].painter.doSetXY(0,0),z.turtles.turtleList[l].painter.doSetHeading(0),z.turtles.turtleList[l].painter.penState=n}},this._isFirstHomeClick=!0,this._findBlocks=function(){if(z.blocks.visible||z._changeBlockVisibility(),z.blocks.activeBlock=null,hideDOMLabel(),z.blocks.showBlocks(),z.blocksContainer.x=0,z.blocksContainer.y=0,z._isFirstHomeClick){var e="block"===z.auxToolbar.style.display?90+z.toolbarHeight:90,t=Math.floor(z.canvas.width/4);z.palettes.updatePalettes();var a=Math.floor(t*z.turtleBlocksScale),o=Math.floor(e*z.turtleBlocksScale),l=!0;for(var n in z.blocks.blockList)if(!z.blocks.blockList[n].trash){var i=z.blocks.blockList[n];if("start"!==i.name)continue;if(null===i.connections[0]){var s=a-i.container.x,r=o-i.container.y;if(z.blocks.moveBlockRelative(n,s,r),z.blocks.findDragGroup(n),0<z.blocks.dragGroup.length)for(var c=0;c<z.blocks.dragGroup.length;c++){var u=z.blocks.dragGroup[c];0!==c&&z.blocks.moveBlockRelative(u,s,r)}(a+=Math.floor(150*z.turtleBlocksScale))>7*z.canvas.width/8/z.turtleBlocksScale&&(a=(l=!l)?Math.floor(t):Math.floor(t+STANDARDBLOCKHEIGHT),o+=STANDARDBLOCKHEIGHT)}}for(var d in z.blocks.blockList)if(!z.blocks.blockList[d].trash){var p=z.blocks.blockList[d];if("start"===p.name)continue;if(null===p.connections[0]){var M=a-p.container.x,g=o-p.container.y;if(z.blocks.moveBlockRelative(d,M,g),z.blocks.findDragGroup(d),0<z.blocks.dragGroup.length)for(var h=0;h<z.blocks.dragGroup.length;h++){var b=z.blocks.dragGroup[h];0!==h&&z.blocks.moveBlockRelative(b,M,g)}(a+=Math.floor(150*z.turtleBlocksScale))>7*z.canvas.width/8/z.turtleBlocksScale&&(a=(l=!l)?Math.floor(t):Math.floor(t+STANDARDBLOCKHEIGHT),o+=STANDARDBLOCKHEIGHT)}}}else{var m="block"===z.auxToolbar.style.display?90+z.toolbarHeight:90,y=window.innerWidth,k=y<=320?1:Math.floor(y/320),v=1.2*(y/k),w=Math.floor(m*z.turtleBlocksScale),T=1.2*Math.floor(20*z.turtleBlocksScale),D=Array.from({length:k},function(e,t){return Math.floor(t*v+v/2)}),L=Array(k).fill(w);for(var A in z.blocks.blockList)if(!z.blocks.blockList[A].trash){var N=z.blocks.blockList[A];if(null===N.connections[0]){for(var I=0,f=1;f<k;f++)L[f]<L[I]&&(I=f);var C=D[I]-N.container.x,S=L[I]-N.container.y;if(z.blocks.moveBlockRelative(A,C,S),z.blocks.findDragGroup(A),0<z.blocks.dragGroup.length)for(var B=0;B<z.blocks.dragGroup.length;B++){var O=z.blocks.dragGroup[B];0!==B&&z.blocks.moveBlockRelative(O,C,S)}L[I]+=N.height+T}}}z.setHomeContainers(!1),z.boundary.hide();for(var j=0;j<z.turtles.getTurtleCount();j++){var x=z.turtles.getTurtle(j),E=x.painter.penState;x.painter.penState=!1,x.painter.doSetXY(0,0),x.painter.doSetHeading(0),x.painter.penState=E}z._isFirstHomeClick=!z._isFirstHomeClick},this.setHomeContainers=function(e){null!==z.homeButtonContainer&&(e?changeImage(z.homeButtonContainer.children[0],GOHOMEFADEDBUTTON,GOHOMEBUTTON):changeImage(z.homeButtonContainer.children[0],GOHOMEBUTTON,GOHOMEFADEDBUTTON))},this.__saveHelpBlock=function(s,e){var r=z;setTimeout(function(){r.sendAllToTrash(!1,!0),setTimeout(function(){var e,t,a,o,l,n,i=r.blocks.protoBlockDict[s].helpString;i.length<4?(t=(e=r.palettes.getProtoNameAndPalette(s))[0],a=e[1],o=e[2],r.blocks.protoBlockDict.hasOwnProperty(o)&&r.palettes.dict[a].makeBlockFromSearch(t,o,function(e){r.blocks.moveBlock(e,0,0)})):"string"==typeof i[3]?(l=getMacroExpansion(r,i[3],0,0),r.blocks.loadNewBlocks(l)):(n=i[3],r.blocks.loadNewBlocks(n)),setTimeout(function(){console.log("Saving help artwork: "+s+"_block.svg");var e="data:image/svg+xml;utf8,"+r.printBlockSVG();r.save.download("svg",e,s+"_block.svg")},500)},500)},e+1e3)},this._saveHelpBlocks=function(){var e=[];for(var t in z.blocks.protoBlockDict)void 0!==z.blocks.protoBlockDict[t].helpString&&0!==z.blocks.protoBlockDict[t].helpString.length&&e.push(t);var a=0;for(var o in e)z.__saveHelpBlock(e[o],2e3*a),a+=1;z.sendAllToTrash(!0,!0)},this.printBlockSVG=function(){z.blocks.activeBlock=null;for(var e,t=0,a="",o=0,l=0,n=0;n<z.blocks.blockList.length;n++)if(!z.blocks.blockList[n].ignore()){if(z.blocks.blockList[n].container.x+z.blocks.blockList[n].width>o&&(o=z.blocks.blockList[n].container.x+z.blocks.blockList[n].width),z.blocks.blockList[n].container.y+z.blocks.blockList[n].height>l&&(l=z.blocks.blockList[n].container.y+z.blocks.blockList[n].height),e=z.blocks.blockList[n].collapsed?z.blocks.blockCollapseArt[n].split("><"):z.blocks.blockArt[n].split("><"),z.blocks.blockList[n].isCollapsible()&&(a+="<g>"),a+='<g transform="translate('+z.blocks.blockList[n].container.x+", "+z.blocks.blockList[n].container.y+')">',SPECIALINPUTS.includes(z.blocks.blockList[n].name))for(var i=1;i<e.length;i++)1===i?a+="<"+e[i]+"><":2===i||(3===i?a+=e[i].replace("filter:url(#dropshadow);","")+"><":5===i?"string"==typeof z.blocks.blockList[n].value?a+=e[i]+">"+_(z.blocks.blockList[n].value)+"<":a+=e[i]+">"+z.blocks.blockList[n].value+"<":i===e.length-2?a+=e[i]+">":i===e.length-1||(a+=e[i]+"><"));else for(var s=1;s<e.length;s++)1===s?a+="<"+e[s]+"><":2===s||(3===s?a+=e[s].replace("filter:url(#dropshadow);","")+"><":s===e.length-2?a+=e[s]+">":s===e.length-1||(a+=e[s]+"><"));if(a+="</g>",z.blocks.blockList[n].isCollapsible()){var r=void 0,r=INLINECOLLAPSIBLES.includes(z.blocks.blockList[n].name)?z.blocks.blockList[n].container.y+4:z.blocks.blockList[n].container.y+12;a+='<g transform="translate('+z.blocks.blockList[n].container.x+", "+r+') scale(0.5 0.5)">',e=z.blocks.blockList[n].collapsed?EXPANDBUTTON.split("><"):COLLAPSEBUTTON.split("><");for(var c=2;c<e.length-1;c++)a+="<"+e[c]+">";a+="</g>"}if("start"===z.blocks.blockList[n].name){a+='<g transform="translate('+(z.blocks.blockList[n].container.x+110)+", "+(z.blocks.blockList[n].container.y+12)+') scale(0.4 0.4)">',e=TURTLESVG.replace(/fill_color/g,FILLCOLORS[t]).replace(/stroke_color/g,STROKECOLORS[t]).split("><"),9<(t+=1)&&(t=0);for(var u=2;u<e.length-1;u++)a+="<"+e[u]+">";a+="</g>"}z.blocks.blockList[n].isCollapsible()&&(a+="</g>")}return a+="</svg>",'<svg xmlns="http://www.w3.org/2000/svg" width="'+o+'" height="'+l+'">'+encodeURIComponent(a)},this.printBlockPNG=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,o,l,a,n,i,s,r,c,u,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=z.printBlockSVG(),o=document.createElement("canvas"),l=o.getContext("2d"),a=new DOMParser,n=a.parseFromString(decodeURIComponent(t),"image/svg+xml"),i=n.documentElement,s=parseInt(i.getAttribute("width"),10),r=parseInt(i.getAttribute("height"),10),o.width=s,o.height=r,c=new Image,u=new Blob([decodeURIComponent(t)],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(u),e.abrupt("return",new Promise(function(t,a){c.onload=function(){l.drawImage(c,0,0),URL.revokeObjectURL(d);var e=o.toDataURL("image/png");t(e)},c.onerror=function(e){URL.revokeObjectURL(d),a(e)},c.src=d}));case 14:case"end":return e.stop()}},e)}));function m(t){if(!docById("import-midi")){var a=document.createElement("div");a.classList.add("modalBox"),a.id="import-midi";var e=document.createElement("h2");e.textContent=_("Import MIDI"),e.classList.add("modal-title"),a.appendChild(e);var o=document.createElement("div");o.classList.add("message-container");var l=document.createElement("p");l.textContent=_("Set the max blocks to generate :"),l.classList.add("modal-message"),o.appendChild(l);var n=document.createElement("select");n.classList.add("block-count-dropdown");for(var i=1;i<=12;i++){var s=document.createElement("option");s.value=100*i,s.textContent=100*i,n.appendChild(s)}o.appendChild(n),a.appendChild(o);var r=document.createElement("button");r.classList.add("confirm-button"),r.textContent="Confirm",r.addEventListener("click",function(){var e=n.value;transcribeMidi(t,e),document.body.removeChild(a)}),a.appendChild(r);var c=document.createElement("button");c.classList.add("cancel-button"),c.textContent="Cancel",c.addEventListener("click",function(){document.body.removeChild(a)}),a.appendChild(c),document.body.appendChild(a)}}this._allClear=function(a){function e(){z.blocks.activeBlock=null,hideDOMLabel(),z.logo.boxes={},z.logo.time=0,z.hideMsgs(),z.hideGrids(),z.turtles.setBackgroundColor(-1),z.logo.svgOutput="",z.logo.notationOutput="";for(var e=0;e<z.turtles.getTurtleCount();e++)z.logo.turtleHeaps[e]=[],z.logo.turtleDicts[e]={},z.logo.notation.notationStaging[e]=[],z.logo.notation.notationDrumStaging[e]=[],void 0!==a&&a||z.turtles.getTurtle(e).painter.doClear(!0,!0,!0);z.blocksContainer.x=0,z.blocksContainer.y=0,Element.prototype.remove=function(){z.parentElement.removeChild(z)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var e=0,t=z.length;e<t;e++)z[e]&&z[e].parentElement&&z[e].parentElement.removeChild(z[e])};var t=docById("myTable");null!==t&&t.remove(),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",z.__tick())}var t,o,l,n,i,s,r;1<arguments.length&&void 0!==arguments[1]&&arguments[1]?e():(t=e,docById("clear-confirm")||((o=document.createElement("div")).classList.add("modalBox"),o.id="clear-confirm",(l=document.createElement("h2")).textContent=_("Clear Workspace"),l.classList.add("modal-title"),o.appendChild(l),(n=document.createElement("p")).textContent=_("Are you sure you want to clear the workspace?"),n.classList.add("modal-message"),o.appendChild(n),(i=document.createElement("div")).classList.add("clear-button-container"),(s=document.createElement("button")).classList.add("confirm-button"),s.textContent="Confirm",s.style.backgroundColor=platformColor.blueButton,s.style.color="white",s.style.border="none",s.style.borderRadius="4px",s.style.padding="8px 16px",s.style.fontWeight="bold",s.style.cursor="pointer",s.style.marginRight="16px",s.addEventListener("click",function(){document.body.removeChild(o),t()}),(r=document.createElement("button")).classList.add("cancel-button"),r.textContent="Cancel",r.style.backgroundColor="#f1f1f1",r.style.color="black",r.style.border="none",r.style.borderRadius="4px",r.style.padding="8px 16px",r.style.fontWeight="bold",r.style.cursor="pointer",r.addEventListener("click",function(){document.body.removeChild(o)}),i.appendChild(s),i.appendChild(r),o.appendChild(i),document.body.appendChild(o)))};function y(e,t){e.runMode="normal",e._doFastButton(t)}function k(e){g||(g=!0,e._doRecordButton())}var g=!(this._doFastButton=function(e){z._onResize(),z.blocks.activeBlock=null,hideDOMLabel();var t=z.logo.turtleDelay;z.logo.turtleDelay=0,z.logo.synth.resume();for(var a,o=document.getElementsByClassName("wftTitle"),l=0;l<o.length;l++)if("tempo"===o[l].innerHTML){z.logo.tempo.isMoving&&z.logo.tempo.pause(),z.logo.tempo.resume();break}z.turtles.running()?0!==t?z.logo.step():(document.getElementById("stop").style.color="white",z.logo.doStopTurtles(),a=z,setTimeout(function(){document.getElementById("stop").style.color="#ea174c",a.logo.runLogoCommands(null,e)},500)):(z.turtles.isShrunk()||(z.blocks.hideBlocks(),z.showBlocksAfterRun=!0),z.logo.runLogoCommands(null,e))});this._doRecordButton=function(){var l,n=document.getElementById("record"),i=document.getElementById("rec_inside"),e=new Event("click"),s=0;function r(){return(r=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=1,e.next=3,navigator.mediaDevices.getDisplayMedia({preferCurrentTab:"True",systemAudio:"include",audio:"True",video:{mediaSource:"tab"},bandwidthProfile:{video:{clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto"}},preferredVideoCodecs:"auto"});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var c=z;function u(){s=0,l.stop();var e=document.createElement("p");e.textContent="Stopped recording",document.body.appendChild(e)}function d(e,t){s=1,i.classList.add("blink"),n.removeEventListener("click",d,!0);var a=[],o=new MediaRecorder(e);return e.oninactive=function(){console.log("Recording is ready to save"),u(),s=0},o.onstop=function(){!function(e){s=1,i.classList.remove("blink");var t=new Blob(e,{type:"video/webm"}),a=window.prompt(_("Enter file name"));if(null===a||""===a.trim())return alert(_("File save canceled")),s=0,p(),k();var o=document.createElement("a");o.href=URL.createObjectURL(t),o.download="".concat(a,".webm"),document.body.appendChild(o),o.click(),URL.revokeObjectURL(t),document.body.removeChild(o),s=0,p(),k(),c.textMsg(_("Click on stop saving"))}(a),a=[],s=0,i.setAttribute("fill","#ffffff")},o.ondataavailable=function(e){0<e.data.size&&a.push(e.data)},o.start(200),setTimeout(function(){console.log("Resizing for Record",c.canvas.height),c._onResize()},500),o}function p(){n.addEventListener("click",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(){return r.apply(this,arguments)}();case 2:t=e.sent,l=d(t),1==s&&this.removeEventListener("click",o),(a=document.createElement("p")).textContent="Started recording",document.body.appendChild(a),i.setAttribute("fill","red");case 10:case"end":return e.stop()}},e,this)}));function o(){return e.apply(this,arguments)}return o}())}0==s&&g&&(p(),n.dispatchEvent(e),s=1),1==s&&g&&(n.addEventListener("click",u),s=0)};function v(e){e.runMode="slow",e._doSlowButton()}this._doSlowButton=function(){z.blocks.activeBlock=null,hideDOMLabel(),z.logo.turtleDelay=DEFAULTDELAY,z.logo.synth.resume(),z.turtles.running()?z.logo.step():z.logo.runLogoCommands()};function w(e){e.runMode="step",e._doStepButton()}this._doStepButton=function(){z.blocks.activeBlock=null,hideDOMLabel();var e=Object.keys(z.logo.stepQueue).length;if(z.logo.synth.resume(),0===e||z.logo.turtleDelay!==z.TURTLESTEP)z.logo.turtleDelay=z.TURTLESTEP,z.turtles.running()||(z.logo.runLogoCommands(),docById("stop").style.color=z.toolbar.stopIconColorWhenPlaying),z.logo.step();else{if(Object.keys(z.logo.stepQueue).every(function(e){return 0===z.logo.stepQueue[e].length}))return z.logo.doStopTurtles(),void(docById("stop").style.color="white");z.logo.turtleDelay=z.TURTLESTEP,z.logo.step()}};function T(e,t){e._doHardStopButton(t)}this._doHardStopButton=function(e){if(z.blocks.activeBlock=null,hideDOMLabel(),void 0===e&&(e=!1),!e||!_THIS_IS_MUSIC_BLOCKS_){z.logo.doStopTurtles();for(var t=document.getElementsByClassName("wftTitle"),a=0;a<t.length;a++)if("tempo"===t[a].innerHTML){z.logo.tempo.isMoving&&z.logo.tempo.pause();break}}};function D(e){e.toolbar.renderSaveIcons(e.save.saveHTML.bind(e.save),doSVG,e.save.saveSVG.bind(e.save),e.save.saveMIDI.bind(e.save),e.save.savePNG.bind(e.save),e.save.saveWAV.bind(e.save),e.save.saveLilypond.bind(e.save),e.save.saveLilypond.bind(afterSaveLilypond),e.save.afterSaveLilypondLY.bind(e.save),e.save.saveAbc.bind(e.save),e.save.saveMxml.bind(e.save),e.save.saveBlockArtwork.bind(e.save),e.save.saveBlockArtworkPNG.bind(e.save)),e.regeneratePalettes&&e.regeneratePalettes(),e.refreshCanvas()}function L(e){e._setScroller(),e._setupBlocksContainerEvents(),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none")}this._setScroller=function(){z.blocks.activeBlock=null,z.scrollBlockContainer=!z.scrollBlockContainer;var e=docById("enableHorizScrollIcon"),t=docById("disableHorizScrollIcon");z.scrollBlockContainer&&!z.beginnerMode?(e.style.display="none",t.style.display="block",z.helpfulWheelItems.forEach(function(e){"Enable horizontal scrolling"===e.label?e.display=!1:"Disable horizontal scrolling"===e.label&&(e.display=!0)}),activity.textMsg("Horizontal scrolling enabled.",3e3)):(e.style.display="block",t.style.display="none",z.helpfulWheelItems.forEach(function(e){"Enable horizontal scrolling"===e.label?e.display=!0:"Disable horizontal scrolling"===e.label&&(e.display=!1)}),activity.textMsg("Horizontal scrolling disabled.",3e3))},this.doLoadAnimation=function(){var t={load_messages:[_("Catching mice"),_("Cleaning the instruments"),_("Testing key pieces"),_("Sight-reading"),_("Combining math and music"),_("Generating more blocks"),_("Do Re Mi Fa Sol La Ti Do"),_("Tuning string instruments"),_("Pressing random keys")]};document.getElementById("load-container").style.display="block";var a=0;setInterval(function(){var e=t.load_messages[Math.floor(Math.random()*t.load_messages.length)];document.getElementById("messageText").innerHTML=e+"...",++a>=t.load_messages.length&&(a=0)},2e3)};var d=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._doLargerBlocks();case 2:"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",t.__tick());case 3:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}();this._doLargerBlocks=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(z.blocks.activeBlock=null,z.resizeDebounce){e.next=12;break}if(z.blockscale<BLOCKSCALES.length-1)return z.resizeDebounce=!0,z.blockscale+=1,z.clearCache(),e.next=8,z.blocks.setBlockScale(BLOCKSCALES[z.blockscale]);e.next=10;break;case 8:z.blocks.checkBounds(),z.refreshCanvas();case 10:t=z,setTimeout(function(){t.resizeDebounce=!1},200);case 12:return e.next=14,z.setSmallerLargerStatus();case 14:return e.next=16,z.stage.update();case 16:case"end":return e.stop()}},e)}));var p=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._doSmallerBlocks();case 2:"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",t.__tick());case 3:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}();this._doSmallerBlocks=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(z.blocks.activeBlock=null,z.resizeDebounce){e.next=12;break}if(0<z.blockscale)return z.resizeDebounce=!0,--z.blockscale,z.clearCache(),e.next=8,z.blocks.setBlockScale(BLOCKSCALES[z.blockscale]);e.next=10;break;case 8:z.blocks.checkBounds(),z.refreshCanvas();case 10:t=z,setTimeout(function(){t.resizeDebounce=!1},200);case 12:return e.next=14,z.setSmallerLargerStatus();case 14:return e.next=16,z.stage.update();case 16:case"end":return e.stop()}},e)})),this.setSmallerLargerStatus=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(BLOCKSCALES[z.blockscale]<DEFAULTBLOCKSCALE)return e.next=3,changeImage(z.smallerContainer.children[0],SMALLERBUTTON,SMALLERDISABLEBUTTON);e.next=5;break;case 3:e.next=7;break;case 5:return e.next=7,changeImage(z.smallerContainer.children[0],SMALLERDISABLEBUTTON,SMALLERBUTTON);case 7:if(4===BLOCKSCALES[z.blockscale])return e.next=10,changeImage(z.largerContainer.children[0],BIGGERBUTTON,BIGGERDISABLEBUTTON);e.next=12;break;case 10:e.next=14;break;case 12:return e.next=14,changeImage(z.largerContainer.children[0],BIGGERDISABLEBUTTON,BIGGERBUTTON);case 14:case"end":return e.stop()}},e)}));function A(e){e._deletePlugin()}this._deletePlugin=function(){if(null!==z.palettes.activePalette){var e=JSON.parse(z.storage.plugins);z.palettes.activePalette in e.PALETTEPLUGINS&&delete e.PALETTEPLUGINS[z.palettes.activePalette],z.palettes.activePalette in e.PALETTEFILLCOLORS&&delete e.PALETTEFILLCOLORS[z.palettes.activePalette],z.palettes.activePalette in e.PALETTESTROKECOLORS&&delete e.PALETTESTROKECOLORS[z.palettes.activePalette],z.palettes.activePalette in e.PALETTEHIGHLIGHTCOLORS&&delete e.PALETTEHIGHLIGHTCOLORS[z.palettes.activePalette];for(var t=0;t<z.palettes.dict[z.palettes.activePalette].protoList.length;t++){var a=z.palettes.dict[z.palettes.activePalette].protoList[t].name;a in e.FLOWPLUGINS&&(console.log("deleting "+a),delete e.FLOWPLUGINS[a]),a in e.BLOCKPLUGINS&&(console.log("deleting "+a),delete e.BLOCKPLUGINS[a]),a in e.ARGPLUGINS&&(console.log("deleting "+a),delete e.ARGPLUGINS[a])}z.palettes.activePalette in e.MACROPLUGINS&&delete e.MACROPLUGINS[z.palettes.activePalette],z.palettes.activePalette in e.ONLOAD&&delete e.ONLOAD[z.palettes.activePalette],z.palettes.activePalette in e.ONSTART&&delete e.ONSTART[z.palettes.activePalette],z.palettes.activePalette in e.ONSTOP&&delete e.ONSTOP[z.palettes.activePalette],z.storage.plugins=JSON.stringify(e),z.textMsg(z.palettes.activePalette+" "+_("plugins will be removed upon restart."))}},this.hideGrids=function(){z.turtles.setGridLabel(_("show Cartesian")),z._hideCartesian(),z._hidePolar(),_THIS_IS_MUSIC_BLOCKS_&&(z._hideTreble(),z._hideGrand(),z._hideSoprano(),z._hideAlto(),z._hideTenor(),z._hideBass())},this._doCartesianPolar=function(){switch(z.turtles.currentGrid){case 1:z._hideCartesian();break;case 2:z._hideCartesian(),z._hidePolar();break;case 3:z._hidePolar();break;case 4:z._hideTreble();break;case 5:z._hideGrand();break;case 6:z._hideSoprano();break;case 7:z._hideAlto();break;case 8:z._hideTenor();break;case 9:z._hideBass()}switch(z.turtles.gridWheel.selectedNavItemIndex){case 1:z._showCartesian();break;case 2:z._showCartesian(),z._showPolar();break;case 3:z._showPolar();break;case 4:z._showTreble();break;case 5:z._showGrand();break;case 6:z._showSoprano();break;case 7:z._showAlto();break;case 8:z._showTenor();break;case 9:z._showBass()}z.turtles.currentGrid=z.turtles.gridWheel.selectedNavItemIndex,z.update=!0},this._setupBlocksContainerEvents=function(){function c(){["wheelDiv","contextWheelDiv","helpfulWheelDiv","textLabel","numberLabel"].forEach(function(e){var t=docById(e);t&&(t.style.display="none")})}var u=z,a={x:0,y:0,delta:0},e=document.getElementById("myCanvas"),i=[[null,null],[null,null]];e.addEventListener("touchstart",function(e){if(2===e.touches.length)for(var t=0;t<2;t++)i[t][0]=e.touches[t].clientY,i[t][1]=e.touches[t].clientX}),e.addEventListener("touchmove",function(e){if(2===e.touches.length){for(var t=0;t<2;t++){var a,o,l=e.touches[t].clientY,n=e.touches[t].clientX;null!==i[t][0]&&null!==i[t][1]&&(a=l-i[t][0],o=n-i[t][1],0!=a&&(c(),u.blocksContainer.y-=a),0!=o&&(c(),u.blocksContainer.x-=o),i[t][0]=l,i[t][1]=n)}u.refreshCanvas()}}),e.addEventListener("touchend",function(){for(var e=0;e<2;e++)i[e][0]=null,i[e][1]=null});docById("myCanvas").addEventListener("wheel",function(e){var t,a,o,l,n,i=(n=l=o=a=0,"detail"in(t=e)&&(o=t.detail),"wheelDelta"in t&&(o=-t.wheelDelta/120),"wheelDeltaY"in t&&(o=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(a=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(a=o,o=0),l=10*a,n=10*o,"deltaY"in t&&(n=t.deltaY),"deltaX"in t&&(l=t.deltaX),(l||n)&&t.deltaMode&&(1===t.deltaMode?(l*=40,n*=40):(l*=800,n*=800)),l&&!a&&(a=l<1?-1:1),n&&!o&&(o=n<1?-1:1),{pixelX:l,pixelY:n}),s=i.pixelY,r=i.pixelX;e.ctrlKey?(e.preventDefault(),(s<0?d:p)(u)):0!==s&&e.axis===e.VERTICAL_AXIS?(c(),u.blocksContainer.y-=s):u.scrollBlockContainer&&0!==r&&e.axis===e.HORIZONTAL_AXIS?(c(),u.blocksContainer.x-=r):e.preventDefault(),u.refreshCanvas()},!1);function t(e){u.stageMouseDown=!1,u.moving=!1,null===u.stage.getObjectUnderPoint()&&a.delta<4&&(u.stageX=e.stageX,u.stageY=e.stageY)}z.stage.on("stagemousemove",function(e){u.stageX=e.stageX,u.stageY=e.stageY}),z.stage.on("stagemousedown",function(e){return u.stageMouseDown=!0,null!==u.stage.getObjectUnderPoint()|u.turtles.running()||(u.moving=!0,a={x:e.stageX,y:e.stageY,delta:0},hideDOMLabel(),u.stage.removeAllEventListeners("stagemousemove"),u.stage.on("stagemousemove",function(e){var t;u.stageX=e.stageX,u.stageY=e.stageY,u.moving&&(u.blocks.activeBlock=null,t=Math.abs(e.stageX-a.x)+Math.abs(e.stageY-a.y),u.scrollBlockContainer&&(u.blocksContainer.x+=e.stageX-a.x),u.blocksContainer.y+=e.stageY-a.y,a={x:e.stageX,y:e.stageY,delta:a.delta+t},u.refreshCanvas())})),u.stage.removeAllEventListeners("stagemouseup"),void u.stage.on("stagemouseup",t)})},this.getStageScale=function(){return z.turtleBlocksScale},this.getStageX=function(){return z.turtles.screenX2turtleX(z.stageX/z.turtleBlocksScale)},this.getStageY=function(){return z.turtles.screenY2turtleY((z.stageY-z.toolbarHeight)/z.turtleBlocksScale)},this.getStageMouseDown=function(){return z.stageMouseDown},this._createGrid=function(e){var t=new Image;t.src=e;var a=new createjs.Container;z.stage.addChild(a);var o=new createjs.Bitmap(t);return a.addChild(o),o.cache(0,0,1200,900),o.x=(z.canvas.width-1200)/2,o.y=(z.canvas.height-900)/2,o.scaleX=o.scaleY=o.scale=1,o.visible=!1,o.updateCache(),o},this._createMsgContainer=function(e,t,l,a){var n=new createjs.Container;z.stage.addChild(n),n.x=z.canvas.width/2,n.y=a,n.visible=!1;var i=new Image,o=MSGBLOCK.replace("fill_color",e).replace("stroke_color",t),s=z;i.onload=function(){var e=new createjs.Bitmap(i);n.addChild(e);var t=new createjs.Text("your message here","20px Arial","#000000");n.addChild(t),t.textAlign="center",t.textBaseline="alphabetic",t.x=500,t.y=30;var a=n.getBounds();n.cache(a.x,a.y,a.width,a.height);var o=new createjs.Shape;o.graphics.beginFill("#FFF").drawRect(0,0,1e3,42),o.x=0,o.y=0,n.hitArea=o,n.on("click",function(e){n.visible=!1,null!==s.errorMsgArrow&&s.errorMsgArrow.removeAllChildren(),s.update=!0}),l(t),s.msgText=t},i.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(o))},this._createErrorContainers=function(){for(var e=0;e<a.length;e++){var t=a[e];z._makeErrorArtwork(t)}},this._makeErrorArtwork=function(e){var n=new createjs.Container;z.stage.addChild(n),n.x=z.canvas.width/2,n.y=80,z.errorArtwork[e]=n,z.errorArtwork[e].name=e,z.errorArtwork[e].visible=!1;var i=new Image;i.onload=function(){var e=new createjs.Bitmap(i);n.addChild(e);var t=new createjs.Text("","20px Sans","#000000");n.addChild(t),t.x=70,t.y=10;var a=n.getBounds();n.cache(a.x,a.y,a.width,a.height);var o=new createjs.Shape;o.graphics.beginFill("#FFF").drawRect(0,0,a.width,a.height),o.x=0,o.y=0,n.hitArea=o;var l=z;n.on("click",function(e){n.visible=!1,null!==l.errorMsgArrow&&void 0!==l.errorMsgArrow&&l.errorMsgArrow.removeAllChildren(),l.update=!0})},i.src="images/"+e+".svg"},this.prepSearchWidget=function(){for(var e in z.searchBlockPosition=[100,100],z.searchSuggestions=[],z.deprecatedBlockNames=[],z.blocks.protoBlockDict){var t=z.blocks.protoBlockDict[e],a=t.staticLabels.join(" "),o=t.palette.model.makeBlockInfo(0,t,t.name,t.name).artwork64;if(a||void 0!==t.extraSearchTerms)if(t.deprecated)z.deprecatedBlockNames.push(a);else{if(0===a.length){var l=_(t.name);switch(t.name){case"scaledegree2":l=_("scale degree");break;case"voicename":l=_("voice name");break;case"invertmode":l=_("invert mode");break;case"outputtools":l=_("output tools");break;case"customNote":l=_("custom note");break;case"accidentalname":l=_("accidental name");break;case"eastindiansolfege":l=_("east indian solfege");break;case"notename":l=_("note name");break;case"temperamentname":l=_("temperament name");break;case"modename":l=_("mode name");break;case"chordname":l=_("chord name");break;case"intervalname":l=_("interval name");break;case"filtertype":l=_("filter type");break;case"oscillatortype":l=_("oscillator type");break;case"audiofile":l=_("audio file");break;case"noisename":l=_("noise name");break;case"drumname":l=_("drum name");break;case"effectsname":l=_("effects name");break;case"wrapmode":l=_("wrap mode");break;case"loadFile":l=_("load file")}z.searchSuggestions.push({label:l,value:t.name,specialDict:t,artwork:o})}else z.searchSuggestions.push({label:a,value:t.name,specialDict:t,artwork:o});if(void 0!==t.extraSearchTerms)for(var n=0;n<t.extraSearchTerms.length;n++)z.searchSuggestions.push({label:t.extraSearchTerms[n],value:t.name,specialDict:t,artwork:o})}}z.searchSuggestions=z.searchSuggestions.reverse()},this.hideSearchWidget=function(){var e=docByClass("ui-menu");0<e.length&&(e[0].style.visibility="hidden"),z.searchWidget.style.visibility="hidden",z.searchWidget.idInput_custom=""},this.showSearchWidget=function(){var e,a;z.searchWidget.style.zIndex=1001,z.searchWidget.style.border="2px solid lightblue",z.helpfulSearchDiv&&z._hideHelpfulSearchWidget(),"visible"===z.searchWidget.style.visibility?z.hideSearchWidget():(0<(e=docByClass("ui-menu")).length&&(e[0].style.visibility="visible"),z.searchWidget.value=null,z.searchWidget.style.visibility="visible",z.searchWidget.style.left=z.palettes.getSearchPos()[0]*z.turtleBlocksScale*1.5+"px",z.searchWidget.style.top=z.palettes.getSearchPos()[1]*z.turtleBlocksScale*.95+"px",z.searchBlockPosition=[100,100],z.prepSearchWidget(),a=z,document.addEventListener("mousedown",function e(t){"visible"===docById("search").style.visibility&&(t.target===docById("search")||docById("search").contains(t.target))||docById("ui-id-1")&&"block"===docById("ui-id-1").style.display&&(t.target===docById("ui-id-1")||docById("ui-id-1").contains(t.target))||document.getElementsByTagName("tr")[2].contains(t.target)||(a.hideSearchWidget(),document.removeEventListener("mousedown",e))}),setTimeout(function(){a.searchWidget.focus(),a.doSearch()},500))},this.doSearch=function(){var a=jQuery.noConflict(),o=z;a("#search").autocomplete({source:o.searchSuggestions,select:function(e,t){e.preventDefault(),o.searchWidget.value=t.item.label,o.searchWidget.idInput_custom=t.item.value,o.searchWidget.protoblk=t.item.specialDict,o.doSearch(),13===e.keyCode&&(z.searchWidget.style.visibility="visible")},focus:function(e){e.preventDefault()}}),a("#search").autocomplete("instance")._renderItem=function(e,t){return a("<li></li>").data("item.autocomplete",t).append('<img src="'+t.artwork+'" height="20px"><a> '+t.label+"</a>").appendTo(e.css({"z-index":9999,"max-height":"200px","overflow-y":"auto"}))};var e,t,l,n=z.searchWidget.idInput_custom;!n||n.length<=0||(t=(e=z.searchWidget.protoblk).palette.name,l=e.name,z.blocks.protoBlockDict.hasOwnProperty(l)?(z.palettes.dict[t].makeBlockFromSearch(e,l,function(e){o.blocks.moveBlock(e,100+o.searchBlockPosition[0]-o.blocksContainer.x,o.searchBlockPosition[1]-o.blocksContainer.y)}),z.searchBlockPosition[0]+=STANDARDBLOCKHEIGHT,z.searchBlockPosition[1]+=STANDARDBLOCKHEIGHT):-1<z.deprecatedBlockNames.indexOf(n)?z.errorMsg(_("This block is deprecated.")):z.errorMsg(_("Block cannot be found.")),z.searchWidget.value="",z.update=!0)},this.__makeNewNote=function(e,t){var a,o,l,n=[[0,"newnote",300-z.blocksContainer.x,300-z.blocksContainer.y,[null,1,4,8]],[1,"divide",0,0,[0,2,3]],[2,["number",{value:1}],0,0,[1]],[3,["number",{value:4}],0,0,[1]],[4,"vspace",0,0,[0,5]],[5,"pitch",0,0,[4,6,7,null]],[6,["solfege",{value:t}],0,0,[5]],[7,["number",{value:e}],0,0,[5]],[8,"hidden",0,0,[0,null]]];z.blocks.loadNewBlocks(n),null!==z.blocks.activeBlock&&(a=z.blocks.findBottomBlock(z.blocks.activeBlock),"hidden"===z.blocks.blockList[a].name&&"newnote"===z.blocks.blockList[z.blocks.blockList[a].connections[0]].name&&(o=z.blocks.blockList.length-9,l=z.blocks.blockList[a].connections.length-1,z.blocks.blockList[a].connections[l]=o,z.blocks.blockList[o].connections[0]=a,z.blocks.adjustDocks(a,!0))),z.blocks.activeBlock=z.blocks.blockList.length-1},this.makeSamplerWidget=function(e,t){var a=[[0,"sampler",300-z.blocksContainer.x,300-z.blocksContainer.y,[null,1,8]],[1,"settimbre",0,0,[0,2,6,7]],[2,["customsample",{value:["","","do",4]}],0,0,[1,3,4,5]],[3,["audiofile",{value:[e,t]}],0,0,[2]],[4,["solfege",{value:"do"}],0,0,[2]],[5,["number",{value:4}],0,0,[2]],[6,"vspace",0,0,[1,null]],[7,"hidden",0,0,[1,null]],[8,"hiddennoflow",0,0,[0,null]]];z.blocks.loadNewBlocks(a)},this.__keyPressed=function(e){if(!0===window.widgetWindows.isOpen("slider")&&(37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode))return e.preventDefault(),e.stopPropagation(),!1;if(!0!==window.widgetWindows.isOpen("JavaScript Editor")&&z.keyboardEnableFlag&&!docById("labelDiv").classList.contains("hasKeyboard")){if(z.keyboardEnableFlag){if(null!==docById("BPMInput")&&docById("BPMInput").classList.contains("hasKeyboard"))return;if(null!==docById("musicratio1")&&docById("musicratio1").classList.contains("hasKeyboard"))return;if(null!==docById("musicratio2")&&docById("musicratio2").classList.contains("hasKeyboard"))return;if(null!==docById("dissectNumber")&&docById("dissectNumber").classList.contains("hasKeyboard"))return;if(null!==docById("timbreName")&&docById("timbreName").classList.contains("hasKeyboard"))return}if(9===e.keyCode)return e.preventDefault(),!1;for(var t="block"===docById("lilypondModal").style.display||"visible"===z.searchWidget.style.visibility||"visible"===z.helpfulSearchWidget.style.visibility||z.isInputON||docById("samplerPrompt")||""===docById("planet-iframe").style.display||"visible"===docById("paste").style.visibility||""===docById("wheelDiv").style.display||z.turtles.running(),a=document.getElementsByClassName("wftTitle"),o=0;o<a.length;o++)if("tempo"===a[o].innerHTML){z.inTempoWidget=!0;break}if(e.altKey&&!t||13==e.keyCode||"/"==e.key||"\\"==e.key)switch(e.keyCode){case 66:z.textMsg("Alt-B "+_("Saving block artwork")),z.save.saveBlockArtwork();break;case 67:z.textMsg("Alt-C "+_("Copy")),z.blocks.prepareStackForCopy();break;case 69:z.textMsg("Alt-E "+_("Erase")),z._allClear(!1);break;case 82:z.textMsg("Alt-R "+_("Play"));var l=document.getElementById("stop");l&&(l.style.color=platformColor.stopIconcolor),z._doFastButton();break;case 13:if(z.isInputON)return;if("visible"===z.searchWidget.style.visibility)return;if("visible"===docById("paste").style.visibility)return z.pasted(),void(docById("paste").style.visibility="hidden");z.textMsg("Enter "+_("Play"));var n=document.getElementById("stop");n&&(n.style.color=platformColor.stopIconcolor),z._doFastButton();break;case 83:z.textMsg("Alt-S "+_("Stop")),z.logo.doStopTurtles();break;case 86:z.blocks.pasteStack();break;case 72:z.textMsg("Alt-H "+_("Save block help")),z._saveHelpBlocks();break;case 191:"/"!=e.key||z.beginnerMode||"block"!=disableHorizScrollIcon.style.display||(z.blocksContainer.x+=z.canvas.width/10,z.stage.update());case 220:"\\"!=e.key||z.beginnerMode||"block"!=disableHorizScrollIcon.style.display||(z.blocksContainer.x-=z.canvas.width/10,z.stage.update())}else if(e.ctrlKey)switch(e.keyCode){case 86:z.pasteBox.createBox(z.turtleBlocksScale,200,200),z.pasteBox.show(),docById("paste").style.left=(z.pasteBox.getPos()[0]+10)*z.turtleBlocksScale+"px",docById("paste").style.top=(z.pasteBox.getPos()[1]+10)*z.turtleBlocksScale+"px",docById("paste").focus(),docById("paste").style.visibility="visible",z.update=!0}else if(e.shiftKey&&!t){var i=_("ti la sol fa mi re do").split(" ");switch(e.keyCode){case 68:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("D "+i[6]),z.__makeNewNote(5,"do"));break;case 82:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("R "+i[5]),z.__makeNewNote(5,"re"));break;case 77:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("M "+i[4]),z.__makeNewNote(5,"mi"));break;case 70:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("F "+i[3]),z.__makeNewNote(5,"fa"));break;case 83:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("S "+i[2]),z.__makeNewNote(5,"sol"));break;case 76:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("L "+i[1]),z.__makeNewNote(5,"la"));break;case 84:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("T "+i[0]),z.__makeNewNote(5,"ti"))}}else{if("visible"===docById("paste").style.visibility&&13===e.keyCode)0<docById("paste").value.length&&z.pasted();else if(!t){var s,r=_("ti la sol fa mi re do").split(" ");switch(e.keyCode){case 35:z.textMsg("END "+_("Jumping to the bottom of the page.")),z.blocksContainer.y=-z.blocks.bottomMostBlock()+z.canvas.height/2,z.stage.update();break;case 33:z.textMsg("PAGE_UP "+_("Scrolling up.")),z.blocksContainer.y+=z.canvas.height/2,z.stage.update();break;case 34:z.textMsg("PAGE_DOWN "+_("Scrolling down.")),z.blocksContainer.y-=z.canvas.height/2,z.stage.update();break;case 46:z.textMsg("DEL "+_("Extracting block")),z.blocks.extract();break;case 38:z.inTempoWidget?z.logo.tempo.speedUp(0):(null!==z.blocks.activeBlock?(z.textMsg("UP ARROW "+_("Moving block up.")),z.blocks.moveStackRelative(z.blocks.activeBlock,0,-STANDARDBLOCKHEIGHT/2),z.blocks.blockMoved(z.blocks.activeBlock),z.blocks.adjustDocks(z.blocks.activeBlock,!0)):null!==z.palettes.activePalette?z.palettes.activePalette.scrollEvent(STANDARDBLOCKHEIGHT,1):z.blocksContainer.y+=20,z.stage.update());break;case 40:z.inTempoWidget?z.logo.tempo.slowDown(0):(null!==z.blocks.activeBlock?(z.textMsg("DOWN ARROW "+_("Moving block down.")),z.blocks.moveStackRelative(z.blocks.activeBlock,0,STANDARDBLOCKHEIGHT/2),z.blocks.blockMoved(z.blocks.activeBlock),z.blocks.adjustDocks(z.blocks.activeBlock,!0)):null!==z.palettes.activePalette?z.palettes.activePalette.scrollEvent(-STANDARDBLOCKHEIGHT,1):z.blocksContainer.y-=20,z.stage.update());break;case 37:z.inTempoWidget||(null!==z.blocks.activeBlock?(z.textMsg("LEFT ARROW "+_("Moving block left.")),z.blocks.moveStackRelative(z.blocks.activeBlock,-STANDARDBLOCKHEIGHT/2,0),z.blocks.blockMoved(z.blocks.activeBlock),z.blocks.adjustDocks(z.blocks.activeBlock,!0)):z.scrollBlockContainer&&(z.blocksContainer.x+=20),z.stage.update());break;case 39:z.inTempoWidget||(null!==z.blocks.activeBlock?(z.textMsg("RIGHT ARROW "+_("Moving block right.")),z.blocks.moveStackRelative(z.blocks.activeBlock,STANDARDBLOCKHEIGHT/2,0),z.blocks.blockMoved(z.blocks.activeBlock),z.blocks.adjustDocks(z.blocks.activeBlock,!0)):z.scrollBlockContainer&&(z.blocksContainer.x-=20),z.stage.update());break;case 36:z.textMsg("HOME "+_("Jump to home position.")),z.palettes.mouseOver?(s=Math.max(55-z.palettes.buttons.rhythm.y,0),z.palettes.menuScrollEvent(1,s),z.palettes.hidePaletteIconCircles()):null!==z.palettes.activePalette?z.palettes.activePalette.scrollEvent(-z.palettes.activePalette.scrollDiff,1):z._findBlocks(),z.stage.update();break;case 9:break;case 32:1===z.turtleContainer.scaleX?z.turtles.setStageScale(.5):z.turtles.setStageScale(1);break;case 27:"visible"===z.searchWidget.style.visibility&&(z.textMsg("ESC "+_("Hide blocks")),z.searchWidget.style.visibility="hidden");break;case 13:z.textMsg("Return "+_("Play")),z.inTempoWidget&&(z.logo.tempo.isMoving&&z.logo.tempo.pause(),z.logo.tempo.resume()),null!==z.blocks.activeBlock&&SPECIALINPUTS.includes(z.blocks.blockList[z.blocks.activeBlock].name)||z.logo.runLogoCommands();break;case 68:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("d "+r[6]),z.__makeNewNote(4,"do"));break;case 82:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("r "+r[5]),z.__makeNewNote(4,"re"));break;case 77:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("m "+r[4]),z.__makeNewNote(4,"mi"));break;case 70:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("f "+r[3]),z.__makeNewNote(4,"fa"));break;case 83:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("s "+r[2]),z.__makeNewNote(4,"sol"));break;case 76:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("l "+r[1]),z.__makeNewNote(4,"la"));break;case 84:_THIS_IS_MUSIC_BLOCKS_&&(z.textMsg("t "+r[0]),z.__makeNewNote(4,"ti"))}}z.currentKeyCode=e.keyCode}}},this.getCurrentKeyCode=function(){return z.currentKeyCode},this.clearCurrentKeyCode=function(){z.currentKey="",z.currentKeyCode=0},this._onResize=function(e){if(e||null!==z.saveLocally&&z.saveLocally(),z.stage){var t=jQuery.noConflict(),a=0,o=0,o="undefined"==typeof platform||platform.androidWebkit?(a=window.outerWidth,window.outerHeight):(a=window.innerWidth,window.innerHeight);if(z._clientWidth=document.body.clientWidth,z._clientHeight=document.body.clientHeight,z._innerWidth=window.innerWidth,z._innerHeight=window.innerHeight,z._outerWidth=window.outerWidth,z._outerHeight=window.outerHeight,!docById("labelDiv").classList.contains("hasKeyboard")){Math.min(a,o);var l=(z.cellSize,!1);z.turtleBlocksScale=1,z.stage.scaleX=z.turtleBlocksScale,z.stage.scaleY=z.turtleBlocksScale,z.stage.canvas.width=a,z.stage.canvas.height=o,z.turtles.doScale(a,o,z.turtleBlocksScale),z.boundary.setScale(a,o,z.turtleBlocksScale),z.trashcan.resizeEvent(z.turtleBlocksScale),z._setupPaletteMenu();var n=z.canvas.width/(2*z.turtleBlocksScale)-600,i=z.canvas.height/(2*z.turtleBlocksScale)-450;z.cartesianBitmap.x=n,z.cartesianBitmap.y=i,z.polarBitmap.x=n,z.polarBitmap.y=i,z.trebleBitmap.x=n,z.trebleBitmap.y=i,z.grandBitmap.x=n,z.grandBitmap.y=i,z.sopranoBitmap.x=n,z.sopranoBitmap.y=i,z.altoBitmap.x=n,z.altoBitmap.y=i,z.tenorBitmap.x=n,z.tenorBitmap.y=i,z.bassBitmap.x=n,z.bassBitmap.y=i;for(var s=0;s<7;s++)z.grandSharpBitmap[s].x=n,z.grandFlatBitmap[s].x=n,z.trebleSharpBitmap[s].x=n,z.trebleFlatBitmap[s].x=n,z.sopranoSharpBitmap[s].x=n,z.sopranoFlatBitmap[s].x=n,z.altoSharpBitmap[s].x=n,z.altoFlatBitmap[s].x=n,z.tenorSharpBitmap[s].x=n,z.tenorFlatBitmap[s].x=n,z.bassSharpBitmap[s].x=n,z.bassFlatBitmap[s].x=n;z.grandSharpBitmap[0].y=i,z.grandSharpBitmap[1].y=z.canvas.height/(2*z.turtleBlocksScale)-412.5,z.grandSharpBitmap[2].y=z.canvas.height/(2*z.turtleBlocksScale)-462.5,z.grandSharpBitmap[3].y=z.canvas.height/(2*z.turtleBlocksScale)-425,z.grandSharpBitmap[4].y=z.canvas.height/(2*z.turtleBlocksScale)-387.5,z.grandSharpBitmap[5].y=z.canvas.height/(2*z.turtleBlocksScale)-437.5,z.grandSharpBitmap[6].y=z.canvas.height/(2*z.turtleBlocksScale)-400,z.grandFlatBitmap[0].y=i,z.grandFlatBitmap[1].y=z.canvas.height/(2*z.turtleBlocksScale)-487.5,z.grandFlatBitmap[2].y=z.canvas.height/(2*z.turtleBlocksScale)-437.5,z.grandFlatBitmap[3].y=z.canvas.height/(2*z.turtleBlocksScale)-475,z.grandFlatBitmap[4].y=z.canvas.height/(2*z.turtleBlocksScale)-425,z.grandFlatBitmap[5].y=z.canvas.height/(2*z.turtleBlocksScale)-462.5,z.grandFlatBitmap[6].y=z.canvas.height/(2*z.turtleBlocksScale)-412.5;for(var r=0;r<7;r++)z.trebleSharpBitmap[r].y=z.grandSharpBitmap[r].y,z.trebleFlatBitmap[r].y=z.grandFlatBitmap[r].y,z.sopranoSharpBitmap[r].y=z.grandSharpBitmap[r].y,z.sopranoFlatBitmap[r].y=z.grandFlatBitmap[r].y,z.altoSharpBitmap[r].y=z.grandSharpBitmap[r].y,z.altoFlatBitmap[r].y=z.grandFlatBitmap[r].y,z.tenorSharpBitmap[r].y=z.grandSharpBitmap[r].y,z.tenorFlatBitmap[r].y=z.grandFlatBitmap[r].y,z.bassSharpBitmap[r].y=z.grandSharpBitmap[r].y,z.bassFlatBitmap[r].y=z.grandFlatBitmap[r].y;z.sopranoSharpBitmap[4].y-=87.5,z.sopranoSharpBitmap[6].y-=87.5,z.sopranoFlatBitmap[0].y-=87.5,z.sopranoFlatBitmap[2].y-=87.5,z.sopranoFlatBitmap[4].y-=87.5,z.sopranoFlatBitmap[6].y-=87.5;for(var c=0;c<7;c++)z.sopranoSharpBitmap[c].y+=87.5,z.sopranoFlatBitmap[c].y+=87.5;for(var u=0;u<7;u++)z.altoSharpBitmap[u].y+=87.5,z.altoFlatBitmap[u].y+=87.5;z.tenorSharpBitmap[0].y+=87.5,z.tenorSharpBitmap[2].y+=87.5;for(var d=0;d<7;d++)z.tenorSharpBitmap[d].y+=87.5,z.tenorFlatBitmap[d].y+=87.5;for(var p=0;p<7;p++)z.bassSharpBitmap[p].y+=175,z.bassFlatBitmap[p].y+=175;z.update=!0,"undefined"!=typeof platform&&platform.mobile?z.toolbar.disableTooltips(t):z.palettes.setMobile(!1);for(var M=0;M<z.turtles.getTurtleCount();M++)z.turtles.getTurtle(M).painter.doClear(!1,!1,!0);var g=docById("overlayCanvas");l?(g.width=2*a,g.height=2*o):(g.width=a,g.height=o),z.blocks.checkBounds()}}};var l,n=document.getElementById("canvasContainer"),i=document.getElementById("myCanvas"),s=document.getElementById("canvas"),r=document.getElementById("canvasHolder"),c=1600,u=900;function h(){var e,t;window.innerWidth===window.screen.width&&window.innerHeight===window.screen.height?(n.style.width=c+"px",n.style.height=u+"px",i.width=c,i.height=u,s.width=i.width,s.height=i.width,r.width=c,r.height=u):(e=window.innerWidth,t=window.innerHeight,n.style.width=e+"px",n.style.height=t+"px",i.width=e,i.height=t,s.width=i.width,s.height=i.width,r.width=i.width,r.height=i.height),document.getElementById("hideContents").click(),N.refreshCanvas()}window.addEventListener("resize",function(){clearTimeout(l),l=setTimeout(function(){h(),z._setupPaletteMenu()},100)}),window.addEventListener("orientationchange",h);function b(){try{N._onResize(!1),document.getElementById("hideContents").click()}catch(e){console.error("An error occurred in resizeCanvas_:",e)}}var N=this;b(),window.addEventListener("orientationchange",b);function I(e){e.blocks&&e.blocks.trashStacks&&0!==e.blocks.trashStacks.length?"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",e.__tick()):e.textMsg(_("Trash can is empty."),3e3)}function f(e){e.blocks&&e.blocks.trashStacks&&0!==e.blocks.trashStacks.length?(z._restoreTrashById(z.blocks.trashStacks[z.blocks.trashStacks.length-1]),e.textMsg(_("Item restored from the trash."),3e3),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",e.__tick())):e.textMsg(_("Trash can is empty."),3e3)}this._restoreTrashById=function(e){var t=z.blocks.trashStacks.indexOf(e);if(-1!==t){for(var a in z.blocks.trashStacks.splice(t,1),z.palettes.dict)z.palettes.dict[a].hideMenu(!0);z.blocks.activeBlock=null,z.refreshCanvas();var o=3*-z.cellSize;z.blocks.findDragGroup(e);for(var l=0;l<z.blocks.dragGroup.length;l++){var n=z.blocks.dragGroup[l];z.blocks.blockList[n].trash=!1,z.blocks.moveBlockRelative(n,0,o),z.blocks.blockList[n].show()}z.blocks.raiseStackToTop(e);var i=z.blocks.blockList[e];if("start"===i.name||"drum"===i.name){var s=i.value;z.turtles.getTurtle(s).inTrash=!1,z.turtles.getTurtle(s).container.visible=!0}else if("action"===i.name){var r=z.blocks.blockList[i.connections[1]];if(null!==r){var c,u=r.value;i.trash=!0;var d=z.blocks.findUniqueActionName(u);if(i.trash=!1,d!==r){c=8<(r.value=d).length?d.substr(0,7)+"...":d,r.text.text=c,null!==r.label&&(r.label.value=d),r.container.updateCache();for(var p=0;p<z.blocks.dragGroup.length;p++){var M=z.blocks.blockList[z.blocks.dragGroup[p]];["nameddo","nameddoArg","namedcalc","namedcalcArg"].includes(M.name)&&M.privateData===u&&(M.privateData=d,c=8<(M.value=d).length?d.substr(0,7)+"...":d,M.text.text=c,M.overrideName=c,M.regenerateArtwork(),M.container.updateCache())}}}}activity.textMsg(_("Item restored from the trash."),3e3),z.refreshCanvas()}},document.getElementById("restoreIcon").addEventListener("click",function(){z._renderTrashView()}),this._renderTrashView=function(){var e,c,t,a,o,l;activity.blocks&&activity.blocks.trashStacks&&0!==activity.blocks.trashStacks.length&&(e=document.getElementById("trashList"),(c=document.createElement("div")).id="trashView",c.classList.add("trash-view"),(t=document.createElement("div")).classList.add("button-container"),(a=document.createElement("a")).id="restoreLastIcon",a.classList.add("restore-last-icon"),a.innerHTML='<i class="material-icons md-48">restore_from_trash</i>',a.addEventListener("click",function(){z._restoreTrashById(z.blocks.trashStacks[z.blocks.trashStacks.length-1]),c.classList.add("hidden")}),(o=document.createElement("a")).id="restoreAllIcon",o.classList.add("restore-all-icon"),o.innerHTML='<i class="material-icons md-48">delete_sweep</i>',o.addEventListener("click",function(){for(;0<z.blocks.trashStacks.length;)z._restoreTrashById(z.blocks.trashStacks[0]);c.classList.add("hidden")}),a.setAttribute("title",_("Restore last item")),o.setAttribute("title",_("Restore all items")),t.appendChild(a),t.appendChild(o),c.appendChild(t),z.blocks.trashStacks.forEach(function(e){var t=z.blocks.blockList[e],a=document.createElement("div");a.classList.add("trash-item");var o=t.artwork,l="data:image/svg+xml;utf8,"+encodeURIComponent(o),n=document.createElement("img");n.src=l,n.alt="Block Icon",n.classList.add("trash-item-icon");var i,s,r=document.createTextNode(t.name);a.appendChild(n),a.appendChild(r),a.dataset.blockId=e,a.addEventListener("mouseover",function(){return a.classList.add("hover")}),a.addEventListener("mouseout",function(){return a.classList.remove("hover")}),a.addEventListener("click",function(){z._restoreTrashById(e),c.classList.add("hidden")}),i=c,s=!0,document.addEventListener("click",function(e){s?s=!1:i.contains(e.target)||e.target===i||(i.style.display="none")}),c.appendChild(a)}),(l=document.getElementById("trashView"))?e.replaceChild(c,l):e.appendChild(c))},this._openAuxMenu=function(){z.turtles.running()||0!==z.toolbarHeight||z._showHideAuxMenu(!1)};function C(e,t){e._showHideAuxMenu(t)}this._showHideAuxMenu=function(e){var t,a=document.querySelectorAll("#buttoncontainerTOP .tooltipped"),o=document.getElementById("Grid").getBoundingClientRect().top;z.changeTopButtonsPosition=function(t){a.forEach(function(e){e.style.top="".concat(o+t,"px")})},e||0!==z.toolbarHeight?(t=z.toolbarHeight,z.toolbarHeight=0,z.turtles.deltaY(-t),z.palettes.deltaY(-t),z.blocksContainer.y-=t,z.changeTopButtonsPosition(-t),z.cartesianBitmap.y-=t,z.polarBitmap.y-=t,z.trebleBitmap.y-=t,z.grandBitmap.y-=t,z.sopranoBitmap.y-=t,z.altoBitmap.y-=t,z.tenorBitmap.y-=t,z.bassBitmap.y-=t):(t=55+LEADING+5,z.toolbarHeight=t,z.palettes.deltaY(t),z.turtles.deltaY(t),z.blocksContainer.y+=t,z.changeTopButtonsPosition(t),z.cartesianBitmap.y+=t,z.polarBitmap.y+=t,z.trebleBitmap.y+=t,z.grandBitmap.y+=t,z.sopranoBitmap.y+=t,z.altoBitmap.y+=t,z.tenorBitmap.y+=t,z.bassBitmap.y+=t,z.blocks.checkBounds()),z.refreshCanvas()},this.hideAuxMenu=function(){0<z.toolbarHeight&&(z._showHideAuxMenu(!1),z.menuButtonsVisible=!1)},this.sendAllToTrash=function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];for(var o in z.blocksContainer.x=0,z.blocksContainer.y=0,z.blocks.palettes.dict)z.palettes.dict[o].hideMenu(!0);hideDOMLabel(),z.refreshCanvas();var l,n=0,i=3*z.cellSize;for(var s in z.blocks.blockList){null===z.blocks.blockList[s].connections[0]&&z.blocks.trashStacks.push(s),"start"===z.blocks.blockList[s].name||"drum"===z.blocks.blockList[s].name?(l=z.blocks.blockList[s].value,z.blocks.blockList[s].trash||null===l||(z.turtles.getTurtle(l).inTrash=!0,z.turtles.getTurtle(l).container.visible=!1)):"action"===z.blocks.blockList[s].name&&(z.blocks.blockList[s].trash||(z.blocks.deleteActionBlock(z.blocks.blockList[s]),n+=1)),z.blocks.blockList[s].trash=!0,z.blocks.moveBlockRelative(s,0,i),z.blocks.blockList[s].hide()}e?(z.blocks.loadNewBlocks(DATAOBJS),z._allClear(!1)):t||z.saveLocally();var r=z;setTimeout(function(){r.stage.dispatchEvent("trashsignal")},100*n),z.update=!0,a&&closeWidgets()};function S(e){e._changeBlockVisibility(),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",e.__tick())}this._changeBlockVisibility=function(){hideDOMLabel(),z.blocks.visible?(z.blocks.hideBlocks(),z.showBlocksAfterRun=!1,z.palettes.hide(),changeImage(z.hideBlocksContainer.children[0],SHOWBLOCKSBUTTON,HIDEBLOCKSFADEDBUTTON)):(changeImage(z.hideBlocksContainer.children[0],HIDEBLOCKSFADEDBUTTON,SHOWBLOCKSBUTTON),z.blocks.showBlocks(),z.palettes.show())};function B(e){e._toggleCollapsibleStacks(),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none",e.__tick())}this._toggleCollapsibleStacks=function(){hideDOMLabel(),z.blocks.visible&&z.blocks.toggleCollapsibles()},this.onStopTurtle=function(){},this.onRunTurtle=function(){},this.clearCache=function(){z.blocks.blockList.forEach(function(e){e.container&&(e.container.uncache(),e.container.cache()),e.bitmap&&(e.bitmap.uncache(),e.bitmap.cache())})},this.refreshCanvas=function(){var e;z.blockRefreshCanvas||(z.blockRefreshCanvas=!0,z.stage.clear(),z.stage.update(),z.update=!0,e=z,setTimeout(function(){e.blockRefreshCanvas=!1,e.stage.update()},5))},this.__tick=function(e){(z.update||createjs.Tween.hasActiveTweens())&&(z.update=!1,z.stage.update(e))};function O(e){e._doOpenSamples()}this._doOpenSamples=function(){"none"!==docById("palette").style.display&&(docById("palette").style.display="none"),z.toolbar.closeAuxToolbar(C),z.planet.openPlanet(),"none"!==docById("buttoncontainerBOTTOM").style.display&&(docById("buttoncontainerBOTTOM").style.display="none"),"none"!==docById("buttoncontainerTOP").style.display&&(docById("buttoncontainerTOP").style.display="none")},this.doUploadToPlanet=function(){z.planet.openPlanet()};function j(e){piemenuKey(e),"none"!==docById("helpfulWheelDiv").style.display&&(docById("helpfulWheelDiv").style.display="none")}function x(e,t){e.toolbar.closeAuxToolbar(C),void 0===t&&(t=!1),e.merging=!!t,document.querySelector("#myOpenFile").focus(),document.querySelector("#myOpenFile").click(),window.scroll(0,0),T(e),e._allClear(!0,!0)}window.prepareExport=this.prepareExport,this.runProject=function(e){document.removeEventListener("finishedLoading",z.runProject);var t=z;setTimeout(function(){t._changeBlockVisibility(),t._doFastButton(e)},5e3)};var E=[{value:"1/1",duration:1},{value:"1/2",duration:.5},{value:"1/4",duration:.25},{value:"1/8",duration:.125},{value:"1/16",duration:.0625},{value:"1/32",duration:.03125},{value:"1/64",duration:.015625},{value:"1/128",duration:.0078125}];this.getClosestStandardNoteValue=function(e){for(var t=E[0],a=Math.abs(e-t.duration),o=1;o<E.length;o++){var l=Math.abs(e-E[o].duration);l<a&&(t=E[o],a=l)}return t.value.split("/").map(Number)};function U(e,t,a,o){e._loadProject(t,a,o)}var W=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(a){var o,t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.turtles.running()){for(a.stage.update(event),t=0;t<a.turtles.getTurtleCount();t++)a.logo.turtleHeaps[t]=[],a.logo.turtleDicts[t]={},a.logo.notation.notationStaging[t]=[],a.logo.notation.notationDrumStaging[t]=[],a.turtles.getTurtle(t).painter.doClear(!0,!0,!1);_THIS_IS_MUSIC_BLOCKS_?(console.log("%cMusic Blocks","font-size: 24px; font-weight: bold; font-family: sans-serif; padding:20px 0 0 110px; background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+IDxzdmcgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgaWQ9InN2ZzExMjEiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM0LjEzMTI0OSAxNC41NTIwODkiIGhlaWdodD0iNTUuMDAwMDE5IiB3aWR0aD0iMTI5Ij4gPGRlZnMgaWQ9ImRlZnMxMTE1Ij4gPGNsaXBQYXRoIGlkPSJjbGlwUGF0aDQzMzciIGNsaXBQYXRoVW5pdHM9InVzZXJTcGFjZU9uVXNlIj4gPHJlY3QgeT0iNTUyIiB4PSI1ODgiIGhlaWdodD0iMTQzNiIgd2lkdGg9IjE5MDAiIGlkPSJyZWN0NDMzOSIgc3R5bGU9ImZpbGw6I2EzYjVjNDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDwvY2xpcFBhdGg+IDwvZGVmcz4gPG1ldGFkYXRhIGlkPSJtZXRhZGF0YTExMTgiPiA8cmRmOlJERj4gPGNjOldvcmsgcmRmOmFib3V0PSIiPiA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4gPGRjOnR5cGUgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4gPGRjOnRpdGxlPjwvZGM6dGl0bGU+IDwvY2M6V29yaz4gPC9yZGY6UkRGPiA8L21ldGFkYXRhPiA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLjA4Njc4MiwwLDAsMS4wODY3ODIsLTEuNTQ3MzI0NSwtMS4zMDU3OTkpIiBpZD0iZzE4MTIiPiA8ZWxsaXBzZSB0cmFuc2Zvcm09Im1hdHJpeCgwLjAxMDQ2MDk5LDAsMCwwLjAxMDQ2MDk5LDEuMDE2NzM4OSwtNi4yMDQ4NTI5KSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoNDMzNykiIHJ5PSI3NjgiIHJ4PSI3NDgiIGN5PSIxNDc2IiBjeD0iMTU0MCIgaWQ9InBhdGg0MzMzIiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDojYTNiNWM0O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxNTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPGVsbGlwc2Ugcnk9IjEuNzgyNjg1OSIgcng9IjEuNjkzOTIxNiIgY3k9IjguODM0MzUzNCIgY3g9IjE2LjQ0NjczOSIgaWQ9InBhdGg0MjU2IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDojYzlkYWQ4O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojYzlkYWQ4O3N0cm9rZS13aWR0aDowLjEwNDYwOTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDMyOCIgZD0ibSAxNy42MzAyNjYsMTMuNDg3MDkgMC4zMjU0NywwLjM5MjA0NCAwLjM0NzY2LDAuMjczNjkgMC4zMTA2NzYsMC4xMTA5NTUgMC4yMzY3MDUsLTAuMDUxNzggMC4xNDA1NDQsLTAuMTg0OTI2IDAuMTk5NzIsMC4wODEzNyAwLjE1NTMzOCwwLjA0NDM4IDAuNjEzOTU0LC0wLjQyMTYzMiAwLjQyMTYzMSwtMC4yNTE0OTkgYyAwLDAgMC44ODc2NDUsLTAuMDA3NCAxLjYwNTE1NywtMC41NTQ3NzcgMC43MTc1MTMsLTAuNTQ3MzgxIDAuNDk1NjAyLC0wLjY1MDkzOSAwLjQ5NTYwMiwtMC42NTA5MzkgbCAtMC4wMzY5OSwtMC40MjkwMjkgLTAuNTM5OTg0LC0wLjcxNzUxMyAtMC41NTQ3NzcsLTAuNTY5NTcxIC0wLjIyOTMwOSwtMC4xNDc5NDEgYyAwLDAgLTAuMDIyMTksLTAuMDQ0MzggLTAuMDczOTcsLTAuMDQ0MzggLTAuMDUxNzgsMCAtMC4yNDQxMDMsLTAuMDczOTcgLTAuNTE3NzkzLDAuMDQ0MzggLTAuMjczNjkxLDAuMTE4MzUzIC0wLjQ2NjAxNCwwLjE3MDEzMiAtMC44NDMyNjMsMC4zODQ2NDYgLTAuMzc3MjQ4LDAuMjE0NTE0IC0wLjcxMDExNSwwLjQyMTYzMSAtMC44MzU4NjUsMC40OTU2MDIgLTAuMTI1NzUsMC4wNzM5NyAtMC43NDcxLDAuNDI5MDI4IC0wLjc0NzEsMC40MjkwMjggbCAtMC4wOTYxNiwwLjY1ODMzNiB6IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDojZjhmOGY4O2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjAxMDQ2MDk5cHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggaWQ9InBhdGg0MzMwIiBkPSJtIDE4LjA4MTQ4NSwxMy4xMTcyMzkgYyAwLDAgMS4wMTcyMDIsMC4yMTk4MDggMS40OTA2MTMsLTAuMTM1MjUgMC42ODI1NSwtMC42NzQwOTcgMS42NTU4OTMsLTEuMTU0NzMxIDEuODcwMzU1LC0xLjc0NTMwOCAwLjEwODI1NywtMC4yOTgxMTYgMC4wOTI2NSwtMC4zNzIzNzcgLTAuMDgwMTgsLTAuNjM3MTkxIC0wLjc4NDA4NSwtMS4xMTY5NTIzIC0yLjE4NjAyMywwLjQ4MzU2MyAtMi4xODYwMjMsMC40ODM1NjMgbCAtMS4yMjA1MTEsMS4wNDI5ODMgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2M5ZGFkODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI4MSIgZD0ibSAxOC45MjM2MzgsMTEuOTExMTY2IGMgMCwwIC0yLjI2MjA3MywwLjM2MDA3MyAtMS4yNDU4MDcsMS42MzE0MjYgMS4wMTYyNjgsMS4yNzEzNTQgMS4zMzE1OSwwLjQ2ODQxNSAxLjMzMTU5LDAuNDY4NDE1IDAsMCAwLjIzNzM2NCwwLjI4NDAyMSAwLjU1MDIyMSwtMC4wMTI4OSAwLjMxMjg1NywtMC4yOTY5MSAwLjgwMTY1NywtMC40ODY1NjMgMC44MDE2NTcsLTAuNDg2NTYzIDAsMCAwLjgzMzQxOSwtMC4wODE1OCAxLjcyODg1MSwtMC42NDAzNDUgMC44OTU0MzIsLTAuNTU4NzY5IDAuMDI1NDUsLTEuNDk0NjQ0IDAuMDI1NDUsLTEuNDk0NjQ0IDAsMCAtMC43MDQwMDIsLTAuOTE0MzA1IC0xLjE5MTE1OCwtMS4wNjIwMDQgLTAuNDg3MTU1LC0wLjE0NzY5OSAtMS4yNjAyMDYsLTAuMjA1OTYzIC0xLjI2MDIwNiwtMC4yMDU5NjMgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNTkyNiIgZD0ibSAxNi44ODkxNjUsMy45OTA3MDY3IGMgLTAuMjA1OTI1LDAuMDA5MDIgLTAuNDkwNTg0LDAuMDE2NDUyIC0wLjY4MjQzNCwwLjA5NDMwNiAtMC4zNjM1MSwwLjExMzE2MjUgLTAuNzg0MDE5LDAuMzA2NTkxNiAtMS4xMDIwMzksMC40MTQ1MTk3IEMgMTQuODA1NzA3LDQuNjAwOTk5MyAxNC41MjgzODMsNC44Njc1ODQxIDE0LjQ0MjUxNSw0Ljc3MDc2NzYgMTQuMzE0ODUsNC42MjY4MjQ0IDE0LjIyNDM1Myw0LjU5NTM2MyAxNC4wNDU2ODksNC40OTc1NTkgMTMuODAxNzgxLDQuMzk5NTA1IDEzLjg3Mzc3Myw0LjQ0NDgyNzIgMTMuNjYwODY2LDQuMzg2MzI4MyAxMy41MTM2ODEsNC4zNDU4ODcxIDEzLjQ0ODI5LDQuMjg4Mjk1OCAxMy4wNDc5NTQsNC4zMDIzNTY3IGMgLTAuMjE2MDg3LDAuMDA3NTkgLTAuNDczNTEsMC4wMDgwNCAtMC42NjAwODEsMC4wODk3MjUgLTAuMzc0NjE1LDAuMTY0MDE3OCAtMC4yOTksMC4yNDg0NzU3IC0wLjUzODU3MiwwLjQ5MDAyNTIgLTAuMTY1MTA4LDAuMTY2NDcwOSAtMC4yMjMwMjksMC41NzQ5ODMxIC0wLjI4MjA0MSwwLjgxODg1OCAtMC4wNjkzOSwwLjI4Njc3NzYgLTAuMDU0NywwLjYwMTAzOTMgLTAuMDIwMzEsMC45Njc0MDMxIDAuMDI3NjEsMC4yOTQxOTY1IDAuMDkxNzMsMC40OTczOTM5IDAuMjQ5Mzg4LDAuNzU5MDYzIDAuMTM1MDg0LDAuMjI0MTk4OSAwLjMyNDU2MSwwLjI4MzU4MjggMC41NDY1OSwwLjQ5NzI4OTMgMC4wNzc3NCwwLjA3NDgzIDAuMzY4Mzk4LC0wLjAzODk2NSAwLjQ4NDg4LC0wLjAxNTEwNCAwLjEwODcwOSwwLjAyMjI3IC0wLjA0ODE3LDAuMjE2NzA4OCAtMC4wNTMyLDAuMjQ1MzgzNCAtMC4wNTM4LDAuMjM5NTE2OSAtMC4xMTA1MDMsMC4wODc3NzEgLTAuMDgwNiwwLjYyNzQyNjEgMC4zNDgxMjMsMi4wMjY2ODkyIDEuMDA1MDg5LC0xLjA2NzI2NDcgMC4zMjY2NDksMC42Njg2MTk0IC0wLjA1Mjk4LDAuMTM1NTY0IC0wLjQzNzU5NCwwLjM4ODgwNjggLTAuNTAzMzY4LDAuNTg2ODUzOCAtMC4wMTI2NywwLjE2NTEwOSAwLjE5NzgzNSwwLjE5NDA4IDAuMzE4OTk3LDAuMTc4MDQ5IDAuMDYyNjYsMC40ODAzOTUgMC4xMjQ5ODIsMS4wNDIwNDggMC41MjIyNDIsMS4zNzI0MzkgMC4xMjAxNzcsMC4xMDY0MDIgMC4yODY2NTIsMC4wOTQ0NyAwLjQyOTMxNywwLjEyNjQ0MyAwLjIyMTY0MSwwLjI2ODEyOCAwLjQ0ODY2OCwwLjU1NzA2NiAwLjc4NDA4NywwLjY4OTc3NCAwLjI4Mzg0NSwwLjE0ODQzNSAwLjYyNDkxMywwLjA1MSAwLjg5NjEzOCwwLjIzMzA2NSAwLjcxMjkyNSwwLjM2MDkwMSAxLjU5NDM3LDAuMjI3NDI0IDIuMjQwMzA3LC0wLjIxNDM2NyAwLjIzOTczNiwtMC4wMjU4NCAwLjUwMTI0MywwLjA1MTE5IDAuNzUxMzkxLDAuMDIyMjIgMC41NzU4OTgsLTAuMDIwMDYgMS4xNjcyMDcsLTAuMjQwMDA1IDEuNTIzOTYyLC0wLjcxMTUwMiAwLjA3MjksLTAuMDY2IDAuMTAyMDgxLC0wLjE3ODE0IDAuMTY4ODAzLC0wLjI0MDYzNSAwLjA2NjE2LDAuMDgzMyAwLjIwMTA3OSwwLjE2NTI4OSAwLjI4NTY1MywwLjA1NTAyIDAuMTkzMDcyLC0wLjI1MzQzNiAwLjIyMzQxMywtMC41OTUxMDQgMC4zMjcxNDUsLTAuODgyNTU5IDAuMDg2NTgsMC4wMzY0MSAwLjA4NDIsMC4yNjU3MzQgMC4xOTA4MiwwLjE3NTk2OCAwLjA4ODU4LC0wLjI3NzUxIDAuMjMxMDU1LC0wLjU4OTU1NCAwLjE1NzQ4NywtMC44NzUxMDMgQyAyMS4wOTQ5NjgsOS44NjQxNTE0IDIwLjk5NDc5OSw5LjcxMDk4NzkgMjAuOTU5NzUxLDkuNjcwOTkxNCAyMS4wNjk3Myw5LjY2NDkyMTQgMjEuMzkyMTQ2LDkuNjA3NDEyNCAyMS4zNjQyMjYsOS40MzQyNzkgMjEuMjg0OTAyLDkuMjY0MDY1MSAyMC45MzAzMjQsOS4wNTgwODkzIDIwLjc4MTQ3LDguOTYzNjg5MyAyMC42Mjc0ODksNy4wODIzNjI5IDIwLjgzMTk0MSw3Ljk3MzAwNDMgMjAuMzc0NDc1LDYuNTcyMTY2OCAyMC4yODY2OTMsNi4yOTYzNjYgMjAuMTc5NTgyLDYuMDI1MzkwOCAyMC4wMzkxNDksNS43NjczNzc4IDE5LjgxNDE1NSw1LjM1NDAwNzYgMTkuNTAzNjMsNC45NzM5MDc1IDE5LjA1MDAzMSw0LjY2MDUzMjggMTguNjk0MTU3LDQuNDg2NjE1NyAxOC43NzkxNjcsNC40MTI0NTc4IDE4LjQxNjMxOSw0LjI4NDIxMTggMTguMDQwOTE2LDQuMTE0ODkzIDE3LjkyMzEyNiw0LjExNDQyOTQgMTcuNzA2MjE3LDQuMDQ5NTUxNCAxNy40MjE5OTMsNC4wMDQyMzgyIDE3LjE3NjIyNiwzLjk5MzQ2MTEgMTYuODg5MTY1LDMuOTkwNzA2NyBaIG0gLTAuNDE2Nzc3LDMuNzcwMjM0NSBjIDAuMjU4MDA1LDAuMDA5NzYgMC40MjkyNTksMC4yNTQ4MTQgMC41Mjc1MDEsMC40Njg0NDEgLTAuMDQ2NTEsMC4xMjA5MTIzIC0wLjIxNzYxMywwLjE4MDMzMTggLTAuMzE0MzE2LDAuMjcwODAwNSAtMC4wNTIyNywwLjAzMDg5OCAtMC4xOTUwNTcsMC4xNDE5ODI5IC0wLjA3Mzk3LDAuMTc2MjU4MyAwLjE2NzU3NCwtMC4wMDgwMSAwLjM0MTEyNSwtMC4xMDE3NzYgMC41MDIzNjMsLTAuMDgxMjUzIDAuMDM4OCwwLjMxMzY5MjcgMC4wMTAzOCwwLjcyNTUwMzEgLTAuMjk1OTM5LDAuOTAyMTQ5NSAtMC4zMTY4ODQsMC4wODI4MjcgLTAuNTYyMDUzLC0wLjIxMjE0MTYgLTAuNjc2ODI5LC0wLjQ3MTYxOCAtMC4xNDcwOTYsLTAuMzY2NjkwMiAtMC4xODU5MzQsLTAuODQyODQzMSAwLjA3NjUxLC0xLjE2Njk5ODggMC4wNjUzMSwtMC4wNjgyNjggMC4xNjAwMTEsLTAuMTA2MzQ3NSAwLjI1NDY3OCwtMC4wOTc3OCB6IG0gMi44NTkyNDQsMi41NzU3ODc4IGMgLTAuMDc2NzMsMC4xODQ3NTggLTAuMjMwNjU5LDAuMzMwMTU2IC0wLjQwNzAxMSwwLjQxMzI1MiAtMC4wNTUzOSwwLjE1MDcwNSAwLjA0MDA0LDAuMzU0MzggMC4wMjk3LDAuNDgzMjM0IC0wLjA0OTA3LC0wLjE2MDM1NyAtMC4wMDE2LC0wLjM2MTQyNiAtMC4xMDg4NzUsLTAuNDk2NzU3IC0wLjA3MDE4LC0wLjAyMjcxIC0wLjE0Nzc0NywtMC4wMjgxIC0wLjIxMTc0MSwtMC4wNzIwNiAwLjIxMjc5NCwwLjExNzcxNyAwLjQ5NTYxLDAuMDM5MjQgMC42MDQ3NjYsLTAuMTgyMDk0IDAuMDI5MzQsLTAuMDM3NjIgMC4wODE1OSwtMC4xNDU1NzUgMC4wOTMxNiwtMC4xNDU1NzEgeiBtIC0wLjk2NTM3MiwwLjE0MTk4OCBjIDAuMDQ1NjYsMC4wMzQwOSAwLjIwNDg5NywwLjE2Mjg1NyAwLjA3NzQ0LDAuMDY3ODUgLTAuMDE2NDEsLTAuMDExMzggLTAuMDkwMTksLTAuMDcwODYgLTAuMDc3NDQsLTAuMDY3ODUgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2M5ZGFkODtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wNTIzMDQ5NTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggaWQ9InBhdGg0MjU3IiBkPSJtIDE4LjU2MjI5Miw0LjM0MDY1NDMgYyAwLDAgLTAuMDE4MjMsLTAuMTI2MDkyNSAwLjA1NTAzLC0wLjI2MzA5MTEgMC4xMDcwNjUsLTAuMjAwMjExOCAwLjM2NDA0MywtMC40MDk5NDg1IDAuNjYxOTUxLC0wLjU5NjUyOTEgMC4zOTA1NzksLTAuMjQ0NjIwMiAwLjg3ODEwNSwtMC40MDE1NzcyIDEuNDU3NjUzLDAuMDM1OTg1IDAuMTUwMzMxLDAuMTEzNTAwOCAwLjI3NTEyLDAuMzU2MTg0OSAwLjQzNjUyLDAuNTQ2MjQ1OCAwLDAgMC40NDM4MjIsMC41MzI1ODcxIDAuMDU5MTgsMS43OTAwODI5IEMgMjAuODQ3OTc4LDcuMTEwODQ1IDIwLjI0MTQyLDYuNTMzODc1NCAyMC4yNDE0Miw2LjUzMzg3NTQgWiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2M5ZGFkODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI1OSIgZD0ibSAxNS41NDQ5NjIsNC4zMTU2Mjk4IGMgMC42NzQwMTYsMC44NjIwMTcgMi4yMjQ5NDUsMy4zNjQ2NDY3IDIuNTUyNDgxLDIuMTM1NzQ3MSAwLjIwOTIyLC0wLjkxMDEwNjEgMC4wMTUzMiwtMi4zMDI1OTczIDAuMDE1MzIsLTIuMzAyNTk3MyAwLDAgLTEuMjUyMDM4LC0wLjQ2NTg4NTcgLTIuNTY3ODAyLDAuMTY2ODUwMiB6IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDojODk5YmIwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojODk5YmIwO3N0cm9rZS13aWR0aDowLjEwNDYwOTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI3NiIgZD0ibSAxNC41NTMyNiw5LjMxOTI1NjMgYyAwLDAgLTAuMTY3Mzc2LDAuMDUyMzA1IDEuMDk4NDA0LDAuMzM0NzUxNyAxLjI2NTc4LDAuMjgyNDQ2NyAxLjYyMTQ1MywtMC42Njk1MDM0IDEuNjIxNDUzLC0wLjY2OTUwMzQgMCwwIDEuMDM1NjM4LC0xLjUxNjg0MzYgMi4xNDQ1MDMsLTAuMzAzMzY4NyAwLDAgMC4yODI0NDcsMC4zMDMzNjg3IDAuNzg0NTc1LDAuMjkyOTA3NyAwLDAgMC4zMTM4MjksLTAuMTc3ODM2OCAwLjU3NTM1NCwtMC4wMTA0NjEgMC4yNjE1MjUsMC4xNjczNzU5IDAuNDkxNjY3LDAuMzI0MjkwNyAwLjQ5MTY2NywwLjMyNDI5MDcgMCwwIDAuMzg3MDU2LDAuMzY2MTM0NyAtMC4yOTI5MDgsMC4zNTU2NzM3IDAsMCAwLjQyODksMC4xMDQ2MDk5IC0wLjA4MzY5LDEuMzM5MDA3IGwgLTAuMTQ2NDU0LC0wLjMzNDc1MiBjIDAsMCAtMC4yMDkyMiwxLjQwMTc3MyAtMC41NzUzNTQsMC44NjgyNjIgMCwwIC0wLjE2ODU2NywwLjI4NDA0MiAtMC41NDkzMzUsMC41MzgxMTEgLTAuNDYxNzA0LDAuMzA4MDczIC0xLjIwMDYyLDAuNTc5MDM0IC0xLjg4Mjg0NiwwLjMzNTM4MiAwLDAgLTAuOTI5NDM2LDEuMDIzNTYzIC0yLjUxMjQwMiwwLjEyMTEyNSAwLDAgLTAuODcxNzI4LDAuMTY2NTUyIC0xLjQ1NzU0MywtMC44MTY3ODEgMCwwIC0wLjgwNTQ5NiwwLjE5ODc1OSAtMC45NTE5NSwtMS40OTU5MjIgMCwwIC0wLjY3OTk2NSwwLjA0MTg0IC0wLjA0MTg0LC0wLjU0Mzk3MSAwLjYzODEyLC0wLjU4NTgxNTUgMS4yMDMwMTQsLTAuNDYwMjgzNiAxLjIwMzAxNCwtMC40NjAyODM2IHoiIHN0eWxlPSJkaXNwbGF5OmlubGluZTtmaWxsOiNmOGY4Zjg7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuMDEwNDYwOTlweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQzNjUiIGQ9Im0gMTMuNTM4NTQ0LDUuMzE3OTI3NiBjIC0wLjAxNjk4LDAuMDAzMzMgLTAuMjk1NDI5LDAuMDA0MTEgLTAuNTQyNjE0LC0wLjEyODc4OTQgLTAuMTI2Mjk4LC0wLjA2NzkwNiAtMC4yNDcwMjYsLTAuMTI3MDA2OSAtMC4yOTEyNywtMC4xODU5ODA3IC0wLjAzNTY0LC0wLjA0NzUwOCAwLjAwNDEsLTAuMTExNDU4NyAtMC4wNjY4NSwtMC4wNTMwMjIgLTAuOTQ5ODUyLDAuNzgyODExNiAtMC40ODU4NjcsMi4wNDg5MTU3IDAuMzkxNTE4LDIuMzgxNzQ5OSAwLDAgMC4xNjgwMywtMC45MzA1MDIgMS4wODQ1NzEsLTEuOTg3ODA1NyIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2Y4ZjhmODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggaWQ9InBhdGg0MzY3IiBkPSJtIDE4Ljk2OTEyOSw0LjU1MTQ2OTcgYyAwLDAgMC45NjE2MTUsMC42ODA1MjcxIDEuMTk4MzIsMS42MTI1NTQzIDAsMCAxLjE1MzkzOSwtMS43MzA5MDY4IC0wLjA3Mzk3LC0yLjQyNjIyODIgMCwwIC0wLjIwNzExOCwwLjc5ODg4IC0xLjEyNDM1MSwwLjgxMzY3MzkgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2Y4ZjhmODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDIxNSIgZD0ibSAxMi44Mzg2ODUsMTAuMjA5MDE4IGMgMC4xNDQzOTksMS43NjE2ODIgMC45Mzg2MDEsMS40NzI4ODIgMC45Mzg2MDEsMS40NzI4ODIgMC42MzUzNiwxLjAxMDggMS40Mjk1NjEsMC44MjMwOCAxLjQyOTU2MSwwLjgyMzA4IDEuMzcxODAyLDAuODM3NTIyIDIuNTI3MDAzLC0wLjEwMTA3OSAyLjUyNzAwMywtMC4xMDEwNzkgMS45MzQ5NjMsMC4zMTc2OCAyLjQxMTQ4MywtMC45MjQxNjIgMi40MTE0ODMsLTAuOTI0MTYyIDAuMzc1NDQxLDAuNTc3NjAxIDAuNjA2NDgxLC0wLjgwODY0MSAwLjYwNjQ4MSwtMC44MDg2NDEgMC4wNTc3NiwtMC4xMTU1MiAwLjE0NDQwMSwwLjM0NjU2IDAuMTQ0NDAxLDAuMzQ2NTYgMC40NjIwNzksLTEuMjEyOTYwNSAwLjA4MzI0LC0xLjM3NzgzMyAwLjA4MzI0LC0xLjM3NzgzMyAxLjAxMDgwMSwwLjAyODg4IC0wLjIwMzYyNiwtMC43MDI4NzQgLTAuMjAzNjI2LC0wLjcwMjg3NCAtMC4wMjU1MywtMS4wNTkwNjU0IC0wLjAyNTA4LC0xLjMyOTIxMzEgLTAuMzkwMDU0LC0yLjMzMzQzNzggMC44MDk3OTcsMC4yMTYzODc3IDAuODExMDU3LC0wLjk2MDY1ODkgMC45NDkxNywtMS4yMjk3ODc3IDAuMTk5OTE5LC0wLjUzOTAyNDUgLTAuMDM1NiwtMS41MDQ0OTA0IC0wLjY3OTY0MSwtMS45MTk1MzIzIC0wLjI2NTQxMSwtMC4xNzEwMzg3IC0wLjYwMDIsLTAuMjQ4NjAwOSAtMS4wMDI0ODYsLTAuMTY0MzE5OCAtMC4zMDI3NTUsMC4xMzkwMTI4IC0wLjY5MjU0LDAuMzk0OTg5NSAtMC45MDc2MjgsMC42MDg2NjE5IC0wLjE5MzYxMywwLjE5MjMzOTUgLTAuMjE5NjQ5LDAuMzAzMjExNCAtMC4xOTU0NDIsMC40MTU1NTciIHN0eWxlPSJmaWxsOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiM1MDUwNTA7c3Ryb2tlLXdpZHRoOjAuMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggaWQ9InBhdGg0MjI3IiBkPSJtIDEyLjgzODY4NSwxMC4yMTE0OTUgYyAwLDAgLTAuOTA5NzIxLDAuMDk4NiAwLjI1OTkyLC0wLjgxMTExNzkgMCwwIDAuNDkwOTYsLTAuNDE4NzYwOCAxLjQ3Mjg4MSwtMC4wNTc3NiIgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQyMjkiIGQ9Ik0gMTIuOTA0OTA0LDkuNTY1NTUzIEMgMTIuNTA1NjUzLDguNzczODU0OCAxMi42NzA3OTcsOC4xNjU2MDM3IDEyLjg1MDI0NCw3Ljk1ODI5NCIgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQyMDEiIGQ9Im0gMTQuNTgxMzAzLDQuODIyNzY5MiBjIDAsMCAxLjc5NTc0OSwtMS40NTE3MDY2IDMuOTY3MjA3LC0wLjUxNTAzMDkiIHN0eWxlPSJkaXNwbGF5OmlubGluZTtmaWxsOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiM1MDUwNTA7c3Ryb2tlLXdpZHRoOjAuMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiBkPSJNIDEyLjkxMzUyNyw3Ljg5OTY1ODEgQyAxMC44OTQzNTYsOC4zNTIwMTQzIDExLjE2ODQwMiw0LjI1NDUyNDcgMTIuNzY0OTUyLDQuMzAyNTA3MyAxMy4zODM1NjksNC4yODU3MzczIDE0LjA5NzQyNCw0LjI2Nzg1NSAxNC42NTY4MSw1LjAwMTUxMyIgaWQ9InBhdGg0MjA3IiAvPiA8cGF0aCBpZD0icGF0aDQyMzMiIGQ9Im0gMTguMzQwMzMxLDEwLjQ1NDQ5OSBjIDAsMCAwLjY2NDI0LDAuNzIyIDEuMDEwODAxLC0wLjE3MzI4IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojNTA1MDUwO3N0cm9rZS13aWR0aDowLjEwNDYwOTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDIzNSIgZD0ibSAxOC44ODkwNTIsMTAuNzI4ODU5IDAuMDcyMiwwLjU2MzE2IiBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojNTA1MDUwO3N0cm9rZS13aWR0aDowLjEwNDYwOTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI1MSIgZD0ibSAxNC4xMzQ4Miw1LjM0NDA4MDEgYyAtMC4xNzgzOTEsMCAtMC42MzI5NDYsMC4wMDY5OCAtMC45OTQxOTIsLTAuMDg2ODE2IEMgMTIuOTA4NzMsNS4xOTcwNTE5IDEyLjcxNTI4NCw1LjA5NTMxMjUgMTIuNjU4MDI2LDQuOTIzNTM3OCIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzUwNTA1MDtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQzMDEiIGQ9Im0gMTIuNjcyOTA2LDExLjI0OTk1OSBjIDAsMCAtMS4yMTMxMTMsMC44ODAyNDcgLTAuNzI0OTA5LDEuNTQ1OTgxIGwgMC41OTkxNiwwLjUzMjU4NiAwLjgyMTA3MiwwLjQ0MzgyMyAxLjIyNzkwNywwLjA2NjU3IDAuODA2Mjc3LC0wLjE0Nzk0MSAwLjQxNDIzNCwtMC4xODQ5MjYgMC40NDM4MjIsMC4zNzcyNSAwLjM5OTQ0MSwwLjAxNDc5IDAuMjI5MzA4LC0wLjExMDk1NiAwLjY4NzkyNCwtMC4yNzM2OTEgMC4zNjI0NTYsLTAuMjg0Nzg2IDAuMjA3MTE3LC0wLjMxNDM3MyAtMC4wMjk1OSwtMC4zNDAyNjQgYyAwLDAgLTAuMzg0NjQ2LC0xLjE2MTMzNSAtMC43OTg4OCwtMS4zNDYyNjEgMCwwIC0wLjUzMjU4NywtMC41NzY5NjkgLTEuMjcyMjkxLC0wLjA4MTM3IDAsMCAtMS4xMTY5NTIsMC4zNjk4NTIgLTIuMDg1OTY0LDAuMDQ0MzggLTAuOTY5MDEyLC0wLjMyNTQ3IC0xLjI4NzA4NSwwLjA1OTE4IC0xLjI4NzA4NSwwLjA1OTE4IHoiIHN0eWxlPSJkaXNwbGF5OmlubGluZTtmaWxsOiNmOGY4Zjg7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuMDEwNDYwOTlweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQzMjUiIGQ9Im0gMTEuODUzMTgsMTIuNDgxMDk0IGMgMCwwIDEuMjIwNTExLC0wLjcwMjcxOSAzLjA2OTc3LC0wLjE4NDkyNyAwLDAgMC45MTcyMzQsMC4xNjI3MzYgMS41MDg5OTYsLTAuMDY2NTcgMC41OTE3NjQsLTAuMjI5MzA5IDAuNzkxNDgzLDAuMjczNjkgMC43OTE0ODMsMC4yNzM2OSAwLDAgMC40NjYwMTQsMC44NDMyNjIgMC4zOTk0NCwwLjkwMjQzOCBsIDAuMTc3NTI5LC0wLjA1MTc4IDAuMjY2MjkzLC0wLjM0MDI2NCAwLjA3Mzk3LC0wLjI1ODg5NyAtMC4xNDA1NDMsLTAuNDI5MDI4IC0wLjI3MzY5MSwtMC41NzY5NjggLTAuMzEwNjc2LC0wLjQ0MzgyMiAtMC4yNTE0OTksLTAuMTg0OTI3IC0wLjQyMTYzMSwtMC4xODQ5MjUgLTAuNDA2ODM4LDAuMDI5NTkgLTAuNjA2NTU2LDAuMjUxNDk5IGMgMCwwIC0xLjAyODE4OSwwLjI4ODQ4NSAtMi4yNDg3LC0wLjE4NDkyNSAwLDAgLTAuOTAyNDM4LC0wLjE2MjczNiAtMS41MTYzOTIsMC45ODM4MDYgbCAtMC4xMTgzNTMsMC4zOTk0MzkgeiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6I2M5ZGFkODtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiIC8+IDxwYXRoIGlkPSJwYXRoNDI3OSIgZD0ibSAxNi44MzM2NzIsMTMuNzg1MjE3IGMgMC4xNTM0MjMsLTAuMTAyOTY3IDEuNDU0MTIyLC0wLjQwNTE0NCAxLjI3MTUzLC0xLjEwNzA1MiAtMC4xODI1OSwtMC43MDE5MDYgLTAuODEwNDg4LC0yLjE4MzA4IC0xLjk2Mjc0OSwtMS42MjExNTEgLTEuMTUyMjY0LDAuNTYxOTMyIC0yLjQyODI3MSwwLjA0NDIyIC0yLjQyODI3MSwwLjA0NDIyIDAsMCAtMC41MDI1NzUsLTAuMTkxMTk4IC0wLjkxNzEzNywwLjA0NDc1IC0wLjQxNDU2MiwwLjIzNTk1MSAtMC44MzU2OTEsMC42MjQyODUgLTAuOTY5NjcsMS4yNjM4MzYgLTAuMTMzOTgyLDAuNjM5NTU3IDEuNTU5NzQ1LDEuMzQxOTkxIDEuNTU5NzQ1LDEuMzQxOTkxIDAsMCAxLjYyODU2NywwLjIzODgxMyAyLjM5NTY5MywtMC4yNzYwMzUgMCwwIDAuNjI5NzI5LDAuNjk3NzcxIDEuMDUwODU5LDAuMzA5NDM3IHoiIHN0eWxlPSJkaXNwbGF5OmlubGluZTtmaWxsOm5vbmU7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiM1MDUwNTA7c3Ryb2tlLXdpZHRoOjAuMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHBhdGggZD0ibSAxNy4xMTQwMTYsOC41MDk4MjQxIGEgMC45NDk4OTcwOCwwLjU4NjQwNTg3IDc4LjA3ODA2MiAwIDEgLTAuMzQwNjEzLDEuMDQwNjk1NSAwLjk0OTg5NzA4LDAuNTg2NDA1ODcgNzguMDc4MDYyIDAgMSAtMC43NzY1NjIsLTAuNjc4NzU2IDAuOTQ5ODk3MDgsMC41ODY0MDU4NyA3OC4wNzgwNjIgMCAxIDAuMjM5NTYsLTEuMTI5MDIxNiAwLjk0OTg5NzA4LDAuNTg2NDA1ODcgNzguMDc4MDYyIDAgMSAwLjgwNzczNiwwLjUzMTgzNzIgbCAtMC41MDM4NzgsMC4zNTYzODM5IHoiIGlkPSJwYXRoNDI2NSIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6IzUwNTA1MDtmaWxsLW9wYWNpdHk6MTtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5NDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIgLz4gPHBhdGggZD0iTSAyMC40MTM5NzcsOC4wMzE1OTA2IEEgMC44NTY3NjMyNSwwLjUyODkxMDk1IDc4LjA3ODA2MiAwIDEgMjAuMTA2NzYsOC45NzAyNDk4IDAuODU2NzYzMjUsMC41Mjg5MTA5NSA3OC4wNzgwNjIgMCAxIDE5LjQwNjMzNiw4LjM1ODA0MzEgMC44NTY3NjMyNSwwLjUyODkxMDk1IDc4LjA3ODA2MiAwIDEgMTkuNjIyNDA3LDcuMzM5NzE3NiAwLjg1Njc2MzI1LDAuNTI4OTEwOTUgNzguMDc4MDYyIDAgMSAyMC4zNTA5NDgsNy44MTk0MTA4IGwgLTAuNDU0NDc0LDAuMzIxNDQxNiB6IiBpZD0icGF0aDQyNjUtMiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lO2ZpbGw6IzUwNTA1MDtmaWxsLW9wYWNpdHk6MTtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5NDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIgLz4gPHBhdGggaWQ9InBhdGg1NzIwIiBkPSJtIDIxLjEzNDgzMiw3LjY5NjM2MzQgYyAtMC4xMTIzMTgsLTAuMDI3NzU3IC0wLjI2MjQ5NywtMC4wODEwNTQgLTAuMzMzNzMxLC0wLjExODQzODMgLTAuMTQ0MDA1LC0wLjA3NTU3MyAtMC4yOTkzMjksLTAuMjY5ODY1MyAtMC4yOTkzMjksLTAuMzc0NDI2IDAsLTAuMDk2NjA3IC0wLjE5MzI5OCwtMC44NDY4MTQgLTAuMjk0MTMzLC0xLjE0MTU1OTcgQyAxOS45MTc4NSw1LjIxNDg4MjcgMTkuNDI2NzM2LDQuNjc1ODIwNSAxOC44MDY4MDgsNC41MjQzNDIzIDE4LjU3NDU0Myw0LjQ2NzU4OTMgMTguMzc3OTYsNC4zNzc3MTcyIDE4LjM3Nzk2LDQuMzI4Mjg1MSBjIDAsLTAuMTE2NTg3NCAwLjUxODc4NywtMC4zNzIwNTkgMC43NTU1ODcsLTAuMzcyMDgxOCAwLjIyNTEyOSwtMi4wOWUtNSAwLjU1MTc3MywwLjE5NTUxMDUgMC43NTQwMDcsMC40NTEzNTU2IDAuMDg5NTgsMC4xMTMzMjYgMC4zMzY4NDMsMC41NTg3ODc0IDAuNTQ5NDc2LDAuOTg5OTE0MSAwLjYzMDg5MSwxLjI3OTE3MTkgMS4xMjc0NjQsMS45Njg0NzM4IDEuNTY3NTYzLDIuMTc1OTYzMyAwLjIxNzMwOCwwLjEwMjQ1MTggMC4yMjYxMTYsMC4xMTE5NDIgMC4xMzA4ODEsMC4xNDEwMjE1IC0wLjE1OTgzNSwwLjA0ODgwNCAtMC43NzQ5NSwwLjAzNzY4MSAtMS4wMDA2NDIsLTAuMDE4MDk0IHoiIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjA7c3Ryb2tlLXdpZHRoOjAuMDUyMzA0OTU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lIiAvPiA8cGF0aCBpZD0icGF0aDQyNDUiIGQ9Im0gMTUuNTQ0Mzg3LDQuMzE0MzcwOSBjIDAsMCAxLjU1NTIyNiwyLjEwODgwNTMgMi4wNzgyNzYsMi4yNzYxODExIDAuNTIzMDQ5LDAuMTY3Mzc1OSAwLjU1MDA5OSwtMS4yNjczOTM5IDAuNTUwMDk5LC0xLjI2NzM5MzkgMCwwIDAuMDEwNDYsLTAuODA1NDk2MiAtMC4wMzEzOCwtMS4xNjExNyIgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4xMDQ2MDk5O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiAvPiA8cGF0aCBpZD0icGF0aDQyNDkiIGQ9Im0gMTguOTQ0Mzc3LDQuNTQ1NjI2MiBjIDAuMjUwMTgyLDAuMDI5NjUgMC44NTMyMzUsLTAuMDU1OTAzIDEuMTM0NjY1LC0wLjc3MjM2OTQiIHN0eWxlPSJmaWxsOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiM1MDUwNTA7c3Ryb2tlLXdpZHRoOjAuMTA0NjA5OTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4gPHRleHQgaWQ9InRleHQ0MjQ1IiB5PSIyLjA1MTI3MTQiIHg9IjExLjU1NzI5OSIgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXNpemU6MC4xMjU1MzE4OHB4O2xpbmUtaGVpZ2h0OjAlO2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7bGV0dGVyLXNwYWNpbmc6MHB4O3dvcmQtc3BhY2luZzowcHg7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjAxMDQ2MDk5cHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHRzcGFuIHN0eWxlPSJmb250LXNpemU6MC40MTg0Mzk2cHg7bGluZS1oZWlnaHQ6MS4yNTtzdHJva2Utd2lkdGg6MC4wMTA0NjA5OXB4IiB5PSIyLjA1MTI3MTQiIHg9IjExLjU1NzI5OSIgaWQ9InRzcGFuNDI0NyI+wqA8L3RzcGFuPjwvdGV4dD4gPC9nPiA8L3N2Zz4=) no-repeat;"),console.log("%cMusic Blocks is a collection of tools for exploring fundamental musical concepts in a fun way.","font-size: 16px; font-family: sans-serif; font-weight: bold;")):console.log("%cTurtle Blocks is a collection of tools for exploring  concepts from Logo in a fun way.","font-size: 16px; font-family: sans-serif; font-weight: bold;"),a.keyboardEnableFlag=1}document.removeEventListener("finishedLoading",o);case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),a.keyboardEnableFlag=0,a.sessionData=null,a.planet)return e.next=6,a.planet.openCurrentProject();e.next=9;break;case 6:a.sessionData=e.sent,e.next=11;break;case 9:t=a.storage.currentProject,a.sessionData=a.storage["SESSION"+t];case 11:if(document.addEventListener?document.addEventListener("finishedLoading",o):document.attachEvent("finishedLoading",o),a.sessionData){a.doLoadAnimation();try{"undefined"===a.sessionData||"[]"===a.sessionData?a.justLoadStart():(window.loadedSession=a.sessionData,a.blocks.loadNewBlocks(JSON.parse(a.sessionData)))}catch(e){console.error(e)}}else a.justLoadStart();a.update=!0;case 14:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}();function R(e,t,a,o,l,n,i){var s=e;a=toFraction(a);var r,c,u,d=(r=s.name,((c=o.accidentals.find(function(e){var t=e.note.toUpperCase().replace(",","");return r=r.replace(",",""),t.toLowerCase()===r.toLowerCase()}))?r+("sharp"===c.acc?"â™¯":"flat"===c.acc?"â™­":""):r).toUpperCase());return null!=n&&(a[1]=i*n),l.push([t,["newnote",{collapsed:!0}],0,0,[t-1,t+1,t+4,t+8]],[t+1,"divide",0,0,[t,t+2,t+3]],[t+2,["number",{value:a[0]}],0,0,[t+1]],[t+3,["number",{value:a[1]}],0,0,[t+1]],[t+4,"vspace",0,0,[t,t+5]],[t+5,"pitch",0,0,[t+4,t+6,t+7,null]],[t+6,["notename",{value:d}],0,0,[t+5]],[t+7,["number",{value:(u=s.pitch,Math.floor(u/7)+4)}],0,0,[t+5]],[t+8,"hidden",0,0,[t,t+9]]),1}function G(e,t){for(var a=0;a<e.length;a++)if(e[a][0]===t)return a;return-1}this._loadProject=function(e,t,a){var o,l,n,i,s;void 0!==z.planet&&(t=void 0!==t?t:{run:!1,show:!1,collapse:!1},z.loading=!0,document.body.style.cursor="wait",z.doLoadAnimation(),z.textMsg(z.planet.getCurrentProjectName()),o=z,setTimeout(function(){try{o.planet.openProjectFromPlanet(e,function(){o.loadStartWrapper(W)})}catch(e){console.error(e),o.loadStartWrapper(W)}o.planet.initialiseNewProject(),o.loading=!1,document.body.style.cursor="default",o.update=!0},2500),l=t.run,n=t.show,i=t.collapse,s=function t(){setTimeout(function(){if(!i&&o.firstRun&&o._toggleCollapsibleStacks(),l&&o.firstRun){for(var e=0;e<o.turtles.getTurtleCount();e++)o.turtles.getTurtle(e).painter.doClear(!0,!0,!1);o.textMsg(_("Click the run button to run the project.")),n&&o._changeBlockVisibility(),i||o._toggleCollapsibleStacks()}else n||o._changeBlockVisibility();document.removeEventListener("finishedLoading",t),o.firstRun=!1},1e3)},document.addEventListener?document.addEventListener("finishedLoading",s,!1):document.attachEvent("finishedLoading",s))},this.parseABC=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var a,o,l,n,i,d,p,s,M,g,h,b,r,c,u,m,y,k,v,w,T,D,L,A,N,I,f,C,S,B,O,j;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(c in d=[],p={},s={},M=0,h=((g=null)!==(a=null===(o=t.metaText)||void 0===o?void 0:o.title)&&void 0!==a?a:"title").toString().toLowerCase(),b=(null!==(l=null===(n=t.metaText)||void 0===n?void 0:n.instruction)&&void 0!==l?l:"guitar").toString().toLowerCase(),null!==(i=t.lines)&&void 0!==i&&i.forEach(function(e){var t;null!==(t=e.staff)&&void 0!==t&&t.forEach(function(e,t){s.hasOwnProperty(t)||(s[t]={arrangedBlocks:[]}),s[t].arrangedBlocks.push(e)})}),r=function(u){var e;null!==(e=s[u].arrangedBlocks)&&void 0!==e&&e.forEach(function(n){var e,t,a,o,l,i,s,r;p.hasOwnProperty(u)||(p[u]={meterNum:(null==n||null===(e=n.meter)||void 0===e||null===(t=e.value[0])||void 0===t?void 0:t.num)||4,meterDen:(null==n||null===(a=n.meter)||void 0===a||null===(o=a.value[0])||void 0===o?void 0:o.den)||4,keySignature:n.key,baseBlocks:[],startBlock:[[M,["start",{collapsed:!1}],100,100,[null,M+1,null]],[M+1,"print",0,0,[M,M+2,M+3]],[M+2,["text",{value:h}],0,0,[M+1]],[M+3,"setturtlename2",0,0,[M+1,M+4,M+5]],[M+4,["text",{value:"Voice ".concat(parseInt(u)+1," ")}],0,0,[M+3]],[M+5,"meter",0,0,[M+3,M+6,M+7,M+10]],[M+6,["number",{value:(null==n||null===(l=n.meter)||void 0===l||null===(i=l.value[0])||void 0===i?void 0:i.num)||4}],0,0,[M+5]],[M+7,"divide",0,0,[M+5,M+8,M+9]],[M+8,["number",{value:1}],0,0,[M+7]],[M+9,["number",{value:(null==n||null===(s=n.meter)||void 0===s||null===(r=s.value[0])||void 0===r?void 0:r.den)||4}],0,0,[M+7]],[M+10,"vspace",0,0,[M+5,M+11]],[M+11,"setkey2",0,0,[M+10,M+12,M+13,M+14]],[M+12,["notename",{value:n.key.root}],0,0,[M+11]],[M+13,["modename",{value:"m"==n.key.mode?"minor":"major"}],0,0,[M+11]],[M+14,"settimbre",0,0,[M+11,M+15,null,M+16]],[M+15,["voicename",{value:b}],0,0,[M+14]],[M+16,"hidden",0,0,[M+14,null]]],repeatBlock:[],repeatArray:[],nameddoArray:{}},M+=17);var c=[];n.voices.forEach(function(e){var t,a,o,l;e.forEach(function(e){if("note"===e.el_type)null!==(null==e?void 0:e.startTriplet)&&void 0!==(null==e?void 0:e.startTriplet)&&(g=e.startTriplet),R(e.pitches[0],M,e.duration,n.key,c,g,p[u].meterDen),null!==(null==e?void 0:e.endTriplet)&&void 0!==(null==e?void 0:e.endTriplet)&&(g=null),M+=9;else if("bar"===e.el_type)if("bar_left_repeat"===e.type)p[u].repeatArray.push({start:p[u].baseBlocks.length,end:-1});else if("bar_right_repeat"===e.type){var t=p[u].repeatArray;for(var a in t)-1===t[a].end&&(p[u].repeatArray[a].end=p[u].baseBlocks.length)}}),c[0][4][0]=M+3,c[c.length-1][4][1]=null,0!=p[u].baseBlocks.length&&(p[u].baseBlocks[p[u].baseBlocks.length-1][0][p[u].baseBlocks[p[u].baseBlocks.length-1][0].length-4][4][1]=M),c.push([M,["nameddo",{value:"V: ".concat(parseInt(u)+1," Line ").concat((null===(t=p[u])||void 0===t||null===(a=t.baseBlocks)||void 0===a?void 0:a.length)+1)}],0,0,[0===p[u].baseBlocks.length?null:p[u].baseBlocks[p[u].baseBlocks.length-1][0][p[u].baseBlocks[p[u].baseBlocks.length-1][0].length-4][0],null]],[M+1,["action",{collapsed:!1}],100,100,[null,M+2,M+3,null]],[M+2,["text",{value:"V: ".concat(parseInt(u)+1," Line ").concat((null===(o=p[u])||void 0===o||null===(l=o.baseBlocks)||void 0===l?void 0:l.length)+1)}],0,0,[M+1]],[M+3,"hidden",0,0,[M+1,c[0][0]]]),p[u].nameddoArray||(p[u].nameddoArray={}),p[u].nameddoArray[u]||(p[u].nameddoArray[u]=[]),p[u].nameddoArray[u].push(M),M+=4,d.push(c),p[u].baseBlocks.push([c])})})},s)r(c);for(m in u=[],p){p[m].startBlock[p[m].startBlock.length-3][4][2]=p[m].baseBlocks[0][0][p[m].baseBlocks[0][0].length-4][0],p[m].baseBlocks[0][0][p[m].baseBlocks[0][0].length-4][4][0]=p[m].startBlock[p[m].startBlock.length-3][0],y=p[m].repeatArray,k=_createForOfIteratorHelper(y);try{for(k.s();!(v=k.n()).done;)0==(w=v.value).start?(p[m].repeatBlock.push([M,"repeat",0,0,[p[m].startBlock[p[m].startBlock.length-3][0],M+1,p[m].nameddoArray[m][0],null===p[m].nameddoArray[m][w.end+1]?null:p[m].nameddoArray[m][w.end+1]]]),p[m].repeatBlock.push([M+1,["number",{value:2}],100,100,[M]]),p[m].startBlock[p[m].startBlock.length-3][4][2]=M,T=G(p[m].baseBlocks[0][0],p[m].nameddoArray[m][0]),D=G(p[m].baseBlocks[w.end][0],p[m].nameddoArray[m][w.end]),p[m].baseBlocks[w.end+1]&&p[m].baseBlocks[w.end+1][0]&&-1!=(L=G(p[m].baseBlocks[w.end+1][0],p[m].nameddoArray[m][w.end+1]))&&(p[m].baseBlocks[w.end+1][0][L][4][0]=M),p[m].baseBlocks[0][0][T][4][0]=M,p[m].baseBlocks[w.end][0][D][4][1]=null):(A=G(p[m].baseBlocks[w.start][0],p[m].nameddoArray[m][w.start]),N=G(p[m].baseBlocks[w.start-1][0],p[m].baseBlocks[w.start][0][A][4][0]),I=G(p[m].baseBlocks[w.end][0],p[m].baseBlocks[w.start][0][A][4][1]),(f=-1)===N&&(f=G(p[m].repeatBlock,p[m].baseBlocks[w.start][0][A][4][0])),p[m].baseBlocks[w.start][0][A][4][0],C=p[m].baseBlocks[w.start][0][A][0],S=p[m].nameddoArray[m][w.end+1],p[m].repeatBlock.push([M,"repeat",0,0,[p[m].baseBlocks[w.start][0][A][4][0],M+1,C,null===S?null:S]]),p[m].repeatBlock.push([M+1,["number",{value:2}],100,100,[M]]),-1!=N?p[m].baseBlocks[w.start-1][0][N][4][1]=M:p[m].repeatBlock[f][4][3]=M,-1!==I&&(p[m].baseBlocks[w.end][0][I][4][1]=null),p[m].baseBlocks[w.start][0][A][4][0]=M,null!==S&&(B=G(p[m].baseBlocks[w.end+1][0],S),p[m].baseBlocks[w.end+1][0][B][4][0]=M)),M+=2}catch(e){k.e(e)}finally{k.f()}O=p[m].baseBlocks.reduce(function(e,t){return e.concat(t)},[]),j=O.flat(),[].concat(_toConsumableArray(p[m].startBlock),_toConsumableArray(j)),u.push.apply(u,_toConsumableArray(p[m].startBlock)),u.push.apply(u,_toConsumableArray(j)),u.push.apply(u,_toConsumableArray(p[m].repeatBlock))}return this.blocks.loadNewBlocks(u),e.abrupt("return",null);case 14:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),this.loadStartWrapper=function(){var l=_asyncToGenerator(regeneratorRuntime.mark(function e(t,a,o,l){var n,i,s,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Date,e.next=3,t(z,a,o,l);case 3:i=new Date,s=i.getTime()-n.getTime(),r=Math.max(6e3-s),setTimeout(z.showContents,r);case 7:case"end":return e.stop()}},e)}));return function(e,t,a,o){return l.apply(this,arguments)}}(),this.showContents=function(){docById("loading-image-container").style.display="none",docById("bottom-right-logo").style.display="none",docById("palette").style.display="block",docById("hideContents").style.display="block",docById("buttoncontainerBOTTOM").style.display="block",docById("buttoncontainerTOP").style.display="block"},this.justLoadStart=function(){z.blocks.loadNewBlocks(DATAOBJS)};function Y(e){e.turtles.running()&&e._doHardStopButton(),void 0!==e.planet&&e.planet.getCurrentProjectName()!==_("My Project")?(e.planet.saveLocally(),e.planet.initialiseNewProject(),W(e),e.planet.saveLocally()):(e.toolbar.closeAuxToolbar(C),setTimeout(function(){e.sendAllToTrash(!1,!1),e.blocks.loadNewBlocks(DATAOBJS)},1e3))}this.hideMsgs=function(){if(null!==z.errorMsgText){for(var e in z.errorMsgText.parent.visible=!1,z.errorText.classList.remove("show"),z._hideArrows(),z.msgText.parent.visible=!1,z.printText.classList.remove("show"),z.errorArtwork)z.errorArtwork[e].visible=!1;z.refreshCanvas()}};this._hideArrows=function(){null!==z.errorMsgArrow&&(z.errorMsgArrow.removeAllChildren(),z.refreshCanvas())},this.textMsg=function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_MSGTIMEOUT_;null!==z.msgTimeoutID&&(clearTimeout(z.msgTimeoutID),z.msgTimeoutID=null),null!==z.msgText&&(z.printText.classList.add("show"),z.printTextContent.innerHTML=e,(t=z).msgTimeoutID=setTimeout(function(){t.printText.classList.remove("show"),t.msgTimeoutID=null},a))},this.errorMsg=function(e,t,a,o){if(null!==z.errorMsgTimeoutID&&clearTimeout(z.errorMsgTimeoutID),null!==z.errorMsgText){var l,n,i,s,r,c;switch(null!=t&&t in z.blocks.blockList&&!z.blocks.blockList[t].collapsed&&(l=z.canvas.width/2,n=z.blocks.blockList[t].container.x+z.blocksContainer.x,i=z.blocks.blockList[t].container.y+z.blocksContainer.y,null===z.errorMsgArrow&&(z.errorMsgArrow=new createjs.Container,z.stage.addChild(z.errorMsgArrow)),s=new createjs.Shape,z.errorMsgArrow.addChild(s),s.graphics.setStrokeStyle(4).beginStroke("#ff0031").moveTo(l,128).lineTo(n,i),z.stage.setChildIndex(z.errorMsgArrow,z.stage.children.length-1),r=Math.atan2(n-l,128-i)/Math.PI*180,c=new createjs.Shape,z.errorMsgArrow.addChild(c),c.graphics.setStrokeStyle(4).beginStroke("#ff0031").moveTo(-10,18).lineTo(0,0).lineTo(10,18),c.x=n,c.y=i,c.rotation=r),e){case NOMICERRORMSG:z.errorArtwork.nomicrophone.visible=!0,z.stage.setChildIndex(z.errorArtwork.nomicrophone,z.stage.children.length-1);break;case NOSTRINGERRORMSG:z.errorArtwork.notastring.visible=!0,z.stage.setChildIndex(z.errorArtwork.notastring,z.stage.children.length-1);break;case EMPTYHEAPERRORMSG:z.errorArtwork.emptyheap.visible=!0,z.stage.setChildIndex(z.errorArtwork.emptyheap,z.stage.children.length-1);break;case NOSQRTERRORMSG:z.errorArtwork.negroot.visible=!0,z.stage.setChildIndex(z.errorArtwork.negroot,z.stage.children.length-1);break;case NOACTIONERRORMSG:null===a&&(a="foo"),z.errorArtwork.nostack.children[1].text=a,z.errorArtwork.nostack.visible=!0,z.errorArtwork.nostack.updateCache(),z.stage.setChildIndex(z.errorArtwork.nostack,z.stage.children.length-1);break;case NOBOXERRORMSG:null===a&&(a="foo"),z.errorArtwork.emptybox.children[1].text=a,z.errorArtwork.emptybox.visible=!0,z.errorArtwork.emptybox.updateCache(),z.stage.setChildIndex(z.errorArtwork.emptybox,z.stage.children.length-1);break;case ZERODIVIDEERRORMSG:z.errorArtwork.zerodivide.visible=!0,z.stage.setChildIndex(z.errorArtwork.zerodivide,z.stage.children.length-1);break;case NANERRORMSG:z.errorArtwork.notanumber.visible=!0,z.stage.setChildIndex(z.errorArtwork.notanumber,z.stage.children.length-1);break;case NOINPUTERRORMSG:z.errorArtwork.noinput.visible=!0,z.stage.setChildIndex(z.errorArtwork.noinput,z.stage.children.length-1);break;default:z.errorText.classList.add("show"),z.errorTextContent.innerHTML=e}var u,d=void 0!==o?o:_ERRORMSGTIMEOUT_;0<d&&((u=z).errorMsgTimeoutID=setTimeout(function(){u.hideMsgs()},d)),z.refreshCanvas()}},this._hideCartesian=function(){z.cartesianBitmap.visible=!1,z.cartesianBitmap.updateCache(),z.update=!0},this._showCartesian=function(){z.cartesianBitmap.visible=!0,z.cartesianBitmap.updateCache(),z.update=!0},this._hidePolar=function(){z.polarBitmap.visible=!1,z.polarBitmap.updateCache(),z.update=!0},this._showPolar=function(){z.polarBitmap.visible=!0,z.polarBitmap.updateCache(),z.update=!0},this._hideAccidentals=function(){for(var e=z.canvas.width/(2*z.turtleBlocksScale)-600,t=0;t<7;t++)z.grandSharpBitmap[t].visible=!1,z.grandSharpBitmap[t].x=e,z.grandSharpBitmap[t].updateCache(),z.grandFlatBitmap[t].visible=!1,z.grandFlatBitmap[t].x=e,z.grandFlatBitmap[t].updateCache(),z.trebleSharpBitmap[t].visible=!1,z.trebleSharpBitmap[t].x=e,z.trebleSharpBitmap[t].updateCache(),z.trebleFlatBitmap[t].visible=!1,z.trebleFlatBitmap[t].x=e,z.trebleFlatBitmap[t].updateCache(),z.sopranoSharpBitmap[t].visible=!1,z.sopranoSharpBitmap[t].x=e,z.sopranoSharpBitmap[t].updateCache(),z.sopranoFlatBitmap[t].visible=!1,z.sopranoFlatBitmap[t].x=e,z.sopranoFlatBitmap[t].updateCache(),z.altoSharpBitmap[t].visible=!1,z.altoSharpBitmap[t].x=e,z.altoSharpBitmap[t].updateCache(),z.altoFlatBitmap[t].visible=!1,z.altoFlatBitmap[t].x=e,z.altoFlatBitmap[t].updateCache(),z.tenorSharpBitmap[t].visible=!1,z.tenorSharpBitmap[t].x=e,z.tenorSharpBitmap[t].updateCache(),z.tenorFlatBitmap[t].visible=!1,z.tenorFlatBitmap[t].x=e,z.tenorFlatBitmap[t].updateCache(),z.bassSharpBitmap[t].visible=!1,z.bassSharpBitmap[t].x=e,z.bassSharpBitmap[t].updateCache(),z.bassFlatBitmap[t].visible=!1,z.bassFlatBitmap[t].x=e,z.bassFlatBitmap[t].updateCache();z.update=!0},this._hideTreble=function(){z.trebleBitmap.visible=!1,z.trebleBitmap.updateCache(),z._hideAccidentals(),z.update=!0},this._showTreble=function(){z.trebleBitmap.visible=!0,z.trebleBitmap.updateCache(),z._hideAccidentals(),console.log(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1]);var e=buildScale(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1])[0];console.log(e);for(var t=["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP],a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,l=0;l<7;l++)e.includes(t[l])&&(z.trebleSharpBitmap[l].x+=o,z.trebleSharpBitmap[l].visible=!0,z.trebleSharpBitmap[l].updateCache(),o+=15),e.includes(a[l])&&(z.trebleFlatBitmap[l].x+=o,z.trebleFlatBitmap[l].visible=!0,z.trebleFlatBitmap[l].updateCache(),o+=15);z.update=!0},this._hideGrand=function(){z.grandBitmap.visible=!1,z.grandBitmap.updateCache(),z._hideAccidentals(),z.update=!0},this._showGrand=function(){z.grandBitmap.visible=!0,z.grandBitmap.updateCache(),z._hideAccidentals(),console.log(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1]);var e=buildScale(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1])[0];console.log(e);for(var t=["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP],a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,l=0;l<7;l++)e.includes(t[l])&&(z.grandSharpBitmap[l].x+=o,z.grandSharpBitmap[l].visible=!0,z.grandSharpBitmap[l].updateCache(),o+=15),e.includes(a[l])&&(z.grandFlatBitmap[l].x+=o,z.grandFlatBitmap[l].visible=!0,z.grandFlatBitmap[l].updateCache(),o+=15);z.update=!0},this._hideSoprano=function(){z.sopranoBitmap.visible=!1,z.sopranoBitmap.updateCache(),z.update=!0},this._showSoprano=function(){z.sopranoBitmap.visible=!0,z.sopranoBitmap.updateCache(),z._hideAccidentals(),console.log(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1]);var e=buildScale(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1])[0];console.log(e);for(var t=["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP],a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,l=0;l<7;l++)e.includes(t[l])&&(z.sopranoSharpBitmap[l].x+=o,z.sopranoSharpBitmap[l].visible=!0,z.sopranoSharpBitmap[l].updateCache(),o+=15),e.includes(a[l])&&(z.sopranoFlatBitmap[l].x+=o,z.sopranoFlatBitmap[l].visible=!0,z.sopranoFlatBitmap[l].updateCache(),o+=15);z.update=!0},this._hideAlto=function(){z.altoBitmap.visible=!1,z.altoBitmap.updateCache(),z._hideAccidentals(),z.update=!0},this.__showAltoAccidentals=function(){},this._showAlto=function(){z.altoBitmap.visible=!0,z.altoBitmap.updateCache(),z._hideAccidentals(),console.log(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1]);var e=buildScale(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1])[0];console.log(e);for(var t=["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP],a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,l=0;l<7;l++)e.includes(t[l])&&(z.altoSharpBitmap[l].x+=o,z.altoSharpBitmap[l].visible=!0,z.altoSharpBitmap[l].updateCache(),o+=15),e.includes(a[l])&&(z.altoFlatBitmap[l].x+=o,z.altoFlatBitmap[l].visible=!0,z.altoFlatBitmap[l].updateCache(),o+=15);z.update=!0},this._hideTenor=function(){z.tenorBitmap.visible=!1,z.tenorBitmap.updateCache(),z.update=!0},this._showTenor=function(){z.tenorBitmap.visible=!0,z.tenorBitmap.updateCache(),z._hideAccidentals(),console.log(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1]);var e=buildScale(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1])[0];console.log(e);for(var t=["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP],a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,l=0;l<7;l++)e.includes(t[l])&&(z.tenorSharpBitmap[l].x+=o,z.tenorSharpBitmap[l].visible=!0,z.tenorSharpBitmap[l].updateCache(),o+=15),e.includes(a[l])&&(z.tenorFlatBitmap[l].x+=o,z.tenorFlatBitmap[l].visible=!0,z.tenorFlatBitmap[l].updateCache(),o+=15);z.update=!0},this._hideBass=function(){z.bassBitmap.visible=!1,z.bassBitmap.updateCache(),z._hideAccidentals(),z.update=!0},this._showBass=function(){z.bassBitmap.visible=!0,z.bassBitmap.updateCache(),z._hideAccidentals(),console.log(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1]);var e=buildScale(z.KeySignatureEnv[0]+" "+z.KeySignatureEnv[1])[0];console.log(e);for(var t=["F"+SHARP,"C"+SHARP,"G"+SHARP,"D"+SHARP,"A"+SHARP,"E"+SHARP,"B"+SHARP],a=["B"+FLAT,"E"+FLAT,"A"+FLAT,"D"+FLAT,"G"+FLAT,"C"+FLAT,"F"+FLAT],o=0,l=0;l<7;l++)e.includes(t[l])&&(z.bassSharpBitmap[l].x+=o,z.bassSharpBitmap[l].visible=!0,z.bassSharpBitmap[l].updateCache(),o+=15),e.includes(a[l])&&(z.bassFlatBitmap[l].x+=o,z.bassFlatBitmap[l].visible=!0,z.bassFlatBitmap[l].updateCache(),o+=15);z.update=!0},this.prepareExport=function(){var e=[];z.hasMatrixDataBlock=!1;for(var t=0;t<z.blocks.blockList.length;t++){z.blocks.blockList[t].trash||e.push(t)}for(var a=[],o=0;o<z.blocks.blockList.length;o++){var l,n=z.blocks.blockList[o],i=null;if(!n.trash){if(n.isValueBlock()||"loadFile"===n.name||"boolean"===n.name)switch(n.name){case"namedbox":case"namedarg":i={value:n.privateData};break;default:i={value:n.value}}else switch(n.name){case"start":case"drum":var s=z.turtles.getTurtle(n.value),i=null==s?{id:z.turtles.getTurtleCount(),collapsed:!1,xcor:0,ycor:0,heading:0,color:0,shade:50,pensize:5,grey:100}:{id:s.id,collapsed:n.collapsed,xcor:s.x,ycor:s.y,heading:s.orientation,color:s.painter.color,shade:s.painter.value,pensize:s.painter.stroke,grey:s.painter.chroma};break;case"temperament1":z.blocks.customTemperamentDefined&&(l="custom",null!==n.connections[1]&&(l=z.blocks.blockList[n.connections[1]].value),console.log(l),i={customName:l,customTemperamentNotes:getTemperament(l),startingPitch:z.logo.synth.startingPitch,octaveSpace:getOctaveRatio()});break;case"interval":case"newnote":case"action":case"matrix":case"pitchdrummatrix":case"rhythmruler":case"timbre":case"pitchstaircase":case"tempo":case"pitchslider":case"musickeyboard":case"modewidget":case"meterwidget":case"status":i={collapsed:n.collapsed};break;case"storein2":case"nameddo":case"nameddoArg":case"namedcalc":case"namedcalcArg":case"outputtools":i={value:n.privateData};break;case"nopValueBlock":case"nopZeroArgBlock":case"nopOneArgBlock":case"nopTwoArgBlock":case"nopThreeArgBlock":n.name=n.privateData;break;case"matrixData":i={notes:window.savedMatricesNotes,count:window.savedMatricesCount},z.hasMatrixDataBlock=!0;break;case"wrapmode":i={value:n.value}}for(var r=[],c=0;c<n.connections.length;c++){var u=e.indexOf(n.connections[c]);null===n.connections[c]||-1===u?r.push(null):r.push(u)}null===i?a.push([e.indexOf(o),n.name,n.container.x,n.container.y,r]):a.push([e.indexOf(o),[n.name,i],n.container.x,n.container.y,r])}}return JSON.stringify(a)};function P(e){e._doOpenPlugin()}this._doOpenPlugin=function(){z.toolbar.closeAuxToolbar(C),z.pluginChooser.focus(),z.pluginChooser.click()};function H(e){x(e,!0)}this._setupPaletteMenu=function(){function e(e,t,a){var o=z._makeButton(e,t,n,i,l,0);return z._loadButtonDragHandler(o,a,z),n+=l,o}var l=z.cellSize,n=window.innerWidth-4*l-27.5,i=window.innerHeight-57.5,t=docById("buttoncontainerBOTTOM");t&&t.parentNode.removeChild(t);var a=document.createElement("div");a.setAttribute("id","buttoncontainerBOTTOM"),a.style.display="block",document.body.appendChild(a),z.homeButtonContainer=e(GOHOMEFADEDBUTTON,_("Home")+" ["+_("Home").toUpperCase()+"]",o),z.boundary.hide(),z.helpfulWheelItems.find(function(e){return"Home [HOME]"===e.label})||z.helpfulWheelItems.push({label:"Home [HOME]",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(GOHOMEFADEDBUTTON)),display:!0,fn:o}),z.hideBlocksContainer=e(SHOWBLOCKSBUTTON,_("Show/hide blocks"),S),z.helpfulWheelItems.find(function(e){return"Show/hide blocks"===e.label})||z.helpfulWheelItems.push({label:"Show/hide blocks",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(SHOWBLOCKSBUTTON)),display:!0,fn:S}),z.collapseBlocksContainer=e(COLLAPSEBLOCKSBUTTON,_("Expand/collapse blocks"),B),z.helpfulWheelItems.find(function(e){return"Expand/collapse blocks"===e.label})||z.helpfulWheelItems.push({label:"Expand/collapse blocks",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(COLLAPSEBLOCKSBUTTON)),display:!0,fn:B}),z.smallerContainer=e(SMALLERBUTTON,_("Decrease block size"),p),z.helpfulWheelItems.find(function(e){return"Decrease block size"===e.label})||z.helpfulWheelItems.push({label:"Decrease block size",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(SMALLERBUTTON)),display:!0,fn:p}),z.largerContainer=e(BIGGERBUTTON,_("Increase block size"),d),z.helpfulWheelItems.find(function(e){return"Increase block size"===e.label})||z.helpfulWheelItems.push({label:"Increase block size",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(BIGGERBUTTON)),display:!0,fn:d}),z.helpfulWheelItems.find(function(e){return"Restore"===e.label})||z.helpfulWheelItems.push({label:"Restore",icon:"imgsrc:header-icons/restore-from-trash.svg",display:!0,fn:f}),z.helpfulWheelItems.find(function(e){return"Turtle Wrap Off"===e.label})||z.helpfulWheelItems.push({label:"Turtle Wrap Off",icon:"imgsrc:header-icons/wrap-text.svg",display:!0,fn:z.toolbar.changeWrap}),z.helpfulWheelItems.find(function(e){return"Turtle Wrap On"===e.label})||z.helpfulWheelItems.push({label:"Turtle Wrap On",icon:"imgsrc:header-icons/wrap-text.svg",display:!1,fn:z.toolbar.changeWrap}),z.helpfulWheelItems.find(function(e){return"Enable horizontal scrolling"===e.label})||z.helpfulWheelItems.push({label:"Enable horizontal scrolling",icon:"imgsrc:header-icons/compare-arrows.svg",display:!z.beginnerMode,fn:L}),z.helpfulWheelItems.find(function(e){return"Disable horizontal scrolling"===e.label})||z.helpfulWheelItems.push({label:"Disable horizontal scrolling",icon:"imgsrc:header-icons/lock.svg",display:!1,fn:L}),_THIS_IS_MUSIC_BLOCKS_&&!z.helpfulWheelItems.find(function(e){return"Set Pitch Preview"===e.label})&&z.helpfulWheelItems.push({label:"Set Pitch Preview",icon:"imgsrc:header-icons/music-note.svg",display:!0,fn:j}),z.helpfulWheelItems.find(function(e){return"Grid"===e.label})||z.helpfulWheelItems.push({label:"Grid",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(CARTESIANBUTTON)),display:!0,fn:piemenuGrid}),z.helpfulWheelItems.find(function(e){return"Select"===e.label})||z.helpfulWheelItems.push({label:"Select",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(SELECTBUTTON)),display:!0,fn:z.selectMode}),z.helpfulWheelItems.find(function(e){return"Clear"===e.label})||z.helpfulWheelItems.push({label:"Clear",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(CLEARBUTTON)),display:!0,fn:function(){return z._allClear(!1)}}),z.helpfulWheelItems.find(function(e){return"Collapse"===e.label})||z.helpfulWheelItems.push({label:"Collapse",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(COLLAPSEBUTTON)),display:!0,fn:z.turtles.collapse}),z.helpfulWheelItems.find(function(e){return"Expand"===e.label})||z.helpfulWheelItems.push({label:"Expand",icon:"imgsrc:data:image/svg+xml;base64,"+window.btoa(base64Encode(EXPANDBUTTON)),display:!1,fn:z.turtles.expand}),z.helpfulWheelItems.find(function(e){return"Search for Blocks"===e.label})||z.helpfulWheelItems.push({label:"Search for Blocks",icon:"imgsrc:header-icons/search-button.svg",display:!0,fn:z._displayHelpfulSearchDiv}),z.helpfulWheelItems.find(function(e){return"Paste previous stack"===e.label})||z.helpfulWheelItems.push({label:"Paste previous stack",icon:"imgsrc:header-icons/copy-button.svg",display:!1,fn:z.turtles.expand}),z.helpfulWheelItems.find(function(e){return"Close"===e.label})||z.helpfulWheelItems.push({label:"Close",icon:"imgsrc:header-icons/cancel-button.svg",display:!0,fn:z._hideHelpfulSearchWidget})},this.showHelpfulSearchWidget=function(){var e,t=jQuery.noConflict();if(t("#helpfulSearch"))try{t("#helpfulSearch").autocomplete("destroy")}catch(e){}z.helpfulSearchWidget.style.zIndex=1001,z.helpfulSearchWidget.idInput_custom="","block"===z.helpfulSearchDiv.style.display&&(z.helpfulSearchWidget.value=null,z.helpfulSearchWidget.style.visibility="visible",z.searchBlockPosition=[100,100],z.prepSearchWidget(),e=z,setTimeout(function(){e.helpfulSearchWidget.focus(),e.doHelpfulSearch()},500),docById("helpfulWheelDiv").style.display="none")},this.doHelpfulSearch=function(){var a=jQuery.noConflict(),o=z;a("#helpfulSearch").autocomplete({source:o.searchSuggestions,select:function(e,t){e.preventDefault(),o.helpfulSearchWidget.value=t.item.label,o.helpfulSearchWidget.idInput_custom=t.item.value,o.helpfulSearchWidget.protoblk=t.item.specialDict,o.doHelpfulSearch()},focus:function(e){e.preventDefault()}}),a("#helpfulSearch").autocomplete("instance")._renderItem=function(e,t){return a("<li></li>").data("item.autocomplete",t).append('<img src="'+t.artwork+'" height = "20px"><a> '+t.label+"</a>").appendTo(e.css("z-index",9999))};var e,t,l,n=z.helpfulSearchWidget.idInput_custom;!n||n.length<=0||(t=(e=z.helpfulSearchWidget.protoblk).palette.name,l=e.name,z.blocks.protoBlockDict.hasOwnProperty(l)?(z.palettes.dict[t].makeBlockFromSearch(e,l,function(e){o.blocks.moveBlock(e,100+o.searchBlockPosition[0]-o.blocksContainer.x,o.searchBlockPosition[1]-o.blocksContainer.y)}),z.searchBlockPosition[0]+=STANDARDBLOCKHEIGHT,z.searchBlockPosition[1]+=STANDARDBLOCKHEIGHT):-1<z.deprecatedBlockNames.indexOf(n)?z.errorMsg(_("This block is deprecated.")):z.errorMsg(_("Block cannot be found.")),z.helpfulSearchWidget.value="",docById("helpfulSearchDiv").style.display="none",z.update=!0)};function Q(e){new JSEditor(e)}function Z(e){e.statsWindow&&e.statsWindow.isOpen||(e.statsWindow=new StatsWindow(e))}function F(e){e._showHelp()}this._showHelp=function(){new HelpWidget(z,!1)};function X(e){e._showAboutPage()}this._showAboutPage=function(){new HelpWidget(z,!1)},this._makeButton=function(e,t,a,o){var l=document.createElement("div");l.setAttribute("id",""+t),l.setAttribute("class","tooltipped"),l.setAttribute("data-tooltip",t),l.setAttribute("data-position","top"),jQuery.noConflict()(".tooltipped").tooltip({html:!0,delay:100});var n=z;l.onmouseover=function(e){n.loading||(document.body.style.cursor="pointer",l.style.transition="0.12s ease-out",l.style.transform="scale(1.15)")},l.onmouseout=function(e){n.loading||(document.body.style.cursor="default",l.style.transition="0.15s ease-out",l.style.transform="scale(1)")};var i=new Image;return i.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(e)),l.appendChild(i),l.setAttribute("style","position: absolute; right:"+(document.body.clientWidth-a)+"px;  top: "+o+"px;"),docById("buttoncontainerBOTTOM").appendChild(l),l},this._loadButtonDragHandler=function(e,t,a){var o=z;e.onmousedown=function(e){o.loading||(document.body.style.cursor="default"),t(a)}},this.pasted=function(){var e=docById("paste").value,t="";if(null!==e&&""!==e){var a=e.replace("\n"," ");try{t=JSON.parse(a)}catch(e){return void z.errorMsg(_("Could not parse JSON input."))}for(var o in z.palettes.dict)z.palettes.dict[o].hideMenu(!0);z.refreshCanvas(),z.blocks.loadNewBlocks(t),z.pasteBox.hide()}},this.deltaY=function(e){z.toolbarHeight+=e;for(var t=0;t<z.onscreenButtons.length;t++)z.onscreenButtons[t].y+=e;for(var a=0;a<z.onscreenMenu.length;a++)z.onscreenMenu[a].y+=e;z.palettes.deltaY(e),z.turtles.deltaY(e),z.blocksContainer.y+=e,z.refreshCanvas()},this.domReady=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return z.saveLocally=void 0,z.update=!0,e.next=4,z.init();case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.__saveLocally=function(){var e=z.prepareExport();if(void 0===z.storage.currentProject)try{z.storage.currentProject="My Project",z.storage.allProjects=JSON.stringify(["My Project"])}catch(e){console.error(e)}var a="";try{a=z.storage.currentProject,z.storage["SESSION"+a]=e}catch(e){console.error(e)}var o=new Image,t=doSVG(z.canvas,z.logo,z.turtles,320,240,320/z.canvas.width);o.onload=function(){var e=new createjs.Bitmap(o),t=e.getBounds();e.cache(t.x,t.y,t.width,t.height);try{N.storage["SESSIONIMAGE"+a]=e.bitmapCache.getCacheDataURL()}catch(e){console.error(e)}},o.src="data:image/svg+xml;base64,"+window.btoa(base64Encode(t))},this.setupMouseEvents=function(){document.addEventListener("mousedown",function(e){z.isSelecting&&(z.moving=!1,"myCanvas"===e.target.id&&z._createDrag(e))},!1)},this.deselectSelectedBlocks=function(){z.unhighlightSelectedBlocks(!1),z.setSelectionMode(!1)},document.getElementById("toolbars").addEventListener("mouseover",function(){z.isDragging=!1}),this.deleteMultipleBlocks=function(){if(z.blocks.selectionModeOn){for(var e=z.blocks.selectedBlocks,t=[],a=[],o=0;o<e.length;o++)z.blocks.selectedBlocks[o].isClampBlock()?t.push(z.blocks.selectedBlocks[o]):z.blocks.selectedBlocks[o].isDisconnected()&&a.push(z.blocks.selectedBlocks[o]);for(var l=0;l<t.length;l++)z.blocks.sendStackToTrash(t[l]);for(var n=0;n<a.length;n++)z.blocks.sendStackToTrash(a[n]);z.blocks.setSelectionToActivity(!1),z.refreshCanvas(),docById("helpfulWheelDiv").style.display="none"}},this.copyMultipleBlocks=function(){z.blocks.selectionModeOn&&z.blocks.selectedBlocks.length&&function(){for(var t=z.blocks.selectedBlocks,o=0,l=0,n=new Map,e=0;e<t.length;e++)(function(e){var a=z.blocks.blockList.indexOf(t[e]);if(n.set(a,t[e].connections.filter(function(e){return null!==e})),t[e].connections.some(function(e){var t=n.get(e);return t&&t.some(function(e){return e===a})})||t[e].trash)return;z.blocks.activeBlock=a,z.blocks.pasteDx=o,z.blocks.pasteDy=l,z.blocks.prepareStackForCopy(),z.blocks.pasteStack(),o+=21,l+=21})(e);z.setSelectionMode(!1),z.selectedBlocks=[],z.unhighlightSelectedBlocks(!1,!1),z.blocks.setSelectedBlocks(z.selectedBlocks),z.refreshCanvas(),docById("helpfulWheelDiv").style.display="none"}()},this.selectMode=function(){z.moving=!1,z.isSelecting=!z.isSelecting,z.isSelecting?z.textMsg(_("Select is enabled.")):z.textMsg(_("Select is disabled.")),docById("helpfulWheelDiv").style.display="none"},this._create2Ddrag=function(){z.dragArea={},z.selectedBlocks=[],z.startX=0,z.startY=0,z.currentX=0,z.currentY=0,z.hasMouseMoved=!1,z.selectionArea=document.createElement("div"),document.body.appendChild(z.selectionArea),z.setupMouseEvents(),document.addEventListener("mousemove",function(e){z.hasMouseMoved=!0,z.isDragging&&z.isSelecting&&(z.currentX=e.clientX,z.currentY=e.clientY,z.blocks.isBlockMoving||z.turtles.running()||(z.setSelectionMode(!0),z.drawSelectionArea(),z.selectedBlocks=z.selectBlocksInDragArea(),z.unhighlightSelectedBlocks(!0,!0),z.blocks.setSelectedBlocks(z.selectedBlocks)))}),document.addEventListener("mouseup",function(e){z.isSelecting&&(z.isDragging=!1,z.selectionArea.style.display="none",z.startX=0,z.startY=0,z.currentX=0,z.currentY=0,setTimeout(function(){z.hasMouseMoved=!1},100))})},this._createDrag=function(e){z.isDragging=!0,z.startX=e.clientX,z.startY=e.clientY},this.drawSelectionArea=function(){var e=Math.min(z.startX,z.currentX),t=Math.min(z.startY,z.currentY),a=Math.abs(z.currentX-z.startX),o=Math.abs(z.currentY-z.startY);z.selectionArea.style.display="flex",z.selectionArea.style.position="absolute",z.selectionArea.style.left=e+"px",z.selectionArea.style.top=t+"px",z.selectionArea.style.height=o+"px",z.selectionArea.style.width=a+"px",z.selectionArea.style.zIndex="9989",z.selectionArea.style.backgroundColor="rgba(137, 207, 240, 0.5)",z.selectionArea.style.pointerEvents="none",z.dragArea={x:e,y:t,width:a,height:o}},this.rectanglesOverlap=function(e,t){return e.x+e.width>t.x&&e.x<t.x+t.width&&e.y+e.height>t.y&&e.y<t.y+t.height},this.selectBlocksInDragArea=function(e,t){var a=[];return z.dragRect=z.dragArea,z.blocks.blockList.forEach(function(e){z.blockRect={x:z.scrollBlockContainer?e.container.x+z.blocksContainer.x:e.container.x,y:e.container.y+z.blocksContainer.y,height:e.height,width:e.width},z.rectanglesOverlap(z.blockRect,z.dragRect)&&a.push(e)}),a},this.unhighlightSelectedBlocks=function(e,t){for(var a=0;a<z.selectedBlocks.length;a++)for(var o in z.blocks.blockList)z.isEqual(z.blocks.blockList[o],z.selectedBlocks[a])&&(e?z.blocks.unhighlightSelectedBlocks(o,!0):(z.blocks.highlight(o,!0),z.refreshCanvas()))},this.isEqual=function(e,t){var a=Object.keys(e),o=Object.keys(t);if(a.length!==o.length)return!1;for(var l=0,n=a;l<n.length;l++){var i=n[l];if(!t.hasOwnProperty(i))return!1}for(var s=0,r=a;s<r.length;s++){var c=r[s];if(e[c]!==t[c])return!1}return!0},this.setSelectionMode=function(e){e?z.selectionModeOn||0!==z.selectedBlocks.length&&(z.selectedBlocks=[],z.selectionModeOn=e,z.blocks.setSelection(z.selectionModeOn)):(z.selectedBlocks=[],z.selectionModeOn=e,z.blocks.setSelection(z.selectionModeOn))},this.init=_asyncToGenerator(regeneratorRuntime.mark(function e(){var s,t,a,o,l,n,i,r,c,u,d,p,M,g,h,b;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return z._clientWidth=document.body.clientWidth,z._clientHeight=document.body.clientHeight,z._innerWidth=window.innerWidth,z._innerHeight=window.innerHeight,z._outerWidth=window.outerWidth,z._outerHeight=window.outerHeight,docById("loader").className="loader",doBrowserCheck(),s=z,jQuery.browser.mozilla||(window.onblur=function(){T(s,!0)}),z.stage=new createjs.Stage(z.canvas),createjs.Touch.enable(z.stage),t=0,document.addEventListener("mousemove",function(){++t%4==0&&s.__tick()}),document.addEventListener("click",function(e){z.hasMouseMoved||(z.selectionModeOn?z.deselectSelectedBlocks():z._hideHelpfulSearchWidget(e))}),z._createMsgContainer("#ffffff","#7a7a7a",function(e){s.msgText=e},130),z._createMsgContainer("#ffcbc4","#ff0031",function(e){s.errorMsgText=e},130),z._createErrorContainers(),z.blocksContainer=new createjs.Container,z.trashContainer=new createjs.Container,z.turtleContainer=new createjs.Container,z.stage.addChild(z.turtleContainer),z.stage.addChild(z.trashContainer),z.stage.addChild(z.blocksContainer),z._setupBlocksContainerEvents(),z.trashcan=new Trashcan(z),z.turtles=new Turtles(z),z.boundary=new Boundary(z.blocksContainer),z.blocks=new Blocks(z),z.palettes=new Palettes(z),z.palettes.init(),z.logo=new Logo(z),z.pasteBox=new PasteBox(z),z.languageBox=new LanguageBox(z),z.themeBox=new ThemeBox(z),z.firstTimeUser&&z._showHelp(),e.prev=36,z.planet=new PlanetInterface(z),e.next=40,z.planet.init();case 40:e.next=45;break;case 42:e.prev=42,e.t0=e.catch(36),z.planet=void 0;case 45:for(z.save=new SaveInterface(z),z.toolbar=new Toolbar,z.toolbar.init(z),z.toolbar.renderLogoIcon(X),z.toolbar.renderPlayIcon(y),z.toolbar.renderStopIcon(T),z.toolbar.renderNewProjectIcon(Y),z.toolbar.renderLoadIcon(x),z.toolbar.renderSaveIcons(z.save.saveHTML.bind(z.save),doSVG,z.save.saveSVG.bind(z.save),z.save.saveMIDI.bind(z.save),z.save.savePNG.bind(z.save),z.save.saveWAV.bind(z.save),z.save.saveLilypond.bind(z.save),z.save.saveAbc.bind(z.save),z.save.saveMxml.bind(z.save),z.save.saveBlockArtwork.bind(z.save),z.save.saveBlockArtworkPNG.bind(z.save)),z.toolbar.renderPlanetIcon(z.planet,O),z.toolbar.renderMenuIcon(C),z.toolbar.renderHelpIcon(F),z.toolbar.renderModeSelectIcon(D,k,Z,P,A,L),z.toolbar.renderRunSlowlyIcon(v),z.toolbar.renderRunStepIcon(w),z.toolbar.renderThemeSelectIcon(z.themeBox,z.themes),z.toolbar.renderMergeIcon(H),z.toolbar.renderRestoreIcon(I),_THIS_IS_MUSIC_BLOCKS_&&z.toolbar.renderChooseKeyIcon(j),z.toolbar.renderJavaScriptIcon(Q),z.toolbar.renderLanguageSelectIcon(z.languageBox),z.toolbar.renderWrapIcon(),initPalettes(z.palettes),void 0!==z.planet?z.saveLocally=z.planet.saveLocally.bind(z.planet):z.saveLocally=z.__saveLocally,window.saveLocally=z.saveLocally,initBasicProtoBlocks(z),z.macroData=z.storage.macros,null!==z.macroData&&processMacroData(z.macroData,z.palettes,z.blocks,z.macroDict),z.pluginData=z.storage.plugins,null!==z.pluginData&&"null"!==z.pluginData&&updatePluginObj(z,processPluginData(z,z.pluginData)),void 0!==(a=z.storage.custommode)&&JSON.parse(a),z.fileChooser.addEventListener("click",function(e){s.value=null}),z.fileChooser.addEventListener("change",function(e){var l=new FileReader,t=new FileReader;l.onload=function(e){s.loading=!0,document.body.style.cursor="wait",s.doLoadAnimation(),setTimeout(function(){var e=l.result;if(null===e||""===e)s.errorMsg(_("Cannot load project from the file. Please check the file type."));else{var t,a=e.replace("\n"," ");try{for(var o in t=a.includes("html")?a.includes('id="codeBlock"')?JSON.parse(a.match('<div class="code" id="codeBlock">(.+?)</div>')[1]):JSON.parse(a.match('<div class="code">(.+?)</div>')[1]):JSON.parse(a),s.palettes.dict)s.palettes.dict[o].hideMenu(!0);s.stage.removeAllEventListeners("trashsignal"),s.merging?(s.merging=!1,s.blocks.loadNewBlocks(t)):(s.stage.addEventListener("trashsignal",function(){s.blocks.loadNewBlocks(t),s.stage.removeAllEventListeners("trashsignal"),s.planet&&s.planet.saveLocally()},!1),s.sendAllToTrash(!1,!1),s._allClear(!1,!0),s.planet&&(s.planet.closePlanet(),s.planet.initialiseNewProject(s.fileChooser.files[0].name.substr(0,s.fileChooser.files[0].name.lastIndexOf("."))))),s.loading=!1,s.refreshCanvas()}catch(e){s.errorMsg(_("Cannot load project from the file. Please check the file type.")),console.error(e),document.body.style.cursor="default",s.loading=!1}}},200)},t.onload=function(e){var t=new Midi(e.target.result);console.debug(t),m(t)};var a,o=s.fileChooser.files[0];o&&("mid"===(a=o.name.split(".").pop().toLowerCase())||"midi"===a?t.readAsArrayBuffer(o):l.readAsText(o))},!1),o=function(e){e.stopPropagation(),e.preventDefault();var n=e.dataTransfer.files,i=new FileReader,t=new FileReader,a=new FileReader;if(i.onload=function(e){s.loading=!0,document.body.style.cursor="wait",setTimeout(function(){var e=i.result;if(null===e||""===e)s.errorMsg(_("Cannot load project from the file. Please check the file type."));else{var t,a=e.replace("\n"," ");try{for(var o in t=a.includes("html")?JSON.parse(a.match('<div class="code">(.+?)</div>')[1]):JSON.parse(a),s.blocks.palettes.dict)s.palettes.dict[o].hideMenu(!0);s.stage.removeAllEventListeners("trashsignal");var l=function e(){document.removeEventListener("finishedLoading",e)};s.stage.addEventListener("trashsignal",function(){s.blocks.loadNewBlocks(t),s.stage.removeAllEventListeners("trashsignal"),document.addEventListener?document.addEventListener("finishedLoading",l):document.attachEvent("finishedLoading",l)},!1),s.sendAllToTrash(!1,!1),void 0!==s.planet&&s.planet.initialiseNewProject(n[0].name.substr(0,n[0].name.lastIndexOf("."))),s.loading=!1,s.refreshCanvas()}catch(e){console.error(e),s.errorMsg(_("Cannot load project from the file. Please check the file type.")),document.body.style.cursor="default",s.loading=!1}}},200)},t.onload=function(e){var t=new Midi(e.target.result);console.debug(t),m(t)},a.onload=function(e){var t=(t=e.target.result).replace(/\\/g,""),a=new ABCJS.parseOnly(t);console.log(a),a.forEach(function(e){z.parseABC(e)})},a.onload=function(e){var t=(t=e.target.result).replace(/\\/g,""),a=new ABCJS.parseOnly(t);console.log(a),a.forEach(function(e){z.parseABC(e)})},void 0!==n[0]){var o=n[0].name.split(".").pop().toLowerCase();if("mid"==o||"midi"==o)return void t.readAsArrayBuffer(n[0]);if("abc"==o)return void a.readAsText(n[0]);i.readAsText(n[0]),i.readAsText(n[0]),window.scroll(0,0)}},l=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},(n=docById("canvasHolder")).addEventListener("dragover",l,!1),n.addEventListener("drop",o,!1),z.allFilesChooser.addEventListener("click",function(e){z.value=null}),z.pluginChooser.addEventListener("click",function(e){window.scroll(0,0),z.value=null}),z.pluginChooser.addEventListener("change",function(e){window.scroll(0,0);var t=new FileReader;t.onload=function(e){s.loading=!0,document.body.style.cursor="wait",setTimeout(function(){var e=processRawPluginData(s,t.result);null!==e&&(s.storage.plugins=preparePluginExports(s,e)),setTimeout(function(){s.palettes.visible&&s.palettes.hide()},1e3),document.body.style.cursor="default",s.loading=!1},200)},t.readAsText(s.pluginChooser.files[0])},!1),createjs.Touch.enable(z.stage,!1,!0),z.stage.mouseMoveOutside=!0,z.stage.enableMouseOver(10),z.cartesianBitmap=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(CARTESIAN))),z.polarBitmap=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(POLAR))),z.trebleBitmap=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE))),z.grandBitmap=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(GRAND))),z.sopranoBitmap=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(SOPRANO))),z.altoBitmap=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(ALTO))),z.tenorBitmap=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TENOR))),z.bassBitmap=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(BASS))),i=0;i<7;i++)z.grandSharpBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(GRAND_G))),z.grandFlatBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(GRAND_F))),z.trebleSharpBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),z.trebleFlatBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F))),z.sopranoSharpBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),z.sopranoFlatBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F))),z.altoSharpBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),z.altoFlatBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F))),z.tenorSharpBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),z.tenorFlatBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F))),z.bassSharpBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_G))),z.bassFlatBitmap[i]=z._createGrid("data:image/svg+xml;base64,"+window.btoa(base64Encode(TREBLE_F)));if(r=window.location.href,c={run:!1,show:!1,collapse:!1},z._onResize(!0),d=[],!(0<r.indexOf("?"))){e.next=138;break}if(!(0<(u=r.split("?"))[1].indexOf("&"))){e.next=136;break}g=u[1].split("&"),h=0;case 108:if(!(h<g.length)){e.next=134;break}if(!(0<g[h].indexOf("="))){e.next=131;break}p=g[h].split("="),e.t1=p[0].toLowerCase(),e.next="file"===e.t1?114:"id"===e.t1?115:"run"===e.t1?117:"show"===e.t1?119:"collapse"===e.t1?121:"inurl"===e.t1?123:"outurl"===e.t1?127:129;break;case 114:return e.abrupt("break",131);case 115:return z.projectID=p[1],e.abrupt("break",131);case 117:return"true"===p[1].toLowerCase()&&(c.run=!0),e.abrupt("break",131);case 119:return"true"===p[1].toLowerCase()&&(c.show=!0),e.abrupt("break",131);case 121:return"true"===p[1].toLowerCase()&&(c.collapse=!0),e.abrupt("break",131);case 123:return M=p[1],function(e){return new Promise(function(t,a){var o=new XMLHttpRequest;o.open("get",e,!0),o.responseType="json",o.onload=function(){var e=o.status;200===e?t(o.response):a(e)},o.send()})}(M).then(function(e){var t=e.arg;d.push(parseInt(t))},function(e){alert("Something went wrong reading JSON-encoded project data.")}),e.abrupt("break",131);case 127:return M=p[1],e.abrupt("break",131);case 129:return z.errorMsg(_("Invalid parameters")),e.abrupt("break",131);case 131:h++,e.next=108;break;case 134:e.next=138;break;case 136:0<u[1].indexOf("=")&&(p=u[1].split("=")),"id"===p[0].toLowerCase()&&(z.projectID=p[1]);case 138:null!==z.projectID?setTimeout(function(){s.loadStartWrapper(U,s.projectID,c,d)},200):setTimeout(function(){s.loadStartWrapper(W)},200),z.prepSearchWidget(),z._create2Ddrag(),b=z,document.onkeydown=function(){b.__keyPressed(event)},void 0!==z.planet&&z.planet.planet.setAnalyzeProject(doAnalyzeProject);case 144:case"end":return e.stop()}},e,null,[[36,42]])}))}return _createClass(J,[{key:"saveLocally",value:function(){try{localStorage.setItem("beginnerMode",this.beginnerMode.toString()),localStorage.setItem("themePreference",this.themePreference.toString())}catch(e){console.error("Error saving to localStorage:",e)}}},{key:"regeneratePalettes",value:function(){try{var e={};if(this.palettes&&this.palettes.dict)for(var t in this.palettes.dict){var a=this.palettes.dict[t];a&&a.container&&void 0!==a.container.x&&(e[t]={x:a.container.x,y:a.container.y,visible:!!a.visible})}if(!this.palettes)return void console.warn("Palettes object not initialized");if("function"!=typeof this.palettes.hide?console.warn("Palettes hide method not available"):this.palettes.hide(),"function"!=typeof this.palettes.clear?(console.warn("Palettes clear method not available"),this.palettes.dict={},this.palettes.visible=!1,this.palettes.activePalette=null,this.palettes.paletteObject=null):this.palettes.clear(),initPalettes(this.palettes),this.blocks&&initBasicProtoBlocks(this),this.palettes&&this.palettes.dict)for(var o in e){var l=this.palettes.dict[o],n=e[o];l&&l.container&&n&&(l.container.x=n.x,l.container.y=n.y,n.visible&&l.showMenu(!0))}this.palettes&&"function"==typeof this.palettes.updatePalettes&&this.palettes.updatePalettes(),this.blocks&&"function"==typeof this.blocks.updateBlockPositions&&this.blocks.updateBlockPositions(),this.refreshCanvas()}catch(e){console.error("Error regenerating palettes:",e),this.errorMsg(_("Error regenerating palettes. Please refresh the page."))}}}]),J}(),activity=new Activity;require(["domReady!"],function(e){setTimeout(function(){activity.setupDependencies(),activity.domReady(e)},5e3)}),define(MYDEFINES,function(e){activity.setupDependencies(),activity.doContextMenus(),activity.doPluginsAndPaletteCols()});